(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,830046,e=>{"use strict";e.i(313550);var s=e.i(111043),t=e.i(818796),a=e.i(560149),l=e.i(747146),r=e.i(904653),n=e.i(970799),i=e.i(552038),c=(0,i.createServerReference)("600f2001e85494de7547a5213c6143dced69476baf",i.callServer,void 0,i.findSourceMapURL,"getCustomerCallData"),o=(0,i.createServerReference)("60e51c1544e88202aee90bf80bbe297c22b52e59cc",i.callServer,void 0,i.findSourceMapURL,"getCustomerCallDataById"),d=e.i(7550),m=e.i(762744),x=e.i(808529),u=e.i(193822),h=e.i(126256),p=e.i(311003),j=e.i(14100),f=e.i(224262),g=e.i(874283),N=e.i(837362),N=N,v=e.i(50675),b=e.i(181947),w=e.i(189355),y=e.i(721855),C=e.i(452865),S=e.i(212409);e.i(670258);var k=e.i(921251);e.i(553153);var T=e.i(363712);e.i(889265);var _=e.i(677607);e.i(794747);var D=e.i(513990),A=e.i(152088);function P({callId:e,isActive:t,isMuted:a,isOnHold:l,isRecording:r,videoStatus:i,connectionQuality:c,callDuration:o,holdStartTime:P,recordingStartTime:L,customerData:F,callerName:B,callerNumber:E,onMuteToggle:I,onHoldToggle:R,onRecordToggle:M,onVideoToggle:U,onTransfer:z,onEndCall:O,onClose:V,onShowShortcuts:$}){let[H,q]=(0,n.useState)(!1),[J,K]=(0,n.useState)(0);(0,n.useEffect)(()=>{if(!l||!P)return void K(0);let e=setInterval(()=>{K(Math.floor((Date.now()-P)/1e3))},1e3);return()=>clearInterval(e)},[l,P]);let[Y,W]=(0,n.useState)(0);(0,n.useEffect)(()=>{if(!r||!L)return void W(0);let e=setInterval(()=>{W(Math.floor((Date.now()-L)/1e3))},1e3);return()=>clearInterval(e)},[r,L]);let X=e=>{let s=Math.floor(e/60);return`${s}:${(e%60).toString().padStart(2,"0")}`},G=F?.customer&&"object"==typeof F.customer&&"avatar_url"in F.customer?F.customer.avatar_url??void 0:void 0;return(0,s.jsx)(D.TooltipProvider,{delayDuration:300,children:(0,s.jsxs)("div",{className:"relative",children:[a&&(0,s.jsxs)("div",{className:"bg-destructive/10 border-destructive/30 flex items-center justify-center gap-2 border-b px-4 py-2",children:[(0,s.jsx)(h.MicOff,{className:"text-destructive h-4 w-4 animate-pulse"}),(0,s.jsx)("span",{className:"text-destructive text-sm font-medium",children:"You are muted"}),(0,s.jsx)("span",{className:"text-destructive/70 text-xs",children:"Press M to unmute"})]}),l&&(0,s.jsxs)("div",{className:"bg-warning/10 border-warning/30 flex items-center justify-center gap-2 border-b px-4 py-2",children:[(0,s.jsx)(v.Timer,{className:"text-warning h-4 w-4"}),(0,s.jsx)("span",{className:"text-warning text-sm font-medium",children:"Call on hold"}),(0,s.jsx)(T.Badge,{variant:"outline",className:"text-warning border-warning/50 font-mono text-xs",children:X(J)}),(0,s.jsx)("span",{className:"text-warning/70 text-xs",children:"Press H to resume"})]}),(0,s.jsxs)("div",{className:"bg-card/50 flex items-center justify-between px-6 py-3 backdrop-blur-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)(k.Avatar,{className:"h-11 w-11",children:[(0,s.jsx)(k.AvatarImage,{src:G}),(0,s.jsx)(k.AvatarFallback,{className:(0,A.cn)("text-base font-semibold transition-all",t?"bg-emerald-500/20 text-emerald-600 ring-2 ring-emerald-500/30":"bg-muted text-muted-foreground"),children:B&&"Unknown Caller"!==B?B.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):"?"})]}),t&&(0,s.jsx)("div",{className:"ring-background absolute -top-0.5 -right-0.5 h-3 w-3 rounded-full bg-emerald-500 ring-2"})]}),(0,s.jsxs)("div",{className:"space-y-0.5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-foreground text-sm font-semibold",children:B}),t&&(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)("span",{className:"text-muted-foreground font-mono text-xs tabular-nums",children:o}),r&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(m.Circle,{className:"size-2 animate-pulse fill-red-500 text-red-500"}),(0,s.jsxs)("span",{className:"text-destructive font-mono text-xs",children:["REC ",X(Y)]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-muted-foreground font-mono text-xs",children:E}),F?.isKnownCustomer&&(0,s.jsx)(T.Badge,{className:"h-4 px-1.5 text-[10px]",variant:"outline",children:"Customer"})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,s.jsxs)(D.Tooltip,{children:[(0,s.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,s.jsx)(_.Button,{className:(0,A.cn)("h-10 w-10 rounded-full transition-all hover:scale-105",a&&"ring-destructive/50 ring-2 ring-offset-2",!a&&"hover:bg-muted"),onClick:I,size:"icon",variant:a?"destructive":"ghost",children:a?(0,s.jsx)(h.MicOff,{className:"size-4 animate-pulse"}):(0,s.jsx)(u.Mic,{className:"size-4"})})}),(0,s.jsxs)(D.TooltipContent,{side:"bottom",children:[(0,s.jsx)("p",{children:a?"Unmute":"Mute"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press M"})]})]}),(0,s.jsxs)(D.Tooltip,{children:[(0,s.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,s.jsx)(_.Button,{className:(0,A.cn)("h-10 w-10 rounded-full transition-all hover:scale-105",l&&"ring-warning/50 ring-2 ring-offset-2",!l&&"hover:bg-muted"),onClick:R,size:"icon",variant:l?"secondary":"ghost",children:l?(0,s.jsx)(f.Play,{className:"size-4"}):(0,s.jsx)(p.Pause,{className:"size-4"})})}),(0,s.jsxs)(D.TooltipContent,{side:"bottom",children:[(0,s.jsx)("p",{children:l?"Resume":"Hold"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press H"})]})]}),(0,s.jsxs)(D.Tooltip,{children:[(0,s.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,s.jsx)(_.Button,{className:(0,A.cn)("h-10 w-10 rounded-full transition-all hover:scale-105",r&&"ring-destructive/50 ring-2 ring-offset-2",!r&&"hover:bg-muted"),onClick:M,size:"icon",variant:r?"destructive":"ghost",children:r?(0,s.jsx)(m.Circle,{className:"size-4 animate-pulse fill-current"}):(0,s.jsx)(N.default,{className:"size-4"})})}),(0,s.jsxs)(D.TooltipContent,{side:"bottom",children:[(0,s.jsx)("p",{children:r?"Stop Recording":"Record"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press R"})]})]}),(0,s.jsx)("div",{className:"bg-border mx-2 h-6 w-px"}),(0,s.jsxs)(D.Tooltip,{children:[(0,s.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,s.jsx)(_.Button,{className:(0,A.cn)("h-10 w-10 rounded-full transition-all hover:scale-105","off"===i&&"hover:bg-muted"),onClick:U,size:"icon",variant:"connected"===i?"default":"ghost",children:"connected"===i?(0,s.jsx)(b.Video,{className:"size-4"}):(0,s.jsx)(w.VideoOff,{className:"size-4"})})}),(0,s.jsx)(D.TooltipContent,{side:"bottom",children:(0,s.jsx)("p",{children:"connected"===i?"End Video":"Start Video"})})]}),(0,s.jsxs)(D.Tooltip,{children:[(0,s.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,s.jsx)(_.Button,{className:"hover:bg-muted h-10 w-10 rounded-full transition-all hover:scale-105",onClick:z,size:"icon",variant:"ghost",children:(0,s.jsx)(d.ArrowRightLeft,{className:"size-4"})})}),(0,s.jsxs)(D.TooltipContent,{side:"bottom",children:[(0,s.jsx)("p",{children:"Transfer Call"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press T"})]})]}),(0,s.jsx)("div",{className:"bg-border mx-2 h-6 w-px"}),(0,s.jsxs)(D.Tooltip,{children:[(0,s.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,s.jsx)(_.Button,{className:"text-destructive-foreground h-12 w-12 rounded-full transition-all hover:scale-105",onClick:O,size:"icon",variant:"destructive",children:(0,s.jsx)(j.PhoneOff,{className:"size-5"})})}),(0,s.jsxs)(D.TooltipContent,{side:"bottom",children:[(0,s.jsx)("p",{children:"End Call"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press Shift+E"})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsxs)(T.Badge,{className:"font-mono text-[10px]",title:"unknown"===c?"Monitoring connection quality...":void 0,variant:(()=>{switch(c){case"excellent":return"default";case"good":return"secondary";case"poor":return"destructive";default:return"outline"}})(),children:[(()=>{switch(c){case"excellent":return(0,s.jsx)(g.Signal,{className:"text-success h-3 w-3"});case"good":return(0,s.jsx)(y.Wifi,{className:"text-warning h-3 w-3"});case"poor":return(0,s.jsx)(C.WifiOff,{className:"text-destructive h-3 w-3"});default:return(0,s.jsx)(g.Signal,{className:"text-muted-foreground h-3 w-3"})}})(),(0,s.jsx)("span",{className:"ml-1 capitalize",children:c})]}),$&&(0,s.jsxs)(D.Tooltip,{children:[(0,s.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,s.jsx)(_.Button,{className:"h-8 w-8",onClick:$,size:"icon",variant:"ghost",children:(0,s.jsx)(x.Keyboard,{className:"h-4 w-4"})})}),(0,s.jsxs)(D.TooltipContent,{side:"bottom",children:[(0,s.jsx)("p",{children:"Keyboard Shortcuts"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press ?"})]})]}),(0,s.jsx)(_.Button,{className:"h-8 w-8",onClick:V,size:"icon",variant:"ghost",children:(0,s.jsx)(S.X,{className:"h-4 w-4"})})]})]})]})})}var L=e.i(327149),F=e.i(263942),B=e.i(276389),E=e.i(881177),E=E,I=e.i(606661),R=e.i(979731),M=e.i(201710),U=e.i(62538),z=e.i(732436),z=z,O=e.i(559586),V=e.i(15751),$=e.i(939397),H=e.i(371526),q=e.i(598870),J=e.i(75063),J=J,K=e.i(14435),Y=e.i(501651);e.i(51478);var W=e.i(635613);e.i(149989);var X=e.i(880177);e.i(254978);var G=e.i(375308),Q=e.i(220168);e.i(526120);var Z=e.i(610120);e.i(711448);var ee=e.i(157222);let es=[{id:"greeting",text:"Greet customer warmly and smile while speaking",enabled:!0,order:1},{id:"verify",text:"Verify customer name, phone, and service address",enabled:!0,order:2},{id:"availability",text:"Ask about preferred appointment times and availability",enabled:!0,order:3},{id:"confirm",text:"Confirm all details before ending the call",enabled:!0,order:4}];var et=e.i(943174),et=et,ea=e.i(511623),ea=ea,el=e.i(403468),er=e.i(397595),en=e.i(265444),en=en,ei=e.i(175913),ec=e.i(129932);let eo={past_due:{icon:el.CreditCard,bgColor:"bg-destructive/10 dark:bg-destructive/20",borderColor:"border-destructive/50",textColor:"text-destructive",iconColor:"text-destructive"},vip:{icon:er.Crown,bgColor:"bg-amber-500/10 dark:bg-amber-500/20",borderColor:"border-amber-500/50",textColor:"text-amber-600 dark:text-amber-400",iconColor:"text-amber-500"},at_risk:{icon:ec.TrendingDown,bgColor:"bg-orange-500/10 dark:bg-orange-500/20",borderColor:"border-orange-500/50",textColor:"text-orange-600 dark:text-orange-400",iconColor:"text-orange-500"},complaint:{icon:en.default,bgColor:"bg-warning/10 dark:bg-warning/20",borderColor:"border-warning/50",textColor:"text-warning",iconColor:"text-warning"},blocked:{icon:ea.default,bgColor:"bg-destructive/15 dark:bg-destructive/25",borderColor:"border-destructive",textColor:"text-destructive",iconColor:"text-destructive"},new_customer:{icon:ei.Star,bgColor:"bg-primary/10 dark:bg-primary/20",borderColor:"border-primary/50",textColor:"text-primary",iconColor:"text-primary"},high_value:{icon:et.default,bgColor:"bg-success/10 dark:bg-success/20",borderColor:"border-success/50",textColor:"text-success",iconColor:"text-success"}};function ed({customerData:e,stats:t,onTakePayment:a,onViewHistory:l,onViewComplaints:r,className:i}){let[c,o]=(0,n.useState)(new Set),d=[];if(!e||!t)return null;let{customer:m}=e;if(t.openInvoices>0){let s=e.invoices.filter(e=>"unpaid"===e.status||"overdue"===e.status).reduce((e,s)=>e+(s.total_amount||0),0);if(s>0){let l=e.invoices.some(e=>"overdue"===e.status);d.push({id:"past_due",type:"past_due",title:l?"Past Due Balance":"Outstanding Balance",description:`${t.openInvoices} unpaid invoice${t.openInvoices>1?"s":""}`,amount:s,action:a?{label:"Take Payment",onClick:a}:void 0})}}let x=m?.tags?.includes("VIP")||m?.tags?.includes("vip")||m?.priority_level==="high";x&&d.push({id:"vip",type:"vip",title:"VIP Customer",description:"Priority service â€¢ Extended support",dismissible:!0}),t.totalRevenue>1e4&&!x&&d.push({id:"high_value",type:"high_value",title:"High Value Customer",description:`Lifetime value: ${em(t.totalRevenue)}`,dismissible:!0}),m?.created_at&&new Date(m.created_at)>new Date(Date.now()-2592e6)&&0===t.totalRevenue&&d.push({id:"new_customer",type:"new_customer",title:"New Customer",description:"First interaction â€¢ Make a great impression!",dismissible:!0});let u=e.jobs.filter(e=>"cancelled"===e.status).length;u>=2&&d.push({id:"at_risk",type:"at_risk",title:"At-Risk Customer",description:`${u} cancelled jobs â€¢ Consider retention offer`,action:l?{label:"View History",onClick:l}:void 0}),(m?.notes?.toLowerCase().includes("complaint")||m?.notes?.toLowerCase().includes("unhappy")||m?.notes?.toLowerCase().includes("frustrated"))&&d.push({id:"complaint",type:"complaint",title:"Recent Complaint",description:"Customer had a previous issue â€¢ Handle with care",action:r?{label:"View Details",onClick:r}:void 0}),(m?.status==="blocked"||m?.tags?.includes("problem")||m?.tags?.includes("do-not-service"))&&d.push({id:"blocked",type:"blocked",title:"Service Restricted",description:"Check with manager before scheduling"});let h=d.filter(e=>!c.has(e.id));return 0===h.length?null:(0,s.jsx)("div",{className:(0,A.cn)("space-y-2",i),children:h.map(e=>{let t=eo[e.type],a=t.icon;return(0,s.jsx)("div",{className:(0,A.cn)("relative overflow-hidden rounded-lg border p-3 transition-all",t.bgColor,t.borderColor),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:(0,A.cn)("mt-0.5 flex h-8 w-8 shrink-0 items-center justify-center rounded-full",t.bgColor),children:(0,s.jsx)(a,{className:(0,A.cn)("h-4 w-4",t.iconColor)})}),(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("h4",{className:(0,A.cn)("text-sm font-semibold",t.textColor),children:e.title}),void 0!==e.amount&&(0,s.jsx)(T.Badge,{className:(0,A.cn)("font-mono text-xs",t.textColor),variant:"outline",children:em(e.amount)})]}),(0,s.jsx)("p",{className:(0,A.cn)("mt-0.5 text-xs opacity-80",t.textColor),children:e.description}),e.action&&(0,s.jsx)(_.Button,{className:(0,A.cn)("mt-2 h-7 text-xs",t.textColor),onClick:e.action.onClick,size:"sm",variant:"outline",children:e.action.label})]}),e.dismissible&&(0,s.jsx)(_.Button,{className:(0,A.cn)("h-6 w-6 shrink-0 opacity-60 hover:opacity-100",t.textColor),onClick:()=>{var s;return s=e.id,void o(e=>new Set([...e,s]))},size:"icon",variant:"ghost",children:(0,s.jsx)(S.X,{className:"h-3 w-3"})})]})},e.id)})})}function em(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}var ex=e.i(376089),eu=e.i(136764);function eh({stats:e,openBalance:t=0,lastVisitDate:a,className:l}){var r,n;let i=e=>e>=1e3?`$${(e/1e3).toFixed(1)}k`:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),c=(r=e.totalRevenue)>=1e4?"text-success":r>=5e3?"text-primary":r>=1e3?"text-foreground":"text-muted-foreground",o=t>0;return(0,s.jsx)(D.TooltipProvider,{delayDuration:200,children:(0,s.jsx)("div",{className:(0,A.cn)("bg-card/80 sticky top-0 z-10 border-b backdrop-blur-sm",l),children:(0,s.jsxs)("div",{className:"grid grid-cols-5 divide-x",children:[(0,s.jsxs)(D.Tooltip,{children:[(0,s.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(ex.Banknote,{className:(0,A.cn)("h-3.5 w-3.5",c)}),(0,s.jsx)("span",{className:(0,A.cn)("text-xs font-bold",c),children:i(e.totalRevenue)})]}),(0,s.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Revenue"})]})}),(0,s.jsxs)(D.TooltipContent,{children:[(0,s.jsx)("p",{children:"Total Lifetime Revenue"}),(0,s.jsxs)("p",{className:"text-muted-foreground text-xs",children:[(n=e.totalRevenue)>=1e4?"High Value":n>=5e3?"Good":n>=1e3?"Average":n>0?"New":"No History"," customer"]})]})]}),(0,s.jsxs)(D.Tooltip,{children:[(0,s.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,s.jsxs)("div",{className:(0,A.cn)("flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50",o&&"bg-destructive/5"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(el.CreditCard,{className:(0,A.cn)("h-3.5 w-3.5",o?"text-destructive":"text-muted-foreground")}),(0,s.jsx)("span",{className:(0,A.cn)("text-xs font-bold",o?"text-destructive":"text-muted-foreground"),children:o?i(t):"$0"})]}),(0,s.jsx)("span",{className:"text-muted-foreground text-[10px]",children:o?"Due":"Balance"})]})}),(0,s.jsxs)(D.TooltipContent,{children:[(0,s.jsx)("p",{children:o?"Outstanding Balance":"No Balance Due"}),o&&(0,s.jsxs)("p",{className:"text-destructive text-xs",children:[e.openInvoices," unpaid invoice",1!==e.openInvoices?"s":""]})]})]}),(0,s.jsxs)(D.Tooltip,{children:[(0,s.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(L.Briefcase,{className:(0,A.cn)("h-3.5 w-3.5",e.activeJobs>0?"text-primary":"text-muted-foreground")}),(0,s.jsx)("span",{className:(0,A.cn)("text-xs font-bold",e.activeJobs>0?"text-primary":"text-muted-foreground"),children:e.activeJobs})]}),(0,s.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Active"})]})}),(0,s.jsxs)(D.TooltipContent,{children:[(0,s.jsx)("p",{children:"Active Jobs"}),(0,s.jsxs)("p",{className:"text-muted-foreground text-xs",children:[e.totalJobs," total jobs"]})]})]}),(0,s.jsxs)(D.Tooltip,{children:[(0,s.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(eu.Clock,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,s.jsx)("span",{className:"text-foreground text-xs font-bold",children:(e=>{if(!e)return"Never";let s=new Date(e),t=Math.floor((new Date().getTime()-s.getTime())/864e5);return 0===t?"Today":1===t?"Yesterday":t<7?`${t} days ago`:t<30?`${Math.floor(t/7)} weeks ago`:t<365?`${Math.floor(t/30)} months ago`:s.toLocaleDateString("en-US",{month:"short",year:"numeric"})})(a??null)})]}),(0,s.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Last Visit"})]})}),(0,s.jsxs)(D.TooltipContent,{children:[(0,s.jsx)("p",{children:"Last Service Visit"}),a&&(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:new Date(a).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]})]}),(0,s.jsxs)(D.Tooltip,{children:[(0,s.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(K.User,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,s.jsx)("span",{className:"text-foreground text-xs font-bold",children:(()=>{if(!e.customerSince)return"New";let s=new Date(e.customerSince),t=(new Date().getTime()-s.getTime())/31536e6;if(t<1){let e=Math.floor(12*t);return e<=1?"< 1 mo":`${e} mo`}return`${Math.floor(t)}y`})()})]}),(0,s.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Member"})]})}),(0,s.jsxs)(D.TooltipContent,{children:[(0,s.jsx)("p",{children:"Customer Since"}),e.customerSince&&(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:new Date(e.customerSince).toLocaleDateString("en-US",{month:"long",year:"numeric"})})]})]})]})})})}var ep=e.i(512710),ej=e.i(263699),ef=e.i(142642),eg=e.i(751139);let eN={resolved:"bg-success/10 text-success border-success/30",callback_scheduled:"bg-warning/10 text-warning border-warning/30",escalated:"bg-orange-500/10 text-orange-500 border-orange-500/30",voicemail_left:"bg-muted text-muted-foreground border-muted",transferred:"bg-muted text-muted-foreground border-muted",customer_hung_up:"bg-muted text-muted-foreground border-muted",appointment_booked:"bg-primary/10 text-primary border-primary/30",quote_provided:"bg-primary/10 text-primary border-primary/30",payment_taken:"bg-success/10 text-success border-success/30",other:"bg-muted text-muted-foreground border-muted"},ev={positive:"ðŸ˜Š",neutral:"ðŸ˜",negative:"ðŸ˜ "};function eb({lastCall:e,recentCalls:t=[],onViewAllCalls:a,className:r}){let i,c,o,[d,m]=(0,n.useState)(!1);if(!e)return(0,s.jsx)("div",{className:(0,A.cn)("border-primary/20 bg-primary/5 rounded-xl border p-4",r),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"bg-primary/10 rounded-full p-2",children:(0,s.jsx)($.Phone,{className:"text-primary h-4 w-4"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"text-sm font-semibold",children:"First Call"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1 text-xs",children:"This is the first call with this customer. No previous call history available."})]})]})});let x=e=>{let s=Math.floor(e/60),t=e%60;return 0===s?`${t}s`:`${s}m ${t}s`},u=eN[e.disposition]||eN.other;return(0,s.jsxs)("div",{className:(0,A.cn)("bg-muted/30 overflow-hidden rounded-xl border transition-all",r),children:[(0,s.jsxs)("button",{className:"flex w-full items-center justify-between p-4 text-left transition-colors hover:bg-muted/50",onClick:()=>m(!d),type:"button",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"bg-muted rounded-full p-2",children:(0,s.jsx)($.Phone,{className:"text-muted-foreground h-4 w-4"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("h4",{className:"text-sm font-semibold",children:"Previous Call"}),e.sentiment&&(0,s.jsx)("span",{title:`Customer was ${e.sentiment}`,children:ev[e.sentiment]})]}),(0,s.jsxs)("p",{className:"text-muted-foreground text-xs",children:[(i=new Date(e.date),0===(o=Math.floor(((c=new Date).getTime()-i.getTime())/864e5))?`Today at ${i.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:1===o?`Yesterday at ${i.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:o<7?`${o} days ago`:i.toLocaleDateString("en-US",{month:"short",day:"numeric",year:i.getFullYear()!==c.getFullYear()?"numeric":void 0}))," â€¢ ",x(e.duration)]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(T.Badge,{className:(0,A.cn)("text-xs",u),variant:"outline",children:e.disposition.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),d?(0,s.jsx)(ej.ChevronUp,{className:"text-muted-foreground h-4 w-4"}):(0,s.jsx)(ep.ChevronDown,{className:"text-muted-foreground h-4 w-4"})]})]}),d&&(0,s.jsxs)("div",{className:"border-t p-4 pt-3",children:[(0,s.jsxs)("div",{className:"mb-3 grid grid-cols-3 gap-2",children:[(0,s.jsxs)("div",{className:"bg-card rounded-lg p-2 text-center",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,s.jsx)(K.User,{className:"text-muted-foreground h-3 w-3"}),(0,s.jsx)("span",{className:"text-xs font-medium",children:e.csrName})]}),(0,s.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Handled by"})]}),(0,s.jsxs)("div",{className:"bg-card rounded-lg p-2 text-center",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,s.jsx)(eu.Clock,{className:"text-muted-foreground h-3 w-3"}),(0,s.jsx)("span",{className:"text-xs font-medium",children:x(e.duration)})]}),(0,s.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Duration"})]}),(0,s.jsxs)("div",{className:"bg-card rounded-lg p-2 text-center",children:[(0,s.jsx)("div",{className:"flex items-center justify-center gap-1",children:e.issueResolved?(0,s.jsx)("span",{className:"text-success text-xs font-medium",children:"Yes"}):(0,s.jsx)("span",{className:"text-warning text-xs font-medium",children:"No"})}),(0,s.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Resolved"})]})]}),e.topics&&e.topics.length>0&&(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsxs)("div",{className:"mb-1.5 flex items-center gap-1",children:[(0,s.jsx)(ef.Sparkles,{className:"text-primary h-3 w-3"}),(0,s.jsx)("span",{className:"text-muted-foreground text-xs font-medium",children:"Topics Discussed"})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:e.topics.map((e,t)=>(0,s.jsx)(T.Badge,{className:"text-[10px]",variant:"secondary",children:e},t))})]}),e.notes&&(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsxs)("div",{className:"mb-1.5 flex items-center gap-1",children:[(0,s.jsx)(I.FileText,{className:"text-muted-foreground h-3 w-3"}),(0,s.jsx)("span",{className:"text-muted-foreground text-xs font-medium",children:"Notes"})]}),(0,s.jsx)("p",{className:"bg-card rounded-lg border p-2 text-xs",children:e.notes})]}),e.followUpScheduled&&!e.issueResolved&&(0,s.jsxs)("div",{className:"bg-warning/10 border-warning/30 flex items-start gap-2 rounded-lg border p-2",children:[(0,s.jsx)(eg.AlertTriangle,{className:"text-warning mt-0.5 h-3.5 w-3.5 shrink-0"}),(0,s.jsx)("p",{className:"text-warning text-xs",children:"Follow-up was scheduled for this customer. Check if issue was resolved."})]}),a&&t.length>0&&(0,s.jsxs)(_.Button,{className:"mt-3 w-full gap-1 text-xs",onClick:a,size:"sm",variant:"outline",children:[(0,s.jsx)(l.MessageSquare,{className:"h-3 w-3"}),"View All ",t.length+1," Calls"]})]})]})}function ew({onCreateJob:e,onScheduleAppointment:t,onSendSMS:a,onSendEmail:r,onTakePayment:n,onAddNote:i,onAISuggestion:c,customerEmail:o,customerPhone:d,hasOutstandingBalance:m,outstandingAmount:x,className:u,layout:h="grid"}){let p=[{id:"job",label:"New Job",shortLabel:"Job",icon:(0,s.jsx)(L.Briefcase,{className:"h-4 w-4"}),shortcut:"J",variant:"default",onClick:e,description:"Create a new job for this customer"},{id:"appointment",label:"Schedule",icon:(0,s.jsx)(B.Calendar,{className:"h-4 w-4"}),shortcut:"A",variant:"outline",onClick:t,description:"Schedule an appointment"},{id:"sms",label:"SMS",icon:(0,s.jsx)(l.MessageSquare,{className:"h-4 w-4"}),shortcut:"S",variant:"outline",onClick:a,disabled:!d,description:d?"Send SMS to customer":"No phone number available"},{id:"email",label:"Email",icon:(0,s.jsx)(O.Mail,{className:"h-4 w-4"}),shortcut:"E",variant:"outline",onClick:r,disabled:!o,description:o?"Send email to customer":"No email address available"},{id:"note",label:"Note",icon:(0,s.jsx)(I.FileText,{className:"h-4 w-4"}),shortcut:"N",variant:"outline",onClick:i,description:"Add a note to this call"}];return n&&m&&p.push({id:"payment",label:"Payment",icon:(0,s.jsx)(el.CreditCard,{className:"h-4 w-4"}),variant:"secondary",onClick:n,badge:x?`$${x.toLocaleString()}`:"Due",description:"Take payment for outstanding balance"}),(0,s.jsx)(D.TooltipProvider,{delayDuration:300,children:(0,s.jsxs)("div",{className:(0,A.cn)("space-y-3",u),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("h4",{className:"text-muted-foreground flex items-center gap-2 text-xs font-semibold tracking-wide uppercase",children:[(0,s.jsx)(H.Plus,{className:"h-3 w-3"}),"Quick Actions"]}),c&&(0,s.jsxs)(_.Button,{className:"h-6 gap-1 px-2 text-xs",onClick:c,size:"sm",variant:"ghost",children:[(0,s.jsx)(ef.Sparkles,{className:"h-3 w-3"}),"AI Suggest"]})]}),(0,s.jsx)("div",{className:{horizontal:"flex flex-wrap items-center gap-2",vertical:"flex flex-col gap-2",grid:"grid grid-cols-3 gap-2"}[h],children:p.map(e=>(0,s.jsxs)(D.Tooltip,{children:[(0,s.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,s.jsxs)(_.Button,{className:(0,A.cn)("relative h-10 gap-2 text-sm","grid"===h&&"w-full flex-col h-auto py-3","vertical"===h&&"w-full justify-start"),disabled:e.disabled,onClick:e.onClick,size:"sm",variant:e.variant||"outline",children:[e.icon,(0,s.jsx)("span",{className:(0,A.cn)("grid"===h&&"text-xs"),children:"horizontal"===h&&e.shortLabel||e.label}),e.badge&&(0,s.jsx)(T.Badge,{className:"absolute -top-1 -right-1 h-5 px-1.5 text-[10px]",variant:"destructive",children:e.badge})]})}),(0,s.jsxs)(D.TooltipContent,{side:"bottom",children:[(0,s.jsx)("p",{children:e.description||e.label}),e.shortcut&&(0,s.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Press ",e.shortcut]})]})]},e.id))}),(0,s.jsx)("p",{className:"text-muted-foreground/60 text-center text-[10px]",children:"Press ? to see all shortcuts"})]})})}function ey({customerData:e,isLoading:a,onCreateJob:l,onScheduleAppointment:r,onSendSMS:i,onSendEmail:c,onTakePayment:o,onAddNote:d,previousCall:m}){let x=es.filter(e=>e.enabled).sort((e,s)=>e.order-s.order),u=e?.invoices.filter(e=>"unpaid"===e.status||"overdue"===e.status).reduce((e,s)=>e+(s.total_amount||0),0)||0,h=e?.jobs.filter(e=>"completed"===e.status).sort((e,s)=>{let t=e.completed_at||e.updated_at||"";return new Date(s.completed_at||s.updated_at||"").getTime()-new Date(t).getTime()})[0]?.completed_at||null;if(a)return(0,s.jsx)("div",{className:"flex h-full items-center justify-center p-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"border-primary mx-auto mb-4 h-12 w-12 animate-spin rounded-full border-4 border-t-transparent"}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm",children:"Loading customer data..."})]})});if(!e)return(0,s.jsx)("div",{className:"flex h-full items-center justify-center p-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(t.AlertCircle,{className:"text-muted-foreground mx-auto mb-4 h-12 w-12"}),(0,s.jsx)("p",{className:"text-foreground font-medium",children:"No customer data"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1 text-sm",children:"Customer information will appear here"})]})});let{customer:p,stats:j,jobs:f,invoices:g,estimates:N,appointments:v,properties:b,equipment:w}=e,y=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),C=e=>e?new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"N/A",[k,D]=(0,n.useState)(p?.phone?[p.phone]:[""]),[A,P]=(0,n.useState)(p?.email?[p.email]:[""]),et=async()=>{},ea=[{id:"overview",title:"Customer Overview",icon:(0,s.jsx)(K.User,{className:"h-4 w-4"}),actions:(0,s.jsxs)(_.Button,{className:"h-8 gap-1.5 px-3",onClick:et,size:"sm",variant:"default",children:[(0,s.jsx)(q.Save,{className:"h-3.5 w-3.5"}),"Save"]}),content:(0,s.jsxs)("div",{className:"space-y-6 p-6",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h4",{className:"text-sm font-semibold",children:"Basic Information"}),(0,s.jsxs)(Q.StandardFormRow,{cols:2,children:[(0,s.jsx)(Q.StandardFormField,{label:"First Name",htmlFor:"firstName",children:(0,s.jsx)(W.Input,{defaultValue:p?.first_name||"",id:"firstName",placeholder:"Enter first name"})}),(0,s.jsx)(Q.StandardFormField,{label:"Last Name",htmlFor:"lastName",children:(0,s.jsx)(W.Input,{defaultValue:p?.last_name||"",id:"lastName",placeholder:"Enter last name"})})]}),(0,s.jsx)(Q.StandardFormField,{label:"Company",htmlFor:"company",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(F.Building2,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,s.jsx)(W.Input,{className:"pl-9",defaultValue:p?.company_name||"",id:"company",placeholder:"Enter company name"})]})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsx)("h4",{className:"text-sm font-semibold",children:"Contact Information"})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(X.Label,{children:"Email Addresses"}),A.map((e,t)=>(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)("div",{className:"relative flex-1",children:[(0,s.jsx)(O.Mail,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,s.jsx)(W.Input,{className:"pl-9",onChange:e=>{var s;let a;return s=e.target.value,void((a=[...A])[t]=s,P(a))},placeholder:"email@example.com",type:"email",value:e})]}),A.length>1&&(0,s.jsx)(_.Button,{className:"h-9 w-9",onClick:()=>{P(A.filter((e,s)=>s!==t))},size:"icon",variant:"ghost",children:(0,s.jsx)(S.X,{className:"h-4 w-4"})})]},t)),(0,s.jsxs)(_.Button,{className:"w-full",onClick:()=>P([...A,""]),size:"sm",variant:"outline",children:[(0,s.jsx)(H.Plus,{className:"mr-2 h-4 w-4"}),"Add Email"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(X.Label,{children:"Phone Numbers"}),k.map((e,t)=>(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)("div",{className:"relative flex-1",children:[(0,s.jsx)($.Phone,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,s.jsx)(W.Input,{className:"pl-9",onChange:e=>{var s;let a;return s=e.target.value,void((a=[...k])[t]=s,D(a))},placeholder:"(555) 123-4567",type:"tel",value:e})]}),k.length>1&&(0,s.jsx)(_.Button,{className:"h-9 w-9",onClick:()=>{D(k.filter((e,s)=>s!==t))},size:"icon",variant:"ghost",children:(0,s.jsx)(S.X,{className:"h-4 w-4"})})]},t)),(0,s.jsxs)(_.Button,{className:"w-full",onClick:()=>D([...k,""]),size:"sm",variant:"outline",children:[(0,s.jsx)(H.Plus,{className:"mr-2 h-4 w-4"}),"Add Phone"]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h4",{className:"text-sm font-semibold",children:"Address"}),(0,s.jsx)(Q.StandardFormField,{label:"Street Address",htmlFor:"address",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(V.MapPin,{className:"text-muted-foreground absolute top-3 left-3 h-4 w-4"}),(0,s.jsx)(Z.Textarea,{className:"min-h-[60px] pl-9",defaultValue:p?.address||"",id:"address",placeholder:"123 Main Street"})]})}),(0,s.jsxs)(Q.StandardFormRow,{cols:3,children:[(0,s.jsx)(Q.StandardFormField,{label:"City",htmlFor:"city",children:(0,s.jsx)(W.Input,{defaultValue:p?.city||"",id:"city",placeholder:"City"})}),(0,s.jsx)(Q.StandardFormField,{label:"State",htmlFor:"state",children:(0,s.jsx)(W.Input,{defaultValue:p?.state||"",id:"state",placeholder:"State"})}),(0,s.jsx)(Q.StandardFormField,{label:"ZIP Code",htmlFor:"zipCode",children:(0,s.jsx)(W.Input,{defaultValue:p?.zip_code||"",id:"zipCode",placeholder:"12345"})})]})]}),p&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h4",{className:"text-sm font-semibold",children:"Enrichment Data"}),(0,s.jsx)(Q.StandardFormField,{label:"Website",htmlFor:"website",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(R.Globe,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,s.jsx)(W.Input,{className:"pl-9",defaultValue:"",id:"website",placeholder:"https://example.com",type:"url"})]})}),(0,s.jsxs)(Q.StandardFormRow,{cols:3,children:[(0,s.jsx)(Q.StandardFormField,{label:"LinkedIn",htmlFor:"linkedin",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(z.default,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,s.jsx)(W.Input,{className:"pl-9",defaultValue:"",id:"linkedin",placeholder:"Profile URL"})]})}),(0,s.jsx)(Q.StandardFormField,{label:"Twitter",htmlFor:"twitter",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(J.default,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,s.jsx)(W.Input,{className:"pl-9",defaultValue:"",id:"twitter",placeholder:"@username"})]})}),(0,s.jsx)(Q.StandardFormField,{label:"Facebook",htmlFor:"facebook",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(E.default,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,s.jsx)(W.Input,{className:"pl-9",defaultValue:"",id:"facebook",placeholder:"Profile URL"})]})})]})]})]})},{id:"jobs",title:"Jobs",icon:(0,s.jsx)(L.Briefcase,{className:"h-4 w-4"}),count:f.length,actions:(0,s.jsxs)(_.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,s.jsx)(H.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Link Job"]}),content:f.length>0?(0,s.jsx)("div",{className:"space-y-2 p-6",children:f.map(e=>(0,s.jsxs)("div",{className:"bg-muted/30 rounded-lg border p-3 text-sm",children:[(0,s.jsxs)("div",{className:"mb-1 flex items-start justify-between",children:[(0,s.jsx)("span",{className:"font-medium",children:e.title||"Untitled Job"}),(0,s.jsx)(T.Badge,{className:"text-xs",variant:"outline",children:e.status})]}),(0,s.jsxs)("p",{className:"text-muted-foreground font-mono text-xs",children:["#",e.job_number]}),e.financial?.total_amount&&(0,s.jsx)("p",{className:"mt-1 text-xs",children:y(e.financial.total_amount)})]},e.id))}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 py-12 text-center",children:[(0,s.jsx)(L.Briefcase,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm",children:"No jobs found"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"This customer has no jobs yet"})]})},{id:"invoices",title:"Invoices",icon:(0,s.jsx)(I.FileText,{className:"h-4 w-4"}),count:g.length,actions:(0,s.jsxs)(_.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,s.jsx)(H.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Link Invoice"]}),content:g.length>0?(0,s.jsx)("div",{className:"space-y-2 p-6",children:g.map(e=>(0,s.jsxs)("div",{className:"bg-muted/30 rounded-lg border p-3 text-sm",children:[(0,s.jsxs)("div",{className:"mb-1 flex items-start justify-between",children:[(0,s.jsxs)("span",{className:"font-medium",children:["Invoice #",e.invoice_number]}),(0,s.jsx)(T.Badge,{className:"text-xs",variant:"paid"===e.status?"default":"unpaid"===e.status?"destructive":"outline",children:e.status})]}),(0,s.jsx)("p",{className:"font-semibold",children:y(e.total_amount||0)}),(0,s.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Due: ",C(e.due_date)]})]},e.id))}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 py-12 text-center",children:[(0,s.jsx)(I.FileText,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm",children:"No invoices found"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"This customer has no invoices yet"})]})},{id:"appointments",title:"Appointments",icon:(0,s.jsx)(B.Calendar,{className:"h-4 w-4"}),count:v.length,actions:(0,s.jsxs)(_.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,s.jsx)(H.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Schedule"]}),content:v.length>0?(0,s.jsx)("div",{className:"space-y-2 p-6",children:v.map(e=>{let t=e.scheduled_start??e.scheduled_for??e.start_time??e.scheduled_at??null;return(0,s.jsxs)("div",{className:"bg-muted/30 rounded-lg border p-3 text-sm",children:[(0,s.jsxs)("div",{className:"mb-1 flex items-start justify-between",children:[(0,s.jsx)("span",{className:"font-medium",children:e.title||"Appointment"}),(0,s.jsx)(T.Badge,{className:"text-xs",variant:"outline",children:e.status})]}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:t?C(t):"Date to be scheduled"})]},e.id)})}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 py-12 text-center",children:[(0,s.jsx)(B.Calendar,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm",children:"No appointments"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"No scheduled appointments for this customer"})]})},{id:"properties",title:"Properties",icon:(0,s.jsx)(M.Home,{className:"h-4 w-4"}),count:b.length,actions:(0,s.jsxs)(_.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,s.jsx)(H.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Link Property"]}),content:b.length>0?(0,s.jsx)("div",{className:"space-y-2 p-6",children:b.map(e=>(0,s.jsx)("div",{className:"bg-muted/30 rounded-lg border p-3 text-sm",children:(0,s.jsxs)("div",{className:"mb-1 flex items-start gap-2",children:[(0,s.jsx)(V.MapPin,{className:"text-muted-foreground mt-0.5 h-4 w-4 shrink-0"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"font-medium",children:e.name||"Property"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:e.address})]})]})},e.id))}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 py-12 text-center",children:[(0,s.jsx)(M.Home,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm",children:"No properties"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"No properties associated with this customer"})]})},{id:"equipment",title:"Equipment",icon:(0,s.jsx)(Y.Wrench,{className:"h-4 w-4"}),count:w.length,actions:(0,s.jsxs)(_.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,s.jsx)(H.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Add Equipment"]}),content:w.length>0?(0,s.jsx)("div",{className:"space-y-2 p-6",children:w.map(e=>(0,s.jsxs)("div",{className:"bg-muted/30 rounded-lg border p-3 text-sm",children:[(0,s.jsx)("p",{className:"font-medium",children:e.name||"Equipment"}),e.model&&(0,s.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Model: ",e.model]}),e.serial_number&&(0,s.jsxs)("p",{className:"text-muted-foreground font-mono text-xs",children:["S/N: ",e.serial_number]})]},e.id))}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 py-12 text-center",children:[(0,s.jsx)(Y.Wrench,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm",children:"No equipment"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"No equipment associated with this customer"})]})},{id:"notes",title:"Notes",icon:(0,s.jsx)(I.FileText,{className:"h-4 w-4"}),count:+!!p?.notes,actions:(0,s.jsxs)(_.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,s.jsx)(H.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Add Note"]}),content:(0,s.jsx)("div",{className:"space-y-4 p-6",children:p?.notes?(0,s.jsx)("div",{className:"space-y-3",children:(0,s.jsxs)("div",{className:"bg-muted/30 rounded-lg border p-4",children:[(0,s.jsx)("div",{className:"mb-2 flex items-start justify-between",children:(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("p",{className:"text-sm",children:p.notes})})}),(0,s.jsxs)("div",{className:"text-muted-foreground flex items-center gap-2 text-xs",children:[(0,s.jsx)(K.User,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:"System"}),(0,s.jsx)("span",{children:"â€¢"}),(0,s.jsx)("span",{children:C(p.created_at||new Date().toISOString())})]})]})}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,s.jsx)(I.FileText,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm",children:"No notes yet"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"Add notes about this customer"}),(0,s.jsxs)(_.Button,{className:"mt-4",onClick:()=>{},size:"sm",variant:"outline",children:[(0,s.jsx)(H.Plus,{className:"mr-2 h-4 w-4"}),"Add Note"]})]})})}];return(0,s.jsxs)("div",{className:"flex h-full flex-col",children:[p&&j&&(0,s.jsx)(eh,{stats:j,openBalance:u,lastVisitDate:h}),(0,s.jsx)(G.ScrollArea,{className:"flex-1",children:(0,s.jsxs)("div",{className:"flex flex-col gap-4 p-4",children:[e&&j&&(0,s.jsx)(ed,{customerData:e,stats:j,onTakePayment:o}),(0,s.jsx)(eb,{lastCall:m??null}),(0,s.jsx)("section",{className:"border-border/60 bg-card overflow-hidden rounded-xl border p-4 shadow-sm",children:(0,s.jsx)(ew,{onCreateJob:l||(()=>{}),onScheduleAppointment:r||(()=>{}),onSendSMS:i||(()=>{}),onSendEmail:c||(()=>{}),onTakePayment:o,onAddNote:d||(()=>{}),customerEmail:p?.email,customerPhone:p?.phone,hasOutstandingBalance:u>0,outstandingAmount:u,layout:"grid"})}),x.length>0&&(0,s.jsx)("section",{className:"border-primary/20 bg-primary/5 overflow-hidden rounded-xl border shadow-sm",children:(0,s.jsxs)("div",{className:"flex items-start gap-3 p-4",children:[(0,s.jsx)("div",{className:"bg-primary/10 rounded-full p-2",children:(0,s.jsx)(U.Lightbulb,{className:"text-primary h-4 w-4"})}),(0,s.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,s.jsx)("h3",{className:"text-foreground text-sm font-semibold",children:"Call Reminders"}),(0,s.jsx)("ul",{className:"text-muted-foreground space-y-1.5 text-xs",children:x.map(e=>(0,s.jsxs)("li",{className:"flex items-start gap-2",children:[(0,s.jsx)("span",{className:"text-primary mt-0.5",children:"â€¢"}),(0,s.jsx)("span",{children:e.text})]},e.id))})]})]})}),p&&(0,s.jsx)("section",{className:"border-border/60 bg-card overflow-hidden rounded-xl border p-4 shadow-sm",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h4",{className:"text-muted-foreground text-xs font-semibold tracking-wide uppercase",children:"Customer Tags"}),(0,s.jsxs)(_.Button,{className:"h-6 px-2 text-xs",onClick:()=>{},size:"sm",variant:"ghost",children:[(0,s.jsx)(H.Plus,{className:"mr-1 h-3 w-3"}),"Add"]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-1.5",children:[(0,s.jsx)(T.Badge,{className:"text-xs",variant:"secondary",children:"VIP"}),(0,s.jsx)(T.Badge,{className:"text-xs",variant:"secondary",children:"Recurring"}),(0,s.jsxs)(T.Badge,{className:"hover:bg-muted cursor-pointer text-xs",variant:"outline",children:[(0,s.jsx)(H.Plus,{className:"mr-1 h-3 w-3"}),"Add Tag"]})]})]})}),(0,s.jsx)("section",{className:"border-border/60 bg-card overflow-hidden rounded-xl border shadow-sm",children:(0,s.jsx)("div",{className:"flex flex-col gap-4 p-0",children:(0,s.jsx)(ee.UnifiedAccordion,{defaultOpenSection:null,enableReordering:!1,sections:ea,storageKey:"call-window-customer-sidebar"})})})]})})]})}var eC=e.i(51866),eS=e.i(87912),ek=e.i(641304),eT=e.i(202724),e_=(0,i.createServerReference)("60d61fe4e8976bdfeff5cf3386134c7b4b7b4f4bd0",i.callServer,void 0,i.findSourceMapURL,"getTechnicianSchedules");function eD({appointments:e,workingHours:t,technicianColor:a,currentTime:l=new Date}){let r,{start:n,end:i}=t,c=i-n,o=e=>new Date(e).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),d=Array.from({length:c+1},(e,s)=>n+s),m=(r=l.getHours()+l.getMinutes()/60)<n?0:r>i?100:(r-n)/c*100;return(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"bg-muted/20 relative h-24 rounded-lg border p-2",children:[(0,s.jsx)("div",{className:"absolute inset-x-2 top-1 flex justify-between",children:d.map(e=>(0,s.jsx)("div",{className:"flex flex-col items-center",children:(0,s.jsxs)("span",{className:"text-muted-foreground text-[9px]",children:[e>12?e-12:0===e?12:e,e>=12?"p":"a"]})},e))}),(0,s.jsxs)("div",{className:"bg-card relative mt-6 h-12 rounded border",children:[e.map(e=>{let t,l,r,i,d,m=(t=new Date(e.scheduled_start),l=new Date(e.scheduled_end),r=t.getHours()+t.getMinutes()/60,i=l.getHours()+l.getMinutes()/60,d=(r-n)/c*100,{left:`${Math.max(0,d)}%`,width:`${Math.min(100-Math.max(0,d),(i-r)/c*100)}%`}),x=(e=>{switch(e){case"in_progress":return"bg-warning/80 border-warning";case"completed":return"bg-success/80 border-success";case"cancelled":return"bg-destructive/80 border-destructive";default:return`${a}/80 border-${a.replace("bg-","")}`}})(e.status);return(0,s.jsx)("div",{className:(0,A.cn)("absolute top-1 h-10 rounded border-2 p-1 transition-all hover:z-10 hover:scale-105",x,"in_progress"===e.status&&"animate-pulse"),style:m,title:`${e.customer_name} â€¢ ${o(e.scheduled_start)} - ${o(e.scheduled_end)}`,children:(0,s.jsxs)("div",{className:"flex h-full flex-col justify-center overflow-hidden px-1",children:[(0,s.jsx)("p",{className:"truncate text-[10px] leading-tight font-medium text-white",children:e.customer_name}),e.assigned_technicians.length>1&&(0,s.jsxs)("div",{className:"flex items-center gap-0.5 text-white/80",children:[(0,s.jsx)(eT.Users,{className:"h-2.5 w-2.5"}),(0,s.jsx)("span",{className:"text-[8px]",children:e.assigned_technicians.length})]})]})},e.id)}),m>0&&m<100&&(0,s.jsx)("div",{className:"absolute top-0 h-full w-0.5 bg-blue-500 shadow-lg",style:{left:`${m}%`},children:(0,s.jsx)("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2",children:(0,s.jsxs)("div",{className:"flex items-center gap-1 rounded bg-blue-500 px-1.5 py-0.5 text-white shadow-lg",children:[(0,s.jsx)(eu.Clock,{className:"h-2.5 w-2.5"}),(0,s.jsx)("span",{className:"text-[9px] font-medium",children:l.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})})]})})})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-[10px]",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:(0,A.cn)("h-2 w-2 rounded",a)}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"Scheduled"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"bg-warning h-2 w-2 rounded"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"In Progress"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"bg-success h-2 w-2 rounded"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"Completed"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"h-2 w-2 rounded border-2 border-blue-500 bg-blue-500"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"Current Time"})]})]})]})}function eA({className:e,companyId:a}){let l,i=(0,r.useRouter)(),[c,o]=(0,n.useState)(new Date),[d,m]=(0,n.useState)(null),[x,u]=(0,n.useState)([]),[h,p]=(0,n.useState)(!0),[j,f]=(0,n.useState)(null),[g,N]=(0,n.useState)(new Date);if((0,n.useEffect)(()=>{let e=setInterval(()=>{N(new Date)},6e4);return()=>clearInterval(e)},[]),(0,n.useEffect)(()=>{!async function(){if(!a){f("No company ID provided"),p(!1);return}p(!0),f(null);try{let e=await e_(c,a);u(e)}catch(e){f("Failed to load schedules")}finally{p(!1)}}()},[c,a]),h)return(0,s.jsx)("div",{className:(0,A.cn)("flex h-full items-center justify-center",e),children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(ek.Loader2,{className:"text-primary mx-auto mb-4 h-8 w-8 animate-spin"}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm",children:"Loading schedules..."})]})});if(j)return(0,s.jsx)("div",{className:(0,A.cn)("flex h-full items-center justify-center",e),children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(t.AlertCircle,{className:"text-destructive mx-auto mb-4 h-8 w-8"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:j}),(0,s.jsx)(_.Button,{className:"mt-4",onClick:()=>i.refresh(),size:"sm",variant:"outline",children:"Retry"})]})});let v=e=>new Date(e).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),b=e=>{let s=new Date(c);s.setDate(s.getDate()+e),o(s)},w=d?x.filter(e=>e.id===d):x,y=x.reduce((e,s)=>e+s.appointments.length,0),C=w.map(e=>({id:e.id,title:e.name,icon:(0,s.jsxs)(k.Avatar,{className:"h-5 w-5",children:[(0,s.jsx)(k.AvatarImage,{src:e.avatar_url}),(0,s.jsx)(k.AvatarFallback,{className:(0,A.cn)("text-[10px] text-white",e.color),children:e.name.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2)})]}),count:e.appointments.length,actions:(0,s.jsx)(T.Badge,{className:"text-[10px]",variant:"secondary",children:e.role.replace("_"," ")}),content:(0,s.jsxs)("div",{className:"space-y-4 p-4",children:[(0,s.jsx)(eD,{appointments:e.appointments,currentTime:g,technicianColor:e.color,workingHours:e.working_hours}),e.appointments.length>0?(0,s.jsx)("div",{className:"space-y-3",children:e.appointments.map(e=>(0,s.jsxs)("div",{className:"bg-card hover:bg-muted/50 rounded-lg border p-4 transition-colors",children:[(0,s.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eu.Clock,{className:"text-muted-foreground h-4 w-4"}),(0,s.jsxs)("span",{className:"text-sm font-semibold",children:[v(e.scheduled_start)," -"," ",v(e.scheduled_end)]}),(0,s.jsxs)(T.Badge,{className:"text-[10px]",variant:"secondary",children:[e.duration_hours,"h window"]})]}),(e=>{switch(e){case"completed":return(0,s.jsx)(T.Badge,{className:"border-success/50 bg-success/10 text-success text-[10px]",variant:"outline",children:"Completed"});case"in_progress":return(0,s.jsx)(T.Badge,{className:"border-warning/50 bg-warning/10 text-warning text-[10px]",variant:"outline",children:"In Progress"});case"cancelled":return(0,s.jsx)(T.Badge,{className:"border-destructive/50 bg-destructive/10 text-destructive text-[10px]",variant:"outline",children:"Cancelled"});default:return(0,s.jsx)(T.Badge,{className:"text-[10px]",variant:"outline",children:"Scheduled"})}})(e.status)]}),(0,s.jsxs)("div",{className:"mb-3 space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(K.User,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:e.customer_name})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(V.MapPin,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,s.jsxs)("span",{className:"text-muted-foreground text-xs",children:[e.address,", ",e.city,","," ",e.state]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(T.Badge,{className:"text-xs",variant:"outline",children:e.job_type}),(0,s.jsxs)("span",{className:"text-muted-foreground font-mono text-xs",children:["#",e.job_number]})]})]}),e.assigned_technicians.length>1&&(0,s.jsx)("div",{className:"border-t pt-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eT.Users,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"Team:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:e.assigned_technicians.map(e=>(0,s.jsxs)(T.Badge,{className:"text-[10px]",variant:e.is_lead?"default":"secondary",children:[e.name,e.is_lead&&" (Lead)"]},e.id))})]})})]},e.id))}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,s.jsx)(B.Calendar,{className:"text-muted-foreground mb-3 h-10 w-10"}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm",children:"No appointments today"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"This technician is available"})]})]})}));return(0,s.jsxs)("div",{className:(0,A.cn)("flex h-full flex-col",e),children:[(0,s.jsxs)("div",{className:"bg-card/50 space-y-3 border-b p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(_.Button,{className:"h-8 w-8",onClick:()=>b(-1),size:"icon",variant:"ghost",children:(0,s.jsx)(eC.ChevronLeft,{className:"h-4 w-4"})}),(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(B.Calendar,{className:"text-muted-foreground h-4 w-4"}),(0,s.jsx)("span",{className:"text-sm font-semibold",children:c.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]}),(l=new Date,c.getDate()===l.getDate()&&c.getMonth()===l.getMonth()&&c.getFullYear()===l.getFullYear()&&(0,s.jsx)(T.Badge,{className:"mt-1 text-[10px]",variant:"secondary",children:"Today"}))]}),(0,s.jsx)(_.Button,{className:"h-8 w-8",onClick:()=>b(1),size:"icon",variant:"ghost",children:(0,s.jsx)(eS.ChevronRight,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("div",{className:"bg-muted/30 flex items-center gap-2 rounded-lg border px-3 py-1.5",children:[(0,s.jsx)(eT.Users,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,s.jsxs)("span",{className:"text-muted-foreground text-xs",children:[w.length," Techs"]}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"â€¢"}),(0,s.jsxs)("span",{className:"text-xs font-medium",children:[y," Appointments"]})]}),(0,s.jsx)(_.Button,{className:"h-7 gap-1.5 px-2 text-xs",onClick:()=>m(null),size:"sm",variant:"outline",children:d?"Show All":"All Techs"})]})]}),(0,s.jsx)(G.ScrollArea,{className:"flex-1",children:(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)("section",{className:"border-border/60 bg-card overflow-hidden rounded-xl border shadow-sm",children:(0,s.jsx)("div",{className:"flex flex-col gap-4 p-0",children:(0,s.jsx)(ee.UnifiedAccordion,{defaultOpenSection:C[0]?.id,enableReordering:!1,sections:C,storageKey:"csr-schedule-technicians"})})})})}),(0,s.jsx)("div",{className:"bg-card/50 border-t p-3",children:(0,s.jsxs)(_.Button,{className:"w-full gap-2 text-xs",onClick:()=>{},size:"sm",variant:"default",children:[(0,s.jsx)(H.Plus,{className:"h-3.5 w-3.5"}),"Book New Appointment"]})})]})}var eP=e.i(852648);e.i(769588);var eL=e.i(1414);e.i(539870);var eF=e.i(846358);e.i(868198);var eB=e.i(798764);let eE=[{value:"resolved",label:"Issue Resolved",icon:(0,s.jsx)(eP.CheckCircle2,{className:"h-4 w-4"}),color:"text-success"},{value:"appointment_booked",label:"Appointment Booked",icon:(0,s.jsx)(B.Calendar,{className:"h-4 w-4"}),color:"text-primary"},{value:"quote_provided",label:"Quote Provided",icon:(0,s.jsx)(I.FileText,{className:"h-4 w-4"}),color:"text-primary"},{value:"payment_taken",label:"Payment Taken",icon:(0,s.jsx)(eP.CheckCircle2,{className:"h-4 w-4"}),color:"text-success"},{value:"callback_scheduled",label:"Callback Scheduled",icon:(0,s.jsx)($.Phone,{className:"h-4 w-4"}),color:"text-warning"},{value:"escalated",label:"Escalated to Manager",icon:(0,s.jsx)(eg.AlertTriangle,{className:"h-4 w-4"}),color:"text-orange-500"},{value:"transferred",label:"Transferred",icon:(0,s.jsx)($.Phone,{className:"h-4 w-4"}),color:"text-muted-foreground"},{value:"voicemail_left",label:"Left Voicemail",icon:(0,s.jsx)(l.MessageSquare,{className:"h-4 w-4"}),color:"text-muted-foreground"},{value:"customer_hung_up",label:"Customer Hung Up",icon:(0,s.jsx)(j.PhoneOff,{className:"h-4 w-4"}),color:"text-muted-foreground"},{value:"wrong_number",label:"Wrong Number",icon:(0,s.jsx)(S.X,{className:"h-4 w-4"}),color:"text-muted-foreground"},{value:"spam",label:"Spam/Unwanted",icon:(0,s.jsx)(eg.AlertTriangle,{className:"h-4 w-4"}),color:"text-destructive"},{value:"other",label:"Other",icon:(0,s.jsx)(I.FileText,{className:"h-4 w-4"}),color:"text-muted-foreground"}],eI=[{value:"callback",label:"Callback",icon:(0,s.jsx)($.Phone,{className:"h-4 w-4"})},{value:"email",label:"Email",icon:(0,s.jsx)(O.Mail,{className:"h-4 w-4"})},{value:"sms",label:"SMS",icon:(0,s.jsx)(l.MessageSquare,{className:"h-4 w-4"})},{value:"appointment",label:"Appointment",icon:(0,s.jsx)(B.Calendar,{className:"h-4 w-4"})}];function eR({open:e,onOpenChange:t,onComplete:a,onCancel:l,callDuration:r,customerName:i,customerEmail:c,existingNotes:o="",isSubmitting:d=!1}){let m,[x,u]=(0,n.useState)(""),[h,p]=(0,n.useState)(o),[f,g]=(0,n.useState)(!1),[N,v]=(0,n.useState)("callback"),[b,w]=(0,n.useState)(!1),[y,C]=(0,n.useState)(!1),S=r>120,k=""!==x&&(!S||h.trim().length>0),D=(0,n.useCallback)(()=>{k&&x&&a({disposition:x,notes:h.trim(),followUp:{enabled:f,type:N},sendConfirmation:b,createJob:y})},[k,x,h,f,N,b,y,a]);return(0,n.useEffect)(()=>{e&&(u(""),p(o),g(!1),v("callback"),w(!1),C(!1))},[e,o]),(0,n.useEffect)(()=>{let s=s=>{e&&"Enter"===s.key&&(s.ctrlKey||s.metaKey)&&k&&(s.preventDefault(),D())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[e,k,D]),(0,s.jsx)(eF.Dialog,{onOpenChange:t,open:e,children:(0,s.jsxs)(eF.DialogContent,{className:"max-w-lg",children:[(0,s.jsxs)(eF.DialogHeader,{children:[(0,s.jsxs)(eF.DialogTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(j.PhoneOff,{className:"text-destructive h-5 w-5"}),"Wrap Up Call"]}),(0,s.jsxs)(eF.DialogDescription,{className:"flex items-center gap-4",children:[(0,s.jsx)("span",{children:"Complete this form before ending the call with"}),(0,s.jsx)(T.Badge,{variant:"outline",children:i})]})]}),(0,s.jsxs)("div",{className:"bg-muted/50 flex items-center justify-between rounded-lg border p-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eu.Clock,{className:"text-muted-foreground h-4 w-4"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Call Duration"})]}),(0,s.jsx)(T.Badge,{variant:"secondary",className:"font-mono",children:(m=Math.floor(r/60),`${m}:${(r%60).toString().padStart(2,"0")}`)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(X.Label,{className:"flex items-center gap-1",children:["Call Disposition",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsxs)(eB.Select,{value:x,onValueChange:e=>u(e),children:[(0,s.jsx)(eB.SelectTrigger,{className:(0,A.cn)(!x&&"border-destructive/50"),children:(0,s.jsx)(eB.SelectValue,{placeholder:"Select outcome..."})}),(0,s.jsx)(eB.SelectContent,{children:eE.map(e=>(0,s.jsx)(eB.SelectItem,{value:e.value,children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:e.color,children:e.icon}),(0,s.jsx)("span",{children:e.label})]})},e.value))})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(X.Label,{className:"flex items-center gap-1",children:["Call Notes",S&&(0,s.jsx)("span",{className:"text-destructive",children:"*"}),!S&&(0,s.jsx)("span",{className:"text-muted-foreground text-xs ml-1",children:"(optional for short calls)"})]}),(0,s.jsx)(Z.Textarea,{className:(0,A.cn)("min-h-[100px] resize-none",S&&!h.trim()&&"border-destructive/50"),placeholder:"Summarize the call, customer's issue, and resolution...",value:h,onChange:e=>p(e.target.value)}),S&&!h.trim()&&(0,s.jsxs)("p",{className:"text-destructive text-xs flex items-center gap-1",children:[(0,s.jsx)(eg.AlertTriangle,{className:"h-3 w-3"}),"Notes required for calls over 2 minutes"]})]}),(0,s.jsxs)("div",{className:"space-y-3 rounded-lg border p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eL.Checkbox,{id:"followUp",checked:f,onCheckedChange:e=>g(e)}),(0,s.jsx)(X.Label,{htmlFor:"followUp",className:"text-sm font-medium cursor-pointer",children:"Schedule Follow-up"})]}),f&&(0,s.jsxs)(eB.Select,{value:N,onValueChange:e=>v(e),children:[(0,s.jsx)(eB.SelectTrigger,{className:"w-[140px] h-8",children:(0,s.jsx)(eB.SelectValue,{})}),(0,s.jsx)(eB.SelectContent,{children:eI.map(e=>(0,s.jsx)(eB.SelectItem,{value:e.value,children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.icon,(0,s.jsx)("span",{children:e.label})]})},e.value))})]})]}),c&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eL.Checkbox,{id:"sendConfirmation",checked:b,onCheckedChange:e=>w(e)}),(0,s.jsxs)(X.Label,{htmlFor:"sendConfirmation",className:"text-sm cursor-pointer flex items-center gap-1",children:[(0,s.jsx)(O.Mail,{className:"h-3.5 w-3.5"}),"Send confirmation email"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eL.Checkbox,{id:"createJob",checked:y,onCheckedChange:e=>C(e)}),(0,s.jsxs)(X.Label,{htmlFor:"createJob",className:"text-sm cursor-pointer flex items-center gap-1",children:[(0,s.jsx)(H.Plus,{className:"h-3.5 w-3.5"}),"Create job from this call"]})]})]}),(0,s.jsxs)(eF.DialogFooter,{className:"gap-2 sm:gap-0",children:[(0,s.jsx)(_.Button,{variant:"outline",onClick:l,disabled:d,children:"Continue Call"}),(0,s.jsx)(_.Button,{variant:"destructive",onClick:D,disabled:!k||d,className:"gap-2",children:d?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ek.Loader2,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.PhoneOff,{className:"h-4 w-4"}),"End Call"]})})]}),(0,s.jsxs)("p",{className:"text-muted-foreground text-center text-xs",children:["Press"," ",(0,s.jsx)("kbd",{className:"bg-muted rounded px-1.5 py-0.5 font-mono",children:"Ctrl+Enter"})," ","to complete"]})]})})}var N=N;let eM=[{title:"Call Controls",shortcuts:[{keys:["M"],description:"Toggle mute/unmute",icon:(0,s.jsx)(u.Mic,{className:"h-3.5 w-3.5"})},{keys:["H"],description:"Toggle hold/resume",icon:(0,s.jsx)(p.Pause,{className:"h-3.5 w-3.5"})},{keys:["R"],description:"Toggle recording",icon:(0,s.jsx)(N.default,{className:"h-3.5 w-3.5"})},{keys:["T"],description:"Transfer call",icon:(0,s.jsx)($.Phone,{className:"h-3.5 w-3.5"})},{keys:["Shift","E"],description:"End call",icon:(0,s.jsx)(j.PhoneOff,{className:"h-3.5 w-3.5"}),destructive:!0}]},{title:"Quick Actions",shortcuts:[{keys:["J"],description:"Create new job",icon:(0,s.jsx)(H.Plus,{className:"h-3.5 w-3.5"})},{keys:["A"],description:"Schedule appointment",icon:(0,s.jsx)(B.Calendar,{className:"h-3.5 w-3.5"})},{keys:["N"],description:"Focus notes field",icon:(0,s.jsx)(I.FileText,{className:"h-3.5 w-3.5"})},{keys:["S"],description:"Send SMS to customer"},{keys:["E"],description:"Send email to customer"}]},{title:"Navigation",shortcuts:[{keys:["1"],description:"View transcript panel"},{keys:["2"],description:"View schedule panel"},{keys:["Tab"],description:"Cycle through sections"},{keys:["Esc"],description:"Close dialogs/minimize"}]},{title:"General",shortcuts:[{keys:["?"],description:"Show this help panel",icon:(0,s.jsx)(x.Keyboard,{className:"h-3.5 w-3.5"})},{keys:["Ctrl","S"],description:"Save notes"},{keys:["Ctrl","C"],description:"Copy selected text"}]}];function eU({open:e,onOpenChange:t}){return(0,n.useEffect)(()=>{let s=s=>{"Escape"===s.key&&e&&t(!1)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[e,t]),(0,s.jsx)(eF.Dialog,{onOpenChange:t,open:e,children:(0,s.jsxs)(eF.DialogContent,{className:"max-h-[85vh] max-w-2xl overflow-y-auto",children:[(0,s.jsxs)(eF.DialogHeader,{children:[(0,s.jsxs)(eF.DialogTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(x.Keyboard,{className:"h-5 w-5"}),"Keyboard Shortcuts"]}),(0,s.jsxs)(eF.DialogDescription,{children:["Use these shortcuts for faster call handling. Press"," ",(0,s.jsx)("kbd",{className:"bg-muted rounded px-1.5 py-0.5 font-mono text-xs",children:"?"})," ","anytime to show this panel."]})]}),(0,s.jsx)("div",{className:"mt-4 grid grid-cols-2 gap-6",children:eM.map(e=>(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold",children:e.title}),(0,s.jsx)("div",{className:"space-y-2",children:e.shortcuts.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between rounded-lg border p-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.icon&&(0,s.jsx)("span",{className:(0,A.cn)("text-muted-foreground",e.destructive&&"text-destructive"),children:e.icon}),(0,s.jsx)("span",{className:(0,A.cn)("text-sm",e.destructive&&"text-destructive"),children:e.description})]}),(0,s.jsx)("div",{className:"flex items-center gap-1",children:e.keys.map((t,a)=>(0,s.jsxs)("span",{children:[(0,s.jsx)("kbd",{className:(0,A.cn)("bg-muted inline-flex min-w-[24px] items-center justify-center rounded px-1.5 py-0.5 font-mono text-xs",e.destructive&&"bg-destructive/10 text-destructive"),children:t}),a<e.keys.length-1&&(0,s.jsx)("span",{className:"text-muted-foreground mx-0.5 text-xs",children:"+"})]},a))})]},t))})]},e.title))}),(0,s.jsx)("div",{className:"bg-muted/50 mt-6 rounded-lg border p-4",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"bg-primary/10 rounded-full p-2",children:(0,s.jsx)(x.Keyboard,{className:"text-primary h-4 w-4"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-medium",children:"Pro Tips"}),(0,s.jsxs)("ul",{className:"text-muted-foreground mt-1 space-y-1 text-xs",children:[(0,s.jsx)("li",{children:"â€¢ Shortcuts only work when the call window is focused"}),(0,s.jsxs)("li",{children:["â€¢ Use"," ",(0,s.jsx)("kbd",{className:"bg-muted rounded px-1 font-mono",children:"Shift+E"})," ","for end call to prevent accidental hangups"]}),(0,s.jsxs)("li",{children:["â€¢ Press"," ",(0,s.jsx)("kbd",{className:"bg-muted rounded px-1 font-mono",children:"N"})," to quickly add notes during a call"]}),(0,s.jsx)("li",{children:"â€¢ The mute indicator turns red when you're muted"})]})]})]})})]})})}var ez=e.i(486506),eO=e.i(560895),eO=eO;e.i(160424);var eV=e.i(595521),e$=e.i(123331);e.i(181893).Zap,B.Calendar,el.CreditCard,eO.default,e$.UserCog,l.MessageSquare,$.Phone,L.Briefcase,eV.ThumbsDown,eP.CheckCircle2;var eH=e.i(621334),eH=eH,eq=e.i(850132),eq=eq,eJ=e.i(524672),eK=e.i(697029);eJ.Smile,eq.default,eH.default,eK.TrendingUp,ez.ArrowRight,ec.TrendingDown,e.i(79254),e.i(882525);var eY=e.i(982686),eW=e.i(540374);$.Phone,O.Mail,V.MapPin,K.User,B.Calendar,eu.Clock,eY.DollarSign,Y.Wrench,eW.Tag,eW.Tag,e.i(726526),e.i(673542),e.i(244242),e.i(563078),e.i(789067);var eX=e.i(861308);function eG({className:e}){return(0,s.jsx)("div",{className:(0,A.cn)("bg-card/80 sticky top-0 z-10 border-b backdrop-blur-sm",e),children:(0,s.jsx)("div",{className:"grid grid-cols-5 divide-x",children:Array.from({length:5}).map((e,t)=>(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center gap-1.5 p-3",children:[(0,s.jsx)(eX.Skeleton,{className:"h-4 w-12"}),(0,s.jsx)(eX.Skeleton,{className:"h-3 w-8"})]},t))})})}function eQ({className:e}){return(0,s.jsx)("div",{className:(0,A.cn)("space-y-2",e),children:(0,s.jsxs)("div",{className:"flex items-start gap-3 rounded-lg border bg-muted/20 p-3",children:[(0,s.jsx)(eX.Skeleton,{className:"h-8 w-8 rounded-full"}),(0,s.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,s.jsx)(eX.Skeleton,{className:"h-4 w-32"}),(0,s.jsx)(eX.Skeleton,{className:"h-3 w-48"})]})]})})}function eZ({className:e}){return(0,s.jsxs)("div",{className:(0,A.cn)("space-y-3",e),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(eX.Skeleton,{className:"h-4 w-24"}),(0,s.jsx)(eX.Skeleton,{className:"h-6 w-16"})]}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:Array.from({length:6}).map((e,t)=>(0,s.jsx)(eX.Skeleton,{className:"h-16 rounded-lg"},t))})]})}function e0({className:e}){return(0,s.jsx)("div",{className:(0,A.cn)("rounded-xl border bg-muted/30 p-4",e),children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(eX.Skeleton,{className:"h-10 w-10 rounded-full"}),(0,s.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,s.jsx)(eX.Skeleton,{className:"h-4 w-24"}),(0,s.jsx)(eX.Skeleton,{className:"h-3 w-32"})]}),(0,s.jsx)(eX.Skeleton,{className:"h-5 w-16 rounded-full"})]})})}function e1({className:e}){return(0,s.jsxs)("div",{className:(0,A.cn)("rounded-xl border bg-card",e),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eX.Skeleton,{className:"h-4 w-4"}),(0,s.jsx)(eX.Skeleton,{className:"h-4 w-28"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eX.Skeleton,{className:"h-8 w-8 rounded"}),(0,s.jsx)(eX.Skeleton,{className:"h-8 w-8 rounded"})]})]}),(0,s.jsx)("div",{className:"border-b p-3",children:(0,s.jsx)(eX.Skeleton,{className:"h-9 w-full rounded"})}),(0,s.jsx)("div",{className:"space-y-3 p-4",children:Array.from({length:4}).map((e,t)=>(0,s.jsxs)("div",{className:(0,A.cn)("rounded-lg border p-3",t%2==0?"ml-0 mr-8":"ml-8 mr-0"),children:[(0,s.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,s.jsx)(eX.Skeleton,{className:"h-3 w-12"}),(0,s.jsx)(eX.Skeleton,{className:"h-3 w-16"})]}),(0,s.jsx)(eX.Skeleton,{className:"h-4 w-full"}),(0,s.jsx)(eX.Skeleton,{className:"mt-1 h-4 w-3/4"})]},t))})]})}function e2({className:e}){return(0,s.jsxs)("div",{className:(0,A.cn)("flex h-full flex-col",e),children:[(0,s.jsx)(eG,{}),(0,s.jsxs)("div",{className:"flex-1 space-y-4 overflow-hidden p-4",children:[(0,s.jsx)(eQ,{}),(0,s.jsx)(e0,{}),(0,s.jsx)("div",{className:"rounded-xl border bg-card p-4",children:(0,s.jsx)(eZ,{})}),(0,s.jsx)("div",{className:"rounded-xl border bg-card p-4",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(eX.Skeleton,{className:"h-4 w-24"}),(0,s.jsxs)("div",{className:"flex gap-1.5",children:[(0,s.jsx)(eX.Skeleton,{className:"h-6 w-12 rounded-full"}),(0,s.jsx)(eX.Skeleton,{className:"h-6 w-16 rounded-full"}),(0,s.jsx)(eX.Skeleton,{className:"h-6 w-14 rounded-full"})]})]})})]})]})}function e4(){return(0,s.jsxs)("div",{className:"flex h-screen flex-col bg-background",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between border-b px-6 py-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(eX.Skeleton,{className:"h-11 w-11 rounded-full"}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(eX.Skeleton,{className:"h-4 w-32"}),(0,s.jsx)(eX.Skeleton,{className:"h-3 w-24"})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:Array.from({length:6}).map((e,t)=>(0,s.jsx)(eX.Skeleton,{className:"h-10 w-10 rounded-full"},t))}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eX.Skeleton,{className:"h-6 w-20 rounded-full"}),(0,s.jsx)(eX.Skeleton,{className:"h-8 w-8 rounded"})]})]}),(0,s.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,s.jsx)("div",{className:"flex w-[35%] flex-col border-r",children:(0,s.jsx)(e1,{className:"flex-1"})}),(0,s.jsx)("div",{className:"w-[65%]",children:(0,s.jsx)(e2,{className:"h-full"})})]})]})}var e3=e.i(873001),e5=e.i(142328);async function e6(e){try{let s=e._peer?.connection;if(!(s&&s instanceof RTCPeerConnection))return null;let t=await s.getStats(),a={packetLoss:0,jitter:0,rtt:0,audioLevel:0};return t.forEach(e=>{if("inbound-rtp"===e.type&&"audio"===e.kind){let s=e.packetsLost||0,t=e.packetsReceived||1;a.packetLoss=s/(s+t)*100,a.jitter=1e3*(e.jitter||0)}"candidate-pair"===e.type&&"succeeded"===e.state&&(a.rtt=e.currentRoundTripTime?1e3*e.currentRoundTripTime:0),"media-source"===e.type&&"audio"===e.kind&&(a.audioLevel=e.audioLevel||0)}),a}catch(e){return null}}var e8=e.i(468849);e.i(418488);var e9=e.i(539900),e7=e.i(948962);function se(e){if(!window.opener||window.opener.closed)return!1;try{return window.opener.postMessage(e,window.location.origin),!0}catch(e){return!1}}function ss(){let i,d=(0,r.useSearchParams)(),m=d?.get("callId")||new URLSearchParams(window.location.search).get("callId"),x=d?.get("customerId"),u=d?.get("direction"),{call:h,answerCall:p,endCall:j,toggleMute:f,toggleHold:g,toggleRecording:N,requestVideo:v,endVideo:b,setCustomerData:w,setCallMetadata:y,setTelnyxCallState:C}=(0,e9.useUIStore)(),{clearTranscript:S}=(0,e7.useTranscriptStore)(),{quality:k,metrics:T}=function({call:e,updateInterval:s=2e3}){let[t,a]=(0,n.useState)("unknown"),[l,r]=(0,n.useState)(null),[i,c]=(0,n.useState)(!1),o=(0,n.useCallback)(async()=>{if(!e){a("unknown"),r(null);return}let s=await e6(e);s&&(r(s),a(function(e){let{packetLoss:s,jitter:t,rtt:a}=e;return s<1&&t<30&&a<150?"excellent":s<3&&t<50&&a<300?"good":"poor"}(s)))},[e]);return(0,n.useEffect)(()=>{if(!e){c(!1),a("unknown"),r(null);return}c(!0),o();let t=setInterval(o,s);return()=>{clearInterval(t),c(!1)}},[e,s,o]),{quality:t,metrics:l,isMonitoring:i}}({call:(0,e8.useTelnyxWebRTC)({username:"bcw1995gmailcommidzvmln",password:"Jp5FMRf*nG6yhBOdvTkajkVyZcbK*SN%",autoConnect:!1}).currentCall,updateInterval:2e3}),[D,A]=(0,n.useState)(!1),[L,F]=(0,n.useState)(!1),[B,E]=(0,n.useState)(0),[I,R]=(0,n.useState)(!1),[M,U]=(0,n.useState)(d?.get("companyId")??null),[z,O]=(0,n.useState)("schedule"),[V,$]=(0,n.useState)(!1),[H,q]=(0,n.useState)(!1),[J,K]=(0,n.useState)(),[Y,W]=(0,n.useState)(),[X,G]=(0,n.useState)(""),Q=(0,n.useRef)(null),Z=(0,n.useCallback)(()=>{},[]),ee=(0,n.useCallback)(()=>{O("schedule")},[]),es=(0,n.useCallback)(()=>{},[]),et=(0,n.useCallback)(()=>{},[]),ea=(0,n.useCallback)(()=>{},[]),el=(0,n.useCallback)(()=>{},[]);(0,n.useEffect)(()=>{m&&(se({type:"CALL_POP_OUT_READY",callId:m,timestamp:Date.now()}),A(!0),u&&y({callControlId:m,callSessionId:m,direction:u}))},[m,u,y]),(0,n.useEffect)(()=>{m&&(async()=>{F(!0);try{let s,t=M??d?.get("companyId")??null;if(t&&!M&&U(t),!t)try{let{createClient:s}=await e.A(396931),a=s();if(!a)return;let{data:{user:l},error:r}=await a.auth.getUser();if(r)return void console.error("Call window: Failed to get user:",r.message);if(l){let{data:e,error:s}=await a.from("company_memberships").select("company_id, status, joined_at").eq("user_id",l.id).eq("status","active").order("joined_at",{ascending:!1});if(s)return void console.error("Call window: Failed to fetch team memberships:",s.message);if(Array.isArray(e)&&e.length>0){e.length;let s=e[0];s?.company_id&&(t=s.company_id,U(s.company_id))}}}catch(e){}if(!t)return void F(!1);if(x)s=await o(x,t);else{let e=h.caller?.number||d?.get("from");e&&(s=await c(e,t))}s?.success&&s.data&&w(s.data)}catch(e){}finally{F(!1)}})()},[m,x,h.caller?.number,d,w,M]),(0,n.useEffect)(()=>{if("active"!==h.status||!h.startTime)return;let e=setInterval(()=>{E(Math.floor((Date.now()-h.startTime)/1e3))},1e3);return()=>clearInterval(e)},[h.status,h.startTime]),(0,n.useEffect)(()=>{let e=e=>{var s;if(e.origin!==window.location.origin||!("object"==typeof(s=e.data)&&null!==s&&"string"==typeof s.type&&"string"==typeof s.callId&&["CALL_STATE_INIT","CALL_STATE_SYNC","CALL_POP_OUT_READY","CALL_POP_OUT_CLOSED","CALL_ACTION","TRANSCRIPT_ENTRY","TRANSCRIPT_UPDATE","AI_EXTRACTION_UPDATE","FORM_DATA_UPDATE","REQUEST_FORM_DATA","FORM_DATA_SYNC","CUSTOMER_DATA_UPDATE"].includes(s.type)))return;let t=e.data;switch(t.type){case"CALL_STATE_SYNC":t.callData;break;case"CALL_ACTION":"end"===t.action?(j(),S()):"mute"===t.action?f():"unmute"===t.action&&f();break;case"TRANSCRIPT_UPDATE":break;case"CUSTOMER_DATA_UPDATE":t.customerData&&w(t.customerData)}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[j,f,S,w]);let er=(0,n.useCallback)(e=>{if(m)switch(e){case"mute":case"unmute":f(),se({type:"CALL_ACTION",callId:m,action:h.isMuted?"unmute":"mute",timestamp:Date.now()});break;case"hold":case"unhold":h.isOnHold?K(void 0):K(Date.now()),g(),se({type:"CALL_ACTION",callId:m,action:h.isOnHold?"unhold":"hold",timestamp:Date.now()});break;case"record_start":case"record_stop":h.isRecording?W(void 0):W(Date.now()),N(),se({type:"CALL_ACTION",callId:m,action:h.isRecording?"record_stop":"record_start",timestamp:Date.now()});break;case"end":q(!0);break;case"force_end":j(),S(),se({type:"CALL_ACTION",callId:m,action:"end",timestamp:Date.now()}),setTimeout(()=>window.close(),500)}},[m,h.isMuted,h.isOnHold,h.isRecording,f,g,N,j,S]),en=(0,n.useCallback)(e=>{G(e.notes),er("force_end"),q(!1)},[er]),ei=(0,n.useCallback)(()=>{q(!1)},[]),ec=(0,n.useCallback)(()=>{m&&("off"===h.videoStatus?(v(),se({type:"CALL_ACTION",callId:m,action:"video_on",timestamp:Date.now()})):(b(),se({type:"CALL_ACTION",callId:m,action:"video_off",timestamp:Date.now()})))},[m,h.videoStatus,v,b]),eo=(0,n.useCallback)(()=>{R(!0)},[]),ed=(0,n.useCallback)(()=>{window.close()},[]);if(!function(e,s={}){let{enabled:t=!0,onShortcutTriggered:a}=s;(0,n.useRef)(!1);let l=(0,n.useCallback)(()=>{let e=document.activeElement;if(!e)return!1;let s=e.tagName.toLowerCase(),t="true"===e.getAttribute("contenteditable");return"input"===s||"textarea"===s||t},[]),r=(0,n.useCallback)(s=>{if(!t)return;if(l()){"Escape"===s.key&&(s.preventDefault(),e.onEscape?.(),a?.("escape"));return}let r=s.key.toLowerCase(),n=s.ctrlKey||s.metaKey,i=s.shiftKey;if(!s.altKey){if(n)return;if(i&&"e"===r){s.preventDefault(),e.onEndCall?.(),a?.("end_call");return}switch(r){case"m":s.preventDefault(),e.onToggleMute?.(),a?.("toggle_mute");break;case"h":s.preventDefault(),e.onToggleHold?.(),a?.("toggle_hold");break;case"r":s.preventDefault(),e.onToggleRecording?.(),a?.("toggle_recording");break;case"t":s.preventDefault(),e.onTransfer?.(),a?.("transfer");break;case"j":s.preventDefault(),e.onCreateJob?.(),a?.("create_job");break;case"a":s.preventDefault(),e.onScheduleAppointment?.(),a?.("schedule_appointment");break;case"n":s.preventDefault(),e.onFocusNotes?.(),a?.("focus_notes");break;case"s":s.preventDefault(),e.onSendSMS?.(),a?.("send_sms");break;case"e":i||(s.preventDefault(),e.onSendEmail?.(),a?.("send_email"));break;case"1":s.preventDefault(),e.onViewTranscript?.(),a?.("view_transcript");break;case"2":s.preventDefault(),e.onViewSchedule?.(),a?.("view_schedule");break;case"?":case"/":s.preventDefault(),e.onShowHelp?.(),a?.("show_help");break;case"escape":s.preventDefault(),e.onEscape?.(),a?.("escape")}}},[t,l,e,a]);(0,n.useEffect)(()=>(window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)),[r])}({onToggleMute:()=>er(h.isMuted?"unmute":"mute"),onToggleHold:()=>er(h.isOnHold?"unhold":"hold"),onToggleRecording:()=>er(h.isRecording?"record_stop":"record_start"),onEndCall:()=>er("end"),onCreateJob:Z,onScheduleAppointment:ee,onSendSMS:es,onSendEmail:et,onFocusNotes:el,onShowHelp:()=>$(!0),onViewTranscript:()=>O("transcript"),onViewSchedule:()=>O("schedule"),onEscape:()=>{V&&$(!1),H&&q(!1)}},{enabled:"active"===h.status}),!m)return(0,s.jsx)("div",{className:"bg-background flex h-screen items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(t.AlertCircle,{className:"text-destructive mx-auto mb-4 h-12 w-12"}),(0,s.jsx)("h1",{className:"mb-2 text-2xl font-bold",children:"Invalid Call"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"No call ID provided"})]})});let em="active"===h.status,ex=h.customerData,eu=ex?.customer?.first_name&&ex?.customer?.last_name?`${ex.customer.first_name} ${ex.customer.last_name}`.trim():ex?.customer?.first_name?ex.customer.first_name:h.caller?.name||"Unknown Caller",eh=ex?.customer?.phone||h.caller?.number||"No number";return(0,s.jsxs)("div",{className:"bg-background flex h-screen flex-col",children:[(0,s.jsx)(e3.SkipLink,{}),(0,s.jsx)(P,{callDuration:(i=Math.floor(B/60),`${i}:${(B%60).toString().padStart(2,"0")}`),callerName:eu,callerNumber:eh,callId:m,connectionQuality:k||"unknown",customerData:ex,isActive:em,isMuted:h.isMuted,isOnHold:h.isOnHold,isRecording:h.isRecording,holdStartTime:J,recordingStartTime:Y,onClose:ed,onEndCall:()=>er("end"),onHoldToggle:()=>er(h.isOnHold?"unhold":"hold"),onMuteToggle:()=>er(h.isMuted?"unmute":"mute"),onRecordToggle:()=>er(h.isRecording?"record_stop":"record_start"),onTransfer:eo,onVideoToggle:ec,onShowShortcuts:()=>$(!0),videoStatus:h.videoStatus}),(0,s.jsxs)("main",{id:"main-content",ref:Q,className:"flex flex-1 overflow-hidden",role:"main","aria-label":"Call window main content",children:[(0,s.jsxs)("section",{className:"bg-muted/20 flex w-[35%] flex-col","aria-label":"transcript"===z?"Call transcript":"Schedule view",children:[(0,s.jsxs)("div",{className:"bg-card/50 flex border-b",role:"tablist","aria-label":"View selection",children:[(0,s.jsxs)(_.Button,{className:"flex-1 rounded-none border-r",onClick:()=>O("transcript"),size:"sm",variant:"transcript"===z?"secondary":"ghost",role:"tab","aria-selected":"transcript"===z,"aria-controls":"left-panel-content",children:[(0,s.jsx)(l.MessageSquare,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),"Transcript",(0,s.jsx)("span",{className:"sr-only",children:"(Press T)"})]}),(0,s.jsxs)(_.Button,{className:"flex-1 rounded-none",onClick:()=>O("schedule"),size:"sm",variant:"schedule"===z?"secondary":"ghost",role:"tab","aria-selected":"schedule"===z,"aria-controls":"left-panel-content",children:[(0,s.jsx)(a.CalendarDays,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),"Schedule",(0,s.jsx)("span",{className:"sr-only",children:"(Press S)"})]})]}),(0,s.jsx)("div",{id:"left-panel-content",className:"flex-1 overflow-hidden",role:"tabpanel","aria-label":"transcript"===z?"Call transcript panel":"Schedule panel",children:"transcript"===z?(0,s.jsx)(e5.TranscriptPanel,{}):(0,s.jsx)(eA,{companyId:M||void 0})})]}),(0,s.jsx)("section",{className:"flex-1 overflow-hidden","aria-label":"Customer information",children:(0,s.jsx)(ey,{customerData:ex,isLoading:L,onCreateJob:Z,onScheduleAppointment:ee,onSendSMS:es,onSendEmail:et,onTakePayment:ea,onAddNote:el})})]}),(0,s.jsx)(eU,{open:V,onOpenChange:$}),(0,s.jsx)(eR,{open:H,onOpenChange:q,onComplete:en,onCancel:ei,callDuration:B,customerName:eu,existingNotes:X})]})}function st(){return(0,s.jsx)(n.Suspense,{fallback:(0,s.jsx)(e4,{}),children:(0,s.jsx)(ss,{})})}e.s(["default",()=>st],830046)}]);