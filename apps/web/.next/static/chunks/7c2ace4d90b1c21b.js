(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,728947,e=>{"use strict";let t=(0,e.i(383206).default)("voicemail",[["circle",{cx:"6",cy:"12",r:"4",key:"1ehtga"}],["circle",{cx:"18",cy:"12",r:"4",key:"4vafl8"}],["line",{x1:"6",x2:"18",y1:"16",y2:"16",key:"pmt8us"}]]);e.s(["default",()=>t])},398598,e=>{"use strict";var t=e.i(728947);e.s(["Voicemail",()=>t.default])},438690,491655,e=>{"use strict";var t=e.i(552038),s=(0,t.createServerReference)("403ea65f9c2fca71bfc045bb6385cb305ee814e033",t.callServer,void 0,t.findSourceMapURL,"autoLinkCommunicationAction");e.s(["autoLinkCommunicationAction",()=>s],438690);var a=(0,t.createServerReference)("40cc931dda50eedd0e238813824fa3e4330a2065ab",t.callServer,void 0,t.findSourceMapURL,"getAutoLinkSuggestionsAction");e.s(["getAutoLinkSuggestionsAction",()=>a],491655)},411494,e=>{"use strict";var t=e.i(552038),s=(0,t.createServerReference)("406861cd5224a1d7b671811bfed22c95dd73829df5",t.callServer,void 0,t.findSourceMapURL,"markEmailAsReadAction");e.s(["markEmailAsReadAction",()=>s])},26839,e=>{"use strict";var t=e.i(552038),s=(0,t.createServerReference)("40fce90de48a3dc3624e62d6ae8fe22c5d103d1f6b",t.callServer,void 0,t.findSourceMapURL,"archiveEmailAction");e.s(["archiveEmailAction",()=>s])},171887,e=>{"use strict";var t=e.i(552038),s=(0,t.createServerReference)("4072a3f09fd79f89952570ec80a7c57e18f5dadea3",t.callServer,void 0,t.findSourceMapURL,"toggleStarEmailAction");e.s(["toggleStarEmailAction",()=>s])},231476,e=>{"use strict";var t=e.i(819260);e.s(["PanelLeft",()=>t.default])},905167,e=>{"use strict";let t=(0,e.i(383206).default)("reply",[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]]);e.s(["default",()=>t])},103047,e=>{"use strict";let t=(0,e.i(383206).default)("sticky-note",[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]]);e.s(["default",()=>t])},79370,e=>{"use strict";var t=e.i(103047);e.s(["StickyNote",()=>t.default])},126776,e=>{"use strict";var t=e.i(905167);e.s(["Reply",()=>t.default])},474500,e=>{"use strict";var t=e.i(111043);e.i(889265);var s=e.i(677607),a=e.i(152088),l=e.i(882896),i=e.i(507769),r=e.i(218074),n=e.i(818796),c=e.i(970799),d=e.i(995403);e.i(794747);var o=e.i(513990);function m({html:s,text:l,attachments:r,className:n}){let[d,o]=(0,c.useState)(null);(0,c.useEffect)(()=>{e.A(161886).then(e=>{o(()=>e.default)})},[]);let m=(0,c.useMemo)(()=>s&&d?d.sanitize(s,{ALLOWED_TAGS:["p","br","strong","em","u","b","i","s","strike","a","ul","ol","li","h1","h2","h3","h4","h5","h6","blockquote","img","table","thead","tbody","tfoot","tr","th","td","div","span","hr","pre","code","font","center","section","article","header","footer","main","style"],ALLOWED_ATTR:["href","src","alt","title","width","height","style","class","id","align","valign","border","cellpadding","cellspacing","bgcolor","color","face","size","colspan","rowspan","target","rel"],ALLOW_DATA_ATTR:!1,ALLOWED_URI_REGEXP:/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,KEEP_CONTENT:!0,ADD_TAGS:["style"],ADD_ATTR:["media","type"]}):null,[s,d]),u=(0,c.useMemo)(()=>l?l.split(/\n\n+/).map((e,s)=>(0,t.jsx)("p",{className:"mb-4 last:mb-0",children:e.split("\n").map((e,s,a)=>(0,t.jsxs)("span",{children:[e,s<a.length-1&&(0,t.jsx)("br",{})]},s))},s)):null,[l]),h=r&&r.length>0;return(0,t.jsxs)("div",{className:(0,a.cn)("flex flex-col gap-4",n),children:[(0,t.jsx)("div",{className:"email-content-wrapper prose prose-sm dark:prose-invert max-w-none",children:m?(0,t.jsx)("div",{className:"email-content-html text-sm leading-relaxed",style:{fontSize:"14px",lineHeight:"1.6",color:"inherit"},dangerouslySetInnerHTML:{__html:m}}):s&&!d?u?(0,t.jsx)("div",{className:"text-sm leading-relaxed text-foreground",children:u}):(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)("div",{className:"text-sm text-muted-foreground italic",children:"Loading email content..."})}):u?(0,t.jsx)("div",{className:"text-sm leading-relaxed text-foreground",children:u}):(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("svg",{width:"64",height:"64",viewBox:"0 0 192 192",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"mx-auto mb-4 opacity-30",children:(0,t.jsx)("rect",{width:"192",height:"192",rx:"96",fill:"currentColor",fillOpacity:"0.15"})}),(0,t.jsx)("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"No content available"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"This email may have been deleted or expired"})]})})}),h&&(0,t.jsxs)("div",{className:"border-t border-border/50 pt-4",children:[(0,t.jsxs)("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2 text-foreground",children:[(0,t.jsx)(i.File,{className:"h-4 w-4"}),"Attachments (",r.length,")"]}),(0,t.jsx)("div",{className:"flex flex-col gap-2",children:r.map((e,s)=>(0,t.jsx)(x,{attachment:e},e.id||e.path||s))})]})]})}function x({attachment:e}){let a=e.filename||e.name||"attachment",m=e.content_type||e.type||"",x=m.startsWith("image/"),u=e.storage_url||null,h=!!u&&"#"!==u,p=(0,c.useCallback)(()=>{d.toast.error("Attachment unavailable",{description:"This attachment cannot be downloaded. The file may have expired or been removed."})},[]);return(0,t.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg hover:bg-muted transition-colors",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:x?(0,t.jsx)(r.Image,{className:"h-5 w-5 text-muted-foreground"}):(0,t.jsx)(i.File,{className:"h-5 w-5 text-muted-foreground"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-medium truncate",children:a}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[m&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:m}),!h&&(0,t.jsxs)(o.Tooltip,{children:[(0,t.jsx)(o.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("span",{className:"text-xs text-orange-500 flex items-center gap-0.5",children:[(0,t.jsx)(n.AlertCircle,{className:"h-3 w-3"}),"Unavailable"]})}),(0,t.jsx)(o.TooltipContent,{children:(0,t.jsx)("p",{children:"This attachment cannot be downloaded"})})]})]})]}),h?(0,t.jsx)(s.Button,{variant:"ghost",size:"sm",className:"flex-shrink-0",asChild:!0,children:(0,t.jsxs)("a",{href:u,download:a,target:"_blank",rel:"noopener noreferrer",children:[(0,t.jsx)(l.Download,{className:"h-4 w-4"}),(0,t.jsxs)("span",{className:"sr-only",children:["Download ",a]})]})}):(0,t.jsxs)(o.Tooltip,{children:[(0,t.jsx)(o.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(s.Button,{variant:"ghost",size:"sm",className:"flex-shrink-0 opacity-50",onClick:p,children:[(0,t.jsx)(l.Download,{className:"h-4 w-4"}),(0,t.jsxs)("span",{className:"sr-only",children:["Download ",a]})]})}),(0,t.jsx)(o.TooltipContent,{children:(0,t.jsx)("p",{children:"Attachment unavailable for download"})})]})]})}e.s(["EmailContent",()=>m])},966757,e=>{"use strict";var t=e.i(111043),s=e.i(970799),a=e.i(904653);e.i(670258);var l=e.i(921251);e.i(889265);var i=e.i(677607);e.i(51478);var r=e.i(635613);e.i(254978);var n=e.i(375308);e.i(287133);var c=e.i(120109);e.i(794747);var d=e.i(513990);e.i(306226);var o=e.i(508420);e.i(244242);var m=e.i(563078);e.i(526120);var x=e.i(610120);e.i(553153);var u=e.i(363712),h=e.i(152088),p=e.i(581435),f=e.i(559586),g=e.i(747146),v=e.i(939397),j=e.i(398598),N=e.i(14435),b=e.i(327149),w=e.i(126776),y=e.i(946672),k=e.i(532727),C=e.i(175913),S=e.i(38614),A=e.i(79370),T=e.i(694288),L=e.i(910685),M=e.i(212409),R=e.i(160424),B=e.i(231476),z=e.i(751139),D=e.i(474500),F=e.i(438690),E=e.i(491655);e.i(254851);var U=e.i(605278),I=e.i(15751),P=e.i(79254),_=e.i(818796),O=e.i(929294);function H({communication:e,companyId:a,onLinked:l}){let[r,n]=(0,s.useState)([]),[d,o]=(0,s.useState)(!0),[m,x]=(0,s.useState)(null),[p,f]=(0,s.useState)(new Set);if((0,s.useEffect)(()=>{!async function(){if(a){o(!0);try{let t=await (0,E.getAutoLinkSuggestionsAction)({communicationId:e.id,companyId:a});t.success&&t.suggestions&&n(t.suggestions)}catch(e){console.error("Failed to fetch suggestions:",e)}finally{o(!1)}}}()},[e.id,a]),e.customerId||e.jobId||e.propertyId)return null;let g=r.filter(e=>!p.has(e.id));if(d)return(0,t.jsx)(U.Card,{className:"border-blue-200 bg-blue-50/50 dark:border-blue-900 dark:bg-blue-950/20",children:(0,t.jsx)(U.CardHeader,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(O.Link2,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),(0,t.jsx)(U.CardTitle,{className:"text-sm font-semibold",children:"Looking for matches..."})]})})});if(0===g.length)return null;let v=async t=>{x(t.id);try{(await (0,F.autoLinkCommunicationAction)({communicationId:e.id,customerId:"customer"===t.type?t.id:void 0,jobId:"job"===t.type?t.id:void 0,propertyId:"property"===t.type?t.id:void 0,linkConfidence:t.confidence,linkMethod:t.matchMethod})).success&&(n(e=>e.filter(e=>e.id!==t.id)),l?.())}catch(e){console.error("Failed to link communication:",e)}finally{x(null)}};return(0,t.jsxs)(U.Card,{className:"border-blue-200 bg-blue-50/50 dark:border-blue-900 dark:bg-blue-950/20",children:[(0,t.jsxs)(U.CardHeader,{className:"pb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(O.Link2,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),(0,t.jsx)(U.CardTitle,{className:"text-sm font-semibold",children:"Suggested Matches"})]}),(0,t.jsxs)(U.CardDescription,{className:"text-xs",children:["We found ",g.length," potential ",1===g.length?"match":"matches"," for this communication"]})]}),(0,t.jsx)(U.CardContent,{className:"space-y-2 pt-0",children:g.map((e,s)=>{var a;let l=(e=>{switch(e){case"customer":return{icon:N.User,color:"text-blue-500",bg:"bg-blue-500/10",label:"Customer"};case"job":return{icon:b.Briefcase,color:"text-purple-500",bg:"bg-purple-500/10",label:"Job"};case"property":return{icon:I.MapPin,color:"text-green-500",bg:"bg-green-500/10",label:"Property"}}})(e.type),r=l.icon,n=m===e.id;return(0,t.jsxs)("div",{children:[s>0&&(0,t.jsx)(c.Separator,{className:"my-2"}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:(0,h.cn)("rounded-full p-2",l.bg),children:(0,t.jsx)(r,{className:(0,h.cn)("h-4 w-4",l.color)})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0 space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"font-medium text-sm truncate",children:e.name}),(0,t.jsx)(u.Badge,{variant:"outline",className:"text-xs shrink-0",children:l.label})]}),e.subtitle&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:e.subtitle}),(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(a=e.confidence)>=.9?(0,t.jsxs)(u.Badge,{variant:"default",className:"gap-1",children:[(0,t.jsx)(P.Check,{className:"h-3 w-3"}),Math.round(100*a),"% match"]}):a>=.7?(0,t.jsxs)(u.Badge,{variant:"secondary",className:"gap-1",children:[Math.round(100*a),"% match"]}):(0,t.jsxs)(u.Badge,{variant:"outline",className:"gap-1",children:[(0,t.jsx)(_.AlertCircle,{className:"h-3 w-3"}),Math.round(100*a),"% match"]}),e.matchDetails&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:e.matchDetails})]})]}),(0,t.jsxs)("div",{className:"flex gap-1 shrink-0",children:[(0,t.jsxs)(i.Button,{size:"sm",variant:"default",onClick:()=>v(e),disabled:n,className:"h-8 gap-1",children:[(0,t.jsx)(P.Check,{className:"h-3 w-3"}),"Link"]}),(0,t.jsx)(i.Button,{size:"sm",variant:"ghost",onClick:()=>{var t;return t=e.id,void f(e=>new Set([...e,t]))},disabled:n,className:"h-8 w-8 p-0",children:(0,t.jsx)(M.X,{className:"h-3 w-3"})})]})]})]},e.id)})})]})}var $=e.i(995403),W=e.i(411494),V=e.i(26839),X=e.i(171887),q=e.i(552038),G=(0,q.createServerReference)("4058cd3d49d375b37cef03bec92ad4d75901c4c01b",q.callServer,void 0,q.findSourceMapURL,"bulkDeleteEmailsAction"),K=e.i(24079),Z=e.i(176378);function J({initialCommunications:F,companyId:E,teamMemberId:U,selectedId:I}){let P=(0,a.useRouter)(),_=(0,a.useSearchParams)(),{toggleSidebar:O}=(0,K.useSidebar)(),[q,J]=(0,s.useTransition)(),Q=_?.get("id")||I,[Y,ee]=(0,s.useState)(F),[et,es]=(0,s.useState)(!1),[ea,el]=(0,s.useState)(null),[ei,er]=(0,s.useState)(()=>I&&F&&F.find(e=>e.id===I)||null),[en,ec]=(0,s.useState)(""),[ed,eo]=(0,s.useState)(""),[em,ex]=(0,s.useState)("all"),[eu,eh]=(0,s.useState)(!1),[ep,ef]=(0,s.useState)(""),[eg,ev]=(0,s.useState)(!1),ej=(0,s.useRef)(null),eN=(0,s.useRef)(ei),eb=(0,s.useRef)(et);eb.current=et,(0,s.useEffect)(()=>{if(Q&&Y){let e=Y.find(e=>e.id===Q);e&&(er(e),ef(e.internalNotes||""),eN.current=e)}else er(null),eN.current=null},[Q,Y]),(0,s.useEffect)(()=>(ej.current&&clearTimeout(ej.current),ej.current=setTimeout(()=>{ec(ed)},300),()=>{ej.current&&clearTimeout(ej.current)}),[ed]);let ew=(0,s.useCallback)(async(t=!1)=>{es(!0),el(null),J(async()=>{try{let{getCommunicationsAction:t}=await e.A(312968),s=await t({teamMemberId:U,companyId:E,type:"all"!==em?em:void 0,limit:100});if(s.success&&s.data){ee(s.data);let e=eN.current;if(e){let t=s.data.find(t=>t.id===e.id);t&&(er(t),eN.current=t)}}}catch(t){console.error("Failed to fetch communications:",t);let e=t instanceof Error?t.message:"Failed to load communications";el(e),$.toast.error("Failed to load communications",{description:e})}finally{es(!1)}})},[U,E,em]);(0,s.useEffect)(()=>{ew()},[em]),(0,s.useEffect)(()=>{en&&ew()},[en]),(0,s.useEffect)(()=>{let e=setInterval(()=>{eb.current||ew()},3e4);return()=>clearInterval(e)},[ew]);let ey=(0,s.useCallback)(e=>{er(e),ef(e.internalNotes||""),eN.current=e;let t=new URLSearchParams(_?.toString()||"");t.set("id",e.id),P.push(`/dashboard/communication?${t.toString()}`,{scroll:!1}),("unread"===e.status||"new"===e.status)&&((0,W.markEmailAsReadAction)(e.id).catch(e=>{console.error("Failed to mark as read:",e)}),ee(t=>t.map(t=>t.id===e.id?{...t,status:"read"}:t)))},[P,_]),ek=(0,s.useCallback)(async()=>{if(ei){ev(!0);try{let{saveInternalNotesAction:t}=await e.A(312968),s=await t({communicationId:ei.id,notes:ep});s.success?($.toast.success("Notes saved"),ee(e=>e.map(e=>e.id===ei.id?{...e,internalNotes:ep,internalNotesUpdatedAt:new Date().toISOString(),internalNotesUpdatedBy:U}:e)),eh(!1)):$.toast.error(s.error||"Failed to save notes")}catch(e){console.error("Failed to save notes:",e),$.toast.error("Failed to save notes")}finally{ev(!1)}}},[ei,ep,U]),eC=(0,s.useCallback)(async e=>{try{let t=await (0,V.archiveEmailAction)(e);t.success?($.toast.success("Archived"),ee(t=>t.filter(t=>t.id!==e)),ei?.id===e&&er(null)):$.toast.error(t.error||"Failed to archive")}catch(e){console.error("Failed to archive:",e),$.toast.error("Failed to archive")}},[ei]),eS=(0,s.useCallback)(async e=>{try{let t=await (0,X.toggleStarEmailAction)(e);t.success?($.toast.success("Updated"),ee(t=>t.map(t=>t.id===e?{...t,isStarred:!t.isStarred}:t))):$.toast.error(t.error||"Failed to update")}catch(e){console.error("Failed to star:",e),$.toast.error("Failed to update")}},[]),eA=(0,s.useCallback)(async e=>{try{let t=await G([e]);t.success?($.toast.success("Deleted"),ee(t=>t.filter(t=>t.id!==e)),ei?.id===e&&er(null)):$.toast.error(t.error||"Failed to delete")}catch(e){console.error("Failed to delete:",e),$.toast.error("Failed to delete")}},[ei]),eT=Y.filter(e=>{if(en){let t=en.toLowerCase(),s=e.subject?.toLowerCase().includes(t),a=e.body?.toLowerCase().includes(t),l=e.fromAddress?.toLowerCase().includes(t),i=e.toAddress?.toLowerCase().includes(t);return s||a||l||i}return!0}),eL=!ei,eM=[{type:"all",label:"All",count:Y.length},{type:"email",label:"Email",count:Y.filter(e=>"email"===e.type).length},{type:"sms",label:"SMS",count:Y.filter(e=>"sms"===e.type).length},{type:"call",label:"Calls",count:Y.filter(e=>"call"===e.type).length},{type:"voicemail",label:"Voicemail",count:Y.filter(e=>"voicemail"===e.type).length}];return(0,t.jsx)("div",{className:"flex h-full w-full flex-col overflow-hidden bg-sidebar",children:(0,t.jsxs)("div",{className:"flex flex-1 overflow-hidden min-h-0 md:gap-2",children:[(0,t.jsx)("div",{className:(0,h.cn)("bg-card mb-1 shadow-sm flex flex-col overflow-hidden","w-full h-full","md:w-[400px] lg:w-[480px] md:rounded-tr-2xl",eL?"flex":"hidden md:flex"),children:(0,t.jsxs)("div",{className:"w-full h-full flex flex-col",children:[(0,t.jsxs)("div",{className:"sticky top-0 z-15 flex flex-col gap-2 p-2 pb-0 transition-colors bg-card",children:[(0,t.jsx)("div",{className:"grid grid-cols-12 gap-2 mt-1",children:(0,t.jsxs)("div",{className:"col-span-12 flex gap-2",children:[(0,t.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:O,className:"h-10 w-10 p-0 md:h-8 md:w-8 shrink-0",title:"Toggle sidebar",children:(0,t.jsx)(B.PanelLeft,{className:"h-5 w-5 md:h-4 md:w-4 text-muted-foreground"})}),(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(r.Input,{type:"search",placeholder:"Search communications...",value:ed,onChange:e=>eo(e.target.value),className:"h-10 md:h-8 pl-9 pr-20 text-base md:text-sm border-input bg-white dark:bg-[#141414] dark:border-none"}),(0,t.jsx)("svg",{width:"10",height:"10",viewBox:"0 0 10 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"absolute left-3 top-1/2 -translate-y-1/2 fill-[#71717A] dark:fill-[#6F6F6F]",children:(0,t.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.81038 7.0756C6.18079 7.54011 5.40248 7.81466 4.56004 7.81466C2.46451 7.81466 0.765747 6.11589 0.765747 4.02037C0.765747 1.92484 2.46451 0.226074 4.56004 0.226074C6.65557 0.226074 8.35433 1.92484 8.35433 4.02037C8.35433 4.8628 8.07978 5.64112 7.61527 6.27071L9.70535 8.36078C9.92761 8.58305 9.92761 8.94341 9.70535 9.16568C9.48308 9.38794 9.12272 9.38794 8.90046 9.16568L6.81038 7.0756ZM7.21604 4.02037C7.21604 5.48724 6.02691 6.67637 4.56004 6.67637C3.09317 6.67637 1.90403 5.48724 1.90403 4.02037C1.90403 2.5535 3.09317 1.36436 4.56004 1.36436C6.02691 1.36436 7.21604 2.5535 7.21604 4.02037Z"})}),ed&&(0,t.jsx)("button",{onClick:()=>eo(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:(0,t.jsx)(M.X,{className:"h-3 w-3"})})]}),(0,t.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>ew(!0),disabled:et,className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"Refresh",children:(0,t.jsx)(R.RefreshCw,{className:`h-5 w-5 md:h-4 md:w-4 text-muted-foreground ${et?"animate-spin":""}`})})]})}),(0,t.jsx)("div",{className:"flex gap-1 overflow-x-auto pb-2 scrollbar-none",children:eM.map(({type:e,label:s,count:a})=>(0,t.jsxs)(i.Button,{variant:em===e?"default":"ghost",size:"sm",onClick:()=>ex(e),className:"h-7 gap-1 whitespace-nowrap text-xs shrink-0",children:[s,a>0&&(0,t.jsx)(u.Badge,{variant:em===e?"secondary":"outline",className:"ml-0.5 h-4 px-1 text-[10px]",children:a})]},e))})]}),(0,t.jsx)("div",{className:(0,h.cn)("bg-[#006FFE] relative z-5 h-0.5 w-full transition-opacity",et?"opacity-100 animate-pulse":"opacity-0")}),(0,t.jsx)("div",{className:"relative z-1 flex-1 overflow-hidden pt-0 min-h-0",children:(0,t.jsx)("div",{className:"hide-link-indicator flex h-full w-full",children:(0,t.jsx)("div",{className:"flex flex-1 flex-col",children:(0,t.jsx)(n.ScrollArea,{className:"scrollbar-none flex-1 overflow-x-hidden h-full",children:ea&&(!Y||0===Y.length)?(0,t.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(z.AlertTriangle,{className:"h-8 w-8 text-destructive mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-sm text-destructive mb-2 font-medium",children:"Failed to load communications"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-4",children:ea}),(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>ew(),children:"Try Again"})]})}):eT.length?(0,t.jsx)("div",{className:"min-h-[200px] px-2",children:eT.map(e=>{let s=ei?.id===e.id,a="unread"===e.status||"new"===e.status,r=(e=>{switch(e){case"email":return{icon:f.Mail,color:"text-blue-500",bg:"bg-blue-500/10"};case"sms":return{icon:g.MessageSquare,color:"text-green-500",bg:"bg-green-500/10"};case"call":return{icon:v.Phone,color:"text-purple-500",bg:"bg-purple-500/10"};case"voicemail":return{icon:j.Voicemail,color:"text-orange-500",bg:"bg-orange-500/10"};default:return{icon:f.Mail,color:"text-gray-500",bg:"bg-gray-500/10"}}})(e.type),n=r.icon;return(0,t.jsx)("div",{className:"select-none md:my-1",children:(0,t.jsxs)("div",{className:(0,h.cn)("hover:bg-accent group flex cursor-pointer flex-col items-start rounded-lg py-2 text-left text-sm transition-all hover:opacity-100 relative",s?"bg-accent opacity-100":"",a?"opacity-100":"opacity-60"),onClick:()=>ey(e),children:[(0,t.jsxs)("div",{className:"dark:bg-panelDark absolute right-2 z-25 flex -translate-y-1/2 items-center gap-1 rounded-xl border bg-white p-1 opacity-0 shadow-sm group-hover:opacity-100 top-[-1] transition-opacity duration-200",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)(i.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 overflow-visible p-0 hover:bg-accent group/star",onClick:t=>{t.stopPropagation(),eS(e.id)},title:"Star",children:(0,t.jsx)(C.Star,{className:"h-4 w-4 text-muted-foreground transition-colors group-hover/star:text-yellow-500"})}),(0,t.jsx)(i.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:bg-accent group/archive",onClick:t=>{t.stopPropagation(),eC(e.id)},title:"Archive",children:(0,t.jsx)(y.Archive,{className:"h-4 w-4 text-muted-foreground transition-colors group-hover/archive:text-blue-500"})})]}),(0,t.jsxs)("div",{className:"relative flex w-full items-center justify-between gap-4 px-2",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(l.Avatar,{className:"h-8 w-8 shrink-0 rounded-full border",children:(0,t.jsx)(l.AvatarFallback,{className:"bg-white dark:bg-[#373737] text-[#9F9F9D] font-bold text-xs",children:("inbound"===e.direction?e.fromAddress?.[0]:e.toAddress?.[0])?.toUpperCase()||"?"})}),(0,t.jsx)("div",{className:(0,h.cn)("absolute -bottom-1 -right-1 rounded-full p-0.5 border border-white dark:border-[#1C1C1C]",r.bg),children:(0,t.jsx)(n,{className:(0,h.cn)("h-2.5 w-2.5",r.color)})})]}),(0,t.jsx)("div",{className:"flex w-full justify-between",children:(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsxs)("div",{className:"flex w-full flex-row items-center justify-between",children:[(0,t.jsx)("div",{className:"flex flex-row items-center gap-[4px]",children:(0,t.jsx)("span",{className:"font-bold text-md flex items-baseline gap-1 group-hover:opacity-100",children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"line-clamp-1 overflow-hidden text-sm",children:"outbound"===e.direction?e.toAddress||"Unknown recipient":e.fromAddress||"Unknown sender"}),a&&(0,t.jsx)("span",{className:"ml-0.5 size-2 rounded-full bg-[#006FFE]"})]})})}),(0,t.jsx)("p",{className:"text-muted-foreground text-nowrap text-xs font-normal opacity-70 transition-opacity group-hover:opacity-100 dark:text-[#8C8C8C]",children:e.createdAt?new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center gap-2",children:[(0,t.jsx)("p",{className:"mt-1 line-clamp-1 min-w-0 overflow-hidden text-sm text-[#8C8C8C] flex-1",children:e.subject||e.body||"No content"}),(0,t.jsxs)("div",{className:"flex items-center gap-1 shrink-0",children:[e.customerId&&(0,t.jsx)(Z.default,{href:`/dashboard/customers/${e.customerId}`,onClick:e=>e.stopPropagation(),className:"px-1.5 py-0.5 rounded text-[10px] bg-primary/10 text-primary hover:bg-primary/20 transition-colors flex items-center gap-0.5",title:"View customer profile",children:(0,t.jsx)(N.User,{className:"h-2.5 w-2.5"})}),e.jobId&&(0,t.jsx)("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-purple-500/10 text-purple-600 flex items-center gap-0.5",children:(0,t.jsx)(b.Briefcase,{className:"h-2.5 w-2.5"})}),e.autoLinked&&void 0!==e.linkConfidence&&(0,t.jsx)("span",{className:(0,h.cn)("px-1.5 py-0.5 rounded text-[10px] flex items-center gap-0.5",e.linkConfidence>=.8?"bg-green-500/10 text-green-600":"bg-yellow-500/10 text-yellow-600"),title:`Auto-linked: ${Math.round(100*e.linkConfidence)}%`,children:(0,t.jsx)(T.Link,{className:"h-2.5 w-2.5"})}),e.internalNotes&&(0,t.jsx)("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-muted text-muted-foreground flex items-center gap-0.5",children:(0,t.jsx)(A.StickyNote,{className:"h-2.5 w-2.5"})}),"failed"===e.status&&(0,t.jsx)("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-destructive/10 text-destructive flex items-center gap-0.5",children:(0,t.jsx)(z.AlertTriangle,{className:"h-2.5 w-2.5"})})]})]})]})})]})]})},e.id)})}):(0,t.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No communications found"}),en&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Try adjusting your search"})]})})})})})})]})}),ei?(0,t.jsx)("div",{className:(0,h.cn)("bg-card mb-1 shadow-sm flex flex-col min-w-0 overflow-hidden","w-full h-full","md:rounded-tl-2xl md:flex-1",ei?"flex":"hidden md:flex"),children:(0,t.jsx)("div",{className:"relative flex-1 min-h-0 flex flex-col",children:(0,t.jsxs)("div",{className:"bg-card relative flex flex-col overflow-hidden transition-all duration-300 h-full flex-1 min-h-0",children:[(0,t.jsxs)("div",{className:"sticky top-0 z-15 flex shrink-0 items-center justify-between gap-1.5 p-2 pb-0 transition-colors bg-card",children:[(0,t.jsxs)("div",{className:"flex flex-1 items-center gap-2",children:[(0,t.jsxs)(i.Button,{variant:"ghost",size:"sm",onClick:()=>{er(null),eN.current=null;let e=new URLSearchParams;P.push(`/dashboard/communication?${e.toString()}`,{scroll:!1})},className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"Back to list",children:[(0,t.jsx)(L.ArrowLeft,{className:"h-5 w-5 md:hidden text-muted-foreground"}),(0,t.jsx)(M.X,{className:"h-4 w-4 hidden md:block text-muted-foreground"})]}),(0,t.jsx)(c.Separator,{orientation:"vertical",className:"h-4 bg-border/60 hidden md:block"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[("email"===ei.type||"sms"===ei.type)&&(0,t.jsxs)(i.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-auto md:px-2",title:"Reply",children:[(0,t.jsx)(w.Reply,{className:"h-5 w-5 md:h-4 md:w-4 md:mr-1.5 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm leading-none font-medium hidden md:inline",children:"Reply"})]}),(0,t.jsxs)(o.Sheet,{open:eu,onOpenChange:eh,children:[(0,t.jsx)(o.SheetTrigger,{asChild:!0,children:(0,t.jsx)(i.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8 hidden md:flex",title:"Internal notes",children:(0,t.jsx)(A.StickyNote,{className:"h-4 w-4 text-muted-foreground"})})}),(0,t.jsxs)(o.SheetContent,{children:[(0,t.jsxs)(o.SheetHeader,{children:[(0,t.jsx)(o.SheetTitle,{children:"Internal Notes"}),(0,t.jsx)(o.SheetDescription,{children:"Private team notes - not visible to customer"})]}),(0,t.jsxs)("div",{className:"py-4",children:[(0,t.jsx)(x.Textarea,{placeholder:"Add your notes here...",value:ep,onChange:e=>ef(e.target.value),className:"min-h-[200px] resize-none"}),ei.internalNotesUpdatedAt&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Last updated"," ",(0,p.formatDistanceToNow)(new Date(ei.internalNotesUpdatedAt),{addSuffix:!0})]}),(0,t.jsxs)("div",{className:"mt-4 flex justify-end gap-2",children:[(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>eh(!1),children:"Cancel"}),(0,t.jsx)(i.Button,{size:"sm",onClick:ek,disabled:eg,children:eg?"Saving...":"Save Notes"})]})]})]})]}),(0,t.jsx)(i.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8 group/star",title:"Star",children:(0,t.jsx)(C.Star,{className:"h-5 w-5 md:h-4 md:w-4 text-muted-foreground transition-colors group-hover/star:text-yellow-500"})}),(0,t.jsx)(i.Button,{variant:"destructive",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"Archive",onClick:()=>ei&&eC(ei.id),children:(0,t.jsx)(y.Archive,{className:"h-5 w-5 md:h-4 md:w-4"})}),(0,t.jsxs)(m.DropdownMenu,{children:[(0,t.jsx)(m.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(i.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"More",children:(0,t.jsx)(S.MoreHorizontal,{className:"h-5 w-5 md:h-4 md:w-4 text-muted-foreground"})})}),(0,t.jsxs)(m.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,t.jsxs)(m.DropdownMenuItem,{onClick:()=>eh(!0),className:"md:hidden",children:[(0,t.jsx)(A.StickyNote,{className:"h-4 w-4 mr-2"}),"Notes"]}),(0,t.jsx)(m.DropdownMenuSeparator,{className:"md:hidden"}),(0,t.jsxs)(m.DropdownMenuItem,{onClick:()=>eA(ei.id),className:"text-destructive focus:text-destructive",children:[(0,t.jsx)(k.Trash2,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]}),(0,t.jsx)("div",{className:"flex min-h-0 flex-1 flex-col overflow-hidden",children:(0,t.jsx)("div",{className:"relative overflow-hidden flex-1 h-full min-h-0 flex flex-col",children:(0,t.jsxs)(d.TooltipProvider,{delayDuration:100,children:[(0,t.jsxs)("div",{className:"border-b border-border/50 px-2 py-4 space-y-3",children:[(0,t.jsx)("h1",{className:"text-base font-semibold text-foreground",children:ei.subject||("sms"===ei.type?"Text Message":"No Subject")}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(l.Avatar,{className:"h-9 w-9 shrink-0 rounded-md cursor-pointer",children:(0,t.jsx)(l.AvatarFallback,{className:"bg-muted text-muted-foreground font-semibold text-sm rounded-md",children:("inbound"===ei.direction?ei.fromAddress?.[0]:ei.toAddress?.[0])?.toUpperCase()||"?"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-semibold text-sm text-foreground",children:"inbound"===ei.direction?ei.fromAddress||"Unknown":ei.toAddress||"Unknown"}),("unread"===ei.status||"new"===ei.status)&&(0,t.jsx)("div",{className:"h-2 w-2 rounded-full bg-primary"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)("span",{children:"inbound"===ei.direction?`from ${ei.fromAddress?.split("@")[0]||"unknown"}`:`to ${ei.toAddress?.split("@")[0]||"unknown"}`}),ei.customerId&&(0,t.jsxs)(u.Badge,{variant:"outline",className:"gap-1",children:[(0,t.jsx)(N.User,{className:"h-2.5 w-2.5"}),"Customer"]})]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:new Date(ei.createdAt).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[ei.autoLinked&&void 0!==ei.linkConfidence&&(0,t.jsxs)(u.Badge,{variant:ei.linkConfidence>=.8?"default":"secondary",className:"gap-1",children:[(0,t.jsx)(T.Link,{className:"h-3 w-3"}),"Auto-linked (",Math.round(100*ei.linkConfidence),"%)"]}),ei.status&&(0,t.jsx)(u.Badge,{variant:"outline",className:"gap-1",children:ei.status}),ei.type&&(0,t.jsx)(u.Badge,{variant:"outline",className:"gap-1",children:ei.type})]})]}),(0,t.jsx)("div",{className:"px-2 py-2",children:(0,t.jsx)(H,{communication:ei,companyId:E,onLinked:()=>{ew()}})}),(0,t.jsx)(n.ScrollArea,{className:"flex-1 px-2 py-4",children:"email"===ei.type?(0,t.jsx)(D.EmailContent,{content:ei.body||"",contentType:ei.contentType||"text"}):(0,t.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,t.jsx)("p",{className:"whitespace-pre-wrap",children:ei.body||"No content"})})})]})})})]})})}):(0,t.jsxs)("div",{className:(0,h.cn)("bg-card mb-1 shadow-sm hidden md:flex md:flex-col md:items-center md:justify-center md:rounded-tl-2xl md:flex-1"),children:[(0,t.jsx)(f.Mail,{className:"h-16 w-16 text-muted-foreground mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"No communication selected"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select a communication from the list to view details"})]})]})})}e.s(["UnifiedInboxPageClient",()=>J],966757)}]);