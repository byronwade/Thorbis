(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,871509,e=>{"use strict";function t(e,s={}){let{minimumFractionDigits:r=0,maximumFractionDigits:a=s.decimals??2,showZero:i=!0,decimals:n}=s,l=void 0!==n?n:a,c=void 0!==n?n:r;return null==e?i?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(0):"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:c,maximumFractionDigits:l}).format(e/100)}function s(e,t={}){let{minimumFractionDigits:r=0,maximumFractionDigits:a=t.decimals??2,showZero:i=!0,decimals:n}=t,l=void 0!==n?n:a,c=void 0!==n?n:r;return null==e||Number.isNaN(e)?i?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(0):"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:c,maximumFractionDigits:l}).format(e)}function r(e,t={}){let s;if(!e)return"—";let a="number"==typeof e||"string"==typeof e?new Date(e):e;if(Number.isNaN(a.getTime()))return"—";let i="table";"string"==typeof t?i=t||"table":(i=t.preset||"table",s=t.custom);let n=s||({short:{month:"short",day:"numeric",year:"numeric"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"},table:{month:"short",day:"numeric",year:"numeric"},time:{hour:"numeric",minute:"2-digit",hour12:!0},datetime:{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}})[i];return new Intl.DateTimeFormat("en-US",n).format(a)}function a(e){return r(e,{preset:"datetime"})}function i(e,t){if(!e)return"—";let s="number"==typeof e||"string"==typeof e?new Date(e):e;if(Number.isNaN(s.getTime()))return"—";if(!t)return r(s,{preset:"short"});let a="number"==typeof t||"string"==typeof t?new Date(t):t;if(Number.isNaN(a.getTime())||s.getFullYear()===a.getFullYear()&&s.getMonth()===a.getMonth()&&s.getDate()===a.getDate())return r(s,{preset:"short"});let i=new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(s),n=new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(a);return`${i} → ${n}`}e.s(["formatCurrency",()=>t,"formatCurrencyFromDollars",()=>s,"formatDate",()=>r,"formatDateRange",()=>i,"formatDateTime",()=>a])},686787,e=>{"use strict";e.i(116233),e.s([])},242020,e=>{"use strict";var t=e.i(111043),s=e.i(970799),r=e.i(176378),a=e.i(818796),i=e.i(327149),n=e.i(276389),l=e.i(512710),c=e.i(263699),m=e.i(982686),o=e.i(606661),d=e.i(641304),u=e.i(939397),h=e.i(14435);e.i(686787);var x=e.i(519539);e.i(553153);var f=e.i(363712);e.i(889265);var j=e.i(677607);e.i(254851);var N=e.i(605278);e.i(287133);var p=e.i(120109),y=e.i(830891),g=e.i(871509),v=e.i(960876);function b({customerId:e,className:b}){let[w,C]=(0,s.useState)(!1),[D,_]=(0,s.useState)(!0),[S,F]=(0,s.useState)(null),[U,T]=(0,s.useState)(null),[$,A]=(0,s.useState)([]),[B,I]=(0,s.useState)([]),[k,P]=(0,s.useState)(0),[R,z]=(0,s.useState)(null);if((0,s.useEffect)(()=>{(async()=>{_(!0),F(null);try{let t=(0,y.createClient)(),[s,r,a]=await Promise.all([t.from("customers").select("id, first_name, last_name, display_name, email, phone, company_name").eq("id",e).single(),t.from("jobs").select("id, title, status, total_amount, scheduled_start, created_at").eq("customer_id",e).order("created_at",{ascending:!1}).limit(3),t.from("invoices").select("id, invoice_number, status, total_amount, due_date, created_at").eq("customer_id",e).order("created_at",{ascending:!1}).limit(3)]);if(s.error)throw s.error;if(T(s.data),r.error)throw r.error;let i=r.data||[];if(A(i),i.length>0){let e=i.find(e=>"completed"===e.status||"invoiced"===e.status);e?.scheduled_start&&z(e.scheduled_start)}if(a.error)throw a.error;let n=a.data||[];I(n);let l=n.filter(e=>"sent"===e.status||"overdue"===e.status).reduce((e,t)=>e+(t.total_amount||0),0);P(l)}catch(e){console.error("Error fetching customer context:",e),F("Failed to load customer information")}finally{_(!1)}})()},[e]),D)return(0,t.jsxs)(N.Card,{className:b,children:[(0,t.jsx)(N.CardHeader,{className:"pb-3",children:(0,t.jsxs)(N.CardTitle,{className:"text-sm flex items-center gap-2",children:[(0,t.jsx)(h.User,{className:"h-4 w-4"}),"Customer Context"]})}),(0,t.jsx)(N.CardContent,{children:(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)(d.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"})})})]});if(S||!U)return(0,t.jsxs)(N.Card,{className:b,children:[(0,t.jsx)(N.CardHeader,{className:"pb-3",children:(0,t.jsxs)(N.CardTitle,{className:"text-sm flex items-center gap-2",children:[(0,t.jsx)(h.User,{className:"h-4 w-4"}),"Customer Context"]})}),(0,t.jsx)(N.CardContent,{children:(0,t.jsxs)(x.Alert,{variant:"destructive",children:[(0,t.jsx)(a.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)(x.AlertDescription,{children:S||"Customer not found"})]})})]});let q=(0,s.useMemo)(()=>(0,v.getCustomerDisplayName)(U),[U]);return(0,t.jsxs)(N.Card,{className:b,children:[(0,t.jsxs)(N.CardHeader,{className:"pb-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(h.User,{className:"h-4 w-4"}),(0,t.jsx)(N.CardTitle,{className:"text-sm",children:q})]}),(0,t.jsx)(j.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>C(!w),children:w?(0,t.jsx)(l.ChevronDown,{className:"h-4 w-4"}):(0,t.jsx)(c.ChevronUp,{className:"h-4 w-4"})})]}),U.company_name&&(0,t.jsx)(N.CardDescription,{className:"text-xs",children:U.company_name})]}),!w&&(0,t.jsxs)(N.CardContent,{className:"space-y-4",children:[k>0&&(0,t.jsxs)(x.Alert,{children:[(0,t.jsx)(m.DollarSign,{className:"h-4 w-4"}),(0,t.jsxs)(x.AlertDescription,{className:"text-xs",children:["Outstanding balance: ",(0,g.formatCurrency)(k)]})]}),R&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)(n.Calendar,{className:"h-3.5 w-3.5"}),(0,t.jsxs)("span",{children:["Last service: ",(0,g.formatDate)(R,"short")]})]}),$.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("h4",{className:"text-xs font-semibold flex items-center gap-1.5",children:[(0,t.jsx)(i.Briefcase,{className:"h-3.5 w-3.5"}),"Recent Jobs"]}),(0,t.jsx)(r.default,{href:`/dashboard/customers/${e}?tab=jobs`,className:"text-xs text-primary hover:underline",children:"View All"})]}),(0,t.jsx)("div",{className:"space-y-1.5",children:$.map(e=>(0,t.jsx)(r.default,{href:`/dashboard/work/${e.id}`,className:"block p-2 rounded-md hover:bg-muted/50 transition-colors",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-xs font-medium truncate",children:e.title||"Untitled Job"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,g.formatDate)(e.created_at,"short")})]}),(0,t.jsxs)("div",{className:"text-right shrink-0",children:[(0,t.jsx)(f.Badge,{variant:"outline",className:"text-xs h-5",children:e.status}),e.total_amount&&(0,t.jsx)("p",{className:"text-xs font-semibold mt-0.5",children:(0,g.formatCurrency)(e.total_amount)})]})]})},e.id))})]}),B.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Separator,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("h4",{className:"text-xs font-semibold flex items-center gap-1.5",children:[(0,t.jsx)(o.FileText,{className:"h-3.5 w-3.5"}),"Recent Invoices"]}),(0,t.jsx)(r.default,{href:`/dashboard/customers/${e}?tab=invoices`,className:"text-xs text-primary hover:underline",children:"View All"})]}),(0,t.jsx)("div",{className:"space-y-1.5",children:B.map(e=>(0,t.jsx)(r.default,{href:`/dashboard/work/invoices/${e.id}`,className:"block p-2 rounded-md hover:bg-muted/50 transition-colors",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("p",{className:"text-xs font-medium",children:["#",e.invoice_number]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:e.due_date?`Due ${(0,g.formatDate)(e.due_date,"short")}`:(0,g.formatDate)(e.created_at,"short")})]}),(0,t.jsxs)("div",{className:"text-right shrink-0",children:[(0,t.jsx)(f.Badge,{variant:"paid"===e.status?"default":"overdue"===e.status?"destructive":"outline",className:"text-xs h-5",children:e.status}),(0,t.jsx)("p",{className:"text-xs font-semibold mt-0.5",children:(0,g.formatCurrency)(e.total_amount)})]})]})},e.id))})]})]}),(0,t.jsx)(p.Separator,{}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(j.Button,{asChild:!0,size:"sm",variant:"outline",className:"flex-1 h-8 text-xs",children:(0,t.jsxs)(r.default,{href:`/dashboard/customers/${e}`,children:[(0,t.jsx)(h.User,{className:"mr-1.5 h-3.5 w-3.5"}),"View Profile"]})}),U.phone&&(0,t.jsx)(j.Button,{asChild:!0,size:"sm",variant:"outline",className:"flex-1 h-8 text-xs",children:(0,t.jsxs)(r.default,{href:`tel:${U.phone}`,children:[(0,t.jsx)(u.Phone,{className:"mr-1.5 h-3.5 w-3.5"}),"Call"]})}),(0,t.jsx)(j.Button,{asChild:!0,size:"sm",variant:"outline",className:"flex-1 h-8 text-xs",children:(0,t.jsxs)(r.default,{href:`/dashboard/schedule/new?customerId=${e}`,children:[(0,t.jsx)(n.Calendar,{className:"mr-1.5 h-3.5 w-3.5"}),"Schedule"]})})]}),0===$.length&&0===B.length&&(0,t.jsx)("div",{className:"text-center py-6",children:(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"No recent activity with this customer"})})]})]})}e.s(["CustomerContextCard",()=>b])},321019,e=>{e.n(e.i(242020))}]);