(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,339215,826997,e=>{"use strict";var t=e.i(111043),s=e.i(904653),a=e.i(995403),r=e.i(946672),n=e.i(276389),i=e.i(852648),l=e.i(882525),c=e.i(969098),o=e.i(15751),d=e.i(747146),u=e.i(38614),m=e.i(332845),h=e.i(939397),p=e.i(154115),x=e.i(532727),g=e.i(604501),S=e.i(678170),f=e.i(321369),j=e.i(900007),v=e.i(471348),b=e.i(694486),C=e.i(607126),y=e.i(683201),N=e.i(113444),w=e.i(234461),M=e.i(988969),k=e.i(890314),I=e.i(381750);e.i(116233);var A=e.i(530344),T=e.i(152088);let U=["scheduled","dispatched","arrived","in-progress","closed","completed"];function D({job:e,children:D,onOpenChange:R}){var L;let _,z=(0,s.useRouter)(),E=(L=e.status,-1===(_=U.indexOf(L))?0:_),F="cancelled"===e.status,J="closed"===e.status||"completed"===e.status,$=async(t,s,...r)=>{let n=a.toast.loading(`${t}...`),i=await s(e.id,...r);i.success?a.toast.success(`${t} successful`,{id:n}):a.toast.error(i.error||`Failed to ${t.toLowerCase()}`,{id:n})},O=async()=>{if(!e.customer?.phone)return void a.toast.error("Customer has no phone number");let t=e.assignments[0]?.displayName||"Your technician",s=e.location?.address?`${e.location.address.street}, ${e.location.address.city}, ${e.location.address.state}`:void 0;a.toast.loading("Sending On My Way notification...");let r=await (0,k.sendOnMyWayNotification)(e.id,t,e.customer.phone,s);a.toast.dismiss(),r.success?a.toast.success("On My Way notification sent!"):a.toast.error(r.error||"Failed to send notification")};return(0,t.jsxs)(A.ContextMenu,{onOpenChange:R,children:[(0,t.jsx)(A.ContextMenuTrigger,{asChild:!0,children:D}),(0,t.jsxs)(A.ContextMenuContent,{className:"w-64",children:[(0,t.jsxs)("div",{className:"px-2 py-2 border-b mb-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:(0,T.cn)("size-2 rounded-full shrink-0","scheduled"===e.status&&"bg-blue-500","dispatched"===e.status&&"bg-sky-500","arrived"===e.status&&"bg-emerald-400","in-progress"===e.status&&"bg-amber-500 animate-pulse","closed"===e.status&&"bg-emerald-600","completed"===e.status&&"bg-emerald-600","cancelled"===e.status&&"bg-slate-400")}),(0,t.jsx)("span",{className:"text-sm font-semibold truncate flex-1",children:e.customer?.name||"Unknown Customer"})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5 truncate pl-4",children:e.title})]}),(0,t.jsx)(A.ContextMenuLabel,{className:"text-xs text-muted-foreground font-normal",children:"View"}),(0,t.jsxs)(A.ContextMenuItem,{disabled:!e.jobId,onClick:()=>{e.jobId&&z.push(`/dashboard/work/${e.jobId}`)},children:[(0,t.jsx)(c.ExternalLink,{className:"size-4"}),(0,t.jsx)("span",{children:"View Job Details"}),(0,t.jsx)(A.ContextMenuShortcut,{children:"⌘O"})]}),e.location?.address&&(0,t.jsxs)(A.ContextMenuItem,{onClick:()=>{let t=`${e.location?.address?.street}, ${e.location?.address?.city}, ${e.location?.address?.state}`;window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(t)}`,"_blank")},children:[(0,t.jsx)(m.Navigation,{className:"size-4"}),(0,t.jsx)("span",{children:"Open in Maps"})]}),(0,t.jsx)(A.ContextMenuSeparator,{}),(0,t.jsx)(A.ContextMenuLabel,{className:"text-xs text-muted-foreground font-normal",children:"Update Status"}),!F&&(0,t.jsxs)("div",{className:"px-2 py-1.5 mb-1",children:[(0,t.jsx)("div",{className:"flex items-center gap-0.5",children:U.slice(0,-1).map((e,s)=>(0,t.jsx)("div",{className:"flex items-center flex-1",children:(0,t.jsx)("div",{className:(0,T.cn)("h-1 flex-1 rounded-full transition-colors",s<E?"bg-emerald-500":s===E?"bg-blue-500":"bg-muted")})},e))}),(0,t.jsxs)("p",{className:"text-[10px] text-muted-foreground mt-1 text-center capitalize",children:["Current: ",e.status.replace("-"," ")]})]}),(0,t.jsxs)(A.ContextMenuItem,{disabled:E>=1||F,onClick:()=>$("Dispatching",M.dispatchAppointment),children:[(0,t.jsx)(g.Truck,{className:"size-4"}),(0,t.jsx)("span",{children:"Mark Dispatched"}),E>=1&&!F&&(0,t.jsx)(i.CheckCircle2,{className:"size-3.5 text-emerald-500 ml-auto"})]}),e.customer?.phone&&(0,t.jsxs)(A.ContextMenuItem,{disabled:E>=2||F,onClick:O,className:"text-sky-600 dark:text-sky-400",children:[(0,t.jsx)(p.Send,{className:"size-4"}),(0,t.jsx)("span",{children:'Send "On My Way" SMS'})]}),(0,t.jsxs)(A.ContextMenuItem,{disabled:E>=2||F,onClick:()=>$("Marking arrived",b.arriveAppointment),children:[(0,t.jsx)(o.MapPin,{className:"size-4"}),(0,t.jsx)("span",{children:"Mark Arrived"}),E>=2&&!F&&(0,t.jsx)(i.CheckCircle2,{className:"size-3.5 text-emerald-500 ml-auto"})]}),(0,t.jsxs)(A.ContextMenuItem,{disabled:E>=4||F,onClick:()=>$("Closing",N.closeAppointment),children:[(0,t.jsx)(S.UserCheck,{className:"size-4"}),(0,t.jsx)("span",{children:"Mark Closed"}),E>=4&&!F&&(0,t.jsx)(i.CheckCircle2,{className:"size-3.5 text-emerald-500 ml-auto"})]}),(0,t.jsxs)(A.ContextMenuItem,{disabled:J||F,onClick:()=>$("Completing",w.completeAppointment),children:[(0,t.jsx)(i.CheckCircle2,{className:"size-4"}),(0,t.jsx)("span",{children:"Mark Complete"}),"completed"===e.status&&(0,t.jsx)(i.CheckCircle2,{className:"size-3.5 text-emerald-500 ml-auto"})]}),(0,t.jsx)(A.ContextMenuSeparator,{}),(e.customer?.phone||e.customer?.email)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(A.ContextMenuSub,{children:[(0,t.jsxs)(A.ContextMenuSubTrigger,{children:[(0,t.jsx)(d.MessageSquare,{className:"size-4"}),(0,t.jsx)("span",{children:"Contact Customer"})]}),(0,t.jsxs)(A.ContextMenuSubContent,{className:"w-48",children:[e.customer?.phone&&(0,t.jsxs)(A.ContextMenuItem,{onClick:()=>{window.location.href=`tel:${e.customer?.phone}`},children:[(0,t.jsx)(h.Phone,{className:"size-4"}),(0,t.jsxs)("span",{children:["Call ",e.customer.phone]})]}),e.customer?.phone&&(0,t.jsxs)(A.ContextMenuItem,{onClick:()=>{window.location.href=`sms:${e.customer?.phone}`},children:[(0,t.jsx)(d.MessageSquare,{className:"size-4"}),(0,t.jsx)("span",{children:"Send SMS"})]})]})]}),(0,t.jsx)(A.ContextMenuSeparator,{})]}),(0,t.jsx)(A.ContextMenuLabel,{className:"text-xs text-muted-foreground font-normal",children:"Schedule"}),(0,t.jsxs)(A.ContextMenuItem,{children:[(0,t.jsx)(n.Calendar,{className:"size-4"}),(0,t.jsx)("span",{children:"Reschedule"}),(0,t.jsx)(A.ContextMenuShortcut,{children:"⌘R"})]}),(0,t.jsxs)(A.ContextMenuItem,{children:[(0,t.jsx)(l.Copy,{className:"size-4"}),(0,t.jsx)("span",{children:"Duplicate"}),(0,t.jsx)(A.ContextMenuShortcut,{children:"⌘D"})]}),(0,t.jsxs)(A.ContextMenuItem,{onClick:()=>$("Moving to Unscheduled",I.unassignAppointment),children:[(0,t.jsx)(f.UserMinus,{className:"size-4"}),(0,t.jsx)("span",{children:"Move to Unscheduled"})]}),(0,t.jsx)(A.ContextMenuSeparator,{}),(0,t.jsxs)(A.ContextMenuSub,{children:[(0,t.jsxs)(A.ContextMenuSubTrigger,{className:"text-destructive focus:text-destructive",children:[(0,t.jsx)(u.MoreHorizontal,{className:"size-4"}),(0,t.jsx)("span",{children:"More Actions"})]}),(0,t.jsxs)(A.ContextMenuSubContent,{className:"w-56",children:[(0,t.jsxs)(A.ContextMenuItem,{className:"text-orange-600 focus:text-orange-600 dark:text-orange-400 dark:focus:text-orange-400",disabled:F,onClick:()=>$("Cancelling appointment",C.cancelAppointment),children:[(0,t.jsx)(j.XCircle,{className:"size-4"}),(0,t.jsx)("span",{children:"Cancel Appointment Only"})]}),(0,t.jsxs)(A.ContextMenuItem,{variant:"destructive",disabled:F||!e.jobId,onClick:()=>$("Cancelling job & appointment",t=>(0,y.cancelJobAndAppointment)(t,e.jobId??"")),children:[(0,t.jsx)(x.Trash2,{className:"size-4"}),(0,t.jsx)("span",{children:"Cancel Job & Appointment"})]}),(0,t.jsx)(A.ContextMenuSeparator,{}),(0,t.jsxs)(A.ContextMenuItem,{variant:"destructive",onClick:()=>$("Archiving",v.archiveAppointment),children:[(0,t.jsx)(r.Archive,{className:"size-4"}),(0,t.jsx)("span",{children:"Archive"})]})]})]})]})]})}e.s(["ScheduleJobContextMenu",()=>D],339215);var R=e.i(970799),L=e.i(83690),_=e.i(899117),z=e.i(729885),E=e.i(830891);function F(){let e=(0,_.useScheduleStore)(e=>e.isLoading),t=(0,_.useScheduleStore)(e=>e.error),s=(0,_.useScheduleStore)(e=>e.lastSync),a=(0,_.useScheduleStore)(e=>e.jobs),r=(0,_.useScheduleStore)(e=>e.technicians),n=(0,_.useScheduleStore)(e=>e.selectedJobId),i=(0,_.useScheduleStore)(e=>e.selectedTechnicianId),l=(0,_.useScheduleStore)(e=>e.lastFetchedRange),c=(0,_.useScheduleStore)(e=>e.companyId),o=(0,_.useScheduleStore)(e=>e.unassignedHasMore),d=(0,_.useScheduleStore)(e=>e.unassignedSearch),u=(0,_.useScheduleStore)(e=>e.isLoadingUnassigned),m=(0,_.useScheduleStore)(e=>e.unassignedTotalCount),h=(0,_.useScheduleStore)(e=>e.setLoading),p=(0,_.useScheduleStore)(e=>e.setError),x=(0,_.useScheduleStore)(e=>e.setJobs),g=(0,_.useScheduleStore)(e=>e.setTechnicians),S=(0,_.useScheduleStore)(e=>e.selectJob),f=(0,_.useScheduleStore)(e=>e.selectTechnician),j=(0,_.useScheduleStore)(e=>e.addJob),v=(0,_.useScheduleStore)(e=>e.updateJob),b=(0,_.useScheduleStore)(e=>e.moveJob),C=(0,_.useScheduleStore)(e=>e.deleteJob),y=(0,_.useScheduleStore)(e=>e.duplicateJob),N=(0,_.useScheduleStore)(e=>e.getJobById),w=(0,_.useScheduleStore)(e=>e.syncWithServer),M=(0,_.useScheduleStore)(e=>e.setLastSync),k=(0,_.useScheduleStore)(e=>e.setCompanyId),I=(0,_.useScheduleStore)(e=>e.setLastFetchedRange),A=(0,_.useScheduleStore)(e=>e.setUnassignedMeta),T=(0,_.useScheduleStore)(e=>e.getUnassignedJobs),U=(0,_.useScheduleStore)(e=>e.getJobsGroupedByTechnician),D=(0,_.useScheduleStore)(e=>e.loadMoreUnassignedJobs),F=(0,z.useViewStore)(e=>e.filters),J=(0,z.useViewStore)(e=>e.showCompletedJobs);(0,z.useViewStore)(e=>e.currentDate),(0,z.useViewStore)(e=>e.zoom);let $=(0,R.useMemo)(()=>z.useViewStore.getState().getVisibleTimeRange(),[]),O=$.start.getTime(),V=$.end.getTime(),H=(0,R.useRef)(_.useScheduleStore.getState().companyId);(0,R.useEffect)(()=>{H.current=c},[c]);let P=a.size,B=(0,R.useMemo)(()=>{if(!l||0===P)return!1;let e=l.start.getTime(),t=l.end.getTime();return e<=O&&t>=V},[P,l,V,O]);(0,R.useEffect)(()=>{let e=!0;return B&&H.current?()=>{e=!1}:((async()=>{h(!0),p(null);try{let t=(0,E.createClient)();if(!t)throw Error("Database connection not available");let{data:{user:s},error:a}=await t.auth.getUser();if(a)throw a;if(!s)throw Error("User session not found");let r=H.current;if(!r){let{data:e,error:a}=await t.from("company_memberships").select("company_id").eq("user_id",s.id).eq("status","active").order("joined_at",{ascending:!1,nullsFirst:!1}).limit(1).maybeSingle();if(a)throw a;if(!e?.company_id)throw Error("No active company membership found");H.current=r=e.company_id,k(r)}if(!r)throw Error("Unable to resolve company context for schedule data");let{jobs:n,technicians:i,unassignedMeta:l}=await (0,L.fetchScheduleData)({supabase:t,companyId:r,range:{start:new Date(O),end:new Date(V)}});if(!e)return;g(i),x(n);let c={start:new Date(O),end:new Date(V)};g(i),x(n);let o=n.filter(e=>e.isUnassigned).length;A(l,o),M(new Date),I(c)}catch(t){if(!e)return;p(t instanceof Error?t.message:"object"==typeof t&&null!==t&&"message"in t?String(t.message):"Unknown error")}finally{e&&h(!1)}})(),()=>{e=!1})},[B,V,O,k,I,p,x,M,h,g]);let q=(0,R.useMemo)(()=>{var e,t;let s=(e=Array.from(a.values()),t={technicianIds:F.technicianIds,statuses:F.statuses,priorities:F.priorities,searchQuery:F.searchQuery},e.filter(e=>{if(t.technicianIds&&t.technicianIds.length>0&&!t.technicianIds.some(t=>{var s,a;return s=e,a=t,s.technicianId===a||s.assignments.some(e=>e.technicianId===a)})||t.statuses&&t.statuses.length>0&&!t.statuses.includes(e.status)||t.priorities&&t.priorities.length>0&&!t.priorities.includes(e.priority))return!1;if(t.searchQuery&&""!==t.searchQuery.trim()){let s=t.searchQuery.toLowerCase(),a=e.title.toLowerCase().includes(s),r=e.customer.name.toLowerCase().includes(s),n=e.description?.toLowerCase().includes(s);if(!(a||r||n))return!1}return!0}));return[...J?s:s.filter(e=>"completed"!==e.status)].sort((e,t)=>{let s=e.startTime instanceof Date?e.startTime:new Date(e.startTime),a=t.startTime instanceof Date?t.startTime:new Date(t.startTime);return s.getTime()-a.getTime()})},[a,F,J]),W=(0,R.useMemo)(()=>{let e=Array.from(r.values());return F.technicianIds.length>0?e.filter(e=>F.technicianIds.includes(e.id)):e},[r,F.technicianIds]),Q=(0,R.useMemo)(()=>{let e=new Map;for(let t of q){let s=t.technicianId;if(s){let a=e.get(s);a?a.push(t):e.set(s,[t])}}return e},[q]),G=(0,R.useCallback)(e=>Q.get(e)??[],[Q]),K=(0,R.useMemo)(()=>{let{start:e,end:t}=$;return q.filter(s=>s.startTime<=t&&s.endTime>=e)},[q,$]),X=(0,R.useCallback)(()=>Array.from(a.values()),[a]);return{isLoading:e,error:t,lastSync:s,technicians:W,jobs:q,visibleJobs:K,selectedJobId:n,selectedTechnicianId:i,selectedJob:n?N(n):null,getJobsForTechnician:G,getAllJobs:X,selectJob:S,selectTechnician:f,getUnassignedJobs:T,getJobsGroupedByTechnician:U,unassignedHasMore:o,unassignedSearch:d,isLoadingUnassigned:u,unassignedTotalCount:m,loadMoreUnassignedJobs:D,addJob:j,updateJob:v,moveJob:b,deleteJob:C,duplicateJob:y,refresh:w}}function J(){let e=(0,_.useScheduleStore)(e=>e.companyId),t=(0,_.useScheduleStore)(e=>e.updateJob),s=(0,_.useScheduleStore)(e=>e.deleteJob),a=(0,_.useScheduleStore)(e=>e.addJob),r=(0,_.useScheduleStore)(e=>e.getJobById),n=(0,_.useScheduleStore)(e=>e.syncWithServer),i=(0,_.useScheduleStore)(e=>e.lastSync),[l,c]=(0,R.useState)(!1),[o,d]=(0,R.useState)(null);return(0,R.useEffect)(()=>{if(!e)return;let a=(0,E.createClient)();if(!a)return void d("Database connection not available");let i=`schedule-realtime-${e}`,l=a.channel(i).on("postgres_changes",{event:"*",schema:"public",table:"appointments",filter:`company_id=eq.${e}`},async e=>{let{eventType:a,new:i,old:l}=e;switch(a){case"DELETE":{let e=l?.id;e&&s(e);break}case"UPDATE":{let e=i.id;if(!e)break;if(r(e)){let s={};void 0!==i.title&&(s.title=i.title),void 0!==i.description&&(s.description=i.description),void 0!==i.status&&(s.status=function(e){let t=e?.toLowerCase()??"scheduled";switch(t){case"scheduled":case"dispatched":case"arrived":case"closed":case"cancelled":return t;case"in-progress":case"in_progress":case"inprogress":return"in-progress";case"completed":case"complete":case"done":return"completed";default:return"scheduled"}}(i.status)),void 0!==i.start_time&&(s.startTime=new Date(i.start_time)),void 0!==i.end_time&&(s.endTime=new Date(i.end_time)),void 0!==i.assigned_to&&(null===i.assigned_to?(s.isUnassigned=!0,s.technicianId="",s.assignments=[]):(s.isUnassigned=!1,s.technicianId=i.assigned_to)),Object.keys(s).length>0&&t(e,s)}else await n();break}case"INSERT":await n()}}).subscribe(e=>{"SUBSCRIBED"===e?(c(!0),d(null)):"CHANNEL_ERROR"===e?(c(!1),d("Failed to connect to real-time updates")):"CLOSED"===e&&c(!1)});return()=>{a.removeChannel(l),c(!1)}},[e,t,s,a,r,n]),{isConnected:l,connectionError:o,lastUpdate:i}}e.s(["useSchedule",()=>F,"useScheduleRealtime",()=>J],826997)},272014,e=>{"use strict";var t=e.i(543713);e.s(["ClipboardCheck",()=>t.default])},626642,e=>{"use strict";let t=(0,e.i(383206).default)("user-check",[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);e.s(["default",()=>t])},678170,e=>{"use strict";var t=e.i(626642);e.s(["UserCheck",()=>t.default])},543713,e=>{"use strict";let t=(0,e.i(383206).default)("clipboard-check",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);e.s(["default",()=>t])},155902,e=>{"use strict";let t=(0,e.i(383206).default)("user-minus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);e.s(["default",()=>t])},760003,e=>{"use strict";let t=(0,e.i(383206).default)("hard-hat",[["path",{d:"M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5",key:"1p9q5i"}],["path",{d:"M14 6a6 6 0 0 1 6 6v3",key:"1hnv84"}],["path",{d:"M4 15v-3a6 6 0 0 1 6-6",key:"9ciidu"}],["rect",{x:"2",y:"15",width:"20",height:"4",rx:"1",key:"g3x8cw"}]]);e.s(["default",()=>t])},471348,e=>{"use strict";var t=e.i(552038),s=(0,t.createServerReference)("405048d6a264d7ae3ad8ea60c8cc225c5627b9ed33",t.callServer,void 0,t.findSourceMapURL,"archiveAppointment");e.s(["archiveAppointment",()=>s])},694486,e=>{"use strict";var t=e.i(552038),s=(0,t.createServerReference)("401af1cccca2877b6fdd4f049a5ef44df19cbda3ce",t.callServer,void 0,t.findSourceMapURL,"arriveAppointment");e.s(["arriveAppointment",()=>s])},607126,e=>{"use strict";var t=e.i(552038),s=(0,t.createServerReference)("601fcf9855a0cae3a0f1238e7e6ab0a7248f5ff0d4",t.callServer,void 0,t.findSourceMapURL,"cancelAppointment");e.s(["cancelAppointment",()=>s])},683201,e=>{"use strict";var t=e.i(552038),s=(0,t.createServerReference)("70b85397633d2ec7a4e8ec1d3ac4ab0702216ae896",t.callServer,void 0,t.findSourceMapURL,"cancelJobAndAppointment");e.s(["cancelJobAndAppointment",()=>s])},113444,e=>{"use strict";var t=e.i(552038),s=(0,t.createServerReference)("40e3ca7c75a73c22bad7803143ef99c89a1af186a6",t.callServer,void 0,t.findSourceMapURL,"closeAppointment");e.s(["closeAppointment",()=>s])},234461,988969,e=>{"use strict";var t=e.i(552038),s=(0,t.createServerReference)("40871b78d9e0136f2bfb2a26d724bac08c55979e01",t.callServer,void 0,t.findSourceMapURL,"completeAppointment");e.s(["completeAppointment",()=>s],234461);var a=(0,t.createServerReference)("4023cefc494eedf9321cc01c41274bd09e0baceb4b",t.callServer,void 0,t.findSourceMapURL,"dispatchAppointment");e.s(["dispatchAppointment",()=>a],988969)},890314,e=>{"use strict";var t=e.i(552038),s=(0,t.createServerReference)("7880f45196246990bf710fa56eb7e4cd5c15291c34",t.callServer,void 0,t.findSourceMapURL,"sendOnMyWayNotification");e.s(["sendOnMyWayNotification",()=>s])},381750,e=>{"use strict";var t=e.i(552038),s=(0,t.createServerReference)("4090075f04f8b8e0ce55f600da981c4363c44553f7",t.callServer,void 0,t.findSourceMapURL,"unassignAppointment");e.s(["unassignAppointment",()=>s])},960876,e=>{"use strict";function t(e,t){if(!e)return t||"Unknown Customer";if(e.display_name)return e.display_name;let s=e.first_name?.trim(),a=e.last_name?.trim();return s&&a?`${s} ${a}`:s||a||(e.company_name?e.company_name:e.email?e.email:t||"Unknown Customer")}function s(e){if(!e)return"?";let s=t(e).split(/\s+/).filter(Boolean);return s.length>=2?(s[0][0]+s[1][0]).toUpperCase():1===s.length&&s[0].length>=2?s[0].slice(0,2).toUpperCase():1===s.length?s[0][0].toUpperCase():"?"}e.s(["getCustomerDisplayName",()=>t,"getCustomerInitials",()=>s])},568185,e=>{"use strict";let t=(0,e.i(383206).default)("chevrons-up-down",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);e.s(["default",()=>t])},390929,e=>{"use strict";var t=e.i(568185);e.s(["ChevronsUpDown",()=>t.default])},438351,195100,e=>{"use strict";var t=e.i(552038),s=(0,t.createServerReference)("40f01c38bcd0dedd8819f5121a098e2ffd43eb6e19",t.callServer,void 0,t.findSourceMapURL,"createAppointment");e.s(["createAppointment",()=>s],438351);var a=e.i(111043),r=e.i(302324);e.i(670258);var n=e.i(921251);e.i(889265);var i=e.i(677607);e.i(733296);var l=e.i(993665);e.i(220474);var c=e.i(171056);e.i(254978);var o=e.i(375308),d=e.i(152088),u=e.i(960876),m=e.i(263942),h=e.i(79254),p=e.i(390929),x=e.i(641304),g=e.i(559586),S=e.i(939397),f=e.i(371526),j=e.i(287268),v=e.i(14435),b=e.i(970799);function C({value:e,onChange:t,placeholder:s="Search for customer...",className:C,showRecent:y=!0,recentCustomers:N=[],showCreateNew:w=!0,onCreateNew:M,disabled:k=!1,label:I,error:A=!1,errorMessage:T}){let[U,D]=(0,b.useState)(!1),[R,L]=(0,b.useState)(""),[_,z]=(0,b.useState)([]),[E,F]=(0,b.useState)(!1),[J,$]=(0,b.useState)(null);(0,b.useEffect)(()=>{if(R.trim().length<2){z([]),F(!1);return}F(!0);let e=setTimeout(async()=>{try{let e=await (0,r.searchCustomers)(R,{limit:10});if(e.success&&e.data){let t=Array.isArray(e.data)?e.data:[e.data];z(t)}else z([])}catch(e){console.error("Customer search error:",e),z([])}finally{F(!1)}},300);return()=>clearTimeout(e)},[R]);let O=(0,b.useCallback)(e=>{$(e),t(e.id,e),D(!1),L("")},[t]),V=(0,b.useCallback)(()=>{$(null),t(null,null),L("")},[t]),H=J?(0,u.getCustomerDisplayName)(J):s,P=(0,b.useMemo)(()=>{let e=new Map;return _.forEach(t=>e.set(t.id,t)),R.trim().length<2&&y&&N.forEach(t=>e.set(t.id,t)),Array.from(e.values())},[_,N,R,y]),B=({customer:t})=>{let s=(0,u.getCustomerDisplayName)(t),r=(0,u.getCustomerInitials)(t),i=e===t.id;return(0,a.jsxs)(l.CommandItem,{value:t.id,onSelect:()=>O(t),className:"flex items-center gap-3 px-3 py-2.5 cursor-pointer",children:[(0,a.jsx)(n.Avatar,{className:"h-8 w-8 shrink-0",children:(0,a.jsx)(n.AvatarFallback,{className:"text-xs font-semibold",children:r})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"font-medium text-sm truncate",children:s}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[t.email&&(0,a.jsxs)("span",{className:"flex items-center gap-1 truncate",children:[(0,a.jsx)(g.Mail,{className:"h-3 w-3 shrink-0"}),t.email]}),t.phone&&(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(S.Phone,{className:"h-3 w-3 shrink-0"}),t.phone]})]}),t.company_name&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground flex items-center gap-1 mt-0.5",children:[(0,a.jsx)(m.Building2,{className:"h-3 w-3 shrink-0"}),t.company_name]})]}),i&&(0,a.jsx)(h.Check,{className:"h-4 w-4 text-primary shrink-0"})]},t.id)};return(0,a.jsxs)("div",{className:(0,d.cn)("flex flex-col gap-1.5",C),children:[I&&(0,a.jsx)("label",{className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:I}),(0,a.jsxs)(c.Popover,{open:U,onOpenChange:D,children:[(0,a.jsx)(c.PopoverTrigger,{asChild:!0,children:(0,a.jsxs)(i.Button,{variant:"outline",role:"combobox","aria-expanded":U,disabled:k,className:(0,d.cn)("w-full justify-between",!J&&"text-muted-foreground",A&&"border-destructive focus-visible:ring-destructive"),children:[(0,a.jsx)("span",{className:"flex items-center gap-2 truncate",children:J?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.User,{className:"h-4 w-4 shrink-0"}),(0,a.jsx)("span",{className:"truncate",children:H})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.Search,{className:"h-4 w-4 shrink-0"}),(0,a.jsx)("span",{children:s})]})}),(0,a.jsx)(p.ChevronsUpDown,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(c.PopoverContent,{className:"w-[400px] p-0",align:"start",children:(0,a.jsxs)(l.Command,{shouldFilter:!1,children:[(0,a.jsx)(l.CommandInput,{placeholder:"Search customers...",value:R,onValueChange:L}),(0,a.jsx)(l.CommandList,{children:E?(0,a.jsx)("div",{className:"flex items-center justify-center py-6",children:(0,a.jsx)(x.Loader2,{className:"h-5 w-5 animate-spin text-muted-foreground"})}):(0,a.jsxs)(a.Fragment,{children:[P.length>0?(0,a.jsx)(l.CommandGroup,{heading:R.trim().length>=2?"Search Results":y&&N.length>0?"Recent Customers":"All Customers",children:(0,a.jsx)(o.ScrollArea,{className:"max-h-[300px]",children:P.map(e=>(0,a.jsx)(B,{customer:e},e.id))})}):R.trim().length>=2?(0,a.jsx)(l.CommandEmpty,{children:"No customers found."}):y&&0===N.length?(0,a.jsx)(l.CommandEmpty,{children:"Start typing to search for customers..."}):null,w&&M&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.CommandSeparator,{}),(0,a.jsx)(l.CommandGroup,{children:(0,a.jsxs)(l.CommandItem,{onSelect:()=>{D(!1),M()},className:"flex items-center gap-2 px-3 py-2.5 cursor-pointer text-primary",children:[(0,a.jsx)(f.Plus,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"font-medium",children:"Create New Customer"})]})})]})]})}),J&&!k&&(0,a.jsx)("div",{className:"border-t p-2",children:(0,a.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:V,className:"w-full text-muted-foreground hover:text-destructive",children:"Clear Selection"})})]})})]}),A&&T&&(0,a.jsx)("p",{className:"text-sm text-destructive",children:T})]})}e.s(["CustomerAutocomplete",()=>C],195100)},373915,e=>{"use strict";var t=e.i(111043),s=e.i(438351),a=e.i(195100);e.i(889265);var r=e.i(677607);e.i(539870);var n=e.i(846358);e.i(51478);var i=e.i(635613);e.i(149989);var l=e.i(880177);e.i(868198);var c=e.i(798764);e.i(526120);var o=e.i(610120),d=e.i(152088),u=e.i(751139),m=e.i(276389),h=e.i(136764),p=e.i(641304),x=e.i(15751),g=e.i(14435),S=e.i(501651),f=e.i(970799),j=e.i(230902);let v=[{value:"emergency",label:"Emergency / Urgent",color:"text-red-500"},{value:"follow_up",label:"Callback / Follow Up",color:"text-orange-500"},{value:"maintenance",label:"Maintenance / Recurring",color:"text-purple-500"},{value:"installation",label:"Install / New Work",color:"text-green-500"},{value:"service_call",label:"Service Call",color:"text-blue-500"},{value:"inspection",label:"Inspection",color:"text-slate-500"},{value:"estimate",label:"Estimate",color:"text-amber-500"},{value:"repair",label:"Repair",color:"text-cyan-500"},{value:"winterization",label:"Winterization",color:"text-indigo-500"}],b=[{value:"low",label:"Low",color:"text-slate-500"},{value:"normal",label:"Normal",color:"text-blue-500"},{value:"high",label:"High",color:"text-orange-500"},{value:"urgent",label:"Urgent",color:"text-red-500"}],C=[{value:30,label:"30 min"},{value:60,label:"1 hour"},{value:90,label:"1.5 hours"},{value:120,label:"2 hours"},{value:180,label:"3 hours"},{value:240,label:"4 hours"},{value:480,label:"Full day"}];function y({open:e,onOpenChange:y,location:N,technicians:w=[],nearbyCustomers:M=[],onSuccess:k,onCreateCustomer:I,defaultTechnicianId:A,defaultDateTime:T,defaultDuration:U}){let[D,R]=(0,f.useTransition)(),[L,_]=(0,f.useState)(null),[z,E]=(0,f.useState)(null),[F,J]=(0,f.useState)(null),[$,O]=(0,f.useState)(""),[V,H]=(0,f.useState)("service_call"),[P,B]=(0,f.useState)("normal"),[q,W]=(0,f.useState)(""),[Q,G]=(0,f.useState)(60),[K,X]=(0,f.useState)("");(0,f.useEffect)(()=>{if(e){if(A&&W(A),T){let e=new Date,t=T;T<e&&((t=new Date).setMinutes(0,0,0),t.setHours(t.getHours()+1)),ee((0,j.format)(t,"yyyy-MM-dd'T'HH:mm"))}U&&G([30,60,90,120,180,240,480].reduce((e,t)=>Math.abs(t-U)<Math.abs(e-U)?t:e))}},[e,A,T,U]);let Y=()=>{let e=new Date;return e.setMinutes(0,0,0),e.setHours(e.getHours()+1),e.toISOString().slice(0,16)},[Z,ee]=(0,f.useState)(Y()),et=(0,f.useCallback)(()=>{let e=new Date(Z);return e.setMinutes(e.getMinutes()+Q),e.toISOString()},[Z,Q]),es=(0,f.useCallback)(()=>{E(null),J(null),O(""),H("service_call"),B("normal"),W(""),G(60),X(""),ee(Y()),_(null)},[]),ea=e=>{e||es(),y(e)},er=async e=>{(e.preventDefault(),_(null),F)?$.trim()?R(async()=>{try{let e=new FormData;if(e.set("customerId",F),e.set("title",$.trim()),e.set("scheduledStart",new Date(Z).toISOString()),e.set("scheduledEnd",et()),e.set("type",V),e.set("priority",P),e.set("category","job_appointment"),q&&"unassigned"!==q&&e.set("assignedTo",q),K.trim()&&e.set("notes",K.trim()),N?.address){let t=K.trim(),s=`Location: ${N.address}`;e.set("notes",t?`${t}

${s}`:s)}let t=await (0,s.createAppointment)(e);t.success&&t.data?(k?.(t.data),ea(!1)):_(t.error||"Failed to create appointment")}catch(e){console.error("Failed to create appointment:",e),_("An unexpected error occurred")}}):_("Please enter a title"):_("Please select a customer")};return(0,t.jsx)(n.Dialog,{open:e,onOpenChange:ea,children:(0,t.jsxs)(n.DialogContent,{className:"sm:max-w-[500px]",children:[(0,t.jsxs)(n.DialogHeader,{children:[(0,t.jsxs)(n.DialogTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(m.Calendar,{className:"h-5 w-5 text-primary"}),"Quick Appointment"]}),(0,t.jsx)(n.DialogDescription,{children:N?.address?(0,t.jsxs)("span",{className:"flex items-center gap-1 text-sm",children:[(0,t.jsx)(x.MapPin,{className:"h-3.5 w-3.5"}),N.address]}):"Create a new appointment from the dispatch map"})]}),(0,t.jsxs)("form",{onSubmit:er,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"customer",children:"Customer *"}),(0,t.jsx)(a.CustomerAutocomplete,{value:F,onChange:(e,t)=>{if(J(e),E(t),t&&!$){let e=t.display_name||`${t.first_name||""} ${t.last_name||""}`.trim()||t.company_name||"Customer";O(`Service call - ${e}`)}},placeholder:"Search or select customer...",showCreateNew:!0,onCreateNew:I,showRecent:!0,recentCustomers:M,error:L?.includes("customer")})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"title",children:"Title *"}),(0,t.jsx)(i.Input,{id:"title",value:$,onChange:e=>O(e.target.value),placeholder:"e.g., AC Repair, Plumbing Inspection",className:(0,d.cn)(L?.includes("title")&&"border-destructive")})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"jobType",children:"Job Type"}),(0,t.jsxs)(c.Select,{value:V,onValueChange:H,children:[(0,t.jsx)(c.SelectTrigger,{id:"jobType",children:(0,t.jsx)(c.SelectValue,{})}),(0,t.jsx)(c.SelectContent,{children:v.map(e=>(0,t.jsx)(c.SelectItem,{value:e.value,children:(0,t.jsxs)("span",{className:(0,d.cn)("flex items-center gap-2",e.color),children:[(0,t.jsx)(S.Wrench,{className:"h-3.5 w-3.5"}),e.label]})},e.value))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"priority",children:"Priority"}),(0,t.jsxs)(c.Select,{value:P,onValueChange:B,children:[(0,t.jsx)(c.SelectTrigger,{id:"priority",children:(0,t.jsx)(c.SelectValue,{})}),(0,t.jsx)(c.SelectContent,{children:b.map(e=>(0,t.jsx)(c.SelectItem,{value:e.value,children:(0,t.jsxs)("span",{className:(0,d.cn)("flex items-center gap-2",e.color),children:["urgent"===e.value&&(0,t.jsx)(u.AlertTriangle,{className:"h-3.5 w-3.5"}),e.label]})},e.value))})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"scheduledStart",children:"Date & Time"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(h.Clock,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,t.jsx)(i.Input,{id:"scheduledStart",type:"datetime-local",value:Z,onChange:e=>ee(e.target.value),className:"pl-9"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"duration",children:"Duration"}),(0,t.jsxs)(c.Select,{value:Q.toString(),onValueChange:e=>G(Number(e)),children:[(0,t.jsx)(c.SelectTrigger,{id:"duration",children:(0,t.jsx)(c.SelectValue,{})}),(0,t.jsx)(c.SelectContent,{children:C.map(e=>(0,t.jsx)(c.SelectItem,{value:e.value.toString(),children:e.label},e.value))})]})]})]}),w.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"technician",children:"Assign Technician"}),(0,t.jsxs)(c.Select,{value:q,onValueChange:W,children:[(0,t.jsx)(c.SelectTrigger,{id:"technician",children:(0,t.jsx)(c.SelectValue,{placeholder:"Select technician (optional)"})}),(0,t.jsxs)(c.SelectContent,{children:[(0,t.jsx)(c.SelectItem,{value:"unassigned",children:"Unassigned"}),w.map(e=>(0,t.jsx)(c.SelectItem,{value:e.id,children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(g.User,{className:"h-3.5 w-3.5"}),e.name]})},e.id))]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"notes",children:"Notes"}),(0,t.jsx)(o.Textarea,{id:"notes",value:K,onChange:e=>X(e.target.value),placeholder:"Additional notes or instructions...",rows:2})]}),L&&(0,t.jsx)("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:L}),(0,t.jsxs)(n.DialogFooter,{children:[(0,t.jsx)(r.Button,{type:"button",variant:"outline",onClick:()=>ea(!1),disabled:D,children:"Cancel"}),(0,t.jsx)(r.Button,{type:"submit",disabled:D||!F,children:D?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create Appointment"})]})]})]})})}e.s(["QuickAppointmentDialog",()=>y])},952521,e=>{"use strict";var t=e.i(760003);e.s(["HardHat",()=>t.default])},321369,e=>{"use strict";var t=e.i(155902);e.s(["UserMinus",()=>t.default])}]);