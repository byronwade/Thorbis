(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,842210,e=>{"use strict";e.i(111043),e.i(486506);var t=e.i(276389),s=e.i(852648);e.i(136764);var a=e.i(982686),r=e.i(606661);e.i(288413);var i=e.i(311003),n=e.i(224262);e.i(154115);var l=e.i(212409);function o(){return null}e.i(970799),e.i(553153),e.i(363712),e.i(889265),e.i(677607),e.i(51478),e.i(635613),e.i(526120),e.i(610120),r.FileText,t.Calendar,n.Play,i.Pause,s.CheckCircle2,l.X,r.FileText,a.DollarSign,e.s(["JobHelpFooter",()=>o])},178193,e=>{"use strict";e.i(313550);var t=e.i(111043),s=e.i(227009),a=e.i(818796),r=e.i(263942),i=e.i(276389),n=e.i(133279),l=e.i(630754),o=e.i(87912),d=e.i(982686),c=e.i(882896),m=e.i(969098),u=e.i(606661),x=e.i(979731),h=e.i(929294),p=e.i(559586),g=e.i(15751),j=e.i(747146),f=e.i(60179),v=e.i(939397),b=e.i(371526),N=e.i(868106),y=e.i(598870),w=e.i(123891),C=e.i(142642),_=e.i(79370),k=e.i(540374),S=e.i(826463),D=e.i(14435),T=e.i(202724),z=e.i(501651),A=e.i(176378),F=e.i(904653),M=e.i(970799),P=e.i(49718),I=e.i(50753),L=e.i(16927),B=e.i(214618),$=e.i(905383),q=e.i(552038),U=(0,q.createServerReference)("408e80b3cde6acbbf52029b5b34cf969f275e65d9d",q.callServer,void 0,q.findSourceMapURL,"findOrCreateProperty"),E=(0,q.createServerReference)("408f899c6c9ae9bf0d3ddd5dc5f59d9eb034eefefe",q.callServer,void 0,q.findSourceMapURL,"assignTeamMemberToJob"),R=(0,q.createServerReference)("40bc97e60829c913eadb2dcb8c0210e5703090afdf",q.callServer,void 0,q.findSourceMapURL,"removeTeamMemberFromJob"),O=e.i(154115),J=e.i(40616);e.i(889265);var V=e.i(677607);e.i(539870);var H=e.i(846358);e.i(868198);var W=e.i(798764),Y=e.i(220168);e.i(526120);var G=e.i(610120),K=e.i(51052);function X({open:e,onOpenChange:s,customerName:a,customerPhone:r,customerId:i,companyId:n,companyPhones:l=[],jobId:o,propertyId:d,invoiceId:c,estimateId:m,onCommunicationCreated:u}){let{toast:x}=(0,K.useToast)(),[h,p]=(0,M.useTransition)(),[g,f]=(0,M.useState)(""),[v,b]=(0,M.useState)(l[0]?.number||""),N=g.length,y=N<=160?+(N>0):Math.ceil(N/153);return(0,t.jsx)(H.Dialog,{onOpenChange:s,open:e,children:(0,t.jsxs)(H.DialogContent,{className:"sm:max-w-lg",children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsxs)(H.DialogTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(j.MessageSquare,{className:"size-5"}),"Send Text Message"]}),(0,t.jsxs)(H.DialogDescription,{children:["Send an SMS message to ",a]})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsx)("div",{className:"bg-muted/50 rounded-lg border p-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"bg-primary/10 text-primary flex size-10 items-center justify-center rounded-full text-sm font-semibold",children:a.split(" ").map(e=>e[0]).join("").toUpperCase()}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("div",{className:"text-sm font-medium",children:a}),(0,t.jsx)("div",{className:"text-muted-foreground text-xs",children:r})]})]})}),l.length>0?(0,t.jsx)(Y.StandardFormField,{label:"Send From",htmlFor:"sms-from",children:(0,t.jsxs)(W.Select,{onValueChange:b,value:v,children:[(0,t.jsx)(W.SelectTrigger,{id:"sms-from",children:(0,t.jsx)(W.SelectValue,{placeholder:"Select a phone number"})}),(0,t.jsx)(W.SelectContent,{children:l.map(e=>(0,t.jsx)(W.SelectItem,{value:e.number,children:e.label||e.number},e.id))})]})}):(0,t.jsxs)("div",{className:"border-warning bg-warning dark:border-warning dark:bg-warning rounded-lg border p-4 text-center",children:[(0,t.jsx)("p",{className:"text-warning dark:text-warning text-sm",children:"No company phone numbers configured."}),(0,t.jsx)("p",{className:"text-warning dark:text-warning mt-1 text-xs",children:"Purchase or port a phone number from Settings → Phone Numbers"})]}),(0,t.jsxs)(Y.StandardFormField,{label:"Message",htmlFor:"sms-message",children:[(0,t.jsx)(G.Textarea,{id:"sms-message",className:"min-h-[120px] resize-y",onChange:e=>f(e.target.value),placeholder:"Type your message here...",value:g}),(0,t.jsxs)("div",{className:"text-muted-foreground flex items-center justify-between text-xs",children:[(0,t.jsxs)("span",{children:[N," characters"]}),(0,t.jsxs)("span",{className:y>1?"text-amber-500":"",children:[y," SMS segment",1!==y?"s":""]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)(V.Button,{disabled:h,onClick:()=>s(!1),variant:"outline",children:"Cancel"}),(0,t.jsxs)(V.Button,{disabled:h||!g.trim()||!v||0===l.length,onClick:()=>{g.trim()?v?p(async()=>{let e=await (0,J.sendTextMessage)({to:r,from:v,text:g,companyId:n,customerId:i,jobId:o,propertyId:d,invoiceId:c,estimateId:m});e.success&&"data"in e&&e.data?(x.success(`Text message sent to ${a}`),u?.(e.data),f(""),s(!1)):x.error(e.error||"Failed to send text message")}):x.error("Please select a company phone number to send from"):x.error("Please enter a message to send")},children:[(0,t.jsx)(O.Send,{className:"mr-2 size-4"}),0===l.length?"No Phone Numbers":"Send Message"]})]})]})})}var Q=e.i(821305),Z=e.i(278633),ee=e.i(307033);e.i(235670);var et=e.i(360648);e.i(670258);var es=e.i(921251);e.i(553153);var ea=e.i(363712);e.i(742854);var er=e.i(755297);e.i(51478);var ei=e.i(635613);e.i(220474);var en=e.i(171056);e.i(287133);var el=e.i(120109);e.i(789067);var eo=e.i(861308);e.i(6130);var ed=e.i(506806);e.i(711448);var ec=e.i(157222),em=e.i(933234);e.i(418488);var eu=e.i(592270),ex=e.i(539900),eh=e.i(830891),ep=e.i(152088),eg=(0,q.createServerReference)("40df181f2aa3e0769d3e7da5a87fb03c360b1659f1",q.callServer,void 0,q.findSourceMapURL,"getCustomerProperties"),ej=(0,q.createServerReference)("407903e35c92a73720ba1d8412141271ed3380a794",q.callServer,void 0,q.findSourceMapURL,"searchCustomersForJob"),ef=e.i(486506),ev=e.i(136764),eb=e.i(62538),eN=e.i(697029),ey=e.i(181893);e.i(686787);var ew=e.i(519539),eC=e.i(871509);function e_({job:e,customer:s,property:r,metrics:i,teamAssignments:n,timeEntries:o,invoices:c,payments:m,estimates:u,userRole:x="owner",onTitleChange:h,onSave:p,onCancel:g,isSaving:j=!1,hasChanges:f=!1}){var v;let[b,N]=(0,M.useState)([]);return(0,M.useEffect)(()=>{N(function(e){let{job:s,customer:r,metrics:i,teamAssignments:n,timeEntries:o,invoices:c,payments:m,estimates:u,userRole:x}=e,h=[],p=new Date,g=(i.totalAmount||0)-(i.paidAmount||0),j=s.scheduled_start?new Date(s.scheduled_start):null,f=j&&j<p&&"completed"!==s.status,v=c.filter(e=>{let t=e.due_date?new Date(e.due_date):null;return t&&t<p&&"paid"!==e.status});if(f&&0===n.length){let e=Math.floor((p.getTime()-j.getTime())/36e5);h.push({type:"critical",icon:(0,t.jsx)(a.AlertCircle,{className:"h-4 w-4"}),title:`Job Overdue by ${e} hours`,message:"dispatcher"===x?`This job was scheduled ${e}h ago but no technician is assigned. Dispatch protocol requires immediate assignment for jobs overdue by more than 2 hours.`:`This job is ${e} hours overdue. Company policy requires immediate action for jobs past their scheduled time. Contact dispatch or reassign technicians.`,action:{label:"Assign Technician",onClick:()=>{let e=document.querySelector('[data-section="team-assignments"]');e?.scrollIntoView({behavior:"smooth",block:"center"})}}})}if(v.length>0&&g>0){let e=v.reduce((e,t)=>new Date(t.due_date)<new Date(e.due_date)?t:e),s=Math.floor((p.getTime()-new Date(e.due_date).getTime())/864e5);s>=30?h.push({type:"critical",icon:(0,t.jsx)(d.DollarSign,{className:"h-4 w-4"}),title:`Outstanding Balance: ${(0,eC.formatCurrency)(g)} (${s} days overdue)`,message:"owner"===x||"manager"===x?`Company policy requires escalation for accounts 30+ days past due. The balance of ${(0,eC.formatCurrency)(g)} has been outstanding since ${new Date(e.due_date).toLocaleDateString()}. Consider collection agency referral or payment plan negotiation.`:`This account is ${s} days past due. Per company policy, accounts over 30 days require manager approval before scheduling additional work. Contact management before proceeding.`,action:{label:"View Invoices",onClick:()=>{let e=document.querySelector('[data-section="invoices"]');e?.scrollIntoView({behavior:"smooth",block:"center"})}}}):s>=15&&h.push({type:"warning",icon:(0,t.jsx)(ev.Clock,{className:"h-4 w-4"}),title:`Payment Overdue: ${(0,eC.formatCurrency)(g)} (${s} days)`,message:`Customer has an outstanding balance ${s} days past due. Company policy recommends friendly follow-up call at 15 days. Consider offering payment plan or checking if there are service quality concerns.`,action:{label:"Send Payment Reminder",onClick:()=>{}}})}let b=i.totalAmount||0;b>5e5&&0===u.length&&h.push({type:"warning",icon:(0,t.jsx)(eb.Lightbulb,{className:"h-4 w-4"}),title:"High-Value Job Without Approved Estimate",message:"technician"===x?"Company policy requires written estimates for jobs over $5,000 before work begins. Ensure you have customer approval documented before proceeding with any repairs or installations.":`This is a high-value job (potential revenue ${(0,eC.formatCurrency)(b)}) with no estimate on file. Best practice is to provide detailed written estimates for all jobs exceeding $5,000 to protect both the company and customer.`,action:{label:"Create Estimate",onClick:()=>{}}});let N=100*(r?.total_revenue||0);N>1e6&&h.push({type:"success",icon:(0,t.jsx)(eN.TrendingUp,{className:"h-4 w-4"}),title:`VIP Customer: ${(0,eC.formatCurrency)(N)} Lifetime Value`,message:`${r?.display_name||r?.first_name+" "+r?.last_name} is a high-value customer with ${(0,eC.formatCurrency)(N)} in total revenue. Prioritize excellent service and consider offering loyalty perks or discounts on future work.`,action:{label:"View Customer History",onClick:()=>{window.location.href=`/dashboard/customers/${r?.id}`}}});let y=o.find(e=>e.clock_in_time&&!e.clock_out_time);if(y){let e=new Date(y.clock_in_time),s=(p.getTime()-e.getTime())/36e5;h.push({type:"info",icon:(0,t.jsx)(ey.Zap,{className:"h-4 w-4"}),title:"Job In Progress",message:"technician"===x?`You've been clocked in for ${s.toFixed(1)} hours. Remember to clock out when complete and document all parts used and work performed.`:`Technician currently on-site and clocked in for ${s.toFixed(1)} hours. Real-time updates available in team tracking.`,action:{label:"View Time Entries",onClick:()=>{let e=document.querySelector('[data-section="time-entries"]');e?.scrollIntoView({behavior:"smooth",block:"center"})}}})}if(m.length>0){let e=m[0],s=new Date(e.payment_date||e.created_at),a=Math.floor((p.getTime()-s.getTime())/864e5);a<=7&&h.push({type:"success",icon:(0,t.jsx)(l.CheckCircle,{className:"h-4 w-4"}),title:"Recent Payment Received",message:`Customer paid ${(0,eC.formatCurrency)(e.amount)} ${0===a?"today":a+" days ago"}. Account is in good standing. Consider following up to ensure satisfaction and request a review.`,action:{label:"Send Review Request",onClick:()=>{}}})}return"dispatcher"===x&&0===n.length&&"scheduled"===s.status&&h.push({type:"warning",icon:(0,t.jsx)(ev.Clock,{className:"h-4 w-4"}),title:"Technician Assignment Required",message:"This job is scheduled but has no technician assigned. Dispatch protocol requires all scheduled jobs to have team assignments at least 24 hours in advance for route optimization.",action:{label:"Assign Team",onClick:()=>{let e=document.querySelector('[data-section="team-assignments"]');e?.scrollIntoView({behavior:"smooth",block:"center"})}}}),"technician"!==x||"in_progress"!==s.status||y||h.push({type:"warning",icon:(0,t.jsx)(ev.Clock,{className:"h-4 w-4"}),title:"Clock-In Reminder",message:"This job is marked as 'In Progress' but you haven't clocked in yet. Company policy requires accurate time tracking for all billable hours. Please clock in before starting work.",action:{label:"Clock In Now",onClick:()=>{}}}),h}({job:e,customer:s,property:r,metrics:i,teamAssignments:n,timeEntries:o,invoices:c,payments:m,estimates:u,userRole:x}))},[e.id,e.status,e.priority,s?.id,i.totalAmount,i.paidAmount,n.length,c.length,x]),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)(ei.Input,{className:"h-auto border-0 bg-transparent p-0 text-2xl font-bold tracking-tight shadow-none focus-visible:ring-0 md:text-3xl",onChange:e=>h(e.target.value),placeholder:"Enter job title...",value:e.title}),(0,t.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[(0,t.jsxs)(ea.Badge,{variant:"secondary",className:"font-mono text-xs",children:["#",e.job_number]}),(0,t.jsx)(ea.Badge,{variant:function(e){switch(e?.toLowerCase()){case"completed":case"paid":return"default";case"in_progress":case"scheduled":return"secondary";case"overdue":case"cancelled":case"urgent":return"destructive";default:return"outline"}}(e.status),className:"capitalize",children:e.status?.replace(/_/g," ")}),e.priority&&"low"!==e.priority&&(0,t.jsx)(ea.Badge,{variant:"urgent"===(v=e.priority)||"high"===v?"destructive":"outline",className:"capitalize",children:e.priority})]})]}),f&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(V.Button,{variant:"outline",size:"sm",onClick:g,children:"Cancel"}),(0,t.jsx)(V.Button,{size:"sm",onClick:p,disabled:j,children:j?"Saving...":"Save Changes"})]})]}),b.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(el.Separator,{}),(0,t.jsx)("div",{className:"space-y-2",children:b.map((e,s)=>(0,t.jsx)(ek,{insight:e},s))})]})]})}function ek({insight:e}){return(0,t.jsx)(ew.Alert,{variant:"critical"===e.type?"destructive":"default",className:"relative",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:`mt-0.5 shrink-0 ${(e=>{switch(e){case"critical":return"text-destructive";case"warning":return"text-yellow-600 dark:text-yellow-400";case"success":return"text-green-600 dark:text-green-400";default:return"text-blue-600 dark:text-blue-400"}})(e.type)}`,children:e.icon}),(0,t.jsxs)("div",{className:"flex-1 min-w-0 space-y-1",children:[(0,t.jsx)("div",{className:"font-semibold text-sm leading-tight",children:e.title}),(0,t.jsx)(ew.AlertDescription,{className:"text-xs leading-relaxed",children:e.message}),e.action&&(0,t.jsxs)(V.Button,{variant:"link",size:"sm",className:"h-auto p-0 text-xs gap-1",onClick:e.action.onClick,children:[e.action.label,(0,t.jsx)(ef.ArrowRight,{className:"h-3 w-3"})]})]})]})})}var eS=e.i(79254),eD=e.i(212409),eT=e.i(823167),ez=(0,q.createServerReference)("40e9803ebaeabdd8b04052b6c8ee82a0faeea4b5e9",q.callServer,void 0,q.findSourceMapURL,"uploadDocument");let eA={"image/jpeg":[".jpg",".jpeg"],"image/png":[".png"],"image/heic":[".heic"],"image/heif":[".heif"],"image/webp":[".webp"],"image/gif":[".gif"],"image/bmp":[".bmp"],"image/tiff":[".tiff",".tif"],"application/pdf":[".pdf"],"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"application/vnd.ms-excel":[".xls"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"text/plain":[".txt"],"text/csv":[".csv"]};function eF({jobId:e,companyId:s,onUploadComplete:a,onCancel:r}){let{toast:i}=(0,K.useToast)(),[l,o]=(0,M.useState)([]),[d,c]=(0,M.useState)(!1),[m,x]=(0,M.useState)(0),h=()=>Math.random().toString(36).substring(2,15),p=e=>e.startsWith("image/"),g=e=>{let t=e.type;return Object.keys(eA).includes(t)?e.size>0x6400000?`${e.name}: Too large (max 100MB)`:null:`${e.name}: Unsupported file type`},j=(0,M.useCallback)(e=>{if(!e)return;let t=[],s=[];Array.from(e).forEach(e=>{let a=g(e);if(a)return void s.push(a);let r=URL.createObjectURL(e),i=!p(e.type);t.push({id:h(),file:e,preview:r,category:"other",caption:"",isDocument:i})}),s.length>0&&i.error(`Some files couldn't be added: ${s.join(", ")}`),o(e=>[...e,...t])},[i,h,p,g]),f=e=>{o(t=>{let s=t.find(t=>t.id===e);return s&&URL.revokeObjectURL(s.preview),t.filter(t=>t.id!==e)})},v=async()=>{if(0!==l.length){c(!0),x(0);try{let t=0,n=0;for(let a=0;a<l.length;a++){let r=l[a];try{let a=new FormData;a.append("file",r.file),a.append("companyId",s),a.append("contextType","job"),a.append("contextId",e),r.isDocument?a.append("folder","documents"):a.append("folder","photos"),r.caption&&a.append("description",r.caption),r.category&&a.append("tags",JSON.stringify([r.category]));let l=await ez(a);if(l?.success)t++;else{n++;let e=l?.error||"Unknown error";e.includes("Access denied")?i.error(`Access denied for ${r.file.name}. Please verify you have permission to upload files to this job.`):e.includes("Storage upload failed")?i.error(`Storage error for ${r.file.name}. The file may be too large or the storage service is unavailable.`):i.error(`Failed to upload ${r.file.name}: ${e}`)}}catch(t){n++;let e=t instanceof Error?t.message:String(t);e.includes("unexpected response")?i.error(`Server error uploading ${r.file.name}. Please try again or contact support if the problem persists.`):i.error(`Error uploading ${r.file.name}: ${e}`)}x(Math.round((a+1)/l.length*100))}t>0&&i.success(`Successfully uploaded ${t} ${1===t?"file":"files"}${n>0?` (${n} failed)`:""}`),n>0&&0===t&&i.error("All uploads failed. Please check your permissions and try again."),l.forEach(e=>URL.revokeObjectURL(e.preview)),o([]),a&&a(),r&&setTimeout(()=>r(),100)}catch(t){let e=t instanceof Error?t.message:"Failed to upload files";i.error(e)}finally{c(!1),x(0)}}};return(0,t.jsxs)("div",{className:"bg-muted/30 space-y-3 rounded-lg border p-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{accept:Object.values(eA).flat().join(","),className:"absolute inset-0 cursor-pointer opacity-0",id:"inline-file-upload",multiple:!0,onChange:e=>{j(e.target.files),e.target.value=""},type:"file"}),(0,t.jsxs)("div",{className:"border-muted-foreground/25 bg-background hover:border-muted-foreground/50 flex items-center gap-3 rounded-md border-2 border-dashed p-3",children:[(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)("div",{className:"bg-primary/10 flex size-8 items-center justify-center rounded",children:(0,t.jsx)(n.Camera,{className:"text-primary size-4"})}),(0,t.jsx)("div",{className:"bg-primary/10 flex size-8 items-center justify-center rounded",children:(0,t.jsx)(u.FileText,{className:"text-primary size-4"})})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Click or drag files here"}),(0,t.jsx)("p",{className:"text-muted-foreground text-xs",children:"Images & documents up to 100MB"})]}),(0,t.jsx)(S.Upload,{className:"text-muted-foreground size-5"})]})]}),l.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-sm font-medium",children:[l.length," file",1!==l.length?"s":""," selected"]}),(0,t.jsx)(V.Button,{onClick:()=>l.forEach(e=>f(e.id)),size:"sm",variant:"ghost",children:"Clear all"})]}),(0,t.jsx)("div",{className:"grid gap-2",children:l.map(e=>{var s;return(0,t.jsxs)("div",{className:"bg-background flex items-center gap-3 rounded-md border p-2",children:[(0,t.jsx)("div",{className:"bg-muted relative size-12 shrink-0 overflow-hidden rounded",children:e.isDocument?(0,t.jsx)("div",{className:"flex size-full items-center justify-center",children:(0,t.jsx)(u.FileText,{className:"text-muted-foreground size-6"})}):(0,t.jsx)(eT.default,{alt:e.file.name,className:"object-cover",fill:!0,src:e.preview})}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 items-center gap-2",children:[(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"truncate text-sm font-medium",children:e.file.name}),(0,t.jsx)("p",{className:"text-muted-foreground text-xs",children:(s=e.file.size)<1024?`${s} B`:s<1048576?`${(s/1024).toFixed(1)} KB`:`${(s/1048576).toFixed(1)} MB`})]}),(0,t.jsxs)(W.Select,{onValueChange:t=>{var s;return s=e.id,void o(e=>e.map(e=>e.id===s?{...e,category:t}:e))},value:e.category,children:[(0,t.jsx)(W.SelectTrigger,{className:"h-7 w-24 text-xs",children:(0,t.jsx)(W.SelectValue,{})}),(0,t.jsxs)(W.SelectContent,{children:[(0,t.jsx)(W.SelectItem,{value:"before",children:"Before"}),(0,t.jsx)(W.SelectItem,{value:"during",children:"During"}),(0,t.jsx)(W.SelectItem,{value:"after",children:"After"}),(0,t.jsx)(W.SelectItem,{value:"other",children:"Other"})]})]}),(0,t.jsx)(ei.Input,{className:"h-7 w-32 text-xs",onChange:t=>{var s,a;return s=e.id,a=t.target.value,void o(e=>e.map(e=>e.id===s?{...e,caption:a}:e))},placeholder:"Caption",value:e.caption}),(0,t.jsx)(V.Button,{className:"size-7 p-0",onClick:()=>f(e.id),size:"sm",variant:"ghost",children:(0,t.jsx)(eD.X,{className:"size-4"})})]})]},e.id)})}),d&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Uploading..."}),(0,t.jsxs)("span",{className:"font-medium",children:[m,"%"]})]}),(0,t.jsx)("div",{className:"bg-muted h-1.5 overflow-hidden rounded-full",children:(0,t.jsx)("div",{className:"bg-primary h-full transition-all duration-300",style:{width:`${m}%`}})})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(V.Button,{disabled:d,onClick:r,size:"sm",variant:"outline",children:"Cancel"}),(0,t.jsx)(V.Button,{disabled:0===l.length||d,onClick:v,size:"sm",children:d?(0,t.jsx)(t.Fragment,{children:"Uploading..."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eS.Check,{className:"mr-1 size-4"}),"Upload ",l.length," ",1===l.length?"File":"Files"]})})]})]})]})}var eM=e.i(367571),eP=e.i(287268);function eI({activities:e}){let[a,r]=(0,M.useState)(""),[i,n]=(0,M.useState)(1),l=(0,M.useMemo)(()=>{let t=[...e];if(a.trim()){let e=a.toLowerCase();t=t.filter(t=>t.description?.toLowerCase().includes(e)||t.activity_type?.toLowerCase().includes(e)||t.entity_type?.toLowerCase().includes(e)||t.metadata?.estimate_number?.toLowerCase().includes(e)||t.metadata?.invoice_number?.toLowerCase().includes(e))}return t.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),t},[e,a]),d=(0,M.useMemo)(()=>{let e=(i-1)*10;return l.slice(e,e+10)},[l,i]),c=Math.ceil(l.length/10);return(0,t.jsxs)("div",{children:[e.length>5&&(0,t.jsx)("div",{className:"border-b p-3",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(eP.Search,{className:"text-muted-foreground absolute top-1/2 left-3 size-4 -translate-y-1/2"}),(0,t.jsx)(ei.Input,{className:"pl-9",onChange:e=>{r(e.target.value),n(1)},placeholder:"Search activities...",value:a})]})}),(0,t.jsx)("div",{className:"divide-y",children:d.length>0?d.map(e=>{let a=Array.isArray(e.user)?e.user[0]:e.user,r=a?{name:a.raw_user_meta_data?.name||a.name||"Unknown User",email:a.raw_user_meta_data?.email||a.email,avatar:a.raw_user_meta_data?.avatar_url||a.avatar}:null,i=e.activity_type||"general",n=e.entity_type,l=e.metadata||{},d={created:{icon:(0,t.jsx)(C.Sparkles,{className:"size-3"}),iconColor:"text-emerald-600 dark:text-emerald-400",borderColor:"border-l-emerald-500",label:"Created"},sent:{icon:(0,t.jsx)(p.Mail,{className:"size-3"}),iconColor:"text-blue-600 dark:text-blue-400",borderColor:"border-l-blue-500",label:"Sent"},viewed:{icon:(0,t.jsx)(eM.Eye,{className:"size-3"}),iconColor:"text-purple-600 dark:text-purple-400",borderColor:"border-l-purple-500",label:"Viewed"},status_changed:{icon:(0,t.jsx)(s.Activity,{className:"size-3"}),iconColor:"text-orange-600 dark:text-orange-400",borderColor:"border-l-orange-500",label:"Status Changed"},note_added:{icon:(0,t.jsx)(j.MessageSquare,{className:"size-3"}),iconColor:"text-cyan-600 dark:text-cyan-400",borderColor:"border-l-cyan-500",label:"Note Added"},assigned:{icon:(0,t.jsx)(D.User,{className:"size-3"}),iconColor:"text-indigo-600 dark:text-indigo-400",borderColor:"border-l-indigo-500",label:"Assigned"}}[i]||{icon:(0,t.jsx)(s.Activity,{className:"size-3"}),iconColor:"text-gray-600 dark:text-gray-400",borderColor:"border-l-gray-500",label:i.replace(/_/g," ")};return(0,t.jsxs)("div",{className:(0,ep.cn)("hover:bg-muted/30 flex gap-3 border-l-2 px-4 py-2.5 transition-colors",d.borderColor),children:[(0,t.jsx)("div",{className:(0,ep.cn)("bg-muted flex size-7 shrink-0 items-center justify-center rounded-full",d.iconColor),children:d.icon}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col gap-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,t.jsx)(ea.Badge,{className:"text-xs",variant:"outline",children:d.label}),n&&(0,t.jsx)(ea.Badge,{className:"text-xs",variant:"secondary",children:n}),l.estimate_number&&(0,t.jsx)(ea.Badge,{className:"font-mono text-xs",variant:"outline",children:l.estimate_number}),l.invoice_number&&(0,t.jsx)(ea.Badge,{className:"font-mono text-xs",variant:"outline",children:l.invoice_number}),r?.name&&(0,t.jsxs)("div",{className:"text-muted-foreground flex items-center gap-1 text-xs",children:[(0,t.jsxs)(es.Avatar,{className:"size-4",children:[(0,t.jsx)(es.AvatarImage,{src:r.avatar}),(0,t.jsx)(es.AvatarFallback,{className:"text-[8px]",children:r.name.substring(0,2).toUpperCase()})]}),(0,t.jsx)("span",{children:r.name})]})]}),(0,t.jsx)("time",{className:"text-muted-foreground shrink-0 text-xs",children:new Date(e.created_at).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})]}),(0,t.jsx)("p",{className:"text-sm leading-snug",children:e.description||"Activity logged"}),(l.amount||l.old_status||l.email||l.method)&&(0,t.jsxs)("div",{className:"text-muted-foreground flex flex-wrap gap-3 text-xs",children:[l.amount&&(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(N.Receipt,{className:"size-3"}),"$",(l.amount/100).toFixed(2)]}),l.old_status&&l.new_status&&(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(o.ChevronRight,{className:"size-3"}),l.old_status," → ",l.new_status]}),l.email&&(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(p.Mail,{className:"size-3"}),l.email]}),l.method&&(0,t.jsxs)("span",{className:"flex items-center gap-1",children:["via ",l.method]})]})]})]},e.id)}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,t.jsx)("div",{className:"bg-muted mx-auto mb-4 flex size-12 items-center justify-center rounded-full",children:(0,t.jsx)(s.Activity,{className:"text-muted-foreground size-6"})}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:a?"No activities match your search":"No activity yet"})]})}),c>1&&(0,t.jsxs)("div",{className:"flex items-center justify-between border-t px-4 py-3",children:[(0,t.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Showing ",(i-1)*10+1,"-",Math.min(10*i,l.length)," ","of ",l.length," activities"]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(V.Button,{disabled:1===i,onClick:()=>n(e=>Math.max(1,e-1)),size:"sm",variant:"outline",children:"Previous"}),(0,t.jsx)(V.Button,{disabled:i===c,onClick:()=>n(e=>Math.min(c,e+1)),size:"sm",variant:"outline",children:"Next"})]})]})]})}var eL=e.i(148347);e.i(116233);var eB=e.i(85086);function e$({appointment:e,showExpanded:s=!1}){let a=new Date(e.start_time),r=new Date(e.end_time),i=e=>e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),n=Array.isArray(e.assigned_user)?e.assigned_user[0]:e.assigned_user,l=e.team_members&&e.team_members.length>0,o=e.equipment&&e.equipment.length>0,d=e.notes||e.access_instructions,c=e.actual_start_time||e.actual_end_time,m=l||o||d||c;return(0,t.jsx)(eB.ExpandableRow,{defaultExpanded:s,details:m?(0,t.jsxs)("div",{className:"divide-y",children:[l&&(0,t.jsx)(eB.ExpandableRowSection,{icon:(0,t.jsx)(T.Users,{className:"size-4"}),title:"Team Members",children:(0,t.jsx)("div",{className:"space-y-2",children:e.team_members?.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3 rounded-md border p-2",children:[(0,t.jsxs)(es.Avatar,{className:"size-8",children:[(0,t.jsx)(es.AvatarImage,{src:e.avatar}),(0,t.jsx)(es.AvatarFallback,{className:"text-xs",children:e.name.substring(0,2).toUpperCase()})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"text-foreground text-sm font-medium",children:e.name}),e.role&&(0,t.jsx)("div",{className:"text-muted-foreground text-xs",children:e.role})]}),e.email&&(0,t.jsx)(A.default,{className:"text-primary text-xs hover:underline",href:`mailto:${e.email}`,children:e.email})]},e.id))})}),o&&(0,t.jsx)(eB.ExpandableRowSection,{icon:(0,t.jsx)(z.Wrench,{className:"size-4"}),title:"Equipment",children:(0,t.jsx)("div",{className:"space-y-2",children:e.equipment?.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between rounded-md border p-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(z.Wrench,{className:"text-muted-foreground size-4"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-foreground text-sm font-medium",children:e.name}),e.serial_number&&(0,t.jsxs)("div",{className:"text-muted-foreground font-mono text-xs",children:["SN: ",e.serial_number]})]})]}),e.type&&(0,t.jsx)(ea.Badge,{variant:"outline",children:e.type})]},e.id))})}),c&&(0,t.jsx)(eB.ExpandableRowSection,{icon:(0,t.jsx)(ev.Clock,{className:"size-4"}),title:"Time Tracking",children:(0,t.jsxs)("div",{className:"grid gap-2 text-sm sm:grid-cols-2",children:[e.actual_start_time&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Actual Start:"})," ",(0,t.jsx)("span",{className:"font-medium",children:new Date(e.actual_start_time).toLocaleString()})]}),e.actual_end_time&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Actual End:"})," ",(0,t.jsx)("span",{className:"font-medium",children:new Date(e.actual_end_time).toLocaleString()})]}),e.actual_duration&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Actual Duration:"})," ",(0,t.jsxs)("span",{className:"font-medium",children:[e.actual_duration," min"]})]}),e.duration&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Estimated Duration:"})," ",(0,t.jsxs)("span",{className:"font-medium",children:[e.duration," min"]})]})]})}),d&&(0,t.jsxs)(eB.ExpandableRowSection,{icon:(0,t.jsx)(u.FileText,{className:"size-4"}),title:"Notes & Instructions",children:[e.access_instructions&&(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsxs)("div",{className:"mb-1 flex items-center gap-2 text-xs font-medium",children:[(0,t.jsx)(g.MapPin,{className:"size-3"}),"Access Instructions"]}),(0,t.jsx)("p",{className:"bg-muted/50 rounded-md border p-2 text-xs whitespace-pre-wrap",children:e.access_instructions})]}),e.notes&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mb-1 text-xs font-medium",children:"Internal Notes"}),(0,t.jsx)("p",{className:"bg-muted/50 rounded-md border p-2 text-xs whitespace-pre-wrap",children:e.notes})]})]})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,t.jsx)(u.FileText,{className:"text-muted-foreground mb-2 size-8"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"No additional details available"})]}),disabled:!m,showIndicator:m,summary:(0,t.jsxs)("div",{className:"flex flex-1 items-center gap-4 py-3 pr-4",children:[(0,t.jsxs)("div",{className:"flex w-32 shrink-0 flex-col",children:[(0,t.jsx)("div",{className:"text-sm font-medium",children:a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),(0,t.jsxs)("div",{className:"text-muted-foreground text-xs",children:[i(a)," - ",i(r)]})]}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,t.jsx)("div",{className:"truncate text-sm font-medium",children:e.title||"Untitled Appointment"}),e.type&&(0,t.jsx)("div",{className:"text-muted-foreground truncate text-xs",children:e.type})]}),n&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(es.Avatar,{className:"size-6",children:[(0,t.jsx)(es.AvatarImage,{src:n.avatar}),(0,t.jsx)(es.AvatarFallback,{className:"text-[10px]",children:n.name.substring(0,2).toUpperCase()})]}),(0,t.jsx)("span",{className:"text-muted-foreground hidden text-xs sm:inline",children:n.name})]}),e.status&&(0,t.jsx)(ea.Badge,{className:(0,ep.cn)("h-6 shrink-0 rounded-full px-3 text-xs capitalize",(e=>{switch(e?.toLowerCase()){case"completed":return"bg-green-500/10 text-green-700 dark:text-green-400";case"in_progress":return"bg-blue-500/10 text-blue-700 dark:text-blue-400";case"scheduled":return"bg-purple-500/10 text-purple-700 dark:text-purple-400";case"cancelled":return"bg-red-500/10 text-red-700 dark:text-red-400";default:return"bg-gray-500/10 text-gray-700 dark:text-gray-400"}})(e.status)),variant:"secondary",children:e.status.replace(/_/g," ")}),m&&(0,t.jsxs)("div",{className:"text-muted-foreground flex shrink-0 items-center gap-1 text-xs",children:[l&&(0,t.jsxs)(ea.Badge,{className:"h-5 px-1.5",variant:"outline",children:[(0,t.jsx)(T.Users,{className:"mr-1 size-3"}),e.team_members?.length]}),o&&(0,t.jsxs)(ea.Badge,{className:"h-5 px-1.5",variant:"outline",children:[(0,t.jsx)(z.Wrench,{className:"mr-1 size-3"}),e.equipment?.length]})]})]})})}function eq({appointments:e}){let[s,a]=(0,M.useState)(""),[r,n]=(0,M.useState)("all"),l=(0,M.useMemo)(()=>Array.from(new Set(e.map(e=>e.status).filter(Boolean))),[e]),o=(0,M.useMemo)(()=>{let t=e;if(s.trim()){let e=s.toLowerCase();t=t.filter(t=>{let s=Array.isArray(t.assigned_user)?t.assigned_user[0]:t.assigned_user;return t.title?.toLowerCase().includes(e)||t.type?.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e)||s?.name.toLowerCase().includes(e)})}return"all"!==r&&(t=t.filter(e=>e.status===r)),t.sort((e,t)=>new Date(t.start_time).getTime()-new Date(e.start_time).getTime()),t},[e,s,r]);return(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("div",{className:"bg-background sticky top-0 z-10 flex flex-wrap items-center gap-2 border-b p-3",children:[(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(eP.Search,{className:"text-muted-foreground absolute top-1/2 left-3 size-4 -translate-y-1/2"}),(0,t.jsx)(ei.Input,{className:"h-9 pl-9",onChange:e=>a(e.target.value),placeholder:"Search appointments...",value:s})]}),(0,t.jsxs)(W.Select,{onValueChange:n,value:r,children:[(0,t.jsxs)(W.SelectTrigger,{className:"h-9 w-[160px]",children:[(0,t.jsx)(eL.Filter,{className:"mr-2 size-4"}),(0,t.jsx)(W.SelectValue,{placeholder:"All Statuses"})]}),(0,t.jsxs)(W.SelectContent,{children:[(0,t.jsx)(W.SelectItem,{value:"all",children:"All Statuses"}),l.map(e=>(0,t.jsx)(W.SelectItem,{value:e||"",children:e?.replace(/_/g," ")},e))]})]}),(0,t.jsxs)(ea.Badge,{className:"h-9 px-3",variant:"outline",children:[o.length," of ",e.length]})]}),(0,t.jsx)("div",{className:"divide-y",children:o.length>0?o.map(e=>(0,t.jsx)(e$,{appointment:e},e.id)):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,t.jsx)(i.Calendar,{className:"text-muted-foreground mb-3 size-12"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:s||"all"!==r?"No appointments match your filters":"No appointments scheduled"}),(s||"all"!==r)&&(0,t.jsx)(V.Button,{className:"mt-3",onClick:()=>{a(""),n("all")},size:"sm",variant:"outline",children:"Clear Filters"})]})})]})}var eU=e.i(390929),eE=e.i(96881),eE=eE;e.i(244242);var eR=e.i(563078);function eO({currentCustomer:e,currentProperty:s,onAssignCustomer:a,onRemoveCustomer:r,onRemoveProperty:i,searchCustomers:n,getCustomerProperties:l}){let[d,c]=(0,M.useState)(!1),[m,u]=(0,M.useState)(""),[x,h]=(0,M.useState)(!1),[p,j]=(0,M.useState)([]),[f,v]=(0,M.useState)(null),[b,N]=(0,M.useState)([]),[y,w]=(0,M.useState)(null),[C,_]=(0,M.useState)(!1),[k,S]=(0,M.useState)(!1),[T,z]=(0,M.useState)(!1),[F,P]=(0,M.useState)(!1);(0,M.useEffect)(()=>{if(!m||m.length<2)return void j([]);let e=setTimeout(async()=>{h(!0);try{let e=await n(m);j(e)}catch(e){console.error("Error searching customers:",e),j([])}finally{h(!1)}},300);return()=>clearTimeout(e)},[m,n]),(0,M.useEffect)(()=>{if(!f){N([]),w(null);return}!async function(){_(!0);try{let e=await l(f.id);N(e),1===e.length&&w(e[0])}catch(e){console.error("Error loading properties:",e),N([])}finally{_(!1)}}()},[f,l]);let I=e=>e.company_name?`${e.display_name} (${e.company_name})`:e.display_name,L=async()=>{if(f){P(!0);try{await a(f,y),c(!1),v(null),w(null),u("")}catch(e){console.error("Error assigning customer:",e)}finally{P(!1)}}},B=async()=>{try{await r(),S(!1)}catch(e){console.error("Error removing customer:",e)}},$=async()=>{try{await i(),z(!1)}catch(e){console.error("Error removing property:",e)}},q=(0,t.jsxs)(en.Popover,{onOpenChange:c,open:d,children:[(0,t.jsx)(en.PopoverTrigger,{asChild:!0,children:(0,t.jsx)(V.Button,{className:(0,ep.cn)("justify-start transition-all",e?"px-3":"w-full"),size:e?"sm":"default",variant:e?"ghost":"outline",children:e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(D.User,{className:"mr-2 size-4"}),(0,t.jsx)("span",{children:"Change"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(D.User,{className:"text-muted-foreground mr-2 size-4"}),(0,t.jsx)("span",{children:"Assign Customer & Property"}),(0,t.jsx)(eU.ChevronsUpDown,{className:"ml-auto size-4 opacity-50"})]})})}),(0,t.jsx)(en.PopoverContent,{align:"start",className:"w-[650px] p-0 shadow-xl",children:(0,t.jsxs)("div",{className:"flex h-[550px] flex-col",children:[(0,t.jsxs)("div",{className:"bg-muted/30 border-b p-4",children:[(0,t.jsx)("h3",{className:"mb-3 text-base font-semibold",children:"Assign Customer & Property"}),(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsxs)("div",{className:"text-muted-foreground flex items-center gap-2 text-xs",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"bg-primary/20 text-primary flex size-5 items-center justify-center rounded-full text-[10px] font-bold",children:"1"}),(0,t.jsx)("span",{className:(0,ep.cn)(f?"text-primary font-medium":""),children:"Select Customer"})]}),(0,t.jsx)(o.ChevronRight,{className:"size-3"}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:(0,ep.cn)("flex size-5 items-center justify-center rounded-full text-[10px] font-bold",f?"bg-primary/20 text-primary":"bg-muted text-muted-foreground"),children:"2"}),(0,t.jsx)("span",{className:(0,ep.cn)(f?"text-primary font-medium":"text-muted-foreground"),children:"Choose Property"})]})]})})]}),(0,t.jsx)("div",{className:"bg-background border-b p-4",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(eP.Search,{className:"text-muted-foreground absolute top-1/2 left-3 size-4 -translate-y-1/2"}),(0,t.jsx)("input",{className:"border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-11 w-full rounded-lg border px-10 py-2 text-sm transition-shadow file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",onChange:e=>u(e.target.value),placeholder:"Search by name, email, phone, company, or address...",value:m}),x&&(0,t.jsx)("div",{className:"absolute top-1/2 right-3 -translate-y-1/2",children:(0,t.jsx)("div",{className:"border-primary/30 border-t-primary size-4 animate-spin rounded-full border-2"})})]})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:f?(0,t.jsx)("div",{className:"bg-primary/5 border-b p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsxs)("div",{className:"bg-primary/20 text-primary flex size-10 flex-shrink-0 items-center justify-center rounded-full text-sm font-bold",children:[f.first_name?.[0],f.last_name?.[0]]}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"mb-1 flex items-center gap-2",children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:I(f)}),(0,t.jsx)(eS.Check,{className:"text-primary size-4 flex-shrink-0"})]}),(0,t.jsxs)("div",{className:"text-muted-foreground space-y-0.5 text-xs",children:[f.email&&(0,t.jsx)("div",{className:"truncate",children:f.email}),f.phone&&(0,t.jsx)("div",{children:f.phone})]})]}),(0,t.jsx)(V.Button,{onClick:()=>v(null),size:"sm",variant:"ghost",children:"Change"})]})}):m.length<2?(0,t.jsxs)("div",{className:"flex h-full flex-col items-center justify-center p-8 text-center",children:[(0,t.jsx)(eP.Search,{className:"text-muted-foreground mb-3 size-10"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"Type at least 2 characters to search"})]}):0!==p.length||x?(0,t.jsx)("div",{className:"divide-y",children:p.map(e=>(0,t.jsxs)("button",{className:"hover:bg-muted/50 flex w-full items-start gap-3 p-4 text-left transition-all hover:shadow-sm",onClick:()=>{v(e),u("")},type:"button",children:[(0,t.jsxs)("div",{className:"bg-muted/80 flex size-10 flex-shrink-0 items-center justify-center rounded-full text-sm font-semibold",children:[e.first_name?.[0],e.last_name?.[0]]}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"mb-1 flex items-center gap-2",children:[(0,t.jsx)("div",{className:"truncate text-sm font-medium",children:I(e)}),(0,t.jsx)(ea.Badge,{className:"flex-shrink-0 capitalize",variant:"outline",children:e.type})]}),(0,t.jsxs)("div",{className:"text-muted-foreground space-y-0.5 text-xs",children:[e.email&&(0,t.jsx)("div",{className:"truncate",children:e.email}),e.phone&&(0,t.jsx)("div",{children:e.phone}),e.address&&(0,t.jsxs)("div",{className:"truncate text-[11px]",children:[e.address,", ",e.city,","," ",e.state]})]})]}),(0,t.jsx)(o.ChevronRight,{className:"text-muted-foreground mt-2 size-4 flex-shrink-0"})]},e.id))}):(0,t.jsxs)("div",{className:"flex h-full flex-col items-center justify-center p-8 text-center",children:[(0,t.jsx)(D.User,{className:"text-muted-foreground mb-3 size-10"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"No customers found"})]})}),f&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"bg-muted/30 border-t p-4",children:(0,t.jsx)("div",{className:"space-y-3",children:C?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(eo.Skeleton,{className:"h-16 w-full"}),(0,t.jsx)(eo.Skeleton,{className:"h-16 w-full"})]}):0===b.length?(0,t.jsxs)("div",{className:"bg-background rounded-lg border border-dashed p-6 text-center",children:[(0,t.jsx)(g.MapPin,{className:"text-muted-foreground mx-auto mb-2 size-10"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-1 text-sm font-medium",children:"No properties found"}),(0,t.jsx)("p",{className:"text-muted-foreground text-xs",children:"You can still assign this customer without a property"})]}):(0,t.jsxs)("div",{className:"max-h-[180px] space-y-2 overflow-y-auto pr-1",children:[(0,t.jsx)("p",{className:"text-muted-foreground mb-2 text-xs font-medium",children:"Select a property (optional)"}),b.map(e=>(0,t.jsxs)("button",{className:(0,ep.cn)("hover:bg-muted/80 flex w-full items-start gap-3 rounded-lg border p-3 text-left transition-all",y?.id===e.id&&"border-primary bg-primary/10 shadow-sm"),onClick:()=>w(e),type:"button",children:[(0,t.jsx)(g.MapPin,{className:(0,ep.cn)("mt-0.5 size-4 flex-shrink-0",y?.id===e.id?"text-primary":"text-muted-foreground")}),(0,t.jsxs)("div",{className:"min-w-0 flex-1 text-sm",children:[(0,t.jsx)("div",{className:"truncate font-medium",children:e.address}),e.address_line2&&(0,t.jsx)("div",{className:"text-muted-foreground truncate text-xs",children:e.address_line2}),(0,t.jsxs)("div",{className:"text-muted-foreground truncate text-xs",children:[e.city,", ",e.state," ",e.zip]})]}),y?.id===e.id&&(0,t.jsx)(eS.Check,{className:"text-primary size-4 flex-shrink-0"})]},e.id))]})})}),(0,t.jsx)("div",{className:"bg-background border-t p-4",children:(0,t.jsx)(V.Button,{className:"h-11 w-full text-base font-medium shadow-sm",disabled:F,onClick:L,size:"lg",children:F?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mr-2 size-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"Assigning..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eS.Check,{className:"mr-2 size-5"}),"Assign to Job"]})})})]})]})})]});return(0,t.jsxs)("div",{className:"flex w-full gap-2",children:[e?(0,t.jsxs)("div",{className:"flex flex-1 gap-0",children:[(0,t.jsxs)(eR.DropdownMenu,{children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(V.Button,{className:"flex-1 justify-start rounded-r-none border-r-0",size:"default",variant:"outline",children:[(0,t.jsx)(D.User,{className:"mr-2 size-4"}),(0,t.jsx)("span",{className:"truncate font-medium",children:I(e)}),(0,t.jsx)(o.ChevronRight,{className:"ml-auto size-4 opacity-50"})]})}),(0,t.jsxs)(eR.DropdownMenuContent,{align:"start",className:"w-64",children:[(0,t.jsx)(eR.DropdownMenuLabel,{className:"font-normal",children:(0,t.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium leading-none",children:I(e)}),e.type&&(0,t.jsx)(ea.Badge,{className:"mt-1 w-fit capitalize",variant:"secondary",size:"sm",children:e.type}),e.email&&(0,t.jsx)("p",{className:"text-muted-foreground text-xs",children:e.email}),e.phone&&(0,t.jsx)("p",{className:"text-muted-foreground text-xs",children:e.phone})]})}),s&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsx)(eR.DropdownMenuLabel,{className:"font-normal",children:(0,t.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-muted-foreground",children:"Property"}),(0,t.jsx)("p",{className:"text-sm font-medium leading-none",children:s.address}),(0,t.jsxs)("p",{className:"text-muted-foreground text-xs",children:[s.city,", ",s.state," ",s.zip]})]})})]}),(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsx)(eR.DropdownMenuItem,{asChild:!0,children:(0,t.jsxs)(A.default,{href:`/dashboard/customers/${e.id}`,className:"cursor-pointer",children:[(0,t.jsx)(eM.Eye,{className:"mr-2 size-4"}),"View Customer Profile"]})}),s&&(0,t.jsx)(eR.DropdownMenuItem,{asChild:!0,children:(0,t.jsxs)(A.default,{href:`/dashboard/work/properties/${s.id}`,className:"cursor-pointer",children:[(0,t.jsx)(g.MapPin,{className:"mr-2 size-4"}),"View Property Details"]})}),(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsxs)(eR.DropdownMenuItem,{onSelect:e=>{e.preventDefault(),c(!0)},children:[(0,t.jsx)(eU.ChevronsUpDown,{className:"mr-2 size-4"}),"Change Customer/Property"]}),s&&(0,t.jsxs)(eR.DropdownMenuItem,{onSelect:e=>{e.preventDefault(),z(!0)},children:[(0,t.jsx)(eE.default,{className:"mr-2 size-4"}),"Unlink Property"]}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"text-destructive focus:text-destructive",onSelect:e=>{e.preventDefault(),S(!0)},children:[(0,t.jsx)(eE.default,{className:"mr-2 size-4"}),"Unlink Customer"]})]})]}),(0,t.jsx)(V.Button,{className:"rounded-l-none px-3",size:"default",variant:"outline",onClick:()=>S(!0),children:(0,t.jsx)(eE.default,{className:"size-4 text-destructive"})})]}):q,(0,t.jsx)(et.AlertDialog,{onOpenChange:S,open:k,children:(0,t.jsxs)(et.AlertDialogContent,{children:[(0,t.jsxs)(et.AlertDialogHeader,{children:[(0,t.jsx)(et.AlertDialogTitle,{children:"Unlink Customer?"}),(0,t.jsxs)(et.AlertDialogDescription,{children:["Are you sure you want to unlink"," ",(0,t.jsx)("strong",{children:e?.display_name})," from this job?",(0,t.jsx)("br",{}),(0,t.jsx)("br",{}),"This will also unlink any associated property. The customer and property records will remain in your system, but this job will no longer be associated with them."]})]}),(0,t.jsxs)(et.AlertDialogFooter,{children:[(0,t.jsx)(et.AlertDialogCancel,{children:"Cancel"}),(0,t.jsxs)(et.AlertDialogAction,{onClick:B,children:[(0,t.jsx)(eE.default,{className:"mr-2 size-4"}),"Unlink Customer"]})]})]})}),(0,t.jsx)(et.AlertDialog,{onOpenChange:z,open:T,children:(0,t.jsxs)(et.AlertDialogContent,{children:[(0,t.jsxs)(et.AlertDialogHeader,{children:[(0,t.jsx)(et.AlertDialogTitle,{children:"Unlink Property?"}),(0,t.jsxs)(et.AlertDialogDescription,{children:["This will unlink ",(0,t.jsx)("strong",{children:s?.address})," from this job. The customer will remain assigned. The property record will remain in your system."]})]}),(0,t.jsxs)(et.AlertDialogFooter,{children:[(0,t.jsx)(et.AlertDialogCancel,{children:"Cancel"}),(0,t.jsxs)(et.AlertDialogAction,{onClick:$,children:[(0,t.jsx)(eE.default,{className:"mr-2 size-4"}),"Unlink Property"]})]})]})})]})}var eJ=e.i(946672),eV=e.i(825893),eH=e.i(38614),eW=e.i(995403),eY=(0,q.createServerReference)("600d248fca67343a7a300d336e6a84b87acdd15e2e",q.callServer,void 0,q.findSourceMapURL,"bulkArchive"),eG=e.i(810481),eK=e.i(831269),eX=e.i(527756),eQ=e.i(794712),eZ=e.i(635709);function e0({estimates:e}){let s=(0,F.useRouter)(),[a,r]=(0,M.useState)(!1),[i,n]=(0,M.useState)(new Set),[o,d]=(0,M.useState)(!1),[m,u]=(0,M.useState)(null),[x,h]=(0,M.useState)(!1),p=(0,M.useCallback)(e=>(0,eC.formatCurrency)(e,{minimumFractionDigits:0,maximumFractionDigits:0}),[]),g=(0,M.useCallback)(async()=>{if(0!==i.size){d(!0);try{let e=await eY(Array.from(i),"estimate");e.success&&e.data?(eW.toast.success(`Successfully archived ${e.data.archived} estimate${1===e.data.archived?"":"s"}`),r(!1),n(new Set),s.refresh()):eW.toast.error("Failed to archive estimates")}catch(e){eW.toast.error("Failed to archive estimates")}finally{d(!1)}}},[i]),j=(0,M.useCallback)(async()=>{if(m){h(!0);try{let e=await (0,eG.unlinkEstimateFromJob)(m);e.success?(eW.toast.success("Estimate unlinked from job"),u(null),s.refresh()):eW.toast.error(e.error||"Failed to unlink estimate")}catch(e){eW.toast.error("Failed to unlink estimate")}finally{h(!1)}}},[m]),f=(0,M.useMemo)(()=>[{key:"estimate_number",header:"Estimate #",width:"w-40",shrink:!0,render:e=>(0,t.jsx)(A.default,{className:"text-foreground hover:text-primary truncate text-xs font-medium transition-colors hover:underline",href:`/dashboard/work/estimates/${e.id}`,title:e.estimate_number,children:e.estimate_number})},{key:"title",header:"Title",width:"flex-1",render:e=>(0,t.jsx)(A.default,{className:"block min-w-0",href:`/dashboard/work/estimates/${e.id}`,onClick:e=>e.stopPropagation(),title:e.title||void 0,children:(0,t.jsx)("span",{className:"text-foreground truncate text-xs leading-tight font-medium hover:underline",children:e.title||"—"})})},{key:"status",header:"Status",width:"w-32",shrink:!0,render:e=>(0,t.jsx)(eQ.EstimateStatusBadge,{status:e.status})},{key:"total_amount",header:"Amount",width:"w-36",shrink:!0,align:"right",render:e=>(0,t.jsx)("span",{className:"text-xs font-semibold tabular-nums",children:p(e.total_amount)})},{key:"valid_until",header:"Valid Until",width:"w-36",shrink:!0,hideOnMobile:!0,render:e=>(0,t.jsx)("span",{className:"text-muted-foreground text-xs tabular-nums",children:e.valid_until?(0,eC.formatDate)(e.valid_until,"short"):"—"})},{key:"actions",header:"",width:"w-12",shrink:!0,align:"right",render:e=>(0,t.jsxs)(eR.DropdownMenu,{children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(V.Button,{className:"size-8 p-0",size:"sm",variant:"ghost",children:(0,t.jsx)(eH.MoreHorizontal,{className:"size-4"})})}),(0,t.jsxs)(eR.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,t.jsx)(eR.DropdownMenuItem,{asChild:!0,className:"cursor-pointer",children:(0,t.jsxs)(A.default,{href:`/dashboard/work/estimates/${e.id}`,children:[(0,t.jsx)(eM.Eye,{className:"mr-2 size-4"}),"View Details"]})}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",children:[(0,t.jsx)(c.Download,{className:"mr-2 size-4"}),"Download PDF"]}),(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",children:[(0,t.jsx)(O.Send,{className:"mr-2 size-4"}),"Send to Customer"]}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",children:[(0,t.jsx)(l.CheckCircle,{className:"mr-2 size-4"}),"Convert to Invoice"]}),(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>u(e.id),children:[(0,t.jsx)(eV.Link2Off,{className:"mr-2 size-4"}),"Unlink from Job"]})]})]})}],[p]),v=(0,M.useMemo)(()=>[{label:"Archive Selected",icon:(0,t.jsx)(eJ.Archive,{className:"h-4 w-4"}),variant:"destructive",onClick:e=>{n(e),r(!0)}}],[]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eX.FullWidthDataTable,{...eZ.TablePresets.compact(),bulkActions:v,columns:f,data:e,emptyIcon:(0,t.jsx)(N.Receipt,{className:"text-muted-foreground/50 size-12"}),emptyMessage:"No estimates found for this job",getItemId:e=>e.id,noPadding:!0,searchFilter:(e,t)=>{let s=t.toLowerCase();return e.estimate_number?.toLowerCase().includes(s)||e.title?.toLowerCase().includes(s)||e.status?.toLowerCase().includes(s)},searchPlaceholder:"Search estimates..."}),(0,t.jsx)(eK.ArchiveConfirmDialog,{entityType:"estimate",isLoading:o,itemCount:i.size,onConfirm:g,onOpenChange:r,open:a}),(0,t.jsx)(H.Dialog,{onOpenChange:e=>!e&&u(null),open:null!==m,children:(0,t.jsxs)(H.DialogContent,{children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsx)(H.DialogTitle,{children:"Unlink Estimate from Job?"}),(0,t.jsx)(H.DialogDescription,{children:"This will remove the job association from this estimate. The estimate will remain in the system but will no longer appear on this job's page."})]}),(0,t.jsxs)(H.DialogFooter,{children:[(0,t.jsx)(V.Button,{disabled:x,onClick:()=>u(null),variant:"outline",children:"Cancel"}),(0,t.jsx)(V.Button,{disabled:x,onClick:j,variant:"destructive",children:x?"Unlinking...":"Unlink Estimate"})]})]})})]})}var e1=e.i(403468),e2=e.i(608630);function e4({invoices:e}){let s=(0,F.useRouter)(),[a,r]=(0,M.useState)(null),[i,n]=(0,M.useState)(!1),l=(0,M.useCallback)(e=>(0,eC.formatCurrency)(e,{minimumFractionDigits:0,maximumFractionDigits:0}),[]),o=(0,M.useCallback)(async()=>{if(a){n(!0);try{let e=await (0,e2.unlinkInvoiceFromJob)(a);e.success?(eW.toast.success("Invoice unlinked from job"),r(null),s.refresh()):eW.toast.error(e.error||"Failed to unlink invoice")}catch(e){eW.toast.error("Failed to unlink invoice")}finally{n(!1)}}},[a,s]),d=(0,M.useMemo)(()=>[{key:"invoice_number",header:"Invoice #",width:"w-32",shrink:!0,render:e=>(0,t.jsx)(A.default,{className:"text-foreground text-xs leading-tight font-medium hover:underline",href:`/dashboard/work/invoices/${e.id}`,onClick:e=>e.stopPropagation(),children:e.invoice_number})},{key:"title",header:"Title",render:e=>(0,t.jsx)(A.default,{className:"text-foreground text-xs leading-tight font-medium hover:underline",href:`/dashboard/work/invoices/${e.id}`,onClick:e=>e.stopPropagation(),children:e.title||"—"})},{key:"status",header:"Status",width:"w-24",shrink:!0,render:e=>(0,t.jsx)(eQ.InvoiceStatusBadge,{status:e.status})},{key:"total_amount",header:"Amount",width:"w-32",shrink:!0,align:"right",render:e=>(0,t.jsx)("span",{className:"font-medium",children:l(e.total_amount)})},{key:"balance_amount",header:"Balance",width:"w-32",shrink:!0,align:"right",render:e=>{let s=e.balance_amount??e.total_amount-e.paid_amount;return s>0?(0,t.jsx)("span",{className:"text-destructive font-medium",children:l(s)}):(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"Paid"})}},{key:"due_date",header:"Due Date",width:"w-28",shrink:!0,hideOnMobile:!0,render:e=>(0,t.jsx)("span",{className:"text-xs",children:(0,eC.formatDate)(e.due_date,"short")})},{key:"actions",header:"",width:"w-12",shrink:!0,align:"right",render:e=>{let s=e.balance_amount??e.total_amount-e.paid_amount,a="paid"!==e.status&&s>0;return(0,t.jsxs)(eR.DropdownMenu,{children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(V.Button,{className:"size-8 p-0",size:"sm",variant:"ghost",children:(0,t.jsx)(eH.MoreHorizontal,{className:"size-4"})})}),(0,t.jsxs)(eR.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",children:[(0,t.jsx)(eM.Eye,{className:"mr-2 size-4"}),"View Details"]}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",children:[(0,t.jsx)(c.Download,{className:"mr-2 size-4"}),"Download PDF"]}),(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",children:[(0,t.jsx)(O.Send,{className:"mr-2 size-4"}),"Send to Customer"]}),a&&(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",children:[(0,t.jsx)(e1.CreditCard,{className:"mr-2 size-4"}),"Record Payment"]}),(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>r(e.id),children:[(0,t.jsx)(eV.Link2Off,{className:"mr-2 size-4"}),"Unlink from Job"]})]})]})}}],[l]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eX.FullWidthDataTable,{...eZ.TablePresets.compact(),columns:d,data:e,emptyIcon:(0,t.jsx)(u.FileText,{className:"text-muted-foreground/50 size-12"}),emptyMessage:"No invoices found for this job",getItemId:e=>e.id,noPadding:!0,searchFilter:(e,t)=>{let s=t.toLowerCase();return e.invoice_number?.toLowerCase().includes(s)||e.title?.toLowerCase().includes(s)||e.status?.toLowerCase().includes(s)},searchPlaceholder:"Search invoices..."}),(0,t.jsx)(H.Dialog,{onOpenChange:e=>!e&&r(null),open:null!==a,children:(0,t.jsxs)(H.DialogContent,{children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsx)(H.DialogTitle,{children:"Unlink Invoice from Job?"}),(0,t.jsx)(H.DialogDescription,{children:"This will remove the job association from this invoice. The invoice will remain in the system but will no longer appear on this job's page."})]}),(0,t.jsxs)(H.DialogFooter,{children:[(0,t.jsx)(V.Button,{disabled:i,onClick:()=>r(null),variant:"outline",children:"Cancel"}),(0,t.jsx)(V.Button,{disabled:i,onClick:o,variant:"destructive",children:i?"Unlinking...":"Unlink Invoice"})]})]})})]})}var e3=e.i(664136),e5=e.i(586870),e6=e.i(532727);function e8({notes:e,onDeleteNote:s}){let a=(0,F.useRouter)(),[r,i]=(0,M.useState)(null),[n,l]=(0,M.useState)(null),[o,d]=(0,M.useState)(!1),[c,m]=(0,M.useState)(!1),[x,h]=(0,M.useState)(new Set),[p,g]=(0,M.useState)(!1),j=(0,M.useCallback)(async()=>{if(r&&s){d(!0);try{let e=await s(r);e.success?(eW.toast.success("Note deleted"),i(null),a.refresh()):eW.toast.error(e.error||"Failed to delete note")}catch(e){eW.toast.error("Failed to delete note")}finally{d(!1)}}},[r,s,a]),f=(0,M.useCallback)(async()=>{if(0!==x.size){g(!0);try{let e=await eY(Array.from(x),"job_note");e.success&&e.data?(eW.toast.success(`Successfully archived ${e.data.archived} note${1===e.data.archived?"":"s"}`),m(!1),h(new Set),a.refresh()):eW.toast.error("Failed to archive notes")}catch(e){eW.toast.error("Failed to archive notes")}finally{g(!1)}}},[x,a]),v=(0,M.useCallback)(e=>e?e.split(/[-_]/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"General",[]),b=(0,M.useCallback)((e,t=100)=>e.length<=t?e:`${e.substring(0,t)}...`,[]),N=(0,M.useMemo)(()=>e.find(e=>e.id===n),[e,n]),y=(0,M.useMemo)(()=>[{label:"Archive Selected",icon:(0,t.jsx)(eJ.Archive,{className:"h-4 w-4"}),variant:"destructive",onClick:e=>{h(e),m(!0)}}],[]),w=(0,M.useMemo)(()=>[{key:"content",header:"Note",render:e=>(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[e.is_important&&(0,t.jsx)(e5.Flag,{className:"text-destructive mt-0.5 size-4 shrink-0 fill-current"}),(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("span",{className:"text-xs leading-tight",children:b(e.content)}),e.content.length>100&&(0,t.jsx)("button",{className:"text-primary text-xs font-medium hover:underline",onClick:t=>{t.stopPropagation(),l(e.id)},type:"button",children:"Read more"})]})]})},{key:"note_type",header:"Type",width:"w-28",shrink:!0,hideOnMobile:!0,render:e=>(0,t.jsx)(ea.Badge,{variant:"outline",className:"font-normal",children:v(e.note_type)})},{key:"is_important",header:"Important",width:"w-24",shrink:!0,hideOnMobile:!0,align:"center",render:e=>e.is_important?(0,t.jsx)(e5.Flag,{className:"text-destructive size-4 fill-current"}):(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"—"})},{key:"created_by_name",header:"Author",width:"w-36",shrink:!0,hideOnMobile:!0,render:e=>(0,t.jsx)("span",{className:"text-xs",children:e.created_by_name||"Unknown"})},{key:"created_at",header:"Date",width:"w-32",shrink:!0,render:e=>(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:(0,eC.formatDate)(e.created_at,"short")})},{key:"actions",header:"",width:"w-12",shrink:!0,align:"right",render:e=>(0,t.jsxs)(eR.DropdownMenu,{children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(V.Button,{className:"size-8 p-0",size:"sm",variant:"ghost",children:(0,t.jsx)(eH.MoreHorizontal,{className:"size-4"})})}),(0,t.jsxs)(eR.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",onClick:()=>l(e.id),children:[(0,t.jsx)(eM.Eye,{className:"mr-2 size-4"}),"View Full Note"]}),(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",children:[(0,t.jsx)(e3.Edit,{className:"mr-2 size-4"}),"Edit Note"]}),(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>{h(new Set([e.id])),m(!0)},children:[(0,t.jsx)(eJ.Archive,{className:"mr-2 size-4"}),"Archive Note"]}),s&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>i(e.id),children:[(0,t.jsx)(e6.Trash2,{className:"mr-2 size-4"}),"Delete Note"]})]})]})]})}],[b,v,s]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eX.FullWidthDataTable,{...eZ.TablePresets.compact(),bulkActions:y,columns:w,data:e,emptyIcon:(0,t.jsx)(u.FileText,{className:"text-muted-foreground/50 size-12"}),emptyMessage:"No notes found for this job",getItemId:e=>e.id,noPadding:!0,searchFilter:(e,t)=>{let s=t.toLowerCase();return e.content.toLowerCase().includes(s)||e.note_type?.toLowerCase().includes(s)||e.created_by_name?.toLowerCase().includes(s)},searchPlaceholder:"Search notes...",getRowClassName:e=>e.is_important?"border-l-2 border-l-destructive":""}),(0,t.jsx)(eK.ArchiveConfirmDialog,{entityType:"note",isLoading:p,itemCount:x.size,onConfirm:f,onOpenChange:m,open:c}),(0,t.jsx)(H.Dialog,{onOpenChange:e=>!e&&l(null),open:null!==n,children:(0,t.jsxs)(H.DialogContent,{className:"max-w-2xl",children:[(0,t.jsx)(H.DialogHeader,{children:(0,t.jsxs)(H.DialogTitle,{className:"flex items-center gap-2",children:[N?.is_important&&(0,t.jsx)(e5.Flag,{className:"text-destructive size-5 fill-current"}),"Note Details"]})}),N&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-muted-foreground mb-1 text-xs font-medium tracking-wide uppercase",children:"Type"}),(0,t.jsx)(ea.Badge,{variant:"outline",children:v(N.note_type)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-muted-foreground mb-1 text-xs font-medium tracking-wide uppercase",children:"Content"}),(0,t.jsx)("p",{className:"text-foreground text-xs leading-relaxed whitespace-pre-wrap",children:N.content})]}),(0,t.jsxs)("div",{className:"border-border/40 flex items-center justify-between border-t pt-3",children:[(0,t.jsxs)("div",{className:"text-muted-foreground text-xs",children:["Created by"," ",(0,t.jsx)("span",{className:"font-medium",children:N.created_by_name||"Unknown"})]}),(0,t.jsx)("div",{className:"text-muted-foreground text-xs",children:(0,eC.formatDate)(N.created_at,"datetime")})]})]}),(0,t.jsx)(H.DialogFooter,{children:(0,t.jsx)(V.Button,{onClick:()=>l(null),variant:"outline",children:"Close"})})]})}),(0,t.jsx)(H.Dialog,{onOpenChange:e=>!e&&i(null),open:null!==r,children:(0,t.jsxs)(H.DialogContent,{children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsx)(H.DialogTitle,{children:"Delete Note?"}),(0,t.jsx)(H.DialogDescription,{children:"This will permanently delete this note. This action cannot be undone. Are you sure you want to continue?"})]}),(0,t.jsxs)(H.DialogFooter,{children:[(0,t.jsx)(V.Button,{disabled:o,onClick:()=>i(null),variant:"outline",children:"Cancel"}),(0,t.jsx)(V.Button,{disabled:o,onClick:j,variant:"destructive",children:o?"Deleting...":"Delete Note"})]})]})})]})}var e7=e.i(535046);function e9({payments:e,onDeletePayment:s}){let a=(0,F.useRouter)(),[r,i]=(0,M.useState)(null),[n,l]=(0,M.useState)(!1),[o,d]=(0,M.useState)(!1),[m,u]=(0,M.useState)(new Set),[x,h]=(0,M.useState)(!1),[p,g]=(0,M.useState)(null),[j,f]=(0,M.useState)(!1),v=(0,M.useCallback)(e=>(0,eC.formatCurrency)(e,{minimumFractionDigits:2,maximumFractionDigits:2}),[]),b=(0,M.useCallback)(async()=>{if(0!==m.size){h(!0);try{let e=await eY(Array.from(m),"payment");e.success&&e.data?(eW.toast.success(`Successfully archived ${e.data.archived} payment${1===e.data.archived?"":"s"}`),d(!1),u(new Set),a.refresh()):eW.toast.error("Failed to archive payments")}catch(e){eW.toast.error("Failed to archive payments")}finally{h(!1)}}},[m,a]),N=(0,M.useCallback)(async()=>{if(p){f(!0);try{let e=await (0,e7.unlinkPaymentFromJob)(p);e.success?(eW.toast.success("Payment unlinked from job"),g(null),a.refresh()):eW.toast.error(e.error||"Failed to unlink payment")}catch(e){eW.toast.error("Failed to unlink payment")}finally{f(!1)}}},[p,a]),y=(0,M.useCallback)(async()=>{if(r&&s){l(!0);try{let e=await s(r);e.success?(eW.toast.success("Payment deleted"),i(null),a.refresh()):eW.toast.error(e.error||"Failed to delete payment")}catch(e){eW.toast.error("Failed to delete payment")}finally{l(!1)}}},[r,s,a]),w=(0,M.useCallback)(e=>e?e.split(/[-_]/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"—",[]),C=(0,M.useMemo)(()=>[{label:"Archive Selected",icon:(0,t.jsx)(eJ.Archive,{className:"h-4 w-4"}),variant:"destructive",onClick:e=>{u(e),d(!0)}}],[]),_=(0,M.useMemo)(()=>[{key:"payment_date",header:"Date",width:"w-32",shrink:!0,render:e=>(0,t.jsx)("span",{className:"text-xs font-medium",children:(0,eC.formatDate)(e.payment_date||e.created_at,"short")})},{key:"amount",header:"Amount",width:"w-32",shrink:!0,align:"right",render:e=>(0,t.jsx)("span",{className:"font-semibold",children:v(e.amount)})},{key:"payment_method",header:"Method",width:"w-32",shrink:!0,hideOnMobile:!0,render:e=>(0,t.jsx)("span",{className:"text-xs",children:w(e.payment_method)})},{key:"reference_number",header:"Reference",width:"w-36",shrink:!0,hideOnMobile:!0,render:e=>(0,t.jsx)("span",{className:"text-muted-foreground font-mono text-xs",children:e.reference_number||"—"})},{key:"notes",header:"Notes",render:e=>(0,t.jsx)("span",{className:"text-muted-foreground line-clamp-1 text-xs",children:e.notes||"—"})},{key:"actions",header:"",width:"w-12",shrink:!0,align:"right",render:e=>(0,t.jsxs)(eR.DropdownMenu,{children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(V.Button,{className:"size-8 p-0",size:"sm",variant:"ghost",children:(0,t.jsx)(eH.MoreHorizontal,{className:"size-4"})})}),(0,t.jsxs)(eR.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",children:[(0,t.jsx)(eM.Eye,{className:"mr-2 size-4"}),"View Details"]}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",children:[(0,t.jsx)(c.Download,{className:"mr-2 size-4"}),"Download Receipt"]}),(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",children:[(0,t.jsx)(e3.Edit,{className:"mr-2 size-4"}),"Edit Payment"]}),(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>g(e.id),children:[(0,t.jsx)(eV.Link2Off,{className:"mr-2 size-4"}),"Unlink from Job"]}),s&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>i(e.id),children:[(0,t.jsx)(e6.Trash2,{className:"mr-2 size-4"}),"Delete Payment"]})]})]})]})}],[v,w,s]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eX.FullWidthDataTable,{...eZ.TablePresets.compact(),bulkActions:C,columns:_,data:e,emptyIcon:(0,t.jsx)(e1.CreditCard,{className:"text-muted-foreground/50 size-12"}),emptyMessage:"No payments found for this job",getItemId:e=>e.id,noPadding:!0,searchFilter:(e,t)=>{let s=t.toLowerCase();return e.reference_number?.toLowerCase().includes(s)||e.payment_method?.toLowerCase().includes(s)||e.notes?.toLowerCase().includes(s)||v(e.amount).toLowerCase().includes(s)},searchPlaceholder:"Search payments..."}),(0,t.jsx)(eK.ArchiveConfirmDialog,{entityType:"payment",isLoading:x,itemCount:m.size,onConfirm:b,onOpenChange:d,open:o}),(0,t.jsx)(H.Dialog,{onOpenChange:e=>!e&&g(null),open:null!==p,children:(0,t.jsxs)(H.DialogContent,{children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsx)(H.DialogTitle,{children:"Unlink Payment from Job?"}),(0,t.jsx)(H.DialogDescription,{children:"This will remove the job association from this payment. The payment will remain in the system but will no longer appear on this job's page."})]}),(0,t.jsxs)(H.DialogFooter,{children:[(0,t.jsx)(V.Button,{disabled:j,onClick:()=>g(null),variant:"outline",children:"Cancel"}),(0,t.jsx)(V.Button,{disabled:j,onClick:N,variant:"destructive",children:j?"Unlinking...":"Unlink Payment"})]})]})}),s&&(0,t.jsx)(H.Dialog,{onOpenChange:e=>!e&&i(null),open:null!==r,children:(0,t.jsxs)(H.DialogContent,{children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsx)(H.DialogTitle,{children:"Delete Payment?"}),(0,t.jsx)(H.DialogDescription,{children:"This will permanently delete this payment record. This action cannot be undone. Are you sure you want to continue?"})]}),(0,t.jsxs)(H.DialogFooter,{children:[(0,t.jsx)(V.Button,{disabled:n,onClick:()=>i(null),variant:"outline",children:"Cancel"}),(0,t.jsx)(V.Button,{disabled:n,onClick:y,variant:"destructive",children:n?"Deleting...":"Delete Payment"})]})]})})]})}function te({purchaseOrders:e}){let s=(0,F.useRouter)(),[a,r]=(0,M.useState)(!1),[i,n]=(0,M.useState)(new Set),[l,o]=(0,M.useState)(!1),d=(0,M.useCallback)(e=>(0,eC.formatCurrency)(e,{minimumFractionDigits:0,maximumFractionDigits:0}),[]),m=(0,M.useCallback)(async()=>{if(0!==i.size){o(!0);try{let e=await eY(Array.from(i),"purchase_order");e.success&&e.data?(eW.toast.success(`Successfully archived ${e.data.archived} purchase order${1===e.data.archived?"":"s"}`),r(!1),n(new Set),s.refresh()):eW.toast.error("Failed to archive purchase orders")}catch(e){eW.toast.error("Failed to archive purchase orders")}finally{o(!1)}}},[i]),u=(0,M.useMemo)(()=>[{key:"po_number",header:"PO #",width:"w-40",shrink:!0,render:e=>(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-2",children:[(0,t.jsx)(A.default,{className:"text-foreground hover:text-primary truncate text-xs font-medium transition-colors hover:underline",href:`/dashboard/work/purchase-orders/${e.id}`,title:e.po_number,children:e.po_number}),e.auto_generated&&(0,t.jsx)(ea.Badge,{className:"shrink-0 text-xs",variant:"outline",children:"Auto"})]})},{key:"title",header:"Title",width:"flex-1",render:e=>(0,t.jsx)(A.default,{className:"block min-w-0",href:`/dashboard/work/purchase-orders/${e.id}`,onClick:e=>e.stopPropagation(),title:e.title||void 0,children:(0,t.jsx)("span",{className:"text-foreground truncate text-xs leading-tight font-medium hover:underline",children:e.title||"—"})})},{key:"vendor",header:"Vendor",width:"w-48",shrink:!0,render:e=>(0,t.jsx)("span",{className:"text-foreground block truncate text-xs",title:e.vendor,children:e.vendor})},{key:"status",header:"Status",width:"w-32",shrink:!0,render:e=>(0,t.jsx)(eQ.StatusBadge,{status:e.status,type:"purchase_order"})},{key:"total_amount",header:"Amount",width:"w-36",shrink:!0,align:"right",render:e=>(0,t.jsx)("span",{className:"text-xs font-semibold tabular-nums",children:d(e.total_amount)})},{key:"expected_delivery",header:"Expected Delivery",width:"w-40",shrink:!0,hideOnMobile:!0,render:e=>(0,t.jsx)("span",{className:"text-muted-foreground text-xs tabular-nums",children:e.expected_delivery?(0,eC.formatDate)(e.expected_delivery,"short"):"—"})},{key:"actions",header:"",width:"w-12",shrink:!0,align:"right",render:e=>(0,t.jsxs)(eR.DropdownMenu,{children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(V.Button,{className:"size-8 p-0",size:"sm",variant:"ghost",children:(0,t.jsx)(eH.MoreHorizontal,{className:"size-4"})})}),(0,t.jsxs)(eR.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",children:[(0,t.jsx)(eM.Eye,{className:"mr-2 size-4"}),"View Details"]}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",children:[(0,t.jsx)(c.Download,{className:"mr-2 size-4"}),"Download PDF"]}),(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",children:[(0,t.jsx)(O.Send,{className:"mr-2 size-4"}),"Send to Vendor"]})]})]})}],[d]),x=(0,M.useMemo)(()=>[{label:"Archive Selected",icon:(0,t.jsx)(eJ.Archive,{className:"h-4 w-4"}),variant:"destructive",onClick:e=>{n(e),r(!0)}}],[]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eX.FullWidthDataTable,{...eZ.TablePresets.compact(),bulkActions:x,columns:u,data:e,emptyIcon:(0,t.jsx)(f.Package,{className:"text-muted-foreground/50 size-12"}),emptyMessage:"No purchase orders found for this job",getItemId:e=>e.id,noPadding:!0,searchFilter:(e,t)=>{let s=t.toLowerCase();return e.po_number?.toLowerCase().includes(s)||e.title?.toLowerCase().includes(s)||e.vendor?.toLowerCase().includes(s)||e.status?.toLowerCase().includes(s)},searchPlaceholder:"Search purchase orders..."}),(0,t.jsx)(eK.ArchiveConfirmDialog,{entityType:"purchase order",isLoading:l,itemCount:i.size,onConfirm:m,onOpenChange:r,open:a})]})}var tt=e.i(912952),ts=e.i(85878);function ta({jobId:e,currentStatus:s}){(0,F.useRouter)();let{toast:a}=(0,K.useToast)(),[r,i]=(0,M.useState)(null),n=async()=>{i("arrive");try{let t=await (0,ts.startJob)(e);t.success?a.success("Job started - technician arrived"):a.error(t.error||"Failed to mark job as arrived")}catch{a.error("Failed to mark job as arrived")}finally{i(null)}},o=async()=>{i("close");try{let t=await (0,tt.completeJob)(e);t.success?a.success("Job closed successfully"):a.error(t.error||"Failed to close job")}catch{a.error("Failed to close job")}finally{i(null)}},d="scheduled"===s,c="in_progress"===s;return(0,t.jsx)("div",{className:"space-y-3",children:"completed"!==s&&"cancelled"!==s&&(d||c)&&(0,t.jsxs)("div",{className:"flex justify-end",children:[d&&(0,t.jsxs)(V.Button,{className:"bg-success hover:bg-success",disabled:"arrive"===r,onClick:n,children:[(0,t.jsx)(l.CheckCircle,{className:"mr-2 h-4 w-4"}),"arrive"===r?"Arriving...":"Arrive at Site"]}),c&&(0,t.jsxs)(V.Button,{className:"bg-accent hover:bg-accent",disabled:"close"===r,onClick:o,children:[(0,t.jsx)(l.CheckCircle,{className:"mr-2 h-4 w-4"}),"close"===r?"Closing...":"Complete Job"]})]})})}var tr=e.i(710269),ti=e.i(852648),tn=e.i(288413),tl=e.i(8392);let to={quoted:["scheduled","cancelled"],scheduled:["in_progress","on_hold","cancelled"],in_progress:["on_hold","completed","cancelled"],on_hold:["scheduled","in_progress","cancelled"],completed:["invoiced"],cancelled:["quoted","scheduled"],invoiced:["paid"],paid:[]},td={quoted:["customer_id"],scheduled:["customer_id","scheduled_start","scheduled_end"],in_progress:["customer_id","scheduled_start","assigned_to"],on_hold:["customer_id"],completed:["customer_id","scheduled_start"],cancelled:[],invoiced:["customer_id","total_amount"],paid:["customer_id","total_amount"]},tc={customer_id:"Customer",scheduled_start:"Start Date",scheduled_end:"End Date",assigned_to:"Assigned Team Member",property_id:"Property",total_amount:"Total Amount"};function tm(e){return({quoted:"Quoted",scheduled:"Scheduled",in_progress:"In Progress",on_hold:"On Hold",completed:"Completed",cancelled:"Cancelled",invoiced:"Invoiced",paid:"Paid"})[e]||e}function tu(e){return({quoted:"outline",scheduled:"secondary",in_progress:"default",on_hold:"secondary",completed:"default",cancelled:"destructive",invoiced:"secondary",paid:"default"})[e]||"default"}function tx({currentStatus:e,onStatusChange:s,job:r,disabled:i=!1,showAllStatuses:n=!1}){let l=(0,M.useMemo)(()=>{let t=to[e]||[];return[e,...t]},[e]),o=(0,M.useMemo)(()=>({quoted:"scheduled",scheduled:"in_progress",in_progress:"completed",on_hold:"in_progress",completed:"invoiced",cancelled:null,invoiced:"paid",paid:null})[e]||null,[e]),d=n?["quoted","scheduled","in_progress","on_hold","completed","cancelled","invoiced","paid"]:l,c=(0,M.useCallback)(t=>t===e?{allowed:!0}:function(e){let{currentStatus:t,newStatus:s,job:a}=e;if(t===s)return{allowed:!0};let r=to[t];if(!r.includes(s))return{allowed:!1,reason:`Cannot transition from "${t}" to "${s}". Valid next statuses: ${r.join(", ")}`};let i=td[s],n=[];for(let e of i){let t=a[e];(null==t||""===t)&&n.push(tc[e]||e)}if(n.length>0)return{allowed:!1,reason:`Cannot transition to "${s}" - missing required fields`,requiredFields:n};let l=[];if("scheduled"!==t||"in_progress"!==s||a.teamAssignments&&0!==a.teamAssignments.length||l.push("No team members assigned to this job"),"completed"===t&&"invoiced"===s){let e=a.estimates&&a.estimates.length>0,t=a.total_amount&&a.total_amount>0;if(!e&&!t)return{allowed:!1,reason:"Cannot create invoice - no estimates or total amount defined"}}if("invoiced"===t&&"paid"===s){if(!a.invoices||0===a.invoices.length)return{allowed:!1,reason:"Cannot mark as paid - no invoices found"};let e=a.invoices.filter(e=>"paid"!==e.status&&"cancelled"!==e.status);if(e.length>0)return{allowed:!1,reason:`Cannot mark as paid - ${e.length} invoice(s) still unpaid`}}return"paid"===t?{allowed:!1,reason:"Cannot change status of paid jobs. Create a new job if needed."}:{allowed:!0,warnings:l.length>0?l:void 0}}({currentStatus:e,newStatus:t,job:r}),[e,r]),m=(0,M.useCallback)(e=>{c(e).allowed&&s(e)},[c,s]),u=(0,M.useMemo)(()=>c(e),[e,c]),x=(0,M.useMemo)(()=>{let t=l.filter(t=>t!==e);return{current:tm(e),nextSteps:t.map(e=>tm(e)),recommended:o?tm(o):null}},[e,l,o]);return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(W.Select,{value:e,onValueChange:m,disabled:i,children:[(0,t.jsx)(W.SelectTrigger,{className:"w-full",children:(0,t.jsx)(W.SelectValue,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ea.Badge,{variant:tu(e),children:tm(e)}),o&&e!==o&&(0,t.jsxs)("span",{className:"text-muted-foreground text-xs",children:["→ Next: ",tm(o)]})]})})}),(0,t.jsx)(W.SelectContent,{children:d.map(s=>{let r=c(s),i=!r.allowed,n=s===e,l=s===o;return(0,t.jsxs)(W.SelectItem,{value:s,disabled:i&&!n,className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ea.Badge,{variant:tu(s),className:"text-xs",children:tm(s)}),n&&(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"(current)"}),l&&!n&&(0,t.jsx)("span",{className:"text-primary text-xs",children:"(recommended)"}),i&&!n&&(0,t.jsx)("span",{className:"text-destructive text-xs",children:(0,t.jsx)(a.AlertCircle,{className:"inline h-3 w-3"})}),r.warnings&&r.warnings.length>0&&(0,t.jsx)("span",{className:"text-yellow-600 text-xs",children:(0,t.jsx)(tl.Info,{className:"inline h-3 w-3"})})]}),i&&!n&&r.reason&&(0,t.jsx)("div",{className:"text-destructive mt-1 text-xs",children:r.reason}),i&&!n&&r.requiredFields&&r.requiredFields.length>0&&(0,t.jsxs)("div",{className:"text-destructive mt-1 text-xs",children:["Missing: ",r.requiredFields.join(", ")]})]},s)})})]})}),(0,t.jsxs)(en.Popover,{children:[(0,t.jsx)(en.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(V.Button,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground h-8 w-8 p-0",children:[(0,t.jsx)(tn.HelpCircle,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"View workflow information"})]})}),(0,t.jsx)(en.PopoverContent,{className:"w-80",align:"start",children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"mb-2 font-semibold text-sm",children:["Current Status: ",x.current]}),(0,t.jsxs)("p",{className:"text-muted-foreground text-xs",children:["This job is currently in the"," ",x.current.toLowerCase()," stage."]})]}),x.nextSteps.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"mb-2 flex items-center gap-1 font-semibold text-sm",children:[(0,t.jsx)(ef.ArrowRight,{className:"h-3 w-3"}),"Available Next Steps"]}),(0,t.jsx)("ul",{className:"space-y-1",children:x.nextSteps.map((e,s)=>(0,t.jsxs)("li",{className:`flex items-center gap-2 text-xs ${e===x.recommended?"text-primary font-medium":"text-muted-foreground"}`,children:[(0,t.jsx)(ti.CheckCircle2,{className:"h-3 w-3"}),e,e===x.recommended&&(0,t.jsx)(ea.Badge,{variant:"default",className:"ml-auto text-xs",children:"Recommended"})]},s))})]}),0===x.nextSteps.length&&"paid"!==e&&(0,t.jsx)("div",{children:(0,t.jsx)("p",{className:"text-muted-foreground text-xs",children:"This status cannot be changed further. Job is complete."})}),"paid"===e&&(0,t.jsx)("div",{className:"rounded-md border-green-600 bg-green-50 p-2 dark:bg-green-950",children:(0,t.jsx)("p",{className:"text-green-900 text-xs dark:text-green-100",children:"✓ Job is fully paid. No further status changes allowed."})}),(0,t.jsx)("div",{className:"border-t pt-2",children:(0,t.jsx)("p",{className:"text-muted-foreground text-xs italic",children:"Status changes follow your workflow rules. Some transitions may require additional information like dates, assignments, or invoices."})})]})})]})]}),u.warnings&&u.warnings.length>0&&(0,t.jsxs)(ew.Alert,{variant:"default",className:"border-yellow-600",children:[(0,t.jsx)(tl.Info,{className:"h-4 w-4 text-yellow-600"}),(0,t.jsx)(ew.AlertDescription,{children:(0,t.jsx)("ul",{className:"list-disc space-y-1 pl-4",children:u.warnings.map((e,s)=>(0,t.jsx)("li",{className:"text-sm",children:e},s))})})]}),"paid"===e&&(0,t.jsxs)(ew.Alert,{variant:"default",className:"border-green-600",children:[(0,t.jsx)(ti.CheckCircle2,{className:"h-4 w-4 text-green-600"}),(0,t.jsx)(ew.AlertDescription,{children:"This job is marked as paid. No further status changes are allowed."})]})]})}function th({tasks:e,onToggleComplete:s,onDeleteTask:a}){let r=(0,F.useRouter)(),[i,n]=(0,M.useState)(null),[o,d]=(0,M.useState)(!1),[c,m]=(0,M.useState)(!1),[u,x]=(0,M.useState)(new Set),[h,p]=(0,M.useState)(!1),g=(0,M.useCallback)(async()=>{if(i&&a){d(!0);try{let e=await a(i);e.success?(eW.toast.success("Task deleted"),n(null),r.refresh()):eW.toast.error(e.error||"Failed to delete task")}catch(e){eW.toast.error("Failed to delete task")}finally{d(!1)}}},[i,a,r]),j=(0,M.useCallback)(async()=>{if(0!==u.size){p(!0);try{let e=await eY(Array.from(u),"job_task");e.success&&e.data?(eW.toast.success(`Successfully archived ${e.data.archived} task${1===e.data.archived?"":"s"}`),m(!1),x(new Set),r.refresh()):eW.toast.error("Failed to archive tasks")}catch(e){eW.toast.error("Failed to archive tasks")}finally{p(!1)}}},[u,r]),f=(0,M.useCallback)(async(e,t)=>{if(s)try{let a=await s(e,!t);a.success?(eW.toast.success(t?"Task marked incomplete":"Task completed"),r.refresh()):eW.toast.error(a.error||"Failed to update task")}catch(e){eW.toast.error("Failed to update task")}},[s,r]),v=(0,M.useCallback)(e=>e||"Other",[]),b=(0,M.useCallback)(e=>{switch(e){case"Pre-Job":case"Safety":return"default";case"On-Site":case"Quality":return"secondary";default:return"outline"}},[]),N=e.filter(e=>e.is_completed).length,y=e.length,w=y>0?Math.round(N/y*100):0,C=(0,M.useMemo)(()=>[{label:"Archive Selected",icon:(0,t.jsx)(eJ.Archive,{className:"h-4 w-4"}),variant:"destructive",onClick:e=>{x(e),m(!0)}}],[]),_=(0,M.useMemo)(()=>[{key:"status",header:"",width:"w-12",shrink:!0,align:"center",render:e=>(0,t.jsx)("button",{className:"flex items-center justify-center",onClick:t=>{t.stopPropagation(),f(e.id,e.is_completed)},type:"button",disabled:!s,children:(0,t.jsx)("input",{checked:e.is_completed,className:(0,ep.cn)("border-border h-5 w-5 cursor-pointer rounded focus:ring-2",e.is_completed?"text-success focus:ring-green-500":"focus:ring-primary"),onChange:()=>{},type:"checkbox",disabled:!s})})},{key:"title",header:"Task",render:e=>(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:(0,ep.cn)("text-xs font-medium",e.is_completed&&"text-muted-foreground line-through"),children:e.title}),e.is_required&&(0,t.jsx)(ea.Badge,{variant:"destructive",className:"text-xs",children:"Required"})]}),e.description&&(0,t.jsx)("p",{className:"text-muted-foreground line-clamp-2 text-xs",children:e.description})]})},{key:"category",header:"Category",width:"w-28",shrink:!0,hideOnMobile:!0,render:e=>(0,t.jsx)(ea.Badge,{variant:b(e.category),className:"font-normal",children:v(e.category)})},{key:"assigned_user",header:"Assigned To",width:"w-36",shrink:!0,hideOnMobile:!0,render:e=>{let s=Array.isArray(e.assigned_user)?e.assigned_user[0]:e.assigned_user;return s?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(es.Avatar,{className:"h-6 w-6",children:[(0,t.jsx)(es.AvatarImage,{src:s.avatar}),(0,t.jsx)(es.AvatarFallback,{className:"text-xs",children:s.name?.substring(0,2).toUpperCase()||"TM"})]}),(0,t.jsx)("span",{className:"max-w-24 truncate text-xs",children:s.name})]}):(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"—"})}},{key:"due_date",header:"Due Date",width:"w-32",shrink:!0,hideOnMobile:!0,render:e=>{if(e.is_completed&&e.completed_at)return(0,t.jsxs)("div",{className:"text-success flex items-center gap-1 text-xs",children:[(0,t.jsx)(l.CheckCircle,{className:"size-3"}),(0,eC.formatDate)(e.completed_at,"short")]});if(e.due_date){let s=new Date(e.due_date)<new Date&&!e.is_completed;return(0,t.jsxs)("div",{className:(0,ep.cn)("flex items-center gap-1 text-xs",s?"text-destructive":"text-muted-foreground"),children:[(0,t.jsx)(ev.Clock,{className:"size-3"}),(0,eC.formatDate)(e.due_date,"short")]})}return(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"—"})}},{key:"actions",header:"",width:"w-12",shrink:!0,align:"right",render:e=>(0,t.jsxs)(eR.DropdownMenu,{children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(V.Button,{className:"size-8 p-0",size:"sm",variant:"ghost",children:(0,t.jsx)(eH.MoreHorizontal,{className:"size-4"})})}),(0,t.jsxs)(eR.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",onClick:()=>f(e.id,e.is_completed),disabled:!s,children:[(0,t.jsx)(l.CheckCircle,{className:"mr-2 size-4"}),e.is_completed?"Mark Incomplete":"Mark Complete"]}),(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"cursor-pointer",children:[(0,t.jsx)(e3.Edit,{className:"mr-2 size-4"}),"Edit Task"]}),(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>{x(new Set([e.id])),m(!0)},children:[(0,t.jsx)(eJ.Archive,{className:"mr-2 size-4"}),"Archive Task"]}),a&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>n(e.id),children:[(0,t.jsx)(e6.Trash2,{className:"mr-2 size-4"}),"Delete Task"]})]})]})]})}],[f,v,b,s,a]);return(0,t.jsxs)(t.Fragment,{children:[y>0&&(0,t.jsxs)("div",{className:"bg-muted/30 border-border mb-4 rounded-lg border p-4",children:[(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between text-xs",children:[(0,t.jsx)("span",{className:"font-medium",children:"Overall Progress"}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:[N," of ",y," completed (",w,"%)"]})]}),(0,t.jsx)("div",{className:"bg-muted h-2 w-full overflow-hidden rounded-full",children:(0,t.jsx)("div",{className:"bg-success h-full transition-all",style:{width:`${w}%`}})})]}),(0,t.jsx)(eX.FullWidthDataTable,{...eZ.TablePresets.compact(),bulkActions:C,columns:_,data:e,emptyIcon:(0,t.jsx)(l.CheckCircle,{className:"text-muted-foreground/50 size-12"}),emptyMessage:"No tasks added yet. Create a step-by-step checklist for the field crew.",getItemId:e=>e.id,noPadding:!0,searchFilter:(e,t)=>{let s=t.toLowerCase();return e.title.toLowerCase().includes(s)||e.description?.toLowerCase().includes(s)||e.category?.toLowerCase().includes(s)},searchPlaceholder:"Search tasks...",getRowClassName:e=>(0,ep.cn)(e.is_completed&&"bg-secondary/30 opacity-75",e.is_required&&!e.is_completed&&"border-l-2 border-l-destructive")}),(0,t.jsx)(eK.ArchiveConfirmDialog,{entityType:"task",isLoading:h,itemCount:u.size,onConfirm:j,onOpenChange:m,open:c}),(0,t.jsx)(H.Dialog,{onOpenChange:e=>!e&&n(null),open:null!==i,children:(0,t.jsxs)(H.DialogContent,{children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsx)(H.DialogTitle,{children:"Delete Task?"}),(0,t.jsx)(H.DialogDescription,{children:"This will permanently delete this task. This action cannot be undone. Are you sure you want to continue?"})]}),(0,t.jsxs)(H.DialogFooter,{children:[(0,t.jsx)(V.Button,{disabled:o,onClick:()=>n(null),variant:"outline",children:"Cancel"}),(0,t.jsx)(V.Button,{disabled:o,onClick:g,variant:"destructive",children:o?"Deleting...":"Delete Task"})]})]})})]})}e.i(733296);var tp=e.i(993665);function tg({availableMembers:e,currentMemberIds:s,onAssign:a,trigger:r}){let[i,n]=(0,M.useState)(!1),[l,o]=(0,M.useState)(""),[d,c]=(0,M.useState)(null),[m,u]=(0,M.useState)("crew"),[x,h]=(0,M.useState)(!1),p=e.filter(e=>!s.includes(e.id)),g=l.trim()?p.filter(e=>{let t=l.toLowerCase();return[e.user.firstName,e.user.lastName].filter(Boolean).join(" ").toLowerCase().includes(t)||e.user.email?.toLowerCase().includes(t)||e.jobTitle?.toLowerCase().includes(t)}):p,j=async()=>{if(d){h(!0);try{await a(d.id,m),n(!1),c(null),u("crew"),o("")}finally{h(!1)}}},f=e=>[e.user.firstName,e.user.lastName].filter(Boolean).join(" ")||e.user.email;return(0,t.jsxs)(en.Popover,{open:i,onOpenChange:e=>{n(e),e||(c(null),u("crew"),o(""))},children:[(0,t.jsx)(en.PopoverTrigger,{asChild:!0,children:r||(0,t.jsxs)(V.Button,{variant:"outline",size:"sm",children:[(0,t.jsx)(T.Users,{className:"mr-2 h-4 w-4"}),"Add Team Member"]})}),(0,t.jsxs)(en.PopoverContent,{className:"w-[400px] p-0",align:"start",children:[(0,t.jsxs)(tp.Command,{shouldFilter:!1,children:[(0,t.jsx)(tp.CommandInput,{placeholder:"Search team members...",value:l,onValueChange:o}),(0,t.jsxs)(tp.CommandList,{children:[0===g.length&&(0,t.jsx)(tp.CommandEmpty,{children:l.trim()?"No team members found":"No available team members"}),g.length>0&&(0,t.jsx)(tp.CommandGroup,{heading:"Available Team Members",children:g.map(e=>(0,t.jsxs)("div",{onClick:()=>c(e),className:(0,ep.cn)("relative flex cursor-pointer select-none items-center justify-between gap-2 rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground",d?.id===e.id&&"bg-accent"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"bg-primary/10 text-primary flex h-8 w-8 items-center justify-center rounded-full",children:(0,t.jsx)(D.User,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:f(e)}),e.jobTitle&&(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:e.jobTitle})]})]}),d?.id===e.id&&(0,t.jsx)(eS.Check,{className:"h-4 w-4"})]},e.id))})]})]}),d&&(0,t.jsxs)("div",{className:"space-y-3 border-t p-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)(D.User,{className:"text-muted-foreground h-4 w-4"}),(0,t.jsx)("span",{className:"font-medium",children:f(d)}),d.jobTitle&&(0,t.jsx)(ea.Badge,{variant:"secondary",className:"text-xs",children:d.jobTitle})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-xs font-medium",children:"Role"}),(0,t.jsxs)(W.Select,{value:m,onValueChange:u,children:[(0,t.jsx)(W.SelectTrigger,{className:"h-9",children:(0,t.jsx)(W.SelectValue,{})}),(0,t.jsxs)(W.SelectContent,{children:[(0,t.jsx)(W.SelectItem,{value:"primary",children:"Primary"}),(0,t.jsx)(W.SelectItem,{value:"supervisor",children:"Supervisor"}),(0,t.jsx)(W.SelectItem,{value:"assistant",children:"Assistant"}),(0,t.jsx)(W.SelectItem,{value:"crew",children:"Crew"})]})]})]}),(0,t.jsx)(V.Button,{onClick:j,disabled:x,className:"w-full",size:"sm",children:x?"Assigning...":"Assign to Job"})]})]})]})}var tj=e.i(321369),tf=e.i(799296);function tv({teamMembers:e,onRemoveMember:s}){let a=(0,F.useRouter)(),[r,i]=(0,M.useState)(null),[n,l]=(0,M.useState)(!1),o=(0,M.useRef)(0),d=(0,M.useCallback)(()=>{let e=Date.now();e-o.current<1e3?console.warn("⚠️ Refresh called too frequently, skipping to prevent loop"):(o.current=e,a.refresh())},[a]),c=(0,M.useCallback)(async()=>{if(r&&s){l(!0);try{let e=await s(r);e.success?(eW.toast.success("Team member removed from job"),i(null),d()):eW.toast.error(e.error||"Failed to remove team member")}catch(e){eW.toast.error("Failed to remove team member")}finally{l(!1)}}},[r,s,d]),m=(0,M.useCallback)(e=>{let t=e.team_member.user;return t.name?t.name:t.first_name||t.last_name?[t.first_name,t.last_name].filter(Boolean).join(" "):t.email||"Unknown User"},[]),u=(0,M.useCallback)(e=>{let t=e.team_member.user;if(t.first_name&&t.last_name)return`${t.first_name[0]}${t.last_name[0]}`.toUpperCase();let s=t.name||t.email||"?",a=s.split(" ");return a.length>=2?`${a[0][0]}${a[1][0]}`.toUpperCase():s.substring(0,2).toUpperCase()},[]),x=(0,M.useMemo)(()=>[{key:"name",header:"Name",render:e=>{let s=m(e),a=u(e),r=e.team_member.user.avatar_url;return(0,t.jsxs)(A.default,{className:"flex items-center gap-2.5 text-xs leading-tight hover:underline",href:`/dashboard/team/${e.user_id}`,onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)(es.Avatar,{className:"size-8",children:[r&&(0,t.jsx)(es.AvatarImage,{alt:s,src:r}),(0,t.jsx)(es.AvatarFallback,{className:"bg-primary/10 text-primary text-xs font-semibold",children:a})]}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-foreground font-medium",children:s}),e.team_member.user.email&&(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:e.team_member.user.email})]})]})}},{key:"job_title",header:"Job Title",width:"w-40",shrink:!0,hideOnMobile:!0,render:e=>(0,t.jsx)("span",{className:"text-xs",children:e.team_member.job_title||"—"})},{key:"role",header:"Role",width:"w-32",shrink:!0,render:e=>(0,t.jsx)("span",{className:"text-xs",children:e.role||"Team Member"})},{key:"assigned_at",header:"Assigned Date",width:"w-32",shrink:!0,hideOnMobile:!0,render:e=>(0,t.jsx)("span",{className:"text-xs",children:(0,eC.formatDate)(e.assigned_at,"short")})},{key:"actions",header:"",width:"w-12",shrink:!0,align:"right",render:e=>(0,t.jsxs)(eR.DropdownMenu,{children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(V.Button,{className:"size-8 p-0",size:"sm",variant:"ghost",children:(0,t.jsx)(eH.MoreHorizontal,{className:"size-4"})})}),(0,t.jsxs)(eR.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,t.jsx)(eR.DropdownMenuItem,{className:"cursor-pointer",asChild:!0,children:(0,t.jsxs)(A.default,{href:`/dashboard/team/${e.user_id}`,children:[(0,t.jsx)(eM.Eye,{className:"mr-2 size-4"}),"View Profile"]})}),(0,t.jsx)(eR.DropdownMenuSeparator,{}),(0,t.jsxs)(eR.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>i(e.id),disabled:!s,children:[(0,t.jsx)(tj.UserMinus,{className:"mr-2 size-4"}),"Remove from Job"]})]})]})}],[m,u,s]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eX.FullWidthDataTable,{...eZ.TablePresets.compact(),columns:x,data:e,emptyIcon:(0,t.jsx)(tf.UserX,{className:"text-muted-foreground/50 size-12"}),emptyMessage:"No team members assigned to this job",getItemId:e=>e.id,noPadding:!0,searchFilter:(e,t)=>{let s=t.toLowerCase();return m(e).toLowerCase().includes(s)||e.team_member.user.email?.toLowerCase().includes(s)||e.team_member.job_title?.toLowerCase().includes(s)||e.role?.toLowerCase().includes(s)},searchPlaceholder:"Search team members..."}),(0,t.jsx)(H.Dialog,{onOpenChange:e=>!e&&i(null),open:null!==r,children:(0,t.jsxs)(H.DialogContent,{children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsx)(H.DialogTitle,{children:"Remove Team Member from Job?"}),(0,t.jsx)(H.DialogDescription,{children:"This will remove this team member's assignment to this job. The team member will remain in the system but will no longer be associated with this job."})]}),(0,t.jsxs)(H.DialogFooter,{children:[(0,t.jsx)(V.Button,{disabled:n,onClick:()=>i(null),variant:"outline",children:"Cancel"}),(0,t.jsx)(V.Button,{disabled:n,onClick:c,variant:"destructive",children:n?"Removing...":"Remove Member"})]})]})})]})}var tb=e.i(258978),tN=e.i(487236);function ty({entityData:e,jobData:q,metrics:O}){let J=e||q,ef=J?.job??J??null;if(!ef)return(0,t.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Job Not Found"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"This job may have been deleted or you don't have access to it."})]})});let ev=(0,F.useRouter)(),{toast:eb}=(0,K.useToast)(),eN=(0,eu.useRoleStore)(e=>e.role),[ey,ew]=(0,M.useTransition)(),eC=(0,M.useRef)(0),ek=(0,M.useCallback)(()=>{let e=Date.now();e-eC.current<1e3?console.warn("⚠️ Refresh called too frequently, skipping to prevent loop"):(eC.current=e,ew(()=>{ev.refresh()}))},[ev]),[eS,eD]=(0,M.useState)(()=>J?.job?{...J.job,priority:J.job.priority||"medium"}:{priority:"medium"}),[eT,ez]=(0,M.useState)(!1),[eA,eM]=(0,M.useState)(!1),[eP,eL]=(0,M.useState)(!1),[eB,e$]=(0,M.useState)(!1),[eU,eE]=(0,M.useState)(!1),[eR,eJ]=(0,M.useState)(!1),[eV,eH]=(0,M.useState)(!1),[eW,eY]=(0,M.useState)(!1),[eG,eK]=(0,M.useState)(!1),[eX,eQ]=(0,M.useState)(!1),[eZ,e1]=(0,M.useState)(!1),[e2,e3]=(0,M.useState)(""),[e5,e6]=(0,M.useState)(""),[e7,tt]=(0,M.useState)(""),[ts,ti]=(0,M.useState)(!1),[tn,tl]=(0,M.useState)(!1),[to,td]=(0,M.useState)(!1),[tc,tm]=(0,M.useState)(!1),[tu,tp]=(0,M.useState)(!1),[tj,tf]=(0,M.useState)(!1),[ty,tw]=(0,M.useState)(""),[tC,t_]=(0,M.useState)(""),[tk,tS]=(0,M.useState)(""),[tD,tT]=(0,M.useState)(""),[tz,tA]=(0,M.useState)(!1),[tF,tM]=(0,M.useState)([]),[tP,tI]=(0,M.useState)([]),[tL,tB]=(0,M.useState)([]),[t$,tq]=(0,M.useState)([]),{customer:tU,property:tE,assignedUser:tR,teamAssignments:tO=[],availableTeamMembers:tJ=[],timeEntries:tV=[],invoices:tH=[],estimates:tW=[],payments:tY=[],purchaseOrders:tG=[],tasks:tK=[],photos:tX=[],documents:tQ=[],signatures:tZ=[],activities:t0=[],communications:t1=[],equipment:t2=[],jobEquipment:t4=[],jobMaterials:t3=[],jobNotes:t5=[],schedules:t6=[],allCustomers:t8=[],allProperties:t7=[],companyPhones:t9=[]}=J||{},[se,st]=(0,M.useState)(tW),[ss,sa]=(0,M.useState)(tH),[sr,si]=(0,M.useState)(tY),[sn,sl]=(0,M.useState)(t4),[so,sd]=(0,M.useState)(tK),[sc,sm]=(0,M.useState)(t5),su=(0,M.useRef)(tW),sx=(0,M.useRef)(tH),sh=(0,M.useRef)(tY),sp=(0,M.useRef)(t4),sg=(0,M.useRef)(tK),sj=(0,M.useRef)(t5);(0,M.useEffect)(()=>{let e=tW.length!==su.current.length||tW.some((e,t)=>e?.id!==su.current[t]?.id),t=tH.length!==sx.current.length||tH.some((e,t)=>e?.id!==sx.current[t]?.id),s=tY.length!==sh.current.length||tY.some((e,t)=>e?.id!==sh.current[t]?.id),a=t4.length!==sp.current.length||t4.some((e,t)=>e?.id!==sp.current[t]?.id),r=tK.length!==sg.current.length||tK.some((e,t)=>e?.id!==sg.current[t]?.id),i=t5.length!==sj.current.length||t5.some((e,t)=>e?.id!==sj.current[t]?.id);e&&(st(tW),su.current=tW),t&&(sa(tH),sx.current=tH),s&&(si(tY),sh.current=tY),a&&(sl(t4),sp.current=t4),r&&(sd(tK),sg.current=tK),i&&(sm(t5),sj.current=t5)},[tW,tH,tY,t4,tK,t5]);let sf=(0,M.useMemo)(()=>e?.job_tags?e.job_tags.map(e=>({label:e.name||e.label,color:e.color})):[],[e?.job_tags]);(0,M.useEffect)(()=>{to&&ef?.company_id&&(async()=>{let e=(0,eh.createClient)(),{data:t,error:s}=await e.from("estimates").select(`
					id,
					estimate_number,
					total_amount,
					status,
					created_at,
					customer:customers(id, name)
				`).eq("company_id",ef.company_id).or(`job_id.is.null,job_id.neq.${ef.id}`).order("created_at",{ascending:!1}).limit(50);!s&&t&&tM(t)})()},[to,ef?.company_id,ef?.id]),(0,M.useEffect)(()=>{tc&&ef?.company_id&&(async()=>{let e=(0,eh.createClient)(),{data:t,error:s}=await e.from("invoices").select(`
					id,
					invoice_number,
					total_amount,
					status,
					created_at,
					customer:customers(id, name)
				`).eq("company_id",ef.company_id).or(`job_id.is.null,job_id.neq.${ef.id}`).order("created_at",{ascending:!1}).limit(50);!s&&t&&tI(t)})()},[tc,ef?.company_id,ef?.id]),(0,M.useEffect)(()=>{tu&&ef?.company_id&&(async()=>{let e=(0,eh.createClient)(),{data:t,error:s}=await e.from("payments").select(`
					id,
					amount,
					payment_method,
					reference_number,
					created_at,
					customer:customers(id, name)
				`).eq("company_id",ef.company_id).or(`job_id.is.null,job_id.neq.${ef.id}`).order("created_at",{ascending:!1}).limit(50);!s&&t&&tB(t)})()},[tu,ef?.company_id,ef?.id]),(0,M.useEffect)(()=>{tj&&ef?.company_id&&(async()=>{let e=(0,eh.createClient)(),{data:t,error:s}=await e.from("equipment").select("id, name, category, serial_number, created_at").eq("company_id",ef.company_id).order("created_at",{ascending:!1}).limit(50);!s&&t&&tq(t)})()},[tj,ef?.company_id]);let sv=(0,M.useMemo)(()=>({1:()=>{let e=document.querySelector('[data-section-id="customer"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let t=e.querySelector("[data-accordion-trigger]");t&&"closed"===t.getAttribute("data-state")&&t.click()}},2:()=>{let e=document.querySelector('[data-section-id="team"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let t=e.querySelector("[data-accordion-trigger]");t&&"closed"===t.getAttribute("data-state")&&t.click()}},3:()=>{let e=document.querySelector('[data-section-id="appointments"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let t=e.querySelector("[data-accordion-trigger]");t&&"closed"===t.getAttribute("data-state")&&t.click()}},4:()=>{let e=document.querySelector('[data-section-id="estimates"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let t=e.querySelector("[data-accordion-trigger]");t&&"closed"===t.getAttribute("data-state")&&t.click()}},5:()=>{let e=document.querySelector('[data-section-id="invoices"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let t=e.querySelector("[data-accordion-trigger]");t&&"closed"===t.getAttribute("data-state")&&t.click()}},6:()=>{let e=document.querySelector('[data-section-id="payments"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let t=e.querySelector("[data-accordion-trigger]");t&&"closed"===t.getAttribute("data-state")&&t.click()}},7:()=>{let e=document.querySelector('[data-section-id="purchase-orders"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let t=e.querySelector("[data-accordion-trigger]");t&&"closed"===t.getAttribute("data-state")&&t.click()}},8:()=>{let e=document.querySelector('[data-section-id="tasks"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let t=e.querySelector("[data-accordion-trigger]");t&&"closed"===t.getAttribute("data-state")&&t.click()}},9:()=>{let e=document.querySelector('[data-section-id="notes"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let t=e.querySelector("[data-accordion-trigger]");t&&"closed"===t.getAttribute("data-state")&&t.click()}}}),[]);(0,em.useSectionShortcuts)(sv);let[sb,sN]=(0,M.useState)(tU),[sy,sw]=(0,M.useState)(tE),sC=!!(sy?.lat&&sy?.lon)||!0,[s_,sk]=(0,M.useState)(""),[sS,sD]=(0,M.useState)(""),[sT,sz]=(0,M.useState)("search"),[sA,sF]=(0,M.useState)(!1),[sM,sP]=(0,M.useState)(!1),[sI,sL]=(0,M.useState)(!1),[sB,s$]=(0,M.useState)(!1),[sq,sU]=(0,M.useState)({name:"",address:"",address2:"",city:"",state:"",zipCode:""}),[sE,sR]=(0,M.useState)(!1),[sO,sJ]=(0,M.useState)(!1),sV=M.default.useRef(null),sH=(0,ex.useUIStore)(e=>e.setIncomingCall),sW=sb?.id?t7.filter(e=>e.customer_id===sb.id):[],sY=(e,t)=>{eD({...eS,[e]:t}),ez(!0)},sG=async()=>{if(!sb?.id)return void eb.error("Please select a customer first");s$(!0);try{let e=new FormData;e.append("customerId",sb.id),e.append("name",sq.name),e.append("address",sq.address),e.append("address2",sq.address2),e.append("city",sq.city),e.append("state",sq.state),e.append("zipCode",sq.zipCode);let t=await U(e);if(t.success&&t.data){let e=new FormData;e.append("propertyId",t.data);let s=await (0,$.updateJob)(ef.id,e);s.success?(eb.success("Property created and assigned successfully"),sL(!1),sU({name:"",address:"",address2:"",city:"",state:"",zipCode:""})):eb.error(s.error||"Failed to assign property to job")}else eb.error(t.error??"Failed to create property")}catch(e){eb.error("Failed to create property")}finally{s$(!1)}},sK=async(e,t)=>{try{let s=await E({jobId:ef.id,teamMemberId:e,role:t});s.success?(eb.success("Team member assigned"),ek()):(console.error("Assignment failed:",s.error,s),eb.error(s.error||"Failed to assign team member"))}catch(t){console.error("Failed to assign team member:",t);let e=t instanceof Error?t.message:"Failed to assign team member";eb.error(e)}},sX=async e=>{try{let t=await R({jobId:ef.id,teamMemberId:e});if(t.success)return eb.success("Team member removed"),ek(),{success:!0};{let e=t.error||"Failed to remove team member";return eb.error(e),{success:!1,error:e}}}catch(t){console.error("Failed to remove team member:",t);let e=t instanceof Error?t.message:"Failed to remove team member";return eb.error(e),{success:!1,error:e}}};t8.filter(e=>{if(!s_)return!0;let t=s_.toLowerCase(),s=`${e.first_name} ${e.last_name}`.toLowerCase(),a=e.phone?.toLowerCase()||"",r=e.email?.toLowerCase()||"",i=e.company_name?.toLowerCase()||"";return s.includes(t)||a.includes(t)||r.includes(t)||i.includes(t)}),sW.filter(e=>{if(!sS)return!0;let t=sS.toLowerCase(),s=e.name?.toLowerCase()||"",a=e.address?.toLowerCase()||"",r=e.city?.toLowerCase()||"";return s.includes(t)||a.includes(t)||r.includes(t)});let sQ=async()=>{let e={...eS};eM(!0);try{let t=new FormData;eS.title!==J.job.title&&t.append("title",eS.title),eS.description!==J.job.description&&t.append("description",eS.description||""),eS.status!==J.job.status&&t.append("status",eS.status),eS.priority!==J.job.priority&&t.append("priority",eS.priority||"medium"),eS.job_type!==J.job.job_type&&t.append("jobType",eS.job_type||""),eS.notes!==J.job.notes&&t.append("notes",eS.notes||"");let s=await (0,$.updateJob)(J.job.id,t);if(s.success){eb.success("Changes saved successfully"),ez(!1);let e={...eS};t.has("title")&&(e.title=t.get("title")),t.has("description")&&(e.description=t.get("description")),t.has("status")&&(e.status=t.get("status")),t.has("priority")&&(e.priority=t.get("priority")),t.has("jobType")&&(e.job_type=t.get("jobType")),t.has("notes")&&(e.notes=t.get("notes")),eD(e)}else eD(e),ez(!1),eb.error(s.error||"Failed to save changes - changes reverted")}catch(t){eD(e),ez(!1),eb.error("Failed to save changes - changes reverted")}finally{eM(!1)}},sZ=async e=>{let t=new FormData;void 0!==e.labor_hours_estimated&&t.append("labor_hours_estimated",e.labor_hours_estimated.toString()),void 0!==e.labor_hours_actual&&t.append("labor_hours_actual",e.labor_hours_actual.toString()),void 0!==e.labor_rate&&t.append("labor_rate",e.labor_rate.toString()),void 0!==e.labor_burden_percent&&t.append("labor_burden_percent",e.labor_burden_percent.toString()),void 0!==e.labor_cost_total&&t.append("labor_cost_total",e.labor_cost_total.toString()),void 0!==e.materials_cost_actual&&t.append("materials_cost_actual",e.materials_cost_actual.toString()),void 0!==e.materials_markup_percent&&t.append("materials_markup_percent",e.materials_markup_percent.toString()),void 0!==e.materials_revenue&&t.append("materials_revenue",e.materials_revenue.toString()),void 0!==e.equipment_cost&&t.append("equipment_cost",e.equipment_cost.toString()),void 0!==e.subcontractor_cost&&t.append("subcontractor_cost",e.subcontractor_cost.toString()),void 0!==e.overhead_allocation&&t.append("overhead_allocation",e.overhead_allocation.toString()),void 0!==e.total_cost_actual&&t.append("total_cost_actual",e.total_cost_actual.toString()),void 0!==e.total_revenue&&t.append("total_revenue",e.total_revenue.toString()),void 0!==e.profit_margin_actual&&t.append("profit_margin_actual",e.profit_margin_actual.toString()),void 0!==e.profit_margin_target&&t.append("profit_margin_target",e.profit_margin_target.toString());let s=await (0,$.updateJob)(ef.id,t);if(s.success)eb.success("Job costing updated successfully");else throw eb.error(s.error||"Failed to update job costing"),Error(s.error||"Failed to update job costing")},s0=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e/100),s1=e=>e?new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}).format(new Date(e)):"Not set",s2=e=>{if(!e)return"—";let t="string"==typeof e||"number"==typeof e?new Date(e):e;if(!t||Number.isNaN(t.getTime()))return"—";let s=Math.round((t.getTime()-Date.now())/6e4),a=new Intl.RelativeTimeFormat("en",{numeric:"auto"});if(60>Math.abs(s))return a.format(s,"minute");let r=Math.round(s/60);if(24>Math.abs(r))return a.format(r,"hour");let i=Math.round(r/24);if(30>Math.abs(i))return a.format(i,"day");let n=Math.round(i/30);if(12>Math.abs(n))return a.format(n,"month");let l=Math.round(n/12);return a.format(l,"year")},s4=sb?`/dashboard/customers/${sb.id}`:null,s3=e=>{if(!e)return null;if("string"==typeof e)try{return JSON.parse(e)}catch{return null}return"object"==typeof e?e:null},s5=(0,M.useMemo)(()=>{let e=e=>e.filter(e=>"string"==typeof e&&e.trim().length>0).map(e=>e.trim());if(!sb?.tags)return[];if(Array.isArray(sb.tags))return e(sb.tags);if("string"==typeof sb.tags)try{let t=JSON.parse(sb.tags);if(Array.isArray(t))return e(t);if("string"==typeof t)return t.split(",").map(e=>e.trim()).filter(Boolean)}catch{return sb.tags.split(",").map(e=>e.trim()).filter(Boolean)}return[]},[sb?.tags]),s6=(0,M.useMemo)(()=>{let e=s3(sb?.metadata);return e&&"object"==typeof e?e:{}},[sb?.metadata,s3]),s8=(0,M.useMemo)(()=>{let e=s3(sb?.communication_preferences);return e&&"object"==typeof e?e:null},[sb?.communication_preferences,s3]),s7=(0,M.useMemo)(()=>{let e=s6.membershipTier||s6.membership_level||s6.membership||s6.plan;return e||(s5.find(e=>{if("string"!=typeof e)return!1;let t=e.toLowerCase();return["vip","member","plan","tier","priority"].some(e=>t.includes(e))})??null)},[s6,s5]),s9=sb?.outstanding_balance??sb?.outstandingBalance??0,ae=(0,M.useMemo)(()=>sb?"blocked"===(sb.status||"").toLowerCase()?{tone:"destructive",label:"Credit Hold",description:"Account is blocked until balance issues are resolved."}:s9>0?{tone:"warning",label:"Balance Due",description:`${s0(s9)} outstanding`}:"inactive"===(sb.status||"").toLowerCase()?{tone:"warning",label:"Inactive",description:"Customer marked inactive. Reactivate to schedule work."}:{tone:"positive",label:"In Good Standing",description:"No outstanding balances or restrictions."}:{tone:"neutral",label:"No customer",description:""},[sb,s9,s0]),at={positive:"border-emerald-100 bg-emerald-50 text-emerald-700 dark:border-emerald-400/20 dark:bg-emerald-400/10 dark:text-emerald-200",warning:"border-warning bg-warning text-warning dark:border-warning/20 dark:bg-warning/10 dark:text-warning",destructive:"border-rose-100 bg-rose-50 text-rose-700 dark:border-rose-400/20 dark:bg-rose-400/10 dark:text-rose-200",neutral:"border-muted bg-muted/40 text-muted-foreground dark:border-muted/30 dark:bg-muted/20 dark:text-muted-foreground"},as=at[ae.tone]??at.neutral,aa=(sb?.payment_terms??sb?.paymentTerms??"due_on_receipt").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),ar=sb?.credit_limit??sb?.creditLimit??0,ai=(0,M.useMemo)(()=>(Array.isArray(ss)?ss:[]).filter(e=>["sent","viewed","partial","overdue"].includes((e?.status||"").toLowerCase())),[ss]),an=(0,M.useMemo)(()=>{let e=Date.now();return ai.filter(t=>{if("overdue"===(t?.status||"").toLowerCase())return!0;let s=t?.due_date??t?.dueDate??t?.due_on??t?.dueOn;if(!s)return!1;let a=new Date(s);return!Number.isNaN(a.getTime())&&a.getTime()<e})},[ai]);(0,M.useMemo)(()=>ai.reduce((e,t)=>e+((t?.balance_amount??t?.balanceAmount??0)||0),0),[ai]);let al=(0,M.useMemo)(()=>{let e=ai.map(e=>{let t=e?.due_date??e?.dueDate??e?.due_on??e?.dueOn;return{invoice:e,dueDate:t?new Date(t):null}}).filter(e=>e.dueDate&&!Number.isNaN(e.dueDate.getTime())).sort((e,t)=>e.dueDate?.getTime()-t.dueDate?.getTime());return e[0]?.invoice??null},[ai]),ao=(0,M.useMemo)(()=>{let e=Array.isArray(t6)?t6:[],t=Date.now();return e.map(e=>{let t=e?.start_time??e?.startTime??e?.start_at??e?.startAt;return{schedule:e,startDate:t?new Date(t):null}}).filter(({startDate:e})=>e&&!Number.isNaN(e.getTime())&&e.getTime()>t).sort((e,t)=>e.startDate?.getTime()-t.startDate?.getTime()).map(({schedule:e})=>e)},[t6])[0]??null,ad=t1?.[0]??null,ac=(0,M.useMemo)(()=>s8?[{key:"email",label:"Email",enabled:s8.email??s8.Email??!0},{key:"sms",label:"SMS",enabled:s8.sms??s8.SMS??!1},{key:"phone",label:"Phone",enabled:s8.phone??s8.Phone??!1}]:null,[s8]),am=sb?.preferred_contact_method??sb?.preferredContactMethod??("string"==typeof s8?.preferred?s8?.preferred:null)??"email",au=am?am.replace(/_/g," "):"Not set",ax=sb?.source??s6?.source??s6?.acquiredVia??"—",ah=sb?.portal_enabled??sb?.portalEnabled??!1,ap=sb?.portal_last_login_at??sb?.portalLastLoginAt??null,ag=sb?.created_at??sb?.createdAt??null;sb?.last_invoice_date??sb?.lastInvoiceDate,sb?.last_payment_date??sb?.lastPaymentDate;let aj=sb?.last_job_date??sb?.lastJobDate??null,af=sb?.average_job_value??sb?.averageJobValue??0,av=sb?.total_revenue??sb?.totalRevenue??0,ab=sb?.total_jobs??sb?.totalJobs??0;ai.length;let aN=an.length;sb?.internal_notes??sb?.internalNotes;let ay=(0,M.useMemo)(()=>{if(!Array.isArray(tO)||0===tO.length)return[];let e=new Set;return tO.map(t=>{let s=t?.team_member||t?.teamMember;if(!s)return null;let a=s.users||s.user||t?.user||t?.assigned_user,r=s.id??t.id;return!r||e.has(r)?null:(e.add(r),{id:r,userId:a?.id??s.user_id??t.user_id??null,name:a?.name??s.name??s.display_name??"Team member",title:s.job_title??t.job_title??t.role??a?.job_title??null,avatar:a?.avatar??a?.avatar_url??a?.profile_image_url??s.avatar??null,email:a?.email??s.email??null})}).filter(Boolean)},[tO]),aw=(0,M.useMemo)(()=>Array.isArray(tO)&&0!==tO.length?Array.from(new Set(tO.map(e=>e.team_member_id||e.teamMemberId||e.team_member?.id||e.id||null).filter(e=>!!e))):[],[tO]);[sb?.address,sb?.city,sb?.state,sb?.zip_code??sb?.zipCode].filter(Boolean).join(", ");let aC=sb?.secondary_phone??sb?.secondaryPhone??null,a_=sb?.billing_email??sb?.billingEmail??sb?.email??null;ad?.created_at??ad?.createdAt,ad?.channel??ad?.type??ad?.medium,al?.due_date??al?.dueDate??al?.due_on??al?.dueOn,al?.balance_amount??al?.balanceAmount;let ak=(sb?.status||"active").replace(/_/g," ");(ef?[(0,t.jsxs)(ea.Badge,{className:"font-mono text-xs",variant:"secondary",children:["#",ef.job_number]},"job-number"),eS.status?(0,t.jsx)(ea.Badge,{className:"font-medium capitalize",variant:(e=>{switch(e?.toLowerCase()){case"paid":case"approved":case"completed":case"in_progress":return"default";case"sent":case"scheduled":case"confirmed":default:return"secondary";case"overdue":case"cancelled":case"no_show":return"destructive";case"rescheduled":case"draft":case"pending":return"outline"}})(eS.status),children:eS.status.replace(/_/g," ")},"job-status"):null,eS.priority?(0,t.jsx)(ea.Badge,{className:"font-medium capitalize",variant:"high"===eS.priority||"urgent"===eS.priority?"destructive":"outline",children:eS.priority},"job-priority"):null]:[]).filter(Boolean);let aS=async()=>{eJ(!0);try{let e=await (0,I.archiveJob)(ef.id);e.success?(eb.success("Job archived successfully"),eE(!1),ev.push("/dashboard/work")):eb.error(e.error||"Failed to archive job")}catch{eb.error("Failed to archive job")}finally{eJ(!1)}};sb&&(A.default,sb.id,D.User,sb.first_name,sb.last_name),sy&&(t.Fragment,A.default,sy.id,g.MapPin,sy.city,sy.state,sy.zip_code||sy.zipCode),eT&&[].unshift((0,t.jsx)(V.Button,{onClick:()=>{eD({...ef,priority:ef.priority||"medium"}),ez(!1)},size:"sm",variant:"outline",children:"Cancel"},"cancel"),(0,t.jsxs)(V.Button,{disabled:eA,onClick:sQ,size:"sm",children:[(0,t.jsx)(y.Save,{className:"mr-2 h-4 w-4"}),eA?"Saving...":"Save Changes"]},"save"));let aD={title:(0,t.jsx)(e_,{job:eS,customer:sb,property:sy,metrics:O,teamAssignments:tO,timeEntries:tV,invoices:ss,payments:sr,estimates:se,userRole:eN,onTitleChange:e=>sY("title",e),onSave:sQ,onCancel:()=>{eD({...ef,priority:ef.priority||"medium"}),ez(!1)},isSaving:eA,hasChanges:eT})};(0,M.useMemo)(()=>sy?{address:sy.address,city:sy.city,state:sy.state,zip_code:sy.zip_code,lat:sy.lat,lon:sy.lon}:void 0,[sy?.address,sy?.city,sy?.state,sy?.zip_code,sy?.lat,sy?.lon]);let aT=(0,t.jsx)("div",{className:"space-y-3",children:(0,t.jsx)(Z.DetailPageSurface,{padding:"sm",variant:"default",className:"rounded-xl",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,t.jsx)(Y.StandardFormField,{label:"Status",className:"mb-0 min-w-[140px]",children:(0,t.jsx)(tx,{currentStatus:eS.status||"quoted",onStatusChange:e=>sY("status",e),job:{id:J.job.id,scheduled_start:eS.scheduled_start||J.job.scheduled_start,scheduled_end:eS.scheduled_end||J.job.scheduled_end,assigned_to:eS.assigned_to||J.job.assigned_to,customer_id:eS.customer_id||J.job.customer_id,property_id:eS.property_id||J.property?.id,total_amount:eS.total_amount||J.job.total_amount,invoices:J.invoices,estimates:J.estimates,teamAssignments:J.teamAssignments}})}),(0,t.jsx)(Y.StandardFormField,{label:"Priority",className:"mb-0 min-w-[120px]",children:(0,t.jsxs)(W.Select,{onValueChange:e=>sY("priority",e),value:eS.priority||void 0,children:[(0,t.jsx)(W.SelectTrigger,{className:"h-8",children:(0,t.jsx)(W.SelectValue,{placeholder:"Set priority",children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(a.AlertCircle,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"capitalize text-xs",children:eS.priority||"Set priority"})]})})}),(0,t.jsxs)(W.SelectContent,{children:[(0,t.jsx)(W.SelectItem,{value:"low",children:"Low"}),(0,t.jsx)(W.SelectItem,{value:"medium",children:"Medium"}),(0,t.jsx)(W.SelectItem,{value:"high",children:"High"}),(0,t.jsx)(W.SelectItem,{value:"urgent",children:"Urgent"})]})]})}),sy&&(0,t.jsx)(Y.StandardFormField,{label:"Travel",className:"mb-0",children:(0,t.jsx)(tb.TravelTime,{property:sy})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-4 lg:grid-cols-6",children:[sb&&(0,t.jsxs)(en.Popover,{children:[(0,t.jsx)(en.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)("button",{className:"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50",children:[(0,t.jsxs)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1",children:[(0,t.jsx)(D.User,{className:"h-2.5 w-2.5"}),"Customer"]}),(0,t.jsx)("div",{className:"text-xs font-medium truncate",children:sb.display_name||`${sb.first_name} ${sb.last_name}`}),(0,t.jsx)("div",{className:"text-[10px] text-muted-foreground truncate",children:sb.phone||sb.email||sb.type||""})]})}),(0,t.jsx)(en.PopoverContent,{className:"w-64",align:"start",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Name"}),(0,t.jsx)(A.default,{href:`/dashboard/customers/${sb.id}`,className:"text-sm font-medium text-primary hover:underline",children:sb.display_name||`${sb.first_name} ${sb.last_name}`})]}),sb.phone&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Phone"}),(0,t.jsx)("a",{href:`tel:${sb.phone}`,className:"text-sm text-primary hover:underline",children:sb.phone})]}),sb.email&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Email"}),(0,t.jsx)("a",{href:`mailto:${sb.email}`,className:"text-sm text-primary hover:underline",children:sb.email})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Type"}),(0,t.jsx)(ea.Badge,{variant:"outline",className:"text-xs",children:sb.type||"residential"})]})]})})]}),sy&&(0,t.jsxs)(en.Popover,{children:[(0,t.jsx)(en.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)("button",{className:"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50",children:[(0,t.jsxs)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1",children:[(0,t.jsx)(g.MapPin,{className:"h-2.5 w-2.5"}),"Location"]}),(0,t.jsx)("div",{className:"text-xs font-medium truncate",children:sy.address}),(0,t.jsxs)("div",{className:"text-[10px] text-muted-foreground truncate",children:[sy.city,", ",sy.state]})]})}),(0,t.jsx)(en.PopoverContent,{className:"w-64",align:"start",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Address"}),(0,t.jsxs)("div",{className:"text-sm",children:[sy.address,sy.address_line2&&`, ${sy.address_line2}`,(0,t.jsx)("br",{}),sy.city,", ",sy.state," ",sy.zip]}),sy.lat&&sy.lon&&(0,t.jsxs)("a",{href:`https://www.google.com/maps?q=${sy.lat},${sy.lon}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline mt-1 inline-flex items-center gap-1",children:[(0,t.jsx)(m.ExternalLink,{className:"h-3 w-3"}),"Open in Maps"]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Type"}),(0,t.jsx)(ea.Badge,{variant:"outline",className:"text-xs",children:sy.property_type||"Unknown"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Access"}),sy.access_code?(0,t.jsx)("code",{className:"text-xs bg-muted px-1.5 py-0.5 rounded",children:sy.access_code}):(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"None"})]})]})]})})]}),(0,t.jsxs)(en.Popover,{children:[(0,t.jsx)(en.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)("button",{className:"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50",children:[(0,t.jsxs)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1",children:[(0,t.jsx)(i.Calendar,{className:"h-2.5 w-2.5"}),"Schedule"]}),eS.scheduled_start?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"text-xs font-medium",children:new Date(eS.scheduled_start).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}),(0,t.jsxs)("div",{className:"text-[10px] text-muted-foreground",children:[tO?.length||0," tech",tO?.length!==1?"s":""]})]}):(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Not scheduled"})]})}),(0,t.jsx)(en.PopoverContent,{className:"w-64",align:"start",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Start"}),(0,t.jsx)("div",{className:"text-sm",children:eS.scheduled_start?s1(eS.scheduled_start):"Not set"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"End"}),(0,t.jsx)("div",{className:"text-sm",children:eS.scheduled_end?s1(eS.scheduled_end):"Not set"})]})]}),tO&&tO.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-xs text-muted-foreground mb-1",children:["Team (",tO.length,")"]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:tO.map(e=>(0,t.jsx)(ea.Badge,{variant:"secondary",className:"text-xs",children:e.user?.name||"Unknown"},e.id))})]})]})})]}),(0,t.jsxs)(en.Popover,{children:[(0,t.jsx)(en.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)("button",{className:"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50",children:[(0,t.jsxs)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1",children:[(0,t.jsx)(d.DollarSign,{className:"h-2.5 w-2.5"}),"Financial"]}),(0,t.jsx)("div",{className:"text-xs font-semibold",children:s0(eS.total_amount||0)}),(0,t.jsx)("div",{className:"text-[10px] text-muted-foreground",children:sr&&sr.length>0?`${s0(sr.reduce((e,t)=>e+(t.amount||0),0))} paid`:"$0 paid"})]})}),(0,t.jsx)(en.PopoverContent,{className:"w-64",align:"start",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Job Value"}),(0,t.jsx)("div",{className:"text-sm font-semibold",children:s0(eS.total_amount||0)})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Payments"}),(0,t.jsx)("div",{className:"text-sm font-semibold text-green-600 dark:text-green-400",children:sr&&sr.length>0?s0(sr.reduce((e,t)=>e+(t.amount||0),0)):"$0"}),(0,t.jsxs)("div",{className:"text-[10px] text-muted-foreground",children:[sr?.length||0," payment",sr?.length!==1?"s":""]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Estimates"}),(0,t.jsx)("div",{className:"text-sm",children:se?.length||0}),se&&se.length>0&&(0,t.jsx)(ea.Badge,{variant:se.some(e=>"accepted"===e.status)?"default":"secondary",className:"text-[10px] mt-0.5",children:se.find(e=>"accepted"===e.status)?"Accepted":"Pending"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Invoices"}),(0,t.jsx)("div",{className:"text-sm",children:ss?.length||0})]})]})]})})]}),(0,t.jsxs)(en.Popover,{children:[(0,t.jsx)(en.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)("button",{className:"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50",children:[(0,t.jsxs)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1",children:[(0,t.jsx)(j.MessageSquare,{className:"h-2.5 w-2.5"}),"Activity"]}),(0,t.jsxs)("div",{className:"text-xs font-medium",children:[(t1?.length||0)+(sc?.length||0)+(tX?.length||0)+(tQ?.length||0)," ","items"]}),(0,t.jsxs)("div",{className:"text-[10px] text-muted-foreground",children:[t1?.length||0," msg • ",sc?.length||0," ","notes"]})]})}),(0,t.jsx)(en.PopoverContent,{className:"w-64",align:"start",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Messages"}),(0,t.jsx)("div",{className:"text-sm font-semibold",children:t1?.length||0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),(0,t.jsx)("div",{className:"text-sm font-semibold",children:sc?.length||0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Photos"}),(0,t.jsx)("div",{className:"text-sm font-semibold",children:tX?.length||0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Documents"}),(0,t.jsx)("div",{className:"text-sm font-semibold",children:tQ?.length||0})]})]})})]}),(0,t.jsxs)(er.Collapsible,{children:[(0,t.jsx)(er.CollapsibleTrigger,{asChild:!0,children:(0,t.jsxs)("button",{className:"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50 w-full",children:[(0,t.jsxs)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1",children:[(0,t.jsx)(z.Wrench,{className:"h-2.5 w-2.5"}),"Service"]}),(0,t.jsx)("div",{className:"text-xs font-medium truncate",children:eS.service_type||eS.job_type||"Not set"}),(0,t.jsxs)("div",{className:"text-[10px] text-muted-foreground",children:[sn?.length||0," equipment"]})]})}),(0,t.jsx)(er.CollapsibleContent,{className:"mt-2",children:(0,t.jsxs)("div",{className:"space-y-2 p-2 bg-muted/30 rounded-md",children:[(0,t.jsx)(Y.StandardFormField,{label:"Service Type",htmlFor:"service-type",className:"mb-0",children:(0,t.jsx)(ei.Input,{id:"service-type",onChange:e=>sY("service_type",e.target.value),placeholder:"e.g. HVAC Maintenance",value:eS.service_type||eS.job_type||"",className:"h-8 text-sm"})}),sn&&sn.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Equipment"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1.5",children:sn.map(e=>(0,t.jsx)(ea.Badge,{variant:"outline",className:"text-xs",children:e.equipment?.name||e.equipment_id},e.id))})]}),(0,t.jsx)(Y.StandardFormField,{label:"Description",htmlFor:"job-description",className:"mb-0",children:(0,t.jsx)(G.Textarea,{id:"job-description",onChange:e=>sY("description",e.target.value),placeholder:"Add context, expectations, or key notes for the crew.",value:eS.description||"",className:"min-h-[60px] text-sm"})})]})})]})]}),(0,t.jsx)("div",{className:"flex justify-end pt-2 border-t border-border/40",children:(0,t.jsx)(ta,{currentStatus:ef.status,jobId:ef.id})})]})})}),az=[];az.push({id:"customer",title:"Customer & Property",icon:(0,t.jsx)(D.User,{className:"size-4"}),count:+!!sb,actions:(0,t.jsx)(eO,{currentCustomer:sb?{id:sb.id,first_name:sb.first_name||"",last_name:sb.last_name||"",display_name:sb.display_name||"",email:sb.email||"",phone:sb.phone||"",company_name:sb.company_name,type:sb.type||"residential",address:sb.address,city:sb.city,state:sb.state,zip:sb.zip}:null,currentProperty:sy?{id:sy.id,customer_id:sy.customer_id,address:sy.address||"",address_line2:sy.address_line2,city:sy.city||"",state:sy.state||"",zip:sy.zip||"",property_type:sy.property_type}:null,getCustomerProperties:eg,onAssignCustomer:async(e,t)=>{let s=await (0,L.assignCustomerToJob)(ef.id,e.id,t?.id||null);s.success?(sN(e),sw(t??null),eb.success("Customer and property assigned successfully"),ek()):eb.error(s.error||"Failed to assign customer")},onRemoveCustomer:async()=>{let e=await (0,B.removeCustomerFromJob)(ef.id);e.success?(sN(null),sw(null),eb.success("Customer and property removed successfully"),ek()):eb.error(e.error||"Failed to remove customer")},onRemoveProperty:async()=>{if(!sb)return;let e=await (0,L.assignCustomerToJob)(ef.id,sb.id,null);e.success?(sw(null),eb.success("Property removed from job"),ek()):eb.error(e.error||"Failed to remove property")},searchCustomers:ej}),content:(0,t.jsx)(ec.UnifiedAccordionContent,{className:"space-y-6",children:(0,t.jsxs)("div",{className:"flex flex-col gap-6 lg:flex-row",children:[sb?(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col gap-6",children:[(0,t.jsx)("div",{className:"border-border/60 bg-card/80 rounded-xl border p-6 shadow-sm",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-6",children:[(0,t.jsxs)("div",{className:"flex min-w-0 items-start gap-4",children:[(0,t.jsxs)("div",{className:"bg-primary/10 text-primary flex size-14 flex-shrink-0 items-center justify-center rounded-full text-xl font-semibold",children:[sb.first_name?.[0],sb.last_name?.[0]]}),(0,t.jsxs)("div",{className:"min-w-0 space-y-1.5",children:[s4?(0,t.jsxs)(A.default,{className:"text-foreground hover:text-primary block text-lg font-semibold transition-colors",href:s4,children:[sb.first_name," ",sb.last_name]}):(0,t.jsxs)("span",{className:"text-foreground block text-lg font-semibold",children:[sb.first_name," ",sb.last_name]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)(ea.Badge,{className:"h-6 rounded-full px-2.5 text-[11px] font-medium capitalize",variant:"outline",children:ak}),(0,t.jsxs)("span",{className:(0,ep.cn)("inline-flex items-center gap-1 rounded-full border px-2.5 py-0.5 text-[11px] font-medium",as),title:ae.description,children:[(0,t.jsx)(w.ShieldCheck,{className:"h-3 w-3"}),ae.label]}),s7&&(0,t.jsxs)("span",{className:"bg-primary/10 text-primary inline-flex items-center gap-1 rounded-full px-2.5 py-0.5 text-[11px] font-medium",children:[(0,t.jsx)(C.Sparkles,{className:"h-3 w-3"}),s7]})]})]})]}),s4&&(0,t.jsx)(V.Button,{asChild:!0,className:"flex-shrink-0",size:"sm",variant:"outline",children:(0,t.jsxs)(A.default,{className:"flex items-center gap-1.5",href:s4,children:["View Profile",(0,t.jsx)(o.ChevronRight,{className:"h-3.5 w-3.5"})]})})]})}),(0,t.jsx)("div",{className:"border-border/60 bg-card/80 rounded-xl border shadow-sm",children:(0,t.jsxs)("div",{className:"divide-border/40 bg-muted/20 grid grid-cols-2 divide-x divide-y sm:divide-y-0 md:grid-cols-4 px-4 py-4 sm:px-6",children:[(0,t.jsxs)("div",{className:"px-3 py-3 first:pl-0 last:pr-0 sm:py-0",children:[(0,t.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Lifetime Value"}),(0,t.jsx)("div",{className:"text-foreground mt-1 text-lg font-bold",children:s0(av)}),(0,t.jsxs)("div",{className:"text-muted-foreground mt-0.5 text-xs",children:[ab," job",1===ab?"":"s"," ·"," ",s0(af)," avg"]})]}),(0,t.jsxs)("div",{className:"px-3 py-3 first:pl-0 last:pr-0 sm:py-0",children:[(0,t.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Balance Due"}),(0,t.jsx)("div",{className:(0,ep.cn)("mt-1 text-lg font-bold",s9>0?"text-warning":"text-foreground"),children:s0(s9)}),(0,t.jsx)("div",{className:"text-muted-foreground mt-0.5 text-xs",children:aN>0?`${aN} overdue`:aa})]}),(0,t.jsxs)("div",{className:"px-3 py-3 first:pl-0 last:pr-0 sm:py-0",children:[(0,t.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Credit Limit"}),(0,t.jsx)("div",{className:"text-foreground mt-1 text-lg font-bold",children:ar>0?s0(ar):"None"}),(0,t.jsx)("div",{className:"text-muted-foreground mt-0.5 text-xs",children:ar>0&&s9>0?`${Math.round(s9/ar*100)}% used`:ar>0?"Available":"Cash only"})]}),(0,t.jsxs)("div",{className:"px-3 py-3 first:pl-0 last:pr-0 sm:py-0",children:[(0,t.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Customer Since"}),(0,t.jsx)("div",{className:"text-foreground mt-1 text-lg font-bold",children:ag?s2(ag):"—"}),(0,t.jsxs)("div",{className:"text-muted-foreground mt-0.5 text-xs capitalize",children:["via ",ax]})]})]})}),(0,t.jsx)("div",{className:"border-border/60 bg-card/80 rounded-xl border p-6 shadow-sm",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Contact"}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[sb.email&&(0,t.jsx)(V.Button,{className:"h-7 w-7 p-0",onClick:()=>{let e=new URLSearchParams;e.set("compose","true"),e.set("to",sb.email),e.set("name",`${sb.first_name} ${sb.last_name}`),e.set("customerId",sb.id),ev.push(`/dashboard/communication/email?${e.toString()}`)},size:"sm",title:"Send Email",variant:"outline",children:(0,t.jsx)(p.Mail,{className:"h-3.5 w-3.5"})}),sb.phone&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(V.Button,{className:"h-7 w-7 p-0",onClick:()=>{sH({number:sb.phone,name:`${sb.first_name} ${sb.last_name}`,avatar:sb.avatar_url})},size:"sm",title:"Call",variant:"outline",children:(0,t.jsx)(v.Phone,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(V.Button,{className:"h-7 w-7 p-0",onClick:()=>sR(!0),size:"sm",title:"Send Text Message",variant:"outline",children:(0,t.jsx)(j.MessageSquare,{className:"h-3.5 w-3.5"})})]})]})]}),(0,t.jsxs)("dl",{className:"grid gap-3",children:[sb.email&&(0,t.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,t.jsx)("div",{className:"bg-muted flex size-8 flex-shrink-0 items-center justify-center rounded-lg",children:(0,t.jsx)(p.Mail,{className:"text-muted-foreground h-3.5 w-3.5"})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("dt",{className:"text-muted-foreground text-[10px] font-medium tracking-wide uppercase",children:"Email"}),(0,t.jsx)("dd",{className:"text-foreground truncate text-sm font-medium",children:sb.email})]})]}),sb.phone&&(0,t.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,t.jsx)("div",{className:"bg-muted flex size-8 flex-shrink-0 items-center justify-center rounded-lg",children:(0,t.jsx)(v.Phone,{className:"text-muted-foreground h-3.5 w-3.5"})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("dt",{className:"text-muted-foreground text-[10px] font-medium tracking-wide uppercase",children:"Phone"}),(0,t.jsx)("dd",{className:"text-foreground text-sm font-medium",children:sb.phone})]})]}),aC&&(0,t.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,t.jsx)("div",{className:"bg-muted flex size-8 flex-shrink-0 items-center justify-center rounded-lg",children:(0,t.jsx)(v.Phone,{className:"text-muted-foreground h-3.5 w-3.5"})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("dt",{className:"text-muted-foreground text-[10px] font-medium tracking-wide uppercase",children:"Alt Phone"}),(0,t.jsx)("dd",{className:"text-foreground text-sm font-medium",children:aC})]})]}),a_&&a_!==sb.email&&(0,t.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,t.jsx)("div",{className:"bg-muted flex size-8 flex-shrink-0 items-center justify-center rounded-lg",children:(0,t.jsx)(N.Receipt,{className:"text-muted-foreground h-3.5 w-3.5"})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("dt",{className:"text-muted-foreground text-[10px] font-medium tracking-wide uppercase",children:"Billing Email"}),(0,t.jsx)("dd",{className:"text-foreground truncate text-sm font-medium",children:a_})]})]})]})]})}),(0,t.jsx)("div",{className:"border-border/60 bg-card/80 rounded-xl border p-6 shadow-sm",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Account Details"}),(0,t.jsxs)("dl",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("dt",{className:"text-muted-foreground text-xs",children:"Portal Access"}),(0,t.jsx)("dd",{className:"text-foreground mt-1 text-sm font-medium",children:ah?(0,t.jsxs)("span",{className:"inline-flex items-center gap-1.5 text-emerald-700 dark:text-emerald-200",children:[(0,t.jsx)(x.Globe,{className:"h-3.5 w-3.5"})," Enabled"]}):(0,t.jsx)("span",{className:"text-muted-foreground",children:"Disabled"})}),ah&&ap&&(0,t.jsxs)("dd",{className:"text-muted-foreground mt-0.5 text-xs",children:["Last login ",s2(ap)]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("dt",{className:"text-muted-foreground text-xs",children:"Preferred Contact"}),(0,t.jsx)("dd",{className:"text-foreground mt-1 text-sm font-medium capitalize",children:au}),ac&&(0,t.jsx)("dd",{className:"mt-1.5 flex flex-wrap gap-1.5",children:ac.map(e=>e.enabled&&(0,t.jsx)("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-700 dark:bg-emerald-400/10 dark:text-emerald-200",children:e.label},e.key))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("dt",{className:"text-muted-foreground text-xs",children:"Last Activity"}),(0,t.jsx)("dd",{className:"text-foreground mt-1 text-sm font-medium",children:aj?s2(aj):"No activity"}),ao&&(0,t.jsxs)("dd",{className:"text-muted-foreground mt-0.5 text-xs",children:["Next:"," ",s2(ao.start_time??ao.startTime??ao.start_at??ao.startAt)]})]})]})]})}),(0,t.jsx)("div",{className:"border-border/60 bg-card/80 rounded-xl border p-6 shadow-sm",children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(k.Tag,{className:"text-muted-foreground size-4"}),(0,t.jsx)("h4",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Job Tags"})]}),(0,t.jsx)(ee.EntityTags,{entityId:ef.id,entityType:"job",tags:sf,onUpdateTags:async(e,t)=>{(await (0,P.updateEntityTags)("job",e,t)).success&&ek()}})]})}),(ay.length>0||s5.length>0)&&(0,t.jsx)("div",{className:"border-border/60 bg-card/80 rounded-xl border p-6 shadow-sm",children:(0,t.jsxs)("div",{className:"space-y-4",children:[ay.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Assigned Team"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:ay.filter(Boolean).map(e=>(0,t.jsxs)(A.default,{className:"group border-border/60 bg-background text-foreground hover:border-primary/50 hover:bg-primary/5 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-medium transition-colors",href:e?.id?`/dashboard/settings/team/${e.id}`:"/dashboard/settings/team",children:[(0,t.jsx)(es.Avatar,{className:"bg-muted h-6 w-6 border border-white/10",children:e?.avatar?(0,t.jsx)(es.AvatarImage,{alt:e?.name||"Team Member",src:e.avatar}):(0,t.jsx)(es.AvatarFallback,{className:"text-[10px]",children:e?.name?.split(" ").map(e=>e[0]).join("").slice(0,2).toUpperCase()||"TM"})}),(0,t.jsx)("span",{children:e?.name||"Unknown"})]},e?.id||"unknown"))})]}),s5.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Tags"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:s5.map(e=>(0,t.jsx)("span",{className:"bg-primary/10 text-primary inline-flex items-center gap-1 rounded-full px-2.5 py-0.5 text-xs font-medium",children:e},e))})]})]})})]}):(0,t.jsxs)("div",{className:"border-border/60 bg-background flex flex-1 flex-col items-center justify-center rounded-xl border border-dashed p-6 text-center",children:[(0,t.jsx)("div",{className:"bg-muted mb-3 flex size-12 items-center justify-center rounded-full",children:(0,t.jsx)(D.User,{className:"text-muted-foreground size-6"})}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"No customer assigned"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1 text-xs",children:"Assign a customer to unlock profile insights."})]}),(0,t.jsx)("aside",{className:"mt-6 space-y-6 lg:mt-0 lg:w-[360px]",children:sy?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"border-border/60 bg-card/80 rounded-xl border p-0 shadow-sm",children:sC?(0,t.jsx)(tN.PropertyLocationVisual,{property:sy}):(0,t.jsxs)("div",{className:"space-y-4 p-6",children:[(0,t.jsx)(eo.Skeleton,{className:"h-40 w-full rounded-lg"}),(0,t.jsxs)("div",{className:"text-muted-foreground space-y-1 text-sm",children:[(0,t.jsx)("p",{children:"Connect a Google Maps API key or add coordinates to visualize this location."}),(0,t.jsx)("p",{className:"text-xs",children:"Update property details to include latitude and longitude for enhanced routing."})]})]})}),(0,t.jsxs)("div",{className:"border-border/60 bg-card/80 space-y-3 rounded-xl border p-6 shadow-sm",children:[(0,t.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Property Details"}),(0,t.jsxs)("dl",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("dt",{className:"text-muted-foreground text-xs",children:"Address"}),(0,t.jsxs)("dd",{className:"text-foreground",children:[sy.address,sy.address2?`, ${sy.address2}`:"",(0,t.jsx)("br",{}),sy.city,", ",sy.state," ",sy.zip_code]})]}),sy.square_footage&&(0,t.jsxs)("div",{children:[(0,t.jsx)("dt",{className:"text-muted-foreground text-xs",children:"Square Footage"}),(0,t.jsx)("dd",{className:"text-foreground",children:sy.square_footage})]}),sy.year_built&&(0,t.jsxs)("div",{children:[(0,t.jsx)("dt",{className:"text-muted-foreground text-xs",children:"Year Built"}),(0,t.jsx)("dd",{className:"text-foreground",children:sy.year_built})]})]})]})]}):(0,t.jsx)("div",{className:"border-border/60 bg-background text-muted-foreground flex flex-col items-center justify-center rounded-xl border border-dashed p-6 text-center text-sm",children:"No property assigned"})})]})})});let aA=(0,M.useMemo)(()=>Array.isArray(tO)&&0!==tO.length?tO.map(e=>{let t=e?.team_member||e?.teamMember;if(!t)return null;let s=t.user||t.users?.[0]||e?.user||e?.assigned_user,a=s?.id||t.user_id||e.user_id;if(!a)return null;let r=null;return s?.name?r=s.name:s?.first_name||s?.last_name?r=[s.first_name,s.last_name].filter(Boolean).join(" "):t.user?.name?r=t.user.name:s?.email&&(r=s.email),{id:e.id||e.team_member_id||t.id,user_id:a,team_member:{job_title:t.job_title||e.job_title||void 0,user:{name:r||void 0,email:s?.email||t.email||void 0,avatar_url:s?.avatar_url||s?.avatar||t.avatar||void 0,first_name:s?.first_name||(r?r.split(" ")[0]:void 0),last_name:s?.last_name||(r&&r.includes(" ")?r.split(" ").slice(1).join(" "):void 0)}},assigned_at:e.assigned_at||e.assignedAt||new Date().toISOString(),role:e.role||"crew"}}).filter(e=>null!==e):[],[tO]);az.push({id:"team",title:"Team Members",icon:(0,t.jsx)(T.Users,{className:"size-4"}),count:aA.length,actions:(0,t.jsx)(tg,{availableMembers:tJ,currentMemberIds:aw,onAssign:sK}),content:(0,t.jsx)(ec.UnifiedAccordionContent,{className:"overflow-x-auto p-0 sm:p-0",children:(0,t.jsx)(tv,{teamMembers:aA,onRemoveMember:sX})})}),az.push({id:"appointments",title:"Appointments",icon:(0,t.jsx)(i.Calendar,{className:"size-4"}),count:t6.length,actions:(0,t.jsxs)(V.Button,{onClick:()=>ev.push(`/dashboard/schedule/new?jobId=${ef.id}`),size:"sm",variant:"outline",children:[(0,t.jsx)(b.Plus,{className:"mr-2 h-4 w-4"})," Add Appointment"]}),content:(0,t.jsx)(ec.UnifiedAccordionContent,{className:"p-0 sm:p-0",children:(0,t.jsx)(eq,{appointments:t6})})}),az.push({id:"equipment-serviced",title:"Equipment Serviced",icon:(0,t.jsx)(z.Wrench,{className:"size-4"}),count:sn.length,actions:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(V.Button,{onClick:()=>tf(!0),size:"sm",variant:"ghost",children:[(0,t.jsx)(h.Link2,{className:"mr-2 h-4 w-4"})," Link Existing"]}),(0,t.jsxs)(V.Button,{onClick:()=>ev.push(`/dashboard/work/equipment/new?jobId=${ef.id}`),size:"sm",variant:"outline",children:[(0,t.jsx)(b.Plus,{className:"mr-2 h-4 w-4"})," Add Equipment"]})]}),content:(0,t.jsx)(ec.UnifiedAccordionContent,{children:0===sn.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,t.jsx)("div",{className:"bg-muted mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full",children:(0,t.jsx)(z.Wrench,{className:"text-muted-foreground h-8 w-8"})}),(0,t.jsx)("h3",{className:"mb-2 text-lg font-semibold",children:"No equipment has been added to this job yet"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-4 text-sm",children:"Equipment serviced on this job will appear here"}),(0,t.jsxs)(V.Button,{onClick:()=>{},size:"sm",variant:"secondary",children:[(0,t.jsx)(b.Plus,{className:"mr-2 h-4 w-4"})," Add Equipment"]})]}):(0,t.jsx)("div",{className:"space-y-4",children:sn.map(e=>(0,t.jsxs)("div",{className:"hover:bg-accent/50 space-y-3 rounded-lg border p-4 transition-colors",children:[(0,t.jsx)("div",{className:"flex items-start justify-between",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,t.jsx)("h4",{className:"font-semibold",children:e.equipment?.name}),(0,t.jsx)(ea.Badge,{variant:"secondary",children:e.service_type})]}),(0,t.jsx)("div",{className:"text-muted-foreground space-y-1 text-sm",children:(0,t.jsxs)("p",{children:[e.equipment?.manufacturer," ",e.equipment?.model,e.equipment?.serial_number&&` • SN: ${e.equipment.serial_number}`]})})]})}),e.work_performed&&(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Work Performed:"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:e.work_performed})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4 text-sm",children:[e.condition_before&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground mr-2",children:"Before:"}),(0,t.jsx)(ea.Badge,{variant:"outline",children:e.condition_before})]}),e.condition_after&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground mr-2",children:"After:"}),(0,t.jsx)(ea.Badge,{variant:"default",children:e.condition_after})]})]})]},e.id))})})}),t2.length>0&&az.push({id:"equipment",title:"Customer Equipment at Property",icon:(0,t.jsx)(r.Building2,{className:"size-4"}),count:t2.length,content:(0,t.jsx)(ec.UnifiedAccordionContent,{className:"p-0",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(ed.Table,{children:[(0,t.jsx)(ed.TableHeader,{children:(0,t.jsxs)(ed.TableRow,{children:[(0,t.jsx)(ed.TableHead,{children:"Equipment"}),(0,t.jsx)(ed.TableHead,{children:"Type"}),(0,t.jsx)(ed.TableHead,{children:"Manufacturer"}),(0,t.jsx)(ed.TableHead,{children:"Model"}),(0,t.jsx)(ed.TableHead,{children:"Serial #"}),(0,t.jsx)(ed.TableHead,{children:"Last Service"})]})}),(0,t.jsx)(ed.TableBody,{children:t2.map(e=>(0,t.jsxs)(ed.TableRow,{children:[(0,t.jsx)(ed.TableCell,{className:"font-medium",children:e.name}),(0,t.jsx)(ed.TableCell,{children:e.type}),(0,t.jsx)(ed.TableCell,{children:e.manufacturer||"N/A"}),(0,t.jsx)(ed.TableCell,{children:e.model||"N/A"}),(0,t.jsx)(ed.TableCell,{className:"font-mono text-sm",children:e.serial_number||"N/A"}),(0,t.jsx)(ed.TableCell,{className:"text-sm",children:e.last_service_date?s1(e.last_service_date):"Never"})]},e.id))})]})})})}),az.push({id:"estimates",title:"Estimates",icon:(0,t.jsx)(N.Receipt,{className:"size-4"}),count:se.length,actions:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(V.Button,{onClick:()=>td(!0),size:"sm",variant:"ghost",children:[(0,t.jsx)(h.Link2,{className:"mr-2 h-4 w-4"})," Link Existing"]}),(0,t.jsxs)(V.Button,{onClick:()=>ev.push(`/dashboard/work/estimates/new?jobId=${ef.id}`),size:"sm",variant:"outline",children:[(0,t.jsx)(b.Plus,{className:"mr-2 h-4 w-4"})," Create Estimate"]})]}),content:(0,t.jsx)(ec.UnifiedAccordionContent,{className:"overflow-x-auto p-0 sm:p-0",children:(0,t.jsx)(e0,{estimates:se})})}),az.push({id:"invoices",title:"Invoices",icon:(0,t.jsx)(u.FileText,{className:"size-4"}),count:ss.length,actions:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(V.Button,{onClick:()=>tm(!0),size:"sm",variant:"ghost",children:[(0,t.jsx)(h.Link2,{className:"mr-2 h-4 w-4"})," Link Existing"]}),(0,t.jsxs)(V.Button,{onClick:()=>ev.push(`/dashboard/work/invoices/new?jobId=${ef.id}`),size:"sm",variant:"outline",children:[(0,t.jsx)(b.Plus,{className:"mr-2 h-4 w-4"})," Create Invoice"]})]}),content:(0,t.jsx)(ec.UnifiedAccordionContent,{className:"overflow-x-auto p-0 sm:p-0",children:(0,t.jsx)(e4,{invoices:ss})})}),az.push({id:"payments",title:"Payments",icon:(0,t.jsx)(d.DollarSign,{className:"size-4"}),count:sr.length,actions:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(V.Button,{onClick:()=>tp(!0),size:"sm",variant:"ghost",children:[(0,t.jsx)(h.Link2,{className:"mr-2 h-4 w-4"})," Link Existing"]}),(0,t.jsxs)(V.Button,{onClick:()=>ev.push(`/dashboard/work/payments/new?jobId=${ef.id}`),size:"sm",variant:"outline",children:[(0,t.jsx)(b.Plus,{className:"mr-2 h-4 w-4"})," Record Payment"]})]}),content:(0,t.jsx)(ec.UnifiedAccordionContent,{className:"overflow-x-auto p-0 sm:p-0",children:(0,t.jsx)(e9,{payments:sr})})}),az.push({id:"purchase-orders",title:"Purchase Orders",icon:(0,t.jsx)(f.Package,{className:"size-4"}),count:tG.length,actions:(0,t.jsxs)(V.Button,{onClick:()=>ev.push(`/dashboard/work/purchase-orders/new?jobId=${ef.id}`),size:"sm",variant:"outline",children:[(0,t.jsx)(b.Plus,{className:"mr-2 h-4 w-4"})," Create PO"]}),content:(0,t.jsx)(ec.UnifiedAccordionContent,{className:"overflow-x-auto p-0 sm:p-0",children:(0,t.jsx)(te,{purchaseOrders:tG})})}),az.push({id:"photos",title:"Photos & Documents",icon:(0,t.jsx)(n.Camera,{className:"size-4"}),count:tX.length+tQ.length,actions:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("input",{accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt,.csv",className:"hidden",multiple:!0,onChange:e=>{e.target.files&&e.target.files.length>0&&eL(!0)},ref:sV,type:"file"}),(0,t.jsxs)(V.Button,{onClick:()=>sV.current?.click(),size:"sm",variant:"outline",children:[(0,t.jsx)(b.Plus,{className:"mr-2 h-4 w-4"})," Upload"]})]}),content:(0,t.jsx)(ec.UnifiedAccordionContent,{className:"p-0",children:(0,t.jsxs)("div",{className:(0,ep.cn)("relative transition-colors",eB&&"bg-primary/5 ring-primary ring-2 ring-inset"),onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),e$(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget===e.target&&e$(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation(),e$(!1),eL(!0)},children:[eB&&(0,t.jsx)("div",{className:"bg-primary/5 pointer-events-none absolute inset-0 z-10 flex items-center justify-center backdrop-blur-sm",children:(0,t.jsxs)("div",{className:"border-primary bg-background rounded-lg border-2 border-dashed p-8 text-center",children:[(0,t.jsx)(S.Upload,{className:"text-primary mx-auto mb-2 h-12 w-12"}),(0,t.jsx)("p",{className:"text-primary font-semibold",children:"Drop files to upload"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"Photos, documents, and more"})]})}),(0,t.jsx)("div",{className:"bg-muted/30 border-b px-6 py-3",children:(0,t.jsxs)("div",{className:"text-muted-foreground flex items-center gap-2 text-sm",children:[(0,t.jsx)(S.Upload,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Drag and drop files anywhere in this section to upload"})]})}),(0,t.jsxs)("div",{className:"space-y-6 px-6 py-6",children:[eP&&(0,t.jsx)(eF,{companyId:ef.company_id,jobId:ef.id,onCancel:()=>eL(!1),onUploadComplete:()=>{eL(!1)}}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mb-3 flex items-center justify-between",children:(0,t.jsxs)("h4",{className:"font-semibold",children:["Photos by Category (",tX.length,")"]})}),tX.length>0?(0,t.jsx)("div",{className:"grid gap-3 md:grid-cols-4",children:["before","during","after","issue","equipment","completion","other"].map(e=>{let s=tX.filter(t=>t.category===e).length;return(0,t.jsxs)("div",{className:"rounded-lg border p-4 text-center",children:[(0,t.jsx)("p",{className:"text-muted-foreground text-xs font-medium uppercase",children:e}),(0,t.jsx)("p",{className:"text-3xl font-bold",children:s})]},e)})}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,t.jsx)("div",{className:"bg-muted mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full",children:(0,t.jsx)(n.Camera,{className:"text-muted-foreground h-8 w-8"})}),(0,t.jsx)("h3",{className:"mb-2 text-lg font-semibold",children:"No photos uploaded yet"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-4 text-sm",children:"Upload photos to document the job progress"}),(0,t.jsxs)(V.Button,{onClick:()=>eL(!0),size:"sm",variant:"secondary",children:[(0,t.jsx)(b.Plus,{className:"mr-2 h-4 w-4"})," Upload Photos"]})]})]}),(0,t.jsx)(el.Separator,{}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"mb-3 font-semibold",children:["Documents (",tQ.length,")"]}),tQ.length>0?(0,t.jsx)("div",{className:"space-y-2",children:tQ.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(u.FileText,{className:"text-muted-foreground h-4 w-4"}),(0,t.jsx)("span",{className:"text-sm",children:e.file_name})]}),(0,t.jsx)(V.Button,{className:"h-8 px-2",size:"sm",variant:"secondary",children:(0,t.jsx)(c.Download,{className:"h-3.5 w-3.5"})})]},e.id))}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,t.jsx)("div",{className:"bg-muted mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full",children:(0,t.jsx)(u.FileText,{className:"text-muted-foreground h-8 w-8"})}),(0,t.jsx)("h3",{className:"mb-2 text-lg font-semibold",children:"No documents uploaded yet"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-4 text-sm",children:"Upload documents, receipts, or other files related to this job"}),(0,t.jsxs)(V.Button,{onClick:()=>eL(!0),size:"sm",variant:"secondary",children:[(0,t.jsx)(b.Plus,{className:"mr-2 h-4 w-4"})," Upload Document"]})]})]}),(0,t.jsx)(el.Separator,{}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"mb-3 font-semibold",children:"Signatures"}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Customer Signature"}),tZ.find(e=>"customer"===e.signature_type)?(0,t.jsxs)(ea.Badge,{variant:"default",children:[(0,t.jsx)(l.CheckCircle,{className:"mr-1 h-3 w-3"})," Signed"]}):(0,t.jsx)(ea.Badge,{variant:"secondary",children:"Pending"})]}),tZ.find(e=>"customer"===e.signature_type)&&(0,t.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Signed"," ",s1(tZ.find(e=>"customer"===e.signature_type).signed_at)]})]}),(0,t.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Technician Signature"}),tZ.find(e=>"technician"===e.signature_type)?(0,t.jsxs)(ea.Badge,{variant:"default",children:[(0,t.jsx)(l.CheckCircle,{className:"mr-1 h-3 w-3"})," Signed"]}):(0,t.jsx)(ea.Badge,{variant:"secondary",children:"Pending"})]}),tZ.find(e=>"technician"===e.signature_type)&&(0,t.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Signed"," ",s1(tZ.find(e=>"technician"===e.signature_type).signed_at)]})]})]})]})]})]})})}),az.push({id:"tasks",title:"Job Tasks & Checklist",icon:(0,t.jsx)(l.CheckCircle,{className:"size-4"}),count:so.length,actions:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(V.Button,{onClick:()=>eK(!0),size:"sm",variant:"outline",children:[(0,t.jsx)(b.Plus,{className:"mr-2 h-4 w-4"})," Add Task"]}),(0,t.jsx)(V.Button,{onClick:()=>e1(!0),size:"sm",variant:"outline",children:"Load Template"})]}),content:(0,t.jsx)(ec.UnifiedAccordionContent,{className:"overflow-x-auto p-0 sm:p-0",children:(0,t.jsx)(th,{tasks:so})})}),az.push({id:"notes",title:"Notes",icon:(0,t.jsx)(_.StickyNote,{className:"size-4"}),count:sc.length,actions:(0,t.jsxs)(V.Button,{onClick:()=>eQ(!0),size:"sm",variant:"outline",children:[(0,t.jsx)(b.Plus,{className:"mr-2 h-4 w-4"})," Add Note"]}),content:(0,t.jsx)(ec.UnifiedAccordionContent,{className:"overflow-x-auto p-0 sm:p-0",children:(0,t.jsx)(e8,{notes:sc})})}),az.push({id:"activity",title:"Activity & Communications",icon:(0,t.jsx)(s.Activity,{className:"size-4"}),count:t0.length+t1.length,actions:(0,t.jsxs)(V.Button,{onClick:()=>{let e="/dashboard/communication/messages",t=sb?.id?`${e}?customerId=${sb.id}`:e;ev.push(t)},size:"sm",variant:"outline",children:[(0,t.jsx)(b.Plus,{className:"mr-2 h-4 w-4"})," Add Communication"]}),content:(0,t.jsx)(ec.UnifiedAccordionContent,{className:"p-0",children:(0,t.jsx)(eI,{activities:[...t0,...t1]})})});let aF=[];return sb&&aF.push({id:`customer-${sb.id}`,type:"customer",title:`${sb.first_name} ${sb.last_name}`,subtitle:sb.email||sb.phone||void 0,href:`/dashboard/customers/${sb.id}`}),sy&&aF.push({id:`property-${sy.id}`,type:"property",title:sy.name||sy.address,subtitle:`${sy.city||""}, ${sy.state||""}`,href:`/dashboard/work/properties/${sy.id}`}),tR&&aF.push({id:`technician-${tR.id}`,type:"team",title:tR.name,subtitle:tR.email||tR.phone||void 0,href:tR.id?`/dashboard/settings/team/${tR.id}`:"/dashboard/settings/team"}),ef?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.DetailPageContentLayout,{activities:t0,beforeContent:aT,customSections:az,enableReordering:!0,header:aD,notes:sc,relatedItems:aF,showStandardSections:{activities:!1,notes:!1,attachments:!1},storageKey:"job-details"}),(0,t.jsx)(H.Dialog,{onOpenChange:sL,open:sI,children:(0,t.jsxs)(H.DialogContent,{className:"sm:max-w-[500px]",children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsx)(H.DialogTitle,{children:"Create New Property"}),(0,t.jsxs)(H.DialogDescription,{children:["Add a new property for ",sb?.first_name," ",sb?.last_name]})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsx)(Y.StandardFormField,{label:"Property Name",htmlFor:"property-name",children:(0,t.jsx)(ei.Input,{id:"property-name",onChange:e=>sU({...sq,name:e.target.value}),placeholder:"Main Residence",value:sq.name})}),(0,t.jsx)(Y.StandardFormField,{label:"Address",htmlFor:"property-address",required:!0,children:(0,t.jsx)(ei.Input,{id:"property-address",onChange:e=>sU({...sq,address:e.target.value}),placeholder:"123 Main St",value:sq.address})}),(0,t.jsx)(Y.StandardFormField,{label:"Address Line 2",htmlFor:"property-address2",children:(0,t.jsx)(ei.Input,{id:"property-address2",onChange:e=>sU({...sq,address2:e.target.value}),placeholder:"Apt 4B",value:sq.address2})}),(0,t.jsxs)(Y.StandardFormRow,{cols:2,children:[(0,t.jsx)(Y.StandardFormField,{label:"City",htmlFor:"property-city",required:!0,children:(0,t.jsx)(ei.Input,{id:"property-city",onChange:e=>sU({...sq,city:e.target.value}),placeholder:"New York",value:sq.city})}),(0,t.jsx)(Y.StandardFormField,{label:"State",htmlFor:"property-state",required:!0,children:(0,t.jsx)(ei.Input,{id:"property-state",onChange:e=>sU({...sq,state:e.target.value}),placeholder:"NY",value:sq.state})})]}),(0,t.jsx)(Y.StandardFormField,{label:"ZIP Code",htmlFor:"property-zip",required:!0,children:(0,t.jsx)(ei.Input,{id:"property-zip",onChange:e=>sU({...sq,zipCode:e.target.value}),placeholder:"10001",value:sq.zipCode})})]}),(0,t.jsxs)(H.DialogFooter,{children:[(0,t.jsx)(V.Button,{disabled:sB,onClick:()=>sL(!1),variant:"outline",children:"Cancel"}),(0,t.jsx)(V.Button,{disabled:sB||!sq.address||!sq.city||!sq.state||!sq.zipCode,onClick:sG,children:sB?"Creating...":"Create Property"})]})]})}),sb?.phone&&(0,t.jsx)(X,{companyId:ef.company_id,companyPhones:t9,customerId:sb.id,customerName:`${sb.first_name} ${sb.last_name}`,customerPhone:sb.phone,jobId:ef.id,onOpenChange:sR,open:sE,propertyId:sy?.id}),(0,t.jsx)(H.Dialog,{onOpenChange:eE,open:eU,children:(0,t.jsxs)(H.DialogContent,{children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsx)(H.DialogTitle,{children:"Archive Job"}),(0,t.jsx)(H.DialogDescription,{children:"Archiving removes this job from active workflows. You can restore it from the archive within 90 days."})]}),(0,t.jsxs)(H.DialogFooter,{children:[(0,t.jsx)(V.Button,{disabled:eR,onClick:()=>eE(!1),variant:"outline",children:"Cancel"}),(0,t.jsx)(V.Button,{disabled:eR,onClick:aS,variant:"destructive",children:eR?"Archiving...":"Archive Job"})]})]})}),(0,t.jsx)(et.AlertDialog,{onOpenChange:sJ,open:sO,children:(0,t.jsxs)(et.AlertDialogContent,{children:[(0,t.jsxs)(et.AlertDialogHeader,{children:[(0,t.jsx)(et.AlertDialogTitle,{children:"Remove Customer and Property?"}),(0,t.jsx)(et.AlertDialogDescription,{children:"This will clear the customer and property fields from this job. This action can be undone by reassigning a customer and property."})]}),(0,t.jsxs)(et.AlertDialogFooter,{children:[(0,t.jsx)(et.AlertDialogCancel,{children:"Cancel"}),(0,t.jsx)(et.AlertDialogAction,{onClick:async()=>{try{let e=new FormData;e.append("customer_id",""),e.append("property_id","");let t=await (0,$.updateJob)(ef.id,e);t.success?eb.success("Customer and property removed"):eb.error(t.error||"Failed to remove customer and property")}catch{eb.error("Failed to remove customer and property")}},children:"Remove"})]})]})}),O&&(0,t.jsx)(tr.JobStatisticsSheet,{invoices:ss,job:ef,jobMaterials:t3,metrics:O,onOpenChange:eH,open:eV,payments:sr,teamAssignments:tO,timeEntries:tV,onUpdateCosting:sZ}),(0,t.jsx)(H.Dialog,{onOpenChange:eK,open:eG,children:(0,t.jsxs)(H.DialogContent,{className:"sm:max-w-[500px]",children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsx)(H.DialogTitle,{children:"Add Task"}),(0,t.jsx)(H.DialogDescription,{children:"Create a new task or checklist item for this job."})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsx)(Y.StandardFormField,{label:"Title",htmlFor:"task-title",required:!0,children:(0,t.jsx)(ei.Input,{id:"task-title",onChange:e=>e3(e.target.value),placeholder:"Enter task title...",value:e2})}),(0,t.jsx)(Y.StandardFormField,{label:"Description",htmlFor:"task-description",description:"Optional",children:(0,t.jsx)(G.Textarea,{id:"task-description",onChange:e=>e6(e.target.value),placeholder:"Enter task description...",value:e5,className:"min-h-[80px]"})})]}),(0,t.jsxs)(H.DialogFooter,{children:[(0,t.jsx)(V.Button,{disabled:ts,onClick:()=>{e3(""),e6(""),eK(!1)},variant:"outline",children:"Cancel"}),(0,t.jsx)(V.Button,{disabled:ts||!e2.trim(),onClick:async()=>{if(!e2.trim())return;ti(!0);let e={id:`temp-${Date.now()}`,job_id:ef.id,title:e2.trim(),description:e5.trim()||null,is_completed:!1,is_required:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};sd([...so,e]),e3(""),e6(""),eK(!1);try{let t=(0,eh.createClient)(),{data:s,error:a}=await t.from("job_tasks").insert({job_id:ef.id,title:e.title,description:e.description,is_completed:!1,is_required:!1}).select().single();a?(sd(so),eb.error("Failed to create task")):(sd(t=>t.map(t=>t.id===e.id?s:t)),eb.success("Task created successfully"))}catch{sd(so),eb.error("Failed to create task")}finally{ti(!1)}},children:ts?"Creating...":"Create Task"})]})]})}),(0,t.jsx)(H.Dialog,{onOpenChange:eQ,open:eX,children:(0,t.jsxs)(H.DialogContent,{className:"sm:max-w-[500px]",children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsx)(H.DialogTitle,{children:"Add Note"}),(0,t.jsx)(H.DialogDescription,{children:"Add a note or comment for this job."})]}),(0,t.jsx)("div",{className:"space-y-4 py-4",children:(0,t.jsx)(Y.StandardFormField,{label:"Note Content",htmlFor:"note-content",required:!0,children:(0,t.jsx)(G.Textarea,{id:"note-content",onChange:e=>tt(e.target.value),placeholder:"Enter note content...",value:e7,className:"min-h-[120px]"})})}),(0,t.jsxs)(H.DialogFooter,{children:[(0,t.jsx)(V.Button,{disabled:tn,onClick:()=>{tt(""),eQ(!1)},variant:"outline",children:"Cancel"}),(0,t.jsx)(V.Button,{disabled:tn||!e7.trim(),onClick:async()=>{if(!e7.trim())return;tl(!0);let e=(0,eh.createClient)(),{data:{user:t}}=await e.auth.getUser(),s={id:`temp-${Date.now()}`,job_id:ef.id,content:e7.trim(),note_type:"general",is_important:!1,created_by:t?.id||null,created_by_name:t?.email||"Unknown",created_at:new Date().toISOString()};sm([...sc,s]),tt(""),eQ(!1);try{let{data:a,error:r}=await e.from("job_notes").insert({job_id:ef.id,content:s.content,note_type:"general",is_important:!1,created_by:t?.id||null}).select().single();r?(sm(sc),eb.error("Failed to create note")):(sm(e=>e.map(e=>e.id===s.id?a:e)),eb.success("Note created successfully"))}catch{sm(sc),eb.error("Failed to create note")}finally{tl(!1)}},children:tn?"Creating...":"Create Note"})]})]})}),(0,t.jsx)(H.Dialog,{onOpenChange:e1,open:eZ,children:(0,t.jsxs)(H.DialogContent,{className:"sm:max-w-[500px]",children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsx)(H.DialogTitle,{children:"Load Task Template"}),(0,t.jsx)(H.DialogDescription,{children:"Select a task template to apply to this job. This feature will be available soon."})]}),(0,t.jsx)("div",{className:"space-y-4 py-4",children:(0,t.jsx)("div",{className:"text-muted-foreground rounded-lg border border-dashed p-6 text-center text-sm",children:"Task templates feature is coming soon. You'll be able to save and load predefined task checklists for different job types."})}),(0,t.jsx)(H.DialogFooter,{children:(0,t.jsx)(V.Button,{onClick:()=>e1(!1),variant:"outline",children:"Close"})})]})}),(0,t.jsx)(H.Dialog,{onOpenChange:td,open:to,children:(0,t.jsxs)(H.DialogContent,{className:"sm:max-w-[700px]",children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsx)(H.DialogTitle,{children:"Link Existing Estimate"}),(0,t.jsx)(H.DialogDescription,{children:"Search and select an estimate to link to this job. Only unlinked estimates are shown."})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(ei.Input,{placeholder:"Search by estimate number, customer, or status...",value:ty,onChange:e=>tw(e.target.value),className:"pl-10"}),(0,t.jsx)(u.FileText,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"})]}),(0,t.jsx)("div",{className:"border rounded-lg max-h-[400px] overflow-y-auto",children:0===tF.filter(e=>{if(!ty)return!0;let t=ty.toLowerCase();return e.estimate_number.toLowerCase().includes(t)||e.status.toLowerCase().includes(t)||e.customer?.name?.toLowerCase().includes(t)}).length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,t.jsx)(u.FileText,{className:"h-12 w-12 text-muted-foreground/50 mb-3"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No estimates found"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Try adjusting your search"})]}):(0,t.jsx)("div",{className:"divide-y",children:tF.filter(e=>{if(!ty)return!0;let t=ty.toLowerCase();return e.estimate_number.toLowerCase().includes(t)||e.status.toLowerCase().includes(t)||e.customer?.name?.toLowerCase().includes(t)}).map(e=>(0,t.jsx)("button",{onClick:async()=>{tA(!0),st([...se,{...e,job_id:ef.id}]),td(!1),tw("");try{let t=(0,eh.createClient)(),{error:s}=await t.from("estimates").update({job_id:ef.id}).eq("id",e.id);s?(st(se),eb.error("Failed to link estimate")):eb.success("Estimate linked successfully")}catch{st(se),eb.error("Failed to link estimate")}finally{tA(!1)}},disabled:tz,className:"w-full px-4 py-3 hover:bg-accent transition-colors text-left disabled:opacity-50 disabled:cursor-not-allowed",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("span",{className:"font-semibold text-sm",children:e.estimate_number}),(0,t.jsx)(ea.Badge,{variant:"outline",className:"text-xs",children:e.status})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)(D.User,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"truncate",children:e.customer?.name||"No customer"})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"font-semibold text-sm",children:["$",(e.total_amount/100).toFixed(2)]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleDateString()})]})]})},e.id))})})]}),(0,t.jsx)(H.DialogFooter,{children:(0,t.jsx)(V.Button,{onClick:()=>{td(!1),tw("")},variant:"outline",disabled:tz,children:"Cancel"})})]})}),(0,t.jsx)(H.Dialog,{onOpenChange:tm,open:tc,children:(0,t.jsxs)(H.DialogContent,{className:"sm:max-w-[700px]",children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsx)(H.DialogTitle,{children:"Link Existing Invoice"}),(0,t.jsx)(H.DialogDescription,{children:"Search and select an invoice to link to this job. Only unlinked invoices are shown."})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(ei.Input,{placeholder:"Search by invoice number, customer, or status...",value:tC,onChange:e=>t_(e.target.value),className:"pl-10"}),(0,t.jsx)(u.FileText,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"})]}),(0,t.jsx)("div",{className:"border rounded-lg max-h-[400px] overflow-y-auto",children:0===tP.filter(e=>{if(!tC)return!0;let t=tC.toLowerCase();return e.invoice_number.toLowerCase().includes(t)||e.status.toLowerCase().includes(t)||e.customer?.name?.toLowerCase().includes(t)}).length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,t.jsx)(u.FileText,{className:"h-12 w-12 text-muted-foreground/50 mb-3"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No invoices found"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Try adjusting your search"})]}):(0,t.jsx)("div",{className:"divide-y",children:tP.filter(e=>{if(!tC)return!0;let t=tC.toLowerCase();return e.invoice_number.toLowerCase().includes(t)||e.status.toLowerCase().includes(t)||e.customer?.name?.toLowerCase().includes(t)}).map(e=>(0,t.jsx)("button",{onClick:async()=>{tA(!0),sa([...ss,{...e,job_id:ef.id}]),tm(!1),t_("");try{let t=(0,eh.createClient)(),{error:s}=await t.from("invoices").update({job_id:ef.id}).eq("id",e.id);s?(sa(ss),eb.error("Failed to link invoice")):eb.success("Invoice linked successfully")}catch{sa(ss),eb.error("Failed to link invoice")}finally{tA(!1)}},disabled:tz,className:"w-full px-4 py-3 hover:bg-accent transition-colors text-left disabled:opacity-50 disabled:cursor-not-allowed",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("span",{className:"font-semibold text-sm",children:e.invoice_number}),(0,t.jsx)(ea.Badge,{variant:"outline",className:"text-xs",children:e.status})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)(D.User,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"truncate",children:e.customer?.name||"No customer"})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"font-semibold text-sm",children:["$",(e.total_amount/100).toFixed(2)]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleDateString()})]})]})},e.id))})})]}),(0,t.jsx)(H.DialogFooter,{children:(0,t.jsx)(V.Button,{onClick:()=>{tm(!1),t_("")},variant:"outline",disabled:tz,children:"Cancel"})})]})}),(0,t.jsx)(H.Dialog,{onOpenChange:tp,open:tu,children:(0,t.jsxs)(H.DialogContent,{className:"sm:max-w-[700px]",children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsx)(H.DialogTitle,{children:"Link Existing Payment"}),(0,t.jsx)(H.DialogDescription,{children:"Search and select a payment to link to this job. Only unlinked payments are shown."})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(ei.Input,{placeholder:"Search by reference, payment method, or customer...",value:tk,onChange:e=>tS(e.target.value),className:"pl-10"}),(0,t.jsx)(d.DollarSign,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"})]}),(0,t.jsx)("div",{className:"border rounded-lg max-h-[400px] overflow-y-auto",children:0===tL.filter(e=>{if(!tk)return!0;let t=tk.toLowerCase();return e.payment_method.toLowerCase().includes(t)||e.reference_number?.toLowerCase().includes(t)||e.customer?.name?.toLowerCase().includes(t)}).length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,t.jsx)(d.DollarSign,{className:"h-12 w-12 text-muted-foreground/50 mb-3"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No payments found"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Try adjusting your search"})]}):(0,t.jsx)("div",{className:"divide-y",children:tL.filter(e=>{if(!tk)return!0;let t=tk.toLowerCase();return e.payment_method.toLowerCase().includes(t)||e.reference_number?.toLowerCase().includes(t)||e.customer?.name?.toLowerCase().includes(t)}).map(e=>(0,t.jsx)("button",{onClick:async()=>{tA(!0),si([...sr,{...e,job_id:ef.id}]),tp(!1),tS("");try{let t=(0,eh.createClient)(),{error:s}=await t.from("payments").update({job_id:ef.id}).eq("id",e.id);s?(si(sr),eb.error("Failed to link payment")):eb.success("Payment linked successfully")}catch{si(sr),eb.error("Failed to link payment")}finally{tA(!1)}},disabled:tz,className:"w-full px-4 py-3 hover:bg-accent transition-colors text-left disabled:opacity-50 disabled:cursor-not-allowed",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("span",{className:"font-semibold text-sm",children:e.reference_number||"No reference"}),(0,t.jsx)(ea.Badge,{variant:"outline",className:"text-xs",children:e.payment_method})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)(D.User,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"truncate",children:e.customer?.name||"No customer"})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"font-semibold text-sm",children:["$",(e.amount/100).toFixed(2)]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleDateString()})]})]})},e.id))})})]}),(0,t.jsx)(H.DialogFooter,{children:(0,t.jsx)(V.Button,{onClick:()=>{tp(!1),tS("")},variant:"outline",disabled:tz,children:"Cancel"})})]})}),(0,t.jsx)(H.Dialog,{onOpenChange:tf,open:tj,children:(0,t.jsxs)(H.DialogContent,{className:"sm:max-w-[700px]",children:[(0,t.jsxs)(H.DialogHeader,{children:[(0,t.jsx)(H.DialogTitle,{children:"Link Existing Equipment"}),(0,t.jsx)(H.DialogDescription,{children:"Search and link existing equipment to this job. Select equipment from the list below."})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(ei.Input,{placeholder:"Search by equipment name, category, or serial number...",value:tD,onChange:e=>tT(e.target.value),className:"pl-10"}),(0,t.jsx)(z.Wrench,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"})]}),(0,t.jsx)("div",{className:"border rounded-lg max-h-[400px] overflow-y-auto",children:0===t$.filter(e=>{if(!tD)return!0;let t=tD.toLowerCase();return e.name.toLowerCase().includes(t)||e.category?.toLowerCase().includes(t)||e.serial_number?.toLowerCase().includes(t)}).length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,t.jsx)(z.Wrench,{className:"h-12 w-12 text-muted-foreground/50 mb-4"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"No equipment found"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Try adjusting your search terms or create new equipment from the inventory section."})]}):t$.filter(e=>{if(!tD)return!0;let t=tD.toLowerCase();return e.name.toLowerCase().includes(t)||e.category?.toLowerCase().includes(t)||e.serial_number?.toLowerCase().includes(t)}).map((e,s,a)=>(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{onClick:async()=>{tA(!0);let t={id:`temp-${Date.now()}`,company_id:ef.company_id,job_id:ef.id,equipment_id:e.id,equipment:e,service_type:null,service_description:null,hours_spent:null,parts_cost:null,labor_cost:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};sl([...sn,t]),tf(!1),tT("");try{let s=(0,eh.createClient)(),{data:a}=await s.from("job_equipment").select("id").eq("job_id",ef.id).eq("equipment_id",e.id).single();if(a){sl(sn),eb.error("Equipment is already linked to this job"),tA(!1);return}let{data:r,error:i}=await s.from("job_equipment").insert({company_id:ef.company_id,job_id:ef.id,equipment_id:e.id}).select("*, equipment:equipment_id(*)").single();i?(sl(sn),eb.error("Failed to link equipment")):(sl(e=>e.map(e=>e.id===t.id?r:e)),eb.success("Equipment linked successfully"))}catch{sl(sn),eb.error("Failed to link equipment")}finally{tA(!1)}},disabled:tz,className:"w-full px-4 py-3 hover:bg-accent transition-colors text-left disabled:opacity-50 disabled:cursor-not-allowed",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("span",{className:"font-semibold text-sm truncate",children:e.name}),e.category&&(0,t.jsx)(ea.Badge,{variant:"outline",className:"text-xs shrink-0",children:e.category})]}),e.serial_number&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)(z.Wrench,{className:"h-3 w-3"}),(0,t.jsxs)("span",{className:"truncate",children:["SN: ",e.serial_number]})]})]}),(0,t.jsx)("div",{className:"text-right shrink-0",children:(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleDateString()})})]})}),s<a.length-1&&(0,t.jsx)("div",{className:"border-b"})]},e.id))})]})]})})]}):(0,t.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"Job not found"})})})}e.s(["JobPageContent",()=>ty],178193)}]);