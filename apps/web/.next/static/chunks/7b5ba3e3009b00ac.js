(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,672573,e=>{"use strict";let s=(0,e.i(383206).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["default",()=>s])},15751,e=>{"use strict";var s=e.i(672573);e.s(["MapPin",()=>s.default])},519131,e=>{"use strict";let s=(0,e.i(383206).default)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);e.s(["default",()=>s])},233654,e=>{"use strict";var s=e.i(519131);e.s(["Paperclip",()=>s.default])},711448,e=>{"use strict";e.i(116233),e.s([])},305549,585506,e=>{"use strict";var s=e.i(111043),t=e.i(868422),a=e.i(227009);e.i(670258);var i=e.i(921251);e.i(711448);var r=e.i(157222);function l({activities:e}){return e&&0!==e.length?(0,s.jsx)(r.UnifiedAccordionContent,{children:(0,s.jsx)("div",{className:"max-h-96 space-y-3 overflow-y-auto",children:e.map(e=>(0,s.jsxs)("div",{className:"hover:bg-muted/50 flex gap-3 rounded-lg border p-3 transition-colors",children:[(0,s.jsxs)(i.Avatar,{className:"size-8 flex-shrink-0",children:[(0,s.jsx)(i.AvatarImage,{src:e.user?.avatar}),(0,s.jsx)(i.AvatarFallback,{children:e.user?.name?.charAt(0)||"?"})]}),(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsx)("p",{className:"text-sm break-words",children:e.description}),(0,s.jsxs)("p",{className:"text-muted-foreground mt-1 text-xs",children:[e.user?.name," •"," ",(0,t.formatDistance)(new Date(e.created_at),new Date,{addSuffix:!0})]})]})]},e.id))})}):(0,s.jsx)(r.UnifiedAccordionContent,{children:(0,s.jsx)("div",{className:"flex h-32 items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(a.Activity,{className:"text-muted-foreground/50 mx-auto size-8"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No activity yet"})]})})})}e.s(["ActivityLogSection",()=>l],305549);var n=e.i(882896),c=e.i(606661),d=e.i(233654),o=e.i(371526),x=e.i(826463),m=e.i(970799);e.i(889265);var h=e.i(677607),u=e.i(51052);function p({attachments:e,entityType:t,entityId:a,onUpload:i}){let{toast:l}=(0,u.useToast)(),[p,j]=(0,m.useState)(!1),f=async e=>{let s=e.target.files;if(s&&0!==s.length){j(!0);try{i&&await i(s),l.success(`${s.length} file(s) uploaded successfully`)}catch(e){l.error("Failed to upload files")}finally{j(!1),e.target.value=""}}};return(0,s.jsx)(r.UnifiedAccordionContent,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[i&&(0,s.jsxs)("div",{children:[(0,s.jsx)("input",{className:"hidden",disabled:p,id:"file-upload",multiple:!0,onChange:f,type:"file"}),(0,s.jsx)("label",{htmlFor:"file-upload",children:(0,s.jsx)(h.Button,{asChild:!0,className:"w-full cursor-pointer",disabled:p,size:"sm",variant:"outline",children:(0,s.jsx)("span",{children:p?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Upload,{className:"mr-2 size-4 animate-pulse"}),"Uploading..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Plus,{className:"mr-2 size-4"}),"Upload Files"]})})})})]}),e&&e.length>0?(0,s.jsx)("div",{className:"space-y-2",children:e.map(e=>(0,s.jsxs)("div",{className:"hover:bg-muted/50 flex items-center justify-between rounded-lg border p-3 transition-colors",children:[(0,s.jsxs)("div",{className:"flex min-w-0 flex-1 items-center gap-3",children:[(0,s.jsx)(c.FileText,{className:"text-muted-foreground size-4 flex-shrink-0"}),(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsx)("p",{className:"truncate text-sm font-medium",children:e.original_file_name||e.file_name||"Untitled"}),(0,s.jsxs)("p",{className:"text-muted-foreground text-xs",children:[e.file_size?`${(e.file_size/1024).toFixed(1)} KB`:"",e.category&&` • ${e.category}`]})]})]}),(0,s.jsx)(h.Button,{asChild:!0,className:"flex-shrink-0",size:"sm",variant:"ghost",children:(0,s.jsx)("a",{download:!0,href:e.storage_url||e.url,rel:"noopener noreferrer",target:"_blank",children:(0,s.jsx)(n.Download,{className:"size-4"})})})]},e.id))}):(0,s.jsx)("div",{className:"flex h-32 items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(d.Paperclip,{className:"text-muted-foreground/50 mx-auto size-8"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No attachments yet"})]})})]})})}e.s(["AttachmentsSection",()=>p],585506)},431111,e=>{"use strict";var s=e.i(111043),t=e.i(904653),a=e.i(970799),i=e.i(146798);function r({stats:e,children:r}){let l=(0,t.usePathname)()||"/dashboard",n=(0,i.useToolbarStatsStore)(e=>e.setStats),c=(0,i.useToolbarStatsStore)(e=>e.clearStats);return(0,a.useLayoutEffect)(()=>(e?n(l,e):c(l),()=>{c(l)}),[l,e,n,c]),(0,s.jsx)(s.Fragment,{children:r})}e.s(["ToolbarStatsProvider",()=>r])},415872,e=>{"use strict";let s=(0,e.i(383206).default)("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);e.s(["default",()=>s])},613240,e=>{"use strict";var s=e.i(415872);e.s(["Printer",()=>s.default])},6130,e=>{"use strict";e.i(116233),e.s([])},568185,e=>{"use strict";let s=(0,e.i(383206).default)("chevrons-up-down",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);e.s(["default",()=>s])},390929,e=>{"use strict";var s=e.i(568185);e.s(["ChevronsUpDown",()=>s.default])},422178,e=>{"use strict";let s=(0,e.i(383206).default)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);e.s(["default",()=>s])},913468,e=>{"use strict";var s=e.i(422178);e.s(["Pencil",()=>s.default])},403953,e=>{"use strict";let s=(0,e.i(383206).default)("file-check",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);e.s(["default",()=>s])},588477,e=>{"use strict";var s=e.i(403953);e.s(["FileCheck",()=>s.default])},672972,e=>{"use strict";var s=e.i(111043),t=e.i(227009),a=e.i(818796),i=e.i(946672),r=e.i(852648),l=e.i(87912),n=e.i(136764),c=e.i(982686),d=e.i(882896),o=e.i(588477),x=e.i(606661),m=e.i(559586),h=e.i(15751),u=e.i(848475),p=e.i(233654),j=e.i(913468),f=e.i(613240),v=e.i(14435),N=e.i(501651),g=e.i(176378),b=e.i(904653),w=e.i(970799),y=e.i(995403),C=e.i(552038),_=(0,C.createServerReference)("4066209038ae23a9a45e986f8c13ba3905ebd04f3f",C.callServer,void 0,C.findSourceMapURL,"archivePurchaseOrder"),k=(0,C.createServerReference)("7cd73a860e620e759c1e6c5723747509ab34fd5645",C.callServer,void 0,C.findSourceMapURL,"updatePurchaseOrderVendor"),S=e.i(263942),z=e.i(79254),D=e.i(390929),T=e.i(722573);e.i(889265);var U=e.i(677607);e.i(733296);var A=e.i(993665);e.i(220474);var P=e.i(171056),M=e.i(152088);function F({value:e,onValueChange:t,placeholder:a="Select vendor...",disabled:i=!1,className:r}){let[l,n]=(0,w.useState)(!1),[c,d]=(0,w.useState)([]),[o,x]=(0,w.useState)(!1),[m,h]=(0,w.useState)("");(0,w.useEffect)(()=>{let e=async()=>{x(!0);let e=await (0,T.searchVendors)(m||"");e.success&&e.data&&d(e.data),x(!1)},s=setTimeout(()=>{e()},300);return()=>clearTimeout(s)},[m]);let u=c.find(s=>s.id===e);return(0,s.jsxs)(P.Popover,{onOpenChange:n,open:l,children:[(0,s.jsx)(P.PopoverTrigger,{asChild:!0,children:(0,s.jsxs)(U.Button,{"aria-expanded":l,className:(0,M.cn)("w-full justify-between",!u&&"text-muted-foreground",r),disabled:i,role:"combobox",variant:"outline",children:[u?(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)(S.Building2,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:u.display_name||u.name}),(0,s.jsxs)("span",{className:"text-muted-foreground text-xs",children:["(",u.vendor_number,")"]})]}):(0,s.jsx)("span",{children:a}),(0,s.jsx)(D.ChevronsUpDown,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,s.jsx)(P.PopoverContent,{align:"start",className:"w-full p-0",children:(0,s.jsxs)(A.Command,{children:[(0,s.jsx)(A.CommandInput,{onValueChange:h,placeholder:"Search vendors..."}),(0,s.jsxs)(A.CommandList,{children:[(0,s.jsx)(A.CommandEmpty,{children:o?"Loading...":"No vendors found."}),(0,s.jsx)(A.CommandGroup,{children:c.map(a=>(0,s.jsxs)(A.CommandItem,{onSelect:()=>{t(a.id===e?void 0:a.id,a.id===e?void 0:a),n(!1)},value:`${a.name} ${a.vendor_number} ${a.email||""}`,children:[(0,s.jsx)(z.Check,{className:(0,M.cn)("mr-2 h-4 w-4",e===a.id?"opacity-100":"opacity-0")}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-medium",children:a.display_name||a.name}),(0,s.jsxs)("span",{className:"text-muted-foreground text-xs",children:[a.vendor_number,a.email&&` • ${a.email}`]})]})]},a.id))})]})]})})]})}var L=e.i(305549),B=e.i(585506);e.i(553153);var I=e.i(363712);e.i(539870);var O=e.i(846358);e.i(244242);var R=e.i(563078);e.i(149989);var $=e.i(880177),V=e.i(220168);e.i(6130);var q=e.i(506806);e.i(526120);var E=e.i(610120);e.i(711448);var H=e.i(157222),J=e.i(51052);function K({entityData:e,metrics:C}){(0,b.useRouter)();let{toast:S}=(0,J.useToast)(),[z,D]=(0,w.useState)(!1),[T,A]=(0,w.useState)(!1),[P,M]=(0,w.useState)(!1),[K,G]=(0,w.useState)(!1),{purchaseOrder:W,job:Y,estimate:Q,invoice:X,lineItems:Z=[],activities:ee=[],attachments:es=[],requestedByUser:et,approvedByUser:ea}=e,[ei,er]=(0,w.useState)(!1),[el,en]=(0,w.useState)(W.status||"draft"),[ec,ed]=(0,w.useState)(""),[eo,ex]=(0,w.useState)(!1),[em,eh]=(0,w.useState)(!1),[eu,ep]=(0,w.useState)(W.vendor_id),[ej,ef]=(0,w.useState)(null),[ev,eN]=(0,w.useState)(!1),[eg,eb]=(0,w.useState)(!1),[ew,ey]=(0,w.useState)("line-items"),eC=async()=>{G(!0);try{let e=await _(W.id);e.success?(y.toast.success("Purchase order archived successfully"),M(!1),window.location.href="/dashboard/work/purchase-orders"):y.toast.error(e.error||"Failed to archive purchase order")}catch(e){y.toast.error("Failed to archive purchase order")}finally{G(!1)}},e_=[{id:"line-items",title:"Line Items",count:Z.length,defaultOpen:!0,content:(0,s.jsx)(H.UnifiedAccordionContent,{children:Z.length>0?(0,s.jsx)("div",{className:"-mx-4 overflow-x-auto sm:mx-0",children:(0,s.jsxs)(q.Table,{children:[(0,s.jsx)(q.TableHeader,{className:"bg-background sticky top-0",children:(0,s.jsxs)(q.TableRow,{children:[(0,s.jsx)(q.TableHead,{className:"min-w-[200px]",children:"Description"}),(0,s.jsx)(q.TableHead,{className:"w-24 text-right",children:"Ordered"}),("partially_received"===W.status||"received"===W.status||Z.some(e=>e.received_quantity>0))&&(0,s.jsx)(q.TableHead,{className:"w-24 text-right",children:"Received"}),(0,s.jsx)(q.TableHead,{className:"w-32 text-right",children:"Unit Price"}),(0,s.jsx)(q.TableHead,{className:"w-32 text-right",children:"Total"})]})}),(0,s.jsxs)(q.TableBody,{children:[Z.map(e=>{let t=e.received_quantity||0,a=e.quantity||0,i=t>=a,l=t>0&&t<a;return(0,s.jsxs)(q.TableRow,{children:[(0,s.jsx)(q.TableCell,{className:"font-medium",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.description,i&&(0,s.jsx)(r.CheckCircle2,{"aria-label":"Fully received",className:"text-success size-4"}),l&&(0,s.jsx)(n.Clock,{"aria-label":"Partially received",className:"text-warning size-4"})]})}),(0,s.jsx)(q.TableCell,{className:"text-right",children:a}),("partially_received"===W.status||"received"===W.status||t>0)&&(0,s.jsxs)(q.TableCell,{className:"text-right",children:[(0,s.jsx)("span",{className:i?"text-success font-semibold":l?"text-warning":"",children:t}),l&&(0,s.jsxs)("span",{className:"text-muted-foreground ml-1 text-xs",children:["(",a-t," remaining)"]})]}),(0,s.jsx)(q.TableCell,{className:"text-right",children:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format((e.unit_price||0)/100)}),(0,s.jsx)(q.TableCell,{className:"text-right font-semibold",children:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a*(e.unit_price||0)/100)})]},e.id)}),(0,s.jsxs)(q.TableRow,{className:"bg-muted/50 border-t-2",children:[(0,s.jsx)(q.TableCell,{className:"text-right font-semibold",colSpan:"partially_received"===W.status||"received"===W.status||Z.some(e=>e.received_quantity>0)?4:3,children:"Total"}),(0,s.jsx)(q.TableCell,{className:"text-right text-lg font-bold",children:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(Z.reduce((e,s)=>e+(s.quantity||0)*(s.unit_price||0),0)/100)})]})]})]})}):(0,s.jsx)("div",{className:"flex h-64 items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(x.FileText,{className:"text-muted-foreground/50 mx-auto size-12"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-4 text-sm",children:"No line items yet"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"Add items to this purchase order"})]})})})}];return Y&&e_.push({id:"job-details",title:"Related Job",icon:(0,s.jsx)(N.Wrench,{className:"size-4"}),content:(0,s.jsx)(H.UnifiedAccordionContent,{children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-xs",children:"Job Number"}),(0,s.jsxs)(g.default,{className:"text-primary block text-sm font-medium hover:underline",href:`/dashboard/work/${Y.id}`,children:["#",Y.job_number]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-xs",children:"Title"}),(0,s.jsx)("p",{className:"text-sm",children:Y.title})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-xs",children:"Status"}),(0,s.jsx)(I.Badge,{variant:"outline",children:Y.status})]})]})})}),Q&&e_.push({id:"source-estimate",title:"Source Estimate",icon:(0,s.jsx)(x.FileText,{className:"size-4"}),content:(0,s.jsx)(H.UnifiedAccordionContent,{children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-xs",children:"Estimate Number"}),(0,s.jsxs)(g.default,{className:"text-primary block text-sm font-medium hover:underline",href:`/dashboard/work/estimates/${Q.id}`,children:["#",Q.estimate_number||Q.id.slice(0,8)]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-xs",children:"Title"}),(0,s.jsx)("p",{className:"text-sm",children:Q.title})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-xs",children:"Total Amount"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format((Q.total_amount||0)/100)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-xs",children:"Status"}),(0,s.jsx)(I.Badge,{variant:"outline",children:Q.status})]})]})})}),X&&e_.push({id:"related-invoice",title:"Related Invoice",icon:(0,s.jsx)(o.FileCheck,{className:"size-4"}),content:(0,s.jsx)(H.UnifiedAccordionContent,{children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-xs",children:"Invoice Number"}),(0,s.jsxs)(g.default,{className:"text-primary block text-sm font-medium hover:underline",href:`/dashboard/work/invoices/${X.id}`,children:["#",X.invoice_number||X.id.slice(0,8)]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-xs",children:"Title"}),(0,s.jsx)("p",{className:"text-sm",children:X.title})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-xs",children:"Total Amount"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format((X.total_amount||0)/100)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-xs",children:"Status"}),(0,s.jsx)(I.Badge,{variant:"paid"===X.status?"default":"outline",children:X.status})]})]})})}),(W.delivery_address||W.tracking_number)&&e_.push({id:"delivery",title:"Delivery Details",icon:(0,s.jsx)(h.MapPin,{className:"size-4"}),content:(0,s.jsx)(H.UnifiedAccordionContent,{children:(0,s.jsxs)("div",{className:"space-y-3",children:[W.delivery_address&&(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-xs",children:"Delivery Address"}),(0,s.jsx)("p",{className:"text-sm whitespace-pre-line",children:W.delivery_address})]}),W.tracking_number&&(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-xs",children:"Tracking Number"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("p",{className:"font-mono text-sm",children:W.tracking_number}),(0,s.jsx)(U.Button,{asChild:!0,className:"h-6 px-2",size:"sm",variant:"ghost",children:(0,s.jsx)("a",{href:`https://www.google.com/search?q=${encodeURIComponent(W.tracking_number)}`,rel:"noopener noreferrer",target:"_blank",children:"Track"})})]})]})]})})}),e_.push({id:"attachments",title:"Attachments",icon:(0,s.jsx)(p.Paperclip,{className:"size-4"}),count:es.length,content:(0,s.jsx)(H.UnifiedAccordionContent,{children:es.length>0?(0,s.jsx)("div",{className:"space-y-2",children:es.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between rounded-lg border p-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(x.FileText,{className:"text-muted-foreground size-4"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:e.original_file_name||e.file_name}),(0,s.jsxs)("p",{className:"text-muted-foreground text-xs",children:[e.file_size?`${(e.file_size/1024).toFixed(1)} KB`:"",e.category&&` • ${e.category}`]})]})]}),(0,s.jsx)(U.Button,{asChild:!0,size:"sm",variant:"ghost",children:(0,s.jsx)("a",{href:e.storage_url,rel:"noopener noreferrer",target:"_blank",children:(0,s.jsx)(d.Download,{className:"size-4"})})})]},e.id))}):(0,s.jsx)("p",{className:"text-muted-foreground text-center text-sm",children:"No attachments yet"})})}),(W.notes||W.internal_notes)&&e_.push({id:"notes",title:"Notes",icon:(0,s.jsx)(x.FileText,{className:"size-4"}),content:(0,s.jsx)(H.UnifiedAccordionContent,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[W.notes&&(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-xs",children:"Public Notes"}),(0,s.jsx)("p",{className:"mt-1 text-sm whitespace-pre-wrap",children:W.notes})]}),W.internal_notes&&(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-xs",children:"Internal Notes"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1 text-sm whitespace-pre-wrap",children:W.internal_notes})]})]})})}),e_.push({id:"documents",title:"Documents",icon:(0,s.jsx)(p.Paperclip,{className:"size-4"}),count:es.length,content:(0,s.jsx)(B.AttachmentsSection,{attachments:es})}),e_.push({id:"activity",title:"Activity",icon:(0,s.jsx)(t.Activity,{className:"size-4"}),count:ee.length,content:(0,s.jsx)(L.ActivityLogSection,{activities:ee})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"w-full",children:(0,s.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,s.jsxs)("div",{className:"hidden flex-row items-center justify-between lg:flex",children:[(0,s.jsx)("div",{className:"flex flex-row items-center gap-2",children:(0,s.jsx)("h1",{className:"text-2xl font-semibold",children:W.title})}),(0,s.jsxs)("div",{className:"flex h-min gap-2",children:[(0,s.jsxs)(U.Button,{onClick:()=>window.print(),size:"sm",variant:"outline",children:[(0,s.jsx)(f.Printer,{className:"mr-2 size-4"}),"Print"]}),W.vendor_email&&(0,s.jsx)(U.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,s.jsxs)("a",{href:`mailto:${W.vendor_email}?subject=Purchase Order ${W.po_number||W.poNumber}`,children:[(0,s.jsx)(m.Mail,{className:"mr-2 size-4"}),"Email Vendor"]})}),(0,s.jsxs)(R.DropdownMenu,{children:[(0,s.jsx)(R.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsx)(U.Button,{size:"sm",variant:"outline",children:(0,s.jsx)(u.MoreVertical,{className:"size-4"})})}),(0,s.jsxs)(R.DropdownMenuContent,{align:"end",children:[(0,s.jsx)(R.DropdownMenuItem,{onClick:()=>{en("pending_approval"),er(!0)},children:"Request Approval"}),(0,s.jsx)(R.DropdownMenuItem,{onClick:()=>{en("approved"),er(!0)},children:"Approve"}),(0,s.jsx)(R.DropdownMenuItem,{onClick:()=>{en("ordered"),er(!0)},children:"Mark as Ordered"}),(0,s.jsx)(R.DropdownMenuItem,{onClick:()=>{en("partially_received"),er(!0)},children:"Partially Received"}),(0,s.jsx)(R.DropdownMenuItem,{onClick:()=>{en("received"),er(!0)},children:"Mark as Received"}),(0,s.jsx)(R.DropdownMenuItem,{className:"text-destructive",onClick:()=>{en("cancelled"),er(!0)},children:"Cancel PO"}),(0,s.jsxs)(R.DropdownMenuItem,{onClick:()=>M(!0),children:[(0,s.jsx)(i.Archive,{className:"mr-2 size-4"}),"Archive"]})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-muted/50 rounded-md shadow-sm",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 overflow-hidden p-4 sm:p-6 md:flex-row",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsx)("div",{className:"aspect-[16/10] w-full md:w-[320px] lg:w-[400px]",children:(0,s.jsx)("div",{className:"border-border flex size-full w-full flex-none justify-center overflow-hidden rounded-lg border border-solid p-0",children:(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsx)("div",{className:"border-border w-full border-b border-solid p-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:["received"===W.status?(0,s.jsx)(r.CheckCircle2,{className:"text-success size-4"}):"cancelled"===W.status?(0,s.jsx)(a.AlertCircle,{className:"text-destructive size-4"}):(0,s.jsx)(n.Clock,{className:"text-warning size-4"}),(0,s.jsx)("h3",{className:"text-sm font-medium",children:W.status?.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())||"Draft"})]})}),(0,s.jsx)("div",{className:"flex h-[calc(100%-45px)] flex-col p-3",children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"PO Number"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:W.po_number||W.poNumber})]}),W.vendor&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"Vendor"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:W.vendor})]})]})})]})})}),(0,s.jsxs)("div",{className:"flex h-min flex-wrap gap-2 lg:hidden",children:[(0,s.jsxs)(U.Button,{className:"min-w-[96px] flex-1",onClick:()=>window.print(),size:"sm",variant:"outline",children:[(0,s.jsx)(f.Printer,{className:"mr-2 size-4"}),"Print"]}),W.vendor_email&&(0,s.jsx)(U.Button,{asChild:!0,className:"min-w-[96px] flex-1",size:"sm",variant:"outline",children:(0,s.jsxs)("a",{href:`mailto:${W.vendor_email}?subject=Purchase Order ${W.po_number||W.poNumber}`,children:[(0,s.jsx)(m.Mail,{className:"mr-2 size-4"}),"Email"]})}),(0,s.jsxs)(R.DropdownMenu,{children:[(0,s.jsx)(R.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsx)(U.Button,{size:"sm",variant:"outline",children:(0,s.jsx)(u.MoreVertical,{className:"size-4"})})}),(0,s.jsxs)(R.DropdownMenuContent,{align:"end",children:[(0,s.jsx)(R.DropdownMenuItem,{onClick:()=>{en("pending_approval"),er(!0)},children:"Request Approval"}),(0,s.jsx)(R.DropdownMenuItem,{onClick:()=>{en("approved"),er(!0)},children:"Approve"}),(0,s.jsx)(R.DropdownMenuItem,{onClick:()=>{en("ordered"),er(!0)},children:"Mark as Ordered"}),(0,s.jsx)(R.DropdownMenuItem,{onClick:()=>{en("partially_received"),er(!0)},children:"Partially Received"}),(0,s.jsx)(R.DropdownMenuItem,{onClick:()=>{en("received"),er(!0)},children:"Mark as Received"}),(0,s.jsx)(R.DropdownMenuItem,{className:"text-destructive",onClick:()=>{en("cancelled"),er(!0)},children:"Cancel PO"}),(0,s.jsxs)(R.DropdownMenuItem,{onClick:()=>M(!0),children:[(0,s.jsx)(i.Archive,{className:"mr-2 size-4"}),"Archive"]})]})]})]})]}),(0,s.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col gap-4 sm:gap-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4 [&>div]:flex-[0_1_auto]",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"Created"}),(0,s.jsxs)("div",{className:"flex h-5 items-center gap-2 text-sm whitespace-nowrap [&>*]:text-ellipsis",children:[(0,s.jsx)(v.User,{className:"text-muted-foreground size-4 flex-none"}),(0,s.jsx)("span",{className:"-ml-px shrink truncate text-sm",children:et?.name||et?.email||"Unknown"}),(0,s.jsx)("span",{className:"text-muted-foreground flex-none text-xs tabular-nums",children:new Date(W.created_at).toLocaleDateString()})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"Status"}),(0,s.jsxs)("div",{className:"-ml-[3px] flex h-5 items-center gap-1 text-sm whitespace-nowrap [&>*]:text-ellipsis",children:[(0,s.jsx)("span",{className:"flex size-4 items-center justify-center",children:(0,s.jsx)("span",{className:`size-2.5 flex-none rounded-full ${"received"===W.status?"bg-success":"cancelled"===W.status?"bg-destructive":"bg-warning"}`})}),(0,s.jsx)("span",{className:"text-sm",children:W.status?.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())||"Draft"}),W.priority&&(0,s.jsx)(I.Badge,{className:"ml-1",variant:"outline",children:W.priority})]})]}),W.expected_delivery&&(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"Expected Delivery"}),(0,s.jsxs)("div",{className:"flex h-5 items-center gap-2 text-sm whitespace-nowrap tabular-nums [&>*]:text-ellipsis",children:[(0,s.jsx)(n.Clock,{className:"text-muted-foreground size-4 flex-none"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:new Date(W.expected_delivery).toLocaleDateString()}),W.actual_delivery&&(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:new Date(W.actual_delivery).toLocaleDateString()})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"Total"}),(0,s.jsxs)("div",{className:"flex h-5 items-center gap-2 text-sm whitespace-nowrap [&>*]:text-ellipsis",children:[(0,s.jsx)(c.DollarSign,{className:"text-muted-foreground size-4 flex-none"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format((W.total_amount||0)/100)})]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"Vendor"}),(0,s.jsxs)("div",{className:"flex h-5 items-center gap-2 text-sm whitespace-nowrap [&>*]:text-ellipsis",children:[!em&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.User,{className:"text-muted-foreground size-4 flex-none"}),W.vendor?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:W.vendor}),(0,s.jsxs)(U.Button,{className:"h-6 px-2",onClick:()=>eh(!0),size:"sm",variant:"ghost",children:[(0,s.jsx)(j.Pencil,{className:"mr-1 size-3"}),"Change"]})]}):(0,s.jsx)(U.Button,{className:"h-6",onClick:()=>eh(!0),size:"sm",variant:"outline",children:"Assign Vendor"})]}),em&&(0,s.jsxs)("div",{className:"flex w-full items-center gap-2",children:[(0,s.jsx)(F,{className:"flex-1",onValueChange:(e,s)=>{ep(e),ef(s)},placeholder:"Select vendor...",value:eu}),(0,s.jsx)(U.Button,{className:"h-6",disabled:ev||!eu,onClick:async()=>{if(!eu)return void S.error("Please select a vendor");eN(!0);try{let e=ej?.display_name||ej?.name||W.vendor,s=ej?.email||W.vendor_email,t=ej?.phone||W.vendor_phone,a=await k(W.id,eu,e,s,t);if(a.success)S.success(`Vendor changed to ${e}`),eh(!1);else throw Error(a.error||"Failed to update vendor")}catch(e){S.error(e instanceof Error?e.message:"Failed to update vendor")}finally{eN(!1)}},size:"sm",children:ev?"Saving...":"Save"}),(0,s.jsx)(U.Button,{className:"h-6",disabled:ev,onClick:()=>{eh(!1),ep(W.vendor_id),ef(null)},size:"sm",variant:"ghost",children:"Cancel"})]})]})]}),W.job_id&&(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"Related Job"}),(0,s.jsxs)("div",{className:"flex h-5 items-center gap-2 text-sm whitespace-nowrap [&>*]:text-ellipsis",children:[(0,s.jsx)(o.FileCheck,{className:"text-muted-foreground size-4 flex-none"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:["Job #",W.job_id]})]})]})]})]}),(0,s.jsx)("div",{className:"rounded-b","data-orientation":"vertical",children:(0,s.jsxs)("div",{"data-orientation":"vertical","data-state":eg?"open":"closed",children:[(0,s.jsx)("button",{className:"ease border-border hover:bg-muted/50 disabled:text-muted-foreground flex h-12 w-full cursor-pointer items-center justify-between border-0 border-t bg-transparent px-4 transition-all duration-200","data-radix-collection-item":"",onClick:()=>eb(!eg),type:"button",children:(0,s.jsxs)("span",{className:"flex w-full items-center gap-2",children:[(0,s.jsx)(l.ChevronRight,{className:`size-4 transition-transform duration-200 ease-[ease] ${eg?"rotate-90":""}`}),(0,s.jsx)("span",{className:"flex w-full items-center gap-2",children:(0,s.jsx)("span",{className:"text-sm font-medium",children:"Purchase Order Details"})})]})}),(0,s.jsx)("div",{className:"slide-in-from-top-2 animate-in data-[state=closed]:animate-content-close data-[state=closed]:animate-out data-[state=open]:animate-content-open overflow-hidden duration-200 will-change-[height]","data-state":eg?"open":"closed",hidden:!eg,role:"region",children:(0,s.jsxs)("div",{className:"space-y-4 border-t p-4 sm:p-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-muted-foreground text-xs",children:"PO Number"}),(0,s.jsx)("p",{className:"mt-1 text-sm font-medium",children:W.po_number||W.poNumber})]}),W.delivery_address&&(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-muted-foreground text-xs",children:"Delivery Address"}),(0,s.jsx)("p",{className:"mt-1 text-sm whitespace-pre-line",children:W.delivery_address})]}),W.tracking_number&&(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-muted-foreground text-xs",children:"Tracking Number"}),(0,s.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,s.jsx)("p",{className:"font-mono text-sm",children:W.tracking_number}),(0,s.jsx)(U.Button,{asChild:!0,className:"h-6 px-2",size:"sm",variant:"ghost",children:(0,s.jsx)("a",{href:`https://www.google.com/search?q=${encodeURIComponent(W.tracking_number)}`,rel:"noopener noreferrer",target:"_blank",children:"Track"})})]})]}),W.notes&&(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-muted-foreground text-xs",children:"Public Notes"}),(0,s.jsx)("p",{className:"mt-1 text-sm whitespace-pre-wrap",children:W.notes})]}),W.internal_notes&&(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{className:"text-muted-foreground text-xs",children:"Internal Notes"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1 text-sm whitespace-pre-wrap",children:W.internal_notes})]})]})})]})})]}),(0,s.jsx)(H.UnifiedAccordion,{defaultOpenSection:"line-items",sections:e_})]})}),(0,s.jsx)(O.Dialog,{onOpenChange:er,open:ei,children:(0,s.jsxs)(O.DialogContent,{children:[(0,s.jsxs)(O.DialogHeader,{children:[(0,s.jsx)(O.DialogTitle,{children:"Update Purchase Order Status"}),(0,s.jsxs)(O.DialogDescription,{children:["Update the status of this purchase order to"," ",el.replace("_"," "),"."]})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)($.Label,{children:"New Status"}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(I.Badge,{variant:"default",children:el.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())})})]}),(0,s.jsx)(V.StandardFormField,{label:"Notes (Optional)",htmlFor:"status-notes",children:(0,s.jsx)(E.Textarea,{id:"status-notes",onChange:e=>ed(e.target.value),placeholder:"Add any notes about this status change...",value:ec})})]}),(0,s.jsxs)(O.DialogFooter,{className:"flex-col gap-2 sm:flex-row",children:[(0,s.jsx)(U.Button,{className:"w-full sm:w-auto",onClick:()=>{er(!1),ed("")},variant:"outline",children:"Cancel"}),(0,s.jsx)(U.Button,{className:"w-full sm:w-auto",disabled:eo,onClick:async()=>{S.success(`Status changed to ${el.replace("_"," ")}`),er(!1),ed("")},children:eo?"Updating...":"Update Status"})]})]})}),(0,s.jsx)(O.Dialog,{onOpenChange:M,open:P,children:(0,s.jsxs)(O.DialogContent,{children:[(0,s.jsxs)(O.DialogHeader,{children:[(0,s.jsx)(O.DialogTitle,{children:"Archive Purchase Order?"}),(0,s.jsx)(O.DialogDescription,{children:"This will archive the purchase order. You can restore it from the archive within 90 days."})]}),(0,s.jsxs)(O.DialogFooter,{children:[(0,s.jsx)(U.Button,{disabled:K,onClick:()=>M(!1),variant:"outline",children:"Cancel"}),(0,s.jsx)(U.Button,{disabled:K,onClick:eC,variant:"destructive",children:K?"Archiving...":"Archive Purchase Order"})]})]})})]})}e.s(["PurchaseOrderPageContent",()=>K],672972)}]);