(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,80777,e=>{"use strict";var t=e.i(111043),i=e.i(970799),s=e.i(904653),a=e.i(152088);e.i(889265);var o=e.i(677607);e.i(553153);var r=e.i(363712);e.i(51478);var n=e.i(635613);e.i(149989);var c=e.i(880177);e.i(526120);var l=e.i(610120);e.i(744662);var d=e.i(766667);e.i(868198);var m=e.i(798764);e.i(794747);var u=e.i(513990),p=e.i(840044),g=e.i(351753),g=g,y=e.i(635387),h=e.i(148347),b=e.i(935682),f=e.i(889773),v=e.i(186287),x=e.i(697029),_=e.i(371526),j=e.i(532727),C=e.i(51866),w=e.i(87912),T=e.i(598870),N=e.i(367571),k=e.i(142642),I=e.i(569398),S=e.i(136764),A=e.i(982686),P=e.i(760228),F=e.i(68599),R=e.i(276389),q=e.i(186224),q=q,L=e.i(175913),D=e.i(852648),H=e.i(963063),H=H,B=e.i(868106),z=e.i(403468),V=e.i(327149),M=e.i(606661),E=e.i(202724),J=e.i(678170),U=e.i(79254);let W={id:"invoices",name:"Invoices",dbTable:"invoices",description:"All customer invoices including draft, sent, paid, and overdue",tooltip:"Track billing performance, payment collection, and revenue recognition. Invoices are the primary source for revenue metrics and cash flow analysis.",icon:"Receipt",color:"emerald",category:"financial",fields:[{id:"total_amount",name:"Total Amount",dbColumn:"total",type:"currency",description:"Invoice total including all line items, taxes, and fees",tooltip:"The complete invoice amount before any payments or credits. This is the gross revenue expected from the invoice. Use this for revenue forecasting and sales performance tracking.",aggregations:["sum","avg","min","max"],category:"metric",businessImpact:"high"},{id:"subtotal",name:"Subtotal",dbColumn:"subtotal",type:"currency",description:"Sum of line items before taxes and discounts",tooltip:"The base price of all services and products before any modifications. Useful for understanding true service value separate from taxes and adjustments.",aggregations:["sum","avg"],category:"metric",businessImpact:"medium"},{id:"tax_amount",name:"Tax Amount",dbColumn:"tax_amount",type:"currency",description:"Total taxes applied to the invoice",tooltip:"All applicable taxes (sales tax, VAT, etc.). Track this for tax reporting and compliance. High tax amounts may indicate certain service types or geographic regions.",aggregations:["sum","avg"],category:"metric",businessImpact:"medium"},{id:"discount_amount",name:"Discount Amount",dbColumn:"discount_amount",type:"currency",description:"Total discounts applied",tooltip:"All discounts given on this invoice. Monitor discount trends to ensure profitability. Excessive discounting may indicate pricing issues or sales concerns.",aggregations:["sum","avg"],category:"metric",businessImpact:"high",relatedFields:["discount_percent","discount_reason"]},{id:"amount_paid",name:"Amount Paid",dbColumn:"amount_paid",type:"currency",description:"Total payments received against this invoice",tooltip:"Actual cash collected. The difference between total and amount_paid is your outstanding receivable. Critical for cash flow management.",aggregations:["sum","avg"],category:"metric",businessImpact:"high"},{id:"balance_due",name:"Balance Due",dbColumn:"balance_due",type:"currency",description:"Remaining amount to be collected",tooltip:"Outstanding balance = Total - Amount Paid. High balances indicate collection issues. Track by age to prioritize collection efforts.",formula:"total - amount_paid",aggregations:["sum","avg"],category:"metric",businessImpact:"high"},{id:"status",name:"Status",dbColumn:"status",type:"string",description:"Current invoice status",tooltip:"Invoice lifecycle stage: draft (not sent), sent (awaiting payment), partial (some payment received), paid (fully collected), overdue (past due date), void (cancelled). Use for pipeline analysis.",category:"dimension",businessImpact:"high"},{id:"invoice_date",name:"Invoice Date",dbColumn:"invoice_date",type:"date",description:"Date the invoice was created",tooltip:"When the invoice was generated. Use for revenue recognition timing, seasonal analysis, and billing cycle optimization.",category:"dimension",businessImpact:"medium"},{id:"due_date",name:"Due Date",dbColumn:"due_date",type:"date",description:"Payment due date",tooltip:"When payment is expected. Calculate days_overdue as today - due_date for aging analysis. Longer payment terms may affect cash flow.",category:"dimension",businessImpact:"medium"},{id:"paid_date",name:"Paid Date",dbColumn:"paid_date",type:"date",description:"Date payment was received",tooltip:"When the invoice was fully paid. Use paid_date - invoice_date to calculate Days Sales Outstanding (DSO). Faster payment = better cash flow.",category:"dimension",businessImpact:"medium"},{id:"days_to_pay",name:"Days to Pay",dbColumn:"days_to_pay",type:"number",description:"Number of days from invoice to payment",tooltip:"Measures payment speed. Lower is better. Industry average is 30-45 days. High values may indicate customer cash flow issues or billing disputes.",aggregations:["avg","median","min","max"],category:"metric",businessImpact:"high"},{id:"payment_method",name:"Payment Method",dbColumn:"payment_method",type:"string",description:"How the invoice was paid",tooltip:"Card, ACH, check, cash, financing. Different methods have different processing costs and timing. Cards: fast but ~3% fees. ACH: slower but cheaper. Checks: slowest, risk of bounce.",category:"dimension",businessImpact:"medium"}],relationships:[{targetSource:"customers",type:"many-to-many",foreignKey:"customer_id",description:"Invoices belong to customers"},{targetSource:"jobs",type:"many-to-many",foreignKey:"job_id",description:"Invoices are generated from jobs"},{targetSource:"payments",type:"one-to-many",foreignKey:"invoice_id",description:"Invoices can have multiple payments"}],commonFilters:[{id:"status_open",name:"Open Invoices",field:"status",operator:"in",description:"Invoices awaiting payment (sent, partial, overdue)"},{id:"status_paid",name:"Paid Invoices",field:"status",operator:"equals",description:"Fully paid invoices only"},{id:"overdue",name:"Overdue",field:"due_date",operator:"less_than",description:"Past due date and not fully paid"}],sampleQueries:[{name:"Monthly Revenue",description:"Total invoiced revenue by month",metrics:["total_amount"],dimensions:["invoice_date"]},{name:"Collection Rate",description:"Percentage of invoices paid on time",metrics:["amount_paid","total_amount"],dimensions:["status"]}]},K={id:"payments",name:"Payments",dbTable:"payments",description:"All payment transactions received",tooltip:"Track cash inflows, payment methods, and transaction success rates. Essential for cash flow management and reconciliation.",icon:"CreditCard",color:"green",category:"financial",fields:[{id:"amount",name:"Amount",dbColumn:"amount",type:"currency",description:"Payment amount received",tooltip:"The actual cash received. Note: This is stored in cents (multiply display by 100 for database queries). Track by payment method to optimize processing costs.",aggregations:["sum","avg","min","max","count"],category:"metric",businessImpact:"high"},{id:"payment_method",name:"Payment Method",dbColumn:"payment_method",type:"string",description:"How payment was made",tooltip:"Credit card, debit card, ACH, check, cash, or financing. Each has different costs: Cards ~2.9%, ACH ~0.5%, Check/Cash ~0%. Optimize mix to reduce fees.",category:"dimension",businessImpact:"medium"},{id:"status",name:"Status",dbColumn:"status",type:"string",description:"Transaction status",tooltip:"pending (processing), succeeded (confirmed), failed (declined), refunded (returned to customer). Monitor failed rates to identify card/bank issues.",category:"dimension",businessImpact:"high"},{id:"processing_fee",name:"Processing Fee",dbColumn:"processing_fee",type:"currency",description:"Payment processor fees",tooltip:"Fees charged by payment processors (Stripe, Square, etc.). Track this to understand true net revenue. Typically 2.9% + $0.30 for cards.",aggregations:["sum","avg"],category:"metric",businessImpact:"medium"},{id:"net_amount",name:"Net Amount",dbColumn:"net_amount",type:"currency",description:"Amount after fees",tooltip:"What you actually receive after processor fees. Net Amount = Amount - Processing Fee. This is your true cash intake.",formula:"amount - processing_fee",aggregations:["sum","avg"],category:"metric",businessImpact:"high"},{id:"payment_date",name:"Payment Date",dbColumn:"payment_date",type:"date",description:"When payment was received",tooltip:"Transaction timestamp. Note: Cards process instantly but settle in 2-3 days. ACH takes 3-5 business days. Use for cash flow forecasting.",category:"dimension",businessImpact:"medium"},{id:"refund_amount",name:"Refund Amount",dbColumn:"refund_amount",type:"currency",description:"Amount refunded to customer",tooltip:"Money returned. High refund rates may indicate quality issues or customer dissatisfaction. Monitor refund reasons to identify patterns.",aggregations:["sum","avg"],category:"metric",businessImpact:"high"}],relationships:[{targetSource:"invoices",type:"many-to-many",foreignKey:"invoice_id",description:"Payments apply to invoices"},{targetSource:"customers",type:"many-to-many",foreignKey:"customer_id",description:"Payments come from customers"}],commonFilters:[{id:"successful",name:"Successful Payments",field:"status",operator:"equals",description:"Only confirmed payments"},{id:"refunded",name:"Refunded",field:"status",operator:"equals",description:"Payments that were refunded"}],sampleQueries:[{name:"Daily Cash Flow",description:"Net payments by day",metrics:["net_amount"],dimensions:["payment_date"]},{name:"Payment Method Mix",description:"Revenue breakdown by payment type",metrics:["amount"],dimensions:["payment_method"]}]},O={id:"jobs",name:"Jobs",dbTable:"jobs",description:"Service jobs and work orders",tooltip:"The core operational unit. Jobs track all service work from scheduling to completion. Critical for operational efficiency, resource utilization, and revenue generation.",icon:"Briefcase",color:"blue",category:"operations",fields:[{id:"status",name:"Status",dbColumn:"status",type:"string",description:"Current job status",tooltip:"Job lifecycle: draft → scheduled → in_progress → completed → invoiced. Track status transitions for operational efficiency. Jobs stuck in one status may indicate process issues.",category:"dimension",businessImpact:"high"},{id:"job_type",name:"Job Type",dbColumn:"job_type",type:"string",description:"Category of service",tooltip:"Service category (repair, maintenance, installation, inspection, emergency). Different types have different margins and resource requirements. Track profitability by type.",category:"dimension",businessImpact:"high"},{id:"priority",name:"Priority",dbColumn:"priority",type:"string",description:"Job urgency level",tooltip:"low, normal, high, emergency. Higher priority jobs often command premium pricing. Track priority distribution to optimize scheduling and staffing.",category:"dimension",businessImpact:"medium"},{id:"total_amount",name:"Total Amount",dbColumn:"total",type:"currency",description:"Total job revenue",tooltip:"Complete job value including labor, parts, and fees. This is potential revenue - actual collection depends on invoicing and payment. Track vs. estimates for accuracy.",aggregations:["sum","avg","min","max"],category:"metric",businessImpact:"high"},{id:"labor_cost",name:"Labor Cost",dbColumn:"labor_cost",type:"currency",description:"Cost of technician time",tooltip:"Total labor expense = hours × hourly rate. Compare to labor_revenue to understand labor margin. Target 50-60% labor margin for healthy profitability.",aggregations:["sum","avg"],category:"metric",businessImpact:"high"},{id:"parts_cost",name:"Parts Cost",dbColumn:"parts_cost",type:"currency",description:"Cost of materials used",tooltip:"Inventory and parts expense. Track markup (parts_revenue / parts_cost) to ensure healthy margins. Industry standard is 40-100% markup on parts.",aggregations:["sum","avg"],category:"metric",businessImpact:"high"},{id:"gross_profit",name:"Gross Profit",dbColumn:"gross_profit",type:"currency",description:"Revenue minus direct costs",tooltip:"Gross Profit = Total - Labor Cost - Parts Cost. This is your contribution margin before overhead. Target 40-50% gross margin for sustainable business.",formula:"total - labor_cost - parts_cost",aggregations:["sum","avg"],category:"metric",businessImpact:"high"},{id:"gross_margin",name:"Gross Margin %",dbColumn:"gross_margin_percent",type:"percentage",description:"Profit as percentage of revenue",tooltip:"Gross Margin = (Gross Profit / Total) × 100. Higher is better. Below 30% may indicate pricing or cost issues. Track by job type to identify profitable services.",formula:"(gross_profit / total) * 100",aggregations:["avg","median"],category:"metric",businessImpact:"high"},{id:"scheduled_start",name:"Scheduled Start",dbColumn:"scheduled_start",type:"date",description:"When job is scheduled to begin",tooltip:"Planned start time. Compare to actual_start for schedule adherence. Large gaps indicate dispatch inefficiency or customer-caused delays.",category:"dimension",businessImpact:"medium"},{id:"actual_start",name:"Actual Start",dbColumn:"actual_start",type:"date",description:"When job actually started",tooltip:"Real start time. Actual vs Scheduled variance measures operational efficiency. Target < 15 min variance for good customer experience.",category:"dimension",businessImpact:"medium"},{id:"completed_at",name:"Completed At",dbColumn:"completed_at",type:"date",description:"When job was finished",tooltip:"Completion timestamp. Use for cycle time analysis (completed_at - created_at) and productivity tracking (jobs per day).",category:"dimension",businessImpact:"medium"},{id:"duration_hours",name:"Duration (Hours)",dbColumn:"duration_hours",type:"duration",description:"Total time spent on job",tooltip:"Actual hours worked. Compare to estimated_hours for accuracy. Consistently over-running estimates indicates poor scoping or training needs.",aggregations:["sum","avg","median"],category:"metric",businessImpact:"high"},{id:"estimated_hours",name:"Estimated Hours",dbColumn:"estimated_hours",type:"duration",description:"Planned job duration",tooltip:"Expected hours at scheduling. Accuracy affects scheduling density and customer expectations. Track by job type to improve future estimates.",aggregations:["sum","avg"],category:"metric",businessImpact:"medium"},{id:"first_time_fix",name:"First Time Fix",dbColumn:"first_time_fix",type:"boolean",description:"Was job completed on first visit?",tooltip:"TRUE if resolved without return visit. Industry benchmark is 85-90% FTF rate. Low rates indicate parts availability, diagnosis, or training issues. Huge impact on profitability.",category:"dimension",businessImpact:"high"},{id:"callback_required",name:"Callback Required",dbColumn:"callback_required",type:"boolean",description:"Did job require a return visit?",tooltip:"TRUE if technician had to return. Callbacks are expensive - typically cost 2x the original job. Track by technician and job type to identify issues.",category:"dimension",businessImpact:"high"},{id:"customer_rating",name:"Customer Rating",dbColumn:"customer_rating",type:"rating",description:"Customer satisfaction score",tooltip:"1-5 star rating from customer. Average should be 4.5+. Below 4.0 indicates service issues. Low ratings correlate with churn - address immediately.",aggregations:["avg","count"],category:"metric",businessImpact:"high"},{id:"lead_source",name:"Lead Source",dbColumn:"source",type:"string",description:"How customer found you",tooltip:"Marketing attribution: referral, google, facebook, repeat, etc. Track revenue by source to optimize marketing spend. Referrals typically have highest conversion and LTV.",category:"dimension",businessImpact:"high"}],relationships:[{targetSource:"customers",type:"many-to-many",foreignKey:"customer_id",description:"Jobs are performed for customers"},{targetSource:"team_members",type:"many-to-many",foreignKey:"assigned_to",description:"Jobs are assigned to technicians"},{targetSource:"invoices",type:"one-to-many",foreignKey:"job_id",description:"Jobs generate invoices"},{targetSource:"estimates",type:"one-to-many",foreignKey:"job_id",description:"Jobs may have estimates"},{targetSource:"equipment",type:"many-to-many",foreignKey:"equipment_id",description:"Jobs service equipment"}],commonFilters:[{id:"completed",name:"Completed Jobs",field:"status",operator:"equals",description:"Only finished jobs"},{id:"in_progress",name:"In Progress",field:"status",operator:"equals",description:"Currently active jobs"},{id:"emergency",name:"Emergency Jobs",field:"priority",operator:"equals",description:"High priority emergency calls"}],sampleQueries:[{name:"Revenue by Job Type",description:"Total revenue broken down by service category",metrics:["total_amount","gross_profit"],dimensions:["job_type"]},{name:"Technician Productivity",description:"Jobs completed and revenue per technician",metrics:["total_amount","duration_hours"],dimensions:["assigned_to"]},{name:"First Time Fix Rate",description:"Percentage of jobs completed on first visit",metrics:["first_time_fix"],dimensions:["job_type","assigned_to"]}]},Q={id:"estimates",name:"Estimates",dbTable:"estimates",description:"Quotes and proposals sent to customers",tooltip:"Track your sales pipeline. Estimates represent potential revenue. Monitor conversion rates, average values, and time-to-close to optimize your sales process.",icon:"FileText",color:"amber",category:"operations",fields:[{id:"total_amount",name:"Total Amount",dbColumn:"total",type:"currency",description:"Estimate total value",tooltip:"Proposed job value. This is your potential revenue pipeline. Track total estimates value to forecast future revenue. Compare to actual job values to measure estimate accuracy.",aggregations:["sum","avg","min","max"],category:"metric",businessImpact:"high"},{id:"status",name:"Status",dbColumn:"status",type:"string",description:"Estimate lifecycle stage",tooltip:"draft (not sent), sent (awaiting response), viewed (customer opened), accepted (converted to job), declined (lost), expired (past valid date). Pipeline stage for forecasting.",category:"dimension",businessImpact:"high"},{id:"conversion_probability",name:"Conversion Probability",dbColumn:"conversion_probability",type:"percentage",description:"Likelihood of winning this estimate",tooltip:"AI-predicted win probability based on historical data. Use for weighted pipeline forecasting: Expected Revenue = Total × Probability. Higher values indicate better qualified opportunities.",aggregations:["avg"],category:"metric",businessImpact:"medium"},{id:"created_at",name:"Created At",dbColumn:"created_at",type:"date",description:"When estimate was created",tooltip:"Creation timestamp. Track estimate volume over time. Sudden drops may indicate lead generation issues. Spikes may strain your capacity to follow up.",category:"dimension",businessImpact:"medium"},{id:"sent_at",name:"Sent At",dbColumn:"sent_at",type:"date",description:"When estimate was sent to customer",tooltip:"Delivery timestamp. Time from creation to send should be < 24 hours for best conversion. Delays hurt win rates.",category:"dimension",businessImpact:"medium"},{id:"viewed_at",name:"Viewed At",dbColumn:"viewed_at",type:"date",description:"When customer first viewed",tooltip:"Customer engagement signal. Quick views indicate interest. No view after 48 hours suggests the estimate may be in spam or customer is not engaged.",category:"dimension",businessImpact:"medium"},{id:"accepted_at",name:"Accepted At",dbColumn:"accepted_at",type:"date",description:"When estimate was approved",tooltip:"Conversion timestamp. Days from sent to accepted is your sales cycle length. Shorter cycles = healthier pipeline. Long cycles may need follow-up automation.",category:"dimension",businessImpact:"high"},{id:"expiry_date",name:"Expiry Date",dbColumn:"valid_until",type:"date",description:"When estimate expires",tooltip:"Deadline for customer decision. Expired estimates should be followed up or closed. Short validity (7-14 days) creates urgency. Long validity (30+ days) may delay decisions.",category:"dimension",businessImpact:"medium"},{id:"days_to_convert",name:"Days to Convert",dbColumn:"days_to_convert",type:"number",description:"Time from sent to accepted",tooltip:"Sales cycle length. Industry average is 7-14 days. Longer cycles tie up resources and reduce forecast accuracy. Track by estimate size - larger deals typically take longer.",aggregations:["avg","median","min","max"],category:"metric",businessImpact:"high"},{id:"follow_up_count",name:"Follow-up Count",dbColumn:"follow_up_count",type:"number",description:"Number of follow-up attempts",tooltip:"How many times you've followed up. Sweet spot is 2-5 follow-ups. Zero follow-ups hurt conversion. Too many (10+) wastes resources on unqualified leads.",aggregations:["avg","sum"],category:"metric",businessImpact:"medium"},{id:"decline_reason",name:"Decline Reason",dbColumn:"decline_reason",type:"string",description:"Why estimate was rejected",tooltip:"Categories: price (too expensive), timing (not ready), competitor (chose another), diy (doing themselves), other. Track to identify patterns and improve win rate.",category:"dimension",businessImpact:"high"}],relationships:[{targetSource:"customers",type:"many-to-many",foreignKey:"customer_id",description:"Estimates are for customers"},{targetSource:"jobs",type:"one-to-many",foreignKey:"estimate_id",description:"Accepted estimates become jobs"}],commonFilters:[{id:"pending",name:"Pending Response",field:"status",operator:"in",description:"Estimates awaiting customer decision"},{id:"won",name:"Won Estimates",field:"status",operator:"equals",description:"Converted to jobs"},{id:"lost",name:"Lost Estimates",field:"status",operator:"equals",description:"Declined or expired"}],sampleQueries:[{name:"Conversion Funnel",description:"Estimates by stage with conversion rates",metrics:["total_amount"],dimensions:["status"]},{name:"Win/Loss Analysis",description:"Declined estimates by reason",metrics:["total_amount"],dimensions:["decline_reason"],filters:["lost"]}]},G={id:"customers",name:"Customers",dbTable:"customers",description:"All customer records and profiles",tooltip:"Your customer base is your most valuable asset. Track customer health, lifetime value, and engagement to maximize retention and growth.",icon:"Users",color:"purple",category:"customers",fields:[{id:"lifetime_value",name:"Lifetime Value",dbColumn:"lifetime_value",type:"currency",description:"Total revenue from this customer",tooltip:"All-time revenue generated. LTV = Sum of all invoices paid. High LTV customers deserve VIP treatment. Track LTV growth over time to measure customer development success.",aggregations:["sum","avg","max"],category:"metric",businessImpact:"high"},{id:"total_revenue",name:"Total Revenue",dbColumn:"total_revenue",type:"currency",description:"Sum of all customer invoices",tooltip:"Total billed amount. May differ from lifetime_value due to outstanding balances or refunds. Use for revenue analysis.",aggregations:["sum","avg"],category:"metric",businessImpact:"high"},{id:"outstanding_balance",name:"Outstanding Balance",dbColumn:"outstanding_balance",type:"currency",description:"Amount currently owed",tooltip:"Unpaid invoice total. High balances may indicate payment issues. Consider before offering new services. Important for credit management.",aggregations:["sum","avg"],category:"metric",businessImpact:"high"},{id:"total_jobs",name:"Total Jobs",dbColumn:"total_jobs",type:"number",description:"Number of completed jobs",tooltip:"Service frequency indicator. More jobs = more engaged customer. Zero jobs after estimate may indicate lost opportunity.",aggregations:["sum","avg"],category:"metric",businessImpact:"medium"},{id:"average_job_value",name:"Average Job Value",dbColumn:"average_job_value",type:"currency",description:"Mean revenue per job",tooltip:"Average ticket size. Track over time - declining AJV may indicate downselling or competition. Rising AJV suggests successful upselling.",aggregations:["avg"],category:"metric",businessImpact:"high"},{id:"customer_segment",name:"Segment",dbColumn:"customer_segment",type:"string",description:"Customer classification",tooltip:"Behavioral segment: new (< 90 days), active (recent service), loyal (multiple services), at_risk (overdue for service), dormant (no activity 1+ year), churned (lost), vip (top 10% LTV).",category:"dimension",businessImpact:"high"},{id:"health_score",name:"Health Score",dbColumn:"health_score",type:"number",description:"Customer engagement score (0-100)",tooltip:"Composite score based on: recency (last service), frequency (job count), monetary (LTV), satisfaction (ratings), and balance (payment behavior). Above 70 = healthy, below 40 = at risk.",aggregations:["avg","min","max"],category:"metric",businessImpact:"high"},{id:"churn_risk",name:"Churn Risk",dbColumn:"churn_risk",type:"string",description:"Likelihood of losing customer",tooltip:"AI-predicted risk: low (< 20%), medium (20-50%), high (> 50%), churned (lost). Prioritize retention efforts on high-risk valuable customers.",category:"dimension",businessImpact:"high"},{id:"last_job_date",name:"Last Service Date",dbColumn:"last_job_date",type:"date",description:"Most recent service",tooltip:"Recency indicator. Customers with no service in 12+ months are dormant. Schedule proactive outreach based on typical service intervals.",category:"dimension",businessImpact:"high"},{id:"created_at",name:"Customer Since",dbColumn:"created_at",type:"date",description:"Account creation date",tooltip:"Customer tenure. Longer tenure typically means higher LTV. Track new customer acquisition rate monthly.",category:"dimension",businessImpact:"medium"},{id:"source",name:"Acquisition Source",dbColumn:"source",type:"string",description:"How customer found you",tooltip:"Lead source: referral, google, facebook, yelp, repeat, direct, etc. Track LTV by source to optimize marketing spend. Referrals typically have 25-50% higher LTV.",category:"dimension",businessImpact:"high"},{id:"type",name:"Customer Type",dbColumn:"type",type:"string",description:"Residential or commercial",tooltip:"Business classification. Commercial customers typically have higher AJV but longer payment cycles. Residential is higher volume, faster payment.",category:"dimension",businessImpact:"medium"},{id:"average_satisfaction",name:"Average Satisfaction",dbColumn:"average_satisfaction_rating",type:"rating",description:"Mean customer rating",tooltip:"Average of all job ratings. Below 4.0 indicates relationship issues. Track trend over time - declining satisfaction predicts churn.",aggregations:["avg"],category:"metric",businessImpact:"high"},{id:"nps_score",name:"NPS Score",dbColumn:"nps_score",type:"number",description:"Net Promoter Score",tooltip:"Would they recommend you? -100 to +100 scale. Promoters (9-10), Passives (7-8), Detractors (0-6). Score > 50 is excellent. Industry average is 30-40.",aggregations:["avg"],category:"metric",businessImpact:"high"},{id:"equipment_count",name:"Equipment Count",dbColumn:"equipment_count",type:"number",description:"Number of units on file",tooltip:"More equipment = more service opportunities. Cross-sell maintenance plans. Equipment data enables proactive outreach when units age out.",aggregations:["sum","avg"],category:"metric",businessImpact:"medium"},{id:"active_contract_value",name:"Contract Value",dbColumn:"active_contract_value",type:"currency",description:"Value of active service agreements",tooltip:"Recurring revenue from this customer. Contract customers have 3-5x higher retention. Track contract penetration to grow recurring revenue.",aggregations:["sum","avg"],category:"metric",businessImpact:"high"}],relationships:[{targetSource:"jobs",type:"one-to-many",foreignKey:"customer_id",description:"Customers have many jobs"},{targetSource:"invoices",type:"one-to-many",foreignKey:"customer_id",description:"Customers receive invoices"},{targetSource:"properties",type:"one-to-many",foreignKey:"customer_id",description:"Customers have properties"},{targetSource:"equipment",type:"one-to-many",foreignKey:"customer_id",description:"Customers own equipment"}],commonFilters:[{id:"active",name:"Active Customers",field:"status",operator:"equals",description:"Currently active accounts"},{id:"at_risk",name:"At Risk",field:"churn_risk",operator:"in",description:"High churn risk customers"},{id:"vip",name:"VIP Customers",field:"customer_segment",operator:"equals",description:"Top tier customers"}],sampleQueries:[{name:"Customer Segmentation",description:"Customer count and LTV by segment",metrics:["lifetime_value"],dimensions:["customer_segment"]},{name:"Acquisition Analysis",description:"New customers and LTV by source",metrics:["lifetime_value","total_jobs"],dimensions:["source"]},{name:"Churn Risk Report",description:"At-risk customers sorted by value",metrics:["lifetime_value","health_score"],dimensions:["churn_risk"],filters:["at_risk"]}]},$={id:"team_members",name:"Team Members",dbTable:"team_members",description:"Employees and their performance metrics",tooltip:"Track technician productivity, efficiency, and quality. Team performance directly impacts profitability and customer satisfaction.",icon:"UserCheck",color:"indigo",category:"team",fields:[{id:"name",name:"Name",dbColumn:"display_name",type:"string",description:"Team member name",tooltip:"Full name for display. Use for grouping and reporting.",category:"dimension",businessImpact:"low"},{id:"role",name:"Role",dbColumn:"role",type:"string",description:"Job title/position",tooltip:"Position: technician, senior_tech, lead, manager, admin. Different roles have different metrics expectations. Compare within role groups.",category:"dimension",businessImpact:"medium"},{id:"hourly_rate",name:"Hourly Rate",dbColumn:"hourly_rate",type:"currency",description:"Pay rate per hour",tooltip:"Labor cost basis. Use to calculate job costs and margins. Higher rates should correlate with higher productivity or specialized skills.",aggregations:["avg"],category:"metric",businessImpact:"high"},{id:"billable_rate",name:"Billable Rate",dbColumn:"billable_rate",type:"currency",description:"Rate charged to customers",tooltip:"What you charge for this tech's time. Billable Rate / Hourly Rate = Labor Margin. Target 2-3x multiplier for healthy margins.",aggregations:["avg"],category:"metric",businessImpact:"high"},{id:"utilization_rate",name:"Utilization Rate",dbColumn:"utilization_rate",type:"percentage",description:"Percentage of time on billable work",tooltip:"Billable Hours / Available Hours × 100. Target 70-80%. Below 60% indicates scheduling issues or training needs. Above 90% risks burnout.",aggregations:["avg"],category:"metric",businessImpact:"high"},{id:"jobs_completed",name:"Jobs Completed",dbColumn:"jobs_completed_count",type:"number",description:"Number of jobs finished",tooltip:"Productivity measure. Track weekly/monthly trends. Sudden drops may indicate issues. Compare to team average and historical performance.",aggregations:["sum","avg"],category:"metric",businessImpact:"high"},{id:"revenue_generated",name:"Revenue Generated",dbColumn:"revenue_generated",type:"currency",description:"Total revenue from assigned jobs",tooltip:"Value of work completed. Revenue per tech varies by experience, job mix, and territory. Use for commission calculations and performance reviews.",aggregations:["sum","avg"],category:"metric",businessImpact:"high"},{id:"average_job_value",name:"Average Job Value",dbColumn:"average_job_value",type:"currency",description:"Mean revenue per job",tooltip:"Revenue / Jobs Completed. Higher values indicate upselling success. Compare across team to identify training opportunities.",aggregations:["avg"],category:"metric",businessImpact:"high"},{id:"first_time_fix_rate",name:"First Time Fix Rate",dbColumn:"first_time_fix_rate",type:"percentage",description:"Jobs completed on first visit",tooltip:"Quality indicator. Target 85-90%. Below 75% needs investigation - could be training, parts availability, or dispatch issues. Huge impact on profitability.",aggregations:["avg"],category:"metric",businessImpact:"high"},{id:"callback_rate",name:"Callback Rate",dbColumn:"callback_rate",type:"percentage",description:"Jobs requiring return visit",tooltip:"Inverse of FTF. Target < 15%. High callback rates are expensive (2x cost) and damage customer satisfaction. Identify root causes.",aggregations:["avg"],category:"metric",businessImpact:"high"},{id:"average_rating",name:"Average Rating",dbColumn:"average_rating",type:"rating",description:"Mean customer satisfaction score",tooltip:"Customer ratings 1-5. Target 4.5+. Below 4.0 requires immediate attention. Ratings impact customer retention and referrals.",aggregations:["avg"],category:"metric",businessImpact:"high"},{id:"avg_job_duration",name:"Avg Job Duration",dbColumn:"average_job_duration",type:"duration",description:"Average time per job",tooltip:"Mean hours per job. Lower is more efficient IF quality is maintained. Compare by job type - some naturally take longer. Track trend over time.",aggregations:["avg"],category:"metric",businessImpact:"medium"},{id:"on_time_arrival_rate",name:"On-Time Arrival",dbColumn:"on_time_arrival_rate",type:"percentage",description:"Percentage arriving within window",tooltip:"Punctuality measure. Target 90%+. Late arrivals hurt customer satisfaction. May indicate routing issues, poor time estimation, or traffic problems.",aggregations:["avg"],category:"metric",businessImpact:"medium"},{id:"overtime_hours",name:"Overtime Hours",dbColumn:"overtime_hours",type:"duration",description:"Hours worked over 40/week",tooltip:"OT is 1.5x cost. Some OT is healthy (high demand), excessive OT (15%+ of hours) indicates understaffing or poor scheduling.",aggregations:["sum","avg"],category:"metric",businessImpact:"high"}],relationships:[{targetSource:"jobs",type:"one-to-many",foreignKey:"assigned_to",description:"Team members are assigned jobs"}],commonFilters:[{id:"technicians",name:"Technicians Only",field:"role",operator:"in",description:"Field service technicians"},{id:"active",name:"Active Employees",field:"status",operator:"equals",description:"Currently employed"}],sampleQueries:[{name:"Productivity Leaderboard",description:"Revenue and jobs by technician",metrics:["revenue_generated","jobs_completed"],dimensions:["name"]},{name:"Quality Metrics",description:"FTF rate and ratings by technician",metrics:["first_time_fix_rate","average_rating"],dimensions:["name"]},{name:"Efficiency Analysis",description:"Utilization and average job duration",metrics:["utilization_rate","avg_job_duration"],dimensions:["name","role"]}]},Y=[W,K,O,Q,G,$],Z={invoices:W,payments:K,jobs:O,estimates:Q,customers:G,team_members:$};var X=e.i(24079);let ee=[{id:"source",title:"Choose Data Source",shortTitle:"Source"},{id:"fields",title:"Select Fields",shortTitle:"Fields"},{id:"filters",title:"Add Filters",shortTitle:"Filters"},{id:"visualization",title:"Choose Chart",shortTitle:"Chart"},{id:"save",title:"Name & Save",shortTitle:"Save"}],et=[{value:"equals",label:"Equals"},{value:"not_equals",label:"Not Equals"},{value:"greater_than",label:"Greater Than"},{value:"less_than",label:"Less Than"},{value:"between",label:"Between"},{value:"contains",label:"Contains"},{value:"is_null",label:"Is Empty"},{value:"is_not_null",label:"Has Value"}],ei=[{value:"table",label:"Table",icon:g.default,description:"Raw data in rows and columns"},{value:"bar",label:"Bar Chart",icon:b.BarChart3,description:"Compare values across categories"},{value:"line",label:"Line Chart",icon:f.LineChart,description:"Show trends over time"},{value:"pie",label:"Pie Chart",icon:v.PieChart,description:"Show proportions of a whole"},{value:"area",label:"Area Chart",icon:x.TrendingUp,description:"Cumulative data over time"}],es={invoices:B.Receipt,payments:z.CreditCard,jobs:V.Briefcase,estimates:M.FileText,customers:E.Users,team_members:J.UserCheck},ea={currency:A.DollarSign,percentage:P.Percent,number:F.Hash,date:R.Calendar,boolean:q.default,rating:L.Star,string:y.Columns3,duration:S.Clock};function eo({type:e}){let i=ea[e]||y.Columns3;return(0,t.jsx)(i,{className:"h-3.5 w-3.5"})}function er({selectedSource:e,onSelect:i}){return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"What data do you want to analyze?"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Choose a data source to get started. This determines what fields are available."})]}),(0,t.jsx)("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:Y.map(s=>{let o=es[s.id]||p.Database,n=e===s.id;return(0,t.jsxs)("button",{type:"button",onClick:()=>i(s.id),className:(0,a.cn)("group relative flex flex-col items-center gap-3 rounded-xl p-6 text-center transition-all",n?"bg-primary/10 ring-2 ring-primary":"bg-muted/30 hover:bg-muted/50"),children:[n&&(0,t.jsx)("div",{className:"absolute top-3 right-3",children:(0,t.jsx)(D.CheckCircle2,{className:"h-5 w-5 text-primary"})}),(0,t.jsx)("div",{className:(0,a.cn)("flex h-14 w-14 items-center justify-center rounded-full transition-colors",n?"bg-primary text-primary-foreground":"bg-muted group-hover:bg-muted/80"),children:(0,t.jsx)(o,{className:"h-7 w-7"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold",children:s.name}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-2",children:s.description})]}),(0,t.jsxs)(r.Badge,{variant:"secondary",className:"text-xs",children:[s.fields.length," fields"]})]},s.id)})})]})}function en({source:e,selectedFields:s,onToggleField:o}){let[c,l]=(0,i.useState)(""),d=e.fields.filter(e=>"metric"===e.category),m=e.fields.filter(e=>"dimension"===e.category||"attribute"===e.category),u=d.filter(e=>e.name.toLowerCase().includes(c.toLowerCase())),p=m.filter(e=>e.name.toLowerCase().includes(c.toLowerCase())),g=e=>s.some(t=>t.fieldId===e);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"What data do you want to see?"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select the fields to include in your report. Click to toggle."})]}),(0,t.jsx)(n.Input,{placeholder:"Search fields...",value:c,onChange:e=>l(e.target.value),className:"max-w-md"}),(0,t.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(I.Calculator,{className:"h-4 w-4 text-blue-500"}),(0,t.jsx)("span",{className:"font-medium",children:"Metrics"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"(Numbers you can sum, average, etc.)"})]}),(0,t.jsx)("div",{className:"space-y-1.5 max-h-[300px] overflow-y-auto pr-2",children:u.map(e=>{let i=g(e.id);return(0,t.jsxs)("button",{type:"button",onClick:()=>o(e),className:(0,a.cn)("w-full flex items-center gap-3 rounded-lg p-3 text-left transition-all",i?"bg-primary/10 ring-1 ring-primary/30":"bg-muted/30 hover:bg-muted/50"),children:[(0,t.jsx)("div",{className:(0,a.cn)("flex h-8 w-8 items-center justify-center rounded-lg transition-colors",i?"bg-primary text-primary-foreground":"bg-muted"),children:(0,t.jsx)(eo,{type:e.type})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-medium truncate",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:e.description})]}),i&&(0,t.jsx)(U.Check,{className:"h-4 w-4 text-primary flex-shrink-0"})]},e.id)})})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(H.default,{className:"h-4 w-4 text-purple-500"}),(0,t.jsx)("span",{className:"font-medium",children:"Dimensions"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"(Categories to group by)"})]}),(0,t.jsx)("div",{className:"space-y-1.5 max-h-[300px] overflow-y-auto pr-2",children:p.map(e=>{let i=g(e.id);return(0,t.jsxs)("button",{type:"button",onClick:()=>o(e),className:(0,a.cn)("w-full flex items-center gap-3 rounded-lg p-3 text-left transition-all",i?"bg-primary/10 ring-1 ring-primary/30":"bg-muted/30 hover:bg-muted/50"),children:[(0,t.jsx)("div",{className:(0,a.cn)("flex h-8 w-8 items-center justify-center rounded-lg transition-colors",i?"bg-primary text-primary-foreground":"bg-muted"),children:(0,t.jsx)(eo,{type:e.type})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-medium truncate",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:e.description})]}),i&&(0,t.jsx)(U.Check,{className:"h-4 w-4 text-primary flex-shrink-0"})]},e.id)})})]})]}),s.length>0&&(0,t.jsxs)("div",{className:"rounded-xl bg-muted/30 p-4",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsxs)("span",{className:"text-sm font-medium",children:[s.length," fields selected"]})}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:s.map(i=>{let s=e.fields.find(e=>e.id===i.fieldId);return(0,t.jsx)(r.Badge,{variant:"secondary",className:"gap-1.5 py-1.5",children:s?.name},i.id)})})]})]})}function ec({source:e,filters:i,onAddFilter:s,onUpdateFilter:a,onRemoveFilter:c}){return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Filter your data (optional)"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Add conditions to narrow down your results. Skip this step if you want all data."})]}),0===i.length?(0,t.jsxs)("div",{className:"rounded-xl bg-muted/30 p-8 text-center",children:[(0,t.jsx)(h.Filter,{className:"h-10 w-10 mx-auto mb-3 text-muted-foreground"}),(0,t.jsx)("p",{className:"font-medium mb-1",children:"No filters yet"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Your report will include all data. Add filters to focus on specific records."}),(0,t.jsxs)(o.Button,{variant:"outline",onClick:s,children:[(0,t.jsx)(_.Plus,{className:"mr-2 h-4 w-4"}),"Add Filter"]})]}):(0,t.jsxs)("div",{className:"space-y-3",children:[i.map((i,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-3 rounded-xl bg-muted/30 p-4",children:[s>0&&(0,t.jsx)(r.Badge,{variant:"secondary",className:"text-xs",children:"AND"}),(0,t.jsxs)(m.Select,{value:i.fieldId,onValueChange:e=>a(i.id,{fieldId:e}),children:[(0,t.jsx)(m.SelectTrigger,{className:"w-[180px]",children:(0,t.jsx)(m.SelectValue,{placeholder:"Select field"})}),(0,t.jsx)(m.SelectContent,{children:e.fields.map(e=>(0,t.jsx)(m.SelectItem,{value:e.id,children:e.name},e.id))})]}),(0,t.jsxs)(m.Select,{value:i.operator,onValueChange:e=>a(i.id,{operator:e}),children:[(0,t.jsx)(m.SelectTrigger,{className:"w-[150px]",children:(0,t.jsx)(m.SelectValue,{})}),(0,t.jsx)(m.SelectContent,{children:et.map(e=>(0,t.jsx)(m.SelectItem,{value:e.value,children:e.label},e.value))})]}),"is_null"!==i.operator&&"is_not_null"!==i.operator&&(0,t.jsx)(n.Input,{placeholder:"Value",value:i.value,onChange:e=>a(i.id,{value:e.target.value}),className:"w-[150px]"}),(0,t.jsx)(o.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 text-muted-foreground hover:text-destructive",onClick:()=>c(i.id),children:(0,t.jsx)(j.Trash2,{className:"h-4 w-4"})})]},i.id)),(0,t.jsxs)(o.Button,{variant:"outline",size:"sm",onClick:s,children:[(0,t.jsx)(_.Plus,{className:"mr-2 h-4 w-4"}),"Add Another Filter"]})]})]})}function el({chartType:e,onSelect:i}){return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"How should your data look?"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Choose a visualization that best represents your data."})]}),(0,t.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:ei.map(s=>{let o=s.icon,r=e===s.value;return(0,t.jsxs)("button",{type:"button",onClick:()=>i(s.value),className:(0,a.cn)("group relative flex flex-col items-center gap-3 rounded-xl p-6 text-center transition-all",r?"bg-primary/10 ring-2 ring-primary":"bg-muted/30 hover:bg-muted/50"),children:[r&&(0,t.jsx)("div",{className:"absolute top-3 right-3",children:(0,t.jsx)(D.CheckCircle2,{className:"h-5 w-5 text-primary"})}),(0,t.jsx)("div",{className:(0,a.cn)("flex h-14 w-14 items-center justify-center rounded-full transition-colors",r?"bg-primary text-primary-foreground":"bg-muted group-hover:bg-muted/80"),children:(0,t.jsx)(o,{className:"h-7 w-7"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold",children:s.label}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:s.description})]})]},s.value)})})]})}function ed({config:e,selectedSource:i,onUpdateConfig:s}){return(0,t.jsxs)("div",{className:"space-y-6 max-w-xl",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Name your report"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Give your report a descriptive name so you can find it later."})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"name",children:"Report Name *"}),(0,t.jsx)(n.Input,{id:"name",placeholder:"e.g., Monthly Revenue by Customer",value:e.name,onChange:e=>s({name:e.target.value}),className:"text-lg"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"description",children:"Description (optional)"}),(0,t.jsx)(l.Textarea,{id:"description",placeholder:"What does this report show?",value:e.description,onChange:e=>s({description:e.target.value}),rows:3})]})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-muted/30 p-5 space-y-3",children:[(0,t.jsxs)("h4",{className:"font-semibold flex items-center gap-2",children:[(0,t.jsx)(k.Sparkles,{className:"h-4 w-4"}),"Report Summary"]}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Data Source"}),(0,t.jsx)("span",{className:"font-medium",children:i?.name||"—"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Fields"}),(0,t.jsxs)("span",{className:"font-medium",children:[e.selectedFields.length," selected"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Filters"}),(0,t.jsx)("span",{className:"font-medium",children:e.filters.length||"None"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Visualization"}),(0,t.jsx)("span",{className:"font-medium capitalize",children:e.chartType})]})]})]})]})}function em(){let e=(0,s.useRouter)(),[r,n]=(0,i.useState)("source"),[c,l]=(0,i.useState)({name:"",description:"",primarySource:"",selectedFields:[],filters:[],chartType:"table",limit:100}),m=ee.findIndex(e=>e.id===r),p=(m+1)/ee.length*100,g=c.primarySource?Z[c.primarySource]:null,y=(0,i.useMemo)(()=>{switch(r){case"source":return!!c.primarySource;case"fields":return c.selectedFields.length>0;case"filters":default:return!0;case"visualization":return!!c.chartType;case"save":return c.name.trim().length>0}},[r,c]),h=(0,i.useCallback)(e=>{l(t=>({...t,primarySource:e,selectedFields:[],filters:[]}))},[]),b=(0,i.useCallback)(e=>{l(t=>t.selectedFields.some(t=>t.fieldId===e.id)?{...t,selectedFields:t.selectedFields.filter(t=>t.fieldId!==e.id)}:{...t,selectedFields:[...t.selectedFields,{id:`${e.id}-${Date.now()}`,sourceId:t.primarySource,fieldId:e.id,aggregation:e.aggregations?.[0]}]})},[]),f=(0,i.useCallback)(()=>{if(!g)return;let e=g.fields[0];l(t=>({...t,filters:[...t.filters,{id:`filter-${Date.now()}`,sourceId:t.primarySource,fieldId:e.id,operator:"equals",value:""}]}))},[g]),v=(0,i.useCallback)((e,t)=>{l(i=>({...i,filters:i.filters.map(i=>i.id===e?{...i,...t}:i)}))},[]),x=(0,i.useCallback)(e=>{l(t=>({...t,filters:t.filters.filter(t=>t.id!==e)}))},[]);return(0,t.jsx)(u.TooltipProvider,{delayDuration:200,children:(0,t.jsxs)("div",{className:"flex h-full flex-col",children:[(0,t.jsxs)("div",{className:"bg-background/80 backdrop-blur-xl sticky top-0 z-40 px-6 py-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,t.jsx)(X.SidebarTrigger,{className:"-ml-1"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h1",{className:"text-lg font-semibold",children:"Create Custom Report"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Step ",m+1," of ",ee.length,": ",ee[m].title]})]}),(0,t.jsx)(o.Button,{variant:"outline",size:"sm",onClick:()=>e.push("/dashboard/reporting"),children:"Cancel"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.Progress,{value:p,className:"h-1.5"}),(0,t.jsx)("div",{className:"flex justify-between",children:ee.map((e,i)=>{let s=i===m,o=i<m;return(0,t.jsxs)("button",{type:"button",onClick:()=>{i<m&&n(e.id)},disabled:i>m,className:(0,a.cn)("text-xs transition-colors",s&&"text-primary font-semibold",o&&"text-primary cursor-pointer hover:underline",!s&&!o&&"text-muted-foreground"),children:[(0,t.jsx)("span",{className:"hidden sm:inline",children:e.shortTitle}),(0,t.jsx)("span",{className:"sm:hidden",children:i+1}),o&&(0,t.jsx)(U.Check,{className:"inline h-3 w-3 ml-1"})]},e.id)})})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,t.jsxs)("div",{className:"p-6 max-w-5xl mx-auto",children:["source"===r&&(0,t.jsx)(er,{selectedSource:c.primarySource,onSelect:h}),"fields"===r&&g&&(0,t.jsx)(en,{source:g,selectedFields:c.selectedFields,onToggleField:b}),"filters"===r&&g&&(0,t.jsx)(ec,{source:g,filters:c.filters,onAddFilter:f,onUpdateFilter:v,onRemoveFilter:x}),"visualization"===r&&(0,t.jsx)(el,{chartType:c.chartType,onSelect:e=>l(t=>({...t,chartType:e}))}),"save"===r&&(0,t.jsx)(ed,{config:c,selectedSource:g,onUpdateConfig:e=>l(t=>({...t,...e}))})]})}),(0,t.jsx)("div",{className:"bg-background/80 backdrop-blur-xl sticky bottom-0 z-40 px-6 py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between max-w-5xl mx-auto",children:[(0,t.jsxs)(o.Button,{variant:"outline",onClick:()=>{let e=m-1;e>=0&&n(ee[e].id)},disabled:0===m,children:[(0,t.jsx)(C.ChevronLeft,{className:"mr-2 h-4 w-4"}),"Back"]}),(0,t.jsx)("div",{className:"flex gap-3",children:"save"===r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(o.Button,{variant:"outline",children:[(0,t.jsx)(N.Eye,{className:"mr-2 h-4 w-4"}),"Preview"]}),(0,t.jsxs)(o.Button,{onClick:()=>{e.push("/dashboard/reporting")},disabled:!y,children:[(0,t.jsx)(T.Save,{className:"mr-2 h-4 w-4"}),"Save Report"]})]}):(0,t.jsxs)(o.Button,{onClick:()=>{let e=m+1;e<ee.length&&n(ee[e].id)},disabled:!y,children:["Continue",(0,t.jsx)(w.ChevronRight,{className:"ml-2 h-4 w-4"})]})})]})})]})})}e.s(["CustomReportBuilder",()=>em],80777)}]);