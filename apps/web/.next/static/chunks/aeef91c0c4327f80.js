(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,686787,e=>{"use strict";e.i(116233),e.s([])},719768,e=>{"use strict";var a=e.i(111043),n=e.i(970799),l=e.i(818796),s=e.i(641304),t=e.i(14435);e.i(686787);var i=e.i(519539);e.i(889265);var r=e.i(677607);e.i(539870);var m=e.i(846358);e.i(51478);var o=e.i(635613);e.i(149989);var c=e.i(880177),d=e.i(830891);function p({open:e,onOpenChange:p,onCustomerCreated:u,initialEmail:h,initialPhone:x}){let[_,y]=(0,n.useState)({first_name:"",last_name:"",display_name:"",email:h||"",phone:x||"",company_name:""}),[j,f]=(0,n.useState)(!1),[g,v]=(0,n.useState)(null),[C,N]=(0,n.useState)(null),b=async()=>{if(!_.email&&!_.phone)return N(null),!1;let e=(0,d.createClient)(),{data:a,error:n}=await e.from("customers").select("id, first_name, last_name, email, phone, company_name").or(`email.eq.${_.email||""},phone.eq.${_.phone||""}`).limit(1).single();if(n&&"PGRST116"!==n.code)return console.error("Duplicate check error:",n),!1;if(a){let e=[];_.email&&a.email===_.email&&e.push("email"),_.phone&&a.phone===_.phone&&e.push("phone");let n=a.first_name&&a.last_name?`${a.first_name} ${a.last_name}`:a.first_name||a.last_name||a.company_name||"Unknown";return N(`A customer named "${n}" already exists with matching ${e.join(" and ")}.`),!0}return N(null),!1},A=(e,a)=>{y(n=>({...n,[e]:a})),v(null),("email"===e||"phone"===e)&&N(null)},D=async e=>{e.preventDefault(),v(null),f(!0);try{if(!_.first_name.trim()&&!_.last_name.trim()&&!_.company_name.trim()){v("Please provide at least a first name, last name, or company name"),f(!1);return}if(await b()&&C)return void f(!1);let e=(0,d.createClient)(),{data:{user:a}}=await e.auth.getUser();if(!a){v("You must be logged in to create a customer"),f(!1);return}let{data:n}=await e.from("profiles").select("company_id").eq("id",a.id).single();if(!n?.company_id){v("Could not determine your company. Please contact support."),f(!1);return}let{data:l,error:s}=await e.from("customers").insert({company_id:n.company_id,first_name:_.first_name.trim()||null,last_name:_.last_name.trim()||null,display_name:_.display_name.trim()||null,email:_.email.trim()||null,phone:_.phone.trim()||null,company_name:_.company_name.trim()||null}).select().single();if(s){console.error("Create customer error:",s),v(s.message||"Failed to create customer. Please try again."),f(!1);return}u({id:l.id,first_name:l.first_name,last_name:l.last_name,display_name:l.display_name,email:l.email,phone:l.phone,company_name:l.company_name}),y({first_name:"",last_name:"",display_name:"",email:"",phone:"",company_name:""}),N(null),p(!1)}catch(e){console.error("Unexpected error:",e),v("An unexpected error occurred. Please try again.")}finally{f(!1)}};return(0,a.jsx)(m.Dialog,{open:e,onOpenChange:p,children:(0,a.jsxs)(m.DialogContent,{className:"sm:max-w-[500px]",children:[(0,a.jsx)(m.DialogHeader,{children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"bg-primary/10 flex size-10 items-center justify-center rounded-full",children:(0,a.jsx)(t.User,{className:"text-primary size-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(m.DialogTitle,{children:"Create New Customer"}),(0,a.jsx)(m.DialogDescription,{children:"Add a new customer to your account"})]})]})}),(0,a.jsxs)("form",{onSubmit:D,children:[(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[g&&(0,a.jsxs)(i.Alert,{variant:"destructive",children:[(0,a.jsx)(l.AlertCircle,{className:"size-4"}),(0,a.jsx)(i.AlertDescription,{children:g})]}),C&&(0,a.jsxs)(i.Alert,{children:[(0,a.jsx)(l.AlertCircle,{className:"size-4"}),(0,a.jsx)(i.AlertDescription,{children:C})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.Label,{htmlFor:"first_name",children:"First Name"}),(0,a.jsx)(o.Input,{id:"first_name",placeholder:"John",value:_.first_name,onChange:e=>A("first_name",e.target.value),disabled:j})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.Label,{htmlFor:"last_name",children:"Last Name"}),(0,a.jsx)(o.Input,{id:"last_name",placeholder:"Smith",value:_.last_name,onChange:e=>A("last_name",e.target.value),disabled:j})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(c.Label,{htmlFor:"display_name",children:["Display Name ",(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"(optional)"})]}),(0,a.jsx)(o.Input,{id:"display_name",placeholder:"How this customer should be displayed",value:_.display_name,onChange:e=>A("display_name",e.target.value),disabled:j})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(c.Label,{htmlFor:"company_name",children:["Company Name ",(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"(optional)"})]}),(0,a.jsx)(o.Input,{id:"company_name",placeholder:"ABC Plumbing Co.",value:_.company_name,onChange:e=>A("company_name",e.target.value),disabled:j})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(c.Label,{htmlFor:"email",children:["Email ",(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"(optional)"})]}),(0,a.jsx)(o.Input,{id:"email",type:"email",placeholder:"john@example.com",value:_.email,onChange:e=>A("email",e.target.value),onBlur:b,disabled:j})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(c.Label,{htmlFor:"phone",children:["Phone ",(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"(optional)"})]}),(0,a.jsx)(o.Input,{id:"phone",type:"tel",placeholder:"(555) 123-4567",value:_.phone,onChange:e=>A("phone",e.target.value),onBlur:b,disabled:j})]}),(0,a.jsx)("p",{className:"text-muted-foreground text-xs",children:"At least one name field (first, last, or company) is required."})]}),(0,a.jsxs)(m.DialogFooter,{children:[(0,a.jsx)(r.Button,{type:"button",variant:"outline",onClick:()=>{y({first_name:"",last_name:"",display_name:"",email:h||"",phone:x||"",company_name:""}),v(null),N(null),p(!1)},disabled:j,children:"Cancel"}),(0,a.jsx)(r.Button,{type:"submit",disabled:j||!!C,children:j?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.Loader2,{className:"mr-2 size-4 animate-spin"}),"Creating..."]}):"Create Customer"})]})]})]})})}e.s(["CustomerCreateModal",()=>p])},646323,e=>{e.n(e.i(719768))}]);