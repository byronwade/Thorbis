(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,119023,e=>{"use strict";var t=e.i(111043),s=e.i(999),r=e.i(913532),n=e.i(230902),a=e.i(751139),i=e.i(327149),l=e.i(276389),o=e.i(757799),d=e.i(79254),c=e.i(87912),u=e.i(136764),m=e.i(272014),h=e.i(969098),g=e.i(952521),b=e.i(15751),x=e.i(939397),f=e.i(224262),p=e.i(371526),j=e.i(817451),v=e.i(287268),T=e.i(154115),w=e.i(121085),y=e.i(175913),N=e.i(14435),C=e.i(202724),D=e.i(501651),k=e.i(181893),M=e.i(176378),S=e.i(904653),z=e.i(970799),E=e.i(995403),I=e.i(694486),A=e.i(234461),$=e.i(988969),R=e.i(287939),J=e.i(691225),L=e.i(899117),U=e.i(607200),F=e.i(606560),P=e.i(381750);let B="unassigned-dropzone";function O(e){return!!e&&"clientX"in e&&"clientY"in e}e.i(670258);var H=e.i(921251);e.i(553153);var W=e.i(363712),X=e.i(339215);e.i(794747);var q=e.i(513990),V=e.i(826997),K=e.i(112668),Y=e.i(152088),G=e.i(365446),Q=e.i(373915),_=e.i(745372),Z=e.i(409607);let ee={emergency:{borderColor:"border-l-red-500",bgColor:"bg-red-500/10",icon:k.Zap,label:"Emergency"},repair:{borderColor:"border-l-orange-500",bgColor:"bg-orange-500/10",icon:D.Wrench,label:"Repair"},installation:{borderColor:"border-l-green-500",bgColor:"bg-green-500/10",icon:g.HardHat,label:"Installation"},maintenance:{borderColor:"border-l-blue-500",bgColor:"bg-blue-500/10",icon:w.Settings,label:"Maintenance"},premium_maintenance:{borderColor:"border-l-violet-500",bgColor:"bg-violet-500/10",icon:y.Star,label:"Premium"},inspection:{borderColor:"border-l-cyan-500",bgColor:"bg-cyan-500/10",icon:v.Search,label:"Inspection"},service:{borderColor:"border-l-sky-500",bgColor:"bg-sky-500/10",icon:m.ClipboardCheck,label:"Service"},service_call:{borderColor:"border-l-teal-500",bgColor:"bg-teal-500/10",icon:x.Phone,label:"Service Call"},estimate:{borderColor:"border-l-amber-500",bgColor:"bg-amber-500/10",icon:m.ClipboardCheck,label:"Estimate"},callback:{borderColor:"border-l-pink-500",bgColor:"bg-pink-500/10",icon:x.Phone,label:"Callback"},other:{borderColor:"border-l-slate-400",bgColor:"bg-slate-400/10",icon:m.ClipboardCheck,label:"Other"},default:{borderColor:"border-l-slate-400",bgColor:"bg-slate-400/10",icon:m.ClipboardCheck,label:"Job"}},et=e=>(e.jobType?ee[e.jobType]:ee.default)||ee.default,es=e=>{let t=et(e);return`border-l-2 ${t.borderColor}`},er={job:{icon:i.Briefcase,label:"Job",bgColor:"bg-blue-500/10",textColor:"text-blue-600 dark:text-blue-400",borderStyle:"border-solid"},meeting:{icon:C.Users,label:"Meeting",bgColor:"bg-purple-500/10",textColor:"text-purple-600 dark:text-purple-400",borderStyle:"border-dashed"},event:{icon:l.Calendar,label:"Event",bgColor:"bg-emerald-500/10",textColor:"text-emerald-600 dark:text-emerald-400",borderStyle:"border-dotted"}},en=e=>er[e.appointmentCategory||"job"],ea=(0,z.memo)(function({gap:e}){if(e.width<30)return null;let s=e=>{if(e<60)return`${e}m`;let t=Math.floor(e/60),s=e%60;return s>0?`${t}h ${s}m`:`${t}h`};return(0,t.jsx)(q.TooltipProvider,{children:(0,t.jsxs)(q.Tooltip,{delayDuration:100,children:[(0,t.jsx)(q.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("div",{className:"absolute flex items-center justify-center",style:{left:`${e.leftPosition}px`,width:`${e.width}px`,top:"50%",transform:"translateY(-50%)",height:"32px"},children:(0,t.jsxs)("div",{className:(0,Y.cn)("flex items-center gap-1 rounded-full px-2 py-1 text-[10px] font-medium shadow-sm",e.isInsufficient?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":e.isTight?"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400":"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400"),children:[(0,t.jsx)(o.Car,{className:"size-3"}),(0,t.jsx)("span",{children:s(e.gapMinutes)})]})})}),(0,t.jsx)(q.TooltipContent,{className:"max-w-64",side:"top",sideOffset:4,children:(0,t.jsxs)("div",{className:"space-y-1.5 text-xs",children:[(0,t.jsx)("div",{className:"font-semibold",children:"Travel Time Gap"}),(0,t.jsxs)("div",{className:"text-muted-foreground",children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:s(e.gapMinutes)})," ","available between jobs"]}),(0,t.jsxs)("div",{className:"text-muted-foreground",children:["Est. travel:"," ",(0,t.jsx)("span",{className:"font-medium text-foreground",children:s(e.estimatedTravelMinutes)})]}),e.isInsufficient&&(0,t.jsx)("div",{className:"text-red-600 dark:text-red-400 font-medium",children:"⚠ Insufficient travel time"}),e.isTight&&!e.isInsufficient&&(0,t.jsx)("div",{className:"text-orange-600 dark:text-orange-400 font-medium",children:"⚠ Tight schedule"}),(0,t.jsxs)("div",{className:"border-t pt-1.5 mt-1.5 text-muted-foreground",children:[(0,t.jsxs)("div",{children:["From: ",e.fromJob.customer?.name||"Unknown"," (ends"," ",(0,n.format)(e.fromJob.endTime instanceof Date?e.fromJob.endTime:new Date(e.fromJob.endTime),"h:mm a"),")"]}),(0,t.jsxs)("div",{children:["To: ",e.toJob.customer?.name||"Unknown"," (starts"," ",(0,n.format)(e.toJob.startTime instanceof Date?e.toJob.startTime:new Date(e.toJob.startTime),"h:mm a"),")"]})]})]})})]})})}),ei=(0,z.memo)(function({job:e,left:i,width:l,top:m,hasOverlap:g,isSelected:x,onSelect:p,onHover:v,onResize:w,onResizeComplete:y}){let C,D,k,S,R,J,L,U,[F,P]=(0,z.useState)(!1),[B,O]=(0,z.useState)(!1),[H,V]=(0,z.useTransition)(),{attributes:K,listeners:G,setNodeRef:Q,transform:Z,isDragging:ee}=(0,s.useDraggable)({id:e.id,data:{job:e},disabled:F}),er=(0,z.useCallback)(t=>{t.stopPropagation(),e.id&&V(async()=>{let t=await (0,$.dispatchAppointment)(e.id);t.success?E.toast.success("Job dispatched"):E.toast.error(t.error||"Failed to dispatch")})},[e.id]),ea=(0,z.useCallback)(t=>{t.stopPropagation(),e.id&&V(async()=>{let t=await (0,I.arriveAppointment)(e.id);t.success?E.toast.success("Marked as arrived"):E.toast.error(t.error||"Failed to update")})},[e.id]),ei=(0,z.useCallback)(t=>{t.stopPropagation(),e.id&&V(async()=>{let t=await (0,A.completeAppointment)(e.id);t.success?E.toast.success("Job completed"):E.toast.error(t.error||"Failed to complete")})},[e.id]),el=(()=>{if(!e.jobId||0===e.assignments.length)return null;switch(e.status){case"scheduled":return{icon:T.Send,label:"Dispatch",onClick:er,className:"bg-blue-500 hover:bg-blue-600 text-white"};case"dispatched":return{icon:o.Car,label:"Arrive",onClick:ea,className:"bg-sky-500 hover:bg-sky-600 text-white"};case"arrived":return{icon:f.Play,label:"Start",onClick:ei,className:"bg-emerald-500 hover:bg-emerald-600 text-white"};case"in-progress":return{icon:d.Check,label:"Done",onClick:ei,className:"bg-amber-500 hover:bg-amber-600 text-white"};default:return null}})(),eo={left:`${i}px`,width:`${l}px`,top:`${(m>0||g?4:11)+m}px`,height:"48px",transform:r.CSS.Translate.toString(Z),zIndex:ee?50:x?20:10-m/6},ed=e.startTime instanceof Date?e.startTime:new Date(e.startTime),ec=e.endTime instanceof Date?e.endTime:new Date(e.endTime),eu=Math.round((ec.getTime()-ed.getTime())/6e4),em=es(e),eh=(t,s)=>{t.stopPropagation(),P(!0),v(!0);let r=t.clientX,n=0,a=t=>{let a=15*Math.round(Math.round((t.clientX-r)/80*60)/15);a!==n&&(n=a,w(e.id,s,a))},i=()=>{P(!1),v(!1),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",i),y(e.id,0!==n)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",i)};return(0,t.jsx)(q.TooltipProvider,{children:(0,t.jsxs)(q.Tooltip,{delayDuration:200,open:!B&&void 0,children:[(0,t.jsx)(q.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("div",{className:(0,Y.cn)("group absolute",!ee&&"transition-[left,top,width] duration-200 ease-out"),ref:Q,style:eo,...K,...G,onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),children:[(0,t.jsx)("div",{className:"bg-primary absolute top-0 left-0 h-full w-1 cursor-ew-resize opacity-0 transition-opacity group-hover:opacity-100 hover:opacity-100",onMouseDown:e=>eh(e,"start"),style:{zIndex:60}}),(0,t.jsx)(X.ScheduleJobContextMenu,{job:e,onOpenChange:O,children:(C=en(e),(0,t.jsxs)("div",{className:(0,Y.cn)("bg-card relative flex h-full cursor-grab items-center gap-2 rounded-md border px-2.5 py-1.5 active:cursor-grabbing",!ee&&"transition-[box-shadow,ring] duration-150 ease-out hover:shadow-sm",em,C.borderStyle,e.isUnassigned&&"!border-red-500",x&&"ring-primary shadow-md ring-1",ee&&"shadow-2xl ring-2 ring-primary/50 scale-[1.02] opacity-90",("completed"===e.status||"closed"===e.status)&&"opacity-50"),onClick:p,children:[g&&(0,t.jsxs)(q.Tooltip,{children:[(0,t.jsx)(q.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("div",{className:"absolute -top-0.5 -right-0.5 size-2 rounded-full bg-red-500"})}),(0,t.jsx)(q.TooltipContent,{side:"top",className:"text-xs",children:"Overlaps with another job"})]}),e.recurrence&&(0,t.jsxs)(q.Tooltip,{children:[(0,t.jsx)(q.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(j.Repeat,{className:"absolute -top-0.5 left-0.5 size-2.5 text-violet-500"})}),(0,t.jsx)(q.TooltipContent,{side:"top",className:"text-xs",children:"Recurring job"})]}),(D=C.icon,(0,t.jsxs)(q.Tooltip,{children:[(0,t.jsx)(q.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("div",{className:(0,Y.cn)("flex size-4 shrink-0 items-center justify-center rounded-sm",C.bgColor),children:(0,t.jsx)(D,{className:(0,Y.cn)("size-2.5",C.textColor)})})}),(0,t.jsx)(q.TooltipContent,{side:"top",className:"text-xs",children:C.label})]})),(S=(k=et(e)).icon,(0,t.jsxs)(q.Tooltip,{children:[(0,t.jsx)(q.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("div",{className:(0,Y.cn)("flex size-5 shrink-0 items-center justify-center rounded",k.bgColor),children:(0,t.jsx)(S,{className:(0,Y.cn)("size-3",k.borderColor.replace("border-l-","text-"))})})}),(0,t.jsx)(q.TooltipContent,{side:"top",className:"text-xs",children:k.label})]})),(0,t.jsx)("span",{className:"text-foreground flex-1 truncate text-xs font-semibold",children:e.customer?.name||"Unknown Customer"}),(0,t.jsx)(_.TeamAvatarGroup,{assignments:e.assignments,maxVisible:3,onAddMember:()=>{},onRemove:e=>{}}),el&&(0,t.jsxs)(q.Tooltip,{children:[(0,t.jsx)(q.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("button",{type:"button",onClick:el.onClick,disabled:H,className:(0,Y.cn)("flex size-6 items-center justify-center rounded-md opacity-0 transition-opacity duration-150 group-hover:opacity-100","focus:outline-none focus:ring-2 focus:ring-offset-1",el.className,H&&"cursor-wait opacity-50"),children:H?(0,t.jsx)("div",{className:"size-3 animate-spin rounded-full border-2 border-white border-t-transparent"}):(0,t.jsx)(el.icon,{className:"size-3"})})}),(0,t.jsx)(q.TooltipContent,{side:"top",className:"text-xs",children:el.label})]}),e.jobId&&(0,t.jsxs)(q.Tooltip,{children:[(0,t.jsx)(q.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(M.default,{href:`/dashboard/work/${e.jobId}`,onClick:e=>e.stopPropagation(),className:"flex size-6 items-center justify-center rounded-md bg-slate-100 opacity-0 transition-[opacity,background-color] duration-150 hover:bg-slate-200 group-hover:opacity-100 dark:bg-slate-800 dark:hover:bg-slate-700",children:(0,t.jsx)(h.ExternalLink,{className:"size-3 text-slate-600 dark:text-slate-400"})})}),(0,t.jsx)(q.TooltipContent,{side:"top",className:"text-xs",children:"View Details"})]}),(0,t.jsx)("div",{className:(0,Y.cn)("size-1.5 shrink-0 rounded-full","scheduled"===e.status&&"bg-blue-500","dispatched"===e.status&&"bg-sky-500","arrived"===e.status&&"bg-emerald-500","in-progress"===e.status&&"bg-amber-500",("closed"===e.status||"completed"===e.status)&&"bg-slate-400","cancelled"===e.status&&"bg-slate-300")})]}))}),(0,t.jsx)("div",{className:"bg-primary absolute top-0 right-0 h-full w-1 cursor-ew-resize opacity-0 transition-opacity group-hover:opacity-100 hover:opacity-100",onMouseDown:e=>eh(e,"end"),style:{zIndex:60}})]})}),(0,t.jsx)(q.TooltipContent,{className:"w-80 overflow-hidden rounded-lg border border-border bg-popover p-0 shadow-xl [&>svg]:hidden",side:"top",sideOffset:8,children:(0,t.jsxs)("div",{className:"overflow-hidden text-popover-foreground",children:[(0,t.jsxs)("div",{className:"border-b border-border px-4 py-3",children:[(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between gap-2",children:[(0,t.jsx)("h4",{className:"text-foreground text-base font-bold",children:e.customer?.name||"Unknown Customer"}),(0,t.jsx)(W.Badge,{className:"text-[10px] capitalize",variant:"outline",children:e.status})]}),(0,t.jsx)("p",{className:"text-muted-foreground mb-2 text-sm",children:e.title}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(J=(R=en(e)).icon,(0,t.jsxs)(W.Badge,{className:(0,Y.cn)("gap-1 px-2 py-0.5 text-[10px]",R.bgColor,R.textColor),variant:"outline",children:[(0,t.jsx)(J,{className:"size-2.5"}),R.label]})),(U=(L=et(e)).icon,(0,t.jsxs)(W.Badge,{className:(0,Y.cn)("gap-1 px-2 py-0.5 text-[10px]",L.bgColor,L.borderColor.replace("border-l-","text-")),variant:"outline",children:[(0,t.jsx)(U,{className:"size-2.5"}),L.label]})),e.recurrence&&(0,t.jsxs)(W.Badge,{className:"gap-0.5 bg-violet-100 px-1.5 py-0.5 text-[10px] text-violet-700 dark:bg-violet-900/30 dark:text-violet-300",variant:"outline",children:[(0,t.jsx)(j.Repeat,{className:"size-2.5"}),"Recurring"]}),"urgent"===e.priority&&(0,t.jsxs)(W.Badge,{className:"gap-0.5 px-1.5 py-0.5 text-[10px]",variant:"destructive",children:[(0,t.jsx)(a.AlertTriangle,{className:"size-2.5"}),"Urgent"]})]})]}),(0,t.jsxs)("div",{className:"space-y-3 p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,t.jsx)(u.Clock,{className:"text-muted-foreground size-4"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"text-foreground text-sm font-medium",children:[(0,n.format)(ed,"h:mm a")," – ",(0,n.format)(ec,"h:mm a")]}),(0,t.jsxs)("p",{className:"text-muted-foreground text-xs",children:[(0,n.format)(ed,"EEE, MMM d")," • ",eu," min"]})]})]}),e.location?.address?.street&&(0,t.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,t.jsx)(b.MapPin,{className:"text-muted-foreground mt-0.5 size-4 shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"text-foreground text-sm font-medium",children:e.location.address.street}),e.location.address.city&&(0,t.jsxs)("p",{className:"text-muted-foreground text-xs",children:[e.location.address.city,","," ",e.location.address.state]})]})]}),e.customer?.phone&&(0,t.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,t.jsx)(N.User,{className:"text-muted-foreground size-4"}),(0,t.jsx)("p",{className:"text-foreground text-sm font-medium",children:e.customer.phone})]}),e.assignments.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-1.5 border-t border-border pt-2",children:e.assignments.map((e,s)=>(0,t.jsxs)("div",{className:"bg-muted flex items-center gap-1 rounded-md px-2 py-1",children:[(0,t.jsx)("div",{className:(0,Y.cn)("size-1.5 rounded-full","available"===e.status&&"bg-green-500","on-job"===e.status&&"bg-amber-500","on-break"===e.status&&"bg-slate-400")}),(0,t.jsx)("span",{className:"text-foreground text-xs font-medium",children:e.displayName})]},s))})]}),e.jobId&&(0,t.jsx)("div",{className:"border-t border-border p-3",children:(0,t.jsxs)("a",{className:"bg-primary text-primary-foreground hover:bg-primary/90 flex items-center justify-center gap-1.5 rounded-md px-3 py-2 text-sm font-medium transition-colors",href:`/dashboard/work/${e.jobId}`,onClick:e=>e.stopPropagation(),children:["View Details",(0,t.jsx)(c.ChevronRight,{className:"size-3.5"})]})})]})})]})})},(e,t)=>e.job.id===t.job.id&&e.job.status===t.job.status&&e.job.startTime===t.job.startTime&&e.job.endTime===t.job.endTime&&e.left===t.left&&e.width===t.width&&e.top===t.top&&e.hasOverlap===t.hasOverlap&&e.isSelected===t.isSelected),el=(0,z.memo)(function({technician:e,jobs:r,height:a,selectedJobId:i,onSelectJob:l,onJobHover:o,onResize:d,onResizeComplete:c,isDragActive:m,onDoubleClick:h,onDragCreate:g,totalWidth:b,timeRangeStart:x,isSelectionMode:f,selectedJobIds:j,onToggleJobSelection:v}){let{setNodeRef:T,isOver:w}=(0,s.useDroppable)({id:e.id,data:{technician:e}}),y=(0,z.useMemo)(()=>(function(e,t){if(e.length<2)return[];let s=[...e].sort((e,t)=>e.left-t.left),r=[];for(let e=0;e<s.length-1;e++){let t=s[e],n=s[e+1];if(t.left+t.width>n.left)continue;let a=t.job.endTime instanceof Date?t.job.endTime:new Date(t.job.endTime),i=Math.round(((n.job.startTime instanceof Date?n.job.startTime:new Date(n.job.startTime)).getTime()-a.getTime())/6e4);if(i<15)continue;let l=15,o=t.job.location?.coordinates,d=n.job.location?.coordinates;o?.lat&&o?.lng&&d?.lat&&d?.lng&&(l=Math.max(5,Math.ceil(function(e,t,s,r){let n=(s-e)*Math.PI/180,a=(r-t)*Math.PI/180,i=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(a/2)*Math.sin(a/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*3959}(o.lat,o.lng,d.lat,d.lng)/25*60)));let c=t.left+t.width,u=n.left-c;r.push({fromJobId:t.job.id,toJobId:n.job.id,fromJob:t.job,toJob:n.job,gapMinutes:i,estimatedTravelMinutes:l,leftPosition:c,width:u,isTight:i<1.5*l,isInsufficient:i<l})}return r})(r,0),[r]),N=(0,z.useCallback)(t=>{if(t.target.closest(".job-card"))return;let s=t.currentTarget.getBoundingClientRect(),r=t.clientX-s.left,n=b/80,a=15*Math.round(r/b*(60*n)/15),i=new Date(x);i.setMinutes(i.getMinutes()+a),h(e.id,i)},[b,x,e.id,h]),[C,D]=(0,z.useState)(!1),[k,M]=(0,z.useState)(0),[S,E]=(0,z.useState)(0),I=(0,z.useRef)(null),A=(0,z.useRef)(null),$=(0,z.useCallback)(e=>{let t=b/80,s=15*Math.round(e/b*(60*t)/15),r=new Date(x);return r.setMinutes(r.getMinutes()+s),r},[b,x]),R=(0,z.useCallback)(e=>{if(e.target.closest(".job-card")||0!==e.button)return;let t=e.currentTarget.getBoundingClientRect(),s=e.clientX-t.left;I.current=t,M(s),E(s),D(!0),e.preventDefault()},[]);(0,z.useEffect)(()=>{if(!C)return;let t=I.current;if(!t)return;let s=e=>{E(Math.max(0,Math.min(e.clientX-t.left,b)))},r=s=>{let r=Math.max(0,Math.min(s.clientX-t.left,b)),n=Math.min(k,r),a=Math.max(k,r),i=a-n;if(D(!1),M(0),E(0),I.current=null,i>20){let t=$(n),s=Math.round(($(a).getTime()-t.getTime())/6e4);s>=15&&setTimeout(()=>{g(e.id,t,s)},0)}};return document.addEventListener("mousemove",s),document.addEventListener("mouseup",r),()=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",r)}},[C,k,b,$,e.id,g]);let J=(0,z.useMemo)(()=>C?{left:Math.min(k,S),width:Math.abs(S-k)}:null,[C,k,S]),L=(0,z.useMemo)(()=>{if(!C||!J||J.width<20)return null;let e=Math.min(k,S),t=Math.max(k,S),s=$(e),r=$(t),a=Math.round((r.getTime()-s.getTime())/6e4);return{start:(0,n.format)(s,"h:mm a"),end:(0,n.format)(r,"h:mm a"),duration:a>=60?`${Math.floor(a/60)}h ${a%60}m`:`${a}m`}},[C,J,k,S,$]),U=(0,z.useCallback)(e=>{T(e),A.current=e},[T]);return(0,t.jsxs)("div",{className:(0,Y.cn)("relative border-b transition-[background-color,box-shadow] duration-150",m&&"bg-muted/20",w&&"bg-primary/10 ring-primary shadow-inner ring-2 ring-inset",C&&"cursor-crosshair select-none"),ref:U,style:{height:a,minHeight:a,maxHeight:a},onDoubleClick:N,onMouseDown:R,children:[w&&(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 z-10 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"fade-in zoom-in-95 animate-in bg-primary text-primary-foreground rounded-lg px-4 py-2 text-sm font-semibold shadow-lg duration-200",children:["Drop to assign to ",e.name]})}),C&&J&&J.width>10&&(0,t.jsx)("div",{className:"pointer-events-none absolute z-50",style:{left:J.left,width:J.width,height:48,top:11},children:(0,t.jsx)("div",{className:"relative flex h-full w-full items-center justify-center rounded-lg border-2 border-dashed border-blue-400 bg-blue-500/40 shadow-lg",children:L&&(0,t.jsxs)("div",{className:"flex items-center gap-1.5 rounded-full bg-blue-600 px-3 py-1 text-xs font-bold text-white shadow-md",children:[(0,t.jsx)(u.Clock,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:[L.start," - ",L.end]}),(0,t.jsxs)("span",{className:"text-blue-200",children:["(",L.duration,")"]})]})})}),0!==r.length||m?(0,t.jsxs)(t.Fragment,{children:[y.map(e=>(0,t.jsx)(ea,{gap:e},`travel-${e.fromJobId}-${e.toJobId}`)),r.map(({job:e,left:s,width:r,top:n,hasOverlap:a})=>(0,t.jsx)(ei,{hasOverlap:a,isSelected:f?j.has(e.id):i===e.id,job:e,left:s,onHover:o,onResize:d,onResizeComplete:c,onSelect:()=>f?v(e.id):l(e.id),top:n,width:r},e.id))]}):(0,t.jsx)("div",{className:"flex h-full items-center pl-4",children:(0,t.jsx)("div",{className:"sticky left-16 z-20",children:(0,t.jsxs)(q.Tooltip,{children:[(0,t.jsx)(q.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("div",{className:"border-muted-foreground/30 bg-muted hover:border-primary/40 hover:bg-primary/5 flex h-10 cursor-pointer items-center gap-2 rounded-md border border-dashed px-4 py-2 shadow-sm transition-colors",children:[(0,t.jsx)(p.Plus,{className:"text-muted-foreground size-3.5"}),(0,t.jsx)("span",{className:"text-muted-foreground text-xs font-semibold tracking-wide",children:"Double-click to add job"})]})}),(0,t.jsxs)(q.TooltipContent,{side:"top",className:"text-xs",children:["Double-click anywhere to schedule a job for ",e.name]})]})})})]})},(e,t)=>e.technician.id===t.technician.id&&e.height===t.height&&e.selectedJobId===t.selectedJobId&&e.isDragActive===t.isDragActive&&e.totalWidth===t.totalWidth&&e.timeRangeStart===t.timeRangeStart&&e.isSelectionMode===t.isSelectionMode&&e.selectedJobIds===t.selectedJobIds&&e.jobs===t.jobs);function eo(){let e,r,a,i,l,[o,d]=(0,z.useState)(!1),[c,m]=(0,z.useState)(null),[h,g]=(0,z.useState)(null),[b,x]=(0,z.useState)(!1),[f,p]=(0,z.useState)(null),[j,v]=(0,z.useState)(null),[T,w]=(0,z.useState)(!1),[y,N]=(0,z.useState)([]),[C,D]=(0,z.useState)(!1),[k,M]=(0,z.useState)(null),[I,X]=(0,z.useState)(null),[ee,er]=(0,z.useState)(!1),[ea,ei]=(0,z.useState)(null),[eo,ed]=(0,z.useState)(null),[ec,eu]=(0,z.useState)(!1),[em,eh]=(0,z.useState)(new Set),[eg,eb]=(0,z.useTransition)(),ex=(0,S.useRouter)(),ef=(0,z.useRef)(null),ep=(0,z.useRef)(null),{technicians:ej,getJobsForTechnician:ev,selectJob:eT,selectedJobId:ew,moveJob:ey,updateJob:eN,jobs:eC,isLoading:eD,error:ek,unassignedHasMore:eM,unassignedSearch:eS,isLoadingUnassigned:ez,unassignedTotalCount:eE,loadMoreUnassignedJobs:eI}=(0,V.useSchedule)(),eA=(0,K.useScheduleViewStore)(e=>e.currentDate),e$=(0,K.useScheduleViewStore)(e=>e.bufferStartDate),eR=(0,K.useScheduleViewStore)(e=>e.bufferEndDate),eJ=(0,K.useScheduleViewStore)(e=>e.extendBufferLeft),eL=(0,K.useScheduleViewStore)(e=>e.extendBufferRight),{isConnected:eU}=(0,V.useScheduleRealtime)(),eF=(0,z.useMemo)(()=>eC.filter(e=>e.isUnassigned),[eC]),eP=eF.length>0||eM||eS.length>0;(0,z.useEffect)(()=>{N(e=>{let t=eF.map(e=>e.id);if(0===e.length)return t;let s=e.filter(e=>t.includes(e));return t.forEach(e=>{s.includes(e)||s.push(e)}),s})},[eF]);let eB=(0,z.useMemo)(()=>{if(0===y.length)return eF;let e=new Map(eF.map(e=>[e.id,e]));return[...y.map(t=>e.get(t)).filter(e=>!!e),...eF.filter(e=>!y.includes(e.id))]},[eF,y]),eO=(0,z.useCallback)(e=>{eI({reset:!0,search:e})},[eI]),eH=(0,z.useCallback)(()=>{eI({search:eS})},[eI,eS]);(0,z.useCallback)(()=>{eu(e=>!e),ec&&eh(new Set)},[ec]);let eW=(0,z.useCallback)(e=>{eh(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]);(0,z.useCallback)(()=>{eh(new Set(eC.filter(e=>!e.isUnassigned).map(e=>e.id)))},[eC]),(0,z.useCallback)(()=>{eh(new Set)},[]),(0,z.useCallback)(()=>{eb(async()=>{let e=Array.from(em),t=0,s=0;for(let r of e)(await (0,$.dispatchAppointment)(r)).success?t++:s++;t>0&&E.toast.success(`Dispatched ${t} job${t>1?"s":""}`),s>0&&E.toast.error(`Failed to dispatch ${s} job${s>1?"s":""}`),eh(new Set),eu(!1)})},[em]),(0,z.useCallback)(()=>{eb(async()=>{let e=Array.from(em),t=0,s=0;for(let r of e)(await (0,A.completeAppointment)(r)).success?t++:s++;t>0&&E.toast.success(`Completed ${t} job${t>1?"s":""}`),s>0&&E.toast.error(`Failed to complete ${s} job${s>1?"s":""}`),eh(new Set),eu(!1)})},[em]);let eX=(0,s.useSensor)(s.MouseSensor,{activationConstraint:{distance:3}}),eq=(0,s.useSensor)(s.TouchSensor,{activationConstraint:{delay:150,tolerance:5}}),eV=(0,s.useSensors)(eX,eq);(0,z.useEffect)(()=>{!eP&&T&&w(!1)},[eP,T]);let eK=(0,z.useMemo)(()=>eA instanceof Date?eA:new Date(eA),[eA]),eY=(0,z.useMemo)(()=>e$ instanceof Date?e$:new Date(e$),[e$]),eG=(0,z.useMemo)(()=>eR instanceof Date?eR:new Date(eR),[eR]),eQ=(0,z.useMemo)(()=>{let e=new Date(eY);e.setHours(0,0,0,0);let t=e.getTime(),s=new Date(eG);s.setHours(23,59,59,999);let r=Math.ceil((s.getTime()-t)/36e5);return{startTs:t,totalHours:r,hourMs:36e5,getSlot:e=>new Date(t+36e5*e)}},[eY,eG]),e_=(0,z.useMemo)(()=>{let e=[];for(let t=0;t<eQ.totalHours;t++)e.push(eQ.getSlot(t));return e},[eQ]),eZ=(0,z.useMemo)(()=>{let e=e_[0]??new Date(eY),t=e_.at(-1),s=new Date(t||eG);return s.setHours(s.getHours(),59,59,999),{start:e,end:s}},[e_,eY,eG]),e0=80*eQ.totalHours,e1=(0,z.useMemo)(()=>{let e=new Date(eK);e.setHours(0,0,0,0);let t=new Date(eY);return t.setHours(0,0,0,0),(e.getTime()-t.getTime())/36e5*80},[eK,eY]),e5=(0,z.useMemo)(()=>{let e=new Date;if(e<eZ.start||e>eZ.end)return null;let t=(eZ.end.getTime()-eZ.start.getTime())/6e4;return(e.getTime()-eZ.start.getTime())/6e4/t*e0},[eZ,e0]),e2=(0,z.useMemo)(()=>ej.map(e=>{let t,s=(t=[],[...ev(e.id).filter(e=>{let t=e.startTime instanceof Date?e.startTime:new Date(e.startTime),s=e.endTime instanceof Date?e.endTime:new Date(e.endTime);return t<=eZ.end&&s>=eZ.start}).map(e=>{let t=e.startTime instanceof Date?e.startTime:new Date(e.startTime),s=e.endTime instanceof Date?e.endTime:new Date(e.endTime),r=(t.getTime()-eZ.start.getTime())/6e4;return{job:e,left:r/60*80,width:Math.max(60,((s.getTime()-eZ.start.getTime())/6e4-r)/60*80)}})].sort((e,t)=>e.left-t.left).forEach(({job:e,left:s,width:r})=>{let n=s+r,a=t.filter(e=>{let t=e.left+e.width;return!(n<=e.left||s>=t)});a.length>0&&a.forEach(e=>{e.hasOverlap||(e.hasOverlap=!0)});let i=0,l=new Set(a.map(e=>e.lane));for(;l.has(i);)i++;t.push({job:e,left:s,width:r,top:52*i,lane:i,hasOverlap:a.length>0})}),t),r=Math.max(70,(Math.max(0,...s.map(e=>e.lane))+1)*52+8);return{technician:e,jobs:s,height:r}}),[ej,ev,eZ]);(0,z.useMemo)(()=>e2.reduce((e,t)=>e+t.jobs.filter(e=>e.hasOverlap).length,0),[e2]),(0,z.useMemo)(()=>{let e=0,t=0,s=0,r=0;e2.forEach(({jobs:n})=>{e+=n.length;let a=n.reduce((e,{job:t})=>{let s=t.startTime instanceof Date?t.startTime:new Date(t.startTime);return e+((t.endTime instanceof Date?t.endTime:new Date(t.endTime)).getTime()-s.getTime())/6e4},0);t+=a,a>0?r++:s++});let n=e2.length>0?Math.round(t/(480*e2.length)*100):0;return{totalJobs:e,totalHours:Math.round(t/60),avgUtilization:n,availableTechs:s,busyTechs:r,totalTechs:e2.length}},[e2]);let e3=(0,z.useMemo)(()=>44+e2.reduce((e,t)=>e+t.height,0),[e2]),e4=(0,z.useRef)(null),e6=(0,z.useRef)(e2);e6.current=e2;let{handleDragStart:e9,handleDragMove:e8,handleDragEnd:e7,handleDragCancel:te,dragPointerRef:tt,rafIdRef:ts,pendingDragMoveRef:tr,dragJobCacheRef:tn,lastDragPreviewRef:ta}=function(e){let{technicians:t,unassignedJobs:s,technicianLanes:r,timeRange:a,totalWidth:i,timelineRef:l,setUnassignedOrder:o,setActiveJobId:d,setDragPreview:c}=e,u=(0,L.useScheduleStore)(e=>e.moveJob),m=(0,L.useScheduleStore)(e=>e.updateJob),h=(0,z.useRef)(null),g=(0,z.useRef)({x:0,y:0}),b=(0,z.useRef)(null),x=(0,z.useRef)(null),f=(0,z.useRef)(""),p=(0,z.useRef)(null),j=(0,z.useCallback)(e=>{let t=e.active.id;d(t),c(null);let n=s.find(e=>e.id===t);if(n&&n){let e=n.startTime instanceof Date?n.startTime:new Date(n.startTime||Date.now()),t=n.endTime instanceof Date?n.endTime:new Date(n.endTime||Date.now()+72e5);h.current={job:n,startTime:e,endTime:t,duration:t.getTime()-e.getTime(),isFromUnassigned:!0}}else{let e=r.flatMap(e=>e.jobs).find(e=>e.job.id===t);if(e){let t=e.job,s=t.startTime instanceof Date?t.startTime:new Date(t.startTime),r=t.endTime instanceof Date?t.endTime:new Date(t.endTime);h.current={job:t,startTime:s,endTime:r,duration:r.getTime()-s.getTime(),isFromUnassigned:!1}}else h.current=null}let a=e.activatorEvent;O(a)&&(g.current={x:a.clientX,y:a.clientY})},[r,s,d,c]),v=(0,z.useCallback)(()=>{let e,s,r=x.current;if(!r)return;let o=h.current;if(!o)return void c(null);let{job:d,startTime:u,duration:m,isFromUnassigned:p}=o,j=r.over?.id??d.technicianId,v=t.find(e=>e.id===j);if(p){let t=l.current?.getBoundingClientRect();if(t){let n=15*Math.round((g.current.x+r.delta.x-t.left)/i*1440/15);(e=new Date(a.start)).setMinutes(e.getMinutes()+n),s=new Date(e.getTime()+m)}else e=u,s=new Date(u.getTime()+m)}else{let t=15*Math.round(Math.round(r.delta.x/80*60)/15);s=new Date((e=new Date(u.getTime()+60*t*1e3)).getTime()+m)}let T=`${(0,n.format)(e,"h:mm a")} – ${(0,n.format)(s,"h:mm a")}`,w=v?.name??"Unassigned",y=`${T}|${w}`;y!==f.current&&(f.current=y,c({label:T,technician:w})),b.current=null},[t,a,i,l,c]),T=(0,z.useCallback)(e=>{x.current=e;let t=e.activatorEvent;O(t)&&(g.current={x:t.clientX,y:t.clientY}),null===b.current&&(b.current=requestAnimationFrame(v))},[v]),w=(0,z.useCallback)(async(e,s,r)=>{let a=t.find(e=>e.id===s),i=a?.userId||s,l=15*Math.round(Math.round(r.x/80*60)/15),o=e.startTime instanceof Date?e.startTime:new Date(e.startTime),d=e.endTime instanceof Date?e.endTime:new Date(e.endTime),c=d.getTime()-o.getTime(),h=new Date(o.getTime()+60*l*1e3),g=new Date(h.getTime()+c);p.current={jobId:e.id,previousState:{technicianId:e.technicianId,startTime:o,endTime:d,assignments:[...e.assignments],isUnassigned:e.isUnassigned}},u(e.id,s,h,g);let b=E.toast.loading(`Moving to ${a?.name} at ${(0,n.format)(h,"h:mm a")}...`),x=await (0,U.moveAppointment)(e.id,i,h,g);if(!x.success){if(p.current){let{previousState:t}=p.current;m(e.id,t)}return E.toast.error(x.error||"Failed to move appointment",{id:b}),p.current=null,!1}return E.toast.success(`Moved to ${a?.name} at ${(0,n.format)(h,"h:mm a")}`,{id:b}),p.current=null,!0},[t,u,m]),y=(0,z.useCallback)(async(e,s)=>{let r,o,d=t.find(e=>e.id===s),c=d?.userId||s,h=g.current.x,b=l.current?.getBoundingClientRect();if(b){let t=15*Math.round((h-b.left)/i*1440/15);(r=new Date(a.start)).setMinutes(r.getMinutes()+t);let s=e.endTime&&e.startTime?new Date(e.endTime).getTime()-new Date(e.startTime).getTime():72e5;o=new Date(r.getTime()+s)}else(r=new Date).setMinutes(15*Math.round(r.getMinutes()/15)),o=new Date(r.getTime()+72e5);p.current={jobId:e.id,previousState:{technicianId:e.technicianId,startTime:e.startTime,endTime:e.endTime,assignments:[...e.assignments],isUnassigned:!0}},u(e.id,s,r,o);let x=E.toast.loading(`Scheduling for ${d?.name} at ${(0,n.format)(r,"h:mm a")}...`),f=await (0,F.assignNewAppointment)(e.id,c,r,o);if(!f.success){if(p.current){let{previousState:t}=p.current;m(e.id,t)}return E.toast.error(f.error||"Failed to assign appointment",{id:x}),p.current=null,!1}return E.toast.success(`Scheduled for ${d?.name} at ${(0,n.format)(r,"h:mm a")}`,{id:x}),p.current=null,!0},[t,u,m,a,i,l]),N=(0,z.useCallback)(()=>{d(null),c(null),null!==b.current&&(cancelAnimationFrame(b.current),b.current=null),x.current=null,h.current=null,f.current=""},[d,c]);return{handleDragStart:j,handleDragMove:T,handleDragEnd:(0,z.useCallback)(async e=>{let{active:t,over:r,delta:n}=e;if(d(null),c(null),null!==b.current&&(cancelAnimationFrame(b.current),b.current=null),x.current=null,f.current="",!r){h.current=null;return}let a=t.id,i=r.id,l=h.current;if(!l||l.job.id!==a){h.current=null;return}let{job:u,isFromUnassigned:g}=l,p=i===B,j=s.some(e=>e.id===i);if(h.current=null,g&&j&&a!==i)return void o(e=>{let t=e.indexOf(a),s=e.indexOf(i);return -1===t||-1===s?e:(0,J.arrayMove)(e,t,s)});if(p){if(g)return void o(e=>{let t=e.indexOf(a);return -1===t?e:(0,J.arrayMove)(e,t,e.length-1)});m(a,{technicianId:"",assignments:[],isUnassigned:!0,startTime:u.startTime instanceof Date?u.startTime:new Date(u.startTime),endTime:u.endTime instanceof Date?u.endTime:new Date(u.endTime)});let e=E.toast.loading("Moving appointment to Unscheduled..."),t=await (0,P.unassignAppointment)(a);return void(t.success?E.toast.success("Appointment moved to Unscheduled",{id:e}):E.toast.error(t.error||"Failed to unschedule appointment",{id:e}))}g?await y(u,i):await w(u,i,n)},[s,m,o,y,w,d,c]),handleDragCancel:N,dragJobCacheRef:h,dragPointerRef:g,rafIdRef:b,pendingDragMoveRef:x,lastDragPreviewRef:f}}({technicians:ej,unassignedJobs:eF,technicianLanes:e2.map(e=>({technicianId:e.technician.id,jobs:e.jobs})),timeRange:eZ,totalWidth:e0,timelineRef:ep,setUnassignedOrder:N,setActiveJobId:p,setDragPreview:v}),ti=(0,z.useCallback)((e,t,s)=>{if(!e4.current||e4.current.jobId!==e){let t=e6.current.flatMap(e=>e.jobs).find(t=>t.job.id===e);if(!t)return;let s=t.job;e4.current={jobId:e,originalStart:s.startTime instanceof Date?s.startTime:new Date(s.startTime),originalEnd:s.endTime instanceof Date?s.endTime:new Date(s.endTime)}}let r=e4.current;if(!r)return;let{originalStart:n,originalEnd:a}=r,i=n,l=a;"start"===t?(i=new Date(n.getTime()+60*s*1e3))>=a&&(i=new Date(a.getTime()-9e5)):(l=new Date(a.getTime()+60*s*1e3))<=n&&(l=new Date(n.getTime()+9e5));let o=e6.current.find(t=>t.jobs.some(t=>t.job.id===e))?.technician.id||"";ey(e,o,i,l)},[ey]),tl=(0,z.useCallback)(async(e,t)=>{if(!e4.current||e4.current.jobId!==e)return;if(!t){e4.current=null;return}let s=e6.current.flatMap(e=>e.jobs).find(t=>t.job.id===e);if(!s){e4.current=null;return}let r=s.job,a=r.startTime instanceof Date?r.startTime:new Date(r.startTime),i=r.endTime instanceof Date?r.endTime:new Date(r.endTime),l=E.toast.loading("Saving appointment time..."),o=await (0,R.updateAppointmentTimes)(e,a,i);o.success?E.toast.success(`Updated to ${(0,n.format)(a,"h:mm a")} - ${(0,n.format)(i,"h:mm a")}`,{id:l}):E.toast.error(o.error||"Failed to update times",{id:l}),e4.current=null},[]),to=(0,z.useCallback)(async(e,t)=>{if(0===t)return;let s=e2.flatMap(e=>e.jobs).find(t=>t.job.id===e);if(!s)return;let r=s.job,a=r.technicianId,i=r.startTime instanceof Date?r.startTime:new Date(r.startTime),l=r.endTime instanceof Date?r.endTime:new Date(r.endTime),o=new Date(i.getTime()+60*t*1e3),d=new Date(l.getTime()+60*t*1e3);ey(e,a,o,d);let c=E.toast.loading(`Moving to ${(0,n.format)(o,"h:mm a")}…`),u=await (0,R.updateAppointmentTimes)(e,o,d);u.success?E.toast.success(`Updated to ${(0,n.format)(o,"h:mm a")} - ${(0,n.format)(d,"h:mm a")}`,{id:c}):E.toast.error(u.error||"Failed to update times",{id:c})},[e2,ey]),td=(0,z.useCallback)(async(e,t)=>{let s=e2.flatMap(e=>e.jobs).find(t=>t.job.id===e);if(!s)return;let r=s.job,n=ej.findIndex(e=>e.id===r.technicianId);if(-1===n)return;let a=ej[n+t];if(!a)return;let i=r.startTime instanceof Date?r.startTime:new Date(r.startTime),l=r.endTime instanceof Date?r.endTime:new Date(r.endTime);ey(e,a.id,i,l);let o=E.toast.loading(`Assigning to ${a.name}…`),d=await assignJobToTechnician(e,e,a.id);d.success?E.toast.success(`Assigned to ${a.name}`,{id:o}):E.toast.error(d.error||"Failed to assign job",{id:o})},[e2,ej,ey]);(0,z.useEffect)(()=>{if(!f)return;let e=e=>{tt.current={x:e.clientX,y:e.clientY}};return window.addEventListener("pointermove",e,{passive:!0}),()=>window.removeEventListener("pointermove",e)},[f]),(0,z.useEffect)(()=>{let e;if(!f)return;let t=ef.current;if(!t)return;let s=0,r=e=>e>=200?0:8+37*Math.pow(1-e/200,2.5),n=()=>{let a=tt.current,i=t.getBoundingClientRect(),l=0,o=a.x-i.left,d=i.right-a.x;if(o<200?l=-r(o):d<200&&(l=r(d)),0!==l){t.scrollLeft+=l;let e=Date.now();if(e-s>300){s=e;let{scrollLeft:r,scrollWidth:n,clientWidth:a}=t;r<300&&l<0?eJ():n-r-a<300&&l>0&&eL()}}let c=ep.current;if(c){let e=c.getBoundingClientRect(),t=0,s=a.y-e.top,n=e.bottom-a.y;s<200?t=-r(s):n<200&&(t=r(n)),0!==t&&(c.scrollTop+=t)}e=requestAnimationFrame(n)};return e=requestAnimationFrame(n),()=>cancelAnimationFrame(e)},[f,eJ,eL]);let tc=(0,z.useCallback)(e=>{if(!ep.current||b){m(null),g(null);return}let t=ep.current.getBoundingClientRect(),s=e.clientX-t.left;if(s<0||s>e0){m(null),g(null);return}let r=s/e0*1440,a=new Date(eZ.start);a.setMinutes(a.getMinutes()+r),m(s),g((0,n.format)(a,"h:mm a"))},[e0,eZ,b]),tu=(0,z.useCallback)(()=>{m(null),g(null)},[]),tm=(0,z.useMemo)(()=>f?e2.flatMap(e=>e.jobs).find(e=>e.job.id===f)?.job:null,[f,e2]);(0,z.useEffect)(()=>{d(!0)},[]),(0,z.useEffect)(()=>{let e=e=>{if(!ew)return;let t=e.target;t&&["INPUT","TEXTAREA","SELECT"].includes(t.tagName)||("ArrowRight"===e.key||"ArrowLeft"===e.key?(e.preventDefault(),to(ew,(e.shiftKey?60:15)*("ArrowRight"===e.key?1:-1))):("ArrowUp"===e.key||"ArrowDown"===e.key)&&(e.preventDefault(),td(ew,"ArrowUp"===e.key?-1:1)))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ew,to,td]);let th=(0,z.useRef)(!1);(0,z.useEffect)(()=>{if(ef.current){let e=ef.current;if(!th.current||null!==e5){let t=null!==e5?e5:e1+e.clientWidth/4;e.scrollLeft=Math.max(0,t-e.clientWidth/2),th.current=!0}}},[e5,e1]);let tg=(0,z.useRef)(!1),tb=(0,z.useRef)(0),tx=(0,z.useCallback)(()=>{let e=ef.current;if(!e||tg.current)return;let t=Date.now();if(t-tb.current<150)return;tb.current=t;let{scrollLeft:s,scrollWidth:r,clientWidth:n}=e;s<400?(tg.current=!0,eJ(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(ef.current){let e=ef.current.scrollWidth;ef.current.scrollLeft=s+(e-r)}tg.current=!1})})):r-s-n<400&&(tg.current=!0,eL(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{tg.current=!1})}))},[eJ,eL]);(0,z.useEffect)(()=>{let e=ef.current;if(e)return e.addEventListener("scroll",tx,{passive:!0}),()=>e.removeEventListener("scroll",tx)},[tx]),(0,z.useEffect)(()=>{let e=e=>{"k"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),M(eK),D(!0))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[eK]);let tf=(0,z.useCallback)(e=>{e.preventDefault(),M(eK),D(!0)},[eK]),tp=(0,z.useCallback)((e,t)=>{X(e),ei(t),ed(null),er(!0)},[]),tj=(0,z.useCallback)((e,t,s)=>{X(e),ei(t),ed(s),er(!0)},[]),tv=(0,z.useMemo)(()=>ej.map(e=>({id:e.id,name:e.name,avatar:e.avatar})),[ej]);return!o||eD?(0,t.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,t.jsx)("div",{className:"text-muted-foreground",children:"Loading schedule..."})}):ek?(0,t.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-destructive mb-2",children:"Error loading schedule"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:ek})]})}):(0,t.jsxs)(s.DndContext,{autoScroll:!1,collisionDetection:s.pointerWithin,onDragCancel:te,onDragEnd:e7,onDragMove:e8,onDragStart:e9,sensors:eV,children:[(0,t.jsxs)("div",{className:"bg-background m-0 flex h-full w-full overflow-hidden p-0",children:[eP&&(0,t.jsx)("div",{className:"h-full shrink-0",style:{width:T?"320px":"48px"},children:(0,t.jsx)(Z.UnassignedPanel,{activeJobId:f,dropId:B,isOpen:T,onToggle:()=>w(!T),onSearchChange:eO,onLoadMore:eH,unassignedJobs:eB,hasMore:eM,isLoadingMore:ez,totalCount:eE,searchQuery:eS})}),(0,t.jsx)("div",{className:"flex flex-1 flex-col overflow-hidden",children:(0,t.jsxs)("div",{className:"flex flex-1 overflow-auto",ref:ef,children:[(0,t.jsxs)("div",{className:"bg-card sticky left-0 z-35 flex shrink-0 flex-col border-r",style:{width:220,minHeight:e3},children:[(0,t.jsx)("div",{className:"bg-muted sticky top-0 z-40 h-11 shrink-0 border-b",children:(0,t.jsxs)("div",{className:"flex h-full items-center justify-between px-4",children:[(0,t.jsx)("span",{className:"text-muted-foreground text-xs font-semibold tracking-wide uppercase",children:"Team"}),(0,t.jsxs)(q.Tooltip,{children:[(0,t.jsx)(q.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("div",{className:(0,Y.cn)("size-2 rounded-full",eU?"bg-green-500 animate-pulse":"bg-slate-400")})}),(0,t.jsx)(q.TooltipContent,{side:"right",className:"text-xs",children:eU?"Live updates active":"Connecting to live updates..."})]})]})}),e2.map(({technician:e,jobs:s,height:r})=>{let n=e.role?.toLowerCase().includes("apprentice"),a=s.length>0,i=s.reduce((e,t)=>{let s=t.job.startTime instanceof Date?t.job.startTime:new Date(t.job.startTime);return e+((t.job.endTime instanceof Date?t.job.endTime:new Date(t.job.endTime)).getTime()-s.getTime())/6e4},0),l=Math.min(100,Math.round(i/480*100));return(0,t.jsxs)(q.Tooltip,{children:[(0,t.jsx)(q.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("div",{className:"flex cursor-pointer items-center border-b px-3 hover:bg-primary/5 active:bg-primary/10 transition-colors",style:{height:r,minHeight:r,maxHeight:r},onClick:()=>ex.push(`/dashboard/schedule/technician/${e.id}`),children:(0,t.jsxs)("div",{className:"flex w-full items-center gap-2.5",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(H.Avatar,{className:"size-9",children:(0,t.jsx)(H.AvatarFallback,{className:(0,Y.cn)("text-xs font-semibold",n?"bg-amber-100 text-amber-700":"bg-primary/10 text-primary"),children:e.name.split(" ").map(e=>e[0]).join("").toUpperCase()})}),(0,t.jsx)("div",{className:(0,Y.cn)("ring-card absolute -right-0.5 -bottom-0.5 size-3 rounded-full ring-2",a?"bg-warning":"bg-success")})]}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("p",{className:"truncate text-sm font-semibold",children:e.name}),n&&(0,t.jsx)(W.Badge,{className:"px-1 py-0 text-[9px]",variant:"outline",children:"Apprentice"})]}),(0,t.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,t.jsx)("div",{className:"h-1.5 flex-1 overflow-hidden rounded-full bg-slate-200 dark:bg-slate-700",children:(0,t.jsx)("div",{className:(0,Y.cn)("h-full rounded-full transition-[width] duration-200",0===l?"bg-slate-200 dark:bg-slate-700":l<50?"bg-emerald-500":l<80?"bg-amber-500":"bg-red-500"),style:{width:`${l}%`}})}),(0,t.jsxs)("span",{className:"text-muted-foreground text-[10px] tabular-nums",children:[s.length," job",1!==s.length?"s":""]})]})]})]})})}),(0,t.jsx)(q.TooltipContent,{side:"right",className:"overflow-hidden rounded-lg border border-border bg-popover p-0 shadow-xl [&>svg]:hidden",children:(0,t.jsxs)("div",{className:"flex flex-col gap-1 p-3 text-xs text-popover-foreground",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,t.jsx)("span",{className:"font-medium",children:e.name}),(0,t.jsx)(W.Badge,{variant:"secondary",className:(0,Y.cn)("px-1.5 py-0.5 text-[10px]",a?"bg-warning/15 text-warning":"bg-success/15 text-success"),children:a?"Busy":"Available"})]}),(0,t.jsx)("div",{className:"text-muted-foreground",children:e.role}),(0,t.jsxs)("div",{className:"mt-1 border-t border-border pt-1",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Jobs Today:"}),(0,t.jsx)("span",{className:"font-medium",children:s.length})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Time Booked:"}),(0,t.jsxs)("span",{className:"font-medium",children:[Math.round(i/60),"h"," ",Math.round(i%60),"m"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Utilization:"}),(0,t.jsxs)("span",{className:(0,Y.cn)("font-medium",l<50?"text-success":l<80?"text-warning":"text-destructive"),children:[l,"%"]})]})]})]})})]},e.id)})]}),(0,t.jsxs)("div",{className:"flex flex-1 flex-col",style:{minWidth:e0},children:[(0,t.jsx)("div",{className:"bg-card sticky top-0 z-30 flex h-11 shrink-0 border-b",children:e_.map((e,s)=>{let r=e.getHours(),a=r>=6&&r<18,i=0===r,l=e.toDateString()===eK.toDateString();return(0,t.jsxs)("div",{className:(0,Y.cn)("relative flex shrink-0 flex-col items-center justify-center border-r",a?"bg-card":"bg-muted/30",i&&"border-l-2 border-l-primary/50",l&&i&&"bg-primary/10"),style:{width:80},children:[i&&(0,t.jsx)("span",{className:(0,Y.cn)("text-[10px] font-semibold leading-tight",l?"text-primary":"text-muted-foreground"),children:(0,n.format)(e,"EEE d")}),(0,t.jsx)("span",{className:(0,Y.cn)("text-xs font-medium",a?"text-foreground":"text-muted-foreground"),children:(0,n.format)(e,"h a")})]},s)})}),(0,t.jsxs)("div",{className:"relative flex-1",onContextMenu:tf,onMouseLeave:tu,onMouseMove:tc,ref:ep,style:{minWidth:e0},children:[(0,t.jsx)("div",{className:"absolute inset-0 flex",children:e_.map((e,s)=>{let r=e.getHours(),n=r>=6&&r<18,a=e.toDateString()===eK.toDateString();return(0,t.jsx)("div",{className:(0,Y.cn)("relative shrink-0 border-r",n?s%2==0?"bg-background":"bg-muted/5":"bg-muted/20",0===r&&"border-l-2 border-l-primary/30",a&&"bg-primary/5"),style:{width:80,backgroundImage:n?void 0:"repeating-linear-gradient(45deg, transparent, transparent 8px, hsl(var(--muted) / 0.3) 8px, hsl(var(--muted) / 0.3) 16px)"},children:f&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"bg-primary/20 absolute top-0 left-1/4 h-full w-px"}),(0,t.jsx)("div",{className:"bg-primary/30 absolute top-0 left-1/2 h-full w-px"}),(0,t.jsx)("div",{className:"bg-primary/20 absolute top-0 left-3/4 h-full w-px"})]})},s)})}),null!==c&&h&&!b&&(0,t.jsx)("div",{className:"pointer-events-none absolute top-0 z-50",style:{left:c,transform:"translate(-50%, -50%)"},children:(0,t.jsx)("div",{className:"bg-foreground text-background rounded-md px-2.5 py-1 text-xs font-semibold whitespace-nowrap shadow-lg",children:h})}),null!==e5&&(0,t.jsxs)("div",{className:"absolute top-0 z-30 h-full w-0.5 bg-blue-500 shadow-lg",style:{left:e5},children:[(0,t.jsx)("div",{className:"absolute -top-1.5 -left-1.5 size-3 rounded-full bg-blue-500 ring-2 ring-blue-200"}),(0,t.jsx)("div",{className:"absolute top-0 left-1/2 z-50 -translate-x-1/2 -translate-y-1/2 rounded-md bg-blue-500 px-2.5 py-1 text-xs font-semibold whitespace-nowrap text-white shadow-lg",children:(0,n.format)(new Date,"EEE, MMM d • h:mm a")})]}),e2.map(({technician:e,jobs:s,height:r})=>(0,t.jsx)(el,{height:r,isDragActive:null!==f,jobs:s,onJobHover:x,onResize:ti,onResizeComplete:tl,onSelectJob:eT,selectedJobId:ew,technician:e,onDoubleClick:tp,onDragCreate:tj,totalWidth:e0,timeRangeStart:eZ.start,isSelectionMode:ec,selectedJobIds:em,onToggleJobSelection:eW},e.id))]})]})]})})]}),(0,t.jsx)(s.DragOverlay,{dropAnimation:{duration:200,easing:"cubic-bezier(0.18, 0.67, 0.6, 1.22)"},children:tm?(e=en(tm),a=(r=et(tm)).icon,i=e.icon,l=es(tm),(0,t.jsxs)("div",{className:"relative",children:[j&&(0,t.jsxs)("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 whitespace-nowrap rounded-md bg-primary px-2 py-1 text-xs font-medium text-primary-foreground shadow-lg",children:[(0,t.jsx)(u.Clock,{className:"mr-1 inline-block size-3"}),j.label]}),(0,t.jsxs)("div",{className:(0,Y.cn)("bg-card flex items-center gap-2 rounded-md border px-2.5 py-1.5 shadow-2xl ring-2 ring-primary scale-[1.02]",l,e.borderStyle,tm.isUnassigned&&"!border-red-500"),style:{height:"48px",minWidth:"180px",maxWidth:"300px"},children:[(0,t.jsx)("div",{className:(0,Y.cn)("flex size-4 shrink-0 items-center justify-center rounded-sm",e.bgColor),children:(0,t.jsx)(i,{className:(0,Y.cn)("size-2.5",e.textColor)})}),(0,t.jsx)("div",{className:(0,Y.cn)("flex size-5 shrink-0 items-center justify-center rounded",r.bgColor),children:(0,t.jsx)(a,{className:(0,Y.cn)("size-3",r.borderColor.replace("border-l-","text-"))})}),(0,t.jsx)("span",{className:"text-foreground flex-1 truncate text-xs font-semibold",children:tm.customer?.name||"Unknown Customer"}),(0,t.jsx)(_.TeamAvatarGroup,{assignments:tm.assignments,maxVisible:2,onAddMember:()=>{},onRemove:()=>{}}),(0,t.jsx)("div",{className:(0,Y.cn)("size-1.5 shrink-0 rounded-full","scheduled"===tm.status&&"bg-blue-500","dispatched"===tm.status&&"bg-sky-500","arrived"===tm.status&&"bg-emerald-500","in-progress"===tm.status&&"bg-amber-500",("closed"===tm.status||"completed"===tm.status)&&"bg-slate-400","cancelled"===tm.status&&"bg-slate-300")})]})]})):null}),(0,t.jsx)(G.ScheduleCommandMenu,{isOpen:C,onClose:()=>{D(!1),X(null)},selectedDate:k,selectedTechnicianId:I,selectedTechnicianName:I?ej.find(e=>e.id===I)?.name:void 0,unassignedJobs:eF}),(0,t.jsx)(Q.QuickAppointmentDialog,{open:ee,onOpenChange:e=>{er(e),e||(X(null),ei(null),ed(null))},technicians:tv,onSuccess:()=>{refresh()},defaultTechnicianId:I||void 0,defaultDateTime:ea||void 0,defaultDuration:eo||void 0})]})}e.s(["DispatchTimeline",()=>eo],119023)},915024,e=>{e.n(e.i(119023))}]);