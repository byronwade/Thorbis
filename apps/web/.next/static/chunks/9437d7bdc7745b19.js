(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,306466,e=>{"use strict";let a=(0,e.i(383206).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["default",()=>a])},598870,e=>{"use strict";var a=e.i(306466);e.s(["Save",()=>a.default])},127869,e=>{"use strict";var a=e.i(111043),s=e.i(910685),t=e.i(904653);e.i(889265);var r=e.i(677607);function l({href:e,label:l}){let i=(0,t.useRouter)();return(0,a.jsxs)(r.Button,{className:"h-8 gap-1.5",onClick:()=>i.push(e),size:"sm",variant:"outline",children:[(0,a.jsx)(s.ArrowLeft,{className:"size-4"}),l]})}e.s(["DetailBackButton",()=>l])},432716,e=>{"use strict";let a=(0,e.i(383206).default)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);e.s(["default",()=>a])},882525,e=>{"use strict";var a=e.i(432716);e.s(["Copy",()=>a.default])},616291,e=>{"use strict";let a=(0,e.i(383206).default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);e.s(["default",()=>a])},664136,e=>{"use strict";var a=e.i(616291);e.s(["Edit",()=>a.default])},213075,e=>{"use strict";let a=(0,e.i(383206).default)("receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);e.s(["default",()=>a])},868106,e=>{"use strict";var a=e.i(213075);e.s(["Receipt",()=>a.default])},415872,e=>{"use strict";let a=(0,e.i(383206).default)("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);e.s(["default",()=>a])},613240,e=>{"use strict";var a=e.i(415872);e.s(["Printer",()=>a.default])},673846,e=>{"use strict";let a=(0,e.i(383206).default)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]);e.s(["default",()=>a])},129932,e=>{"use strict";var a=e.i(673846);e.s(["TrendingDown",()=>a.default])},748887,e=>{"use strict";let a=(0,e.i(383206).default)("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);e.s(["default",()=>a])},614726,e=>{"use strict";var a=e.i(748887);e.s(["Share2",()=>a.default])},23656,e=>{"use strict";let a=(0,e.i(383206).default)("tags",[["path",{d:"M13.172 2a2 2 0 0 1 1.414.586l6.71 6.71a2.4 2.4 0 0 1 0 3.408l-4.592 4.592a2.4 2.4 0 0 1-3.408 0l-6.71-6.71A2 2 0 0 1 6 9.172V3a1 1 0 0 1 1-1z",key:"16rjxf"}],["path",{d:"M2 7v6.172a2 2 0 0 0 .586 1.414l6.71 6.71a2.4 2.4 0 0 0 3.191.193",key:"178nd4"}],["circle",{cx:"10.5",cy:"6.5",r:".5",fill:"currentColor",key:"12ikhr"}]]);e.s(["default",()=>a])},50753,e=>{"use strict";var a=e.i(552038),s=(0,a.createServerReference)("40f1e5f08b8bcdc5c42b2b4791562d08761d764af2",a.callServer,void 0,a.findSourceMapURL,"archiveJob");e.s(["archiveJob",()=>s])},710269,e=>{"use strict";var a=e.i(111043),s=e.i(935682),t=e.i(136764),r=e.i(982686),l=e.i(129932),i=e.i(697029),n=e.i(202724),o=e.i(970799);e.i(670258);var d=e.i(921251);e.i(553153);var c=e.i(363712);e.i(254851);var m=e.i(605278);e.i(287133);var u=e.i(120109);e.i(306226);var x=e.i(508420),h=e.i(818796),p=e.i(569398),j=e.i(664136),g=e.i(60179),b=e.i(598870),v=e.i(501651),f=e.i(212409);e.i(889265);var N=e.i(677607);e.i(51478);var y=e.i(635613),_=e.i(220168),C=e.i(871509);function w({jobId:e,costing:s,editable:n=!1,onSave:d}){let[x,w]=(0,o.useState)(!1),[k,S]=(0,o.useState)(!1),[T,F]=(0,o.useState)(s),M=(T.labor_hours_actual||0)*(T.labor_rate||0)*(1+(T.labor_burden_percent||30)/100),D=M+(T.materials_cost_actual||0)+(T.equipment_cost||0)+(T.subcontractor_cost||0)+(T.overhead_allocation||0),A=(T.materials_cost_actual||0)*(1+(T.materials_markup_percent||50)/100),z=T.total_revenue||A,I=z-D,B=z>0?I/z*100:0,H=T.profit_margin_target||40,L=B>=H?"success":B>=.8*H?"warning":"danger",P=async()=>{if(d){S(!0);try{let e={...T,labor_cost_total:M,materials_revenue:A,total_cost_actual:D,total_revenue:z,profit_margin_actual:B};await d(e),w(!1)}catch(e){console.error("Failed to save costing data:",e)}finally{S(!1)}}},$=(e,a)=>{F(s=>({...s,[e]:""===a?void 0:parseFloat(a)}))};return(0,a.jsxs)(m.Card,{children:[(0,a.jsx)(m.CardHeader,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.Calculator,{className:"h-5 w-5 text-primary"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(m.CardTitle,{children:"Job Costing & Profitability"}),(0,a.jsx)(m.CardDescription,{children:"Track costs, revenue, and profit margin"})]})]}),n&&!x&&(0,a.jsxs)(N.Button,{variant:"outline",size:"sm",onClick:()=>w(!0),children:[(0,a.jsx)(j.Edit,{className:"mr-2 h-4 w-4"}),"Edit Costing"]}),x&&(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(N.Button,{variant:"outline",size:"sm",onClick:()=>{F(s),w(!1)},disabled:k,children:[(0,a.jsx)(f.X,{className:"mr-2 h-4 w-4"}),"Cancel"]}),(0,a.jsxs)(N.Button,{size:"sm",onClick:P,disabled:k,children:[(0,a.jsx)(b.Save,{className:"mr-2 h-4 w-4"}),k?"Saving...":"Save"]})]})]})}),(0,a.jsxs)(m.CardContent,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,a.jsxs)("div",{className:"rounded-lg border bg-card p-4",children:[(0,a.jsxs)("div",{className:"text-muted-foreground mb-1 flex items-center gap-2 text-xs font-medium uppercase",children:[(0,a.jsx)(r.DollarSign,{className:"h-3 w-3"}),"Total Cost"]}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:(0,C.formatCurrency)(D)})]}),(0,a.jsxs)("div",{className:"rounded-lg border bg-card p-4",children:[(0,a.jsxs)("div",{className:"text-muted-foreground mb-1 flex items-center gap-2 text-xs font-medium uppercase",children:[(0,a.jsx)(r.DollarSign,{className:"h-3 w-3"}),"Total Revenue"]}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:(0,C.formatCurrency)(z)})]}),(0,a.jsxs)("div",{className:"rounded-lg border bg-card p-4",children:[(0,a.jsxs)("div",{className:"text-muted-foreground mb-1 flex items-center gap-2 text-xs font-medium uppercase",children:[(0,a.jsx)(i.TrendingUp,{className:"h-3 w-3"}),"Profit"]}),(0,a.jsx)("div",{className:`text-2xl font-bold ${I>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:(0,C.formatCurrency)(I)})]}),(0,a.jsxs)("div",{className:"rounded-lg border bg-card p-4",children:[(0,a.jsxs)("div",{className:"text-muted-foreground mb-1 flex items-center gap-2 text-xs font-medium uppercase",children:[B>=H?(0,a.jsx)(i.TrendingUp,{className:"h-3 w-3"}):(0,a.jsx)(l.TrendingDown,{className:"h-3 w-3"}),"Margin"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[B.toFixed(1),"%"]}),(0,a.jsxs)(c.Badge,{variant:"success"===L?"default":"warning"===L?"secondary":"destructive",children:["Target: ",H,"%"]})]})]})]}),(0,a.jsx)(u.Separator,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(t.Clock,{className:"h-4 w-4 text-primary"}),(0,a.jsx)("h4",{className:"font-semibold",children:"Labor Costs"})]}),(0,a.jsxs)(_.StandardFormRow,{cols:2,children:[(0,a.jsx)(_.StandardFormField,{label:"Estimated Hours",htmlFor:"labor_hours_estimated",children:(0,a.jsx)(y.Input,{id:"labor_hours_estimated",type:"number",step:"0.25",value:T.labor_hours_estimated||"",onChange:e=>$("labor_hours_estimated",e.target.value),disabled:!x,placeholder:"8.0"})}),(0,a.jsx)(_.StandardFormField,{label:"Actual Hours",htmlFor:"labor_hours_actual",children:(0,a.jsx)(y.Input,{id:"labor_hours_actual",type:"number",step:"0.25",value:T.labor_hours_actual||"",onChange:e=>$("labor_hours_actual",e.target.value),disabled:!x,placeholder:"7.5"})}),(0,a.jsx)(_.StandardFormField,{label:"Hourly Rate ($)",htmlFor:"labor_rate",children:(0,a.jsx)(y.Input,{id:"labor_rate",type:"number",step:"0.01",value:T.labor_rate||"",onChange:e=>$("labor_rate",e.target.value),disabled:!x,placeholder:"50.00"})}),(0,a.jsxs)(_.StandardFormField,{label:"Labor Burden (%)",htmlFor:"labor_burden_percent",children:[(0,a.jsx)(y.Input,{id:"labor_burden_percent",type:"number",step:"0.1",value:T.labor_burden_percent||30,onChange:e=>$("labor_burden_percent",e.target.value),disabled:!x,placeholder:"30.0"}),(0,a.jsx)("p",{className:"text-muted-foreground text-xs",children:"Benefits, taxes, insurance (default: 30%)"})]})]}),(0,a.jsxs)("div",{className:"bg-muted/50 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Total Labor Cost"}),(0,a.jsx)("span",{className:"text-lg font-bold",children:(0,C.formatCurrency)(M)})]}),(0,a.jsxs)("p",{className:"text-muted-foreground mt-1 text-xs",children:[T.labor_hours_actual||0," hours × $",T.labor_rate||0,"/hr ×"," ",(1+(T.labor_burden_percent||30)/100).toFixed(2)," ","burden"]})]})]}),(0,a.jsx)(u.Separator,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(g.Package,{className:"h-4 w-4 text-primary"}),(0,a.jsx)("h4",{className:"font-semibold",children:"Materials & Parts"})]}),(0,a.jsxs)(_.StandardFormRow,{cols:2,children:[(0,a.jsx)(_.StandardFormField,{label:"Cost ($)",htmlFor:"materials_cost_actual",children:(0,a.jsx)(y.Input,{id:"materials_cost_actual",type:"number",step:"0.01",value:T.materials_cost_actual||"",onChange:e=>$("materials_cost_actual",e.target.value),disabled:!x,placeholder:"800.00"})}),(0,a.jsxs)(_.StandardFormField,{label:"Markup (%)",htmlFor:"materials_markup_percent",children:[(0,a.jsx)(y.Input,{id:"materials_markup_percent",type:"number",step:"0.1",value:T.materials_markup_percent||50,onChange:e=>$("materials_markup_percent",e.target.value),disabled:!x,placeholder:"50.0"}),(0,a.jsx)("p",{className:"text-muted-foreground text-xs",children:"Typical markup: 40-60%"})]})]}),(0,a.jsxs)("div",{className:"bg-muted/50 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Materials Revenue"}),(0,a.jsx)("span",{className:"text-lg font-bold",children:(0,C.formatCurrency)(A)})]}),(0,a.jsxs)("p",{className:"text-muted-foreground mt-1 text-xs",children:["$",T.materials_cost_actual||0," cost ×"," ",(1+(T.materials_markup_percent||50)/100).toFixed(2)," ","markup"]})]})]}),(0,a.jsx)(u.Separator,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(v.Wrench,{className:"h-4 w-4 text-primary"}),(0,a.jsx)("h4",{className:"font-semibold",children:"Other Costs"})]}),(0,a.jsxs)(_.StandardFormRow,{cols:2,children:[(0,a.jsx)(_.StandardFormField,{label:"Equipment/Tools ($)",htmlFor:"equipment_cost",children:(0,a.jsx)(y.Input,{id:"equipment_cost",type:"number",step:"0.01",value:T.equipment_cost||"",onChange:e=>$("equipment_cost",e.target.value),disabled:!x,placeholder:"100.00"})}),(0,a.jsx)(_.StandardFormField,{label:"Subcontractors ($)",htmlFor:"subcontractor_cost",children:(0,a.jsx)(y.Input,{id:"subcontractor_cost",type:"number",step:"0.01",value:T.subcontractor_cost||"",onChange:e=>$("subcontractor_cost",e.target.value),disabled:!x,placeholder:"0.00"})}),(0,a.jsxs)(_.StandardFormField,{label:"Overhead ($)",htmlFor:"overhead_allocation",children:[(0,a.jsx)(y.Input,{id:"overhead_allocation",type:"number",step:"0.01",value:T.overhead_allocation||"",onChange:e=>$("overhead_allocation",e.target.value),disabled:!x,placeholder:"150.00"}),(0,a.jsx)("p",{className:"text-muted-foreground text-xs",children:"Allocated overhead (admin, insurance, etc.)"})]}),(0,a.jsx)(_.StandardFormField,{label:"Target Margin (%)",htmlFor:"profit_margin_target",children:(0,a.jsx)(y.Input,{id:"profit_margin_target",type:"number",step:"0.1",value:T.profit_margin_target||40,onChange:e=>$("profit_margin_target",e.target.value),disabled:!x,placeholder:"40.0"})})]})]}),B<H&&z>0&&(0,a.jsxs)("div",{className:"flex items-start gap-2 rounded-lg border border-yellow-200 bg-yellow-50 p-3 dark:border-yellow-800 dark:bg-yellow-950",children:[(0,a.jsx)(h.AlertCircle,{className:"mt-0.5 h-4 w-4 text-yellow-600 dark:text-yellow-400"}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("p",{className:"font-medium text-yellow-900 dark:text-yellow-100",children:"Below Target Margin"}),(0,a.jsxs)("p",{className:"text-muted-foreground mt-1",children:["Current margin (",B.toFixed(1),"%) is below target (",H,"%). Consider adjusting pricing or reducing costs."]})]})]})]})]})}function k({open:e,onOpenChange:h,job:p,metrics:j,timeEntries:g,teamAssignments:b,invoices:v,payments:f,jobMaterials:N,onUpdateCosting:y}){let _=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e/100),C=e=>null!=e?`${e.toFixed(1)}h`:"0.0h",k=(0,o.useMemo)(()=>{let e=50*j.totalLaborHours*100,a=j.materialsCost||0,s=e+a,t=j.totalAmount-s,r=j.totalAmount>0?t/j.totalAmount*100:0,l=j.estimatedLaborHours>0?j.totalLaborHours-j.estimatedLaborHours:0,i=j.estimatedLaborHours>0?l/j.estimatedLaborHours*100:0,n=g.filter(e=>"travel"===e.entry_type).reduce((e,a)=>e+(a.total_hours||0),0);return{laborCost:e,materialsCost:a,totalCost:s,profit:t,profitMargin:r,laborVariance:l,laborVariancePercent:i,travelHours:n,onSiteHours:g.filter(e=>"work"===e.entry_type||"labor"===e.entry_type).reduce((e,a)=>e+(a.total_hours||0),0),teamMembers:Object.values(g.reduce((e,a)=>{let s=Array.isArray(a.user)?a.user[0]:a.user,t=s?.id||"unknown",r=s?.name||"Unknown";return e[t]||(e[t]={id:t,name:r,avatar:s?.avatar,totalHours:0,entries:0}),e[t].totalHours+=a.total_hours||0,e[t].entries+=1,e},{}))}},[j,g]);return(0,a.jsx)(x.Sheet,{onOpenChange:h,open:e,children:(0,a.jsxs)(x.SheetContent,{className:"w-full overflow-y-auto px-0 sm:max-w-3xl lg:max-w-4xl",children:[(0,a.jsx)("div",{className:"px-6",children:(0,a.jsx)(x.SheetHeader,{className:"space-y-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"bg-background flex h-10 w-10 items-center justify-center rounded-lg border",children:(0,a.jsx)(s.BarChart3,{className:"text-muted-foreground h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x.SheetTitle,{className:"text-2xl",children:"Job Analytics"}),(0,a.jsxs)(x.SheetDescription,{children:["#",p.job_number||"N/A"," • ",p.title||"Untitled Job"]})]})]}),(0,a.jsx)(c.Badge,{variant:"completed"===p.status?"default":"in_progress"===p.status?"secondary":"outline",children:p.status?.replace(/_/g," ")||"Unknown"})]})})}),(0,a.jsx)(u.Separator,{className:"my-6"}),(0,a.jsxs)("div",{className:"space-y-6 px-6 pb-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(r.DollarSign,{className:"text-muted-foreground h-5 w-5"}),(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Financial Overview"})]}),(0,a.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsx)(m.Card,{children:(0,a.jsxs)(m.CardContent,{className:"p-6",children:[(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Job Value"}),(0,a.jsx)("p",{className:"mt-2 text-2xl font-bold tabular-nums",children:_(j.totalAmount)}),(0,a.jsxs)("p",{className:"text-muted-foreground mt-1 text-xs",children:[v.length," invoice",1!==v.length?"s":""]})]})}),(0,a.jsx)(m.Card,{children:(0,a.jsxs)(m.CardContent,{className:"p-6",children:[(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Paid"}),(0,a.jsx)("p",{className:"text-success dark:text-success mt-2 text-2xl font-bold tabular-nums",children:_(j.paidAmount)}),(0,a.jsxs)("p",{className:"text-muted-foreground mt-1 text-xs",children:[f.length," payment",1!==f.length?"s":""]})]})}),(0,a.jsx)(m.Card,{children:(0,a.jsxs)(m.CardContent,{className:"p-6",children:[(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Outstanding"}),(0,a.jsx)("p",{className:"text-warning dark:text-warning mt-2 text-2xl font-bold tabular-nums",children:_(j.totalAmount-j.paidAmount)}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1 text-xs",children:j.totalAmount>0?`${Math.round((j.totalAmount-j.paidAmount)/j.totalAmount*100)}% remaining`:"N/A"})]})}),(0,a.jsx)(m.Card,{children:(0,a.jsxs)(m.CardContent,{className:"p-6",children:[(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Profit"}),(0,a.jsx)("p",{className:`mt-2 text-2xl font-bold tabular-nums ${k.profit>=0?"text-success dark:text-success":"text-destructive dark:text-destructive"}`,children:_(k.profit)}),(0,a.jsxs)("div",{className:"mt-1 flex items-center gap-1",children:[k.profitMargin>=0?(0,a.jsx)(i.TrendingUp,{className:"text-success dark:text-success h-3 w-3"}):(0,a.jsx)(l.TrendingDown,{className:"text-destructive dark:text-destructive h-3 w-3"}),(0,a.jsxs)("p",{className:"text-muted-foreground text-xs",children:[k.profitMargin.toFixed(1),"% margin"]})]})]})})]})]}),(0,a.jsx)(w,{jobId:p.id,costing:{labor_hours_estimated:p.labor_hours_estimated,labor_hours_actual:p.labor_hours_actual||j.totalLaborHours,labor_rate:p.labor_rate,labor_burden_percent:p.labor_burden_percent||30,labor_cost_total:p.labor_cost_total,materials_cost_actual:p.materials_cost_actual||k.materialsCost/100,materials_markup_percent:p.materials_markup_percent||50,materials_revenue:p.materials_revenue,equipment_cost:p.equipment_cost,subcontractor_cost:p.subcontractor_cost,overhead_allocation:p.overhead_allocation,total_cost_actual:p.total_cost_actual||k.totalCost/100,total_revenue:p.total_revenue||j.totalAmount/100,profit_margin_actual:p.profit_margin_actual||k.profitMargin,profit_margin_target:p.profit_margin_target||40},editable:!0,onSave:y}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(t.Clock,{className:"text-muted-foreground h-5 w-5"}),(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Labor & Time"})]}),(0,a.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsx)(m.Card,{children:(0,a.jsxs)(m.CardContent,{className:"p-6",children:[(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Total Hours"}),(0,a.jsx)("p",{className:"mt-2 text-2xl font-bold tabular-nums",children:C(j.totalLaborHours)})]})}),(0,a.jsx)(m.Card,{children:(0,a.jsxs)(m.CardContent,{className:"p-6",children:[(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Estimated"}),(0,a.jsx)("p",{className:"mt-2 text-2xl font-bold tabular-nums",children:j.estimatedLaborHours>0?C(j.estimatedLaborHours):"N/A"})]})}),(0,a.jsx)(m.Card,{children:(0,a.jsxs)(m.CardContent,{className:"p-6",children:[(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Travel Time"}),(0,a.jsx)("p",{className:"mt-2 text-2xl font-bold tabular-nums",children:C(k.travelHours)})]})}),(0,a.jsx)(m.Card,{children:(0,a.jsxs)(m.CardContent,{className:"p-6",children:[(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"On-Site Time"}),(0,a.jsx)("p",{className:"mt-2 text-2xl font-bold tabular-nums",children:C(k.onSiteHours)})]})})]}),j.estimatedLaborHours>0&&(0,a.jsx)(m.Card,{children:(0,a.jsx)(m.CardContent,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[k.laborVariance>=0?(0,a.jsx)(i.TrendingUp,{className:"text-warning dark:text-warning h-4 w-4"}):(0,a.jsx)(l.TrendingDown,{className:"text-success dark:text-success h-4 w-4"}),(0,a.jsx)("span",{className:"font-medium",children:"Labor Variance"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("span",{className:`text-lg font-bold tabular-nums ${k.laborVariance>=0?"text-warning dark:text-warning":"text-success dark:text-success"}`,children:[k.laborVariance>=0?"+":"",C(Math.abs(k.laborVariance))]}),(0,a.jsxs)("p",{className:"text-muted-foreground mt-0.5 text-xs",children:[k.laborVariancePercent>=0?"+":"",k.laborVariancePercent.toFixed(1),"% vs estimate"]})]})]})})})]}),k.teamMembers.length>0&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n.Users,{className:"text-muted-foreground h-5 w-5"}),(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Team Breakdown"})]}),(0,a.jsx)(m.Card,{children:(0,a.jsx)(m.CardContent,{className:"p-6",children:(0,a.jsx)("div",{className:"space-y-4",children:k.teamMembers.map((e,s)=>(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)(d.Avatar,{className:"h-9 w-9",children:[(0,a.jsx)(d.AvatarImage,{alt:e.name,src:e.avatar||void 0}),(0,a.jsx)(d.AvatarFallback,{className:"text-xs",children:e.name.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:e.name}),(0,a.jsxs)("p",{className:"text-muted-foreground text-xs",children:[e.entries," ",1===e.entries?"entry":"entries"]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"font-semibold tabular-nums",children:C(e.totalHours)}),(0,a.jsxs)("p",{className:"text-muted-foreground text-xs",children:[(e.totalHours/j.totalLaborHours*100).toFixed(0),"%"]})]})]}),s!==k.teamMembers.length-1&&(0,a.jsx)(u.Separator,{className:"mt-4"})]},e.id))})})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(s.BarChart3,{className:"text-muted-foreground h-5 w-5"}),(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Performance"})]}),(0,a.jsx)(m.Card,{children:(0,a.jsxs)(m.CardContent,{className:"space-y-6 p-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Completion Progress"}),(0,a.jsxs)("span",{className:"font-bold tabular-nums",children:[j.completionPercentage,"%"]})]}),(0,a.jsx)("div",{className:"bg-secondary relative h-2 w-full overflow-hidden rounded-full",children:(0,a.jsx)("div",{className:"bg-primary h-full rounded-full transition-all",style:{width:`${j.completionPercentage}%`}})})]}),(0,a.jsx)(u.Separator,{}),(0,a.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Efficiency"}),(0,a.jsx)("p",{className:"mt-1 text-lg font-semibold",children:j.estimatedLaborHours>0?`${(j.estimatedLaborHours/j.totalLaborHours*100).toFixed(0)}%`:"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Job Status"}),(0,a.jsx)(c.Badge,{className:"mt-1",variant:"outline",children:p.status?.replace(/_/g," ")||"Unknown"})]})]})]})})]})]})]})})}e.s(["JobStatisticsSheet",()=>k],710269)},890591,e=>{"use strict";var a=e.i(111043),s=e.i(904653),t=e.i(970799),r=e.i(946672),l=e.i(935682),i=e.i(276389),n=e.i(882525),o=e.i(403468),d=e.i(882896),c=e.i(606661),m=e.i(559586),u=e.i(747146),x=e.i(848475),h=e.i(939397),p=e.i(613240),j=e.i(868106),g=e.i(614726),b=e.i(23656),b=b,v=e.i(50753);e.i(553153);var f=e.i(363712);e.i(889265);var N=e.i(677607);e.i(539870);var y=e.i(846358);e.i(244242);var _=e.i(563078);e.i(794747);var C=e.i(513990),w=e.i(51052),k=e.i(343511),S=e.i(710269),T=e.i(371526),F=e.i(540374),M=e.i(995403),D=e.i(552038),A=(0,D.createServerReference)("60f17c4aa6f5422ed664af74d27030f3031342ae78",D.callServer,void 0,D.findSourceMapURL,"updateCustomerTags"),z=(0,D.createServerReference)("60898a74b1f50c91ad212b879e4dd1f41f996ca0d1",D.callServer,void 0,D.findSourceMapURL,"updateJobTags");e.i(51478);var I=e.i(635613);e.i(149989);var B=e.i(880177);e.i(287133);var H=e.i(120109),L=e.i(212409);let P={red:"bg-red-100 text-red-700 border-red-200 dark:bg-red-900/20 dark:text-red-400 dark:border-red-900/30",orange:"bg-orange-100 text-orange-700 border-orange-200 dark:bg-orange-900/20 dark:text-orange-400 dark:border-orange-900/30",amber:"bg-amber-100 text-amber-700 border-amber-200 dark:bg-amber-900/20 dark:text-amber-400 dark:border-amber-900/30",yellow:"bg-yellow-100 text-yellow-700 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-400 dark:border-yellow-900/30",green:"bg-green-100 text-green-700 border-green-200 dark:bg-green-900/20 dark:text-green-400 dark:border-green-900/30",emerald:"bg-emerald-100 text-emerald-700 border-emerald-200 dark:bg-emerald-900/20 dark:text-emerald-400 dark:border-emerald-900/30",teal:"bg-teal-100 text-teal-700 border-teal-200 dark:bg-teal-900/20 dark:text-teal-400 dark:border-teal-900/30",blue:"bg-blue-100 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-900/30",indigo:"bg-indigo-100 text-indigo-700 border-indigo-200 dark:bg-indigo-900/20 dark:text-indigo-400 dark:border-indigo-900/30",purple:"bg-purple-100 text-purple-700 border-purple-200 dark:bg-purple-900/20 dark:text-purple-400 dark:border-purple-900/30",pink:"bg-pink-100 text-pink-700 border-pink-200 dark:bg-pink-900/20 dark:text-pink-400 dark:border-pink-900/30",gray:"bg-gray-100 text-gray-700 border-gray-200 dark:bg-gray-900/20 dark:text-gray-400 dark:border-gray-900/30"};function $({tag:e,type:s,onRemove:t,showRemove:r=!1}){let l="string"==typeof e?e:e.label,i="string"==typeof e?void 0:e.color,n=i&&P[i]?P[i]:"customer"===s?P.blue:P.purple;return(0,a.jsxs)("div",{className:`inline-flex items-center gap-1.5 rounded-full border px-3 py-1.5 text-sm font-medium transition-colors ${n}`,children:[(0,a.jsx)(F.Tag,{className:"size-3"}),(0,a.jsx)("span",{children:l}),r&&t&&(0,a.jsx)(N.Button,{className:"size-4 p-0 hover:bg-transparent",onClick:e=>{e.stopPropagation(),t()},size:"icon",variant:"ghost",children:(0,a.jsx)(L.X,{className:"size-3"})})]})}let R=["DNS - Do Not Service","Family Friend","10% Discount","VIP Customer","Payment Plan","Requires Appointment"],J=["Warranty Work","Follow-up Required","Emergency","Inspection Needed","Parts on Order","Callback Scheduled"];function U({open:e,onOpenChange:s,customerId:r,jobId:l,customerTags:i=[],jobTags:n=[],onUpdate:o}){let[d,c]=(0,t.useState)(i),[m,u]=(0,t.useState)(n),[x,h]=(0,t.useState)(""),[p,j]=(0,t.useState)(""),[g,b]=(0,t.useState)(!1),v=e=>{e&&!d.includes(e)&&c([...d,e]),h("")},f=e=>{e&&!m.includes(e)&&u([...m,e]),j("")},_=async()=>{b(!0);try{let e=[];r&&JSON.stringify(d)!==JSON.stringify(i)&&e.push(A(r,d)),l&&JSON.stringify(m)!==JSON.stringify(n)&&e.push(z(l,m));let a=await Promise.all(e);if(a.every(e=>e.success))M.toast.success("Tags updated successfully"),o?.(),s(!1);else{let e=a.find(e=>!e.success)?.error;M.toast.error(e||"Failed to update tags")}}catch(e){M.toast.error("Failed to update tags")}finally{b(!1)}};return(0,a.jsx)(y.Dialog,{onOpenChange:s,open:e,children:(0,a.jsxs)(y.DialogContent,{className:"max-h-[90vh] max-w-2xl overflow-y-auto",children:[(0,a.jsxs)(y.DialogHeader,{children:[(0,a.jsx)(y.DialogTitle,{children:"Manage Tags"}),(0,a.jsx)(y.DialogDescription,{children:"Add tags to organize and categorize this customer and job"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[r&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(F.Tag,{className:"size-4 text-blue-600"}),(0,a.jsx)("h3",{className:"text-sm font-semibold",children:"Customer Tags"}),(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Apply to all jobs for this customer)"})]}),d.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:d.map(e=>(0,a.jsx)($,{onRemove:()=>{c(d.filter(a=>a!==e))},showRemove:!0,tag:e,type:"customer"},e))}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(B.Label,{className:"text-xs",children:"Quick Add"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:R.filter(e=>!d.includes(e)).map(e=>(0,a.jsxs)(N.Button,{className:"h-7 gap-1 text-xs",onClick:()=>v(e),size:"sm",variant:"outline",children:[(0,a.jsx)(T.Plus,{className:"size-3"}),e]},e))})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(I.Input,{onChange:e=>h(e.target.value),onKeyDown:e=>{"Enter"===e.key&&v(x)},placeholder:"Add custom customer tag...",value:x}),(0,a.jsx)(N.Button,{onClick:()=>v(x),size:"sm",variant:"outline",children:(0,a.jsx)(T.Plus,{className:"size-4"})})]})]}),r&&l&&(0,a.jsx)(H.Separator,{}),l&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(F.Tag,{className:"size-4 text-purple-600"}),(0,a.jsx)("h3",{className:"text-sm font-semibold",children:"Job Tags"}),(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Apply to this job only)"})]}),m.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:m.map(e=>(0,a.jsx)($,{onRemove:()=>{u(m.filter(a=>a!==e))},showRemove:!0,tag:e,type:"job"},e))}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(B.Label,{className:"text-xs",children:"Quick Add"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:J.filter(e=>!m.includes(e)).map(e=>(0,a.jsxs)(N.Button,{className:"h-7 gap-1 text-xs",onClick:()=>f(e),size:"sm",variant:"outline",children:[(0,a.jsx)(T.Plus,{className:"size-3"}),e]},e))})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(I.Input,{onChange:e=>j(e.target.value),onKeyDown:e=>{"Enter"===e.key&&f(p)},placeholder:"Add custom job tag...",value:p}),(0,a.jsx)(N.Button,{onClick:()=>f(p),size:"sm",variant:"outline",children:(0,a.jsx)(T.Plus,{className:"size-4"})})]})]})]}),(0,a.jsxs)(y.DialogFooter,{children:[(0,a.jsx)(N.Button,{onClick:()=>s(!1),variant:"outline",children:"Cancel"}),(0,a.jsx)(N.Button,{disabled:g,onClick:_,children:g?"Saving...":"Save Changes"})]})]})})}function O({job:e,customer:T,metrics:F,timeEntries:M=[],teamAssignments:D=[],invoices:A=[],payments:z=[],jobMaterials:I=[]}){let B=(0,s.usePathname)(),H=(0,s.useRouter)(),{toast:L}=(0,w.useToast)(),P=(0,k.useDialerStore)(e=>e.openDialer),$=B?.split("/").pop(),[R,J]=(0,t.useState)(!1),[O,V]=(0,t.useState)(!1),[E,q]=(0,t.useState)(!1),[K,W]=(0,t.useState)(!1),Q=T?.tags||[],X=e?.metadata?.tags||e?.custom_fields?.tags||[],Z=Q.length+X.length,G=async()=>{if(!$)return void L.error("Job ID not found");V(!0);try{let e=await (0,v.archiveJob)($);e.success?(L.success("Job archived successfully"),J(!1),H.push("/dashboard/work")):L.error(e.error||"Failed to archive job")}catch(e){L.error("Failed to archive job")}finally{V(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsxs)(C.TooltipProvider,{children:[(0,a.jsxs)(C.Tooltip,{children:[(0,a.jsx)(C.TooltipTrigger,{asChild:!0,children:(0,a.jsx)(N.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,a.jsxs)("a",{href:`/dashboard/work/appointments/new?jobId=${$}`,children:[(0,a.jsx)(i.Calendar,{}),(0,a.jsx)("span",{className:"hidden md:inline",children:"Schedule"})]})})}),(0,a.jsx)(C.TooltipContent,{children:(0,a.jsx)("p",{children:"Schedule appointment"})})]}),(0,a.jsxs)(_.DropdownMenu,{children:[(0,a.jsx)(_.DropdownMenuTrigger,{asChild:!0,children:(0,a.jsxs)(N.Button,{size:"sm",variant:"outline",children:[(0,a.jsx)(h.Phone,{}),(0,a.jsx)("span",{className:"hidden md:inline",children:"Contact"})]})}),(0,a.jsxs)(_.DropdownMenuContent,{align:"start",children:[(0,a.jsx)(_.DropdownMenuLabel,{children:"Contact Customer"}),(0,a.jsx)(_.DropdownMenuSeparator,{}),(0,a.jsxs)(_.DropdownMenuItem,{disabled:!T?.phone,onClick:()=>{if(T?.phone)P(T.phone,T.id,T?.display_name||`${T?.first_name||""} ${T?.last_name||""}`.trim());else L.error("No phone number available")},children:[(0,a.jsx)(h.Phone,{className:"mr-2 size-3.5"}),T?.phone?`Call ${T.phone}`:"No phone number"]}),(0,a.jsxs)(_.DropdownMenuItem,{disabled:!T?.phone,onClick:()=>{T?.phone?H.push(`/dashboard/communication/messages?phone=${T.phone}&customerId=${T.id}`):L.error("No phone number available")},children:[(0,a.jsx)(u.MessageSquare,{className:"mr-2 size-3.5"}),T?.phone?"Send text message":"No phone number"]}),(0,a.jsxs)(_.DropdownMenuItem,{disabled:!T?.email,onClick:()=>{T?.email?H.push(`/dashboard/communication?email=${T.email}&customerId=${T.id}`):L.error("No email address available")},children:[(0,a.jsx)(m.Mail,{className:"mr-2 size-3.5"}),T?.email?`Email ${T.email}`:"No email address"]})]})]}),(0,a.jsxs)(C.Tooltip,{children:[(0,a.jsx)(C.TooltipTrigger,{asChild:!0,children:(0,a.jsx)(N.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,a.jsxs)("a",{href:`/dashboard/work/payments/new?jobId=${$}`,children:[(0,a.jsx)(o.CreditCard,{}),(0,a.jsx)("span",{className:"hidden md:inline",children:"Payment"})]})})}),(0,a.jsx)(C.TooltipContent,{children:(0,a.jsx)("p",{children:"Collect payment"})})]}),(0,a.jsxs)(C.Tooltip,{children:[(0,a.jsx)(C.TooltipTrigger,{asChild:!0,children:(0,a.jsx)(N.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,a.jsxs)("a",{href:`/dashboard/work/invoices/new?jobId=${$}`,children:[(0,a.jsx)(j.Receipt,{}),(0,a.jsx)("span",{className:"hidden md:inline",children:"Invoice"})]})})}),(0,a.jsx)(C.TooltipContent,{children:(0,a.jsx)("p",{children:"Create invoice"})})]}),(0,a.jsxs)(C.Tooltip,{children:[(0,a.jsx)(C.TooltipTrigger,{asChild:!0,children:(0,a.jsx)(N.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,a.jsxs)("a",{href:`/dashboard/work/estimates/new?jobId=${$}`,children:[(0,a.jsx)(c.FileText,{}),(0,a.jsx)("span",{className:"hidden md:inline",children:"Estimate"})]})})}),(0,a.jsx)(C.TooltipContent,{children:(0,a.jsx)("p",{children:"Create estimate"})})]})]}),(0,a.jsxs)(_.DropdownMenu,{children:[(0,a.jsx)(_.DropdownMenuTrigger,{asChild:!0,children:(0,a.jsxs)(N.Button,{size:"sm",variant:"outline",children:[(0,a.jsx)(x.MoreVertical,{}),(0,a.jsx)("span",{className:"hidden md:inline",children:"Actions"})]})}),(0,a.jsxs)(_.DropdownMenuContent,{align:"end",className:"w-56",children:[e&&F&&(0,a.jsxs)(_.DropdownMenuItem,{onClick:()=>q(!0),children:[(0,a.jsx)(l.BarChart3,{className:"mr-2 size-3.5"}),"View Statistics"]}),(0,a.jsxs)(_.DropdownMenuItem,{onClick:()=>W(!0),children:[(0,a.jsx)(b.default,{className:"mr-2 size-3.5"}),"Manage Tags",Z>0&&(0,a.jsx)(f.Badge,{className:"ml-auto h-5 px-1.5",variant:"secondary",children:Z})]}),(0,a.jsx)(_.DropdownMenuSeparator,{}),(0,a.jsxs)(_.DropdownMenuItem,{onClick:()=>H.push(`/dashboard/work/new?cloneFrom=${$}`),children:[(0,a.jsx)(n.Copy,{className:"mr-2 size-3.5"}),"Clone Job"]}),(0,a.jsxs)(_.DropdownMenuItem,{onClick:()=>{let a=new Blob([[["Field","Value"],["Job Number",e?.job_number||""],["Title",e?.title||""],["Status",e?.status||""],["Customer",T?.display_name||""],["Phone",T?.phone||""],["Email",T?.email||""],["Created",e?.created_at?new Date(e.created_at).toLocaleDateString():""],["Total Revenue",F?.totalRevenue?`$${F.totalRevenue.toFixed(2)}`:"$0.00"]].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n")],{type:"text/csv"}),s=window.URL.createObjectURL(a),t=document.createElement("a");t.href=s,t.download=`job-${e?.job_number||$}.csv`,t.click(),window.URL.revokeObjectURL(s),L.success("Job exported to CSV")},children:[(0,a.jsx)(d.Download,{className:"mr-2 size-3.5"}),"Export to CSV"]}),(0,a.jsxs)(_.DropdownMenuItem,{onClick:()=>{window.print(),L.success("Opening print dialog...")},children:[(0,a.jsx)(p.Printer,{className:"mr-2 size-3.5"}),"Print Details"]}),(0,a.jsxs)(_.DropdownMenuItem,{onClick:()=>{navigator.clipboard.writeText(window.location.href),L.success("Job link copied to clipboard")},children:[(0,a.jsx)(g.Share2,{className:"mr-2 size-3.5"}),"Share Link"]}),(0,a.jsx)(_.DropdownMenuSeparator,{}),(0,a.jsxs)(_.DropdownMenuItem,{className:"text-destructive",onClick:()=>J(!0),children:[(0,a.jsx)(r.Archive,{className:"mr-2 size-3.5"}),"Archive Job"]})]})]})]}),(0,a.jsx)(y.Dialog,{onOpenChange:J,open:R,children:(0,a.jsxs)(y.DialogContent,{children:[(0,a.jsxs)(y.DialogHeader,{children:[(0,a.jsx)(y.DialogTitle,{children:"Archive Job"}),(0,a.jsx)(y.DialogDescription,{children:"Are you sure you want to archive this job? Archived jobs can be restored within 90 days. Completed or invoiced jobs cannot be archived."})]}),(0,a.jsxs)(y.DialogFooter,{children:[(0,a.jsx)(N.Button,{disabled:O,onClick:()=>J(!1),variant:"outline",children:"Cancel"}),(0,a.jsx)(N.Button,{disabled:O,onClick:G,variant:"destructive",children:O?"Archiving...":"Archive Job"})]})]})}),e&&F&&(0,a.jsx)(S.JobStatisticsSheet,{invoices:A,job:e,jobMaterials:I,metrics:F,onOpenChange:q,open:E,payments:z,teamAssignments:D,timeEntries:M}),(0,a.jsx)(U,{customerId:T?.id,customerTags:Q,jobId:e?.id,jobTags:X,onOpenChange:W,onUpdate:()=>{},open:K})]})}function V(){let e=(0,s.useParams)(),r=e?.id,[l,i]=(0,t.useState)(null);return(0,t.useEffect)(()=>{async function e(){try{let e=await fetch(`/api/jobs/${r}/toolbar-data`);if(e.ok){let a=await e.json();i(a)}}catch(e){}}r&&e()},[r]),(0,a.jsx)(O,{customer:l?.customer,invoices:l?.invoices||[],job:l?.job,jobMaterials:l?.jobMaterials||[],metrics:l?.metrics,payments:l?.payments||[],teamAssignments:l?.teamAssignments||[],timeEntries:l?.timeEntries||[]})}e.s(["JobDetailToolbarWrapper",()=>V],890591)}]);