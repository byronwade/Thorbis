(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,801316,e=>{"use strict";e.i(313550);var t=e.i(111043),s=e.i(702948),r=e.i(970799),a=e.i(939397),n=e.i(14100),l=e.i(212409);e.i(889265);var o=e.i(677607);e.i(254851);var i=e.i(605278);e.i(794747);var c=e.i(513990),d=e.i(152088);function u({callId:e,customerName:s,customerPhone:u,duration:m,isActive:x,onFocusPopOut:g,onReturnToMain:h,position:p="bottom-right"}){let b,[f,v]=(0,r.useState)(m),[j,N]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(!x)return;let e=setInterval(()=>{v(e=>e+1)},1e3);return()=>clearInterval(e)},[x]),(0,r.useEffect)(()=>{if(!j)return;let e=()=>N(!1);return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[j]),(0,t.jsxs)("div",{className:(0,d.cn)("fixed z-50 transition-all duration-200",{"bottom-right":"bottom-6 right-6","bottom-left":"bottom-6 left-6","top-right":"top-24 right-6","top-left":"top-24 left-6"}[p]),onContextMenu:e=>{e.preventDefault(),N(!0)},children:[(0,t.jsx)(c.TooltipProvider,{children:(0,t.jsxs)(c.Tooltip,{children:[(0,t.jsx)(c.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(i.Card,{className:(0,d.cn)("group relative cursor-pointer overflow-hidden","border-primary/30 from-primary/10 to-primary/5 rounded-2xl border-2 bg-gradient-to-br","shadow-primary/20 shadow-lg backdrop-blur-sm","hover:border-primary/50 hover:shadow-primary/30 transition-all duration-300 hover:scale-105 hover:shadow-xl","animate-pulse-slow"),onClick:g,children:[(0,t.jsx)("div",{className:"bg-primary/20 absolute inset-0 animate-ping rounded-2xl opacity-75"}),(0,t.jsxs)("div",{className:"relative flex items-center gap-3 p-4",children:[(0,t.jsx)("div",{className:"bg-primary text-primary-foreground flex h-12 w-12 items-center justify-center rounded-full shadow-md",children:(0,t.jsx)(a.Phone,{className:"h-6 w-6 animate-pulse"})}),(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"text-foreground text-sm font-semibold",children:s}),(0,t.jsx)("div",{className:"text-muted-foreground text-xs",children:u}),(0,t.jsx)("div",{className:"text-primary font-mono text-xs font-bold",children:(b=Math.floor(f/60),`${b.toString().padStart(2,"0")}:${(f%60).toString().padStart(2,"0")}`)})]}),(0,t.jsx)(o.Button,{className:"ml-2 h-8 w-8 opacity-0 transition-opacity group-hover:opacity-100",onClick:e=>{e.stopPropagation(),h()},size:"icon",variant:"ghost",children:(0,t.jsx)(l.X,{className:"h-4 w-4"})})]})]})}),(0,t.jsx)(c.TooltipContent,{className:"max-w-xs",side:"left",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"font-semibold",children:"Active Call (Pop-out Window)"}),(0,t.jsx)("p",{className:"text-muted-foreground text-xs",children:"Click to bring window to front"}),(0,t.jsx)("p",{className:"text-muted-foreground text-xs",children:"Right-click or click X to return to main window"})]})})]})}),j&&(0,t.jsx)("div",{className:"border-border bg-background absolute right-0 bottom-full mb-2 rounded-lg border p-2 shadow-lg",children:(0,t.jsxs)(o.Button,{className:"w-full justify-start gap-2 text-sm",onClick:e=>{e.stopPropagation(),h(),N(!1)},size:"sm",variant:"ghost",children:[(0,t.jsx)(n.PhoneOff,{className:"h-4 w-4"}),"Return to Main Window"]})})]})}e.i(553153);var m=e.i(363712),x=e.i(237294);let g=e=>({name:"Unknown Customer",email:"",phone:e||"Unknown",company:"",accountStatus:"Unknown",lastContact:"Never",totalCalls:0,openTickets:0,priority:"medium",tags:[],recentIssues:[],aiData:{isKnownCustomer:!1,isSpam:!1,spamConfidence:0,recognitionSource:"unknown",trustScore:.5,callHistory:[],similarCallers:0,riskLevel:"medium",aiNotes:["First-time caller","No prior history","Standard verification recommended"]}});var h=e.i(173030),p=e.i(241736);e.i(670258);var b=e.i(921251);e.i(526120);var f=e.i(610120);e.i(418488);var v=e.i(539900),j=e.i(7107);let N="thorbis-call-sync-fallback",w=[600,800,1e3,1200];var C=e.i(468849),y=e.i(948962),k=e.i(334992);let S=(0,s.default)(()=>e.A(146481).then(e=>e.AlertCircle),{loadableGenerated:{modules:[77157]}}),A=(0,s.default)(()=>e.A(146481).then(e=>e.AlertTriangle),{loadableGenerated:{modules:[77157]}}),E=(0,s.default)(()=>e.A(146481).then(e=>e.ArrowRightLeft),{loadableGenerated:{modules:[77157]}}),T=(0,s.default)(()=>e.A(146481).then(e=>e.Brain),{loadableGenerated:{modules:[77157]}}),z=(0,s.default)(()=>e.A(146481).then(e=>e.Building2),{loadableGenerated:{modules:[77157]}}),R=(0,s.default)(()=>e.A(146481).then(e=>e.CheckCircle2),{loadableGenerated:{modules:[77157]}}),P=(0,s.default)(()=>e.A(146481).then(e=>e.ChevronDown),{loadableGenerated:{modules:[77157]}}),L=(0,s.default)(()=>e.A(146481).then(e=>e.ChevronUp),{loadableGenerated:{modules:[77157]}}),I=(0,s.default)(()=>e.A(146481).then(e=>e.Clock),{loadableGenerated:{modules:[77157]}}),M=(0,s.default)(()=>e.A(146481).then(e=>e.FileText),{loadableGenerated:{modules:[77157]}}),D=(0,s.default)(()=>e.A(146481).then(e=>e.Hash),{loadableGenerated:{modules:[77157]}}),O=(0,s.default)(()=>e.A(146481).then(e=>e.HelpCircle),{loadableGenerated:{modules:[77157]}}),_=(0,s.default)(()=>e.A(146481).then(e=>e.Maximize2),{loadableGenerated:{modules:[77157]}}),U=(0,s.default)(()=>e.A(146481).then(e=>e.Mic),{loadableGenerated:{modules:[77157]}}),W=(0,s.default)(()=>e.A(146481).then(e=>e.MicOff),{loadableGenerated:{modules:[77157]}}),H=(0,s.default)(()=>e.A(146481).then(e=>e.Minimize2),{loadableGenerated:{modules:[77157]}}),G=(0,s.default)(()=>e.A(146481).then(e=>e.Pause),{loadableGenerated:{modules:[77157]}}),V=(0,s.default)(()=>e.A(146481).then(e=>e.Phone),{loadableGenerated:{modules:[77157]}}),F=(0,s.default)(()=>e.A(146481).then(e=>e.PhoneOff),{loadableGenerated:{modules:[77157]}}),B=(0,s.default)(()=>e.A(146481).then(e=>e.Play),{loadableGenerated:{modules:[77157]}}),Y=(0,s.default)(()=>e.A(146481).then(e=>e.Settings),{loadableGenerated:{modules:[77157]}}),X=(0,s.default)(()=>e.A(146481).then(e=>e.Shield),{loadableGenerated:{modules:[77157]}}),$=(0,s.default)(()=>e.A(146481).then(e=>e.Square),{loadableGenerated:{modules:[77157]}}),K=(0,s.default)(()=>e.A(146481).then(e=>e.SquareStack),{loadableGenerated:{modules:[77157]}}),q=(0,s.default)(()=>e.A(146481).then(e=>e.Tag),{loadableGenerated:{modules:[77157]}}),Z=(0,s.default)(()=>e.A(146481).then(e=>e.User),{loadableGenerated:{modules:[77157]}}),J=(0,s.default)(()=>e.A(146481).then(e=>e.Video),{loadableGenerated:{modules:[77157]}}),Q=(0,s.default)(()=>e.A(146481).then(e=>e.VideoOff),{loadableGenerated:{modules:[77157]}}),ee=(0,s.default)(()=>e.A(146481).then(e=>e.Voicemail),{loadableGenerated:{modules:[77157]}}),et=(0,s.default)(()=>e.A(323616).then(e=>({default:e.TransferCallModal})),{loadableGenerated:{modules:[586437]},loading:()=>null}),es=(0,s.default)(()=>e.A(420165).then(e=>({default:e.AIAutofillPreview})),{loadableGenerated:{modules:[600539]},loading:()=>null}),er=(0,s.default)(()=>e.A(416432).then(e=>({default:e.TranscriptPanel})),{loadableGenerated:{modules:[594306]},loading:()=>null}),ea=(0,s.default)(()=>e.A(309695).then(e=>({default:e.VideoConferenceView})),{loadableGenerated:{modules:[88298]},loading:()=>null}),en=(0,r.memo)(function({caller:e,customerData:s,onAnswer:a,onDecline:n,onVoicemail:l}){var c;let{aiData:u}=s,x=(0,r.useMemo)(()=>u.isSpam?(0,t.jsxs)("div",{className:"border-destructive/50 bg-destructive/5 dark:bg-destructive/10 mb-4 flex items-center gap-2.5 rounded-lg border p-3 backdrop-blur-sm",children:[(0,t.jsx)(A,{className:"text-destructive size-4 shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"text-destructive text-xs leading-tight font-semibold",children:"Potential Spam Detected"}),(0,t.jsxs)("p",{className:"text-destructive/70 dark:text-destructive/90 mt-0.5 text-[11px]",children:[Math.round(u.spamConfidence),"% confidence •"," ",u.similarCallers," similar reports"]})]})]}):u.isKnownCustomer?(0,t.jsxs)("div",{className:"border-success/50 bg-success/5 dark:bg-success/10 mb-4 flex items-center gap-2.5 rounded-lg border p-3 backdrop-blur-sm",children:[(0,t.jsx)(R,{className:"text-success size-4 shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"text-success text-xs leading-tight font-semibold",children:"Verified Customer"}),(0,t.jsxs)("p",{className:"text-success/70 dark:text-success/90 mt-0.5 text-[11px]",children:["Trust score: ",u.trustScore,"% •"," ",u.recognitionSource.toUpperCase()]})]})]}):(0,t.jsxs)("div",{className:"border-warning/50 bg-warning/5 dark:bg-warning/10 mb-4 flex items-center gap-2.5 rounded-lg border p-3 backdrop-blur-sm",children:[(0,t.jsx)(O,{className:"text-warning size-4 shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"text-warning text-xs leading-tight font-semibold",children:"Unknown Caller"}),(0,t.jsx)("p",{className:"text-warning/70 dark:text-warning/90 mt-0.5 text-[11px]",children:"First-time caller • Verification recommended"})]})]}),[u.isSpam,u.isKnownCustomer,u.spamConfidence,u.similarCallers,u.trustScore,u.recognitionSource]),g=(0,r.useMemo)(()=>e.name?.split(" ").map(e=>e[0]).join("").toUpperCase()||"?",[e.name]),h=(0,r.useMemo)(()=>s.tags.map(e=>(0,t.jsx)(m.Badge,{className:"px-2 py-0.5 text-[10px]",variant:"default",children:e},e)),[s.tags]),p=(0,r.useCallback)(()=>{a()},[a]),f=(0,r.useCallback)(()=>{n()},[n]),v=(0,r.useCallback)(()=>{l()},[l]);return(0,t.jsx)("div",{className:"fade-in slide-in-from-bottom-4 animate-in fixed right-6 bottom-6 z-50 w-[420px] duration-300 ease-out",children:(0,t.jsxs)(i.Card,{className:"bg-card/95 dark:bg-card/95 border-2 shadow-2xl backdrop-blur-xl dark:shadow-2xl",children:[(0,t.jsxs)(i.CardHeader,{className:"space-y-0 pb-4",children:[x,(0,t.jsxs)("div",{className:"flex items-start gap-4 pt-2",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)(b.Avatar,{className:"ring-primary/20 dark:ring-primary/30 size-20 shadow-lg ring-2",children:[(0,t.jsx)(b.AvatarImage,{src:e.avatar}),(0,t.jsx)(b.AvatarFallback,{className:"border-primary/20 from-primary/20 to-primary/10 text-foreground border-2 bg-gradient-to-br text-lg font-semibold",children:g})]}),u.isKnownCustomer&&(0,t.jsx)("div",{className:"border-card bg-success absolute -right-1 -bottom-1 rounded-full border-2 p-1",children:(0,t.jsx)(X,{className:"text-success-foreground size-3"})})]}),(0,t.jsxs)("div",{className:"min-w-0 flex-1 pt-1",children:[(0,t.jsx)("div",{className:"mb-1 flex items-center gap-2",children:(0,t.jsx)("h3",{className:"text-foreground truncate text-lg leading-tight font-bold",children:e.name||"Unknown Caller"})}),(0,t.jsx)("p",{className:"text-muted-foreground mb-2 font-mono text-sm",children:e.number}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"bg-success shadow-success/50 size-2 animate-pulse rounded-full shadow-sm"}),(0,t.jsx)("p",{className:"text-muted-foreground text-xs font-medium",children:"Incoming call..."})]})]})]})]}),(0,t.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,t.jsxs)(i.Card,{className:"bg-muted/30 dark:bg-muted/20 border-2 p-4",children:[(0,t.jsxs)("div",{className:"mb-3 flex flex-wrap items-center gap-2",children:[h,(0,t.jsx)(m.Badge,{className:(0,d.cn)("px-2 py-0.5 text-[10px]","high"===(c=s.priority)?"bg-destructive text-destructive-foreground":"medium"===c?"bg-warning text-warning-foreground dark:text-warning-foreground":"bg-success text-success-foreground dark:text-success-foreground"),variant:"high"===s.priority?"destructive":"medium"===s.priority?"outline":"secondary",children:s.priority.toUpperCase()})]}),(0,t.jsxs)("div",{className:"space-y-2.5 text-xs",children:[(0,t.jsxs)("div",{className:"text-muted-foreground flex items-center gap-2.5",children:[(0,t.jsx)(z,{className:"size-4 shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:s.company||"No company"})]}),(0,t.jsxs)("div",{className:"text-muted-foreground flex items-center gap-2.5",children:[(0,t.jsx)(I,{className:"size-4 shrink-0"}),(0,t.jsxs)("span",{children:["Last contact: ",s.lastContact]})]}),(0,t.jsxs)("div",{className:"text-muted-foreground flex items-center gap-2.5",children:[(0,t.jsx)(M,{className:"size-4 shrink-0"}),(0,t.jsxs)("span",{children:[s.openTickets," open tickets"]})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3 pt-2",children:[(0,t.jsxs)(o.Button,{className:"h-14 flex-col gap-1.5 rounded-xl font-semibold shadow-lg transition-all hover:scale-105 hover:shadow-xl active:scale-95",onClick:f,size:"lg",variant:"destructive",children:[(0,t.jsx)(F,{className:"size-5"}),(0,t.jsx)("span",{className:"text-xs",children:"Decline"})]}),(0,t.jsxs)(o.Button,{className:"h-14 flex-col gap-1.5 rounded-xl border-2 font-semibold shadow-lg transition-all hover:scale-105 hover:shadow-xl active:scale-95",onClick:v,size:"lg",variant:"outline",children:[(0,t.jsx)(ee,{className:"size-5"}),(0,t.jsx)("span",{className:"text-xs",children:"Voicemail"})]}),(0,t.jsxs)(o.Button,{className:"bg-success text-success-foreground hover:bg-success/90 h-14 flex-col gap-1.5 rounded-xl font-semibold shadow-lg transition-all hover:scale-105 hover:shadow-xl active:scale-95",onClick:p,size:"lg",children:[(0,t.jsx)(V,{className:"size-5"}),(0,t.jsx)("span",{className:"text-xs",children:"Answer"})]})]})]})]})})}),el=(0,r.memo)(function({caller:e,callDuration:s,call:a,onMaximize:n,onEndCall:l,toggleMute:o,toggleHold:i,sendDTMF:c}){let[u,m]=(0,r.useState)(!1),[x,g]=(0,r.useState)(!1),[h,p]=(0,r.useState)(()=>({x:window.innerWidth-350,y:window.innerHeight-150})),[f,v]=(0,r.useState)(!1),j=(0,r.useRef)({x:0,y:0}),N=(0,r.useCallback)(e=>{p({x:e.clientX-j.current.x,y:e.clientY-j.current.y})},[]),w=(0,r.useCallback)(()=>{v(!1)},[]);return(0,r.useEffect)(()=>{if(f)return window.addEventListener("mousemove",N),window.addEventListener("mouseup",w),()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",w)}},[f,N,w]),(0,t.jsx)("div",{className:(0,d.cn)("fade-in slide-in-from-bottom-2 animate-in fixed z-50 duration-300",f&&"cursor-grabbing"),style:{left:`${h.x}px`,top:`${h.y}px`,width:u?"340px":"320px"},children:(0,t.jsxs)("div",{className:"border-border bg-card rounded-xl border shadow-2xl dark:shadow-lg",children:[(0,t.jsx)("div",{className:"border-border bg-muted/50 dark:bg-muted/30 cursor-grab rounded-t-xl border-b px-4 py-3 active:cursor-grabbing",onMouseDown:e=>{v(!0),j.current={x:e.clientX-h.x,y:e.clientY-h.y}},children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)(b.Avatar,{className:"ring-border dark:ring-border/50 size-10 ring-2",children:[(0,t.jsx)(b.AvatarImage,{src:e.avatar}),(0,t.jsx)(b.AvatarFallback,{className:"bg-muted text-muted-foreground text-xs",children:e.name?.split(" ").map(e=>e[0]).join("").toUpperCase()||"?"})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,t.jsx)("p",{className:"text-foreground truncate text-sm font-medium",children:e.name||"Unknown"}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"bg-success size-1.5 animate-pulse rounded-full"}),(0,t.jsx)("p",{className:"text-muted-foreground font-mono text-[11px]",children:s}),a.isRecording&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"•"}),(0,t.jsx)($,{className:"text-destructive size-2 fill-red-500"})]})]})]}),(0,t.jsx)("button",{className:"bg-background hover:bg-accent flex size-7 items-center justify-center rounded-lg transition-colors active:scale-95",onClick:()=>m(!u),title:u?"Collapse":"Expand",type:"button",children:u?(0,t.jsx)(L,{className:"text-muted-foreground size-3.5"}):(0,t.jsx)(P,{className:"text-muted-foreground size-3.5"})})]})}),(0,t.jsx)("div",{className:"p-3",children:(0,t.jsxs)("div",{className:"grid grid-cols-5 gap-1.5",children:[(0,t.jsxs)("button",{className:(0,d.cn)("flex flex-col items-center gap-1 rounded-lg p-2 transition-colors active:scale-95",a.isMuted?"bg-destructive text-destructive-foreground hover:bg-destructive/90":"bg-background text-muted-foreground hover:bg-accent"),onClick:o,title:a.isMuted?"Unmute":"Mute",type:"button",children:[a.isMuted?(0,t.jsx)(W,{className:"size-4"}):(0,t.jsx)(U,{className:"size-4"}),(0,t.jsx)("span",{className:"text-[9px]",children:a.isMuted?"Unmute":"Mute"})]}),i&&(0,t.jsxs)("button",{className:(0,d.cn)("flex flex-col items-center gap-1 rounded-lg p-2 transition-colors active:scale-95",a.isOnHold?"bg-warning text-warning-foreground hover:bg-warning/90 dark:text-warning-foreground":"bg-background text-muted-foreground hover:bg-accent"),onClick:i,title:a.isOnHold?"Resume":"Hold",type:"button",children:[a.isOnHold?(0,t.jsx)(B,{className:"size-4"}):(0,t.jsx)(G,{className:"size-4"}),(0,t.jsx)("span",{className:"text-[9px]",children:a.isOnHold?"Resume":"Hold"})]}),c&&(0,t.jsxs)("button",{className:(0,d.cn)("flex flex-col items-center gap-1 rounded-lg p-2 transition-colors active:scale-95",x?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-background text-muted-foreground hover:bg-accent"),onClick:()=>g(!x),title:"Keypad",type:"button",children:[(0,t.jsx)(D,{className:"size-4"}),(0,t.jsx)("span",{className:"text-[9px]",children:"Keypad"})]}),(0,t.jsxs)("button",{className:"bg-background text-muted-foreground hover:bg-accent flex flex-col items-center gap-1 rounded-lg p-2 transition-colors active:scale-95",onClick:n,title:"Open Dashboard",type:"button",children:[(0,t.jsx)(_,{className:"size-4"}),(0,t.jsx)("span",{className:"text-[9px]",children:"Open"})]}),(0,t.jsxs)("button",{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 flex flex-col items-center gap-1 rounded-lg p-2 transition-colors active:scale-95",onClick:l,title:"End Call",type:"button",children:[(0,t.jsx)(F,{className:"size-4"}),(0,t.jsx)("span",{className:"text-[9px]",children:"End"})]})]})}),u&&(0,t.jsx)("div",{className:"border-border border-t p-3",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Caller Number"}),(0,t.jsx)("span",{className:"text-muted-foreground font-mono",children:e.number})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Status"}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"bg-success size-1.5 rounded-full"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:a.isOnHold?"On Hold":"Active"})]})]})]})}),x&&c&&(0,t.jsxs)("div",{className:"border-border border-t p-3",children:[(0,t.jsx)("div",{className:"mb-2 text-center",children:(0,t.jsx)("p",{className:"text-muted-foreground text-xs",children:"Dial Tones"})}),(0,t.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[["1","2","3"],["4","5","6"],["7","8","9"],["*","0","#"]].flat().map(e=>(0,t.jsx)("button",{className:"border-border bg-background text-foreground hover:bg-accent flex size-12 items-center justify-center rounded-lg border font-mono text-lg transition-colors active:scale-95",onClick:()=>c(e),type:"button",children:e},e))})]})]})})}),eo=(0,r.memo)(function({id:e,title:s,icon:r,children:a,isCollapsed:n,onToggleCollapse:l,badge:o}){return(0,t.jsxs)("div",{className:"border-border bg-card/50 dark:bg-card/80 overflow-hidden rounded-xl border shadow-sm backdrop-blur-sm",children:[(0,t.jsxs)("button",{className:"bg-muted/50 hover:bg-muted/70 dark:bg-muted/30 dark:hover:bg-muted/50 flex w-full items-center justify-between px-5 py-3.5 text-left transition-colors active:scale-[0.98]",onClick:l,type:"button",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2.5",children:[r,(0,t.jsx)("span",{className:"text-foreground text-sm font-semibold",children:s}),o]}),n?(0,t.jsx)(P,{className:"text-muted-foreground size-4"}):(0,t.jsx)(L,{className:"text-muted-foreground size-4"})]}),!n&&(0,t.jsx)("div",{className:"border-border bg-card/30 dark:bg-card/50 border-t p-5",children:a})]})}),ei=(0,r.memo)(function({call:e,caller:s,callDuration:r,customerData:a,callNotes:n,setCallNotes:l,disposition:o,setDisposition:i,onEndCall:c,onMinimize:u,onRequestVideo:m,onEndVideo:x,onTransfer:g,toggleMute:h,toggleHold:p,toggleRecording:v,position:N,height:w,width:C,isDragging:y,isResizing:k,handleMouseDown:A,handleTouchStart:z,isPopOutZone:R,resizeHandles:P}){let L=(0,j.useCallPreferencesStore)(e=>e.cards),I=(0,j.useCallPreferencesStore)(e=>e.toggleCard),D=(0,j.useCallPreferencesStore)(e=>e.layoutMode),O=L.filter(e=>e.isVisible).sort((e,t)=>e.order-t.order);return(0,t.jsxs)("div",{className:(0,d.cn)("fade-in slide-in-from-bottom-2 animate-in fixed z-50 duration-300",y&&"cursor-grabbing",R&&"scale-95 opacity-50"),"data-draggable-container":!0,style:{width:`${C}px`,height:`${w}px`,left:`${N.x}px`,top:`${N.y}px`},children:[R&&(0,t.jsx)("div",{className:"border-primary bg-primary/10 absolute inset-0 z-50 flex items-center justify-center rounded-2xl border-2 border-dashed backdrop-blur-sm",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(K,{className:"text-primary mx-auto mb-2 h-12 w-12"}),(0,t.jsx)("p",{className:"text-primary font-semibold",children:"Release to Pop Out"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"Opens call in separate window"})]})}),(0,t.jsx)("div",{className:(0,d.cn)("hover:bg-primary/20 absolute -top-1 right-0 left-0 h-2 cursor-ns-resize",k&&"bg-primary/30"),...P.handleNorth}),(0,t.jsx)("div",{className:(0,d.cn)("hover:bg-primary/20 absolute top-0 -right-1 bottom-0 w-2 cursor-ew-resize",k&&"bg-primary/30"),...P.handleEast}),(0,t.jsx)("div",{className:(0,d.cn)("hover:bg-primary/20 absolute right-0 -bottom-1 left-0 h-2 cursor-ns-resize",k&&"bg-primary/30"),...P.handleSouth}),(0,t.jsx)("div",{className:(0,d.cn)("hover:bg-primary/20 absolute top-0 bottom-0 -left-1 w-2 cursor-ew-resize",k&&"bg-primary/30"),...P.handleWest}),(0,t.jsx)("div",{className:(0,d.cn)("hover:bg-primary/30 absolute -top-1 -left-1 h-4 w-4 cursor-nwse-resize rounded-tl-2xl",k&&"bg-primary/40"),...P.handleNorthWest}),(0,t.jsx)("div",{className:(0,d.cn)("hover:bg-primary/30 absolute -top-1 -right-1 h-4 w-4 cursor-nesw-resize rounded-tr-2xl",k&&"bg-primary/40"),...P.handleNorthEast}),(0,t.jsx)("div",{className:(0,d.cn)("hover:bg-primary/30 absolute -right-1 -bottom-1 h-4 w-4 cursor-nwse-resize rounded-br-2xl",k&&"bg-primary/40"),...P.handleSouthEast}),(0,t.jsx)("div",{className:(0,d.cn)("hover:bg-primary/30 absolute -bottom-1 -left-1 h-4 w-4 cursor-nesw-resize rounded-bl-2xl",k&&"bg-primary/40"),...P.handleSouthWest}),(0,t.jsxs)("div",{className:"border-border bg-card flex h-full flex-col rounded-2xl border shadow-2xl dark:shadow-lg",children:[(0,t.jsxs)("div",{className:"border-border bg-muted/50 dark:bg-muted/30 cursor-grab border-b p-6 active:cursor-grabbing","data-drag-handle":!0,onMouseDown:A,onTouchStart:z,children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)(b.Avatar,{className:"ring-border dark:ring-border/50 size-14 ring-2",children:[(0,t.jsx)(b.AvatarImage,{src:s.avatar}),(0,t.jsx)(b.AvatarFallback,{className:"bg-muted text-muted-foreground",children:s.name?.split(" ").map(e=>e[0]).join("").toUpperCase()||"?"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"text-foreground text-base font-semibold",children:s.name||"Unknown"}),"high"===a.priority&&(0,t.jsx)(S,{className:"text-destructive size-4"})]}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:s.number}),(0,t.jsxs)("div",{className:"mt-1.5 flex items-center gap-2",children:[(0,t.jsx)("div",{className:"bg-success size-2 animate-pulse rounded-full"}),(0,t.jsx)("p",{className:"text-muted-foreground font-mono text-xs",children:r}),e.isRecording&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"•"}),(0,t.jsx)($,{className:"text-destructive size-2.5 fill-red-500"}),(0,t.jsx)("span",{className:"text-destructive text-xs",children:"REC"})]})]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{className:"bg-background hover:bg-accent flex size-9 items-center justify-center rounded-lg transition-colors active:scale-95",onClick:u,title:"Minimize",type:"button",children:(0,t.jsx)(H,{className:"text-muted-foreground size-4"})}),(0,t.jsx)("button",{className:"bg-background hover:bg-accent flex size-9 items-center justify-center rounded-lg transition-colors active:scale-95",title:"Settings",type:"button",children:(0,t.jsx)(Y,{className:"text-muted-foreground size-4"})})]})]}),(0,t.jsxs)("div",{className:"mt-5 grid grid-cols-6 gap-2.5",children:[(0,t.jsxs)("button",{className:(0,d.cn)("flex flex-col items-center gap-1.5 rounded-lg p-3 transition-colors active:scale-95",e.isMuted?"bg-destructive text-destructive-foreground hover:bg-destructive/90":"bg-background text-muted-foreground hover:bg-accent"),onClick:h,type:"button",children:[e.isMuted?(0,t.jsx)(W,{className:"size-5"}):(0,t.jsx)(U,{className:"size-5"}),(0,t.jsx)("span",{className:"text-[10px]",children:e.isMuted?"Unmute":"Mute"})]}),(0,t.jsxs)("button",{className:(0,d.cn)("flex flex-col items-center gap-1.5 rounded-lg p-3 transition-colors active:scale-95",e.isOnHold?"bg-warning text-warning-foreground hover:bg-warning/90 dark:text-warning-foreground":"bg-background text-muted-foreground hover:bg-accent"),onClick:p,type:"button",children:[e.isOnHold?(0,t.jsx)(B,{className:"size-5"}):(0,t.jsx)(G,{className:"size-5"}),(0,t.jsx)("span",{className:"text-[10px]",children:e.isOnHold?"Resume":"Hold"})]}),(0,t.jsxs)("button",{className:(0,d.cn)("flex flex-col items-center gap-1.5 rounded-lg p-3 transition-colors active:scale-95",e.isRecording?"bg-destructive text-destructive-foreground hover:bg-destructive/90":"bg-background text-muted-foreground hover:bg-accent"),onClick:v,type:"button",children:[(0,t.jsx)($,{className:"size-5"}),(0,t.jsx)("span",{className:"text-[10px]",children:e.isRecording?"Stop":"Record"})]}),(0,t.jsxs)("button",{className:"bg-background text-muted-foreground hover:bg-accent flex flex-col items-center gap-1.5 rounded-lg p-3 transition-colors active:scale-95",onClick:g,title:"Transfer Call",type:"button",children:[(0,t.jsx)(E,{className:"size-5"}),(0,t.jsx)("span",{className:"text-[10px]",children:"Transfer"})]}),(0,t.jsxs)("button",{className:(0,d.cn)("flex flex-col items-center gap-1.5 rounded-lg p-3 transition-colors active:scale-95","connected"===e.videoStatus?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-background text-muted-foreground hover:bg-accent"),onClick:()=>{"off"===e.videoStatus?m():"connected"===e.videoStatus&&x()},type:"button",children:["connected"===e.videoStatus?(0,t.jsx)(J,{className:"size-5"}):(0,t.jsx)(Q,{className:"size-5"}),(0,t.jsx)("span",{className:"text-[10px]",children:"Video"})]}),(0,t.jsxs)("button",{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 flex flex-col items-center gap-1.5 rounded-lg p-3 transition-colors active:scale-95",onClick:c,type:"button",children:[(0,t.jsx)(F,{className:"size-5"}),(0,t.jsx)("span",{className:"text-[10px]",children:"End"})]})]})]}),(0,t.jsx)("div",{className:(0,d.cn)("flex-1 overflow-y-auto","compact"===D?"p-4":"comfortable"===D?"p-5":"p-6","compact"===D?"gap-3":"comfortable"===D?"gap-4":"gap-5"),children:(0,t.jsx)("div",{className:(0,d.cn)("grid gap-4",C>=1200?"grid-cols-2":"grid-cols-1"),children:O.map(e=>{var s,r,c;switch(e.id){case"transcript":return(0,t.jsx)(eo,{icon:(0,t.jsx)(M,{className:"text-primary size-4"}),id:e.id,isCollapsed:e.isCollapsed,onToggleCollapse:()=>I(e.id),title:"Live Transcript",children:(0,t.jsx)("div",{className:"h-96",children:(0,t.jsx)(er,{})})},e.id);case"ai-autofill":return(0,t.jsx)(eo,{badge:(0,t.jsx)("span",{className:"bg-accent text-accent-foreground rounded-full px-2 py-0.5 text-[9px]",children:"AI"}),icon:(0,t.jsx)(T,{className:"text-accent-foreground size-4"}),id:e.id,isCollapsed:e.isCollapsed,onToggleCollapse:()=>I(e.id),title:"AI Auto-fill",children:(0,t.jsx)("div",{className:"h-96",children:(0,t.jsx)(es,{})})},e.id);case"customer-info":return(0,t.jsx)(eo,{icon:(0,t.jsx)(Z,{className:"text-success size-4"}),id:e.id,isCollapsed:e.isCollapsed,onToggleCollapse:()=>I(e.id),title:"Customer Information",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-muted-foreground mb-1.5 block text-xs font-medium",children:"Email"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:a.email})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-muted-foreground mb-1.5 block text-xs font-medium",children:"Company"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:a.company})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-muted-foreground mb-1.5 block text-xs font-medium",children:"Status"}),(0,t.jsx)("p",{className:"text-success text-sm",children:a.accountStatus})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-muted-foreground mb-1.5 block text-xs font-medium",children:"Priority"}),(0,t.jsx)("p",{className:(0,d.cn)("text-sm","high"===(s=a.priority)?"text-destructive":"medium"===s?"text-warning":"text-success"),children:a.priority.charAt(0).toUpperCase()+a.priority.slice(1)})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-muted-foreground mb-1.5 block text-xs font-medium",children:"Tags"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:a.tags.map(e=>(0,t.jsx)("span",{className:"bg-primary text-primary-foreground rounded-full px-3 py-1 text-xs",children:e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-muted-foreground mb-1.5 block text-xs font-medium",children:"Recent Issues"}),(0,t.jsx)("div",{className:"space-y-1.5",children:a.recentIssues.map(e=>(0,t.jsxs)("p",{className:"text-muted-foreground text-sm",children:["• ",e.text]},e.id))})]})]})},e.id);case"ai-analysis":return(0,t.jsx)(eo,{badge:a.aiData.isKnownCustomer?(0,t.jsx)("span",{className:"bg-success text-success-foreground dark:text-success-foreground rounded px-2 py-0.5 text-[9px]",children:"VERIFIED"}):a.aiData.isSpam?(0,t.jsx)("span",{className:"bg-destructive text-destructive-foreground rounded px-2 py-0.5 text-[9px]",children:"SPAM"}):null,icon:(0,t.jsx)(T,{className:"text-warning size-4"}),id:e.id,isCollapsed:e.isCollapsed,onToggleCollapse:()=>I(e.id),title:"AI Analysis",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground text-xs font-medium",children:"Trust Score"}),(0,t.jsxs)("span",{className:"text-foreground font-mono text-sm font-semibold",children:[a.aiData.trustScore,"%"]})]}),(0,t.jsx)("div",{className:"bg-muted h-2 overflow-hidden rounded-full",children:(0,t.jsx)("div",{className:(0,d.cn)("h-full transition-all",(r=a.aiData.trustScore)>=80?"bg-success":r>=50?"bg-warning":"bg-destructive"),style:{width:`${a.aiData.trustScore}%`}})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground text-xs font-medium",children:"Risk Level"}),(0,t.jsx)("span",{className:(0,d.cn)("rounded px-3 py-1 text-xs font-semibold","high"===(c=a.aiData.riskLevel)?"bg-destructive text-destructive":"medium"===c?"bg-warning text-warning":"bg-success text-success"),children:a.aiData.riskLevel.toUpperCase()})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-muted-foreground mb-2 block text-xs font-medium",children:"AI Insights"}),(0,t.jsx)("div",{className:"space-y-2",children:a.aiData.aiNotes.map((e,s)=>(0,t.jsxs)("div",{className:"border-border bg-muted/50 dark:bg-muted/30 flex items-start gap-2.5 rounded-lg border p-3",children:[(0,t.jsx)("div",{className:"bg-success mt-1 size-2 shrink-0 rounded-full"}),(0,t.jsx)("p",{className:"text-muted-foreground flex-1 text-sm leading-relaxed",children:e})]},s))})]})]})},e.id);case"notes":return(0,t.jsx)(eo,{icon:(0,t.jsx)(M,{className:"text-muted-foreground size-4"}),id:e.id,isCollapsed:e.isCollapsed,onToggleCollapse:()=>I(e.id),title:"Call Notes",children:(0,t.jsx)(f.Textarea,{className:"border-border bg-background text-foreground placeholder:text-muted-foreground min-h-32 text-sm",onChange:e=>l(e.target.value),placeholder:"Enter call notes and customer concerns...",value:n})},e.id);case"disposition":return(0,t.jsx)(eo,{icon:(0,t.jsx)(q,{className:"text-muted-foreground size-4"}),id:e.id,isCollapsed:e.isCollapsed,onToggleCollapse:()=>I(e.id),title:"Call Disposition",children:(0,t.jsx)("div",{className:"grid grid-cols-2 gap-3",children:[{value:"resolved",label:"Resolved",color:"green"},{value:"escalated",label:"Escalated",color:"red"},{value:"callback",label:"Callback",color:"amber"},{value:"voicemail",label:"Voicemail",color:"blue"}].map(e=>(0,t.jsx)("button",{className:(0,d.cn)("rounded-lg border px-4 py-3 text-sm font-medium transition-colors active:scale-95",o===e.value?"green"===e.color?"border-success bg-success text-success-foreground dark:text-success-foreground":"red"===e.color?"border-destructive bg-destructive text-destructive-foreground":"amber"===e.color?"border-warning bg-warning text-warning-foreground dark:text-warning-foreground":"border-primary bg-primary text-primary-foreground":"border-border bg-background text-muted-foreground hover:bg-accent"),onClick:()=>i(e.value),type:"button",children:e.label},e.value))})},e.id);case"quick-actions":return(0,t.jsx)(eo,{icon:(0,t.jsx)(K,{className:"text-muted-foreground size-4"}),id:e.id,isCollapsed:e.isCollapsed,onToggleCollapse:()=>I(e.id),title:"Quick Actions",children:(0,t.jsx)("div",{className:"grid grid-cols-2 gap-2.5",children:["Check Balance","Reset Password","Open Ticket","Send Email"].map(e=>(0,t.jsx)("button",{className:"border-border bg-background text-foreground hover:bg-accent rounded-lg border px-4 py-3 text-sm transition-colors active:scale-95",type:"button",children:e},e))})},e.id);default:return null}})})})]})]})});function ec(){let s,a,n,l,o,i,c,d,m,b,f,[S,A]=(0,r.useState)(null),[E,T]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=!1;return(0,k.fetchWebRTCCredentialsOnce)().then(t=>{!e&&t.success&&t.credential&&A({username:t.credential.username,password:t.credential.password})}).catch(()=>{e||(0,k.resetWebRTCCredentialsCache)()}).finally(()=>{e||T(!1)}),()=>{e=!0}},[]);let z=(0,C.useTelnyxWebRTC)({username:S?.username||"",password:S?.password||"",autoConnect:!1,disabled:!S,debug:!1,onIncomingCall:e=>{},onCallEnded:e=>{q()}}),{call:R,requestVideo:P,endVideo:L}=(0,v.useUIStore)(),[I,M]=(0,r.useState)("00:00"),[D,O]=(0,r.useState)(""),[_,U]=(0,r.useState)(""),[W,H]=(0,r.useState)(!1),[G,V]=(0,r.useState)(!1),[F,B]=(0,r.useState)(!1),Y=z.currentCall?{status:"ringing"===z.currentCall.state?"inbound"===z.currentCall.direction?"incoming":"active":"active"===z.currentCall.state?"active":"ended"===z.currentCall.state?"ended":"idle",caller:{name:z.currentCall.remoteName||"Unknown Caller",number:z.currentCall.remoteNumber},isMuted:z.currentCall.isMuted,isOnHold:z.currentCall.isHeld,isRecording:F,startTime:z.currentCall.startTime?.getTime(),videoStatus:R.videoStatus||"off",isLocalVideoEnabled:R.isLocalVideoEnabled,isRemoteVideoEnabled:R.isRemoteVideoEnabled,isScreenSharing:!1,connectionQuality:"excellent",hasVirtualBackground:!1,reactions:[],chatMessages:[],participants:[],meetingLink:""}:{status:"idle",caller:null,isMuted:!1,isOnHold:!1,isRecording:!1,startTime:void 0,videoStatus:"off",isLocalVideoEnabled:!1,isRemoteVideoEnabled:!1},X=(s=(0,r.useRef)(null),a=(0,r.useRef)(!1),n=(0,v.useUIStore)(),l=(0,j.useCallPreferencesStore)(),o=(0,r.useRef)(n.call),i=(0,r.useRef)(l.position),c=(0,r.useRef)(l.popoverWidth),d=(0,r.useRef)({answerCall:n.answerCall,endCall:n.endCall,toggleMute:n.toggleMute,toggleHold:n.toggleHold,toggleRecording:n.toggleRecording,setIncomingCall:n.setIncomingCall,setPosition:l.setPosition,setPopoverWidth:l.setPopoverWidth}),(0,r.useEffect)(()=>{o.current=n.call,i.current=l.position,c.current=l.popoverWidth,d.current={answerCall:n.answerCall,endCall:n.endCall,toggleMute:n.toggleMute,toggleHold:n.toggleHold,toggleRecording:n.toggleRecording,setIncomingCall:n.setIncomingCall,setPosition:l.setPosition,setPopoverWidth:l.setPopoverWidth}}),m=(0,r.useCallback)(e=>{if(!(Date.now()-e.timestamp>5e3)){a.current=!0;try{let t=o.current,s=i.current,r=c.current,a=d.current;switch(e.type){case"CALL_INCOMING":{let s=e.data;"idle"===t.status&&a.setIncomingCall({number:s.caller.number,name:s.caller.name||"Unknown",avatar:s.caller.avatar});break}case"CALL_ANSWERED":"incoming"===t.status&&a.answerCall();break;case"CALL_ENDED":"idle"!==t.status&&"ended"!==t.status&&a.endCall();break;case"CALL_ACTION":switch(e.data){case"mute":t.isMuted||a.toggleMute();break;case"unmute":t.isMuted&&a.toggleMute();break;case"hold":t.isOnHold||a.toggleHold();break;case"unhold":t.isOnHold&&a.toggleHold();break;case"record_start":t.isRecording||a.toggleRecording();break;case"record_stop":t.isRecording&&a.toggleRecording()}break;case"POSITION_UPDATE":{let t=e.data;"default"!==s&&(s.x!==t.x||s.y!==t.y)&&a.setPosition(t);break}case"SIZE_UPDATE":{let t=e.data;r!==t&&a.setPopoverWidth(t)}}}finally{a.current=!1}}},[]),b=(0,r.useCallback)(()=>{let e=e=>{if(e.key===N&&e.newValue)try{let t=JSON.parse(e.newValue);m(t)}catch(e){}};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}},[m]),(0,r.useEffect)(()=>{if("undefined"!=typeof BroadcastChannel)try{s.current=new BroadcastChannel("thorbis-call-sync"),s.current.onmessage=e=>{m(e.data)}}catch(e){b()}else b();let e=e=>{if("call-preferences-storage"===e.key&&e.newValue)try{let t=JSON.parse(e.newValue),s=i.current,r=c.current,a=d.current;t.state?.position&&JSON.stringify(t.state.position)!==JSON.stringify(s)&&a.setPosition(t.state.position),t.state?.popoverWidth&&t.state.popoverWidth!==r&&a.setPopoverWidth(t.state.popoverWidth)}catch(e){}};return window.addEventListener("storage",e),()=>{s.current&&s.current.close(),window.removeEventListener("storage",e)}},[m,b]),f=(0,r.useCallback)(e=>{a.current||(s.current?s.current.postMessage(e):(localStorage.setItem(N,JSON.stringify(e)),localStorage.removeItem(N)))},[]),{broadcastIncomingCall:(0,r.useCallback)(e=>{f({type:"CALL_INCOMING",timestamp:Date.now(),data:{caller:e}})},[f]),broadcastCallAnswered:(0,r.useCallback)(()=>{f({type:"CALL_ANSWERED",timestamp:Date.now()})},[f]),broadcastCallEnded:(0,r.useCallback)(()=>{f({type:"CALL_ENDED",timestamp:Date.now()})},[f]),broadcastCallAction:(0,r.useCallback)(e=>{f({type:"CALL_ACTION",timestamp:Date.now(),data:e})},[f]),broadcastPositionUpdate:(0,r.useCallback)((e,t)=>{f({type:"POSITION_UPDATE",timestamp:Date.now(),data:{x:e,y:t}})},[f]),broadcastSizeUpdate:(0,r.useCallback)(e=>{f({type:"SIZE_UPDATE",timestamp:Date.now(),data:e})},[f])}),$=(0,y.useTranscriptStore)(e=>e.startRecording),K=(0,y.useTranscriptStore)(e=>e.stopRecording),q=(0,y.useTranscriptStore)(e=>e.clearTranscript),Z=(0,y.useTranscriptStore)(e=>e.addEntry),[J,Q]=(0,r.useState)(null);(0,r.useEffect)(()=>{!async function(){let t=await e.A(396931).then(e=>e.createClient());if(!t)return;let{data:{user:s}}=await t.auth.getUser();try{if(!s)return;let{data:e,error:r}=await t.from("company_memberships").select("company_id").eq("user_id",s.id).eq("status","active").order("updated_at",{ascending:!1}).limit(1);if(r)return;let a=Array.isArray(e)?e[0]:e;a?.company_id&&Q(a.company_id)}catch(e){}}()},[]);let{data:ee,isLoading:es}=function(e,t){let[s,a]=(0,r.useState)(null),[n,l]=(0,r.useState)(null),[o,i]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{e&&t?(async()=>{i(!0),l(null);try{let s=await (0,x.getCustomerByPhone)(e,t);if(s.success&&s.data){let t=s.data;a({name:`${t.first_name} ${t.last_name}`,email:t.email||"",phone:t.phone||e,company:t.company_name||"",accountStatus:t.status||"Active",lastContact:t.last_contact_date?new Date(t.last_contact_date).toLocaleDateString():"Unknown",totalCalls:t.total_interactions||0,openTickets:0,priority:t.priority_level||"medium",tags:t.tags||[],recentIssues:[],aiData:{isKnownCustomer:!0,isSpam:!1,spamConfidence:0,recognitionSource:"crm",trustScore:.9,callHistory:[],similarCallers:0,riskLevel:"low",aiNotes:[`Customer since ${t.created_at?new Date(t.created_at).getFullYear():"Unknown"}`,"Verified customer","Account in good standing"]}})}else a(g(e))}catch(s){let t=g(e);t.aiData.aiNotes=["Error loading customer data"],a(t),l(s instanceof Error?s:Error("Failed to fetch customer"))}finally{i(!1)}})():a(g(e))},[e,t]),{data:s,error:n,isLoading:o}}(Y.caller?.number,J||void 0),er=ee||{name:Y.caller?.name||"Unknown Customer",email:"",phone:Y.caller?.number||"Unknown",company:"",accountStatus:"Unknown",lastContact:"Never",totalCalls:0,openTickets:0,priority:"medium",tags:[],recentIssues:[],aiData:{isKnownCustomer:!1,isSpam:!1,spamConfidence:0,recognitionSource:"unknown",trustScore:60,callHistory:[],similarCallers:0,riskLevel:"medium",aiNotes:["Loading customer data..."]}},eo=`call-${Y.caller?.number||Date.now()}`;(0,r.useEffect)(()=>{"incoming"===Y.status&&Y.caller&&X.broadcastIncomingCall(Y.caller)},[Y.status,Y.caller,X]);let[ec,ed]=(0,r.useState)(800),eu=function(e){let{width:t,height:s,snapThreshold:a=20,onDragStart:n,onDragEnd:l,onBeyondBounds:o}=e,i=(0,j.useCallPreferencesStore)(e=>e.position),c=(0,j.useCallPreferencesStore)(e=>e.setPosition),[d,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)(()=>"default"===i?{x:window.innerWidth-t-24,y:24}:i),g=(0,r.useRef)({x:0,y:0}),h=(0,r.useRef)({x:0,y:0}),p=(0,r.useRef)(null),b=(0,r.useRef)(!1);(0,r.useEffect)(()=>{d||("default"===i?x({x:window.innerWidth-t-24,y:24}):x(i))},[i,t,d]);let f=(0,r.useCallback)(e=>e.x<-50||e.y<-50||e.x>window.innerWidth+50||e.y>window.innerHeight+50,[]),v=(0,r.useCallback)((e,r=!1)=>{let{x:n,y:l}=e;return!r&&(n=Math.max(0,Math.min(n,window.innerWidth-t)),l=Math.max(0,Math.min(l,window.innerHeight-s)),n<a&&(n=0),l<a&&(l=0),window.innerWidth-n-t<a&&(n=window.innerWidth-t),window.innerHeight-l-s<a&&(l=window.innerHeight-s)),{x:n,y:l}},[t,s,a]),N=(0,r.useCallback)((e,t,s)=>{b.current=!0,u(!0),g.current={x:e,y:t},h.current={x:e-m.x,y:t-m.y},n?.()},[m,n]),w=(0,r.useCallback)(e=>{if(e.target.closest("[data-drag-handle]")){e.preventDefault();let t=e.currentTarget.closest("[data-draggable-container]");t&&N(e.clientX,e.clientY,t)}},[N]),C=(0,r.useCallback)(e=>{if(e.target.closest("[data-drag-handle]")){e.preventDefault();let t=e.touches[0],s=e.currentTarget.closest("[data-draggable-container]");s&&N(t.clientX,t.clientY,s)}},[N]),y=(0,r.useRef)(v),k=(0,r.useRef)(f),S=(0,r.useRef)(o),A=(0,r.useRef)(l),E=(0,r.useRef)(c);return(0,r.useEffect)(()=>{y.current=v,k.current=f,S.current=o,A.current=l,E.current=c}),(0,r.useEffect)(()=>{if(!d)return;let e=e=>{b.current&&(p.current&&cancelAnimationFrame(p.current),p.current=requestAnimationFrame(()=>{let t={x:e.clientX-h.current.x,y:e.clientY-h.current.y},s=k.current(t);S.current?.(s),x(y.current(t,!0))}))},t=e=>{if(!b.current)return;p.current&&cancelAnimationFrame(p.current);let t={x:e.clientX-h.current.x,y:e.clientY-h.current.y};if(!k.current(t)){let e=y.current(t,!1);x(e),E.current(e)}b.current=!1,u(!1),S.current?.(!1),A.current?.()},s=e=>{b.current&&(p.current&&cancelAnimationFrame(p.current),p.current=requestAnimationFrame(()=>{let t=e.touches[0],s={x:t.clientX-h.current.x,y:t.clientY-h.current.y},r=k.current(s);S.current?.(r),x(y.current(s,!0))}))},r=e=>{if(!b.current)return;p.current&&cancelAnimationFrame(p.current);let t=e.changedTouches[0],s={x:t.clientX-h.current.x,y:t.clientY-h.current.y};if(!k.current(s)){let e=y.current(s,!1);x(e),E.current(e)}b.current=!1,u(!1),S.current?.(!1),A.current?.()};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),document.addEventListener("touchmove",s),document.addEventListener("touchend",r),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t),document.removeEventListener("touchmove",s),document.removeEventListener("touchend",r),p.current&&cancelAnimationFrame(p.current)}},[d]),{position:m,isDragging:d,handleMouseDown:w,handleTouchStart:C,resetPosition:(0,r.useCallback)(()=>{let e={x:window.innerWidth-t-24,y:24};x(e),c(e)},[t,c])}}({width:900,height:ec,onBeyondBounds:e=>{ep(e)}}),em=function(e,t,s={}){let{minWidth:a=420,maxWidth:n=1400,minHeight:l=400,maxHeight:o=2e3,snapPoints:i=w,snapThreshold:c=30,onResize:d}=s,u=(0,j.useCallPreferencesStore)(e=>e.popoverWidth),m=(0,j.useCallPreferencesStore)(e=>e.setPopoverWidth),x=(0,j.useCallPreferencesStore)(e=>e.setPosition),[g,h]=(0,r.useState)(!1),[p,b]=(0,r.useState)(null),[f,v]=(0,r.useState)({width:u,height:t,x:e.x,y:e.y}),N=(0,r.useRef)({x:0,y:0,width:0,height:0,posX:0,posY:0}),C=(0,r.useRef)(null),y=(0,r.useRef)(!1),k=(0,r.useCallback)(e=>{for(let t of i)if(Math.abs(e-t)<c)return t;return e},[i,c]);(0,r.useEffect)(()=>{g||v({width:u,height:t,x:e.x,y:e.y})},[u,t,e,g]);let S=(0,r.useCallback)((e,t)=>{e.preventDefault(),e.stopPropagation();let s="touches"in e?e.touches[0].clientX:e.clientX,r="touches"in e?e.touches[0].clientY:e.clientY;y.current=!0,h(!0),b(t),N.current={x:s,y:r,width:f.width,height:f.height,posX:f.x,posY:f.y}},[f]),A=(0,r.useCallback)((e,t,s)=>{let{width:r,height:i,posX:c,posY:d}=N.current,u=r,m=i,x=c,g=d;return s.includes("e")?u=r+e:s.includes("w")&&(u=r-e,x=c+e),s.includes("s")?m=i+t:s.includes("n")&&(m=i-t,g=d+t),u=Math.max(a,Math.min(n,u)),m=Math.max(l,Math.min(o,m)),u=k(u),s.includes("w")&&(x=c-(u-r)),s.includes("n")&&(g=d-(m-i)),{width:u,height:m,x:x,y:g}},[a,n,l,o,k]),E=(0,r.useRef)(A),T=(0,r.useRef)(d),z=(0,r.useRef)(m),R=(0,r.useRef)(x),P=(0,r.useRef)(f);(0,r.useEffect)(()=>{E.current=A,T.current=d,z.current=m,R.current=x,P.current=f}),(0,r.useEffect)(()=>{if(!(g&&p))return;let e=e=>{y.current&&(C.current&&cancelAnimationFrame(C.current),C.current=requestAnimationFrame(()=>{let t="touches"in e?e.touches[0].clientX:e.clientX,s="touches"in e?e.touches[0].clientY:e.clientY,r=t-N.current.x,a=s-N.current.y,n=E.current(r,a,p);v(n),P.current=n,T.current?.(n.width,n.height,n.x,n.y)}))},t=()=>{if(!y.current)return;C.current&&cancelAnimationFrame(C.current);let e=P.current;z.current(e.width),R.current({x:e.x,y:e.y}),y.current=!1,h(!1),b(null)};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),document.addEventListener("touchmove",e),document.addEventListener("touchend",t),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t),document.removeEventListener("touchmove",e),document.removeEventListener("touchend",t),C.current&&cancelAnimationFrame(C.current)}},[g,p]);let L=(0,r.useCallback)(e=>({onMouseDown:t=>S(t,e),onTouchStart:t=>S(t,e)}),[S]);return{width:f.width,height:f.height,position:{x:f.x,y:f.y},isResizing:g,activeDirection:p,handleNorth:L("n"),handleEast:L("e"),handleSouth:L("s"),handleWest:L("w"),handleNorthEast:L("ne"),handleSouthEast:L("se"),handleSouthWest:L("sw"),handleNorthWest:L("nw")}}(eu.position,ec,{onResize:(e,t,s,r)=>{ed(t)}}),{isPopOutZone:ex,isPopOutActive:eg,popOutWindow:eh,handleBeyondBounds:ep,createPopOut:eb,returnToMain:ef,focusPopOut:ev}=function(e){let{callId:t,onPopOutCreated:s,onPopOutClosed:a}=e,[n,l]=(0,r.useState)({isPopOutZone:!1,isPopOutActive:!1,popOutWindow:null}),o=(0,r.useRef)(null),i=(0,r.useRef)(null),c=(0,r.useCallback)(e=>{l(t=>({...t,isPopOutZone:e&&!t.isPopOutActive}))},[]),d=(0,r.useCallback)(()=>{o.current=null,l(e=>({...e,isPopOutActive:!1,popOutWindow:null})),a?.()},[a]),u=(0,r.useCallback)(()=>{if(n.isPopOutActive||o.current)return;let e=window.open(`/call?callId=${t}`,"_blank","noopener,noreferrer");if(!e)return;o.current=e,l(t=>({...t,isPopOutActive:!0,isPopOutZone:!1,popOutWindow:e}));let r=setInterval(()=>{if(e.closed){clearInterval(r),d();return}try{e.postMessage({type:"CALL_STATE_INIT",callId:t,timestamp:Date.now()},window.location.origin),clearInterval(r),s?.()}catch(e){}},100);setTimeout(()=>clearInterval(r),5e3);let a=setInterval(()=>{e.closed&&(clearInterval(a),d())},500);return()=>{clearInterval(r),clearInterval(a)}},[t,n.isPopOutActive,s,d]),m=(0,r.useCallback)(()=>{o.current&&!o.current.closed&&o.current.close(),d()},[d]),x=(0,r.useCallback)(()=>{o.current&&!o.current.closed&&o.current.focus()},[]);return(0,r.useEffect)(()=>{let e=e=>{if(e.origin!==window.location.origin)return;let{type:s,callId:r}=e.data;if(r===t)switch(s){case"CALL_POP_OUT_READY":o.current&&o.current.postMessage({type:"CALL_STATE_SYNC",callId:t,timestamp:Date.now()},window.location.origin);break;case"CALL_POP_OUT_CLOSED":d()}};return i.current=e,window.addEventListener("message",e),()=>{i.current&&window.removeEventListener("message",i.current)}},[t,d]),(0,r.useEffect)(()=>()=>{o.current&&!o.current.closed&&o.current.close()},[]),{isPopOutZone:n.isPopOutZone,isPopOutActive:n.isPopOutActive,popOutWindow:n.popOutWindow,handleBeyondBounds:c,createPopOut:u,returnToMain:m,focusPopOut:x}}({callId:eo,onPopOutCreated:()=>{},onPopOutClosed:()=>{}});if((0,r.useEffect)(()=>{ex&&!eu.isDragging&&eb()},[ex,eu.isDragging,eb]),(0,r.useEffect)(()=>{if("active"===Y.status){$();let e=setTimeout(()=>{Z({speaker:"customer",text:"Hi, I'm calling about my recent order. My name is John Smith and my email is john.smith@example.com"})},2e3),t=setTimeout(()=>{Z({speaker:"csr",text:"Thank you for calling. I'll help you with that. Let me pull up your account."})},4e3),s=setTimeout(()=>{Z({speaker:"customer",text:"I haven't received my package yet and it's been 5 days. The tracking number shows it's still in processing."})},6e3),r=setTimeout(()=>{Z({speaker:"csr",text:"I understand your concern. Let me check on that for you right away. I'll follow up with the shipping department and send you an email update within 24 hours."})},8e3);return()=>{clearTimeout(e),clearTimeout(t),clearTimeout(s),clearTimeout(r)}}"ended"===Y.status&&K()},[Y.status,Z,$,K]),(0,r.useEffect)(()=>{if("active"===Y.status&&Y.startTime){let e=setInterval(()=>{let e=Date.now(),t=Math.floor((e-(Y.startTime||e))/1e3),s=Math.floor(t/60);M(`${String(s).padStart(2,"0")}:${String(t%60).padStart(2,"0")}`)},1e3);return()=>clearInterval(e)}},[Y.status,Y.startTime]),"idle"===Y.status||"ended"===Y.status||!Y.caller)return null;let ej=async()=>{try{await z.answerCall(),X.broadcastCallAnswered();{let e=new URLSearchParams({callId:eo,...J&&{companyId:J},...Y.caller?.number&&{from:Y.caller.number},direction:"inbound"}),t=`/call?${e.toString()}`;window.open(t,"_blank","noopener,noreferrer")}}catch(e){}},eN=async()=>{if(!z.currentCall){q(),B(!1),X.broadcastCallEnded();return}try{await z.endCall(),q(),B(!1),X.broadcastCallEnded()}catch(e){}},ew=async()=>{if(U("voicemail"),!z.currentCall){q(),X.broadcastCallEnded();return}try{await z.endCall(),X.broadcastCallEnded()}catch(e){}},eC=async()=>{try{Y.isMuted?(await z.unmuteCall(),X.broadcastCallAction("unmute")):(await z.muteCall(),X.broadcastCallAction("mute"))}catch(e){}},ey=async()=>{try{Y.isOnHold?(await z.unholdCall(),X.broadcastCallAction("unhold")):(await z.holdCall(),X.broadcastCallAction("hold"))}catch(e){}},ek=async()=>{if(z.currentCall?.id)try{F?(await (0,p.stopCallRecording)(z.currentCall.id)).success&&(B(!1),X.broadcastCallAction("record_stop")):(await (0,h.startCallRecording)(z.currentCall.id)).success&&(B(!0),X.broadcastCallAction("record_start"))}catch(e){}},eS=async e=>{try{await z.sendDTMF(e)}catch(e){}};return"active"===Y.status&&("requesting"===Y.videoStatus||"ringing"===Y.videoStatus||"connected"===Y.videoStatus)?(0,t.jsx)(ea,{addReaction:v.useUIStore.getState().addReaction,call:Y,callDuration:I,caller:Y.caller,onEndCall:eN,onEndVideo:L,onToggleLocalVideo:v.useUIStore.getState().toggleLocalVideo,sendChatMessage:v.useUIStore.getState().sendChatMessage,toggleMute:eC,toggleRecording:ek,toggleScreenShare:v.useUIStore.getState().toggleScreenShare,toggleVirtualBackground:v.useUIStore.getState().toggleVirtualBackground}):"incoming"===Y.status?(0,t.jsx)(en,{caller:Y.caller,customerData:er,onAnswer:ej,onDecline:eN,onVoicemail:ew}):W?(0,t.jsx)(el,{call:Y,callDuration:I,caller:Y.caller,onEndCall:eN,onMaximize:()=>H(!1),sendDTMF:eS,toggleHold:ey,toggleMute:eC}):eg?(0,t.jsx)(u,{callId:eo,customerName:Y.caller?.name||"Unknown Caller",customerPhone:Y.caller?.number||"",duration:Math.floor((Date.now()-(Y.startTime||Date.now()))/1e3),isActive:"active"===Y.status,onFocusPopOut:ev,onReturnToMain:ef,position:"bottom-right"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ei,{call:Y,callDuration:I,caller:Y.caller,callNotes:D,customerData:er,disposition:_,handleMouseDown:eu.handleMouseDown,handleTouchStart:eu.handleTouchStart,height:em.height,isDragging:eu.isDragging,isPopOutZone:ex,isResizing:em.isResizing,onEndCall:eN,onEndVideo:L,onMinimize:()=>H(!0),onRequestVideo:P,onTransfer:()=>{V(!0)},position:em.position,resizeHandles:{handleNorth:em.handleNorth,handleEast:em.handleEast,handleSouth:em.handleSouth,handleWest:em.handleWest,handleNorthEast:em.handleNorthEast,handleSouthEast:em.handleSouthEast,handleSouthWest:em.handleSouthWest,handleNorthWest:em.handleNorthWest},setCallNotes:O,setDisposition:U,toggleHold:ey,toggleMute:eC,toggleRecording:ek,width:em.width}),(0,t.jsx)(et,{callControlId:z.currentCall?.id||null,fromNumber:Y.caller?.number||"",onOpenChange:V,onTransferSuccess:()=>{q(),X.broadcastCallEnded()},open:G})]})}e.s(["IncomingCallNotification",()=>ec],801316)},809423,e=>{e.n(e.i(801316))}]);