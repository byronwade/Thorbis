(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,661803,e=>{"use strict";var s=e.i(111043),t=e.i(946672),a=e.i(263942),r=e.i(276389),i=e.i(403468),l=e.i(882896),n=e.i(606661),d=e.i(559586),c=e.i(15751),o=e.i(848475),m=e.i(60179),x=e.i(939397),h=e.i(371526),u=e.i(613240),p=e.i(868106),j=e.i(598870),f=e.i(614726),g=e.i(123891),N=e.i(142642),v=e.i(697029),y=e.i(14435),b=e.i(123331),w=e.i(501651),C=e.i(176378),k=e.i(904653),S=e.i(970799),_=e.i(49718),A=e.i(38614),P=e.i(995403),F=e.i(552038),D=(0,F.createServerReference)("40295f87d7cac83dfc3c1e3626ca045351b8684bcf",F.callServer,void 0,F.findSourceMapURL,"sendEstimateEmail"),z=(0,F.createServerReference)("401d437f15534a88ca15a64f6eb984496a9be06f5a",F.callServer,void 0,F.findSourceMapURL,"sendInvoiceEmail"),M=e.i(818796),I=e.i(751139),T=e.i(79254),B=e.i(641304),$=(0,F.createServerReference)("40c95bcd163662f3ce8b4f9c35b5e60fd93c079978",F.callServer,void 0,F.findSourceMapURL,"processInvoicePayment"),L=(0,F.createServerReference)("0025397304fc442a5fd90eb659fe2d0732fecdbdaf",F.callServer,void 0,F.findSourceMapURL,"getPaymentMethods");e.i(686787);var R=e.i(519539);e.i(553153);var U=e.i(363712);e.i(889265);var E=e.i(677607);e.i(539870);var q=e.i(846358);function V({open:e,onOpenChange:t,invoiceId:a,invoiceNumber:r,amount:l,onSuccess:n}){let[d,c]=(0,S.useState)(!0),[o,m]=(0,S.useState)(!1),[x,h]=(0,S.useState)(null),[u,p]=(0,S.useState)(!1),[j,f]=(0,S.useState)(null);(0,S.useEffect)(()=>{e&&g()},[e,g]);let g=async()=>{c(!0),h(null);let e=await L();if(!(e.success&&e.paymentMethods)){h(e.error||"Failed to load payment methods"),c(!1);return}let s=e.paymentMethods.find(e=>e.is_default)??e.paymentMethods[0];s?f({id:s.id,card_brand:s.brand,card_last4:s.last4,card_exp_month:s.exp_month,card_exp_year:s.exp_year,nickname:s.display_name,is_default:s.is_default}):h("No payment methods found. Please add a payment method first."),c(!1)},N=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e/100),v=async()=>{if(!j)return void h("No payment method available");m(!0),h(null);let e=await $({invoiceId:a,paymentMethodId:j.id,channel:"online"});m(!1),e.success?(p(!0),setTimeout(()=>{n?.(),t(!1),p(!1)},1500)):h(e.error||"Payment failed")};return d?(0,s.jsx)(q.Dialog,{onOpenChange:t,open:e,children:(0,s.jsx)(q.DialogContent,{className:"sm:max-w-[450px]",children:(0,s.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,s.jsx)(B.Loader2,{className:"text-muted-foreground size-8 animate-spin"})})})}):u?(0,s.jsx)(q.Dialog,{onOpenChange:t,open:e,children:(0,s.jsxs)(q.DialogContent,{className:"sm:max-w-[450px]",children:[(0,s.jsx)(q.DialogHeader,{children:(0,s.jsx)(q.DialogTitle,{children:"Payment Successful"})}),(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,s.jsx)("div",{className:"bg-success/10 mb-4 flex size-16 items-center justify-center rounded-full",children:(0,s.jsx)(T.Check,{className:"text-success size-8"})}),(0,s.jsx)("h3",{className:"mb-2 text-lg font-semibold",children:"Payment Successful!"}),(0,s.jsxs)("p",{className:"text-muted-foreground text-center text-sm",children:[N(l)," paid for invoice ",r]})]})]})}):(0,s.jsx)(q.Dialog,{onOpenChange:t,open:e,children:(0,s.jsxs)(q.DialogContent,{className:"sm:max-w-[450px]",children:[(0,s.jsxs)(q.DialogHeader,{children:[(0,s.jsx)(q.DialogTitle,{children:"Confirm Payment"}),(0,s.jsxs)(q.DialogDescription,{children:["Quick payment for ",r]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"bg-muted/30 rounded-lg border p-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm",children:"Amount to Pay:"}),(0,s.jsx)("span",{className:"text-xl font-bold",children:N(l)})]})}),j?(0,s.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,s.jsx)("p",{className:"text-muted-foreground mb-2 text-xs",children:"Payment Method:"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-2xl",children:"üí≥"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-sm font-medium",children:[j.card_brand.toUpperCase()," ‚Ä¢‚Ä¢‚Ä¢‚Ä¢"," ",j.card_last4]}),(0,s.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Expires"," ",String(j.card_exp_month).padStart(2,"0"),"/",j.card_exp_year,j.nickname&&` ‚Ä¢ ${j.nickname}`]})]}),j.is_default&&(0,s.jsx)(U.Badge,{className:"ml-auto text-xs",variant:"secondary",children:"Default"})]})]}):(0,s.jsxs)(R.Alert,{variant:"destructive",children:[(0,s.jsx)(I.AlertTriangle,{className:"size-4"}),(0,s.jsx)(R.AlertDescription,{children:"No payment method available. Please add a payment method in the Billing Information section."})]}),(0,s.jsxs)(R.Alert,{children:[(0,s.jsx)(M.AlertCircle,{className:"size-4"}),(0,s.jsxs)(R.AlertDescription,{className:"text-sm",children:["This will charge ",N(l)," to your"," ",j?.card_brand.toUpperCase()," card ending in"," ",j?.card_last4,"."]})]}),x&&(0,s.jsxs)(R.Alert,{variant:"destructive",children:[(0,s.jsx)(M.AlertCircle,{className:"size-4"}),(0,s.jsx)(R.AlertDescription,{children:x})]})]}),(0,s.jsxs)(q.DialogFooter,{children:[(0,s.jsx)(E.Button,{disabled:o,onClick:()=>t(!1),variant:"outline",children:"Cancel"}),(0,s.jsx)(E.Button,{disabled:o||!j,onClick:v,children:o?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B.Loader2,{className:"mr-2 size-4 animate-spin"}),"Processing..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.CreditCard,{className:"mr-2 size-4"}),"Confirm & Pay"]})})]})]})})}e.i(244242);var O=e.i(563078),H=e.i(527756),W=e.i(635709);function G({invoices:e,onUpdate:t}){let[a,r]=(0,S.useState)(null),[l,c]=(0,S.useState)(null),o=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e/100),m=async e=>{c(e);let s=await z(e);c(null),s.success?(P.toast.success(s.message||"Invoice sent successfully"),t?.()):P.toast.error(s.error||"Failed to send invoice")},x=async e=>{c(e);let s=await D(e);c(null),s.success?(P.toast.success(s.message||"Estimate sent successfully"),t?.()):P.toast.error(s.error||"Failed to send estimate")},h=e=>(0,s.jsx)(U.Badge,{className:"text-xs",variant:{paid:"default",pending:"secondary",draft:"outline",overdue:"destructive"}[e]||"outline",children:e}),u=(0,S.useMemo)(()=>[{key:"invoice_number",header:"Invoice #",width:"w-32",shrink:!0,render:e=>(0,s.jsx)(C.default,{className:"text-foreground text-xs leading-tight font-medium hover:underline",href:`/dashboard/work/invoices/${e.id}`,onClick:e=>e.stopPropagation(),children:e.invoice_number})},{key:"title",header:"Title",render:e=>(0,s.jsx)(C.default,{className:"text-foreground text-xs leading-tight font-medium hover:underline",href:`/dashboard/work/invoices/${e.id}`,onClick:e=>e.stopPropagation(),children:e.title||"‚Äî"})},{key:"status",header:"Status",width:"w-24",shrink:!0,render:e=>h(e.status)},{key:"total_amount",header:"Amount",width:"w-32",shrink:!0,align:"right",render:e=>(0,s.jsx)("span",{className:"font-medium",children:o(e.total_amount)})},{key:"balance_amount",header:"Balance",width:"w-32",shrink:!0,align:"right",render:e=>e.balance_amount>0?(0,s.jsx)("span",{className:"text-destructive font-medium",children:o(e.balance_amount)}):(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"Paid"})},{key:"due_date",header:"Due Date",width:"w-28",shrink:!0,hideOnMobile:!0,render:e=>(0,s.jsx)("span",{className:"text-xs",children:e.due_date?new Date(e.due_date).toLocaleDateString():"‚Äî"})},{key:"actions",header:"",width:"w-12",shrink:!0,align:"right",render:e=>{let t="paid"!==e.status&&e.balance_amount>0;return(0,s.jsxs)(O.DropdownMenu,{children:[(0,s.jsx)(O.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsx)(E.Button,{className:"size-8 p-0",size:"sm",variant:"ghost",children:(0,s.jsx)(A.MoreHorizontal,{className:"size-4"})})}),(0,s.jsxs)(O.DropdownMenuContent,{align:"end",className:"w-48",children:[t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(O.DropdownMenuItem,{className:"cursor-pointer",onClick:()=>r(e),children:[(0,s.jsx)(i.CreditCard,{className:"mr-2 size-4"}),"Quick Pay"]}),(0,s.jsx)(O.DropdownMenuSeparator,{})]}),(0,s.jsxs)(O.DropdownMenuItem,{className:"cursor-pointer",disabled:l===e.id,onClick:()=>m(e.id),children:[(0,s.jsx)(d.Mail,{className:"mr-2 size-4"}),"Send Invoice"]}),(0,s.jsxs)(O.DropdownMenuItem,{className:"cursor-pointer",disabled:l===e.id,onClick:()=>x(e.id),children:[(0,s.jsx)(n.FileText,{className:"mr-2 size-4"}),"Send as Estimate"]})]})]})}}],[l,o,h,x,m]);return(0,s.jsxs)(s.Fragment,{children:[a&&(0,s.jsx)(V,{amount:a.balance_amount,invoiceId:a.id,invoiceNumber:a.invoice_number,onOpenChange:e=>!e&&r(null),onSuccess:()=>{r(null),t?.()},open:!!a}),(0,s.jsx)(H.FullWidthDataTable,{...W.TablePresets.fullList(),columns:u,data:e,emptyIcon:(0,s.jsx)(n.FileText,{className:"text-muted-foreground/50 size-12"}),emptyMessage:"No invoices found",getItemId:e=>e.id,searchFilter:(e,s)=>{let t=s.toLowerCase();return e.invoice_number?.toLowerCase().includes(t)||e.title?.toLowerCase().includes(t)||e.status?.toLowerCase().includes(t)},searchPlaceholder:"Search invoices..."})]})}var J=e.i(532727);e.i(116233);var Z=e.i(65456);function K({id:e,type:t="card",card_brand:a,card_last4:r,card_exp_month:i,card_exp_year:l,cardholder_name:n,bank_name:d,account_type:c,is_default:o,nickname:m,is_verified:x,onSetDefault:h,onRemove:u,disabled:p=!1}){return(0,s.jsxs)("div",{className:"group relative",children:[(0,s.jsx)(Z.CreditCardVisual,{accountType:c,bankName:d,brand:a,cardholderName:n,expMonth:i,expYear:l,isDefault:o,isVerified:x,last4:r,nickname:m,type:t}),(0,s.jsxs)("div",{className:"mt-3 flex items-center justify-between gap-2 opacity-0 transition-opacity group-hover:opacity-100",children:[(0,s.jsx)("div",{className:"flex gap-2",children:!o&&h&&(0,s.jsx)(E.Button,{className:"h-8 text-xs",disabled:p,onClick:e=>{e.stopPropagation(),h()},size:"sm",variant:"outline",children:"Set as Default"})}),u&&(0,s.jsxs)(E.Button,{className:"text-destructive hover:bg-destructive hover:text-destructive-foreground h-8",disabled:p,onClick:e=>{e.stopPropagation(),confirm(`Remove this ${"card"===t?"card":"account"}?`)&&u()},size:"sm",variant:"outline",children:[(0,s.jsx)(J.Trash2,{className:"mr-1.5 size-3.5"}),"Remove"]})]})]})}e.i(313550);var Q=e.i(969098),X=e.i(160063),X=X,Y=e.i(201710),ee=e.i(799296),es=(0,F.createServerReference)("40c4dabc91a1b3abfcb02e70294b84f9e59c59d1e8",F.callServer,void 0,F.findSourceMapURL,"archiveProperty");e.i(235670);var et=e.i(360648);e.i(306226);var ea=e.i(508420),er=e.i(133279),ei=e.i(136764),el=e.i(964529),en=e.i(167542),en=en,ed=e.i(979731),ec=e.i(8392),eo=e.i(332845),em=e.i(175913),ex=e.i(555739),eh=e.i(902302),eh=eh;e.i(254851);var eu=e.i(605278);e.i(287133);var ep=e.i(120109);e.i(794747);var ej=e.i(513990),ef=e.i(797566);e.i(789067);var eg=e.i(861308);let eN=!1,ev=!1,ey=[];function eb({address:e,lat:t,lon:a,nearbySuppliers:r=[]}){let[i,l]=(0,S.useState)(!1),[n,d]=(0,S.useState)(!0),[o,m]=(0,S.useState)(null),x=(0,S.useRef)(null),h=(0,S.useRef)(null),u=(0,S.useRef)(null),p=(0,S.useRef)(null),j="AIzaSyCVKN0pddG230vvjT0EMP9sSIR31j1q2t0";(0,S.useEffect)(()=>{if(u.current)return void d(!1);let e=!0,s=null,t=0,a=()=>{if(e){if(!x.current){if(++t>=50){m("Failed to initialize map"),d(!1);return}s=setTimeout(a,100);return}new Promise((e,s)=>{if(eN||window.google?.maps){eN=!0,e();return}if(ev)return void ey.push(e);let t=document.querySelector('script[src*="maps.googleapis.com"]');if(t){ev=!0,t.addEventListener("load",()=>{eN=!0,ev=!1,e(),ey.forEach(e=>e()),ey.length=0});return}ev=!0;let a=document.createElement("script");a.src=`https://maps.googleapis.com/maps/api/js?key=${j}&libraries=marker`,a.async=!0,a.defer=!0,a.onload=()=>{eN=!0,ev=!1,e(),ey.forEach(e=>e()),ey.length=0},a.onerror=()=>{ev=!1,s(Error("Failed to load Google Maps"))},document.head.appendChild(a)}).then(()=>{e&&x.current&&!u.current&&f(x.current,!1)}).catch(s=>{e&&m("Failed to load Google Maps")}).finally(()=>{e&&d(!1)})}};return a(),()=>{e=!1,s&&clearTimeout(s)}},[j,f]),(0,S.useEffect)(()=>{i&&h.current&&!p.current&&f(h.current,!0)},[i,f]);let f=(s,i)=>{if(!window.google?.maps)return;let l=new google.maps.Map(s,{center:{lat:t,lng:a},zoom:i?13:12,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:i});new google.maps.Marker({position:{lat:t,lng:a},map:l,title:e.full,icon:{path:google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#ef4444",fillOpacity:1,strokeColor:"#f3f7fd",strokeWeight:2},label:{text:"üìç",fontSize:"18px"}});let n=new google.maps.LatLngBounds;for(let e of(n.extend({lat:t,lng:a}),r)){let s=new google.maps.Marker({position:{lat:e.lat,lng:e.lon},map:l,title:e.name,icon:{path:google.maps.SymbolPath.CIRCLE,scale:6,fillColor:"#3b82f6",fillOpacity:.8,strokeColor:"#f3f7fd",strokeWeight:2}}),t=new google.maps.InfoWindow({content:`
          <div style="padding: 8px;">
            <div style="font-weight: 600; margin-bottom: 4px;">${e.name}</div>
            <div style="font-size: 12px; color: #666;">
              ${(e.distance/1e3).toFixed(1)} km away
            </div>
          </div>
        `});s.addListener("click",()=>{t.open(l,s)}),n.extend({lat:e.lat,lng:e.lon})}r.length>0&&l.fitBounds(n),i?p.current=l:u.current=l};return o?(0,s.jsxs)("div",{className:"border-muted text-muted-foreground flex items-center gap-2 rounded-lg border p-4 text-sm",children:[(0,s.jsx)(c.MapPin,{className:"h-4 w-4"}),(0,s.jsxs)("span",{children:["Map unavailable: ",o]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"group bg-card relative overflow-hidden rounded-lg border",children:(0,s.jsxs)("div",{className:"relative h-[180px] w-full",children:[(0,s.jsx)("div",{className:"h-full w-full",ref:x}),n&&(0,s.jsx)(eg.Skeleton,{className:"absolute inset-0 h-full w-full"}),(0,s.jsx)("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent p-3",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"mb-1 flex items-center gap-2",children:[(0,s.jsx)(c.MapPin,{className:"h-4 w-4 text-white"}),(0,s.jsx)("span",{className:"text-sm font-semibold text-white",children:"Service Location"}),r.length>0&&(0,s.jsxs)(U.Badge,{className:"bg-primary/80 h-5 text-[10px] text-white",variant:"secondary",children:[(0,s.jsx)(ex.Store,{className:"mr-1 h-3 w-3"}),r.length," suppliers"]})]}),(0,s.jsx)("p",{className:"text-xs text-white/90",children:e.street}),(0,s.jsxs)("p",{className:"text-xs text-white/80",children:[e.city,", ",e.state," ",e.zipCode]})]}),(0,s.jsx)(E.Button,{className:"bg-card/90 hover:bg-card h-8 w-8",onClick:()=>l(!0),size:"icon",variant:"ghost",children:(0,s.jsx)(ef.Maximize2,{className:"text-foreground h-4 w-4"})})]})})]})}),(0,s.jsx)(q.Dialog,{onOpenChange:l,open:i,children:(0,s.jsxs)(q.DialogContent,{className:"max-w-4xl p-0",children:[(0,s.jsxs)(q.DialogHeader,{className:"border-b p-4",children:[(0,s.jsxs)(q.DialogTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(c.MapPin,{className:"text-primary h-5 w-5"}),"Service Location Map"]}),(0,s.jsxs)("div",{className:"text-muted-foreground mt-2 text-sm",children:[(0,s.jsx)("p",{className:"text-foreground font-medium",children:e.street}),(0,s.jsxs)("p",{children:[e.city,", ",e.state," ",e.zipCode]})]})]}),(0,s.jsx)("div",{className:"h-[600px] w-full",ref:h}),(0,s.jsx)("div",{className:"border-t p-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-6 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"bg-destructive flex h-6 w-6 items-center justify-center rounded-full",children:(0,s.jsx)(c.MapPin,{className:"h-4 w-4 text-white"})}),(0,s.jsx)("span",{children:"Service Location"})]}),r.length>0&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"bg-primary flex h-6 w-6 items-center justify-center rounded-full",children:(0,s.jsx)(ex.Store,{className:"h-4 w-4 text-white"})}),(0,s.jsxs)("span",{children:["Nearby Suppliers (",r.length,")"]})]})]})})]})})]})}function ew({enrichmentData:e}){let t;if(!e)return(0,s.jsx)(eu.Card,{children:(0,s.jsx)(eu.CardContent,{className:"flex items-center justify-center py-8",children:(0,s.jsx)("p",{className:"text-muted-foreground text-sm",children:"No operational intelligence available"})})});if("failed"===e.enrichmentStatus)return(0,s.jsx)(eu.Card,{children:(0,s.jsx)(eu.CardContent,{className:"py-6",children:(0,s.jsxs)(R.Alert,{variant:"destructive",children:[(0,s.jsx)(I.AlertTriangle,{className:"h-4 w-4"}),(0,s.jsx)(R.AlertDescription,{children:"Failed to load operational intelligence. Please try again."})]})})});let{propertyData:r,buildingData:i,weather:l,waterQuality:n,locationIntelligence:d,nearbySuppliers:o,streetView:m,googlePlaces:h,timeZone:u,recommendations:p}=e;return(0,s.jsxs)("div",{className:"space-y-6",children:[(p.shouldReschedule||l?.hasActiveAlerts||p.upsellOpportunities.length>0)&&(0,s.jsxs)("div",{className:"space-y-3",children:[p.shouldReschedule&&(0,s.jsxs)(R.Alert,{variant:"destructive",children:[(0,s.jsx)(I.AlertTriangle,{className:"h-4 w-4"}),(0,s.jsx)(R.AlertDescription,{className:"font-medium",children:p.rescheduleReason})]}),l?.hasActiveAlerts&&l.alerts?.[0]&&(0,s.jsxs)(R.Alert,{children:[(0,s.jsx)(el.CloudRain,{className:"h-4 w-4"}),(0,s.jsxs)(R.AlertDescription,{children:[(0,s.jsxs)("span",{className:"font-medium",children:[l.alerts[0].event,": "]}),l.alerts[0].headline]})]}),p.upsellOpportunities.length>0&&(0,s.jsxs)(R.Alert,{className:"border-emerald-200 bg-emerald-50 dark:border-emerald-900 dark:bg-emerald-950",children:[(0,s.jsx)(v.TrendingUp,{className:"h-4 w-4 text-emerald-600 dark:text-emerald-400"}),(0,s.jsx)(R.AlertDescription,{className:"text-emerald-900 dark:text-emerald-100",children:p.upsellOpportunities[0]})]})]}),e.location&&(0,s.jsx)(eb,{address:{street:e.location.address?.split(",")[0]||"",city:e.location.address?.split(",")[1]?.trim()||"",state:e.location.address?.split(",")[2]?.trim().split(" ")[0]||"",zipCode:e.location.address?.split(",")[2]?.trim().split(" ").slice(1).join(" ")||"",full:e.location.address||""},lat:e.location.lat||0,lon:e.location.lon||0,nearbySuppliers:o}),(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[l?.forecast?.periods?.[0]&&(0,s.jsxs)(eu.Card,{children:[(0,s.jsx)(eu.CardHeader,{className:"pb-3",children:(0,s.jsxs)(eu.CardTitle,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,s.jsx)(eh.default,{className:"text-muted-foreground h-4 w-4"}),"Weather"]})}),(0,s.jsxs)(eu.CardContent,{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,s.jsxs)("span",{className:"text-3xl font-semibold",children:[l.forecast.periods[0].temperature,"¬∞"]}),(0,s.jsx)("span",{className:"text-muted-foreground text-sm",children:l.forecast.periods[0].windSpeed})]}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm leading-relaxed",children:l.forecast.periods[0].detailedForecast})]})]}),r&&(r.characteristics?.yearBuilt||r.characteristics?.squareFeet||r.assessment?.assessedValue||r.market?.lastSoldPrice)&&(0,s.jsxs)(eu.Card,{children:[(0,s.jsx)(eu.CardHeader,{className:"pb-3",children:(0,s.jsxs)(eu.CardTitle,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,s.jsx)(a.Building2,{className:"text-muted-foreground h-4 w-4"}),"Property"]})}),(0,s.jsxs)(eu.CardContent,{className:"space-y-2",children:[r.characteristics?.squareFeet&&(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Size"}),(0,s.jsxs)("span",{className:"font-medium",children:[r.characteristics.squareFeet.toLocaleString()," ","sq ft"]})]}),r.characteristics?.yearBuilt&&(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Built"}),(0,s.jsx)("span",{className:"font-medium",children:r.characteristics.yearBuilt})]}),r.assessment?.assessedValue&&(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Assessed"}),(0,s.jsxs)("span",{className:"font-medium",children:["$",(r.assessment.assessedValue/100).toLocaleString()]})]}),r.market?.lastSoldPrice&&(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Last Sold"}),(0,s.jsxs)("span",{className:"font-medium",children:["$",(r.market.lastSoldPrice/100).toLocaleString()]})]})]})]}),i&&(i.footprint?.area||i.height||i.levels||i.buildingType)&&(0,s.jsxs)(eu.Card,{children:[(0,s.jsx)(eu.CardHeader,{className:"pb-3",children:(0,s.jsxs)(eu.CardTitle,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,s.jsx)(a.Building2,{className:"text-muted-foreground h-4 w-4"}),"Building"]})}),(0,s.jsxs)(eu.CardContent,{className:"space-y-2",children:[i.buildingType&&(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Type"}),(0,s.jsx)("span",{className:"font-medium",children:i.buildingType})]}),i.footprint?.area&&(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Footprint"}),(0,s.jsxs)("span",{className:"font-medium",children:[Math.round(10.764*i.footprint.area).toLocaleString()," ","sq ft"]})]}),i.height&&(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Height"}),(0,s.jsxs)("span",{className:"font-medium",children:[Math.round(3.281*i.height)," ft"]})]}),i.levels&&(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Floors"}),(0,s.jsx)("span",{className:"font-medium",children:i.levels})]})]})]}),n&&(0,s.jsxs)(eu.Card,{children:[(0,s.jsx)(eu.CardHeader,{className:"pb-3",children:(0,s.jsxs)(eu.CardTitle,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,s.jsx)(en.default,{className:"text-muted-foreground h-4 w-4"}),"Water Quality"]})}),(0,s.jsxs)(eu.CardContent,{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground text-sm",children:"Hardness"}),(0,s.jsx)(U.Badge,{variant:"outline",children:n.classification})]}),n.recommendations.shouldOfferSoftener&&(0,s.jsx)("p",{className:"text-muted-foreground text-sm leading-relaxed",children:n.recommendations.reason})]})]}),d?.county?.countyName&&(0,s.jsxs)(eu.Card,{children:[(0,s.jsx)(eu.CardHeader,{className:"pb-3",children:(0,s.jsxs)(eu.CardTitle,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,s.jsx)(c.MapPin,{className:"text-muted-foreground h-4 w-4"}),"Location"]})}),(0,s.jsxs)(eu.CardContent,{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"County"}),(0,s.jsx)("span",{className:"font-medium",children:d.county.countyName})]}),d.floodZone&&(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Flood Zone"}),(0,s.jsx)(U.Badge,{variant:"high"===d.floodZone.riskLevel?"destructive":"secondary",children:d.floodZone.zone})]})]})]}),u&&(0,s.jsxs)(eu.Card,{children:[(0,s.jsx)(eu.CardHeader,{className:"pb-3",children:(0,s.jsxs)(eu.CardTitle,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,s.jsx)(ei.Clock,{className:"text-muted-foreground h-4 w-4"}),"Time Zone"]})}),(0,s.jsx)(eu.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Zone"}),(0,s.jsx)("span",{className:"font-medium",children:u.timeZoneName})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Offset"}),(0,s.jsxs)(U.Badge,{variant:"secondary",children:["UTC",u.totalOffsetHours>=0?"+":"",u.totalOffsetHours]})]}),u.isDST&&(0,s.jsx)(U.Badge,{className:"text-xs",variant:"outline",children:"Daylight Saving Time"})]})})]}),!h&&o&&o.length>0&&(0,s.jsxs)(eu.Card,{className:"sm:col-span-2",children:[(0,s.jsx)(eu.CardHeader,{className:"pb-3",children:(0,s.jsxs)(eu.CardTitle,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,s.jsx)(ex.Store,{className:"text-muted-foreground h-4 w-4"}),"Nearby Suppliers"]})}),(0,s.jsx)(eu.CardContent,{children:(0,s.jsx)("div",{className:"space-y-2",children:o.slice(0,3).map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsx)("p",{className:"truncate text-sm font-medium",children:e.name}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:e.distance?`${(e.distance/1e3).toFixed(1)} km`:"‚Äî"})]}),(0,s.jsx)(E.Button,{asChild:!0,size:"sm",variant:"ghost",children:(0,s.jsx)("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${e.lat},${e.lon}`,rel:"noopener noreferrer",target:"_blank",children:(0,s.jsx)(eo.Navigation,{className:"h-4 w-4"})})})]},`${e.name}-${e.lat}-${e.lon}`))})})]})]}),m?.available&&m.mainView&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ep.Separator,{}),(0,s.jsxs)(eu.Card,{children:[(0,s.jsx)(eu.CardHeader,{children:(0,s.jsxs)(eu.CardTitle,{className:"flex items-center gap-2 text-base",children:[(0,s.jsx)(er.Camera,{className:"text-primary h-5 w-5"}),"Property Street View"]})}),(0,s.jsxs)(eu.CardContent,{className:"space-y-4",children:[(0,s.jsx)("div",{className:"overflow-hidden rounded-lg border",children:(0,s.jsx)("img",{alt:"Property street view",className:"h-auto w-full",height:"400",loading:"lazy",src:m.mainView,width:"600"})}),m.alternateViews&&m.alternateViews.length>0&&(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:m.alternateViews.map(e=>(0,s.jsx)("div",{className:"overflow-hidden rounded-md border",children:(0,s.jsx)("img",{alt:"Property from alternate angle",className:"h-auto w-full",height:"400",loading:"lazy",src:e,width:"600"})},`view-${e.substring(0,30)}`))}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:"Street view images provided by Google Maps"})]})]})]}),h&&h.places.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ep.Separator,{}),(0,s.jsxs)(eu.Card,{children:[(0,s.jsx)(eu.CardHeader,{children:(0,s.jsxs)(eu.CardTitle,{className:"flex items-center justify-between text-base",children:[(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)(ex.Store,{className:"text-primary h-5 w-5"}),"Nearby Suppliers"]}),(0,s.jsxs)(U.Badge,{variant:"secondary",children:[h.totalResults," found"]})]})}),(0,s.jsx)(eu.CardContent,{children:(0,s.jsx)("div",{className:"space-y-4",children:h.places.slice(0,3).map(e=>(0,s.jsxs)("div",{className:"flex gap-4 rounded-lg border p-4",children:[e.photoUrl&&(0,s.jsx)("div",{className:"h-20 w-20 flex-shrink-0 overflow-hidden rounded-md",children:(0,s.jsx)("img",{alt:e.name,className:"h-full w-full object-cover",height:"80",loading:"lazy",src:e.photoUrl,width:"80"})}),(0,s.jsxs)("div",{className:"min-w-0 flex-1 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsx)("h4",{className:"truncate text-sm font-semibold",children:e.name}),(0,s.jsx)("p",{className:"text-muted-foreground truncate text-xs",children:e.vicinity})]}),(0,s.jsxs)(U.Badge,{className:"flex-shrink-0 text-xs",variant:"outline",children:[(e.distance/1e3).toFixed(1)," km"]})]}),e.rating&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(em.Star,{className:"text-warning h-3 w-3 fill-yellow-400"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:e.rating.toFixed(1)})]}),e.userRatingsTotal&&(0,s.jsxs)("span",{className:"text-muted-foreground text-xs",children:["(",e.userRatingsTotal.toLocaleString()," ","reviews)"]}),void 0!==e.openNow&&(0,s.jsx)(U.Badge,{className:"text-xs",variant:e.openNow?"default":"secondary",children:e.openNow?"Open":"Closed"})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsx)(E.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,s.jsxs)("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${e.lat},${e.lon}`,rel:"noopener noreferrer",target:"_blank",children:[(0,s.jsx)(eo.Navigation,{className:"mr-1 h-3 w-3"}),"Directions"]})}),e.phoneNumber&&(0,s.jsx)(E.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,s.jsxs)("a",{href:`tel:${e.phoneNumber}`,children:[(0,s.jsx)(x.Phone,{className:"mr-1 h-3 w-3"}),"Call"]})}),e.website&&(0,s.jsx)(E.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,s.jsxs)("a",{href:e.website,rel:"noopener noreferrer",target:"_blank",children:[(0,s.jsx)(ed.Globe,{className:"mr-1 h-3 w-3"}),"Website"]})}),(0,s.jsx)(E.Button,{asChild:!0,size:"sm",variant:"ghost",children:(0,s.jsxs)("a",{href:`https://www.google.com/maps/place/?q=place_id:${e.placeId}`,rel:"noopener noreferrer",target:"_blank",children:[(0,s.jsx)(Q.ExternalLink,{className:"mr-1 h-3 w-3"}),"View on Maps"]})})]})]})]},e.placeId))})})]})]}),e.sources&&e.sources.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ep.Separator,{}),(0,s.jsx)(ej.TooltipProvider,{children:(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"Data sources:"}),e.sources.map(e=>(0,s.jsxs)(ej.Tooltip,{children:[(0,s.jsx)(ej.TooltipTrigger,{asChild:!0,children:(0,s.jsx)(U.Badge,{className:"cursor-help",variant:"secondary",children:e.toUpperCase()})}),(0,s.jsx)(ej.TooltipContent,{children:(0,s.jsx)("p",{className:"max-w-xs text-xs",children:{nominatim:"OpenStreetMap Nominatim - Free geocoding service for address lookup",none:"No data sources available - check API configurations",nws:"National Weather Service - Free weather forecasts and alerts",fcc:"FCC Census Block API - Free location and county information",fema:"FEMA NFHL - Free flood zone and risk data",overpass:"OpenStreetMap Overpass API - Free nearby points of interest","usgs-elevation":"USGS Elevation API - Free terrain elevation data","osm-walkability":"OpenStreetMap - Calculated walkability score based on amenities","osm-schools":"OpenStreetMap - Nearby schools and education facilities","google-places":"Google Places API - Business info with reviews and ratings","google-streetview":"Google Street View - Property photos from street level","google-timezone":"Google Time Zone API - Automatic timezone detection",census:"US Census Bureau - Demographics and population statistics",airnow:"AirNow EPA - Air quality index and pollutant data",usgs:"USGS Water Services - Water quality and hardness data",osm:"OpenStreetMap - Building footprints and characteristics",rentcast:"RentCast API - Property details, taxes, and market data",attom:"Attom Data - Comprehensive property information"}[e.toLowerCase()]||`${e} - Data enrichment service`})})]},e))]})}),e.sources.includes("none")&&!e.propertyData&&(0,s.jsxs)(R.Alert,{children:[(0,s.jsx)(ec.Info,{className:"h-4 w-4"}),(0,s.jsxs)(R.AlertDescription,{className:"text-sm",children:[(0,s.jsx)("strong",{children:"Tip:"})," Add a RentCast API key for property details (50 free requests/month)"]})]}),e.sources.includes("none")&&e.propertyData&&(0,s.jsxs)(R.Alert,{variant:"default",children:[(0,s.jsx)(ec.Info,{className:"h-4 w-4"}),(0,s.jsxs)(R.AlertDescription,{className:"text-sm",children:[(0,s.jsx)("strong",{children:"Note:"})," Property data not available for this rural location in RentCast database"]})]}),e.sources.some(e=>["google-streetview","google-places","google-timezone"].includes(e))&&(t=[],(m?.available&&t.push("Street View photos"),h?.places?.length&&t.push("supplier details"),u&&t.push("timezone data"),0===t.length)?null:(0,s.jsxs)(R.Alert,{className:"border-success bg-success dark:border-success dark:bg-success",children:[(0,s.jsx)(er.Camera,{className:"text-success dark:text-success h-4 w-4"}),(0,s.jsxs)(R.AlertDescription,{className:"text-sm",children:[(0,s.jsx)("strong",{children:"Google Maps:"})," ",t.join(", ")," ","available (100% FREE - 25k+ requests/month)"]})]}))]})]})}var eC=e.i(871509),ek=e.i(274220),eS=e.i(152088);function e_({properties:e,itemsPerPage:r=10,customerId:i}){let l=(0,k.useRouter)(),n=(0,ek.useArchiveStore)(e=>e.filters.properties),d=e.filter(e=>{let s=!!(e.archived_at||e.deleted_at);return"active"===n?!s:"archived"!==n||s}),[c,o]=(0,S.useState)(null),[m,x]=(0,S.useState)({x:0,y:0}),[u,p]=(0,S.useState)(!1),[j,f]=(0,S.useState)(new Set),g=e=>{x({x:e.clientX,y:e.clientY})},v=()=>{o(null)},y=[{label:"Archive Properties",icon:(0,s.jsx)(t.Archive,{className:"size-4"}),variant:"destructive",onClick:e=>{f(e),p(!0)}},{label:"Move to Another Customer",icon:(0,s.jsx)(ee.UserX,{className:"size-4"}),variant:"ghost",onClick:async e=>{alert(`Move ${e.size} properties to another customer (coming soon)`)}}],b=[{key:"address",header:"Address",width:"flex-1",sortable:!0,render:e=>{let t=function(e){switch(e){case"commercial":return a.Building2;case"industrial":return X.default;default:return Y.Home}}(e.type);return(0,s.jsxs)("div",{className:"flex min-w-0 items-center gap-2",onMouseEnter:s=>{o(e),x({x:s.clientX,y:s.clientY})},onMouseLeave:v,onMouseMove:g,children:[(0,s.jsx)(t,{className:"text-muted-foreground size-4 shrink-0"}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("p",{className:"truncate leading-tight font-medium",children:e.name||e.address}),(0,s.jsxs)("p",{className:"text-muted-foreground truncate text-xs leading-tight",children:[e.city,", ",e.state," ",e.zip_code]})]})]})}},{key:"type",header:"Type",sortable:!0,width:"w-32",shrink:!0,render:e=>{var t;let a;return t=e.type,a={residential:"bg-success text-success dark:bg-success dark:text-success",commercial:"bg-primary text-primary dark:bg-primary dark:text-primary",industrial:"bg-accent text-accent-foreground dark:bg-accent dark:text-accent-foreground"},(0,s.jsx)(U.Badge,{className:(0,eS.cn)("text-xs",a[t||"residential"]||a.residential),children:t?t.charAt(0).toUpperCase()+t.slice(1):"Residential"})}},{key:"size",header:"Size",width:"w-32",shrink:!0,sortable:!0,align:"right",render:e=>{let t=e.square_footage||e.enrichment?.details?.squareFootage,a=e.enrichment?.details?.bedrooms,r=e.enrichment?.details?.bathrooms;return(0,s.jsxs)("div",{className:"text-xs",children:[(0,s.jsx)("p",{className:"font-medium",children:t?t.toLocaleString():"‚Äî"}),a&&r&&(0,s.jsxs)("p",{className:"text-muted-foreground text-xs",children:[a,"bd / ",r,"ba"]}),!t&&e.year_built&&(0,s.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Built ",e.year_built]})]})}},{key:"value",header:"Value",width:"w-36",shrink:!0,sortable:!0,align:"right",hideOnMobile:!0,render:e=>{let t=e.enrichment?.ownership?.marketValue,a=e.enrichment?.taxes?.annualAmount;return(0,s.jsx)("div",{className:"text-xs",children:t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-success dark:text-success font-semibold",children:(0,eC.formatCurrency)(t)}),a&&(0,s.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Tax: ",(0,eC.formatCurrency)(a)]})]}):(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"No data"})})}},{key:"actions",header:"",width:"w-36",shrink:!0,align:"right",render:e=>(0,s.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[e.operationalIntelligence&&(0,s.jsxs)(ea.Sheet,{children:[(0,s.jsx)(ea.SheetTrigger,{asChild:!0,children:(0,s.jsxs)(E.Button,{className:"h-7 gap-1 px-2 text-xs",onClick:e=>e.stopPropagation(),size:"sm",variant:"ghost",children:[(0,s.jsx)(N.Sparkles,{className:"size-3"}),"Intel"]})}),(0,s.jsxs)(ea.SheetContent,{className:"w-full overflow-y-auto sm:max-w-2xl",children:[(0,s.jsxs)(ea.SheetHeader,{children:[(0,s.jsxs)(ea.SheetTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(N.Sparkles,{className:"text-primary size-5"}),"Operational Intelligence"]}),(0,s.jsxs)(ea.SheetDescription,{children:["Live data for ",e.address,", ",e.city]})]}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(ew,{enrichmentData:e.operationalIntelligence})})]})]}),(0,s.jsxs)(C.default,{className:"text-primary inline-flex items-center gap-1 text-xs hover:underline",href:`/dashboard/customers/${e.customer_id}#property-${e.id}`,onClick:e=>e.stopPropagation(),children:["View",(0,s.jsx)(Q.ExternalLink,{className:"size-3"})]})]})}];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(H.FullWidthDataTable,{...W.TablePresets.fullList(),bulkActions:y,columns:b,data:d,emptyAction:(0,s.jsxs)(E.Button,{onClick:()=>window.location.href=`/dashboard/work/properties/new?customerId=${i||e[0]?.customer_id||""}`,size:"sm",children:[(0,s.jsx)(h.Plus,{className:"mr-2 size-4"}),"Add Property"]}),emptyIcon:(0,s.jsx)(a.Building2,{className:"text-muted-foreground h-8 w-8"}),emptyMessage:"No properties found",entity:"properties",getItemId:e=>e.id,isArchived:e=>!!(e.archived_at||e.deleted_at),searchFilter:(e,s)=>{let t=s.toLowerCase();return(e.name?.toLowerCase()||"").includes(t)||e.address.toLowerCase().includes(t)||e.city.toLowerCase().includes(t)||e.state.toLowerCase().includes(t)||e.zip_code.toLowerCase().includes(t)||(e.type?.toLowerCase()||"").includes(t)},searchPlaceholder:"Search properties...",showArchived:"active"!==n,showRefresh:!1}),c&&(0,s.jsxs)("div",{className:"border-primary bg-background pointer-events-none fixed z-50 overflow-hidden rounded-lg border-2 shadow-2xl",style:{left:m.x+20,top:m.y-150,width:"400px",height:"300px"},children:[(0,s.jsx)("iframe",{frameBorder:"0",height:"100%",loading:"lazy",src:`https://www.google.com/maps/embed/v1/place?key=AIzaSyCVKN0pddG230vvjT0EMP9sSIR31j1q2t0&q=${encodeURIComponent(c.address+", "+c.city+", "+c.state+" "+c.zip_code)}&zoom=14`,style:{border:0},title:`Map of ${c.address}`,width:"100%"}),(0,s.jsxs)("div",{className:"bg-background/95 absolute right-0 bottom-0 left-0 border-t p-2 backdrop-blur",children:[(0,s.jsx)("p",{className:"truncate text-xs font-medium",children:c.address}),(0,s.jsxs)("p",{className:"text-muted-foreground truncate text-xs",children:[c.city,", ",c.state]})]})]}),(0,s.jsx)(et.AlertDialog,{onOpenChange:p,open:u,children:(0,s.jsxs)(et.AlertDialogContent,{children:[(0,s.jsxs)(et.AlertDialogHeader,{children:[(0,s.jsxs)(et.AlertDialogTitle,{children:["Archive ",j.size," ",1===j.size?"Property":"Properties","?"]}),(0,s.jsxs)(et.AlertDialogDescription,{children:[j.size," ",1===j.size?"property":"properties"," will be archived and can be restored within 90 days."]})]}),(0,s.jsxs)(et.AlertDialogFooter,{children:[(0,s.jsx)(et.AlertDialogCancel,{children:"Cancel"}),(0,s.jsx)(et.AlertDialogAction,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:async()=>{let e=Array.from(j),s=0;for(let t of e)(await es(t)).success&&s++;s>0&&l.refresh()},children:"Archive"})]})]})})]})}var eA=e.i(821305),eP=e.i(278633),eF=e.i(307033);e.i(670258);var eD=e.i(921251);e.i(51478);var ez=e.i(635613);e.i(149989);var eM=e.i(880177),eI=e.i(220168),eT=e.i(794712);e.i(526120);var eB=e.i(610120);e.i(711448);var e$=e.i(157222),eL=e.i(55029),eR=e.i(933234),eU=e.i(51052),eE=e.i(237833);function eq({customerData:e,metrics:A}){let P=(0,k.useRouter)(),{toast:F}=(0,eU.useToast)(),D=(0,k.usePathname)(),[z,M]=(0,S.useState)(e.customer),[I,T]=(0,S.useState)(!1),[B,$]=(0,S.useState)(!1),L=(0,eE.useToolbarActionsStore)(e=>e.setActions),{customer:R,properties:q=[],jobs:V=[],invoices:H=[],estimates:W=[],appointments:J=[],contracts:Z=[],payments:Q=[],maintenancePlans:X=[],serviceAgreements:Y=[],activities:ee=[],equipment:es=[],attachments:et=[],paymentMethods:ea=[],enrichmentData:er}=e,ei=(0,S.useMemo)(()=>R?.customer_tags?R.customer_tags.map(e=>({id:e.id,name:e.name,slug:e.slug,color:e.color,category:e.category,icon:e.icon})):[],[R?.customer_tags]),el=(0,S.useMemo)(()=>({1:()=>{let e=document.querySelector('[data-section-id="customer-info"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let s=e.querySelector("[data-accordion-trigger]");s&&"closed"===s.getAttribute("data-state")&&s.click()}},2:()=>{let e=document.querySelector('[data-section-id="properties"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let s=e.querySelector("[data-accordion-trigger]");s&&"closed"===s.getAttribute("data-state")&&s.click()}},3:()=>{let e=document.querySelector('[data-section-id="jobs"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let s=e.querySelector("[data-accordion-trigger]");s&&"closed"===s.getAttribute("data-state")&&s.click()}},4:()=>{let e=document.querySelector('[data-section-id="invoices"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let s=e.querySelector("[data-accordion-trigger]");s&&"closed"===s.getAttribute("data-state")&&s.click()}},5:()=>{let e=document.querySelector('[data-section-id="equipment"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let s=e.querySelector("[data-accordion-trigger]");s&&"closed"===s.getAttribute("data-state")&&s.click()}},6:()=>{let e=document.querySelector('[data-section-id="payment-methods"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let s=e.querySelector("[data-accordion-trigger]");s&&"closed"===s.getAttribute("data-state")&&s.click()}},7:()=>{let e=document.querySelector('[data-section-id="estimates"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let s=e.querySelector("[data-accordion-trigger]");s&&"closed"===s.getAttribute("data-state")&&s.click()}},8:()=>{let e=document.querySelector('[data-section-id="appointments"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let s=e.querySelector("[data-accordion-trigger]");s&&"closed"===s.getAttribute("data-state")&&s.click()}},9:()=>{let e=document.querySelector('[data-section-id="contracts"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let s=e.querySelector("[data-accordion-trigger]");s&&"closed"===s.getAttribute("data-state")&&s.click()}}}),[]);(0,eR.useSectionShortcuts)(el);let en=(e,s)=>{M(t=>({...t,[e]:s})),T(!0)},ed=(z?.status||R?.status||"active")?.toLowerCase(),ec=(0,S.useMemo)(()=>{let e=z?.display_name||z?.company_name||R?.display_name||R?.company_name;if(e&&e.trim().length>0)return e.trim();let s=[z?.first_name||R?.first_name,z?.last_name||R?.last_name].filter(Boolean).join(" ").trim();return s.length>0?s:z?.email||R?.email||"Unnamed Customer"},[R,z]),eo=(0,S.useMemo)(()=>{let e=R?.customer_number??R?.account_number??R?.reference_id??R?.external_id;return e?`#${e}`:R?.id?`#${R.id.slice(0,8).toUpperCase()}`:"#CUSTOMER"},[R]),em=z?.email||R?.email||null,ex=z?.phone||z?.mobile_phone||R?.phone||R?.mobile_phone||null,eh=(0,S.useMemo)(()=>q.length>0?q[0]:null,[q]),eu=z?.created_at??R?.created_at??R?.createdAt??null,ej=A?.outstandingBalance??R?.outstanding_balance??R?.outstandingBalance??0,ef=z?.membership_tier??z?.membership??z?.plan??R?.membership_tier??R?.membership??R?.plan??null,eg=z?.portal_enabled??R?.portal_enabled??R?.portalEnabled??!1,eN=async()=>{$(!0);try{F.success("Customer updated successfully"),T(!1)}catch(e){F.error("Failed to update customer")}finally{$(!1)}},ev=()=>{M(R),T(!1)},ey=[(0,s.jsx)(U.Badge,{className:"font-mono",variant:"outline",children:eo},"identifier"),(0,s.jsx)(eT.CustomerStatusBadge,{status:ed||"active"}),ef?(0,s.jsx)(U.Badge,{variant:"secondary",children:ef},"membership"):null,eg?(0,s.jsxs)(U.Badge,{className:"gap-1 text-xs",variant:"outline",children:[(0,s.jsx)(N.Sparkles,{className:"h-3.5 w-3.5"})," Portal Enabled"]},"portal"):null].filter(Boolean),eb=[{key:"new-job",label:"New Job",icon:h.Plus,onClick:()=>P.push(`/dashboard/work/new?customerId=${R.id}`)},{key:"new-invoice",label:"New Invoice",icon:n.FileText,variant:"secondary",onClick:()=>P.push(`/dashboard/work/invoices/new?customerId=${R.id}`)},{key:"schedule-appointment",label:"Schedule Appointment",icon:r.Calendar,variant:"secondary",onClick:()=>P.push(`/dashboard/schedule/new?customerId=${R.id}`)},{key:"add-property",label:"Add Property",icon:a.Building2,variant:"outline",onClick:()=>P.push(`/dashboard/work/properties/new?customerId=${R.id}`)}],ew=()=>eb.map(e=>{let{key:t,label:a,icon:r,onClick:i}=e,l="variant"in e?e.variant:void 0;return(0,s.jsxs)(E.Button,{onClick:i,size:"sm",variant:l??"default",children:[(0,s.jsx)(r,{className:"mr-2 h-4 w-4"}),a]},t)}),ek=(0,S.useCallback)(()=>I?(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsxs)(E.Button,{disabled:B,onClick:eN,size:"sm",children:[(0,s.jsx)(j.Save,{className:"mr-2 h-4 w-4"}),B?"Saving...":"Save Changes"]}),(0,s.jsx)(E.Button,{onClick:ev,size:"sm",variant:"outline",children:"Cancel"})]}):(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[ew(),(0,s.jsx)(ep.Separator,{className:"h-6",orientation:"vertical"}),(0,s.jsxs)(O.DropdownMenu,{children:[(0,s.jsx)(O.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsxs)(E.Button,{className:"h-8 w-8",size:"icon",variant:"outline",children:[(0,s.jsx)(o.MoreVertical,{className:"size-4"}),(0,s.jsx)("span",{className:"sr-only",children:"More actions"})]})}),(0,s.jsxs)(O.DropdownMenuContent,{align:"end",className:"w-56",children:[(0,s.jsx)(O.DropdownMenuLabel,{className:"text-muted-foreground text-xs font-medium tracking-wide uppercase",children:"Actions"}),(0,s.jsx)(O.DropdownMenuSeparator,{}),(0,s.jsxs)(O.DropdownMenuItem,{onClick:()=>P.push(`/dashboard/customers/${R.id}/edit`),children:[(0,s.jsx)(b.UserCog,{className:"mr-2 size-3.5"}),"Edit Full Profile"]}),(0,s.jsx)(O.DropdownMenuSeparator,{}),(0,s.jsxs)(O.DropdownMenuItem,{onClick:()=>{},children:[(0,s.jsx)(l.Download,{className:"mr-2 size-3.5"}),"Export Customer Data"]}),(0,s.jsxs)(O.DropdownMenuItem,{onClick:()=>{},children:[(0,s.jsx)(u.Printer,{className:"mr-2 size-3.5"}),"Print Customer Profile"]}),(0,s.jsxs)(O.DropdownMenuItem,{onClick:()=>{},children:[(0,s.jsx)(f.Share2,{className:"mr-2 size-3.5"}),"Share Customer Link"]}),(0,s.jsx)(O.DropdownMenuSeparator,{}),(0,s.jsxs)(O.DropdownMenuItem,{onClick:()=>{},children:[(0,s.jsx)(y.User,{className:"mr-2 size-3.5"}),"Merge with Another Customer"]}),(0,s.jsx)(O.DropdownMenuSeparator,{}),(0,s.jsxs)(O.DropdownMenuItem,{className:"text-destructive focus:text-destructive",onClick:()=>{},children:[(0,s.jsx)(t.Archive,{className:"mr-2 size-3.5"}),"Archive Customer"]})]})]})]}),[I,B,eN,ev,ew,P,R.id]);(0,S.useEffect)(()=>{D&&L(D,ek())},[D,L,ek]);let eq=[{label:"Outstanding Balance",icon:(0,s.jsx)(i.CreditCard,{className:"h-3.5 w-3.5"}),value:(0,eC.formatCurrencyFromDollars)(ej,{decimals:0}),helperText:"Open invoices"},{label:"Lifetime Revenue",icon:(0,s.jsx)(v.TrendingUp,{className:"h-3.5 w-3.5"}),value:(0,eC.formatCurrencyFromDollars)(A?.totalRevenue??0,{decimals:0})},{label:"Jobs",icon:(0,s.jsx)(w.Wrench,{className:"h-3.5 w-3.5"}),value:A?.totalJobs??V.length,helperText:"All time"},{label:"Properties",icon:(0,s.jsx)(a.Building2,{className:"h-3.5 w-3.5"}),value:A?.totalProperties??q.length}],eV=(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,s.jsx)(r.Calendar,{className:"h-4 w-4"}),eu?`Customer since ${(0,eC.formatDate)(eu,"short")}`:"Customer since ‚Äî"]}),eh?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{"aria-hidden":"true",children:"‚Ä¢"}),(0,s.jsxs)(C.default,{className:"text-muted-foreground hover:text-foreground inline-flex items-center gap-1 transition-colors",href:`/dashboard/work/properties/${eh.id}`,children:[(0,s.jsx)(c.MapPin,{className:"h-4 w-4"}),eh.name||eh.address]})]}):null]}),eO=ec.split(" ").map(e=>e?.[0]).filter(Boolean).join("").slice(0,2).toUpperCase(),eH={title:ec,subtitle:eV,badges:ey,metadata:eq,leadingVisual:(0,s.jsxs)(eD.Avatar,{className:"h-12 w-12",children:[(0,s.jsx)(eD.AvatarImage,{alt:ec,src:R?.avatar_url??void 0}),(0,s.jsx)(eD.AvatarFallback,{children:eO||"CU"})]})},eW=[{key:"primary-email",icon:d.Mail,label:"Primary Email",value:em??"Not provided",href:em?`mailto:${em}`:void 0},{key:"primary-phone",icon:x.Phone,label:"Primary Phone",value:ex??"Not provided",href:ex?`tel:${ex}`:void 0},{key:"portal",icon:N.Sparkles,label:"Portal Access",value:eg?"Enabled":"Disabled"},{key:"membership",icon:g.ShieldCheck,label:"Membership",value:ef??"Standard"}],eG=[{key:"outstanding",icon:n.FileText,label:"Outstanding",value:(0,eC.formatCurrencyFromDollars)(ej,{decimals:0})},{key:"jobs",icon:v.TrendingUp,label:"Total Jobs",value:A?.totalJobs??V.length},{key:"properties",icon:a.Building2,label:"Properties",value:A?.totalProperties??q.length},{key:"lifetime-revenue",icon:p.Receipt,label:"Lifetime Revenue",value:(0,eC.formatCurrencyFromDollars)(A?.totalRevenue??0,{decimals:0})}],eJ=(0,s.jsx)(eP.DetailPageSurface,{padding:"lg",variant:"muted",children:(0,s.jsxs)("div",{className:"flex flex-col gap-4 md:gap-6",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsx)(eM.Label,{className:"text-muted-foreground text-xs font-medium uppercase",children:"Display Name"}),(0,s.jsx)(ez.Input,{className:(0,eS.cn)("border-border/40 bg-background focus-visible:ring-primary/50 h-11 md:h-12 rounded-lg border px-3 md:px-4 text-lg md:text-xl font-semibold shadow-none focus-visible:ring-2 sm:text-2xl"),onChange:e=>(e=>{if(z?.company_name||R?.company_name)return void en("company_name",e);if(z?.display_name||R?.display_name)return void en("display_name",e);let s=e.trim();if(!s){en("first_name",""),en("last_name","");return}let t=s.split(/\s+/);1===t.length?(en("first_name",t[0]),en("last_name","")):(en("first_name",t.slice(0,-1).join(" ")),en("last_name",t.at(-1)))})(e.target.value),placeholder:"Enter customer name...",value:ec}),(0,s.jsx)("p",{className:"text-muted-foreground text-[0.7rem] md:text-xs",children:"Update how this customer appears across Thorbis. Changes are saved when you select Save changes."})]}),(0,s.jsx)("div",{className:"grid gap-2 md:gap-3 grid-cols-1 sm:grid-cols-2",children:eW.map(({key:e,icon:t,label:a,value:r,href:i})=>(0,s.jsx)("div",{className:"border-border/40 bg-background rounded-lg border px-3 py-2.5 md:py-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-2 md:gap-3",children:[(0,s.jsx)(t,{className:"text-muted-foreground h-3.5 w-3.5 md:h-4 md:w-4 shrink-0"}),(0,s.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,s.jsx)("span",{className:"text-muted-foreground text-[0.65rem] md:text-xs font-medium uppercase",children:a}),i?(0,s.jsx)("a",{className:"text-xs md:text-sm font-semibold hover:underline truncate",href:i,children:r}):(0,s.jsx)("span",{className:"text-xs md:text-sm font-semibold truncate",children:r})]})]})},e))}),(0,s.jsx)("div",{className:"grid gap-2 md:gap-3 grid-cols-2 lg:grid-cols-4",children:eG.map(({key:e,icon:t,label:a,value:r})=>(0,s.jsx)("div",{className:"border-border/40 bg-background rounded-lg border px-3 py-2.5 md:py-3",children:(0,s.jsxs)("div",{className:"flex flex-col gap-1.5 md:gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(t,{className:"text-muted-foreground h-3.5 w-3.5 md:h-4 md:w-4 shrink-0"}),(0,s.jsx)("span",{className:"text-muted-foreground text-[0.65rem] md:text-xs font-medium uppercase leading-none",children:a})]}),(0,s.jsx)("span",{className:"text-sm md:text-base font-semibold truncate",children:r})]})},e))})]})}),eZ=(0,S.useMemo)(()=>[{id:"customer-info",title:"Customer Information",icon:(0,s.jsx)(y.User,{className:"size-4"}),defaultOpen:!0,content:(0,s.jsx)(e$.UnifiedAccordionContent,{children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(eI.StandardFormRow,{cols:2,children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(eI.StandardFormField,{label:"First Name",htmlFor:"first_name",children:(0,s.jsx)(ez.Input,{id:"first_name",onChange:e=>en("first_name",e.target.value),value:z.first_name||""})}),(0,s.jsx)(eI.StandardFormField,{label:"Last Name",htmlFor:"last_name",children:(0,s.jsx)(ez.Input,{id:"last_name",onChange:e=>en("last_name",e.target.value),value:z.last_name||""})}),(0,s.jsx)(eI.StandardFormField,{label:"Company Name",htmlFor:"company_name",children:(0,s.jsx)(ez.Input,{id:"company_name",onChange:e=>en("company_name",e.target.value),value:z.company_name||""})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(eI.StandardFormField,{label:"Email",htmlFor:"email",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(ez.Input,{id:"email",onChange:e=>en("email",e.target.value),type:"email",value:z.email||""}),R.email&&(0,s.jsx)(E.Button,{asChild:!0,size:"icon",variant:"outline",children:(0,s.jsx)("a",{href:`mailto:${R.email}`,children:(0,s.jsx)(d.Mail,{className:"size-4"})})})]})}),(0,s.jsx)(eI.StandardFormField,{label:"Phone",htmlFor:"phone",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(ez.Input,{id:"phone",onChange:e=>en("phone",e.target.value),type:"tel",value:z.phone||""}),R.phone&&(0,s.jsx)(E.Button,{asChild:!0,size:"icon",variant:"outline",children:(0,s.jsx)("a",{href:`tel:${R.phone}`,children:(0,s.jsx)(x.Phone,{className:"size-4"})})})]})}),(0,s.jsx)(eI.StandardFormField,{label:"Mobile Phone",htmlFor:"mobile_phone",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(ez.Input,{id:"mobile_phone",onChange:e=>en("mobile_phone",e.target.value),type:"tel",value:z.mobile_phone||""}),R.mobile_phone&&(0,s.jsx)(E.Button,{asChild:!0,size:"icon",variant:"outline",children:(0,s.jsx)("a",{href:`tel:${R.mobile_phone}`,children:(0,s.jsx)(x.Phone,{className:"size-4"})})})]})})]})]}),(0,s.jsxs)(eI.StandardFormRow,{cols:2,children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(eI.StandardFormField,{label:"Address",htmlFor:"address",children:(0,s.jsx)(eB.Textarea,{id:"address",onChange:e=>en("address",e.target.value),rows:3,value:z.address||""})}),(0,s.jsxs)(eI.StandardFormRow,{cols:2,children:[(0,s.jsx)(eI.StandardFormField,{label:"City",htmlFor:"city",children:(0,s.jsx)(ez.Input,{id:"city",onChange:e=>en("city",e.target.value),value:z.city||""})}),(0,s.jsx)(eI.StandardFormField,{label:"State",htmlFor:"state",children:(0,s.jsx)(ez.Input,{id:"state",onChange:e=>en("state",e.target.value),value:z.state||""})}),(0,s.jsx)(eI.StandardFormField,{label:"Postal Code",htmlFor:"postal_code",children:(0,s.jsx)(ez.Input,{id:"postal_code",onChange:e=>en("postal_code",e.target.value),value:z.postal_code||""})}),(0,s.jsx)(eI.StandardFormField,{label:"Country",htmlFor:"country",children:(0,s.jsx)(ez.Input,{id:"country",onChange:e=>en("country",e.target.value),value:z.country||""})})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(eI.StandardFormField,{label:"Tags",htmlFor:"tags",description:"Comma separated tags",children:(0,s.jsx)(ez.Input,{id:"tags",onChange:e=>en("tags",e.target.value.split(",").map(e=>e.trim())),placeholder:"Comma separated tags",value:(z.tags||[]).join(", ")})}),(0,s.jsx)(eI.StandardFormField,{label:"Notes",htmlFor:"notes",description:"Internal notes about this customer",children:(0,s.jsx)(eB.Textarea,{id:"notes",onChange:e=>en("notes",e.target.value),placeholder:"Internal notes about this customer",rows:4,value:z.notes||""})})]})]})]})})},{id:"properties",title:"Properties",icon:(0,s.jsx)(a.Building2,{className:"size-4"}),count:q.length,actions:(0,s.jsxs)(E.Button,{onClick:()=>P.push(`/dashboard/work/properties/new?customerId=${R.id}`),size:"sm",variant:"outline",children:[(0,s.jsx)(h.Plus,{className:"mr-2 h-4 w-4"})," Add Property"]}),content:(0,s.jsxs)(e$.UnifiedAccordionContent,{className:"p-0",children:[(0,s.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Manage service locations for this customer."}),(0,s.jsx)(e_,{customerId:R.id,itemsPerPage:10,properties:q})]})},{id:"jobs",title:"Jobs",icon:(0,s.jsx)(w.Wrench,{className:"size-4"}),count:V.length,actions:(0,s.jsxs)(E.Button,{onClick:()=>P.push(`/dashboard/work/new?customerId=${R.id}`),size:"sm",variant:"outline",children:[(0,s.jsx)(h.Plus,{className:"mr-2 h-4 w-4"})," New Job"]}),content:(0,s.jsxs)(e$.UnifiedAccordionContent,{className:"p-0",children:[(0,s.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Recent jobs associated with this customer."}),(0,s.jsx)(eL.JobsTable,{itemsPerPage:10,jobs:V})]})},{id:"invoices",title:"Invoices",icon:(0,s.jsx)(p.Receipt,{className:"size-4"}),actions:(0,s.jsxs)(E.Button,{onClick:()=>P.push(`/dashboard/work/invoices/new?customerId=${R.id}`),size:"sm",variant:"outline",children:[(0,s.jsx)(h.Plus,{className:"mr-2 h-4 w-4"})," New Invoice"]}),content:(0,s.jsxs)(e$.UnifiedAccordionContent,{className:"p-0",children:[(0,s.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Billing history and outstanding invoices."}),(0,s.jsx)(G,{invoices:H||[],onUpdate:()=>{}})]})},{id:"equipment",title:"Equipment",icon:(0,s.jsx)(m.Package,{className:"size-4"}),actions:(0,s.jsxs)(E.Button,{onClick:()=>{},size:"sm",variant:"outline",children:[(0,s.jsx)(h.Plus,{className:"mr-2 h-4 w-4"})," Add Equipment"]}),content:(0,s.jsx)(e$.UnifiedAccordionContent,{children:es.length>0?(0,s.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:es.map(e=>(0,s.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"bg-primary/10 rounded-md p-2",children:(0,s.jsx)(w.Wrench,{className:"text-primary h-4 w-4"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:e.name}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:e.type||e.category||"Equipment"})]})]}),(0,s.jsxs)("div",{className:"mt-3 space-y-1 text-sm",children:[e.serial_number&&(0,s.jsxs)("p",{className:"text-muted-foreground",children:["Serial: ",e.serial_number]}),e.manufacturer&&(0,s.jsxs)("p",{className:"text-muted-foreground flex items-center gap-2",children:[(0,s.jsx)(a.Building2,{className:"h-4 w-4"}),e.manufacturer]}),e.install_date&&(0,s.jsxs)("p",{className:"text-muted-foreground flex items-center gap-2",children:[(0,s.jsx)(r.Calendar,{className:"h-4 w-4"}),"Installed ",(0,eC.formatDate)(e.install_date,"short")]})]})]},e.id))}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center rounded-lg border border-dashed p-6 text-center",children:[(0,s.jsx)(m.Package,{className:"text-muted-foreground h-6 w-6"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No equipment on record for this customer yet."})]})})},{id:"payment-methods",title:"Payment Methods",icon:(0,s.jsx)(i.CreditCard,{className:"size-4"}),count:ea.length,actions:(0,s.jsxs)(E.Button,{onClick:()=>{},size:"sm",variant:"outline",children:[(0,s.jsx)(h.Plus,{className:"mr-2 h-4 w-4"})," Add Payment Method"]}),content:(0,s.jsx)(e$.UnifiedAccordionContent,{children:ea.length>0?(0,s.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:ea.map(e=>{let t="ach"===e.type||"bank"===e.type?e.type:"card";return(0,s.jsx)(K,{account_type:e.account_type,bank_name:e.bank_name,card_brand:e.brand||e.card_brand,card_exp_month:e.exp_month||e.card_exp_month,card_exp_year:e.exp_year||e.card_exp_year,card_last4:e.last4||e.card_last_four||e.card_last4,cardholder_name:e.cardholder_name||e.name,id:e.id,is_default:e.is_default,is_verified:e.is_verified,nickname:e.nickname,onRemove:()=>{},onSetDefault:()=>{},type:t},e.id)})}):(0,s.jsxs)("div",{className:"bg-muted/30 flex flex-col items-center justify-center rounded-lg border border-dashed py-12 text-center",children:[(0,s.jsx)(i.CreditCard,{className:"text-muted-foreground/50 mb-3 size-12"}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm font-medium",children:"No payment methods on file"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1 text-xs",children:"Add a card or bank account for quick invoicing"})]})})},{id:"estimates",title:"Estimates",icon:(0,s.jsx)(n.FileText,{className:"size-4"}),count:W.length,actions:(0,s.jsxs)(E.Button,{onClick:()=>P.push(`/dashboard/work/estimates/new?customerId=${R.id}`),size:"sm",variant:"outline",children:[(0,s.jsx)(h.Plus,{className:"mr-2 h-4 w-4"})," New Estimate"]}),content:(0,s.jsxs)(e$.UnifiedAccordionContent,{className:"p-0",children:[(0,s.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Estimates and quotes provided to this customer."}),W.length>0?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-muted/50 border-b",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Estimate #"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Date"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Total"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:W.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-muted/30 border-b",children:[(0,s.jsxs)("td",{className:"px-6 py-4 text-sm",children:["#",e.estimate_number||e.id.slice(0,8)]}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,eC.formatDate)(e.created_at,"short")}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm font-medium",children:(0,eC.formatCurrencyFromDollars)(e.total_amount/100)}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,s.jsx)(U.Badge,{variant:"outline",children:e.status||"draft"})}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,s.jsx)(C.default,{className:"text-primary hover:underline",href:`/dashboard/work/estimates/${e.id}`,children:"View"})})]},e.id))})]})}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[(0,s.jsx)(n.FileText,{className:"text-muted-foreground h-8 w-8"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No estimates for this customer yet."})]})]})},{id:"appointments",title:"Appointments",icon:(0,s.jsx)(r.Calendar,{className:"size-4"}),count:J.length,actions:(0,s.jsxs)(E.Button,{onClick:()=>P.push(`/dashboard/schedule?customerId=${R.id}`),size:"sm",variant:"outline",children:[(0,s.jsx)(h.Plus,{className:"mr-2 h-4 w-4"})," Schedule Appointment"]}),content:(0,s.jsxs)(e$.UnifiedAccordionContent,{className:"p-0",children:[(0,s.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Scheduled appointments and service visits for this customer."}),J.length>0?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-muted/50 border-b",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Date & Time"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Type"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Property"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Job"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:J.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-muted/30 border-b",children:[(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:new Date(e.scheduled_start).toLocaleString()}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:e.type||"Service"}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:e.property?.name||e.property?.address||"-"}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:e.job?.job_number?`#${e.job.job_number}`:"-"}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,s.jsx)(U.Badge,{variant:"outline",children:e.status||"scheduled"})}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,s.jsx)(C.default,{className:"text-primary hover:underline",href:`/dashboard/appointments/${e.id}`,children:"View"})})]},e.id))})]})}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[(0,s.jsx)(r.Calendar,{className:"text-muted-foreground h-8 w-8"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No appointments scheduled for this customer."})]})]})},{id:"contracts",title:"Contracts",icon:(0,s.jsx)(n.FileText,{className:"size-4"}),count:Z.length,content:(0,s.jsxs)(e$.UnifiedAccordionContent,{className:"p-0",children:[(0,s.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Service contracts and agreements signed by this customer."}),Z.length>0?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-muted/50 border-b",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Contract #"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Date"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Related To"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:Z.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-muted/30 border-b",children:[(0,s.jsxs)("td",{className:"px-6 py-4 text-sm",children:["#",e.contract_number||e.id.slice(0,8)]}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,eC.formatDate)(e.created_at,"short")}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:e.job?`Job #${e.job.job_number}`:e.estimate?`Est #${e.estimate.estimate_number}`:e.invoice?`Inv #${e.invoice.invoice_number}`:"-"}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,s.jsx)(U.Badge,{variant:"outline",children:e.status||"draft"})}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,s.jsx)(C.default,{className:"text-primary hover:underline",href:`/dashboard/work/contracts/${e.id}`,children:"View"})})]},e.id))})]})}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[(0,s.jsx)(n.FileText,{className:"text-muted-foreground h-8 w-8"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No contracts for this customer."})]})]})},{id:"payments",title:"Payments",icon:(0,s.jsx)(i.CreditCard,{className:"size-4"}),count:Q.length,content:(0,s.jsxs)(e$.UnifiedAccordionContent,{className:"p-0",children:[(0,s.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Payment history and transactions from this customer."}),Q.length>0?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-muted/50 border-b",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Payment #"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Date"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Amount"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Method"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Invoice"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:Q.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-muted/30 border-b",children:[(0,s.jsxs)("td",{className:"px-6 py-4 text-sm",children:["#",e.payment_number||e.id.slice(0,8)]}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,eC.formatDate)(e.created_at,"short")}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm font-medium",children:(0,eC.formatCurrencyFromDollars)(e.amount/100)}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm capitalize",children:e.payment_method?.replace("_"," ")||"-"}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:e.invoice?`#${e.invoice.invoice_number}`:"-"}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,s.jsx)(U.Badge,{variant:"completed"===e.status?"default":"outline",children:e.status})}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,s.jsx)(C.default,{className:"text-primary hover:underline",href:`/dashboard/work/payments/${e.id}`,children:"View"})})]},e.id))})]})}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[(0,s.jsx)(i.CreditCard,{className:"text-muted-foreground h-8 w-8"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No payment history for this customer."})]})]})},{id:"maintenance-plans",title:"Maintenance Plans",icon:(0,s.jsx)(g.ShieldCheck,{className:"size-4"}),count:X.length,content:(0,s.jsxs)(e$.UnifiedAccordionContent,{className:"p-0",children:[(0,s.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Recurring maintenance plans for this customer's equipment."}),X.length>0?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-muted/50 border-b",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Plan Name"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Property"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Frequency"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:X.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-muted/30 border-b",children:[(0,s.jsx)("td",{className:"px-6 py-4 text-sm font-medium",children:e.name||`Plan ${e.id.slice(0,8)}`}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:e.property?.name||e.property?.address||"-"}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm capitalize",children:e.frequency||"Monthly"}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,s.jsx)(U.Badge,{variant:"outline",children:e.status||"active"})}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,s.jsx)(C.default,{className:"text-primary hover:underline",href:`/dashboard/work/maintenance-plans/${e.id}`,children:"View"})})]},e.id))})]})}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[(0,s.jsx)(g.ShieldCheck,{className:"text-muted-foreground h-8 w-8"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No maintenance plans for this customer."})]})]})},{id:"service-agreements",title:"Service Agreements",icon:(0,s.jsx)(n.FileText,{className:"size-4"}),count:Y.length,content:(0,s.jsxs)(e$.UnifiedAccordionContent,{className:"p-0",children:[(0,s.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Long-term service agreements and ongoing contracts."}),Y.length>0?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-muted/50 border-b",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Agreement #"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Property"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Start Date"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"End Date"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:Y.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-muted/30 border-b",children:[(0,s.jsxs)("td",{className:"px-6 py-4 text-sm",children:["#",e.id.slice(0,8)]}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:e.property?.name||e.property?.address||"-"}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:e.start_date?(0,eC.formatDate)(e.start_date,"short"):"-"}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:e.end_date?(0,eC.formatDate)(e.end_date,"short"):"-"}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,s.jsx)(U.Badge,{variant:"outline",children:e.status||"active"})}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,s.jsx)(C.default,{className:"text-primary hover:underline",href:`/dashboard/work/service-agreements/${e.id}`,children:"View"})})]},e.id))})]})}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[(0,s.jsx)(n.FileText,{className:"text-muted-foreground h-8 w-8"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No service agreements for this customer."})]})]})}],[R.id,R.email,R.mobile_phone,R.phone,es,W,J,Z,Q,X,Y,en,V,z,ea,q,P,H]),eK=(0,S.useMemo)(()=>{let e=[];if(eh&&e.push({id:`property-${eh.id}`,type:"property",title:eh.name||eh.address,subtitle:`${eh.city||""}, ${eh.state||""}`,href:`/dashboard/work/properties/${eh.id}`}),V.length>0){let s=V[0];e.push({id:`job-${s.id}`,type:"job",title:s.title||`Job #${s.job_number}`,subtitle:s.status,href:`/dashboard/work/${s.id}`,badge:s.status?{label:s.status,variant:"outline"}:void 0})}return e},[V,eh]),eQ=(0,s.jsx)("div",{className:"w-full px-2 sm:px-0",children:(0,s.jsx)("div",{className:"bg-muted/50 mx-auto max-w-7xl rounded-md shadow-sm",children:(0,s.jsxs)("div",{className:"flex flex-col gap-3 p-4 sm:p-6",children:[(0,s.jsx)("span",{className:"text-muted-foreground text-xs font-medium",children:"Tags:"}),(0,s.jsx)(eF.EntityTags,{entityId:R.id,entityType:"customer",onUpdateTags:async(e,s)=>{(await (0,_.updateEntityTags)("customer",e,s)).success&&P.refresh()},tags:ei})]})})});return(0,s.jsx)(eA.DetailPageContentLayout,{activities:ee,attachments:et,beforeContent:eJ,customHeader:eQ,customSections:eZ,defaultOpenSection:"customer-info",enableReordering:!0,header:eH,notes:[],relatedItems:eK,showStandardSections:{notes:!1},storageKey:"customer-details"})}e.s(["CustomerPageContent",()=>eq],661803)}]);