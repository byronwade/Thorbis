(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,698684,e=>{"use strict";let t=(0,e.i(383206).default)("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);e.s(["default",()=>t])},407205,e=>{"use strict";var t=e.i(698684);e.s(["ArrowUp",()=>t.default])},519131,e=>{"use strict";let t=(0,e.i(383206).default)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);e.s(["default",()=>t])},233654,e=>{"use strict";var t=e.i(519131);e.s(["Paperclip",()=>t.default])},281595,e=>{"use strict";let t=(0,e.i(383206).default)("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);e.s(["default",()=>t])},133279,e=>{"use strict";var t=e.i(281595);e.s(["Camera",()=>t.default])},873382,e=>{"use strict";let t=(0,e.i(383206).default)("smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);e.s(["default",()=>t])},524672,e=>{"use strict";var t=e.i(873382);e.s(["Smile",()=>t.default])},231476,e=>{"use strict";var t=e.i(819260);e.s(["PanelLeft",()=>t.default])},665123,e=>{"use strict";var t=e.i(905501);e.s(["ImageIcon",()=>t.default])},666108,e=>{"use strict";let t=(0,e.i(383206).default)("message-square-text",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}],["path",{d:"M7 11h10",key:"1twpyw"}],["path",{d:"M7 15h6",key:"d9of3u"}],["path",{d:"M7 7h8",key:"af5zfr"}]]);e.s(["default",()=>t])},608423,e=>{"use strict";var t=e.i(111043);e.i(889265);var a=e.i(677607);e.i(244242);var s=e.i(563078);e.i(220474);var r=e.i(171056);e.i(254978);var n=e.i(375308),i=e.i(152088),l=e.i(407205),o=e.i(133279),c=e.i(606661),d=e.i(665123),m=e.i(641304),u=e.i(666108),u=u,p=e.i(371526),h=e.i(524672),g=e.i(212409),x=e.i(970799);let f=[{id:"appointment-reminder",label:"Appointment Reminder",preview:"Reminder about upcoming appointment",build:e=>{let t=e.customerFirstName||"there",a=e.appointmentDate&&e.appointmentTime?`on ${e.appointmentDate} at ${e.appointmentTime}`:e.appointmentDate?`on ${e.appointmentDate}`:"for your upcoming appointment";return`Hi ${t}, this is a reminder about your appointment ${a}. Reply CONFIRM to confirm or call us to reschedule.`}},{id:"on-the-way",label:"On The Way",preview:"Technician en route notification",build:e=>{let t=e.customerFirstName||"there",a=e.technicianName||"Our technician";return`Hi ${t}, ${a} is on the way and should arrive shortly.`}},{id:"running-late",label:"Running Late",preview:"Apology for delay",build:e=>{let t=e.customerFirstName||"there";return`Hi ${t}, we apologize but our technician is running a bit behind schedule. We'll update you when they're on the way.`}},{id:"job-complete",label:"Job Complete",preview:"Work completed notification",build:e=>{let t=e.customerFirstName||"there",a=e.companyName?`choosing ${e.companyName}`:"your business";return`Hi ${t}, the work has been completed. If you have any questions, please don't hesitate to reach out. Thank you for ${a}!`}},{id:"payment-reminder",label:"Payment Reminder",preview:"Friendly payment reminder",build:e=>{let t=e.customerFirstName||"there",a=e.invoiceNumber&&e.amount?`invoice #${e.invoiceNumber} for $${e.amount}`:e.invoiceNumber?`invoice #${e.invoiceNumber}`:"your outstanding invoice";return`Hi ${t}, this is a friendly reminder that ${a} is due. Please let us know if you have any questions.`}},{id:"follow-up",label:"Follow Up",preview:"Service follow-up request",build:e=>{let t=e.customerFirstName||"there";return`Hi ${t}, just following up on our recent service. Is everything working well? We'd love to hear your feedback!`}},{id:"thank-you",label:"Thank You",preview:"Thank you message",build:e=>{let t=e.companyName?`choosing ${e.companyName}`:"your business";return`Thank you for ${t}! We appreciate your trust in us. If you have a moment, we'd love a review!`}},{id:"reschedule",label:"Reschedule Request",preview:"Reschedule appointment request",build:e=>{let t=e.customerFirstName||"there",a=e.companyPhone?`, or call us at ${e.companyPhone}`:"";return`Hi ${t}, we need to reschedule your appointment. Please reply with a date and time that works for you${a}.`}}],b=[{name:"Frequently Used",emojis:["ğŸ˜€","ğŸ˜‚","ğŸ˜","ğŸ¥°","ğŸ˜˜","ğŸ˜Š","ğŸ˜‰","ğŸ˜","ğŸ¤”","ğŸ˜","ğŸ˜’","ğŸ™„","ğŸ˜®","ğŸ¤—","ğŸ˜´","ğŸ˜‹","ğŸ˜","ğŸ¤¤","ğŸ˜ª","ğŸ˜µ"]},{name:"Smileys & People",emojis:["ğŸ˜€","ğŸ˜ƒ","ğŸ˜„","ğŸ˜","ğŸ˜†","ğŸ˜…","ğŸ¤£","ğŸ˜‚","ğŸ™‚","ğŸ™ƒ","ğŸ˜‰","ğŸ˜Š","ğŸ˜‡","ğŸ¥°","ğŸ˜","ğŸ¤©","ğŸ˜˜","ğŸ˜—","ğŸ˜š","ğŸ˜™","ğŸ˜‹","ğŸ˜›","ğŸ˜œ","ğŸ¤ª","ğŸ˜","ğŸ¤‘","ğŸ¤—","ğŸ¤­","ğŸ¤«","ğŸ¤”"]},{name:"Gestures",emojis:["ğŸ‘‹","ğŸ¤š","ğŸ–","âœ‹","ğŸ––","ğŸ‘Œ","ğŸ¤Œ","ğŸ¤","âœŒï¸","ğŸ¤","ğŸ¤Ÿ","ğŸ¤˜","ğŸ¤™","ğŸ‘ˆ","ğŸ‘‰","ğŸ‘†","ğŸ–•","ğŸ‘‡","â˜ï¸","ğŸ‘"]},{name:"Objects",emojis:["ğŸ“±","ğŸ’»","âŒš","ğŸ–¥","âŒ¨ï¸","ğŸ–±","ğŸ–²","ğŸ•¹","ğŸ—œ","ğŸ’¾","ğŸ’¿","ğŸ“€","ğŸ“·","ğŸ“¸","ğŸ“¹","ğŸ¥","ğŸ“½","ğŸ","ğŸ“","â˜ï¸"]},{name:"Symbols",emojis:["â¤ï¸","ğŸ§¡","ğŸ’›","ğŸ’š","ğŸ’™","ğŸ’œ","ğŸ–¤","ğŸ¤","ğŸ¤","ğŸ’”","â£ï¸","ğŸ’•","ğŸ’","ğŸ’“","ğŸ’—","ğŸ’–","ğŸ’˜","ğŸ’","ğŸ’Ÿ","â˜®ï¸"]}];function y({value:e,onChange:y,onSend:v,onAttach:j,sending:N=!1,disabled:w=!1,placeholder:k="Text Message",showSegmentCounter:C=!0,customerName:S,customerFirstName:R,customerId:A,jobType:T,companyName:z,companyPhone:$,technicianName:M,appointmentDate:D,appointmentTime:_,invoiceNumber:F,amount:P,enableAiSuggestions:U=!1}){let[I,E]=(0,x.useState)([]),[L,O]=(0,x.useState)(!1),[q,H]=(0,x.useState)(!1),[B,W]=(0,x.useState)(""),[K,J]=(0,x.useState)(!1),V=(0,x.useRef)(null),X=(0,x.useRef)(null),G=(0,x.useRef)(null),Q=(0,x.useRef)(null),Y=function(e){if(!e)return{segments:0,charsPerSegment:160,isUnicode:!1};let t=!/^[@Â£$Â¥Ã¨Ã©Ã¹Ã¬Ã²Ã‡\nÃ˜Ã¸\rÃ…Ã¥Î”_Î¦Î“Î›Î©Î Î¨Î£Î˜Î\x1B !"#Â¤%&'()*+,\-./0-9:;<=>?Â¡A-ZÃ„Ã–Ã‘Ü§Â¿a-zÃ¤Ã¶Ã±Ã¼Ã ]*$/.test(e),a=t?70:160,s=t?67:153;return e.length<=a?{segments:1,charsPerSegment:a,isUnicode:t}:{segments:Math.ceil(e.length/s),charsPerSegment:s,isUnicode:t}}(e),Z=C&&e.length>0&&(q||e.length>100),ee=(0,x.useCallback)(async e=>{if(!U||e.length<3)return void W("");J(!0);try{let t=await fetch("/api/ai/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"system",content:`You are an SMS autocomplete assistant for a field service company. Complete the user's SMS message naturally and professionally.
Context: ${S?`Customer: ${S}`:""} ${T?`Job type: ${T}`:""} ${z?`Company: ${z}`:""}
IMPORTANT: Only return the completion text (what comes AFTER what the user typed). Keep it short (under 100 chars). No quotes or explanations.`},{role:"user",content:`Complete this SMS message: "${e}"`}],model:"claude-3-5-haiku-20241022",maxTokens:100})});if(t.ok){let e=await t.json(),a=e.content||e.message||"";a&&a.length>0&&a.length<150?W(a.trim()):W("")}}catch(e){console.error("AI suggestion error:",e),W("")}finally{J(!1)}},[U,S,T,z]);(0,x.useEffect)(()=>{if(Q.current&&clearTimeout(Q.current),W(""),U&&!(e.length<5)&&q)return Q.current=setTimeout(()=>{ee(e)},500),()=>{Q.current&&clearTimeout(Q.current)}},[e,U,q,ee]),(0,x.useEffect)(()=>{V.current&&V.current.textContent!==e&&(V.current.textContent=e)},[e]);let et=(0,x.useCallback)(t=>{let a=t+" ",s=V.current;if(s){let t=window.getSelection();if(t&&t.rangeCount>0){let r=t.getRangeAt(0);if(s.contains(r.commonAncestorContainer)){r.deleteContents();let e=document.createTextNode(a);r.insertNode(e);let n=document.createRange();n.setStartAfter(e),n.setEndAfter(e),t.removeAllRanges(),t.addRange(n),y(s.textContent||"")}else y(e+a),requestAnimationFrame(()=>{if(s){s.focus();let e=document.createRange();e.selectNodeContents(s),e.collapse(!1);let t=window.getSelection();t?.removeAllRanges(),t?.addRange(e)}})}else y(e+a),requestAnimationFrame(()=>{if(s){s.focus();let e=document.createRange();e.selectNodeContents(s),e.collapse(!1);let t=window.getSelection();t?.removeAllRanges(),t?.addRange(e)}});s.focus()}else y(e+a);O(!1)},[e,y]),ea=(0,x.useCallback)(e=>{if(!e||0===e.length)return;let t=Array.from(e).map(e=>{let t={id:`${Date.now()}-${Math.random()}`,file:e,type:e.type.startsWith("image/")?"image":"file"};return"image"===t.type&&(t.preview=URL.createObjectURL(e)),t});E(e=>[...e,...t]),j&&j(Array.from(e))},[j]),es=(0,x.useCallback)(e=>{E(t=>{let a=t.find(t=>t.id===e);return a?.preview&&URL.revokeObjectURL(a.preview),t.filter(t=>t.id!==e)})},[]),er=(0,x.useCallback)(()=>{!e.trim()&&0===I.length||N||w||(v(),I.forEach(e=>{e.preview&&URL.revokeObjectURL(e.preview)}),E([]))},[e,I,N,w,v]),en=(0,x.useCallback)(t=>{if("Tab"===t.key&&B){t.preventDefault(),y(e+B),W(""),V.current&&(V.current.textContent=e+B,requestAnimationFrame(()=>{if(V.current){V.current.focus();let e=document.createRange();e.selectNodeContents(V.current),e.collapse(!1);let t=window.getSelection();t?.removeAllRanges(),t?.addRange(e)}}));return}if("Escape"===t.key&&B){t.preventDefault(),W("");return}"Enter"!==t.key||t.shiftKey||(t.preventDefault(),er()),"Enter"===t.key&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),er())},[er,B,e,y]),ei=(0,x.useCallback)(e=>{e.preventDefault();let t=e.clipboardData.getData("text/plain"),a=window.getSelection();if(a&&a.rangeCount>0){let e=a.getRangeAt(0);e.deleteContents();let s=document.createTextNode(t);e.insertNode(s);let r=document.createRange();r.setStartAfter(s),r.setEndAfter(s),a.removeAllRanges(),a.addRange(r),y(V.current?.textContent||"")}},[y]),el=(0,x.useCallback)((t,a=!1)=>{let s=V.current;if(!s)return void y(a?t:e+t);if(a)y(t),s.textContent=t,requestAnimationFrame(()=>{s.focus();let e=document.createRange();e.selectNodeContents(s),e.collapse(!1);let t=window.getSelection();t?.removeAllRanges(),t?.addRange(e)});else{let a=window.getSelection();if(a&&a.rangeCount>0){let r=a.getRangeAt(0);if(s.contains(r.commonAncestorContainer)){r.deleteContents();let e=document.createTextNode(t);r.insertNode(e);let n=document.createRange();n.setStartAfter(e),n.setEndAfter(e),a.removeAllRanges(),a.addRange(n),y(s.textContent||"")}else y(e+t)}else y(e+t);s.focus()}},[e,y]),eo=(0,x.useCallback)(e=>{let t={customerFirstName:R||S?.split(" ")[0],customerName:S,companyName:z,companyPhone:$,technicianName:M,appointmentDate:D,appointmentTime:_,invoiceNumber:F,amount:P};el(e.build(t),!0)},[el,R,S,z,$,M,D,_,F,P]);return(0,t.jsxs)("div",{className:"bg-card border-t border-border/50",children:[Z&&(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2 px-3 pt-2 pb-1",children:[(0,t.jsxs)("span",{className:"text-[10px] text-muted-foreground",children:[e.length," chars"]}),(0,t.jsx)("span",{className:"text-[10px] text-muted-foreground",children:"Â·"}),(0,t.jsxs)("span",{className:(0,i.cn)("text-[10px] font-medium",Y.segments>1?"text-amber-500":"text-muted-foreground"),children:[Y.segments," segment",1!==Y.segments?"s":""]}),Y.isUnicode&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-[10px] text-muted-foreground",children:"Â·"}),(0,t.jsx)("span",{className:"text-[10px] text-amber-500",children:"Unicode"})]})]}),I.length>0&&(0,t.jsx)("div",{className:"px-3 pt-2",children:(0,t.jsx)(n.ScrollArea,{className:"w-full",children:(0,t.jsx)("div",{className:"flex gap-2",children:I.map(e=>(0,t.jsx)("div",{className:"group relative shrink-0",children:"image"===e.type&&e.preview?(0,t.jsxs)("div",{className:"relative size-16 overflow-hidden rounded-xl border border-border",children:[(0,t.jsx)("img",{src:e.preview,alt:e.file.name,className:"size-full object-cover"}),(0,t.jsx)(a.Button,{variant:"ghost",size:"sm",className:"absolute right-0.5 top-0.5 size-5 rounded-full bg-black/60 p-0 opacity-0 transition-opacity hover:bg-black/80 group-hover:opacity-100",onClick:()=>es(e.id),children:(0,t.jsx)(g.X,{className:"size-3 text-white"})})]}):(0,t.jsxs)("div",{className:"relative flex size-16 items-center justify-center rounded-xl border border-border bg-muted",children:[(0,t.jsx)(c.FileText,{className:"size-5 text-muted-foreground"}),(0,t.jsx)(a.Button,{variant:"ghost",size:"sm",className:"absolute right-0.5 top-0.5 size-5 rounded-full bg-black/60 p-0 opacity-0 transition-opacity hover:bg-black/80 group-hover:opacity-100",onClick:()=>es(e.id),children:(0,t.jsx)(g.X,{className:"size-3 text-white"})}),(0,t.jsx)("span",{className:"absolute bottom-1 left-1 right-1 truncate text-[8px] text-muted-foreground",children:e.file.name})]})},e.id))})})}),(0,t.jsxs)("div",{className:"flex items-end gap-1.5 p-2 pb-safe",children:[(0,t.jsxs)(s.DropdownMenu,{children:[(0,t.jsx)(s.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(a.Button,{type:"button",variant:"ghost",size:"icon",className:"mb-0.5 size-10 md:size-8 shrink-0 rounded-full hover:bg-muted",disabled:w,title:"Add attachment",children:(0,t.jsx)(p.Plus,{className:"size-6 md:size-5 text-muted-foreground"})})}),(0,t.jsxs)(s.DropdownMenuContent,{align:"start",side:"top",className:"w-48",children:[(0,t.jsxs)(s.DropdownMenuItem,{onClick:()=>G.current?.click(),className:"gap-2",children:[(0,t.jsx)(o.Camera,{className:"size-4"}),(0,t.jsx)("span",{children:"Camera"})]}),(0,t.jsxs)(s.DropdownMenuItem,{onClick:()=>{let e=document.createElement("input");e.type="file",e.accept="image/*",e.multiple=!0,e.onchange=e=>ea(e.target.files),e.click()},className:"gap-2",children:[(0,t.jsx)(d.ImageIcon,{className:"size-4"}),(0,t.jsx)("span",{children:"Photo Library"})]}),(0,t.jsxs)(s.DropdownMenuItem,{onClick:()=>X.current?.click(),className:"gap-2",children:[(0,t.jsx)(c.FileText,{className:"size-4"}),(0,t.jsx)("span",{children:"Document"})]})]})]}),(0,t.jsxs)(s.DropdownMenu,{children:[(0,t.jsx)(s.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(a.Button,{type:"button",variant:"ghost",size:"icon",className:"mb-0.5 size-10 md:size-8 shrink-0 rounded-full hover:bg-muted",disabled:w,title:"Quick replies",children:(0,t.jsx)(u.default,{className:"size-5 md:size-4 text-muted-foreground"})})}),(0,t.jsxs)(s.DropdownMenuContent,{align:"start",side:"top",className:"w-56",children:[(0,t.jsx)("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground",children:"Quick Replies"}),f.map(e=>(0,t.jsxs)(s.DropdownMenuItem,{onClick:()=>eo(e),className:"flex-col items-start gap-0.5",children:[(0,t.jsx)("span",{className:"font-medium",children:e.label}),(0,t.jsx)("span",{className:"line-clamp-1 text-xs text-muted-foreground",children:e.preview})]},e.id))]})]}),(0,t.jsx)("input",{ref:X,type:"file",multiple:!0,accept:"*/*",className:"hidden",onChange:e=>ea(e.target.files)}),(0,t.jsx)("input",{ref:G,type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:e=>ea(e.target.files)}),(0,t.jsx)("div",{className:"relative min-w-0 flex-1",children:(0,t.jsxs)("div",{className:(0,i.cn)("flex w-full items-center overflow-y-auto rounded-[18px] border border-border bg-muted/50 pl-3 pr-1 py-1 transition-colors","min-h-[44px] md:min-h-[36px] max-h-[120px]","focus-within:border-primary/30 focus-within:bg-background focus-within:ring-1 focus-within:ring-primary/20",(w||N)&&"cursor-not-allowed opacity-50"),onClick:()=>V.current?.focus(),children:[(0,t.jsxs)("div",{className:"relative min-w-0 flex-1",children:[(0,t.jsx)("div",{ref:V,contentEditable:!w&&!N,suppressContentEditableWarning:!0,spellCheck:!0,onInput:e=>{y(e.currentTarget.textContent||"")},onKeyDown:en,onPaste:ei,onFocus:()=>H(!0),onBlur:()=>H(!1),"data-placeholder":k,className:(0,i.cn)("w-full min-w-0 whitespace-pre-wrap break-words py-1 leading-5 outline-none","text-base md:text-sm","empty:before:pointer-events-none empty:before:text-muted-foreground/60 empty:before:content-[attr(data-placeholder)]",(w||N)&&"pointer-events-none")}),B&&e&&(0,t.jsxs)("div",{className:"pointer-events-none absolute inset-0 flex items-center overflow-hidden py-1 text-sm leading-5","aria-hidden":"true",children:[(0,t.jsx)("span",{className:"invisible whitespace-pre-wrap",children:e}),(0,t.jsx)("span",{className:"text-muted-foreground/40",children:B})]}),B&&(0,t.jsxs)("div",{className:"absolute -top-5 right-0 flex items-center gap-1 text-[10px] text-muted-foreground",children:[(0,t.jsx)("kbd",{className:"rounded border border-border bg-muted px-1 py-0.5 font-mono text-[9px]",children:"Tab"}),(0,t.jsx)("span",{children:"to accept"})]})]}),(0,t.jsxs)("div",{className:"flex shrink-0 items-center gap-0.5 pl-1",children:[(0,t.jsxs)(r.Popover,{open:L,onOpenChange:O,children:[(0,t.jsx)(r.PopoverTrigger,{asChild:!0,children:(0,t.jsx)("button",{type:"button",className:(0,i.cn)("flex size-9 md:size-7 items-center justify-center rounded-full transition-colors","hover:bg-muted/80",L&&"bg-muted"),disabled:w,title:"Add emoji",children:(0,t.jsx)(h.Smile,{className:"size-5 md:size-4 text-muted-foreground"})})}),(0,t.jsx)(r.PopoverContent,{side:"top",align:"end",className:"w-[300px] p-0",children:(0,t.jsx)(n.ScrollArea,{className:"h-[280px]",children:(0,t.jsx)("div",{className:"p-2",children:b.map((e,a)=>(0,t.jsxs)("div",{className:a>0?"mt-3":"",children:[(0,t.jsx)("h4",{className:"mb-1.5 px-1 text-[10px] font-semibold uppercase tracking-wider text-muted-foreground",children:e.name}),(0,t.jsx)("div",{className:"grid grid-cols-8 gap-0.5",children:e.emojis.map((e,a)=>(0,t.jsx)("button",{type:"button",className:"flex size-8 items-center justify-center rounded-lg text-lg transition-colors hover:bg-muted",onClick:()=>et(e),children:e},`${e}-${a}`))})]},e.name))})})})]}),(0,t.jsx)("button",{type:"button",onClick:er,disabled:!e.trim()&&0===I.length||N||w,className:(0,i.cn)("flex size-9 md:size-7 items-center justify-center rounded-full transition-all duration-200",e.trim()||I.length>0?"bg-primary hover:bg-primary/90 scale-100 active:scale-95":"bg-muted/50 scale-90"),children:N?(0,t.jsx)(m.Loader2,{className:(0,i.cn)("size-5 md:size-4 animate-spin",e.trim()||I.length>0?"text-primary-foreground":"text-muted-foreground")}):(0,t.jsx)(l.ArrowUp,{className:(0,i.cn)("size-5 md:size-4",e.trim()||I.length>0?"text-primary-foreground":"text-muted-foreground")})})]})]})})]})]})}e.s(["SmsMessageInput",()=>y],608423)},167297,e=>{"use strict";var t=e.i(111043),a=e.i(608423);e.i(670258);var s=e.i(921251);e.i(889265);var r=e.i(677607);e.i(51478);var n=e.i(635613),i=e.i(152088),l=e.i(24079),o=e.i(68599),c=e.i(641304),d=e.i(747146),m=e.i(38614),u=e.i(231476),p=e.i(233654),h=e.i(160424),g=e.i(287268),x=e.i(212409),f=e.i(970799),b=e.i(995403),y=e.i(904653),v=e.i(552038),j=(0,v.createServerReference)("407cdb4f27b0a3c9f049dfd3b6d0861b01b26a0e85",v.callServer,void 0,v.findSourceMapURL,"getTeamChannelMessagesAction"),N=(0,v.createServerReference)("40d31525c81948d6fd1432186542094856234a3c66",v.callServer,void 0,v.findSourceMapURL,"sendTeamChannelMessageAction"),w=(0,v.createServerReference)("40581e668b6daea6cb7c47a00911750a07df65b573",v.callServer,void 0,v.findSourceMapURL,"markTeamChannelAsReadAction");let k=[{id:"general",name:"General",type:"public"},{id:"sales",name:"Sales",type:"public"},{id:"support",name:"Support",type:"public"},{id:"technicians",name:"Technicians",type:"public"},{id:"management",name:"Management",type:"private"}];function C({initialChannels:v,initialChannelId:C}){(0,y.useRouter)();let S=(0,y.useSearchParams)().get("channel")||C||"general",{toggleSidebar:R}=(0,l.useSidebar)(),A=v.length>0?v:k,T=A.find(e=>e.id===S)||A[0],[z,$]=(0,f.useState)([]),[M,D]=(0,f.useState)(!1),[_,F]=(0,f.useState)(!1),[P,U]=(0,f.useState)(null),[I,E]=(0,f.useState)(""),[L,O]=(0,f.useState)(!1),[q,H]=(0,f.useState)([]),[B,W]=(0,f.useState)(""),[K,J]=(0,f.useState)(""),V=(0,f.useRef)(null),X=(0,f.useRef)(null),G=(0,f.useCallback)(async(e=!1)=>{e?F(!0):D(!0),U(null);try{let e=await j({channel:S,limit:100,offset:0});e.success&&e.messages?($(e.messages),e.messages.filter(e=>!e.read_at&&"inbound"===e.direction).length>0&&($(e=>e.map(e=>e.read_at||"inbound"!==e.direction?e:{...e,read_at:new Date().toISOString()})),w(S).then(e=>{e.success&&setTimeout(()=>{G(!1)},500)}).catch(()=>{}))):U(e.error||"Failed to load messages")}catch(e){U(e instanceof Error?e.message:"Unknown error")}finally{D(!1),F(!1)}},[S]);(0,f.useEffect)(()=>{V.current&&(V.current.scrollTop=V.current.scrollHeight)},[z]);let Q=(0,f.useRef)(!0);(0,f.useEffect)(()=>{if(Q.current){Q.current=!1;return}G()},[S]),(0,f.useEffect)(()=>(X.current&&clearTimeout(X.current),X.current=setTimeout(()=>{W(K),K&&G()},300),()=>{X.current&&clearTimeout(X.current)}),[K]);let Y=(0,f.useCallback)(()=>{G(!0)},[S]),Z=(0,f.useCallback)(async()=>{if((I.trim()||0!==q.length)&&!L){O(!0);try{let t=[];if(q.length>0){let{uploadSmsAttachments:a}=await e.A(413320),s=await a(q);if(!s.success||!s.urls){b.toast.error(s.error||"Failed to upload attachments"),O(!1);return}t=q.map((e,t)=>({type:e.type.startsWith("image/")?"image":"file",filename:e.name,url:s.urls?.[t]}))}let a=await N({channel:S,text:I.trim(),attachments:t});a.success?(E(""),H([]),b.toast.success("Message sent"),G(!0)):b.toast.error(a.error||"Failed to send message")}catch(e){b.toast.error("Failed to send message",{description:e instanceof Error?e.message:"Unknown error"})}finally{O(!1)}}},[I,q,S,L]),ee=(0,f.useCallback)(e=>{H(t=>[...t,...e])},[]);return(0,t.jsx)("div",{className:"flex h-full w-full flex-col overflow-hidden bg-sidebar",children:(0,t.jsxs)("div",{className:"bg-card mb-1 rounded-tl-2xl shadow-sm lg:h-full flex flex-col min-w-0 flex-1 overflow-hidden",children:[(0,t.jsxs)("div",{className:"sticky top-0 z-10 flex items-center justify-between gap-2 p-3 border-b border-border bg-card",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 shrink-0",onClick:R,title:"Toggle sidebar",children:(0,t.jsx)(u.PanelLeft,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{className:"relative flex-1 max-w-md",children:[(0,t.jsx)(n.Input,{type:"search",placeholder:"Search messages...",value:K,onChange:e=>J(e.target.value),className:"h-8 pl-9 pr-8"}),(0,t.jsx)(g.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),K&&(0,t.jsx)("button",{onClick:()=>J(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:(0,t.jsx)(x.X,{className:"h-3 w-3"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 shrink-0 ml-2",children:[(0,t.jsx)(o.Hash,{className:"h-5 w-5 text-muted-foreground"}),(0,t.jsx)("h1",{className:"font-semibold text-base",children:T.name})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:Y,disabled:_,className:"h-8 w-8 p-0",title:"Refresh",children:(0,t.jsx)(h.RefreshCw,{className:`h-4 w-4 text-muted-foreground ${_?"animate-spin":""}`})}),(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",title:"More options",children:(0,t.jsx)(m.MoreHorizontal,{className:"h-4 w-4 text-muted-foreground"})})]})]}),(0,t.jsx)("div",{ref:V,className:"flex-1 overflow-y-auto bg-gradient-to-b from-background to-muted/20 px-4 py-4",children:M?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)(c.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):P?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-sm text-destructive mb-2 font-medium",children:P}),(0,t.jsx)(r.Button,{variant:"outline",size:"sm",onClick:()=>G(),children:"Try Again"})]})}):0===z.length?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(d.MessageSquare,{className:"h-12 w-12 text-muted-foreground opacity-50 mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No messages yet"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Start the conversation!"})]})}):(0,t.jsx)("div",{className:"space-y-2",children:z.map((e,a)=>{let r,n,l,o,c,d="outbound"===e.direction,m=0===a||new Date(e.created_at).getTime()-new Date(z[a-1].created_at).getTime()>3e5;return(0,t.jsxs)("div",{className:"flex flex-col",children:[m&&(0,t.jsx)("div",{className:"flex justify-center my-2",children:(0,t.jsx)("span",{className:"text-xs text-muted-foreground bg-muted/50 px-2 py-1 rounded-full",children:(r=new Date(e.created_at),l=Math.floor((n=new Date().getTime()-r.getTime())/6e4),o=Math.floor(n/36e5),c=Math.floor(n/864e5),l<1?"Just now":l<60?`${l}m ago`:o<24?`${o}h ago`:c<7?`${c}d ago`:r.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}))})}),(0,t.jsxs)("div",{className:(0,i.cn)("flex gap-3",d?"justify-end":"justify-start"),children:[!d&&e.sent_by_user&&(0,t.jsx)(s.Avatar,{className:"h-8 w-8 shrink-0",children:(0,t.jsx)(s.AvatarFallback,{children:e.sent_by_user.name?.[0]?.toUpperCase()||"U"})}),(0,t.jsxs)("div",{className:(0,i.cn)("max-w-[75%] rounded-2xl px-4 py-2 shadow-sm",d?"bg-primary text-primary-foreground rounded-tr-sm":"bg-muted text-foreground rounded-tl-sm"),children:[!d&&e.sent_by_user&&(0,t.jsx)("div",{className:"text-xs font-medium mb-1 opacity-80",children:e.sent_by_user.name||"Unknown"}),e.provider_metadata&&"object"==typeof e.provider_metadata&&"attachments"in e.provider_metadata&&Array.isArray(e.provider_metadata.attachments)&&e.provider_metadata.attachments.length>0&&(0,t.jsx)("div",{className:(0,i.cn)("mb-2 space-y-2",(e.body,"")),children:e.provider_metadata.attachments.map((e,a)=>{let s="image"===e.type||e.url&&/\.(jpg|jpeg|png|gif|webp)$/i.test(e.url);return(0,t.jsx)("div",{className:"rounded-lg overflow-hidden",children:s?(0,t.jsx)("img",{src:e.url,alt:e.filename||"Image",className:"max-w-full max-h-64 object-contain rounded-lg",loading:"lazy"}):(0,t.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:(0,i.cn)("flex items-center gap-2 p-2 rounded-lg hover:opacity-80 transition-opacity",d?"bg-primary-foreground/20":"bg-background/20"),children:[(0,t.jsx)(p.Paperclip,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-xs truncate",children:e.filename||"Attachment"})]})},a)})}),e.body&&(0,t.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:e.body}),!e.body&&(!e.provider_metadata||"object"!=typeof e.provider_metadata||!("attachments"in e.provider_metadata)||!Array.isArray(e.provider_metadata.attachments)||0===e.provider_metadata.attachments.length)&&(0,t.jsx)("p",{className:"text-sm opacity-70 italic",children:"No message content"}),(0,t.jsx)("span",{className:(0,i.cn)("text-xs opacity-70 mt-1 block",d?"text-right":"text-left"),children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})]},e.id)})})}),(0,t.jsx)(a.SmsMessageInput,{value:I,onChange:E,onSend:Z,onAttach:ee,sending:L,disabled:!1,placeholder:`Message #${T.name.toLowerCase()}`})]})})}e.s(["TeamsPageClient",()=>C],167297)},413320,e=>{e.v(t=>Promise.all(["static/chunks/1cef69d04370d194.js"].map(t=>e.l(t))).then(()=>t(100556)))}]);