(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,907276,e=>{"use strict";var t=e.i(111043),s=e.i(904653),a=e.i(970799),r=e.i(995403),n=e.i(49718),i=e.i(559586),l=e.i(747146),d=e.i(939397);e.i(254851);var c=e.i(605278);e.i(789067);var o=e.i(861308);function m({title:e,description:s,children:r,icon:n,badge:i,className:l,rootMargin:d="100px",loadImmediately:o=!1}){let[m,u]=(0,a.useState)(o),x=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(o)return;let e=new IntersectionObserver(([t])=>{t?.isIntersecting&&(u(!0),e.disconnect())},{rootMargin:d,threshold:.1});return x.current&&e.observe(x.current),()=>e.disconnect()},[o,d]),(0,t.jsxs)(c.Card,{ref:x,className:l,children:[(0,t.jsxs)(c.CardHeader,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[n,(0,t.jsx)(c.CardTitle,{className:"text-lg",children:e})]}),i&&(0,t.jsx)("span",{className:"bg-muted rounded-full px-2 py-0.5 text-xs font-medium",children:i})]}),s&&(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:s})]}),(0,t.jsx)(c.CardContent,{children:"function"==typeof r?r({isVisible:m}):r})]})}function u({rows:e=3}){return(0,t.jsx)("div",{className:"space-y-3",children:Array.from({length:e}).map((e,s)=>(0,t.jsx)(o.Skeleton,{className:"h-16 w-full"},s))})}e.i(889265);var x=e.i(677607),h=e.i(830891);function p(e,t,s={}){let{enabled:r=!0}=s,[n,i]=(0,a.useState)(null),[l,d]=(0,a.useState)(null),[c,o]=(0,a.useState)(!1),m=(0,a.useRef)(null);return(0,a.useEffect)(()=>{r&&(m.current!==e||null===n)&&(async()=>{o(!0),d(null);try{let s=await t();if(s.error)throw s.error;i(s.data),m.current=e}catch(e){d(e instanceof Error?e:Error("Failed to fetch data"))}finally{o(!1)}})()},[r,e,t,n]),{data:n,error:l,isLoading:c}}var j=e.i(871509);function g({invoiceId:e,customerId:s,jobId:a,companyId:r,loadImmediately:n=!1}){return(0,t.jsx)(m,{title:"Communications",icon:(0,t.jsx)(l.MessageSquare,{className:"h-5 w-5"}),loadImmediately:n,children:({isVisible:n})=>{let{data:c,isLoading:o,error:m}=function(e,t,s,a,r=!0){return p(["invoice-communications",e,t,s],async()=>{let r=(0,h.createClient)(),n=[`invoice_id.eq.${e}`];t&&n.push(`customer_id.eq.${t}`),s&&n.push(`job_id.eq.${s}`);let i=r.from("communications").select(`
					*,
					customer:customers!customer_id(id, first_name, last_name)
				`).eq("company_id",a).order("created_at",{ascending:!1}).limit(50);i=n.length>1?i.or(n.join(",")):i.eq("invoice_id",e);let l=await i;return{data:(l.data||[]).filter((e,t,s)=>!!e?.id&&s.findIndex(t=>t.id===e.id)===t)??[],error:l.error}},{enabled:r})}(e,s,a,r,n);return o?(0,t.jsx)(u,{rows:3}):m?(0,t.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"Failed to load communications"}):c&&0!==c.length?(0,t.jsxs)("div",{className:"space-y-3",children:[c.slice(0,10).map(e=>(0,t.jsx)("div",{className:"rounded-lg border p-3",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:`mt-0.5 flex h-8 w-8 items-center justify-center rounded-full ${(e=>{switch(e?.toLowerCase()){case"email":return"bg-blue-100 text-blue-600";case"phone":case"call":return"bg-green-100 text-green-600";default:return"bg-gray-100 text-gray-600"}})(e.type)}`,children:(e=>{switch(e?.toLowerCase()){case"email":return(0,t.jsx)(i.Mail,{className:"h-4 w-4"});case"phone":case"call":return(0,t.jsx)(d.Phone,{className:"h-4 w-4"});default:return(0,t.jsx)(l.MessageSquare,{className:"h-4 w-4"})}})(e.type)}),(0,t.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm font-medium capitalize",children:e.type||"Communication"}),(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:(0,j.formatDate)(e.created_at)})]}),e.subject&&(0,t.jsx)("p",{className:"text-sm font-medium",children:e.subject}),e.message&&(0,t.jsx)("p",{className:"text-muted-foreground line-clamp-2 text-sm",children:e.message}),e.customer&&(0,t.jsxs)("p",{className:"text-muted-foreground text-xs",children:["To:"," ",e.customer.first_name||e.customer.last_name?`${e.customer.first_name} ${e.customer.last_name}`.trim():"Customer"]}),e.status&&(0,t.jsx)("span",{className:`inline-block rounded-full px-2 py-0.5 text-xs ${"sent"===e.status||"delivered"===e.status?"bg-green-100 text-green-700":"pending"===e.status?"bg-yellow-100 text-yellow-700":"failed"===e.status?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:e.status})]})]})},e.id)),c.length>10&&(0,t.jsxs)(x.Button,{variant:"outline",size:"sm",className:"w-full",children:["View All Communications (",c.length,")"]})]}):(0,t.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"No communications found"})}})}var f=e.i(327149),N=e.i(176378);function v({jobId:e,loadImmediately:s=!1}){return e?(0,t.jsx)(m,{title:"Related Job",icon:(0,t.jsx)(f.Briefcase,{className:"h-5 w-5"}),loadImmediately:s,children:({isVisible:s})=>{let{data:a,isLoading:r,error:n}=function(e,t=!0){return p(["invoice-job",e],async()=>{if(!e)return{data:null,error:null};let t=(0,h.createClient)();return await t.from("jobs").select("id, job_number, title, property_id").eq("id",e).single()},{enabled:t&&!!e})}(e,s);return r?(0,t.jsx)(u,{rows:2}):n?(0,t.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"Failed to load job details"}):a?(0,t.jsx)(N.default,{href:`/dashboard/work/jobs/${a.id}`,className:"hover:bg-accent block rounded-lg border p-4 transition-colors",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-sm font-medium",children:["Job #",a.job_number]}),(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"View Details →"})]}),a.title&&(0,t.jsx)("p",{className:"text-muted-foreground line-clamp-2 text-sm",children:a.title})]})}):(0,t.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"Job not found"})}}):(0,t.jsx)(m,{title:"Related Job",icon:(0,t.jsx)(f.Briefcase,{className:"h-5 w-5"}),loadImmediately:!0,children:(0,t.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"No job linked to this invoice"})})}var y=e.i(79254),b=e.i(403468),_=e.i(263942),w=e.i(376089),C=e.i(588477),I=e.i(641304),S=e.i(868106);e.i(539870);var k=e.i(846358);e.i(51478);var D=e.i(635613);e.i(149989);var F=e.i(880177);e.i(997035);var P=e.i(226571);e.i(526120);var L=e.i(610120),q=e.i(152088),T=e.i(552038),$=(0,T.createServerReference)("40b886386a6f7298961914ae721c16cba685c0df71",T.callServer,void 0,T.findSourceMapURL,"collectManualPayment");let B=[{id:"cash",name:"Cash",description:"Customer paid with cash",icon:w.Banknote},{id:"check",name:"Check",description:"Customer paid with check",icon:C.FileCheck},{id:"card",name:"Credit/Debit Card",description:"Process card payment",icon:b.CreditCard},{id:"ach",name:"Bank Transfer (ACH)",description:"Process ACH payment",icon:_.Building2}];function A({invoiceId:e,invoiceNumber:s,customerId:n,customerName:i,companyId:l,amountDue:d,currency:c="USD",trigger:o,onSuccess:m}){let[u,h]=(0,a.useState)(!1),[p,j]=(0,a.useTransition)(),[g,f]=(0,a.useState)("cash"),[N,v]=(0,a.useState)((d/100).toFixed(2)),[y,b]=(0,a.useState)(""),[_,w]=(0,a.useState)(""),[C,T]=(0,a.useState)(""),[A,R]=(0,a.useState)(""),[E,M]=(0,a.useState)(""),[z,U]=(0,a.useState)(i),[H,O]=(0,a.useState)(""),[V,J]=(0,a.useState)(""),[G,K]=(0,a.useState)(i),Y=async t=>{t.preventDefault();let s=Math.round(100*Number.parseFloat(N));s<=0?r.toast.error("Invalid amount",{description:"Please enter a valid payment amount."}):j(async()=>{try{let t=await $({invoiceId:e,companyId:l,customerId:n,paymentMethod:g,amount:s,notes:y||void 0,checkNumber:"check"===g?_:void 0,cardDetails:"card"===g?{cardNumber:C.replace(/\s/g,""),cardExpiry:A,cardCvc:E,cardName:z}:void 0,achDetails:"ach"===g?{accountNumber:H,routingNumber:V,accountName:G}:void 0});t.success?(r.toast.success("Payment collected",{description:`Payment of ${W(s)} has been recorded.`}),h(!1),Q(),m?.()):r.toast.error("Payment failed",{description:t.error||"Unable to process payment."})}catch(e){r.toast.error("Payment error",{description:"An unexpected error occurred. Please try again."})}})},Q=()=>{f("cash"),v((d/100).toFixed(2)),b(""),w(""),T(""),R(""),M(""),U(i),O(""),J(""),K(i)},W=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:c}).format(e/100);return(0,t.jsxs)(k.Dialog,{open:u,onOpenChange:h,children:[(0,t.jsx)(k.DialogTrigger,{asChild:!0,children:o||(0,t.jsxs)(x.Button,{variant:"outline",size:"sm",children:[(0,t.jsx)(S.Receipt,{className:"mr-2 h-4 w-4"}),"Collect Payment"]})}),(0,t.jsx)(k.DialogContent,{className:"sm:max-w-[500px]",children:(0,t.jsxs)("form",{onSubmit:Y,children:[(0,t.jsxs)(k.DialogHeader,{children:[(0,t.jsx)(k.DialogTitle,{children:"Collect Payment"}),(0,t.jsxs)(k.DialogDescription,{children:["Record a payment for Invoice #",s," from ",i]})]}),(0,t.jsxs)("div",{className:"space-y-6 py-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.Label,{htmlFor:"amount",children:"Payment Amount"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"text-muted-foreground absolute left-3 top-1/2 -translate-y-1/2",children:"$"}),(0,t.jsx)(D.Input,{id:"amount",type:"number",step:"0.01",min:"0.01",value:N,onChange:e=>v(e.target.value),className:"pl-8",required:!0})]}),100*Number.parseFloat(N)<d&&(0,t.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Partial payment (",W(d-100*Number.parseFloat(N))," remaining)"]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(F.Label,{children:"Payment Method"}),(0,t.jsx)(P.RadioGroup,{value:g,onValueChange:e=>f(e),className:"grid gap-2",children:B.map(e=>{let s=e.icon;return(0,t.jsxs)("div",{children:[(0,t.jsx)(P.RadioGroupItem,{value:e.id,id:e.id,className:"peer sr-only"}),(0,t.jsxs)(F.Label,{htmlFor:e.id,className:(0,q.cn)("flex cursor-pointer items-center gap-3 rounded-lg border-2 p-3 transition-colors","peer-data-[state=checked]:border-primary peer-data-[state=checked]:bg-primary/5","hover:border-primary/50"),children:[(0,t.jsx)(s,{className:"h-5 w-5 text-muted-foreground"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:e.name}),(0,t.jsx)("p",{className:"text-muted-foreground text-xs",children:e.description})]})]})]},e.id)})})]}),"check"===g&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.Label,{htmlFor:"checkNumber",children:"Check Number"}),(0,t.jsx)(D.Input,{id:"checkNumber",value:_,onChange:e=>w(e.target.value),placeholder:"Enter check number",required:!0})]}),"card"===g&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.Label,{htmlFor:"cardName",children:"Cardholder Name"}),(0,t.jsx)(D.Input,{id:"cardName",value:z,onChange:e=>U(e.target.value),required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.Label,{htmlFor:"cardNumber",children:"Card Number"}),(0,t.jsx)(D.Input,{id:"cardNumber",maxLength:19,value:C,onChange:e=>{let t=e.target.value.replace(/\s/g,"");T(t.match(/.{1,4}/g)?.join(" ")||t)},placeholder:"1234 5678 9012 3456",required:!0})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.Label,{htmlFor:"cardExpiry",children:"Expiry"}),(0,t.jsx)(D.Input,{id:"cardExpiry",maxLength:5,value:A,onChange:e=>{let t=e.target.value.replace(/\D/g,"");t.length>=2?R(`${t.slice(0,2)}/${t.slice(2,4)}`):R(t)},placeholder:"MM/YY",required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.Label,{htmlFor:"cardCvc",children:"CVC"}),(0,t.jsx)(D.Input,{id:"cardCvc",maxLength:4,value:E,onChange:e=>M(e.target.value.replace(/\D/g,"")),placeholder:"123",required:!0})]})]})]}),"ach"===g&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.Label,{htmlFor:"accountName",children:"Account Holder Name"}),(0,t.jsx)(D.Input,{id:"accountName",value:G,onChange:e=>K(e.target.value),required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.Label,{htmlFor:"routingNumber",children:"Routing Number"}),(0,t.jsx)(D.Input,{id:"routingNumber",maxLength:9,value:V,onChange:e=>J(e.target.value.replace(/\D/g,"")),placeholder:"110000000",required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.Label,{htmlFor:"accountNumber",children:"Account Number"}),(0,t.jsx)(D.Input,{id:"accountNumber",value:H,onChange:e=>O(e.target.value.replace(/\D/g,"")),placeholder:"000123456789",required:!0})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.Label,{htmlFor:"notes",children:"Notes (Optional)"}),(0,t.jsx)(L.Textarea,{id:"notes",value:y,onChange:e=>b(e.target.value),placeholder:"Add any notes about this payment...",rows:2})]})]}),(0,t.jsxs)(k.DialogFooter,{children:[(0,t.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>h(!1),disabled:p,children:"Cancel"}),(0,t.jsx)(x.Button,{type:"submit",disabled:p,children:p?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(I.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S.Receipt,{className:"mr-2 h-4 w-4"}),"Collect ",W(100*Number.parseFloat(N))]})})]})]})})]})}e.i(553153);var R=e.i(363712);function E({customerId:e,invoiceId:s,invoiceNumber:a,customerName:r,companyId:n,amountDue:i,loadImmediately:l=!1,onPaymentSuccess:d}){let c=s&&n&&i&&i>0;return(0,t.jsx)(m,{title:"Payment Methods",icon:(0,t.jsx)(b.CreditCard,{className:"h-5 w-5"}),loadImmediately:l,children:({isVisible:l})=>{let{data:o,isLoading:m,error:j}=function(e,t=!0){return p(["invoice-payment-methods",e],async()=>{let t=(0,h.createClient)();return await t.from("customer_payment_methods").select("*").eq("customer_id",e).eq("is_active",!0).order("is_default",{ascending:!1})},{enabled:t})}(e,l);return m?(0,t.jsx)(u,{rows:2}):j?(0,t.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"Failed to load payment methods"}):o&&0!==o.length?(0,t.jsxs)("div",{className:"space-y-3",children:[o.map(e=>(0,t.jsx)("div",{className:"rounded-lg border p-3",children:(0,t.jsx)("div",{className:"flex items-start justify-between gap-2",children:(0,t.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"card"===e.type?"Credit Card":e.type}),e.is_default&&(0,t.jsxs)(R.Badge,{variant:"default",className:"text-xs",children:[(0,t.jsx)(y.Check,{className:"mr-1 h-3 w-3"}),"Default"]})]}),e.last4&&(0,t.jsxs)("p",{className:"text-muted-foreground text-sm",children:["•••• ",e.last4]}),e.brand&&(0,t.jsx)("p",{className:"text-muted-foreground text-xs",children:e.brand}),e.exp_month&&e.exp_year&&(0,t.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Expires ",e.exp_month,"/",e.exp_year]})]})})},e.id)),c?(0,t.jsx)(A,{invoiceId:s,invoiceNumber:a||"",customerId:e,customerName:r||"Customer",companyId:n,amountDue:i,onSuccess:d,trigger:(0,t.jsx)(x.Button,{variant:"outline",size:"sm",className:"w-full",children:"Collect Payment"})}):(0,t.jsx)(x.Button,{variant:"outline",size:"sm",className:"w-full",disabled:!0,children:"Collect Payment"})]}):(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"No saved payment methods"}),(0,t.jsx)(x.Button,{variant:"outline",size:"sm",className:"w-full",children:"Add Payment Method"})]})}})}var M=e.i(982686);function z({invoiceId:e,loadImmediately:s=!1}){return(0,t.jsx)(m,{title:"Payments Received",icon:(0,t.jsx)(M.DollarSign,{className:"h-5 w-5"}),loadImmediately:s,children:({isVisible:s})=>{let{data:a,isLoading:r,error:n}=function(e,t=!0){return p(["invoice-payments",e],async()=>{let t=(0,h.createClient)();return await t.from("invoice_payments").select(`
					id,
					amount_applied,
					applied_at,
					notes,
					payment:payments!payment_id (
						id,
						payment_number,
						amount,
						payment_method,
						payment_type,
						status,
						card_brand,
						card_last4,
						check_number,
						reference_number,
						processor_name,
						receipt_url,
						receipt_number,
						refunded_amount,
						refund_reason,
						processed_at,
						completed_at,
						notes
					)
				`).eq("invoice_id",e).order("applied_at",{ascending:!1})},{enabled:t})}(e,s);return r?(0,t.jsx)(u,{rows:3}):n?(0,t.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"Failed to load payments"}):a&&0!==a.length?(0,t.jsxs)("div",{className:"space-y-3",children:[a.map(e=>{let s=e.payment;return s?(0,t.jsx)("div",{className:"rounded-lg border p-3",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"mt-0.5 flex h-8 w-8 items-center justify-center rounded-full bg-green-100",children:(0,t.jsx)(b.CreditCard,{className:"h-4 w-4 text-green-600"})}),(0,t.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:(0,j.formatCurrency)(e.amount_applied)}),(0,t.jsx)("span",{className:`inline-block rounded-full px-2 py-0.5 text-xs ${"completed"===s.status?"bg-green-100 text-green-700":"pending"===s.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}`,children:s.status})]}),(0,t.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Payment #",s.payment_number]}),s.payment_method&&(0,t.jsxs)("p",{className:"text-muted-foreground text-xs",children:[s.payment_method,s.card_last4&&` ending in ${s.card_last4}`]}),(0,t.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Applied ",(0,j.formatDate)(e.applied_at)]}),e.notes&&(0,t.jsxs)("p",{className:"text-muted-foreground text-xs italic",children:['"',e.notes,'"']})]})]})},e.id):null}),a.length>5&&(0,t.jsx)(x.Button,{variant:"outline",size:"sm",className:"w-full",children:"View All Payments"})]}):(0,t.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"No payments received yet"})}})}var U=e.i(201710);function H({propertyId:e,loadImmediately:s=!1}){return e?(0,t.jsx)(m,{title:"Service Location",icon:(0,t.jsx)(U.Home,{className:"h-5 w-5"}),loadImmediately:s,children:({isVisible:s})=>{let{data:a,isLoading:r,error:n}=function(e,t=!0){return p(["invoice-property",e],async()=>{if(!e)return{data:null,error:null};let t=(0,h.createClient)();return await t.from("properties").select("*").eq("id",e).single()},{enabled:t&&!!e})}(e,s);return r?(0,t.jsx)(u,{rows:3}):n?(0,t.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"Failed to load property details"}):a?(0,t.jsx)(N.default,{href:`/dashboard/properties/${a.id}`,className:"hover:bg-accent block rounded-lg border p-4 transition-colors",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:a.name||"Property"}),(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"View Details →"})]}),a.address&&(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:a.address}),(a.city||a.state||a.zip_code)&&(0,t.jsx)("p",{className:"text-muted-foreground text-xs",children:[a.city,a.state,a.zip_code].filter(Boolean).join(", ")})]})}):(0,t.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"Property not found"})}}):(0,t.jsx)(m,{title:"Service Location",icon:(0,t.jsx)(U.Home,{className:"h-5 w-5"}),loadImmediately:!0,children:(0,t.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"No property linked to this invoice"})})}var O=e.i(606661),V=e.i(73905);function J({estimateId:e,invoiceId:s,invoiceCreatedAt:a,loadImmediately:r=!1}){return(0,t.jsx)(m,{title:"Workflow Timeline",icon:(0,t.jsx)(V.GitBranch,{className:"h-5 w-5"}),loadImmediately:r,children:({isVisible:r})=>{let{data:n,isLoading:i}=function(e,t=!0){return p(["invoice-estimate",e],async()=>{if(!e)return{data:null,error:null};let t=(0,h.createClient)();return await t.from("estimates").select("id, estimate_number, created_at, status").eq("id",e).maybeSingle()},{enabled:t&&!!e})}(e,r),{data:l,isLoading:d}=function(e,t=!0){return p(["invoice-contract",e],async()=>{let t=(0,h.createClient)();return await t.from("contracts").select("id, contract_number, created_at, status, signed_at").eq("invoice_id",e).is("deleted_at",null).maybeSingle()},{enabled:t})}(s,r);return i||d?(0,t.jsx)(u,{rows:3}):(0,t.jsxs)("div",{className:"space-y-3",children:[n&&(0,t.jsxs)(N.default,{href:`/dashboard/work/estimates/${n.id}`,className:"hover:bg-accent flex items-start gap-3 rounded-lg border p-3 transition-colors",children:[(0,t.jsx)("div",{className:"mt-0.5 flex h-6 w-6 items-center justify-center rounded-full bg-blue-100 text-blue-600",children:(0,t.jsx)(O.FileText,{className:"h-3.5 w-3.5"})}),(0,t.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-sm font-medium",children:["Estimate #",n.estimate_number]}),(0,t.jsx)(y.Check,{className:"h-4 w-4 text-green-600"})]}),(0,t.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Created ",(0,j.formatDate)(n.created_at)]}),(0,t.jsx)("span",{className:"inline-block rounded-full bg-blue-100 px-2 py-0.5 text-xs text-blue-700",children:n.status})]})]}),l&&(0,t.jsxs)(N.default,{href:`/dashboard/work/contracts/${l.id}`,className:"hover:bg-accent flex items-start gap-3 rounded-lg border p-3 transition-colors",children:[(0,t.jsx)("div",{className:"mt-0.5 flex h-6 w-6 items-center justify-center rounded-full bg-purple-100 text-purple-600",children:(0,t.jsx)(C.FileCheck,{className:"h-3.5 w-3.5"})}),(0,t.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-sm font-medium",children:["Contract #",l.contract_number]}),(0,t.jsx)(y.Check,{className:"h-4 w-4 text-green-600"})]}),(0,t.jsx)("p",{className:"text-muted-foreground text-xs",children:l.signed_at?`Signed ${(0,j.formatDate)(l.signed_at)}`:`Created ${(0,j.formatDate)(l.created_at)}`}),(0,t.jsx)("span",{className:"inline-block rounded-full bg-purple-100 px-2 py-0.5 text-xs text-purple-700",children:l.status})]})]}),(0,t.jsxs)("div",{className:"border-primary/50 bg-primary/5 flex items-start gap-3 rounded-lg border p-3",children:[(0,t.jsx)("div",{className:"bg-primary text-primary-foreground mt-0.5 flex h-6 w-6 items-center justify-center rounded-full",children:(0,t.jsx)(O.FileText,{className:"h-3.5 w-3.5"})}),(0,t.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Invoice (Current)"}),(0,t.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Created ",(0,j.formatDate)(a)]})]})]}),!n&&!l&&(0,t.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"No workflow history available"})]})}})}var G=e.i(821305),K=e.i(307033);e.i(287133);var Y=e.i(120109);function Q({entityData:e,metrics:i}){let l=(0,s.useRouter)(),{invoice:d,customer:c,company:o,companyId:m}=e,[u,x]=(0,a.useState)(d),h=(0,a.useMemo)(()=>d?.invoice_tags?d.invoice_tags.map(e=>({id:e.id,name:e.name,slug:e.slug,color:e.color,category:e.category,icon:e.icon})):[],[d?.invoice_tags]);return(0,t.jsx)(G.DetailPageContentLayout,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("h1",{className:"text-2xl font-bold",children:["Invoice #",u.invoice_number]}),(0,t.jsx)(R.Badge,{className:(e=>{switch(e?.toLowerCase()){case"paid":return"bg-green-100 text-green-700";case"partial":return"bg-yellow-100 text-yellow-700";case"overdue":return"bg-red-100 text-red-700";case"draft":return"bg-gray-100 text-gray-700";default:return"bg-blue-100 text-blue-700"}})(u.status),children:u.status})]}),c&&(0,t.jsxs)("p",{className:"text-muted-foreground",children:["Customer:"," ",c.display_name||c.company_name||`${c.first_name||""} ${c.last_name||""}`.trim()||c.email||"Unknown"]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"text-muted-foreground text-sm",children:"Total Amount"}),(0,t.jsx)("div",{className:"text-2xl font-bold",children:(0,j.formatCurrency)(u.total_amount||0)}),u.balance_amount>0&&(0,t.jsxs)("div",{className:"mt-1 text-sm text-red-600",children:["Balance: ",(0,j.formatCurrency)(u.balance_amount)]})]})]}),(0,t.jsx)(Y.Separator,{}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-muted-foreground text-sm",children:"Issue Date"}),(0,t.jsx)("div",{className:"font-medium",children:(0,j.formatDate)(u.issue_date||u.created_at)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-muted-foreground text-sm",children:"Due Date"}),(0,t.jsx)("div",{className:"font-medium",children:u.due_date?(0,j.formatDate)(u.due_date):"Not set"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-muted-foreground text-sm",children:"Paid Amount"}),(0,t.jsx)("div",{className:"font-medium text-green-600",children:(0,j.formatCurrency)(u.paid_amount||0)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-muted-foreground text-sm",children:"Payment Terms"}),(0,t.jsx)("div",{className:"font-medium",children:u.payment_terms||"Net 30"})]})]}),(0,t.jsx)(Y.Separator,{}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"mb-4 text-xl font-semibold",children:"Invoice Details"}),(0,t.jsxs)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[(0,t.jsx)(v,{jobId:u.job_id,loadImmediately:!0}),(0,t.jsx)(H,{propertyId:u.job?.property_id||u.property_id}),(0,t.jsx)(J,{estimateId:u.converted_from_estimate_id,invoiceId:u.id,invoiceCreatedAt:u.created_at}),(0,t.jsx)(z,{invoiceId:u.id}),(0,t.jsx)(E,{customerId:u.customer_id}),(0,t.jsx)(g,{invoiceId:u.id,customerId:u.customer_id,jobId:u.job_id,companyId:m})]})]}),u.line_items&&u.line_items.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Y.Separator,{}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"mb-4 text-xl font-semibold",children:"Line Items"}),(0,t.jsx)("div",{className:"rounded-lg border",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-muted/50 border-b",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"p-3 text-left text-sm font-medium",children:"Item"}),(0,t.jsx)("th",{className:"p-3 text-right text-sm font-medium",children:"Qty"}),(0,t.jsx)("th",{className:"p-3 text-right text-sm font-medium",children:"Rate"}),(0,t.jsx)("th",{className:"p-3 text-right text-sm font-medium",children:"Amount"})]})}),(0,t.jsx)("tbody",{children:u.line_items.map((e,s)=>(0,t.jsxs)("tr",{className:"border-b last:border-0",children:[(0,t.jsxs)("td",{className:"p-3",children:[(0,t.jsx)("div",{className:"font-medium",children:e.description}),e.notes&&(0,t.jsx)("div",{className:"text-muted-foreground text-sm",children:e.notes})]}),(0,t.jsx)("td",{className:"p-3 text-right",children:e.quantity}),(0,t.jsx)("td",{className:"p-3 text-right",children:(0,j.formatCurrency)(e.rate||0)}),(0,t.jsx)("td",{className:"p-3 text-right font-medium",children:(0,j.formatCurrency)(e.amount||0)})]},s))})]})})]})]}),u.notes&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Y.Separator,{}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"mb-2 text-lg font-semibold",children:"Notes"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:u.notes})]})]}),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Y.Separator,{}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"mb-3 text-lg font-semibold",children:"Tags"}),(0,t.jsx)("div",{className:"bg-muted/50 rounded-md p-4",children:(0,t.jsx)(K.EntityTags,{entityId:d.id,entityType:"invoice",onUpdateTags:async(e,t)=>{let s=await (0,n.updateEntityTags)("invoice",e,t);s.success?l.refresh():r.toast.error(s.error||"Failed to update tags")},tags:h})})]})]})]})})}e.s(["InvoicePageContentOptimized",()=>Q],907276)}]);