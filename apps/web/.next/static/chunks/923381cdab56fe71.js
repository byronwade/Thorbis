(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,672573,e=>{"use strict";let t=(0,e.i(383206).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["default",()=>t])},15751,e=>{"use strict";var t=e.i(672573);e.s(["MapPin",()=>t.default])},969249,e=>{"use strict";let t=(0,e.i(383206).default)("navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);e.s(["default",()=>t])},332845,e=>{"use strict";var t=e.i(969249);e.s(["Navigation",()=>t.default])},960876,e=>{"use strict";function t(e,t){if(!e)return t||"Unknown Customer";if(e.display_name)return e.display_name;let a=e.first_name?.trim(),s=e.last_name?.trim();return a&&s?`${a} ${s}`:a||s||(e.company_name?e.company_name:e.email?e.email:t||"Unknown Customer")}function a(e){if(!e)return"?";let a=t(e).split(/\s+/).filter(Boolean);return a.length>=2?(a[0][0]+a[1][0]).toUpperCase():1===a.length&&a[0].length>=2?a[0].slice(0,2).toUpperCase():1===a.length?a[0][0].toUpperCase():"?"}e.s(["getCustomerDisplayName",()=>t,"getCustomerInitials",()=>a])},568185,e=>{"use strict";let t=(0,e.i(383206).default)("chevrons-up-down",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);e.s(["default",()=>t])},390929,e=>{"use strict";var t=e.i(568185);e.s(["ChevronsUpDown",()=>t.default])},438351,195100,e=>{"use strict";var t=e.i(552038),a=(0,t.createServerReference)("40f01c38bcd0dedd8819f5121a098e2ffd43eb6e19",t.callServer,void 0,t.findSourceMapURL,"createAppointment");e.s(["createAppointment",()=>a],438351);var s=e.i(111043),l=e.i(302324);e.i(670258);var r=e.i(921251);e.i(889265);var i=e.i(677607);e.i(733296);var n=e.i(993665);e.i(220474);var c=e.i(171056);e.i(254978);var o=e.i(375308),d=e.i(152088),u=e.i(960876),m=e.i(263942),h=e.i(79254),x=e.i(390929),p=e.i(641304),v=e.i(559586),g=e.i(939397),j=e.i(371526),y=e.i(287268),f=e.i(14435),b=e.i(970799);function C({value:e,onChange:t,placeholder:a="Search for customer...",className:C,showRecent:N=!0,recentCustomers:S=[],showCreateNew:k=!0,onCreateNew:w,disabled:M=!1,label:A,error:T=!1,errorMessage:D}){let[F,I]=(0,b.useState)(!1),[_,L]=(0,b.useState)(""),[U,P]=(0,b.useState)([]),[R,B]=(0,b.useState)(!1),[V,E]=(0,b.useState)(null);(0,b.useEffect)(()=>{if(_.trim().length<2){P([]),B(!1);return}B(!0);let e=setTimeout(async()=>{try{let e=await (0,l.searchCustomers)(_,{limit:10});if(e.success&&e.data){let t=Array.isArray(e.data)?e.data:[e.data];P(t)}else P([])}catch(e){console.error("Customer search error:",e),P([])}finally{B(!1)}},300);return()=>clearTimeout(e)},[_]);let H=(0,b.useCallback)(e=>{E(e),t(e.id,e),I(!1),L("")},[t]),$=(0,b.useCallback)(()=>{E(null),t(null,null),L("")},[t]),z=V?(0,u.getCustomerDisplayName)(V):a,O=(0,b.useMemo)(()=>{let e=new Map;return U.forEach(t=>e.set(t.id,t)),_.trim().length<2&&N&&S.forEach(t=>e.set(t.id,t)),Array.from(e.values())},[U,S,_,N]),q=({customer:t})=>{let a=(0,u.getCustomerDisplayName)(t),l=(0,u.getCustomerInitials)(t),i=e===t.id;return(0,s.jsxs)(n.CommandItem,{value:t.id,onSelect:()=>H(t),className:"flex items-center gap-3 px-3 py-2.5 cursor-pointer",children:[(0,s.jsx)(r.Avatar,{className:"h-8 w-8 shrink-0",children:(0,s.jsx)(r.AvatarFallback,{className:"text-xs font-semibold",children:l})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium text-sm truncate",children:a}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[t.email&&(0,s.jsxs)("span",{className:"flex items-center gap-1 truncate",children:[(0,s.jsx)(v.Mail,{className:"h-3 w-3 shrink-0"}),t.email]}),t.phone&&(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(g.Phone,{className:"h-3 w-3 shrink-0"}),t.phone]})]}),t.company_name&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground flex items-center gap-1 mt-0.5",children:[(0,s.jsx)(m.Building2,{className:"h-3 w-3 shrink-0"}),t.company_name]})]}),i&&(0,s.jsx)(h.Check,{className:"h-4 w-4 text-primary shrink-0"})]},t.id)};return(0,s.jsxs)("div",{className:(0,d.cn)("flex flex-col gap-1.5",C),children:[A&&(0,s.jsx)("label",{className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:A}),(0,s.jsxs)(c.Popover,{open:F,onOpenChange:I,children:[(0,s.jsx)(c.PopoverTrigger,{asChild:!0,children:(0,s.jsxs)(i.Button,{variant:"outline",role:"combobox","aria-expanded":F,disabled:M,className:(0,d.cn)("w-full justify-between",!V&&"text-muted-foreground",T&&"border-destructive focus-visible:ring-destructive"),children:[(0,s.jsx)("span",{className:"flex items-center gap-2 truncate",children:V?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.User,{className:"h-4 w-4 shrink-0"}),(0,s.jsx)("span",{className:"truncate",children:z})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.Search,{className:"h-4 w-4 shrink-0"}),(0,s.jsx)("span",{children:a})]})}),(0,s.jsx)(x.ChevronsUpDown,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,s.jsx)(c.PopoverContent,{className:"w-[400px] p-0",align:"start",children:(0,s.jsxs)(n.Command,{shouldFilter:!1,children:[(0,s.jsx)(n.CommandInput,{placeholder:"Search customers...",value:_,onValueChange:L}),(0,s.jsx)(n.CommandList,{children:R?(0,s.jsx)("div",{className:"flex items-center justify-center py-6",children:(0,s.jsx)(p.Loader2,{className:"h-5 w-5 animate-spin text-muted-foreground"})}):(0,s.jsxs)(s.Fragment,{children:[O.length>0?(0,s.jsx)(n.CommandGroup,{heading:_.trim().length>=2?"Search Results":N&&S.length>0?"Recent Customers":"All Customers",children:(0,s.jsx)(o.ScrollArea,{className:"max-h-[300px]",children:O.map(e=>(0,s.jsx)(q,{customer:e},e.id))})}):_.trim().length>=2?(0,s.jsx)(n.CommandEmpty,{children:"No customers found."}):N&&0===S.length?(0,s.jsx)(n.CommandEmpty,{children:"Start typing to search for customers..."}):null,k&&w&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.CommandSeparator,{}),(0,s.jsx)(n.CommandGroup,{children:(0,s.jsxs)(n.CommandItem,{onSelect:()=>{I(!1),w()},className:"flex items-center gap-2 px-3 py-2.5 cursor-pointer text-primary",children:[(0,s.jsx)(j.Plus,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"font-medium",children:"Create New Customer"})]})})]})]})}),V&&!M&&(0,s.jsx)("div",{className:"border-t p-2",children:(0,s.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:$,className:"w-full text-muted-foreground hover:text-destructive",children:"Clear Selection"})})]})})]}),T&&D&&(0,s.jsx)("p",{className:"text-sm text-destructive",children:D})]})}e.s(["CustomerAutocomplete",()=>C],195100)},373915,e=>{"use strict";var t=e.i(111043),a=e.i(438351),s=e.i(195100);e.i(889265);var l=e.i(677607);e.i(539870);var r=e.i(846358);e.i(51478);var i=e.i(635613);e.i(149989);var n=e.i(880177);e.i(868198);var c=e.i(798764);e.i(526120);var o=e.i(610120),d=e.i(152088),u=e.i(751139),m=e.i(276389),h=e.i(136764),x=e.i(641304),p=e.i(15751),v=e.i(14435),g=e.i(501651),j=e.i(970799),y=e.i(230902);let f=[{value:"emergency",label:"Emergency / Urgent",color:"text-red-500"},{value:"follow_up",label:"Callback / Follow Up",color:"text-orange-500"},{value:"maintenance",label:"Maintenance / Recurring",color:"text-purple-500"},{value:"installation",label:"Install / New Work",color:"text-green-500"},{value:"service_call",label:"Service Call",color:"text-blue-500"},{value:"inspection",label:"Inspection",color:"text-slate-500"},{value:"estimate",label:"Estimate",color:"text-amber-500"},{value:"repair",label:"Repair",color:"text-cyan-500"},{value:"winterization",label:"Winterization",color:"text-indigo-500"}],b=[{value:"low",label:"Low",color:"text-slate-500"},{value:"normal",label:"Normal",color:"text-blue-500"},{value:"high",label:"High",color:"text-orange-500"},{value:"urgent",label:"Urgent",color:"text-red-500"}],C=[{value:30,label:"30 min"},{value:60,label:"1 hour"},{value:90,label:"1.5 hours"},{value:120,label:"2 hours"},{value:180,label:"3 hours"},{value:240,label:"4 hours"},{value:480,label:"Full day"}];function N({open:e,onOpenChange:N,location:S,technicians:k=[],nearbyCustomers:w=[],onSuccess:M,onCreateCustomer:A,defaultTechnicianId:T,defaultDateTime:D,defaultDuration:F}){let[I,_]=(0,j.useTransition)(),[L,U]=(0,j.useState)(null),[P,R]=(0,j.useState)(null),[B,V]=(0,j.useState)(null),[E,H]=(0,j.useState)(""),[$,z]=(0,j.useState)("service_call"),[O,q]=(0,j.useState)("normal"),[W,G]=(0,j.useState)(""),[K,Q]=(0,j.useState)(60),[J,X]=(0,j.useState)("");(0,j.useEffect)(()=>{if(e){if(T&&G(T),D){let e=new Date,t=D;D<e&&((t=new Date).setMinutes(0,0,0),t.setHours(t.getHours()+1)),ee((0,y.format)(t,"yyyy-MM-dd'T'HH:mm"))}F&&Q([30,60,90,120,180,240,480].reduce((e,t)=>Math.abs(t-F)<Math.abs(e-F)?t:e))}},[e,T,D,F]);let Y=()=>{let e=new Date;return e.setMinutes(0,0,0),e.setHours(e.getHours()+1),e.toISOString().slice(0,16)},[Z,ee]=(0,j.useState)(Y()),et=(0,j.useCallback)(()=>{let e=new Date(Z);return e.setMinutes(e.getMinutes()+K),e.toISOString()},[Z,K]),ea=(0,j.useCallback)(()=>{R(null),V(null),H(""),z("service_call"),q("normal"),G(""),Q(60),X(""),ee(Y()),U(null)},[]),es=e=>{e||ea(),N(e)},el=async e=>{(e.preventDefault(),U(null),B)?E.trim()?_(async()=>{try{let e=new FormData;if(e.set("customerId",B),e.set("title",E.trim()),e.set("scheduledStart",new Date(Z).toISOString()),e.set("scheduledEnd",et()),e.set("type",$),e.set("priority",O),e.set("category","job_appointment"),W&&"unassigned"!==W&&e.set("assignedTo",W),J.trim()&&e.set("notes",J.trim()),S?.address){let t=J.trim(),a=`Location: ${S.address}`;e.set("notes",t?`${t}

${a}`:a)}let t=await (0,a.createAppointment)(e);t.success&&t.data?(M?.(t.data),es(!1)):U(t.error||"Failed to create appointment")}catch(e){console.error("Failed to create appointment:",e),U("An unexpected error occurred")}}):U("Please enter a title"):U("Please select a customer")};return(0,t.jsx)(r.Dialog,{open:e,onOpenChange:es,children:(0,t.jsxs)(r.DialogContent,{className:"sm:max-w-[500px]",children:[(0,t.jsxs)(r.DialogHeader,{children:[(0,t.jsxs)(r.DialogTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(m.Calendar,{className:"h-5 w-5 text-primary"}),"Quick Appointment"]}),(0,t.jsx)(r.DialogDescription,{children:S?.address?(0,t.jsxs)("span",{className:"flex items-center gap-1 text-sm",children:[(0,t.jsx)(p.MapPin,{className:"h-3.5 w-3.5"}),S.address]}):"Create a new appointment from the dispatch map"})]}),(0,t.jsxs)("form",{onSubmit:el,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"customer",children:"Customer *"}),(0,t.jsx)(s.CustomerAutocomplete,{value:B,onChange:(e,t)=>{if(V(e),R(t),t&&!E){let e=t.display_name||`${t.first_name||""} ${t.last_name||""}`.trim()||t.company_name||"Customer";H(`Service call - ${e}`)}},placeholder:"Search or select customer...",showCreateNew:!0,onCreateNew:A,showRecent:!0,recentCustomers:w,error:L?.includes("customer")})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"title",children:"Title *"}),(0,t.jsx)(i.Input,{id:"title",value:E,onChange:e=>H(e.target.value),placeholder:"e.g., AC Repair, Plumbing Inspection",className:(0,d.cn)(L?.includes("title")&&"border-destructive")})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"jobType",children:"Job Type"}),(0,t.jsxs)(c.Select,{value:$,onValueChange:z,children:[(0,t.jsx)(c.SelectTrigger,{id:"jobType",children:(0,t.jsx)(c.SelectValue,{})}),(0,t.jsx)(c.SelectContent,{children:f.map(e=>(0,t.jsx)(c.SelectItem,{value:e.value,children:(0,t.jsxs)("span",{className:(0,d.cn)("flex items-center gap-2",e.color),children:[(0,t.jsx)(g.Wrench,{className:"h-3.5 w-3.5"}),e.label]})},e.value))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"priority",children:"Priority"}),(0,t.jsxs)(c.Select,{value:O,onValueChange:q,children:[(0,t.jsx)(c.SelectTrigger,{id:"priority",children:(0,t.jsx)(c.SelectValue,{})}),(0,t.jsx)(c.SelectContent,{children:b.map(e=>(0,t.jsx)(c.SelectItem,{value:e.value,children:(0,t.jsxs)("span",{className:(0,d.cn)("flex items-center gap-2",e.color),children:["urgent"===e.value&&(0,t.jsx)(u.AlertTriangle,{className:"h-3.5 w-3.5"}),e.label]})},e.value))})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"scheduledStart",children:"Date & Time"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(h.Clock,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,t.jsx)(i.Input,{id:"scheduledStart",type:"datetime-local",value:Z,onChange:e=>ee(e.target.value),className:"pl-9"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"duration",children:"Duration"}),(0,t.jsxs)(c.Select,{value:K.toString(),onValueChange:e=>Q(Number(e)),children:[(0,t.jsx)(c.SelectTrigger,{id:"duration",children:(0,t.jsx)(c.SelectValue,{})}),(0,t.jsx)(c.SelectContent,{children:C.map(e=>(0,t.jsx)(c.SelectItem,{value:e.value.toString(),children:e.label},e.value))})]})]})]}),k.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"technician",children:"Assign Technician"}),(0,t.jsxs)(c.Select,{value:W,onValueChange:G,children:[(0,t.jsx)(c.SelectTrigger,{id:"technician",children:(0,t.jsx)(c.SelectValue,{placeholder:"Select technician (optional)"})}),(0,t.jsxs)(c.SelectContent,{children:[(0,t.jsx)(c.SelectItem,{value:"unassigned",children:"Unassigned"}),k.map(e=>(0,t.jsx)(c.SelectItem,{value:e.id,children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(v.User,{className:"h-3.5 w-3.5"}),e.name]})},e.id))]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"notes",children:"Notes"}),(0,t.jsx)(o.Textarea,{id:"notes",value:J,onChange:e=>X(e.target.value),placeholder:"Additional notes or instructions...",rows:2})]}),L&&(0,t.jsx)("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:L}),(0,t.jsxs)(r.DialogFooter,{children:[(0,t.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>es(!1),disabled:I,children:"Cancel"}),(0,t.jsx)(l.Button,{type:"submit",disabled:I||!B,children:I?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create Appointment"})]})]})]})})}e.s(["QuickAppointmentDialog",()=>N])},456788,e=>{"use strict";let t=(0,e.i(383206).default)("route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);e.s(["default",()=>t])},520824,e=>{"use strict";var t=e.i(456788);e.s(["Route",()=>t.default])},784601,e=>{"use strict";let t=(0,e.i(383206).default)("cloud-rain",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]]);e.s(["default",()=>t])},964529,e=>{"use strict";var t=e.i(784601);e.s(["CloudRain",()=>t.default])},555251,216622,e=>{"use strict";var t=e.i(383206);let a=(0,t.default)("battery-medium",[["path",{d:"M10 14v-4",key:"suye4c"}],["path",{d:"M22 14v-4",key:"14q9d5"}],["path",{d:"M6 14v-4",key:"14a6bd"}],["rect",{x:"2",y:"6",width:"16",height:"12",rx:"2",key:"13zb55"}]]);e.s(["default",()=>a],555251);let s=(0,t.default)("locate",[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}]]);e.s(["default",()=>s],216622)},305770,e=>{"use strict";let t=(0,e.i(383206).default)("battery",[["path",{d:"M 22 14 L 22 10",key:"nqc4tb"}],["rect",{x:"2",y:"6",width:"16",height:"12",rx:"2",key:"13zb55"}]]);e.s(["default",()=>t])},789942,e=>{"use strict";let t=(0,e.i(383206).default)("battery-low",[["path",{d:"M22 14v-4",key:"14q9d5"}],["path",{d:"M6 14v-4",key:"14a6bd"}],["rect",{x:"2",y:"6",width:"16",height:"12",rx:"2",key:"13zb55"}]]);e.s(["default",()=>t])},311089,e=>{"use strict";let t=(0,e.i(383206).default)("signal",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]]);e.s(["default",()=>t])},874283,e=>{"use strict";var t=e.i(311089);e.s(["Signal",()=>t.default])},4975,907820,e=>{"use strict";var t=e.i(305770);e.s(["Battery",()=>t.default],4975);var a=e.i(789942);e.s(["BatteryLow",()=>a.default],907820)}]);