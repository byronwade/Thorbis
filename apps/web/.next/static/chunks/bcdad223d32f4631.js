(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,52573,e=>{"use strict";let t=(0,e.i(383206).default)("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);e.s(["default",()=>t])},694288,e=>{"use strict";var t=e.i(52573);e.s(["Link",()=>t.default])},519131,e=>{"use strict";let t=(0,e.i(383206).default)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);e.s(["default",()=>t])},233654,e=>{"use strict";var t=e.i(519131);e.s(["Paperclip",()=>t.default])},711448,e=>{"use strict";e.i(116233),e.s([])},305549,585506,e=>{"use strict";var t=e.i(111043),s=e.i(868422),a=e.i(227009);e.i(670258);var l=e.i(921251);e.i(711448);var i=e.i(157222);function r({activities:e}){return e&&0!==e.length?(0,t.jsx)(i.UnifiedAccordionContent,{children:(0,t.jsx)("div",{className:"max-h-96 space-y-3 overflow-y-auto",children:e.map(e=>(0,t.jsxs)("div",{className:"hover:bg-muted/50 flex gap-3 rounded-lg border p-3 transition-colors",children:[(0,t.jsxs)(l.Avatar,{className:"size-8 flex-shrink-0",children:[(0,t.jsx)(l.AvatarImage,{src:e.user?.avatar}),(0,t.jsx)(l.AvatarFallback,{children:e.user?.name?.charAt(0)||"?"})]}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"text-sm break-words",children:e.description}),(0,t.jsxs)("p",{className:"text-muted-foreground mt-1 text-xs",children:[e.user?.name," •"," ",(0,s.formatDistance)(new Date(e.created_at),new Date,{addSuffix:!0})]})]})]},e.id))})}):(0,t.jsx)(i.UnifiedAccordionContent,{children:(0,t.jsx)("div",{className:"flex h-32 items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(a.Activity,{className:"text-muted-foreground/50 mx-auto size-8"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No activity yet"})]})})})}e.s(["ActivityLogSection",()=>r],305549);var n=e.i(882896),d=e.i(606661),c=e.i(233654),o=e.i(371526),m=e.i(826463),x=e.i(970799);e.i(889265);var u=e.i(677607),h=e.i(51052);function g({attachments:e,entityType:s,entityId:a,onUpload:l}){let{toast:r}=(0,h.useToast)(),[g,f]=(0,x.useState)(!1),p=async e=>{let t=e.target.files;if(t&&0!==t.length){f(!0);try{l&&await l(t),r.success(`${t.length} file(s) uploaded successfully`)}catch(e){r.error("Failed to upload files")}finally{f(!1),e.target.value=""}}};return(0,t.jsx)(i.UnifiedAccordionContent,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[l&&(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{className:"hidden",disabled:g,id:"file-upload",multiple:!0,onChange:p,type:"file"}),(0,t.jsx)("label",{htmlFor:"file-upload",children:(0,t.jsx)(u.Button,{asChild:!0,className:"w-full cursor-pointer",disabled:g,size:"sm",variant:"outline",children:(0,t.jsx)("span",{children:g?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Upload,{className:"mr-2 size-4 animate-pulse"}),"Uploading..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Plus,{className:"mr-2 size-4"}),"Upload Files"]})})})})]}),e&&e.length>0?(0,t.jsx)("div",{className:"space-y-2",children:e.map(e=>(0,t.jsxs)("div",{className:"hover:bg-muted/50 flex items-center justify-between rounded-lg border p-3 transition-colors",children:[(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 items-center gap-3",children:[(0,t.jsx)(d.FileText,{className:"text-muted-foreground size-4 flex-shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"truncate text-sm font-medium",children:e.original_file_name||e.file_name||"Untitled"}),(0,t.jsxs)("p",{className:"text-muted-foreground text-xs",children:[e.file_size?`${(e.file_size/1024).toFixed(1)} KB`:"",e.category&&` • ${e.category}`]})]})]}),(0,t.jsx)(u.Button,{asChild:!0,className:"flex-shrink-0",size:"sm",variant:"ghost",children:(0,t.jsx)("a",{download:!0,href:e.storage_url||e.url,rel:"noopener noreferrer",target:"_blank",children:(0,t.jsx)(n.Download,{className:"size-4"})})})]},e.id))}):(0,t.jsx)("div",{className:"flex h-32 items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(c.Paperclip,{className:"text-muted-foreground/50 mx-auto size-8"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No attachments yet"})]})})]})})}e.s(["AttachmentsSection",()=>g],585506)},821305,278633,e=>{"use strict";var t=e.i(111043),s=e.i(227009),a=e.i(606661),l=e.i(694288),i=e.i(233654),r=e.i(702948),n=e.i(152088);function d({header:e,customHeader:s,metadata:a,beforeContent:l,afterContent:i,children:r,className:d,contentGapClassName:c,statsBar:o}){let m=a??e?.metadata??[];return(0,t.jsxs)("div",{className:(0,n.cn)("flex w-full flex-col gap-4 pb-24 lg:gap-5",d),"data-detail-shell":"",children:[o,s??(e?(0,t.jsx)(x,{section:e}):null),m.length>0?(0,t.jsx)(u,{items:m}):null,l,r?(0,t.jsx)("div",{className:(0,n.cn)("flex flex-col gap-4",c),children:r}):null,i]})}let c={none:"p-0",sm:"p-4",md:"p-6",lg:"p-8"},o={default:"border border-border/60 bg-card shadow-sm",muted:"border border-border/60 bg-muted/40 shadow-sm",subtle:"border border-border/40 bg-card/80 shadow-sm",ghost:"border border-border/50 bg-transparent shadow-none"};function m({children:e,className:s,padding:a="md",variant:l="default"}){return(0,t.jsx)("section",{className:(0,n.cn)("rounded-xl",o[l],s),children:(0,t.jsx)("div",{className:(0,n.cn)("flex flex-col gap-4",c[a]),children:e})})}function x({section:e}){var s;let{breadcrumbs:a,leadingVisual:l,title:i,subtitle:r,description:n,badges:d,actions:c,secondaryActions:o}=e;return(0,t.jsxs)("header",{className:"flex flex-col gap-4 lg:gap-6",children:[a?(0,t.jsx)("div",{className:"text-muted-foreground text-sm",children:a}):null,(0,t.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between lg:gap-8",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsx)("div",{className:"flex flex-col gap-3",children:(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:gap-4",children:[l?(0,t.jsx)("div",{className:"flex items-center justify-center",children:l}):null,(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(s=i)?"string"==typeof s?(0,t.jsx)("h1",{className:"text-2xl font-semibold tracking-tight md:text-3xl",children:s}):(0,t.jsx)("div",{className:"text-2xl font-semibold tracking-tight md:text-3xl",children:s}):null,r?(0,t.jsx)("div",{className:"text-muted-foreground max-w-3xl text-sm md:text-base",children:r}):null]})]}),n?(0,t.jsx)("div",{className:"text-muted-foreground max-w-3xl text-sm",children:n}):null]})}),d&&d.length>0?(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:d}):null]}),h(c,o)?(0,t.jsxs)("div",{className:"hidden flex-wrap items-center gap-2 lg:flex",children:[c?.map((e,s)=>(0,t.jsx)("span",{className:"inline-flex",children:e},s)),o?.map((e,s)=>(0,t.jsx)("span",{className:"inline-flex",children:e},`secondary-${s}`))]}):null]}),h(c,o)?(0,t.jsxs)("div",{className:"flex flex-col gap-2 lg:hidden",children:[c&&c.length>0?(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:c.map((e,s)=>(0,t.jsx)("span",{className:"flex-1",children:e},s))}):null,o&&o.length>0?(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:o.map((e,s)=>(0,t.jsx)("span",{className:"flex-1",children:e},`secondary-mobile-${s}`))}):null]}):null]})}function u({items:e}){return(0,t.jsx)("section",{className:"@xl-page:grid-cols-4 grid grid-cols-1 gap-4 md:grid-cols-2",children:e.map((e,s)=>(0,t.jsxs)("div",{className:"border-border/50 bg-card/60 flex flex-col gap-1 rounded-lg border px-4 py-3 shadow-sm",children:[(0,t.jsxs)("span",{className:"text-muted-foreground flex items-center gap-2 text-xs font-medium tracking-wide uppercase",children:[e.icon,e.label]}),(0,t.jsx)("div",{className:"text-foreground text-sm font-semibold",children:e.value}),e.helperText?(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:e.helperText}):null]},s))})}function h(e,t){return!!(e&&e.length>0||t&&t.length>0)}e.s(["DetailPageShell",()=>d,"DetailPageSurface",()=>m],278633);var g=e.i(305549),f=e.i(585506),p=e.i(868422),j=e.i(371526),b=e.i(970799);e.i(670258);var v=e.i(921251);e.i(889265);var N=e.i(677607);e.i(526120);var y=e.i(610120);e.i(711448);var k=e.i(157222),w=e.i(51052);function C({notes:e,entityType:s,entityId:l,onAddNote:i}){let{toast:r}=(0,w.useToast)(),[n,d]=(0,b.useState)(!1),[c,o]=(0,b.useState)(""),[m,x]=(0,b.useState)(!1),u=async()=>{if(i){if(!c.trim())return void r.error("Please enter a note");x(!0);try{await i(c),r.success("Note added successfully"),o(""),d(!1)}catch(e){r.error("Failed to add note")}finally{x(!1)}}};return(0,t.jsx)(k.UnifiedAccordionContent,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[i&&(n?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(y.Textarea,{autoFocus:!0,onChange:e=>o(e.target.value),placeholder:"Enter your note...",rows:3,value:c}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(N.Button,{disabled:m,onClick:u,size:"sm",children:m?"Saving...":"Save Note"}),(0,t.jsx)(N.Button,{onClick:()=>{d(!1),o("")},size:"sm",variant:"outline",children:"Cancel"})]})]}):(0,t.jsxs)(N.Button,{className:"w-full",onClick:()=>d(!0),size:"sm",variant:"outline",children:[(0,t.jsx)(j.Plus,{className:"mr-2 size-4"}),"Add Note"]})),e&&e.length>0?(0,t.jsx)("div",{className:"space-y-3",children:e.map(e=>(0,t.jsx)("div",{className:"hover:bg-muted/50 rounded-lg border p-3 transition-colors",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)(v.Avatar,{className:"size-8 flex-shrink-0",children:[(0,t.jsx)(v.AvatarImage,{src:e.user?.avatar}),(0,t.jsx)(v.AvatarFallback,{children:e.user?.name?.charAt(0)||"?"})]}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("p",{className:"text-xs font-medium",children:e.user?.name}),(0,t.jsx)("p",{className:"text-muted-foreground text-xs",children:(0,p.formatDistance)(new Date(e.created_at),new Date,{addSuffix:!0})})]}),(0,t.jsx)("p",{className:"mt-1 text-sm break-words whitespace-pre-wrap",children:e.content||e.note})]})]})},e.id))}):(0,t.jsx)("div",{className:"flex h-32 items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(a.FileText,{className:"text-muted-foreground/50 mx-auto size-8"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No notes yet"})]})})]})})}var S=e.i(87912),T=e.i(176378);e.i(553153);var A=e.i(363712);function _({relatedItems:e}){return e&&0!==e.length?(0,t.jsx)(k.UnifiedAccordionContent,{children:(0,t.jsx)("div",{className:"space-y-2",children:e.map(e=>(0,t.jsxs)(T.default,{className:"group hover:bg-muted/50 flex items-center justify-between rounded-lg border p-3 transition-colors",href:e.href,children:[(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"truncate text-sm font-medium",children:e.title}),e.badge&&(0,t.jsx)(A.Badge,{className:"flex-shrink-0",variant:e.badge.variant||"default",children:e.badge.label})]}),e.subtitle&&(0,t.jsx)("p",{className:"text-muted-foreground truncate text-xs",children:e.subtitle})]}),(0,t.jsx)(S.ChevronRight,{className:"text-muted-foreground size-4 flex-shrink-0 transition-transform group-hover:translate-x-0.5"})]},e.id))})}):(0,t.jsx)(k.UnifiedAccordionContent,{children:(0,t.jsx)("div",{className:"flex h-32 items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(l.Link,{className:"text-muted-foreground/50 mx-auto size-8"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No related items"})]})})})}let z=(0,r.default)(()=>e.A(134181).then(e=>e.UnifiedAccordion),{loadableGenerated:{modules:[388024]},ssr:!1});function D({header:e,customHeader:r,customSections:c,activities:o=[],notes:x=[],attachments:u=[],relatedItems:h=[],showStandardSections:p={activities:!0,notes:!0,attachments:!0,relatedItems:!0},className:j,defaultOpenSection:b,beforeContent:v,afterContent:N,statsBar:y,contentGapClassName:k,surfacePadding:w="none",surfaceVariant:S="default",surfaceClassName:T,storageKey:A,enableReordering:D=!0}){let F=[];!1!==p.activities&&F.push({id:"activity-log",title:"Activity Log",icon:(0,t.jsx)(s.Activity,{className:"size-4"}),count:o.length,content:(0,t.jsx)(g.ActivityLogSection,{activities:o})}),!1!==p.notes&&F.push({id:"notes",title:"Notes",icon:(0,t.jsx)(a.FileText,{className:"size-4"}),count:x.length,content:(0,t.jsx)(C,{notes:x})}),!1!==p.attachments&&F.push({id:"attachments",title:"Attachments",icon:(0,t.jsx)(i.Paperclip,{className:"size-4"}),count:u.length,content:(0,t.jsx)(f.AttachmentsSection,{attachments:u})}),!1!==p.relatedItems&&h.length>0&&F.push({id:"related-items",title:"Related Items",icon:(0,t.jsx)(l.Link,{className:"size-4"}),count:h.length,content:(0,t.jsx)(_,{relatedItems:h})});let U=[...c||[],...F];return(0,t.jsx)(d,{afterContent:N,beforeContent:v,className:(0,n.cn)("w-full",j),contentGapClassName:k??"gap-4",customHeader:r,header:e,statsBar:y,children:(0,t.jsx)(m,{className:(0,n.cn)("overflow-hidden",T),padding:w,variant:S,children:(0,t.jsx)(z,{defaultOpenSection:b||U[0]?.id,enableReordering:D,sections:U,storageKey:A})})})}e.s(["DetailPageContentLayout",()=>D],821305)},431111,e=>{"use strict";var t=e.i(111043),s=e.i(904653),a=e.i(970799),l=e.i(146798);function i({stats:e,children:i}){let r=(0,s.usePathname)()||"/dashboard",n=(0,l.useToolbarStatsStore)(e=>e.setStats),d=(0,l.useToolbarStatsStore)(e=>e.clearStats);return(0,a.useLayoutEffect)(()=>(e?n(r,e):d(r),()=>{d(r)}),[r,e,n,d]),(0,t.jsx)(t.Fragment,{children:i})}e.s(["ToolbarStatsProvider",()=>i])},213075,e=>{"use strict";let t=(0,e.i(383206).default)("receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);e.s(["default",()=>t])},868106,e=>{"use strict";var t=e.i(213075);e.s(["Receipt",()=>t.default])},6130,e=>{"use strict";e.i(116233),e.s([])},235670,e=>{"use strict";e.i(116233),e.s([])},49718,307033,e=>{"use strict";var t=e.i(552038),s=(0,t.createServerReference)("70ff12ee81a60340f786414d0baa7af58484dd7488",t.callServer,void 0,t.findSourceMapURL,"updateEntityTags");e.s(["updateEntityTags",()=>s],49718);var a=e.i(111043),l=e.i(371526),i=e.i(540374),r=e.i(212409),n=e.i(904653),d=e.i(970799),c=e.i(995403);e.i(235670);var o=e.i(360648);e.i(889265);var m=e.i(677607);e.i(51478);var x=e.i(635613);e.i(149989);var u=e.i(880177);e.i(220474);var h=e.i(171056);e.i(868198);var g=e.i(798764),f=e.i(220168);let p=[{name:"Red",value:"red",class:"bg-red-100 text-red-700 border-red-200 dark:bg-red-900/20 dark:text-red-400 dark:border-red-900/30"},{name:"Orange",value:"orange",class:"bg-orange-100 text-orange-700 border-orange-200 dark:bg-orange-900/20 dark:text-orange-400 dark:border-orange-900/30"},{name:"Amber",value:"amber",class:"bg-amber-100 text-amber-700 border-amber-200 dark:bg-amber-900/20 dark:text-amber-400 dark:border-amber-900/30"},{name:"Yellow",value:"yellow",class:"bg-yellow-100 text-yellow-700 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-400 dark:border-yellow-900/30"},{name:"Green",value:"green",class:"bg-green-100 text-green-700 border-green-200 dark:bg-green-900/20 dark:text-green-400 dark:border-green-900/30"},{name:"Emerald",value:"emerald",class:"bg-emerald-100 text-emerald-700 border-emerald-200 dark:bg-emerald-900/20 dark:text-emerald-400 dark:border-emerald-900/30"},{name:"Teal",value:"teal",class:"bg-teal-100 text-teal-700 border-teal-200 dark:bg-teal-900/20 dark:text-teal-400 dark:border-teal-900/30"},{name:"Blue",value:"blue",class:"bg-blue-100 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-900/30"},{name:"Indigo",value:"indigo",class:"bg-indigo-100 text-indigo-700 border-indigo-200 dark:bg-indigo-900/20 dark:text-indigo-400 dark:border-indigo-900/30"},{name:"Purple",value:"purple",class:"bg-purple-100 text-purple-700 border-purple-200 dark:bg-purple-900/20 dark:text-purple-400 dark:border-purple-900/30"},{name:"Pink",value:"pink",class:"bg-pink-100 text-pink-700 border-pink-200 dark:bg-pink-900/20 dark:text-pink-400 dark:border-pink-900/30"},{name:"Gray",value:"gray",class:"bg-gray-100 text-gray-700 border-gray-200 dark:bg-gray-900/20 dark:text-gray-400 dark:border-gray-900/30"}],j=p.reduce((e,t)=>({...e,[t.value]:t.class}),{});function b({entityId:e,entityType:t,tags:s,onUpdateTags:b,readOnly:v=!1}){(0,n.useRouter)();let[N,y]=(0,d.useState)(!1),[k,w]=(0,d.useState)(""),[C,S]=(0,d.useState)("blue"),[T,A]=(0,d.useState)(!1),[_,z]=(0,d.useState)(null),D=e=>"string"==typeof e?e:e.label,F=async()=>{if(!k.trim())return void c.toast.error("Please enter a tag name");A(!0);try{let t={label:k.trim(),color:C},a=[...s,t],l=await b(e,a);l.success?(c.toast.success("Tag added"),y(!1),w(""),S("blue")):c.toast.error(l.error||"Failed to add tag")}catch(e){c.toast.error("Failed to add tag")}finally{A(!1)}},U=async t=>{try{let a=s.filter(e=>{let s=D(e),a=D(t);return s!==a}),l=await b(e,a);l.success?c.toast.success("Tag removed"):c.toast.error(l.error||"Failed to remove tag")}catch(e){c.toast.error("Failed to remove tag")}finally{z(null)}},$=p.find(e=>e.value===C);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[s.map((e,t)=>{let s=D(e),l="string"==typeof e?void 0:e.color,n=l&&j[l]?j[l]:j.blue;return(0,a.jsxs)("div",{className:`inline-flex items-center gap-1.5 rounded-full border px-3 py-1.5 text-sm font-medium transition-colors ${n}`,children:[(0,a.jsx)(i.Tag,{className:"size-3"}),(0,a.jsx)("span",{children:s}),!v&&(0,a.jsx)(m.Button,{className:"ml-1 size-4 p-0 hover:bg-black/10 dark:hover:bg-white/10",onClick:()=>z(e),size:"icon",variant:"ghost",children:(0,a.jsx)(r.X,{className:"size-3"})})]},`${s}-${t}`)}),!v&&(0,a.jsxs)(h.Popover,{onOpenChange:y,open:N,children:[(0,a.jsx)(h.PopoverTrigger,{asChild:!0,children:(0,a.jsxs)("button",{className:"border-border/60 bg-background hover:border-primary/50 hover:bg-primary/5 inline-flex items-center gap-1.5 rounded-full border border-dashed px-3 py-1.5 text-sm font-medium transition-colors",children:[(0,a.jsx)(l.Plus,{className:"size-3"}),(0,a.jsx)("span",{children:"Add Tag"})]})}),(0,a.jsx)(h.PopoverContent,{align:"start",className:"w-80",side:"bottom",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-semibold",children:"Create Custom Tag"}),(0,a.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Add a custom tag for this ",t]})]}),(0,a.jsx)(f.StandardFormField,{label:"Tag Name",htmlFor:"tag-label",children:(0,a.jsx)(x.Input,{id:"tag-label",onChange:e=>w(e.target.value),onKeyDown:e=>{"Enter"===e.key&&F()},placeholder:"e.g., High Priority, VIP, etc.",value:k})}),(0,a.jsx)(f.StandardFormField,{label:"Color",htmlFor:"tag-color",children:(0,a.jsxs)(g.Select,{onValueChange:S,value:C,children:[(0,a.jsx)(g.SelectTrigger,{id:"tag-color",children:(0,a.jsx)(g.SelectValue,{children:$&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:`h-4 w-4 rounded-full ${$.class}`}),(0,a.jsx)("span",{children:$.name})]})})}),(0,a.jsx)(g.SelectContent,{children:p.map(e=>(0,a.jsx)(g.SelectItem,{value:e.value,children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:`h-4 w-4 rounded-full ${e.class}`}),(0,a.jsx)("span",{children:e.name})]})},e.value))})]})}),k&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.Label,{children:"Preview"}),(0,a.jsxs)("div",{className:`inline-flex items-center gap-1.5 rounded-full border px-3 py-1.5 text-sm font-medium ${$?.class}`,children:[(0,a.jsx)(i.Tag,{className:"size-3"}),(0,a.jsx)("span",{children:k})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(m.Button,{className:"flex-1",onClick:()=>y(!1),variant:"outline",children:"Cancel"}),(0,a.jsx)(m.Button,{className:"flex-1",disabled:T||!k.trim(),onClick:F,children:T?"Saving...":"Add Tag"})]})]})})]})]}),(0,a.jsx)(o.AlertDialog,{onOpenChange:()=>z(null),open:!!_,children:(0,a.jsxs)(o.AlertDialogContent,{children:[(0,a.jsxs)(o.AlertDialogHeader,{children:[(0,a.jsx)(o.AlertDialogTitle,{children:"Remove Tag"}),(0,a.jsxs)(o.AlertDialogDescription,{children:['Are you sure you want to remove the tag "',_?D(_):"",'"? This action cannot be undone.']})]}),(0,a.jsxs)(o.AlertDialogFooter,{children:[(0,a.jsx)(o.AlertDialogCancel,{children:"Cancel"}),(0,a.jsx)(o.AlertDialogAction,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:()=>_&&U(_),children:"Remove"})]})]})})]})}e.s(["EntityTags",()=>b],307033)},933234,e=>{"use strict";var t=e.i(970799);function s(e){(0,t.useEffect)(()=>{let t=t=>{if(!t.ctrlKey||t.shiftKey||t.altKey||t.metaKey)return;let s=e[t.key];s&&(t.preventDefault(),s())};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[e])}e.s(["useSectionShortcuts",()=>s])},403953,e=>{"use strict";let t=(0,e.i(383206).default)("file-check",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);e.s(["default",()=>t])},588477,e=>{"use strict";var t=e.i(403953);e.s(["FileCheck",()=>t.default])},14886,e=>{"use strict";e.i(116233),e.s([])},753741,e=>{"use strict";var t=e.i(552038),s=(0,t.createServerReference)("40e2aa0d05076ccd3498ded44cdcc1b488052809cf",t.callServer,void 0,t.findSourceMapURL,"unlinkJobFromEstimate");e.s(["unlinkJobFromEstimate",()=>s])},363855,e=>{"use strict";let t=(0,e.i(383206).default)("link-2-off",[["path",{d:"M9 17H7A5 5 0 0 1 7 7",key:"10o201"}],["path",{d:"M15 7h2a5 5 0 0 1 4 8",key:"1d3206"}],["line",{x1:"8",x2:"12",y1:"12",y2:"12",key:"rvw6j4"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);e.s(["default",()=>t])},825893,e=>{"use strict";var t=e.i(363855);e.s(["Link2Off",()=>t.default])},617196,e=>{"use strict";var t=e.i(111043),s=e.i(276389),a=e.i(588477),l=e.i(606661),i=e.i(825893),r=e.i(60179),n=e.i(868106),d=e.i(697029),c=e.i(14435),o=e.i(176378),m=e.i(904653),x=e.i(970799),u=e.i(995403),h=e.i(49718),g=e.i(753741),f=e.i(821305),p=e.i(307033);e.i(553153);var j=e.i(363712);e.i(889265);var b=e.i(677607);e.i(539870);var v=e.i(846358);e.i(149989);var N=e.i(880177);e.i(6130);var y=e.i(506806);e.i(711448);var k=e.i(157222);e.i(14886);var w=e.i(362501),C=e.i(933234);function S(e){return null==e?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e/100)}function T({entityData:e}){var T;let A,_=(0,m.useRouter)(),[z,D]=(0,x.useState)(null),[F,U]=(0,x.useState)(!1),{estimate:$,customer:P,job:L,invoice:I,contract:R,notes:B=[],activities:E=[],attachments:V=[]}=e,q=(0,x.useMemo)(()=>$?.estimate_tags?$.estimate_tags.map(e=>({id:e.id,name:e.name,slug:e.slug,color:e.color,category:e.category,icon:e.icon})):[],[$?.estimate_tags]),M=(0,x.useMemo)(()=>({1:()=>{let e=document.querySelector('[data-section-id="workflow-timeline"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let t=e.querySelector("[data-accordion-trigger]");t&&"closed"===t.getAttribute("data-state")&&t.click()}},2:()=>{let e=document.querySelector('[data-section-id="estimate-details"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let t=e.querySelector("[data-accordion-trigger]");t&&"closed"===t.getAttribute("data-state")&&t.click()}},3:()=>{let e=document.querySelector('[data-section-id="line-items"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let t=e.querySelector("[data-accordion-trigger]");t&&"closed"===t.getAttribute("data-state")&&t.click()}},4:()=>{let e=document.querySelector('[data-section-id="customer"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let t=e.querySelector("[data-accordion-trigger]");t&&"closed"===t.getAttribute("data-state")&&t.click()}},5:()=>{let e=document.querySelector('[data-section-id="job"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let t=e.querySelector("[data-accordion-trigger]");t&&"closed"===t.getAttribute("data-state")&&t.click()}},9:()=>{let e=document.querySelector('[data-section-id="tags"]');if(e){e.scrollIntoView({behavior:"smooth",block:"start"});let t=e.querySelector("[data-accordion-trigger]");t&&"closed"===t.getAttribute("data-state")&&t.click()}}}),[]);(0,C.useSectionShortcuts)(M);let O=async()=>{if(z){U(!0);try{let e=await (0,g.unlinkJobFromEstimate)($.id);e.success?(u.toast.success("Job unlinked from estimate"),D(null),_.refresh()):u.toast.error(e.error||"Failed to unlink job")}catch(e){u.toast.error("Failed to unlink job")}finally{U(!1)}}},H=$.line_items?"string"==typeof $.line_items?JSON.parse($.line_items):$.line_items:[],J=[(T=$.status||"draft",A=({draft:{className:"bg-muted text-foreground dark:bg-foreground/20 dark:text-muted-foreground",label:"Draft"},sent:{className:"bg-primary text-primary dark:bg-primary/20 dark:text-primary",label:"Sent"},viewed:{className:"bg-accent text-accent-foreground dark:bg-accent/20 dark:text-accent-foreground",label:"Viewed"},accepted:{className:"bg-success text-white",label:"Accepted"},declined:{className:"bg-destructive text-white",label:"Declined"},expired:{className:"bg-warning text-white",label:"Expired"}})[T]||{className:"bg-muted text-foreground",label:T},(0,t.jsx)(j.Badge,{className:A.className,variant:"outline",children:A.label},"status"))],K=(0,t.jsx)("div",{className:"w-full px-2 sm:px-0",children:(0,t.jsx)("div",{className:"bg-muted/50 rounded-md shadow-sm",children:(0,t.jsxs)("div",{className:"flex flex-col gap-4 p-4 sm:p-6",children:[(0,t.jsx)("div",{className:"flex flex-col gap-6 sm:flex-row sm:items-start sm:justify-between",children:(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:J}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold sm:text-3xl",children:$.title||`Estimate ${$.estimate_number||$.id.slice(0,8)}`}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm sm:text-base",children:S($.total_amount)})]})]})}),P&&(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:(0,t.jsxs)(o.default,{className:"border-border/60 bg-background hover:border-primary/50 hover:bg-primary/5 inline-flex items-center gap-2 rounded-full border px-4 py-2 text-sm font-medium transition-colors",href:`/dashboard/customers/${P.id}`,children:[(0,t.jsx)(c.User,{className:"size-4"}),P.display_name||`${P.first_name||""} ${P.last_name||""}`.trim()||"Unknown Customer"]})}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[$.valid_until&&(0,t.jsxs)("div",{className:"bg-muted inline-flex items-center gap-2 rounded-full px-3 py-1 text-sm",children:[(0,t.jsx)(s.Calendar,{className:"text-muted-foreground size-4"}),(0,t.jsxs)("span",{className:"font-medium",children:["Valid until"," ",new Date($.valid_until).toLocaleDateString()]})]}),L&&(0,t.jsxs)(o.default,{className:"bg-muted hover:bg-muted/80 inline-flex items-center gap-2 rounded-full px-3 py-1 text-sm transition-colors",href:`/dashboard/work/${L.id}`,children:[(0,t.jsx)(l.FileText,{className:"text-muted-foreground size-4"}),(0,t.jsxs)("span",{className:"font-medium",children:["Job #",L.job_number]})]})]})]})})}),G=(0,x.useMemo)(()=>{let e=[];if(R||I){let s=[{id:"estimate",label:"Estimate Created",status:"completed",date:$.created_at,href:`/dashboard/work/estimates/${$.id}`,description:"accepted"===$.status?"Accepted by customer":void 0},{id:"contract",label:"Contract Generated",status:R?"completed":"pending",date:R?.created_at,href:R?`/dashboard/work/contracts/${R.id}`:void 0,description:R?.status==="signed"?"Signed":R?"Pending signature":void 0},{id:"invoice",label:"Invoice Created",status:I?"completed":"pending",date:I?.created_at,href:I?`/dashboard/work/invoices/${I.id}`:void 0,description:I?.status==="paid"?"Paid in full":I?`Status: ${I.status}`:void 0},{id:"payment",label:"Payment Received",status:I?.status==="paid"?"completed":I?"current":"pending",date:I?.paid_at,description:I?.paid_at?"Completed":I?`Balance: ${S(I.balance_amount)}`:void 0}];e.push({id:"workflow-timeline",title:"Sales Workflow",icon:(0,t.jsx)(d.TrendingUp,{className:"size-4"}),defaultOpen:!0,content:(0,t.jsx)(k.UnifiedAccordionContent,{children:(0,t.jsx)(w.WorkflowTimeline,{stages:s})})})}return e.push({id:"line-items",title:"Line Items",icon:(0,t.jsx)(l.FileText,{className:"size-4"}),count:H.length,defaultOpen:!(R||I),content:(0,t.jsx)(k.UnifiedAccordionContent,{children:H.length>0?(0,t.jsx)("div",{className:"-mx-4 overflow-x-auto sm:mx-0",children:(0,t.jsxs)(y.Table,{children:[(0,t.jsx)(y.TableHeader,{children:(0,t.jsxs)(y.TableRow,{children:[(0,t.jsx)(y.TableHead,{children:"Description"}),(0,t.jsx)(y.TableHead,{className:"text-right",children:"Quantity"}),(0,t.jsx)(y.TableHead,{className:"text-right",children:"Unit Price"}),(0,t.jsx)(y.TableHead,{className:"text-right",children:"Total"})]})}),(0,t.jsxs)(y.TableBody,{children:[H.map((e,s)=>(0,t.jsxs)(y.TableRow,{children:[(0,t.jsx)(y.TableCell,{className:"font-medium",children:e.description||e.name||"Item"}),(0,t.jsx)(y.TableCell,{className:"text-right",children:e.quantity||1}),(0,t.jsx)(y.TableCell,{className:"text-right",children:S(e.unit_price||e.unitPrice||e.price||0)}),(0,t.jsx)(y.TableCell,{className:"text-right font-semibold",children:S((e.quantity||1)*(e.unit_price||e.unitPrice||e.price||0))})]},s)),(0,t.jsxs)(y.TableRow,{className:"bg-muted/50 border-t-2",children:[(0,t.jsx)(y.TableCell,{className:"text-right font-semibold",colSpan:3,children:"Subtotal"}),(0,t.jsx)(y.TableCell,{className:"text-right font-semibold",children:S($.subtotal||0)})]}),$.tax_amount>0&&(0,t.jsxs)(y.TableRow,{children:[(0,t.jsxs)(y.TableCell,{className:"text-right",colSpan:3,children:["Tax (",$.tax_rate||0,"%)"]}),(0,t.jsx)(y.TableCell,{className:"text-right",children:S($.tax_amount||0)})]}),$.discount_amount>0&&(0,t.jsxs)(y.TableRow,{children:[(0,t.jsx)(y.TableCell,{className:"text-right",colSpan:3,children:"Discount"}),(0,t.jsxs)(y.TableCell,{className:"text-right",children:["-",S($.discount_amount||0)]})]}),(0,t.jsxs)(y.TableRow,{className:"bg-muted/50 border-t-2",children:[(0,t.jsx)(y.TableCell,{className:"text-right text-lg font-bold",colSpan:3,children:"Total"}),(0,t.jsx)(y.TableCell,{className:"text-right text-lg font-bold",children:S($.total_amount||0)})]})]})]})}):(0,t.jsx)("div",{className:"flex h-64 items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(l.FileText,{className:"text-muted-foreground/50 mx-auto size-12"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-4 text-sm",children:"No line items yet"})]})})})}),$.terms&&e.push({id:"terms",title:"Terms & Conditions",icon:(0,t.jsx)(a.FileCheck,{className:"size-4"}),content:(0,t.jsx)(k.UnifiedAccordionContent,{children:(0,t.jsx)("div",{className:"space-y-3",children:(0,t.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:$.terms})})})}),$.valid_until&&e.push({id:"validity",title:"Validity",icon:(0,t.jsx)(s.Calendar,{className:"size-4"}),content:(0,t.jsx)(k.UnifiedAccordionContent,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(N.Label,{children:"Valid Until"}),(0,t.jsx)("p",{className:"text-sm",children:new Date($.valid_until).toLocaleDateString()})]}),"accepted"===$.status&&$.accepted_at&&(0,t.jsxs)("div",{children:[(0,t.jsx)(N.Label,{children:"Accepted At"}),(0,t.jsx)("p",{className:"text-sm",children:new Date($.accepted_at).toLocaleString()})]}),"declined"===$.status&&$.declined_at&&(0,t.jsxs)("div",{children:[(0,t.jsx)(N.Label,{children:"Declined At"}),(0,t.jsx)("p",{className:"text-sm",children:new Date($.declined_at).toLocaleString()}),$.decline_reason&&(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)(N.Label,{children:"Decline Reason"}),(0,t.jsx)("p",{className:"text-sm",children:$.decline_reason})]})]})]})})}),P&&e.push({id:"customer-details",title:"Customer Details",icon:(0,t.jsx)(c.User,{className:"size-4"}),content:(0,t.jsx)(k.UnifiedAccordionContent,{children:(0,t.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[(0,t.jsxs)("div",{className:"grid flex-1 gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(N.Label,{children:"Name"}),(0,t.jsx)("p",{className:"text-sm",children:P.display_name||`${P.first_name||""} ${P.last_name||""}`.trim()||"Unknown"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(N.Label,{children:"Email"}),(0,t.jsx)("p",{className:"text-sm",children:P.email||"N/A"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(N.Label,{children:"Phone"}),(0,t.jsx)("p",{className:"text-sm",children:P.phone||"N/A"})]})]}),(0,t.jsx)(b.Button,{asChild:!0,size:"sm",variant:"ghost",children:(0,t.jsx)(o.default,{href:`/dashboard/customers/${P.id}`,children:"View Full Profile"})})]})})}),L&&e.push({id:"job-details",title:"Related Job",icon:(0,t.jsx)(l.FileText,{className:"size-4"}),content:(0,t.jsx)(k.UnifiedAccordionContent,{children:(0,t.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[(0,t.jsxs)("div",{className:"grid flex-1 gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(N.Label,{children:"Job Number"}),(0,t.jsxs)("p",{className:"text-sm",children:["#",L.job_number||L.id.slice(0,8)]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(N.Label,{children:"Title"}),(0,t.jsx)("p",{className:"text-sm",children:L.title||"N/A"})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(b.Button,{asChild:!0,size:"sm",variant:"ghost",children:(0,t.jsx)(o.default,{href:`/dashboard/work/${L.id}`,children:"View Job"})}),(0,t.jsxs)(b.Button,{onClick:()=>D(L.id),size:"sm",variant:"outline",children:[(0,t.jsx)(i.Link2Off,{className:"mr-2 size-4"}),"Unlink"]})]})]})})}),I&&e.push({id:"invoice-details",title:"Related Invoice",icon:(0,t.jsx)(n.Receipt,{className:"size-4"}),content:(0,t.jsx)(k.UnifiedAccordionContent,{children:(0,t.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[(0,t.jsxs)("div",{className:"grid flex-1 gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(N.Label,{children:"Invoice Number"}),(0,t.jsxs)("p",{className:"text-sm",children:["#",I.invoice_number||I.id.slice(0,8)]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(N.Label,{children:"Invoice Amount"}),(0,t.jsx)("p",{className:"text-sm",children:S(I.total_amount)})]})]}),(0,t.jsx)(b.Button,{asChild:!0,size:"sm",variant:"ghost",children:(0,t.jsx)(o.default,{href:`/dashboard/work/invoices/${I.id}`,children:"View Invoice"})})]})})}),e.push({id:"tags",title:"Tags",icon:(0,t.jsx)(r.Package,{className:"size-4"}),content:(0,t.jsx)(k.UnifiedAccordionContent,{children:(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)("div",{className:"bg-muted/50 rounded-md",children:(0,t.jsxs)("div",{className:"flex flex-col gap-3 p-4",children:[(0,t.jsx)("span",{className:"text-muted-foreground text-xs font-medium",children:"Organize estimates with tags:"}),(0,t.jsx)(p.EntityTags,{entityId:$.id,entityType:"estimate",onUpdateTags:async(e,t)=>{let s=await (0,h.updateEntityTags)("estimate",e,t);s.success?_.refresh():u.toast.error(s.error||"Failed to update tags")},tags:q})]})})})})}),e},[$,P,L,I,R,H,q,_]),W=(0,x.useMemo)(()=>{let e=[];return P&&e.push({id:`customer-${P.id}`,type:"customer",title:P.display_name||`${P.first_name||""} ${P.last_name||""}`.trim()||"Unknown Customer",subtitle:P.email||P.phone||void 0,href:`/dashboard/customers/${P.id}`}),L&&e.push({id:`job-${L.id}`,type:"job",title:L.title||`Job #${L.job_number||L.id.slice(0,8)}`,subtitle:L.status,href:`/dashboard/work/${L.id}`,badge:L.status?{label:L.status,variant:"outline"}:void 0}),I&&e.push({id:`invoice-${I.id}`,type:"invoice",title:`Invoice #${I.invoice_number||I.id.slice(0,8)}`,subtitle:S(I.total_amount),href:`/dashboard/work/invoices/${I.id}`,badge:I.status?{label:I.status,variant:"outline"}:void 0}),e},[P,L,I]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.DetailPageContentLayout,{activities:E,attachments:V,customHeader:K,customSections:G,defaultOpenSection:"line-items",notes:B,relatedItems:W,showStandardSections:{activities:!0,notes:!0,attachments:!0,relatedItems:!0}}),(0,t.jsx)(v.Dialog,{onOpenChange:e=>!e&&D(null),open:null!==z,children:(0,t.jsxs)(v.DialogContent,{children:[(0,t.jsxs)(v.DialogHeader,{children:[(0,t.jsx)(v.DialogTitle,{children:"Unlink Job from Estimate?"}),(0,t.jsx)(v.DialogDescription,{children:"This will remove the job association from this estimate. The estimate will remain in the system but will no longer appear on the job's page."})]}),(0,t.jsxs)(v.DialogFooter,{children:[(0,t.jsx)(b.Button,{disabled:F,onClick:()=>D(null),variant:"outline",children:"Cancel"}),(0,t.jsx)(b.Button,{disabled:F,onClick:O,variant:"destructive",children:F?"Unlinking...":"Unlink Job"})]})]})})]})}e.s(["EstimatePageContent",()=>T])},134181,e=>{e.v(t=>Promise.all(["static/chunks/6680116ea3e49da7.js"].map(t=>e.l(t))).then(()=>t(388024)))}]);