(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,432716,e=>{"use strict";let s=(0,e.i(383206).default)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);e.s(["default",()=>s])},882525,e=>{"use strict";var s=e.i(432716);e.s(["Copy",()=>s.default])},287939,e=>{"use strict";var s=e.i(552038),t=(0,s.createServerReference)("70482cdf6ba7060ca0b16f2ea28d8691a93cbe5912",s.callServer,void 0,s.findSourceMapURL,"updateAppointmentTimes");e.s(["updateAppointmentTimes",()=>t])},365446,409607,e=>{"use strict";var s=e.i(111043),t=e.i(230902),r=e.i(486506),a=e.i(327149),i=e.i(276389),n=e.i(136764),l=e.i(15751),o=e.i(371526),d=e.i(287268),c=e.i(142642),m=e.i(14435),x=e.i(904653),u=e.i(970799);e.i(553153);var h=e.i(363712);e.i(733296);var g=e.i(993665),p=e.i(152088);function b({isOpen:e,onClose:b,selectedDate:f,selectedTechnicianId:j,selectedTechnicianName:v,unassignedJobs:N=[]}){let y=(0,x.useRouter)(),[C,w]=(0,u.useState)(""),k=(0,u.useCallback)(()=>{let e=new URLSearchParams;f&&(e.set("date",(0,t.format)(f,"yyyy-MM-dd")),e.set("startTime",(0,t.format)(f,"HH:mm"))),j&&e.set("assignTo",j);let s=e.toString();y.push(`/dashboard/work/new${s?`?${s}`:""}`),b()},[f,j,y,b]),T=(0,u.useCallback)(e=>{e.jobId&&y.push(`/dashboard/work/${e.jobId}`),b()},[y,b]),S=N.filter(e=>{if(!C)return!0;let s=C.toLowerCase();return e.title?.toLowerCase().includes(s)||e.customer?.name?.toLowerCase().includes(s)||e.location?.address?.street?.toLowerCase().includes(s)});return(0,s.jsxs)(g.CommandDialog,{onOpenChange:b,open:e,children:[(0,s.jsxs)("div",{className:"flex items-center border-b px-3",children:[(0,s.jsx)(d.Search,{className:"text-muted-foreground mr-2 size-4 shrink-0"}),(0,s.jsx)(g.CommandInput,{onValueChange:w,placeholder:"Search jobs, customers, or addresses...",value:C,className:"border-0 focus:ring-0"})]}),(0,s.jsxs)(g.CommandList,{className:"max-h-[400px]",children:[(0,s.jsx)(g.CommandEmpty,{children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,s.jsx)("div",{className:"bg-muted mb-3 flex size-12 items-center justify-center rounded-full",children:(0,s.jsx)(d.Search,{className:"text-muted-foreground size-5"})}),(0,s.jsx)("p",{className:"mb-1 text-sm font-medium",children:"No matching jobs"}),(0,s.jsx)("p",{className:"text-muted-foreground mb-4 max-w-[200px] text-xs",children:"Try a different search term or create a new job"}),(0,s.jsxs)("button",{onClick:k,className:"text-primary hover:text-primary/80 flex items-center gap-1 text-sm font-medium transition-colors",children:[(0,s.jsx)(o.Plus,{className:"size-4"}),"Create New Job"]})]})}),(0,s.jsx)(g.CommandGroup,{heading:"Quick Actions",children:(0,s.jsxs)(g.CommandItem,{className:"group py-3",onSelect:k,children:[(0,s.jsx)("div",{className:"bg-primary/10 group-aria-selected:bg-primary/20 mr-3 flex size-10 items-center justify-center rounded-lg transition-colors",children:(0,s.jsx)(o.Plus,{className:"text-primary size-5"})}),(0,s.jsxs)("div",{className:"flex flex-1 flex-col gap-1",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm font-semibold",children:"Create New Job"}),f&&(0,s.jsxs)(h.Badge,{className:"gap-1 font-medium",variant:"secondary",children:[(0,s.jsx)(i.Calendar,{className:"size-3"}),(0,t.format)(f,"MMM d")," at"," ",(0,t.format)(f,"h:mm a")]}),v&&(0,s.jsxs)(h.Badge,{className:"gap-1 font-medium",variant:"outline",children:[(0,s.jsx)(m.User,{className:"size-3"}),v]})]}),(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:v?`Schedule a new appointment for ${v}`:"Create a new job or service appointment"})]}),(0,s.jsx)("kbd",{className:"bg-muted text-muted-foreground ml-2 hidden rounded px-1.5 py-0.5 font-mono text-[10px] group-aria-selected:inline",children:"↵"})]})}),S.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.CommandSeparator,{}),(0,s.jsxs)(g.CommandGroup,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-2 py-1.5",children:[(0,s.jsx)("span",{className:"text-muted-foreground text-xs font-medium",children:"Unscheduled Jobs"}),(0,s.jsx)(h.Badge,{variant:"secondary",className:"h-5 px-1.5 text-[10px]",children:S.length})]}),S.slice(0,10).map(e=>{let i,o=e.startTime instanceof Date?e.startTime:new Date(e.startTime),d=(i=e.title.toLowerCase()).includes("emergency")||i.includes("urgent")?{label:"Urgent",color:"bg-red-500"}:i.includes("callback")||i.includes("follow")?{label:"Callback",color:"bg-orange-500"}:null;return(0,s.jsxs)(g.CommandItem,{className:"group py-2.5",onSelect:()=>T(e),children:[(0,s.jsx)("div",{className:"mr-3 flex size-10 items-center justify-center rounded-lg bg-orange-500/10 group-aria-selected:bg-orange-500/20 transition-colors",children:(0,s.jsx)(a.Briefcase,{className:"size-5 text-orange-600 dark:text-orange-500"})}),(0,s.jsxs)("div",{className:"flex flex-1 flex-col gap-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm font-semibold",children:e.title}),d&&(0,s.jsx)("span",{className:(0,p.cn)("rounded px-1.5 py-0.5 text-[10px] font-medium text-white",d.color),children:d.label})]}),e.customer?.name&&(0,s.jsx)("span",{className:"text-muted-foreground text-xs font-medium",children:e.customer.name}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1",children:[e.startTime&&(0,s.jsxs)("div",{className:"text-muted-foreground flex items-center gap-1 text-xs",children:[(0,s.jsx)(n.Clock,{className:"size-3"}),(0,s.jsx)("span",{children:(0,t.format)(o,"MMM d, h:mm a")})]}),e.assignments.length>0&&(0,s.jsxs)("div",{className:"text-muted-foreground flex items-center gap-1 text-xs",children:[(0,s.jsx)(m.User,{className:"size-3"}),(0,s.jsxs)("span",{children:[e.assignments.length," assigned"]})]}),e.location?.address?.street&&(0,s.jsxs)("div",{className:"text-muted-foreground flex items-center gap-1 text-xs",children:[(0,s.jsx)(l.MapPin,{className:"size-3"}),(0,s.jsx)("span",{className:"max-w-[180px] truncate",children:e.location.address.street})]})]})]}),(0,s.jsx)(r.ArrowRight,{className:"text-muted-foreground ml-2 size-4 shrink-0 opacity-0 transition-opacity group-aria-selected:opacity-100"})]},e.id)}),S.length>10&&(0,s.jsxs)("div",{className:"flex items-center gap-2 px-2 py-2",children:[(0,s.jsx)(c.Sparkles,{className:"text-muted-foreground/50 size-4"}),(0,s.jsxs)("span",{className:"text-muted-foreground text-xs",children:["+",S.length-10," more jobs available"]})]})]})]})]}),(0,s.jsx)("div",{className:"border-t px-3 py-2",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"text-muted-foreground flex items-center gap-4 text-xs",children:[(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("kbd",{className:"bg-muted rounded px-1 font-mono text-[10px]",children:"↑↓"}),"navigate"]}),(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("kbd",{className:"bg-muted rounded px-1 font-mono text-[10px]",children:"↵"}),"select"]}),(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("kbd",{className:"bg-muted rounded px-1 font-mono text-[10px]",children:"esc"}),"close"]})]}),S.length>0&&(0,s.jsxs)("span",{className:"text-muted-foreground text-[10px]",children:[S.length," result",1!==S.length?"s":""]})]})})]})}e.s(["ScheduleCommandMenu",()=>b],365446);var f=e.i(999),j=e.i(691225),v=e.i(913532),N=e.i(818796),y=e.i(51866),C=e.i(87912),w=e.i(272014),k=e.i(952521),T=e.i(939397),S=e.i(121085),D=e.i(175913),M=e.i(202724),z=e.i(501651),O=e.i(181893);e.i(889265);var P=e.i(677607);e.i(742854);var U=e.i(755297);e.i(51478);var A=e.i(635613);e.i(794747);var B=e.i(513990);let L={emergency:{borderColor:"border-l-red-500",bgColor:"bg-red-500/10",icon:O.Zap,label:"Emergency"},repair:{borderColor:"border-l-orange-500",bgColor:"bg-orange-500/10",icon:z.Wrench,label:"Repair"},installation:{borderColor:"border-l-green-500",bgColor:"bg-green-500/10",icon:k.HardHat,label:"Installation"},maintenance:{borderColor:"border-l-blue-500",bgColor:"bg-blue-500/10",icon:S.Settings,label:"Maintenance"},premium_maintenance:{borderColor:"border-l-violet-500",bgColor:"bg-violet-500/10",icon:D.Star,label:"Premium"},inspection:{borderColor:"border-l-cyan-500",bgColor:"bg-cyan-500/10",icon:d.Search,label:"Inspection"},service:{borderColor:"border-l-sky-500",bgColor:"bg-sky-500/10",icon:w.ClipboardCheck,label:"Service"},service_call:{borderColor:"border-l-teal-500",bgColor:"bg-teal-500/10",icon:T.Phone,label:"Service Call"},estimate:{borderColor:"border-l-amber-500",bgColor:"bg-amber-500/10",icon:w.ClipboardCheck,label:"Estimate"},callback:{borderColor:"border-l-pink-500",bgColor:"bg-pink-500/10",icon:T.Phone,label:"Callback"},other:{borderColor:"border-l-slate-400",bgColor:"bg-slate-400/10",icon:w.ClipboardCheck,label:"Other"},default:{borderColor:"border-l-slate-400",bgColor:"bg-slate-400/10",icon:w.ClipboardCheck,label:"Job"}},I={job:{icon:a.Briefcase,label:"Job",bgColor:"bg-blue-500/10",textColor:"text-blue-600 dark:text-blue-400",borderStyle:"border-solid"},meeting:{icon:M.Users,label:"Meeting",bgColor:"bg-purple-500/10",textColor:"text-purple-600 dark:text-purple-400",borderStyle:"border-dashed"},event:{icon:i.Calendar,label:"Event",bgColor:"bg-emerald-500/10",textColor:"text-emerald-600 dark:text-emerald-400",borderStyle:"border-dotted"}},E=(0,u.memo)(function({job:e,isDragOverlay:r=!1}){let a,i,o,d,{attributes:c,listeners:m,setNodeRef:x,transform:u,transition:g,isDragging:b}=(0,j.useSortable)({id:e.id,data:{job:e}}),f=r?void 0:{transform:v.CSS.Transform.toString(u),transition:g},N=e.startTime instanceof Date?e.startTime:new Date(e.startTime),y=Math.round(((e.endTime instanceof Date?e.endTime:new Date(e.endTime)).getTime()-N.getTime())/6e4);return(0,s.jsxs)("div",{ref:r?void 0:x,style:f,...r?{}:c,...r?{}:m,className:(0,p.cn)("group bg-card relative cursor-grab rounded-lg border-2 border-dashed border-red-200 p-3 shadow-sm transition-all hover:border-red-300 hover:shadow-md active:cursor-grabbing dark:border-red-900/50",b&&!r&&"opacity-30",r&&"scale-105 cursor-grabbing shadow-2xl ring-2 ring-red-500"),children:[(0,s.jsx)("div",{className:"absolute top-2 right-2 opacity-0 transition-opacity group-hover:opacity-100",children:(0,s.jsx)("div",{className:"flex size-5 items-center justify-center rounded bg-red-500 text-white",children:(0,s.jsx)(C.ChevronRight,{className:"size-3"})})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-start gap-2 pr-6",children:[(0,s.jsxs)(B.TooltipProvider,{children:[(i=(a=I[e.appointmentCategory||"job"]).icon,(0,s.jsxs)(B.Tooltip,{children:[(0,s.jsx)(B.TooltipTrigger,{asChild:!0,children:(0,s.jsx)("div",{className:(0,p.cn)("mt-0.5 flex size-4 shrink-0 items-center justify-center rounded-sm",a.bgColor),children:(0,s.jsx)(i,{className:(0,p.cn)("size-2.5",a.textColor)})})}),(0,s.jsx)(B.TooltipContent,{side:"top",className:"text-xs",children:a.label})]})),(d=(o=(e.jobType?L[e.jobType]:L.default)||L.default).icon,(0,s.jsxs)(B.Tooltip,{children:[(0,s.jsx)(B.TooltipTrigger,{asChild:!0,children:(0,s.jsx)("div",{className:(0,p.cn)("mt-0.5 flex size-5 shrink-0 items-center justify-center rounded",o.bgColor),children:(0,s.jsx)(d,{className:(0,p.cn)("size-3",o.borderColor.replace("border-l-","text-"))})})}),(0,s.jsx)(B.TooltipContent,{side:"top",className:"text-xs",children:o.label})]}))]}),(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsx)("p",{className:"text-foreground text-sm font-semibold",children:e.title}),e.customer?.name&&(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:e.customer.name})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4 text-xs",children:[(0,s.jsxs)("div",{className:"text-muted-foreground flex items-center gap-1.5",children:[(0,s.jsx)(n.Clock,{className:"size-3.5"}),(0,s.jsx)("span",{className:"font-mono font-medium",children:(0,t.format)(N,"h:mm a")})]}),(0,s.jsxs)(h.Badge,{className:"text-[10px]",variant:"secondary",children:[y," min"]})]}),e.location?.address?.street&&(0,s.jsxs)("div",{className:"text-muted-foreground flex items-start gap-1.5 text-xs",children:[(0,s.jsx)(l.MapPin,{className:"mt-0.5 size-3.5 shrink-0"}),(0,s.jsx)("span",{className:"line-clamp-1",children:e.location.address.street})]}),"urgent"===e.priority&&(0,s.jsx)(h.Badge,{className:"text-[9px]",variant:"destructive",children:"URGENT"})]})]})},(e,s)=>e.job.id===s.job.id&&e.isDragOverlay===s.isDragOverlay&&e.job.status===s.job.status&&e.job.title===s.job.title);function F({unassignedJobs:e=[],isOpen:t,onToggle:r,dropId:a="unassigned-dropzone",activeJobId:i,searchQuery:n="",onSearchChange:l,onLoadMore:o,hasMore:c=!1,isLoadingMore:m=!1,totalCount:x}){let{setNodeRef:g,isOver:b}=(0,f.useDroppable)({id:a}),v=Array.isArray(e)?e:[],C=v.find(e=>e.id===i),[w,k]=(0,u.useState)(n??""),T=(0,u.useRef)(n??""),S=w.trim();(0,u.useEffect)(()=>{T.current=n??"",k(n??"")},[n]),(0,u.useEffect)(()=>{if(!l)return;let e=setTimeout(()=>{S!==(T.current??"")&&(T.current=S,l(S))},400);return()=>clearTimeout(e)},[S,l]);let D=(0,u.useMemo)(()=>[...v].sort((e,s)=>"urgent"===e.priority&&"urgent"!==s.priority?-1:"urgent"===s.priority&&"urgent"!==e.priority?1:new Date(e.startTime).getTime()-new Date(s.startTime).getTime()),[v]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(U.Collapsible,{className:"h-full",onOpenChange:r,open:t,children:(0,s.jsx)("div",{className:(0,p.cn)("bg-card flex h-full flex-col border-r transition-colors duration-200",b&&"bg-red-50/80 ring-2 ring-red-500 ring-inset dark:bg-red-950/50"),ref:g,children:t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(U.CollapsibleTrigger,{asChild:!0,children:(0,s.jsxs)(P.Button,{className:"hover:bg-muted h-auto w-full shrink-0 justify-between px-4 py-3",variant:"ghost",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(N.AlertCircle,{className:"size-4 text-red-500"}),(0,s.jsx)("span",{className:"text-sm font-semibold",children:"Unscheduled"}),(0,s.jsx)(h.Badge,{className:"bg-red-100 px-2 py-0.5 text-xs font-semibold text-red-700 dark:bg-red-950/50 dark:text-red-400",variant:"secondary",children:x??D.length})]}),(0,s.jsx)(y.ChevronLeft,{className:"size-4 transition-transform"})]})}),(0,s.jsx)("div",{className:"border-b px-3 py-2",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(d.Search,{className:"text-muted-foreground absolute top-1/2 left-2 size-4 -translate-y-1/2"}),(0,s.jsx)(A.Input,{className:"pl-8 text-sm",placeholder:"Search...",value:w,onChange:e=>k(e.target.value)})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-x-hidden overflow-y-auto",style:{minHeight:0},children:(0,s.jsx)("div",{className:"space-y-2 p-3",children:0===D.length?(0,s.jsx)("div",{className:"rounded-lg border border-dashed p-6 text-center",children:(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:S?"No jobs match this search":"All jobs scheduled"})}):(0,s.jsx)(j.SortableContext,{items:D.map(e=>e.id),strategy:j.verticalListSortingStrategy,children:D.map(e=>(0,s.jsx)(E,{job:e},e.id))})})}),(c||m)&&(0,s.jsx)("div",{className:"border-t px-3 py-2",children:(0,s.jsx)(P.Button,{className:"w-full",disabled:m||!o,onClick:o,size:"sm",variant:"outline",children:m?"Loading...":"Load more"})})]}):(0,s.jsx)("button",{className:"flex h-full w-12 items-center justify-center bg-red-50 transition-colors hover:bg-red-100 dark:bg-red-950/30 dark:hover:bg-red-950/50",onClick:r,children:(0,s.jsxs)("div",{className:"flex rotate-180 items-center gap-3 [writing-mode:vertical-rl]",children:[(0,s.jsx)("span",{className:"text-sm font-bold tracking-wider text-red-700 dark:text-red-400",children:"UNSCHEDULED"}),(0,s.jsx)(h.Badge,{className:"bg-red-600 px-2.5 py-0.5 text-xs font-semibold text-white dark:bg-red-700",variant:"secondary",children:x??D.length})]})})})}),(0,s.jsx)(f.DragOverlay,{dropAnimation:null,children:C?(0,s.jsx)(E,{isDragOverlay:!0,job:C}):null})]})}e.s(["UnassignedPanel",()=>F],409607)},791605,e=>{"use strict";var s=e.i(111043),t=e.i(999),r=e.i(913532),a=e.i(598279),i=e.i(936765),n=e.i(348793),l=e.i(230902),o=e.i(103882),d=e.i(983961),c=e.i(551685),m=e.i(432286),x=e.i(954259),u=e.i(630754),h=e.i(852648),g=e.i(332845),p=e.i(604501),b=e.i(904653),f=e.i(970799),j=e.i(995403),v=e.i(287939);e.i(670258);var N=e.i(921251);e.i(553153);var y=e.i(363712);e.i(889265);var C=e.i(677607),w=e.i(339215);e.i(51478);var k=e.i(635613);e.i(220474);var T=e.i(171056),S=e.i(220168);e.i(794747);var D=e.i(513990),M=e.i(826997),z=e.i(112668),O=e.i(152088),P=e.i(365446),U=e.i(373915),A=e.i(409607);let B=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],L=e=>{switch(e){case"scheduled":return"bg-blue-500";case"dispatched":return"bg-sky-500";case"arrived":return"bg-emerald-400";case"in-progress":return"bg-amber-500 animate-pulse";case"closed":case"completed":return"bg-emerald-600";case"cancelled":return"bg-slate-400";default:return"bg-slate-500"}},I=(0,f.memo)(function({job:e,isDragOverlay:a=!1,isSelected:i=!1,onSelect:n}){let o;(0,b.useRouter)();let[,d]=(0,f.useState)(!1),[c,m]=(0,f.useState)(!1),[x,y]=(0,f.useState)(""),[M,z]=(0,f.useState)(""),{attributes:P,listeners:U,setNodeRef:A,transform:B,isDragging:I}=(0,t.useDraggable)({id:e.id,data:{job:e}}),E={transform:r.CSS.Translate.toString(B)},F=e.startTime instanceof Date?e.startTime:new Date(e.startTime),H=e.endTime instanceof Date?e.endTime:new Date(e.endTime),J=async()=>{let[s,t]=x.split(":").map(Number),[r,a]=M.split(":").map(Number),i=new Date(F);i.setHours(s,t,0,0);let n=new Date(H);n.setHours(r,a,0,0);let l=j.toast.loading("Updating appointment times..."),o=await (0,v.updateAppointmentTimes)(e.id,i,n);o.success?(j.toast.success("Times updated",{id:l}),m(!1)):j.toast.error(o.error||"Failed to update times",{id:l})},R=()=>{switch(e.status){case"dispatched":return(0,s.jsx)(p.Truck,{className:"size-3"});case"arrived":return(0,s.jsx)(g.Navigation,{className:"size-3"});case"closed":return(0,s.jsx)(u.CheckCircle,{className:"size-3"});case"completed":return(0,s.jsx)(h.CheckCircle2,{className:"size-3"});default:return null}},$=(0,s.jsxs)("button",{ref:A,style:E,...P,...U,className:(0,O.cn)("group bg-background relative flex w-full cursor-grab items-center gap-1.5 rounded-full border-2 px-2.5 py-1.5 text-left text-xs font-medium shadow-sm transition-all hover:shadow-md active:cursor-grabbing",(o=e.title.toLowerCase()).includes("emergency")||o.includes("urgent")?"border-red-400 dark:border-red-700":o.includes("callback")||o.includes("follow-up")||o.includes("followup")?"border-orange-400 dark:border-orange-700":o.includes("meeting")||o.includes("event")||o.includes("training")?"border-purple-400 dark:border-purple-700":o.includes("install")||o.includes("setup")||o.includes("new")?"border-green-400 dark:border-green-700":o.includes("service")||o.includes("maintenance")?"border-blue-400 dark:border-blue-700":"border-slate-300 dark:border-slate-700",I&&!a&&"opacity-30",a&&"ring-primary cursor-grabbing shadow-xl ring-2",i&&"ring-primary ring-2 ring-offset-1"),onClick:s=>{s.shiftKey&&n?(s.stopPropagation(),n(e.id,!0)):s.shiftKey||(s.stopPropagation(),y((0,l.format)(F,"HH:mm")),z((0,l.format)(H,"HH:mm")),m(!0))},type:"button",children:[R()?(0,s.jsx)("div",{className:(0,O.cn)("shrink-0",L(e.status)),children:R()}):(0,s.jsx)("div",{className:(0,O.cn)("size-1.5 shrink-0 rounded-full",L(e.status))}),(0,s.jsx)("span",{className:"shrink-0 text-[10px] font-medium",children:(0,l.format)(F,"h:mm a")}),(0,s.jsx)("span",{className:"truncate text-[11px] font-semibold",children:e.customer?.name||"Unknown"}),e.assignments.length>0&&(0,s.jsxs)("div",{className:"ml-auto flex shrink-0 -space-x-1",children:[e.assignments.slice(0,2).map((e,t)=>(0,s.jsx)(N.Avatar,{className:"border-background size-4 border",children:(0,s.jsx)(N.AvatarFallback,{className:"text-[8px]",children:e.displayName?.slice(0,2).toUpperCase()||"?"})},e.technicianId||t)),e.assignments.length>2&&(0,s.jsxs)("div",{className:"border-background bg-muted flex size-4 items-center justify-center rounded-full border text-[7px] font-medium",children:["+",e.assignments.length-2]})]})]}),K=(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold",children:e.customer?.name||"Unknown Customer"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:e.title})]}),(0,s.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Time:"})," ",(0,l.format)(F,"h:mm a")," - ",(0,l.format)(H,"h:mm a")]}),e.location?.address?.street&&(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Location:"})," ",e.location.address.street]}),e.assignments.length>0&&(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Team:"})," ",e.assignments.map(e=>e.displayName).join(", ")]})]})]});if(a)return $;let Q=`monthly-start-${e.id}`,V=`monthly-end-${e.id}`;return(0,s.jsxs)(T.Popover,{onOpenChange:m,open:c,children:[(0,s.jsx)(D.TooltipProvider,{children:(0,s.jsxs)(D.Tooltip,{delayDuration:200,children:[(0,s.jsx)(w.ScheduleJobContextMenu,{job:e,onOpenChange:d,children:(0,s.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,s.jsx)(T.PopoverTrigger,{asChild:!0,children:$})})}),(0,s.jsx)(D.TooltipContent,{className:"max-w-xs",side:"top",children:K})]})}),(0,s.jsx)(T.PopoverContent,{align:"start",className:"w-80",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-semibold",children:"Quick Edit Times"}),(0,s.jsx)("p",{className:"text-muted-foreground text-xs",children:e.customer?.name||"Unknown Customer"})]}),(0,s.jsxs)("div",{className:"grid gap-3",children:[(0,s.jsx)(S.StandardFormField,{label:"Start Time",htmlFor:Q,children:(0,s.jsx)(k.Input,{id:Q,onChange:e=>y(e.target.value),type:"time",value:x})}),(0,s.jsx)(S.StandardFormField,{label:"End Time",htmlFor:V,children:(0,s.jsx)(k.Input,{id:V,onChange:e=>z(e.target.value),type:"time",value:M})})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(C.Button,{className:"flex-1",onClick:J,size:"sm",children:"Save"}),(0,s.jsx)(C.Button,{className:"flex-1",onClick:()=>m(!1),size:"sm",variant:"outline",children:"Cancel"})]})]})})]})}),E=(0,f.memo)(function({date:e,jobs:r,isCurrentMonth:a,isSelectedDate:i,selectedJobIds:n,onJobSelect:o,onOpenCommandMenu:d,onDoubleClick:m}){let{setNodeRef:x,isOver:u}=(0,t.useDroppable)({id:`day-${e.toISOString()}`,data:{date:e}}),h=(0,c.isToday)(e),g=r.length>0,p=(0,f.useMemo)(()=>r.reduce((e,s)=>{let t=s.startTime instanceof Date?s.startTime:new Date(s.startTime);return e+((s.endTime instanceof Date?s.endTime:new Date(s.endTime)).getTime()-t.getTime())/36e5},0),[r]),b=0===e.getDay()||6===e.getDay();return(0,s.jsxs)("div",{className:(0,O.cn)("border-border/50 relative flex h-[140px] cursor-context-menu flex-col border p-3 transition-all duration-200",!a&&"bg-muted/50 opacity-60",u&&"bg-primary/10 ring-primary ring-2 ring-inset",h&&"bg-blue-50 ring-2 ring-blue-500/30 dark:bg-blue-950/30",i&&!h&&"bg-emerald-50 ring-2 ring-emerald-500/50 dark:bg-emerald-950/30",b&&!h&&"bg-slate-100/80 dark:bg-slate-800/30"),onContextMenu:s=>{s.preventDefault(),d?.(e)},onDoubleClick:s=>{s.target.closest("[data-job-pill]")||m?.(e)},ref:x,children:[(0,s.jsxs)("div",{className:"group/header mb-2 flex shrink-0 items-center justify-between gap-2",children:[(0,s.jsx)(D.TooltipProvider,{children:(0,s.jsxs)(D.Tooltip,{delayDuration:300,children:[(0,s.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,s.jsx)("span",{className:(0,O.cn)("flex size-7 items-center justify-center rounded-full text-base font-bold transition-all",h&&"bg-blue-500 text-white shadow-md",i&&!h&&"bg-emerald-500 text-white shadow-md",!(h||i||a)&&"text-muted-foreground/60",!(h||i)&&a&&"text-foreground"),children:(0,l.format)(e,"d")})}),g&&(0,s.jsx)(D.TooltipContent,{className:"w-64",side:"top",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between border-b pb-2",children:[(0,s.jsx)("p",{className:"text-sm font-semibold",children:(0,l.format)(e,"EEEE, MMM d")}),(0,s.jsxs)(y.Badge,{variant:"secondary",children:[r.length," jobs"]})]}),(0,s.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Total Hours:"}),(0,s.jsxs)("span",{className:"font-medium",children:[p.toFixed(1),"h"]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Avg Duration:"}),(0,s.jsxs)("span",{className:"font-medium",children:[(p/r.length).toFixed(1),"h"]})]}),(0,s.jsxs)("div",{className:"mt-2 space-y-1 border-t pt-2",children:[(0,s.jsx)("p",{className:"text-xs font-medium",children:"Status Breakdown:"}),Object.entries(r.reduce((e,s)=>(e[s.status||"scheduled"]=(e[s.status||"scheduled"]||0)+1,e),{})).map(([e,t])=>(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("span",{className:"text-muted-foreground capitalize",children:[e,":"]}),(0,s.jsx)("span",{className:"font-medium",children:t})]},e))]})]})]})})]})}),g&&(0,s.jsxs)(y.Badge,{className:"h-5 px-2 text-[10px] font-semibold",variant:"secondary",children:[r.length," jobs · ",p.toFixed(1),"h"]})]}),u&&(0,s.jsx)("div",{className:"pointer-events-none absolute inset-0 z-10 flex items-center justify-center",children:(0,s.jsx)("div",{className:"fade-in zoom-in-95 animate-in bg-primary text-primary-foreground rounded-lg px-3 py-1.5 text-xs font-semibold shadow-lg duration-200",children:"Drop to schedule"})}),(0,s.jsx)("div",{className:"flex-1 space-y-0.5 overflow-x-hidden overflow-y-auto",children:r.map(e=>(0,s.jsx)(I,{isSelected:n?.has(e.id),job:e,onSelect:o},e.id))})]})});function F(){let[e,r]=(0,f.useState)(null),[c,u]=(0,f.useState)(!1),[h,g]=(0,f.useState)(new Set),[p,b]=(0,f.useState)(!1),[N,y]=(0,f.useState)(null),[C,w]=(0,f.useState)(!1),[k,T]=(0,f.useState)(null),{currentDate:S}=(0,z.useScheduleViewStore)(),D=(0,f.useCallback)((e,s)=>{g(t=>{let r=new Set(t);return s?r.has(e)?r.delete(e):r.add(e):(r.clear(),r.add(e)),r})},[]),L=(0,f.useCallback)(e=>{y(e),b(!0)},[]),F=(0,f.useCallback)(e=>{let s=new Date(e);s.setHours(9,0,0,0),T(s),w(!0)},[]),{getAllJobs:H,moveJob:J,isLoading:R,loadMoreUnassignedJobs:$,unassignedHasMore:K,unassignedSearch:Q,isLoadingUnassigned:V,unassignedTotalCount:W}=(0,M.useSchedule)(),G=(0,t.useSensors)((0,t.useSensor)(t.MouseSensor,{activationConstraint:{distance:8}}),(0,t.useSensor)(t.TouchSensor,{activationConstraint:{delay:200,tolerance:6}})),_=(0,f.useMemo)(()=>S instanceof Date?S:new Date(S),[S]),Z=(0,f.useMemo)(()=>{let e=(0,m.startOfMonth)(_),s=(0,i.endOfMonth)(_),t=(0,x.startOfWeek)(e),r=(0,n.endOfWeek)(s),l=[],o=t;for(;o<=r;)l.push(o),o=(0,a.addDays)(o,1);return l},[_]),{jobsByDate:q,unassignedJobs:X}=(0,f.useMemo)(()=>{let e=H(),s=new Map,t=[];for(let r of e){if(!r.technicianId){t.push(r);continue}let e=r.startTime instanceof Date?r.startTime:new Date(r.startTime),a=(0,l.format)(e,"yyyy-MM-dd");s.has(a)||s.set(a,[]),s.get(a)?.push(r)}return{jobsByDate:s,unassignedJobs:t}},[H]),Y=X.length>0||K||Q.length>0,ee=(0,f.useCallback)(e=>{r(e.active.id)},[]),es=(0,f.useCallback)(async e=>{let{active:s,over:t}=e;if(r(null),!t)return;let a=s.id,i=t.data.current;if(!i?.date)return;let n=H().find(e=>e.id===a);if(!n)return;let o=n.startTime instanceof Date?n.startTime:new Date(n.startTime),d=(n.endTime instanceof Date?n.endTime:new Date(n.endTime)).getTime()-o.getTime(),c=new Date(i.date);c.setHours(o.getHours(),o.getMinutes(),0,0);let m=new Date(c.getTime()+d);J(a,n.technicianId,c,m);let x=j.toast.loading(`Moving to ${(0,l.format)(i.date,"MMM d")}...`),u=await (0,v.updateAppointmentTimes)(a,c,m);u.success?j.toast.success(`Moved to ${(0,l.format)(i.date,"MMM d")}`,{id:x}):j.toast.error(u.error||"Failed to move appointment",{id:x})},[H,J]),et=(0,f.useMemo)(()=>e?H().find(s=>s.id===e):null,[e,H]),er=(0,f.useCallback)(e=>{$({reset:!0,search:e})},[$]),ea=(0,f.useCallback)(()=>{$({search:Q})},[$,Q]);return R?(0,s.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,s.jsx)("div",{className:"text-muted-foreground",children:"Loading schedule..."})}):(0,s.jsxs)(t.DndContext,{onDragEnd:es,onDragStart:ee,sensors:G,children:[(0,s.jsxs)("div",{className:"flex h-full overflow-hidden",children:[Y&&(0,s.jsx)(A.UnassignedPanel,{activeJobId:e,hasMore:K,isLoadingMore:V,isOpen:c,onLoadMore:ea,onSearchChange:er,onToggle:()=>u(!c),searchQuery:Q,totalCount:W,unassignedJobs:X}),(0,s.jsx)("div",{className:"flex flex-1 flex-col overflow-hidden",children:(0,s.jsx)("div",{className:"flex-1 overflow-auto",children:(0,s.jsxs)("div",{className:"grid min-h-full grid-cols-7",children:[B.map((e,t)=>(0,s.jsx)("div",{className:(0,O.cn)("bg-muted/50 sticky top-0 z-30 border-r border-b-2 px-4 py-3 text-center text-sm font-bold tracking-wide uppercase shadow-sm backdrop-blur-sm",(0===t||6===t)&&"bg-slate-200/80 dark:bg-slate-700/50"),children:e},e)),Z.map((e,t)=>{let r=(0,l.format)(e,"yyyy-MM-dd"),a=q.get(r)||[],i=(0,d.isSameMonth)(e,_),n=(0,o.isSameDay)(e,_);return(0,s.jsx)(E,{date:e,isCurrentMonth:i,isSelectedDate:n,jobs:a,onDoubleClick:F,onJobSelect:D,onOpenCommandMenu:L,selectedJobIds:h},e.toISOString())})]})})})]}),(0,s.jsx)(P.ScheduleCommandMenu,{isOpen:p,onClose:()=>b(!1),selectedDate:N,unassignedJobs:X}),(0,s.jsx)(U.QuickAppointmentDialog,{open:C,onOpenChange:w,defaultDateTime:k||void 0,onSuccess:()=>{w(!1),j.toast.success("Appointment created")}}),(0,s.jsx)(t.DragOverlay,{dropAnimation:{duration:200,easing:"cubic-bezier(0.18, 0.67, 0.6, 1.22)"},children:et?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(I,{isDragOverlay:!0,job:et}),(0,s.jsx)("div",{className:"pointer-events-none absolute -bottom-2 left-1/2 -translate-x-1/2",children:(0,s.jsx)("div",{className:"bg-primary text-primary-foreground flex items-center gap-1 rounded-full px-2 py-0.5 text-[10px] shadow-lg",children:(0,s.jsx)("span",{children:"Drop to reschedule"})})})]}):null})]})}e.s(["MonthlyView",()=>F])},5456,e=>{e.n(e.i(791605))}]);