(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,926991,e=>{"use strict";let s=(0,e.i(383206).default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["default",()=>s])},51866,e=>{"use strict";var s=e.i(926991);e.s(["ChevronLeft",()=>s.default])},103047,e=>{"use strict";let s=(0,e.i(383206).default)("sticky-note",[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]]);e.s(["default",()=>s])},905167,e=>{"use strict";let s=(0,e.i(383206).default)("reply",[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]]);e.s(["default",()=>s])},79370,e=>{"use strict";var s=e.i(103047);e.s(["StickyNote",()=>s.default])},126776,e=>{"use strict";var s=e.i(905167);e.s(["Reply",()=>s.default])},474500,e=>{"use strict";var s=e.i(111043);e.i(889265);var t=e.i(677607),a=e.i(152088),l=e.i(882896),i=e.i(507769),r=e.i(218074),n=e.i(818796),c=e.i(970799),d=e.i(995403);e.i(794747);var o=e.i(513990);function m({html:t,text:l,attachments:r,className:n}){let[d,o]=(0,c.useState)(null);(0,c.useEffect)(()=>{e.A(161886).then(e=>{o(()=>e.default)})},[]);let m=(0,c.useMemo)(()=>t&&d?d.sanitize(t,{ALLOWED_TAGS:["p","br","strong","em","u","b","i","s","strike","a","ul","ol","li","h1","h2","h3","h4","h5","h6","blockquote","img","table","thead","tbody","tfoot","tr","th","td","div","span","hr","pre","code","font","center","section","article","header","footer","main","style"],ALLOWED_ATTR:["href","src","alt","title","width","height","style","class","id","align","valign","border","cellpadding","cellspacing","bgcolor","color","face","size","colspan","rowspan","target","rel"],ALLOW_DATA_ATTR:!1,ALLOWED_URI_REGEXP:/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,KEEP_CONTENT:!0,ADD_TAGS:["style"],ADD_ATTR:["media","type"]}):null,[t,d]),x=(0,c.useMemo)(()=>l?l.split(/\n\n+/).map((e,t)=>(0,s.jsx)("p",{className:"mb-4 last:mb-0",children:e.split("\n").map((e,t,a)=>(0,s.jsxs)("span",{children:[e,t<a.length-1&&(0,s.jsx)("br",{})]},t))},t)):null,[l]),u=r&&r.length>0;return(0,s.jsxs)("div",{className:(0,a.cn)("flex flex-col gap-4",n),children:[(0,s.jsx)("div",{className:"email-content-wrapper prose prose-sm dark:prose-invert max-w-none",children:m?(0,s.jsx)("div",{className:"email-content-html text-sm leading-relaxed",style:{fontSize:"14px",lineHeight:"1.6",color:"inherit"},dangerouslySetInnerHTML:{__html:m}}):t&&!d?x?(0,s.jsx)("div",{className:"text-sm leading-relaxed text-foreground",children:x}):(0,s.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,s.jsx)("div",{className:"text-sm text-muted-foreground italic",children:"Loading email content..."})}):x?(0,s.jsx)("div",{className:"text-sm leading-relaxed text-foreground",children:x}):(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("svg",{width:"64",height:"64",viewBox:"0 0 192 192",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"mx-auto mb-4 opacity-30",children:(0,s.jsx)("rect",{width:"192",height:"192",rx:"96",fill:"currentColor",fillOpacity:"0.15"})}),(0,s.jsx)("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"No content available"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"This email may have been deleted or expired"})]})})}),u&&(0,s.jsxs)("div",{className:"border-t border-border/50 pt-4",children:[(0,s.jsxs)("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2 text-foreground",children:[(0,s.jsx)(i.File,{className:"h-4 w-4"}),"Attachments (",r.length,")"]}),(0,s.jsx)("div",{className:"flex flex-col gap-2",children:r.map((e,t)=>(0,s.jsx)(h,{attachment:e},e.id||e.path||t))})]})]})}function h({attachment:e}){let a=e.filename||e.name||"attachment",m=e.content_type||e.type||"",h=m.startsWith("image/"),x=e.storage_url||null,u=!!x&&"#"!==x,f=(0,c.useCallback)(()=>{d.toast.error("Attachment unavailable",{description:"This attachment cannot be downloaded. The file may have expired or been removed."})},[]);return(0,s.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg hover:bg-muted transition-colors",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:h?(0,s.jsx)(r.Image,{className:"h-5 w-5 text-muted-foreground"}):(0,s.jsx)(i.File,{className:"h-5 w-5 text-muted-foreground"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium truncate",children:a}),(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[m&&(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:m}),!u&&(0,s.jsxs)(o.Tooltip,{children:[(0,s.jsx)(o.TooltipTrigger,{asChild:!0,children:(0,s.jsxs)("span",{className:"text-xs text-orange-500 flex items-center gap-0.5",children:[(0,s.jsx)(n.AlertCircle,{className:"h-3 w-3"}),"Unavailable"]})}),(0,s.jsx)(o.TooltipContent,{children:(0,s.jsx)("p",{children:"This attachment cannot be downloaded"})})]})]})]}),u?(0,s.jsx)(t.Button,{variant:"ghost",size:"sm",className:"flex-shrink-0",asChild:!0,children:(0,s.jsxs)("a",{href:x,download:a,target:"_blank",rel:"noopener noreferrer",children:[(0,s.jsx)(l.Download,{className:"h-4 w-4"}),(0,s.jsxs)("span",{className:"sr-only",children:["Download ",a]})]})}):(0,s.jsxs)(o.Tooltip,{children:[(0,s.jsx)(o.TooltipTrigger,{asChild:!0,children:(0,s.jsxs)(t.Button,{variant:"ghost",size:"sm",className:"flex-shrink-0 opacity-50",onClick:f,children:[(0,s.jsx)(l.Download,{className:"h-4 w-4"}),(0,s.jsxs)("span",{className:"sr-only",children:["Download ",a]})]})}),(0,s.jsx)(o.TooltipContent,{children:(0,s.jsx)("p",{children:"Attachment unavailable for download"})})]})]})}e.s(["EmailContent",()=>m])},201796,e=>{"use strict";let s=(0,e.i(383206).default)("trash",[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["default",()=>s])},316387,e=>{"use strict";var s=e.i(201796);e.s(["Trash",()=>s.default])},937343,923192,e=>{"use strict";var s=e.i(383206);let t=(0,s.default)("forward",[["path",{d:"m15 17 5-5-5-5",key:"nf172w"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]]);e.s(["default",()=>t],937343);let a=(0,s.default)("reply-all",[["path",{d:"m12 17-5-5 5-5",key:"1s3y5u"}],["path",{d:"M22 18v-2a4 4 0 0 0-4-4H7",key:"1fcyog"}],["path",{d:"m7 17-5-5 5-5",key:"1ed8i2"}]]);e.s(["default",()=>a],923192)},123215,631237,787817,e=>{"use strict";var s=e.i(552038),t=(0,s.createServerReference)("406d2674c7205459d9f4f40892380fb085c342fe1c",s.callServer,void 0,s.findSourceMapURL,"getEmailsAction");e.s(["getEmailsAction",()=>t],123215);var a=e.i(937343);e.s(["Forward",()=>a.default],631237);var l=e.i(923192);e.s(["ReplyAll",()=>l.default],787817)},366822,e=>{"use strict";var s=e.i(111043),t=e.i(904653),a=e.i(970799),l=e.i(552038),i=(0,l.createServerReference)("400737686314e248a3cd3c96e588f4e7cbf17190d8",l.callServer,void 0,l.findSourceMapURL,"getEmailByIdAction"),r=e.i(123215),n=e.i(474500);e.i(670258);var c=e.i(921251);e.i(889265);var d=e.i(677607);e.i(287133);var o=e.i(120109);e.i(794747);var m=e.i(513990),h=e.i(751139),x=e.i(946672),u=e.i(51866),f=e.i(631237),p=e.i(38614),v=e.i(126776),j=e.i(787817),g=e.i(175913),N=e.i(79370),b=e.i(316387),w=e.i(212409),y=e.i(995403),k=e.i(176378);function A(){let e=(0,t.useParams)(),l=(0,t.useRouter)(),A=e?.folder||"inbox",T=e?.id,[_,S]=(0,a.useTransition)(),[C,z]=(0,a.useState)(null),[B,E]=(0,a.useState)(null),[R,L]=(0,a.useState)(!0),[D,M]=(0,a.useState)(null),[U,F]=(0,a.useState)(null),[O,H]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{(async()=>{try{let e=await (0,r.getEmailsAction)({limit:50,offset:0,type:"all",folder:"inbox"===A?void 0:A,sortBy:"created_at",sortOrder:"desc"});E(e)}catch(e){console.error("Failed to fetch emails:",e)}})()},[A]),(0,a.useEffect)(()=>{if(!T){M("No email ID provided"),L(!1);return}L(!0),M(null),S(async()=>{try{let e=await i(T);if(!e.success||!e.email)throw Error(e.error||"Email not found");z(e.email),F({html:e.email.body_html||null,text:e.email.body||null})}catch(s){let e=s instanceof Error?s.message:"Failed to load email";M(e),y.toast.error("Failed to load email",{description:e})}finally{L(!1)}})},[T]),R&&!C)?(0,s.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading email..."})]})}):D||!C?(0,s.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(h.AlertTriangle,{className:"h-8 w-8 text-destructive mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-sm font-medium text-destructive mb-2",children:D||"Email not found"}),(0,s.jsxs)(d.Button,{variant:"outline",onClick:()=>l.push(`/dashboard/communication/${A}`),children:["Back to ",A.charAt(0).toUpperCase()+A.slice(1)]})]})}):(0,s.jsx)("div",{className:"flex h-full w-full flex-col overflow-hidden bg-sidebar",children:(0,s.jsxs)("div",{className:"flex flex-1 overflow-hidden min-h-0 gap-2",children:[(0,s.jsxs)("div",{className:"bg-card mb-1 w-full md:w-[400px] lg:w-[480px] shadow-sm lg:h-full lg:shadow-sm flex flex-col rounded-tr-2xl overflow-hidden",children:[(0,s.jsx)("div",{className:"p-4 border-b",children:(0,s.jsxs)(d.Button,{variant:"ghost",size:"sm",onClick:()=>l.push(`/dashboard/communication/${A}`),className:"w-full justify-start",children:[(0,s.jsx)(u.ChevronLeft,{className:"h-4 w-4 mr-2"}),"Back to ",A.charAt(0).toUpperCase()+A.slice(1)]})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",children:B?.emails?.map(e=>{let t=e.id===C.id;return(0,s.jsx)(k.default,{href:`/dashboard/communication/${A}/${e.id}`,className:`block border-b border-border/50 hover:bg-accent/50 transition-colors ${t?"bg-accent":""}`,children:(0,s.jsxs)("div",{className:"p-3 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-foreground line-clamp-1",children:e.from_name||e.from_address||"Unknown"}),!e.read_at&&(0,s.jsx)("div",{className:"h-2 w-2 rounded-full bg-primary shrink-0"})]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-1",children:e.subject||"No subject"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})})]})},e.id)})})]}),(0,s.jsx)("div",{className:"bg-card mb-1 rounded-tl-2xl shadow-sm lg:h-full flex flex-col min-w-0 flex-1 overflow-hidden",children:(0,s.jsx)("div",{className:"relative flex-1 min-h-0 flex flex-col",children:(0,s.jsx)("div",{className:"flex flex-col h-full flex-1 min-h-0",children:(0,s.jsxs)("div",{className:"bg-card relative flex flex-col overflow-hidden transition-all duration-300 h-full flex-1 min-h-0",children:[(0,s.jsxs)("div",{className:"sticky top-0 z-15 flex shrink-0 items-center justify-between gap-1.5 p-2 pb-0 transition-colors bg-card",children:[(0,s.jsxs)("div",{className:"flex flex-1 items-center gap-2",children:[(0,s.jsxs)(d.Button,{variant:"ghost",size:"sm",onClick:()=>l.push(`/dashboard/communication/${A}`),className:"h-8 w-8 p-0 hover:bg-accent/80 active:bg-accent transition-colors",children:[(0,s.jsx)(w.X,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]}),(0,s.jsx)(o.Separator,{orientation:"vertical",className:"h-4 bg-border/60"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsxs)(d.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 hover:bg-accent/80 active:bg-accent transition-colors",children:[(0,s.jsx)(j.ReplyAll,{className:"h-4 w-4 mr-1.5 text-muted-foreground"}),(0,s.jsx)("span",{className:"text-sm leading-none font-medium",children:"Reply all"})]}),(0,s.jsxs)(d.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-accent/80 active:bg-accent transition-colors",title:"Notes",children:[(0,s.jsx)(N.StickyNote,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsx)("span",{className:"sr-only",children:"Notes"})]}),(0,s.jsx)(d.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-accent/80 active:bg-accent transition-colors",title:"Star",children:(0,s.jsx)(g.Star,{className:"h-4 w-4 text-muted-foreground"})}),(0,s.jsx)(d.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-accent/80 active:bg-accent transition-colors",title:"Archive",children:(0,s.jsx)(x.Archive,{className:"h-4 w-4 text-muted-foreground"})}),(0,s.jsx)(d.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-destructive/10 active:bg-destructive/15 transition-colors",title:"Delete",children:(0,s.jsx)(b.Trash,{className:"h-4 w-4 fill-destructive text-destructive"})}),(0,s.jsx)(d.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-accent/80 active:bg-accent transition-colors",title:"More options",children:(0,s.jsx)(p.MoreHorizontal,{className:"h-4 w-4 text-muted-foreground"})})]})]}),(0,s.jsx)("div",{className:"flex min-h-0 flex-1 flex-col overflow-hidden",children:(0,s.jsxs)("div",{className:"relative overflow-hidden flex-1 h-full min-h-0 flex flex-col",children:[(0,s.jsx)(m.TooltipProvider,{children:(0,s.jsxs)("div",{className:"border-b border-border/50 px-2 py-4 space-y-3",children:[(0,s.jsx)("h1",{className:"text-base font-semibold text-foreground",children:C.subject||"No Subject"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(c.Avatar,{className:"h-9 w-9 shrink-0 rounded-md cursor-pointer",children:(0,s.jsx)(c.AvatarFallback,{className:"bg-muted text-muted-foreground font-semibold text-sm rounded-md",children:C.from_address?.[0]?.toUpperCase()||"U"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-semibold text-sm text-foreground",children:C.from_name||C.from_address||"Unknown"}),!C.read_at&&(0,s.jsx)("div",{className:"h-2 w-2 rounded-full bg-primary"})]}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:["to ",C.to_address?.includes("@")?"me"===C.to_address.split("@")[0]?"you":C.to_address.split("@")[0]:"you"]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:new Date(C.created_at).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})})})]})]})}),(0,s.jsxs)("div",{className:"flex-1 overflow-hidden flex flex-col min-h-0",children:[(0,s.jsx)("div",{className:"flex-1 overflow-y-auto px-2 py-4",children:O?(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading email content..."})]})}):(0,s.jsx)(n.EmailContent,{html:U?.html||C.body_html||null,text:U?.text||C.body||null,attachments:null})}),(0,s.jsx)("div",{className:"border-t border-border/50 px-2 py-4 bg-background",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(d.Button,{variant:"default",size:"sm",className:"h-9 px-4",children:[(0,s.jsx)(v.Reply,{className:"h-4 w-4 mr-2"}),"Reply"]}),(0,s.jsxs)(d.Button,{variant:"outline",size:"sm",className:"h-9 px-4",children:[(0,s.jsx)(j.ReplyAll,{className:"h-4 w-4 mr-2"}),"Reply All"]}),(0,s.jsxs)(d.Button,{variant:"outline",size:"sm",className:"h-9 px-4",children:[(0,s.jsx)(f.Forward,{className:"h-4 w-4 mr-2"}),"Forward"]})]})})]})]})})]})})})})]})})}e.s(["default",()=>A],366822)},161886,e=>{e.v(s=>Promise.all(["static/chunks/30bf752a4ae14562.js"].map(s=>e.l(s))).then(()=>s(112867)))}]);