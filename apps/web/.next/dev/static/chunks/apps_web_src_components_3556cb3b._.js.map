{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/schedule/hooks/use-schedule-drag.ts"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useRef } from \"react\";\nimport type { DragStartEvent, DragEndEvent, DragMoveEvent } from \"@dnd-kit/core\";\nimport { arrayMove } from \"@dnd-kit/sortable\";\nimport { format } from \"date-fns\";\nimport { toast } from \"sonner\";\n\nimport type { Job, Technician } from \"@/components/schedule/schedule-types\";\nimport { useScheduleStore } from \"@/lib/stores/schedule-store\";\nimport {\n\tmoveAppointment,\n\tassignNewAppointment,\n\tunassignAppointment,\n} from \"@/actions/schedule-assignments\";\n\n// Constants - exported for use in dispatch-timeline\nexport const DRAG_HOUR_WIDTH = 80; // Must match dispatch-timeline HOUR_WIDTH\nexport const DRAG_SNAP_INTERVAL_MINUTES = 15;\nexport const DRAG_UNASSIGNED_DROP_ID = \"unassigned-dropzone\";\n\n// Type guard for pointer events\nfunction hasClientCoordinates(\n\tevent: Event | null | undefined,\n): event is PointerEvent | MouseEvent | TouchEvent {\n\tif (!event) return false;\n\treturn \"clientX\" in event && \"clientY\" in event;\n}\n\nexport type DragJobCache = {\n\tjob: Job;\n\tstartTime: Date;\n\tendTime: Date;\n\tduration: number;\n\tisFromUnassigned: boolean;\n};\n\nexport type DragPreview = {\n\tlabel: string;\n\ttechnician: string;\n};\n\nexport type UseScheduleDragConfig = {\n\ttechnicians: Technician[];\n\tunassignedJobs: Job[];\n\ttechnicianLanes: Array<{ technicianId: string; jobs: Array<{ job: Job }> }>;\n\ttimeRange: { start: Date; end: Date };\n\ttotalWidth: number;\n\ttimelineRef: React.RefObject<HTMLDivElement | null>;\n\tsetUnassignedOrder: React.Dispatch<React.SetStateAction<string[]>>;\n\tsetActiveJobId: (id: string | null) => void;\n\tsetDragPreview: (preview: DragPreview | null) => void;\n};\n\nexport type UseScheduleDragReturn = {\n\thandleDragStart: (event: DragStartEvent) => void;\n\thandleDragMove: (event: DragMoveEvent) => void;\n\thandleDragEnd: (event: DragEndEvent) => Promise<void>;\n\thandleDragCancel: () => void;\n\tdragJobCacheRef: React.RefObject<DragJobCache | null>;\n\tdragPointerRef: React.RefObject<{ x: number; y: number }>;\n\trafIdRef: React.RefObject<number | null>;\n\tpendingDragMoveRef: React.RefObject<DragMoveEvent | null>;\n\tlastDragPreviewRef: React.RefObject<string>;\n};\n\n/**\n * Custom hook for handling schedule drag and drop operations\n * Separates \"move existing appointment\" from \"assign unassigned job\" operations\n * Uses batched server actions for performance\n */\nexport function useScheduleDrag(config: UseScheduleDragConfig): UseScheduleDragReturn {\n\tconst {\n\t\ttechnicians,\n\t\tunassignedJobs,\n\t\ttechnicianLanes,\n\t\ttimeRange,\n\t\ttotalWidth,\n\t\ttimelineRef,\n\t\tsetUnassignedOrder,\n\t\tsetActiveJobId,\n\t\tsetDragPreview,\n\t} = config;\n\n\t// Store actions\n\tconst moveJob = useScheduleStore((state) => state.moveJob);\n\tconst updateJob = useScheduleStore((state) => state.updateJob);\n\n\t// Refs for performance optimization\n\tconst dragJobCacheRef = useRef<DragJobCache | null>(null);\n\tconst dragPointerRef = useRef<{ x: number; y: number }>({ x: 0, y: 0 });\n\tconst rafIdRef = useRef<number | null>(null);\n\tconst pendingDragMoveRef = useRef<DragMoveEvent | null>(null);\n\tconst lastDragPreviewRef = useRef<string>(\"\");\n\n\t// Rollback state for optimistic updates\n\tconst rollbackStateRef = useRef<{\n\t\tjobId: string;\n\t\tpreviousState: Partial<Job>;\n\t} | null>(null);\n\n\t/**\n\t * Handle drag start - cache job data for performance\n\t */\n\tconst handleDragStart = useCallback(\n\t\t(event: DragStartEvent) => {\n\t\t\tconst jobId = event.active.id as string;\n\t\t\tsetActiveJobId(jobId);\n\t\t\tsetDragPreview(null);\n\n\t\t\t// Check if dragging from unassigned panel first (faster check)\n\t\t\tconst unassignedJob = unassignedJobs.find((j) => j.id === jobId);\n\t\t\tconst isFromUnassigned = !!unassignedJob;\n\n\t\t\tif (isFromUnassigned && unassignedJob) {\n\t\t\t\t// Cache unassigned job data\n\t\t\t\tconst startTime =\n\t\t\t\t\tunassignedJob.startTime instanceof Date\n\t\t\t\t\t\t? unassignedJob.startTime\n\t\t\t\t\t\t: new Date(unassignedJob.startTime || Date.now());\n\t\t\t\tconst endTime =\n\t\t\t\t\tunassignedJob.endTime instanceof Date\n\t\t\t\t\t\t? unassignedJob.endTime\n\t\t\t\t\t\t: new Date(unassignedJob.endTime || Date.now() + 2 * 60 * 60 * 1000);\n\n\t\t\t\tdragJobCacheRef.current = {\n\t\t\t\t\tjob: unassignedJob,\n\t\t\t\t\tstartTime,\n\t\t\t\t\tendTime,\n\t\t\t\t\tduration: endTime.getTime() - startTime.getTime(),\n\t\t\t\t\tisFromUnassigned: true,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\t// Search technician lanes for existing job\n\t\t\t\tconst jobData = technicianLanes\n\t\t\t\t\t.flatMap((lane) => lane.jobs)\n\t\t\t\t\t.find((j) => j.job.id === jobId);\n\n\t\t\t\tif (jobData) {\n\t\t\t\t\tconst job = jobData.job;\n\t\t\t\t\tconst startTime =\n\t\t\t\t\t\tjob.startTime instanceof Date ? job.startTime : new Date(job.startTime);\n\t\t\t\t\tconst endTime =\n\t\t\t\t\t\tjob.endTime instanceof Date ? job.endTime : new Date(job.endTime);\n\n\t\t\t\t\tdragJobCacheRef.current = {\n\t\t\t\t\t\tjob,\n\t\t\t\t\t\tstartTime,\n\t\t\t\t\t\tendTime,\n\t\t\t\t\t\tduration: endTime.getTime() - startTime.getTime(),\n\t\t\t\t\t\tisFromUnassigned: false,\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tdragJobCacheRef.current = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Capture pointer position for drop time calculation\n\t\t\tconst activator = event.activatorEvent;\n\t\t\tif (hasClientCoordinates(activator)) {\n\t\t\t\tdragPointerRef.current = {\n\t\t\t\t\tx: activator.clientX,\n\t\t\t\t\ty: activator.clientY,\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\t\t[technicianLanes, unassignedJobs, setActiveJobId, setDragPreview],\n\t);\n\n\t/**\n\t * Process drag move updates (throttled via RAF)\n\t */\n\tconst processDragMove = useCallback(() => {\n\t\tconst event = pendingDragMoveRef.current;\n\t\tif (!event) return;\n\n\t\tconst cached = dragJobCacheRef.current;\n\t\tif (!cached) {\n\t\t\tsetDragPreview(null);\n\t\t\treturn;\n\t\t}\n\n\t\tconst { job, startTime, duration, isFromUnassigned } = cached;\n\t\tconst targetTechnicianId =\n\t\t\t(event.over?.id as string | undefined) ?? job.technicianId;\n\t\tconst targetTech = technicians.find((tech) => tech.id === targetTechnicianId);\n\n\t\tlet newStart: Date;\n\t\tlet newEnd: Date;\n\n\t\tif (isFromUnassigned) {\n\t\t\t// For unassigned jobs, calculate drop time from current pointer position\n\t\t\tconst timelineRect = timelineRef.current?.getBoundingClientRect();\n\t\t\tif (timelineRect) {\n\t\t\t\tconst currentX = dragPointerRef.current.x + event.delta.x;\n\t\t\t\tconst relativeX = currentX - timelineRect.left;\n\t\t\t\tconst minutesFromStart = (relativeX / totalWidth) * (24 * 60);\n\t\t\t\tconst snappedMinutes = Math.round(minutesFromStart / DRAG_SNAP_INTERVAL_MINUTES) * DRAG_SNAP_INTERVAL_MINUTES;\n\n\t\t\t\tnewStart = new Date(timeRange.start);\n\t\t\t\tnewStart.setMinutes(newStart.getMinutes() + snappedMinutes);\n\t\t\t\tnewEnd = new Date(newStart.getTime() + duration);\n\t\t\t} else {\n\t\t\t\tnewStart = startTime;\n\t\t\t\tnewEnd = new Date(startTime.getTime() + duration);\n\t\t\t}\n\t\t} else {\n\t\t\t// For existing jobs, calculate time change from horizontal drag delta\n\t\t\tconst deltaMinutes = Math.round((event.delta.x / DRAG_HOUR_WIDTH) * 60);\n\t\t\tconst snappedMinutes =\n\t\t\t\tMath.round(deltaMinutes / DRAG_SNAP_INTERVAL_MINUTES) * DRAG_SNAP_INTERVAL_MINUTES;\n\t\t\tnewStart = new Date(startTime.getTime() + snappedMinutes * 60 * 1000);\n\t\t\tnewEnd = new Date(newStart.getTime() + duration);\n\t\t}\n\n\t\t// Only update state if the label actually changed\n\t\tconst newLabel = `${format(newStart, \"h:mm a\")} – ${format(newEnd, \"h:mm a\")}`;\n\t\tconst newTechnician = targetTech?.name ?? \"Unassigned\";\n\t\tconst previewKey = `${newLabel}|${newTechnician}`;\n\n\t\tif (previewKey !== lastDragPreviewRef.current) {\n\t\t\tlastDragPreviewRef.current = previewKey;\n\t\t\tsetDragPreview({\n\t\t\t\tlabel: newLabel,\n\t\t\t\ttechnician: newTechnician,\n\t\t\t});\n\t\t}\n\n\t\trafIdRef.current = null;\n\t}, [technicians, timeRange, totalWidth, timelineRef, setDragPreview]);\n\n\t/**\n\t * Handle drag move - throttle updates to 60fps using RAF\n\t */\n\tconst handleDragMove = useCallback(\n\t\t(event: DragMoveEvent) => {\n\t\t\tpendingDragMoveRef.current = event;\n\n\t\t\t// Update pointer position for accurate drop calculations\n\t\t\tconst activator = event.activatorEvent;\n\t\t\tif (hasClientCoordinates(activator)) {\n\t\t\t\tdragPointerRef.current = {\n\t\t\t\t\tx: activator.clientX,\n\t\t\t\t\ty: activator.clientY,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (rafIdRef.current === null) {\n\t\t\t\trafIdRef.current = requestAnimationFrame(processDragMove);\n\t\t\t}\n\t\t},\n\t\t[processDragMove],\n\t);\n\n\t/**\n\t * Handle moving an existing appointment to a new time/technician\n\t */\n\tconst handleMoveExistingAppointment = useCallback(\n\t\tasync (\n\t\t\tjob: Job,\n\t\t\ttargetTechnicianId: string,\n\t\t\tdelta: { x: number; y: number },\n\t\t): Promise<boolean> => {\n\t\t\tconst targetTech = technicians.find((t) => t.id === targetTechnicianId);\n\t\t\tconst techIdForDb = targetTech?.userId || targetTechnicianId;\n\n\t\t\t// Calculate new times from drag delta\n\t\t\tconst deltaMinutes = Math.round((delta.x / DRAG_HOUR_WIDTH) * 60);\n\t\t\tconst snappedMinutes =\n\t\t\t\tMath.round(deltaMinutes / DRAG_SNAP_INTERVAL_MINUTES) * DRAG_SNAP_INTERVAL_MINUTES;\n\n\t\t\tconst oldStart =\n\t\t\t\tjob.startTime instanceof Date ? job.startTime : new Date(job.startTime);\n\t\t\tconst oldEnd =\n\t\t\t\tjob.endTime instanceof Date ? job.endTime : new Date(job.endTime);\n\t\t\tconst duration = oldEnd.getTime() - oldStart.getTime();\n\n\t\t\tconst newStart = new Date(oldStart.getTime() + snappedMinutes * 60 * 1000);\n\t\t\tconst newEnd = new Date(newStart.getTime() + duration);\n\n\t\t\t// Store previous state for rollback\n\t\t\trollbackStateRef.current = {\n\t\t\t\tjobId: job.id,\n\t\t\t\tpreviousState: {\n\t\t\t\t\ttechnicianId: job.technicianId,\n\t\t\t\t\tstartTime: oldStart,\n\t\t\t\t\tendTime: oldEnd,\n\t\t\t\t\tassignments: [...job.assignments],\n\t\t\t\t\tisUnassigned: job.isUnassigned,\n\t\t\t\t},\n\t\t\t};\n\n\t\t\t// Optimistic update\n\t\t\tmoveJob(job.id, targetTechnicianId, newStart, newEnd);\n\n\t\t\tconst toastId = toast.loading(\n\t\t\t\t`Moving to ${targetTech?.name} at ${format(newStart, \"h:mm a\")}...`,\n\t\t\t);\n\n\t\t\t// Single batched server call\n\t\t\tconst result = await moveAppointment(job.id, techIdForDb, newStart, newEnd);\n\n\t\t\tif (!result.success) {\n\t\t\t\t// Rollback on failure\n\t\t\t\tif (rollbackStateRef.current) {\n\t\t\t\t\tconst { previousState } = rollbackStateRef.current;\n\t\t\t\t\tupdateJob(job.id, previousState);\n\t\t\t\t}\n\t\t\t\ttoast.error(result.error || \"Failed to move appointment\", { id: toastId });\n\t\t\t\trollbackStateRef.current = null;\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\ttoast.success(`Moved to ${targetTech?.name} at ${format(newStart, \"h:mm a\")}`, {\n\t\t\t\tid: toastId,\n\t\t\t});\n\t\t\trollbackStateRef.current = null;\n\t\t\treturn true;\n\t\t},\n\t\t[technicians, moveJob, updateJob],\n\t);\n\n\t/**\n\t * Handle assigning an unassigned job to a technician\n\t */\n\tconst handleAssignUnassignedJob = useCallback(\n\t\tasync (job: Job, targetTechnicianId: string): Promise<boolean> => {\n\t\t\tconst targetTech = technicians.find((t) => t.id === targetTechnicianId);\n\t\t\tconst techIdForDb = targetTech?.userId || targetTechnicianId;\n\n\t\t\t// Calculate drop time from cursor position\n\t\t\tconst dropX = dragPointerRef.current.x;\n\t\t\tconst timelineRect = timelineRef.current?.getBoundingClientRect();\n\n\t\t\tlet newStart: Date;\n\t\t\tlet newEnd: Date;\n\n\t\t\tif (timelineRect) {\n\t\t\t\tconst relativeX = dropX - timelineRect.left;\n\t\t\t\tconst minutesFromStart = (relativeX / totalWidth) * (24 * 60);\n\t\t\t\tconst snappedMinutes =\n\t\t\t\t\tMath.round(minutesFromStart / DRAG_SNAP_INTERVAL_MINUTES) * DRAG_SNAP_INTERVAL_MINUTES;\n\n\t\t\t\tnewStart = new Date(timeRange.start);\n\t\t\t\tnewStart.setMinutes(newStart.getMinutes() + snappedMinutes);\n\n\t\t\t\t// Use job's existing duration or default to 2 hours\n\t\t\t\tconst existingDuration =\n\t\t\t\t\tjob.endTime && job.startTime\n\t\t\t\t\t\t? new Date(job.endTime).getTime() - new Date(job.startTime).getTime()\n\t\t\t\t\t\t: 2 * 60 * 60 * 1000;\n\t\t\t\tnewEnd = new Date(newStart.getTime() + existingDuration);\n\t\t\t} else {\n\t\t\t\t// Fallback to current time\n\t\t\t\tnewStart = new Date();\n\t\t\t\tnewStart.setMinutes(\n\t\t\t\t\tMath.round(newStart.getMinutes() / DRAG_SNAP_INTERVAL_MINUTES) * DRAG_SNAP_INTERVAL_MINUTES,\n\t\t\t\t);\n\t\t\t\tnewEnd = new Date(newStart.getTime() + 2 * 60 * 60 * 1000);\n\t\t\t}\n\n\t\t\t// Store previous state for rollback\n\t\t\trollbackStateRef.current = {\n\t\t\t\tjobId: job.id,\n\t\t\t\tpreviousState: {\n\t\t\t\t\ttechnicianId: job.technicianId,\n\t\t\t\t\tstartTime: job.startTime,\n\t\t\t\t\tendTime: job.endTime,\n\t\t\t\t\tassignments: [...job.assignments],\n\t\t\t\t\tisUnassigned: true,\n\t\t\t\t},\n\t\t\t};\n\n\t\t\t// Optimistic update\n\t\t\tmoveJob(job.id, targetTechnicianId, newStart, newEnd);\n\n\t\t\tconst toastId = toast.loading(\n\t\t\t\t`Scheduling for ${targetTech?.name} at ${format(newStart, \"h:mm a\")}...`,\n\t\t\t);\n\n\t\t\t// Single batched server call\n\t\t\tconst result = await assignNewAppointment(job.id, techIdForDb, newStart, newEnd);\n\n\t\t\tif (!result.success) {\n\t\t\t\t// Rollback on failure\n\t\t\t\tif (rollbackStateRef.current) {\n\t\t\t\t\tconst { previousState } = rollbackStateRef.current;\n\t\t\t\t\tupdateJob(job.id, previousState);\n\t\t\t\t}\n\t\t\t\ttoast.error(result.error || \"Failed to assign appointment\", { id: toastId });\n\t\t\t\trollbackStateRef.current = null;\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\ttoast.success(\n\t\t\t\t`Scheduled for ${targetTech?.name} at ${format(newStart, \"h:mm a\")}`,\n\t\t\t\t{ id: toastId },\n\t\t\t);\n\t\t\trollbackStateRef.current = null;\n\t\t\treturn true;\n\t\t},\n\t\t[technicians, moveJob, updateJob, timeRange, totalWidth, timelineRef],\n\t);\n\n\t/**\n\t * Handle drag cancel - cleanup all state\n\t */\n\tconst handleDragCancel = useCallback(() => {\n\t\tsetActiveJobId(null);\n\t\tsetDragPreview(null);\n\n\t\t// Cleanup RAF\n\t\tif (rafIdRef.current !== null) {\n\t\t\tcancelAnimationFrame(rafIdRef.current);\n\t\t\trafIdRef.current = null;\n\t\t}\n\t\tpendingDragMoveRef.current = null;\n\t\tdragJobCacheRef.current = null;\n\t\tlastDragPreviewRef.current = \"\";\n\t}, [setActiveJobId, setDragPreview]);\n\n\t/**\n\t * Handle drag end - determine operation type and execute\n\t */\n\tconst handleDragEnd = useCallback(\n\t\tasync (event: DragEndEvent) => {\n\t\t\tconst { active, over, delta } = event;\n\n\t\t\t// Reset UI state\n\t\t\tsetActiveJobId(null);\n\t\t\tsetDragPreview(null);\n\n\t\t\t// Cleanup RAF\n\t\t\tif (rafIdRef.current !== null) {\n\t\t\t\tcancelAnimationFrame(rafIdRef.current);\n\t\t\t\trafIdRef.current = null;\n\t\t\t}\n\t\t\tpendingDragMoveRef.current = null;\n\t\t\tlastDragPreviewRef.current = \"\";\n\n\t\t\tif (!over) {\n\t\t\t\tdragJobCacheRef.current = null;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst jobId = active.id as string;\n\t\t\tconst overId = over.id as string;\n\n\t\t\t// Use cached data instead of re-searching (O(1) vs O(n))\n\t\t\tconst cached = dragJobCacheRef.current;\n\t\t\tif (!cached || cached.job.id !== jobId) {\n\t\t\t\tdragJobCacheRef.current = null;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { job, isFromUnassigned } = cached;\n\t\t\tconst droppedOnUnassigned = overId === DRAG_UNASSIGNED_DROP_ID;\n\t\t\tconst overIsUnassignedJob = unassignedJobs.some((j) => j.id === overId);\n\n\t\t\t// Clean up cache\n\t\t\tdragJobCacheRef.current = null;\n\n\t\t\t// CASE 1: Reordering within unassigned panel\n\t\t\tif (isFromUnassigned && overIsUnassignedJob && jobId !== overId) {\n\t\t\t\tsetUnassignedOrder((prev) => {\n\t\t\t\t\tconst fromIndex = prev.indexOf(jobId);\n\t\t\t\t\tconst toIndex = prev.indexOf(overId);\n\t\t\t\t\tif (fromIndex === -1 || toIndex === -1) return prev;\n\t\t\t\t\treturn arrayMove(prev, fromIndex, toIndex);\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// CASE 2: Moving to unassigned panel (unscheduling)\n\t\t\tif (droppedOnUnassigned) {\n\t\t\t\tif (isFromUnassigned) {\n\t\t\t\t\t// Already unassigned, just reorder to end\n\t\t\t\t\tsetUnassignedOrder((prev) => {\n\t\t\t\t\t\tconst fromIndex = prev.indexOf(jobId);\n\t\t\t\t\t\tif (fromIndex === -1) return prev;\n\t\t\t\t\t\treturn arrayMove(prev, fromIndex, prev.length - 1);\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Unassign existing appointment\n\t\t\t\tconst startTime =\n\t\t\t\t\tjob.startTime instanceof Date ? job.startTime : new Date(job.startTime);\n\t\t\t\tconst endTime =\n\t\t\t\t\tjob.endTime instanceof Date ? job.endTime : new Date(job.endTime);\n\n\t\t\t\tupdateJob(jobId, {\n\t\t\t\t\ttechnicianId: \"\",\n\t\t\t\t\tassignments: [],\n\t\t\t\t\tisUnassigned: true,\n\t\t\t\t\tstartTime,\n\t\t\t\t\tendTime,\n\t\t\t\t});\n\n\t\t\t\tconst toastId = toast.loading(\"Moving appointment to Unscheduled...\");\n\t\t\t\tconst result = await unassignAppointment(jobId);\n\n\t\t\t\tif (result.success) {\n\t\t\t\t\ttoast.success(\"Appointment moved to Unscheduled\", { id: toastId });\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(result.error || \"Failed to unschedule appointment\", {\n\t\t\t\t\t\tid: toastId,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// CASE 3: Assigning unassigned job to technician (CREATE operation)\n\t\t\tif (isFromUnassigned) {\n\t\t\t\tawait handleAssignUnassignedJob(job, overId);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// CASE 4: Moving existing appointment (MOVE operation)\n\t\t\tawait handleMoveExistingAppointment(job, overId, delta);\n\t\t},\n\t\t[\n\t\t\tunassignedJobs,\n\t\t\tupdateJob,\n\t\t\tsetUnassignedOrder,\n\t\t\thandleAssignUnassignedJob,\n\t\t\thandleMoveExistingAppointment,\n\t\t\tsetActiveJobId,\n\t\t\tsetDragPreview,\n\t\t],\n\t);\n\n\treturn {\n\t\thandleDragStart,\n\t\thandleDragMove,\n\t\thandleDragEnd,\n\t\thandleDragCancel,\n\t\t// Expose refs for any external cleanup needs\n\t\tdragJobCacheRef,\n\t\tdragPointerRef,\n\t\trafIdRef,\n\t\tpendingDragMoveRef,\n\t\tlastDragPreviewRef,\n\t};\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 472, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/ui/context-menu.tsx"],"sourcesContent":["// Re-export from @stratos/ui package\nexport * from \"@stratos/ui\";\n"],"names":[],"mappings":"AAAA,qCAAqC;;AACrC"}},
    {"offset": {"line": 483, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/schedule/schedule-job-context-menu.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRouter } from \"next/navigation\";\nimport { toast } from \"sonner\";\nimport {\n\tArchive,\n\tCalendar,\n\tCheckCircle2,\n\tChevronRight,\n\tClock,\n\tCopy,\n\tExternalLink,\n\tMapPin,\n\tMessageSquare,\n\tMoreHorizontal,\n\tNavigation,\n\tPhone,\n\tSend,\n\tTrash2,\n\tTruck,\n\tUserCheck,\n\tUserMinus,\n\tXCircle,\n} from \"lucide-react\";\nimport {\n\tarchiveAppointment,\n\tarriveAppointment,\n\tcancelAppointment,\n\tcancelJobAndAppointment,\n\tcloseAppointment,\n\tcompleteAppointment,\n\tdispatchAppointment,\n\tsendOnMyWayNotification,\n\tunassignAppointment,\n} from \"@/actions/schedule-assignments\";\nimport {\n\tContextMenu,\n\tContextMenuContent,\n\tContextMenuItem,\n\tContextMenuLabel,\n\tContextMenuSeparator,\n\tContextMenuShortcut,\n\tContextMenuSub,\n\tContextMenuSubContent,\n\tContextMenuSubTrigger,\n\tContextMenuTrigger,\n} from \"@/components/ui/context-menu\";\nimport { cn } from \"@/lib/utils\";\nimport type { Job } from \"./schedule-types\";\n\ntype ScheduleJobContextMenuProps = {\n\tjob: Job;\n\tchildren: React.ReactNode;\n\tonOpenChange?: (open: boolean) => void;\n};\n\n// Status workflow order for visual display\nconst STATUS_ORDER = [\"scheduled\", \"dispatched\", \"arrived\", \"in-progress\", \"closed\", \"completed\"];\n\n// Get current status step for progress indicator\nfunction getStatusStep(status: Job[\"status\"]) {\n\tconst idx = STATUS_ORDER.indexOf(status);\n\treturn idx === -1 ? 0 : idx;\n}\n\nexport function ScheduleJobContextMenu({\n\tjob,\n\tchildren,\n\tonOpenChange,\n}: ScheduleJobContextMenuProps) {\n\tconst router = useRouter();\n\tconst currentStep = getStatusStep(job.status);\n\tconst isCancelled = job.status === \"cancelled\";\n\tconst isClosed = job.status === \"closed\" || job.status === \"completed\";\n\n\tconst handleAction = async (\n\t\taction: string,\n\t\tactionFn: (id: string, ...args: unknown[]) => Promise<{ success: boolean; error?: string }>,\n\t\t...args: unknown[]\n\t) => {\n\t\tconst toastId = toast.loading(`${action}...`);\n\t\tconst result = await actionFn(job.id, ...args);\n\n\t\tif (result.success) {\n\t\t\ttoast.success(`${action} successful`, { id: toastId });\n\t\t} else {\n\t\t\ttoast.error(result.error || `Failed to ${action.toLowerCase()}`, {\n\t\t\t\tid: toastId,\n\t\t\t});\n\t\t}\n\t};\n\n\tconst handleSendOnMyWay = async () => {\n\t\tif (!job.customer?.phone) {\n\t\t\ttoast.error(\"Customer has no phone number\");\n\t\t\treturn;\n\t\t}\n\t\tconst techName = job.assignments[0]?.displayName || \"Your technician\";\n\t\tconst address = job.location?.address\n\t\t\t? `${job.location.address.street}, ${job.location.address.city}, ${job.location.address.state}`\n\t\t\t: undefined;\n\n\t\ttoast.loading(\"Sending On My Way notification...\");\n\t\tconst result = await sendOnMyWayNotification(\n\t\t\tjob.id,\n\t\t\ttechName,\n\t\t\tjob.customer.phone,\n\t\t\taddress,\n\t\t);\n\t\ttoast.dismiss();\n\n\t\tif (result.success) {\n\t\t\ttoast.success(\"On My Way notification sent!\");\n\t\t} else {\n\t\t\ttoast.error(result.error || \"Failed to send notification\");\n\t\t}\n\t};\n\n\treturn (\n\t\t<ContextMenu onOpenChange={onOpenChange}>\n\t\t\t<ContextMenuTrigger asChild>{children}</ContextMenuTrigger>\n\n\t\t\t<ContextMenuContent className=\"w-64\">\n\t\t\t\t{/* Header - Job Info */}\n\t\t\t\t<div className=\"px-2 py-2 border-b mb-1\">\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\"size-2 rounded-full shrink-0\",\n\t\t\t\t\t\t\t\tjob.status === \"scheduled\" && \"bg-blue-500\",\n\t\t\t\t\t\t\t\tjob.status === \"dispatched\" && \"bg-sky-500\",\n\t\t\t\t\t\t\t\tjob.status === \"arrived\" && \"bg-emerald-400\",\n\t\t\t\t\t\t\t\tjob.status === \"in-progress\" && \"bg-amber-500 animate-pulse\",\n\t\t\t\t\t\t\t\tjob.status === \"closed\" && \"bg-emerald-600\",\n\t\t\t\t\t\t\t\tjob.status === \"completed\" && \"bg-emerald-600\",\n\t\t\t\t\t\t\t\tjob.status === \"cancelled\" && \"bg-slate-400\",\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span className=\"text-sm font-semibold truncate flex-1\">\n\t\t\t\t\t\t\t{job.customer?.name || \"Unknown Customer\"}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<p className=\"text-xs text-muted-foreground mt-0.5 truncate pl-4\">\n\t\t\t\t\t\t{job.title}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t{/* View Actions */}\n\t\t\t\t<ContextMenuLabel className=\"text-xs text-muted-foreground font-normal\">\n\t\t\t\t\tView\n\t\t\t\t</ContextMenuLabel>\n\t\t\t\t<ContextMenuItem\n\t\t\t\t\tdisabled={!job.jobId}\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tif (job.jobId) {\n\t\t\t\t\t\t\trouter.push(`/dashboard/work/${job.jobId}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<ExternalLink className=\"size-4\" />\n\t\t\t\t\t<span>View Job Details</span>\n\t\t\t\t\t<ContextMenuShortcut>⌘O</ContextMenuShortcut>\n\t\t\t\t</ContextMenuItem>\n\n\t\t\t\t{job.location?.address && (\n\t\t\t\t\t<ContextMenuItem\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tconst address = `${job.location?.address?.street}, ${job.location?.address?.city}, ${job.location?.address?.state}`;\n\t\t\t\t\t\t\twindow.open(\n\t\t\t\t\t\t\t\t`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}`,\n\t\t\t\t\t\t\t\t\"_blank\"\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Navigation className=\"size-4\" />\n\t\t\t\t\t\t<span>Open in Maps</span>\n\t\t\t\t\t</ContextMenuItem>\n\t\t\t\t)}\n\n\t\t\t\t<ContextMenuSeparator />\n\n\t\t\t\t{/* Status Progression */}\n\t\t\t\t<ContextMenuLabel className=\"text-xs text-muted-foreground font-normal\">\n\t\t\t\t\tUpdate Status\n\t\t\t\t</ContextMenuLabel>\n\n\t\t\t\t{/* Progress indicator */}\n\t\t\t\t{!isCancelled && (\n\t\t\t\t\t<div className=\"px-2 py-1.5 mb-1\">\n\t\t\t\t\t\t<div className=\"flex items-center gap-0.5\">\n\t\t\t\t\t\t\t{STATUS_ORDER.slice(0, -1).map((status, idx) => (\n\t\t\t\t\t\t\t\t<div key={status} className=\"flex items-center flex-1\">\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"h-1 flex-1 rounded-full transition-colors\",\n\t\t\t\t\t\t\t\t\t\t\tidx < currentStep\n\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-emerald-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t: idx === currentStep\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-blue-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-muted\",\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p className=\"text-[10px] text-muted-foreground mt-1 text-center capitalize\">\n\t\t\t\t\t\t\tCurrent: {job.status.replace(\"-\", \" \")}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\n\t\t\t\t<ContextMenuItem\n\t\t\t\t\tdisabled={currentStep >= 1 || isCancelled}\n\t\t\t\t\tonClick={() => handleAction(\"Dispatching\", dispatchAppointment)}\n\t\t\t\t>\n\t\t\t\t\t<Truck className=\"size-4\" />\n\t\t\t\t\t<span>Mark Dispatched</span>\n\t\t\t\t\t{currentStep >= 1 && !isCancelled && (\n\t\t\t\t\t\t<CheckCircle2 className=\"size-3.5 text-emerald-500 ml-auto\" />\n\t\t\t\t\t)}\n\t\t\t\t</ContextMenuItem>\n\n\t\t\t\t{job.customer?.phone && (\n\t\t\t\t\t<ContextMenuItem\n\t\t\t\t\t\tdisabled={currentStep >= 2 || isCancelled}\n\t\t\t\t\t\tonClick={handleSendOnMyWay}\n\t\t\t\t\t\tclassName=\"text-sky-600 dark:text-sky-400\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Send className=\"size-4\" />\n\t\t\t\t\t\t<span>Send \"On My Way\" SMS</span>\n\t\t\t\t\t</ContextMenuItem>\n\t\t\t\t)}\n\n\t\t\t\t<ContextMenuItem\n\t\t\t\t\tdisabled={currentStep >= 2 || isCancelled}\n\t\t\t\t\tonClick={() => handleAction(\"Marking arrived\", arriveAppointment)}\n\t\t\t\t>\n\t\t\t\t\t<MapPin className=\"size-4\" />\n\t\t\t\t\t<span>Mark Arrived</span>\n\t\t\t\t\t{currentStep >= 2 && !isCancelled && (\n\t\t\t\t\t\t<CheckCircle2 className=\"size-3.5 text-emerald-500 ml-auto\" />\n\t\t\t\t\t)}\n\t\t\t\t</ContextMenuItem>\n\n\t\t\t\t<ContextMenuItem\n\t\t\t\t\tdisabled={currentStep >= 4 || isCancelled}\n\t\t\t\t\tonClick={() => handleAction(\"Closing\", closeAppointment)}\n\t\t\t\t>\n\t\t\t\t\t<UserCheck className=\"size-4\" />\n\t\t\t\t\t<span>Mark Closed</span>\n\t\t\t\t\t{currentStep >= 4 && !isCancelled && (\n\t\t\t\t\t\t<CheckCircle2 className=\"size-3.5 text-emerald-500 ml-auto\" />\n\t\t\t\t\t)}\n\t\t\t\t</ContextMenuItem>\n\n\t\t\t\t<ContextMenuItem\n\t\t\t\t\tdisabled={isClosed || isCancelled}\n\t\t\t\t\tonClick={() => handleAction(\"Completing\", completeAppointment)}\n\t\t\t\t>\n\t\t\t\t\t<CheckCircle2 className=\"size-4\" />\n\t\t\t\t\t<span>Mark Complete</span>\n\t\t\t\t\t{(job.status === \"completed\") && (\n\t\t\t\t\t\t<CheckCircle2 className=\"size-3.5 text-emerald-500 ml-auto\" />\n\t\t\t\t\t)}\n\t\t\t\t</ContextMenuItem>\n\n\t\t\t\t<ContextMenuSeparator />\n\n\t\t\t\t{/* Communication */}\n\t\t\t\t{(job.customer?.phone || job.customer?.email) && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<ContextMenuSub>\n\t\t\t\t\t\t\t<ContextMenuSubTrigger>\n\t\t\t\t\t\t\t\t<MessageSquare className=\"size-4\" />\n\t\t\t\t\t\t\t\t<span>Contact Customer</span>\n\t\t\t\t\t\t\t</ContextMenuSubTrigger>\n\t\t\t\t\t\t\t<ContextMenuSubContent className=\"w-48\">\n\t\t\t\t\t\t\t\t{job.customer?.phone && (\n\t\t\t\t\t\t\t\t\t<ContextMenuItem\n\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\twindow.location.href = `tel:${job.customer?.phone}`;\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Phone className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t<span>Call {job.customer.phone}</span>\n\t\t\t\t\t\t\t\t\t</ContextMenuItem>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{job.customer?.phone && (\n\t\t\t\t\t\t\t\t\t<ContextMenuItem\n\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\twindow.location.href = `sms:${job.customer?.phone}`;\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<MessageSquare className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t<span>Send SMS</span>\n\t\t\t\t\t\t\t\t\t</ContextMenuItem>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</ContextMenuSubContent>\n\t\t\t\t\t\t</ContextMenuSub>\n\t\t\t\t\t\t<ContextMenuSeparator />\n\t\t\t\t\t</>\n\t\t\t\t)}\n\n\t\t\t\t{/* Scheduling Actions */}\n\t\t\t\t<ContextMenuLabel className=\"text-xs text-muted-foreground font-normal\">\n\t\t\t\t\tSchedule\n\t\t\t\t</ContextMenuLabel>\n\n\t\t\t\t<ContextMenuItem>\n\t\t\t\t\t<Calendar className=\"size-4\" />\n\t\t\t\t\t<span>Reschedule</span>\n\t\t\t\t\t<ContextMenuShortcut>⌘R</ContextMenuShortcut>\n\t\t\t\t</ContextMenuItem>\n\n\t\t\t\t<ContextMenuItem>\n\t\t\t\t\t<Copy className=\"size-4\" />\n\t\t\t\t\t<span>Duplicate</span>\n\t\t\t\t\t<ContextMenuShortcut>⌘D</ContextMenuShortcut>\n\t\t\t\t</ContextMenuItem>\n\n\t\t\t\t<ContextMenuItem\n\t\t\t\t\tonClick={() => handleAction(\"Moving to Unscheduled\", unassignAppointment)}\n\t\t\t\t>\n\t\t\t\t\t<UserMinus className=\"size-4\" />\n\t\t\t\t\t<span>Move to Unscheduled</span>\n\t\t\t\t</ContextMenuItem>\n\n\t\t\t\t<ContextMenuSeparator />\n\n\t\t\t\t{/* Danger Zone */}\n\t\t\t\t<ContextMenuSub>\n\t\t\t\t\t<ContextMenuSubTrigger className=\"text-destructive focus:text-destructive\">\n\t\t\t\t\t\t<MoreHorizontal className=\"size-4\" />\n\t\t\t\t\t\t<span>More Actions</span>\n\t\t\t\t\t</ContextMenuSubTrigger>\n\t\t\t\t\t<ContextMenuSubContent className=\"w-56\">\n\t\t\t\t\t\t<ContextMenuItem\n\t\t\t\t\t\t\tclassName=\"text-orange-600 focus:text-orange-600 dark:text-orange-400 dark:focus:text-orange-400\"\n\t\t\t\t\t\t\tdisabled={isCancelled}\n\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\thandleAction(\"Cancelling appointment\", cancelAppointment)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<XCircle className=\"size-4\" />\n\t\t\t\t\t\t\t<span>Cancel Appointment Only</span>\n\t\t\t\t\t\t</ContextMenuItem>\n\n\t\t\t\t\t\t<ContextMenuItem\n\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\tdisabled={isCancelled || !job.jobId}\n\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\thandleAction(\"Cancelling job & appointment\", (scheduleId) =>\n\t\t\t\t\t\t\t\t\tcancelJobAndAppointment(scheduleId as string, job.jobId ?? \"\"),\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Trash2 className=\"size-4\" />\n\t\t\t\t\t\t\t<span>Cancel Job & Appointment</span>\n\t\t\t\t\t\t</ContextMenuItem>\n\n\t\t\t\t\t\t<ContextMenuSeparator />\n\n\t\t\t\t\t\t<ContextMenuItem\n\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\tonClick={() => handleAction(\"Archiving\", archiveAppointment)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Archive className=\"size-4\" />\n\t\t\t\t\t\t\t<span>Archive</span>\n\t\t\t\t\t\t</ContextMenuItem>\n\t\t\t\t\t</ContextMenuSubContent>\n\t\t\t\t</ContextMenuSub>\n\t\t\t</ContextMenuContent>\n\t\t</ContextMenu>\n\t);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1250, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/schedule/schedule-command-menu.tsx"],"sourcesContent":["\"use client\";\n\nimport { format } from \"date-fns\";\nimport {\n\tArrowRight,\n\tBriefcase,\n\tCalendar,\n\tClock,\n\tMapPin,\n\tPlus,\n\tSearch,\n\tSparkles,\n\tUser,\n} from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\nimport { useCallback, useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n\tCommandDialog,\n\tCommandEmpty,\n\tCommandGroup,\n\tCommandInput,\n\tCommandItem,\n\tCommandList,\n\tCommandSeparator,\n} from \"@/components/ui/command\";\nimport { cn } from \"@/lib/utils\";\nimport type { Job } from \"./schedule-types\";\n\ntype ScheduleCommandMenuProps = {\n\tisOpen: boolean;\n\tonClose: () => void;\n\tselectedDate: Date | null;\n\tselectedTechnicianId?: string | null;\n\tselectedTechnicianName?: string;\n\tunassignedJobs?: Job[];\n};\n\nexport function ScheduleCommandMenu({\n\tisOpen,\n\tonClose,\n\tselectedDate,\n\tselectedTechnicianId,\n\tselectedTechnicianName,\n\tunassignedJobs = [],\n}: ScheduleCommandMenuProps) {\n\tconst router = useRouter();\n\tconst [searchQuery, setSearchQuery] = useState(\"\");\n\n\tconst handleCreateNew = useCallback(() => {\n\t\tconst params = new URLSearchParams();\n\n\t\tif (selectedDate) {\n\t\t\tparams.set(\"date\", format(selectedDate, \"yyyy-MM-dd\"));\n\t\t\tparams.set(\"startTime\", format(selectedDate, \"HH:mm\"));\n\t\t}\n\n\t\tif (selectedTechnicianId) {\n\t\t\tparams.set(\"assignTo\", selectedTechnicianId);\n\t\t}\n\n\t\tconst queryString = params.toString();\n\t\trouter.push(`/dashboard/work/new${queryString ? `?${queryString}` : \"\"}`);\n\t\tonClose();\n\t}, [selectedDate, selectedTechnicianId, router, onClose]);\n\n\tconst handleSelectUnassigned = useCallback(\n\t\t(job: Job) => {\n\t\t\t// Navigate to job details to schedule it\n\t\t\tif (job.jobId) {\n\t\t\t\trouter.push(`/dashboard/work/${job.jobId}`);\n\t\t\t}\n\t\t\tonClose();\n\t\t},\n\t\t[router, onClose],\n\t);\n\n\t// Filter unassigned jobs by search query\n\tconst filteredJobs = unassignedJobs.filter((job) => {\n\t\tif (!searchQuery) {\n\t\t\treturn true;\n\t\t}\n\t\tconst query = searchQuery.toLowerCase();\n\t\treturn (\n\t\t\tjob.title?.toLowerCase().includes(query) ||\n\t\t\tjob.customer?.name?.toLowerCase().includes(query) ||\n\t\t\tjob.location?.address?.street?.toLowerCase().includes(query)\n\t\t);\n\t});\n\n\t// Get priority indicator for jobs\n\tconst getJobPriority = (job: Job) => {\n\t\tconst title = job.title.toLowerCase();\n\t\tif (title.includes(\"emergency\") || title.includes(\"urgent\")) {\n\t\t\treturn { label: \"Urgent\", color: \"bg-red-500\" };\n\t\t}\n\t\tif (title.includes(\"callback\") || title.includes(\"follow\")) {\n\t\t\treturn { label: \"Callback\", color: \"bg-orange-500\" };\n\t\t}\n\t\treturn null;\n\t};\n\n\treturn (\n\t\t<CommandDialog onOpenChange={onClose} open={isOpen}>\n\t\t\t<div className=\"flex items-center border-b px-3\">\n\t\t\t\t<Search className=\"text-muted-foreground mr-2 size-4 shrink-0\" />\n\t\t\t\t<CommandInput\n\t\t\t\t\tonValueChange={setSearchQuery}\n\t\t\t\t\tplaceholder=\"Search jobs, customers, or addresses...\"\n\t\t\t\t\tvalue={searchQuery}\n\t\t\t\t\tclassName=\"border-0 focus:ring-0\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<CommandList className=\"max-h-[400px]\">\n\t\t\t\t<CommandEmpty>\n\t\t\t\t\t<div className=\"flex flex-col items-center justify-center py-8 text-center\">\n\t\t\t\t\t\t<div className=\"bg-muted mb-3 flex size-12 items-center justify-center rounded-full\">\n\t\t\t\t\t\t\t<Search className=\"text-muted-foreground size-5\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p className=\"mb-1 text-sm font-medium\">No matching jobs</p>\n\t\t\t\t\t\t<p className=\"text-muted-foreground mb-4 max-w-[200px] text-xs\">\n\t\t\t\t\t\t\tTry a different search term or create a new job\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonClick={handleCreateNew}\n\t\t\t\t\t\t\tclassName=\"text-primary hover:text-primary/80 flex items-center gap-1 text-sm font-medium transition-colors\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Plus className=\"size-4\" />\n\t\t\t\t\t\t\tCreate New Job\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</CommandEmpty>\n\n\t\t\t\t{/* Create New */}\n\t\t\t\t<CommandGroup heading=\"Quick Actions\">\n\t\t\t\t\t<CommandItem className=\"group py-3\" onSelect={handleCreateNew}>\n\t\t\t\t\t\t<div className=\"bg-primary/10 group-aria-selected:bg-primary/20 mr-3 flex size-10 items-center justify-center rounded-lg transition-colors\">\n\t\t\t\t\t\t\t<Plus className=\"text-primary size-5\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex flex-1 flex-col gap-1\">\n\t\t\t\t\t\t\t<div className=\"flex flex-wrap items-center gap-2\">\n\t\t\t\t\t\t\t\t<span className=\"text-sm font-semibold\">Create New Job</span>\n\t\t\t\t\t\t\t\t{selectedDate && (\n\t\t\t\t\t\t\t\t\t<Badge className=\"gap-1 font-medium\" variant=\"secondary\">\n\t\t\t\t\t\t\t\t\t\t<Calendar className=\"size-3\" />\n\t\t\t\t\t\t\t\t\t\t{format(selectedDate, \"MMM d\")} at{\" \"}\n\t\t\t\t\t\t\t\t\t\t{format(selectedDate, \"h:mm a\")}\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{selectedTechnicianName && (\n\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\tclassName=\"gap-1 font-medium\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<User className=\"size-3\" />\n\t\t\t\t\t\t\t\t\t\t{selectedTechnicianName}\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t{selectedTechnicianName\n\t\t\t\t\t\t\t\t\t? `Schedule a new appointment for ${selectedTechnicianName}`\n\t\t\t\t\t\t\t\t\t: \"Create a new job or service appointment\"}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<kbd className=\"bg-muted text-muted-foreground ml-2 hidden rounded px-1.5 py-0.5 font-mono text-[10px] group-aria-selected:inline\">\n\t\t\t\t\t\t\t↵\n\t\t\t\t\t\t</kbd>\n\t\t\t\t\t</CommandItem>\n\t\t\t\t</CommandGroup>\n\n\t\t\t\t{/* Unassigned Jobs */}\n\t\t\t\t{filteredJobs.length > 0 && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<CommandSeparator />\n\t\t\t\t\t\t<CommandGroup>\n\t\t\t\t\t\t\t<div className=\"flex items-center justify-between px-2 py-1.5\">\n\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs font-medium\">\n\t\t\t\t\t\t\t\t\tUnscheduled Jobs\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<Badge variant=\"secondary\" className=\"h-5 px-1.5 text-[10px]\">\n\t\t\t\t\t\t\t\t\t{filteredJobs.length}\n\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{filteredJobs.slice(0, 10).map((job) => {\n\t\t\t\t\t\t\t\tconst startTime =\n\t\t\t\t\t\t\t\t\tjob.startTime instanceof Date\n\t\t\t\t\t\t\t\t\t\t? job.startTime\n\t\t\t\t\t\t\t\t\t\t: new Date(job.startTime);\n\t\t\t\t\t\t\t\tconst priority = getJobPriority(job);\n\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<CommandItem\n\t\t\t\t\t\t\t\t\t\tclassName=\"group py-2.5\"\n\t\t\t\t\t\t\t\t\t\tkey={job.id}\n\t\t\t\t\t\t\t\t\t\tonSelect={() => handleSelectUnassigned(job)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div className=\"mr-3 flex size-10 items-center justify-center rounded-lg bg-orange-500/10 group-aria-selected:bg-orange-500/20 transition-colors\">\n\t\t\t\t\t\t\t\t\t\t\t<Briefcase className=\"size-5 text-orange-600 dark:text-orange-500\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-1 flex-col gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{job.title}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t{priority && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"rounded px-1.5 py-0.5 text-[10px] font-medium text-white\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpriority.color\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{priority.label}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{job.customer?.name && (\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{job.customer.name}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap items-center gap-x-3 gap-y-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t{job.startTime && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground flex items-center gap-1 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Clock className=\"size-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>{format(startTime, \"MMM d, h:mm a\")}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t{job.assignments.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground flex items-center gap-1 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<User className=\"size-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{job.assignments.length} assigned\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t{job.location?.address?.street && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground flex items-center gap-1 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<MapPin className=\"size-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"max-w-[180px] truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{job.location.address.street}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<ArrowRight className=\"text-muted-foreground ml-2 size-4 shrink-0 opacity-0 transition-opacity group-aria-selected:opacity-100\" />\n\t\t\t\t\t\t\t\t\t</CommandItem>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t{filteredJobs.length > 10 && (\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 px-2 py-2\">\n\t\t\t\t\t\t\t\t\t<Sparkles className=\"text-muted-foreground/50 size-4\" />\n\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t+{filteredJobs.length - 10} more jobs available\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</CommandGroup>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</CommandList>\n\n\t\t\t{/* Keyboard shortcuts footer */}\n\t\t\t<div className=\"border-t px-3 py-2\">\n\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t<div className=\"text-muted-foreground flex items-center gap-4 text-xs\">\n\t\t\t\t\t\t<span className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t<kbd className=\"bg-muted rounded px-1 font-mono text-[10px]\">↑↓</kbd>\n\t\t\t\t\t\t\tnavigate\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t<kbd className=\"bg-muted rounded px-1 font-mono text-[10px]\">↵</kbd>\n\t\t\t\t\t\t\tselect\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t<kbd className=\"bg-muted rounded px-1 font-mono text-[10px]\">esc</kbd>\n\t\t\t\t\t\t\tclose\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t{filteredJobs.length > 0 && (\n\t\t\t\t\t\t<span className=\"text-muted-foreground text-[10px]\">\n\t\t\t\t\t\t\t{filteredJobs.length} result{filteredJobs.length !== 1 ? \"s\" : \"\"}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</CommandDialog>\n\t);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1900, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/customers/customer-autocomplete.tsx"],"sourcesContent":["\"use client\";\n\n/**\n * CustomerAutocomplete Component\n *\n * Reusable autocomplete for customer selection in forms.\n * Features:\n * - Instant search with debouncing\n * - Shows customer details (email, phone, company)\n * - Recent customers quick access\n * - Create new customer option\n * - react-hook-form compatible\n * - Keyboard navigation (arrows, enter, escape)\n */\n\nimport { searchCustomers } from \"@/actions/customers\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tCommand,\n\tCommandEmpty,\n\tCommandGroup,\n\tCommandInput,\n\tCommandItem,\n\tCommandList,\n\tCommandSeparator,\n} from \"@/components/ui/command\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { cn } from \"@/lib/utils\";\nimport {\n\tgetCustomerDisplayName,\n\tgetCustomerInitials,\n\ttype CustomerDisplayData,\n} from \"@/lib/utils/customer-display\";\nimport {\n\tBuilding2,\n\tCheck,\n\tChevronDown,\n\tChevronsUpDown,\n\tClock,\n\tLoader2,\n\tMail,\n\tPhone,\n\tPlus,\n\tSearch,\n\tUser,\n} from \"lucide-react\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\n\nexport type CustomerOption = {\n\tid: string;\n\tdisplay_name?: string | null;\n\tfirst_name?: string | null;\n\tlast_name?: string | null;\n\tcompany_name?: string | null;\n\temail?: string | null;\n\tphone?: string | null;\n};\n\ninterface CustomerAutocompleteProps {\n\t/** Selected customer ID */\n\tvalue?: string | null;\n\t/** Callback when customer is selected */\n\tonChange: (customerId: string | null, customer: CustomerOption | null) => void;\n\t/** Optional placeholder text */\n\tplaceholder?: string;\n\t/** Optional className for styling */\n\tclassName?: string;\n\t/** Show recent customers section */\n\tshowRecent?: boolean;\n\t/** Optional recent customers list */\n\trecentCustomers?: CustomerOption[];\n\t/** Show \"Create New Customer\" option */\n\tshowCreateNew?: boolean;\n\t/** Callback when \"Create New Customer\" is clicked */\n\tonCreateNew?: () => void;\n\t/** Disabled state */\n\tdisabled?: boolean;\n\t/** Optional label */\n\tlabel?: string;\n\t/** Show error state */\n\terror?: boolean;\n\t/** Error message */\n\terrorMessage?: string;\n}\n\nexport function CustomerAutocomplete({\n\tvalue,\n\tonChange,\n\tplaceholder = \"Search for customer...\",\n\tclassName,\n\tshowRecent = true,\n\trecentCustomers = [],\n\tshowCreateNew = true,\n\tonCreateNew,\n\tdisabled = false,\n\tlabel,\n\terror = false,\n\terrorMessage,\n}: CustomerAutocompleteProps) {\n\tconst [open, setOpen] = useState(false);\n\tconst [search, setSearch] = useState(\"\");\n\tconst [customers, setCustomers] = useState<CustomerOption[]>([]);\n\tconst [loading, setLoading] = useState(false);\n\tconst [selectedCustomer, setSelectedCustomer] = useState<CustomerOption | null>(null);\n\n\t// Debounced search\n\tuseEffect(() => {\n\t\tif (search.trim().length < 2) {\n\t\t\tsetCustomers([]);\n\t\t\tsetLoading(false);\n\t\t\treturn;\n\t\t}\n\n\t\tsetLoading(true);\n\t\tconst timeoutId = setTimeout(async () => {\n\t\t\ttry {\n\t\t\t\tconst result = await searchCustomers(search, { limit: 10 });\n\t\t\t\tif (result.success && result.data) {\n\t\t\t\t\tconst customerArray = Array.isArray(result.data) ? result.data : [result.data];\n\t\t\t\t\tsetCustomers(customerArray as CustomerOption[]);\n\t\t\t\t} else {\n\t\t\t\t\tsetCustomers([]);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Customer search error:\", error);\n\t\t\t\tsetCustomers([]);\n\t\t\t} finally {\n\t\t\t\tsetLoading(false);\n\t\t\t}\n\t\t}, 300);\n\n\t\treturn () => clearTimeout(timeoutId);\n\t}, [search]);\n\n\t// Handle customer selection\n\tconst handleSelectCustomer = useCallback(\n\t\t(customer: CustomerOption) => {\n\t\t\tsetSelectedCustomer(customer);\n\t\t\tonChange(customer.id, customer);\n\t\t\tsetOpen(false);\n\t\t\tsetSearch(\"\");\n\t\t},\n\t\t[onChange]\n\t);\n\n\t// Clear selection\n\tconst handleClear = useCallback(() => {\n\t\tsetSelectedCustomer(null);\n\t\tonChange(null, null);\n\t\tsetSearch(\"\");\n\t}, [onChange]);\n\n\t// Get display name for selected customer\n\tconst displayName = selectedCustomer\n\t\t? getCustomerDisplayName(selectedCustomer)\n\t\t: placeholder;\n\n\t// Combine recent and search results (deduplicate by ID)\n\tconst allCustomers = useMemo(() => {\n\t\tconst customerMap = new Map<string, CustomerOption>();\n\n\t\t// Add search results first (higher priority)\n\t\tcustomers.forEach((c) => customerMap.set(c.id, c));\n\n\t\t// Add recent customers if no search\n\t\tif (search.trim().length < 2 && showRecent) {\n\t\t\trecentCustomers.forEach((c) => customerMap.set(c.id, c));\n\t\t}\n\n\t\treturn Array.from(customerMap.values());\n\t}, [customers, recentCustomers, search, showRecent]);\n\n\t// Customer list item component\n\tconst CustomerListItem = ({ customer }: { customer: CustomerOption }) => {\n\t\tconst name = getCustomerDisplayName(customer);\n\t\tconst initials = getCustomerInitials(customer);\n\t\tconst isSelected = value === customer.id;\n\n\t\treturn (\n\t\t\t<CommandItem\n\t\t\t\tkey={customer.id}\n\t\t\t\tvalue={customer.id}\n\t\t\t\tonSelect={() => handleSelectCustomer(customer)}\n\t\t\t\tclassName=\"flex items-center gap-3 px-3 py-2.5 cursor-pointer\"\n\t\t\t>\n\t\t\t\t<Avatar className=\"h-8 w-8 shrink-0\">\n\t\t\t\t\t<AvatarFallback className=\"text-xs font-semibold\">\n\t\t\t\t\t\t{initials}\n\t\t\t\t\t</AvatarFallback>\n\t\t\t\t</Avatar>\n\n\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t<p className=\"font-medium text-sm truncate\">{name}</p>\n\t\t\t\t\t<div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n\t\t\t\t\t\t{customer.email && (\n\t\t\t\t\t\t\t<span className=\"flex items-center gap-1 truncate\">\n\t\t\t\t\t\t\t\t<Mail className=\"h-3 w-3 shrink-0\" />\n\t\t\t\t\t\t\t\t{customer.email}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{customer.phone && (\n\t\t\t\t\t\t\t<span className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t<Phone className=\"h-3 w-3 shrink-0\" />\n\t\t\t\t\t\t\t\t{customer.phone}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t\t{customer.company_name && (\n\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground flex items-center gap-1 mt-0.5\">\n\t\t\t\t\t\t\t<Building2 className=\"h-3 w-3 shrink-0\" />\n\t\t\t\t\t\t\t{customer.company_name}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{isSelected && (\n\t\t\t\t\t<Check className=\"h-4 w-4 text-primary shrink-0\" />\n\t\t\t\t)}\n\t\t\t</CommandItem>\n\t\t);\n\t};\n\n\treturn (\n\t\t<div className={cn(\"flex flex-col gap-1.5\", className)}>\n\t\t\t{label && (\n\t\t\t\t<label className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\">\n\t\t\t\t\t{label}\n\t\t\t\t</label>\n\t\t\t)}\n\n\t\t\t<Popover open={open} onOpenChange={setOpen}>\n\t\t\t\t<PopoverTrigger asChild>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\trole=\"combobox\"\n\t\t\t\t\t\taria-expanded={open}\n\t\t\t\t\t\tdisabled={disabled}\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"w-full justify-between\",\n\t\t\t\t\t\t\t!selectedCustomer && \"text-muted-foreground\",\n\t\t\t\t\t\t\terror && \"border-destructive focus-visible:ring-destructive\"\n\t\t\t\t\t\t)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<span className=\"flex items-center gap-2 truncate\">\n\t\t\t\t\t\t\t{selectedCustomer ? (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<User className=\"h-4 w-4 shrink-0\" />\n\t\t\t\t\t\t\t\t\t<span className=\"truncate\">{displayName}</span>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<Search className=\"h-4 w-4 shrink-0\" />\n\t\t\t\t\t\t\t\t\t<span>{placeholder}</span>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n\t\t\t\t\t</Button>\n\t\t\t\t</PopoverTrigger>\n\n\t\t\t\t<PopoverContent className=\"w-[400px] p-0\" align=\"start\">\n\t\t\t\t\t<Command shouldFilter={false}>\n\t\t\t\t\t\t<CommandInput\n\t\t\t\t\t\t\tplaceholder=\"Search customers...\"\n\t\t\t\t\t\t\tvalue={search}\n\t\t\t\t\t\t\tonValueChange={setSearch}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<CommandList>\n\t\t\t\t\t\t\t{loading ? (\n\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center py-6\">\n\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t{/* Search Results / All Customers */}\n\t\t\t\t\t\t\t\t\t{allCustomers.length > 0 ? (\n\t\t\t\t\t\t\t\t\t\t<CommandGroup\n\t\t\t\t\t\t\t\t\t\t\theading={\n\t\t\t\t\t\t\t\t\t\t\t\tsearch.trim().length >= 2\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"Search Results\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: showRecent && recentCustomers.length > 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"Recent Customers\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"All Customers\"\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<ScrollArea className=\"max-h-[300px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t{allCustomers.map((customer) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<CustomerListItem key={customer.id} customer={customer} />\n\t\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t\t</ScrollArea>\n\t\t\t\t\t\t\t\t\t\t</CommandGroup>\n\t\t\t\t\t\t\t\t\t) : search.trim().length >= 2 ? (\n\t\t\t\t\t\t\t\t\t\t<CommandEmpty>No customers found.</CommandEmpty>\n\t\t\t\t\t\t\t\t\t) : showRecent && recentCustomers.length === 0 ? (\n\t\t\t\t\t\t\t\t\t\t<CommandEmpty>Start typing to search for customers...</CommandEmpty>\n\t\t\t\t\t\t\t\t\t) : null}\n\n\t\t\t\t\t\t\t\t\t{/* Create New Customer */}\n\t\t\t\t\t\t\t\t\t{showCreateNew && onCreateNew && (\n\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t<CommandSeparator />\n\t\t\t\t\t\t\t\t\t\t\t<CommandGroup>\n\t\t\t\t\t\t\t\t\t\t\t\t<CommandItem\n\t\t\t\t\t\t\t\t\t\t\t\t\tonSelect={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetOpen(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonCreateNew();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center gap-2 px-3 py-2.5 cursor-pointer text-primary\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Plus className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">Create New Customer</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</CommandItem>\n\t\t\t\t\t\t\t\t\t\t\t</CommandGroup>\n\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</CommandList>\n\n\t\t\t\t\t\t{/* Clear Selection */}\n\t\t\t\t\t\t{selectedCustomer && !disabled && (\n\t\t\t\t\t\t\t<div className=\"border-t p-2\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\tonClick={handleClear}\n\t\t\t\t\t\t\t\t\tclassName=\"w-full text-muted-foreground hover:text-destructive\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tClear Selection\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</Command>\n\t\t\t\t</PopoverContent>\n\t\t\t</Popover>\n\n\t\t\t{error && errorMessage && (\n\t\t\t\t<p className=\"text-sm text-destructive\">{errorMessage}</p>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2418, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/schedule/quick-appointment-dialog.tsx"],"sourcesContent":["\"use client\";\n\n/**\n * QuickAppointmentDialog Component\n *\n * A streamlined dialog for quickly creating appointments from the dispatch map.\n * Triggered by clicking on the map canvas.\n *\n * Features:\n * - Pre-fills location from map click coordinates\n * - Customer autocomplete with nearby customer suggestions\n * - Technician assignment\n * - Date/time picker with smart defaults\n * - Job type/priority selection\n */\n\nimport { createAppointment } from \"@/actions/appointments\";\nimport { CustomerAutocomplete, type CustomerOption } from \"@/components/customers/customer-autocomplete\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDialog,\n\tDialogContent,\n\tDialogDescription,\n\tDialogFooter,\n\tDialogHeader,\n\tDialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { cn } from \"@/lib/utils\";\nimport {\n\tAlertTriangle,\n\tCalendar,\n\tClock,\n\tLoader2,\n\tMapPin,\n\tUser,\n\tWrench,\n} from \"lucide-react\";\nimport { useCallback, useEffect, useState, useTransition } from \"react\";\nimport { format } from \"date-fns\";\n\n// Job types matching the backend schema\n// Valid types: service_call, installation, maintenance, inspection, repair, estimate, follow_up, winterization, emergency\nconst JOB_TYPES = [\n\t{ value: \"emergency\", label: \"Emergency / Urgent\", color: \"text-red-500\" },\n\t{ value: \"follow_up\", label: \"Callback / Follow Up\", color: \"text-orange-500\" },\n\t{ value: \"maintenance\", label: \"Maintenance / Recurring\", color: \"text-purple-500\" },\n\t{ value: \"installation\", label: \"Install / New Work\", color: \"text-green-500\" },\n\t{ value: \"service_call\", label: \"Service Call\", color: \"text-blue-500\" },\n\t{ value: \"inspection\", label: \"Inspection\", color: \"text-slate-500\" },\n\t{ value: \"estimate\", label: \"Estimate\", color: \"text-amber-500\" },\n\t{ value: \"repair\", label: \"Repair\", color: \"text-cyan-500\" },\n\t{ value: \"winterization\", label: \"Winterization\", color: \"text-indigo-500\" },\n] as const;\n\nconst PRIORITIES = [\n\t{ value: \"low\", label: \"Low\", color: \"text-slate-500\" },\n\t{ value: \"normal\", label: \"Normal\", color: \"text-blue-500\" },\n\t{ value: \"high\", label: \"High\", color: \"text-orange-500\" },\n\t{ value: \"urgent\", label: \"Urgent\", color: \"text-red-500\" },\n] as const;\n\nconst DURATIONS = [\n\t{ value: 30, label: \"30 min\" },\n\t{ value: 60, label: \"1 hour\" },\n\t{ value: 90, label: \"1.5 hours\" },\n\t{ value: 120, label: \"2 hours\" },\n\t{ value: 180, label: \"3 hours\" },\n\t{ value: 240, label: \"4 hours\" },\n\t{ value: 480, label: \"Full day\" },\n] as const;\n\nexport type MapClickLocation = {\n\tlat: number;\n\tlng: number;\n\taddress?: string;\n};\n\nexport type TechnicianOption = {\n\tid: string;\n\tname: string;\n\tavatar?: string;\n};\n\ninterface QuickAppointmentDialogProps {\n\topen: boolean;\n\tonOpenChange: (open: boolean) => void;\n\tlocation?: MapClickLocation | null;\n\ttechnicians?: TechnicianOption[];\n\tnearbyCustomers?: CustomerOption[];\n\tonSuccess?: (appointmentId: string) => void;\n\tonCreateCustomer?: () => void;\n\t/** Pre-select a technician (e.g., from timeline double-click) */\n\tdefaultTechnicianId?: string;\n\t/** Pre-fill date/time (e.g., from timeline double-click) */\n\tdefaultDateTime?: Date;\n\t/** Pre-fill duration in minutes (e.g., from timeline drag-to-create) */\n\tdefaultDuration?: number;\n}\n\nexport function QuickAppointmentDialog({\n\topen,\n\tonOpenChange,\n\tlocation,\n\ttechnicians = [],\n\tnearbyCustomers = [],\n\tonSuccess,\n\tonCreateCustomer,\n\tdefaultTechnicianId,\n\tdefaultDateTime,\n\tdefaultDuration,\n}: QuickAppointmentDialogProps) {\n\tconst [isPending, startTransition] = useTransition();\n\tconst [error, setError] = useState<string | null>(null);\n\n\t// Form state\n\tconst [selectedCustomer, setSelectedCustomer] = useState<CustomerOption | null>(null);\n\tconst [customerId, setCustomerId] = useState<string | null>(null);\n\tconst [title, setTitle] = useState(\"\");\n\tconst [jobType, setJobType] = useState<string>(\"service_call\");\n\tconst [priority, setPriority] = useState<string>(\"normal\");\n\tconst [technicianId, setTechnicianId] = useState<string>(\"\");\n\tconst [duration, setDuration] = useState<number>(60);\n\tconst [notes, setNotes] = useState(\"\");\n\n\t// Apply defaults when dialog opens\n\tuseEffect(() => {\n\t\tif (open) {\n\t\t\tif (defaultTechnicianId) {\n\t\t\t\tsetTechnicianId(defaultTechnicianId);\n\t\t\t}\n\t\t\tif (defaultDateTime) {\n\t\t\t\t// Ensure the time is not in the past (server rejects past appointments)\n\t\t\t\tconst now = new Date();\n\t\t\t\tlet adjustedTime = defaultDateTime;\n\t\t\t\tif (defaultDateTime < now) {\n\t\t\t\t\t// Move to the same time slot tomorrow, or next available hour if today\n\t\t\t\t\tadjustedTime = new Date();\n\t\t\t\t\tadjustedTime.setMinutes(0, 0, 0);\n\t\t\t\t\tadjustedTime.setHours(adjustedTime.getHours() + 1);\n\t\t\t\t}\n\t\t\t\tsetScheduledStart(format(adjustedTime, \"yyyy-MM-dd'T'HH:mm\"));\n\t\t\t}\n\t\t\tif (defaultDuration) {\n\t\t\t\t// Snap to nearest valid duration option\n\t\t\t\tconst validDurations = [30, 60, 90, 120, 180, 240, 480];\n\t\t\t\tconst closest = validDurations.reduce((prev, curr) =>\n\t\t\t\t\tMath.abs(curr - defaultDuration) < Math.abs(prev - defaultDuration) ? curr : prev\n\t\t\t\t);\n\t\t\t\tsetDuration(closest);\n\t\t\t}\n\t\t}\n\t}, [open, defaultTechnicianId, defaultDateTime, defaultDuration]);\n\n\t// Date/time - default to next available slot (next hour)\n\tconst getDefaultDateTime = () => {\n\t\tconst now = new Date();\n\t\tnow.setMinutes(0, 0, 0);\n\t\tnow.setHours(now.getHours() + 1);\n\t\treturn now.toISOString().slice(0, 16);\n\t};\n\tconst [scheduledStart, setScheduledStart] = useState(getDefaultDateTime());\n\n\t// Calculate end time based on duration\n\tconst getScheduledEnd = useCallback(() => {\n\t\tconst start = new Date(scheduledStart);\n\t\tstart.setMinutes(start.getMinutes() + duration);\n\t\treturn start.toISOString();\n\t}, [scheduledStart, duration]);\n\n\t// Handle customer selection\n\tconst handleCustomerChange = (id: string | null, customer: CustomerOption | null) => {\n\t\tsetCustomerId(id);\n\t\tsetSelectedCustomer(customer);\n\t\t// Auto-fill title if empty\n\t\tif (customer && !title) {\n\t\t\tconst customerName = customer.display_name ||\n\t\t\t\t`${customer.first_name || \"\"} ${customer.last_name || \"\"}`.trim() ||\n\t\t\t\tcustomer.company_name || \"Customer\";\n\t\t\tsetTitle(`Service call - ${customerName}`);\n\t\t}\n\t};\n\n\t// Reset form\n\tconst resetForm = useCallback(() => {\n\t\tsetSelectedCustomer(null);\n\t\tsetCustomerId(null);\n\t\tsetTitle(\"\");\n\t\tsetJobType(\"service_call\");\n\t\tsetPriority(\"normal\");\n\t\tsetTechnicianId(\"\");\n\t\tsetDuration(60);\n\t\tsetNotes(\"\");\n\t\tsetScheduledStart(getDefaultDateTime());\n\t\tsetError(null);\n\t}, []);\n\n\t// Handle close\n\tconst handleOpenChange = (newOpen: boolean) => {\n\t\tif (!newOpen) {\n\t\t\tresetForm();\n\t\t}\n\t\tonOpenChange(newOpen);\n\t};\n\n\t// Handle form submission\n\tconst handleSubmit = async (e: React.FormEvent) => {\n\t\te.preventDefault();\n\t\tsetError(null);\n\n\t\tif (!customerId) {\n\t\t\tsetError(\"Please select a customer\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (!title.trim()) {\n\t\t\tsetError(\"Please enter a title\");\n\t\t\treturn;\n\t\t}\n\n\t\tstartTransition(async () => {\n\t\t\ttry {\n\t\t\t\tconst formData = new FormData();\n\t\t\t\tformData.set(\"customerId\", customerId);\n\t\t\t\tformData.set(\"title\", title.trim());\n\t\t\t\tformData.set(\"scheduledStart\", new Date(scheduledStart).toISOString());\n\t\t\t\tformData.set(\"scheduledEnd\", getScheduledEnd());\n\t\t\t\tformData.set(\"type\", jobType);\n\t\t\t\tformData.set(\"priority\", priority);\n\t\t\t\tformData.set(\"category\", \"job_appointment\");\n\n\t\t\t\tif (technicianId && technicianId !== \"unassigned\") {\n\t\t\t\t\tformData.set(\"assignedTo\", technicianId);\n\t\t\t\t}\n\n\t\t\t\tif (notes.trim()) {\n\t\t\t\t\tformData.set(\"notes\", notes.trim());\n\t\t\t\t}\n\n\t\t\t\t// Add location info to notes if available\n\t\t\t\tif (location?.address) {\n\t\t\t\t\tconst existingNotes = notes.trim();\n\t\t\t\t\tconst locationNote = `Location: ${location.address}`;\n\t\t\t\t\tformData.set(\"notes\", existingNotes ? `${existingNotes}\\n\\n${locationNote}` : locationNote);\n\t\t\t\t}\n\n\t\t\t\tconst result = await createAppointment(formData);\n\n\t\t\t\tif (result.success && result.data) {\n\t\t\t\t\tonSuccess?.(result.data);\n\t\t\t\t\thandleOpenChange(false);\n\t\t\t\t} else {\n\t\t\t\t\tsetError(result.error || \"Failed to create appointment\");\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"Failed to create appointment:\", err);\n\t\t\t\tsetError(\"An unexpected error occurred\");\n\t\t\t}\n\t\t});\n\t};\n\n\treturn (\n\t\t<Dialog open={open} onOpenChange={handleOpenChange}>\n\t\t\t<DialogContent className=\"sm:max-w-[500px]\">\n\t\t\t\t<DialogHeader>\n\t\t\t\t\t<DialogTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Calendar className=\"h-5 w-5 text-primary\" />\n\t\t\t\t\t\tQuick Appointment\n\t\t\t\t\t</DialogTitle>\n\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t{location?.address ? (\n\t\t\t\t\t\t\t<span className=\"flex items-center gap-1 text-sm\">\n\t\t\t\t\t\t\t\t<MapPin className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t{location.address}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\"Create a new appointment from the dispatch map\"\n\t\t\t\t\t\t)}\n\t\t\t\t\t</DialogDescription>\n\t\t\t\t</DialogHeader>\n\n\t\t\t\t<form onSubmit={handleSubmit} className=\"space-y-4\">\n\t\t\t\t\t{/* Customer Selection */}\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<Label htmlFor=\"customer\">Customer *</Label>\n\t\t\t\t\t\t<CustomerAutocomplete\n\t\t\t\t\t\t\tvalue={customerId}\n\t\t\t\t\t\t\tonChange={handleCustomerChange}\n\t\t\t\t\t\t\tplaceholder=\"Search or select customer...\"\n\t\t\t\t\t\t\tshowCreateNew\n\t\t\t\t\t\t\tonCreateNew={onCreateCustomer}\n\t\t\t\t\t\t\tshowRecent\n\t\t\t\t\t\t\trecentCustomers={nearbyCustomers}\n\t\t\t\t\t\t\terror={error?.includes(\"customer\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Title */}\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<Label htmlFor=\"title\">Title *</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\tid=\"title\"\n\t\t\t\t\t\t\tvalue={title}\n\t\t\t\t\t\t\tonChange={(e) => setTitle(e.target.value)}\n\t\t\t\t\t\t\tplaceholder=\"e.g., AC Repair, Plumbing Inspection\"\n\t\t\t\t\t\t\tclassName={cn(error?.includes(\"title\") && \"border-destructive\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Job Type & Priority */}\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label htmlFor=\"jobType\">Job Type</Label>\n\t\t\t\t\t\t\t<Select value={jobType} onValueChange={setJobType}>\n\t\t\t\t\t\t\t\t<SelectTrigger id=\"jobType\">\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{JOB_TYPES.map((type) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={type.value} value={type.value}>\n\t\t\t\t\t\t\t\t\t\t\t<span className={cn(\"flex items-center gap-2\", type.color)}>\n\t\t\t\t\t\t\t\t\t\t\t\t<Wrench className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t{type.label}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label htmlFor=\"priority\">Priority</Label>\n\t\t\t\t\t\t\t<Select value={priority} onValueChange={setPriority}>\n\t\t\t\t\t\t\t\t<SelectTrigger id=\"priority\">\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{PRIORITIES.map((p) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={p.value} value={p.value}>\n\t\t\t\t\t\t\t\t\t\t\t<span className={cn(\"flex items-center gap-2\", p.color)}>\n\t\t\t\t\t\t\t\t\t\t\t\t{p.value === \"urgent\" && <AlertTriangle className=\"h-3.5 w-3.5\" />}\n\t\t\t\t\t\t\t\t\t\t\t\t{p.label}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Date/Time & Duration */}\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label htmlFor=\"scheduledStart\">Date & Time</Label>\n\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t<Clock className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tid=\"scheduledStart\"\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={scheduledStart}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setScheduledStart(e.target.value)}\n\t\t\t\t\t\t\t\t\tclassName=\"pl-9\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label htmlFor=\"duration\">Duration</Label>\n\t\t\t\t\t\t\t<Select value={duration.toString()} onValueChange={(v) => setDuration(Number(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger id=\"duration\">\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{DURATIONS.map((d) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={d.value} value={d.value.toString()}>\n\t\t\t\t\t\t\t\t\t\t\t{d.label}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Technician Assignment */}\n\t\t\t\t\t{technicians.length > 0 && (\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label htmlFor=\"technician\">Assign Technician</Label>\n\t\t\t\t\t\t\t<Select value={technicianId} onValueChange={setTechnicianId}>\n\t\t\t\t\t\t\t\t<SelectTrigger id=\"technician\">\n\t\t\t\t\t\t\t\t\t<SelectValue placeholder=\"Select technician (optional)\" />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"unassigned\">Unassigned</SelectItem>\n\t\t\t\t\t\t\t\t\t{technicians.map((tech) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={tech.id} value={tech.id}>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<User className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t{tech.name}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Notes */}\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<Label htmlFor=\"notes\">Notes</Label>\n\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\tid=\"notes\"\n\t\t\t\t\t\t\tvalue={notes}\n\t\t\t\t\t\t\tonChange={(e) => setNotes(e.target.value)}\n\t\t\t\t\t\t\tplaceholder=\"Additional notes or instructions...\"\n\t\t\t\t\t\t\trows={2}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Error Display */}\n\t\t\t\t\t{error && (\n\t\t\t\t\t\t<div className=\"rounded-md bg-destructive/10 p-3 text-sm text-destructive\">\n\t\t\t\t\t\t\t{error}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\tonClick={() => handleOpenChange(false)}\n\t\t\t\t\t\t\tdisabled={isPending}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button type=\"submit\" disabled={isPending || !customerId}>\n\t\t\t\t\t\t\t{isPending ? (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n\t\t\t\t\t\t\t\t\tCreating...\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\"Create Appointment\"\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</form>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3288, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/schedule/team-avatar-manager.tsx"],"sourcesContent":["\"use client\";\n\nimport { X } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { cn } from \"@/lib/utils\";\nimport type { JobAssignment } from \"./schedule-types\";\n\nfunction TeamAvatar({\n\tassignment,\n\tonRemove,\n\tsize = \"sm\",\n}: {\n\tassignment: JobAssignment;\n\tonRemove?: () => void;\n\tsize?: \"sm\" | \"md\";\n}) {\n\tconst [isHovered, setIsHovered] = useState(false);\n\n\tconst sizeClasses = size === \"md\" ? \"size-8\" : \"size-6\";\n\tconst textSize = size === \"md\" ? \"text-[10px]\" : \"text-[8px]\";\n\n\treturn (\n\t\t<div\n\t\t\tclassName=\"relative\"\n\t\t\tonMouseEnter={() => setIsHovered(true)}\n\t\t\tonMouseLeave={() => setIsHovered(false)}\n\t\t>\n\t\t\t<Avatar\n\t\t\t\tclassName={cn(\n\t\t\t\t\tsizeClasses,\n\t\t\t\t\t\"border-card border-2 transition-all\",\n\t\t\t\t\tisHovered && \"ring-primary ring-2\",\n\t\t\t\t)}\n\t\t\t\ttitle={assignment.displayName}\n\t\t\t>\n\t\t\t\t{assignment.avatar && (\n\t\t\t\t\t<img\n\t\t\t\t\t\talt={assignment.displayName}\n\t\t\t\t\t\tclassName=\"size-full object-cover\"\n\t\t\t\t\t\tsrc={assignment.avatar}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t\t<AvatarFallback\n\t\t\t\t\tclassName={cn(\"bg-muted text-foreground font-bold\", textSize)}\n\t\t\t\t>\n\t\t\t\t\t{assignment.displayName\n\t\t\t\t\t\t.split(\" \")\n\t\t\t\t\t\t.map((n) => n[0])\n\t\t\t\t\t\t.join(\"\")\n\t\t\t\t\t\t.toUpperCase()}\n\t\t\t\t</AvatarFallback>\n\t\t\t</Avatar>\n\n\t\t\t{/* Remove button on hover */}\n\t\t\t{isHovered && onRemove && (\n\t\t\t\t<button\n\t\t\t\t\tclassName=\"bg-destructive text-destructive-foreground absolute -top-1 -right-1 flex size-4 items-center justify-center rounded-full shadow-md transition-transform hover:scale-110\"\n\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tonRemove();\n\t\t\t\t\t}}\n\t\t\t\t\ttitle=\"Remove from job\"\n\t\t\t\t>\n\t\t\t\t\t<X className=\"size-3\" />\n\t\t\t\t</button>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n\nexport function TeamAvatarGroup({\n\tassignments,\n\tmaxVisible = 3,\n\tonRemove,\n\tonAddMember,\n\tsize = \"sm\",\n\tjobId,\n}: {\n\tassignments: JobAssignment[];\n\tmaxVisible?: number;\n\tonRemove?: (technicianId: string) => void;\n\tonAddMember?: () => void;\n\tsize?: \"sm\" | \"md\";\n\tjobId?: string;\n}) {\n\tconst [showAll, setShowAll] = useState(false);\n\tconst visibleAssignments = showAll\n\t\t? assignments\n\t\t: assignments.slice(0, maxVisible);\n\tconst remainingCount = assignments.length - maxVisible;\n\n\treturn (\n\t\t<div className=\"flex shrink-0 items-center gap-1\" data-job-id={jobId}>\n\t\t\t<div className=\"flex -space-x-1.5\">\n\t\t\t\t{visibleAssignments.map((assignment, idx) => (\n\t\t\t\t\t<TeamAvatar\n\t\t\t\t\t\tassignment={assignment}\n\t\t\t\t\t\tkey={idx}\n\t\t\t\t\t\tonRemove={\n\t\t\t\t\t\t\tonRemove\n\t\t\t\t\t\t\t\t? () => onRemove(assignment.technicianId || \"\")\n\t\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsize={size}\n\t\t\t\t\t/>\n\t\t\t\t))}\n\n\t\t\t\t{!showAll && remainingCount > 0 && (\n\t\t\t\t\t<button\n\t\t\t\t\t\tclassName=\"border-card bg-muted text-muted-foreground hover:bg-muted/80 hover:ring-primary flex size-6 items-center justify-center rounded-full border-2 text-[8px] font-bold transition-all hover:ring-2\"\n\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\tsetShowAll(true);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ttitle={`Show ${remainingCount} more`}\n\t\t\t\t\t>\n\t\t\t\t\t\t+{remainingCount}\n\t\t\t\t\t</button>\n\t\t\t\t)}\n\t\t\t</div>\n\n\t\t\t{/* Add member button */}\n\t\t\t{onAddMember && (\n\t\t\t\t<button\n\t\t\t\t\tclassName=\"border-muted-foreground/30 bg-muted/50 text-muted-foreground hover:border-primary hover:bg-primary/10 hover:text-primary flex size-6 items-center justify-center rounded-full border-2 border-dashed transition-all\"\n\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tonAddMember();\n\t\t\t\t\t}}\n\t\t\t\t\ttitle=\"Add team member\"\n\t\t\t\t>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclassName=\"relative flex items-center justify-center text-base leading-none font-bold\"\n\t\t\t\t\t\tstyle={{ top: \"-1px\" }}\n\t\t\t\t\t>\n\t\t\t\t\t\t+\n\t\t\t\t\t</span>\n\t\t\t\t</button>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AACA;;;AALA;;;;;AAQA,SAAS,WAAW,EACnB,UAAU,EACV,QAAQ,EACR,OAAO,IAAI,EAKX;;IACA,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,gVAAQ,EAAC;IAE3C,MAAM,cAAc,SAAS,OAAO,WAAW;IAC/C,MAAM,WAAW,SAAS,OAAO,gBAAgB;IAEjD,qBACC,oWAAC;QACA,WAAU;QACV,cAAc,IAAM,aAAa;QACjC,cAAc,IAAM,aAAa;;0BAEjC,oWAAC,6IAAM;gBACN,WAAW,IAAA,2IAAE,EACZ,aACA,uCACA,aAAa;gBAEd,OAAO,WAAW,WAAW;;oBAE5B,WAAW,MAAM,kBACjB,oWAAC;wBACA,KAAK,WAAW,WAAW;wBAC3B,WAAU;wBACV,KAAK,WAAW,MAAM;;;;;;kCAGxB,oWAAC,qJAAc;wBACd,WAAW,IAAA,2IAAE,EAAC,sCAAsC;kCAEnD,WAAW,WAAW,CACrB,KAAK,CAAC,KACN,GAAG,CAAC,CAAC,IAAM,CAAC,CAAC,EAAE,EACf,IAAI,CAAC,IACL,WAAW;;;;;;;;;;;;YAKd,aAAa,0BACb,oWAAC;gBACA,WAAU;gBACV,SAAS,CAAC;oBACT,EAAE,eAAe;oBACjB;gBACD;gBACA,OAAM;0BAEN,cAAA,oWAAC,wRAAC;oBAAC,WAAU;;;;;;;;;;;;;;;;;AAKlB;GA7DS;KAAA;AA+DF,SAAS,gBAAgB,EAC/B,WAAW,EACX,aAAa,CAAC,EACd,QAAQ,EACR,WAAW,EACX,OAAO,IAAI,EACX,KAAK,EAQL;;IACA,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gVAAQ,EAAC;IACvC,MAAM,qBAAqB,UACxB,cACA,YAAY,KAAK,CAAC,GAAG;IACxB,MAAM,iBAAiB,YAAY,MAAM,GAAG;IAE5C,qBACC,oWAAC;QAAI,WAAU;QAAmC,eAAa;;0BAC9D,oWAAC;gBAAI,WAAU;;oBACb,mBAAmB,GAAG,CAAC,CAAC,YAAY,oBACpC,oWAAC;4BACA,YAAY;4BAEZ,UACC,WACG,IAAM,SAAS,WAAW,YAAY,IAAI,MAC1C;4BAEJ,MAAM;2BAND;;;;;oBAUN,CAAC,WAAW,iBAAiB,mBAC7B,oWAAC;wBACA,WAAU;wBACV,SAAS,CAAC;4BACT,EAAE,eAAe;4BACjB,WAAW;wBACZ;wBACA,OAAO,CAAC,KAAK,EAAE,eAAe,KAAK,CAAC;;4BACpC;4BACE;;;;;;;;;;;;;YAMJ,6BACA,oWAAC;gBACA,WAAU;gBACV,SAAS,CAAC;oBACT,EAAE,eAAe;oBACjB;gBACD;gBACA,OAAM;0BAEN,cAAA,oWAAC;oBACA,WAAU;oBACV,OAAO;wBAAE,KAAK;oBAAO;8BACrB;;;;;;;;;;;;;;;;;AAON;IAvEgB;MAAA"}},
    {"offset": {"line": 3455, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/schedule/unassigned-panel.tsx"],"sourcesContent":["\"use client\";\n\nimport { DragOverlay, useDroppable } from \"@dnd-kit/core\";\nimport {\n\tSortableContext,\n\tuseSortable,\n\tverticalListSortingStrategy,\n} from \"@dnd-kit/sortable\";\nimport { CSS } from \"@dnd-kit/utilities\";\nimport { format } from \"date-fns\";\nimport {\n\tAlertCircle,\n\tBriefcase,\n\tCalendar,\n\tChevronLeft,\n\tChevronRight,\n\tClipboardCheck,\n\tClock,\n\tHardHat,\n\tMapPin,\n\tPhone,\n\tSearch,\n\tSettings,\n\tStar,\n\tUsers,\n\tWrench,\n\tZap,\n} from \"lucide-react\";\nimport { memo, useEffect, useMemo, useRef, useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Collapsible, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { Input } from \"@/components/ui/input\";\nimport { cn } from \"@/lib/utils\";\nimport type { AppointmentCategory, Job, JobType } from \"./schedule-types\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\n\n// Job type visual configuration - consistent with timeline and kanban views\ntype JobTypeConfig = {\n\tborderColor: string;\n\tbgColor: string;\n\ticon: React.ComponentType<{ className?: string }>;\n\tlabel: string;\n};\n\nconst JOB_TYPE_CONFIG: Record<JobType | \"default\", JobTypeConfig> = {\n\temergency: {\n\t\tborderColor: \"border-l-red-500\",\n\t\tbgColor: \"bg-red-500/10\",\n\t\ticon: Zap,\n\t\tlabel: \"Emergency\",\n\t},\n\trepair: {\n\t\tborderColor: \"border-l-orange-500\",\n\t\tbgColor: \"bg-orange-500/10\",\n\t\ticon: Wrench,\n\t\tlabel: \"Repair\",\n\t},\n\tinstallation: {\n\t\tborderColor: \"border-l-green-500\",\n\t\tbgColor: \"bg-green-500/10\",\n\t\ticon: HardHat,\n\t\tlabel: \"Installation\",\n\t},\n\tmaintenance: {\n\t\tborderColor: \"border-l-blue-500\",\n\t\tbgColor: \"bg-blue-500/10\",\n\t\ticon: Settings,\n\t\tlabel: \"Maintenance\",\n\t},\n\tpremium_maintenance: {\n\t\tborderColor: \"border-l-violet-500\",\n\t\tbgColor: \"bg-violet-500/10\",\n\t\ticon: Star,\n\t\tlabel: \"Premium\",\n\t},\n\tinspection: {\n\t\tborderColor: \"border-l-cyan-500\",\n\t\tbgColor: \"bg-cyan-500/10\",\n\t\ticon: Search,\n\t\tlabel: \"Inspection\",\n\t},\n\tservice: {\n\t\tborderColor: \"border-l-sky-500\",\n\t\tbgColor: \"bg-sky-500/10\",\n\t\ticon: ClipboardCheck,\n\t\tlabel: \"Service\",\n\t},\n\tservice_call: {\n\t\tborderColor: \"border-l-teal-500\",\n\t\tbgColor: \"bg-teal-500/10\",\n\t\ticon: Phone,\n\t\tlabel: \"Service Call\",\n\t},\n\testimate: {\n\t\tborderColor: \"border-l-amber-500\",\n\t\tbgColor: \"bg-amber-500/10\",\n\t\ticon: ClipboardCheck,\n\t\tlabel: \"Estimate\",\n\t},\n\tcallback: {\n\t\tborderColor: \"border-l-pink-500\",\n\t\tbgColor: \"bg-pink-500/10\",\n\t\ticon: Phone,\n\t\tlabel: \"Callback\",\n\t},\n\tother: {\n\t\tborderColor: \"border-l-slate-400\",\n\t\tbgColor: \"bg-slate-400/10\",\n\t\ticon: ClipboardCheck,\n\t\tlabel: \"Other\",\n\t},\n\tdefault: {\n\t\tborderColor: \"border-l-slate-400\",\n\t\tbgColor: \"bg-slate-400/10\",\n\t\ticon: ClipboardCheck,\n\t\tlabel: \"Job\",\n\t},\n};\n\nconst getJobTypeConfig = (job: Job): JobTypeConfig => {\n\tconst config = job.jobType ? JOB_TYPE_CONFIG[job.jobType] : JOB_TYPE_CONFIG.default;\n\treturn config || JOB_TYPE_CONFIG.default;\n};\n\n// Appointment category visual configuration\ntype AppointmentCategoryConfig = {\n\ticon: React.ComponentType<{ className?: string }>;\n\tlabel: string;\n\tbgColor: string;\n\ttextColor: string;\n\tborderStyle: string;\n};\n\nconst APPOINTMENT_CATEGORY_CONFIG: Record<AppointmentCategory, AppointmentCategoryConfig> = {\n\tjob: {\n\t\ticon: Briefcase,\n\t\tlabel: \"Job\",\n\t\tbgColor: \"bg-blue-500/10\",\n\t\ttextColor: \"text-blue-600 dark:text-blue-400\",\n\t\tborderStyle: \"border-solid\",\n\t},\n\tmeeting: {\n\t\ticon: Users,\n\t\tlabel: \"Meeting\",\n\t\tbgColor: \"bg-purple-500/10\",\n\t\ttextColor: \"text-purple-600 dark:text-purple-400\",\n\t\tborderStyle: \"border-dashed\",\n\t},\n\tevent: {\n\t\ticon: Calendar,\n\t\tlabel: \"Event\",\n\t\tbgColor: \"bg-emerald-500/10\",\n\t\ttextColor: \"text-emerald-600 dark:text-emerald-400\",\n\t\tborderStyle: \"border-dotted\",\n\t},\n};\n\nconst getAppointmentCategoryConfig = (job: Job): AppointmentCategoryConfig => {\n\tconst category = job.appointmentCategory || \"job\";\n\treturn APPOINTMENT_CATEGORY_CONFIG[category];\n};\n\nconst UnassignedJobCard = memo(function UnassignedJobCard({\n\tjob,\n\tisDragOverlay = false,\n}: {\n\tjob: Job;\n\tisDragOverlay?: boolean;\n}) {\n\tconst sortable = useSortable({\n\t\tid: job.id,\n\t\tdata: { job },\n\t});\n\n\tconst {\n\t\tattributes,\n\t\tlisteners,\n\t\tsetNodeRef,\n\t\ttransform,\n\t\ttransition,\n\t\tisDragging,\n\t} = sortable;\n\n\tconst style = isDragOverlay\n\t\t? undefined\n\t\t: {\n\t\t\t\ttransform: CSS.Transform.toString(transform),\n\t\t\t\ttransition,\n\t\t\t};\n\n\tconst startTime =\n\t\tjob.startTime instanceof Date ? job.startTime : new Date(job.startTime);\n\tconst endTime =\n\t\tjob.endTime instanceof Date ? job.endTime : new Date(job.endTime);\n\tconst duration = Math.round(\n\t\t(endTime.getTime() - startTime.getTime()) / (1000 * 60),\n\t);\n\n\treturn (\n\t\t<div\n\t\t\tref={isDragOverlay ? undefined : setNodeRef}\n\t\t\tstyle={style}\n\t\t\t{...(isDragOverlay ? {} : attributes)}\n\t\t\t{...(isDragOverlay ? {} : listeners)}\n\t\t\tclassName={cn(\n\t\t\t\t\"group bg-card relative cursor-grab rounded-lg border-2 border-dashed border-red-200 p-3 shadow-sm transition-all hover:border-red-300 hover:shadow-md active:cursor-grabbing dark:border-red-900/50\",\n\t\t\t\tisDragging && !isDragOverlay && \"opacity-30\",\n\t\t\t\tisDragOverlay &&\n\t\t\t\t\t\"scale-105 cursor-grabbing shadow-2xl ring-2 ring-red-500\",\n\t\t\t)}\n\t\t>\n\t\t\t{/* Drag indicator */}\n\t\t\t<div className=\"absolute top-2 right-2 opacity-0 transition-opacity group-hover:opacity-100\">\n\t\t\t\t<div className=\"flex size-5 items-center justify-center rounded bg-red-500 text-white\">\n\t\t\t\t\t<ChevronRight className=\"size-3\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div className=\"space-y-2\">\n\t\t\t\t{/* Appointment Category + Job Type + Title */}\n\t\t\t\t<div className=\"flex items-start gap-2 pr-6\">\n\t\t\t\t\t<TooltipProvider>\n\t\t\t\t\t\t{/* Appointment Category Icon */}\n\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\tconst catConfig = getAppointmentCategoryConfig(job);\n\t\t\t\t\t\t\tconst CatIcon = catConfig.icon;\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t<div className={cn(\"mt-0.5 flex size-4 shrink-0 items-center justify-center rounded-sm\", catConfig.bgColor)}>\n\t\t\t\t\t\t\t\t\t\t\t<CatIcon className={cn(\"size-2.5\", catConfig.textColor)} />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t<TooltipContent side=\"top\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t{catConfig.label}\n\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})()}\n\t\t\t\t\t\t{/* Job Type Icon */}\n\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\tconst typeConfig = getJobTypeConfig(job);\n\t\t\t\t\t\t\tconst TypeIcon = typeConfig.icon;\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t<div className={cn(\"mt-0.5 flex size-5 shrink-0 items-center justify-center rounded\", typeConfig.bgColor)}>\n\t\t\t\t\t\t\t\t\t\t\t<TypeIcon className={cn(\"size-3\", typeConfig.borderColor.replace(\"border-l-\", \"text-\"))} />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t<TooltipContent side=\"top\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t{typeConfig.label}\n\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})()}\n\t\t\t\t\t</TooltipProvider>\n\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t<p className=\"text-foreground text-sm font-semibold\">{job.title}</p>\n\t\t\t\t\t\t{job.customer?.name && (\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">{job.customer.name}</p>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Time */}\n\t\t\t\t<div className=\"flex items-center gap-4 text-xs\">\n\t\t\t\t\t<div className=\"text-muted-foreground flex items-center gap-1.5\">\n\t\t\t\t\t\t<Clock className=\"size-3.5\" />\n\t\t\t\t\t\t<span className=\"font-mono font-medium\">\n\t\t\t\t\t\t\t{format(startTime, \"h:mm a\")}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<Badge className=\"text-[10px]\" variant=\"secondary\">\n\t\t\t\t\t\t{duration} min\n\t\t\t\t\t</Badge>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Location */}\n\t\t\t\t{job.location?.address?.street && (\n\t\t\t\t\t<div className=\"text-muted-foreground flex items-start gap-1.5 text-xs\">\n\t\t\t\t\t\t<MapPin className=\"mt-0.5 size-3.5 shrink-0\" />\n\t\t\t\t\t\t<span className=\"line-clamp-1\">{job.location.address.street}</span>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\n\t\t\t\t{/* Priority indicator */}\n\t\t\t\t{job.priority === \"urgent\" && (\n\t\t\t\t\t<Badge className=\"text-[9px]\" variant=\"destructive\">\n\t\t\t\t\t\tURGENT\n\t\t\t\t\t</Badge>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}, (prev, next) => {\n\t// Only re-render if job ID changes, isDragOverlay changes, or key job fields change\n\treturn prev.job.id === next.job.id &&\n\t\tprev.isDragOverlay === next.isDragOverlay &&\n\t\tprev.job.status === next.job.status &&\n\t\tprev.job.title === next.job.title;\n});\n\nexport function UnassignedPanel({\n\tunassignedJobs = [],\n\tisOpen,\n\tonToggle,\n\tdropId = \"unassigned-dropzone\",\n\tactiveJobId,\n\tsearchQuery = \"\",\n\tonSearchChange,\n\tonLoadMore,\n\thasMore = false,\n\tisLoadingMore = false,\n\ttotalCount,\n}: {\n\tunassignedJobs: Job[];\n\tisOpen: boolean;\n\tonToggle: () => void;\n\tdropId?: string;\n\tactiveJobId: string | null;\n\tsearchQuery?: string;\n\tonSearchChange?: (value: string) => void;\n\tonLoadMore?: () => void;\n\thasMore?: boolean;\n\tisLoadingMore?: boolean;\n\ttotalCount?: number;\n}) {\n\tconst { setNodeRef, isOver } = useDroppable({\n\t\tid: dropId,\n\t});\n\n\tconst rawJobs = Array.isArray(unassignedJobs) ? unassignedJobs : [];\n\tconst activeJob = rawJobs.find((job) => job.id === activeJobId);\n\tconst [searchValue, setSearchValue] = useState(searchQuery ?? \"\");\n\tconst lastSentSearch = useRef(searchQuery ?? \"\");\n\tconst trimmedSearch = searchValue.trim();\n\n\tuseEffect(() => {\n\t\tlastSentSearch.current = searchQuery ?? \"\";\n\t\tsetSearchValue(searchQuery ?? \"\");\n\t}, [searchQuery]);\n\n\tuseEffect(() => {\n\t\tif (!onSearchChange) {\n\t\t\treturn;\n\t\t}\n\t\tconst handler = setTimeout(() => {\n\t\t\tif (trimmedSearch === (lastSentSearch.current ?? \"\")) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlastSentSearch.current = trimmedSearch;\n\t\t\tonSearchChange(trimmedSearch);\n\t\t}, 400);\n\t\treturn () => clearTimeout(handler);\n\t}, [trimmedSearch, onSearchChange]);\n\n\t// Sort jobs by time (urgent first, then by start time)\n\tconst jobs = useMemo(() => {\n\t\treturn [...rawJobs].sort((a, b) => {\n\t\t\t// Urgent jobs first\n\t\t\tif (a.priority === \"urgent\" && b.priority !== \"urgent\") return -1;\n\t\t\tif (b.priority === \"urgent\" && a.priority !== \"urgent\") return 1;\n\t\t\t// Then by start time\n\t\t\treturn new Date(a.startTime).getTime() - new Date(b.startTime).getTime();\n\t\t});\n\t}, [rawJobs]);\n\n\treturn (\n\t\t<>\n\t\t\t<Collapsible className=\"h-full\" onOpenChange={onToggle} open={isOpen}>\n\t\t\t\t<div\n\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\"bg-card flex h-full flex-col border-r transition-colors duration-200\",\n\t\t\t\t\t\tisOver &&\n\t\t\t\t\t\t\t\"bg-red-50/80 ring-2 ring-red-500 ring-inset dark:bg-red-950/50\",\n\t\t\t\t\t)}\n\t\t\t\t\tref={setNodeRef}\n\t\t\t\t>\n\t\t\t\t\t{isOpen ? (\n\t\t\t\t\t\t// Expanded: Full panel with flex layout\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<CollapsibleTrigger asChild>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName=\"hover:bg-muted h-auto w-full shrink-0 justify-between px-4 py-3\"\n\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t<AlertCircle className=\"size-4 text-red-500\" />\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm font-semibold\">Unscheduled</span>\n\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"bg-red-100 px-2 py-0.5 text-xs font-semibold text-red-700 dark:bg-red-950/50 dark:text-red-400\"\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{totalCount ?? jobs.length}\n\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<ChevronLeft className=\"size-4 transition-transform\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</CollapsibleTrigger>\n\n\t\t\t\t\t\t\t<div className=\"border-b px-3 py-2\">\n\t\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t\t<Search className=\"text-muted-foreground absolute top-1/2 left-2 size-4 -translate-y-1/2\" />\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\tclassName=\"pl-8 text-sm\"\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Search...\"\n\t\t\t\t\t\t\t\t\t\tvalue={searchValue}\n\t\t\t\t\t\t\t\t\t\tonChange={(event) => setSearchValue(event.target.value)}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName=\"flex-1 overflow-x-hidden overflow-y-auto\"\n\t\t\t\t\t\t\t\tstyle={{ minHeight: 0 }}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"space-y-2 p-3\">\n\t\t\t\t\t\t\t\t\t{jobs.length === 0 ? (\n\t\t\t\t\t\t\t\t\t\t<div className=\"rounded-lg border border-dashed p-6 text-center\">\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t{trimmedSearch\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"No jobs match this search\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"All jobs scheduled\"}\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<SortableContext\n\t\t\t\t\t\t\t\t\t\t\titems={jobs.map((job) => job.id)}\n\t\t\t\t\t\t\t\t\t\t\tstrategy={verticalListSortingStrategy}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{jobs.map((job) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<UnassignedJobCard job={job} key={job.id} />\n\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t</SortableContext>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{(hasMore || isLoadingMore) && (\n\t\t\t\t\t\t\t\t<div className=\"border-t px-3 py-2\">\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t\t\t\t\tdisabled={isLoadingMore || !onLoadMore}\n\t\t\t\t\t\t\t\t\t\tonClick={onLoadMore}\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{isLoadingMore ? \"Loading...\" : \"Load more\"}\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t// Collapsed: Vertical text in sliver\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclassName=\"flex h-full w-12 items-center justify-center bg-red-50 transition-colors hover:bg-red-100 dark:bg-red-950/30 dark:hover:bg-red-950/50\"\n\t\t\t\t\t\t\tonClick={onToggle}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div className=\"flex rotate-180 items-center gap-3 [writing-mode:vertical-rl]\">\n\t\t\t\t\t\t\t\t<span className=\"text-sm font-bold tracking-wider text-red-700 dark:text-red-400\">\n\t\t\t\t\t\t\t\t\tUNSCHEDULED\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\tclassName=\"bg-red-600 px-2.5 py-0.5 text-xs font-semibold text-white dark:bg-red-700\"\n\t\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{totalCount ?? jobs.length}\n\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</Collapsible>\n\n\t\t\t{/* Drag Overlay - Ghost preview */}\n\t\t\t<DragOverlay dropAnimation={null}>\n\t\t\t\t{activeJob ? <UnassignedJobCard isDragOverlay job={activeJob} /> : null}\n\t\t\t</DragOverlay>\n\t\t</>\n\t);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4189, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/schedule/dispatch-timeline.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n\tDndContext,\n\ttype DragEndEvent,\n\ttype DragMoveEvent,\n\tDragOverlay,\n\ttype DragStartEvent,\n\tMouseSensor,\n\tpointerWithin,\n\tTouchSensor,\n\tuseDraggable,\n\tuseDroppable,\n\tuseSensor,\n\tuseSensors,\n} from \"@dnd-kit/core\";\nimport { CSS } from \"@dnd-kit/utilities\";\nimport { format } from \"date-fns\";\nimport {\n\tAlertTriangle,\n\tBriefcase,\n\tCalendar,\n\tCar,\n\tCheck,\n\tChevronRight,\n\tClock,\n\tClipboardCheck,\n\tExternalLink,\n\tHardHat,\n\tMapPin,\n\tPhone,\n\tPlay,\n\tPlus,\n\tRepeat,\n\tSearch,\n\tSend,\n\tSettings,\n\tStar,\n\tUser,\n\tUsers,\n\tWrench,\n\tX,\n\tZap,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { memo, useCallback, useEffect, useMemo, useRef, useState, useTransition } from \"react\";\nimport { toast } from \"sonner\";\nimport {\n\tarriveAppointment,\n\tcompleteAppointment,\n\tdispatchAppointment,\n\tupdateAppointmentTimes,\n} from \"@/actions/schedule-assignments\";\nimport {\n\tuseScheduleDrag,\n\tDRAG_UNASSIGNED_DROP_ID,\n\ttype DragPreview,\n} from \"./hooks/use-schedule-drag\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { ScheduleJobContextMenu } from \"./schedule-job-context-menu\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { useSchedule, useScheduleRealtime } from \"@/hooks/use-schedule\";\nimport { useScheduleViewStore } from \"@/lib/stores/schedule-view-store\";\nimport { cn } from \"@/lib/utils\";\nimport { ScheduleCommandMenu } from \"./schedule-command-menu\";\nimport {\n\tQuickAppointmentDialog,\n\ttype TechnicianOption,\n} from \"./quick-appointment-dialog\";\nimport type { AppointmentCategory, Job, JobType, Technician } from \"./schedule-types\";\nimport { TeamAvatarGroup } from \"./team-avatar-manager\";\nimport { UnassignedPanel } from \"./unassigned-panel\";\n\nconst HOUR_WIDTH = 80;\nconst LANE_HEIGHT = 70; // More compact\nconst SIDEBAR_WIDTH = 220;\nconst JOB_HEIGHT = 48; // Narrower job cards\nconst JOB_STACK_OFFSET = 6;\nconst STACK_GAP = 4;\nconst BASE_CENTER_OFFSET = Math.max(STACK_GAP, (LANE_HEIGHT - JOB_HEIGHT) / 2);\nconst SNAP_INTERVAL_MINUTES = 15;\nconst LARGE_SNAP_MINUTES = 60;\n\n// Auto-scroll configuration for smooth, fast edge scrolling during drag\nconst AUTO_SCROLL_EDGE = 200; // Start scrolling 200px from edge\nconst AUTO_SCROLL_INNER_EDGE = 80; // Max speed zone within 80px\nconst AUTO_SCROLL_MIN_SPEED = 8; // Minimum scroll speed (px/frame)\nconst AUTO_SCROLL_MAX_SPEED = 45; // Maximum scroll speed (px/frame)\nconst AUTO_SCROLL_ACCELERATION = 2.5; // Exponential acceleration factor\n\n// Job type visual configuration - distinct colors and icons for each type\ntype JobTypeConfig = {\n\tborderColor: string;\n\tbgColor: string;\n\ticon: React.ComponentType<{ className?: string }>;\n\tlabel: string;\n};\n\nconst JOB_TYPE_CONFIG: Record<JobType | \"default\", JobTypeConfig> = {\n\temergency: {\n\t\tborderColor: \"border-l-red-500\",\n\t\tbgColor: \"bg-red-500/10\",\n\t\ticon: Zap,\n\t\tlabel: \"Emergency\",\n\t},\n\trepair: {\n\t\tborderColor: \"border-l-orange-500\",\n\t\tbgColor: \"bg-orange-500/10\",\n\t\ticon: Wrench,\n\t\tlabel: \"Repair\",\n\t},\n\tinstallation: {\n\t\tborderColor: \"border-l-green-500\",\n\t\tbgColor: \"bg-green-500/10\",\n\t\ticon: HardHat,\n\t\tlabel: \"Installation\",\n\t},\n\tmaintenance: {\n\t\tborderColor: \"border-l-blue-500\",\n\t\tbgColor: \"bg-blue-500/10\",\n\t\ticon: Settings,\n\t\tlabel: \"Maintenance\",\n\t},\n\tpremium_maintenance: {\n\t\tborderColor: \"border-l-violet-500\",\n\t\tbgColor: \"bg-violet-500/10\",\n\t\ticon: Star,\n\t\tlabel: \"Premium\",\n\t},\n\tinspection: {\n\t\tborderColor: \"border-l-cyan-500\",\n\t\tbgColor: \"bg-cyan-500/10\",\n\t\ticon: Search,\n\t\tlabel: \"Inspection\",\n\t},\n\tservice: {\n\t\tborderColor: \"border-l-sky-500\",\n\t\tbgColor: \"bg-sky-500/10\",\n\t\ticon: ClipboardCheck,\n\t\tlabel: \"Service\",\n\t},\n\tservice_call: {\n\t\tborderColor: \"border-l-teal-500\",\n\t\tbgColor: \"bg-teal-500/10\",\n\t\ticon: Phone,\n\t\tlabel: \"Service Call\",\n\t},\n\testimate: {\n\t\tborderColor: \"border-l-amber-500\",\n\t\tbgColor: \"bg-amber-500/10\",\n\t\ticon: ClipboardCheck,\n\t\tlabel: \"Estimate\",\n\t},\n\tcallback: {\n\t\tborderColor: \"border-l-pink-500\",\n\t\tbgColor: \"bg-pink-500/10\",\n\t\ticon: Phone,\n\t\tlabel: \"Callback\",\n\t},\n\tother: {\n\t\tborderColor: \"border-l-slate-400\",\n\t\tbgColor: \"bg-slate-400/10\",\n\t\ticon: ClipboardCheck,\n\t\tlabel: \"Other\",\n\t},\n\tdefault: {\n\t\tborderColor: \"border-l-slate-400\",\n\t\tbgColor: \"bg-slate-400/10\",\n\t\ticon: ClipboardCheck,\n\t\tlabel: \"Job\",\n\t},\n};\n\nconst getJobTypeConfig = (job: Job): JobTypeConfig => {\n\tconst config = job.jobType ? JOB_TYPE_CONFIG[job.jobType] : JOB_TYPE_CONFIG.default;\n\treturn config || JOB_TYPE_CONFIG.default;\n};\n\n// Get border color class for a job\nconst getJobTypeColor = (job: Job) => {\n\tconst config = getJobTypeConfig(job);\n\treturn `border-l-2 ${config.borderColor}`;\n};\n\n// Appointment category visual configuration - differentiates jobs, meetings, and events\ntype AppointmentCategoryConfig = {\n\ticon: React.ComponentType<{ className?: string }>;\n\tlabel: string;\n\tbgColor: string;\n\ttextColor: string;\n\tborderStyle: string; // solid for jobs, dashed for meetings, dotted for events\n};\n\nconst APPOINTMENT_CATEGORY_CONFIG: Record<AppointmentCategory, AppointmentCategoryConfig> = {\n\tjob: {\n\t\ticon: Briefcase,\n\t\tlabel: \"Job\",\n\t\tbgColor: \"bg-blue-500/10\",\n\t\ttextColor: \"text-blue-600 dark:text-blue-400\",\n\t\tborderStyle: \"border-solid\",\n\t},\n\tmeeting: {\n\t\ticon: Users,\n\t\tlabel: \"Meeting\",\n\t\tbgColor: \"bg-purple-500/10\",\n\t\ttextColor: \"text-purple-600 dark:text-purple-400\",\n\t\tborderStyle: \"border-dashed\",\n\t},\n\tevent: {\n\t\ticon: Calendar,\n\t\tlabel: \"Event\",\n\t\tbgColor: \"bg-emerald-500/10\",\n\t\ttextColor: \"text-emerald-600 dark:text-emerald-400\",\n\t\tborderStyle: \"border-dotted\",\n\t},\n};\n\nconst getAppointmentCategoryConfig = (job: Job): AppointmentCategoryConfig => {\n\tconst category = job.appointmentCategory || \"job\";\n\treturn APPOINTMENT_CATEGORY_CONFIG[category];\n};\n\ntype JobWithPosition = {\n\tjob: Job;\n\tleft: number;\n\twidth: number;\n\ttop: number;\n\tlane: number;\n\thasOverlap: boolean;\n};\n\n// Travel time gap between consecutive jobs\ntype TravelGap = {\n\tfromJobId: string;\n\ttoJobId: string;\n\tfromJob: Job;\n\ttoJob: Job;\n\tgapMinutes: number; // Time gap between jobs\n\testimatedTravelMinutes: number; // Estimated travel based on distance or default\n\tleftPosition: number; // Pixel position for indicator\n\twidth: number; // Width of the gap in pixels\n\tisTight: boolean; // True if gap < estimated travel time\n\tisInsufficient: boolean; // True if gap significantly less than needed\n};\n\n// Calculate distance between two coordinates (Haversine formula)\nfunction calculateDistance(\n\tlat1: number,\n\tlng1: number,\n\tlat2: number,\n\tlng2: number,\n): number {\n\tconst R = 3959; // Earth's radius in miles\n\tconst dLat = ((lat2 - lat1) * Math.PI) / 180;\n\tconst dLng = ((lng2 - lng1) * Math.PI) / 180;\n\tconst a =\n\t\tMath.sin(dLat / 2) * Math.sin(dLat / 2) +\n\t\tMath.cos((lat1 * Math.PI) / 180) *\n\t\t\tMath.cos((lat2 * Math.PI) / 180) *\n\t\t\tMath.sin(dLng / 2) *\n\t\t\tMath.sin(dLng / 2);\n\tconst c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\treturn R * c;\n}\n\n// Estimate travel time based on distance (assumes ~25 mph average in urban areas)\nfunction estimateTravelTime(distanceMiles: number): number {\n\tconst averageSpeedMph = 25;\n\treturn Math.ceil((distanceMiles / averageSpeedMph) * 60); // minutes\n}\n\n// Calculate travel gaps between consecutive jobs\nfunction calculateTravelGaps(\n\tjobs: JobWithPosition[],\n\thourWidth: number,\n): TravelGap[] {\n\tif (jobs.length < 2) return [];\n\n\t// Sort jobs by start time (left position)\n\tconst sortedJobs = [...jobs].sort((a, b) => a.left - b.left);\n\tconst gaps: TravelGap[] = [];\n\n\tfor (let i = 0; i < sortedJobs.length - 1; i++) {\n\t\tconst currentJob = sortedJobs[i];\n\t\tconst nextJob = sortedJobs[i + 1];\n\n\t\t// Skip if jobs overlap (lane stacking)\n\t\tif (currentJob.left + currentJob.width > nextJob.left) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst currentEnd =\n\t\t\tcurrentJob.job.endTime instanceof Date\n\t\t\t\t? currentJob.job.endTime\n\t\t\t\t: new Date(currentJob.job.endTime);\n\t\tconst nextStart =\n\t\t\tnextJob.job.startTime instanceof Date\n\t\t\t\t? nextJob.job.startTime\n\t\t\t\t: new Date(nextJob.job.startTime);\n\n\t\tconst gapMinutes = Math.round(\n\t\t\t(nextStart.getTime() - currentEnd.getTime()) / (1000 * 60),\n\t\t);\n\n\t\t// Only show gaps >= 15 minutes (significant travel opportunity)\n\t\tif (gapMinutes < 15) continue;\n\n\t\t// Calculate estimated travel time based on distance\n\t\tlet estimatedTravelMinutes = 15; // Default minimum\n\t\tconst currentCoords = currentJob.job.location?.coordinates;\n\t\tconst nextCoords = nextJob.job.location?.coordinates;\n\n\t\tif (currentCoords?.lat && currentCoords?.lng && nextCoords?.lat && nextCoords?.lng) {\n\t\t\tconst distance = calculateDistance(\n\t\t\t\tcurrentCoords.lat,\n\t\t\t\tcurrentCoords.lng,\n\t\t\t\tnextCoords.lat,\n\t\t\t\tnextCoords.lng,\n\t\t\t);\n\t\t\testimatedTravelMinutes = Math.max(5, estimateTravelTime(distance));\n\t\t}\n\n\t\tconst leftPosition = currentJob.left + currentJob.width;\n\t\tconst width = nextJob.left - leftPosition;\n\n\t\tgaps.push({\n\t\t\tfromJobId: currentJob.job.id,\n\t\t\ttoJobId: nextJob.job.id,\n\t\t\tfromJob: currentJob.job,\n\t\t\ttoJob: nextJob.job,\n\t\t\tgapMinutes,\n\t\t\testimatedTravelMinutes,\n\t\t\tleftPosition,\n\t\t\twidth,\n\t\t\tisTight: gapMinutes < estimatedTravelMinutes * 1.5,\n\t\t\tisInsufficient: gapMinutes < estimatedTravelMinutes,\n\t\t});\n\t}\n\n\treturn gaps;\n}\n\n// Travel time indicator component\nconst TravelTimeIndicator = memo(function TravelTimeIndicator({\n\tgap,\n}: {\n\tgap: TravelGap;\n}) {\n\t// Only show if gap is at least 30 pixels wide (to fit content)\n\tif (gap.width < 30) return null;\n\n\tconst formatDuration = (minutes: number): string => {\n\t\tif (minutes < 60) return `${minutes}m`;\n\t\tconst hours = Math.floor(minutes / 60);\n\t\tconst mins = minutes % 60;\n\t\treturn mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;\n\t};\n\n\treturn (\n\t\t<TooltipProvider>\n\t\t\t<Tooltip delayDuration={100}>\n\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"absolute flex items-center justify-center\"\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\tleft: `${gap.leftPosition}px`,\n\t\t\t\t\t\t\twidth: `${gap.width}px`,\n\t\t\t\t\t\t\ttop: \"50%\",\n\t\t\t\t\t\t\ttransform: \"translateY(-50%)\",\n\t\t\t\t\t\t\theight: \"32px\",\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\"flex items-center gap-1 rounded-full px-2 py-1 text-[10px] font-medium shadow-sm\",\n\t\t\t\t\t\t\t\tgap.isInsufficient\n\t\t\t\t\t\t\t\t\t? \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\"\n\t\t\t\t\t\t\t\t\t: gap.isTight\n\t\t\t\t\t\t\t\t\t\t? \"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400\"\n\t\t\t\t\t\t\t\t\t\t: \"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400\",\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Car className=\"size-3\" />\n\t\t\t\t\t\t\t<span>{formatDuration(gap.gapMinutes)}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</TooltipTrigger>\n\t\t\t\t<TooltipContent className=\"max-w-64\" side=\"top\" sideOffset={4}>\n\t\t\t\t\t<div className=\"space-y-1.5 text-xs\">\n\t\t\t\t\t\t<div className=\"font-semibold\">Travel Time Gap</div>\n\t\t\t\t\t\t<div className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t<span className=\"font-medium text-foreground\">\n\t\t\t\t\t\t\t\t{formatDuration(gap.gapMinutes)}\n\t\t\t\t\t\t\t</span>{\" \"}\n\t\t\t\t\t\t\tavailable between jobs\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"text-muted-foreground\">\n\t\t\t\t\t\t\tEst. travel:{\" \"}\n\t\t\t\t\t\t\t<span className=\"font-medium text-foreground\">\n\t\t\t\t\t\t\t\t{formatDuration(gap.estimatedTravelMinutes)}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{gap.isInsufficient && (\n\t\t\t\t\t\t\t<div className=\"text-red-600 dark:text-red-400 font-medium\">\n\t\t\t\t\t\t\t\t⚠ Insufficient travel time\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{gap.isTight && !gap.isInsufficient && (\n\t\t\t\t\t\t\t<div className=\"text-orange-600 dark:text-orange-400 font-medium\">\n\t\t\t\t\t\t\t\t⚠ Tight schedule\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t<div className=\"border-t pt-1.5 mt-1.5 text-muted-foreground\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\tFrom: {gap.fromJob.customer?.name || \"Unknown\"} (ends{\" \"}\n\t\t\t\t\t\t\t\t{format(\n\t\t\t\t\t\t\t\t\tgap.fromJob.endTime instanceof Date\n\t\t\t\t\t\t\t\t\t\t? gap.fromJob.endTime\n\t\t\t\t\t\t\t\t\t\t: new Date(gap.fromJob.endTime),\n\t\t\t\t\t\t\t\t\t\"h:mm a\",\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\tTo: {gap.toJob.customer?.name || \"Unknown\"} (starts{\" \"}\n\t\t\t\t\t\t\t\t{format(\n\t\t\t\t\t\t\t\t\tgap.toJob.startTime instanceof Date\n\t\t\t\t\t\t\t\t\t\t? gap.toJob.startTime\n\t\t\t\t\t\t\t\t\t\t: new Date(gap.toJob.startTime),\n\t\t\t\t\t\t\t\t\t\"h:mm a\",\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</TooltipContent>\n\t\t\t</Tooltip>\n\t\t</TooltipProvider>\n\t);\n});\n\nfunction detectOverlaps(\n\tjobs: Array<{ job: Job; left: number; width: number }>,\n): JobWithPosition[] {\n\tconst positioned: JobWithPosition[] = [];\n\n\t// Sort by start time\n\tconst sorted = [...jobs].sort((a, b) => a.left - b.left);\n\n\tsorted.forEach(({ job, left, width }) => {\n\t\tconst right = left + width;\n\n\t\t// Find all jobs this one overlaps with\n\t\tconst overlapping = positioned.filter((p) => {\n\t\t\tconst pRight = p.left + p.width;\n\t\t\treturn !(right <= p.left || left >= pRight);\n\t\t});\n\n\t\tif (overlapping.length > 0) {\n\t\t\toverlapping.forEach((p) => {\n\t\t\t\tif (!p.hasOverlap) {\n\t\t\t\t\tp.hasOverlap = true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Find the first available lane (row)\n\t\tlet lane = 0;\n\t\tconst usedLanes = new Set(overlapping.map((p) => p.lane));\n\t\twhile (usedLanes.has(lane)) {\n\t\t\tlane++;\n\t\t}\n\n\t\tpositioned.push({\n\t\t\tjob,\n\t\t\tleft,\n\t\t\twidth,\n\t\t\ttop: lane * (JOB_HEIGHT + STACK_GAP),\n\t\t\tlane,\n\t\t\thasOverlap: overlapping.length > 0,\n\t\t});\n\t});\n\n\treturn positioned;\n}\n\nconst JobCard = memo(function JobCard({\n\tjob,\n\tleft,\n\twidth,\n\ttop,\n\thasOverlap,\n\tisSelected,\n\tonSelect,\n\tonHover,\n\tonResize,\n\tonResizeComplete,\n}: {\n\tjob: Job;\n\tleft: number;\n\twidth: number;\n\ttop: number;\n\thasOverlap: boolean;\n\tisSelected: boolean;\n\tonSelect: () => void;\n\tonHover: (isHovering: boolean) => void;\n\tonResize: (\n\t\tjobId: string,\n\t\tdirection: \"start\" | \"end\",\n\t\tdeltaMinutes: number,\n\t) => void;\n\tonResizeComplete: (jobId: string, hasChanges: boolean) => void;\n}) {\n\tconst [isResizing, setIsResizing] = useState(false);\n\tconst [isContextMenuOpen, setIsContextMenuOpen] = useState(false);\n\tconst [isPending, startTransition] = useTransition();\n\tconst { attributes, listeners, setNodeRef, transform, isDragging } =\n\t\tuseDraggable({\n\t\t\tid: job.id,\n\t\t\tdata: { job },\n\t\t\tdisabled: isResizing,\n\t\t});\n\n\t// Quick action handlers\n\tconst handleDispatch = useCallback(\n\t\t(e: React.MouseEvent) => {\n\t\t\te.stopPropagation();\n\t\t\tif (!job.id) return;\n\t\t\tstartTransition(async () => {\n\t\t\t\tconst result = await dispatchAppointment(job.id);\n\t\t\t\tif (result.success) {\n\t\t\t\t\ttoast.success(\"Job dispatched\");\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(result.error || \"Failed to dispatch\");\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t[job.id],\n\t);\n\n\tconst handleArrive = useCallback(\n\t\t(e: React.MouseEvent) => {\n\t\t\te.stopPropagation();\n\t\t\tif (!job.id) return;\n\t\t\tstartTransition(async () => {\n\t\t\t\tconst result = await arriveAppointment(job.id);\n\t\t\t\tif (result.success) {\n\t\t\t\t\ttoast.success(\"Marked as arrived\");\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(result.error || \"Failed to update\");\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t[job.id],\n\t);\n\n\tconst handleComplete = useCallback(\n\t\t(e: React.MouseEvent) => {\n\t\t\te.stopPropagation();\n\t\t\tif (!job.id) return;\n\t\t\tstartTransition(async () => {\n\t\t\t\tconst result = await completeAppointment(job.id);\n\t\t\t\tif (result.success) {\n\t\t\t\t\ttoast.success(\"Job completed\");\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(result.error || \"Failed to complete\");\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t[job.id],\n\t);\n\n\t// Determine which quick action to show based on status\n\tconst getQuickAction = () => {\n\t\tif (!job.jobId || job.assignments.length === 0) return null;\n\n\t\tswitch (job.status) {\n\t\t\tcase \"scheduled\":\n\t\t\t\treturn {\n\t\t\t\t\ticon: Send,\n\t\t\t\t\tlabel: \"Dispatch\",\n\t\t\t\t\tonClick: handleDispatch,\n\t\t\t\t\tclassName: \"bg-blue-500 hover:bg-blue-600 text-white\",\n\t\t\t\t};\n\t\t\tcase \"dispatched\":\n\t\t\t\treturn {\n\t\t\t\t\ticon: Car,\n\t\t\t\t\tlabel: \"Arrive\",\n\t\t\t\t\tonClick: handleArrive,\n\t\t\t\t\tclassName: \"bg-sky-500 hover:bg-sky-600 text-white\",\n\t\t\t\t};\n\t\t\tcase \"arrived\":\n\t\t\t\treturn {\n\t\t\t\t\ticon: Play,\n\t\t\t\t\tlabel: \"Start\",\n\t\t\t\t\tonClick: handleComplete,\n\t\t\t\t\tclassName: \"bg-emerald-500 hover:bg-emerald-600 text-white\",\n\t\t\t\t};\n\t\t\tcase \"in-progress\":\n\t\t\t\treturn {\n\t\t\t\t\ticon: Check,\n\t\t\t\t\tlabel: \"Done\",\n\t\t\t\t\tonClick: handleComplete,\n\t\t\t\t\tclassName: \"bg-amber-500 hover:bg-amber-600 text-white\",\n\t\t\t\t};\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t};\n\n\tconst quickAction = getQuickAction();\n\n\tconst topOffset =\n\t\t(top > 0 || hasOverlap ? STACK_GAP : BASE_CENTER_OFFSET) + top;\n\n\tconst style = {\n\t\tleft: `${left}px`,\n\t\twidth: `${width}px`,\n\t\ttop: `${topOffset}px`,\n\t\theight: `${JOB_HEIGHT}px`,\n\t\ttransform: CSS.Translate.toString(transform),\n\t\tzIndex: isDragging ? 50 : isSelected ? 20 : 10 - top / JOB_STACK_OFFSET,\n\t};\n\n\tconst startTime =\n\t\tjob.startTime instanceof Date ? job.startTime : new Date(job.startTime);\n\tconst endTime =\n\t\tjob.endTime instanceof Date ? job.endTime : new Date(job.endTime);\n\tconst duration = Math.round(\n\t\t(endTime.getTime() - startTime.getTime()) / (1000 * 60),\n\t);\n\n\tconst borderColor = getJobTypeColor(job);\n\n\tconst handleResizeStart = (\n\t\te: React.MouseEvent,\n\t\tdirection: \"start\" | \"end\",\n\t) => {\n\t\te.stopPropagation();\n\t\tsetIsResizing(true);\n\t\tonHover(true); // Keep hover state active during resize\n\n\t\tconst startX = e.clientX;\n\t\tlet totalDelta = 0;\n\n\t\tconst handleMouseMove = (moveEvent: MouseEvent) => {\n\t\t\tconst deltaX = moveEvent.clientX - startX;\n\t\t\tconst deltaMinutes = Math.round((deltaX / HOUR_WIDTH) * 60);\n\n\t\t\t// Snap to 15-minute intervals\n\t\t\tconst snappedMinutes = Math.round(deltaMinutes / 15) * 15;\n\n\t\t\tif (snappedMinutes !== totalDelta) {\n\t\t\t\ttotalDelta = snappedMinutes;\n\t\t\t\tonResize(job.id, direction, snappedMinutes);\n\t\t\t}\n\t\t};\n\n\t\tconst handleMouseUp = () => {\n\t\t\tsetIsResizing(false);\n\t\t\tonHover(false);\n\t\t\tdocument.removeEventListener(\"mousemove\", handleMouseMove);\n\t\t\tdocument.removeEventListener(\"mouseup\", handleMouseUp);\n\n\t\t\tonResizeComplete(job.id, totalDelta !== 0);\n\t\t};\n\n\t\tdocument.addEventListener(\"mousemove\", handleMouseMove);\n\t\tdocument.addEventListener(\"mouseup\", handleMouseUp);\n\t};\n\n\treturn (\n\t\t<TooltipProvider>\n\t\t\t<Tooltip delayDuration={200} open={isContextMenuOpen ? false : undefined}>\n\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"group absolute\",\n\t\t\t\t\t\t\t// Smooth position transitions when not dragging (for repositioning after drop)\n\t\t\t\t\t\t\t!isDragging && \"transition-[left,top,width] duration-200 ease-out\",\n\t\t\t\t\t\t)}\n\t\t\t\t\t\tref={setNodeRef}\n\t\t\t\t\t\tstyle={style}\n\t\t\t\t\t\t{...attributes}\n\t\t\t\t\t\t{...listeners}\n\t\t\t\t\t\tonMouseEnter={() => onHover(true)}\n\t\t\t\t\t\tonMouseLeave={() => onHover(false)}\n\t\t\t\t\t>\n\t\t\t\t\t\t{/* Left Resize Handle */}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"bg-primary absolute top-0 left-0 h-full w-1 cursor-ew-resize opacity-0 transition-opacity group-hover:opacity-100 hover:opacity-100\"\n\t\t\t\t\t\t\tonMouseDown={(e) => handleResizeStart(e, \"start\")}\n\t\t\t\t\t\t\tstyle={{ zIndex: 60 }}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<ScheduleJobContextMenu job={job} onOpenChange={setIsContextMenuOpen}>\n\t\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\t\tconst categoryConfig = getAppointmentCategoryConfig(job);\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"bg-card relative flex h-full cursor-grab items-center gap-2 rounded-md border px-2.5 py-1.5 active:cursor-grabbing\",\n\t\t\t\t\t\t\t\t\t\t\t// Performance: Only transition shadow/ring, not all properties. Disable during drag.\n\t\t\t\t\t\t\t\t\t\t\t!isDragging && \"transition-[box-shadow,ring] duration-150 ease-out hover:shadow-sm\",\n\t\t\t\t\t\t\t\t\t\t\tborderColor,\n\t\t\t\t\t\t\t\t\t\t\tcategoryConfig.borderStyle,\n\t\t\t\t\t\t\t\t\t\t\tjob.isUnassigned && \"!border-red-500\",\n\t\t\t\t\t\t\t\t\t\t\tisSelected && \"ring-primary shadow-md ring-1\",\n\t\t\t\t\t\t\t\t\t\t\tisDragging && \"shadow-2xl ring-2 ring-primary/50 scale-[1.02] opacity-90\",\n\t\t\t\t\t\t\t\t\t\t\t(job.status === \"completed\" || job.status === \"closed\") &&\n\t\t\t\t\t\t\t\t\t\t\t\t\"opacity-50\",\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\tonClick={onSelect}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{/* Overlap indicator - subtle dot */}\n\t\t\t\t\t\t\t\t\t\t{hasOverlap && (\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"absolute -top-0.5 -right-0.5 size-2 rounded-full bg-red-500\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent side=\"top\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tOverlaps with another job\n\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t{/* Recurring indicator - subtle */}\n\t\t\t\t\t\t\t\t\t\t{job.recurrence && (\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Repeat className=\"absolute -top-0.5 left-0.5 size-2.5 text-violet-500\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent side=\"top\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tRecurring job\n\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t{/* Appointment Category Indicator */}\n\t\t\t\t\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\t\t\t\t\tconst CategoryIcon = categoryConfig.icon;\n\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className={cn(\"flex size-4 shrink-0 items-center justify-center rounded-sm\", categoryConfig.bgColor)}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<CategoryIcon className={cn(\"size-2.5\", categoryConfig.textColor)} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent side=\"top\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{categoryConfig.label}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t})()}\n\n\t\t\t\t\t\t\t\t\t\t{/* Job Type Icon */}\n\t\t\t\t\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\t\t\t\t\tconst typeConfig = getJobTypeConfig(job);\n\t\t\t\t\t\t\t\t\t\t\tconst TypeIcon = typeConfig.icon;\n\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className={cn(\"flex size-5 shrink-0 items-center justify-center rounded\", typeConfig.bgColor)}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TypeIcon className={cn(\"size-3\", typeConfig.borderColor.replace(\"border-l-\", \"text-\"))} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent side=\"top\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{typeConfig.label}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t})()}\n\n\t\t\t\t\t\t\t\t\t\t{/* Customer Name - Primary */}\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-foreground flex-1 truncate text-xs font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t{job.customer?.name || \"Unknown Customer\"}\n\t\t\t\t\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t\t\t\t\t{/* Team Avatars */}\n\t\t\t\t\t\t\t\t\t\t<TeamAvatarGroup\n\t\t\t\t\t\t\t\t\t\t\tassignments={job.assignments}\n\t\t\t\t\t\t\t\t\t\t\tmaxVisible={3}\n\t\t\t\t\t\t\t\t\t\t\tonAddMember={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t// TODO: Implement add team member\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tonRemove={(_techId) => {\n\t\t\t\t\t\t\t\t\t\t\t\t// TODO: Implement remove team member\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t\t\t{/* Quick Action Button - appears on hover */}\n\t\t\t\t\t\t\t\t\t\t{quickAction && (\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={quickAction.onClick}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={isPending}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex size-6 items-center justify-center rounded-md opacity-0 transition-opacity duration-150 group-hover:opacity-100\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"focus:outline-none focus:ring-2 focus:ring-offset-1\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tquickAction.className,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisPending && \"cursor-wait opacity-50\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{isPending ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"size-3 animate-spin rounded-full border-2 border-white border-t-transparent\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<quickAction.icon className=\"size-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent side=\"top\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{quickAction.label}\n\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t{/* View Details Link - appears on hover */}\n\t\t\t\t\t\t\t\t\t\t{job.jobId && (\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thref={`/dashboard/work/${job.jobId}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex size-6 items-center justify-center rounded-md bg-slate-100 opacity-0 transition-[opacity,background-color] duration-150 hover:bg-slate-200 group-hover:opacity-100 dark:bg-slate-800 dark:hover:bg-slate-700\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ExternalLink className=\"size-3 text-slate-600 dark:text-slate-400\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent side=\"top\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tView Details\n\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t{/* Status dot */}\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\"size-1.5 shrink-0 rounded-full\",\n\t\t\t\t\t\t\t\t\t\t\t\tjob.status === \"scheduled\" && \"bg-blue-500\",\n\t\t\t\t\t\t\t\t\t\t\t\tjob.status === \"dispatched\" && \"bg-sky-500\",\n\t\t\t\t\t\t\t\t\t\t\t\tjob.status === \"arrived\" && \"bg-emerald-500\",\n\t\t\t\t\t\t\t\t\t\t\t\tjob.status === \"in-progress\" && \"bg-amber-500\",\n\t\t\t\t\t\t\t\t\t\t\t\t(job.status === \"closed\" || job.status === \"completed\") && \"bg-slate-400\",\n\t\t\t\t\t\t\t\t\t\t\t\tjob.status === \"cancelled\" && \"bg-slate-300\",\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t})()}\n\t\t\t\t\t\t</ScheduleJobContextMenu>\n\n\t\t\t\t\t\t{/* Right Resize Handle */}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"bg-primary absolute top-0 right-0 h-full w-1 cursor-ew-resize opacity-0 transition-opacity group-hover:opacity-100 hover:opacity-100\"\n\t\t\t\t\t\t\tonMouseDown={(e) => handleResizeStart(e, \"end\")}\n\t\t\t\t\t\t\tstyle={{ zIndex: 60 }}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</TooltipTrigger>\n\t\t\t\t<TooltipContent\n\t\t\t\t\tclassName=\"w-80 overflow-hidden rounded-lg border border-border bg-popover p-0 shadow-xl [&>svg]:hidden\"\n\t\t\t\t\tside=\"top\"\n\t\t\t\t\tsideOffset={8}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"overflow-hidden text-popover-foreground\">\n\t\t\t\t\t\t{/* Header */}\n\t\t\t\t\t\t<div className=\"border-b border-border px-4 py-3\">\n\t\t\t\t\t\t\t<div className=\"mb-2 flex items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t<h4 className=\"text-foreground text-base font-bold\">\n\t\t\t\t\t\t\t\t\t{job.customer?.name || \"Unknown Customer\"}\n\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t<Badge className=\"text-[10px] capitalize\" variant=\"outline\">\n\t\t\t\t\t\t\t\t\t{job.status}\n\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground mb-2 text-sm\">{job.title}</p>\n\t\t\t\t\t\t\t{/* Type badges row */}\n\t\t\t\t\t\t\t<div className=\"flex flex-wrap items-center gap-1.5\">\n\t\t\t\t\t\t\t\t{/* Appointment Category Badge */}\n\t\t\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\t\t\tconst catConfig = getAppointmentCategoryConfig(job);\n\t\t\t\t\t\t\t\t\tconst CatIcon = catConfig.icon;\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\"gap-1 px-2 py-0.5 text-[10px]\",\n\t\t\t\t\t\t\t\t\t\t\t\tcatConfig.bgColor,\n\t\t\t\t\t\t\t\t\t\t\t\tcatConfig.textColor,\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<CatIcon className=\"size-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t{catConfig.label}\n\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t})()}\n\t\t\t\t\t\t\t\t{/* Job Type Badge */}\n\t\t\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\t\t\tconst typeConfig = getJobTypeConfig(job);\n\t\t\t\t\t\t\t\t\tconst TypeIcon = typeConfig.icon;\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\"gap-1 px-2 py-0.5 text-[10px]\",\n\t\t\t\t\t\t\t\t\t\t\t\ttypeConfig.bgColor,\n\t\t\t\t\t\t\t\t\t\t\t\ttypeConfig.borderColor.replace(\"border-l-\", \"text-\"),\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<TypeIcon className=\"size-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t{typeConfig.label}\n\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t})()}\n\t\t\t\t\t\t\t\t{job.recurrence && (\n\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\tclassName=\"gap-0.5 bg-violet-100 px-1.5 py-0.5 text-[10px] text-violet-700 dark:bg-violet-900/30 dark:text-violet-300\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Repeat className=\"size-2.5\" />\n\t\t\t\t\t\t\t\t\t\tRecurring\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{job.priority === \"urgent\" && (\n\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\tclassName=\"gap-0.5 px-1.5 py-0.5 text-[10px]\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"size-2.5\" />\n\t\t\t\t\t\t\t\t\t\tUrgent\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* Content */}\n\t\t\t\t\t\t<div className=\"space-y-3 p-4\">\n\t\t\t\t\t\t\t{/* Time */}\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2.5\">\n\t\t\t\t\t\t\t\t<Clock className=\"text-muted-foreground size-4\" />\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<p className=\"text-foreground text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t{format(startTime, \"h:mm a\")} – {format(endTime, \"h:mm a\")}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t{format(startTime, \"EEE, MMM d\")} • {duration} min\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Location */}\n\t\t\t\t\t\t\t{job.location?.address?.street && (\n\t\t\t\t\t\t\t\t<div className=\"flex items-start gap-2.5\">\n\t\t\t\t\t\t\t\t\t<MapPin className=\"text-muted-foreground mt-0.5 size-4 shrink-0\" />\n\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-foreground text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t{job.location.address.street}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t{job.location.address.city && (\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t{job.location.address.city},{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t\t{job.location.address.state}\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t{/* Contact */}\n\t\t\t\t\t\t\t{job.customer?.phone && (\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2.5\">\n\t\t\t\t\t\t\t\t\t<User className=\"text-muted-foreground size-4\" />\n\t\t\t\t\t\t\t\t\t<p className=\"text-foreground text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t{job.customer.phone}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t{/* Team */}\n\t\t\t\t\t\t\t{job.assignments.length > 0 && (\n\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-1.5 border-t border-border pt-2\">\n\t\t\t\t\t\t\t\t\t{job.assignments.map((assignment, idx) => (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"bg-muted flex items-center gap-1 rounded-md px-2 py-1\"\n\t\t\t\t\t\t\t\t\t\t\tkey={idx}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"size-1.5 rounded-full\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tassignment.status === \"available\" && \"bg-green-500\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tassignment.status === \"on-job\" && \"bg-amber-500\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tassignment.status === \"on-break\" && \"bg-slate-400\",\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-foreground text-xs font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t{assignment.displayName}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* Action */}\n\t\t\t\t\t\t{job.jobId && (\n\t\t\t\t\t\t\t<div className=\"border-t border-border p-3\">\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\tclassName=\"bg-primary text-primary-foreground hover:bg-primary/90 flex items-center justify-center gap-1.5 rounded-md px-3 py-2 text-sm font-medium transition-colors\"\n\t\t\t\t\t\t\t\t\thref={`/dashboard/work/${job.jobId}`}\n\t\t\t\t\t\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tView Details\n\t\t\t\t\t\t\t\t\t<ChevronRight className=\"size-3.5\" />\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</TooltipContent>\n\t\t\t</Tooltip>\n\t\t</TooltipProvider>\n\t);\n}, (prev, next) => {\n\t// Performance: Custom comparison to avoid re-renders from callback references\n\t// Only re-render if actual data or selection state changes\n\treturn (\n\t\tprev.job.id === next.job.id &&\n\t\tprev.job.status === next.job.status &&\n\t\tprev.job.startTime === next.job.startTime &&\n\t\tprev.job.endTime === next.job.endTime &&\n\t\tprev.left === next.left &&\n\t\tprev.width === next.width &&\n\t\tprev.top === next.top &&\n\t\tprev.hasOverlap === next.hasOverlap &&\n\t\tprev.isSelected === next.isSelected\n\t);\n});\n\nconst TechnicianLane = memo(function TechnicianLane({\n\ttechnician,\n\tjobs,\n\theight,\n\tselectedJobId,\n\tonSelectJob,\n\tonJobHover,\n\tonResize,\n\tonResizeComplete,\n\tisDragActive,\n\tonDoubleClick,\n\tonDragCreate,\n\ttotalWidth,\n\ttimeRangeStart,\n\tisSelectionMode,\n\tselectedJobIds,\n\tonToggleJobSelection,\n}: {\n\ttechnician: Technician;\n\tjobs: JobWithPosition[];\n\theight: number;\n\tselectedJobId: string | null;\n\tonSelectJob: (jobId: string) => void;\n\tonJobHover: (isHovering: boolean) => void;\n\tonResize: (\n\t\tjobId: string,\n\t\tdirection: \"start\" | \"end\",\n\t\tdeltaMinutes: number,\n\t) => void;\n\tonResizeComplete: (jobId: string, hasChanges: boolean) => void;\n\tisDragActive: boolean;\n\tonDoubleClick: (technicianId: string, startTime: Date) => void;\n\tonDragCreate: (technicianId: string, startTime: Date, durationMinutes: number) => void;\n\ttotalWidth: number;\n\ttimeRangeStart: Date;\n\tisSelectionMode: boolean;\n\tselectedJobIds: Set<string>;\n\tonToggleJobSelection: (jobId: string) => void;\n}) {\n\tconst { setNodeRef, isOver } = useDroppable({\n\t\tid: technician.id,\n\t\tdata: { technician },\n\t});\n\n\t// Calculate travel gaps between consecutive jobs\n\tconst travelGaps = useMemo(\n\t\t() => calculateTravelGaps(jobs, HOUR_WIDTH),\n\t\t[jobs],\n\t);\n\n\t// Handle double-click to create new job\n\tconst handleDoubleClick = useCallback(\n\t\t(e: React.MouseEvent<HTMLDivElement>) => {\n\t\t\t// Only trigger on empty space (not on job cards)\n\t\t\tif ((e.target as HTMLElement).closest(\".job-card\")) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst rect = e.currentTarget.getBoundingClientRect();\n\t\t\tconst clickX = e.clientX - rect.left;\n\t\t\t// Calculate total minutes based on actual buffer width (multi-day support)\n\t\t\tconst totalHours = totalWidth / HOUR_WIDTH;\n\t\t\tconst minutesFromStart = (clickX / totalWidth) * (totalHours * 60);\n\n\t\t\t// Snap to 15-minute intervals\n\t\t\tconst snappedMinutes = Math.round(minutesFromStart / 15) * 15;\n\n\t\t\tconst newStartTime = new Date(timeRangeStart);\n\t\t\tnewStartTime.setMinutes(newStartTime.getMinutes() + snappedMinutes);\n\n\t\t\tonDoubleClick(technician.id, newStartTime);\n\t\t},\n\t\t[totalWidth, timeRangeStart, technician.id, onDoubleClick],\n\t);\n\n\t// Drag-to-create state\n\tconst [isDraggingToCreate, setIsDraggingToCreate] = useState(false);\n\tconst [dragStartX, setDragStartX] = useState(0);\n\tconst [dragCurrentX, setDragCurrentX] = useState(0);\n\t// Store the lane rect when drag starts so we don't depend on ref in effects\n\tconst dragLaneRectRef = useRef<DOMRect | null>(null);\n\tconst laneRef = useRef<HTMLDivElement>(null);\n\n\t// Convert pixel position to time (multi-day buffer support)\n\tconst pixelToTime = useCallback(\n\t\t(pixelX: number): Date => {\n\t\t\tconst totalHours = totalWidth / HOUR_WIDTH;\n\t\t\tconst minutesFromStart = (pixelX / totalWidth) * (totalHours * 60);\n\t\t\tconst snappedMinutes = Math.round(minutesFromStart / 15) * 15;\n\t\t\tconst time = new Date(timeRangeStart);\n\t\t\ttime.setMinutes(time.getMinutes() + snappedMinutes);\n\t\t\treturn time;\n\t\t},\n\t\t[totalWidth, timeRangeStart],\n\t);\n\n\t// Handle mouse down to start drag-to-create\n\tconst handleCanvasMouseDown = useCallback(\n\t\t(e: React.MouseEvent<HTMLDivElement>) => {\n\t\t\t// Only trigger on empty space (not on job cards or resize handles)\n\t\t\tif ((e.target as HTMLElement).closest(\".job-card\")) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Only left mouse button\n\t\t\tif (e.button !== 0) return;\n\n\t\t\tconst rect = e.currentTarget.getBoundingClientRect();\n\t\t\tconst startX = e.clientX - rect.left;\n\n\t\t\t// Store the rect for use in global event handlers\n\t\t\tdragLaneRectRef.current = rect;\n\t\t\tsetDragStartX(startX);\n\t\t\tsetDragCurrentX(startX);\n\t\t\tsetIsDraggingToCreate(true);\n\n\t\t\t// Prevent text selection during drag\n\t\t\te.preventDefault();\n\t\t},\n\t\t[],\n\t);\n\n\t// Handle mouse move during drag-to-create\n\tuseEffect(() => {\n\t\tif (!isDraggingToCreate) return;\n\n\t\t// Use stored rect from mousedown - this ensures we have the correct reference\n\t\tconst rect = dragLaneRectRef.current;\n\t\tif (!rect) return;\n\n\t\tconst handleMouseMove = (e: MouseEvent) => {\n\t\t\tconst currentX = Math.max(0, Math.min(e.clientX - rect.left, totalWidth));\n\t\t\tsetDragCurrentX(currentX);\n\t\t};\n\n\t\tconst handleMouseUp = (e: MouseEvent) => {\n\t\t\tconst endX = Math.max(0, Math.min(e.clientX - rect.left, totalWidth));\n\n\t\t\t// Calculate start and end times\n\t\t\tconst minX = Math.min(dragStartX, endX);\n\t\t\tconst maxX = Math.max(dragStartX, endX);\n\n\t\t\t// Only trigger if dragged more than 20 pixels (to avoid accidental clicks)\n\t\t\tconst dragDistance = maxX - minX;\n\t\t\tconsole.log(\"[DEBUG] MouseUp - dragDistance:\", dragDistance, \"minX:\", minX, \"maxX:\", maxX);\n\n\t\t\t// Clear drag state first\n\t\t\tsetIsDraggingToCreate(false);\n\t\t\tsetDragStartX(0);\n\t\t\tsetDragCurrentX(0);\n\t\t\tdragLaneRectRef.current = null;\n\n\t\t\tif (dragDistance > 20) {\n\t\t\t\tconst startTime = pixelToTime(minX);\n\t\t\t\tconst endTime = pixelToTime(maxX);\n\t\t\t\tconst durationMinutes = Math.round((endTime.getTime() - startTime.getTime()) / (1000 * 60));\n\n\t\t\t\t// Minimum 15 minutes - open dialog\n\t\t\t\tif (durationMinutes >= 15) {\n\t\t\t\t\t// Use setTimeout to ensure state clearing is processed first\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tconsole.log(\"[DEBUG] Drag-to-create:\", { techId: technician.id, startTime, durationMinutes });\n\t\t\t\t\t\tonDragCreate(technician.id, startTime, durationMinutes);\n\t\t\t\t\t}, 0);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(\"[DEBUG] Duration too short:\", durationMinutes, \"minutes\");\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tdocument.addEventListener(\"mousemove\", handleMouseMove);\n\t\tdocument.addEventListener(\"mouseup\", handleMouseUp);\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"mousemove\", handleMouseMove);\n\t\t\tdocument.removeEventListener(\"mouseup\", handleMouseUp);\n\t\t};\n\t}, [isDraggingToCreate, dragStartX, totalWidth, pixelToTime, technician.id, onDragCreate]);\n\n\t// Calculate drag preview position and dimensions\n\tconst dragPreviewStyle = useMemo(() => {\n\t\tif (!isDraggingToCreate) return null;\n\t\tconst minX = Math.min(dragStartX, dragCurrentX);\n\t\tconst width = Math.abs(dragCurrentX - dragStartX);\n\t\treturn { left: minX, width };\n\t}, [isDraggingToCreate, dragStartX, dragCurrentX]);\n\n\t// Calculate preview time labels\n\tconst dragTimeLabels = useMemo(() => {\n\t\tif (!isDraggingToCreate || !dragPreviewStyle || dragPreviewStyle.width < 20) return null;\n\t\tconst minX = Math.min(dragStartX, dragCurrentX);\n\t\tconst maxX = Math.max(dragStartX, dragCurrentX);\n\t\tconst startTime = pixelToTime(minX);\n\t\tconst endTime = pixelToTime(maxX);\n\t\tconst durationMinutes = Math.round((endTime.getTime() - startTime.getTime()) / (1000 * 60));\n\t\treturn {\n\t\t\tstart: format(startTime, \"h:mm a\"),\n\t\t\tend: format(endTime, \"h:mm a\"),\n\t\t\tduration: durationMinutes >= 60\n\t\t\t\t? `${Math.floor(durationMinutes / 60)}h ${durationMinutes % 60}m`\n\t\t\t\t: `${durationMinutes}m`,\n\t\t};\n\t}, [isDraggingToCreate, dragPreviewStyle, dragStartX, dragCurrentX, pixelToTime]);\n\n\t// Combine refs for both droppable and local lane ref\n\tconst combinedRef = useCallback(\n\t\t(node: HTMLDivElement | null) => {\n\t\t\tsetNodeRef(node);\n\t\t\t(laneRef as React.MutableRefObject<HTMLDivElement | null>).current = node;\n\t\t},\n\t\t[setNodeRef],\n\t);\n\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\n\t\t\t\t\"relative border-b transition-[background-color,box-shadow] duration-150\",\n\t\t\t\tisDragActive && \"bg-muted/20\",\n\t\t\t\tisOver && \"bg-primary/10 ring-primary shadow-inner ring-2 ring-inset\",\n\t\t\t\tisDraggingToCreate && \"cursor-crosshair select-none\",\n\t\t\t)}\n\t\t\tref={combinedRef}\n\t\t\tstyle={{ height, minHeight: height, maxHeight: height }}\n\t\t\tonDoubleClick={handleDoubleClick}\n\t\t\tonMouseDown={handleCanvasMouseDown}\n\t\t>\n\t\t\t{/* Drop zone indicator */}\n\t\t\t{isOver && (\n\t\t\t\t<div className=\"pointer-events-none absolute inset-0 z-10 flex items-center justify-center\">\n\t\t\t\t\t<div className=\"fade-in zoom-in-95 animate-in bg-primary text-primary-foreground rounded-lg px-4 py-2 text-sm font-semibold shadow-lg duration-200\">\n\t\t\t\t\t\tDrop to assign to {technician.name}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{/* Drag-to-create preview */}\n\t\t\t{isDraggingToCreate && dragPreviewStyle && dragPreviewStyle.width > 10 && (\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"pointer-events-none absolute z-50\"\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tleft: dragPreviewStyle.left,\n\t\t\t\t\t\twidth: dragPreviewStyle.width,\n\t\t\t\t\t\theight: JOB_HEIGHT,\n\t\t\t\t\t\ttop: BASE_CENTER_OFFSET,\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t{/* Preview box with time badge inside */}\n\t\t\t\t\t<div className=\"relative flex h-full w-full items-center justify-center rounded-lg border-2 border-dashed border-blue-400 bg-blue-500/40 shadow-lg\">\n\t\t\t\t\t\t{/* Time badge centered inside the box */}\n\t\t\t\t\t\t{dragTimeLabels && (\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-1.5 rounded-full bg-blue-600 px-3 py-1 text-xs font-bold text-white shadow-md\">\n\t\t\t\t\t\t\t\t<Clock className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t<span>{dragTimeLabels.start} - {dragTimeLabels.end}</span>\n\t\t\t\t\t\t\t\t<span className=\"text-blue-200\">({dragTimeLabels.duration})</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{jobs.length === 0 && !isDragActive ? (\n\t\t\t\t<div className=\"flex h-full items-center pl-4\">\n\t\t\t\t\t<div className=\"sticky left-16 z-20\">\n\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<div className=\"border-muted-foreground/30 bg-muted hover:border-primary/40 hover:bg-primary/5 flex h-10 cursor-pointer items-center gap-2 rounded-md border border-dashed px-4 py-2 shadow-sm transition-colors\">\n\t\t\t\t\t\t\t\t\t<Plus className=\"text-muted-foreground size-3.5\" />\n\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs font-semibold tracking-wide\">\n\t\t\t\t\t\t\t\t\t\tDouble-click to add job\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent side=\"top\" className=\"text-xs\">\n\t\t\t\t\t\t\t\tDouble-click anywhere to schedule a job for {technician.name}\n\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t) : (\n\t\t\t\t<>\n\t\t\t\t\t{/* Travel time indicators between jobs */}\n\t\t\t\t\t{travelGaps.map((gap) => (\n\t\t\t\t\t\t<TravelTimeIndicator gap={gap} key={`travel-${gap.fromJobId}-${gap.toJobId}`} />\n\t\t\t\t\t))}\n\n\t\t\t\t\t{/* Job cards */}\n\t\t\t\t\t{jobs.map(({ job, left, width, top, hasOverlap }) => (\n\t\t\t\t\t\t<JobCard\n\t\t\t\t\t\t\thasOverlap={hasOverlap}\n\t\t\t\t\t\t\tisSelected={\n\t\t\t\t\t\t\t\tisSelectionMode\n\t\t\t\t\t\t\t\t\t? selectedJobIds.has(job.id)\n\t\t\t\t\t\t\t\t\t: selectedJobId === job.id\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tjob={job}\n\t\t\t\t\t\t\tkey={job.id}\n\t\t\t\t\t\t\tleft={left}\n\t\t\t\t\t\t\tonHover={onJobHover}\n\t\t\t\t\t\t\tonResize={onResize}\n\t\t\t\t\t\t\tonResizeComplete={onResizeComplete}\n\t\t\t\t\t\t\tonSelect={() =>\n\t\t\t\t\t\t\t\tisSelectionMode\n\t\t\t\t\t\t\t\t\t? onToggleJobSelection(job.id)\n\t\t\t\t\t\t\t\t\t: onSelectJob(job.id)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttop={top}\n\t\t\t\t\t\t\twidth={width}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))}\n\t\t\t\t</>\n\t\t\t)}\n\t\t</div>\n\t);\n}, (prev, next) => {\n\t// Performance: Custom comparison to avoid re-renders from callback references\n\treturn (\n\t\tprev.technician.id === next.technician.id &&\n\t\tprev.height === next.height &&\n\t\tprev.selectedJobId === next.selectedJobId &&\n\t\tprev.isDragActive === next.isDragActive &&\n\t\tprev.totalWidth === next.totalWidth &&\n\t\tprev.timeRangeStart === next.timeRangeStart &&\n\t\tprev.isSelectionMode === next.isSelectionMode &&\n\t\tprev.selectedJobIds === next.selectedJobIds &&\n\t\tprev.jobs === next.jobs // jobs array reference - will be new if positions changed\n\t);\n});\n\nexport function DispatchTimeline() {\n\tconst [mounted, setMounted] = useState(false);\n\tconst [hoverPosition, setHoverPosition] = useState<number | null>(null);\n\tconst [hoverTime, setHoverTime] = useState<string | null>(null);\n\tconst [isJobHovered, setIsJobHovered] = useState(false);\n\tconst [activeJobId, setActiveJobId] = useState<string | null>(null);\n\tconst [dragPreview, setDragPreview] = useState<DragPreview | null>(null);\n\tconst [unassignedPanelOpen, setUnassignedPanelOpen] = useState(false);\n\tconst [unassignedOrder, setUnassignedOrder] = useState<string[]>([]);\n\tconst [commandMenuOpen, setCommandMenuOpen] = useState(false);\n\tconst [commandMenuDate, setCommandMenuDate] = useState<Date | null>(null);\n\tconst [quickCreateTechId, setQuickCreateTechId] = useState<string | null>(null);\n\tconst [showQuickAppointment, setShowQuickAppointment] = useState(false);\n\tconst [quickAppointmentTime, setQuickAppointmentTime] = useState<Date | null>(null);\n\tconst [quickAppointmentDuration, setQuickAppointmentDuration] = useState<number | null>(null);\n\t// Multi-select mode state\n\tconst [isSelectionMode, setIsSelectionMode] = useState(false);\n\tconst [selectedJobIds, setSelectedJobIds] = useState<Set<string>>(new Set());\n\tconst [isBulkActionPending, startBulkTransition] = useTransition();\n\t// Navigation for technician detail page\n\tconst router = useRouter();\n\tconst scrollContainerRef = useRef<HTMLDivElement>(null);\n\tconst timelineRef = useRef<HTMLDivElement>(null);\n\tconst {\n\t\ttechnicians,\n\t\tgetJobsForTechnician,\n\t\tselectJob,\n\t\tselectedJobId,\n\t\tmoveJob,\n\t\tupdateJob,\n\t\tjobs,\n\t\tisLoading,\n\t\terror,\n\t\tunassignedHasMore,\n\t\tunassignedSearch,\n\t\tisLoadingUnassigned,\n\t\tunassignedTotalCount,\n\t\tloadMoreUnassignedJobs,\n\t} = useSchedule();\n\t// Use individual selectors for better performance (prevents re-renders when unrelated state changes)\n\tconst currentDate = useScheduleViewStore((s) => s.currentDate);\n\tconst bufferStartDate = useScheduleViewStore((s) => s.bufferStartDate);\n\tconst bufferEndDate = useScheduleViewStore((s) => s.bufferEndDate);\n\tconst extendBufferLeft = useScheduleViewStore((s) => s.extendBufferLeft);\n\tconst extendBufferRight = useScheduleViewStore((s) => s.extendBufferRight);\n\n\t// Enable real-time updates for schedule changes\n\tconst { isConnected: isRealtimeConnected } = useScheduleRealtime();\n\n\t// Get unassigned jobs\n\tconst unassignedJobs = useMemo(\n\t\t() => jobs.filter((job) => job.isUnassigned),\n\t\t[jobs],\n\t);\n\tconst showUnassignedPanel =\n\t\tunassignedJobs.length > 0 ||\n\t\tunassignedHasMore ||\n\t\tunassignedSearch.length > 0;\n\n\tuseEffect(() => {\n\t\tsetUnassignedOrder((prev) => {\n\t\t\tconst ids = unassignedJobs.map((job) => job.id);\n\t\t\tif (prev.length === 0) {\n\t\t\t\treturn ids;\n\t\t\t}\n\t\t\tconst next = prev.filter((id) => ids.includes(id));\n\t\t\tids.forEach((id) => {\n\t\t\t\tif (!next.includes(id)) {\n\t\t\t\t\tnext.push(id);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn next;\n\t\t});\n\t}, [unassignedJobs]);\n\n\tconst orderedUnassignedJobs = useMemo(() => {\n\t\tif (unassignedOrder.length === 0) {\n\t\t\treturn unassignedJobs;\n\t\t}\n\t\tconst lookup = new Map(unassignedJobs.map((job) => [job.id, job]));\n\t\tconst ordered = unassignedOrder\n\t\t\t.map((id) => lookup.get(id))\n\t\t\t.filter((job): job is Job => Boolean(job));\n\t\tconst remaining = unassignedJobs.filter(\n\t\t\t(job) => !unassignedOrder.includes(job.id),\n\t\t);\n\t\treturn [...ordered, ...remaining];\n\t}, [unassignedJobs, unassignedOrder]);\n\n\tconst handleUnassignedSearch = useCallback(\n\t\t(value: string) => {\n\t\t\tloadMoreUnassignedJobs({ reset: true, search: value });\n\t\t},\n\t\t[loadMoreUnassignedJobs],\n\t);\n\n\tconst handleLoadMoreUnassigned = useCallback(() => {\n\t\tloadMoreUnassignedJobs({ search: unassignedSearch });\n\t}, [loadMoreUnassignedJobs, unassignedSearch]);\n\n\t// Multi-select handlers\n\tconst toggleSelectionMode = useCallback(() => {\n\t\tsetIsSelectionMode((prev) => !prev);\n\t\tif (isSelectionMode) {\n\t\t\t// Clear selection when exiting selection mode\n\t\t\tsetSelectedJobIds(new Set());\n\t\t}\n\t}, [isSelectionMode]);\n\n\tconst toggleJobSelection = useCallback((jobId: string) => {\n\t\tsetSelectedJobIds((prev) => {\n\t\t\tconst next = new Set(prev);\n\t\t\tif (next.has(jobId)) {\n\t\t\t\tnext.delete(jobId);\n\t\t\t} else {\n\t\t\t\tnext.add(jobId);\n\t\t\t}\n\t\t\treturn next;\n\t\t});\n\t}, []);\n\n\tconst selectAllJobs = useCallback(() => {\n\t\tconst allJobIds = jobs\n\t\t\t.filter((job) => !job.isUnassigned)\n\t\t\t.map((job) => job.id);\n\t\tsetSelectedJobIds(new Set(allJobIds));\n\t}, [jobs]);\n\n\tconst clearSelection = useCallback(() => {\n\t\tsetSelectedJobIds(new Set());\n\t}, []);\n\n\t// Bulk action handlers\n\tconst handleBulkDispatch = useCallback(() => {\n\t\tstartBulkTransition(async () => {\n\t\t\tconst jobIds = Array.from(selectedJobIds);\n\t\t\tlet successCount = 0;\n\t\t\tlet errorCount = 0;\n\n\t\t\tfor (const jobId of jobIds) {\n\t\t\t\tconst result = await dispatchAppointment(jobId);\n\t\t\t\tif (result.success) {\n\t\t\t\t\tsuccessCount++;\n\t\t\t\t} else {\n\t\t\t\t\terrorCount++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (successCount > 0) {\n\t\t\t\ttoast.success(`Dispatched ${successCount} job${successCount > 1 ? \"s\" : \"\"}`);\n\t\t\t}\n\t\t\tif (errorCount > 0) {\n\t\t\t\ttoast.error(`Failed to dispatch ${errorCount} job${errorCount > 1 ? \"s\" : \"\"}`);\n\t\t\t}\n\n\t\t\t// Clear selection after bulk action\n\t\t\tsetSelectedJobIds(new Set());\n\t\t\tsetIsSelectionMode(false);\n\t\t});\n\t}, [selectedJobIds]);\n\n\tconst handleBulkComplete = useCallback(() => {\n\t\tstartBulkTransition(async () => {\n\t\t\tconst jobIds = Array.from(selectedJobIds);\n\t\t\tlet successCount = 0;\n\t\t\tlet errorCount = 0;\n\n\t\t\tfor (const jobId of jobIds) {\n\t\t\t\tconst result = await completeAppointment(jobId);\n\t\t\t\tif (result.success) {\n\t\t\t\t\tsuccessCount++;\n\t\t\t\t} else {\n\t\t\t\t\terrorCount++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (successCount > 0) {\n\t\t\t\ttoast.success(`Completed ${successCount} job${successCount > 1 ? \"s\" : \"\"}`);\n\t\t\t}\n\t\t\tif (errorCount > 0) {\n\t\t\t\ttoast.error(`Failed to complete ${errorCount} job${errorCount > 1 ? \"s\" : \"\"}`);\n\t\t\t}\n\n\t\t\t// Clear selection after bulk action\n\t\t\tsetSelectedJobIds(new Set());\n\t\t\tsetIsSelectionMode(false);\n\t\t});\n\t}, [selectedJobIds]);\n\n\t// Configure drag sensors for responsive, smooth dragging\n\tconst mouseSensor = useSensor(MouseSensor, {\n\t\tactivationConstraint: {\n\t\t\tdistance: 3, // Reduced from 5px for faster drag activation\n\t\t},\n\t});\n\tconst touchSensor = useSensor(TouchSensor, {\n\t\tactivationConstraint: {\n\t\t\tdelay: 150, // Short delay for touch to distinguish from scroll\n\t\t\ttolerance: 5, // Small movement tolerance during delay\n\t\t},\n\t});\n\tconst sensors = useSensors(mouseSensor, touchSensor);\n\n\tuseEffect(() => {\n\t\tif (!showUnassignedPanel && unassignedPanelOpen) {\n\t\t\tsetUnassignedPanelOpen(false);\n\t\t}\n\t}, [showUnassignedPanel, unassignedPanelOpen]);\n\n\tconst dateObj = useMemo(\n\t\t() => (currentDate instanceof Date ? currentDate : new Date(currentDate)),\n\t\t[currentDate],\n\t);\n\n\t// Convert buffer dates to Date objects\n\tconst bufferStart = useMemo(\n\t\t() => (bufferStartDate instanceof Date ? bufferStartDate : new Date(bufferStartDate)),\n\t\t[bufferStartDate],\n\t);\n\tconst bufferEnd = useMemo(\n\t\t() => (bufferEndDate instanceof Date ? bufferEndDate : new Date(bufferEndDate)),\n\t\t[bufferEndDate],\n\t);\n\n\t// Generate hourly slots for the entire buffer range (enables infinite scroll)\n\t// PERFORMANCE: Pre-calculate timestamps, lazy Date creation in render\n\tconst hourlySlotData = useMemo(() => {\n\t\tconst startTime = new Date(bufferStart);\n\t\tstartTime.setHours(0, 0, 0, 0);\n\t\tconst startTs = startTime.getTime();\n\n\t\tconst endTime = new Date(bufferEnd);\n\t\tendTime.setHours(23, 59, 59, 999);\n\t\tconst endTs = endTime.getTime();\n\n\t\t// Calculate total hours and store as timestamps (faster than Date objects)\n\t\tconst totalHours = Math.ceil((endTs - startTs) / (1000 * 60 * 60));\n\t\tconst hourMs = 1000 * 60 * 60;\n\n\t\t// Return metadata instead of array of Dates (reduces memory + GC)\n\t\treturn {\n\t\t\tstartTs,\n\t\t\ttotalHours,\n\t\t\thourMs,\n\t\t\t// Helper to get Date for a specific index (created on-demand)\n\t\t\tgetSlot: (index: number) => new Date(startTs + index * hourMs),\n\t\t};\n\t}, [bufferStart, bufferEnd]);\n\n\t// For compatibility with existing code, create slots array lazily\n\tconst hourlySlots = useMemo(() => {\n\t\tconst slots: Date[] = [];\n\t\tfor (let i = 0; i < hourlySlotData.totalHours; i++) {\n\t\t\tslots.push(hourlySlotData.getSlot(i));\n\t\t}\n\t\treturn slots;\n\t}, [hourlySlotData]);\n\n\tconst timeRange = useMemo(() => {\n\t\tconst start = hourlySlots[0] ?? new Date(bufferStart);\n\t\tconst lastSlot = hourlySlots.at(-1);\n\t\tconst end = lastSlot ? new Date(lastSlot) : new Date(bufferEnd);\n\t\tend.setHours(end.getHours(), 59, 59, 999);\n\t\treturn { start, end };\n\t}, [hourlySlots, bufferStart, bufferEnd]);\n\n\t// PERFORMANCE: Use pre-calculated totalHours instead of array length\n\tconst totalWidth = hourlySlotData.totalHours * HOUR_WIDTH;\n\n\t// Calculate pixel offset for the current date within the buffer\n\tconst currentDateOffset = useMemo(() => {\n\t\tconst currentDayStart = new Date(dateObj);\n\t\tcurrentDayStart.setHours(0, 0, 0, 0);\n\t\tconst bufferStartTime = new Date(bufferStart);\n\t\tbufferStartTime.setHours(0, 0, 0, 0);\n\t\tconst hoursOffset = (currentDayStart.getTime() - bufferStartTime.getTime()) / (1000 * 60 * 60);\n\t\treturn hoursOffset * HOUR_WIDTH;\n\t}, [dateObj, bufferStart]);\n\n\tconst currentTimePosition = useMemo(() => {\n\t\tconst now = new Date();\n\t\t// Check if current time is within the buffer range\n\t\tif (now < timeRange.start || now > timeRange.end) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Calculate position based on minutes from buffer start\n\t\tconst totalMinutes =\n\t\t\t(timeRange.end.getTime() - timeRange.start.getTime()) / (1000 * 60);\n\t\tconst currentMinutes =\n\t\t\t(now.getTime() - timeRange.start.getTime()) / (1000 * 60);\n\t\treturn (currentMinutes / totalMinutes) * totalWidth;\n\t}, [timeRange, totalWidth]);\n\n\tconst technicianLanes = useMemo(() => {\n\t\tconst lanes = technicians.map((tech) => {\n\t\t\tconst allJobs = getJobsForTechnician(tech.id);\n\t\t\tconst jobs = allJobs.filter((job) => {\n\t\t\t\tconst jobStart =\n\t\t\t\t\tjob.startTime instanceof Date\n\t\t\t\t\t\t? job.startTime\n\t\t\t\t\t\t: new Date(job.startTime);\n\t\t\t\tconst jobEnd =\n\t\t\t\t\tjob.endTime instanceof Date ? job.endTime : new Date(job.endTime);\n\t\t\t\treturn jobStart <= timeRange.end && jobEnd >= timeRange.start;\n\t\t\t});\n\n\t\t\tconst jobPositions = jobs.map((job) => {\n\t\t\t\tconst jobStart =\n\t\t\t\t\tjob.startTime instanceof Date\n\t\t\t\t\t\t? job.startTime\n\t\t\t\t\t\t: new Date(job.startTime);\n\t\t\t\tconst jobEnd =\n\t\t\t\t\tjob.endTime instanceof Date ? job.endTime : new Date(job.endTime);\n\n\t\t\t\tconst startMinutes =\n\t\t\t\t\t(jobStart.getTime() - timeRange.start.getTime()) / (1000 * 60);\n\t\t\t\tconst endMinutes =\n\t\t\t\t\t(jobEnd.getTime() - timeRange.start.getTime()) / (1000 * 60);\n\t\t\t\tconst durationMinutes = endMinutes - startMinutes;\n\n\t\t\t\tconst left = (startMinutes / 60) * HOUR_WIDTH;\n\t\t\t\tconst width = Math.max(60, (durationMinutes / 60) * HOUR_WIDTH);\n\n\t\t\t\treturn { job, left, width };\n\t\t\t});\n\n\t\t\tconst positionedJobs = detectOverlaps(jobPositions);\n\t\t\tconst maxLane = Math.max(0, ...positionedJobs.map((p) => p.lane));\n\t\t\t// Calculate lane height to accommodate all stacked jobs\n\t\t\tconst laneHeight = Math.max(\n\t\t\t\tLANE_HEIGHT,\n\t\t\t\t(maxLane + 1) * (JOB_HEIGHT + STACK_GAP) + STACK_GAP * 2,\n\t\t\t);\n\n\t\t\treturn {\n\t\t\t\ttechnician: tech,\n\t\t\t\tjobs: positionedJobs,\n\t\t\t\theight: laneHeight,\n\t\t\t};\n\t\t});\n\n\t\treturn lanes;\n\t}, [technicians, getJobsForTechnician, timeRange]);\n\n\t// Calculate total conflicts across all lanes\n\tconst conflictCount = useMemo(() => {\n\t\treturn technicianLanes.reduce((count, lane) => {\n\t\t\treturn count + lane.jobs.filter((j) => j.hasOverlap).length;\n\t\t}, 0);\n\t}, [technicianLanes]);\n\n\t// Calculate team workload summary\n\tconst teamWorkloadSummary = useMemo(() => {\n\t\tconst WORK_DAY_MINUTES = 8 * 60;\n\t\tlet totalJobs = 0;\n\t\tlet totalMinutes = 0;\n\t\tlet availableTechs = 0;\n\t\tlet busyTechs = 0;\n\n\t\ttechnicianLanes.forEach(({ jobs }) => {\n\t\t\ttotalJobs += jobs.length;\n\t\t\tconst techMinutes = jobs.reduce((acc, { job }) => {\n\t\t\t\tconst start =\n\t\t\t\t\tjob.startTime instanceof Date\n\t\t\t\t\t\t? job.startTime\n\t\t\t\t\t\t: new Date(job.startTime);\n\t\t\t\tconst end =\n\t\t\t\t\tjob.endTime instanceof Date ? job.endTime : new Date(job.endTime);\n\t\t\t\treturn acc + (end.getTime() - start.getTime()) / (1000 * 60);\n\t\t\t}, 0);\n\t\t\ttotalMinutes += techMinutes;\n\t\t\tif (techMinutes > 0) {\n\t\t\t\tbusyTechs++;\n\t\t\t} else {\n\t\t\t\tavailableTechs++;\n\t\t\t}\n\t\t});\n\n\t\tconst avgUtilization =\n\t\t\ttechnicianLanes.length > 0\n\t\t\t\t? Math.round(\n\t\t\t\t\t\t(totalMinutes / (technicianLanes.length * WORK_DAY_MINUTES)) * 100,\n\t\t\t\t\t)\n\t\t\t\t: 0;\n\n\t\treturn {\n\t\t\ttotalJobs,\n\t\t\ttotalHours: Math.round(totalMinutes / 60),\n\t\t\tavgUtilization,\n\t\t\tavailableTechs,\n\t\t\tbusyTechs,\n\t\t\ttotalTechs: technicianLanes.length,\n\t\t};\n\t}, [technicianLanes]);\n\n\t// Calculate total height needed for sidebar to match all lanes\n\tconst totalContentHeight = useMemo(() => {\n\t\t// h-11 = 2.75rem = 44px\n\t\tconst headerHeight = 44;\n\t\tconst lanesHeight = technicianLanes.reduce(\n\t\t\t(sum, lane) => sum + lane.height,\n\t\t\t0,\n\t\t);\n\t\treturn headerHeight + lanesHeight;\n\t}, [technicianLanes]);\n\n\t// Track resize state to accumulate changes\n\tconst resizeStateRef = useRef<{\n\t\tjobId: string;\n\t\toriginalStart: Date;\n\t\toriginalEnd: Date;\n\t} | null>(null);\n\n\t// Performance: Keep ref to technicianLanes to avoid callback recreation\n\tconst technicianLanesRef = useRef(technicianLanes);\n\ttechnicianLanesRef.current = technicianLanes;\n\n\t// Use the optimized drag hook - separates move vs create operations\n\t// and uses batched server calls for performance\n\tconst {\n\t\thandleDragStart,\n\t\thandleDragMove,\n\t\thandleDragEnd,\n\t\thandleDragCancel,\n\t\tdragPointerRef,\n\t\trafIdRef,\n\t\tpendingDragMoveRef,\n\t\tdragJobCacheRef,\n\t\tlastDragPreviewRef,\n\t} = useScheduleDrag({\n\t\ttechnicians,\n\t\tunassignedJobs,\n\t\ttechnicianLanes: technicianLanes.map((lane) => ({\n\t\t\ttechnicianId: lane.technician.id,\n\t\t\tjobs: lane.jobs,\n\t\t})),\n\t\ttimeRange,\n\t\ttotalWidth,\n\t\ttimelineRef,\n\t\tsetUnassignedOrder,\n\t\tsetActiveJobId,\n\t\tsetDragPreview,\n\t});\n\n\tconst handleResize = useCallback(\n\t\t(jobId: string, direction: \"start\" | \"end\", deltaMinutes: number) => {\n\t\t\tif (!resizeStateRef.current || resizeStateRef.current.jobId !== jobId) {\n\t\t\t\tconst jobData = technicianLanesRef.current\n\t\t\t\t\t.flatMap((lane) => lane.jobs)\n\t\t\t\t\t.find((j) => j.job.id === jobId);\n\t\t\t\tif (!jobData) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst job = jobData.job;\n\t\t\t\tresizeStateRef.current = {\n\t\t\t\t\tjobId,\n\t\t\t\t\toriginalStart:\n\t\t\t\t\t\tjob.startTime instanceof Date\n\t\t\t\t\t\t\t? job.startTime\n\t\t\t\t\t\t\t: new Date(job.startTime),\n\t\t\t\t\toriginalEnd:\n\t\t\t\t\t\tjob.endTime instanceof Date ? job.endTime : new Date(job.endTime),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst state = resizeStateRef.current;\n\t\t\tif (!state) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { originalStart, originalEnd } = state;\n\n\t\t\tlet newStart = originalStart;\n\t\t\tlet newEnd = originalEnd;\n\n\t\t\tif (direction === \"start\") {\n\t\t\t\tnewStart = new Date(originalStart.getTime() + deltaMinutes * 60 * 1000);\n\t\t\t\tif (newStart >= originalEnd) {\n\t\t\t\t\tnewStart = new Date(originalEnd.getTime() - 15 * 60 * 1000);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tnewEnd = new Date(originalEnd.getTime() + deltaMinutes * 60 * 1000);\n\t\t\t\tif (newEnd <= originalStart) {\n\t\t\t\t\tnewEnd = new Date(originalStart.getTime() + 15 * 60 * 1000);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst currentTechId =\n\t\t\t\ttechnicianLanesRef.current.find((lane) =>\n\t\t\t\t\tlane.jobs.some((j) => j.job.id === jobId),\n\t\t\t\t)?.technician.id || \"\";\n\n\t\t\tmoveJob(jobId, currentTechId, newStart, newEnd);\n\t\t},\n\t\t[moveJob],\n\t);\n\n\t// Finalize resize and update database\n\tconst finalizeResize = useCallback(\n\t\tasync (jobId: string, hasChanges: boolean) => {\n\t\t\tif (!resizeStateRef.current || resizeStateRef.current.jobId !== jobId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!hasChanges) {\n\t\t\t\tresizeStateRef.current = null;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst jobData = technicianLanesRef.current\n\t\t\t\t.flatMap((lane) => lane.jobs)\n\t\t\t\t.find((j) => j.job.id === jobId);\n\n\t\t\tif (!jobData) {\n\t\t\t\tresizeStateRef.current = null;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst job = jobData.job;\n\t\t\tconst newStart =\n\t\t\t\tjob.startTime instanceof Date ? job.startTime : new Date(job.startTime);\n\t\t\tconst newEnd =\n\t\t\t\tjob.endTime instanceof Date ? job.endTime : new Date(job.endTime);\n\n\t\t\t// Update in database\n\t\t\tconst toastId = toast.loading(\"Saving appointment time...\");\n\t\t\tconst result = await updateAppointmentTimes(jobId, newStart, newEnd);\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\n\t\t\t\t\t`Updated to ${format(newStart, \"h:mm a\")} - ${format(newEnd, \"h:mm a\")}`,\n\t\t\t\t\t{\n\t\t\t\t\t\tid: toastId,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to update times\", { id: toastId });\n\t\t\t}\n\n\t\t\tresizeStateRef.current = null;\n\t\t},\n\t\t[],\n\t);\n\n\tconst adjustJobTime = useCallback(\n\t\tasync (jobId: string, deltaMinutes: number) => {\n\t\t\tif (deltaMinutes === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst jobData = technicianLanes\n\t\t\t\t.flatMap((lane) => lane.jobs)\n\t\t\t\t.find((j) => j.job.id === jobId);\n\n\t\t\tif (!jobData) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst job = jobData.job;\n\t\t\tconst currentTechId = job.technicianId;\n\t\t\tconst start =\n\t\t\t\tjob.startTime instanceof Date ? job.startTime : new Date(job.startTime);\n\t\t\tconst end =\n\t\t\t\tjob.endTime instanceof Date ? job.endTime : new Date(job.endTime);\n\n\t\t\tconst newStart = new Date(start.getTime() + deltaMinutes * 60 * 1000);\n\t\t\tconst newEnd = new Date(end.getTime() + deltaMinutes * 60 * 1000);\n\n\t\t\tmoveJob(jobId, currentTechId, newStart, newEnd);\n\n\t\t\tconst toastId = toast.loading(`Moving to ${format(newStart, \"h:mm a\")}…`);\n\t\t\tconst result = await updateAppointmentTimes(jobId, newStart, newEnd);\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\n\t\t\t\t\t`Updated to ${format(newStart, \"h:mm a\")} - ${format(newEnd, \"h:mm a\")}`,\n\t\t\t\t\t{\n\t\t\t\t\t\tid: toastId,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to update times\", { id: toastId });\n\t\t\t}\n\t\t},\n\t\t[technicianLanes, moveJob],\n\t);\n\n\tconst nudgeJobTechnician = useCallback(\n\t\tasync (jobId: string, direction: -1 | 1) => {\n\t\t\tconst jobData = technicianLanes\n\t\t\t\t.flatMap((lane) => lane.jobs)\n\t\t\t\t.find((j) => j.job.id === jobId);\n\t\t\tif (!jobData) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst job = jobData.job;\n\t\t\tconst currentIndex = technicians.findIndex(\n\t\t\t\t(tech) => tech.id === job.technicianId,\n\t\t\t);\n\t\t\tif (currentIndex === -1) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst targetTech = technicians[currentIndex + direction];\n\t\t\tif (!targetTech) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst start =\n\t\t\t\tjob.startTime instanceof Date ? job.startTime : new Date(job.startTime);\n\t\t\tconst end =\n\t\t\t\tjob.endTime instanceof Date ? job.endTime : new Date(job.endTime);\n\n\t\t\tmoveJob(jobId, targetTech.id, start, end);\n\n\t\t\tconst toastId = toast.loading(`Assigning to ${targetTech.name}…`);\n\t\t\tconst result = await assignJobToTechnician(jobId, jobId, targetTech.id);\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(`Assigned to ${targetTech.name}`, { id: toastId });\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to assign job\", { id: toastId });\n\t\t\t}\n\t\t},\n\t\t[technicianLanes, technicians, moveJob],\n\t);\n\n\tuseEffect(() => {\n\t\tif (!activeJobId) {\n\t\t\treturn;\n\t\t}\n\t\tconst handlePointerMove = (event: PointerEvent) => {\n\t\t\tdragPointerRef.current = { x: event.clientX, y: event.clientY };\n\t\t};\n\t\twindow.addEventListener(\"pointermove\", handlePointerMove, {\n\t\t\tpassive: true,\n\t\t});\n\t\treturn () => window.removeEventListener(\"pointermove\", handlePointerMove);\n\t}, [activeJobId]);\n\n\t// Auto-scroll during drag with smooth exponential acceleration\n\tuseEffect(() => {\n\t\tif (!activeJobId) {\n\t\t\treturn;\n\t\t}\n\t\tconst container = scrollContainerRef.current;\n\t\tif (!container) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet frame: number;\n\t\tlet lastExtendCheck = 0;\n\n\t\t// Calculate scroll speed with exponential easing for smooth acceleration\n\t\tconst calcScrollSpeed = (distanceFromEdge: number): number => {\n\t\t\tif (distanceFromEdge >= AUTO_SCROLL_EDGE) return 0;\n\n\t\t\t// Normalize distance (0 = at edge, 1 = at threshold)\n\t\t\tconst normalized = distanceFromEdge / AUTO_SCROLL_EDGE;\n\t\t\t// Exponential ease-in: faster as you get closer to edge\n\t\t\tconst eased = Math.pow(1 - normalized, AUTO_SCROLL_ACCELERATION);\n\t\t\t// Scale to speed range\n\t\t\treturn AUTO_SCROLL_MIN_SPEED + eased * (AUTO_SCROLL_MAX_SPEED - AUTO_SCROLL_MIN_SPEED);\n\t\t};\n\n\t\tconst tick = () => {\n\t\t\tconst pointer = dragPointerRef.current;\n\t\t\tconst rect = container.getBoundingClientRect();\n\t\t\tlet deltaX = 0;\n\n\t\t\tconst distanceFromLeft = pointer.x - rect.left;\n\t\t\tconst distanceFromRight = rect.right - pointer.x;\n\n\t\t\t// Horizontal auto-scroll\n\t\t\tif (distanceFromLeft < AUTO_SCROLL_EDGE) {\n\t\t\t\tdeltaX = -calcScrollSpeed(distanceFromLeft);\n\t\t\t} else if (distanceFromRight < AUTO_SCROLL_EDGE) {\n\t\t\t\tdeltaX = calcScrollSpeed(distanceFromRight);\n\t\t\t}\n\n\t\t\tif (deltaX !== 0) {\n\t\t\t\tcontainer.scrollLeft += deltaX;\n\n\t\t\t\t// Trigger infinite scroll extension while dragging (throttled)\n\t\t\t\tconst now = Date.now();\n\t\t\t\tif (now - lastExtendCheck > 300) {\n\t\t\t\t\tlastExtendCheck = now;\n\t\t\t\t\tconst { scrollLeft, scrollWidth, clientWidth } = container;\n\t\t\t\t\tconst scrollRight = scrollWidth - scrollLeft - clientWidth;\n\n\t\t\t\t\tif (scrollLeft < 300 && deltaX < 0) {\n\t\t\t\t\t\textendBufferLeft();\n\t\t\t\t\t} else if (scrollRight < 300 && deltaX > 0) {\n\t\t\t\t\t\textendBufferRight();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Vertical auto-scroll for technician lanes\n\t\t\tconst timelineArea = timelineRef.current;\n\t\t\tif (timelineArea) {\n\t\t\t\tconst timelineRect = timelineArea.getBoundingClientRect();\n\t\t\t\tlet deltaY = 0;\n\n\t\t\t\tconst distanceFromTop = pointer.y - timelineRect.top;\n\t\t\t\tconst distanceFromBottom = timelineRect.bottom - pointer.y;\n\n\t\t\t\tif (distanceFromTop < AUTO_SCROLL_EDGE) {\n\t\t\t\t\tdeltaY = -calcScrollSpeed(distanceFromTop);\n\t\t\t\t} else if (distanceFromBottom < AUTO_SCROLL_EDGE) {\n\t\t\t\t\tdeltaY = calcScrollSpeed(distanceFromBottom);\n\t\t\t\t}\n\n\t\t\t\tif (deltaY !== 0) {\n\t\t\t\t\ttimelineArea.scrollTop += deltaY;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tframe = requestAnimationFrame(tick);\n\t\t};\n\n\t\tframe = requestAnimationFrame(tick);\n\t\treturn () => cancelAnimationFrame(frame);\n\t}, [activeJobId, extendBufferLeft, extendBufferRight]);\n\n\t// Handle mouse move to show hover time indicator (hide when hovering over jobs)\n\tconst handleMouseMove = useCallback(\n\t\t(e: React.MouseEvent<HTMLDivElement>) => {\n\t\t\tif (!timelineRef.current || isJobHovered) {\n\t\t\t\tsetHoverPosition(null);\n\t\t\t\tsetHoverTime(null);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst rect = timelineRef.current.getBoundingClientRect();\n\t\t\tconst x = e.clientX - rect.left;\n\n\t\t\tif (x < 0 || x > totalWidth) {\n\t\t\t\tsetHoverPosition(null);\n\t\t\t\tsetHoverTime(null);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Calculate time at cursor position\n\t\t\tconst minutesFromStart = (x / totalWidth) * (24 * 60);\n\t\t\tconst hoverDate = new Date(timeRange.start);\n\t\t\thoverDate.setMinutes(hoverDate.getMinutes() + minutesFromStart);\n\n\t\t\tsetHoverPosition(x);\n\t\t\tsetHoverTime(format(hoverDate, \"h:mm a\"));\n\t\t},\n\t\t[totalWidth, timeRange, isJobHovered],\n\t);\n\n\tconst handleMouseLeave = useCallback(() => {\n\t\tsetHoverPosition(null);\n\t\tsetHoverTime(null);\n\t}, []);\n\n\tconst activeJob = useMemo(() => {\n\t\tif (!activeJobId) {\n\t\t\treturn null;\n\t\t}\n\t\treturn technicianLanes\n\t\t\t.flatMap((lane) => lane.jobs)\n\t\t\t.find((j) => j.job.id === activeJobId)?.job;\n\t}, [activeJobId, technicianLanes]);\n\n\tuseEffect(() => {\n\t\tsetMounted(true);\n\t}, []);\n\n\tuseEffect(() => {\n\t\tconst handleKeyDown = (event: KeyboardEvent) => {\n\t\t\tif (!selectedJobId) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst target = event.target as HTMLElement | null;\n\t\t\tif (target && [\"INPUT\", \"TEXTAREA\", \"SELECT\"].includes(target.tagName)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (event.key === \"ArrowRight\" || event.key === \"ArrowLeft\") {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst delta =\n\t\t\t\t\t(event.shiftKey ? LARGE_SNAP_MINUTES : SNAP_INTERVAL_MINUTES) *\n\t\t\t\t\t(event.key === \"ArrowRight\" ? 1 : -1);\n\t\t\t\tvoid adjustJobTime(selectedJobId, delta);\n\t\t\t} else if (event.key === \"ArrowUp\" || event.key === \"ArrowDown\") {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tvoid nudgeJobTechnician(\n\t\t\t\t\tselectedJobId,\n\t\t\t\t\tevent.key === \"ArrowUp\" ? -1 : 1,\n\t\t\t\t);\n\t\t\t}\n\t\t};\n\n\t\twindow.addEventListener(\"keydown\", handleKeyDown);\n\t\treturn () => window.removeEventListener(\"keydown\", handleKeyDown);\n\t}, [selectedJobId, adjustJobTime, nudgeJobTechnician]);\n\n\t// Scroll to current time/date on mount and when current date changes\n\tconst hasInitialScrolled = useRef(false);\n\tuseEffect(() => {\n\t\tif (scrollContainerRef.current) {\n\t\t\tconst container = scrollContainerRef.current;\n\t\t\t// On initial load or date change, scroll to center the current date\n\t\t\tif (!hasInitialScrolled.current || currentTimePosition !== null) {\n\t\t\t\tconst targetPosition = currentTimePosition !== null\n\t\t\t\t\t? currentTimePosition\n\t\t\t\t\t: currentDateOffset + (container.clientWidth / 4); // Center on current day\n\t\t\t\tcontainer.scrollLeft = Math.max(0, targetPosition - container.clientWidth / 2);\n\t\t\t\thasInitialScrolled.current = true;\n\t\t\t}\n\t\t}\n\t}, [currentTimePosition, currentDateOffset]);\n\n\t// Infinite scroll: Extend buffer when scrolling near edges\n\t// PERFORMANCE: Higher threshold + throttling reduces state updates\n\tconst SCROLL_EDGE_THRESHOLD = 400; // pixels from edge to trigger buffer extension\n\tconst SCROLL_THROTTLE_MS = 150; // minimum ms between scroll checks\n\tconst isExtendingBuffer = useRef(false);\n\tconst lastScrollCheck = useRef(0);\n\n\tconst handleInfiniteScroll = useCallback(() => {\n\t\tconst container = scrollContainerRef.current;\n\t\tif (!container || isExtendingBuffer.current) return;\n\n\t\t// Throttle scroll checks for performance\n\t\tconst now = Date.now();\n\t\tif (now - lastScrollCheck.current < SCROLL_THROTTLE_MS) return;\n\t\tlastScrollCheck.current = now;\n\n\t\tconst { scrollLeft, scrollWidth, clientWidth } = container;\n\t\tconst scrollRight = scrollWidth - scrollLeft - clientWidth;\n\n\t\t// Check if near left edge (scrolling into the past)\n\t\tif (scrollLeft < SCROLL_EDGE_THRESHOLD) {\n\t\t\tisExtendingBuffer.current = true;\n\t\t\t// Store current scroll position relative to content\n\t\t\tconst previousScrollWidth = scrollWidth;\n\t\t\textendBufferLeft();\n\t\t\t// After state update, adjust scroll to maintain position\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t// Double RAF ensures DOM has updated\n\t\t\t\t\tif (scrollContainerRef.current) {\n\t\t\t\t\t\tconst newScrollWidth = scrollContainerRef.current.scrollWidth;\n\t\t\t\t\t\tconst addedWidth = newScrollWidth - previousScrollWidth;\n\t\t\t\t\t\tscrollContainerRef.current.scrollLeft = scrollLeft + addedWidth;\n\t\t\t\t\t}\n\t\t\t\t\tisExtendingBuffer.current = false;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\t// Check if near right edge (scrolling into the future)\n\t\telse if (scrollRight < SCROLL_EDGE_THRESHOLD) {\n\t\t\tisExtendingBuffer.current = true;\n\t\t\textendBufferRight();\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tisExtendingBuffer.current = false;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}, [extendBufferLeft, extendBufferRight]);\n\n\t// Attach scroll listener for infinite scroll (passive for performance)\n\tuseEffect(() => {\n\t\tconst container = scrollContainerRef.current;\n\t\tif (!container) return;\n\n\t\tcontainer.addEventListener(\"scroll\", handleInfiniteScroll, { passive: true });\n\t\treturn () => container.removeEventListener(\"scroll\", handleInfiniteScroll);\n\t}, [handleInfiniteScroll]);\n\n\t// Command menu keyboard shortcut (Cmd+K)\n\tuseEffect(() => {\n\t\tconst handleKeyDown = (e: KeyboardEvent) => {\n\t\t\tif (e.key === \"k\" && (e.metaKey || e.ctrlKey)) {\n\t\t\t\te.preventDefault();\n\t\t\t\tsetCommandMenuDate(dateObj);\n\t\t\t\tsetCommandMenuOpen(true);\n\t\t\t}\n\t\t};\n\n\t\twindow.addEventListener(\"keydown\", handleKeyDown);\n\t\treturn () => window.removeEventListener(\"keydown\", handleKeyDown);\n\t}, [dateObj]);\n\n\t// Right-click handler for timeline\n\tconst handleTimelineContextMenu = useCallback(\n\t\t(e: React.MouseEvent) => {\n\t\t\te.preventDefault();\n\t\t\tsetCommandMenuDate(dateObj);\n\t\t\tsetCommandMenuOpen(true);\n\t\t},\n\t\t[dateObj],\n\t);\n\n\t// Handle double-click on timeline to create new job\n\tconst handleLaneDoubleClick = useCallback(\n\t\t(technicianId: string, startTime: Date) => {\n\t\t\tsetQuickCreateTechId(technicianId);\n\t\t\tsetQuickAppointmentTime(startTime);\n\t\t\tsetQuickAppointmentDuration(null); // Use default duration\n\t\t\tsetShowQuickAppointment(true);\n\t\t},\n\t\t[],\n\t);\n\n\t// Handle drag-to-create on timeline\n\tconst handleLaneDragCreate = useCallback(\n\t\t(technicianId: string, startTime: Date, durationMinutes: number) => {\n\t\t\tconsole.log(\"[DEBUG] handleLaneDragCreate called:\", { technicianId, startTime, durationMinutes });\n\t\t\tsetQuickCreateTechId(technicianId);\n\t\t\tsetQuickAppointmentTime(startTime);\n\t\t\tsetQuickAppointmentDuration(durationMinutes);\n\t\t\tsetShowQuickAppointment(true);\n\t\t\tconsole.log(\"[DEBUG] showQuickAppointment set to true\");\n\t\t},\n\t\t[],\n\t);\n\n\t// Transform technicians to options format for dialog\n\tconst technicianOptions: TechnicianOption[] = useMemo(\n\t\t() =>\n\t\t\ttechnicians.map((tech) => ({\n\t\t\t\tid: tech.id,\n\t\t\t\tname: tech.name,\n\t\t\t\tavatar: tech.avatar,\n\t\t\t})),\n\t\t[technicians]\n\t);\n\n\tif (!mounted || isLoading) {\n\t\t// Conditional returns AFTER all hooks\n\t\treturn (\n\t\t\t<div className=\"flex h-full w-full items-center justify-center\">\n\t\t\t\t<div className=\"text-muted-foreground\">Loading schedule...</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tif (error) {\n\t\treturn (\n\t\t\t<div className=\"flex h-full w-full items-center justify-center\">\n\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t<p className=\"text-destructive mb-2\">Error loading schedule</p>\n\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">{error}</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<DndContext\n\t\t\tautoScroll={false} // Disabled - using custom smooth auto-scroll implementation\n\t\t\tcollisionDetection={pointerWithin} // More accurate for horizontal timeline drop zones\n\t\t\tonDragCancel={handleDragCancel}\n\t\t\tonDragEnd={handleDragEnd}\n\t\t\tonDragMove={handleDragMove}\n\t\t\tonDragStart={handleDragStart}\n\t\t\tsensors={sensors}\n\t\t>\n\t\t\t<div className=\"bg-background m-0 flex h-full w-full overflow-hidden p-0\">\n\t\t\t\t{/* Unassigned Panel */}\n\t\t\t\t{showUnassignedPanel && (\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"h-full shrink-0\"\n\t\t\t\t\t\tstyle={{ width: unassignedPanelOpen ? \"320px\" : \"48px\" }}\n\t\t\t\t\t>\n\t\t\t\t\t\t<UnassignedPanel\n\t\t\t\t\t\t\tactiveJobId={activeJobId}\n\t\t\t\t\t\t\tdropId={DRAG_UNASSIGNED_DROP_ID}\n\t\t\t\t\t\t\tisOpen={unassignedPanelOpen}\n\t\t\t\t\t\t\tonToggle={() => setUnassignedPanelOpen(!unassignedPanelOpen)}\n\t\t\t\t\t\t\tonSearchChange={handleUnassignedSearch}\n\t\t\t\t\t\t\tonLoadMore={handleLoadMoreUnassigned}\n\t\t\t\t\t\t\tunassignedJobs={orderedUnassignedJobs}\n\t\t\t\t\t\t\thasMore={unassignedHasMore}\n\t\t\t\t\t\t\tisLoadingMore={isLoadingUnassigned}\n\t\t\t\t\t\t\ttotalCount={unassignedTotalCount}\n\t\t\t\t\t\t\tsearchQuery={unassignedSearch}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\n\t\t\t\t{/* Timeline */}\n\t\t\t\t<div className=\"flex flex-1 flex-col overflow-hidden\">\n\n\t\t\t\t\t{/* Single scroll container */}\n\t\t\t\t\t<div className=\"flex flex-1 overflow-auto\" ref={scrollContainerRef}>\n\t\t\t\t\t\t{/* Team Sidebar - Sticky */}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"bg-card sticky left-0 z-35 flex shrink-0 flex-col border-r\"\n\t\t\t\t\t\t\tstyle={{ width: SIDEBAR_WIDTH, minHeight: totalContentHeight }}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{/* Team Header with Summary - Sticky */}\n\t\t\t\t\t\t\t<div className=\"bg-muted sticky top-0 z-40 h-11 shrink-0 border-b\">\n\t\t\t\t\t\t\t\t<div className=\"flex h-full items-center justify-between px-4\">\n\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs font-semibold tracking-wide uppercase\">\n\t\t\t\t\t\t\t\t\t\tTeam\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t{/* Real-time connection indicator */}\n\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"size-2 rounded-full\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tisRealtimeConnected\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-green-500 animate-pulse\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-slate-400\",\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t<TooltipContent side=\"right\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{isRealtimeConnected\n\t\t\t\t\t\t\t\t\t\t\t\t? \"Live updates active\"\n\t\t\t\t\t\t\t\t\t\t\t\t: \"Connecting to live updates...\"}\n\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Team Members */}\n\t\t\t\t\t\t\t{technicianLanes.map(({ technician, jobs, height }) => {\n\t\t\t\t\t\t\t\tconst isApprentice = technician.role\n\t\t\t\t\t\t\t\t\t?.toLowerCase()\n\t\t\t\t\t\t\t\t\t.includes(\"apprentice\");\n\t\t\t\t\t\t\t\tconst hasJobs = jobs.length > 0;\n\n\t\t\t\t\t\t\t\t// Calculate utilization (assuming 8 hour workday: 8am-5pm = 9 hours with lunch)\n\t\t\t\t\t\t\t\tconst WORK_DAY_MINUTES = 8 * 60; // 8 hours\n\t\t\t\t\t\t\t\tconst totalScheduledMinutes = jobs.reduce((acc, jobWithPos) => {\n\t\t\t\t\t\t\t\t\tconst start =\n\t\t\t\t\t\t\t\t\t\tjobWithPos.job.startTime instanceof Date\n\t\t\t\t\t\t\t\t\t\t\t? jobWithPos.job.startTime\n\t\t\t\t\t\t\t\t\t\t\t: new Date(jobWithPos.job.startTime);\n\t\t\t\t\t\t\t\t\tconst end =\n\t\t\t\t\t\t\t\t\t\tjobWithPos.job.endTime instanceof Date\n\t\t\t\t\t\t\t\t\t\t\t? jobWithPos.job.endTime\n\t\t\t\t\t\t\t\t\t\t\t: new Date(jobWithPos.job.endTime);\n\t\t\t\t\t\t\t\t\treturn acc + (end.getTime() - start.getTime()) / (1000 * 60);\n\t\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t\t\tconst utilizationPercent = Math.min(\n\t\t\t\t\t\t\t\t\t100,\n\t\t\t\t\t\t\t\t\tMath.round((totalScheduledMinutes / WORK_DAY_MINUTES) * 100),\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t// Color based on utilization\n\t\t\t\t\t\t\t\tconst utilizationColor =\n\t\t\t\t\t\t\t\t\tutilizationPercent === 0\n\t\t\t\t\t\t\t\t\t\t? \"bg-slate-200 dark:bg-slate-700\"\n\t\t\t\t\t\t\t\t\t\t: utilizationPercent < 50\n\t\t\t\t\t\t\t\t\t\t\t? \"bg-emerald-500\"\n\t\t\t\t\t\t\t\t\t\t\t: utilizationPercent < 80\n\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-amber-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-red-500\";\n\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<Tooltip key={technician.id}>\n\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex cursor-pointer items-center border-b px-3 hover:bg-primary/5 active:bg-primary/10 transition-colors\"\n\t\t\t\t\t\t\t\t\t\t\t\tstyle={{ height, minHeight: height, maxHeight: height }}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => router.push(`/dashboard/schedule/technician/${technician.id}`)}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex w-full items-center gap-2.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Avatar className=\"size-9\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarFallback\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"text-xs font-semibold\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisApprentice\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-amber-100 text-amber-700\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-primary/10 text-primary\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{technician.name\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.split(\" \")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.map((n) => n[0])\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.join(\"\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.toUpperCase()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Availability indicator */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"ring-card absolute -right-0.5 -bottom-0.5 size-3 rounded-full ring-2\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thasJobs ? \"bg-warning\" : \"bg-success\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"truncate text-sm font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{technician.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{isApprentice && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"px-1 py-0 text-[9px]\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tApprentice\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Utilization bar */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"mt-1 flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"h-1.5 flex-1 overflow-hidden rounded-full bg-slate-200 dark:bg-slate-700\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"h-full rounded-full transition-[width] duration-200\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tutilizationColor,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle={{ width: `${utilizationPercent}%` }}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-[10px] tabular-nums\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{jobs.length} job{jobs.length !== 1 ? \"s\" : \"\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t<TooltipContent\n\t\t\t\t\t\t\t\t\t\t\tside=\"right\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"overflow-hidden rounded-lg border border-border bg-popover p-0 shadow-xl [&>svg]:hidden\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-col gap-1 p-3 text-xs text-popover-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">{technician.name}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"px-1.5 py-0.5 text-[10px]\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thasJobs\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-warning/15 text-warning\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-success/15 text-success\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{hasJobs ? \"Busy\" : \"Available\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{technician.role}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"mt-1 border-t border-border pt-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">Jobs Today:</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">{jobs.length}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">Time Booked:</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{Math.round(totalScheduledMinutes / 60)}h{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{Math.round(totalScheduledMinutes % 60)}m\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">Utilization:</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"font-medium\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tutilizationPercent < 50\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"text-success\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: utilizationPercent < 80\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"text-warning\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-destructive\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{utilizationPercent}%\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* Timeline (Hours + Lanes) */}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"flex flex-1 flex-col\"\n\t\t\t\t\t\t\tstyle={{ minWidth: totalWidth }}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{/* Hour Header - sticky top, scrolls horizontally */}\n\t\t\t\t\t\t\t<div className=\"bg-card sticky top-0 z-30 flex h-11 shrink-0 border-b\">\n\t\t\t\t\t\t\t\t{hourlySlots.map((slot, index) => {\n\t\t\t\t\t\t\t\t\tconst hour = slot.getHours();\n\t\t\t\t\t\t\t\t\tconst isBusinessHours = hour >= 6 && hour < 18;\n\t\t\t\t\t\t\t\t\tconst isMidnight = hour === 0;\n\t\t\t\t\t\t\t\t\tconst isCurrentDay = slot.toDateString() === dateObj.toDateString();\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\"relative flex shrink-0 flex-col items-center justify-center border-r\",\n\t\t\t\t\t\t\t\t\t\t\t\tisBusinessHours ? \"bg-card\" : \"bg-muted/30\",\n\t\t\t\t\t\t\t\t\t\t\t\tisMidnight && \"border-l-2 border-l-primary/50\",\n\t\t\t\t\t\t\t\t\t\t\t\tisCurrentDay && isMidnight && \"bg-primary/10\",\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\t\t\t\t\tstyle={{ width: HOUR_WIDTH }}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{/* Show date label at midnight */}\n\t\t\t\t\t\t\t\t\t\t\t{isMidnight && (\n\t\t\t\t\t\t\t\t\t\t\t\t<span className={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"text-[10px] font-semibold leading-tight\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tisCurrentDay ? \"text-primary\" : \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t\t)}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{format(slot, \"EEE d\")}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"text-xs font-medium\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tisBusinessHours\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"text-foreground\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{format(slot, \"h a\")}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Timeline Grid */}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName=\"relative flex-1\"\n\t\t\t\t\t\t\t\tonContextMenu={handleTimelineContextMenu}\n\t\t\t\t\t\t\t\tonMouseLeave={handleMouseLeave}\n\t\t\t\t\t\t\t\tonMouseMove={handleMouseMove}\n\t\t\t\t\t\t\t\tref={timelineRef}\n\t\t\t\t\t\t\t\tstyle={{ minWidth: totalWidth }}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{/* Hour Column Backgrounds with 15-min snap guides */}\n\t\t\t\t\t\t\t\t<div className=\"absolute inset-0 flex\">\n\t\t\t\t\t\t\t\t\t{hourlySlots.map((slot, index) => {\n\t\t\t\t\t\t\t\t\t\tconst hour = slot.getHours();\n\t\t\t\t\t\t\t\t\t\tconst isBusinessHours = hour >= 6 && hour < 18;\n\t\t\t\t\t\t\t\t\t\tconst isMidnight = hour === 0;\n\t\t\t\t\t\t\t\t\t\tconst isCurrentDay = slot.toDateString() === dateObj.toDateString();\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"relative shrink-0 border-r\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tisBusinessHours\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? index % 2 === 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-background\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-muted/5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-muted/20\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tisMidnight && \"border-l-2 border-l-primary/30\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tisCurrentDay && \"bg-primary/5\",\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\t\t\t\twidth: HOUR_WIDTH,\n\t\t\t\t\t\t\t\t\t\t\t\t\tbackgroundImage: isBusinessHours\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? undefined\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"repeating-linear-gradient(45deg, transparent, transparent 8px, hsl(var(--muted) / 0.3) 8px, hsl(var(--muted) / 0.3) 16px)\",\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{/* 15-minute snap guides (visible during drag) */}\n\t\t\t\t\t\t\t\t\t\t\t\t{activeJobId && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"bg-primary/20 absolute top-0 left-1/4 h-full w-px\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"bg-primary/30 absolute top-0 left-1/2 h-full w-px\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"bg-primary/20 absolute top-0 left-3/4 h-full w-px\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{/* Hover Time Indicator - Time Badge Only */}\n\t\t\t\t\t\t\t\t{hoverPosition !== null && hoverTime && !isJobHovered && (\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclassName=\"pointer-events-none absolute top-0 z-50\"\n\t\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\t\tleft: hoverPosition,\n\t\t\t\t\t\t\t\t\t\t\ttransform: \"translate(-50%, -50%)\",\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div className=\"bg-foreground text-background rounded-md px-2.5 py-1 text-xs font-semibold whitespace-nowrap shadow-lg\">\n\t\t\t\t\t\t\t\t\t\t\t{hoverTime}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t{/* Current Time Indicator - Blue Line */}\n\t\t\t\t\t\t\t\t{currentTimePosition !== null && (\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclassName=\"absolute top-0 z-30 h-full w-0.5 bg-blue-500 shadow-lg\"\n\t\t\t\t\t\t\t\t\t\tstyle={{ left: currentTimePosition }}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div className=\"absolute -top-1.5 -left-1.5 size-3 rounded-full bg-blue-500 ring-2 ring-blue-200\" />\n\t\t\t\t\t\t\t\t\t\t<div className=\"absolute top-0 left-1/2 z-50 -translate-x-1/2 -translate-y-1/2 rounded-md bg-blue-500 px-2.5 py-1 text-xs font-semibold whitespace-nowrap text-white shadow-lg\">\n\t\t\t\t\t\t\t\t\t\t\t{format(new Date(), \"EEE, MMM d • h:mm a\")}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t{/* Technician Lanes */}\n\t\t\t\t\t\t\t\t{technicianLanes.map(({ technician, jobs, height }) => (\n\t\t\t\t\t\t\t\t\t<TechnicianLane\n\t\t\t\t\t\t\t\t\t\theight={height}\n\t\t\t\t\t\t\t\t\t\tisDragActive={activeJobId !== null}\n\t\t\t\t\t\t\t\t\t\tjobs={jobs}\n\t\t\t\t\t\t\t\t\t\tkey={technician.id}\n\t\t\t\t\t\t\t\t\t\tonJobHover={setIsJobHovered}\n\t\t\t\t\t\t\t\t\t\tonResize={handleResize}\n\t\t\t\t\t\t\t\t\t\tonResizeComplete={finalizeResize}\n\t\t\t\t\t\t\t\t\t\tonSelectJob={selectJob}\n\t\t\t\t\t\t\t\t\t\tselectedJobId={selectedJobId}\n\t\t\t\t\t\t\t\t\t\ttechnician={technician}\n\t\t\t\t\t\t\t\t\t\tonDoubleClick={handleLaneDoubleClick}\n\t\t\t\t\t\t\t\t\t\tonDragCreate={handleLaneDragCreate}\n\t\t\t\t\t\t\t\t\t\ttotalWidth={totalWidth}\n\t\t\t\t\t\t\t\t\t\ttimeRangeStart={timeRange.start}\n\t\t\t\t\t\t\t\t\t\tisSelectionMode={isSelectionMode}\n\t\t\t\t\t\t\t\t\t\tselectedJobIds={selectedJobIds}\n\t\t\t\t\t\t\t\t\t\tonToggleJobSelection={toggleJobSelection}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Drag Overlay - Ghost Preview with smooth animation */}\n\t\t\t<DragOverlay\n\t\t\t\tdropAnimation={{\n\t\t\t\t\tduration: 200,\n\t\t\t\t\teasing: \"cubic-bezier(0.18, 0.67, 0.6, 1.22)\",\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{activeJob ? (\n\t\t\t\t\t(() => {\n\t\t\t\t\t\tconst categoryConfig = getAppointmentCategoryConfig(activeJob);\n\t\t\t\t\t\tconst typeConfig = getJobTypeConfig(activeJob);\n\t\t\t\t\t\tconst TypeIcon = typeConfig.icon;\n\t\t\t\t\t\tconst CategoryIcon = categoryConfig.icon;\n\t\t\t\t\t\tconst borderColor = getJobTypeColor(activeJob);\n\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t{/* Floating time preview badge */}\n\t\t\t\t\t\t\t\t{dragPreview && (\n\t\t\t\t\t\t\t\t\t<div className=\"absolute -top-8 left-1/2 -translate-x-1/2 whitespace-nowrap rounded-md bg-primary px-2 py-1 text-xs font-medium text-primary-foreground shadow-lg\">\n\t\t\t\t\t\t\t\t\t\t<Clock className=\"mr-1 inline-block size-3\" />\n\t\t\t\t\t\t\t\t\t\t{dragPreview.label}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"bg-card flex items-center gap-2 rounded-md border px-2.5 py-1.5 shadow-2xl ring-2 ring-primary scale-[1.02]\",\n\t\t\t\t\t\t\t\t\t\tborderColor,\n\t\t\t\t\t\t\t\t\t\tcategoryConfig.borderStyle,\n\t\t\t\t\t\t\t\t\t\tactiveJob.isUnassigned && \"!border-red-500\",\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\tstyle={{ height: `${JOB_HEIGHT}px`, minWidth: \"180px\", maxWidth: \"300px\" }}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{/* Appointment Category Indicator */}\n\t\t\t\t\t\t\t\t\t<div className={cn(\"flex size-4 shrink-0 items-center justify-center rounded-sm\", categoryConfig.bgColor)}>\n\t\t\t\t\t\t\t\t\t\t<CategoryIcon className={cn(\"size-2.5\", categoryConfig.textColor)} />\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{/* Job Type Icon */}\n\t\t\t\t\t\t\t\t\t<div className={cn(\"flex size-5 shrink-0 items-center justify-center rounded\", typeConfig.bgColor)}>\n\t\t\t\t\t\t\t\t\t\t<TypeIcon className={cn(\"size-3\", typeConfig.borderColor.replace(\"border-l-\", \"text-\"))} />\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{/* Customer Name */}\n\t\t\t\t\t\t\t\t\t<span className=\"text-foreground flex-1 truncate text-xs font-semibold\">\n\t\t\t\t\t\t\t\t\t\t{activeJob.customer?.name || \"Unknown Customer\"}\n\t\t\t\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t\t\t\t{/* Team Avatars */}\n\t\t\t\t\t\t\t\t\t<TeamAvatarGroup\n\t\t\t\t\t\t\t\t\t\tassignments={activeJob.assignments}\n\t\t\t\t\t\t\t\t\t\tmaxVisible={2}\n\t\t\t\t\t\t\t\t\t\tonAddMember={() => {}}\n\t\t\t\t\t\t\t\t\t\tonRemove={() => {}}\n\t\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t\t{/* Status dot */}\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"size-1.5 shrink-0 rounded-full\",\n\t\t\t\t\t\t\t\t\t\t\tactiveJob.status === \"scheduled\" && \"bg-blue-500\",\n\t\t\t\t\t\t\t\t\t\t\tactiveJob.status === \"dispatched\" && \"bg-sky-500\",\n\t\t\t\t\t\t\t\t\t\t\tactiveJob.status === \"arrived\" && \"bg-emerald-500\",\n\t\t\t\t\t\t\t\t\t\t\tactiveJob.status === \"in-progress\" && \"bg-amber-500\",\n\t\t\t\t\t\t\t\t\t\t\t(activeJob.status === \"closed\" || activeJob.status === \"completed\") && \"bg-slate-400\",\n\t\t\t\t\t\t\t\t\t\t\tactiveJob.status === \"cancelled\" && \"bg-slate-300\",\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n\t\t\t\t\t})()\n\t\t\t\t) : null}\n\t\t\t</DragOverlay>\n\n\t\t\t{/* Command Menu */}\n\t\t\t<ScheduleCommandMenu\n\t\t\t\tisOpen={commandMenuOpen}\n\t\t\t\tonClose={() => {\n\t\t\t\t\tsetCommandMenuOpen(false);\n\t\t\t\t\tsetQuickCreateTechId(null);\n\t\t\t\t}}\n\t\t\t\tselectedDate={commandMenuDate}\n\t\t\t\tselectedTechnicianId={quickCreateTechId}\n\t\t\t\tselectedTechnicianName={\n\t\t\t\t\tquickCreateTechId\n\t\t\t\t\t\t? technicians.find((t) => t.id === quickCreateTechId)?.name\n\t\t\t\t\t\t: undefined\n\t\t\t\t}\n\t\t\t\tunassignedJobs={unassignedJobs}\n\t\t\t/>\n\n\t\t\t{/* Quick Appointment Dialog - triggered by double-click or drag-to-create on timeline */}\n\t\t\t<QuickAppointmentDialog\n\t\t\t\topen={showQuickAppointment}\n\t\t\t\tonOpenChange={(open) => {\n\t\t\t\t\tsetShowQuickAppointment(open);\n\t\t\t\t\tif (!open) {\n\t\t\t\t\t\tsetQuickCreateTechId(null);\n\t\t\t\t\t\tsetQuickAppointmentTime(null);\n\t\t\t\t\t\tsetQuickAppointmentDuration(null);\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\ttechnicians={technicianOptions}\n\t\t\t\tonSuccess={() => {\n\t\t\t\t\t// Refresh the schedule data\n\t\t\t\t\tvoid refresh();\n\t\t\t\t}}\n\t\t\t\tdefaultTechnicianId={quickCreateTechId || undefined}\n\t\t\t\tdefaultDateTime={quickAppointmentTime || undefined}\n\t\t\t\tdefaultDuration={quickAppointmentDuration || undefined}\n\t\t\t/>\n\t\t</DndContext>\n\t);\n}\n"],"names":[],"mappings":"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"}}]
}