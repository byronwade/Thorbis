{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/lib/schedule-utils.ts"],"sourcesContent":["import type {\n\tAddress,\n\tCustomer,\n\tJob,\n\tJobAssignment,\n\tLegacyJob,\n\tLocation,\n\tTechnician,\n\tTechnicianSchedule,\n} from \"@/components/schedule/schedule-types\";\n\n/**\n * Utilities for schedule management\n */\n\n// ============================================\n// CONFLICT DETECTION\n// ============================================\n\nfunction hasTimeConflict(\n\tjob1Start: Date | string,\n\tjob1End: Date | string,\n\tjob2Start: Date | string,\n\tjob2End: Date | string,\n): boolean {\n\tconst start1 = job1Start instanceof Date ? job1Start : new Date(job1Start);\n\tconst end1 = job1End instanceof Date ? job1End : new Date(job1End);\n\tconst start2 = job2Start instanceof Date ? job2Start : new Date(job2Start);\n\tconst end2 = job2End instanceof Date ? job2End : new Date(job2End);\n\n\treturn (\n\t\t(start1 >= start2 && start1 < end2) ||\n\t\t(end1 > start2 && end1 <= end2) ||\n\t\t(start1 <= start2 && end1 >= end2)\n\t);\n}\n\nfunction findConflictingJobs(\n\tjobs: Job[],\n\ttechnicianId: string,\n\tstartTime: Date,\n\tendTime: Date,\n\texcludeJobId?: string,\n): Job[] {\n\treturn jobs.filter((job) => {\n\t\tif (excludeJobId && job.id === excludeJobId) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!jobHasTechnician(job, technicianId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn hasTimeConflict(startTime, endTime, job.startTime, job.endTime);\n\t});\n}\n\n// ============================================\n// MIGRATION UTILITIES\n// ============================================\n\nfunction legacyJobToJob(legacy: LegacyJob, technicianId: string): Job {\n\tconst today = new Date();\n\ttoday.setHours(0, 0, 0, 0);\n\n\t// Parse time strings\n\tconst [startHour, startMin] = legacy.startTime.split(\":\").map(Number);\n\tconst [endHour, endMin] = legacy.endTime.split(\":\").map(Number);\n\n\tconst startTime = new Date(today);\n\tstartTime.setHours(startHour, startMin, 0, 0);\n\n\tconst endTime = new Date(today);\n\tendTime.setHours(endHour, endMin, 0, 0);\n\n\t// Create address and location\n\tconst address: Address = {\n\t\tstreet: legacy.address,\n\t\tcity: \"\",\n\t\tstate: \"\",\n\t\tzip: \"\",\n\t\tcountry: \"USA\",\n\t};\n\n\tconst location: Location = {\n\t\taddress,\n\t\tcoordinates: {\n\t\t\tlat: legacy.lat,\n\t\t\tlng: legacy.lng,\n\t\t},\n\t};\n\n\t// Create customer\n\tconst customer: Customer = {\n\t\tid: `customer-${legacy.customer.toLowerCase().replace(/\\s+/g, \"-\")}`,\n\t\tname: legacy.customer,\n\t\tlocation,\n\t\tcreatedAt: new Date(),\n\t\tupdatedAt: new Date(),\n\t};\n\n\t// Calculate estimated duration in minutes\n\tconst estimatedDuration = legacy.estimatedDuration\n\t\t? Number.parseFloat(legacy.estimatedDuration.replace(/[^\\d.]/g, \"\")) * 60\n\t\t: undefined;\n\n\tconst assignments: JobAssignment[] = technicianId\n\t\t? [\n\t\t\t\t{\n\t\t\t\t\ttechnicianId,\n\t\t\t\t\tteamMemberId: undefined,\n\t\t\t\t\tdisplayName: \"Technician\",\n\t\t\t\t\tavatar: null,\n\t\t\t\t\trole: \"primary\",\n\t\t\t\t\tstatus: \"available\",\n\t\t\t\t\tisActive: true,\n\t\t\t\t},\n\t\t\t]\n\t\t: [];\n\n\treturn {\n\t\tid: legacy.id,\n\t\ttechnicianId,\n\t\tassignments,\n\t\tisUnassigned: assignments.length === 0,\n\t\ttitle: legacy.title,\n\t\tdescription: legacy.description,\n\t\tcustomer,\n\t\tlocation,\n\t\tstartTime,\n\t\tendTime,\n\t\tstatus: legacy.status,\n\t\tpriority: legacy.priority,\n\t\tmetadata: {\n\t\t\testimatedDuration,\n\t\t},\n\t\tcreatedAt: new Date(),\n\t\tupdatedAt: new Date(),\n\t};\n}\n\n// ============================================\n// TIME CALCULATIONS\n// ============================================\n\nfunction calculateDuration(\n\tstartTime: Date | string,\n\tendTime: Date | string,\n): number {\n\tconst start = startTime instanceof Date ? startTime : new Date(startTime);\n\tconst end = endTime instanceof Date ? endTime : new Date(endTime);\n\treturn Math.round((end.getTime() - start.getTime()) / (1000 * 60)); // minutes\n}\n\nfunction formatDuration(minutes: number): string {\n\tif (minutes < 60) {\n\t\treturn `${minutes}m`;\n\t}\n\n\tconst hours = Math.floor(minutes / 60);\n\tconst mins = minutes % 60;\n\n\treturn mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;\n}\n\nfunction addMinutes(date: Date, minutes: number): Date {\n\treturn new Date(date.getTime() + minutes * 60 * 1000);\n}\n\n// ============================================\n// WORK HOURS CALCULATIONS\n// ============================================\n\nfunction calculateWorkload(\n\tjobs: Job[],\n\ttechnicianSchedule: TechnicianSchedule,\n\tdate: Date,\n): {\n\ttotalMinutes: number;\n\tavailableMinutes: number;\n\tutilizationRate: number;\n} {\n\tconst dayStart = new Date(date);\n\tdayStart.setHours(technicianSchedule.availableHours.start, 0, 0, 0);\n\n\tconst dayEnd = new Date(date);\n\tdayEnd.setHours(technicianSchedule.availableHours.end, 0, 0, 0);\n\n\tconst availableMinutes = calculateDuration(dayStart, dayEnd);\n\n\t// Calculate total job duration for this day\n\tconst totalMinutes = jobs.reduce((sum, job) => {\n\t\t// Check if job is on this date\n\t\tif (\n\t\t\tjob.startTime.toDateString() === date.toDateString() ||\n\t\t\tjob.endTime.toDateString() === date.toDateString()\n\t\t) {\n\t\t\treturn sum + calculateDuration(job.startTime, job.endTime);\n\t\t}\n\t\treturn sum;\n\t}, 0);\n\n\tconst utilizationRate =\n\t\tavailableMinutes > 0 ? (totalMinutes / availableMinutes) * 100 : 0;\n\n\treturn {\n\t\ttotalMinutes,\n\t\tavailableMinutes,\n\t\tutilizationRate: Math.min(utilizationRate, 100),\n\t};\n}\n\n// ============================================\n// DATE UTILITIES\n// ============================================\n\nfunction isSameDay(date1: Date, date2: Date): boolean {\n\treturn (\n\t\tdate1.getFullYear() === date2.getFullYear() &&\n\t\tdate1.getMonth() === date2.getMonth() &&\n\t\tdate1.getDate() === date2.getDate()\n\t);\n}\n\nfunction isToday(date: Date): boolean {\n\treturn isSameDay(date, new Date());\n}\n\nexport function startOfDay(date: Date): Date {\n\tconst result = new Date(date);\n\tresult.setHours(0, 0, 0, 0);\n\treturn result;\n}\n\nexport function endOfDay(date: Date): Date {\n\tconst result = new Date(date);\n\tresult.setHours(23, 59, 59, 999);\n\treturn result;\n}\n\n// ============================================\n// RECURRING JOBS\n// ============================================\n\nfunction generateRecurringJobInstances(\n\tbaseJob: Job,\n\tstartDate: Date,\n\tendDate: Date,\n): Job[] {\n\tif (!baseJob.recurrence) {\n\t\treturn [baseJob];\n\t}\n\n\tconst instances: Job[] = [];\n\tconst {\n\t\tfrequency,\n\t\tinterval,\n\t\tcount,\n\t\tendDate: recurrenceEndDate,\n\t} = baseJob.recurrence;\n\n\tconst currentDate = new Date(baseJob.startTime);\n\tlet instanceCount = 0;\n\n\twhile (currentDate <= endDate) {\n\t\tif (currentDate >= startDate) {\n\t\t\t// Calculate job duration\n\t\t\tconst duration = calculateDuration(baseJob.startTime, baseJob.endTime);\n\n\t\t\t// Create new instance\n\t\t\tconst instance: Job = {\n\t\t\t\t...baseJob,\n\t\t\t\tid: `${baseJob.id}-instance-${instanceCount}`,\n\t\t\t\tparentJobId: baseJob.id,\n\t\t\t\tstartTime: new Date(currentDate),\n\t\t\t\tendTime: addMinutes(new Date(currentDate), duration),\n\t\t\t};\n\n\t\t\tinstances.push(instance);\n\t\t}\n\n\t\t// Move to next occurrence\n\t\tinstanceCount++;\n\n\t\tif (count && instanceCount >= count) {\n\t\t\tbreak;\n\t\t}\n\t\tif (recurrenceEndDate && currentDate >= recurrenceEndDate) {\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch (frequency) {\n\t\t\tcase \"daily\":\n\t\t\t\tcurrentDate.setDate(currentDate.getDate() + interval);\n\t\t\t\tbreak;\n\t\t\tcase \"weekly\":\n\t\t\t\tcurrentDate.setDate(currentDate.getDate() + interval * 7);\n\t\t\t\tbreak;\n\t\t\tcase \"monthly\":\n\t\t\t\tcurrentDate.setMonth(currentDate.getMonth() + interval);\n\t\t\t\tbreak;\n\t\t\tcase \"yearly\":\n\t\t\t\tcurrentDate.setFullYear(currentDate.getFullYear() + interval);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn instances;\n}\n\n// ============================================\n// FILTERING\n// ============================================\n\nexport function filterJobs(\n\tjobs: Job[],\n\tfilters: {\n\t\ttechnicianIds?: string[];\n\t\tstatuses?: Job[\"status\"][];\n\t\tpriorities?: Job[\"priority\"][];\n\t\tsearchQuery?: string;\n\t},\n): Job[] {\n\treturn jobs.filter((job) => {\n\t\t// Filter by technician\n\t\tif (\n\t\t\tfilters.technicianIds &&\n\t\t\tfilters.technicianIds.length > 0 &&\n\t\t\t!filters.technicianIds.some((technicianId) =>\n\t\t\t\tjobHasTechnician(job, technicianId),\n\t\t\t)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Filter by status\n\t\tif (\n\t\t\tfilters.statuses &&\n\t\t\tfilters.statuses.length > 0 &&\n\t\t\t!filters.statuses.includes(job.status)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Filter by priority\n\t\tif (\n\t\t\tfilters.priorities &&\n\t\t\tfilters.priorities.length > 0 &&\n\t\t\t!filters.priorities.includes(job.priority)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Filter by search query\n\t\tif (filters.searchQuery && filters.searchQuery.trim() !== \"\") {\n\t\t\tconst query = filters.searchQuery.toLowerCase();\n\t\t\tconst matchesTitle = job.title.toLowerCase().includes(query);\n\t\t\tconst matchesCustomer = job.customer.name.toLowerCase().includes(query);\n\t\t\tconst matchesDescription = job.description?.toLowerCase().includes(query);\n\n\t\t\tif (!(matchesTitle || matchesCustomer || matchesDescription)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t});\n}\n\n// ============================================\n// SORTING\n// ============================================\n\nexport function sortJobsByStartTime(jobs: Job[]): Job[] {\n\treturn [...jobs].sort((a, b) => {\n\t\t// Ensure dates are Date objects\n\t\tconst aTime =\n\t\t\ta.startTime instanceof Date ? a.startTime : new Date(a.startTime);\n\t\tconst bTime =\n\t\t\tb.startTime instanceof Date ? b.startTime : new Date(b.startTime);\n\t\treturn aTime.getTime() - bTime.getTime();\n\t});\n}\n\nfunction sortTechniciansByName(technicians: Technician[]): Technician[] {\n\treturn [...technicians].sort((a, b) => a.name.localeCompare(b.name));\n}\n\n// ============================================\n// VALIDATION\n// ============================================\n\nfunction validateJobTimes(\n\tstartTime: Date,\n\tendTime: Date,\n): {\n\tvalid: boolean;\n\terror?: string;\n} {\n\tif (startTime >= endTime) {\n\t\treturn {\n\t\t\tvalid: false,\n\t\t\terror: \"End time must be after start time\",\n\t\t};\n\t}\n\n\tconst duration = calculateDuration(startTime, endTime);\n\tif (duration < 15) {\n\t\treturn {\n\t\t\tvalid: false,\n\t\t\terror: \"Job must be at least 15 minutes long\",\n\t\t};\n\t}\n\n\treturn { valid: true };\n}\n\nfunction validateJob(job: Partial<Job>): {\n\tvalid: boolean;\n\terrors: string[];\n} {\n\tconst errors: string[] = [];\n\n\tif (!job.title || job.title.trim() === \"\") {\n\t\terrors.push(\"Title is required\");\n\t}\n\n\tconst hasTechnician =\n\t\t!!job.technicianId ||\n\t\tjob.assignments?.some((assignment) => assignment.technicianId);\n\n\tif (!hasTechnician) {\n\t\terrors.push(\"Technician must be assigned\");\n\t}\n\n\tif (!job.startTime) {\n\t\terrors.push(\"Start time is required\");\n\t}\n\n\tif (!job.endTime) {\n\t\terrors.push(\"End time is required\");\n\t}\n\n\tif (job.startTime && job.endTime) {\n\t\tconst timeValidation = validateJobTimes(job.startTime, job.endTime);\n\t\tif (!timeValidation.valid) {\n\t\t\terrors.push(timeValidation.error!);\n\t\t}\n\t}\n\n\treturn {\n\t\tvalid: errors.length === 0,\n\t\terrors,\n\t};\n}\n\nfunction jobHasTechnician(job: Job, technicianId: string): boolean {\n\tif (job.technicianId === technicianId) {\n\t\treturn true;\n\t}\n\n\treturn job.assignments.some(\n\t\t(assignment) => assignment.technicianId === technicianId,\n\t);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 322, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/lib/utils/customer-display.ts"],"sourcesContent":["/**\n * Customer Display Utilities\n *\n * Unified logic for displaying customer information consistently across the application.\n * This prevents inconsistent customer name display and provides fallback logic.\n */\n\nexport interface CustomerDisplayData {\n\tid?: string;\n\tdisplay_name?: string | null;\n\tfirst_name?: string | null;\n\tlast_name?: string | null;\n\tcompany_name?: string | null;\n\temail?: string | null;\n\tphone?: string | null;\n}\n\n/**\n * Get a customer's display name using consistent precedence logic:\n * 1. display_name (if set)\n * 2. first_name + last_name (combined)\n * 3. first_name OR last_name (whichever exists)\n * 4. company_name (for business customers)\n * 5. email (as last resort)\n * 6. \"Unknown Customer\" (ultimate fallback)\n *\n * @param customer - Customer object with potential name fields\n * @param fallbackEmail - Optional email to use if customer has no name\n * @returns Display-ready customer name\n *\n * @example\n * ```ts\n * getCustomerDisplayName({ first_name: \"John\", last_name: \"Doe\" })\n * // Returns: \"John Doe\"\n *\n * getCustomerDisplayName({ display_name: \"John's Plumbing\" })\n * // Returns: \"John's Plumbing\"\n *\n * getCustomerDisplayName({ email: \"john@example.com\" })\n * // Returns: \"john@example.com\"\n * ```\n */\nexport function getCustomerDisplayName(\n\tcustomer: CustomerDisplayData | null | undefined,\n\tfallbackEmail?: string | null\n): string {\n\tif (!customer) {\n\t\treturn fallbackEmail || \"Unknown Customer\";\n\t}\n\n\t// Priority 1: Explicit display name\n\tif (customer.display_name) {\n\t\treturn customer.display_name;\n\t}\n\n\t// Priority 2: Full name (first + last)\n\tconst firstName = customer.first_name?.trim();\n\tconst lastName = customer.last_name?.trim();\n\n\tif (firstName && lastName) {\n\t\treturn `${firstName} ${lastName}`;\n\t}\n\n\t// Priority 3: Either first or last name\n\tif (firstName) return firstName;\n\tif (lastName) return lastName;\n\n\t// Priority 4: Company name (for business customers)\n\tif (customer.company_name) {\n\t\treturn customer.company_name;\n\t}\n\n\t// Priority 5: Email from customer record\n\tif (customer.email) {\n\t\treturn customer.email;\n\t}\n\n\t// Priority 6: Fallback email provided\n\tif (fallbackEmail) {\n\t\treturn fallbackEmail;\n\t}\n\n\t// Ultimate fallback\n\treturn \"Unknown Customer\";\n}\n\n/**\n * Get customer initials for avatar displays\n * Takes first letter of each word (max 2 letters)\n *\n * @param customer - Customer object with potential name fields\n * @returns 1-2 character initials (uppercase)\n *\n * @example\n * ```ts\n * getCustomerInitials({ first_name: \"John\", last_name: \"Doe\" })\n * // Returns: \"JD\"\n *\n * getCustomerInitials({ display_name: \"ACME Corp\" })\n * // Returns: \"AC\"\n *\n * getCustomerInitials({ email: \"john@example.com\" })\n * // Returns: \"J\"\n * ```\n */\nexport function getCustomerInitials(\n\tcustomer: CustomerDisplayData | null | undefined\n): string {\n\tif (!customer) return \"?\";\n\n\tconst displayName = getCustomerDisplayName(customer);\n\n\t// Split by spaces and take first letter of each word\n\tconst words = displayName.split(/\\s+/).filter(Boolean);\n\n\tif (words.length >= 2) {\n\t\treturn (words[0][0] + words[1][0]).toUpperCase();\n\t}\n\n\tif (words.length === 1 && words[0].length >= 2) {\n\t\treturn words[0].slice(0, 2).toUpperCase();\n\t}\n\n\tif (words.length === 1) {\n\t\treturn words[0][0].toUpperCase();\n\t}\n\n\treturn \"?\";\n}\n\n/**\n * Get customer's full contact display (name + email/phone)\n * Useful for tooltips, hover cards, and detail views\n *\n * @param customer - Customer object\n * @returns Multi-line contact string\n *\n * @example\n * ```ts\n * getCustomerContactDisplay({\n *   first_name: \"John\",\n *   last_name: \"Doe\",\n *   email: \"john@example.com\",\n *   phone: \"555-1234\"\n * })\n * // Returns: \"John Doe\\njohn@example.com\\n555-1234\"\n * ```\n */\nexport function getCustomerContactDisplay(\n\tcustomer: CustomerDisplayData | null | undefined\n): string {\n\tif (!customer) return \"Unknown Customer\";\n\n\tconst lines: string[] = [getCustomerDisplayName(customer)];\n\n\tif (customer.email) {\n\t\tlines.push(customer.email);\n\t}\n\n\tif (customer.phone) {\n\t\tlines.push(customer.phone);\n\t}\n\n\treturn lines.join(\"\\n\");\n}\n\n/**\n * Check if customer has any name information (not just email)\n * Useful for validation and \"not linked\" indicators\n *\n * @param customer - Customer object\n * @returns true if customer has a real name, false if only email/unknown\n */\nexport function hasCustomerName(\n\tcustomer: CustomerDisplayData | null | undefined\n): boolean {\n\tif (!customer) return false;\n\n\treturn !!(\n\t\tcustomer.display_name ||\n\t\tcustomer.first_name ||\n\t\tcustomer.last_name ||\n\t\tcustomer.company_name\n\t);\n}\n\n/**\n * Format customer name for sorting/comparison\n * Always uses \"Last, First\" format for consistent alphabetization\n *\n * @param customer - Customer object\n * @returns Sortable name string\n *\n * @example\n * ```ts\n * getCustomerSortName({ first_name: \"John\", last_name: \"Doe\" })\n * // Returns: \"Doe, John\"\n *\n * getCustomerSortName({ company_name: \"ACME Corp\" })\n * // Returns: \"ACME Corp\"\n * ```\n */\nexport function getCustomerSortName(\n\tcustomer: CustomerDisplayData | null | undefined\n): string {\n\tif (!customer) return \"zzz_unknown\"; // Sort unknowns to end\n\n\t// If only last name, use it\n\tif (customer.last_name && !customer.first_name) {\n\t\treturn customer.last_name;\n\t}\n\n\t// If only first name, use it\n\tif (customer.first_name && !customer.last_name) {\n\t\treturn customer.first_name;\n\t}\n\n\t// If both names, use \"Last, First\" format\n\tif (customer.first_name && customer.last_name) {\n\t\treturn `${customer.last_name}, ${customer.first_name}`;\n\t}\n\n\t// Otherwise use display name logic\n\treturn getCustomerDisplayName(customer);\n}\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;;;;;;;;;AAqCM,SAAS,uBACf,QAAgD,EAChD,aAA6B;IAE7B,IAAI,CAAC,UAAU;QACd,OAAO,iBAAiB;IACzB;IAEA,oCAAoC;IACpC,IAAI,SAAS,YAAY,EAAE;QAC1B,OAAO,SAAS,YAAY;IAC7B;IAEA,uCAAuC;IACvC,MAAM,YAAY,SAAS,UAAU,EAAE;IACvC,MAAM,WAAW,SAAS,SAAS,EAAE;IAErC,IAAI,aAAa,UAAU;QAC1B,OAAO,GAAG,UAAU,CAAC,EAAE,UAAU;IAClC;IAEA,wCAAwC;IACxC,IAAI,WAAW,OAAO;IACtB,IAAI,UAAU,OAAO;IAErB,oDAAoD;IACpD,IAAI,SAAS,YAAY,EAAE;QAC1B,OAAO,SAAS,YAAY;IAC7B;IAEA,yCAAyC;IACzC,IAAI,SAAS,KAAK,EAAE;QACnB,OAAO,SAAS,KAAK;IACtB;IAEA,sCAAsC;IACtC,IAAI,eAAe;QAClB,OAAO;IACR;IAEA,oBAAoB;IACpB,OAAO;AACR;AAqBO,SAAS,oBACf,QAAgD;IAEhD,IAAI,CAAC,UAAU,OAAO;IAEtB,MAAM,cAAc,uBAAuB;IAE3C,qDAAqD;IACrD,MAAM,QAAQ,YAAY,KAAK,CAAC,OAAO,MAAM,CAAC;IAE9C,IAAI,MAAM,MAAM,IAAI,GAAG;QACtB,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,GAAG,KAAK,CAAC,EAAE,CAAC,EAAE,EAAE,WAAW;IAC/C;IAEA,IAAI,MAAM,MAAM,KAAK,KAAK,KAAK,CAAC,EAAE,CAAC,MAAM,IAAI,GAAG;QAC/C,OAAO,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,WAAW;IACxC;IAEA,IAAI,MAAM,MAAM,KAAK,GAAG;QACvB,OAAO,KAAK,CAAC,EAAE,CAAC,EAAE,CAAC,WAAW;IAC/B;IAEA,OAAO;AACR;AAoBO,SAAS,0BACf,QAAgD;IAEhD,IAAI,CAAC,UAAU,OAAO;IAEtB,MAAM,QAAkB;QAAC,uBAAuB;KAAU;IAE1D,IAAI,SAAS,KAAK,EAAE;QACnB,MAAM,IAAI,CAAC,SAAS,KAAK;IAC1B;IAEA,IAAI,SAAS,KAAK,EAAE;QACnB,MAAM,IAAI,CAAC,SAAS,KAAK;IAC1B;IAEA,OAAO,MAAM,IAAI,CAAC;AACnB;AASO,SAAS,gBACf,QAAgD;IAEhD,IAAI,CAAC,UAAU,OAAO;IAEtB,OAAO,CAAC,CAAC,CACR,SAAS,YAAY,IACrB,SAAS,UAAU,IACnB,SAAS,SAAS,IAClB,SAAS,YAAY,AACtB;AACD;AAkBO,SAAS,oBACf,QAAgD;IAEhD,IAAI,CAAC,UAAU,OAAO,eAAe,uBAAuB;IAE5D,4BAA4B;IAC5B,IAAI,SAAS,SAAS,IAAI,CAAC,SAAS,UAAU,EAAE;QAC/C,OAAO,SAAS,SAAS;IAC1B;IAEA,6BAA6B;IAC7B,IAAI,SAAS,UAAU,IAAI,CAAC,SAAS,SAAS,EAAE;QAC/C,OAAO,SAAS,UAAU;IAC3B;IAEA,0CAA0C;IAC1C,IAAI,SAAS,UAAU,IAAI,SAAS,SAAS,EAAE;QAC9C,OAAO,GAAG,SAAS,SAAS,CAAC,EAAE,EAAE,SAAS,UAAU,EAAE;IACvD;IAEA,mCAAmC;IACnC,OAAO,uBAAuB;AAC/B"}},
    {"offset": {"line": 428, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/hooks/use-schedule.ts"],"sourcesContent":["import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport type { Job, Technician } from \"@/components/schedule/schedule-types\";\nimport { fetchScheduleData } from \"@/lib/schedule-data\";\nimport { filterJobs, sortJobsByStartTime } from \"@/lib/schedule-utils\";\nimport { useScheduleStore } from \"@/lib/stores/schedule-store\";\nimport { useViewStore } from \"@/lib/stores/view-store\";\nimport { createClient } from \"@/lib/supabase/client\";\n\nexport function useSchedule() {\n\t// Use granular selectors to avoid closure issues\n\tconst isLoading = useScheduleStore((state) => state.isLoading);\n\tconst error = useScheduleStore((state) => state.error);\n\tconst lastSync = useScheduleStore((state) => state.lastSync);\n\tconst jobs = useScheduleStore((state) => state.jobs);\n\tconst technicians = useScheduleStore((state) => state.technicians);\n\tconst selectedJobId = useScheduleStore((state) => state.selectedJobId);\n\tconst selectedTechnicianId = useScheduleStore(\n\t\t(state) => state.selectedTechnicianId,\n\t);\n\tconst lastFetchedRange = useScheduleStore((state) => state.lastFetchedRange);\n\tconst storeCompanyId = useScheduleStore((state) => state.companyId);\n\tconst unassignedHasMore = useScheduleStore(\n\t\t(state) => state.unassignedHasMore,\n\t);\n\tconst unassignedSearch = useScheduleStore((state) => state.unassignedSearch);\n\tconst isLoadingUnassigned = useScheduleStore(\n\t\t(state) => state.isLoadingUnassigned,\n\t);\n\tconst unassignedTotalCount = useScheduleStore(\n\t\t(state) => state.unassignedTotalCount,\n\t);\n\n\t// Get actions\n\tconst setLoading = useScheduleStore((state) => state.setLoading);\n\tconst setError = useScheduleStore((state) => state.setError);\n\tconst setJobs = useScheduleStore((state) => state.setJobs);\n\tconst setTechnicians = useScheduleStore((state) => state.setTechnicians);\n\tconst selectJob = useScheduleStore((state) => state.selectJob);\n\tconst selectTechnician = useScheduleStore((state) => state.selectTechnician);\n\tconst addJob = useScheduleStore((state) => state.addJob);\n\tconst updateJob = useScheduleStore((state) => state.updateJob);\n\tconst moveJob = useScheduleStore((state) => state.moveJob);\n\tconst deleteJob = useScheduleStore((state) => state.deleteJob);\n\tconst duplicateJob = useScheduleStore((state) => state.duplicateJob);\n\tconst getJobById = useScheduleStore((state) => state.getJobById);\n\tconst syncWithServer = useScheduleStore((state) => state.syncWithServer);\n\tconst setLastSync = useScheduleStore((state) => state.setLastSync);\n\tconst setCompanyId = useScheduleStore((state) => state.setCompanyId);\n\tconst setLastFetchedRange = useScheduleStore(\n\t\t(state) => state.setLastFetchedRange,\n\t);\n\tconst setUnassignedMeta = useScheduleStore(\n\t\t(state) => state.setUnassignedMeta,\n\t);\n\tconst getUnassignedJobsFromStore = useScheduleStore(\n\t\t(state) => state.getUnassignedJobs,\n\t);\n\tconst getJobsGroupedByTechnicianFromStore = useScheduleStore(\n\t\t(state) => state.getJobsGroupedByTechnician,\n\t);\n\tconst loadMoreUnassignedJobs = useScheduleStore(\n\t\t(state) => state.loadMoreUnassignedJobs,\n\t);\n\n\t// Get view store values with selectors to avoid re-renders\n\tconst filters = useViewStore((state) => state.filters);\n\tconst showCompletedJobs = useViewStore((state) => state.showCompletedJobs);\n\tconst _currentDate = useViewStore((state) => state.currentDate);\n\tconst _zoom = useViewStore((state) => state.zoom);\n\n\t// Calculate visible time range once\n\tconst visibleTimeRange = useMemo(\n\t\t() => useViewStore.getState().getVisibleTimeRange(),\n\t\t[],\n\t);\n\n\tconst rangeStart = visibleTimeRange.start.getTime();\n\tconst rangeEnd = visibleTimeRange.end.getTime();\n\tconst companyIdRef = useRef<string | null>(\n\t\tuseScheduleStore.getState().companyId,\n\t);\n\n\tuseEffect(() => {\n\t\tcompanyIdRef.current = storeCompanyId;\n\t}, [storeCompanyId]);\n\n\tconst jobCount = jobs.size;\n\n\tconst hasCoverage = useMemo(() => {\n\t\tif (!lastFetchedRange || jobCount === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst fetchedStart = lastFetchedRange.start.getTime();\n\t\tconst fetchedEnd = lastFetchedRange.end.getTime();\n\n\t\treturn fetchedStart <= rangeStart && fetchedEnd >= rangeEnd;\n\t}, [jobCount, lastFetchedRange, rangeEnd, rangeStart]);\n\n\tuseEffect(() => {\n\t\tlet isMounted = true;\n\n\t\tif (hasCoverage && companyIdRef.current) {\n\t\t\treturn () => {\n\t\t\t\tisMounted = false;\n\t\t\t};\n\t\t}\n\n\t\tconst loadData = async () => {\n\t\t\tsetLoading(true);\n\t\t\tsetError(null);\n\n\t\t\ttry {\n\t\t\t\tconst supabase = createClient();\n\n\t\t\t\tif (!supabase) {\n\t\t\t\t\tthrow new Error(\"Database connection not available\");\n\t\t\t\t}\n\n\t\t\t\tconst {\n\t\t\t\t\tdata: { user },\n\t\t\t\t\terror: authError,\n\t\t\t\t} = await supabase.auth.getUser();\n\n\t\t\t\tif (authError) {\n\t\t\t\t\tthrow authError;\n\t\t\t\t}\n\n\t\t\t\tif (!user) {\n\t\t\t\t\tthrow new Error(\"User session not found\");\n\t\t\t\t}\n\n\t\t\t\tlet companyId = companyIdRef.current;\n\n\t\t\t\tif (!companyId) {\n\t\t\t\t\tconst { data: membership, error: membershipError } = await supabase\n\t\t\t\t\t\t.from(\"company_memberships\")\n\t\t\t\t\t\t.select(\"company_id\")\n\t\t\t\t\t\t.eq(\"user_id\", user.id)\n\t\t\t\t\t\t.eq(\"status\", \"active\")\n\t\t\t\t\t\t.order(\"joined_at\", { ascending: false, nullsFirst: false })\n\t\t\t\t\t\t.limit(1)\n\t\t\t\t\t\t.maybeSingle();\n\n\t\t\t\t\tif (membershipError) {\n\t\t\t\t\t\tthrow membershipError;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!membership?.company_id) {\n\t\t\t\t\t\tthrow new Error(\"No active company membership found\");\n\t\t\t\t\t}\n\n\t\t\t\t\tcompanyId = membership.company_id;\n\t\t\t\t\tcompanyIdRef.current = companyId;\n\t\t\t\t\tsetCompanyId(companyId);\n\t\t\t\t}\n\n\t\t\t\tif (!companyId) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\"Unable to resolve company context for schedule data\",\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tconst {\n\t\t\t\t\tjobs: convertedJobs,\n\t\t\t\t\ttechnicians: convertedTechnicians,\n\t\t\t\t\tunassignedMeta,\n\t\t\t\t} = await fetchScheduleData({\n\t\t\t\t\tsupabase,\n\t\t\t\t\tcompanyId,\n\t\t\t\t\trange: {\n\t\t\t\t\t\tstart: new Date(rangeStart),\n\t\t\t\t\t\tend: new Date(rangeEnd),\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tif (!isMounted) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsetTechnicians(convertedTechnicians);\n\t\t\t\tsetJobs(convertedJobs);\n\t\t\t\tconst fetchedRange = {\n\t\t\t\t\tstart: new Date(rangeStart),\n\t\t\t\t\tend: new Date(rangeEnd),\n\t\t\t\t};\n\n\t\t\t\tsetTechnicians(convertedTechnicians);\n\t\t\t\tsetJobs(convertedJobs);\n\t\t\t\tconst unassignedCount = convertedJobs.filter(\n\t\t\t\t\t(job) => job.isUnassigned,\n\t\t\t\t).length;\n\t\t\t\tsetUnassignedMeta(unassignedMeta, unassignedCount);\n\t\t\t\tsetLastSync(new Date());\n\t\t\t\tsetLastFetchedRange(fetchedRange);\n\t\t\t} catch (error) {\n\t\t\t\tif (!isMounted) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst errorMessage =\n\t\t\t\t\terror instanceof Error\n\t\t\t\t\t\t? error.message\n\t\t\t\t\t\t: typeof error === \"object\" && error !== null && \"message\" in error\n\t\t\t\t\t\t\t? String((error as { message: string }).message)\n\t\t\t\t\t\t\t: \"Unknown error\";\n\t\t\t\tsetError(errorMessage);\n\t\t\t} finally {\n\t\t\t\tif (isMounted) {\n\t\t\t\t\tsetLoading(false);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tloadData();\n\n\t\treturn () => {\n\t\t\tisMounted = false;\n\t\t};\n\t}, [\n\t\thasCoverage,\n\t\trangeEnd,\n\t\trangeStart,\n\t\tsetCompanyId,\n\t\tsetLastFetchedRange,\n\t\tsetError,\n\t\tsetJobs,\n\t\tsetLastSync,\n\t\tsetLoading,\n\t\tsetTechnicians,\n\t]);\n\n\t// Get filtered and sorted jobs - MEMOIZED\n\tconst filteredJobs = useMemo((): Job[] => {\n\t\tconst allJobs = Array.from(jobs.values());\n\n\t\t// Apply view filters\n\t\tconst filtered = filterJobs(allJobs, {\n\t\t\ttechnicianIds: filters.technicianIds,\n\t\t\tstatuses: filters.statuses,\n\t\t\tpriorities: filters.priorities,\n\t\t\tsearchQuery: filters.searchQuery,\n\t\t});\n\n\t\t// Filter by completed jobs visibility\n\t\tconst visible = showCompletedJobs\n\t\t\t? filtered\n\t\t\t: filtered.filter((job) => job.status !== \"completed\");\n\n\t\t// Sort by start time\n\t\treturn sortJobsByStartTime(visible);\n\t}, [jobs, filters, showCompletedJobs]);\n\n\t// Get filtered technicians - MEMOIZED\n\tconst filteredTechnicians = useMemo((): Technician[] => {\n\t\tconst allTechnicians = Array.from(technicians.values());\n\n\t\t// If technician filter is active, only show filtered technicians\n\t\tif (filters.technicianIds.length > 0) {\n\t\t\treturn allTechnicians.filter((tech) =>\n\t\t\t\tfilters.technicianIds.includes(tech.id),\n\t\t\t);\n\t\t}\n\n\t\treturn allTechnicians;\n\t}, [technicians, filters.technicianIds]);\n\n\t// Pre-index jobs by technician ID for O(1) lookups instead of O(n) filter\n\tconst jobsByTechnicianId = useMemo(() => {\n\t\tconst map = new Map<string, Job[]>();\n\t\tfor (const job of filteredJobs) {\n\t\t\tconst techId = job.technicianId;\n\t\t\tif (techId) {\n\t\t\t\tconst existing = map.get(techId);\n\t\t\t\tif (existing) {\n\t\t\t\t\texisting.push(job);\n\t\t\t\t} else {\n\t\t\t\t\tmap.set(techId, [job]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn map;\n\t}, [filteredJobs]);\n\n\t// Get jobs for a specific technician - now O(1) lookup\n\tconst getJobsForTechnician = useCallback(\n\t\t(technicianId: string): Job[] =>\n\t\t\tjobsByTechnicianId.get(technicianId) ?? [],\n\t\t[jobsByTechnicianId],\n\t);\n\n\t// Get jobs within visible time range - MEMOIZED\n\tconst visibleJobs = useMemo((): Job[] => {\n\t\tconst { start, end } = visibleTimeRange;\n\n\t\treturn filteredJobs.filter((job) => {\n\t\t\t// Job overlaps with visible range\n\t\t\treturn job.startTime <= end && job.endTime >= start;\n\t\t});\n\t}, [filteredJobs, visibleTimeRange]);\n\n\t// Get all jobs (unfiltered)\n\tconst getAllJobs = useCallback(\n\t\t(): Job[] => Array.from(jobs.values()),\n\t\t[jobs],\n\t);\n\n\treturn {\n\t\t// State\n\t\tisLoading,\n\t\terror,\n\t\tlastSync,\n\n\t\t// Data\n\t\ttechnicians: filteredTechnicians,\n\t\tjobs: filteredJobs,\n\t\tvisibleJobs,\n\n\t\t// Selection\n\t\tselectedJobId,\n\t\tselectedTechnicianId,\n\t\tselectedJob: selectedJobId ? getJobById(selectedJobId) : null,\n\n\t\t// Actions\n\t\tgetJobsForTechnician,\n\t\tgetAllJobs,\n\t\tselectJob,\n\t\tselectTechnician,\n\t\tgetUnassignedJobs: getUnassignedJobsFromStore,\n\t\tgetJobsGroupedByTechnician: getJobsGroupedByTechnicianFromStore,\n\t\tunassignedHasMore,\n\t\tunassignedSearch,\n\t\tisLoadingUnassigned,\n\t\tunassignedTotalCount,\n\t\tloadMoreUnassignedJobs,\n\n\t\t// Mutations\n\t\taddJob,\n\t\tupdateJob,\n\t\tmoveJob,\n\t\tdeleteJob,\n\t\tduplicateJob,\n\n\t\t// Sync\n\t\trefresh: syncWithServer,\n\t};\n}\n\n/**\n * Hook for real-time schedule updates via Supabase\n * Subscribes to appointments table for INSERT, UPDATE, DELETE events\n */\nexport function useScheduleRealtime() {\n\tconst companyId = useScheduleStore((state) => state.companyId);\n\tconst updateJob = useScheduleStore((state) => state.updateJob);\n\tconst deleteJob = useScheduleStore((state) => state.deleteJob);\n\tconst addJob = useScheduleStore((state) => state.addJob);\n\tconst getJobById = useScheduleStore((state) => state.getJobById);\n\tconst syncWithServer = useScheduleStore((state) => state.syncWithServer);\n\tconst lastSync = useScheduleStore((state) => state.lastSync);\n\tconst [isConnected, setIsConnected] = useState(false);\n\tconst [connectionError, setConnectionError] = useState<string | null>(null);\n\n\tuseEffect(() => {\n\t\tif (!companyId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst supabase = createClient();\n\t\tif (!supabase) {\n\t\t\tsetConnectionError(\"Database connection not available\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst channelName = `schedule-realtime-${companyId}`;\n\n\t\tconst channel = supabase\n\t\t\t.channel(channelName)\n\t\t\t.on(\n\t\t\t\t\"postgres_changes\",\n\t\t\t\t{\n\t\t\t\t\tevent: \"*\",\n\t\t\t\t\tschema: \"public\",\n\t\t\t\t\ttable: \"appointments\",\n\t\t\t\t\tfilter: `company_id=eq.${companyId}`,\n\t\t\t\t},\n\t\t\t\tasync (payload) => {\n\t\t\t\t\tconst { eventType, new: newRecord, old: oldRecord } = payload;\n\n\t\t\t\t\tswitch (eventType) {\n\t\t\t\t\t\tcase \"DELETE\": {\n\t\t\t\t\t\t\t// Remove job from store\n\t\t\t\t\t\t\tconst jobId = (oldRecord as { id?: string })?.id;\n\t\t\t\t\t\t\tif (jobId) {\n\t\t\t\t\t\t\t\tdeleteJob(jobId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase \"UPDATE\": {\n\t\t\t\t\t\t\t// For updates, try to merge changes into existing job\n\t\t\t\t\t\t\tconst record = newRecord as Record<string, unknown>;\n\t\t\t\t\t\t\tconst jobId = record.id as string;\n\n\t\t\t\t\t\t\tif (!jobId) break;\n\n\t\t\t\t\t\t\tconst existingJob = getJobById(jobId);\n\n\t\t\t\t\t\t\tif (existingJob) {\n\t\t\t\t\t\t\t\t// Merge updates into existing job\n\t\t\t\t\t\t\t\tconst updates: Partial<Job> = {};\n\n\t\t\t\t\t\t\t\tif (record.title !== undefined) {\n\t\t\t\t\t\t\t\t\tupdates.title = record.title as string;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (record.description !== undefined) {\n\t\t\t\t\t\t\t\t\tupdates.description = record.description as string;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (record.status !== undefined) {\n\t\t\t\t\t\t\t\t\tupdates.status = mapStatus(record.status as string);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (record.start_time !== undefined) {\n\t\t\t\t\t\t\t\t\tupdates.startTime = new Date(record.start_time as string);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (record.end_time !== undefined) {\n\t\t\t\t\t\t\t\t\tupdates.endTime = new Date(record.end_time as string);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (record.assigned_to !== undefined) {\n\t\t\t\t\t\t\t\t\t// Assignment changed - need to handle technician change\n\t\t\t\t\t\t\t\t\tif (record.assigned_to === null) {\n\t\t\t\t\t\t\t\t\t\tupdates.isUnassigned = true;\n\t\t\t\t\t\t\t\t\t\tupdates.technicianId = \"\";\n\t\t\t\t\t\t\t\t\t\tupdates.assignments = [];\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tupdates.isUnassigned = false;\n\t\t\t\t\t\t\t\t\t\tupdates.technicianId = record.assigned_to as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (Object.keys(updates).length > 0) {\n\t\t\t\t\t\t\t\t\tupdateJob(jobId, updates);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Job not in store - fetch fresh data\n\t\t\t\t\t\t\t\tawait syncWithServer();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase \"INSERT\": {\n\t\t\t\t\t\t\t// For new jobs, we need full data with joins\n\t\t\t\t\t\t\t// Trigger a sync to get complete job with customer/property data\n\t\t\t\t\t\t\tawait syncWithServer();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t)\n\t\t\t.subscribe((status) => {\n\t\t\t\tif (status === \"SUBSCRIBED\") {\n\t\t\t\t\tsetIsConnected(true);\n\t\t\t\t\tsetConnectionError(null);\n\t\t\t\t} else if (status === \"CHANNEL_ERROR\") {\n\t\t\t\t\tsetIsConnected(false);\n\t\t\t\t\tsetConnectionError(\"Failed to connect to real-time updates\");\n\t\t\t\t} else if (status === \"CLOSED\") {\n\t\t\t\t\tsetIsConnected(false);\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn () => {\n\t\t\tsupabase.removeChannel(channel);\n\t\t\tsetIsConnected(false);\n\t\t};\n\t}, [\n\t\tcompanyId,\n\t\tupdateJob,\n\t\tdeleteJob,\n\t\taddJob,\n\t\tgetJobById,\n\t\tsyncWithServer,\n\t]);\n\n\treturn {\n\t\tisConnected,\n\t\tconnectionError,\n\t\tlastUpdate: lastSync,\n\t};\n}\n\n// Helper to map database status to Job status\nfunction mapStatus(status: string): Job[\"status\"] {\n\tconst normalized = status?.toLowerCase() ?? \"scheduled\";\n\tswitch (normalized) {\n\t\tcase \"scheduled\":\n\t\tcase \"dispatched\":\n\t\tcase \"arrived\":\n\t\tcase \"closed\":\n\t\tcase \"cancelled\":\n\t\t\treturn normalized as Job[\"status\"];\n\t\tcase \"in-progress\":\n\t\tcase \"in_progress\":\n\t\tcase \"inprogress\":\n\t\t\treturn \"in-progress\";\n\t\tcase \"completed\":\n\t\tcase \"complete\":\n\t\tcase \"done\":\n\t\t\treturn \"completed\";\n\t\tdefault:\n\t\t\treturn \"scheduled\";\n\t}\n}\n\n/**\n * Hook for schedule statistics\n */\nfunction useScheduleStats() {\n\tconst { technicians, jobs, visibleJobs } = useSchedule();\n\n\tconst stats = {\n\t\ttotalTechnicians: technicians.length,\n\t\ttotalJobs: jobs.length,\n\t\tvisibleJobs: visibleJobs.length,\n\t\tscheduledJobs: jobs.filter((j) => j.status === \"scheduled\").length,\n\t\tinProgressJobs: jobs.filter((j) => j.status === \"in-progress\").length,\n\t\tcompletedJobs: jobs.filter((j) => j.status === \"completed\").length,\n\t\tcancelledJobs: jobs.filter((j) => j.status === \"cancelled\").length,\n\t\turgentJobs: jobs.filter((j) => j.priority === \"urgent\").length,\n\t};\n\n\treturn stats;\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;AAEO,SAAS;;IACf,iDAAiD;IACjD,MAAM,YAAY,IAAA,+KAAgB;mDAAC,CAAC,QAAU,MAAM,SAAS;;IAC7D,MAAM,QAAQ,IAAA,+KAAgB;+CAAC,CAAC,QAAU,MAAM,KAAK;;IACrD,MAAM,WAAW,IAAA,+KAAgB;kDAAC,CAAC,QAAU,MAAM,QAAQ;;IAC3D,MAAM,OAAO,IAAA,+KAAgB;8CAAC,CAAC,QAAU,MAAM,IAAI;;IACnD,MAAM,cAAc,IAAA,+KAAgB;qDAAC,CAAC,QAAU,MAAM,WAAW;;IACjE,MAAM,gBAAgB,IAAA,+KAAgB;uDAAC,CAAC,QAAU,MAAM,aAAa;;IACrE,MAAM,uBAAuB,IAAA,+KAAgB;8DAC5C,CAAC,QAAU,MAAM,oBAAoB;;IAEtC,MAAM,mBAAmB,IAAA,+KAAgB;0DAAC,CAAC,QAAU,MAAM,gBAAgB;;IAC3E,MAAM,iBAAiB,IAAA,+KAAgB;wDAAC,CAAC,QAAU,MAAM,SAAS;;IAClE,MAAM,oBAAoB,IAAA,+KAAgB;2DACzC,CAAC,QAAU,MAAM,iBAAiB;;IAEnC,MAAM,mBAAmB,IAAA,+KAAgB;0DAAC,CAAC,QAAU,MAAM,gBAAgB;;IAC3E,MAAM,sBAAsB,IAAA,+KAAgB;6DAC3C,CAAC,QAAU,MAAM,mBAAmB;;IAErC,MAAM,uBAAuB,IAAA,+KAAgB;8DAC5C,CAAC,QAAU,MAAM,oBAAoB;;IAGtC,cAAc;IACd,MAAM,aAAa,IAAA,+KAAgB;oDAAC,CAAC,QAAU,MAAM,UAAU;;IAC/D,MAAM,WAAW,IAAA,+KAAgB;kDAAC,CAAC,QAAU,MAAM,QAAQ;;IAC3D,MAAM,UAAU,IAAA,+KAAgB;iDAAC,CAAC,QAAU,MAAM,OAAO;;IACzD,MAAM,iBAAiB,IAAA,+KAAgB;wDAAC,CAAC,QAAU,MAAM,cAAc;;IACvE,MAAM,YAAY,IAAA,+KAAgB;mDAAC,CAAC,QAAU,MAAM,SAAS;;IAC7D,MAAM,mBAAmB,IAAA,+KAAgB;0DAAC,CAAC,QAAU,MAAM,gBAAgB;;IAC3E,MAAM,SAAS,IAAA,+KAAgB;gDAAC,CAAC,QAAU,MAAM,MAAM;;IACvD,MAAM,YAAY,IAAA,+KAAgB;mDAAC,CAAC,QAAU,MAAM,SAAS;;IAC7D,MAAM,UAAU,IAAA,+KAAgB;iDAAC,CAAC,QAAU,MAAM,OAAO;;IACzD,MAAM,YAAY,IAAA,+KAAgB;mDAAC,CAAC,QAAU,MAAM,SAAS;;IAC7D,MAAM,eAAe,IAAA,+KAAgB;sDAAC,CAAC,QAAU,MAAM,YAAY;;IACnE,MAAM,aAAa,IAAA,+KAAgB;oDAAC,CAAC,QAAU,MAAM,UAAU;;IAC/D,MAAM,iBAAiB,IAAA,+KAAgB;wDAAC,CAAC,QAAU,MAAM,cAAc;;IACvE,MAAM,cAAc,IAAA,+KAAgB;qDAAC,CAAC,QAAU,MAAM,WAAW;;IACjE,MAAM,eAAe,IAAA,+KAAgB;sDAAC,CAAC,QAAU,MAAM,YAAY;;IACnE,MAAM,sBAAsB,IAAA,+KAAgB;6DAC3C,CAAC,QAAU,MAAM,mBAAmB;;IAErC,MAAM,oBAAoB,IAAA,+KAAgB;2DACzC,CAAC,QAAU,MAAM,iBAAiB;;IAEnC,MAAM,6BAA6B,IAAA,+KAAgB;oEAClD,CAAC,QAAU,MAAM,iBAAiB;;IAEnC,MAAM,sCAAsC,IAAA,+KAAgB;6EAC3D,CAAC,QAAU,MAAM,0BAA0B;;IAE5C,MAAM,yBAAyB,IAAA,+KAAgB;gEAC9C,CAAC,QAAU,MAAM,sBAAsB;;IAGxC,2DAA2D;IAC3D,MAAM,UAAU,IAAA,uKAAY;6CAAC,CAAC,QAAU,MAAM,OAAO;;IACrD,MAAM,oBAAoB,IAAA,uKAAY;uDAAC,CAAC,QAAU,MAAM,iBAAiB;;IACzE,MAAM,eAAe,IAAA,uKAAY;kDAAC,CAAC,QAAU,MAAM,WAAW;;IAC9D,MAAM,QAAQ,IAAA,uKAAY;2CAAC,CAAC,QAAU,MAAM,IAAI;;IAEhD,oCAAoC;IACpC,MAAM,mBAAmB,IAAA,+UAAO;iDAC/B,IAAM,uKAAY,CAAC,QAAQ,GAAG,mBAAmB;gDACjD,EAAE;IAGH,MAAM,aAAa,iBAAiB,KAAK,CAAC,OAAO;IACjD,MAAM,WAAW,iBAAiB,GAAG,CAAC,OAAO;IAC7C,MAAM,eAAe,IAAA,8UAAM,EAC1B,+KAAgB,CAAC,QAAQ,GAAG,SAAS;IAGtC,IAAA,iVAAS;iCAAC;YACT,aAAa,OAAO,GAAG;QACxB;gCAAG;QAAC;KAAe;IAEnB,MAAM,WAAW,KAAK,IAAI;IAE1B,MAAM,cAAc,IAAA,+UAAO;4CAAC;YAC3B,IAAI,CAAC,oBAAoB,aAAa,GAAG;gBACxC,OAAO;YACR;YAEA,MAAM,eAAe,iBAAiB,KAAK,CAAC,OAAO;YACnD,MAAM,aAAa,iBAAiB,GAAG,CAAC,OAAO;YAE/C,OAAO,gBAAgB,cAAc,cAAc;QACpD;2CAAG;QAAC;QAAU;QAAkB;QAAU;KAAW;IAErD,IAAA,iVAAS;iCAAC;YACT,IAAI,YAAY;YAEhB,IAAI,eAAe,aAAa,OAAO,EAAE;gBACxC;6CAAO;wBACN,YAAY;oBACb;;YACD;YAEA,MAAM;kDAAW;oBAChB,WAAW;oBACX,SAAS;oBAET,IAAI;wBACH,MAAM,WAAW,IAAA,wJAAY;wBAE7B,IAAI,CAAC,UAAU;4BACd,MAAM,IAAI,MAAM;wBACjB;wBAEA,MAAM,EACL,MAAM,EAAE,IAAI,EAAE,EACd,OAAO,SAAS,EAChB,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;wBAE/B,IAAI,WAAW;4BACd,MAAM;wBACP;wBAEA,IAAI,CAAC,MAAM;4BACV,MAAM,IAAI,MAAM;wBACjB;wBAEA,IAAI,YAAY,aAAa,OAAO;wBAEpC,IAAI,CAAC,WAAW;4BACf,MAAM,EAAE,MAAM,UAAU,EAAE,OAAO,eAAe,EAAE,GAAG,MAAM,SACzD,IAAI,CAAC,uBACL,MAAM,CAAC,cACP,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,EAAE,CAAC,UAAU,UACb,KAAK,CAAC,aAAa;gCAAE,WAAW;gCAAO,YAAY;4BAAM,GACzD,KAAK,CAAC,GACN,WAAW;4BAEb,IAAI,iBAAiB;gCACpB,MAAM;4BACP;4BAEA,IAAI,CAAC,YAAY,YAAY;gCAC5B,MAAM,IAAI,MAAM;4BACjB;4BAEA,YAAY,WAAW,UAAU;4BACjC,aAAa,OAAO,GAAG;4BACvB,aAAa;wBACd;wBAEA,IAAI,CAAC,WAAW;4BACf,MAAM,IAAI,MACT;wBAEF;wBAEA,MAAM,EACL,MAAM,aAAa,EACnB,aAAa,oBAAoB,EACjC,cAAc,EACd,GAAG,MAAM,IAAA,qKAAiB,EAAC;4BAC3B;4BACA;4BACA,OAAO;gCACN,OAAO,IAAI,KAAK;gCAChB,KAAK,IAAI,KAAK;4BACf;wBACD;wBAEA,IAAI,CAAC,WAAW;4BACf;wBACD;wBAEA,eAAe;wBACf,QAAQ;wBACR,MAAM,eAAe;4BACpB,OAAO,IAAI,KAAK;4BAChB,KAAK,IAAI,KAAK;wBACf;wBAEA,eAAe;wBACf,QAAQ;wBACR,MAAM,kBAAkB,cAAc,MAAM;8DAC3C,CAAC,MAAQ,IAAI,YAAY;6DACxB,MAAM;wBACR,kBAAkB,gBAAgB;wBAClC,YAAY,IAAI;wBAChB,oBAAoB;oBACrB,EAAE,OAAO,OAAO;wBACf,IAAI,CAAC,WAAW;4BACf;wBACD;wBACA,MAAM,eACL,iBAAiB,QACd,MAAM,OAAO,GACb,OAAO,UAAU,YAAY,UAAU,QAAQ,aAAa,QAC3D,OAAO,AAAC,MAA8B,OAAO,IAC7C;wBACL,SAAS;oBACV,SAAU;wBACT,IAAI,WAAW;4BACd,WAAW;wBACZ;oBACD;gBACD;;YAEA;YAEA;yCAAO;oBACN,YAAY;gBACb;;QACD;gCAAG;QACF;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACA;IAED,0CAA0C;IAC1C,MAAM,eAAe,IAAA,+UAAO;6CAAC;YAC5B,MAAM,UAAU,MAAM,IAAI,CAAC,KAAK,MAAM;YAEtC,qBAAqB;YACrB,MAAM,WAAW,IAAA,+JAAU,EAAC,SAAS;gBACpC,eAAe,QAAQ,aAAa;gBACpC,UAAU,QAAQ,QAAQ;gBAC1B,YAAY,QAAQ,UAAU;gBAC9B,aAAa,QAAQ,WAAW;YACjC;YAEA,sCAAsC;YACtC,MAAM,UAAU,oBACb,WACA,SAAS,MAAM;qDAAC,CAAC,MAAQ,IAAI,MAAM,KAAK;;YAE3C,qBAAqB;YACrB,OAAO,IAAA,wKAAmB,EAAC;QAC5B;4CAAG;QAAC;QAAM;QAAS;KAAkB;IAErC,sCAAsC;IACtC,MAAM,sBAAsB,IAAA,+UAAO;oDAAC;YACnC,MAAM,iBAAiB,MAAM,IAAI,CAAC,YAAY,MAAM;YAEpD,iEAAiE;YACjE,IAAI,QAAQ,aAAa,CAAC,MAAM,GAAG,GAAG;gBACrC,OAAO,eAAe,MAAM;gEAAC,CAAC,OAC7B,QAAQ,aAAa,CAAC,QAAQ,CAAC,KAAK,EAAE;;YAExC;YAEA,OAAO;QACR;mDAAG;QAAC;QAAa,QAAQ,aAAa;KAAC;IAEvC,0EAA0E;IAC1E,MAAM,qBAAqB,IAAA,+UAAO;mDAAC;YAClC,MAAM,MAAM,IAAI;YAChB,KAAK,MAAM,OAAO,aAAc;gBAC/B,MAAM,SAAS,IAAI,YAAY;gBAC/B,IAAI,QAAQ;oBACX,MAAM,WAAW,IAAI,GAAG,CAAC;oBACzB,IAAI,UAAU;wBACb,SAAS,IAAI,CAAC;oBACf,OAAO;wBACN,IAAI,GAAG,CAAC,QAAQ;4BAAC;yBAAI;oBACtB;gBACD;YACD;YACA,OAAO;QACR;kDAAG;QAAC;KAAa;IAEjB,uDAAuD;IACvD,MAAM,uBAAuB,IAAA,mVAAW;yDACvC,CAAC,eACA,mBAAmB,GAAG,CAAC,iBAAiB,EAAE;wDAC3C;QAAC;KAAmB;IAGrB,gDAAgD;IAChD,MAAM,cAAc,IAAA,+UAAO;4CAAC;YAC3B,MAAM,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG;YAEvB,OAAO,aAAa,MAAM;oDAAC,CAAC;oBAC3B,kCAAkC;oBAClC,OAAO,IAAI,SAAS,IAAI,OAAO,IAAI,OAAO,IAAI;gBAC/C;;QACD;2CAAG;QAAC;QAAc;KAAiB;IAEnC,4BAA4B;IAC5B,MAAM,aAAa,IAAA,mVAAW;+CAC7B,IAAa,MAAM,IAAI,CAAC,KAAK,MAAM;8CACnC;QAAC;KAAK;IAGP,OAAO;QACN,QAAQ;QACR;QACA;QACA;QAEA,OAAO;QACP,aAAa;QACb,MAAM;QACN;QAEA,YAAY;QACZ;QACA;QACA,aAAa,gBAAgB,WAAW,iBAAiB;QAEzD,UAAU;QACV;QACA;QACA;QACA;QACA,mBAAmB;QACnB,4BAA4B;QAC5B;QACA;QACA;QACA;QACA;QAEA,YAAY;QACZ;QACA;QACA;QACA;QACA;QAEA,OAAO;QACP,SAAS;IACV;AACD;GAjVgB;;QAEG,+KAAgB;QACpB,+KAAgB;QACb,+KAAgB;QACpB,+KAAgB;QACT,+KAAgB;QACd,+KAAgB;QACT,+KAAgB;QAGpB,+KAAgB;QAClB,+KAAgB;QACb,+KAAgB;QAGjB,+KAAgB;QACb,+KAAgB;QAGf,+KAAgB;QAK1B,+KAAgB;QAClB,+KAAgB;QACjB,+KAAgB;QACT,+KAAgB;QACrB,+KAAgB;QACT,+KAAgB;QAC1B,+KAAgB;QACb,+KAAgB;QAClB,+KAAgB;QACd,+KAAgB;QACb,+KAAgB;QAClB,+KAAgB;QACZ,+KAAgB;QACnB,+KAAgB;QACf,+KAAgB;QACT,+KAAgB;QAGlB,+KAAgB;QAGP,+KAAgB;QAGP,+KAAgB;QAG7B,+KAAgB;QAK/B,uKAAY;QACF,uKAAY;QACjB,uKAAY;QACnB,uKAAY;;;AA2RpB,SAAS;;IACf,MAAM,YAAY,IAAA,+KAAgB;2DAAC,CAAC,QAAU,MAAM,SAAS;;IAC7D,MAAM,YAAY,IAAA,+KAAgB;2DAAC,CAAC,QAAU,MAAM,SAAS;;IAC7D,MAAM,YAAY,IAAA,+KAAgB;2DAAC,CAAC,QAAU,MAAM,SAAS;;IAC7D,MAAM,SAAS,IAAA,+KAAgB;wDAAC,CAAC,QAAU,MAAM,MAAM;;IACvD,MAAM,aAAa,IAAA,+KAAgB;4DAAC,CAAC,QAAU,MAAM,UAAU;;IAC/D,MAAM,iBAAiB,IAAA,+KAAgB;gEAAC,CAAC,QAAU,MAAM,cAAc;;IACvE,MAAM,WAAW,IAAA,+KAAgB;0DAAC,CAAC,QAAU,MAAM,QAAQ;;IAC3D,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,gVAAQ,EAAC;IAC/C,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,gVAAQ,EAAgB;IAEtE,IAAA,iVAAS;yCAAC;YACT,IAAI,CAAC,WAAW;gBACf;YACD;YAEA,MAAM,WAAW,IAAA,wJAAY;YAC7B,IAAI,CAAC,UAAU;gBACd,mBAAmB;gBACnB;YACD;YAEA,MAAM,cAAc,CAAC,kBAAkB,EAAE,WAAW;YAEpD,MAAM,UAAU,SACd,OAAO,CAAC,aACR,EAAE,CACF,oBACA;gBACC,OAAO;gBACP,QAAQ;gBACR,OAAO;gBACP,QAAQ,CAAC,cAAc,EAAE,WAAW;YACrC;yDACA,OAAO;oBACN,MAAM,EAAE,SAAS,EAAE,KAAK,SAAS,EAAE,KAAK,SAAS,EAAE,GAAG;oBAEtD,OAAQ;wBACP,KAAK;4BAAU;gCACd,wBAAwB;gCACxB,MAAM,QAAS,WAA+B;gCAC9C,IAAI,OAAO;oCACV,UAAU;gCACX;gCACA;4BACD;wBAEA,KAAK;4BAAU;gCACd,sDAAsD;gCACtD,MAAM,SAAS;gCACf,MAAM,QAAQ,OAAO,EAAE;gCAEvB,IAAI,CAAC,OAAO;gCAEZ,MAAM,cAAc,WAAW;gCAE/B,IAAI,aAAa;oCAChB,kCAAkC;oCAClC,MAAM,UAAwB,CAAC;oCAE/B,IAAI,OAAO,KAAK,KAAK,WAAW;wCAC/B,QAAQ,KAAK,GAAG,OAAO,KAAK;oCAC7B;oCACA,IAAI,OAAO,WAAW,KAAK,WAAW;wCACrC,QAAQ,WAAW,GAAG,OAAO,WAAW;oCACzC;oCACA,IAAI,OAAO,MAAM,KAAK,WAAW;wCAChC,QAAQ,MAAM,GAAG,UAAU,OAAO,MAAM;oCACzC;oCACA,IAAI,OAAO,UAAU,KAAK,WAAW;wCACpC,QAAQ,SAAS,GAAG,IAAI,KAAK,OAAO,UAAU;oCAC/C;oCACA,IAAI,OAAO,QAAQ,KAAK,WAAW;wCAClC,QAAQ,OAAO,GAAG,IAAI,KAAK,OAAO,QAAQ;oCAC3C;oCACA,IAAI,OAAO,WAAW,KAAK,WAAW;wCACrC,wDAAwD;wCACxD,IAAI,OAAO,WAAW,KAAK,MAAM;4CAChC,QAAQ,YAAY,GAAG;4CACvB,QAAQ,YAAY,GAAG;4CACvB,QAAQ,WAAW,GAAG,EAAE;wCACzB,OAAO;4CACN,QAAQ,YAAY,GAAG;4CACvB,QAAQ,YAAY,GAAG,OAAO,WAAW;wCAC1C;oCACD;oCAEA,IAAI,OAAO,IAAI,CAAC,SAAS,MAAM,GAAG,GAAG;wCACpC,UAAU,OAAO;oCAClB;gCACD,OAAO;oCACN,sCAAsC;oCACtC,MAAM;gCACP;gCACA;4BACD;wBAEA,KAAK;4BAAU;gCACd,6CAA6C;gCAC7C,iEAAiE;gCACjE,MAAM;gCACN;4BACD;oBACD;gBACD;wDAEA,SAAS;yDAAC,CAAC;oBACX,IAAI,WAAW,cAAc;wBAC5B,eAAe;wBACf,mBAAmB;oBACpB,OAAO,IAAI,WAAW,iBAAiB;wBACtC,eAAe;wBACf,mBAAmB;oBACpB,OAAO,IAAI,WAAW,UAAU;wBAC/B,eAAe;oBAChB;gBACD;;YAED;iDAAO;oBACN,SAAS,aAAa,CAAC;oBACvB,eAAe;gBAChB;;QACD;wCAAG;QACF;QACA;QACA;QACA;QACA;QACA;KACA;IAED,OAAO;QACN;QACA;QACA,YAAY;IACb;AACD;IAxIgB;;QACG,+KAAgB;QAChB,+KAAgB;QAChB,+KAAgB;QACnB,+KAAgB;QACZ,+KAAgB;QACZ,+KAAgB;QACtB,+KAAgB;;;AAmIlC,8CAA8C;AAC9C,SAAS,UAAU,MAAc;IAChC,MAAM,aAAa,QAAQ,iBAAiB;IAC5C,OAAQ;QACP,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACJ,OAAO;QACR,KAAK;QACL,KAAK;QACL,KAAK;YACJ,OAAO;QACR,KAAK;QACL,KAAK;QACL,KAAK;YACJ,OAAO;QACR;YACC,OAAO;IACT;AACD;AAEA;;CAEC,GACD,SAAS;;IACR,MAAM,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,EAAE,GAAG;IAE3C,MAAM,QAAQ;QACb,kBAAkB,YAAY,MAAM;QACpC,WAAW,KAAK,MAAM;QACtB,aAAa,YAAY,MAAM;QAC/B,eAAe,KAAK,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,KAAK,aAAa,MAAM;QAClE,gBAAgB,KAAK,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,KAAK,eAAe,MAAM;QACrE,eAAe,KAAK,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,KAAK,aAAa,MAAM;QAClE,eAAe,KAAK,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,KAAK,aAAa,MAAM;QAClE,YAAY,KAAK,MAAM,CAAC,CAAC,IAAM,EAAE,QAAQ,KAAK,UAAU,MAAM;IAC/D;IAEA,OAAO;AACR;IAfS;;QACmC"}}]
}