{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/ai/conversation.tsx"],"sourcesContent":["\"use client\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { cn } from \"@/lib/utils\";\nimport { ArrowDownIcon } from \"lucide-react\";\nimport type { ComponentProps } from \"react\";\nimport { useCallback } from \"react\";\nimport { StickToBottom, useStickToBottomContext } from \"use-stick-to-bottom\";\n\nexport type ConversationProps = ComponentProps<typeof StickToBottom>;\n\nexport const Conversation = ({ className, ...props }: ConversationProps) => (\n  <StickToBottom\n    className={cn(\"relative flex-1 overflow-y-hidden\", className)}\n    initial=\"smooth\"\n    resize=\"smooth\"\n    role=\"log\"\n    {...props}\n  />\n);\n\nexport type ConversationContentProps = ComponentProps<\n  typeof StickToBottom.Content\n>;\n\nexport const ConversationContent = ({\n  className,\n  ...props\n}: ConversationContentProps) => (\n  <StickToBottom.Content\n    className={cn(\"flex flex-col gap-8 p-4\", className)}\n    {...props}\n  />\n);\n\nexport type ConversationEmptyStateProps = ComponentProps<\"div\"> & {\n  title?: string;\n  description?: string;\n  icon?: React.ReactNode;\n};\n\nexport const ConversationEmptyState = ({\n  className,\n  title = \"No messages yet\",\n  description = \"Start a conversation to see messages here\",\n  icon,\n  children,\n  ...props\n}: ConversationEmptyStateProps) => (\n  <div\n    className={cn(\n      \"flex size-full flex-col items-center justify-center gap-3 p-8 text-center\",\n      className\n    )}\n    {...props}\n  >\n    {children ?? (\n      <>\n        {icon && <div className=\"text-muted-foreground\">{icon}</div>}\n        <div className=\"space-y-1\">\n          <h3 className=\"font-medium text-sm\">{title}</h3>\n          {description && (\n            <p className=\"text-muted-foreground text-sm\">{description}</p>\n          )}\n        </div>\n      </>\n    )}\n  </div>\n);\n\nexport type ConversationScrollButtonProps = ComponentProps<typeof Button>;\n\nexport const ConversationScrollButton = ({\n  className,\n  ...props\n}: ConversationScrollButtonProps) => {\n  const { isAtBottom, scrollToBottom } = useStickToBottomContext();\n\n  const handleScrollToBottom = useCallback(() => {\n    scrollToBottom();\n  }, [scrollToBottom]);\n\n  return (\n    !isAtBottom && (\n      <Button\n        className={cn(\n          \"absolute bottom-4 left-[50%] translate-x-[-50%] rounded-full\",\n          className\n        )}\n        onClick={handleScrollToBottom}\n        size=\"icon\"\n        type=\"button\"\n        variant=\"outline\"\n        {...props}\n      >\n        <ArrowDownIcon className=\"size-4\" />\n      </Button>\n    )\n  );\n};\n"],"names":[],"mappings":";;;;;;;;;;;AAEA;AAAA;AACA;AACA;AAEA;AACA;;;AAPA;;;;;;AAWO,MAAM,eAAe,CAAC,EAAE,SAAS,EAAE,GAAG,OAA0B,iBACrE,oWAAC,wRAAa;QACZ,WAAW,IAAA,2IAAE,EAAC,qCAAqC;QACnD,SAAQ;QACR,QAAO;QACP,MAAK;QACJ,GAAG,KAAK;;;;;;KANA;AAcN,MAAM,sBAAsB,CAAC,EAClC,SAAS,EACT,GAAG,OACsB,iBACzB,oWAAC,wRAAa,CAAC,OAAO;QACpB,WAAW,IAAA,2IAAE,EAAC,2BAA2B;QACxC,GAAG,KAAK;;;;;;MANA;AAgBN,MAAM,yBAAyB,CAAC,EACrC,SAAS,EACT,QAAQ,iBAAiB,EACzB,cAAc,2CAA2C,EACzD,IAAI,EACJ,QAAQ,EACR,GAAG,OACyB,iBAC5B,oWAAC;QACC,WAAW,IAAA,2IAAE,EACX,6EACA;QAED,GAAG,KAAK;kBAER,0BACC;;gBACG,sBAAQ,oWAAC;oBAAI,WAAU;8BAAyB;;;;;;8BACjD,oWAAC;oBAAI,WAAU;;sCACb,oWAAC;4BAAG,WAAU;sCAAuB;;;;;;wBACpC,6BACC,oWAAC;4BAAE,WAAU;sCAAiC;;;;;;;;;;;;;;;;;;;MArB7C;AA+BN,MAAM,2BAA2B,CAAC,EACvC,SAAS,EACT,GAAG,OAC2B;;IAC9B,MAAM,EAAE,UAAU,EAAE,cAAc,EAAE,GAAG,IAAA,kSAAuB;IAE9D,MAAM,uBAAuB,IAAA,mVAAW;sEAAC;YACvC;QACF;qEAAG;QAAC;KAAe;IAEnB,OACE,CAAC,4BACC,oWAAC,6IAAM;QACL,WAAW,IAAA,2IAAE,EACX,gEACA;QAEF,SAAS;QACT,MAAK;QACL,MAAK;QACL,SAAQ;QACP,GAAG,KAAK;kBAET,cAAA,oWAAC,4TAAa;YAAC,WAAU;;;;;;;;;;;AAIjC;GA3Ba;;QAI4B,kSAAuB;;;MAJnD"}},
    {"offset": {"line": 144, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/ui/button-group.tsx"],"sourcesContent":["// Re-export from @stratos/ui package\nexport * from \"@stratos/ui\";\n"],"names":[],"mappings":"AAAA,qCAAqC;;AACrC"}},
    {"offset": {"line": 155, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/ai/message.tsx"],"sourcesContent":["\"use client\";\n\nimport { Button } from \"@/components/ui/button\";\nimport {\n  ButtonGroup,\n  ButtonGroupText,\n} from \"@/components/ui/button-group\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { cn } from \"@/lib/utils\";\nimport type { FileUIPart, UIMessage } from \"ai\";\nimport {\n  ChevronLeftIcon,\n  ChevronRightIcon,\n  PaperclipIcon,\n  XIcon,\n} from \"lucide-react\";\nimport type { ComponentProps, HTMLAttributes, ReactElement } from \"react\";\nimport { createContext, memo, useContext, useEffect, useState } from \"react\";\nimport { Streamdown } from \"streamdown\";\n\nexport type MessageProps = HTMLAttributes<HTMLDivElement> & {\n  from: UIMessage[\"role\"];\n};\n\nexport const Message = ({ className, from, ...props }: MessageProps) => (\n  <div\n    className={cn(\n      \"group flex w-full max-w-[80%] flex-col gap-2\",\n      from === \"user\" ? \"is-user ml-auto justify-end\" : \"is-assistant\",\n      className\n    )}\n    {...props}\n  />\n);\n\nexport type MessageContentProps = HTMLAttributes<HTMLDivElement>;\n\nexport const MessageContent = ({\n  children,\n  className,\n  ...props\n}: MessageContentProps) => (\n  <div\n    className={cn(\n      \"is-user:dark flex w-fit flex-col gap-2 overflow-hidden text-sm\",\n      \"group-[.is-user]:ml-auto group-[.is-user]:rounded-lg group-[.is-user]:bg-secondary group-[.is-user]:px-4 group-[.is-user]:py-3 group-[.is-user]:text-foreground\",\n      \"group-[.is-assistant]:text-foreground\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n  </div>\n);\n\nexport type MessageActionsProps = ComponentProps<\"div\">;\n\nexport const MessageActions = ({\n  className,\n  children,\n  ...props\n}: MessageActionsProps) => (\n  <div className={cn(\"flex items-center gap-1\", className)} {...props}>\n    {children}\n  </div>\n);\n\nexport type MessageActionProps = ComponentProps<typeof Button> & {\n  tooltip?: string;\n  label?: string;\n};\n\nexport const MessageAction = ({\n  tooltip,\n  children,\n  label,\n  variant = \"ghost\",\n  size = \"icon-sm\",\n  ...props\n}: MessageActionProps) => {\n  const button = (\n    <Button size={size} type=\"button\" variant={variant} {...props}>\n      {children}\n      <span className=\"sr-only\">{label || tooltip}</span>\n    </Button>\n  );\n\n  if (tooltip) {\n    return (\n      <TooltipProvider>\n        <Tooltip>\n          <TooltipTrigger asChild>{button}</TooltipTrigger>\n          <TooltipContent>\n            <p>{tooltip}</p>\n          </TooltipContent>\n        </Tooltip>\n      </TooltipProvider>\n    );\n  }\n\n  return button;\n};\n\ntype MessageBranchContextType = {\n  currentBranch: number;\n  totalBranches: number;\n  goToPrevious: () => void;\n  goToNext: () => void;\n  branches: ReactElement[];\n  setBranches: (branches: ReactElement[]) => void;\n};\n\nconst MessageBranchContext = createContext<MessageBranchContextType | null>(\n  null\n);\n\nconst useMessageBranch = () => {\n  const context = useContext(MessageBranchContext);\n\n  if (!context) {\n    throw new Error(\n      \"MessageBranch components must be used within MessageBranch\"\n    );\n  }\n\n  return context;\n};\n\nexport type MessageBranchProps = HTMLAttributes<HTMLDivElement> & {\n  defaultBranch?: number;\n  onBranchChange?: (branchIndex: number) => void;\n};\n\nexport const MessageBranch = ({\n  defaultBranch = 0,\n  onBranchChange,\n  className,\n  ...props\n}: MessageBranchProps) => {\n  const [currentBranch, setCurrentBranch] = useState(defaultBranch);\n  const [branches, setBranches] = useState<ReactElement[]>([]);\n\n  const handleBranchChange = (newBranch: number) => {\n    setCurrentBranch(newBranch);\n    onBranchChange?.(newBranch);\n  };\n\n  const goToPrevious = () => {\n    const newBranch =\n      currentBranch > 0 ? currentBranch - 1 : branches.length - 1;\n    handleBranchChange(newBranch);\n  };\n\n  const goToNext = () => {\n    const newBranch =\n      currentBranch < branches.length - 1 ? currentBranch + 1 : 0;\n    handleBranchChange(newBranch);\n  };\n\n  const contextValue: MessageBranchContextType = {\n    currentBranch,\n    totalBranches: branches.length,\n    goToPrevious,\n    goToNext,\n    branches,\n    setBranches,\n  };\n\n  return (\n    <MessageBranchContext.Provider value={contextValue}>\n      <div\n        className={cn(\"grid w-full gap-2 [&>div]:pb-0\", className)}\n        {...props}\n      />\n    </MessageBranchContext.Provider>\n  );\n};\n\nexport type MessageBranchContentProps = HTMLAttributes<HTMLDivElement>;\n\nexport const MessageBranchContent = ({\n  children,\n  ...props\n}: MessageBranchContentProps) => {\n  const { currentBranch, setBranches, branches } = useMessageBranch();\n  const childrenArray = Array.isArray(children) ? children : [children];\n\n  // Use useEffect to update branches when they change\n  useEffect(() => {\n    if (branches.length !== childrenArray.length) {\n      setBranches(childrenArray);\n    }\n  }, [childrenArray, branches, setBranches]);\n\n  return childrenArray.map((branch, index) => (\n    <div\n      className={cn(\n        \"grid gap-2 overflow-hidden [&>div]:pb-0\",\n        index === currentBranch ? \"block\" : \"hidden\"\n      )}\n      key={branch.key}\n      {...props}\n    >\n      {branch}\n    </div>\n  ));\n};\n\nexport type MessageBranchSelectorProps = HTMLAttributes<HTMLDivElement> & {\n  from: UIMessage[\"role\"];\n};\n\nexport const MessageBranchSelector = ({\n  className,\n  from,\n  ...props\n}: MessageBranchSelectorProps) => {\n  const { totalBranches } = useMessageBranch();\n\n  // Don't render if there's only one branch\n  if (totalBranches <= 1) {\n    return null;\n  }\n\n  return (\n    <ButtonGroup\n      className=\"[&>*:not(:first-child)]:rounded-l-md [&>*:not(:last-child)]:rounded-r-md\"\n      orientation=\"horizontal\"\n      {...props}\n    />\n  );\n};\n\nexport type MessageBranchPreviousProps = ComponentProps<typeof Button>;\n\nexport const MessageBranchPrevious = ({\n  children,\n  ...props\n}: MessageBranchPreviousProps) => {\n  const { goToPrevious, totalBranches } = useMessageBranch();\n\n  return (\n    <Button\n      aria-label=\"Previous branch\"\n      disabled={totalBranches <= 1}\n      onClick={goToPrevious}\n      size=\"icon-sm\"\n      type=\"button\"\n      variant=\"ghost\"\n      {...props}\n    >\n      {children ?? <ChevronLeftIcon size={14} />}\n    </Button>\n  );\n};\n\nexport type MessageBranchNextProps = ComponentProps<typeof Button>;\n\nexport const MessageBranchNext = ({\n  children,\n  className,\n  ...props\n}: MessageBranchNextProps) => {\n  const { goToNext, totalBranches } = useMessageBranch();\n\n  return (\n    <Button\n      aria-label=\"Next branch\"\n      disabled={totalBranches <= 1}\n      onClick={goToNext}\n      size=\"icon-sm\"\n      type=\"button\"\n      variant=\"ghost\"\n      {...props}\n    >\n      {children ?? <ChevronRightIcon size={14} />}\n    </Button>\n  );\n};\n\nexport type MessageBranchPageProps = HTMLAttributes<HTMLSpanElement>;\n\nexport const MessageBranchPage = ({\n  className,\n  ...props\n}: MessageBranchPageProps) => {\n  const { currentBranch, totalBranches } = useMessageBranch();\n\n  return (\n    <ButtonGroupText\n      className={cn(\n        \"border-none bg-transparent text-muted-foreground shadow-none\",\n        className\n      )}\n      {...props}\n    >\n      {currentBranch + 1} of {totalBranches}\n    </ButtonGroupText>\n  );\n};\n\nexport type MessageResponseProps = ComponentProps<typeof Streamdown>;\n\nexport const MessageResponse = memo(\n  ({ className, ...props }: MessageResponseProps) => (\n    <Streamdown\n      className={cn(\n        \"size-full [&>*:first-child]:mt-0 [&>*:last-child]:mb-0\",\n        className\n      )}\n      {...props}\n    />\n  ),\n  (prevProps, nextProps) => prevProps.children === nextProps.children\n);\n\nMessageResponse.displayName = \"MessageResponse\";\n\nexport type MessageAttachmentProps = HTMLAttributes<HTMLDivElement> & {\n  data: FileUIPart;\n  className?: string;\n  onRemove?: () => void;\n};\n\nexport function MessageAttachment({\n  data,\n  className,\n  onRemove,\n  ...props\n}: MessageAttachmentProps) {\n  const filename = data.filename || \"\";\n  const mediaType =\n    data.mediaType?.startsWith(\"image/\") && data.url ? \"image\" : \"file\";\n  const isImage = mediaType === \"image\";\n  const attachmentLabel = filename || (isImage ? \"Image\" : \"Attachment\");\n\n  return (\n    <div\n      className={cn(\n        \"group relative size-24 overflow-hidden rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {isImage ? (\n        <>\n          <img\n            alt={filename || \"attachment\"}\n            className=\"size-full object-cover\"\n            height={100}\n            src={data.url}\n            width={100}\n          />\n          {onRemove && (\n            <Button\n              aria-label=\"Remove attachment\"\n              className=\"absolute top-2 right-2 size-6 rounded-full bg-background/80 p-0 opacity-0 backdrop-blur-sm transition-opacity hover:bg-background group-hover:opacity-100 [&>svg]:size-3\"\n              onClick={(e) => {\n                e.stopPropagation();\n                onRemove();\n              }}\n              type=\"button\"\n              variant=\"ghost\"\n            >\n              <XIcon />\n              <span className=\"sr-only\">Remove</span>\n            </Button>\n          )}\n        </>\n      ) : (\n        <>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <div className=\"flex size-full shrink-0 items-center justify-center rounded-lg bg-muted text-muted-foreground\">\n                <PaperclipIcon className=\"size-4\" />\n              </div>\n            </TooltipTrigger>\n            <TooltipContent>\n              <p>{attachmentLabel}</p>\n            </TooltipContent>\n          </Tooltip>\n          {onRemove && (\n            <Button\n              aria-label=\"Remove attachment\"\n              className=\"size-6 shrink-0 rounded-full p-0 opacity-0 transition-opacity hover:bg-accent group-hover:opacity-100 [&>svg]:size-3\"\n              onClick={(e) => {\n                e.stopPropagation();\n                onRemove();\n              }}\n              type=\"button\"\n              variant=\"ghost\"\n            >\n              <XIcon />\n              <span className=\"sr-only\">Remove</span>\n            </Button>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\nexport type MessageAttachmentsProps = ComponentProps<\"div\">;\n\nexport function MessageAttachments({\n  children,\n  className,\n  ...props\n}: MessageAttachmentsProps) {\n  if (!children) {\n    return null;\n  }\n\n  return (\n    <div\n      className={cn(\n        \"ml-auto flex w-fit flex-wrap items-start gap-2\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </div>\n  );\n}\n\nexport type MessageToolbarProps = ComponentProps<\"div\">;\n\nexport const MessageToolbar = ({\n  className,\n  children,\n  ...props\n}: MessageToolbarProps) => (\n  <div\n    className={cn(\n      \"mt-4 flex w-full items-center justify-between gap-4\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n  </div>\n);\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 683, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/ai/artifact.tsx"],"sourcesContent":["\"use client\";\n\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { cn } from \"@/lib/utils\";\nimport { type LucideIcon, XIcon } from \"lucide-react\";\nimport type { ComponentProps, HTMLAttributes } from \"react\";\n\nexport type ArtifactProps = HTMLAttributes<HTMLDivElement>;\n\nexport const Artifact = ({ className, ...props }: ArtifactProps) => (\n  <div\n    className={cn(\n      \"flex flex-col overflow-hidden rounded-lg border bg-background shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n);\n\nexport type ArtifactHeaderProps = HTMLAttributes<HTMLDivElement>;\n\nexport const ArtifactHeader = ({\n  className,\n  ...props\n}: ArtifactHeaderProps) => (\n  <div\n    className={cn(\n      \"flex items-center justify-between border-b bg-muted/50 px-4 py-3\",\n      className\n    )}\n    {...props}\n  />\n);\n\nexport type ArtifactCloseProps = ComponentProps<typeof Button>;\n\nexport const ArtifactClose = ({\n  className,\n  children,\n  size = \"sm\",\n  variant = \"ghost\",\n  ...props\n}: ArtifactCloseProps) => (\n  <Button\n    className={cn(\n      \"size-8 p-0 text-muted-foreground hover:text-foreground\",\n      className\n    )}\n    size={size}\n    type=\"button\"\n    variant={variant}\n    {...props}\n  >\n    {children ?? <XIcon className=\"size-4\" />}\n    <span className=\"sr-only\">Close</span>\n  </Button>\n);\n\nexport type ArtifactTitleProps = HTMLAttributes<HTMLParagraphElement>;\n\nexport const ArtifactTitle = ({ className, ...props }: ArtifactTitleProps) => (\n  <p\n    className={cn(\"font-medium text-foreground text-sm\", className)}\n    {...props}\n  />\n);\n\nexport type ArtifactDescriptionProps = HTMLAttributes<HTMLParagraphElement>;\n\nexport const ArtifactDescription = ({\n  className,\n  ...props\n}: ArtifactDescriptionProps) => (\n  <p className={cn(\"text-muted-foreground text-sm\", className)} {...props} />\n);\n\nexport type ArtifactActionsProps = HTMLAttributes<HTMLDivElement>;\n\nexport const ArtifactActions = ({\n  className,\n  ...props\n}: ArtifactActionsProps) => (\n  <div className={cn(\"flex items-center gap-1\", className)} {...props} />\n);\n\nexport type ArtifactActionProps = ComponentProps<typeof Button> & {\n  tooltip?: string;\n  label?: string;\n  icon?: LucideIcon;\n};\n\nexport const ArtifactAction = ({\n  tooltip,\n  label,\n  icon: Icon,\n  children,\n  className,\n  size = \"sm\",\n  variant = \"ghost\",\n  ...props\n}: ArtifactActionProps) => {\n  const button = (\n    <Button\n      className={cn(\n        \"size-8 p-0 text-muted-foreground hover:text-foreground\",\n        className\n      )}\n      size={size}\n      type=\"button\"\n      variant={variant}\n      {...props}\n    >\n      {Icon ? <Icon className=\"size-4\" /> : children}\n      <span className=\"sr-only\">{label || tooltip}</span>\n    </Button>\n  );\n\n  if (tooltip) {\n    return (\n      <TooltipProvider>\n        <Tooltip>\n          <TooltipTrigger asChild>{button}</TooltipTrigger>\n          <TooltipContent>\n            <p>{tooltip}</p>\n          </TooltipContent>\n        </Tooltip>\n      </TooltipProvider>\n    );\n  }\n\n  return button;\n};\n\nexport type ArtifactContentProps = HTMLAttributes<HTMLDivElement>;\n\nexport const ArtifactContent = ({\n  className,\n  ...props\n}: ArtifactContentProps) => (\n  <div className={cn(\"flex-1 overflow-auto p-4\", className)} {...props} />\n);\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAEA;AAAA;AACA;AAAA;AAMA;AACA;AAVA;;;;;;AAeO,MAAM,WAAW,CAAC,EAAE,SAAS,EAAE,GAAG,OAAsB,iBAC7D,oWAAC;QACC,WAAW,IAAA,2IAAE,EACX,2EACA;QAED,GAAG,KAAK;;;;;;KANA;AAYN,MAAM,iBAAiB,CAAC,EAC7B,SAAS,EACT,GAAG,OACiB,iBACpB,oWAAC;QACC,WAAW,IAAA,2IAAE,EACX,oEACA;QAED,GAAG,KAAK;;;;;;MATA;AAeN,MAAM,gBAAgB,CAAC,EAC5B,SAAS,EACT,QAAQ,EACR,OAAO,IAAI,EACX,UAAU,OAAO,EACjB,GAAG,OACgB,iBACnB,oWAAC,6IAAM;QACL,WAAW,IAAA,2IAAE,EACX,0DACA;QAEF,MAAM;QACN,MAAK;QACL,SAAS;QACR,GAAG,KAAK;;YAER,0BAAY,oWAAC,gSAAK;gBAAC,WAAU;;;;;;0BAC9B,oWAAC;gBAAK,WAAU;0BAAU;;;;;;;;;;;;MAlBjB;AAwBN,MAAM,gBAAgB,CAAC,EAAE,SAAS,EAAE,GAAG,OAA2B,iBACvE,oWAAC;QACC,WAAW,IAAA,2IAAE,EAAC,uCAAuC;QACpD,GAAG,KAAK;;;;;;MAHA;AASN,MAAM,sBAAsB,CAAC,EAClC,SAAS,EACT,GAAG,OACsB,iBACzB,oWAAC;QAAE,WAAW,IAAA,2IAAE,EAAC,iCAAiC;QAAa,GAAG,KAAK;;;;;;MAJ5D;AASN,MAAM,kBAAkB,CAAC,EAC9B,SAAS,EACT,GAAG,OACkB,iBACrB,oWAAC;QAAI,WAAW,IAAA,2IAAE,EAAC,2BAA2B;QAAa,GAAG,KAAK;;;;;;MAJxD;AAaN,MAAM,iBAAiB,CAAC,EAC7B,OAAO,EACP,KAAK,EACL,MAAM,IAAI,EACV,QAAQ,EACR,SAAS,EACT,OAAO,IAAI,EACX,UAAU,OAAO,EACjB,GAAG,OACiB;IACpB,MAAM,uBACJ,oWAAC,6IAAM;QACL,WAAW,IAAA,2IAAE,EACX,0DACA;QAEF,MAAM;QACN,MAAK;QACL,SAAS;QACR,GAAG,KAAK;;YAER,qBAAO,oWAAC;gBAAK,WAAU;;;;;2DAAc;0BACtC,oWAAC;gBAAK,WAAU;0BAAW,SAAS;;;;;;;;;;;;IAIxC,IAAI,SAAS;QACX,qBACE,oWAAC,uJAAe;sBACd,cAAA,oWAAC,+IAAO;;kCACN,oWAAC,sJAAc;wBAAC,OAAO;kCAAE;;;;;;kCACzB,oWAAC,sJAAc;kCACb,cAAA,oWAAC;sCAAG;;;;;;;;;;;;;;;;;;;;;;IAKd;IAEA,OAAO;AACT;MAxCa;AA4CN,MAAM,kBAAkB,CAAC,EAC9B,SAAS,EACT,GAAG,OACkB,iBACrB,oWAAC;QAAI,WAAW,IAAA,2IAAE,EAAC,4BAA4B;QAAa,GAAG,KAAK;;;;;;MAJzD"}},
    {"offset": {"line": 882, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/ai/model-selector.tsx"],"sourcesContent":["import {\n  Command,\n  CommandDialog,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n  CommandSeparator,\n  CommandShortcut,\n} from \"@/components/ui/command\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { cn } from \"@/lib/utils\";\nimport type { ComponentProps, ReactNode } from \"react\";\n\nexport type ModelSelectorProps = ComponentProps<typeof Dialog>;\n\nexport const ModelSelector = (props: ModelSelectorProps) => (\n  <Dialog {...props} />\n);\n\nexport type ModelSelectorTriggerProps = ComponentProps<typeof DialogTrigger>;\n\nexport const ModelSelectorTrigger = (props: ModelSelectorTriggerProps) => (\n  <DialogTrigger {...props} />\n);\n\nexport type ModelSelectorContentProps = ComponentProps<typeof DialogContent> & {\n  title?: ReactNode;\n};\n\nexport const ModelSelectorContent = ({\n  className,\n  children,\n  title = \"Model Selector\",\n  ...props\n}: ModelSelectorContentProps) => (\n  <DialogContent className={cn(\"p-0\", className)} {...props}>\n    <DialogTitle className=\"sr-only\">{title}</DialogTitle>\n    <Command className=\"**:data-[slot=command-input-wrapper]:h-auto\">\n      {children}\n    </Command>\n  </DialogContent>\n);\n\nexport type ModelSelectorDialogProps = ComponentProps<typeof CommandDialog>;\n\nconst ModelSelectorDialog = (props: ModelSelectorDialogProps) => (\n  <CommandDialog {...props} />\n);\n\nexport type ModelSelectorInputProps = ComponentProps<typeof CommandInput>;\n\nexport const ModelSelectorInput = ({\n  className,\n  ...props\n}: ModelSelectorInputProps) => (\n  <CommandInput className={cn(\"h-auto py-3.5\", className)} {...props} />\n);\n\nexport type ModelSelectorListProps = ComponentProps<typeof CommandList>;\n\nexport const ModelSelectorList = (props: ModelSelectorListProps) => (\n  <CommandList {...props} />\n);\n\nexport type ModelSelectorEmptyProps = ComponentProps<typeof CommandEmpty>;\n\nexport const ModelSelectorEmpty = (props: ModelSelectorEmptyProps) => (\n  <CommandEmpty {...props} />\n);\n\nexport type ModelSelectorGroupProps = ComponentProps<typeof CommandGroup>;\n\nexport const ModelSelectorGroup = (props: ModelSelectorGroupProps) => (\n  <CommandGroup {...props} />\n);\n\nexport type ModelSelectorItemProps = ComponentProps<typeof CommandItem>;\n\nexport const ModelSelectorItem = (props: ModelSelectorItemProps) => (\n  <CommandItem {...props} />\n);\n\nexport type ModelSelectorShortcutProps = ComponentProps<typeof CommandShortcut>;\n\nexport const ModelSelectorShortcut = (props: ModelSelectorShortcutProps) => (\n  <CommandShortcut {...props} />\n);\n\nexport type ModelSelectorSeparatorProps = ComponentProps<\n  typeof CommandSeparator\n>;\n\nexport const ModelSelectorSeparator = (props: ModelSelectorSeparatorProps) => (\n  <CommandSeparator {...props} />\n);\n\nexport type ModelSelectorLogoProps = Omit<\n  ComponentProps<\"img\">,\n  \"src\" | \"alt\"\n> & {\n  provider:\n    | \"moonshotai-cn\"\n    | \"lucidquery\"\n    | \"moonshotai\"\n    | \"zai-coding-plan\"\n    | \"alibaba\"\n    | \"xai\"\n    | \"vultr\"\n    | \"nvidia\"\n    | \"upstage\"\n    | \"groq\"\n    | \"github-copilot\"\n    | \"mistral\"\n    | \"vercel\"\n    | \"nebius\"\n    | \"deepseek\"\n    | \"alibaba-cn\"\n    | \"google-vertex-anthropic\"\n    | \"venice\"\n    | \"chutes\"\n    | \"cortecs\"\n    | \"github-models\"\n    | \"togetherai\"\n    | \"azure\"\n    | \"baseten\"\n    | \"huggingface\"\n    | \"opencode\"\n    | \"fastrouter\"\n    | \"google\"\n    | \"google-vertex\"\n    | \"cloudflare-workers-ai\"\n    | \"inception\"\n    | \"wandb\"\n    | \"openai\"\n    | \"zhipuai-coding-plan\"\n    | \"perplexity\"\n    | \"openrouter\"\n    | \"zenmux\"\n    | \"v0\"\n    | \"iflowcn\"\n    | \"synthetic\"\n    | \"deepinfra\"\n    | \"zhipuai\"\n    | \"submodel\"\n    | \"zai\"\n    | \"inference\"\n    | \"requesty\"\n    | \"morph\"\n    | \"lmstudio\"\n    | \"anthropic\"\n    | \"aihubmix\"\n    | \"fireworks-ai\"\n    | \"modelscope\"\n    | \"llama\"\n    | \"scaleway\"\n    | \"amazon-bedrock\"\n    | \"cerebras\"\n    | (string & {});\n};\n\nexport const ModelSelectorLogo = ({\n  provider,\n  className,\n  ...props\n}: ModelSelectorLogoProps) => (\n  <img\n    {...props}\n    alt={`${provider} logo`}\n    className={cn(\"size-3 dark:invert\", className)}\n    height={12}\n    src={`https://models.dev/logos/${provider}.svg`}\n    width={12}\n  />\n);\n\nexport type ModelSelectorLogoGroupProps = ComponentProps<\"div\">;\n\nexport const ModelSelectorLogoGroup = ({\n  className,\n  ...props\n}: ModelSelectorLogoGroupProps) => (\n  <div\n    className={cn(\n      \"-space-x-1 flex shrink-0 items-center [&>img]:rounded-full [&>img]:bg-background [&>img]:p-px [&>img]:ring-1 dark:[&>img]:bg-foreground\",\n      className\n    )}\n    {...props}\n  />\n);\n\nexport type ModelSelectorNameProps = ComponentProps<\"span\">;\n\nexport const ModelSelectorName = ({\n  className,\n  ...props\n}: ModelSelectorNameProps) => (\n  <span className={cn(\"flex-1 truncate text-left\", className)} {...props} />\n);\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAWA;AAAA;AAMA;;;;;AAKO,MAAM,gBAAgB,CAAC,sBAC5B,oWAAC,6IAAM;QAAE,GAAG,KAAK;;;;;;KADN;AAMN,MAAM,uBAAuB,CAAC,sBACnC,oWAAC,oJAAa;QAAE,GAAG,KAAK;;;;;;MADb;AAQN,MAAM,uBAAuB,CAAC,EACnC,SAAS,EACT,QAAQ,EACR,QAAQ,gBAAgB,EACxB,GAAG,OACuB,iBAC1B,oWAAC,oJAAa;QAAC,WAAW,IAAA,2IAAE,EAAC,OAAO;QAAa,GAAG,KAAK;;0BACvD,oWAAC,kJAAW;gBAAC,WAAU;0BAAW;;;;;;0BAClC,oWAAC,+IAAO;gBAAC,WAAU;0BAChB;;;;;;;;;;;;MATM;AAgBb,MAAM,sBAAsB,CAAC,sBAC3B,oWAAC,qJAAa;QAAE,GAAG,KAAK;;;;;;MADpB;AAMC,MAAM,qBAAqB,CAAC,EACjC,SAAS,EACT,GAAG,OACqB,iBACxB,oWAAC,oJAAY;QAAC,WAAW,IAAA,2IAAE,EAAC,iBAAiB;QAAa,GAAG,KAAK;;;;;;MAJvD;AASN,MAAM,oBAAoB,CAAC,sBAChC,oWAAC,mJAAW;QAAE,GAAG,KAAK;;;;;;MADX;AAMN,MAAM,qBAAqB,CAAC,sBACjC,oWAAC,oJAAY;QAAE,GAAG,KAAK;;;;;;MADZ;AAMN,MAAM,qBAAqB,CAAC,sBACjC,oWAAC,oJAAY;QAAE,GAAG,KAAK;;;;;;MADZ;AAMN,MAAM,oBAAoB,CAAC,sBAChC,oWAAC,mJAAW;QAAE,GAAG,KAAK;;;;;;MADX;AAMN,MAAM,wBAAwB,CAAC,sBACpC,oWAAC,uJAAe;QAAE,GAAG,KAAK;;;;;;MADf;AAQN,MAAM,yBAAyB,CAAC,sBACrC,oWAAC,wJAAgB;QAAE,GAAG,KAAK;;;;;;OADhB;AAoEN,MAAM,oBAAoB,CAAC,EAChC,QAAQ,EACR,SAAS,EACT,GAAG,OACoB,iBACvB,oWAAC;QACE,GAAG,KAAK;QACT,KAAK,GAAG,SAAS,KAAK,CAAC;QACvB,WAAW,IAAA,2IAAE,EAAC,sBAAsB;QACpC,QAAQ;QACR,KAAK,CAAC,yBAAyB,EAAE,SAAS,IAAI,CAAC;QAC/C,OAAO;;;;;;OAXE;AAiBN,MAAM,yBAAyB,CAAC,EACrC,SAAS,EACT,GAAG,OACyB,iBAC5B,oWAAC;QACC,WAAW,IAAA,2IAAE,EACX,2IACA;QAED,GAAG,KAAK;;;;;;OATA;AAeN,MAAM,oBAAoB,CAAC,EAChC,SAAS,EACT,GAAG,OACoB,iBACvB,oWAAC;QAAK,WAAW,IAAA,2IAAE,EAAC,6BAA6B;QAAa,GAAG,KAAK;;;;;;OAJ3D"}},
    {"offset": {"line": 1081, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/ui/hover-card.tsx"],"sourcesContent":["// Re-export from @stratos/ui package\nexport * from \"@stratos/ui\";\n"],"names":[],"mappings":"AAAA,qCAAqC;;AACrC"}},
    {"offset": {"line": 1092, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/ui/input-group.tsx"],"sourcesContent":["// Re-export input-group components from @stratos/ui package\nexport {\n\tInputGroup,\n\tInputGroupAddon,\n\tInputGroupButton,\n\tInputGroupText,\n\tInputGroupInput,\n\tInputGroupTextarea,\n} from \"@stratos/ui\";\n"],"names":[],"mappings":"AAAA,4DAA4D;;AAC5D"}},
    {"offset": {"line": 1103, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/ai/prompt-input.tsx"],"sourcesContent":["\"use client\";\n\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n  CommandSeparator,\n} from \"@/components/ui/command\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  HoverCard,\n  HoverCardContent,\n  HoverCardTrigger,\n} from \"@/components/ui/hover-card\";\nimport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupButton,\n  InputGroupTextarea,\n} from \"@/components/ui/input-group\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { cn } from \"@/lib/utils\";\nimport type { ChatStatus, FileUIPart } from \"ai\";\nimport {\n  CornerDownLeftIcon,\n  ImageIcon,\n  Loader2Icon,\n  MicIcon,\n  PaperclipIcon,\n  PlusIcon,\n  SquareIcon,\n  XIcon,\n} from \"lucide-react\";\nimport { nanoid } from \"nanoid\";\nimport {\n  type ChangeEvent,\n  type ChangeEventHandler,\n  Children,\n  type ClipboardEventHandler,\n  type ComponentProps,\n  createContext,\n  type FormEvent,\n  type FormEventHandler,\n  Fragment,\n  type HTMLAttributes,\n  type KeyboardEventHandler,\n  type PropsWithChildren,\n  type ReactNode,\n  type RefObject,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\n// ============================================================================\n// Provider Context & Types\n// ============================================================================\n\nexport type AttachmentsContext = {\n  files: (FileUIPart & { id: string })[];\n  add: (files: File[] | FileList) => void;\n  remove: (id: string) => void;\n  clear: () => void;\n  openFileDialog: () => void;\n  fileInputRef: RefObject<HTMLInputElement | null>;\n};\n\nexport type TextInputContext = {\n  value: string;\n  setInput: (v: string) => void;\n  clear: () => void;\n};\n\nexport type PromptInputControllerProps = {\n  textInput: TextInputContext;\n  attachments: AttachmentsContext;\n  /** INTERNAL: Allows PromptInput to register its file textInput + \"open\" callback */\n  __registerFileInput: (\n    ref: RefObject<HTMLInputElement | null>,\n    open: () => void\n  ) => void;\n};\n\nconst PromptInputController = createContext<PromptInputControllerProps | null>(\n  null\n);\nconst ProviderAttachmentsContext = createContext<AttachmentsContext | null>(\n  null\n);\n\nexport const usePromptInputController = () => {\n  const ctx = useContext(PromptInputController);\n  if (!ctx) {\n    throw new Error(\n      \"Wrap your component inside <PromptInputProvider> to use usePromptInputController().\"\n    );\n  }\n  return ctx;\n};\n\n// Optional variants (do NOT throw). Useful for dual-mode components.\nconst useOptionalPromptInputController = () =>\n  useContext(PromptInputController);\n\nconst useProviderAttachments = () => {\n  const ctx = useContext(ProviderAttachmentsContext);\n  if (!ctx) {\n    throw new Error(\n      \"Wrap your component inside <PromptInputProvider> to use useProviderAttachments().\"\n    );\n  }\n  return ctx;\n};\n\nconst useOptionalProviderAttachments = () =>\n  useContext(ProviderAttachmentsContext);\n\nexport type PromptInputProviderProps = PropsWithChildren<{\n  initialInput?: string;\n}>;\n\n/**\n * Optional global provider that lifts PromptInput state outside of PromptInput.\n * If you don't use it, PromptInput stays fully self-managed.\n */\nexport function PromptInputProvider({\n  initialInput: initialTextInput = \"\",\n  children,\n}: PromptInputProviderProps) {\n  // ----- textInput state\n  const [textInput, setTextInput] = useState(initialTextInput);\n  const clearInput = useCallback(() => setTextInput(\"\"), []);\n\n  // ----- attachments state (global when wrapped)\n  const [attachements, setAttachements] = useState<\n    (FileUIPart & { id: string })[]\n  >([]);\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\n  const openRef = useRef<() => void>(() => {});\n\n  const add = useCallback((files: File[] | FileList) => {\n    const incoming = Array.from(files);\n    if (incoming.length === 0) {\n      return;\n    }\n\n    setAttachements((prev) =>\n      prev.concat(\n        incoming.map((file) => ({\n          id: nanoid(),\n          type: \"file\" as const,\n          url: URL.createObjectURL(file),\n          mediaType: file.type,\n          filename: file.name,\n        }))\n      )\n    );\n  }, []);\n\n  const remove = useCallback((id: string) => {\n    setAttachements((prev) => {\n      const found = prev.find((f) => f.id === id);\n      if (found?.url) {\n        URL.revokeObjectURL(found.url);\n      }\n      return prev.filter((f) => f.id !== id);\n    });\n  }, []);\n\n  const clear = useCallback(() => {\n    setAttachements((prev) => {\n      for (const f of prev) {\n        if (f.url) {\n          URL.revokeObjectURL(f.url);\n        }\n      }\n      return [];\n    });\n  }, []);\n\n  const openFileDialog = useCallback(() => {\n    openRef.current?.();\n  }, []);\n\n  const attachments = useMemo<AttachmentsContext>(\n    () => ({\n      files: attachements,\n      add,\n      remove,\n      clear,\n      openFileDialog,\n      fileInputRef,\n    }),\n    [attachements, add, remove, clear, openFileDialog]\n  );\n\n  const __registerFileInput = useCallback(\n    (ref: RefObject<HTMLInputElement | null>, open: () => void) => {\n      fileInputRef.current = ref.current;\n      openRef.current = open;\n    },\n    []\n  );\n\n  const controller = useMemo<PromptInputControllerProps>(\n    () => ({\n      textInput: {\n        value: textInput,\n        setInput: setTextInput,\n        clear: clearInput,\n      },\n      attachments,\n      __registerFileInput,\n    }),\n    [textInput, clearInput, attachments, __registerFileInput]\n  );\n\n  return (\n    <PromptInputController.Provider value={controller}>\n      <ProviderAttachmentsContext.Provider value={attachments}>\n        {children}\n      </ProviderAttachmentsContext.Provider>\n    </PromptInputController.Provider>\n  );\n}\n\n// ============================================================================\n// Component Context & Hooks\n// ============================================================================\n\nconst LocalAttachmentsContext = createContext<AttachmentsContext | null>(null);\n\nexport const usePromptInputAttachments = () => {\n  // Dual-mode: prefer provider if present, otherwise use local\n  const provider = useOptionalProviderAttachments();\n  const local = useContext(LocalAttachmentsContext);\n  const context = provider ?? local;\n  if (!context) {\n    throw new Error(\n      \"usePromptInputAttachments must be used within a PromptInput or PromptInputProvider\"\n    );\n  }\n  return context;\n};\n\nexport type PromptInputAttachmentProps = HTMLAttributes<HTMLDivElement> & {\n  data: FileUIPart & { id: string };\n  className?: string;\n};\n\nexport function PromptInputAttachment({\n  data,\n  className,\n  ...props\n}: PromptInputAttachmentProps) {\n  const attachments = usePromptInputAttachments();\n\n  const filename = data.filename || \"\";\n\n  const mediaType =\n    data.mediaType?.startsWith(\"image/\") && data.url ? \"image\" : \"file\";\n  const isImage = mediaType === \"image\";\n\n  const attachmentLabel = filename || (isImage ? \"Image\" : \"Attachment\");\n\n  return (\n    <PromptInputHoverCard>\n      <HoverCardTrigger asChild>\n        <div\n          className={cn(\n            \"group relative flex h-8 cursor-default select-none items-center gap-1.5 rounded-md border border-border px-1.5 font-medium text-sm transition-all hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50\",\n            className\n          )}\n          key={data.id}\n          {...props}\n        >\n          <div className=\"relative size-5 shrink-0\">\n            <div className=\"absolute inset-0 flex size-5 items-center justify-center overflow-hidden rounded bg-background transition-opacity group-hover:opacity-0\">\n              {isImage ? (\n                <img\n                  alt={filename || \"attachment\"}\n                  className=\"size-5 object-cover\"\n                  height={20}\n                  src={data.url}\n                  width={20}\n                />\n              ) : (\n                <div className=\"flex size-5 items-center justify-center text-muted-foreground\">\n                  <PaperclipIcon className=\"size-3\" />\n                </div>\n              )}\n            </div>\n            <Button\n              aria-label=\"Remove attachment\"\n              className=\"absolute inset-0 size-5 cursor-pointer rounded p-0 opacity-0 transition-opacity group-hover:pointer-events-auto group-hover:opacity-100 [&>svg]:size-2.5\"\n              onClick={(e) => {\n                e.stopPropagation();\n                attachments.remove(data.id);\n              }}\n              type=\"button\"\n              variant=\"ghost\"\n            >\n              <XIcon />\n              <span className=\"sr-only\">Remove</span>\n            </Button>\n          </div>\n\n          <span className=\"flex-1 truncate\">{attachmentLabel}</span>\n        </div>\n      </HoverCardTrigger>\n      <PromptInputHoverCardContent className=\"w-auto p-2\">\n        <div className=\"w-auto space-y-3\">\n          {isImage && (\n            <div className=\"flex max-h-96 w-96 items-center justify-center overflow-hidden rounded-md border\">\n              <img\n                alt={filename || \"attachment preview\"}\n                className=\"max-h-full max-w-full object-contain\"\n                height={384}\n                src={data.url}\n                width={448}\n              />\n            </div>\n          )}\n          <div className=\"flex items-center gap-2.5\">\n            <div className=\"min-w-0 flex-1 space-y-1 px-0.5\">\n              <h4 className=\"truncate font-semibold text-sm leading-none\">\n                {filename || (isImage ? \"Image\" : \"Attachment\")}\n              </h4>\n              {data.mediaType && (\n                <p className=\"truncate font-mono text-muted-foreground text-xs\">\n                  {data.mediaType}\n                </p>\n              )}\n            </div>\n          </div>\n        </div>\n      </PromptInputHoverCardContent>\n    </PromptInputHoverCard>\n  );\n}\n\nexport type PromptInputAttachmentsProps = Omit<\n  HTMLAttributes<HTMLDivElement>,\n  \"children\"\n> & {\n  children: (attachment: FileUIPart & { id: string }) => ReactNode;\n};\n\nexport function PromptInputAttachments({\n  children,\n  className,\n  ...props\n}: PromptInputAttachmentsProps) {\n  const attachments = usePromptInputAttachments();\n\n  if (!attachments.files.length) {\n    return null;\n  }\n\n  return (\n    <div\n      className={cn(\"flex flex-wrap items-center gap-2 p-3\", className)}\n      {...props}\n    >\n      {attachments.files.map((file) => (\n        <Fragment key={file.id}>{children(file)}</Fragment>\n      ))}\n    </div>\n  );\n}\n\nexport type PromptInputActionAddAttachmentsProps = ComponentProps<\n  typeof DropdownMenuItem\n> & {\n  label?: string;\n};\n\nexport const PromptInputActionAddAttachments = ({\n  label = \"Add photos or files\",\n  ...props\n}: PromptInputActionAddAttachmentsProps) => {\n  const attachments = usePromptInputAttachments();\n\n  return (\n    <DropdownMenuItem\n      {...props}\n      onSelect={(e) => {\n        e.preventDefault();\n        attachments.openFileDialog();\n      }}\n    >\n      <ImageIcon className=\"mr-2 size-4\" /> {label}\n    </DropdownMenuItem>\n  );\n};\n\nexport type PromptInputMessage = {\n  text: string;\n  files: FileUIPart[];\n};\n\nexport type PromptInputProps = Omit<\n  HTMLAttributes<HTMLFormElement>,\n  \"onSubmit\" | \"onError\"\n> & {\n  accept?: string; // e.g., \"image/*\" or leave undefined for any\n  multiple?: boolean;\n  // When true, accepts drops anywhere on document. Default false (opt-in).\n  globalDrop?: boolean;\n  // Render a hidden input with given name and keep it in sync for native form posts. Default false.\n  syncHiddenInput?: boolean;\n  // Minimal constraints\n  maxFiles?: number;\n  maxFileSize?: number; // bytes\n  onError?: (err: {\n    code: \"max_files\" | \"max_file_size\" | \"accept\";\n    message: string;\n  }) => void;\n  onSubmit: (\n    message: PromptInputMessage,\n    event: FormEvent<HTMLFormElement>\n  ) => void | Promise<void>;\n};\n\nexport const PromptInput = ({\n  className,\n  accept,\n  multiple,\n  globalDrop,\n  syncHiddenInput,\n  maxFiles,\n  maxFileSize,\n  onError,\n  onSubmit,\n  children,\n  ...props\n}: PromptInputProps) => {\n  // Try to use a provider controller if present\n  const controller = useOptionalPromptInputController();\n  const usingProvider = !!controller;\n\n  // Refs\n  const inputRef = useRef<HTMLInputElement | null>(null);\n  const anchorRef = useRef<HTMLSpanElement>(null);\n  const formRef = useRef<HTMLFormElement | null>(null);\n\n  // Find nearest form to scope drag & drop\n  useEffect(() => {\n    const root = anchorRef.current?.closest(\"form\");\n    if (root instanceof HTMLFormElement) {\n      formRef.current = root;\n    }\n  }, []);\n\n  // ----- Local attachments (only used when no provider)\n  const [items, setItems] = useState<(FileUIPart & { id: string })[]>([]);\n  const files = usingProvider ? controller.attachments.files : items;\n\n  const openFileDialogLocal = useCallback(() => {\n    inputRef.current?.click();\n  }, []);\n\n  const matchesAccept = useCallback(\n    (f: File) => {\n      if (!accept || accept.trim() === \"\") {\n        return true;\n      }\n      if (accept.includes(\"image/*\")) {\n        return f.type.startsWith(\"image/\");\n      }\n      // NOTE: keep simple; expand as needed\n      return true;\n    },\n    [accept]\n  );\n\n  const addLocal = useCallback(\n    (fileList: File[] | FileList) => {\n      const incoming = Array.from(fileList);\n      const accepted = incoming.filter((f) => matchesAccept(f));\n      if (incoming.length && accepted.length === 0) {\n        onError?.({\n          code: \"accept\",\n          message: \"No files match the accepted types.\",\n        });\n        return;\n      }\n      const withinSize = (f: File) =>\n        maxFileSize ? f.size <= maxFileSize : true;\n      const sized = accepted.filter(withinSize);\n      if (accepted.length > 0 && sized.length === 0) {\n        onError?.({\n          code: \"max_file_size\",\n          message: \"All files exceed the maximum size.\",\n        });\n        return;\n      }\n\n      setItems((prev) => {\n        const capacity =\n          typeof maxFiles === \"number\"\n            ? Math.max(0, maxFiles - prev.length)\n            : undefined;\n        const capped =\n          typeof capacity === \"number\" ? sized.slice(0, capacity) : sized;\n        if (typeof capacity === \"number\" && sized.length > capacity) {\n          onError?.({\n            code: \"max_files\",\n            message: \"Too many files. Some were not added.\",\n          });\n        }\n        const next: (FileUIPart & { id: string })[] = [];\n        for (const file of capped) {\n          next.push({\n            id: nanoid(),\n            type: \"file\",\n            url: URL.createObjectURL(file),\n            mediaType: file.type,\n            filename: file.name,\n          });\n        }\n        return prev.concat(next);\n      });\n    },\n    [matchesAccept, maxFiles, maxFileSize, onError]\n  );\n\n  const add = usingProvider\n    ? (files: File[] | FileList) => controller.attachments.add(files)\n    : addLocal;\n\n  const remove = usingProvider\n    ? (id: string) => controller.attachments.remove(id)\n    : (id: string) =>\n        setItems((prev) => {\n          const found = prev.find((file) => file.id === id);\n          if (found?.url) {\n            URL.revokeObjectURL(found.url);\n          }\n          return prev.filter((file) => file.id !== id);\n        });\n\n  const clear = usingProvider\n    ? () => controller.attachments.clear()\n    : () =>\n        setItems((prev) => {\n          for (const file of prev) {\n            if (file.url) {\n              URL.revokeObjectURL(file.url);\n            }\n          }\n          return [];\n        });\n\n  const openFileDialog = usingProvider\n    ? () => controller.attachments.openFileDialog()\n    : openFileDialogLocal;\n\n  // Let provider know about our hidden file input so external menus can call openFileDialog()\n  useEffect(() => {\n    if (!usingProvider) return;\n    controller.__registerFileInput(inputRef, () => inputRef.current?.click());\n  }, [usingProvider, controller]);\n\n  // Note: File input cannot be programmatically set for security reasons\n  // The syncHiddenInput prop is no longer functional\n  useEffect(() => {\n    if (syncHiddenInput && inputRef.current && files.length === 0) {\n      inputRef.current.value = \"\";\n    }\n  }, [files, syncHiddenInput]);\n\n  // Attach drop handlers on nearest form and document (opt-in)\n  useEffect(() => {\n    const form = formRef.current;\n    if (!form) return;\n\n    const onDragOver = (e: DragEvent) => {\n      if (e.dataTransfer?.types?.includes(\"Files\")) {\n        e.preventDefault();\n      }\n    };\n    const onDrop = (e: DragEvent) => {\n      if (e.dataTransfer?.types?.includes(\"Files\")) {\n        e.preventDefault();\n      }\n      if (e.dataTransfer?.files && e.dataTransfer.files.length > 0) {\n        add(e.dataTransfer.files);\n      }\n    };\n    form.addEventListener(\"dragover\", onDragOver);\n    form.addEventListener(\"drop\", onDrop);\n    return () => {\n      form.removeEventListener(\"dragover\", onDragOver);\n      form.removeEventListener(\"drop\", onDrop);\n    };\n  }, [add]);\n\n  useEffect(() => {\n    if (!globalDrop) return;\n\n    const onDragOver = (e: DragEvent) => {\n      if (e.dataTransfer?.types?.includes(\"Files\")) {\n        e.preventDefault();\n      }\n    };\n    const onDrop = (e: DragEvent) => {\n      if (e.dataTransfer?.types?.includes(\"Files\")) {\n        e.preventDefault();\n      }\n      if (e.dataTransfer?.files && e.dataTransfer.files.length > 0) {\n        add(e.dataTransfer.files);\n      }\n    };\n    document.addEventListener(\"dragover\", onDragOver);\n    document.addEventListener(\"drop\", onDrop);\n    return () => {\n      document.removeEventListener(\"dragover\", onDragOver);\n      document.removeEventListener(\"drop\", onDrop);\n    };\n  }, [add, globalDrop]);\n\n  useEffect(\n    () => () => {\n      if (!usingProvider) {\n        for (const f of files) {\n          if (f.url) URL.revokeObjectURL(f.url);\n        }\n      }\n    },\n    [usingProvider, files]\n  );\n\n  const handleChange: ChangeEventHandler<HTMLInputElement> = (event) => {\n    if (event.currentTarget.files) {\n      add(event.currentTarget.files);\n    }\n  };\n\n  const convertBlobUrlToDataUrl = async (url: string): Promise<string> => {\n    const response = await fetch(url);\n    const blob = await response.blob();\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onloadend = () => resolve(reader.result as string);\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  };\n\n  const ctx = useMemo<AttachmentsContext>(\n    () => ({\n      files: files.map((item) => ({ ...item, id: item.id })),\n      add,\n      remove,\n      clear,\n      openFileDialog,\n      fileInputRef: inputRef,\n    }),\n    [files, add, remove, clear, openFileDialog]\n  );\n\n  const handleSubmit: FormEventHandler<HTMLFormElement> = (event) => {\n    event.preventDefault();\n\n    const form = event.currentTarget;\n    const text = usingProvider\n      ? controller.textInput.value\n      : (() => {\n          const formData = new FormData(form);\n          return (formData.get(\"message\") as string) || \"\";\n        })();\n\n    // Reset form immediately after capturing text to avoid race condition\n    // where user input during async blob conversion would be lost\n    if (!usingProvider) {\n      form.reset();\n    }\n\n    // Convert blob URLs to data URLs asynchronously\n    Promise.all(\n      files.map(async ({ id, ...item }) => {\n        if (item.url && item.url.startsWith(\"blob:\")) {\n          return {\n            ...item,\n            url: await convertBlobUrlToDataUrl(item.url),\n          };\n        }\n        return item;\n      })\n    )\n      .then((convertedFiles: FileUIPart[]) => {\n        try {\n          const result = onSubmit({ text, files: convertedFiles }, event);\n\n          // Handle both sync and async onSubmit\n          if (result instanceof Promise) {\n            result\n              .then(() => {\n                clear();\n                if (usingProvider) {\n                  controller.textInput.clear();\n                }\n              })\n              .catch(() => {\n                // Don't clear on error - user may want to retry\n              });\n          } else {\n            // Sync function completed without throwing, clear attachments\n            clear();\n            if (usingProvider) {\n              controller.textInput.clear();\n            }\n          }\n        } catch (error) {\n          // Don't clear on error - user may want to retry\n        }\n      })\n      .catch((error) => {\n        // Handle blob conversion errors gracefully\n        // Submit with original files if conversion fails\n        console.error(\"Failed to convert blob URLs:\", error);\n        const originalFiles = files.map(({ id, ...item }) => item);\n        onSubmit({ text, files: originalFiles }, event);\n      });\n  };\n\n  // Render with or without local provider\n  const inner = (\n    <>\n      <span aria-hidden=\"true\" className=\"hidden\" ref={anchorRef} />\n      <input\n        accept={accept}\n        aria-label=\"Upload files\"\n        className=\"hidden\"\n        multiple={multiple}\n        onChange={handleChange}\n        ref={inputRef}\n        title=\"Upload files\"\n        type=\"file\"\n      />\n      <form\n        className={cn(\"w-full\", className)}\n        onSubmit={handleSubmit}\n        {...props}\n      >\n        <InputGroup className=\"overflow-hidden\">{children}</InputGroup>\n      </form>\n    </>\n  );\n\n  return usingProvider ? (\n    inner\n  ) : (\n    <LocalAttachmentsContext.Provider value={ctx}>\n      {inner}\n    </LocalAttachmentsContext.Provider>\n  );\n};\n\nexport type PromptInputBodyProps = HTMLAttributes<HTMLDivElement>;\n\nexport const PromptInputBody = ({\n  className,\n  ...props\n}: PromptInputBodyProps) => (\n  <div className={cn(\"contents\", className)} {...props} />\n);\n\nexport type PromptInputTextareaProps = ComponentProps<\n  typeof InputGroupTextarea\n>;\n\nexport const PromptInputTextarea = ({\n  onChange,\n  className,\n  placeholder = \"What would you like to know?\",\n  ...props\n}: PromptInputTextareaProps) => {\n  const controller = useOptionalPromptInputController();\n  const attachments = usePromptInputAttachments();\n  const [isComposing, setIsComposing] = useState(false);\n\n  const handleKeyDown: KeyboardEventHandler<HTMLTextAreaElement> = (e) => {\n    if (e.key === \"Enter\") {\n      if (isComposing || e.nativeEvent.isComposing) {\n        return;\n      }\n      if (e.shiftKey) {\n        return;\n      }\n      e.preventDefault();\n\n      // Check if the submit button is disabled before submitting\n      const form = e.currentTarget.form;\n      const submitButton = form?.querySelector(\n        'button[type=\"submit\"]'\n      ) as HTMLButtonElement | null;\n      if (submitButton?.disabled) {\n        return;\n      }\n\n      form?.requestSubmit();\n    }\n\n    // Remove last attachment when Backspace is pressed and textarea is empty\n    if (\n      e.key === \"Backspace\" &&\n      e.currentTarget.value === \"\" &&\n      attachments.files.length > 0\n    ) {\n      e.preventDefault();\n      const lastAttachment = attachments.files.at(-1);\n      if (lastAttachment) {\n        attachments.remove(lastAttachment.id);\n      }\n    }\n  };\n\n  const handlePaste: ClipboardEventHandler<HTMLTextAreaElement> = (event) => {\n    const items = event.clipboardData?.items;\n\n    if (!items) {\n      return;\n    }\n\n    const files: File[] = [];\n\n    for (const item of items) {\n      if (item.kind === \"file\") {\n        const file = item.getAsFile();\n        if (file) {\n          files.push(file);\n        }\n      }\n    }\n\n    if (files.length > 0) {\n      event.preventDefault();\n      attachments.add(files);\n    }\n  };\n\n  const controlledProps = controller\n    ? {\n        value: controller.textInput.value,\n        onChange: (e: ChangeEvent<HTMLTextAreaElement>) => {\n          controller.textInput.setInput(e.currentTarget.value);\n          onChange?.(e);\n        },\n      }\n    : {\n        onChange,\n      };\n\n  return (\n    <InputGroupTextarea\n      className={cn(\"field-sizing-content max-h-48 min-h-16\", className)}\n      name=\"message\"\n      onCompositionEnd={() => setIsComposing(false)}\n      onCompositionStart={() => setIsComposing(true)}\n      onKeyDown={handleKeyDown}\n      onPaste={handlePaste}\n      placeholder={placeholder}\n      {...props}\n      {...controlledProps}\n    />\n  );\n};\n\nexport type PromptInputHeaderProps = Omit<\n  ComponentProps<typeof InputGroupAddon>,\n  \"align\"\n>;\n\nexport const PromptInputHeader = ({\n  className,\n  ...props\n}: PromptInputHeaderProps) => (\n  <InputGroupAddon\n    align=\"block-end\"\n    className={cn(\"order-first flex-wrap gap-1\", className)}\n    {...props}\n  />\n);\n\nexport type PromptInputFooterProps = Omit<\n  ComponentProps<typeof InputGroupAddon>,\n  \"align\"\n>;\n\nexport const PromptInputFooter = ({\n  className,\n  ...props\n}: PromptInputFooterProps) => (\n  <InputGroupAddon\n    align=\"block-end\"\n    className={cn(\"justify-between gap-1\", className)}\n    {...props}\n  />\n);\n\nexport type PromptInputToolsProps = HTMLAttributes<HTMLDivElement>;\n\nexport const PromptInputTools = ({\n  className,\n  ...props\n}: PromptInputToolsProps) => (\n  <div className={cn(\"flex items-center gap-1\", className)} {...props} />\n);\n\nexport type PromptInputButtonProps = ComponentProps<typeof InputGroupButton>;\n\nexport const PromptInputButton = ({\n  variant = \"ghost\",\n  className,\n  size,\n  ...props\n}: PromptInputButtonProps) => {\n  const newSize =\n    size ?? (Children.count(props.children) > 1 ? \"sm\" : \"icon-sm\");\n\n  return (\n    <InputGroupButton\n      className={cn(className)}\n      size={newSize}\n      type=\"button\"\n      variant={variant}\n      {...props}\n    />\n  );\n};\n\nexport type PromptInputActionMenuProps = ComponentProps<typeof DropdownMenu>;\nexport const PromptInputActionMenu = (props: PromptInputActionMenuProps) => (\n  <DropdownMenu {...props} />\n);\n\nexport type PromptInputActionMenuTriggerProps = PromptInputButtonProps;\n\nexport const PromptInputActionMenuTrigger = ({\n  className,\n  children,\n  ...props\n}: PromptInputActionMenuTriggerProps) => (\n  <DropdownMenuTrigger asChild>\n    <PromptInputButton className={className} {...props}>\n      {children ?? <PlusIcon className=\"size-4\" />}\n    </PromptInputButton>\n  </DropdownMenuTrigger>\n);\n\nexport type PromptInputActionMenuContentProps = ComponentProps<\n  typeof DropdownMenuContent\n>;\nexport const PromptInputActionMenuContent = ({\n  className,\n  ...props\n}: PromptInputActionMenuContentProps) => (\n  <DropdownMenuContent align=\"start\" className={cn(className)} {...props} />\n);\n\nexport type PromptInputActionMenuItemProps = ComponentProps<\n  typeof DropdownMenuItem\n>;\nexport const PromptInputActionMenuItem = ({\n  className,\n  ...props\n}: PromptInputActionMenuItemProps) => (\n  <DropdownMenuItem className={cn(className)} {...props} />\n);\n\n// Note: Actions that perform side-effects (like opening a file dialog)\n// are provided in opt-in modules (e.g., prompt-input-attachments).\n\nexport type PromptInputSubmitProps = ComponentProps<typeof InputGroupButton> & {\n  status?: ChatStatus;\n};\n\nexport const PromptInputSubmit = ({\n  className,\n  variant = \"default\",\n  size = \"icon-sm\",\n  status,\n  children,\n  ...props\n}: PromptInputSubmitProps) => {\n  let Icon = <CornerDownLeftIcon className=\"size-4\" />;\n\n  if (status === \"submitted\") {\n    Icon = <Loader2Icon className=\"size-4 animate-spin\" />;\n  } else if (status === \"streaming\") {\n    Icon = <SquareIcon className=\"size-4\" />;\n  } else if (status === \"error\") {\n    Icon = <XIcon className=\"size-4\" />;\n  }\n\n  return (\n    <InputGroupButton\n      aria-label=\"Submit\"\n      className={cn(className)}\n      size={size}\n      type=\"submit\"\n      variant={variant}\n      {...props}\n    >\n      {children ?? Icon}\n    </InputGroupButton>\n  );\n};\n\ninterface SpeechRecognition extends EventTarget {\n  continuous: boolean;\n  interimResults: boolean;\n  lang: string;\n  start(): void;\n  stop(): void;\n  onstart: ((this: SpeechRecognition, ev: Event) => any) | null;\n  onend: ((this: SpeechRecognition, ev: Event) => any) | null;\n  onresult:\n    | ((this: SpeechRecognition, ev: SpeechRecognitionEvent) => any)\n    | null;\n  onerror:\n    | ((this: SpeechRecognition, ev: SpeechRecognitionErrorEvent) => any)\n    | null;\n}\n\ninterface SpeechRecognitionEvent extends Event {\n  results: SpeechRecognitionResultList;\n  resultIndex: number;\n}\n\ntype SpeechRecognitionResultList = {\n  readonly length: number;\n  item(index: number): SpeechRecognitionResult;\n  [index: number]: SpeechRecognitionResult;\n};\n\ntype SpeechRecognitionResult = {\n  readonly length: number;\n  item(index: number): SpeechRecognitionAlternative;\n  [index: number]: SpeechRecognitionAlternative;\n  isFinal: boolean;\n};\n\ntype SpeechRecognitionAlternative = {\n  transcript: string;\n  confidence: number;\n};\n\ninterface SpeechRecognitionErrorEvent extends Event {\n  error: string;\n}\n\ndeclare global {\n  interface Window {\n    SpeechRecognition: {\n      new (): SpeechRecognition;\n    };\n    webkitSpeechRecognition: {\n      new (): SpeechRecognition;\n    };\n  }\n}\n\nexport type PromptInputSpeechButtonProps = ComponentProps<\n  typeof PromptInputButton\n> & {\n  textareaRef?: RefObject<HTMLTextAreaElement | null>;\n  onTranscriptionChange?: (text: string) => void;\n};\n\nexport const PromptInputSpeechButton = ({\n  className,\n  textareaRef,\n  onTranscriptionChange,\n  ...props\n}: PromptInputSpeechButtonProps) => {\n  const [isListening, setIsListening] = useState(false);\n  const [recognition, setRecognition] = useState<SpeechRecognition | null>(\n    null\n  );\n  const recognitionRef = useRef<SpeechRecognition | null>(null);\n\n  useEffect(() => {\n    if (\n      typeof window !== \"undefined\" &&\n      (\"SpeechRecognition\" in window || \"webkitSpeechRecognition\" in window)\n    ) {\n      const SpeechRecognition =\n        window.SpeechRecognition || window.webkitSpeechRecognition;\n      const speechRecognition = new SpeechRecognition();\n\n      speechRecognition.continuous = true;\n      speechRecognition.interimResults = true;\n      speechRecognition.lang = \"en-US\";\n\n      speechRecognition.onstart = () => {\n        setIsListening(true);\n      };\n\n      speechRecognition.onend = () => {\n        setIsListening(false);\n      };\n\n      speechRecognition.onresult = (event) => {\n        let finalTranscript = \"\";\n\n        for (let i = event.resultIndex; i < event.results.length; i++) {\n          const result = event.results[i];\n          if (result.isFinal) {\n            finalTranscript += result[0]?.transcript ?? \"\";\n          }\n        }\n\n        if (finalTranscript && textareaRef?.current) {\n          const textarea = textareaRef.current;\n          const currentValue = textarea.value;\n          const newValue =\n            currentValue + (currentValue ? \" \" : \"\") + finalTranscript;\n\n          textarea.value = newValue;\n          textarea.dispatchEvent(new Event(\"input\", { bubbles: true }));\n          onTranscriptionChange?.(newValue);\n        }\n      };\n\n      speechRecognition.onerror = (event) => {\n        console.error(\"Speech recognition error:\", event.error);\n        setIsListening(false);\n      };\n\n      recognitionRef.current = speechRecognition;\n      setRecognition(speechRecognition);\n    }\n\n    return () => {\n      if (recognitionRef.current) {\n        recognitionRef.current.stop();\n      }\n    };\n  }, [textareaRef, onTranscriptionChange]);\n\n  const toggleListening = useCallback(() => {\n    if (!recognition) {\n      return;\n    }\n\n    if (isListening) {\n      recognition.stop();\n    } else {\n      recognition.start();\n    }\n  }, [recognition, isListening]);\n\n  return (\n    <PromptInputButton\n      className={cn(\n        \"relative transition-all duration-200\",\n        isListening && \"animate-pulse bg-accent text-accent-foreground\",\n        className\n      )}\n      disabled={!recognition}\n      onClick={toggleListening}\n      {...props}\n    >\n      <MicIcon className=\"size-4\" />\n    </PromptInputButton>\n  );\n};\n\nexport type PromptInputSelectProps = ComponentProps<typeof Select>;\n\nexport const PromptInputSelect = (props: PromptInputSelectProps) => (\n  <Select {...props} />\n);\n\nexport type PromptInputSelectTriggerProps = ComponentProps<\n  typeof SelectTrigger\n>;\n\nexport const PromptInputSelectTrigger = ({\n  className,\n  ...props\n}: PromptInputSelectTriggerProps) => (\n  <SelectTrigger\n    className={cn(\n      \"border-none bg-transparent font-medium text-muted-foreground shadow-none transition-colors\",\n      \"hover:bg-accent hover:text-foreground aria-expanded:bg-accent aria-expanded:text-foreground\",\n      className\n    )}\n    {...props}\n  />\n);\n\nexport type PromptInputSelectContentProps = ComponentProps<\n  typeof SelectContent\n>;\n\nexport const PromptInputSelectContent = ({\n  className,\n  ...props\n}: PromptInputSelectContentProps) => (\n  <SelectContent className={cn(className)} {...props} />\n);\n\nexport type PromptInputSelectItemProps = ComponentProps<typeof SelectItem>;\n\nexport const PromptInputSelectItem = ({\n  className,\n  ...props\n}: PromptInputSelectItemProps) => (\n  <SelectItem className={cn(className)} {...props} />\n);\n\nexport type PromptInputSelectValueProps = ComponentProps<typeof SelectValue>;\n\nexport const PromptInputSelectValue = ({\n  className,\n  ...props\n}: PromptInputSelectValueProps) => (\n  <SelectValue className={cn(className)} {...props} />\n);\n\nexport type PromptInputHoverCardProps = ComponentProps<typeof HoverCard>;\n\nexport const PromptInputHoverCard = ({\n  openDelay = 0,\n  closeDelay = 0,\n  ...props\n}: PromptInputHoverCardProps) => (\n  <HoverCard closeDelay={closeDelay} openDelay={openDelay} {...props} />\n);\n\nexport type PromptInputHoverCardTriggerProps = ComponentProps<\n  typeof HoverCardTrigger\n>;\n\nexport const PromptInputHoverCardTrigger = (\n  props: PromptInputHoverCardTriggerProps\n) => <HoverCardTrigger {...props} />;\n\nexport type PromptInputHoverCardContentProps = ComponentProps<\n  typeof HoverCardContent\n>;\n\nexport const PromptInputHoverCardContent = ({\n  align = \"start\",\n  ...props\n}: PromptInputHoverCardContentProps) => (\n  <HoverCardContent align={align} {...props} />\n);\n\nexport type PromptInputTabsListProps = HTMLAttributes<HTMLDivElement>;\n\nexport const PromptInputTabsList = ({\n  className,\n  ...props\n}: PromptInputTabsListProps) => <div className={cn(className)} {...props} />;\n\nexport type PromptInputTabProps = HTMLAttributes<HTMLDivElement>;\n\nexport const PromptInputTab = ({\n  className,\n  ...props\n}: PromptInputTabProps) => <div className={cn(className)} {...props} />;\n\nexport type PromptInputTabLabelProps = HTMLAttributes<HTMLHeadingElement>;\n\nexport const PromptInputTabLabel = ({\n  className,\n  ...props\n}: PromptInputTabLabelProps) => (\n  <h3\n    className={cn(\n      \"mb-2 px-3 font-medium text-muted-foreground text-xs\",\n      className\n    )}\n    {...props}\n  />\n);\n\nexport type PromptInputTabBodyProps = HTMLAttributes<HTMLDivElement>;\n\nexport const PromptInputTabBody = ({\n  className,\n  ...props\n}: PromptInputTabBodyProps) => (\n  <div className={cn(\"space-y-1\", className)} {...props} />\n);\n\nexport type PromptInputTabItemProps = HTMLAttributes<HTMLDivElement>;\n\nexport const PromptInputTabItem = ({\n  className,\n  ...props\n}: PromptInputTabItemProps) => (\n  <div\n    className={cn(\n      \"flex items-center gap-2 px-3 py-2 text-xs hover:bg-accent\",\n      className\n    )}\n    {...props}\n  />\n);\n\nexport type PromptInputCommandProps = ComponentProps<typeof Command>;\n\nexport const PromptInputCommand = ({\n  className,\n  ...props\n}: PromptInputCommandProps) => <Command className={cn(className)} {...props} />;\n\nexport type PromptInputCommandInputProps = ComponentProps<typeof CommandInput>;\n\nexport const PromptInputCommandInput = ({\n  className,\n  ...props\n}: PromptInputCommandInputProps) => (\n  <CommandInput className={cn(className)} {...props} />\n);\n\nexport type PromptInputCommandListProps = ComponentProps<typeof CommandList>;\n\nexport const PromptInputCommandList = ({\n  className,\n  ...props\n}: PromptInputCommandListProps) => (\n  <CommandList className={cn(className)} {...props} />\n);\n\nexport type PromptInputCommandEmptyProps = ComponentProps<typeof CommandEmpty>;\n\nexport const PromptInputCommandEmpty = ({\n  className,\n  ...props\n}: PromptInputCommandEmptyProps) => (\n  <CommandEmpty className={cn(className)} {...props} />\n);\n\nexport type PromptInputCommandGroupProps = ComponentProps<typeof CommandGroup>;\n\nexport const PromptInputCommandGroup = ({\n  className,\n  ...props\n}: PromptInputCommandGroupProps) => (\n  <CommandGroup className={cn(className)} {...props} />\n);\n\nexport type PromptInputCommandItemProps = ComponentProps<typeof CommandItem>;\n\nexport const PromptInputCommandItem = ({\n  className,\n  ...props\n}: PromptInputCommandItemProps) => (\n  <CommandItem className={cn(className)} {...props} />\n);\n\nexport type PromptInputCommandSeparatorProps = ComponentProps<\n  typeof CommandSeparator\n>;\n\nexport const PromptInputCommandSeparator = ({\n  className,\n  ...props\n}: PromptInputCommandSeparatorProps) => (\n  <CommandSeparator className={cn(className)} {...props} />\n);\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2564, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/ai/loader.tsx"],"sourcesContent":["import { cn } from \"@/lib/utils\";\nimport type { HTMLAttributes } from \"react\";\n\ntype LoaderIconProps = {\n  size?: number;\n};\n\nconst LoaderIcon = ({ size = 16 }: LoaderIconProps) => (\n  <svg\n    height={size}\n    strokeLinejoin=\"round\"\n    style={{ color: \"currentcolor\" }}\n    viewBox=\"0 0 16 16\"\n    width={size}\n  >\n    <title>Loader</title>\n    <g clipPath=\"url(#clip0_2393_1490)\">\n      <path d=\"M8 0V4\" stroke=\"currentColor\" strokeWidth=\"1.5\" />\n      <path\n        d=\"M8 16V12\"\n        opacity=\"0.5\"\n        stroke=\"currentColor\"\n        strokeWidth=\"1.5\"\n      />\n      <path\n        d=\"M3.29773 1.52783L5.64887 4.7639\"\n        opacity=\"0.9\"\n        stroke=\"currentColor\"\n        strokeWidth=\"1.5\"\n      />\n      <path\n        d=\"M12.7023 1.52783L10.3511 4.7639\"\n        opacity=\"0.1\"\n        stroke=\"currentColor\"\n        strokeWidth=\"1.5\"\n      />\n      <path\n        d=\"M12.7023 14.472L10.3511 11.236\"\n        opacity=\"0.4\"\n        stroke=\"currentColor\"\n        strokeWidth=\"1.5\"\n      />\n      <path\n        d=\"M3.29773 14.472L5.64887 11.236\"\n        opacity=\"0.6\"\n        stroke=\"currentColor\"\n        strokeWidth=\"1.5\"\n      />\n      <path\n        d=\"M15.6085 5.52783L11.8043 6.7639\"\n        opacity=\"0.2\"\n        stroke=\"currentColor\"\n        strokeWidth=\"1.5\"\n      />\n      <path\n        d=\"M0.391602 10.472L4.19583 9.23598\"\n        opacity=\"0.7\"\n        stroke=\"currentColor\"\n        strokeWidth=\"1.5\"\n      />\n      <path\n        d=\"M15.6085 10.4722L11.8043 9.2361\"\n        opacity=\"0.3\"\n        stroke=\"currentColor\"\n        strokeWidth=\"1.5\"\n      />\n      <path\n        d=\"M0.391602 5.52783L4.19583 6.7639\"\n        opacity=\"0.8\"\n        stroke=\"currentColor\"\n        strokeWidth=\"1.5\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_2393_1490\">\n        <rect fill=\"white\" height=\"16\" width=\"16\" />\n      </clipPath>\n    </defs>\n  </svg>\n);\n\nexport type LoaderProps = HTMLAttributes<HTMLDivElement> & {\n  size?: number;\n};\n\nexport const Loader = ({ className, size = 16, ...props }: LoaderProps) => (\n  <div\n    className={cn(\n      \"inline-flex animate-spin items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    <LoaderIcon size={size} />\n  </div>\n);\n"],"names":[],"mappings":";;;;;AAAA;;;AAOA,MAAM,aAAa,CAAC,EAAE,OAAO,EAAE,EAAmB,iBAChD,oWAAC;QACC,QAAQ;QACR,gBAAe;QACf,OAAO;YAAE,OAAO;QAAe;QAC/B,SAAQ;QACR,OAAO;;0BAEP,oWAAC;0BAAM;;;;;;0BACP,oWAAC;gBAAE,UAAS;;kCACV,oWAAC;wBAAK,GAAE;wBAAS,QAAO;wBAAe,aAAY;;;;;;kCACnD,oWAAC;wBACC,GAAE;wBACF,SAAQ;wBACR,QAAO;wBACP,aAAY;;;;;;kCAEd,oWAAC;wBACC,GAAE;wBACF,SAAQ;wBACR,QAAO;wBACP,aAAY;;;;;;kCAEd,oWAAC;wBACC,GAAE;wBACF,SAAQ;wBACR,QAAO;wBACP,aAAY;;;;;;kCAEd,oWAAC;wBACC,GAAE;wBACF,SAAQ;wBACR,QAAO;wBACP,aAAY;;;;;;kCAEd,oWAAC;wBACC,GAAE;wBACF,SAAQ;wBACR,QAAO;wBACP,aAAY;;;;;;kCAEd,oWAAC;wBACC,GAAE;wBACF,SAAQ;wBACR,QAAO;wBACP,aAAY;;;;;;kCAEd,oWAAC;wBACC,GAAE;wBACF,SAAQ;wBACR,QAAO;wBACP,aAAY;;;;;;kCAEd,oWAAC;wBACC,GAAE;wBACF,SAAQ;wBACR,QAAO;wBACP,aAAY;;;;;;kCAEd,oWAAC;wBACC,GAAE;wBACF,SAAQ;wBACR,QAAO;wBACP,aAAY;;;;;;;;;;;;0BAGhB,oWAAC;0BACC,cAAA,oWAAC;oBAAS,IAAG;8BACX,cAAA,oWAAC;wBAAK,MAAK;wBAAQ,QAAO;wBAAK,OAAM;;;;;;;;;;;;;;;;;;;;;;KApEvC;AA8EC,MAAM,SAAS,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,EAAE,GAAG,OAAoB,iBACpE,oWAAC;QACC,WAAW,IAAA,2IAAE,EACX,wDACA;QAED,GAAG,KAAK;kBAET,cAAA,oWAAC;YAAW,MAAM;;;;;;;;;;;MART"}},
    {"offset": {"line": 2751, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/ai/owner-action-approval-dialog.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDialog,\n\tDialogContent,\n\tDialogDescription,\n\tDialogFooter,\n\tDialogHeader,\n\tDialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n\tAlertTriangle,\n\tShield,\n\tCheck,\n\tX,\n\tLoader2,\n\tClock,\n\tMail,\n\tMessageSquare,\n\tPhone,\n\tDollarSign,\n\tCalendar,\n\tUser,\n\tBuilding,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\n// Types matching the service\ninterface PendingAction {\n\tid: string;\n\tcompanyId: string;\n\tchatId: string;\n\tmessageId: string;\n\tuserId: string;\n\ttoolName: string;\n\ttoolArgs: Record<string, unknown>;\n\tactionType: string;\n\taffectedEntityType: string;\n\taffectedEntityIds: string[];\n\taffectedCount: number;\n\triskLevel: \"low\" | \"medium\" | \"high\" | \"critical\";\n\tstatus: \"pending\" | \"approved\" | \"rejected\" | \"expired\" | \"executed\" | \"failed\";\n\texpiresAt: string;\n\tcreatedAt: string;\n}\n\ninterface OwnerActionApprovalDialogProps {\n\tpendingAction: PendingAction | null;\n\tisOpen: boolean;\n\tonOpenChange: (open: boolean) => void;\n\tonApprove: (actionId: string) => Promise<{ success: boolean; error?: string }>;\n\tonReject: (actionId: string, reason?: string) => Promise<{ success: boolean; error?: string }>;\n\tisOwner: boolean;\n\tclassName?: string;\n}\n\nconst riskLevelConfig = {\n\tlow: {\n\t\tcolor: \"bg-blue-500/10 text-blue-500 border-blue-500/20\",\n\t\ticon: Shield,\n\t\tlabel: \"Low Risk\",\n\t},\n\tmedium: {\n\t\tcolor: \"bg-yellow-500/10 text-yellow-500 border-yellow-500/20\",\n\t\ticon: AlertTriangle,\n\t\tlabel: \"Medium Risk\",\n\t},\n\thigh: {\n\t\tcolor: \"bg-orange-500/10 text-orange-500 border-orange-500/20\",\n\t\ticon: AlertTriangle,\n\t\tlabel: \"High Risk\",\n\t},\n\tcritical: {\n\t\tcolor: \"bg-red-500/10 text-red-500 border-red-500/20\",\n\t\ticon: AlertTriangle,\n\t\tlabel: \"Critical Risk\",\n\t},\n};\n\nconst actionTypeIcons: Record<string, typeof Mail> = {\n\tsend_communication: Mail,\n\tfinancial: DollarSign,\n\tdelete: X,\n\tbulk_update: Building,\n\tbulk_delete: X,\n\tarchive: Building,\n};\n\nfunction getToolIcon(actionType: string) {\n\treturn actionTypeIcons[actionType] || AlertTriangle;\n}\n\nfunction formatToolArgs(toolArgs: Record<string, unknown>): { label: string; value: string }[] {\n\tconst formatted: { label: string; value: string }[] = [];\n\n\tconst labelMap: Record<string, string> = {\n\t\tto: \"Recipient\",\n\t\trecipient: \"Recipient\",\n\t\tsubject: \"Subject\",\n\t\tbody: \"Message\",\n\t\tmessage: \"Message\",\n\t\tcustomerId: \"Customer ID\",\n\t\tcustomer_id: \"Customer ID\",\n\t\tamount: \"Amount\",\n\t\tteamMemberId: \"Team Member\",\n\t\tvendorId: \"Vendor\",\n\t\tappointmentId: \"Appointment\",\n\t\tinvoiceId: \"Invoice\",\n\t};\n\n\tfor (const [key, value] of Object.entries(toolArgs)) {\n\t\tif (value === undefined || value === null) continue;\n\n\t\tconst label = labelMap[key] || key.replace(/([A-Z])/g, \" $1\").replace(/^./, (s) => s.toUpperCase());\n\t\tlet displayValue = String(value);\n\n\t\t// Format amounts (cents to dollars)\n\t\tif (key === \"amount\" && typeof value === \"number\") {\n\t\t\tdisplayValue = `$${(value / 100).toFixed(2)}`;\n\t\t}\n\n\t\t// Truncate long values\n\t\tif (displayValue.length > 200) {\n\t\t\tdisplayValue = displayValue.substring(0, 200) + \"...\";\n\t\t}\n\n\t\tformatted.push({ label, value: displayValue });\n\t}\n\n\treturn formatted;\n}\n\nfunction formatTimeRemaining(expiresAt: string): string {\n\tconst now = new Date();\n\tconst expires = new Date(expiresAt);\n\tconst diff = expires.getTime() - now.getTime();\n\n\tif (diff <= 0) return \"Expired\";\n\n\tconst hours = Math.floor(diff / (1000 * 60 * 60));\n\tconst minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n\n\tif (hours > 0) {\n\t\treturn `${hours}h ${minutes}m remaining`;\n\t}\n\treturn `${minutes}m remaining`;\n}\n\nexport function OwnerActionApprovalDialog({\n\tpendingAction,\n\tisOpen,\n\tonOpenChange,\n\tonApprove,\n\tonReject,\n\tisOwner,\n\tclassName,\n}: OwnerActionApprovalDialogProps) {\n\tconst [isProcessing, setIsProcessing] = useState(false);\n\tconst [rejectionReason, setRejectionReason] = useState(\"\");\n\tconst [showRejectForm, setShowRejectForm] = useState(false);\n\tconst [result, setResult] = useState<{ type: \"success\" | \"error\"; message: string } | null>(null);\n\n\t// Reset state when dialog opens/closes\n\tuseEffect(() => {\n\t\tif (!isOpen) {\n\t\t\tsetShowRejectForm(false);\n\t\t\tsetRejectionReason(\"\");\n\t\t\tsetResult(null);\n\t\t}\n\t}, [isOpen]);\n\n\tif (!pendingAction) return null;\n\n\tconst riskConfig = riskLevelConfig[pendingAction.riskLevel];\n\tconst RiskIcon = riskConfig.icon;\n\tconst ActionIcon = getToolIcon(pendingAction.actionType);\n\tconst toolArgsFormatted = formatToolArgs(pendingAction.toolArgs);\n\n\tconst handleApprove = async () => {\n\t\tif (!isOwner) {\n\t\t\tsetResult({ type: \"error\", message: \"Only company owners can approve destructive actions.\" });\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsProcessing(true);\n\t\tsetResult(null);\n\n\t\ttry {\n\t\t\tconst res = await onApprove(pendingAction.id);\n\t\t\tif (res.success) {\n\t\t\t\tsetResult({ type: \"success\", message: \"Action approved! The AI will now execute this action.\" });\n\t\t\t\tsetTimeout(() => onOpenChange(false), 1500);\n\t\t\t} else {\n\t\t\t\tsetResult({ type: \"error\", message: res.error || \"Failed to approve action.\" });\n\t\t\t}\n\t\t} catch {\n\t\t\tsetResult({ type: \"error\", message: \"An error occurred while approving the action.\" });\n\t\t} finally {\n\t\t\tsetIsProcessing(false);\n\t\t}\n\t};\n\n\tconst handleReject = async () => {\n\t\tif (!isOwner) {\n\t\t\tsetResult({ type: \"error\", message: \"Only company owners can reject destructive actions.\" });\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsProcessing(true);\n\t\tsetResult(null);\n\n\t\ttry {\n\t\t\tconst res = await onReject(pendingAction.id, rejectionReason || undefined);\n\t\t\tif (res.success) {\n\t\t\t\tsetResult({ type: \"success\", message: \"Action rejected. The AI will not execute this action.\" });\n\t\t\t\tsetTimeout(() => onOpenChange(false), 1500);\n\t\t\t} else {\n\t\t\t\tsetResult({ type: \"error\", message: res.error || \"Failed to reject action.\" });\n\t\t\t}\n\t\t} catch {\n\t\t\tsetResult({ type: \"error\", message: \"An error occurred while rejecting the action.\" });\n\t\t} finally {\n\t\t\tsetIsProcessing(false);\n\t\t}\n\t};\n\n\treturn (\n\t\t<Dialog open={isOpen} onOpenChange={onOpenChange}>\n\t\t\t<DialogContent className={cn(\"max-w-lg\", className)}>\n\t\t\t\t<DialogHeader>\n\t\t\t\t\t<DialogTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Shield className=\"h-5 w-5 text-primary\" />\n\t\t\t\t\t\tOwner Approval Required\n\t\t\t\t\t</DialogTitle>\n\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\tThe AI assistant wants to perform a destructive action that requires your approval.\n\t\t\t\t\t</DialogDescription>\n\t\t\t\t</DialogHeader>\n\n\t\t\t\t{result ? (\n\t\t\t\t\t<div className=\"flex flex-col items-center justify-center py-8\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\"rounded-full p-3 mb-4\",\n\t\t\t\t\t\t\t\tresult.type === \"success\" ? \"bg-green-500/10\" : \"bg-red-500/10\"\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{result.type === \"success\" ? (\n\t\t\t\t\t\t\t\t<Check className=\"h-8 w-8 text-green-500\" />\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<X className=\"h-8 w-8 text-red-500\" />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p className=\"text-center text-sm\">{result.message}</p>\n\t\t\t\t\t</div>\n\t\t\t\t) : (\n\t\t\t\t\t<>\n\t\t\t\t\t\t{/* Risk Level Badge */}\n\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t<Badge variant=\"outline\" className={cn(\"flex items-center gap-1\", riskConfig.color)}>\n\t\t\t\t\t\t\t\t<RiskIcon className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t{riskConfig.label}\n\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t<Clock className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t{formatTimeRemaining(pendingAction.expiresAt)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* Action Summary */}\n\t\t\t\t\t\t<div className=\"bg-muted/50 rounded-lg p-4 space-y-3\">\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<ActionIcon className=\"h-5 w-5 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t{pendingAction.toolName\n\t\t\t\t\t\t\t\t\t\t.replace(/([A-Z])/g, \" $1\")\n\t\t\t\t\t\t\t\t\t\t.replace(/^./, (s) => s.toUpperCase())}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<Separator />\n\n\t\t\t\t\t\t\t{/* Tool Arguments */}\n\t\t\t\t\t\t\t<ScrollArea className=\"max-h-[200px]\">\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t{toolArgsFormatted.map(({ label, value }, idx) => (\n\t\t\t\t\t\t\t\t\t\t<div key={idx} className=\"grid grid-cols-3 gap-2 text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">{label}:</span>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"col-span-2 break-words\">{value}</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</ScrollArea>\n\n\t\t\t\t\t\t\t{/* Affected Entities */}\n\t\t\t\t\t\t\t{pendingAction.affectedCount > 0 && (\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-sm text-muted-foreground pt-2 border-t\">\n\t\t\t\t\t\t\t\t\t<User className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\tAffects {pendingAction.affectedCount}{\" \"}\n\t\t\t\t\t\t\t\t\t\t{pendingAction.affectedEntityType.replace(/_/g, \" \")}\n\t\t\t\t\t\t\t\t\t\t{pendingAction.affectedCount > 1 ? \"s\" : \"\"}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* Owner Warning */}\n\t\t\t\t\t\t{!isOwner && (\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 p-3 bg-yellow-500/10 rounded-lg text-sm\">\n\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-4 w-4 text-yellow-500 flex-shrink-0\" />\n\t\t\t\t\t\t\t\t<p className=\"text-yellow-700 dark:text-yellow-300\">\n\t\t\t\t\t\t\t\t\tOnly company owners can approve or reject this action. Please contact an owner.\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{/* Rejection Reason Form */}\n\t\t\t\t\t\t{showRejectForm && (\n\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t<Label htmlFor=\"rejection-reason\">Reason for rejection (optional)</Label>\n\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\tid=\"rejection-reason\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"Why are you rejecting this action?\"\n\t\t\t\t\t\t\t\t\tvalue={rejectionReason}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setRejectionReason(e.target.value)}\n\t\t\t\t\t\t\t\t\tclassName=\"h-20 resize-none\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t<DialogFooter className=\"flex-col sm:flex-row gap-2\">\n\t\t\t\t\t\t\t{showRejectForm ? (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => setShowRejectForm(false)}\n\t\t\t\t\t\t\t\t\t\tdisabled={isProcessing}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tBack\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\tonClick={handleReject}\n\t\t\t\t\t\t\t\t\t\tdisabled={isProcessing || !isOwner}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{isProcessing ? (\n\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n\t\t\t\t\t\t\t\t\t\t\t\tRejecting...\n\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t<X className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\tConfirm Rejection\n\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => setShowRejectForm(true)}\n\t\t\t\t\t\t\t\t\t\tdisabled={isProcessing || !isOwner}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<X className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tReject\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleApprove}\n\t\t\t\t\t\t\t\t\t\tdisabled={isProcessing || !isOwner}\n\t\t\t\t\t\t\t\t\t\tclassName=\"bg-green-600 hover:bg-green-700\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{isProcessing ? (\n\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n\t\t\t\t\t\t\t\t\t\t\t\tApproving...\n\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t<Check className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\tApprove Action\n\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</DialogFooter>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n\n/**\n * Inline approval banner that appears in the chat when an action needs approval\n */\nexport function ActionApprovalBanner({\n\tpendingAction,\n\tonViewDetails,\n\tclassName,\n}: {\n\tpendingAction: PendingAction;\n\tonViewDetails: () => void;\n\tclassName?: string;\n}) {\n\tconst riskConfig = riskLevelConfig[pendingAction.riskLevel];\n\tconst RiskIcon = riskConfig.icon;\n\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\n\t\t\t\t\"flex items-center justify-between gap-4 p-3 rounded-lg border\",\n\t\t\t\triskConfig.color,\n\t\t\t\tclassName\n\t\t\t)}\n\t\t>\n\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t<RiskIcon className=\"h-5 w-5 flex-shrink-0\" />\n\t\t\t\t<div>\n\t\t\t\t\t<p className=\"text-sm font-medium\">Action requires owner approval</p>\n\t\t\t\t\t<p className=\"text-xs opacity-80\">\n\t\t\t\t\t\t{pendingAction.toolName.replace(/([A-Z])/g, \" $1\")} - {formatTimeRemaining(pendingAction.expiresAt)}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Button size=\"sm\" variant=\"outline\" onClick={onViewDetails}>\n\t\t\t\tReview\n\t\t\t</Button>\n\t\t</div>\n\t);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3448, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/actions/ai-approval.ts"],"sourcesContent":["/**\n * AI Action Approval Server Actions\n *\n * Server actions for owner-only approval of destructive AI actions.\n * These actions wrap the action-approval service for use in React components.\n */\n\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { z } from \"zod\";\nimport {\n\tActionError,\n\tERROR_CODES,\n} from \"@/lib/errors/action-error\";\nimport {\n\ttype ActionResult,\n\tassertAuthenticated,\n\twithErrorHandling,\n} from \"@/lib/errors/with-error-handling\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport {\n\tapproveAction,\n\trejectAction,\n\tgetPendingActionsForCompany,\n\tgetPendingActionsForChat,\n\tgetPendingAction,\n\tisCompanyOwner,\n\texpireOldActions,\n\ttype PendingAction,\n} from \"@/lib/ai/action-approval\";\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type { PendingAction };\n\nexport interface ApprovalActionResult {\n\tsuccess: boolean;\n\terror?: string;\n\tactionId?: string;\n\ttoolName?: string;\n\ttoolArgs?: Record<string, unknown>;\n\t// Execution fields (for approval responses)\n\texecuted?: boolean;\n\texecutionResult?: unknown;\n\texecutionError?: string;\n}\n\n// ============================================================================\n// Validation Schemas\n// ============================================================================\n\nconst approveActionSchema = z.object({\n\tactionId: z.string().uuid(\"Invalid action ID\"),\n});\n\nconst rejectActionSchema = z.object({\n\tactionId: z.string().uuid(\"Invalid action ID\"),\n\treason: z.string().max(500, \"Reason too long\").optional(),\n});\n\nconst getPendingActionsSchema = z.object({\n\tstatus: z.enum([\"pending\", \"approved\", \"rejected\", \"expired\"]).optional(),\n\tlimit: z.number().min(1).max(100).default(50),\n});\n\nconst getChatActionsSchema = z.object({\n\tchatId: z.string().uuid(\"Invalid chat ID\"),\n});\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nasync function getAuthenticatedUserWithCompany() {\n\tconst supabase = await createClient();\n\tif (!supabase) {\n\t\tthrow new ActionError(\n\t\t\t\"Database connection failed\",\n\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t);\n\t}\n\n\tconst {\n\t\tdata: { user },\n\t} = await supabase.auth.getUser();\n\tassertAuthenticated(user?.id);\n\n\tconst { data: teamMember } = await supabase\n\t\t.from(\"company_memberships\")\n\t\t.select(\"company_id, role\")\n\t\t.eq(\"user_id\", user.id)\n\t\t.single();\n\n\tif (!teamMember?.company_id) {\n\t\tthrow new ActionError(\n\t\t\t\"You must be part of a company\",\n\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t403,\n\t\t);\n\t}\n\n\treturn {\n\t\tuserId: user.id,\n\t\tcompanyId: teamMember.company_id,\n\t\trole: teamMember.role,\n\t};\n}\n\n// ============================================================================\n// Server Actions\n// ============================================================================\n\n/**\n * Approve a pending AI action - OWNER ONLY\n * This action will be executed immediately after approval\n */\nexport async function approveAIAction(\n\tinput: z.infer<typeof approveActionSchema>,\n): Promise<ActionResult<ApprovalActionResult>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst validated = approveActionSchema.parse(input);\n\t\tconst { userId, companyId } = await getAuthenticatedUserWithCompany();\n\n\t\t// Verify user is owner (double-check even though DB function enforces this)\n\t\tconst ownerCheck = await isCompanyOwner(companyId, userId);\n\t\tif (!ownerCheck) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Only company owners can approve destructive AI actions\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Call the approval function (which calls the DB RPC)\n\t\tconst result = await approveAction(validated.actionId, userId);\n\n\t\tif (!result.success) {\n\t\t\tthrow new ActionError(\n\t\t\t\tresult.error || \"Failed to approve action\",\n\t\t\t\tERROR_CODES.OPERATION_FAILED,\n\t\t\t);\n\t\t}\n\n\t\t// Automatically execute the approved action\n\t\tlet executionResult: { success: boolean; result?: unknown; error?: string } | null = null;\n\t\ttry {\n\t\t\tconst response = await fetch(\n\t\t\t\t`${process.env.NEXT_PUBLIC_APP_URL || \"http://localhost:3000\"}/api/ai/execute-approved`,\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tactionId: validated.actionId,\n\t\t\t\t\t\tcompanyId,\n\t\t\t\t\t}),\n\t\t\t\t}\n\t\t\t);\n\t\t\texecutionResult = await response.json();\n\t\t} catch (execError) {\n\t\t\tconsole.error(\"Failed to auto-execute approved action:\", execError);\n\t\t\t// Don't fail the approval - execution can be retried\n\t\t}\n\n\t\t// Revalidate AI-related paths\n\t\trevalidatePath(\"/dashboard/ai\");\n\t\trevalidatePath(\"/dashboard/settings/ai\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tactionId: result.actionId,\n\t\t\ttoolName: result.toolName,\n\t\t\ttoolArgs: result.toolArgs,\n\t\t\texecuted: executionResult?.success || false,\n\t\t\texecutionResult: executionResult?.result,\n\t\t\texecutionError: executionResult?.error,\n\t\t};\n\t});\n}\n\n/**\n * Reject a pending AI action - OWNER ONLY\n * The AI will not execute this action\n */\nexport async function rejectAIAction(\n\tinput: z.infer<typeof rejectActionSchema>,\n): Promise<ActionResult<ApprovalActionResult>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst validated = rejectActionSchema.parse(input);\n\t\tconst { userId, companyId } = await getAuthenticatedUserWithCompany();\n\n\t\t// Verify user is owner\n\t\tconst ownerCheck = await isCompanyOwner(companyId, userId);\n\t\tif (!ownerCheck) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Only company owners can reject destructive AI actions\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Call the rejection function\n\t\tconst result = await rejectAction(\n\t\t\tvalidated.actionId,\n\t\t\tuserId,\n\t\t\tvalidated.reason,\n\t\t);\n\n\t\tif (!result.success) {\n\t\t\tthrow new ActionError(\n\t\t\t\tresult.error || \"Failed to reject action\",\n\t\t\t\tERROR_CODES.OPERATION_FAILED,\n\t\t\t);\n\t\t}\n\n\t\t// Revalidate AI-related paths\n\t\trevalidatePath(\"/dashboard/ai\");\n\t\trevalidatePath(\"/dashboard/settings/ai\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tactionId: validated.actionId,\n\t\t};\n\t});\n}\n\n/**\n * Get all pending actions for the current company\n * Used by the owner dashboard to review pending approvals\n */\nexport async function getCompanyPendingActions(\n\tinput?: z.infer<typeof getPendingActionsSchema>,\n): Promise<ActionResult<PendingAction[]>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst validated = input ? getPendingActionsSchema.parse(input) : { limit: 50 };\n\t\tconst { companyId } = await getAuthenticatedUserWithCompany();\n\n\t\t// Expire old actions first\n\t\tawait expireOldActions(companyId);\n\n\t\t// Fetch pending actions\n\t\tconst actions = await getPendingActionsForCompany(companyId, {\n\t\t\tstatus: validated.status,\n\t\t\tlimit: validated.limit,\n\t\t});\n\n\t\treturn actions;\n\t});\n}\n\n/**\n * Get pending actions for a specific chat session\n * Used to show approval banners in the AI chat\n */\nexport async function getChatPendingActions(\n\tinput: z.infer<typeof getChatActionsSchema>,\n): Promise<ActionResult<PendingAction[]>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst validated = getChatActionsSchema.parse(input);\n\t\tconst { companyId } = await getAuthenticatedUserWithCompany();\n\n\t\t// Expire old actions first\n\t\tawait expireOldActions(companyId);\n\n\t\t// Fetch pending actions for the chat\n\t\tconst actions = await getPendingActionsForChat(companyId, validated.chatId);\n\n\t\treturn actions;\n\t});\n}\n\n/**\n * Get a specific pending action by ID\n */\nexport async function getPendingActionById(\n\tactionId: string,\n): Promise<ActionResult<PendingAction | null>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst validated = z.string().uuid(\"Invalid action ID\").parse(actionId);\n\t\tconst { companyId } = await getAuthenticatedUserWithCompany();\n\n\t\tconst action = await getPendingAction(companyId, validated);\n\t\treturn action;\n\t});\n}\n\n/**\n * Check if current user is a company owner\n * Used by UI to determine if approval buttons should be enabled\n */\nexport async function checkIsCompanyOwner(): Promise<ActionResult<boolean>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst { userId, companyId } = await getAuthenticatedUserWithCompany();\n\t\tconst isOwner = await isCompanyOwner(companyId, userId);\n\t\treturn isOwner;\n\t});\n}\n\n/**\n * Get pending action counts for notifications\n */\nexport async function getPendingActionCounts(): Promise<\n\tActionResult<{\n\t\ttotal: number;\n\t\tbyRiskLevel: Record<string, number>;\n\t}>\n> {\n\treturn await withErrorHandling(async () => {\n\t\tconst { companyId } = await getAuthenticatedUserWithCompany();\n\n\t\t// Expire old actions first\n\t\tawait expireOldActions(companyId);\n\n\t\t// Fetch pending actions\n\t\tconst actions = await getPendingActionsForCompany(companyId, {\n\t\t\tstatus: \"pending\",\n\t\t\tlimit: 100,\n\t\t});\n\n\t\t// Group by risk level\n\t\tconst byRiskLevel: Record<string, number> = {\n\t\t\tlow: 0,\n\t\t\tmedium: 0,\n\t\t\thigh: 0,\n\t\t\tcritical: 0,\n\t\t};\n\n\t\tfor (const action of actions) {\n\t\t\tbyRiskLevel[action.riskLevel] = (byRiskLevel[action.riskLevel] || 0) + 1;\n\t\t}\n\n\t\treturn {\n\t\t\ttotal: actions.length,\n\t\t\tbyRiskLevel,\n\t\t};\n\t});\n}\n"],"names":[],"mappings":";;;;;;;IAuHsB,kBAAA,WAAA,GAAA,IAAA,yZAAA,EAAA,8CAAA,8YAAA,EAAA,KAAA,GAAA,oZAAA,EAAA"}},
    {"offset": {"line": 3463, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/actions/ai-approval.ts"],"sourcesContent":["/**\n * AI Action Approval Server Actions\n *\n * Server actions for owner-only approval of destructive AI actions.\n * These actions wrap the action-approval service for use in React components.\n */\n\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { z } from \"zod\";\nimport {\n\tActionError,\n\tERROR_CODES,\n} from \"@/lib/errors/action-error\";\nimport {\n\ttype ActionResult,\n\tassertAuthenticated,\n\twithErrorHandling,\n} from \"@/lib/errors/with-error-handling\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport {\n\tapproveAction,\n\trejectAction,\n\tgetPendingActionsForCompany,\n\tgetPendingActionsForChat,\n\tgetPendingAction,\n\tisCompanyOwner,\n\texpireOldActions,\n\ttype PendingAction,\n} from \"@/lib/ai/action-approval\";\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type { PendingAction };\n\nexport interface ApprovalActionResult {\n\tsuccess: boolean;\n\terror?: string;\n\tactionId?: string;\n\ttoolName?: string;\n\ttoolArgs?: Record<string, unknown>;\n\t// Execution fields (for approval responses)\n\texecuted?: boolean;\n\texecutionResult?: unknown;\n\texecutionError?: string;\n}\n\n// ============================================================================\n// Validation Schemas\n// ============================================================================\n\nconst approveActionSchema = z.object({\n\tactionId: z.string().uuid(\"Invalid action ID\"),\n});\n\nconst rejectActionSchema = z.object({\n\tactionId: z.string().uuid(\"Invalid action ID\"),\n\treason: z.string().max(500, \"Reason too long\").optional(),\n});\n\nconst getPendingActionsSchema = z.object({\n\tstatus: z.enum([\"pending\", \"approved\", \"rejected\", \"expired\"]).optional(),\n\tlimit: z.number().min(1).max(100).default(50),\n});\n\nconst getChatActionsSchema = z.object({\n\tchatId: z.string().uuid(\"Invalid chat ID\"),\n});\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nasync function getAuthenticatedUserWithCompany() {\n\tconst supabase = await createClient();\n\tif (!supabase) {\n\t\tthrow new ActionError(\n\t\t\t\"Database connection failed\",\n\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t);\n\t}\n\n\tconst {\n\t\tdata: { user },\n\t} = await supabase.auth.getUser();\n\tassertAuthenticated(user?.id);\n\n\tconst { data: teamMember } = await supabase\n\t\t.from(\"company_memberships\")\n\t\t.select(\"company_id, role\")\n\t\t.eq(\"user_id\", user.id)\n\t\t.single();\n\n\tif (!teamMember?.company_id) {\n\t\tthrow new ActionError(\n\t\t\t\"You must be part of a company\",\n\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t403,\n\t\t);\n\t}\n\n\treturn {\n\t\tuserId: user.id,\n\t\tcompanyId: teamMember.company_id,\n\t\trole: teamMember.role,\n\t};\n}\n\n// ============================================================================\n// Server Actions\n// ============================================================================\n\n/**\n * Approve a pending AI action - OWNER ONLY\n * This action will be executed immediately after approval\n */\nexport async function approveAIAction(\n\tinput: z.infer<typeof approveActionSchema>,\n): Promise<ActionResult<ApprovalActionResult>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst validated = approveActionSchema.parse(input);\n\t\tconst { userId, companyId } = await getAuthenticatedUserWithCompany();\n\n\t\t// Verify user is owner (double-check even though DB function enforces this)\n\t\tconst ownerCheck = await isCompanyOwner(companyId, userId);\n\t\tif (!ownerCheck) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Only company owners can approve destructive AI actions\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Call the approval function (which calls the DB RPC)\n\t\tconst result = await approveAction(validated.actionId, userId);\n\n\t\tif (!result.success) {\n\t\t\tthrow new ActionError(\n\t\t\t\tresult.error || \"Failed to approve action\",\n\t\t\t\tERROR_CODES.OPERATION_FAILED,\n\t\t\t);\n\t\t}\n\n\t\t// Automatically execute the approved action\n\t\tlet executionResult: { success: boolean; result?: unknown; error?: string } | null = null;\n\t\ttry {\n\t\t\tconst response = await fetch(\n\t\t\t\t`${process.env.NEXT_PUBLIC_APP_URL || \"http://localhost:3000\"}/api/ai/execute-approved`,\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tactionId: validated.actionId,\n\t\t\t\t\t\tcompanyId,\n\t\t\t\t\t}),\n\t\t\t\t}\n\t\t\t);\n\t\t\texecutionResult = await response.json();\n\t\t} catch (execError) {\n\t\t\tconsole.error(\"Failed to auto-execute approved action:\", execError);\n\t\t\t// Don't fail the approval - execution can be retried\n\t\t}\n\n\t\t// Revalidate AI-related paths\n\t\trevalidatePath(\"/dashboard/ai\");\n\t\trevalidatePath(\"/dashboard/settings/ai\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tactionId: result.actionId,\n\t\t\ttoolName: result.toolName,\n\t\t\ttoolArgs: result.toolArgs,\n\t\t\texecuted: executionResult?.success || false,\n\t\t\texecutionResult: executionResult?.result,\n\t\t\texecutionError: executionResult?.error,\n\t\t};\n\t});\n}\n\n/**\n * Reject a pending AI action - OWNER ONLY\n * The AI will not execute this action\n */\nexport async function rejectAIAction(\n\tinput: z.infer<typeof rejectActionSchema>,\n): Promise<ActionResult<ApprovalActionResult>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst validated = rejectActionSchema.parse(input);\n\t\tconst { userId, companyId } = await getAuthenticatedUserWithCompany();\n\n\t\t// Verify user is owner\n\t\tconst ownerCheck = await isCompanyOwner(companyId, userId);\n\t\tif (!ownerCheck) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Only company owners can reject destructive AI actions\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Call the rejection function\n\t\tconst result = await rejectAction(\n\t\t\tvalidated.actionId,\n\t\t\tuserId,\n\t\t\tvalidated.reason,\n\t\t);\n\n\t\tif (!result.success) {\n\t\t\tthrow new ActionError(\n\t\t\t\tresult.error || \"Failed to reject action\",\n\t\t\t\tERROR_CODES.OPERATION_FAILED,\n\t\t\t);\n\t\t}\n\n\t\t// Revalidate AI-related paths\n\t\trevalidatePath(\"/dashboard/ai\");\n\t\trevalidatePath(\"/dashboard/settings/ai\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tactionId: validated.actionId,\n\t\t};\n\t});\n}\n\n/**\n * Get all pending actions for the current company\n * Used by the owner dashboard to review pending approvals\n */\nexport async function getCompanyPendingActions(\n\tinput?: z.infer<typeof getPendingActionsSchema>,\n): Promise<ActionResult<PendingAction[]>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst validated = input ? getPendingActionsSchema.parse(input) : { limit: 50 };\n\t\tconst { companyId } = await getAuthenticatedUserWithCompany();\n\n\t\t// Expire old actions first\n\t\tawait expireOldActions(companyId);\n\n\t\t// Fetch pending actions\n\t\tconst actions = await getPendingActionsForCompany(companyId, {\n\t\t\tstatus: validated.status,\n\t\t\tlimit: validated.limit,\n\t\t});\n\n\t\treturn actions;\n\t});\n}\n\n/**\n * Get pending actions for a specific chat session\n * Used to show approval banners in the AI chat\n */\nexport async function getChatPendingActions(\n\tinput: z.infer<typeof getChatActionsSchema>,\n): Promise<ActionResult<PendingAction[]>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst validated = getChatActionsSchema.parse(input);\n\t\tconst { companyId } = await getAuthenticatedUserWithCompany();\n\n\t\t// Expire old actions first\n\t\tawait expireOldActions(companyId);\n\n\t\t// Fetch pending actions for the chat\n\t\tconst actions = await getPendingActionsForChat(companyId, validated.chatId);\n\n\t\treturn actions;\n\t});\n}\n\n/**\n * Get a specific pending action by ID\n */\nexport async function getPendingActionById(\n\tactionId: string,\n): Promise<ActionResult<PendingAction | null>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst validated = z.string().uuid(\"Invalid action ID\").parse(actionId);\n\t\tconst { companyId } = await getAuthenticatedUserWithCompany();\n\n\t\tconst action = await getPendingAction(companyId, validated);\n\t\treturn action;\n\t});\n}\n\n/**\n * Check if current user is a company owner\n * Used by UI to determine if approval buttons should be enabled\n */\nexport async function checkIsCompanyOwner(): Promise<ActionResult<boolean>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst { userId, companyId } = await getAuthenticatedUserWithCompany();\n\t\tconst isOwner = await isCompanyOwner(companyId, userId);\n\t\treturn isOwner;\n\t});\n}\n\n/**\n * Get pending action counts for notifications\n */\nexport async function getPendingActionCounts(): Promise<\n\tActionResult<{\n\t\ttotal: number;\n\t\tbyRiskLevel: Record<string, number>;\n\t}>\n> {\n\treturn await withErrorHandling(async () => {\n\t\tconst { companyId } = await getAuthenticatedUserWithCompany();\n\n\t\t// Expire old actions first\n\t\tawait expireOldActions(companyId);\n\n\t\t// Fetch pending actions\n\t\tconst actions = await getPendingActionsForCompany(companyId, {\n\t\t\tstatus: \"pending\",\n\t\t\tlimit: 100,\n\t\t});\n\n\t\t// Group by risk level\n\t\tconst byRiskLevel: Record<string, number> = {\n\t\t\tlow: 0,\n\t\t\tmedium: 0,\n\t\t\thigh: 0,\n\t\t\tcritical: 0,\n\t\t};\n\n\t\tfor (const action of actions) {\n\t\t\tbyRiskLevel[action.riskLevel] = (byRiskLevel[action.riskLevel] || 0) + 1;\n\t\t}\n\n\t\treturn {\n\t\t\ttotal: actions.length,\n\t\t\tbyRiskLevel,\n\t\t};\n\t});\n}\n"],"names":[],"mappings":";;;;;;;IA0LsB,iBAAA,WAAA,GAAA,IAAA,yZAAA,EAAA,8CAAA,8YAAA,EAAA,KAAA,GAAA,oZAAA,EAAA"}},
    {"offset": {"line": 3478, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/actions/ai-approval.ts"],"sourcesContent":["/**\n * AI Action Approval Server Actions\n *\n * Server actions for owner-only approval of destructive AI actions.\n * These actions wrap the action-approval service for use in React components.\n */\n\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { z } from \"zod\";\nimport {\n\tActionError,\n\tERROR_CODES,\n} from \"@/lib/errors/action-error\";\nimport {\n\ttype ActionResult,\n\tassertAuthenticated,\n\twithErrorHandling,\n} from \"@/lib/errors/with-error-handling\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport {\n\tapproveAction,\n\trejectAction,\n\tgetPendingActionsForCompany,\n\tgetPendingActionsForChat,\n\tgetPendingAction,\n\tisCompanyOwner,\n\texpireOldActions,\n\ttype PendingAction,\n} from \"@/lib/ai/action-approval\";\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type { PendingAction };\n\nexport interface ApprovalActionResult {\n\tsuccess: boolean;\n\terror?: string;\n\tactionId?: string;\n\ttoolName?: string;\n\ttoolArgs?: Record<string, unknown>;\n\t// Execution fields (for approval responses)\n\texecuted?: boolean;\n\texecutionResult?: unknown;\n\texecutionError?: string;\n}\n\n// ============================================================================\n// Validation Schemas\n// ============================================================================\n\nconst approveActionSchema = z.object({\n\tactionId: z.string().uuid(\"Invalid action ID\"),\n});\n\nconst rejectActionSchema = z.object({\n\tactionId: z.string().uuid(\"Invalid action ID\"),\n\treason: z.string().max(500, \"Reason too long\").optional(),\n});\n\nconst getPendingActionsSchema = z.object({\n\tstatus: z.enum([\"pending\", \"approved\", \"rejected\", \"expired\"]).optional(),\n\tlimit: z.number().min(1).max(100).default(50),\n});\n\nconst getChatActionsSchema = z.object({\n\tchatId: z.string().uuid(\"Invalid chat ID\"),\n});\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nasync function getAuthenticatedUserWithCompany() {\n\tconst supabase = await createClient();\n\tif (!supabase) {\n\t\tthrow new ActionError(\n\t\t\t\"Database connection failed\",\n\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t);\n\t}\n\n\tconst {\n\t\tdata: { user },\n\t} = await supabase.auth.getUser();\n\tassertAuthenticated(user?.id);\n\n\tconst { data: teamMember } = await supabase\n\t\t.from(\"company_memberships\")\n\t\t.select(\"company_id, role\")\n\t\t.eq(\"user_id\", user.id)\n\t\t.single();\n\n\tif (!teamMember?.company_id) {\n\t\tthrow new ActionError(\n\t\t\t\"You must be part of a company\",\n\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t403,\n\t\t);\n\t}\n\n\treturn {\n\t\tuserId: user.id,\n\t\tcompanyId: teamMember.company_id,\n\t\trole: teamMember.role,\n\t};\n}\n\n// ============================================================================\n// Server Actions\n// ============================================================================\n\n/**\n * Approve a pending AI action - OWNER ONLY\n * This action will be executed immediately after approval\n */\nexport async function approveAIAction(\n\tinput: z.infer<typeof approveActionSchema>,\n): Promise<ActionResult<ApprovalActionResult>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst validated = approveActionSchema.parse(input);\n\t\tconst { userId, companyId } = await getAuthenticatedUserWithCompany();\n\n\t\t// Verify user is owner (double-check even though DB function enforces this)\n\t\tconst ownerCheck = await isCompanyOwner(companyId, userId);\n\t\tif (!ownerCheck) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Only company owners can approve destructive AI actions\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Call the approval function (which calls the DB RPC)\n\t\tconst result = await approveAction(validated.actionId, userId);\n\n\t\tif (!result.success) {\n\t\t\tthrow new ActionError(\n\t\t\t\tresult.error || \"Failed to approve action\",\n\t\t\t\tERROR_CODES.OPERATION_FAILED,\n\t\t\t);\n\t\t}\n\n\t\t// Automatically execute the approved action\n\t\tlet executionResult: { success: boolean; result?: unknown; error?: string } | null = null;\n\t\ttry {\n\t\t\tconst response = await fetch(\n\t\t\t\t`${process.env.NEXT_PUBLIC_APP_URL || \"http://localhost:3000\"}/api/ai/execute-approved`,\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tactionId: validated.actionId,\n\t\t\t\t\t\tcompanyId,\n\t\t\t\t\t}),\n\t\t\t\t}\n\t\t\t);\n\t\t\texecutionResult = await response.json();\n\t\t} catch (execError) {\n\t\t\tconsole.error(\"Failed to auto-execute approved action:\", execError);\n\t\t\t// Don't fail the approval - execution can be retried\n\t\t}\n\n\t\t// Revalidate AI-related paths\n\t\trevalidatePath(\"/dashboard/ai\");\n\t\trevalidatePath(\"/dashboard/settings/ai\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tactionId: result.actionId,\n\t\t\ttoolName: result.toolName,\n\t\t\ttoolArgs: result.toolArgs,\n\t\t\texecuted: executionResult?.success || false,\n\t\t\texecutionResult: executionResult?.result,\n\t\t\texecutionError: executionResult?.error,\n\t\t};\n\t});\n}\n\n/**\n * Reject a pending AI action - OWNER ONLY\n * The AI will not execute this action\n */\nexport async function rejectAIAction(\n\tinput: z.infer<typeof rejectActionSchema>,\n): Promise<ActionResult<ApprovalActionResult>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst validated = rejectActionSchema.parse(input);\n\t\tconst { userId, companyId } = await getAuthenticatedUserWithCompany();\n\n\t\t// Verify user is owner\n\t\tconst ownerCheck = await isCompanyOwner(companyId, userId);\n\t\tif (!ownerCheck) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Only company owners can reject destructive AI actions\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Call the rejection function\n\t\tconst result = await rejectAction(\n\t\t\tvalidated.actionId,\n\t\t\tuserId,\n\t\t\tvalidated.reason,\n\t\t);\n\n\t\tif (!result.success) {\n\t\t\tthrow new ActionError(\n\t\t\t\tresult.error || \"Failed to reject action\",\n\t\t\t\tERROR_CODES.OPERATION_FAILED,\n\t\t\t);\n\t\t}\n\n\t\t// Revalidate AI-related paths\n\t\trevalidatePath(\"/dashboard/ai\");\n\t\trevalidatePath(\"/dashboard/settings/ai\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tactionId: validated.actionId,\n\t\t};\n\t});\n}\n\n/**\n * Get all pending actions for the current company\n * Used by the owner dashboard to review pending approvals\n */\nexport async function getCompanyPendingActions(\n\tinput?: z.infer<typeof getPendingActionsSchema>,\n): Promise<ActionResult<PendingAction[]>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst validated = input ? getPendingActionsSchema.parse(input) : { limit: 50 };\n\t\tconst { companyId } = await getAuthenticatedUserWithCompany();\n\n\t\t// Expire old actions first\n\t\tawait expireOldActions(companyId);\n\n\t\t// Fetch pending actions\n\t\tconst actions = await getPendingActionsForCompany(companyId, {\n\t\t\tstatus: validated.status,\n\t\t\tlimit: validated.limit,\n\t\t});\n\n\t\treturn actions;\n\t});\n}\n\n/**\n * Get pending actions for a specific chat session\n * Used to show approval banners in the AI chat\n */\nexport async function getChatPendingActions(\n\tinput: z.infer<typeof getChatActionsSchema>,\n): Promise<ActionResult<PendingAction[]>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst validated = getChatActionsSchema.parse(input);\n\t\tconst { companyId } = await getAuthenticatedUserWithCompany();\n\n\t\t// Expire old actions first\n\t\tawait expireOldActions(companyId);\n\n\t\t// Fetch pending actions for the chat\n\t\tconst actions = await getPendingActionsForChat(companyId, validated.chatId);\n\n\t\treturn actions;\n\t});\n}\n\n/**\n * Get a specific pending action by ID\n */\nexport async function getPendingActionById(\n\tactionId: string,\n): Promise<ActionResult<PendingAction | null>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst validated = z.string().uuid(\"Invalid action ID\").parse(actionId);\n\t\tconst { companyId } = await getAuthenticatedUserWithCompany();\n\n\t\tconst action = await getPendingAction(companyId, validated);\n\t\treturn action;\n\t});\n}\n\n/**\n * Check if current user is a company owner\n * Used by UI to determine if approval buttons should be enabled\n */\nexport async function checkIsCompanyOwner(): Promise<ActionResult<boolean>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst { userId, companyId } = await getAuthenticatedUserWithCompany();\n\t\tconst isOwner = await isCompanyOwner(companyId, userId);\n\t\treturn isOwner;\n\t});\n}\n\n/**\n * Get pending action counts for notifications\n */\nexport async function getPendingActionCounts(): Promise<\n\tActionResult<{\n\t\ttotal: number;\n\t\tbyRiskLevel: Record<string, number>;\n\t}>\n> {\n\treturn await withErrorHandling(async () => {\n\t\tconst { companyId } = await getAuthenticatedUserWithCompany();\n\n\t\t// Expire old actions first\n\t\tawait expireOldActions(companyId);\n\n\t\t// Fetch pending actions\n\t\tconst actions = await getPendingActionsForCompany(companyId, {\n\t\t\tstatus: \"pending\",\n\t\t\tlimit: 100,\n\t\t});\n\n\t\t// Group by risk level\n\t\tconst byRiskLevel: Record<string, number> = {\n\t\t\tlow: 0,\n\t\t\tmedium: 0,\n\t\t\thigh: 0,\n\t\t\tcritical: 0,\n\t\t};\n\n\t\tfor (const action of actions) {\n\t\t\tbyRiskLevel[action.riskLevel] = (byRiskLevel[action.riskLevel] || 0) + 1;\n\t\t}\n\n\t\treturn {\n\t\t\ttotal: actions.length,\n\t\t\tbyRiskLevel,\n\t\t};\n\t});\n}\n"],"names":[],"mappings":";;;;;;;IAgQsB,wBAAA,WAAA,GAAA,IAAA,yZAAA,EAAA,8CAAA,8YAAA,EAAA,KAAA,GAAA,oZAAA,EAAA"}},
    {"offset": {"line": 3493, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/ai/ai-chat-interface.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState, useRef, useCallback, useMemo } from \"react\";\nimport Image from \"next/image\";\nimport { useChat, type UIMessage as AiMessage } from \"@ai-sdk/react\";\nimport { useChatStore } from \"@/lib/stores/chat-store\";\nimport {\n\tConversation,\n\tConversationContent,\n\tConversationScrollButton,\n\tConversationEmptyState,\n} from \"@/components/ai/conversation\";\nimport {\n\tMessage,\n\tMessageContent,\n\tMessageResponse,\n\tMessageActions,\n\tMessageAction,\n\tMessageToolbar,\n\tMessageAttachment,\n\tMessageAttachments,\n\tMessageBranch,\n\tMessageBranchContent,\n\tMessageBranchSelector,\n\tMessageBranchPrevious,\n\tMessageBranchNext,\n\tMessageBranchPage,\n} from \"@/components/ai/message\";\nimport {\n\tArtifact,\n\tArtifactContent,\n\tArtifactHeader,\n\tArtifactTitle,\n\tArtifactDescription,\n\tArtifactActions,\n\tArtifactAction,\n\tArtifactClose,\n} from \"@/components/ai/artifact\";\nimport {\n\tModelSelector,\n\tModelSelectorContent,\n\tModelSelectorEmpty,\n\tModelSelectorGroup,\n\tModelSelectorInput,\n\tModelSelectorItem,\n\tModelSelectorList,\n\tModelSelectorLogo,\n\tModelSelectorLogoGroup,\n\tModelSelectorName,\n\tModelSelectorTrigger,\n\tModelSelectorSeparator,\n\tModelSelectorShortcut,\n} from \"@/components/ai/model-selector\";\nimport {\n\tPromptInput,\n\tPromptInputBody,\n\tPromptInputTextarea,\n\tPromptInputSubmit,\n\tPromptInputAttachments,\n\tPromptInputAttachment,\n\tPromptInputFooter,\n\tPromptInputTools,\n\tPromptInputButton,\n\tPromptInputActionMenu,\n\tPromptInputActionMenuContent,\n\tPromptInputActionMenuTrigger,\n\tPromptInputActionAddAttachments,\n\tPromptInputSpeechButton,\n} from \"@/components/ai/prompt-input\";\nimport { Loader } from \"@/components/ai/loader\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n\tCheckIcon,\n\tWrench,\n\tBot,\n\tSparkles,\n\tUsers,\n\tCalendar,\n\tFileText,\n\tDollarSign,\n\tPhone,\n\tMail,\n\tMessageSquare,\n\tTrendingUp,\n\tCopy,\n\tRefreshCw,\n\tPencil,\n\tThumbsUp,\n\tThumbsDown,\n\tDownload,\n\tX,\n\tExternalLink,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { toast } from \"sonner\";\nimport {\n\tOwnerActionApprovalDialog,\n\tActionApprovalBanner,\n} from \"@/components/ai/owner-action-approval-dialog\";\nimport {\n\tapproveAIAction,\n\trejectAIAction,\n\tgetChatPendingActions,\n\tcheckIsCompanyOwner,\n\ttype PendingAction,\n} from \"@/actions/ai-approval\";\n\n// Business-focused suggested actions for the AI manager\nconst SUGGESTED_ACTIONS = [\n\t{ text: \"Show today's schedule\", icon: Calendar },\n\t{ text: \"Inactive customers (30+ days)\", icon: Users },\n\t{ text: \"Overdue invoices\", icon: FileText },\n\t{ text: \"Monthly financial summary\", icon: TrendingUp },\n];\n\n// AI Models available - Google Gemini is primary\nconst models = [\n\t{\n\t\tid: \"gemini-2.0-flash-exp\",\n\t\tname: \"Gemini 2.0 Flash\",\n\t\tchef: \"Google\",\n\t\tchefSlug: \"google\",\n\t\tproviders: [\"google\"],\n\t\tdescription: \"Fast and efficient for most tasks\",\n\t},\n\t{\n\t\tid: \"gemini-1.5-pro\",\n\t\tname: \"Gemini 1.5 Pro\",\n\t\tchef: \"Google\",\n\t\tchefSlug: \"google\",\n\t\tproviders: [\"google\"],\n\t\tdescription: \"Best for complex reasoning and analysis\",\n\t},\n\t{\n\t\tid: \"gemini-1.5-flash\",\n\t\tname: \"Gemini 1.5 Flash\",\n\t\tchef: \"Google\",\n\t\tchefSlug: \"google\",\n\t\tproviders: [\"google\"],\n\t\tdescription: \"Ultra fast for quick tasks\",\n\t},\n];\n\n// Tool icons for display\nconst toolIcons: Record<string, React.ElementType> = {\n\tsearchCustomers: Users,\n\tgetCustomerDetails: Users,\n\tcreateCustomer: Users,\n\tupdateCustomer: Users,\n\tsearchJobs: Wrench,\n\tcreateAppointment: Calendar,\n\tgetAvailableSlots: Calendar,\n\tsearchInvoices: FileText,\n\tcreateInvoice: FileText,\n\tgetFinancialSummary: DollarSign,\n\tgetVirtualBuckets: DollarSign,\n\ttransferToBucket: DollarSign,\n\tsendEmail: Mail,\n\tsendSms: MessageSquare,\n\tinitiateCall: Phone,\n\tgetCommunicationHistory: MessageSquare,\n\tgetDashboardMetrics: Sparkles,\n\tgetProactiveInsights: Bot,\n};\n\n// Tool category labels\nconst toolCategoryLabels: Record<string, string> = {\n\tcustomer: \"Customer\",\n\tscheduling: \"Scheduling\",\n\tfinancial: \"Financial\",\n\tcommunication: \"Communication\",\n\treporting: \"Reporting\",\n};\n\ninterface ToolInvocation {\n\ttoolCallId: string;\n\ttoolName: string;\n\targs: Record<string, unknown>;\n\tstate: \"partial-call\" | \"call\" | \"result\";\n\tresult?: unknown;\n}\n\ninterface ApprovalRequest {\n\taction: string;\n\treason: string;\n\tdetails: string;\n\ttoolCallId: string;\n}\n\n// Action selectors - get actions without subscribing to state changes\n// This prevents infinite re-renders when any store state changes\nconst createChatSelector = (state: ReturnType<typeof useChatStore.getState>) => state.createChat;\nconst addMessageSelector = (state: ReturnType<typeof useChatStore.getState>) => state.addMessage;\n\ninterface AiChatInterfaceProps {\n\tcompanyId?: string;\n}\n\n// ChatInputInner component - defined outside to prevent re-creation on every render\ninterface ChatInputInnerProps {\n\tonSubmit: (message: { text: string; files: any[] }, event: React.FormEvent<HTMLFormElement>) => Promise<void>;\n\tselectedModel: string;\n\tsetSelectedModel: (model: string) => void;\n\tstatus: \"submitted\" | \"streaming\" | \"ready\" | \"error\";\n}\n\nfunction ChatInputInner({ onSubmit, selectedModel, setSelectedModel, status }: ChatInputInnerProps) {\n\tconst [modelSelectorOpen, setModelSelectorOpen] = useState(false);\n\tconst textareaRef = useRef<HTMLTextAreaElement>(null);\n\n\tconst selectedModelData = models.find((m) => m.id === selectedModel);\n\n\treturn (\n\t\t<PromptInput\n\t\t\tonSubmit={onSubmit}\n\t\t\taccept=\"image/*\"\n\t\t\tmultiple\n\t\t\tclassName=\"w-full bg-background\"\n\t\t>\n\t\t\t<PromptInputAttachments className=\"!items-start\">\n\t\t\t\t{(attachment) => <PromptInputAttachment data={attachment} />}\n\t\t\t</PromptInputAttachments>\n\t\t\t<PromptInputBody>\n\t\t\t\t<PromptInputTextarea\n\t\t\t\t\tref={textareaRef}\n\t\t\t\t\tplaceholder=\"Ask anything about your business...\"\n\t\t\t\t\tautoFocus\n\t\t\t\t\tdata-testid=\"multimodal-input\"\n\t\t\t\t/>\n\t\t\t</PromptInputBody>\n\t\t\t<PromptInputFooter className=\"flex items-center justify-between\">\n\t\t\t\t<PromptInputTools className=\"gap-1\">\n\t\t\t\t\t<PromptInputActionMenu>\n\t\t\t\t\t\t<PromptInputActionMenuTrigger />\n\t\t\t\t\t\t<PromptInputActionMenuContent>\n\t\t\t\t\t\t\t<PromptInputActionAddAttachments />\n\t\t\t\t\t\t</PromptInputActionMenuContent>\n\t\t\t\t\t</PromptInputActionMenu>\n\t\t\t\t\t<PromptInputSpeechButton textareaRef={textareaRef} />\n\t\t\t\t\t<ModelSelector\n\t\t\t\t\t\tonOpenChange={setModelSelectorOpen}\n\t\t\t\t\t\topen={modelSelectorOpen}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ModelSelectorTrigger asChild>\n\t\t\t\t\t\t\t<PromptInputButton>\n\t\t\t\t\t\t\t\t{selectedModelData?.chefSlug && (\n\t\t\t\t\t\t\t\t\t<ModelSelectorLogo\n\t\t\t\t\t\t\t\t\t\tprovider={selectedModelData.chefSlug}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{selectedModelData?.name && (\n\t\t\t\t\t\t\t\t\t<ModelSelectorName>\n\t\t\t\t\t\t\t\t\t\t{selectedModelData.name}\n\t\t\t\t\t\t\t\t\t</ModelSelectorName>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</PromptInputButton>\n\t\t\t\t\t\t</ModelSelectorTrigger>\n\t\t\t\t\t\t<ModelSelectorContent>\n\t\t\t\t\t\t\t<ModelSelectorInput placeholder=\"Search models...\" />\n\t\t\t\t\t\t\t<ModelSelectorList>\n\t\t\t\t\t\t\t\t<ModelSelectorEmpty>No models found.</ModelSelectorEmpty>\n\t\t\t\t\t\t\t\t{[\"Google\"].map((chef) => (\n\t\t\t\t\t\t\t\t\t<ModelSelectorGroup heading={chef} key={chef}>\n\t\t\t\t\t\t\t\t\t\t{models\n\t\t\t\t\t\t\t\t\t\t\t.filter((m) => m.chef === chef)\n\t\t\t\t\t\t\t\t\t\t\t.map((m) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<ModelSelectorItem\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={m.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonSelect={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetSelectedModel(m.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetModelSelectorOpen(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={m.id}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<ModelSelectorLogo provider={m.chefSlug} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<ModelSelectorName>{m.name}</ModelSelectorName>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<ModelSelectorLogoGroup>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{m.providers.map((provider) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ModelSelectorLogo\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={provider}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprovider={provider}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</ModelSelectorLogoGroup>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedModel === m.id ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<CheckIcon className=\"ml-auto size-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"ml-auto size-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</ModelSelectorItem>\n\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</ModelSelectorGroup>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</ModelSelectorList>\n\t\t\t\t\t\t</ModelSelectorContent>\n\t\t\t\t\t</ModelSelector>\n\t\t\t\t</PromptInputTools>\n\t\t\t\t<PromptInputSubmit\n\t\t\t\t\tstatus={status}\n\t\t\t\t\tclassName=\"size-8 rounded-full bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-50\"\n\t\t\t\t\tdata-testid=\"send-button\"\n\t\t\t\t/>\n\t\t\t</PromptInputFooter>\n\t\t</PromptInput>\n\t);\n}\n\nexport function AiChatInterface({ companyId }: AiChatInterfaceProps) {\n\t// STABLE chat ID for this component instance - created once, never changes\n\t// This prevents useChat from reinitializing when Zustand state changes\n\tconst [stableChatId] = useState(() => crypto.randomUUID());\n\n\t// Track if we've initialized the store chat (prevents infinite loop)\n\tconst hasInitializedRef = useRef(false);\n\n\t// Use action selectors to avoid subscribing to entire store state\n\t// This prevents infinite re-renders when any store state changes\n\tconst createChat = useChatStore(createChatSelector);\n\tconst addMessage = useChatStore(addMessageSelector);\n\tconst [showSuggestedActions, setShowSuggestedActions] = useState(true);\n\tconst [selectedModel, setSelectedModel] = useState(models[0].id);\n\tconst [pendingApprovals, setPendingApprovals] = useState<ApprovalRequest[]>([]);\n\n\t// Owner approval state\n\tconst [ownerPendingActions, setOwnerPendingActions] = useState<PendingAction[]>([]);\n\tconst [selectedPendingAction, setSelectedPendingAction] = useState<PendingAction | null>(null);\n\tconst [approvalDialogOpen, setApprovalDialogOpen] = useState(false);\n\tconst [isOwner, setIsOwner] = useState(false);\n\n\t// Store chat ID for persistence (separate from useChat's ID)\n\tconst [storeChatId, setStoreChatId] = useState<string | null>(null);\n\n\t// Initialize chat in store ONCE when component mounts\n\tuseEffect(() => {\n\t\tif (!hasInitializedRef.current) {\n\t\t\thasInitializedRef.current = true;\n\t\t\tconst newChatId = createChat(\"New Chat\");\n\t\t\tsetStoreChatId(newChatId);\n\t\t}\n\t}, [createChat]);\n\n\t// Check if user is owner on mount\n\tuseEffect(() => {\n\t\tconst checkOwner = async () => {\n\t\t\tconst result = await checkIsCompanyOwner();\n\t\t\tif (result.success && result.data) {\n\t\t\t\tsetIsOwner(result.data);\n\t\t\t}\n\t\t};\n\t\tcheckOwner();\n\t}, []);\n\n\t// Fetch pending actions for this chat\n\tconst fetchPendingActions = useCallback(async () => {\n\t\tif (!stableChatId) return;\n\t\tconst result = await getChatPendingActions({ chatId: stableChatId });\n\t\tif (result.success && result.data) {\n\t\t\tsetOwnerPendingActions(result.data);\n\t\t}\n\t}, [stableChatId]);\n\n\t// Poll for pending actions periodically (every 10 seconds)\n\tuseEffect(() => {\n\t\tfetchPendingActions();\n\t\tconst interval = setInterval(fetchPendingActions, 10000);\n\t\treturn () => clearInterval(interval);\n\t}, [fetchPendingActions]);\n\n\t// Handler for approving owner-required actions\n\tconst handleOwnerApprove = useCallback(async (actionId: string) => {\n\t\tconst result = await approveAIAction({ actionId });\n\t\tif (result.success) {\n\t\t\ttoast.success(\n\t\t\t\tresult.data?.executed\n\t\t\t\t\t? \"Action approved and executed!\"\n\t\t\t\t\t: \"Action approved! Executing...\"\n\t\t\t);\n\t\t\t// Refresh pending actions\n\t\t\tfetchPendingActions();\n\t\t\treturn { success: true };\n\t\t}\n\t\treturn { success: false, error: result.error };\n\t}, [fetchPendingActions]);\n\n\t// Handler for rejecting owner-required actions\n\tconst handleOwnerReject = useCallback(async (actionId: string, reason?: string) => {\n\t\tconst result = await rejectAIAction({ actionId, reason });\n\t\tif (result.success) {\n\t\t\ttoast.info(\"Action rejected\");\n\t\t\tfetchPendingActions();\n\t\t\treturn { success: true };\n\t\t}\n\t\treturn { success: false, error: result.error };\n\t}, [fetchPendingActions]);\n\n\t// Open approval dialog for a specific action\n\tconst handleViewActionDetails = useCallback((action: PendingAction) => {\n\t\tsetSelectedPendingAction(action);\n\t\tsetApprovalDialogOpen(true);\n\t}, []);\n\n\t// Refs for stable callback references - prevents useChat from re-initializing\n\tconst storeChatIdRef = useRef(storeChatId);\n\tconst addMessageRef = useRef(addMessage);\n\tconst fetchPendingActionsRef = useRef(fetchPendingActions);\n\n\t// Keep refs updated\n\tuseEffect(() => {\n\t\tstoreChatIdRef.current = storeChatId;\n\t}, [storeChatId]);\n\n\tuseEffect(() => {\n\t\taddMessageRef.current = addMessage;\n\t}, [addMessage]);\n\n\tuseEffect(() => {\n\t\tfetchPendingActionsRef.current = fetchPendingActions;\n\t}, [fetchPendingActions]);\n\n\t// Memoize body to prevent useChat re-initialization\n\t// Uses stableChatId which never changes for this component instance\n\tconst chatBody = useMemo(() => ({\n\t\tcompanyId,\n\t\tchatId: stableChatId,\n\t\tmodel: selectedModel,\n\t}), [companyId, stableChatId, selectedModel]);\n\n\t// Memoize onFinish callback to prevent useChat re-initialization\n\tconst handleChatFinish = useCallback((message: AiMessage) => {\n\t\t// Sync with chat store when message finishes\n\t\tconst currentStoreChatId = storeChatIdRef.current;\n\t\tif (currentStoreChatId && message.content) {\n\t\t\taddMessageRef.current(currentStoreChatId, {\n\t\t\t\tid: message.id,\n\t\t\t\trole: message.role as \"user\" | \"assistant\",\n\t\t\t\tcontent: message.content,\n\t\t\t\ttimestamp: new Date(),\n\t\t\t});\n\t\t}\n\n\t\t// Check for approval requests in tool results\n\t\tconst toolInvocations = (message as AiMessage & { toolInvocations?: ToolInvocation[] }).toolInvocations;\n\t\tif (toolInvocations) {\n\t\t\t// Check for basic approval requests\n\t\t\tconst approvalRequests = toolInvocations\n\t\t\t\t.filter((inv) => inv.state === \"result\" && inv.toolName === \"requestApproval\")\n\t\t\t\t.map((inv) => ({\n\t\t\t\t\t...(inv.result as { action: string; reason: string; details: string }),\n\t\t\t\t\ttoolCallId: inv.toolCallId,\n\t\t\t\t}));\n\n\t\t\tif (approvalRequests.length > 0) {\n\t\t\t\tsetPendingApprovals((prev) => [...prev, ...approvalRequests]);\n\t\t\t}\n\n\t\t\t// Check for owner-required approval results (destructive actions)\n\t\t\tconst ownerApprovalResults = toolInvocations\n\t\t\t\t.filter((inv) => {\n\t\t\t\t\tif (inv.state !== \"result\") return false;\n\t\t\t\t\tconst result = inv.result as { requiresOwnerApproval?: boolean } | undefined;\n\t\t\t\t\treturn result?.requiresOwnerApproval === true;\n\t\t\t\t});\n\n\t\t\tif (ownerApprovalResults.length > 0) {\n\t\t\t\t// Refresh pending actions to show the new ones\n\t\t\t\tfetchPendingActionsRef.current();\n\t\t\t}\n\t\t}\n\t}, []); // Empty deps - uses refs for latest values\n\n\t// Use Vercel AI SDK's useChat hook (v5 API)\n\t// Uses stableChatId which NEVER changes for this component instance\n\t// This prevents the hook from reinitializing on state changes\n\tconst {\n\t\tmessages,\n\t\terror,\n\t\tsendMessage,\n\t\tsetMessages,\n\t\tstatus,\n\t\tregenerate,\n\t} = useChat({\n\t\tid: stableChatId, // Always stable - never undefined, never changes\n\t\tapi: \"/api/ai/chat\",\n\t\tbody: chatBody,\n\t\tonFinish: handleChatFinish,\n\t});\n\n\t// Derive loading state from status (v5 API change)\n\tconst isLoading = status === \"submitted\" || status === \"streaming\";\n\n\t// Handle approval/rejection of AI actions\n\tconst handleApproval = async (approval: ApprovalRequest, approved: boolean) => {\n\t\t// Remove from pending\n\t\tsetPendingApprovals((prev) => prev.filter((a) => a.toolCallId !== approval.toolCallId));\n\n\t\t// Send response to AI using v5 API\n\t\tsendMessage({\n\t\t\ttext: approved\n\t\t\t\t? `Yes, I approve: ${approval.action}`\n\t\t\t\t: `No, do not proceed with: ${approval.action}`,\n\t\t});\n\t};\n\n\t// NOTE: We no longer sync from Zustand store - useChat manages its own message state\n\t// Messages are only persisted to Zustand when AI finishes (via handleChatFinish)\n\n\t// Hide suggested actions once user starts chatting\n\tuseEffect(() => {\n\t\tif (messages.length > 0) {\n\t\t\tsetShowSuggestedActions(false);\n\t\t}\n\t}, [messages.length]);\n\n\tconst onSubmit = useCallback(async (message: { text: string; files: any[] }, event: React.FormEvent<HTMLFormElement>) => {\n\t\tif (!message.text?.trim()) return;\n\n\t\t// Require companyId for authenticated API calls\n\t\tif (!companyId) {\n\t\t\ttoast.error(\"Please wait - loading company data...\");\n\t\t\treturn;\n\t\t}\n\n\t\t// Add user message to store for persistence\n\t\tconst currentStoreChatId = storeChatIdRef.current;\n\t\tif (currentStoreChatId) {\n\t\t\tconst userMessage = {\n\t\t\t\tid: `msg-${Date.now()}`,\n\t\t\t\trole: \"user\" as const,\n\t\t\t\tcontent: message.text,\n\t\t\t\ttimestamp: new Date(),\n\t\t\t};\n\t\t\taddMessage(currentStoreChatId, userMessage);\n\t\t}\n\n\t\t// Send to AI using v5 API - sendMessage instead of append\n\t\t// Files are passed directly in the message object (not as options)\n\t\tsendMessage({\n\t\t\ttext: message.text,\n\t\t\tfiles: message.files?.length > 0 ? message.files : undefined,\n\t\t});\n\t}, [companyId, addMessage, sendMessage]);\n\n\tconst handleSuggestedAction = useCallback((action: { text: string; icon: React.ElementType }) => {\n\t\tonSubmit({ text: action.text, files: [] }, {} as React.FormEvent<HTMLFormElement>);\n\t}, [onSubmit]);\n\n\t// Message action handlers\n\tconst handleCopyMessage = useCallback(async (content: string) => {\n\t\ttry {\n\t\t\tawait navigator.clipboard.writeText(content);\n\t\t\ttoast.success(\"Copied to clipboard\");\n\t\t} catch {\n\t\t\ttoast.error(\"Failed to copy\");\n\t\t}\n\t}, []);\n\n\tconst handleRegenerateMessage = useCallback(async (messageId: string) => {\n\t\t// Use v5 regenerate API with optional messageId\n\t\tregenerate({ messageId });\n\t\ttoast.success(\"Regenerating response...\");\n\t}, [regenerate]);\n\n\tconst handleFeedback = useCallback((messageId: string, type: \"up\" | \"down\") => {\n\t\t// Log feedback for analytics - can be extended to store in database\n\t\tconsole.info(\"[AI Feedback]\", {\n\t\t\tmessageId,\n\t\t\tfeedbackType: type,\n\t\t\ttimestamp: new Date().toISOString(),\n\t\t});\n\t\ttoast.success(type === \"up\" ? \"Thanks for the feedback!\" : \"We'll improve based on your feedback\");\n\t}, []);\n\n\tconst handleEditMessage = useCallback((messageId: string, content: string) => {\n\t\t// Find the message and allow editing\n\t\tconst messageIndex = messages.findIndex((m) => m.id === messageId);\n\t\tif (messageIndex < 0) return;\n\n\t\t// Set the input to the message content for editing\n\t\t// This will require the PromptInputProvider to be updated\n\t\t// For now, we'll just copy to clipboard\n\t\thandleCopyMessage(content);\n\t\ttoast.info(\"Message copied - paste and edit in the input\");\n\t}, [messages, handleCopyMessage]);\n\n\t// Render tool invocation UI\n\tconst renderToolInvocation = (invocation: ToolInvocation) => {\n\t\tconst ToolIcon = toolIcons[invocation.toolName] || Wrench;\n\t\tconst isCompleted = invocation.state === \"result\";\n\t\tconst isRunning = invocation.state === \"call\";\n\n\t\treturn (\n\t\t\t<div key={invocation.toolCallId} className=\"flex items-center gap-2 text-xs text-muted-foreground py-1\">\n\t\t\t\t<ToolIcon className=\"h-3 w-3\" />\n\t\t\t\t<span>{invocation.toolName.replace(/([A-Z])/g, \" $1\").trim()}</span>\n\t\t\t\t<span className={cn(\n\t\t\t\t\t\"ml-auto\",\n\t\t\t\t\tisCompleted ? \"text-green-600\" : \"text-muted-foreground\"\n\t\t\t\t)}>\n\t\t\t\t\t{isCompleted ? \"Done\" : isRunning ? \"Running...\" : \"Pending\"}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t);\n\t};\n\n\t// Render approval request UI\n\tconst renderApprovalRequest = (approval: ApprovalRequest) => (\n\t\t<div key={approval.toolCallId} className=\"rounded-lg border border-amber-200 bg-amber-50 dark:border-amber-800 dark:bg-amber-950/20 p-3\">\n\t\t\t<p className=\"text-sm font-medium mb-1\">Approval Required</p>\n\t\t\t<p className=\"text-sm text-muted-foreground mb-2\">{approval.action}</p>\n\t\t\t<p className=\"text-xs text-muted-foreground mb-3\">{approval.reason}</p>\n\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t<Button size=\"sm\" onClick={() => handleApproval(approval, true)}>\n\t\t\t\t\tApprove\n\t\t\t\t</Button>\n\t\t\t\t<Button size=\"sm\" variant=\"outline\" onClick={() => handleApproval(approval, false)}>\n\t\t\t\t\tReject\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\t);\n\n\n\treturn (\n\t\t<>\n\t\t<OwnerActionApprovalDialog\n\t\t\tpendingAction={selectedPendingAction}\n\t\t\tisOpen={approvalDialogOpen}\n\t\t\tonOpenChange={setApprovalDialogOpen}\n\t\t\tonApprove={handleOwnerApprove}\n\t\t\tonReject={handleOwnerReject}\n\t\t\tisOwner={isOwner}\n\t\t/>\n\t\t<div className=\"flex h-full flex-col\">\n\t\t\t{/* Messages */}\n\t\t\t<div className=\"flex-1 overflow-y-auto\">\n\t\t\t\t<div className=\"mx-auto max-w-3xl px-4\" role=\"log\">\n\t\t\t\t\t<Conversation>\n\t\t\t\t\t\t<ConversationContent>\n\t\t\t\t\t\t\t{messages.length === 0 && !isLoading && (\n\t\t\t\t\t\t\t\t<ConversationEmptyState\n\t\t\t\t\t\t\t\t\ticon={<Image src=\"/ThorbisLogo.webp\" alt=\"Thorbis AI\" width={48} height={48} className=\"h-12 w-12\" />}\n\t\t\t\t\t\t\t\t\ttitle=\"AI Business Manager\"\n\t\t\t\t\t\t\t\t\tdescription=\"Ask me anything about your business - customers, jobs, invoices, scheduling, and more.\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t{messages.map((message) => {\n\t\t\t\t\t\t\t\tconst toolInvocations = (message as AiMessage & { toolInvocations?: ToolInvocation[] }).toolInvocations;\n\t\t\t\t\t\t\t\tconst attachments = (message as AiMessage & { experimental_attachments?: Array<{ name?: string; content?: string; url?: string; mediaType?: string }> }).experimental_attachments;\n\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<Message key={message.id} from={message.role}>\n\t\t\t\t\t\t\t\t\t\t{/* User message attachments */}\n\t\t\t\t\t\t\t\t\t\t{message.role === \"user\" && attachments && attachments.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t<MessageAttachments className=\"mb-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t{attachments.map((attachment, idx) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<MessageAttachment\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={idx}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata={{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"file\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: attachment.url || \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmediaType: attachment.mediaType || \"application/octet-stream\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfilename: attachment.name || \"attachment\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t\t</MessageAttachments>\n\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t<MessageContent>\n\t\t\t\t\t\t\t\t\t\t\t{/* Render tool invocations for assistant messages */}\n\t\t\t\t\t\t\t\t\t\t\t{message.role === \"assistant\" && toolInvocations && toolInvocations.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"mb-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{toolInvocations\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.filter((inv) => inv.toolName !== \"requestApproval\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.map((inv) => renderToolInvocation(inv))}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t\t{message.content && (\n\t\t\t\t\t\t\t\t\t\t\t\t<MessageResponse>{message.content}</MessageResponse>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t\t{/* Render artifacts if present for assistant messages */}\n\t\t\t\t\t\t\t\t\t\t\t{message.role === \"assistant\" && attachments?.map((attachment, idx) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<Artifact key={idx} className=\"mt-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<ArtifactHeader>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ArtifactTitle>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{attachment.name || \"Artifact\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</ArtifactTitle>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{attachment.mediaType && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ArtifactDescription>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{attachment.mediaType}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</ArtifactDescription>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ArtifactActions>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{attachment.content && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ArtifactAction\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttooltip=\"Copy code\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ticon={Copy}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleCopyMessage(attachment.content || \"\")}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{attachment.url && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ArtifactAction\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttooltip=\"Open in new tab\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ticon={ExternalLink}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => window.open(attachment.url, \"_blank\")}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{attachment.content && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ArtifactAction\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttooltip=\"Download\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ticon={Download}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst blob = new Blob([attachment.content || \"\"], { type: \"text/plain\" });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst a = document.createElement(\"a\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ta.href = url;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ta.download = attachment.name || \"artifact.txt\";\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ta.click();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</ArtifactActions>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</ArtifactHeader>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<ArtifactContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{attachment.content && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<pre className=\"overflow-x-auto rounded-md bg-muted p-4 text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<code>{attachment.content}</code>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</pre>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{attachment.url && !attachment.content && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ExternalLink className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thref={attachment.url}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-primary hover:underline text-sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tView artifact\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</ArtifactContent>\n\t\t\t\t\t\t\t\t\t\t\t\t</Artifact>\n\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t</MessageContent>\n\n\t\t\t\t\t\t\t\t\t\t{/* Message Toolbar with Actions */}\n\t\t\t\t\t\t\t\t\t\t{message.content && (\n\t\t\t\t\t\t\t\t\t\t\t<MessageToolbar className=\"opacity-0 group-hover:opacity-100 transition-opacity\">\n\t\t\t\t\t\t\t\t\t\t\t\t<MessageActions>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<MessageAction\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttooltip=\"Copy\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleCopyMessage(message.content)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Copy className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</MessageAction>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t{message.role === \"user\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<MessageAction\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttooltip=\"Edit\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleEditMessage(message.id, message.content)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Pencil className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</MessageAction>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t{message.role === \"assistant\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<MessageAction\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttooltip=\"Regenerate\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleRegenerateMessage(message.id)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<RefreshCw className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</MessageAction>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<MessageAction\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttooltip=\"Good response\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleFeedback(message.id, \"up\")}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ThumbsUp className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</MessageAction>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<MessageAction\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttooltip=\"Bad response\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleFeedback(message.id, \"down\")}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ThumbsDown className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</MessageAction>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</MessageActions>\n\t\t\t\t\t\t\t\t\t\t\t</MessageToolbar>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</Message>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t})}\n\n\t\t\t\t\t\t\t{isLoading && (\n\t\t\t\t\t\t\t\t<Message from=\"assistant\">\n\t\t\t\t\t\t\t\t\t<MessageContent>\n\t\t\t\t\t\t\t\t\t\t<Loader />\n\t\t\t\t\t\t\t\t\t</MessageContent>\n\t\t\t\t\t\t\t\t</Message>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</ConversationContent>\n\t\t\t\t\t\t<ConversationScrollButton />\n\t\t\t\t\t</Conversation>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Suggested Actions & Input */}\n\t\t\t<div className=\"bg-background px-4 py-4\">\n\t\t\t\t<div className=\"mx-auto max-w-3xl flex flex-col gap-3\">\n\t\t\t\t\t{/* Owner-Required Pending Actions (Destructive) */}\n\t\t\t\t\t{ownerPendingActions.length > 0 && (\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t{ownerPendingActions.map((action) => (\n\t\t\t\t\t\t\t\t<ActionApprovalBanner\n\t\t\t\t\t\t\t\t\tkey={action.id}\n\t\t\t\t\t\t\t\t\tpendingAction={action}\n\t\t\t\t\t\t\t\t\tonViewDetails={() => handleViewActionDetails(action)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Basic Approval Requests */}\n\t\t\t\t\t{pendingApprovals.length > 0 && (\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t{pendingApprovals.map((approval) => renderApprovalRequest(approval))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Suggested Actions */}\n\t\t\t\t\t{showSuggestedActions && messages.length === 0 && (\n\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\" data-testid=\"suggested-actions\">\n\t\t\t\t\t\t\t{SUGGESTED_ACTIONS.map((action, idx) => {\n\t\t\t\t\t\t\t\tconst ActionIcon = action.icon;\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tkey={idx}\n\t\t\t\t\t\t\t\t\t\tclassName=\"inline-flex items-center gap-2 text-sm border border-border bg-background hover:bg-muted rounded-lg px-3 py-2 transition-colors\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => handleSuggestedAction(action)}\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<ActionIcon className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t<span>{action.text}</span>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Input */}\n\t\t\t\t\t<ChatInputInner\n\t\t\t\t\t\tonSubmit={onSubmit}\n\t\t\t\t\t\tselectedModel={selectedModel}\n\t\t\t\t\t\tsetSelectedModel={setSelectedModel}\n\t\t\t\t\t\tstatus={status}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t</>\n\t);\n}\n"],"names":[],"mappings":"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"}}]
}