{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/lib/telnyx/webrtc.ts"],"sourcesContent":["/**\n * Telnyx WebRTC Service - Real-Time Communications\n *\n * Handles WebRTC operations for browser and React Native calling:\n * - WebRTC token generation\n * - Credential management\n * - Connection configuration\n *\n * Compatible with both web browsers and React Native apps.\n */\n\nimport { Buffer } from \"node:buffer\";\n\n/**\n * WebRTC connection options\n */\nexport type WebRTCConnectionOptions = {\n\tusername?: string;\n\tpassword?: string;\n\texpires_at?: number;\n\tttl?: number;\n};\n\n/**\n * WebRTC credential response\n */\nexport type WebRTCCredential = {\n\tusername: string;\n\tpassword: string;\n\texpires_at: number;\n\trealm: string;\n\tsip_uri: string;\n\tstun_servers: string[];\n\tturn_servers: Array<{\n\t\turls: string[];\n\t\tusername: string;\n\t\tcredential: string;\n\t}>;\n};\n\nconst TELNYX_CREDENTIAL_NAME_MAX_LENGTH = 64;\n\n/**\n * Generate WebRTC credentials for a user\n *\n * These credentials are used to authenticate the WebRTC client\n * and establish a connection to Telnyx's WebRTC platform.\n */\nexport async function generateWebRTCToken(params: {\n\tusername: string;\n\tttl?: number; // Time to live in seconds (default: 86400 = 24 hours)\n}): Promise<{\n\tsuccess: boolean;\n\tcredential?: WebRTCCredential;\n\terror?: string;\n}> {\n\ttry {\n\t\tconst apiKey = process.env.TELNYX_API_KEY;\n\n\t\tif (!apiKey) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"TELNYX_API_KEY is not configured\",\n\t\t\t};\n\t\t}\n\n\t\t// Sanitize username - Telnyx requires only letters and numbers\n\t\t// Remove all special characters (@, ., -, _, etc.) and replace with empty string\n\t\tconst sanitizedUsername = params.username.replace(/[^a-zA-Z0-9]/g, \"\");\n\n\t\tconst baseName =\n\t\t\tsanitizedUsername.length > 0\n\t\t\t\t? sanitizedUsername\n\t\t\t\t: Buffer.from(params.username || \"user\").toString(\"hex\");\n\t\tconst uniqueSuffix = Date.now().toString(36);\n\t\tconst prefixLength = Math.max(\n\t\t\t1,\n\t\t\tTELNYX_CREDENTIAL_NAME_MAX_LENGTH - uniqueSuffix.length,\n\t\t);\n\t\tconst credentialPrefix = baseName.slice(0, prefixLength);\n\t\tconst staticName = `${credentialPrefix}${uniqueSuffix}`;\n\t\tconst listResponse = await fetch(\n\t\t\t\"https://api.telnyx.com/v2/credential_connections\",\n\t\t\t{\n\t\t\t\tmethod: \"GET\",\n\t\t\t\theaders: {\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\tAuthorization: `Bearer ${apiKey}`,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\n\t\tif (listResponse.ok) {\n\t\t\tconst listData = await listResponse.json();\n\n\t\t\t// Delete old credentials that match this user's sanitized username\n\t\t\tif (listData.data && Array.isArray(listData.data)) {\n\t\t\t\tconst userCredentials = listData.data.filter((cred: any) =>\n\t\t\t\t\tcred.connection_name?.startsWith(credentialPrefix),\n\t\t\t\t);\n\n\t\t\t\tfor (const cred of userCredentials) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait fetch(\n\t\t\t\t\t\t\t`https://api.telnyx.com/v2/credential_connections/${cred.id}`,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmethod: \"DELETE\",\n\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\tAuthorization: `Bearer ${apiKey}`,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t} catch (_error) {\n\t\t\t\t\t\t// Continue anyway - deletion errors shouldn't block new credential creation\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst generatedPassword = generateRandomPassword(32);\n\n\t\t// Use Telnyx REST API to create WebRTC credentials\n\t\t// Documentation: https://developers.telnyx.com/api/v2/webrtc/credentials\n\t\tconst response = await fetch(\n\t\t\t\"https://api.telnyx.com/v2/credential_connections\",\n\t\t\t{\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\tAuthorization: `Bearer ${apiKey}`,\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tconnection_name: staticName,\n\t\t\t\t\tuser_name: staticName,\n\t\t\t\t\tpassword: generatedPassword,\n\t\t\t\t\tttl: params.ttl || 86_400,\n\t\t\t\t}),\n\t\t\t},\n\t\t);\n\n\t\tif (!response.ok) {\n\t\t\tconst errorText = await response.text();\n\n\t\t\t// If the API endpoint isn't available, try the simpler credentials endpoint\n\t\t\tconst altPassword = generateRandomPassword(32);\n\t\t\tconst altResponse = await fetch(\n\t\t\t\t\"https://api.telnyx.com/v2/texml_credentials\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\tAuthorization: `Bearer ${apiKey}`,\n\t\t\t\t\t},\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tconnection_name: staticName,\n\t\t\t\t\t\tuser_name: staticName, // Both must be unique!\n\t\t\t\t\t\tpassword: altPassword,\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tif (!altResponse.ok) {\n\t\t\t\tconst _altErrorText = await altResponse.text();\n\t\t\t\tthrow new Error(`Telnyx API error: ${response.status} - ${errorText}`);\n\t\t\t}\n\n\t\t\tconst altData = await altResponse.json();\n\n\t\t\tconst credential: WebRTCCredential = {\n\t\t\t\tusername: altData.data?.user_name || staticName,\n\t\t\t\tpassword: altData.data?.password || altPassword,\n\t\t\t\texpires_at: Date.now() + (params.ttl || 86_400) * 1000,\n\t\t\t\trealm: \"sip.telnyx.com\",\n\t\t\t\tsip_uri: `sip:${staticName}@sip.telnyx.com`,\n\t\t\t\tstun_servers: [\n\t\t\t\t\t\"stun:stun.telnyx.com:3478\",\n\t\t\t\t\t\"stun:stun.telnyx.com:3479\",\n\t\t\t\t],\n\t\t\t\tturn_servers: [\n\t\t\t\t\t{\n\t\t\t\t\t\turls: [\n\t\t\t\t\t\t\t\"turn:turn.telnyx.com:3478?transport=udp\",\n\t\t\t\t\t\t\t\"turn:turn.telnyx.com:3478?transport=tcp\",\n\t\t\t\t\t\t],\n\t\t\t\t\t\tusername: altData.data?.user_name || staticName,\n\t\t\t\t\t\tcredential: altData.data?.password || generateRandomPassword(24),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t};\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tcredential,\n\t\t\t};\n\t\t}\n\t\tconst data = await response.json();\n\n\t\t// Map Telnyx API response to our credential format\n\t\tconst credential: WebRTCCredential = {\n\t\t\tusername: data.data?.user_name || staticName,\n\t\t\tpassword: data.data?.password || generatedPassword,\n\t\t\texpires_at: data.data?.expires_at\n\t\t\t\t? new Date(data.data.expires_at).getTime()\n\t\t\t\t: Date.now() + (params.ttl || 86_400) * 1000,\n\t\t\trealm: data.data?.realm || \"sip.telnyx.com\",\n\t\t\tsip_uri: data.data?.sip_uri || `sip:${staticName}@sip.telnyx.com`,\n\t\t\tstun_servers: data.data?.ice_servers?.stun || [\n\t\t\t\t\"stun:stun.telnyx.com:3478\",\n\t\t\t\t\"stun:stun.telnyx.com:3479\",\n\t\t\t],\n\t\t\tturn_servers: data.data?.ice_servers?.turn || [\n\t\t\t\t{\n\t\t\t\t\turls: [\n\t\t\t\t\t\t\"turn:turn.telnyx.com:3478?transport=udp\",\n\t\t\t\t\t\t\"turn:turn.telnyx.com:3478?transport=tcp\",\n\t\t\t\t\t],\n\t\t\t\t\tusername: data.data?.user_name || staticName,\n\t\t\t\t\tcredential: data.data?.password,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tcredential,\n\t\t};\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror:\n\t\t\t\terror instanceof Error\n\t\t\t\t\t? error.message\n\t\t\t\t\t: \"Failed to generate WebRTC token\",\n\t\t};\n\t}\n}\n\n/**\n * Validate WebRTC credential expiration\n */\nfunction isCredentialExpired(credential: WebRTCCredential): boolean {\n\treturn Date.now() >= credential.expires_at;\n}\n\n/**\n * Get time until credential expires (in seconds)\n */\nfunction getCredentialTimeToLive(credential: WebRTCCredential): number {\n\tconst ttl = Math.floor((credential.expires_at - Date.now()) / 1000);\n\treturn Math.max(0, ttl);\n}\n\n/**\n * Format SIP URI for calling\n */\nfunction formatSIPUri(\n\tphoneNumber: string,\n\trealm = \"sip.telnyx.com\",\n): string {\n\t// Remove any non-digit characters\n\tconst cleanNumber = phoneNumber.replace(/\\D/g, \"\");\n\n\t// Format as SIP URI\n\treturn `sip:${cleanNumber}@${realm}`;\n}\n\n/**\n * Generate a random password for WebRTC credentials\n */\nfunction generateRandomPassword(length = 32): string {\n\tconst characters =\n\t\t\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*\";\n\tlet password = \"\";\n\n\tfor (let i = 0; i < length; i++) {\n\t\tpassword += characters.charAt(\n\t\t\tMath.floor(Math.random() * characters.length),\n\t\t);\n\t}\n\n\treturn password;\n}\n\n/**\n * WebRTC connection configuration for @telnyx/webrtc client\n */\nexport type WebRTCClientConfig = {\n\tcredential: WebRTCCredential;\n\ticeServers: RTCIceServer[];\n\tdebug?: boolean;\n\tringbackFile?: string;\n\tringtoneFile?: string;\n};\n\n/**\n * Create WebRTC client configuration\n */\nfunction createWebRTCConfig(\n\tcredential: WebRTCCredential,\n\tdebug = false,\n): WebRTCClientConfig {\n\t// Convert Telnyx credential format to RTCIceServer format\n\tconst iceServers: RTCIceServer[] = [\n\t\t// STUN servers\n\t\t...credential.stun_servers.map((url) => ({\n\t\t\turls: url,\n\t\t})),\n\t\t// TURN servers\n\t\t...credential.turn_servers.map((server) => ({\n\t\t\turls: server.urls,\n\t\t\tusername: server.username,\n\t\t\tcredential: server.credential,\n\t\t})),\n\t];\n\n\treturn {\n\t\tcredential,\n\t\ticeServers,\n\t\tdebug,\n\t};\n}\n\n/**\n * React Native WebRTC configuration helper\n *\n * Provides configuration specific to React Native apps\n */\nfunction createReactNativeWebRTCConfig(\n\tcredential: WebRTCCredential,\n): WebRTCClientConfig {\n\treturn createWebRTCConfig(credential, true); // Enable debug for mobile\n}\n\n/**\n * Web browser WebRTC configuration helper\n */\nfunction createBrowserWebRTCConfig(\n\tcredential: WebRTCCredential,\n): WebRTCClientConfig {\n\treturn createWebRTCConfig(credential, false);\n}\n\n/**\n * Test WebRTC connectivity\n *\n * Checks if the browser/device can connect to STUN/TURN servers\n */\nasync function testWebRTCConnectivity(\n\tcredential: WebRTCCredential,\n): Promise<{\n\tsuccess: boolean;\n\tstunReachable: boolean;\n\tturnReachable: boolean;\n\terror?: string;\n}> {\n\ttry {\n\t\t// Create a test peer connection\n\t\tconst pc = new RTCPeerConnection({\n\t\t\ticeServers: [\n\t\t\t\t{ urls: credential.stun_servers },\n\t\t\t\t...credential.turn_servers.map((server) => ({\n\t\t\t\t\turls: server.urls,\n\t\t\t\t\tusername: server.username,\n\t\t\t\t\tcredential: server.credential,\n\t\t\t\t})),\n\t\t\t],\n\t\t});\n\n\t\tlet stunReachable = false;\n\t\tlet turnReachable = false;\n\n\t\t// Listen for ICE candidates to test connectivity\n\t\tpc.onicecandidate = (event) => {\n\t\t\tif (event.candidate) {\n\t\t\t\tconst candidateType = event.candidate.type;\n\t\t\t\tif (candidateType === \"srflx\") {\n\t\t\t\t\tstunReachable = true;\n\t\t\t\t}\n\t\t\t\tif (candidateType === \"relay\") {\n\t\t\t\t\tturnReachable = true;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Create a dummy offer to trigger ICE gathering\n\t\tconst offer = await pc.createOffer();\n\t\tawait pc.setLocalDescription(offer);\n\n\t\t// Wait for ICE gathering to complete\n\t\tawait new Promise<void>((resolve) => {\n\t\t\tconst checkState = () => {\n\t\t\t\tif (pc.iceGatheringState === \"complete\") {\n\t\t\t\t\tresolve();\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout(checkState, 100);\n\t\t\t\t}\n\t\t\t};\n\t\t\tcheckState();\n\t\t});\n\n\t\t// Clean up\n\t\tpc.close();\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tstunReachable,\n\t\t\tturnReachable,\n\t\t};\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\tstunReachable: false,\n\t\t\tturnReachable: false,\n\t\t\terror:\n\t\t\t\terror instanceof Error ? error.message : \"Failed to test connectivity\",\n\t\t};\n\t}\n}\n"],"names":[],"mappings":"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"}}]
}