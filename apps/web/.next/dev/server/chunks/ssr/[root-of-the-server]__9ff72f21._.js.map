{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/ui/button.tsx"],"sourcesContent":["// Re-export from @stratos/ui package\nexport * from \"@stratos/ui\";\n"],"names":[],"mappings":"AAAA,qCAAqC;;AACrC"}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/ui/card.tsx"],"sourcesContent":["// Re-export from @stratos/ui package\nexport * from \"@stratos/ui\";\n"],"names":[],"mappings":"AAAA,qCAAqC;;AACrC"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/layout/company-gate.tsx"],"sourcesContent":["import { Building2 } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tCard,\n\tCardContent,\n\tCardDescription,\n\tCardHeader,\n\tCardTitle,\n} from \"@/components/ui/card\";\n\ntype CompanyGateProps = {\n\tcontext?: string;\n\thasCompanies?: boolean;\n};\n\nexport function CompanyGate({\n\tcontext = \"this page\",\n\thasCompanies = false,\n}: CompanyGateProps) {\n\tconst description = hasCompanies\n\t\t? `Choose an active workspace from the switcher so we know which ${context} data to load.`\n\t\t: `Youâ€™re not part of any workspace yet. Ask an admin to invite you or create one to unlock ${context}.`;\n\n\treturn (\n\t\t<div className=\"flex min-h-[60vh] items-center justify-center px-6 py-12\">\n\t\t\t<Card className=\"max-w-xl shadow-lg\">\n\t\t\t\t<CardHeader className=\"flex items-start gap-3\">\n\t\t\t\t\t<div className=\"bg-muted rounded-lg p-3\">\n\t\t\t\t\t\t<Building2 className=\"text-muted-foreground size-6\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<CardTitle>Connect a workspace to continue</CardTitle>\n\t\t\t\t\t\t<CardDescription>{description}</CardDescription>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"flex flex-wrap gap-3\">\n\t\t\t\t\t<Button asChild>\n\t\t\t\t\t\t<Link href=\"/dashboard/settings\">Open settings</Link>\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button asChild variant=\"outline\">\n\t\t\t\t\t\t<Link href=\"/dashboard\">Back to dashboard</Link>\n\t\t\t\t\t</Button>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAAA;AACA;AAAA;;;;;;AAaO,SAAS,YAAY,EAC3B,UAAU,WAAW,EACrB,eAAe,KAAK,EACF;IAClB,MAAM,cAAc,eACjB,CAAC,8DAA8D,EAAE,QAAQ,cAAc,CAAC,GACxF,CAAC,yFAAyF,EAAE,QAAQ,CAAC,CAAC;IAEzG,qBACC,qZAAC;QAAI,WAAU;kBACd,cAAA,qZAAC,sIAAI;YAAC,WAAU;;8BACf,qZAAC,4IAAU;oBAAC,WAAU;;sCACrB,qZAAC;4BAAI,WAAU;sCACd,cAAA,qZAAC,iTAAS;gCAAC,WAAU;;;;;;;;;;;sCAEtB,qZAAC;;8CACA,qZAAC,2IAAS;8CAAC;;;;;;8CACX,qZAAC,iJAAe;8CAAE;;;;;;;;;;;;;;;;;;8BAGpB,qZAAC,6IAAW;oBAAC,WAAU;;sCACtB,qZAAC,0IAAM;4BAAC,OAAO;sCACd,cAAA,qZAAC,iWAAI;gCAAC,MAAK;0CAAsB;;;;;;;;;;;sCAElC,qZAAC,0IAAM;4BAAC,OAAO;4BAAC,SAAQ;sCACvB,cAAA,qZAAC,iWAAI;gCAAC,MAAK;0CAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAM9B"}},
    {"offset": {"line": 194, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/schedule/schedule-page-client.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const SchedulePageClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call SchedulePageClient() from the server but SchedulePageClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/schedule/schedule-page-client.tsx <module evaluation>\",\n    \"SchedulePageClient\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,qBAAqB,IAAA,+aAAuB,EACrD;IAAa,MAAM,IAAI,MAAM;AAAoP,GACjR,2FACA","ignoreList":[0]}},
    {"offset": {"line": 208, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/schedule/schedule-page-client.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const SchedulePageClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call SchedulePageClient() from the server but SchedulePageClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/schedule/schedule-page-client.tsx\",\n    \"SchedulePageClient\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,qBAAqB,IAAA,+aAAuB,EACrD;IAAa,MAAM,IAAI,MAAM;AAAoP,GACjR,uEACA","ignoreList":[0]}},
    {"offset": {"line": 222, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 230, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/lib/schedule-bootstrap.ts"],"sourcesContent":["import type {\n\tCustomer,\n\tJob,\n\tRecurrenceRule,\n\tTechnician,\n\tTechnicianSchedule,\n} from \"@/components/schedule/schedule-types\";\nimport type { UnassignedJobsMeta } from \"@/lib/schedule/types\";\n\nexport type SerializedRecurrenceRule = Omit<RecurrenceRule, \"endDate\"> & {\n\tendDate?: string;\n};\n\nexport type SerializedCustomer = Omit<Customer, \"createdAt\" | \"updatedAt\"> & {\n\tcreatedAt: string;\n\tupdatedAt: string;\n};\n\nexport type SerializedTechnicianSchedule = Omit<\n\tTechnicianSchedule,\n\t\"daysOff\"\n> & {\n\tdaysOff: string[];\n};\n\nexport type SerializedTechnician = Omit<\n\tTechnician,\n\t\"createdAt\" | \"updatedAt\" | \"schedule\"\n> & {\n\tcreatedAt: string;\n\tupdatedAt: string;\n\tschedule: SerializedTechnicianSchedule;\n};\n\nexport type SerializedJob = Omit<\n\tJob,\n\t| \"startTime\"\n\t| \"endTime\"\n\t| \"createdAt\"\n\t| \"updatedAt\"\n\t| \"customer\"\n\t| \"recurrence\"\n> & {\n\tstartTime: string;\n\tendTime: string;\n\tcreatedAt: string;\n\tupdatedAt: string;\n\tcustomer: SerializedCustomer;\n\trecurrence?: SerializedRecurrenceRule;\n};\n\nexport type ScheduleBootstrapSerialized = {\n\tcompanyId: string;\n\trange: {\n\t\tstart: string;\n\t\tend: string;\n\t};\n\tlastSync: string;\n\tjobs: SerializedJob[];\n\ttechnicians: SerializedTechnician[];\n\tunassignedMeta?: UnassignedJobsMeta;\n};\n\nexport type ScheduleHydrationPayload = {\n\tcompanyId: string;\n\trange: {\n\t\tstart: Date;\n\t\tend: Date;\n\t};\n\tlastSync: Date;\n\tjobs: Job[];\n\ttechnicians: Technician[];\n\tunassignedMeta?: UnassignedJobsMeta;\n};\n\nexport function serializeScheduleBootstrap(\n\tpayload: ScheduleHydrationPayload,\n): ScheduleBootstrapSerialized {\n\treturn {\n\t\tcompanyId: payload.companyId,\n\t\trange: {\n\t\t\tstart: payload.range.start.toISOString(),\n\t\t\tend: payload.range.end.toISOString(),\n\t\t},\n\t\tlastSync: payload.lastSync.toISOString(),\n\t\tjobs: payload.jobs.map(serializeJob),\n\t\ttechnicians: payload.technicians.map(serializeTechnician),\n\t\tunassignedMeta: payload.unassignedMeta,\n\t};\n}\n\nexport function deserializeScheduleBootstrap(\n\tpayload: ScheduleBootstrapSerialized,\n): ScheduleHydrationPayload {\n\treturn {\n\t\tcompanyId: payload.companyId,\n\t\trange: {\n\t\t\tstart: new Date(payload.range.start),\n\t\t\tend: new Date(payload.range.end),\n\t\t},\n\t\tlastSync: new Date(payload.lastSync),\n\t\tjobs: payload.jobs.map(deserializeJob),\n\t\ttechnicians: payload.technicians.map(deserializeTechnician),\n\t\tunassignedMeta: payload.unassignedMeta,\n\t};\n}\n\nexport function serializeJob(job: Job): SerializedJob {\n\treturn {\n\t\t...job,\n\t\tstartTime: job.startTime.toISOString(),\n\t\tendTime: job.endTime.toISOString(),\n\t\tcreatedAt: job.createdAt.toISOString(),\n\t\tupdatedAt: job.updatedAt.toISOString(),\n\t\tcustomer: {\n\t\t\t...job.customer,\n\t\t\tcreatedAt: job.customer.createdAt.toISOString(),\n\t\t\tupdatedAt: job.customer.updatedAt.toISOString(),\n\t\t},\n\t\trecurrence: job.recurrence\n\t\t\t? serializeRecurrence(job.recurrence)\n\t\t\t: undefined,\n\t};\n}\n\nexport function deserializeJob(job: SerializedJob): Job {\n\treturn {\n\t\t...job,\n\t\tstartTime: new Date(job.startTime),\n\t\tendTime: new Date(job.endTime),\n\t\tcreatedAt: new Date(job.createdAt),\n\t\tupdatedAt: new Date(job.updatedAt),\n\t\tcustomer: {\n\t\t\t...job.customer,\n\t\t\tcreatedAt: new Date(job.customer.createdAt),\n\t\t\tupdatedAt: new Date(job.customer.updatedAt),\n\t\t},\n\t\trecurrence: job.recurrence\n\t\t\t? deserializeRecurrence(job.recurrence)\n\t\t\t: undefined,\n\t};\n}\n\nfunction serializeTechnician(technician: Technician): SerializedTechnician {\n\treturn {\n\t\t...technician,\n\t\tcreatedAt: technician.createdAt.toISOString(),\n\t\tupdatedAt: technician.updatedAt.toISOString(),\n\t\tschedule: serializeTechnicianSchedule(technician.schedule),\n\t};\n}\n\nfunction deserializeTechnician(technician: SerializedTechnician): Technician {\n\treturn {\n\t\t...technician,\n\t\tcreatedAt: new Date(technician.createdAt),\n\t\tupdatedAt: new Date(technician.updatedAt),\n\t\tschedule: deserializeTechnicianSchedule(technician.schedule),\n\t};\n}\n\nfunction serializeTechnicianSchedule(\n\tschedule: TechnicianSchedule,\n): SerializedTechnicianSchedule {\n\treturn {\n\t\t...schedule,\n\t\tdaysOff: schedule.daysOff.map((date) => date.toISOString()),\n\t};\n}\n\nfunction deserializeTechnicianSchedule(\n\tschedule: SerializedTechnicianSchedule,\n): TechnicianSchedule {\n\treturn {\n\t\t...schedule,\n\t\tdaysOff: schedule.daysOff.map((value) => new Date(value)),\n\t};\n}\n\nfunction serializeRecurrence(\n\trecurrence: RecurrenceRule,\n): SerializedRecurrenceRule {\n\treturn {\n\t\t...recurrence,\n\t\tendDate: recurrence.endDate ? recurrence.endDate.toISOString() : undefined,\n\t};\n}\n\nfunction deserializeRecurrence(\n\trecurrence: SerializedRecurrenceRule,\n): RecurrenceRule {\n\treturn {\n\t\t...recurrence,\n\t\tendDate: recurrence.endDate ? new Date(recurrence.endDate) : undefined,\n\t};\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 340, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/components/schedule/schedule-types.ts"],"sourcesContent":["// ============================================\n// CORE DATA TYPES\n// ============================================\n\nexport type Address = {\n\tstreet: string;\n\tcity: string;\n\tstate: string;\n\tzip: string;\n\tcountry: string;\n};\n\nexport type Location = {\n\taddress: Address;\n\tcoordinates: {\n\t\tlat: number;\n\t\tlng: number;\n\t};\n\tplaceId?: string; // Google Places ID\n};\n\nexport type Customer = {\n\tid: string;\n\tname: string;\n\temail?: string;\n\tphone?: string;\n\tcompany?: string;\n\tlocation: Location;\n\tnotes?: string;\n\tcreatedAt: Date;\n\tupdatedAt: Date;\n};\n\nexport type RecurrenceRule = {\n\tfrequency: \"daily\" | \"weekly\" | \"monthly\" | \"yearly\";\n\tinterval: number; // Every N days/weeks/months/years\n\tendDate?: Date;\n\tcount?: number; // Stop after N occurrences\n\tdaysOfWeek?: number[]; // 0-6 (Sunday-Saturday)\n\tdayOfMonth?: number; // 1-31\n\tmonthOfYear?: number; // 1-12\n};\n\nexport type JobMetadata = {\n\testimatedDuration?: number; // minutes\n\tactualDuration?: number; // minutes\n\tmaterials?: string[];\n\tnotes?: string;\n\tinternalNotes?: string;\n\tattachments?: string[]; // URLs\n\ttags?: string[];\n\tcustomFields?: Record<string, any>;\n};\n\nexport type JobAssignmentRole = \"primary\" | \"assistant\" | \"crew\" | \"supervisor\";\n\nexport type JobAssignment = {\n\ttechnicianId: string | null;\n\tteamMemberId?: string | null;\n\tdisplayName: string;\n\tavatar?: string | null;\n\trole: JobAssignmentRole;\n\tstatus?: Technician[\"status\"];\n\tisActive: boolean;\n};\n\nexport type JobType =\n\t| \"service\"\n\t| \"service_call\"\n\t| \"repair\"\n\t| \"installation\"\n\t| \"maintenance\"\n\t| \"premium_maintenance\"\n\t| \"inspection\"\n\t| \"emergency\"\n\t| \"estimate\"\n\t| \"callback\"\n\t| \"other\";\n\n// Appointment category for visual differentiation (meeting vs job vs event)\nexport type AppointmentCategory = \"job\" | \"meeting\" | \"event\";\n\n// Maps database appointment types to display categories\nexport function getAppointmentCategory(\n\ttype?: string | null,\n\tallDay?: boolean,\n): AppointmentCategory {\n\t// All-day appointments are events\n\tif (allDay) return \"event\";\n\n\tswitch (type?.toLowerCase()) {\n\t\tcase \"meeting\":\n\t\tcase \"appointment\":\n\t\tcase \"follow_up\":\n\t\tcase \"consultation\":\n\t\tcase \"call\":\n\t\t\treturn \"meeting\";\n\t\tcase \"event\":\n\t\tcase \"training\":\n\t\tcase \"conference\":\n\t\tcase \"holiday\":\n\t\t\treturn \"event\";\n\t\tcase \"job\":\n\t\tcase \"service\":\n\t\tcase \"repair\":\n\t\tcase \"installation\":\n\t\tcase \"maintenance\":\n\t\tcase \"inspection\":\n\t\tcase \"estimate\":\n\t\tcase \"callback\":\n\t\tdefault:\n\t\t\treturn \"job\";\n\t}\n}\n\nexport type Job = {\n\tid: string; // Schedule ID\n\tjobId?: string; // Actual job ID (for linking to job details)\n\ttechnicianId: string; // Primary technician id (falls back to first assignment or empty string)\n\tassignments: JobAssignment[];\n\tisUnassigned: boolean;\n\n\t// Job details\n\ttitle: string;\n\tdescription?: string;\n\tjobType?: JobType;\n\tappointmentType?: string; // Raw type from appointments table (job, appointment, meeting, etc.)\n\tappointmentCategory?: AppointmentCategory; // Derived: job | meeting | event\n\tcustomer: Customer;\n\tlocation: Location;\n\n\t// Scheduling\n\tstartTime: Date;\n\tendTime: Date;\n\tallDay?: boolean; // For meetings, events\n\n\t// Status\n\tstatus:\n\t\t| \"scheduled\"\n\t\t| \"dispatched\"\n\t\t| \"arrived\"\n\t\t| \"in-progress\"\n\t\t| \"closed\"\n\t\t| \"completed\"\n\t\t| \"cancelled\";\n\tpriority: \"low\" | \"medium\" | \"high\" | \"urgent\";\n\n\t// Recurrence\n\trecurrence?: RecurrenceRule;\n\tparentJobId?: string; // For recurring job instances\n\n\t// Metadata\n\tmetadata: JobMetadata;\n\n\t// Audit\n\tcreatedAt: Date;\n\tupdatedAt: Date;\n\tcreatedBy?: string;\n\tupdatedBy?: string;\n};\n\nexport type TechnicianSchedule = {\n\tavailableHours: {\n\t\tstart: number; // 0-23\n\t\tend: number; // 0-23\n\t};\n\tdaysOff: Date[];\n\tbreakTimes?: Array<{\n\t\tstart: number; // minutes from day start\n\t\tend: number;\n\t}>;\n};\n\nexport type Technician = {\n\tid: string;\n\tuserId?: string;\n\tteamMemberId?: string;\n\tname: string;\n\temail?: string;\n\tphone?: string;\n\tavatar?: string;\n\tcolor?: string;\n\n\t// Employment\n\trole: string;\n\tdepartment?: string;\n\tskills?: string[];\n\tcertifications?: string[];\n\n\t// Status\n\tstatus: \"available\" | \"on-job\" | \"on-break\" | \"offline\";\n\tisActive?: boolean;\n\tcurrentLocation?: Location;\n\n\t// Schedule\n\tschedule: TechnicianSchedule;\n\n\t// Audit\n\tcreatedAt: Date;\n\tupdatedAt: Date;\n};\n\n// ============================================\n// LEGACY COMPATIBILITY (for migration)\n// ============================================\n\n/** @deprecated Use Job with Date objects instead */\nexport type LegacyJob = {\n\tid: string;\n\ttitle: string;\n\tcustomer: string;\n\tstartTime: string; // HH:MM format\n\tendTime: string; // HH:MM format\n\tstatus: \"scheduled\" | \"in-progress\" | \"completed\" | \"cancelled\";\n\tpriority: \"low\" | \"medium\" | \"high\" | \"urgent\";\n\tlocation: string;\n\taddress: string;\n\tlat: number;\n\tlng: number;\n\tdescription?: string;\n\testimatedDuration?: string;\n};\n\n"],"names":[],"mappings":"AAAA,+CAA+C;AAC/C,kBAAkB;AAClB,+CAA+C;;;;;AAiFxC,SAAS,uBACf,IAAoB,EACpB,MAAgB;IAEhB,kCAAkC;IAClC,IAAI,QAAQ,OAAO;IAEnB,OAAQ,MAAM;QACb,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACJ,OAAO;QACR,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACJ,OAAO;QACR,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL;YACC,OAAO;IACT;AACD"}},
    {"offset": {"line": 378, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/lib/schedule-data.ts"],"sourcesContent":["import { cache } from \"react\";\nimport type { SupabaseClient } from \"@supabase/supabase-js\";\nimport { addDays, subDays } from \"date-fns\";\nimport {\n\ttype Job,\n\ttype JobAssignment,\n\ttype Technician,\n\tgetAppointmentCategory,\n} from \"@/components/schedule/schedule-types\";\nimport type { UnassignedJobsMeta } from \"@/lib/schedule/types\";\nimport type { ScheduleHydrationPayload } from \"@/lib/schedule-bootstrap\";\nimport type { Database } from \"@/types/supabase\";\n\ntype Tables = Database[\"public\"][\"Tables\"];\n\ntype ScheduleRow = Tables[\"appointments\"][\"Row\"];\ntype CustomerRow = Tables[\"customers\"][\"Row\"];\ntype PropertyRow = Tables[\"properties\"][\"Row\"];\ntype JobRow = Tables[\"jobs\"][\"Row\"];\ntype TeamMemberRow = Tables[\"team_members\"][\"Row\"];\ntype JobTeamAssignmentRow = Tables[\"job_team_assignments\"][\"Row\"];\ntype JobRecord = Tables[\"jobs\"][\"Row\"];\n\ntype JobCustomer = Pick<\n\tCustomerRow,\n\t| \"id\"\n\t| \"first_name\"\n\t| \"last_name\"\n\t| \"email\"\n\t| \"phone\"\n\t| \"created_at\"\n\t| \"updated_at\"\n>;\n\ntype JobRowWithRelations = JobRecord & {\n\tcustomer?: JobCustomer | JobCustomer[] | null;\n\tproperty?: ScheduleProperty | ScheduleProperty[] | null;\n\tjob_team_assignments?: Array<\n\t\tJobTeamAssignmentRow & {\n\t\t\tteam_member: TeamMemberRow | null;\n\t\t}\n\t> | null;\n};\n\nexport type ScheduleRecord = ScheduleRow & {\n\tcustomer: Pick<\n\t\tCustomerRow,\n\t\t\"id\" | \"first_name\" | \"last_name\" | \"email\" | \"phone\"\n\t> | null;\n\tjob:\n\t\t| (JobRow & {\n\t\t\t\tjob_team_assignments: Array<\n\t\t\t\t\tJobTeamAssignmentRow & {\n\t\t\t\t\t\tteam_member: TeamMemberRow | null;\n\t\t\t\t\t}\n\t\t\t\t> | null;\n\t\t  })\n\t\t| null;\n};\n\ntype ScheduleProperty = Pick<\n\tPropertyRow,\n\t| \"id\"\n\t| \"name\"\n\t| \"address\"\n\t| \"address2\"\n\t| \"city\"\n\t| \"state\"\n\t| \"zip_code\"\n\t| \"country\"\n\t| \"lat\"\n\t| \"lon\"\n>;\n\ntype Range = {\n\tstart: Date;\n\tend: Date;\n};\n\ntype LoadParams = {\n\tsupabase: SupabaseClient<Database>;\n\tcompanyId: string;\n\trange?: Range;\n\tunscheduledLimit?: number;\n\tunscheduledOffset?: number;\n\tunscheduledSearch?: string;\n};\n\ntype TeamMemberRecord = TeamMemberRow & {\n\tusers: {\n\t\tid: string;\n\t\tname: string | null;\n\t\temail: string | null;\n\t\tphone: string | null;\n\t\tavatar: string | null;\n\t} | null;\n};\n\nexport type TechniciansLookup = {\n\ttechnicians: Technician[];\n\tbyId: Map<string, Technician>;\n\tbyUserId: Map<string, Technician>;\n\tbyTeamMemberId: Map<string, Technician>;\n};\n\nconst UNASSIGNED_TECHNICIAN_ID = \"__unassigned\";\n\n// Retry utility with exponential backoff for resilient data fetching\ntype RetryOptions = {\n\tmaxRetries?: number;\n\tinitialDelay?: number;\n\tmaxDelay?: number;\n\tbackoffFactor?: number;\n\tshouldRetry?: (error: unknown) => boolean;\n};\n\nconst DEFAULT_RETRY_OPTIONS: Required<RetryOptions> = {\n\tmaxRetries: 3,\n\tinitialDelay: 500,\n\tmaxDelay: 5000,\n\tbackoffFactor: 2,\n\tshouldRetry: (error) => {\n\t\t// Retry on network errors, timeouts, and server errors (5xx)\n\t\tif (error instanceof Error) {\n\t\t\tconst message = error.message.toLowerCase();\n\t\t\treturn (\n\t\t\t\tmessage.includes(\"network\") ||\n\t\t\t\tmessage.includes(\"timeout\") ||\n\t\t\t\tmessage.includes(\"connection\") ||\n\t\t\t\tmessage.includes(\"fetch failed\") ||\n\t\t\t\tmessage.includes(\"econnreset\") ||\n\t\t\t\tmessage.includes(\"500\") ||\n\t\t\t\tmessage.includes(\"502\") ||\n\t\t\t\tmessage.includes(\"503\") ||\n\t\t\t\tmessage.includes(\"504\")\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t},\n};\n\nasync function withRetry<T>(\n\tfn: () => Promise<T>,\n\tcontext: string,\n\toptions: RetryOptions = {},\n): Promise<T> {\n\tconst opts = { ...DEFAULT_RETRY_OPTIONS, ...options };\n\tlet lastError: unknown;\n\tlet delay = opts.initialDelay;\n\n\tfor (let attempt = 0; attempt <= opts.maxRetries; attempt++) {\n\t\ttry {\n\t\t\treturn await fn();\n\t\t} catch (error) {\n\t\t\tlastError = error;\n\n\t\t\tif (attempt === opts.maxRetries || !opts.shouldRetry(error)) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t`[Schedule] ${context} failed after ${attempt + 1} attempt(s):`,\n\t\t\t\t\terror instanceof Error ? error.message : String(error),\n\t\t\t\t);\n\t\t\t\tthrow error;\n\t\t\t}\n\n\t\t\tconsole.warn(\n\t\t\t\t`[Schedule] ${context} attempt ${attempt + 1} failed, retrying in ${delay}ms...`,\n\t\t\t\terror instanceof Error ? error.message : String(error),\n\t\t\t);\n\n\t\t\tawait new Promise((resolve) => setTimeout(resolve, delay));\n\t\t\tdelay = Math.min(delay * opts.backoffFactor, opts.maxDelay);\n\t\t}\n\t}\n\n\tthrow lastError;\n}\n\nconst scheduleSelect = `\n  *,\n  customer:customers(\n    id,\n    first_name,\n    last_name,\n    email,\n    phone\n  ),\n  job:jobs(\n    id,\n    job_number,\n    title,\n    job_type,\n    company_id,\n    job_team_assignments:job_team_assignments!job_team_assignments_job_id_fkey(\n      id,\n      role,\n      team_member_id,\n      removed_at,\n      team_member:team_members(\n        id,\n        company_id,\n        status,\n        job_title,\n        department,\n        archived_at,\n        user_id,\n        phone,\n        email,\n        invited_name,\n        created_at,\n        updated_at\n      )\n    )\n  )\n`;\n\nconst UNSCHEDULED_JOBS_SELECT = `\n  *,\n  customer:customers!customer_id(\n    id,\n    first_name,\n    last_name,\n    email,\n    phone,\n    created_at,\n    updated_at\n  ),\n  property:properties!property_id(\n    id,\n    name,\n    address,\n    address2,\n    city,\n    state,\n    zip_code,\n    country,\n    lat,\n    lon\n  ),\n  job_team_assignments:job_team_assignments!job_team_assignments_job_id_fkey(\n    id,\n    role,\n    team_member_id,\n    removed_at,\n    team_member:team_members(\n      id,\n      company_id,\n      status,\n      job_title,\n      department,\n      archived_at,\n      user_id,\n      phone,\n      email,\n      invited_name,\n      created_at,\n      updated_at\n    )\n  )\n`;\n\nconst DEFAULT_TECHNICIAN_COLOR = \"#3B82F6\";\n\nconst DEFAULT_SCHEDULE = {\n\tworkingHours: { start: \"08:00\", end: \"17:00\" },\n\tdaysOff: [] as Date[],\n\tavailableHours: { start: 0, end: 40 },\n};\n\nconst DEFAULT_LOCATION = {\n\taddress: {\n\t\tstreet: \"\",\n\t\tcity: \"\",\n\t\tstate: \"\",\n\t\tzip: \"\",\n\t\tcountry: \"\",\n\t},\n\tcoordinates: {\n\t\tlat: 0,\n\t\tlng: 0,\n\t},\n};\n\nconst DEFAULT_UNSCHEDULED_DURATION_MINUTES = 60;\nconst DEFAULT_UNSCHEDULED_PAGE_SIZE = 50;\n\ntype UnscheduledQueryOptions = {\n\tlimit?: number;\n\toffset?: number;\n\tsearch?: string;\n};\n\nexport async function fetchScheduleData({\n\tsupabase,\n\tcompanyId,\n\trange,\n\tunscheduledLimit = DEFAULT_UNSCHEDULED_PAGE_SIZE,\n\tunscheduledOffset = 0,\n\tunscheduledSearch = \"\",\n}: LoadParams): Promise<{\n\tjobs: Job[];\n\ttechnicians: Technician[];\n\tunassignedMeta: UnassignedJobsMeta;\n}> {\n\tconst scheduleQuery = supabase\n\t\t.from(\"appointments\")\n\t\t.select(scheduleSelect)\n\t\t.eq(\"company_id\", companyId)\n\t\t.is(\"deleted_at\", null)\n\t\t.is(\"archived_at\", null)\n\t\t.order(\"start_time\", { ascending: true });\n\n\tif (range) {\n\t\tscheduleQuery.lte(\"start_time\", range.end.toISOString());\n\t\tscheduleQuery.gte(\"end_time\", range.start.toISOString());\n\t}\n\n\t// Fetch all three queries in parallel with retry logic (eliminates waterfall)\n\tlet scheduleResult;\n\tlet teamMembers;\n\tlet unscheduledResult;\n\n\ttry {\n\t\t[scheduleResult, teamMembers, unscheduledResult] = await withRetry(\n\t\t\t() =>\n\t\t\t\tPromise.all([\n\t\t\t\t\tscheduleQuery,\n\t\t\t\t\tfetchTeamMembersWithUsers(supabase, companyId),\n\t\t\t\t\tfetchUnscheduledJobs(supabase, companyId, {\n\t\t\t\t\t\tlimit: unscheduledLimit,\n\t\t\t\t\t\toffset: unscheduledOffset,\n\t\t\t\t\t\tsearch: unscheduledSearch,\n\t\t\t\t\t}),\n\t\t\t\t]),\n\t\t\t\"fetchScheduleData parallel queries\",\n\t\t);\n\t} catch (error) {\n\t\tconsole.error(\"[Schedule] Failed to fetch schedule data:\", error);\n\t\tthrow new Error(\n\t\t\t`Schedule data query failed: ${error instanceof Error ? error.message : String(error)}`,\n\t\t);\n\t}\n\n\tconst scheduleRows = scheduleResult.data ?? [];\n\tconst scheduleError = scheduleResult.error;\n\n\tif (scheduleError) {\n\t\tconsole.error(\"Appointments query error:\", scheduleError);\n\t\tthrow new Error(`Appointments query failed: ${scheduleError.message}`);\n\t}\n\n\tconst scheduledJobIds = new Set(\n\t\tscheduleRows\n\t\t\t.map((row) => (row as ScheduleRow).job_id)\n\t\t\t.filter((id): id is string => Boolean(id)),\n\t);\n\n\tconst unscheduledJobRows = unscheduledResult.rows.filter(\n\t\t(row) => !scheduledJobIds.has(row.id),\n\t);\n\tconst unscheduledMeta = {\n\t\ttotalCount: unscheduledResult.totalCount,\n\t\thasMore: unscheduledResult.hasMore,\n\t\tfetchedCount: unscheduledResult.rows.length,\n\t};\n\n\tlet propertyMap;\n\ttry {\n\t\tpropertyMap = await withRetry(\n\t\t\t() =>\n\t\t\t\tfetchPropertiesByIds(\n\t\t\t\t\tsupabase,\n\t\t\t\t\tcollectPropertyIds(scheduleRows as ScheduleRow[], unscheduledJobRows),\n\t\t\t\t),\n\t\t\t\"fetchPropertiesByIds\",\n\t\t);\n\t} catch (error) {\n\t\tconsole.error(\"[Schedule] Failed to fetch properties:\", error);\n\t\t// Return empty map as fallback - jobs will still work but without property details\n\t\tpropertyMap = new Map<string, ScheduleProperty>();\n\t}\n\n\tconst technicianLookups = mapTeamMembersToTechnicians(teamMembers);\n\n\tconst normalizedSchedules = scheduleRows as unknown as ScheduleRecord[];\n\n\tconst scheduledJobs = normalizedSchedules.map((schedule) =>\n\t\tmapScheduleToJob(\n\t\t\tschedule,\n\t\t\ttechnicianLookups,\n\t\t\tpropertyMap.get(schedule.property_id ?? \"\") ?? null,\n\t\t),\n\t);\n\n\tconst unscheduledJobs = unscheduledJobRows.map((jobRow) =>\n\t\tmapJobRowToUnscheduledJob(\n\t\t\tjobRow,\n\t\t\ttechnicianLookups,\n\t\t\tpropertyMap.get(jobRow.property_id ?? \"\") ?? null,\n\t\t),\n\t);\n\n\tconst jobs = [...scheduledJobs, ...unscheduledJobs];\n\n\treturn {\n\t\tjobs,\n\t\ttechnicians: technicianLookups.technicians,\n\t\tunassignedMeta: {\n\t\t\tlimit: unscheduledLimit,\n\t\t\tnextOffset: unscheduledOffset + unscheduledMeta.fetchedCount,\n\t\t\thasMore: unscheduledMeta.hasMore,\n\t\t\tsearch: unscheduledSearch,\n\t\t\ttotalCount: unscheduledMeta.totalCount,\n\t\t},\n\t};\n}\n\nfunction resolveScheduleRange(\n\trange?: Range,\n\tanchor: Date = new Date(),\n): Range {\n\tif (range) {\n\t\treturn range;\n\t}\n\n\tconst start = subDays(anchor, 7);\n\tconst end = addDays(anchor, 30);\n\treturn { start, end };\n}\n\nasync function loadScheduleSnapshot(\n\tparams: LoadParams & { range?: Range },\n): Promise<ScheduleHydrationPayload> {\n\tconst resolvedRange = resolveScheduleRange(params.range);\n\tconst { jobs, technicians, unassignedMeta } = await fetchScheduleData({\n\t\t...params,\n\t\trange: resolvedRange,\n\t});\n\n\treturn {\n\t\tcompanyId: params.companyId,\n\t\trange: resolvedRange,\n\t\tlastSync: new Date(),\n\t\tjobs,\n\t\ttechnicians,\n\t\tunassignedMeta,\n\t};\n}\n\nfunction createTechnicianJobMap(jobs: Job[]): Record<string, Job[]> {\n\treturn jobs.reduce<Record<string, Job[]>>((acc, job) => {\n\t\tconst key = job.technicianId || UNASSIGNED_TECHNICIAN_ID;\n\t\tif (!acc[key]) {\n\t\t\tacc[key] = [];\n\t\t}\n\t\tacc[key].push(job);\n\t\treturn acc;\n\t}, {});\n}\n\n// Optimized: Single query with join instead of N+1 pattern\nasync function fetchTeamMembersWithUsers(\n\tsupabase: SupabaseClient<Database>,\n\tcompanyId: string,\n): Promise<TeamMemberRecord[]> {\n\t// Use a single query with left join to profiles via user_id\n\tconst { data: membersWithUsers, error } = await supabase\n\t\t.from(\"company_memberships\")\n\t\t.select(`\n\t\t\t*,\n\t\t\tusers:profiles!company_memberships_profile_id_fkey(\n\t\t\t\tid,\n\t\t\t\tfull_name,\n\t\t\t\temail,\n\t\t\t\tphone,\n\t\t\t\tavatar_url\n\t\t\t)\n\t\t`)\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"status\", \"active\")\n\t\t.is(\"archived_at\", null);\n\n\tif (error) {\n\t\t// Fallback to the old two-query approach if join fails\n\t\tconsole.warn(\"Join query failed, falling back to sequential queries:\", error.message);\n\t\treturn fetchTeamMembersWithUsersFallback(supabase, companyId);\n\t}\n\n\treturn (membersWithUsers ?? []).map((member) => ({\n\t\t...member,\n\t\tusers: member.users ? {\n\t\t\tid: member.users.id,\n\t\t\tname: member.users.full_name,\n\t\t\temail: member.users.email,\n\t\t\tphone: member.users.phone,\n\t\t\tavatar: member.users.avatar_url,\n\t\t} : null,\n\t})) as TeamMemberRecord[];\n}\n\n// Fallback function if the join doesn't work\nasync function fetchTeamMembersWithUsersFallback(\n\tsupabase: SupabaseClient<Database>,\n\tcompanyId: string,\n): Promise<TeamMemberRecord[]> {\n\tconst { data: bareMembers, error: bareError } = await supabase\n\t\t.from(\"company_memberships\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"status\", \"active\")\n\t\t.is(\"archived_at\", null);\n\n\tif (bareError) {\n\t\tthrow bareError;\n\t}\n\n\tconst userIds = Array.from(\n\t\tnew Set(\n\t\t\t(bareMembers ?? [])\n\t\t\t\t.map((member) => member.user_id)\n\t\t\t\t.filter((id): id is string => Boolean(id)),\n\t\t),\n\t);\n\n\tconst usersById = new Map<string, TeamMemberRecord[\"users\"]>();\n\tif (userIds.length > 0) {\n\t\tconst { data: users, error: userError } = await supabase\n\t\t\t.from(\"profiles\")\n\t\t\t.select(\"id, full_name, email, phone, avatar_url\")\n\t\t\t.in(\"id\", userIds);\n\t\tif (userError) {\n\t\t\tthrow userError;\n\t\t}\n\t\t(users ?? []).forEach((user) => {\n\t\t\tusersById.set(user.id, user);\n\t\t});\n\t}\n\n\treturn (bareMembers ?? []).map((member) => ({\n\t\t...member,\n\t\tusers: member.user_id ? (usersById.get(member.user_id) ?? null) : null,\n\t})) as TeamMemberRecord[];\n}\n\nasync function fetchUnscheduledJobs(\n\tsupabase: SupabaseClient<Database>,\n\tcompanyId: string,\n\toptions: UnscheduledQueryOptions,\n): Promise<{\n\trows: JobRowWithRelations[];\n\ttotalCount: number;\n\thasMore: boolean;\n}> {\n\tconst limit = options.limit ?? DEFAULT_UNSCHEDULED_PAGE_SIZE;\n\tconst offset = options.offset ?? 0;\n\n\tlet query = supabase\n\t\t.from(\"jobs\")\n\t\t.select(UNSCHEDULED_JOBS_SELECT, { count: \"exact\" })\n\t\t.eq(\"company_id\", companyId)\n\t\t.is(\"deleted_at\", null)\n\t\t.is(\"archived_at\", null)\n\t\t.is(\"scheduled_start\", null)\n\t\t.is(\"scheduled_end\", null)\n\t\t.not(\"status\", \"in\", '(\"completed\",\"cancelled\")')\n\t\t.order(\"created_at\", { ascending: false })\n\t\t.range(offset, offset + limit - 1);\n\n\tif (options.search?.trim()) {\n\t\tconst sanitized = options.search.trim().replace(/,/g, \"\\\\,\");\n\t\tconst term = `%${sanitized}%`;\n\t\tquery = query.or(\n\t\t\t`title.ilike.${term},job_number.ilike.${term},description.ilike.${term}`,\n\t\t);\n\t}\n\n\tlet data;\n\tlet count;\n\tlet error;\n\n\ttry {\n\t\tconst result = await query;\n\t\tdata = result.data;\n\t\tcount = result.count;\n\t\terror = result.error;\n\t} catch (fetchError) {\n\t\tconsole.error(\"[Schedule] Unscheduled jobs fetch failed:\", fetchError);\n\t\t// Return empty result instead of throwing - allows schedule to still load with scheduled jobs\n\t\treturn { rows: [], totalCount: 0, hasMore: false };\n\t}\n\n\tif (error) {\n\t\tconsole.error(\"[Schedule] Unscheduled jobs query error:\", error);\n\t\t// Return empty result as fallback\n\t\treturn { rows: [], totalCount: 0, hasMore: false };\n\t}\n\n\tconst rows = (data ?? []) as JobRowWithRelations[];\n\tconst totalCount = typeof count === \"number\" ? count : rows.length;\n\tconst hasMore = offset + rows.length < totalCount;\n\n\treturn { rows, totalCount, hasMore };\n}\n\nasync function fetchPropertiesByIds(\n\tsupabase: SupabaseClient<Database>,\n\tpropertyIds: string[],\n): Promise<Map<string, ScheduleProperty>> {\n\tconst map = new Map<string, ScheduleProperty>();\n\tif (propertyIds.length === 0) {\n\t\treturn map;\n\t}\n\n\tconst chunkSize = 100;\n\tfor (let i = 0; i < propertyIds.length; i += chunkSize) {\n\t\tconst chunk = propertyIds.slice(i, i + chunkSize);\n\t\ttry {\n\t\t\tconst { data, error } = await supabase\n\t\t\t\t.from(\"properties\")\n\t\t\t\t.select(\n\t\t\t\t\t\"id, name, address, address2, city, state, zip_code, country, lat, lon\",\n\t\t\t\t)\n\t\t\t\t.in(\"id\", chunk);\n\n\t\t\tif (error) {\n\t\t\t\tconsole.error(\"[Schedule] Properties query error:\", error);\n\t\t\t\t// Continue with next chunk instead of failing completely\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t(data ?? []).forEach((property) => map.set(property.id, property));\n\t\t} catch (chunkError) {\n\t\t\tconsole.error(`[Schedule] Failed to fetch properties chunk ${i / chunkSize + 1}:`, chunkError);\n\t\t\t// Continue with next chunk - graceful degradation\n\t\t\tcontinue;\n\t\t}\n\t}\n\treturn map;\n}\n\nfunction mapTeamMembersToTechnicians(\n\tteamMembers: TeamMemberRecord[],\n): TechniciansLookup {\n\tconst technicians: Technician[] = [];\n\tconst byId = new Map<string, Technician>();\n\tconst byUserId = new Map<string, Technician>();\n\tconst byTeamMemberId = new Map<string, Technician>();\n\n\tteamMembers.forEach((member) => {\n\t\tconst technicianId = member.user_id ?? member.id;\n\t\tif (!technicianId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst user = member.users;\n\t\tconst technician: Technician = {\n\t\t\tid: technicianId,\n\t\t\tuserId: member.user_id ?? undefined,\n\t\t\tteamMemberId: member.id,\n\t\t\tname:\n\t\t\t\tuser?.name || member.invited_name || member.job_title || \"Team Member\",\n\t\t\temail: user?.email || member.email || undefined,\n\t\t\tphone: user?.phone || member.phone || undefined,\n\t\t\tavatar: user?.avatar || undefined,\n\t\t\trole: member.job_title || member.role || \"Team Member\",\n\t\t\tdepartment: member.department || undefined,\n\t\t\tstatus: member.status === \"active\" ? \"available\" : \"offline\",\n\t\t\tisActive: member.status === \"active\" && !member.archived_at,\n\t\t\tschedule: { ...DEFAULT_SCHEDULE },\n\t\t\tcolor: DEFAULT_TECHNICIAN_COLOR,\n\t\t\tcreatedAt: new Date(member.created_at),\n\t\t\tupdatedAt: new Date(member.updated_at),\n\t\t};\n\n\t\ttechnicians.push(technician);\n\t\tbyId.set(technician.id, technician);\n\t\tif (technician.userId) {\n\t\t\tbyUserId.set(technician.userId, technician);\n\t\t}\n\t\tif (technician.teamMemberId) {\n\t\t\tbyTeamMemberId.set(technician.teamMemberId, technician);\n\t\t}\n\t});\n\n\treturn { technicians, byId, byUserId, byTeamMemberId };\n}\n\nfunction collectPropertyIds(\n\tschedules: ScheduleRow[],\n\tunscheduledJobs: JobRowWithRelations[],\n): string[] {\n\tconst ids = new Set<string>();\n\tschedules.forEach((row) => {\n\t\tif (row.property_id) {\n\t\t\tids.add(row.property_id);\n\t\t}\n\t});\n\tunscheduledJobs.forEach((job) => {\n\t\tif (job.property_id) {\n\t\t\tids.add(job.property_id);\n\t\t}\n\t});\n\treturn Array.from(ids);\n}\n\nfunction normalizeSingleRecord<T>(value: T | T[] | null | undefined): T | null {\n\tif (Array.isArray(value)) {\n\t\treturn value[0] ?? null;\n\t}\n\treturn value ?? null;\n}\n\nfunction mapJobRowToUnscheduledJob(\n\tjob: JobRowWithRelations,\n\tlookups: TechniciansLookup,\n\tproperty: ScheduleProperty | null,\n): Job {\n\tconst location = buildLocation(property);\n\tconst customer = buildJobCustomer(job, location.address.street);\n\tconst assignments = buildAssignmentsFromJobRow(job, lookups);\n\tconst startTime = job.scheduled_start\n\t\t? new Date(job.scheduled_start)\n\t\t: new Date(job.created_at);\n\tconst endTime = job.scheduled_end\n\t\t? new Date(job.scheduled_end)\n\t\t: new Date(\n\t\t\t\tstartTime.getTime() + DEFAULT_UNSCHEDULED_DURATION_MINUTES * 60 * 1000,\n\t\t\t);\n\n\treturn {\n\t\tid: job.id,\n\t\tjobId: job.id,\n\t\ttechnicianId: \"\",\n\t\tassignments,\n\t\tisUnassigned: true,\n\t\ttitle: job.title || job.job_number || \"Job\",\n\t\tdescription: job.description || undefined,\n\t\tjobType: (job.job_type as Job[\"jobType\"]) || undefined,\n\t\tcustomer,\n\t\tlocation,\n\t\tstartTime,\n\t\tendTime,\n\t\tstatus: mapJobStatus(job.status),\n\t\tpriority: mapJobPriority(job.priority),\n\t\tmetadata: buildJobMetadata(job),\n\t\tcreatedAt: new Date(job.created_at),\n\t\tupdatedAt: new Date(job.updated_at),\n\t};\n}\n\nfunction buildAssignmentsFromJobRow(\n\tjob: JobRowWithRelations,\n\tlookups: TechniciansLookup,\n): JobAssignment[] {\n\tconst assignments: JobAssignment[] = [];\n\n\tif (job.assigned_to) {\n\t\tconst technician =\n\t\t\tlookups.byUserId.get(job.assigned_to) ||\n\t\t\tlookups.byId.get(job.assigned_to);\n\t\tassignments.push({\n\t\t\ttechnicianId: null,\n\t\t\tteamMemberId: technician?.teamMemberId,\n\t\t\tdisplayName: technician?.name || \"Primary Technician\",\n\t\t\tavatar: technician?.avatar ?? null,\n\t\t\trole: \"primary\",\n\t\t\tstatus: technician?.status ?? \"available\",\n\t\t\tisActive: technician?.isActive ?? true,\n\t\t});\n\t}\n\n\tconst crewAssignments = Array.isArray(job.job_team_assignments)\n\t\t? job.job_team_assignments\n\t\t: job.job_team_assignments\n\t\t\t? [job.job_team_assignments]\n\t\t\t: [];\n\n\tcrewAssignments\n\t\t.filter((assignment) => !assignment.removed_at)\n\t\t.forEach((assignment) => {\n\t\t\tconst teamMember = assignment.team_member;\n\t\t\tif (!teamMember) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst technician =\n\t\t\t\t(teamMember.user_id && lookups.byUserId.get(teamMember.user_id)) ||\n\t\t\t\tlookups.byTeamMemberId.get(teamMember.id);\n\n\t\t\tassignments.push({\n\t\t\t\ttechnicianId: null,\n\t\t\t\tteamMemberId: teamMember.id,\n\t\t\t\tdisplayName:\n\t\t\t\t\ttechnician?.name ||\n\t\t\t\t\tteamMember.invited_name ||\n\t\t\t\t\tteamMember.job_title ||\n\t\t\t\t\t\"Crew Member\",\n\t\t\t\tavatar: technician?.avatar ?? null,\n\t\t\t\trole: (assignment.role as JobAssignment[\"role\"]) || \"crew\",\n\t\t\t\tstatus: technician?.status ?? deriveTechnicianStatus(teamMember.status),\n\t\t\t\tisActive: technician?.isActive ?? teamMember.status === \"active\",\n\t\t\t});\n\t\t});\n\n\treturn dedupeAssignments(assignments);\n}\n\nfunction buildJobCustomer(\n\tjob: JobRowWithRelations,\n\tfallbackStreet: string,\n): Job[\"customer\"] {\n\tconst customerRecord = normalizeSingleRecord(job.customer);\n\tconst name = [\n\t\tcustomerRecord?.first_name?.trim() ?? \"\",\n\t\tcustomerRecord?.last_name?.trim() ?? \"\",\n\t]\n\t\t.filter(Boolean)\n\t\t.join(\" \")\n\t\t.trim();\n\n\treturn {\n\t\tid: customerRecord?.id || job.customer_id || `customer-${job.id}`,\n\t\tname: name || job.title || \"Unspecified Customer\",\n\t\temail: customerRecord?.email || undefined,\n\t\tphone: customerRecord?.phone || undefined,\n\t\tlocation: {\n\t\t\t...DEFAULT_LOCATION,\n\t\t\taddress: {\n\t\t\t\t...DEFAULT_LOCATION.address,\n\t\t\t\tstreet: fallbackStreet,\n\t\t\t},\n\t\t},\n\t\tcreatedAt: new Date(customerRecord?.created_at ?? job.created_at),\n\t\tupdatedAt: new Date(customerRecord?.updated_at ?? job.updated_at),\n\t};\n}\n\nfunction buildJobMetadata(job: JobRowWithRelations): Job[\"metadata\"] {\n\tconst baseMetadata =\n\t\tjob.metadata && typeof job.metadata === \"object\"\n\t\t\t? (job.metadata as Job[\"metadata\"])\n\t\t\t: {};\n\tconst metadata = { ...baseMetadata };\n\tif (job.notes) {\n\t\tmetadata.notes = job.notes;\n\t}\n\treturn metadata;\n}\n\nfunction mapJobPriority(value?: string | null): Job[\"priority\"] {\n\tif (!value) {\n\t\treturn \"medium\";\n\t}\n\tconst normalized = value.toLowerCase();\n\tswitch (normalized) {\n\t\tcase \"low\":\n\t\tcase \"medium\":\n\t\tcase \"high\":\n\t\tcase \"urgent\":\n\t\t\treturn normalized as Job[\"priority\"];\n\t\tcase \"critical\":\n\t\tcase \"emergency\":\n\t\t\treturn \"urgent\";\n\t\tdefault:\n\t\t\treturn \"medium\";\n\t}\n}\n\nfunction mapJobStatus(value?: string | null): Job[\"status\"] {\n\tif (!value) {\n\t\treturn \"scheduled\";\n\t}\n\tconst normalized = value.toLowerCase();\n\tswitch (normalized) {\n\t\tcase \"scheduled\":\n\t\tcase \"dispatched\":\n\t\tcase \"arrived\":\n\t\tcase \"closed\":\n\t\tcase \"cancelled\":\n\t\t\treturn normalized as Job[\"status\"];\n\t\tcase \"in-progress\":\n\t\tcase \"in_progress\":\n\t\t\treturn \"in-progress\";\n\t\tcase \"completed\":\n\t\tcase \"complete\":\n\t\tcase \"done\":\n\t\t\treturn \"completed\";\n\t\tcase \"inprogress\":\n\t\t\treturn \"in-progress\";\n\t\tcase \"open\":\n\t\tcase \"pending\":\n\t\tcase \"draft\":\n\t\tdefault:\n\t\t\treturn \"scheduled\";\n\t}\n}\n\nfunction mapScheduleToJob(\n\tschedule: ScheduleRecord,\n\tlookups: TechniciansLookup,\n\tproperty: ScheduleProperty | null,\n): Job {\n\tconst location = buildLocation(property);\n\tconst customer = buildCustomer(schedule, location.address.street);\n\tconst assignments = buildAssignments(schedule, lookups);\n\n\tconst primaryAssignment = assignments.find(\n\t\t(assignment) => assignment.role === \"primary\",\n\t);\n\tconst technicianId = primaryAssignment?.technicianId ?? \"\";\n\n\treturn {\n\t\tid: schedule.id,\n\t\tjobId: schedule.job_id || undefined,\n\t\ttechnicianId,\n\t\tassignments,\n\t\tisUnassigned: assignments.length === 0,\n\t\ttitle: schedule.title || schedule.job?.title || \"Appointment\",\n\t\tdescription: schedule.description || undefined,\n\t\tjobType: (schedule.job?.job_type as Job[\"jobType\"]) || undefined,\n\t\tappointmentType: schedule.type || undefined,\n\t\tappointmentCategory: getAppointmentCategory(schedule.type, schedule.all_day ?? false),\n\t\tcustomer,\n\t\tlocation,\n\t\tstartTime: new Date(schedule.start_time),\n\t\tendTime: new Date(schedule.end_time),\n\t\tallDay: schedule.all_day,\n\t\tstatus:\n\t\t\t(schedule.status as Job[\"status\"]) && isJobStatus(schedule.status)\n\t\t\t\t? (schedule.status as Job[\"status\"])\n\t\t\t\t: \"scheduled\",\n\t\tpriority: \"medium\",\n\t\trecurrence: schedule.is_recurring\n\t\t\t? {\n\t\t\t\t\tfrequency: \"weekly\",\n\t\t\t\t\tinterval: 1,\n\t\t\t\t\tendDate: schedule.recurrence_end_date\n\t\t\t\t\t\t? new Date(schedule.recurrence_end_date)\n\t\t\t\t\t\t: undefined,\n\t\t\t\t}\n\t\t\t: undefined,\n\t\tmetadata: {\n\t\t\testimatedDuration: schedule.duration,\n\t\t\tnotes: schedule.notes || undefined,\n\t\t},\n\t\tcreatedAt: new Date(schedule.created_at),\n\t\tupdatedAt: new Date(schedule.updated_at),\n\t};\n}\n\nfunction buildAssignments(\n\tschedule: ScheduleRecord,\n\tlookups: TechniciansLookup,\n): JobAssignment[] {\n\tconst assignments: JobAssignment[] = [];\n\n\tif (schedule.assigned_to) {\n\t\tconst technician =\n\t\t\tlookups.byUserId.get(schedule.assigned_to) ||\n\t\t\tlookups.byId.get(schedule.assigned_to);\n\t\tassignments.push({\n\t\t\ttechnicianId: technician?.id ?? schedule.assigned_to,\n\t\t\tteamMemberId: technician?.teamMemberId,\n\t\t\tdisplayName: technician?.name || \"Primary Technician\",\n\t\t\tavatar: technician?.avatar || null,\n\t\t\trole: \"primary\",\n\t\t\tstatus: technician?.status ?? \"available\",\n\t\t\tisActive: technician?.isActive ?? true,\n\t\t});\n\t}\n\n\tconst crewAssignments =\n\t\tschedule.job?.job_team_assignments?.filter(\n\t\t\t(assignment) => !assignment.removed_at,\n\t\t) ?? [];\n\n\tcrewAssignments.forEach((assignment) => {\n\t\tconst teamMember = assignment.team_member;\n\t\tif (!teamMember) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst technician =\n\t\t\t(teamMember.user_id && lookups.byUserId.get(teamMember.user_id)) ||\n\t\t\tlookups.byTeamMemberId.get(teamMember.id);\n\n\t\tconst displayName =\n\t\t\ttechnician?.name ||\n\t\t\tteamMember.invited_name ||\n\t\t\tteamMember.job_title ||\n\t\t\t\"Crew Member\";\n\n\t\tassignments.push({\n\t\t\ttechnicianId: technician?.id ?? teamMember.user_id ?? teamMember.id,\n\t\t\tteamMemberId: teamMember.id,\n\t\t\tdisplayName,\n\t\t\tavatar: technician?.avatar || null,\n\t\t\trole: (assignment.role as JobAssignment[\"role\"]) || \"crew\",\n\t\t\tstatus: technician?.status ?? deriveTechnicianStatus(teamMember.status),\n\t\t\tisActive: technician?.isActive ?? teamMember.status === \"active\",\n\t\t});\n\t});\n\n\treturn dedupeAssignments(assignments);\n}\n\nfunction dedupeAssignments(assignments: JobAssignment[]): JobAssignment[] {\n\tconst seen = new Set<string>();\n\n\treturn assignments.filter((assignment) => {\n\t\tconst key = `${assignment.role}-${assignment.technicianId ?? assignment.teamMemberId ?? \"\"}`;\n\t\tif (seen.has(key)) {\n\t\t\treturn false;\n\t\t}\n\t\tseen.add(key);\n\t\treturn true;\n\t});\n}\n\nfunction buildCustomer(\n\tschedule: ScheduleRecord,\n\tfallbackStreet: string,\n): Job[\"customer\"] {\n\tconst customerRecord = schedule.customer;\n\tconst name =\n\t\tcustomerRecord &&\n\t\t`${customerRecord.first_name ?? \"\"} ${customerRecord.last_name ?? \"\"}`.trim();\n\n\treturn {\n\t\tid: customerRecord?.id || schedule.customer_id || `customer-${schedule.id}`,\n\t\tname: name && name.length > 0 ? name : \"Unspecified Customer\",\n\t\temail: customerRecord?.email || undefined,\n\t\tphone: customerRecord?.phone || undefined,\n\t\tlocation: {\n\t\t\t...DEFAULT_LOCATION,\n\t\t\taddress: {\n\t\t\t\t...DEFAULT_LOCATION.address,\n\t\t\t\tstreet: fallbackStreet,\n\t\t\t},\n\t\t},\n\t\tcreatedAt: new Date(schedule.created_at),\n\t\tupdatedAt: new Date(schedule.updated_at),\n\t};\n}\n\nfunction buildLocation(property: ScheduleProperty | null): Job[\"location\"] {\n\tif (!property) {\n\t\treturn { ...DEFAULT_LOCATION };\n\t}\n\n\treturn {\n\t\taddress: {\n\t\t\tstreet: property.address || property.address2 || property.name || \"\",\n\t\t\tcity: property.city || \"\",\n\t\t\tstate: property.state || \"\",\n\t\t\tzip: property.zip_code || \"\",\n\t\t\tcountry: property.country || \"\",\n\t\t},\n\t\tcoordinates: {\n\t\t\tlat: property.lat || 0,\n\t\t\tlng: property.lon || 0,\n\t\t},\n\t};\n}\n\nfunction deriveTechnicianStatus(status?: string | null): Technician[\"status\"] {\n\treturn status === \"active\" ? \"available\" : \"offline\";\n}\n\nfunction isJobStatus(value: string): value is Job[\"status\"] {\n\treturn [\n\t\t\"scheduled\",\n\t\t\"dispatched\",\n\t\t\"arrived\",\n\t\t\"in-progress\",\n\t\t\"closed\",\n\t\t\"completed\",\n\t\t\"cancelled\",\n\t].includes(value);\n}\n\nexport async function fetchAdditionalUnscheduledJobs({\n\tsupabase,\n\tcompanyId,\n\tlimit = DEFAULT_UNSCHEDULED_PAGE_SIZE,\n\toffset = 0,\n\tsearch = \"\",\n}: {\n\tsupabase: SupabaseClient<Database>;\n\tcompanyId: string;\n\tlimit?: number;\n\toffset?: number;\n\tsearch?: string;\n}): Promise<{ jobs: Job[]; meta: UnassignedJobsMeta }> {\n\tconst teamMembers = await fetchTeamMembersWithUsers(supabase, companyId);\n\tconst technicianLookups = mapTeamMembersToTechnicians(teamMembers);\n\tconst { rows, totalCount, hasMore } = await fetchUnscheduledJobs(\n\t\tsupabase,\n\t\tcompanyId,\n\t\t{\n\t\t\tlimit,\n\t\t\toffset,\n\t\t\tsearch,\n\t\t},\n\t);\n\n\tconst propertyMap = await fetchPropertiesByIds(\n\t\tsupabase,\n\t\tcollectPropertyIds([], rows),\n\t);\n\tconst jobs = rows.map((row) =>\n\t\tmapJobRowToUnscheduledJob(\n\t\t\trow,\n\t\t\ttechnicianLookups,\n\t\t\tpropertyMap.get(row.property_id ?? \"\") ?? null,\n\t\t),\n\t);\n\n\treturn {\n\t\tjobs,\n\t\tmeta: {\n\t\t\tlimit,\n\t\t\tnextOffset: offset + rows.length,\n\t\t\thasMore,\n\t\t\tsearch,\n\t\t\ttotalCount,\n\t\t},\n\t};\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1124, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/app/%28dashboard%29/dashboard/schedule/page.tsx"],"sourcesContent":["/**\n * Schedule Page - PPR Enabled\n *\n * Uses Partial Prerendering for instant page loads:\n * - Static shell renders instantly (5-20ms)\n * - Schedule data streams in (200-500ms)\n *\n * Performance: 8-20x faster than traditional SSR\n */\n\nimport { addDays, subDays } from \"date-fns\";\nimport { Suspense } from \"react\";\nimport { CompanyGate } from \"@/components/layout/company-gate\";\nimport { SchedulePageClient } from \"@/components/schedule/schedule-page-client\";\nimport {\n\tgetActiveCompanyId,\n\tgetUserCompanies,\n} from \"@/lib/auth/company-context\";\nimport type { ScheduleBootstrapSerialized } from \"@/lib/schedule-bootstrap\";\nimport { serializeScheduleBootstrap } from \"@/lib/schedule-bootstrap\";\nimport { fetchScheduleData } from \"@/lib/schedule-data\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\n\nasync function getSchedulingSupabaseClient() {\n\ttry {\n\t\t// Try service role client first (bypasses RLS for full company visibility)\n\t\tconst serviceClient = await createServiceSupabaseClient();\n\t\tif (serviceClient) {\n\t\t\treturn serviceClient;\n\t\t}\n\t\t// Service role key not configured - fall back to auth client\n\t\tconsole.warn(\n\t\t\t\"SUPABASE_SERVICE_ROLE_KEY not configured â€“ falling back to authenticated client\",\n\t\t);\n\t\treturn await createClient();\n\t} catch (error) {\n\t\t// Service client creation failed - fall back to auth client\n\t\tconsole.warn(\n\t\t\t\"Supabase service role client failed to initialize â€“ falling back to authenticated client:\",\n\t\t\terror instanceof Error ? error.message : String(error),\n\t\t);\n\t\treturn await createClient();\n\t}\n}\n\n// Schedule data component (async, streams in)\nasync function ScheduleData() {\n\tlet initialData: ScheduleBootstrapSerialized | undefined;\n\tlet bootstrapError: string | null = null;\n\n\tconst companyId = await getActiveCompanyId();\n\tif (!companyId) {\n\t\tconst companies = await getUserCompanies();\n\t\treturn (\n\t\t\t<CompanyGate\n\t\t\t\tcontext=\"scheduling\"\n\t\t\t\thasCompanies={(companies ?? []).length > 0}\n\t\t\t/>\n\t\t);\n\t}\n\n\ttry {\n\t\tconst supabase = await getSchedulingSupabaseClient();\n\n\t\tconst now = new Date();\n\t\tconst defaultRange = {\n\t\t\tstart: subDays(now, 7),\n\t\t\tend: addDays(now, 30),\n\t\t};\n\n\t\tconst { jobs, technicians } = await fetchScheduleData({\n\t\t\tsupabase,\n\t\t\tcompanyId,\n\t\t\trange: defaultRange,\n\t\t});\n\n\t\tinitialData = serializeScheduleBootstrap({\n\t\t\tcompanyId,\n\t\t\tjobs,\n\t\t\ttechnicians,\n\t\t\trange: defaultRange,\n\t\t\tlastSync: new Date(),\n\t\t});\n\t} catch (error) {\n\t\t// Log the full error details to help debug\n\t\tconsole.error(\"Schedule data fetch failed:\", error);\n\t\tif (error instanceof Error) {\n\t\t\tconsole.error(\"Error stack:\", error.stack);\n\t\t}\n\n\t\tbootstrapError =\n\t\t\terror instanceof Error\n\t\t\t\t? error.message\n\t\t\t\t: typeof error === \"string\"\n\t\t\t\t\t? error\n\t\t\t\t\t: \"Unable to load schedule data\";\n\t}\n\n\treturn (\n\t\t<SchedulePageClient\n\t\t\tbootstrapError={bootstrapError}\n\t\t\tinitialData={initialData}\n\t\t/>\n\t);\n}\n\n// Loading skeleton\nfunction ScheduleSkeleton() {\n\treturn (\n\t\t<div className=\"flex h-full w-full items-center justify-center\">\n\t\t\t<div className=\"flex flex-col items-center gap-4\">\n\t\t\t\t<div className=\"border-primary/20 border-t-primary size-12 animate-spin rounded-full border-4\" />\n\t\t\t\t<p className=\"text-muted-foreground text-sm\">Loading schedule...</p>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nexport default function SchedulePage() {\n\treturn (\n\t\t<Suspense fallback={<ScheduleSkeleton />}>\n\t\t\t<ScheduleData />\n\t\t</Suspense>\n\t);\n}\n"],"names":[],"mappings":"AAAA;;;;;;;;CAQC;;;;;AAED;AAAA;AACA;AACA;AACA;AACA;AAAA;AAKA;AACA;AACA;AACA;;;;;;;;;;;AAEA,eAAe;IACd,IAAI;QACH,2EAA2E;QAC3E,MAAM,gBAAgB,MAAM,IAAA,+KAA2B;QACvD,IAAI,eAAe;YAClB,OAAO;QACR;QACA,6DAA6D;QAC7D,QAAQ,IAAI,CACX;QAED,OAAO,MAAM,IAAA,qJAAY;IAC1B,EAAE,OAAO,OAAO;QACf,4DAA4D;QAC5D,QAAQ,IAAI,CACX,6FACA,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;QAEjD,OAAO,MAAM,IAAA,qJAAY;IAC1B;AACD;AAEA,8CAA8C;AAC9C,eAAe;IACd,IAAI;IACJ,IAAI,iBAAgC;IAEpC,MAAM,YAAY,MAAM,IAAA,mKAAkB;IAC1C,IAAI,CAAC,WAAW;QACf,MAAM,YAAY,MAAM,IAAA,iKAAgB;QACxC,qBACC,qZAAC,6KAAW;YACX,SAAQ;YACR,cAAc,CAAC,aAAa,EAAE,EAAE,MAAM,GAAG;;;;;;IAG5C;IAEA,IAAI;QACH,MAAM,WAAW,MAAM;QAEvB,MAAM,MAAM,IAAI;QAChB,MAAM,eAAe;YACpB,OAAO,IAAA,yMAAO,EAAC,KAAK;YACpB,KAAK,IAAA,yMAAO,EAAC,KAAK;QACnB;QAEA,MAAM,EAAE,IAAI,EAAE,WAAW,EAAE,GAAG,MAAM,IAAA,kKAAiB,EAAC;YACrD;YACA;YACA,OAAO;QACR;QAEA,cAAc,IAAA,gLAA0B,EAAC;YACxC;YACA;YACA;YACA,OAAO;YACP,UAAU,IAAI;QACf;IACD,EAAE,OAAO,OAAO;QACf,2CAA2C;QAC3C,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,IAAI,iBAAiB,OAAO;YAC3B,QAAQ,KAAK,CAAC,gBAAgB,MAAM,KAAK;QAC1C;QAEA,iBACC,iBAAiB,QACd,MAAM,OAAO,GACb,OAAO,UAAU,WAChB,QACA;IACN;IAEA,qBACC,qZAAC,iMAAkB;QAClB,gBAAgB;QAChB,aAAa;;;;;;AAGhB;AAEA,mBAAmB;AACnB,SAAS;IACR,qBACC,qZAAC;QAAI,WAAU;kBACd,cAAA,qZAAC;YAAI,WAAU;;8BACd,qZAAC;oBAAI,WAAU;;;;;;8BACf,qZAAC;oBAAE,WAAU;8BAAgC;;;;;;;;;;;;;;;;;AAIjD;AAEe,SAAS;IACvB,qBACC,qZAAC,wXAAQ;QAAC,wBAAU,qZAAC;;;;;kBACpB,cAAA,qZAAC;;;;;;;;;;AAGJ"}}]
}