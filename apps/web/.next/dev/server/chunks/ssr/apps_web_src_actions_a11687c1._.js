module.exports = [
"[project]/apps/web/src/actions/jobs.ts [app-ssr] (ecmascript) <locals>", ((__turbopack_context__) => {
"use strict";

/**
 * Jobs Server Actions - REFACTORED FOR DOMAIN TABLE STRUCTURE
 *
 * Handles job/work order management with comprehensive CRUD operations,
 * status transitions, scheduling, and assignment logic.
 *
 * MIGRATION NOTES:
 * - Core jobs table now has ~20 columns
 * - Domain-specific data moved to 11 domain tables
 * - Financial data -> job_financial
 * - Time tracking -> job_time_tracking
 * - Archive/deletion -> job_multi_entity
 * - All domain tables have CASCADE delete on job_id
 */ __turbopack_context__.s([]);
"use turbopack no side effects";
;
;
;
;
;
;
;
;
}),
"[project]/apps/web/src/actions/data:dc8dce [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"402966b1e12d4396b884610ead62589160248da594":"createJob"},"apps/web/src/actions/jobs.ts",""] */ __turbopack_context__.s([
    "createJob",
    ()=>createJob
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next@16.0.4_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
"use turbopack no side effects";
;
var createJob = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("402966b1e12d4396b884610ead62589160248da594", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "createJob"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vam9icy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEpvYnMgU2VydmVyIEFjdGlvbnMgLSBSRUZBQ1RPUkVEIEZPUiBET01BSU4gVEFCTEUgU1RSVUNUVVJFXG4gKlxuICogSGFuZGxlcyBqb2Ivd29yayBvcmRlciBtYW5hZ2VtZW50IHdpdGggY29tcHJlaGVuc2l2ZSBDUlVEIG9wZXJhdGlvbnMsXG4gKiBzdGF0dXMgdHJhbnNpdGlvbnMsIHNjaGVkdWxpbmcsIGFuZCBhc3NpZ25tZW50IGxvZ2ljLlxuICpcbiAqIE1JR1JBVElPTiBOT1RFUzpcbiAqIC0gQ29yZSBqb2JzIHRhYmxlIG5vdyBoYXMgfjIwIGNvbHVtbnNcbiAqIC0gRG9tYWluLXNwZWNpZmljIGRhdGEgbW92ZWQgdG8gMTEgZG9tYWluIHRhYmxlc1xuICogLSBGaW5hbmNpYWwgZGF0YSAtPiBqb2JfZmluYW5jaWFsXG4gKiAtIFRpbWUgdHJhY2tpbmcgLT4gam9iX3RpbWVfdHJhY2tpbmdcbiAqIC0gQXJjaGl2ZS9kZWxldGlvbiAtPiBqb2JfbXVsdGlfZW50aXR5XG4gKiAtIEFsbCBkb21haW4gdGFibGVzIGhhdmUgQ0FTQ0FERSBkZWxldGUgb24gam9iX2lkXG4gKi9cblxuXCJ1c2Ugc2VydmVyXCI7XG5cbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5pbXBvcnQgeyBnZXRBY3RpdmVDb21wYW55SWQgfSBmcm9tIFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIjtcbmltcG9ydCB7XG5cdEFjdGlvbkVycm9yLFxuXHRFUlJPUl9DT0RFUyxcblx0RVJST1JfTUVTU0FHRVMsXG59IGZyb20gXCJAL2xpYi9lcnJvcnMvYWN0aW9uLWVycm9yXCI7XG5pbXBvcnQge1xuXHR0eXBlIEFjdGlvblJlc3VsdCxcblx0YXNzZXJ0QXV0aGVudGljYXRlZCxcblx0YXNzZXJ0RXhpc3RzLFxuXHR3aXRoRXJyb3JIYW5kbGluZyxcbn0gZnJvbSBcIkAvbGliL2Vycm9ycy93aXRoLWVycm9yLWhhbmRsaW5nXCI7XG5pbXBvcnQgeyBub3RpZnlKb2JDcmVhdGVkIH0gZnJvbSBcIkAvbGliL25vdGlmaWNhdGlvbnMvdHJpZ2dlcnNcIjtcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAL2xpYi9zdXBhYmFzZS9zZXJ2ZXJcIjtcbmltcG9ydCB7XG5cdHR5cGUgSm9iU3RhdHVzLFxuXHR0eXBlIEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0LFxuXHR2YWxpZGF0ZVN0YXR1c1RyYW5zaXRpb24sXG59IGZyb20gXCJAL2xpYi92YWxpZGF0aW9ucy9qb2Itc3RhdHVzLXRyYW5zaXRpb25zXCI7XG5cbi8vIFJlZ2V4IGNvbnN0YW50c1xuY29uc3QgSk9CX05VTUJFUl9SRUdFWCA9IC9KT0ItXFxkezR9LShcXGQrKS87XG5cbi8vIFZhbGlkYXRpb24gU2NoZW1hc1xuY29uc3QgY3JlYXRlSm9iU2NoZW1hID0gei5vYmplY3Qoe1xuXHRwcm9wZXJ0eUlkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIHByb3BlcnR5IElEXCIpLFxuXHRjdXN0b21lcklkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIGN1c3RvbWVyIElEXCIpLm9wdGlvbmFsKCksXG5cdHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCBcIkpvYiB0aXRsZSBpcyByZXF1aXJlZFwiKSxcblx0ZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblx0cHJpb3JpdHk6IHouZW51bShbXCJsb3dcIiwgXCJtZWRpdW1cIiwgXCJoaWdoXCIsIFwidXJnZW50XCJdKS5kZWZhdWx0KFwibWVkaXVtXCIpLFxuXHRqb2JUeXBlOiB6XG5cdFx0LmVudW0oW1xuXHRcdFx0XCJzZXJ2aWNlXCIsXG5cdFx0XHRcImluc3RhbGxhdGlvblwiLFxuXHRcdFx0XCJyZXBhaXJcIixcblx0XHRcdFwibWFpbnRlbmFuY2VcIixcblx0XHRcdFwiaW5zcGVjdGlvblwiLFxuXHRcdFx0XCJjb25zdWx0YXRpb25cIixcblx0XHRdKVxuXHRcdC5vcHRpb25hbCgpLFxuXHRzY2hlZHVsZWRTdGFydDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRzY2hlZHVsZWRFbmQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblx0YXNzaWduZWRUbzogei5zdHJpbmcoKS51dWlkKFwiSW52YWxpZCB1c2VyIElEXCIpLm9wdGlvbmFsKCksXG5cdG5vdGVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdC8vIEVuaGFuY2VkIHNjaGVkdWxpbmcgZmllbGRzXG5cdGlzUmVjdXJyaW5nOiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuXHRzY2hlZHVsaW5nTW9kZTogei5lbnVtKFtcInNwZWNpZmljXCIsIFwid2luZG93XCJdKS5vcHRpb25hbCgpLFxuXHR0aW1lV2luZG93OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VUeXBlOiB6XG5cdFx0LmVudW0oW1wiZGFpbHlcIiwgXCJ3ZWVrbHlcIiwgXCJiaXdlZWtseVwiLCBcIm1vbnRobHlcIiwgXCJxdWFydGVybHlcIiwgXCJ5ZWFybHlcIl0pXG5cdFx0Lm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VFbmREYXRlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VDb3VudDogei5udW1iZXIoKS5pbnQoKS5taW4oMSkubWF4KDM2NSkub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCB1cGRhdGVKb2JTY2hlbWEgPSB6Lm9iamVjdCh7XG5cdHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCBcIkpvYiB0aXRsZSBpcyByZXF1aXJlZFwiKS5vcHRpb25hbCgpLFxuXHRkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRzdGF0dXM6IHpcblx0XHQuZW51bShbXG5cdFx0XHRcInF1b3RlZFwiLFxuXHRcdFx0XCJzY2hlZHVsZWRcIixcblx0XHRcdFwiaW5fcHJvZ3Jlc3NcIixcblx0XHRcdFwib25faG9sZFwiLFxuXHRcdFx0XCJjb21wbGV0ZWRcIixcblx0XHRcdFwiY2FuY2VsbGVkXCIsXG5cdFx0XHRcImludm9pY2VkXCIsXG5cdFx0XHRcInBhaWRcIixcblx0XHRdKVxuXHRcdC5vcHRpb25hbCgpLFxuXHRwcmlvcml0eTogei5lbnVtKFtcImxvd1wiLCBcIm1lZGl1bVwiLCBcImhpZ2hcIiwgXCJ1cmdlbnRcIl0pLm9wdGlvbmFsKCksXG5cdGpvYlR5cGU6IHpcblx0XHQuZW51bShbXG5cdFx0XHRcInNlcnZpY2VcIixcblx0XHRcdFwiaW5zdGFsbGF0aW9uXCIsXG5cdFx0XHRcInJlcGFpclwiLFxuXHRcdFx0XCJtYWludGVuYW5jZVwiLFxuXHRcdFx0XCJpbnNwZWN0aW9uXCIsXG5cdFx0XHRcImNvbnN1bHRhdGlvblwiLFxuXHRcdF0pXG5cdFx0Lm9wdGlvbmFsKCksXG5cdG5vdGVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdC8vIEZpbmFuY2lhbCBmaWVsZHMgKG5vdyBpbiBqb2JfZmluYW5jaWFsIGRvbWFpbiB0YWJsZSlcblx0dG90YWxBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdHBhaWRBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdGRlcG9zaXRBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdHNjaGVkdWxlZFN0YXJ0OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHNjaGVkdWxlZEVuZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRhc3NpZ25lZFRvOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIHVzZXIgSURcIikub3B0aW9uYWwoKS5udWxsYWJsZSgpLFxuXHRjdXN0b21lcklkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIGN1c3RvbWVyIElEXCIpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcblx0cHJvcGVydHlJZDogei5zdHJpbmcoKS51dWlkKFwiSW52YWxpZCBwcm9wZXJ0eSBJRFwiKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG59KTtcblxuLy8gVHlwZSBmb3IgdXBkYXRlSm9iRGF0YSAtIG1ha2VzIGl0IGVhc2llciB0byB1c2UgcHJvZ3JhbW1hdGljYWxseVxuZXhwb3J0IHR5cGUgVXBkYXRlSm9iRGF0YSA9IHouaW5mZXI8dHlwZW9mIHVwZGF0ZUpvYlNjaGVtYT47XG5cbmNvbnN0IHNjaGVkdWxlSm9iU2NoZW1hID0gei5vYmplY3Qoe1xuXHRzY2hlZHVsZWRTdGFydDogei5zdHJpbmcoKSxcblx0c2NoZWR1bGVkRW5kOiB6LnN0cmluZygpLFxufSk7XG5cbi8qKlxuICogR2VuZXJhdGUgdW5pcXVlIGpvYiBudW1iZXJcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVKb2JOdW1iZXIoXG5cdHN1cGFiYXNlOiBhbnksXG5cdGNvbXBhbnlJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxzdHJpbmc+IHtcblx0Ly8gR2V0IHRoZSBsYXRlc3Qgam9iIG51bWJlciBmb3IgdGhpcyBjb21wYW55XG5cdGNvbnN0IHsgZGF0YTogbGF0ZXN0Sm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdC5zZWxlY3QoXCJqb2JfbnVtYmVyXCIpXG5cdFx0LmVxKFwiY29tcGFueV9pZFwiLCBjb21wYW55SWQpXG5cdFx0Lm9yZGVyKFwiY3JlYXRlZF9hdFwiLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcblx0XHQubGltaXQoMSlcblx0XHQuc2luZ2xlKCk7XG5cblx0aWYgKCFsYXRlc3RKb2IpIHtcblx0XHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tMDAxYDtcblx0fVxuXG5cdC8vIEV4dHJhY3QgbnVtYmVyIGZyb20gZm9ybWF0OiBKT0ItWVlZWS1OTk5cblx0Y29uc3QgbWF0Y2ggPSBsYXRlc3RKb2Iuam9iX251bWJlci5tYXRjaChKT0JfTlVNQkVSX1JFR0VYKTtcblx0aWYgKG1hdGNoKSB7XG5cdFx0Y29uc3QgbmV4dE51bWJlciA9IE51bWJlci5wYXJzZUludChtYXRjaFsxXSwgMTApICsgMTtcblx0XHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tJHtuZXh0TnVtYmVyLnRvU3RyaW5nKCkucGFkU3RhcnQoMywgXCIwXCIpfWA7XG5cdH1cblxuXHQvLyBGYWxsYmFja1xuXHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tJHtEYXRlLm5vdygpLnRvU3RyaW5nKCkuc2xpY2UoLTMpfWA7XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIG5leHQgcmVjdXJyZW5jZSBkYXRlXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZU5leHRSZWN1cnJlbmNlKFxuXHRjdXJyZW50RGF0ZTogRGF0ZSxcblx0cmVjdXJyZW5jZVR5cGU6IHN0cmluZyxcbik6IERhdGUge1xuXHRjb25zdCBuZXh0RGF0ZSA9IG5ldyBEYXRlKGN1cnJlbnREYXRlKTtcblxuXHRzd2l0Y2ggKHJlY3VycmVuY2VUeXBlKSB7XG5cdFx0Y2FzZSBcImRhaWx5XCI6XG5cdFx0XHRuZXh0RGF0ZS5zZXREYXRlKG5leHREYXRlLmdldERhdGUoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcIndlZWtseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RGF0ZShuZXh0RGF0ZS5nZXREYXRlKCkgKyA3KTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgXCJiaXdlZWtseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RGF0ZShuZXh0RGF0ZS5nZXREYXRlKCkgKyAxNCk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlIFwibW9udGhseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0TW9udGgobmV4dERhdGUuZ2V0TW9udGgoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcInF1YXJ0ZXJseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0TW9udGgobmV4dERhdGUuZ2V0TW9udGgoKSArIDMpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcInllYXJseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RnVsbFllYXIobmV4dERhdGUuZ2V0RnVsbFllYXIoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0ZGVmYXVsdDpcblx0XHRcdC8vIERlZmF1bHQgdG8gbW9udGhseSBpZiB1bmtub3duIHR5cGVcblx0XHRcdG5leHREYXRlLnNldE1vbnRoKG5leHREYXRlLmdldE1vbnRoKCkgKyAxKTtcblx0XHRcdGJyZWFrO1xuXHR9XG5cblx0cmV0dXJuIG5leHREYXRlO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZWN1cnJpbmcgam9ic1xuICovXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVSZWN1cnJpbmdKb2JzKFxuXHRzdXBhYmFzZTogYW55LFxuXHRjb21wYW55SWQ6IHN0cmluZyxcblx0YmFzZUpvYjogYW55LFxuXHRyZWN1cnJlbmNlVHlwZTogc3RyaW5nLFxuXHRyZWN1cnJlbmNlRW5kRGF0ZT86IHN0cmluZyxcblx0cmVjdXJyZW5jZUNvdW50PzogbnVtYmVyLFxuKTogUHJvbWlzZTx2b2lkPiB7XG5cdGlmICghYmFzZUpvYi5zY2hlZHVsZWRfc3RhcnQpIHtcblx0XHRyZXR1cm47IC8vIENhbid0IGNyZWF0ZSByZWN1cnJpbmcgam9icyB3aXRob3V0IGEgc3RhcnQgZGF0ZVxuXHR9XG5cblx0Y29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoYmFzZUpvYi5zY2hlZHVsZWRfc3RhcnQpO1xuXHRjb25zdCBlbmREYXRlID0gbmV3IERhdGUoYmFzZUpvYi5zY2hlZHVsZWRfZW5kIHx8IGJhc2VKb2Iuc2NoZWR1bGVkX3N0YXJ0KTtcblx0Y29uc3QgZHVyYXRpb24gPSBlbmREYXRlLmdldFRpbWUoKSAtIHN0YXJ0RGF0ZS5nZXRUaW1lKCk7XG5cblx0Ly8gRGV0ZXJtaW5lIGhvdyBtYW55IG9jY3VycmVuY2VzIHRvIGNyZWF0ZVxuXHRjb25zdCBtYXhPY2N1cnJlbmNlcyA9IHJlY3VycmVuY2VDb3VudCB8fCA1MjsgLy8gRGVmYXVsdCB0byAxIHllYXIgb2Ygd2Vla2x5IGpvYnNcblx0Y29uc3QgZW5kRGF0ZUxpbWl0ID0gcmVjdXJyZW5jZUVuZERhdGUgPyBuZXcgRGF0ZShyZWN1cnJlbmNlRW5kRGF0ZSkgOiBudWxsO1xuXG5cdGNvbnN0IHJlY3VycmluZ0pvYnM6ICh0eXBlb2YgYmFzZUpvYilbXSA9IFtdO1xuXHRsZXQgY3VycmVudERhdGUgPSBuZXcgRGF0ZShzdGFydERhdGUpO1xuXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgbWF4T2NjdXJyZW5jZXMgLSAxOyBpKyspIHtcblx0XHQvLyAtMSBiZWNhdXNlIHdlIGFscmVhZHkgY3JlYXRlZCB0aGUgZmlyc3Qgam9iXG5cdFx0Y3VycmVudERhdGUgPSBjYWxjdWxhdGVOZXh0UmVjdXJyZW5jZShjdXJyZW50RGF0ZSwgcmVjdXJyZW5jZVR5cGUpO1xuXG5cdFx0Ly8gU3RvcCBpZiB3ZSd2ZSByZWFjaGVkIHRoZSBlbmQgZGF0ZVxuXHRcdGlmIChlbmREYXRlTGltaXQgJiYgY3VycmVudERhdGUgPiBlbmREYXRlTGltaXQpIHtcblx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdGNvbnN0IGN1cnJlbnRFbmREYXRlID0gbmV3IERhdGUoY3VycmVudERhdGUuZ2V0VGltZSgpICsgZHVyYXRpb24pO1xuXG5cdFx0Ly8gR2VuZXJhdGUgYSB1bmlxdWUgam9iIG51bWJlciBmb3IgdGhpcyBvY2N1cnJlbmNlXG5cdFx0Y29uc3Qgam9iTnVtYmVyID0gYXdhaXQgZ2VuZXJhdGVKb2JOdW1iZXIoc3VwYWJhc2UsIGNvbXBhbnlJZCk7XG5cblx0XHRyZWN1cnJpbmdKb2JzLnB1c2goe1xuXHRcdFx0Li4uYmFzZUpvYixcblx0XHRcdGpvYl9udW1iZXI6IGpvYk51bWJlcixcblx0XHRcdHNjaGVkdWxlZF9zdGFydDogY3VycmVudERhdGUudG9JU09TdHJpbmcoKSxcblx0XHRcdHNjaGVkdWxlZF9lbmQ6IGN1cnJlbnRFbmREYXRlLnRvSVNPU3RyaW5nKCksXG5cdFx0XHR0aXRsZTogYCR7YmFzZUpvYi50aXRsZX0gKCR7aSArIDJ9LyR7bWF4T2NjdXJyZW5jZXN9KWAsIC8vIEFkZCBvY2N1cnJlbmNlIG51bWJlclxuXHRcdH0pO1xuXG5cdFx0Ly8gQ3JlYXRlIGpvYnMgaW4gYmF0Y2hlcyBvZiAxMCB0byBhdm9pZCBtZW1vcnkgaXNzdWVzXG5cdFx0aWYgKHJlY3VycmluZ0pvYnMubGVuZ3RoID49IDEwKSB7XG5cdFx0XHRhd2FpdCBzdXBhYmFzZS5mcm9tKFwiam9ic1wiKS5pbnNlcnQocmVjdXJyaW5nSm9icyk7XG5cdFx0XHRyZWN1cnJpbmdKb2JzLmxlbmd0aCA9IDA7IC8vIENsZWFyIGFycmF5XG5cdFx0fVxuXHR9XG5cblx0Ly8gSW5zZXJ0IGFueSByZW1haW5pbmcgam9ic1xuXHRpZiAocmVjdXJyaW5nSm9icy5sZW5ndGggPiAwKSB7XG5cdFx0YXdhaXQgc3VwYWJhc2UuZnJvbShcImpvYnNcIikuaW5zZXJ0KHJlY3VycmluZ0pvYnMpO1xuXHR9XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgbmV3IGpvYlxuICog4pyFIEFMUkVBRFkgTUlHUkFURUQgLSBDcmVhdGVzIGNvcmUgam9iICsgYWxsIDEwIGRvbWFpbiByZWNvcmRzIGluIHBhcmFsbGVsXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVKb2IoXG5cdGZvcm1EYXRhOiBGb3JtRGF0YSxcbik6IFByb21pc2U8QWN0aW9uUmVzdWx0PHN0cmluZz4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSBjcmVhdGVKb2JTY2hlbWEucGFyc2Uoe1xuXHRcdFx0cHJvcGVydHlJZDogZm9ybURhdGEuZ2V0KFwicHJvcGVydHlJZFwiKSxcblx0XHRcdGN1c3RvbWVySWQ6IGZvcm1EYXRhLmdldChcImN1c3RvbWVySWRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0dGl0bGU6IGZvcm1EYXRhLmdldChcInRpdGxlXCIpLFxuXHRcdFx0ZGVzY3JpcHRpb246IGZvcm1EYXRhLmdldChcImRlc2NyaXB0aW9uXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdHByaW9yaXR5OiBmb3JtRGF0YS5nZXQoXCJwcmlvcml0eVwiKSB8fCBcIm1lZGl1bVwiLFxuXHRcdFx0am9iVHlwZTogZm9ybURhdGEuZ2V0KFwiam9iVHlwZVwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRzY2hlZHVsZWRTdGFydDogZm9ybURhdGEuZ2V0KFwic2NoZWR1bGVkU3RhcnRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0c2NoZWR1bGVkRW5kOiBmb3JtRGF0YS5nZXQoXCJzY2hlZHVsZWRFbmRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0YXNzaWduZWRUbzogZm9ybURhdGEuZ2V0KFwiYXNzaWduZWRUb1wiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRub3RlczogZm9ybURhdGEuZ2V0KFwibm90ZXNcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0Ly8gRW5oYW5jZWQgc2NoZWR1bGluZyBmaWVsZHNcblx0XHRcdGlzUmVjdXJyaW5nOiBmb3JtRGF0YS5nZXQoXCJpc1JlY3VycmluZ1wiKSA9PT0gXCJ0cnVlXCIsXG5cdFx0XHRzY2hlZHVsaW5nTW9kZTogKGZvcm1EYXRhLmdldChcInNjaGVkdWxpbmdNb2RlXCIpIGFzIGFueSkgfHwgdW5kZWZpbmVkLFxuXHRcdFx0dGltZVdpbmRvdzogZm9ybURhdGEuZ2V0KFwidGltZVdpbmRvd1wiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRyZWN1cnJlbmNlVHlwZTogKGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VUeXBlXCIpIGFzIGFueSkgfHwgdW5kZWZpbmVkLFxuXHRcdFx0cmVjdXJyZW5jZUVuZERhdGU6IGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VFbmREYXRlXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdHJlY3VycmVuY2VDb3VudDogZm9ybURhdGEuZ2V0KFwicmVjdXJyZW5jZUNvdW50XCIpXG5cdFx0XHRcdD8gTnVtYmVyLnBhcnNlSW50KGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VDb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHR9KTtcblxuXHRcdC8vIFZlcmlmeSBwcm9wZXJ0eSBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IHByb3BlcnR5IH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJwcm9wZXJ0aWVzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgY3VzdG9tZXJfaWQsIGFkZHJlc3NcIilcblx0XHRcdC5lcShcImlkXCIsIGRhdGEucHJvcGVydHlJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhwcm9wZXJ0eSwgXCJQcm9wZXJ0eVwiKTtcblxuXHRcdGlmIChwcm9wZXJ0eS5jb21wYW55X2lkICE9PSBjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwicHJvcGVydHlcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVzZSBjdXN0b21lciBmcm9tIHByb3BlcnR5IGlmIG5vdCBwcm92aWRlZFxuXHRcdGNvbnN0IGN1c3RvbWVySWQgPSBkYXRhLmN1c3RvbWVySWQgfHwgcHJvcGVydHkuY3VzdG9tZXJfaWQ7XG5cblx0XHQvLyBHZW5lcmF0ZSB1bmlxdWUgam9iIG51bWJlclxuXHRcdGNvbnN0IGpvYk51bWJlciA9IGF3YWl0IGdlbmVyYXRlSm9iTnVtYmVyKHN1cGFiYXNlLCBjb21wYW55SWQpO1xuXG5cdFx0Ly8gQWRkIHRpbWUgd2luZG93IGluZm8gdG8gbm90ZXMgaWYgYXBwbGljYWJsZVxuXHRcdGxldCBqb2JOb3RlcyA9IGRhdGEubm90ZXMgfHwgXCJcIjtcblx0XHRpZiAoZGF0YS5zY2hlZHVsaW5nTW9kZSA9PT0gXCJ3aW5kb3dcIiAmJiBkYXRhLnRpbWVXaW5kb3cpIHtcblx0XHRcdGNvbnN0IHdpbmRvd0luZm8gPSBgXFxuXFxuW1NjaGVkdWxpbmddIEN1c3RvbWVyIHByZWZlcnJlZCB0aW1lIHdpbmRvdzogJHtkYXRhLnRpbWVXaW5kb3cuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBkYXRhLnRpbWVXaW5kb3cuc2xpY2UoMSl9YDtcblx0XHRcdGpvYk5vdGVzID0gam9iTm90ZXMgPyBgJHtqb2JOb3Rlc30ke3dpbmRvd0luZm99YCA6IHdpbmRvd0luZm8udHJpbSgpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBjb3JlIGpvYiByZWNvcmRcblx0XHRjb25zdCB7IGRhdGE6IG5ld0pvYiwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogZGF0YS5wcm9wZXJ0eUlkLFxuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0YXNzaWduZWRfdG86IGRhdGEuYXNzaWduZWRUbyxcblx0XHRcdFx0am9iX251bWJlcjogam9iTnVtYmVyLFxuXHRcdFx0XHR0aXRsZTogZGF0YS50aXRsZSxcblx0XHRcdFx0ZGVzY3JpcHRpb246IGRhdGEuZGVzY3JpcHRpb24sXG5cdFx0XHRcdHN0YXR1czogXCJxdW90ZWRcIixcblx0XHRcdFx0cHJpb3JpdHk6IGRhdGEucHJpb3JpdHksXG5cdFx0XHRcdGpvYl90eXBlOiBkYXRhLmpvYlR5cGUsXG5cdFx0XHRcdHNlcnZpY2VfdHlwZTogZGF0YS5qb2JUeXBlLCAvLyBEZWZhdWx0IHNlcnZpY2VfdHlwZSB0byBqb2JfdHlwZVxuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRub3Rlczogam9iTm90ZXMsXG5cdFx0XHR9KVxuXHRcdFx0LnNlbGVjdChcImlkXCIpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoY3JlYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiY3JlYXRlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBkb21haW4gcmVjb3JkcyAocGFyYWxsZWwgaW5zZXJ0cyBmb3IgcGVyZm9ybWFuY2UpXG5cdFx0Y29uc3QgZG9tYWluSW5zZXJ0cyA9IGF3YWl0IFByb21pc2UuYWxsKFtcblx0XHRcdC8vIEZpbmFuY2lhbCBkb21haW4gLSBhbHdheXMgY3JlYXRlIHdpdGggZGVmYXVsdHNcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2ZpbmFuY2lhbFwiKVxuXHRcdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0XHRqb2JfaWQ6IG5ld0pvYi5pZCxcblx0XHRcdFx0XHRjb21wYW55X2lkOiBjb21wYW55SWQsXG5cdFx0XHRcdFx0dG90YWxfYW1vdW50OiAwLFxuXHRcdFx0XHRcdHBhaWRfYW1vdW50OiAwLFxuXHRcdFx0XHRcdGRlcG9zaXRfYW1vdW50OiAwLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gV29ya2Zsb3cgZG9tYWluIC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2Jfd29ya2Zsb3dcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdHdvcmtmbG93X2NvbXBsZXRlZF9zdGFnZXM6IFtdLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gVGltZSB0cmFja2luZyAtIGFsd2F5cyBjcmVhdGVcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX3RpbWVfdHJhY2tpbmdcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdHRvdGFsX2xhYm9yX2hvdXJzOiAwLFxuXHRcdFx0XHRcdGJyZWFrX3RpbWVfbWludXRlczogMCxcblx0XHRcdFx0fSksXG5cblx0XHRcdC8vIEN1c3RvbWVyIGFwcHJvdmFsIC0gYWx3YXlzIGNyZWF0ZSB3aXRoIHBlbmRpbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2N1c3RvbWVyX2FwcHJvdmFsXCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRjdXN0b21lcl9hcHByb3ZhbF9zdGF0dXM6IFwicGVuZGluZ1wiLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gRXF1aXBtZW50IHNlcnZpY2UgLSBhbHdheXMgY3JlYXRlXG5cdFx0XHRzdXBhYmFzZVxuXHRcdFx0XHQuZnJvbShcImpvYl9lcXVpcG1lbnRfc2VydmljZVwiKVxuXHRcdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0XHRqb2JfaWQ6IG5ld0pvYi5pZCxcblx0XHRcdFx0XHRjb21wYW55X2lkOiBjb21wYW55SWQsXG5cdFx0XHRcdFx0ZXF1aXBtZW50X3NlcnZpY2VfaGlzdG9yeTogW10sXG5cdFx0XHRcdFx0ZXF1aXBtZW50X3NlcnZpY2VkOiBbXSxcblx0XHRcdFx0fSksXG5cblx0XHRcdC8vIERpc3BhdGNoIC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfZGlzcGF0Y2hcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gUXVhbGl0eSAtIGFsd2F5cyBjcmVhdGVcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX3F1YWxpdHlcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdGluc3BlY3Rpb25fcmVxdWlyZWQ6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gU2FmZXR5IC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2Jfc2FmZXR5XCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRyZXF1aXJlc19wZXJtaXQ6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gQUkgZW5yaWNobWVudCAtIGNyZWF0ZSBlbXB0eSBmb3IgZnV0dXJlIHByb2Nlc3Npbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2FpX2VucmljaG1lbnRcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gTXVsdGktZW50aXR5IC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfbXVsdGlfZW50aXR5XCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRyZXF1aXJlc19tdWx0aXBsZV9wcm9wZXJ0aWVzOiBmYWxzZSxcblx0XHRcdFx0XHRyZXF1aXJlc19tdWx0aXBsZV9jdXN0b21lcnM6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBhbnkgZG9tYWluIGluc2VydCBlcnJvcnNcblx0XHRjb25zdCBkb21haW5FcnJvcnMgPSBkb21haW5JbnNlcnRzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuZXJyb3IpO1xuXHRcdGlmIChkb21haW5FcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0Ly8gUm9sbGJhY2sgLSBkZWxldGUgdGhlIGpvYiAoQ0FTQ0FERSB3aWxsIGRlbGV0ZSBkb21haW4gcmVjb3Jkcylcblx0XHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JzXCIpLmRlbGV0ZSgpLmVxKFwiaWRcIiwgbmV3Sm9iLmlkKTtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiY3JlYXRlIGpvYiBkb21haW5zXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQ3JlYXRlIHJlY3VycmluZyBqb2JzIGlmIHJlcXVlc3RlZFxuXHRcdGlmIChkYXRhLmlzUmVjdXJyaW5nICYmIGRhdGEucmVjdXJyZW5jZVR5cGUgJiYgZGF0YS5zY2hlZHVsZWRTdGFydCkge1xuXHRcdFx0Y29uc3QgYmFzZUpvYiA9IHtcblx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogZGF0YS5wcm9wZXJ0eUlkLFxuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0YXNzaWduZWRfdG86IGRhdGEuYXNzaWduZWRUbyxcblx0XHRcdFx0dGl0bGU6IGRhdGEudGl0bGUsXG5cdFx0XHRcdGRlc2NyaXB0aW9uOiBkYXRhLmRlc2NyaXB0aW9uLFxuXHRcdFx0XHRzdGF0dXM6IFwicXVvdGVkXCIsXG5cdFx0XHRcdHByaW9yaXR5OiBkYXRhLnByaW9yaXR5LFxuXHRcdFx0XHRqb2JfdHlwZTogZGF0YS5qb2JUeXBlLFxuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRub3RlczogZGF0YS5ub3Rlcyxcblx0XHRcdH07XG5cblx0XHRcdGF3YWl0IGNyZWF0ZVJlY3VycmluZ0pvYnMoXG5cdFx0XHRcdHN1cGFiYXNlLFxuXHRcdFx0XHRjb21wYW55SWQsXG5cdFx0XHRcdGJhc2VKb2IsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZVR5cGUsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZUVuZERhdGUsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZUNvdW50LFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBTZW5kIG5vdGlmaWNhdGlvbiB0byBhc3NpZ25lZCB1c2VyIGlmIGpvYiBpcyBhc3NpZ25lZFxuXHRcdGlmIChkYXRhLmFzc2lnbmVkVG8gJiYgZGF0YS5hc3NpZ25lZFRvICE9PSB1c2VyLmlkKSB7XG5cdFx0XHRhd2FpdCBub3RpZnlKb2JDcmVhdGVkKHtcblx0XHRcdFx0dXNlcklkOiBkYXRhLmFzc2lnbmVkVG8sXG5cdFx0XHRcdGNvbXBhbnlJZDogY29tcGFueUlkLFxuXHRcdFx0XHRqb2JJZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRqb2JUaXRsZTogZGF0YS50aXRsZSxcblx0XHRcdFx0YWRkcmVzczogcHJvcGVydHkuYWRkcmVzcyB8fCBcIlVua25vd24gYWRkcmVzc1wiLFxuXHRcdFx0XHRwcmlvcml0eTpcblx0XHRcdFx0XHRkYXRhLnByaW9yaXR5ID09PSBcInVyZ2VudFwiXG5cdFx0XHRcdFx0XHQ/IFwidXJnZW50XCJcblx0XHRcdFx0XHRcdDogZGF0YS5wcmlvcml0eSA9PT0gXCJoaWdoXCJcblx0XHRcdFx0XHRcdFx0PyBcImhpZ2hcIlxuXHRcdFx0XHRcdFx0XHQ6IFwibWVkaXVtXCIsXG5cdFx0XHRcdGFjdGlvblVybDogXCIvZGFzaGJvYXJkL3dvcmtcIixcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrL2pvYnNcIik7XG5cdFx0cmV0dXJuIG5ld0pvYi5pZDtcblx0fSk7XG59XG5cbi8qKlxuICogR2V0IGEgc2luZ2xlIGpvYiBieSBJRFxuICog4pyFIEFMUkVBRFkgTUlHUkFURUQgLSBGZXRjaGVzIGpvYiB3aXRoIGFsbCBkb21haW4gZGF0YVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueT4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBqb2Igd2l0aCBiYXNpYyByZWxhdGlvbnNoaXBzXG5cdFx0Ly8gU2ltcGxpZmllZCBxdWVyeSAtIG1hbnkgZG9tYWluIHRhYmxlcyBkb24ndCBleGlzdCB5ZXRcblx0XHRjb25zdCB7IGRhdGE6IGpvYiwgZXJyb3I6IGpvYkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRgXG5cdFx0XHRcdCosXG5cdFx0XHRcdHByb3BlcnR5OnByb3BlcnRpZXMoKiksXG5cdFx0XHRcdGN1c3RvbWVyOmN1c3RvbWVycyFjdXN0b21lcl9pZChpZCwgZmlyc3RfbmFtZSwgbGFzdF9uYW1lLCBlbWFpbCwgcGhvbmUsIGRpc3BsYXlfbmFtZSlcblx0XHRcdGAsXG5cdFx0XHQpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGpvYkVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm5vdEZvdW5kKFwiSm9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9SRUNPUkRfTk9UX0ZPVU5ELFxuXHRcdFx0XHQ0MDQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRpZiAoam9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBqb2I7XG5cdH0pO1xufVxuXG4vKipcbiAqIFVwZGF0ZSBqb2IgZGV0YWlsc1xuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgYm90aCBjb3JlIGpvYnMgdGFibGUgYW5kIGRvbWFpbiB0YWJsZXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYihcblx0am9iSWQ6IHN0cmluZyxcblx0Zm9ybURhdGE6IEZvcm1EYXRhLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IGFjdGl2ZSBjb21wYW55IElEXG5cdFx0Y29uc3QgYWN0aXZlQ29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cdFx0aWYgKCFhY3RpdmVDb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgdXNlcidzIHJvbGUgdG8gY2hlY2sgaWYgdGhleSdyZSBhZG1pbi9vd25lclxuXHRcdGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiY29tcGFueV9tZW1iZXJzaGlwc1wiKVxuXHRcdFx0LnNlbGVjdChcblx0XHRcdFx0YFxuICAgICAgICByb2xlX2lkLFxuICAgICAgICBjdXN0b21fcm9sZXMhcm9sZV9pZChuYW1lLCBpc19zeXN0ZW0pXG4gICAgICBgLFxuXHRcdFx0KVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LmVxKFwiY29tcGFueV9pZFwiLCBhY3RpdmVDb21wYW55SWQpXG5cdFx0XHQuZXEoXCJzdGF0dXNcIiwgXCJhY3RpdmVcIilcblx0XHRcdC5tYXliZVNpbmdsZSgpO1xuXG5cdFx0Y29uc3Qgcm9sZSA9IEFycmF5LmlzQXJyYXkodGVhbU1lbWJlcj8uY3VzdG9tX3JvbGVzKVxuXHRcdFx0PyB0ZWFtTWVtYmVyLmN1c3RvbV9yb2xlc1swXVxuXHRcdFx0OiB0ZWFtTWVtYmVyPy5jdXN0b21fcm9sZXM7XG5cblx0XHRjb25zdCBpc0FkbWluT3JPd25lciA9XG5cdFx0XHRyb2xlPy5uYW1lID09PSBcIkFkbWluXCIgfHxcblx0XHRcdHJvbGU/Lm5hbWUgPT09IFwiT3duZXJcIiB8fFxuXHRcdFx0cm9sZT8uaXNfc3lzdGVtID09PSB0cnVlO1xuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhleGlzdGluZ0pvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoZXhpc3RpbmdKb2IuY29tcGFueV9pZCAhPT0gYWN0aXZlQ29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUHJldmVudCBlZGl0aW5nIGNvbXBsZXRlZCBvciBjYW5jZWxsZWQgam9icyAodW5sZXNzIGFkbWluL293bmVyKVxuXHRcdGlmIChcblx0XHRcdCFpc0FkbWluT3JPd25lciAmJlxuXHRcdFx0KGV4aXN0aW5nSm9iLnN0YXR1cyA9PT0gXCJjb21wbGV0ZWRcIiB8fCBleGlzdGluZ0pvYi5zdGF0dXMgPT09IFwiY2FuY2VsbGVkXCIpXG5cdFx0KSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBDYW5ub3QgZWRpdCAke2V4aXN0aW5nSm9iLnN0YXR1c30gam9ic2AsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgY3VzdG9tZXJJZFZhbHVlID0gZm9ybURhdGEuZ2V0KFwiY3VzdG9tZXJJZFwiKTtcblx0XHRjb25zdCBwcm9wZXJ0eUlkVmFsdWUgPSBmb3JtRGF0YS5nZXQoXCJwcm9wZXJ0eUlkXCIpO1xuXG5cdFx0Ly8gSGFuZGxlIGN1c3RvbWVySWQ6IGVtcHR5IHN0cmluZyBvciBcIm51bGxcIiBzdHJpbmcgbWVhbnMgcmVtb3ZlIChzZXQgdG8gbnVsbClcblx0XHQvLyB1bmRlZmluZWQgbWVhbnMgZG9uJ3QgY2hhbmdlIGl0XG5cdFx0bGV0IHBhcnNlZEN1c3RvbWVySWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG5cdFx0aWYgKGN1c3RvbWVySWRWYWx1ZSA9PT0gbnVsbCB8fCBjdXN0b21lcklkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyc2VkQ3VzdG9tZXJJZCA9IHVuZGVmaW5lZDsgLy8gRG9uJ3QgY2hhbmdlXG5cdFx0fSBlbHNlIGlmIChjdXN0b21lcklkVmFsdWUgPT09IFwiXCIgfHwgY3VzdG9tZXJJZFZhbHVlID09PSBcIm51bGxcIikge1xuXHRcdFx0cGFyc2VkQ3VzdG9tZXJJZCA9IG51bGw7IC8vIFJlbW92ZSBjdXN0b21lclxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJzZWRDdXN0b21lcklkID0gY3VzdG9tZXJJZFZhbHVlIGFzIHN0cmluZzsgLy8gU2V0IHRvIHRoaXMgY3VzdG9tZXJcblx0XHR9XG5cblx0XHQvLyBIYW5kbGUgcHJvcGVydHlJZDogZW1wdHkgc3RyaW5nIG1lYW5zIHJlbW92ZSAoc2V0IHRvIG51bGwpLCB1bmRlZmluZWQgbWVhbnMgZG9uJ3QgY2hhbmdlXG5cdFx0bGV0IHBhcnNlZFByb3BlcnR5SWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG5cdFx0aWYgKHByb3BlcnR5SWRWYWx1ZSA9PT0gbnVsbCB8fCBwcm9wZXJ0eUlkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyc2VkUHJvcGVydHlJZCA9IHVuZGVmaW5lZDsgLy8gRG9uJ3QgY2hhbmdlXG5cdFx0fSBlbHNlIGlmIChwcm9wZXJ0eUlkVmFsdWUgPT09IFwiXCIgfHwgcHJvcGVydHlJZFZhbHVlID09PSBcIm51bGxcIikge1xuXHRcdFx0cGFyc2VkUHJvcGVydHlJZCA9IG51bGw7IC8vIFJlbW92ZSBwcm9wZXJ0eVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJzZWRQcm9wZXJ0eUlkID0gcHJvcGVydHlJZFZhbHVlIGFzIHN0cmluZzsgLy8gU2V0IHRvIHRoaXMgcHJvcGVydHlcblx0XHR9XG5cblx0XHRjb25zdCBkYXRhID0gdXBkYXRlSm9iU2NoZW1hLnBhcnNlKHtcblx0XHRcdHRpdGxlOiBmb3JtRGF0YS5nZXQoXCJ0aXRsZVwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRkZXNjcmlwdGlvbjogZm9ybURhdGEuZ2V0KFwiZGVzY3JpcHRpb25cIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0c3RhdHVzOiBmb3JtRGF0YS5nZXQoXCJzdGF0dXNcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0cHJpb3JpdHk6IGZvcm1EYXRhLmdldChcInByaW9yaXR5XCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdGpvYlR5cGU6IGZvcm1EYXRhLmdldChcImpvYlR5cGVcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0bm90ZXM6IGZvcm1EYXRhLmdldChcIm5vdGVzXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdC8vIEZpbmFuY2lhbCBmaWVsZHMgKG5vdyBpbiBqb2JfZmluYW5jaWFsIGRvbWFpbiB0YWJsZSlcblx0XHRcdHRvdGFsQW1vdW50OiBmb3JtRGF0YS5nZXQoXCJ0b3RhbEFtb3VudFwiKVxuXHRcdFx0XHQ/IE51bWJlci5wYXJzZUludChmb3JtRGF0YS5nZXQoXCJ0b3RhbEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdHBhaWRBbW91bnQ6IGZvcm1EYXRhLmdldChcInBhaWRBbW91bnRcIilcblx0XHRcdFx0PyBOdW1iZXIucGFyc2VJbnQoZm9ybURhdGEuZ2V0KFwicGFpZEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdGRlcG9zaXRBbW91bnQ6IGZvcm1EYXRhLmdldChcImRlcG9zaXRBbW91bnRcIilcblx0XHRcdFx0PyBOdW1iZXIucGFyc2VJbnQoZm9ybURhdGEuZ2V0KFwiZGVwb3NpdEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdHNjaGVkdWxlZFN0YXJ0OiBmb3JtRGF0YS5nZXQoXCJzY2hlZHVsZWRTdGFydFwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRzY2hlZHVsZWRFbmQ6IGZvcm1EYXRhLmdldChcInNjaGVkdWxlZEVuZFwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRhc3NpZ25lZFRvOiBmb3JtRGF0YS5nZXQoXCJhc3NpZ25lZFRvXCIpIHx8IG51bGwsXG5cdFx0XHRjdXN0b21lcklkOiBwYXJzZWRDdXN0b21lcklkLFxuXHRcdFx0cHJvcGVydHlJZDogcGFyc2VkUHJvcGVydHlJZCxcblx0XHR9KTtcblxuXHRcdC8vIElmIHN0YXR1cyBpcyBiZWluZyBjaGFuZ2VkLCB2YWxpZGF0ZSB0aGUgdHJhbnNpdGlvblxuXHRcdGlmIChkYXRhLnN0YXR1cyAhPT0gdW5kZWZpbmVkICYmIGRhdGEuc3RhdHVzICE9PSBleGlzdGluZ0pvYi5zdGF0dXMpIHtcblx0XHRcdC8vIEZldGNoIGFkZGl0aW9uYWwgY29udGV4dCBmb3Igc3RhdHVzIHZhbGlkYXRpb25cblx0XHRcdGNvbnN0IHsgZGF0YTogam9iV2l0aENvbnRleHQgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRcdGBcblx0XHRcdFx0XHRpZCxcblx0XHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdFx0c2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRcdHNjaGVkdWxlZF9lbmQsXG5cdFx0XHRcdFx0YXNzaWduZWRfdG8sXG5cdFx0XHRcdFx0Y3VzdG9tZXJfaWQsXG5cdFx0XHRcdFx0cHJvcGVydHlfaWQsXG5cdFx0XHRcdFx0dG90YWxfYW1vdW50LFxuXHRcdFx0XHRcdGludm9pY2VzOmludm9pY2VzKHN0YXR1cywgdG90YWxfYW1vdW50KSxcblx0XHRcdFx0XHRlc3RpbWF0ZXM6ZXN0aW1hdGVzKHN0YXR1cyksXG5cdFx0XHRcdFx0dGVhbV9hc3NpZ25tZW50czpqb2JfdGVhbV9hc3NpZ25tZW50cyh0ZWFtX21lbWJlcl9pZClcblx0XHRcdFx0YCxcblx0XHRcdFx0KVxuXHRcdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRpZiAoam9iV2l0aENvbnRleHQpIHtcblx0XHRcdFx0Y29uc3QgdHJhbnNpdGlvbkNvbnRleHQ6IEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0ID0ge1xuXHRcdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGpvYldpdGhDb250ZXh0LnN0YXR1cyBhcyBKb2JTdGF0dXMsXG5cdFx0XHRcdFx0bmV3U3RhdHVzOiBkYXRhLnN0YXR1cyBhcyBKb2JTdGF0dXMsXG5cdFx0XHRcdFx0am9iOiB7XG5cdFx0XHRcdFx0XHRpZDogam9iV2l0aENvbnRleHQuaWQsXG5cdFx0XHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6XG5cdFx0XHRcdFx0XHRcdGRhdGEuc2NoZWR1bGVkU3RhcnQgfHwgam9iV2l0aENvbnRleHQuc2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRcdFx0c2NoZWR1bGVkX2VuZDogZGF0YS5zY2hlZHVsZWRFbmQgfHwgam9iV2l0aENvbnRleHQuc2NoZWR1bGVkX2VuZCxcblx0XHRcdFx0XHRcdGFzc2lnbmVkX3RvOlxuXHRcdFx0XHRcdFx0XHRkYXRhLmFzc2lnbmVkVG8gIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5hc3NpZ25lZFRvXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5hc3NpZ25lZF90byxcblx0XHRcdFx0XHRcdGN1c3RvbWVyX2lkOlxuXHRcdFx0XHRcdFx0XHRkYXRhLmN1c3RvbWVySWQgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5jdXN0b21lcklkXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5jdXN0b21lcl9pZCxcblx0XHRcdFx0XHRcdHByb3BlcnR5X2lkOlxuXHRcdFx0XHRcdFx0XHRkYXRhLnByb3BlcnR5SWQgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5wcm9wZXJ0eUlkXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5wcm9wZXJ0eV9pZCxcblx0XHRcdFx0XHRcdHRvdGFsX2Ftb3VudDpcblx0XHRcdFx0XHRcdFx0ZGF0YS50b3RhbEFtb3VudCAhPT0gdW5kZWZpbmVkXG5cdFx0XHRcdFx0XHRcdFx0PyBkYXRhLnRvdGFsQW1vdW50XG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC50b3RhbF9hbW91bnQsXG5cdFx0XHRcdFx0XHRpbnZvaWNlczogam9iV2l0aENvbnRleHQuaW52b2ljZXMgfHwgW10sXG5cdFx0XHRcdFx0XHRlc3RpbWF0ZXM6IGpvYldpdGhDb250ZXh0LmVzdGltYXRlcyB8fCBbXSxcblx0XHRcdFx0XHRcdHRlYW1Bc3NpZ25tZW50czogam9iV2l0aENvbnRleHQudGVhbV9hc3NpZ25tZW50cyB8fCBbXSxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSB2YWxpZGF0ZVN0YXR1c1RyYW5zaXRpb24odHJhbnNpdGlvbkNvbnRleHQpO1xuXG5cdFx0XHRcdGlmICghdmFsaWRhdGlvblJlc3VsdC5hbGxvd2VkKSB7XG5cdFx0XHRcdFx0bGV0IGVycm9yTWVzc2FnZSA9XG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlYXNvbiB8fCBcIlN0YXR1cyB0cmFuc2l0aW9uIG5vdCBhbGxvd2VkXCI7XG5cblx0XHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlcXVpcmVkRmllbGRzICYmXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlcXVpcmVkRmllbGRzLmxlbmd0aCA+IDBcblx0XHRcdFx0XHQpIHtcblx0XHRcdFx0XHRcdGVycm9yTWVzc2FnZSArPSBgLiBNaXNzaW5nOiAke3ZhbGlkYXRpb25SZXN1bHQucmVxdWlyZWRGaWVsZHMuam9pbihcIiwgXCIpfWA7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKGVycm9yTWVzc2FnZSwgRVJST1JfQ09ERVMuVkFMSURBVElPTl9GQUlMRUQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gTG9nIHdhcm5pbmdzIGlmIHByZXNlbnQgKG5vbi1ibG9ja2luZylcblx0XHRcdFx0aWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwi4pqg77iPIFN0YXR1cyB0cmFuc2l0aW9uIHdhcm5pbmdzOlwiLCB7XG5cdFx0XHRcdFx0XHRqb2JJZCxcblx0XHRcdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGpvYldpdGhDb250ZXh0LnN0YXR1cyxcblx0XHRcdFx0XHRcdG5ld1N0YXR1czogZGF0YS5zdGF0dXMsXG5cdFx0XHRcdFx0XHR3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIEJ1aWxkIGNvcmUgam9iIHVwZGF0ZSBvYmplY3Qgd2l0aCBvbmx5IGRlZmluZWQgdmFsdWVzXG5cdFx0Y29uc3QgY29yZVVwZGF0ZURhdGE6IGFueSA9IHt9O1xuXHRcdGlmIChkYXRhLnRpdGxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnRpdGxlID0gZGF0YS50aXRsZTtcblx0XHR9XG5cdFx0aWYgKGRhdGEuZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuZGVzY3JpcHRpb24gPSBkYXRhLmRlc2NyaXB0aW9uO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zdGF0dXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuc3RhdHVzID0gZGF0YS5zdGF0dXM7XG5cdFx0fVxuXHRcdGlmIChkYXRhLnByaW9yaXR5ICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnByaW9yaXR5ID0gZGF0YS5wcmlvcml0eTtcblx0XHR9XG5cdFx0aWYgKGRhdGEuam9iVHlwZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb3JlVXBkYXRlRGF0YS5qb2JfdHlwZSA9IGRhdGEuam9iVHlwZTtcblx0XHR9XG5cdFx0aWYgKGRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEubm90ZXMgPSBkYXRhLm5vdGVzO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zY2hlZHVsZWRTdGFydCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb3JlVXBkYXRlRGF0YS5zY2hlZHVsZWRfc3RhcnQgPSBkYXRhLnNjaGVkdWxlZFN0YXJ0O1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zY2hlZHVsZWRFbmQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuc2NoZWR1bGVkX2VuZCA9IGRhdGEuc2NoZWR1bGVkRW5kO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5hc3NpZ25lZFRvICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLmFzc2lnbmVkX3RvID0gZGF0YS5hc3NpZ25lZFRvO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLmN1c3RvbWVyX2lkID0gZGF0YS5jdXN0b21lcklkO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5wcm9wZXJ0eUlkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnByb3BlcnR5X2lkID0gZGF0YS5wcm9wZXJ0eUlkO1xuXHRcdFx0Ly8gSWYgcHJvcGVydHkgaXMgYmVpbmcgc2V0IChub3QgbnVsbCksIHZlcmlmeSBpdCBiZWxvbmdzIHRvIHRoZSBjdXN0b21lciAoaWYgY3VzdG9tZXIgaXMgc2V0KVxuXHRcdFx0aWYgKFxuXHRcdFx0XHRkYXRhLnByb3BlcnR5SWQgIT09IG51bGwgJiZcblx0XHRcdFx0ZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQgJiZcblx0XHRcdFx0ZGF0YS5jdXN0b21lcklkICE9PSBudWxsXG5cdFx0XHQpIHtcblx0XHRcdFx0Y29uc3QgeyBkYXRhOiBwcm9wZXJ0eSB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdFx0XHQuZnJvbShcInByb3BlcnRpZXNcIilcblx0XHRcdFx0XHQuc2VsZWN0KFwiY3VzdG9tZXJfaWRcIilcblx0XHRcdFx0XHQuZXEoXCJpZFwiLCBkYXRhLnByb3BlcnR5SWQpXG5cdFx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRcdGlmIChwcm9wZXJ0eSAmJiBwcm9wZXJ0eS5jdXN0b21lcl9pZCAhPT0gZGF0YS5jdXN0b21lcklkKSB7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcdFx0XCJQcm9wZXJ0eSBkb2VzIG5vdCBiZWxvbmcgdG8gdGhlIHNlbGVjdGVkIGN1c3RvbWVyXCIsXG5cdFx0XHRcdFx0XHRFUlJPUl9DT0RFUy5WQUxJREFUSU9OX0ZBSUxFRCxcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gQnVpbGQgZmluYW5jaWFsIGRvbWFpbiB1cGRhdGUgb2JqZWN0IChpZiBhbnkgZmluYW5jaWFsIGZpZWxkcyBwcm92aWRlZClcblx0XHRjb25zdCBmaW5hbmNpYWxVcGRhdGVEYXRhOiBhbnkgPSB7fTtcblx0XHRpZiAoZGF0YS50b3RhbEFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmaW5hbmNpYWxVcGRhdGVEYXRhLnRvdGFsX2Ftb3VudCA9IGRhdGEudG90YWxBbW91bnQ7XG5cdFx0fVxuXHRcdGlmIChkYXRhLnBhaWRBbW91bnQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0ZmluYW5jaWFsVXBkYXRlRGF0YS5wYWlkX2Ftb3VudCA9IGRhdGEucGFpZEFtb3VudDtcblx0XHR9XG5cdFx0aWYgKGRhdGEuZGVwb3NpdEFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmaW5hbmNpYWxVcGRhdGVEYXRhLmRlcG9zaXRfYW1vdW50ID0gZGF0YS5kZXBvc2l0QW1vdW50O1xuXHRcdH1cblxuXHRcdC8vIEV4ZWN1dGUgdXBkYXRlcyBpbiBwYXJhbGxlbCBmb3IgcGVyZm9ybWFuY2Vcblx0XHRjb25zdCB1cGRhdGVzOiBQcm9taXNlPGFueT5bXSA9IFtdO1xuXG5cdFx0Ly8gVXBkYXRlIGNvcmUgam9iIHRhYmxlIGlmIHRoZXJlIGFyZSBjaGFuZ2VzXG5cdFx0aWYgKE9iamVjdC5rZXlzKGNvcmVVcGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG5cdFx0XHR1cGRhdGVzLnB1c2goXG5cdFx0XHRcdChhc3luYyAoKSA9PiBhd2FpdCBzdXBhYmFzZS5mcm9tKFwiam9ic1wiKS51cGRhdGUoY29yZVVwZGF0ZURhdGEpLmVxKFwiaWRcIiwgam9iSWQpKSgpLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBVcGRhdGUgZmluYW5jaWFsIGRvbWFpbiB0YWJsZSBpZiB0aGVyZSBhcmUgY2hhbmdlc1xuXHRcdGlmIChPYmplY3Qua2V5cyhmaW5hbmNpYWxVcGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG5cdFx0XHR1cGRhdGVzLnB1c2goXG5cdFx0XHRcdChhc3luYyAoKSA9PlxuXHRcdFx0XHRcdGF3YWl0IHN1cGFiYXNlXG5cdFx0XHRcdFx0XHQuZnJvbShcImpvYl9maW5hbmNpYWxcIilcblx0XHRcdFx0XHRcdC51cGRhdGUoZmluYW5jaWFsVXBkYXRlRGF0YSlcblx0XHRcdFx0XHRcdC5lcShcImpvYl9pZFwiLCBqb2JJZCkpKCksXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEV4ZWN1dGUgYWxsIHVwZGF0ZXMgaW4gcGFyYWxsZWxcblx0XHRpZiAodXBkYXRlcy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwodXBkYXRlcyk7XG5cblx0XHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gYW55IHVwZGF0ZVxuXHRcdFx0Y29uc3QgZXJyb3JzID0gcmVzdWx0cy5maWx0ZXIoKHJlc3VsdCkgPT4gcmVzdWx0LmVycm9yKTtcblx0XHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRjb25zdCBlcnJvck1lc3NhZ2VzID0gZXJyb3JzLm1hcCgoZSkgPT4gZS5lcnJvci5tZXNzYWdlKS5qb2luKFwiLCBcIik7XG5cdFx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XHRgJHtFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJ1cGRhdGUgam9iXCIpfTogJHtlcnJvck1lc3NhZ2VzfWAsXG5cdFx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBVcGRhdGUgam9iIHdpdGggZGF0YSBvYmplY3QgKGVhc2llciBmb3IgcHJvZ3JhbW1hdGljIHVzZSlcbiAqIFVzZWQgYnkgam9iIGVkaXRvciBmb3IgaW4tcGxhY2UgdXBkYXRlc1xuICovXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVKb2JEYXRhKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRkYXRhOiBQYXJ0aWFsPFVwZGF0ZUpvYkRhdGE+LFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHQvLyBDb252ZXJ0IGRhdGEgb2JqZWN0IHRvIEZvcm1EYXRhIGZvciBjb21wYXRpYmlsaXR5IHdpdGggZXhpc3RpbmcgdXBkYXRlSm9iXG5cdFx0Y29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcblxuXHRcdC8vIEFkZCBhbGwgZGVmaW5lZCBmaWVsZHMgdG8gRm9ybURhdGFcblx0XHRpZiAoZGF0YS50aXRsZSAhPT0gdW5kZWZpbmVkKSBmb3JtRGF0YS5hcHBlbmQoXCJ0aXRsZVwiLCBkYXRhLnRpdGxlKTtcblx0XHRpZiAoZGF0YS5kZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwiZGVzY3JpcHRpb25cIiwgZGF0YS5kZXNjcmlwdGlvbik7XG5cdFx0aWYgKGRhdGEuc3RhdHVzICE9PSB1bmRlZmluZWQpIGZvcm1EYXRhLmFwcGVuZChcInN0YXR1c1wiLCBkYXRhLnN0YXR1cyk7XG5cdFx0aWYgKGRhdGEucHJpb3JpdHkgIT09IHVuZGVmaW5lZCkgZm9ybURhdGEuYXBwZW5kKFwicHJpb3JpdHlcIiwgZGF0YS5wcmlvcml0eSk7XG5cdFx0aWYgKGRhdGEuam9iVHlwZSAhPT0gdW5kZWZpbmVkKSBmb3JtRGF0YS5hcHBlbmQoXCJqb2JUeXBlXCIsIGRhdGEuam9iVHlwZSk7XG5cdFx0aWYgKGRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkgZm9ybURhdGEuYXBwZW5kKFwibm90ZXNcIiwgZGF0YS5ub3Rlcyk7XG5cdFx0aWYgKGRhdGEudG90YWxBbW91bnQgIT09IHVuZGVmaW5lZClcblx0XHRcdGZvcm1EYXRhLmFwcGVuZChcInRvdGFsQW1vdW50XCIsIGRhdGEudG90YWxBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEucGFpZEFtb3VudCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwicGFpZEFtb3VudFwiLCBkYXRhLnBhaWRBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEuZGVwb3NpdEFtb3VudCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwiZGVwb3NpdEFtb3VudFwiLCBkYXRhLmRlcG9zaXRBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEuc2NoZWR1bGVkU3RhcnQgIT09IHVuZGVmaW5lZClcblx0XHRcdGZvcm1EYXRhLmFwcGVuZChcInNjaGVkdWxlZFN0YXJ0XCIsIGRhdGEuc2NoZWR1bGVkU3RhcnQpO1xuXHRcdGlmIChkYXRhLnNjaGVkdWxlZEVuZCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwic2NoZWR1bGVkRW5kXCIsIGRhdGEuc2NoZWR1bGVkRW5kKTtcblx0XHRpZiAoZGF0YS5hc3NpZ25lZFRvICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJhc3NpZ25lZFRvXCIsIGRhdGEuYXNzaWduZWRUbyB8fCBcIlwiKTtcblx0XHRpZiAoZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJjdXN0b21lcklkXCIsIGRhdGEuY3VzdG9tZXJJZCB8fCBcIlwiKTtcblx0XHRpZiAoZGF0YS5wcm9wZXJ0eUlkICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJwcm9wZXJ0eUlkXCIsIGRhdGEucHJvcGVydHlJZCB8fCBcIlwiKTtcblxuXHRcdC8vIFJldXNlIGV4aXN0aW5nIHVwZGF0ZUpvYiBsb2dpY1xuXHRcdHJldHVybiBhd2FpdCB1cGRhdGVKb2Ioam9iSWQsIGZvcm1EYXRhKTtcblx0fSk7XG59XG5cbi8qKlxuICogVXBkYXRlIGpvYiBzdGF0dXMgd2l0aCB2YWxpZGF0aW9uXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5zdGF0dXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYlN0YXR1cyhcblx0am9iSWQ6IHN0cmluZyxcblx0bmV3U3RhdHVzOiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBjdXJyZW50IHVzZXJcblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmFsaWRhdGUgc3RhdHVzIHZhbHVlXG5cdFx0Y29uc3QgdmFsaWRTdGF0dXNlczogSm9iU3RhdHVzW10gPSBbXG5cdFx0XHRcInF1b3RlZFwiLFxuXHRcdFx0XCJzY2hlZHVsZWRcIixcblx0XHRcdFwiaW5fcHJvZ3Jlc3NcIixcblx0XHRcdFwib25faG9sZFwiLFxuXHRcdFx0XCJjb21wbGV0ZWRcIixcblx0XHRcdFwiY2FuY2VsbGVkXCIsXG5cdFx0XHRcImludm9pY2VkXCIsXG5cdFx0XHRcInBhaWRcIixcblx0XHRdO1xuXHRcdGlmICghdmFsaWRTdGF0dXNlcy5pbmNsdWRlcyhuZXdTdGF0dXMgYXMgSm9iU3RhdHVzKSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkludmFsaWQgam9iIHN0YXR1c1wiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5WQUxJREFUSU9OX0ZBSUxFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gRmV0Y2ggam9iIHdpdGggYWxsIGNvbnRleHQgbmVlZGVkIGZvciB0cmFuc2l0aW9uIHZhbGlkYXRpb25cblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRgXG5cdFx0XHRcdGlkLFxuXHRcdFx0XHRjb21wYW55X2lkLFxuXHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdHNjaGVkdWxlZF9zdGFydCxcblx0XHRcdFx0c2NoZWR1bGVkX2VuZCxcblx0XHRcdFx0YXNzaWduZWRfdG8sXG5cdFx0XHRcdGN1c3RvbWVyX2lkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZCxcblx0XHRcdFx0dG90YWxfYW1vdW50LFxuXHRcdFx0XHRpbnZvaWNlczppbnZvaWNlcyhzdGF0dXMsIHRvdGFsX2Ftb3VudCksXG5cdFx0XHRcdGVzdGltYXRlczplc3RpbWF0ZXMoc3RhdHVzKSxcblx0XHRcdFx0dGVhbV9hc3NpZ25tZW50czpqb2JfdGVhbV9hc3NpZ25tZW50cyh0ZWFtX21lbWJlcl9pZClcblx0XHRcdGAsXG5cdFx0XHQpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhleGlzdGluZ0pvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoZXhpc3RpbmdKb2IuY29tcGFueV9pZCAhPT0gY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQnVpbGQgY29udGV4dCBmb3IgdHJhbnNpdGlvbiB2YWxpZGF0aW9uXG5cdFx0Y29uc3QgdHJhbnNpdGlvbkNvbnRleHQ6IEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0ID0ge1xuXHRcdFx0Y3VycmVudFN0YXR1czogZXhpc3RpbmdKb2Iuc3RhdHVzIGFzIEpvYlN0YXR1cyxcblx0XHRcdG5ld1N0YXR1czogbmV3U3RhdHVzIGFzIEpvYlN0YXR1cyxcblx0XHRcdGpvYjoge1xuXHRcdFx0XHRpZDogZXhpc3RpbmdKb2IuaWQsXG5cdFx0XHRcdHNjaGVkdWxlZF9zdGFydDogZXhpc3RpbmdKb2Iuc2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRzY2hlZHVsZWRfZW5kOiBleGlzdGluZ0pvYi5zY2hlZHVsZWRfZW5kLFxuXHRcdFx0XHRhc3NpZ25lZF90bzogZXhpc3RpbmdKb2IuYXNzaWduZWRfdG8sXG5cdFx0XHRcdGN1c3RvbWVyX2lkOiBleGlzdGluZ0pvYi5jdXN0b21lcl9pZCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IGV4aXN0aW5nSm9iLnByb3BlcnR5X2lkLFxuXHRcdFx0XHR0b3RhbF9hbW91bnQ6IGV4aXN0aW5nSm9iLnRvdGFsX2Ftb3VudCxcblx0XHRcdFx0aW52b2ljZXM6IGV4aXN0aW5nSm9iLmludm9pY2VzIHx8IFtdLFxuXHRcdFx0XHRlc3RpbWF0ZXM6IGV4aXN0aW5nSm9iLmVzdGltYXRlcyB8fCBbXSxcblx0XHRcdFx0dGVhbUFzc2lnbm1lbnRzOiBleGlzdGluZ0pvYi50ZWFtX2Fzc2lnbm1lbnRzIHx8IFtdLFxuXHRcdFx0fSxcblx0XHR9O1xuXG5cdFx0Ly8gVmFsaWRhdGUgdHJhbnNpdGlvbiB3aXRoIGNvbXByZWhlbnNpdmUgYnVzaW5lc3MgcnVsZXNcblx0XHRjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gdmFsaWRhdGVTdGF0dXNUcmFuc2l0aW9uKHRyYW5zaXRpb25Db250ZXh0KTtcblxuXHRcdGlmICghdmFsaWRhdGlvblJlc3VsdC5hbGxvd2VkKSB7XG5cdFx0XHRsZXQgZXJyb3JNZXNzYWdlID1cblx0XHRcdFx0dmFsaWRhdGlvblJlc3VsdC5yZWFzb24gfHwgXCJTdGF0dXMgdHJhbnNpdGlvbiBub3QgYWxsb3dlZFwiO1xuXG5cdFx0XHRpZiAoXG5cdFx0XHRcdHZhbGlkYXRpb25SZXN1bHQucmVxdWlyZWRGaWVsZHMgJiZcblx0XHRcdFx0dmFsaWRhdGlvblJlc3VsdC5yZXF1aXJlZEZpZWxkcy5sZW5ndGggPiAwXG5cdFx0XHQpIHtcblx0XHRcdFx0ZXJyb3JNZXNzYWdlICs9IGAuIE1pc3Npbmc6ICR7dmFsaWRhdGlvblJlc3VsdC5yZXF1aXJlZEZpZWxkcy5qb2luKFwiLCBcIil9YDtcblx0XHRcdH1cblxuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKGVycm9yTWVzc2FnZSwgRVJST1JfQ09ERVMuVkFMSURBVElPTl9GQUlMRUQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyB3YXJuaW5ncyBpZiBwcmVzZW50IChub24tYmxvY2tpbmcpXG5cdFx0aWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCLimqDvuI8gU3RhdHVzIHRyYW5zaXRpb24gd2FybmluZ3M6XCIsIHtcblx0XHRcdFx0am9iSWQsXG5cdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGV4aXN0aW5nSm9iLnN0YXR1cyxcblx0XHRcdFx0bmV3U3RhdHVzLFxuXHRcdFx0XHR3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBzdGF0dXNcblx0XHRjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnVwZGF0ZSh7IHN0YXR1czogbmV3U3RhdHVzIH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwidXBkYXRlIGpvYiBzdGF0dXNcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1FVRVJZX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zb2xlLmxvZyhcIuKchSBKb2Igc3RhdHVzIHVwZGF0ZWQ6XCIsIHtcblx0XHRcdGpvYklkLFxuXHRcdFx0b2xkU3RhdHVzOiBleGlzdGluZ0pvYi5zdGF0dXMsXG5cdFx0XHRuZXdTdGF0dXMsXG5cdFx0fSk7XG5cblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZC93b3JrLyR7am9iSWR9YCk7XG5cdH0pO1xufVxuXG4vKipcbiAqIEFzc2lnbiBqb2IgdG8gYSB0ZWNobmljaWFuXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5hc3NpZ25lZF90b1xuICovXG5hc3luYyBmdW5jdGlvbiBhc3NpZ25Kb2IoXG5cdGpvYklkOiBzdHJpbmcsXG5cdHRlY2huaWNpYW5JZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWRcIilcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0YXNzZXJ0RXhpc3RzKGV4aXN0aW5nSm9iLCBcIkpvYlwiKTtcblxuXHRcdGlmIChleGlzdGluZ0pvYi5jb21wYW55X2lkICE9PSBjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwiam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgdGVjaG5pY2lhbiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IHRlY2huaWNpYW4gfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImNvbXBhbnlfbWVtYmVyc2hpcHNcIilcblx0XHRcdC5zZWxlY3QoXCJ1c2VyX2lkXCIpXG5cdFx0XHQuZXEoXCJ1c2VyX2lkXCIsIHRlY2huaWNpYW5JZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWNobmljaWFuKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiVGVjaG5pY2lhbiBub3QgZm91bmQgaW4geW91ciBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1JFQ09SRF9OT1RfRk9VTkQsXG5cdFx0XHRcdDQwNCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQXNzaWduIGpvYlxuXHRcdGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQudXBkYXRlKHsgYXNzaWduZWRfdG86IHRlY2huaWNpYW5JZCB9KVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpO1xuXG5cdFx0aWYgKHVwZGF0ZUVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImFzc2lnbiBqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1FVRVJZX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZC93b3JrLyR7am9iSWR9YCk7XG5cdH0pO1xufVxuXG4vKipcbiAqIFNjaGVkdWxlIGEgam9iXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icyB0YWJsZSBzY2hlZHVsaW5nIGZpZWxkc1xuICovXG5hc3luYyBmdW5jdGlvbiBzY2hlZHVsZUpvYihcblx0am9iSWQ6IHN0cmluZyxcblx0Zm9ybURhdGE6IEZvcm1EYXRhLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSBzY2hlZHVsZUpvYlNjaGVtYS5wYXJzZSh7XG5cdFx0XHRzY2hlZHVsZWRTdGFydDogZm9ybURhdGEuZ2V0KFwic2NoZWR1bGVkU3RhcnRcIiksXG5cdFx0XHRzY2hlZHVsZWRFbmQ6IGZvcm1EYXRhLmdldChcInNjaGVkdWxlZEVuZFwiKSxcblx0XHR9KTtcblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWQsIHN0YXR1c1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBzY2hlZHVsZSBhbmQgc3RhdHVzXG5cdFx0Y29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRzdGF0dXM6XG5cdFx0XHRcdFx0ZXhpc3RpbmdKb2Iuc3RhdHVzID09PSBcInF1b3RlZFwiID8gXCJzY2hlZHVsZWRcIiA6IGV4aXN0aW5nSm9iLnN0YXR1cyxcblx0XHRcdH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwic2NoZWR1bGUgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0fSk7XG59XG5cbi8qKlxuICogU3RhcnQgYSBqb2JcbiAqIPCflKcgUkVGQUNUT1JFRCAtIE5vdyB1cGRhdGVzIGpvYl90aW1lX3RyYWNraW5nLmFjdHVhbF9zdGFydCBpbnN0ZWFkIG9mIGpvYnMuYWN0dWFsX3N0YXJ0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdGFydEpvYihqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWQsIHN0YXR1c1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbiBvbmx5IHN0YXJ0IHNjaGVkdWxlZCBqb2JzXG5cdFx0aWYgKGV4aXN0aW5nSm9iLnN0YXR1cyAhPT0gXCJzY2hlZHVsZWRcIiAmJiBleGlzdGluZ0pvYi5zdGF0dXMgIT09IFwicXVvdGVkXCIpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgbXVzdCBiZSBzY2hlZHVsZWQgYmVmb3JlIHN0YXJ0aW5nXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuXG5cdFx0Ly8gVXBkYXRlIGJvdGggam9icyB0YWJsZSAoc3RhdHVzKSBhbmQgam9iX3RpbWVfdHJhY2tpbmcgdGFibGUgKGFjdHVhbF9zdGFydCkgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0c3VwYWJhc2UuZnJvbShcImpvYnNcIikudXBkYXRlKHsgc3RhdHVzOiBcImluX3Byb2dyZXNzXCIgfSkuZXEoXCJpZFwiLCBqb2JJZCksXG5cdFx0XHRzdXBhYmFzZVxuXHRcdFx0XHQuZnJvbShcImpvYl90aW1lX3RyYWNraW5nXCIpXG5cdFx0XHRcdC51cGRhdGUoeyBhY3R1YWxfc3RhcnQ6IG5vdyB9KVxuXHRcdFx0XHQuZXEoXCJqb2JfaWRcIiwgam9iSWQpLFxuXHRcdF0pO1xuXG5cdFx0Ly8gQ2hlY2sgZm9yIGVycm9ycyBpbiBlaXRoZXIgdXBkYXRlXG5cdFx0Y29uc3QgZXJyb3JzID0gdXBkYXRlcy5maWx0ZXIoKHJlc3VsdCkgPT4gcmVzdWx0LmVycm9yKTtcblx0XHRpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwic3RhcnQgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBDb21wbGV0ZSBhIGpvYlxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgam9iX3RpbWVfdHJhY2tpbmcuYWN0dWFsX2VuZCBhbmQgY2FsY3VsYXRlcyB0b3RhbF9sYWJvcl9ob3Vyc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29tcGxldGVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHZvaWQ+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IGN1cnJlbnQgdXNlclxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdC8vIEdldCB1c2VyJ3MgYWN0aXZlIGNvbXBhbnkgdXNpbmcgaGVscGVyIChoYW5kbGVzIG11bHRpLWNvbXBhbnkgdXNlcnMpXG5cdFx0Y29uc3QgeyBnZXRBY3RpdmVDb21wYW55SWQgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL2F1dGgvY29tcGFueS1jb250ZXh0XCIpO1xuXHRcdGNvbnN0IGNvbXBhbnlJZCA9IGF3YWl0IGdldEFjdGl2ZUNvbXBhbnlJZCgpO1xuXG5cdFx0aWYgKCFjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGJlbG9uZ3MgdG8gY29tcGFueSBhbmQgZ2V0IHRpbWUgdHJhY2tpbmcgZGF0YVxuXHRcdGNvbnN0IHsgZGF0YTogZXhpc3RpbmdKb2IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkLCBzdGF0dXMsIHRpbWVUcmFja2luZzpqb2JfdGltZV90cmFja2luZygqKVwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbiBvbmx5IGNvbXBsZXRlIGluLXByb2dyZXNzIGpvYnNcblx0XHRpZiAoZXhpc3RpbmdKb2Iuc3RhdHVzICE9PSBcImluX3Byb2dyZXNzXCIpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgbXVzdCBiZSBpbiBwcm9ncmVzcyB0byBjb21wbGV0ZVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcblxuXHRcdC8vIENhbGN1bGF0ZSB0b3RhbCBsYWJvciBob3VycyBpZiB3ZSBoYXZlIGFjdHVhbF9zdGFydFxuXHRcdGNvbnN0IHRpbWVUcmFja2luZyA9IEFycmF5LmlzQXJyYXkoZXhpc3RpbmdKb2IudGltZVRyYWNraW5nKVxuXHRcdFx0PyBleGlzdGluZ0pvYi50aW1lVHJhY2tpbmdbMF1cblx0XHRcdDogZXhpc3RpbmdKb2IudGltZVRyYWNraW5nO1xuXG5cdFx0Y29uc3QgdGltZVRyYWNraW5nVXBkYXRlOiBhbnkgPSB7IGFjdHVhbF9lbmQ6IG5vdyB9O1xuXG5cdFx0aWYgKHRpbWVUcmFja2luZz8uYWN0dWFsX3N0YXJ0KSB7XG5cdFx0XHRjb25zdCBzdGFydFRpbWUgPSBuZXcgRGF0ZSh0aW1lVHJhY2tpbmcuYWN0dWFsX3N0YXJ0KS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBlbmRUaW1lID0gbmV3IERhdGUobm93KS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBob3Vyc1dvcmtlZCA9IChlbmRUaW1lIC0gc3RhcnRUaW1lKSAvICgxMDAwICogNjAgKiA2MCk7IC8vIENvbnZlcnQgbXMgdG8gaG91cnNcblx0XHRcdHRpbWVUcmFja2luZ1VwZGF0ZS50b3RhbF9sYWJvcl9ob3VycyA9IGhvdXJzV29ya2VkO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBib3RoIGpvYnMgdGFibGUgKHN0YXR1cykgYW5kIGpvYl90aW1lX3RyYWNraW5nIHRhYmxlIChhY3R1YWxfZW5kLCB0b3RhbF9sYWJvcl9ob3VycykgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0c3VwYWJhc2UuZnJvbShcImpvYnNcIikudXBkYXRlKHsgc3RhdHVzOiBcImNvbXBsZXRlZFwiIH0pLmVxKFwiaWRcIiwgam9iSWQpLFxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfdGltZV90cmFja2luZ1wiKVxuXHRcdFx0XHQudXBkYXRlKHRpbWVUcmFja2luZ1VwZGF0ZSlcblx0XHRcdFx0LmVxKFwiam9iX2lkXCIsIGpvYklkKSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gZWl0aGVyIHVwZGF0ZVxuXHRcdGNvbnN0IGVycm9ycyA9IHVwZGF0ZXMuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5lcnJvcik7XG5cdFx0aWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImNvbXBsZXRlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0fSk7XG59XG5cbi8qKlxuICogQ2FuY2VsIGEgam9iXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5zdGF0dXMgYW5kIGpvYnMubm90ZXNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gY2FuY2VsSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRyZWFzb24/OiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBjdXJyZW50IHVzZXJcblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzLCBub3Rlc1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbm5vdCBjYW5jZWwgY29tcGxldGVkIGpvYnNcblx0XHRpZiAoZXhpc3RpbmdKb2Iuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiQ2Fubm90IGNhbmNlbCBjb21wbGV0ZWQgam9ic1wiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEFkZCBjYW5jZWxsYXRpb24gcmVhc29uIHRvIG5vdGVzXG5cdFx0Y29uc3QgdXBkYXRlZE5vdGVzID0gcmVhc29uXG5cdFx0XHQ/IGAke2V4aXN0aW5nSm9iLm5vdGVzIHx8IFwiXCJ9XFxuXFxuW0NBTkNFTExFRF06ICR7cmVhc29ufWAudHJpbSgpXG5cdFx0XHQ6IGV4aXN0aW5nSm9iLm5vdGVzO1xuXG5cdFx0Ly8gQ2FuY2VsIGpvYlxuXHRcdGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0c3RhdHVzOiBcImNhbmNlbGxlZFwiLFxuXHRcdFx0XHRub3RlczogdXBkYXRlZE5vdGVzLFxuXHRcdFx0fSlcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKTtcblxuXHRcdGlmICh1cGRhdGVFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJjYW5jZWwgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBTZWFyY2ggam9icyB3aXRoIGZ1bGwtdGV4dCBzZWFyY2ggYW5kIHJhbmtpbmdcbiAqIOKchSBOTyBDSEFOR0VTIE5FRURFRCAtIE9ubHkgc2VhcmNoZXMgam9icyB0YWJsZVxuICovXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hKb2JzKFxuXHRzZWFyY2hUZXJtOiBzdHJpbmcsXG5cdG9wdGlvbnM/OiB7IGxpbWl0PzogbnVtYmVyOyBvZmZzZXQ/OiBudW1iZXIgfSxcbik6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueVtdPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiY29tcGFueV9tZW1iZXJzaGlwc1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWRcIilcblx0XHRcdC5lcShcInVzZXJfaWRcIiwgdXNlci5pZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGlmICghdGVhbU1lbWJlcj8uY29tcGFueV9pZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVzZSBmdWxsLXRleHQgc2VhcmNoIHdpdGggcmFua2luZyBmb3IgYmVzdCBtYXRjaGVzXG5cdFx0Y29uc3QgeyBzZWFyY2hKb2JzRnVsbFRleHQgfSA9IGF3YWl0IGltcG9ydChcblx0XHRcdFwiQC9saWIvc2VhcmNoL2Z1bGwtdGV4dC1zZWFyY2hcIlxuXHRcdCk7XG5cblx0XHRjb25zdCBqb2JzID0gYXdhaXQgc2VhcmNoSm9ic0Z1bGxUZXh0KHN1cGFiYXNlLCB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQsIHNlYXJjaFRlcm0sIHtcblx0XHRcdGxpbWl0OiBvcHRpb25zPy5saW1pdCB8fCA1MCxcblx0XHRcdG9mZnNldDogb3B0aW9ucz8ub2Zmc2V0IHx8IDAsXG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gam9icztcblx0fSk7XG59XG5cbi8qKlxuICogVW5pdmVyc2FsIHNlYXJjaCBhY3Jvc3MgYWxsIGVudGl0aWVzXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHNlYXJjaGVzIGpvYnMgdGFibGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2VhcmNoQWxsKFxuXHRzZWFyY2hUZXJtOiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDxhbnk+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Y29uc3QgeyBkYXRhOiB0ZWFtTWVtYmVyIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjb21wYW55X21lbWJlcnNoaXBzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWFtTWVtYmVyPy5jb21wYW55X2lkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVXNlIHVuaXZlcnNhbCBzZWFyY2ggUlBDIGZ1bmN0aW9uXG5cdFx0Y29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UucnBjKFwic2VhcmNoX2FsbF9lbnRpdGllc1wiLCB7XG5cdFx0XHRjb21wYW55X2lkX3BhcmFtOiB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQsXG5cdFx0XHRzZWFyY2hfcXVlcnk6IHNlYXJjaFRlcm0sXG5cdFx0XHRwZXJfZW50aXR5X2xpbWl0OiA1LFxuXHRcdH0pO1xuXG5cdFx0aWYgKGVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcInNlYXJjaFwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBkYXRhO1xuXHR9KTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSk9CIEFSQ0hJVkUgJiBSRVNUT1JFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogQXJjaGl2ZSBqb2IgKHNvZnQgZGVsZXRlKVxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgam9iX211bHRpX2VudGl0eS5kZWxldGVkX2J5IGFuZCBwZXJtYW5lbnRfZGVsZXRlX3NjaGVkdWxlZF9hdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXJjaGl2ZUpvYihqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHRjb25zdCB7IGRhdGE6IHRlYW1NZW1iZXIgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImNvbXBhbnlfbWVtYmVyc2hpcHNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJ1c2VyX2lkXCIsIHVzZXIuaWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoIXRlYW1NZW1iZXI/LmNvbXBhbnlfaWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogam9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGpvYi5jb21wYW55X2lkICE9PSB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwiam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBDYW5ub3QgYXJjaGl2ZSBjb21wbGV0ZWQvcGFpZCBqb2JzIChidXNpbmVzcyBydWxlKVxuXHRcdGlmIChqb2Iuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiIHx8IGpvYi5zdGF0dXMgPT09IFwiaW52b2ljZWRcIikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkNhbm5vdCBhcmNoaXZlIGNvbXBsZXRlZCBvciBpbnZvaWNlZCBqb2JzLiBUaGVzZSBtdXN0IGJlIHJldGFpbmVkIGZvciByZWNvcmRzLlwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEFyY2hpdmUgam9iIChzb2Z0IGRlbGV0ZSlcblx0XHRjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG5cdFx0Y29uc3Qgc2NoZWR1bGVkRGVsZXRpb24gPSBuZXcgRGF0ZShcblx0XHRcdERhdGUubm93KCkgKyA5MCAqIDI0ICogNjAgKiA2MCAqIDEwMDAsXG5cdFx0KS50b0lTT1N0cmluZygpO1xuXG5cdFx0Ly8gVXBkYXRlIGJvdGggam9icyB0YWJsZSBhbmQgam9iX211bHRpX2VudGl0eSB0YWJsZSBpbiBwYXJhbGxlbFxuXHRcdGNvbnN0IHVwZGF0ZXMgPSBhd2FpdCBQcm9taXNlLmFsbChbXG5cdFx0XHQvLyBVcGRhdGUgY29yZSBqb2JzIHRhYmxlIHdpdGggYXJjaGl2ZSBtZXRhZGF0YVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRcdGRlbGV0ZWRfYXQ6IG5vdyxcblx0XHRcdFx0XHRhcmNoaXZlZF9hdDogbm93LFxuXHRcdFx0XHRcdHN0YXR1czogXCJhcmNoaXZlZFwiLFxuXHRcdFx0XHR9KVxuXHRcdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCksXG5cblx0XHRcdC8vIFVwZGF0ZSBqb2JfbXVsdGlfZW50aXR5IHRhYmxlIHdpdGggZGVsZXRpb24gdHJhY2tpbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX211bHRpX2VudGl0eVwiKVxuXHRcdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0XHRkZWxldGVkX2J5OiB1c2VyLmlkLFxuXHRcdFx0XHRcdHBlcm1hbmVudF9kZWxldGVfc2NoZWR1bGVkX2F0OiBzY2hlZHVsZWREZWxldGlvbixcblx0XHRcdFx0fSlcblx0XHRcdFx0LmVxKFwiam9iX2lkXCIsIGpvYklkKSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gZWl0aGVyIHVwZGF0ZVxuXHRcdGNvbnN0IGVycm9ycyA9IHVwZGF0ZXMuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5lcnJvcik7XG5cdFx0aWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImFyY2hpdmUgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9zZXR0aW5ncy9hcmNoaXZlXCIpO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBSZXN0b3JlIGFyY2hpdmVkIGpvYlxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IGNsZWFycyBqb2JfbXVsdGlfZW50aXR5LmRlbGV0ZWRfYnkgYW5kIHBlcm1hbmVudF9kZWxldGVfc2NoZWR1bGVkX2F0XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlc3RvcmVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHZvaWQ+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Y29uc3QgeyBkYXRhOiB0ZWFtTWVtYmVyIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjb21wYW55X21lbWJlcnNoaXBzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWFtTWVtYmVyPy5jb21wYW55X2lkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnkgYW5kIGlzIGFyY2hpdmVkXG5cdFx0Y29uc3QgeyBkYXRhOiBqb2IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkLCBkZWxldGVkX2F0LCBzdGF0dXNcIilcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0YXNzZXJ0RXhpc3RzKGpvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoam9iLmNvbXBhbnlfaWQgIT09IHRlYW1NZW1iZXIuY29tcGFueV9pZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmICgham9iLmRlbGV0ZWRfYXQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgaXMgbm90IGFyY2hpdmVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmVzdG9yZSBqb2IgLSB1cGRhdGUgYm90aCB0YWJsZXMgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0Ly8gQ2xlYXIgY29yZSBqb2JzIHRhYmxlIGFyY2hpdmUgbWV0YWRhdGFcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0XHRkZWxldGVkX2F0OiBudWxsLFxuXHRcdFx0XHRcdGFyY2hpdmVkX2F0OiBudWxsLFxuXHRcdFx0XHRcdHN0YXR1czogam9iLnN0YXR1cyA9PT0gXCJhcmNoaXZlZFwiID8gXCJzY2hlZHVsZWRcIiA6IGpvYi5zdGF0dXMsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5lcShcImlkXCIsIGpvYklkKSxcblxuXHRcdFx0Ly8gQ2xlYXIgam9iX211bHRpX2VudGl0eSB0YWJsZSBkZWxldGlvbiB0cmFja2luZ1xuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfbXVsdGlfZW50aXR5XCIpXG5cdFx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRcdGRlbGV0ZWRfYnk6IG51bGwsXG5cdFx0XHRcdFx0cGVybWFuZW50X2RlbGV0ZV9zY2hlZHVsZWRfYXQ6IG51bGwsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5lcShcImpvYl9pZFwiLCBqb2JJZCksXG5cdFx0XSk7XG5cblx0XHQvLyBDaGVjayBmb3IgZXJyb3JzIGluIGVpdGhlciB1cGRhdGVcblx0XHRjb25zdCBlcnJvcnMgPSB1cGRhdGVzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuZXJyb3IpO1xuXHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJyZXN0b3JlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9zY2hlZHVsZVwiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvc2V0dGluZ3MvYXJjaGl2ZVwiKTtcblx0fSk7XG59XG5cbi8qKlxuICogUmVtb3ZlIHRlYW0gYXNzaWdubWVudCBmcm9tIGpvYlxuICog4pyFIE5PIENIQU5HRVMgTkVFREVEIC0gT25seSBkZWxldGVzIGZyb20gam9iX3RlYW1fYXNzaWdubWVudHMganVuY3Rpb24gdGFibGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVtb3ZlVGVhbUFzc2lnbm1lbnQoXG5cdGFzc2lnbm1lbnRJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IHRoZSBqdW5jdGlvbiByZWNvcmQgdG8gZmluZCBqb2JfaWQgZm9yIHJldmFsaWRhdGlvblxuXHRcdGNvbnN0IHsgZGF0YTogcmVjb3JkLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9iX3RlYW1fYXNzaWdubWVudHNcIilcblx0XHRcdC5zZWxlY3QoXCJpZCwgam9iX2lkLCBjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBhc3NpZ25tZW50SWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoZmV0Y2hFcnJvciB8fCAhcmVjb3JkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiVGVhbSBhc3NpZ25tZW50IG5vdCBmb3VuZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9SRUNPUkRfTk9UX0ZPVU5ELFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAocmVjb3JkLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJ0ZWFtIGFzc2lnbm1lbnRcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGpvYklkID0gcmVjb3JkLmpvYl9pZDtcblxuXHRcdC8vIERlbGV0ZSBqdW5jdGlvbiB0YWJsZSByb3dcblx0XHRjb25zdCB7IGVycm9yOiBkZWxldGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9iX3RlYW1fYXNzaWdubWVudHNcIilcblx0XHRcdC5kZWxldGUoKVxuXHRcdFx0LmVxKFwiaWRcIiwgYXNzaWdubWVudElkKTtcblxuXHRcdGlmIChkZWxldGVFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJyZW1vdmUgdGVhbSBhc3NpZ25tZW50IGZyb20gam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmV2YWxpZGF0ZSBqb2IgcGFnZSBhbmQgc2NoZWR1bGVcblx0XHRpZiAoam9iSWQpIHtcblx0XHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0XHR9XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBBc3NpZ24gQ3VzdG9tZXIgYW5kIFByb3BlcnR5IHRvIEpvYlxuICpcbiAqIFVwZGF0ZXMgdGhlIGpvYidzIGN1c3RvbWVyX2lkIGFuZCBwcm9wZXJ0eV9pZC5cbiAqIE9ubHkgb25lIGN1c3RvbWVyIGFuZCBwcm9wZXJ0eSBjYW4gYmUgYXNzaWduZWQgcGVyIGpvYi5cbiAqXG4gKiBAcGFyYW0gam9iSWQgLSBKb2IgSURcbiAqIEBwYXJhbSBjdXN0b21lcklkIC0gQ3VzdG9tZXIgSUQgdG8gYXNzaWduXG4gKiBAcGFyYW0gcHJvcGVydHlJZCAtIFByb3BlcnR5IElEIHRvIGFzc2lnbiAob3B0aW9uYWwpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhc3NpZ25DdXN0b21lclRvSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRjdXN0b21lcklkOiBzdHJpbmcsXG5cdHByb3BlcnR5SWQ6IHN0cmluZyB8IG51bGwsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdGNvbnN0IGNvbXBhbnlJZCA9IGF3YWl0IGdldEFjdGl2ZUNvbXBhbnlJZCgpO1xuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImNvbXBhbnkgYWNjZXNzXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGV4aXN0cyBhbmQgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBqb2IsIGVycm9yOiBqb2JFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImlkLCBjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LmlzKFwiZGVsZXRlZF9hdFwiLCBudWxsKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGpvYkVycm9yKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKFwiSm9iIHF1ZXJ5IGVycm9yOlwiLCBqb2JFcnJvcik7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmluZCBqb2I6ICR7am9iRXJyb3IubWVzc2FnZX1gLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdFx0NTAwLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRhc3NlcnRFeGlzdHMoam9iLCBcIkpvYlwiKTtcblxuXHRcdC8vIFZlcmlmeSBjdXN0b21lciBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogY3VzdG9tZXIsIGVycm9yOiBjdXN0b21lckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjdXN0b21lcnNcIilcblx0XHRcdC5zZWxlY3QoXCJpZCwgY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgY3VzdG9tZXJJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LmlzKFwiZGVsZXRlZF9hdFwiLCBudWxsKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGN1c3RvbWVyRXJyb3IpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJDdXN0b21lciBxdWVyeSBlcnJvcjpcIiwgY3VzdG9tZXJFcnJvcik7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmluZCBjdXN0b21lcjogJHtjdXN0b21lckVycm9yLm1lc3NhZ2V9YCxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHRcdDUwMCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0YXNzZXJ0RXhpc3RzKGN1c3RvbWVyLCBcIkN1c3RvbWVyXCIpO1xuXG5cdFx0Ly8gSWYgcHJvcGVydHkgaXMgcHJvdmlkZWQsIHZlcmlmeSBpdCBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY3VzdG9tZXJcblx0XHRpZiAocHJvcGVydHlJZCkge1xuXHRcdFx0Y29uc3QgeyBkYXRhOiBwcm9wZXJ0eSB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJwcm9wZXJ0aWVzXCIpXG5cdFx0XHRcdC5zZWxlY3QoXCJpZCwgY3VzdG9tZXJfaWRcIilcblx0XHRcdFx0LmVxKFwiaWRcIiwgcHJvcGVydHlJZClcblx0XHRcdFx0LmVxKFwiY3VzdG9tZXJfaWRcIiwgY3VzdG9tZXJJZClcblx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRpZiAoIXByb3BlcnR5KSB7XG5cdFx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XHRcIlByb3BlcnR5IG5vdCBmb3VuZCBvciBkb2VzIG5vdCBiZWxvbmcgdG8gdGhpcyBjdXN0b21lclwiLFxuXHRcdFx0XHRcdEVSUk9SX0NPREVTLkRCX1JFQ09SRF9OT1RfRk9VTkQsXG5cdFx0XHRcdFx0NDA0LFxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBqb2Igd2l0aCBjdXN0b21lciBhbmQgcHJvcGVydHlcblx0XHRjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnVwZGF0ZSh7XG5cdFx0XHRcdGN1c3RvbWVyX2lkOiBjdXN0b21lcklkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogcHJvcGVydHlJZCxcblx0XHRcdH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiYXNzaWduIGN1c3RvbWVyIHRvIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyBhY3Rpdml0eVxuXHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JfYWN0aXZpdHlfbG9nXCIpLmluc2VydCh7XG5cdFx0XHRqb2JfaWQ6IGpvYklkLFxuXHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0dXNlcl9pZDogdXNlci5pZCxcblx0XHRcdGFjdGl2aXR5X3R5cGU6IFwiYXNzaWduZWRcIixcblx0XHRcdGVudGl0eV90eXBlOiBcImN1c3RvbWVyXCIsXG5cdFx0XHRkZXNjcmlwdGlvbjogYEFzc2lnbmVkIGN1c3RvbWVyJHtwcm9wZXJ0eUlkID8gXCIgYW5kIHByb3BlcnR5XCIgOiBcIlwifWAsXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IHByb3BlcnR5SWQsXG5cdFx0XHR9LFxuXHRcdH0pO1xuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL3dlbGNvbWVcIik7XG5cdH0pO1xufVxuXG4vKipcbiAqIFJlbW92ZSBDdXN0b21lciBhbmQgUHJvcGVydHkgZnJvbSBKb2JcbiAqXG4gKiBSZW1vdmVzIHRoZSBjdXN0b21lcl9pZCBhbmQgcHJvcGVydHlfaWQgZnJvbSB0aGUgam9iLlxuICogUmVsYXRlZCBkYXRhIChhcHBvaW50bWVudHMsIGludm9pY2VzLCBldGMuKSByZW1haW4gYnV0IGFyZSBubyBsb25nZXIgbGlua2VkLlxuICpcbiAqIEBwYXJhbSBqb2JJZCAtIEpvYiBJRFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVtb3ZlQ3VzdG9tZXJGcm9tSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJjb21wYW55IGFjY2Vzc1wiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogam9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiaWQsIGNvbXBhbnlfaWQsIGN1c3RvbWVyX2lkLCBwcm9wZXJ0eV9pZFwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuZXEoXCJjb21wYW55X2lkXCIsIGNvbXBhbnlJZClcblx0XHRcdC5pcyhcImRlbGV0ZWRfYXRcIiwgbnVsbClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0Ly8gVXBkYXRlIGpvYiB0byByZW1vdmUgY3VzdG9tZXIgYW5kIHByb3BlcnR5XG5cdFx0Y29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRjdXN0b21lcl9pZDogbnVsbCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IG51bGwsXG5cdFx0XHR9KVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpO1xuXG5cdFx0aWYgKHVwZGF0ZUVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcInJlbW92ZSBjdXN0b21lciBmcm9tIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyBhY3Rpdml0eVxuXHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JfYWN0aXZpdHlfbG9nXCIpLmluc2VydCh7XG5cdFx0XHRqb2JfaWQ6IGpvYklkLFxuXHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0dXNlcl9pZDogdXNlci5pZCxcblx0XHRcdGFjdGl2aXR5X3R5cGU6IFwicmVtb3ZlZFwiLFxuXHRcdFx0ZW50aXR5X3R5cGU6IFwiY3VzdG9tZXJcIixcblx0XHRcdGRlc2NyaXB0aW9uOiBcIlJlbW92ZWQgY3VzdG9tZXIgYW5kIHByb3BlcnR5XCIsXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRwcmV2aW91c19jdXN0b21lcl9pZDogam9iLmN1c3RvbWVyX2lkLFxuXHRcdFx0XHRwcmV2aW91c19wcm9wZXJ0eV9pZDogam9iLnByb3BlcnR5X2lkLFxuXHRcdFx0fSxcblx0XHR9KTtcblxuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi93ZWxjb21lXCIpO1xuXHR9KTtcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiK1JBNlBzQiJ9
}),
"[project]/apps/web/src/actions/data:0bef0a [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"605015006d70a49e85a0cf785b36537fbfc8a9e306":"updateJob"},"apps/web/src/actions/jobs.ts",""] */ __turbopack_context__.s([
    "updateJob",
    ()=>updateJob
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next@16.0.4_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
"use turbopack no side effects";
;
var updateJob = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("605015006d70a49e85a0cf785b36537fbfc8a9e306", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "updateJob"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vam9icy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEpvYnMgU2VydmVyIEFjdGlvbnMgLSBSRUZBQ1RPUkVEIEZPUiBET01BSU4gVEFCTEUgU1RSVUNUVVJFXG4gKlxuICogSGFuZGxlcyBqb2Ivd29yayBvcmRlciBtYW5hZ2VtZW50IHdpdGggY29tcHJlaGVuc2l2ZSBDUlVEIG9wZXJhdGlvbnMsXG4gKiBzdGF0dXMgdHJhbnNpdGlvbnMsIHNjaGVkdWxpbmcsIGFuZCBhc3NpZ25tZW50IGxvZ2ljLlxuICpcbiAqIE1JR1JBVElPTiBOT1RFUzpcbiAqIC0gQ29yZSBqb2JzIHRhYmxlIG5vdyBoYXMgfjIwIGNvbHVtbnNcbiAqIC0gRG9tYWluLXNwZWNpZmljIGRhdGEgbW92ZWQgdG8gMTEgZG9tYWluIHRhYmxlc1xuICogLSBGaW5hbmNpYWwgZGF0YSAtPiBqb2JfZmluYW5jaWFsXG4gKiAtIFRpbWUgdHJhY2tpbmcgLT4gam9iX3RpbWVfdHJhY2tpbmdcbiAqIC0gQXJjaGl2ZS9kZWxldGlvbiAtPiBqb2JfbXVsdGlfZW50aXR5XG4gKiAtIEFsbCBkb21haW4gdGFibGVzIGhhdmUgQ0FTQ0FERSBkZWxldGUgb24gam9iX2lkXG4gKi9cblxuXCJ1c2Ugc2VydmVyXCI7XG5cbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5pbXBvcnQgeyBnZXRBY3RpdmVDb21wYW55SWQgfSBmcm9tIFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIjtcbmltcG9ydCB7XG5cdEFjdGlvbkVycm9yLFxuXHRFUlJPUl9DT0RFUyxcblx0RVJST1JfTUVTU0FHRVMsXG59IGZyb20gXCJAL2xpYi9lcnJvcnMvYWN0aW9uLWVycm9yXCI7XG5pbXBvcnQge1xuXHR0eXBlIEFjdGlvblJlc3VsdCxcblx0YXNzZXJ0QXV0aGVudGljYXRlZCxcblx0YXNzZXJ0RXhpc3RzLFxuXHR3aXRoRXJyb3JIYW5kbGluZyxcbn0gZnJvbSBcIkAvbGliL2Vycm9ycy93aXRoLWVycm9yLWhhbmRsaW5nXCI7XG5pbXBvcnQgeyBub3RpZnlKb2JDcmVhdGVkIH0gZnJvbSBcIkAvbGliL25vdGlmaWNhdGlvbnMvdHJpZ2dlcnNcIjtcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAL2xpYi9zdXBhYmFzZS9zZXJ2ZXJcIjtcbmltcG9ydCB7XG5cdHR5cGUgSm9iU3RhdHVzLFxuXHR0eXBlIEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0LFxuXHR2YWxpZGF0ZVN0YXR1c1RyYW5zaXRpb24sXG59IGZyb20gXCJAL2xpYi92YWxpZGF0aW9ucy9qb2Itc3RhdHVzLXRyYW5zaXRpb25zXCI7XG5cbi8vIFJlZ2V4IGNvbnN0YW50c1xuY29uc3QgSk9CX05VTUJFUl9SRUdFWCA9IC9KT0ItXFxkezR9LShcXGQrKS87XG5cbi8vIFZhbGlkYXRpb24gU2NoZW1hc1xuY29uc3QgY3JlYXRlSm9iU2NoZW1hID0gei5vYmplY3Qoe1xuXHRwcm9wZXJ0eUlkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIHByb3BlcnR5IElEXCIpLFxuXHRjdXN0b21lcklkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIGN1c3RvbWVyIElEXCIpLm9wdGlvbmFsKCksXG5cdHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCBcIkpvYiB0aXRsZSBpcyByZXF1aXJlZFwiKSxcblx0ZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblx0cHJpb3JpdHk6IHouZW51bShbXCJsb3dcIiwgXCJtZWRpdW1cIiwgXCJoaWdoXCIsIFwidXJnZW50XCJdKS5kZWZhdWx0KFwibWVkaXVtXCIpLFxuXHRqb2JUeXBlOiB6XG5cdFx0LmVudW0oW1xuXHRcdFx0XCJzZXJ2aWNlXCIsXG5cdFx0XHRcImluc3RhbGxhdGlvblwiLFxuXHRcdFx0XCJyZXBhaXJcIixcblx0XHRcdFwibWFpbnRlbmFuY2VcIixcblx0XHRcdFwiaW5zcGVjdGlvblwiLFxuXHRcdFx0XCJjb25zdWx0YXRpb25cIixcblx0XHRdKVxuXHRcdC5vcHRpb25hbCgpLFxuXHRzY2hlZHVsZWRTdGFydDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRzY2hlZHVsZWRFbmQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblx0YXNzaWduZWRUbzogei5zdHJpbmcoKS51dWlkKFwiSW52YWxpZCB1c2VyIElEXCIpLm9wdGlvbmFsKCksXG5cdG5vdGVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdC8vIEVuaGFuY2VkIHNjaGVkdWxpbmcgZmllbGRzXG5cdGlzUmVjdXJyaW5nOiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuXHRzY2hlZHVsaW5nTW9kZTogei5lbnVtKFtcInNwZWNpZmljXCIsIFwid2luZG93XCJdKS5vcHRpb25hbCgpLFxuXHR0aW1lV2luZG93OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VUeXBlOiB6XG5cdFx0LmVudW0oW1wiZGFpbHlcIiwgXCJ3ZWVrbHlcIiwgXCJiaXdlZWtseVwiLCBcIm1vbnRobHlcIiwgXCJxdWFydGVybHlcIiwgXCJ5ZWFybHlcIl0pXG5cdFx0Lm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VFbmREYXRlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VDb3VudDogei5udW1iZXIoKS5pbnQoKS5taW4oMSkubWF4KDM2NSkub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCB1cGRhdGVKb2JTY2hlbWEgPSB6Lm9iamVjdCh7XG5cdHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCBcIkpvYiB0aXRsZSBpcyByZXF1aXJlZFwiKS5vcHRpb25hbCgpLFxuXHRkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRzdGF0dXM6IHpcblx0XHQuZW51bShbXG5cdFx0XHRcInF1b3RlZFwiLFxuXHRcdFx0XCJzY2hlZHVsZWRcIixcblx0XHRcdFwiaW5fcHJvZ3Jlc3NcIixcblx0XHRcdFwib25faG9sZFwiLFxuXHRcdFx0XCJjb21wbGV0ZWRcIixcblx0XHRcdFwiY2FuY2VsbGVkXCIsXG5cdFx0XHRcImludm9pY2VkXCIsXG5cdFx0XHRcInBhaWRcIixcblx0XHRdKVxuXHRcdC5vcHRpb25hbCgpLFxuXHRwcmlvcml0eTogei5lbnVtKFtcImxvd1wiLCBcIm1lZGl1bVwiLCBcImhpZ2hcIiwgXCJ1cmdlbnRcIl0pLm9wdGlvbmFsKCksXG5cdGpvYlR5cGU6IHpcblx0XHQuZW51bShbXG5cdFx0XHRcInNlcnZpY2VcIixcblx0XHRcdFwiaW5zdGFsbGF0aW9uXCIsXG5cdFx0XHRcInJlcGFpclwiLFxuXHRcdFx0XCJtYWludGVuYW5jZVwiLFxuXHRcdFx0XCJpbnNwZWN0aW9uXCIsXG5cdFx0XHRcImNvbnN1bHRhdGlvblwiLFxuXHRcdF0pXG5cdFx0Lm9wdGlvbmFsKCksXG5cdG5vdGVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdC8vIEZpbmFuY2lhbCBmaWVsZHMgKG5vdyBpbiBqb2JfZmluYW5jaWFsIGRvbWFpbiB0YWJsZSlcblx0dG90YWxBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdHBhaWRBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdGRlcG9zaXRBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdHNjaGVkdWxlZFN0YXJ0OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHNjaGVkdWxlZEVuZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRhc3NpZ25lZFRvOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIHVzZXIgSURcIikub3B0aW9uYWwoKS5udWxsYWJsZSgpLFxuXHRjdXN0b21lcklkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIGN1c3RvbWVyIElEXCIpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcblx0cHJvcGVydHlJZDogei5zdHJpbmcoKS51dWlkKFwiSW52YWxpZCBwcm9wZXJ0eSBJRFwiKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG59KTtcblxuLy8gVHlwZSBmb3IgdXBkYXRlSm9iRGF0YSAtIG1ha2VzIGl0IGVhc2llciB0byB1c2UgcHJvZ3JhbW1hdGljYWxseVxuZXhwb3J0IHR5cGUgVXBkYXRlSm9iRGF0YSA9IHouaW5mZXI8dHlwZW9mIHVwZGF0ZUpvYlNjaGVtYT47XG5cbmNvbnN0IHNjaGVkdWxlSm9iU2NoZW1hID0gei5vYmplY3Qoe1xuXHRzY2hlZHVsZWRTdGFydDogei5zdHJpbmcoKSxcblx0c2NoZWR1bGVkRW5kOiB6LnN0cmluZygpLFxufSk7XG5cbi8qKlxuICogR2VuZXJhdGUgdW5pcXVlIGpvYiBudW1iZXJcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVKb2JOdW1iZXIoXG5cdHN1cGFiYXNlOiBhbnksXG5cdGNvbXBhbnlJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxzdHJpbmc+IHtcblx0Ly8gR2V0IHRoZSBsYXRlc3Qgam9iIG51bWJlciBmb3IgdGhpcyBjb21wYW55XG5cdGNvbnN0IHsgZGF0YTogbGF0ZXN0Sm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdC5zZWxlY3QoXCJqb2JfbnVtYmVyXCIpXG5cdFx0LmVxKFwiY29tcGFueV9pZFwiLCBjb21wYW55SWQpXG5cdFx0Lm9yZGVyKFwiY3JlYXRlZF9hdFwiLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcblx0XHQubGltaXQoMSlcblx0XHQuc2luZ2xlKCk7XG5cblx0aWYgKCFsYXRlc3RKb2IpIHtcblx0XHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tMDAxYDtcblx0fVxuXG5cdC8vIEV4dHJhY3QgbnVtYmVyIGZyb20gZm9ybWF0OiBKT0ItWVlZWS1OTk5cblx0Y29uc3QgbWF0Y2ggPSBsYXRlc3RKb2Iuam9iX251bWJlci5tYXRjaChKT0JfTlVNQkVSX1JFR0VYKTtcblx0aWYgKG1hdGNoKSB7XG5cdFx0Y29uc3QgbmV4dE51bWJlciA9IE51bWJlci5wYXJzZUludChtYXRjaFsxXSwgMTApICsgMTtcblx0XHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tJHtuZXh0TnVtYmVyLnRvU3RyaW5nKCkucGFkU3RhcnQoMywgXCIwXCIpfWA7XG5cdH1cblxuXHQvLyBGYWxsYmFja1xuXHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tJHtEYXRlLm5vdygpLnRvU3RyaW5nKCkuc2xpY2UoLTMpfWA7XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIG5leHQgcmVjdXJyZW5jZSBkYXRlXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZU5leHRSZWN1cnJlbmNlKFxuXHRjdXJyZW50RGF0ZTogRGF0ZSxcblx0cmVjdXJyZW5jZVR5cGU6IHN0cmluZyxcbik6IERhdGUge1xuXHRjb25zdCBuZXh0RGF0ZSA9IG5ldyBEYXRlKGN1cnJlbnREYXRlKTtcblxuXHRzd2l0Y2ggKHJlY3VycmVuY2VUeXBlKSB7XG5cdFx0Y2FzZSBcImRhaWx5XCI6XG5cdFx0XHRuZXh0RGF0ZS5zZXREYXRlKG5leHREYXRlLmdldERhdGUoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcIndlZWtseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RGF0ZShuZXh0RGF0ZS5nZXREYXRlKCkgKyA3KTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgXCJiaXdlZWtseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RGF0ZShuZXh0RGF0ZS5nZXREYXRlKCkgKyAxNCk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlIFwibW9udGhseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0TW9udGgobmV4dERhdGUuZ2V0TW9udGgoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcInF1YXJ0ZXJseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0TW9udGgobmV4dERhdGUuZ2V0TW9udGgoKSArIDMpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcInllYXJseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RnVsbFllYXIobmV4dERhdGUuZ2V0RnVsbFllYXIoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0ZGVmYXVsdDpcblx0XHRcdC8vIERlZmF1bHQgdG8gbW9udGhseSBpZiB1bmtub3duIHR5cGVcblx0XHRcdG5leHREYXRlLnNldE1vbnRoKG5leHREYXRlLmdldE1vbnRoKCkgKyAxKTtcblx0XHRcdGJyZWFrO1xuXHR9XG5cblx0cmV0dXJuIG5leHREYXRlO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZWN1cnJpbmcgam9ic1xuICovXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVSZWN1cnJpbmdKb2JzKFxuXHRzdXBhYmFzZTogYW55LFxuXHRjb21wYW55SWQ6IHN0cmluZyxcblx0YmFzZUpvYjogYW55LFxuXHRyZWN1cnJlbmNlVHlwZTogc3RyaW5nLFxuXHRyZWN1cnJlbmNlRW5kRGF0ZT86IHN0cmluZyxcblx0cmVjdXJyZW5jZUNvdW50PzogbnVtYmVyLFxuKTogUHJvbWlzZTx2b2lkPiB7XG5cdGlmICghYmFzZUpvYi5zY2hlZHVsZWRfc3RhcnQpIHtcblx0XHRyZXR1cm47IC8vIENhbid0IGNyZWF0ZSByZWN1cnJpbmcgam9icyB3aXRob3V0IGEgc3RhcnQgZGF0ZVxuXHR9XG5cblx0Y29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoYmFzZUpvYi5zY2hlZHVsZWRfc3RhcnQpO1xuXHRjb25zdCBlbmREYXRlID0gbmV3IERhdGUoYmFzZUpvYi5zY2hlZHVsZWRfZW5kIHx8IGJhc2VKb2Iuc2NoZWR1bGVkX3N0YXJ0KTtcblx0Y29uc3QgZHVyYXRpb24gPSBlbmREYXRlLmdldFRpbWUoKSAtIHN0YXJ0RGF0ZS5nZXRUaW1lKCk7XG5cblx0Ly8gRGV0ZXJtaW5lIGhvdyBtYW55IG9jY3VycmVuY2VzIHRvIGNyZWF0ZVxuXHRjb25zdCBtYXhPY2N1cnJlbmNlcyA9IHJlY3VycmVuY2VDb3VudCB8fCA1MjsgLy8gRGVmYXVsdCB0byAxIHllYXIgb2Ygd2Vla2x5IGpvYnNcblx0Y29uc3QgZW5kRGF0ZUxpbWl0ID0gcmVjdXJyZW5jZUVuZERhdGUgPyBuZXcgRGF0ZShyZWN1cnJlbmNlRW5kRGF0ZSkgOiBudWxsO1xuXG5cdGNvbnN0IHJlY3VycmluZ0pvYnM6ICh0eXBlb2YgYmFzZUpvYilbXSA9IFtdO1xuXHRsZXQgY3VycmVudERhdGUgPSBuZXcgRGF0ZShzdGFydERhdGUpO1xuXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgbWF4T2NjdXJyZW5jZXMgLSAxOyBpKyspIHtcblx0XHQvLyAtMSBiZWNhdXNlIHdlIGFscmVhZHkgY3JlYXRlZCB0aGUgZmlyc3Qgam9iXG5cdFx0Y3VycmVudERhdGUgPSBjYWxjdWxhdGVOZXh0UmVjdXJyZW5jZShjdXJyZW50RGF0ZSwgcmVjdXJyZW5jZVR5cGUpO1xuXG5cdFx0Ly8gU3RvcCBpZiB3ZSd2ZSByZWFjaGVkIHRoZSBlbmQgZGF0ZVxuXHRcdGlmIChlbmREYXRlTGltaXQgJiYgY3VycmVudERhdGUgPiBlbmREYXRlTGltaXQpIHtcblx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdGNvbnN0IGN1cnJlbnRFbmREYXRlID0gbmV3IERhdGUoY3VycmVudERhdGUuZ2V0VGltZSgpICsgZHVyYXRpb24pO1xuXG5cdFx0Ly8gR2VuZXJhdGUgYSB1bmlxdWUgam9iIG51bWJlciBmb3IgdGhpcyBvY2N1cnJlbmNlXG5cdFx0Y29uc3Qgam9iTnVtYmVyID0gYXdhaXQgZ2VuZXJhdGVKb2JOdW1iZXIoc3VwYWJhc2UsIGNvbXBhbnlJZCk7XG5cblx0XHRyZWN1cnJpbmdKb2JzLnB1c2goe1xuXHRcdFx0Li4uYmFzZUpvYixcblx0XHRcdGpvYl9udW1iZXI6IGpvYk51bWJlcixcblx0XHRcdHNjaGVkdWxlZF9zdGFydDogY3VycmVudERhdGUudG9JU09TdHJpbmcoKSxcblx0XHRcdHNjaGVkdWxlZF9lbmQ6IGN1cnJlbnRFbmREYXRlLnRvSVNPU3RyaW5nKCksXG5cdFx0XHR0aXRsZTogYCR7YmFzZUpvYi50aXRsZX0gKCR7aSArIDJ9LyR7bWF4T2NjdXJyZW5jZXN9KWAsIC8vIEFkZCBvY2N1cnJlbmNlIG51bWJlclxuXHRcdH0pO1xuXG5cdFx0Ly8gQ3JlYXRlIGpvYnMgaW4gYmF0Y2hlcyBvZiAxMCB0byBhdm9pZCBtZW1vcnkgaXNzdWVzXG5cdFx0aWYgKHJlY3VycmluZ0pvYnMubGVuZ3RoID49IDEwKSB7XG5cdFx0XHRhd2FpdCBzdXBhYmFzZS5mcm9tKFwiam9ic1wiKS5pbnNlcnQocmVjdXJyaW5nSm9icyk7XG5cdFx0XHRyZWN1cnJpbmdKb2JzLmxlbmd0aCA9IDA7IC8vIENsZWFyIGFycmF5XG5cdFx0fVxuXHR9XG5cblx0Ly8gSW5zZXJ0IGFueSByZW1haW5pbmcgam9ic1xuXHRpZiAocmVjdXJyaW5nSm9icy5sZW5ndGggPiAwKSB7XG5cdFx0YXdhaXQgc3VwYWJhc2UuZnJvbShcImpvYnNcIikuaW5zZXJ0KHJlY3VycmluZ0pvYnMpO1xuXHR9XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgbmV3IGpvYlxuICog4pyFIEFMUkVBRFkgTUlHUkFURUQgLSBDcmVhdGVzIGNvcmUgam9iICsgYWxsIDEwIGRvbWFpbiByZWNvcmRzIGluIHBhcmFsbGVsXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVKb2IoXG5cdGZvcm1EYXRhOiBGb3JtRGF0YSxcbik6IFByb21pc2U8QWN0aW9uUmVzdWx0PHN0cmluZz4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSBjcmVhdGVKb2JTY2hlbWEucGFyc2Uoe1xuXHRcdFx0cHJvcGVydHlJZDogZm9ybURhdGEuZ2V0KFwicHJvcGVydHlJZFwiKSxcblx0XHRcdGN1c3RvbWVySWQ6IGZvcm1EYXRhLmdldChcImN1c3RvbWVySWRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0dGl0bGU6IGZvcm1EYXRhLmdldChcInRpdGxlXCIpLFxuXHRcdFx0ZGVzY3JpcHRpb246IGZvcm1EYXRhLmdldChcImRlc2NyaXB0aW9uXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdHByaW9yaXR5OiBmb3JtRGF0YS5nZXQoXCJwcmlvcml0eVwiKSB8fCBcIm1lZGl1bVwiLFxuXHRcdFx0am9iVHlwZTogZm9ybURhdGEuZ2V0KFwiam9iVHlwZVwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRzY2hlZHVsZWRTdGFydDogZm9ybURhdGEuZ2V0KFwic2NoZWR1bGVkU3RhcnRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0c2NoZWR1bGVkRW5kOiBmb3JtRGF0YS5nZXQoXCJzY2hlZHVsZWRFbmRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0YXNzaWduZWRUbzogZm9ybURhdGEuZ2V0KFwiYXNzaWduZWRUb1wiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRub3RlczogZm9ybURhdGEuZ2V0KFwibm90ZXNcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0Ly8gRW5oYW5jZWQgc2NoZWR1bGluZyBmaWVsZHNcblx0XHRcdGlzUmVjdXJyaW5nOiBmb3JtRGF0YS5nZXQoXCJpc1JlY3VycmluZ1wiKSA9PT0gXCJ0cnVlXCIsXG5cdFx0XHRzY2hlZHVsaW5nTW9kZTogKGZvcm1EYXRhLmdldChcInNjaGVkdWxpbmdNb2RlXCIpIGFzIGFueSkgfHwgdW5kZWZpbmVkLFxuXHRcdFx0dGltZVdpbmRvdzogZm9ybURhdGEuZ2V0KFwidGltZVdpbmRvd1wiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRyZWN1cnJlbmNlVHlwZTogKGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VUeXBlXCIpIGFzIGFueSkgfHwgdW5kZWZpbmVkLFxuXHRcdFx0cmVjdXJyZW5jZUVuZERhdGU6IGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VFbmREYXRlXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdHJlY3VycmVuY2VDb3VudDogZm9ybURhdGEuZ2V0KFwicmVjdXJyZW5jZUNvdW50XCIpXG5cdFx0XHRcdD8gTnVtYmVyLnBhcnNlSW50KGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VDb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHR9KTtcblxuXHRcdC8vIFZlcmlmeSBwcm9wZXJ0eSBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IHByb3BlcnR5IH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJwcm9wZXJ0aWVzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgY3VzdG9tZXJfaWQsIGFkZHJlc3NcIilcblx0XHRcdC5lcShcImlkXCIsIGRhdGEucHJvcGVydHlJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhwcm9wZXJ0eSwgXCJQcm9wZXJ0eVwiKTtcblxuXHRcdGlmIChwcm9wZXJ0eS5jb21wYW55X2lkICE9PSBjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwicHJvcGVydHlcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVzZSBjdXN0b21lciBmcm9tIHByb3BlcnR5IGlmIG5vdCBwcm92aWRlZFxuXHRcdGNvbnN0IGN1c3RvbWVySWQgPSBkYXRhLmN1c3RvbWVySWQgfHwgcHJvcGVydHkuY3VzdG9tZXJfaWQ7XG5cblx0XHQvLyBHZW5lcmF0ZSB1bmlxdWUgam9iIG51bWJlclxuXHRcdGNvbnN0IGpvYk51bWJlciA9IGF3YWl0IGdlbmVyYXRlSm9iTnVtYmVyKHN1cGFiYXNlLCBjb21wYW55SWQpO1xuXG5cdFx0Ly8gQWRkIHRpbWUgd2luZG93IGluZm8gdG8gbm90ZXMgaWYgYXBwbGljYWJsZVxuXHRcdGxldCBqb2JOb3RlcyA9IGRhdGEubm90ZXMgfHwgXCJcIjtcblx0XHRpZiAoZGF0YS5zY2hlZHVsaW5nTW9kZSA9PT0gXCJ3aW5kb3dcIiAmJiBkYXRhLnRpbWVXaW5kb3cpIHtcblx0XHRcdGNvbnN0IHdpbmRvd0luZm8gPSBgXFxuXFxuW1NjaGVkdWxpbmddIEN1c3RvbWVyIHByZWZlcnJlZCB0aW1lIHdpbmRvdzogJHtkYXRhLnRpbWVXaW5kb3cuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBkYXRhLnRpbWVXaW5kb3cuc2xpY2UoMSl9YDtcblx0XHRcdGpvYk5vdGVzID0gam9iTm90ZXMgPyBgJHtqb2JOb3Rlc30ke3dpbmRvd0luZm99YCA6IHdpbmRvd0luZm8udHJpbSgpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBjb3JlIGpvYiByZWNvcmRcblx0XHRjb25zdCB7IGRhdGE6IG5ld0pvYiwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogZGF0YS5wcm9wZXJ0eUlkLFxuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0YXNzaWduZWRfdG86IGRhdGEuYXNzaWduZWRUbyxcblx0XHRcdFx0am9iX251bWJlcjogam9iTnVtYmVyLFxuXHRcdFx0XHR0aXRsZTogZGF0YS50aXRsZSxcblx0XHRcdFx0ZGVzY3JpcHRpb246IGRhdGEuZGVzY3JpcHRpb24sXG5cdFx0XHRcdHN0YXR1czogXCJxdW90ZWRcIixcblx0XHRcdFx0cHJpb3JpdHk6IGRhdGEucHJpb3JpdHksXG5cdFx0XHRcdGpvYl90eXBlOiBkYXRhLmpvYlR5cGUsXG5cdFx0XHRcdHNlcnZpY2VfdHlwZTogZGF0YS5qb2JUeXBlLCAvLyBEZWZhdWx0IHNlcnZpY2VfdHlwZSB0byBqb2JfdHlwZVxuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRub3Rlczogam9iTm90ZXMsXG5cdFx0XHR9KVxuXHRcdFx0LnNlbGVjdChcImlkXCIpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoY3JlYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiY3JlYXRlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBkb21haW4gcmVjb3JkcyAocGFyYWxsZWwgaW5zZXJ0cyBmb3IgcGVyZm9ybWFuY2UpXG5cdFx0Y29uc3QgZG9tYWluSW5zZXJ0cyA9IGF3YWl0IFByb21pc2UuYWxsKFtcblx0XHRcdC8vIEZpbmFuY2lhbCBkb21haW4gLSBhbHdheXMgY3JlYXRlIHdpdGggZGVmYXVsdHNcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2ZpbmFuY2lhbFwiKVxuXHRcdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0XHRqb2JfaWQ6IG5ld0pvYi5pZCxcblx0XHRcdFx0XHRjb21wYW55X2lkOiBjb21wYW55SWQsXG5cdFx0XHRcdFx0dG90YWxfYW1vdW50OiAwLFxuXHRcdFx0XHRcdHBhaWRfYW1vdW50OiAwLFxuXHRcdFx0XHRcdGRlcG9zaXRfYW1vdW50OiAwLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gV29ya2Zsb3cgZG9tYWluIC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2Jfd29ya2Zsb3dcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdHdvcmtmbG93X2NvbXBsZXRlZF9zdGFnZXM6IFtdLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gVGltZSB0cmFja2luZyAtIGFsd2F5cyBjcmVhdGVcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX3RpbWVfdHJhY2tpbmdcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdHRvdGFsX2xhYm9yX2hvdXJzOiAwLFxuXHRcdFx0XHRcdGJyZWFrX3RpbWVfbWludXRlczogMCxcblx0XHRcdFx0fSksXG5cblx0XHRcdC8vIEN1c3RvbWVyIGFwcHJvdmFsIC0gYWx3YXlzIGNyZWF0ZSB3aXRoIHBlbmRpbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2N1c3RvbWVyX2FwcHJvdmFsXCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRjdXN0b21lcl9hcHByb3ZhbF9zdGF0dXM6IFwicGVuZGluZ1wiLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gRXF1aXBtZW50IHNlcnZpY2UgLSBhbHdheXMgY3JlYXRlXG5cdFx0XHRzdXBhYmFzZVxuXHRcdFx0XHQuZnJvbShcImpvYl9lcXVpcG1lbnRfc2VydmljZVwiKVxuXHRcdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0XHRqb2JfaWQ6IG5ld0pvYi5pZCxcblx0XHRcdFx0XHRjb21wYW55X2lkOiBjb21wYW55SWQsXG5cdFx0XHRcdFx0ZXF1aXBtZW50X3NlcnZpY2VfaGlzdG9yeTogW10sXG5cdFx0XHRcdFx0ZXF1aXBtZW50X3NlcnZpY2VkOiBbXSxcblx0XHRcdFx0fSksXG5cblx0XHRcdC8vIERpc3BhdGNoIC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfZGlzcGF0Y2hcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gUXVhbGl0eSAtIGFsd2F5cyBjcmVhdGVcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX3F1YWxpdHlcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdGluc3BlY3Rpb25fcmVxdWlyZWQ6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gU2FmZXR5IC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2Jfc2FmZXR5XCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRyZXF1aXJlc19wZXJtaXQ6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gQUkgZW5yaWNobWVudCAtIGNyZWF0ZSBlbXB0eSBmb3IgZnV0dXJlIHByb2Nlc3Npbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2FpX2VucmljaG1lbnRcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gTXVsdGktZW50aXR5IC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfbXVsdGlfZW50aXR5XCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRyZXF1aXJlc19tdWx0aXBsZV9wcm9wZXJ0aWVzOiBmYWxzZSxcblx0XHRcdFx0XHRyZXF1aXJlc19tdWx0aXBsZV9jdXN0b21lcnM6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBhbnkgZG9tYWluIGluc2VydCBlcnJvcnNcblx0XHRjb25zdCBkb21haW5FcnJvcnMgPSBkb21haW5JbnNlcnRzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuZXJyb3IpO1xuXHRcdGlmIChkb21haW5FcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0Ly8gUm9sbGJhY2sgLSBkZWxldGUgdGhlIGpvYiAoQ0FTQ0FERSB3aWxsIGRlbGV0ZSBkb21haW4gcmVjb3Jkcylcblx0XHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JzXCIpLmRlbGV0ZSgpLmVxKFwiaWRcIiwgbmV3Sm9iLmlkKTtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiY3JlYXRlIGpvYiBkb21haW5zXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQ3JlYXRlIHJlY3VycmluZyBqb2JzIGlmIHJlcXVlc3RlZFxuXHRcdGlmIChkYXRhLmlzUmVjdXJyaW5nICYmIGRhdGEucmVjdXJyZW5jZVR5cGUgJiYgZGF0YS5zY2hlZHVsZWRTdGFydCkge1xuXHRcdFx0Y29uc3QgYmFzZUpvYiA9IHtcblx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogZGF0YS5wcm9wZXJ0eUlkLFxuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0YXNzaWduZWRfdG86IGRhdGEuYXNzaWduZWRUbyxcblx0XHRcdFx0dGl0bGU6IGRhdGEudGl0bGUsXG5cdFx0XHRcdGRlc2NyaXB0aW9uOiBkYXRhLmRlc2NyaXB0aW9uLFxuXHRcdFx0XHRzdGF0dXM6IFwicXVvdGVkXCIsXG5cdFx0XHRcdHByaW9yaXR5OiBkYXRhLnByaW9yaXR5LFxuXHRcdFx0XHRqb2JfdHlwZTogZGF0YS5qb2JUeXBlLFxuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRub3RlczogZGF0YS5ub3Rlcyxcblx0XHRcdH07XG5cblx0XHRcdGF3YWl0IGNyZWF0ZVJlY3VycmluZ0pvYnMoXG5cdFx0XHRcdHN1cGFiYXNlLFxuXHRcdFx0XHRjb21wYW55SWQsXG5cdFx0XHRcdGJhc2VKb2IsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZVR5cGUsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZUVuZERhdGUsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZUNvdW50LFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBTZW5kIG5vdGlmaWNhdGlvbiB0byBhc3NpZ25lZCB1c2VyIGlmIGpvYiBpcyBhc3NpZ25lZFxuXHRcdGlmIChkYXRhLmFzc2lnbmVkVG8gJiYgZGF0YS5hc3NpZ25lZFRvICE9PSB1c2VyLmlkKSB7XG5cdFx0XHRhd2FpdCBub3RpZnlKb2JDcmVhdGVkKHtcblx0XHRcdFx0dXNlcklkOiBkYXRhLmFzc2lnbmVkVG8sXG5cdFx0XHRcdGNvbXBhbnlJZDogY29tcGFueUlkLFxuXHRcdFx0XHRqb2JJZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRqb2JUaXRsZTogZGF0YS50aXRsZSxcblx0XHRcdFx0YWRkcmVzczogcHJvcGVydHkuYWRkcmVzcyB8fCBcIlVua25vd24gYWRkcmVzc1wiLFxuXHRcdFx0XHRwcmlvcml0eTpcblx0XHRcdFx0XHRkYXRhLnByaW9yaXR5ID09PSBcInVyZ2VudFwiXG5cdFx0XHRcdFx0XHQ/IFwidXJnZW50XCJcblx0XHRcdFx0XHRcdDogZGF0YS5wcmlvcml0eSA9PT0gXCJoaWdoXCJcblx0XHRcdFx0XHRcdFx0PyBcImhpZ2hcIlxuXHRcdFx0XHRcdFx0XHQ6IFwibWVkaXVtXCIsXG5cdFx0XHRcdGFjdGlvblVybDogXCIvZGFzaGJvYXJkL3dvcmtcIixcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrL2pvYnNcIik7XG5cdFx0cmV0dXJuIG5ld0pvYi5pZDtcblx0fSk7XG59XG5cbi8qKlxuICogR2V0IGEgc2luZ2xlIGpvYiBieSBJRFxuICog4pyFIEFMUkVBRFkgTUlHUkFURUQgLSBGZXRjaGVzIGpvYiB3aXRoIGFsbCBkb21haW4gZGF0YVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueT4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBqb2Igd2l0aCBiYXNpYyByZWxhdGlvbnNoaXBzXG5cdFx0Ly8gU2ltcGxpZmllZCBxdWVyeSAtIG1hbnkgZG9tYWluIHRhYmxlcyBkb24ndCBleGlzdCB5ZXRcblx0XHRjb25zdCB7IGRhdGE6IGpvYiwgZXJyb3I6IGpvYkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRgXG5cdFx0XHRcdCosXG5cdFx0XHRcdHByb3BlcnR5OnByb3BlcnRpZXMoKiksXG5cdFx0XHRcdGN1c3RvbWVyOmN1c3RvbWVycyFjdXN0b21lcl9pZChpZCwgZmlyc3RfbmFtZSwgbGFzdF9uYW1lLCBlbWFpbCwgcGhvbmUsIGRpc3BsYXlfbmFtZSlcblx0XHRcdGAsXG5cdFx0XHQpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGpvYkVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm5vdEZvdW5kKFwiSm9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9SRUNPUkRfTk9UX0ZPVU5ELFxuXHRcdFx0XHQ0MDQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRpZiAoam9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBqb2I7XG5cdH0pO1xufVxuXG4vKipcbiAqIFVwZGF0ZSBqb2IgZGV0YWlsc1xuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgYm90aCBjb3JlIGpvYnMgdGFibGUgYW5kIGRvbWFpbiB0YWJsZXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYihcblx0am9iSWQ6IHN0cmluZyxcblx0Zm9ybURhdGE6IEZvcm1EYXRhLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IGFjdGl2ZSBjb21wYW55IElEXG5cdFx0Y29uc3QgYWN0aXZlQ29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cdFx0aWYgKCFhY3RpdmVDb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgdXNlcidzIHJvbGUgdG8gY2hlY2sgaWYgdGhleSdyZSBhZG1pbi9vd25lclxuXHRcdGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiY29tcGFueV9tZW1iZXJzaGlwc1wiKVxuXHRcdFx0LnNlbGVjdChcblx0XHRcdFx0YFxuICAgICAgICByb2xlX2lkLFxuICAgICAgICBjdXN0b21fcm9sZXMhcm9sZV9pZChuYW1lLCBpc19zeXN0ZW0pXG4gICAgICBgLFxuXHRcdFx0KVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LmVxKFwiY29tcGFueV9pZFwiLCBhY3RpdmVDb21wYW55SWQpXG5cdFx0XHQuZXEoXCJzdGF0dXNcIiwgXCJhY3RpdmVcIilcblx0XHRcdC5tYXliZVNpbmdsZSgpO1xuXG5cdFx0Y29uc3Qgcm9sZSA9IEFycmF5LmlzQXJyYXkodGVhbU1lbWJlcj8uY3VzdG9tX3JvbGVzKVxuXHRcdFx0PyB0ZWFtTWVtYmVyLmN1c3RvbV9yb2xlc1swXVxuXHRcdFx0OiB0ZWFtTWVtYmVyPy5jdXN0b21fcm9sZXM7XG5cblx0XHRjb25zdCBpc0FkbWluT3JPd25lciA9XG5cdFx0XHRyb2xlPy5uYW1lID09PSBcIkFkbWluXCIgfHxcblx0XHRcdHJvbGU/Lm5hbWUgPT09IFwiT3duZXJcIiB8fFxuXHRcdFx0cm9sZT8uaXNfc3lzdGVtID09PSB0cnVlO1xuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhleGlzdGluZ0pvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoZXhpc3RpbmdKb2IuY29tcGFueV9pZCAhPT0gYWN0aXZlQ29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUHJldmVudCBlZGl0aW5nIGNvbXBsZXRlZCBvciBjYW5jZWxsZWQgam9icyAodW5sZXNzIGFkbWluL293bmVyKVxuXHRcdGlmIChcblx0XHRcdCFpc0FkbWluT3JPd25lciAmJlxuXHRcdFx0KGV4aXN0aW5nSm9iLnN0YXR1cyA9PT0gXCJjb21wbGV0ZWRcIiB8fCBleGlzdGluZ0pvYi5zdGF0dXMgPT09IFwiY2FuY2VsbGVkXCIpXG5cdFx0KSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBDYW5ub3QgZWRpdCAke2V4aXN0aW5nSm9iLnN0YXR1c30gam9ic2AsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgY3VzdG9tZXJJZFZhbHVlID0gZm9ybURhdGEuZ2V0KFwiY3VzdG9tZXJJZFwiKTtcblx0XHRjb25zdCBwcm9wZXJ0eUlkVmFsdWUgPSBmb3JtRGF0YS5nZXQoXCJwcm9wZXJ0eUlkXCIpO1xuXG5cdFx0Ly8gSGFuZGxlIGN1c3RvbWVySWQ6IGVtcHR5IHN0cmluZyBvciBcIm51bGxcIiBzdHJpbmcgbWVhbnMgcmVtb3ZlIChzZXQgdG8gbnVsbClcblx0XHQvLyB1bmRlZmluZWQgbWVhbnMgZG9uJ3QgY2hhbmdlIGl0XG5cdFx0bGV0IHBhcnNlZEN1c3RvbWVySWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG5cdFx0aWYgKGN1c3RvbWVySWRWYWx1ZSA9PT0gbnVsbCB8fCBjdXN0b21lcklkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyc2VkQ3VzdG9tZXJJZCA9IHVuZGVmaW5lZDsgLy8gRG9uJ3QgY2hhbmdlXG5cdFx0fSBlbHNlIGlmIChjdXN0b21lcklkVmFsdWUgPT09IFwiXCIgfHwgY3VzdG9tZXJJZFZhbHVlID09PSBcIm51bGxcIikge1xuXHRcdFx0cGFyc2VkQ3VzdG9tZXJJZCA9IG51bGw7IC8vIFJlbW92ZSBjdXN0b21lclxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJzZWRDdXN0b21lcklkID0gY3VzdG9tZXJJZFZhbHVlIGFzIHN0cmluZzsgLy8gU2V0IHRvIHRoaXMgY3VzdG9tZXJcblx0XHR9XG5cblx0XHQvLyBIYW5kbGUgcHJvcGVydHlJZDogZW1wdHkgc3RyaW5nIG1lYW5zIHJlbW92ZSAoc2V0IHRvIG51bGwpLCB1bmRlZmluZWQgbWVhbnMgZG9uJ3QgY2hhbmdlXG5cdFx0bGV0IHBhcnNlZFByb3BlcnR5SWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG5cdFx0aWYgKHByb3BlcnR5SWRWYWx1ZSA9PT0gbnVsbCB8fCBwcm9wZXJ0eUlkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyc2VkUHJvcGVydHlJZCA9IHVuZGVmaW5lZDsgLy8gRG9uJ3QgY2hhbmdlXG5cdFx0fSBlbHNlIGlmIChwcm9wZXJ0eUlkVmFsdWUgPT09IFwiXCIgfHwgcHJvcGVydHlJZFZhbHVlID09PSBcIm51bGxcIikge1xuXHRcdFx0cGFyc2VkUHJvcGVydHlJZCA9IG51bGw7IC8vIFJlbW92ZSBwcm9wZXJ0eVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJzZWRQcm9wZXJ0eUlkID0gcHJvcGVydHlJZFZhbHVlIGFzIHN0cmluZzsgLy8gU2V0IHRvIHRoaXMgcHJvcGVydHlcblx0XHR9XG5cblx0XHRjb25zdCBkYXRhID0gdXBkYXRlSm9iU2NoZW1hLnBhcnNlKHtcblx0XHRcdHRpdGxlOiBmb3JtRGF0YS5nZXQoXCJ0aXRsZVwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRkZXNjcmlwdGlvbjogZm9ybURhdGEuZ2V0KFwiZGVzY3JpcHRpb25cIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0c3RhdHVzOiBmb3JtRGF0YS5nZXQoXCJzdGF0dXNcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0cHJpb3JpdHk6IGZvcm1EYXRhLmdldChcInByaW9yaXR5XCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdGpvYlR5cGU6IGZvcm1EYXRhLmdldChcImpvYlR5cGVcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0bm90ZXM6IGZvcm1EYXRhLmdldChcIm5vdGVzXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdC8vIEZpbmFuY2lhbCBmaWVsZHMgKG5vdyBpbiBqb2JfZmluYW5jaWFsIGRvbWFpbiB0YWJsZSlcblx0XHRcdHRvdGFsQW1vdW50OiBmb3JtRGF0YS5nZXQoXCJ0b3RhbEFtb3VudFwiKVxuXHRcdFx0XHQ/IE51bWJlci5wYXJzZUludChmb3JtRGF0YS5nZXQoXCJ0b3RhbEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdHBhaWRBbW91bnQ6IGZvcm1EYXRhLmdldChcInBhaWRBbW91bnRcIilcblx0XHRcdFx0PyBOdW1iZXIucGFyc2VJbnQoZm9ybURhdGEuZ2V0KFwicGFpZEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdGRlcG9zaXRBbW91bnQ6IGZvcm1EYXRhLmdldChcImRlcG9zaXRBbW91bnRcIilcblx0XHRcdFx0PyBOdW1iZXIucGFyc2VJbnQoZm9ybURhdGEuZ2V0KFwiZGVwb3NpdEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdHNjaGVkdWxlZFN0YXJ0OiBmb3JtRGF0YS5nZXQoXCJzY2hlZHVsZWRTdGFydFwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRzY2hlZHVsZWRFbmQ6IGZvcm1EYXRhLmdldChcInNjaGVkdWxlZEVuZFwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRhc3NpZ25lZFRvOiBmb3JtRGF0YS5nZXQoXCJhc3NpZ25lZFRvXCIpIHx8IG51bGwsXG5cdFx0XHRjdXN0b21lcklkOiBwYXJzZWRDdXN0b21lcklkLFxuXHRcdFx0cHJvcGVydHlJZDogcGFyc2VkUHJvcGVydHlJZCxcblx0XHR9KTtcblxuXHRcdC8vIElmIHN0YXR1cyBpcyBiZWluZyBjaGFuZ2VkLCB2YWxpZGF0ZSB0aGUgdHJhbnNpdGlvblxuXHRcdGlmIChkYXRhLnN0YXR1cyAhPT0gdW5kZWZpbmVkICYmIGRhdGEuc3RhdHVzICE9PSBleGlzdGluZ0pvYi5zdGF0dXMpIHtcblx0XHRcdC8vIEZldGNoIGFkZGl0aW9uYWwgY29udGV4dCBmb3Igc3RhdHVzIHZhbGlkYXRpb25cblx0XHRcdGNvbnN0IHsgZGF0YTogam9iV2l0aENvbnRleHQgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRcdGBcblx0XHRcdFx0XHRpZCxcblx0XHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdFx0c2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRcdHNjaGVkdWxlZF9lbmQsXG5cdFx0XHRcdFx0YXNzaWduZWRfdG8sXG5cdFx0XHRcdFx0Y3VzdG9tZXJfaWQsXG5cdFx0XHRcdFx0cHJvcGVydHlfaWQsXG5cdFx0XHRcdFx0dG90YWxfYW1vdW50LFxuXHRcdFx0XHRcdGludm9pY2VzOmludm9pY2VzKHN0YXR1cywgdG90YWxfYW1vdW50KSxcblx0XHRcdFx0XHRlc3RpbWF0ZXM6ZXN0aW1hdGVzKHN0YXR1cyksXG5cdFx0XHRcdFx0dGVhbV9hc3NpZ25tZW50czpqb2JfdGVhbV9hc3NpZ25tZW50cyh0ZWFtX21lbWJlcl9pZClcblx0XHRcdFx0YCxcblx0XHRcdFx0KVxuXHRcdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRpZiAoam9iV2l0aENvbnRleHQpIHtcblx0XHRcdFx0Y29uc3QgdHJhbnNpdGlvbkNvbnRleHQ6IEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0ID0ge1xuXHRcdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGpvYldpdGhDb250ZXh0LnN0YXR1cyBhcyBKb2JTdGF0dXMsXG5cdFx0XHRcdFx0bmV3U3RhdHVzOiBkYXRhLnN0YXR1cyBhcyBKb2JTdGF0dXMsXG5cdFx0XHRcdFx0am9iOiB7XG5cdFx0XHRcdFx0XHRpZDogam9iV2l0aENvbnRleHQuaWQsXG5cdFx0XHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6XG5cdFx0XHRcdFx0XHRcdGRhdGEuc2NoZWR1bGVkU3RhcnQgfHwgam9iV2l0aENvbnRleHQuc2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRcdFx0c2NoZWR1bGVkX2VuZDogZGF0YS5zY2hlZHVsZWRFbmQgfHwgam9iV2l0aENvbnRleHQuc2NoZWR1bGVkX2VuZCxcblx0XHRcdFx0XHRcdGFzc2lnbmVkX3RvOlxuXHRcdFx0XHRcdFx0XHRkYXRhLmFzc2lnbmVkVG8gIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5hc3NpZ25lZFRvXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5hc3NpZ25lZF90byxcblx0XHRcdFx0XHRcdGN1c3RvbWVyX2lkOlxuXHRcdFx0XHRcdFx0XHRkYXRhLmN1c3RvbWVySWQgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5jdXN0b21lcklkXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5jdXN0b21lcl9pZCxcblx0XHRcdFx0XHRcdHByb3BlcnR5X2lkOlxuXHRcdFx0XHRcdFx0XHRkYXRhLnByb3BlcnR5SWQgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5wcm9wZXJ0eUlkXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5wcm9wZXJ0eV9pZCxcblx0XHRcdFx0XHRcdHRvdGFsX2Ftb3VudDpcblx0XHRcdFx0XHRcdFx0ZGF0YS50b3RhbEFtb3VudCAhPT0gdW5kZWZpbmVkXG5cdFx0XHRcdFx0XHRcdFx0PyBkYXRhLnRvdGFsQW1vdW50XG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC50b3RhbF9hbW91bnQsXG5cdFx0XHRcdFx0XHRpbnZvaWNlczogam9iV2l0aENvbnRleHQuaW52b2ljZXMgfHwgW10sXG5cdFx0XHRcdFx0XHRlc3RpbWF0ZXM6IGpvYldpdGhDb250ZXh0LmVzdGltYXRlcyB8fCBbXSxcblx0XHRcdFx0XHRcdHRlYW1Bc3NpZ25tZW50czogam9iV2l0aENvbnRleHQudGVhbV9hc3NpZ25tZW50cyB8fCBbXSxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSB2YWxpZGF0ZVN0YXR1c1RyYW5zaXRpb24odHJhbnNpdGlvbkNvbnRleHQpO1xuXG5cdFx0XHRcdGlmICghdmFsaWRhdGlvblJlc3VsdC5hbGxvd2VkKSB7XG5cdFx0XHRcdFx0bGV0IGVycm9yTWVzc2FnZSA9XG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlYXNvbiB8fCBcIlN0YXR1cyB0cmFuc2l0aW9uIG5vdCBhbGxvd2VkXCI7XG5cblx0XHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlcXVpcmVkRmllbGRzICYmXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlcXVpcmVkRmllbGRzLmxlbmd0aCA+IDBcblx0XHRcdFx0XHQpIHtcblx0XHRcdFx0XHRcdGVycm9yTWVzc2FnZSArPSBgLiBNaXNzaW5nOiAke3ZhbGlkYXRpb25SZXN1bHQucmVxdWlyZWRGaWVsZHMuam9pbihcIiwgXCIpfWA7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKGVycm9yTWVzc2FnZSwgRVJST1JfQ09ERVMuVkFMSURBVElPTl9GQUlMRUQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gTG9nIHdhcm5pbmdzIGlmIHByZXNlbnQgKG5vbi1ibG9ja2luZylcblx0XHRcdFx0aWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwi4pqg77iPIFN0YXR1cyB0cmFuc2l0aW9uIHdhcm5pbmdzOlwiLCB7XG5cdFx0XHRcdFx0XHRqb2JJZCxcblx0XHRcdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGpvYldpdGhDb250ZXh0LnN0YXR1cyxcblx0XHRcdFx0XHRcdG5ld1N0YXR1czogZGF0YS5zdGF0dXMsXG5cdFx0XHRcdFx0XHR3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIEJ1aWxkIGNvcmUgam9iIHVwZGF0ZSBvYmplY3Qgd2l0aCBvbmx5IGRlZmluZWQgdmFsdWVzXG5cdFx0Y29uc3QgY29yZVVwZGF0ZURhdGE6IGFueSA9IHt9O1xuXHRcdGlmIChkYXRhLnRpdGxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnRpdGxlID0gZGF0YS50aXRsZTtcblx0XHR9XG5cdFx0aWYgKGRhdGEuZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuZGVzY3JpcHRpb24gPSBkYXRhLmRlc2NyaXB0aW9uO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zdGF0dXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuc3RhdHVzID0gZGF0YS5zdGF0dXM7XG5cdFx0fVxuXHRcdGlmIChkYXRhLnByaW9yaXR5ICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnByaW9yaXR5ID0gZGF0YS5wcmlvcml0eTtcblx0XHR9XG5cdFx0aWYgKGRhdGEuam9iVHlwZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb3JlVXBkYXRlRGF0YS5qb2JfdHlwZSA9IGRhdGEuam9iVHlwZTtcblx0XHR9XG5cdFx0aWYgKGRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEubm90ZXMgPSBkYXRhLm5vdGVzO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zY2hlZHVsZWRTdGFydCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb3JlVXBkYXRlRGF0YS5zY2hlZHVsZWRfc3RhcnQgPSBkYXRhLnNjaGVkdWxlZFN0YXJ0O1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zY2hlZHVsZWRFbmQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuc2NoZWR1bGVkX2VuZCA9IGRhdGEuc2NoZWR1bGVkRW5kO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5hc3NpZ25lZFRvICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLmFzc2lnbmVkX3RvID0gZGF0YS5hc3NpZ25lZFRvO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLmN1c3RvbWVyX2lkID0gZGF0YS5jdXN0b21lcklkO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5wcm9wZXJ0eUlkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnByb3BlcnR5X2lkID0gZGF0YS5wcm9wZXJ0eUlkO1xuXHRcdFx0Ly8gSWYgcHJvcGVydHkgaXMgYmVpbmcgc2V0IChub3QgbnVsbCksIHZlcmlmeSBpdCBiZWxvbmdzIHRvIHRoZSBjdXN0b21lciAoaWYgY3VzdG9tZXIgaXMgc2V0KVxuXHRcdFx0aWYgKFxuXHRcdFx0XHRkYXRhLnByb3BlcnR5SWQgIT09IG51bGwgJiZcblx0XHRcdFx0ZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQgJiZcblx0XHRcdFx0ZGF0YS5jdXN0b21lcklkICE9PSBudWxsXG5cdFx0XHQpIHtcblx0XHRcdFx0Y29uc3QgeyBkYXRhOiBwcm9wZXJ0eSB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdFx0XHQuZnJvbShcInByb3BlcnRpZXNcIilcblx0XHRcdFx0XHQuc2VsZWN0KFwiY3VzdG9tZXJfaWRcIilcblx0XHRcdFx0XHQuZXEoXCJpZFwiLCBkYXRhLnByb3BlcnR5SWQpXG5cdFx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRcdGlmIChwcm9wZXJ0eSAmJiBwcm9wZXJ0eS5jdXN0b21lcl9pZCAhPT0gZGF0YS5jdXN0b21lcklkKSB7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcdFx0XCJQcm9wZXJ0eSBkb2VzIG5vdCBiZWxvbmcgdG8gdGhlIHNlbGVjdGVkIGN1c3RvbWVyXCIsXG5cdFx0XHRcdFx0XHRFUlJPUl9DT0RFUy5WQUxJREFUSU9OX0ZBSUxFRCxcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gQnVpbGQgZmluYW5jaWFsIGRvbWFpbiB1cGRhdGUgb2JqZWN0IChpZiBhbnkgZmluYW5jaWFsIGZpZWxkcyBwcm92aWRlZClcblx0XHRjb25zdCBmaW5hbmNpYWxVcGRhdGVEYXRhOiBhbnkgPSB7fTtcblx0XHRpZiAoZGF0YS50b3RhbEFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmaW5hbmNpYWxVcGRhdGVEYXRhLnRvdGFsX2Ftb3VudCA9IGRhdGEudG90YWxBbW91bnQ7XG5cdFx0fVxuXHRcdGlmIChkYXRhLnBhaWRBbW91bnQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0ZmluYW5jaWFsVXBkYXRlRGF0YS5wYWlkX2Ftb3VudCA9IGRhdGEucGFpZEFtb3VudDtcblx0XHR9XG5cdFx0aWYgKGRhdGEuZGVwb3NpdEFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmaW5hbmNpYWxVcGRhdGVEYXRhLmRlcG9zaXRfYW1vdW50ID0gZGF0YS5kZXBvc2l0QW1vdW50O1xuXHRcdH1cblxuXHRcdC8vIEV4ZWN1dGUgdXBkYXRlcyBpbiBwYXJhbGxlbCBmb3IgcGVyZm9ybWFuY2Vcblx0XHRjb25zdCB1cGRhdGVzOiBQcm9taXNlPGFueT5bXSA9IFtdO1xuXG5cdFx0Ly8gVXBkYXRlIGNvcmUgam9iIHRhYmxlIGlmIHRoZXJlIGFyZSBjaGFuZ2VzXG5cdFx0aWYgKE9iamVjdC5rZXlzKGNvcmVVcGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG5cdFx0XHR1cGRhdGVzLnB1c2goXG5cdFx0XHRcdChhc3luYyAoKSA9PiBhd2FpdCBzdXBhYmFzZS5mcm9tKFwiam9ic1wiKS51cGRhdGUoY29yZVVwZGF0ZURhdGEpLmVxKFwiaWRcIiwgam9iSWQpKSgpLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBVcGRhdGUgZmluYW5jaWFsIGRvbWFpbiB0YWJsZSBpZiB0aGVyZSBhcmUgY2hhbmdlc1xuXHRcdGlmIChPYmplY3Qua2V5cyhmaW5hbmNpYWxVcGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG5cdFx0XHR1cGRhdGVzLnB1c2goXG5cdFx0XHRcdChhc3luYyAoKSA9PlxuXHRcdFx0XHRcdGF3YWl0IHN1cGFiYXNlXG5cdFx0XHRcdFx0XHQuZnJvbShcImpvYl9maW5hbmNpYWxcIilcblx0XHRcdFx0XHRcdC51cGRhdGUoZmluYW5jaWFsVXBkYXRlRGF0YSlcblx0XHRcdFx0XHRcdC5lcShcImpvYl9pZFwiLCBqb2JJZCkpKCksXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEV4ZWN1dGUgYWxsIHVwZGF0ZXMgaW4gcGFyYWxsZWxcblx0XHRpZiAodXBkYXRlcy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwodXBkYXRlcyk7XG5cblx0XHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gYW55IHVwZGF0ZVxuXHRcdFx0Y29uc3QgZXJyb3JzID0gcmVzdWx0cy5maWx0ZXIoKHJlc3VsdCkgPT4gcmVzdWx0LmVycm9yKTtcblx0XHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRjb25zdCBlcnJvck1lc3NhZ2VzID0gZXJyb3JzLm1hcCgoZSkgPT4gZS5lcnJvci5tZXNzYWdlKS5qb2luKFwiLCBcIik7XG5cdFx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XHRgJHtFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJ1cGRhdGUgam9iXCIpfTogJHtlcnJvck1lc3NhZ2VzfWAsXG5cdFx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBVcGRhdGUgam9iIHdpdGggZGF0YSBvYmplY3QgKGVhc2llciBmb3IgcHJvZ3JhbW1hdGljIHVzZSlcbiAqIFVzZWQgYnkgam9iIGVkaXRvciBmb3IgaW4tcGxhY2UgdXBkYXRlc1xuICovXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVKb2JEYXRhKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRkYXRhOiBQYXJ0aWFsPFVwZGF0ZUpvYkRhdGE+LFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHQvLyBDb252ZXJ0IGRhdGEgb2JqZWN0IHRvIEZvcm1EYXRhIGZvciBjb21wYXRpYmlsaXR5IHdpdGggZXhpc3RpbmcgdXBkYXRlSm9iXG5cdFx0Y29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcblxuXHRcdC8vIEFkZCBhbGwgZGVmaW5lZCBmaWVsZHMgdG8gRm9ybURhdGFcblx0XHRpZiAoZGF0YS50aXRsZSAhPT0gdW5kZWZpbmVkKSBmb3JtRGF0YS5hcHBlbmQoXCJ0aXRsZVwiLCBkYXRhLnRpdGxlKTtcblx0XHRpZiAoZGF0YS5kZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwiZGVzY3JpcHRpb25cIiwgZGF0YS5kZXNjcmlwdGlvbik7XG5cdFx0aWYgKGRhdGEuc3RhdHVzICE9PSB1bmRlZmluZWQpIGZvcm1EYXRhLmFwcGVuZChcInN0YXR1c1wiLCBkYXRhLnN0YXR1cyk7XG5cdFx0aWYgKGRhdGEucHJpb3JpdHkgIT09IHVuZGVmaW5lZCkgZm9ybURhdGEuYXBwZW5kKFwicHJpb3JpdHlcIiwgZGF0YS5wcmlvcml0eSk7XG5cdFx0aWYgKGRhdGEuam9iVHlwZSAhPT0gdW5kZWZpbmVkKSBmb3JtRGF0YS5hcHBlbmQoXCJqb2JUeXBlXCIsIGRhdGEuam9iVHlwZSk7XG5cdFx0aWYgKGRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkgZm9ybURhdGEuYXBwZW5kKFwibm90ZXNcIiwgZGF0YS5ub3Rlcyk7XG5cdFx0aWYgKGRhdGEudG90YWxBbW91bnQgIT09IHVuZGVmaW5lZClcblx0XHRcdGZvcm1EYXRhLmFwcGVuZChcInRvdGFsQW1vdW50XCIsIGRhdGEudG90YWxBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEucGFpZEFtb3VudCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwicGFpZEFtb3VudFwiLCBkYXRhLnBhaWRBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEuZGVwb3NpdEFtb3VudCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwiZGVwb3NpdEFtb3VudFwiLCBkYXRhLmRlcG9zaXRBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEuc2NoZWR1bGVkU3RhcnQgIT09IHVuZGVmaW5lZClcblx0XHRcdGZvcm1EYXRhLmFwcGVuZChcInNjaGVkdWxlZFN0YXJ0XCIsIGRhdGEuc2NoZWR1bGVkU3RhcnQpO1xuXHRcdGlmIChkYXRhLnNjaGVkdWxlZEVuZCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwic2NoZWR1bGVkRW5kXCIsIGRhdGEuc2NoZWR1bGVkRW5kKTtcblx0XHRpZiAoZGF0YS5hc3NpZ25lZFRvICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJhc3NpZ25lZFRvXCIsIGRhdGEuYXNzaWduZWRUbyB8fCBcIlwiKTtcblx0XHRpZiAoZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJjdXN0b21lcklkXCIsIGRhdGEuY3VzdG9tZXJJZCB8fCBcIlwiKTtcblx0XHRpZiAoZGF0YS5wcm9wZXJ0eUlkICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJwcm9wZXJ0eUlkXCIsIGRhdGEucHJvcGVydHlJZCB8fCBcIlwiKTtcblxuXHRcdC8vIFJldXNlIGV4aXN0aW5nIHVwZGF0ZUpvYiBsb2dpY1xuXHRcdHJldHVybiBhd2FpdCB1cGRhdGVKb2Ioam9iSWQsIGZvcm1EYXRhKTtcblx0fSk7XG59XG5cbi8qKlxuICogVXBkYXRlIGpvYiBzdGF0dXMgd2l0aCB2YWxpZGF0aW9uXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5zdGF0dXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYlN0YXR1cyhcblx0am9iSWQ6IHN0cmluZyxcblx0bmV3U3RhdHVzOiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBjdXJyZW50IHVzZXJcblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmFsaWRhdGUgc3RhdHVzIHZhbHVlXG5cdFx0Y29uc3QgdmFsaWRTdGF0dXNlczogSm9iU3RhdHVzW10gPSBbXG5cdFx0XHRcInF1b3RlZFwiLFxuXHRcdFx0XCJzY2hlZHVsZWRcIixcblx0XHRcdFwiaW5fcHJvZ3Jlc3NcIixcblx0XHRcdFwib25faG9sZFwiLFxuXHRcdFx0XCJjb21wbGV0ZWRcIixcblx0XHRcdFwiY2FuY2VsbGVkXCIsXG5cdFx0XHRcImludm9pY2VkXCIsXG5cdFx0XHRcInBhaWRcIixcblx0XHRdO1xuXHRcdGlmICghdmFsaWRTdGF0dXNlcy5pbmNsdWRlcyhuZXdTdGF0dXMgYXMgSm9iU3RhdHVzKSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkludmFsaWQgam9iIHN0YXR1c1wiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5WQUxJREFUSU9OX0ZBSUxFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gRmV0Y2ggam9iIHdpdGggYWxsIGNvbnRleHQgbmVlZGVkIGZvciB0cmFuc2l0aW9uIHZhbGlkYXRpb25cblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRgXG5cdFx0XHRcdGlkLFxuXHRcdFx0XHRjb21wYW55X2lkLFxuXHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdHNjaGVkdWxlZF9zdGFydCxcblx0XHRcdFx0c2NoZWR1bGVkX2VuZCxcblx0XHRcdFx0YXNzaWduZWRfdG8sXG5cdFx0XHRcdGN1c3RvbWVyX2lkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZCxcblx0XHRcdFx0dG90YWxfYW1vdW50LFxuXHRcdFx0XHRpbnZvaWNlczppbnZvaWNlcyhzdGF0dXMsIHRvdGFsX2Ftb3VudCksXG5cdFx0XHRcdGVzdGltYXRlczplc3RpbWF0ZXMoc3RhdHVzKSxcblx0XHRcdFx0dGVhbV9hc3NpZ25tZW50czpqb2JfdGVhbV9hc3NpZ25tZW50cyh0ZWFtX21lbWJlcl9pZClcblx0XHRcdGAsXG5cdFx0XHQpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhleGlzdGluZ0pvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoZXhpc3RpbmdKb2IuY29tcGFueV9pZCAhPT0gY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQnVpbGQgY29udGV4dCBmb3IgdHJhbnNpdGlvbiB2YWxpZGF0aW9uXG5cdFx0Y29uc3QgdHJhbnNpdGlvbkNvbnRleHQ6IEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0ID0ge1xuXHRcdFx0Y3VycmVudFN0YXR1czogZXhpc3RpbmdKb2Iuc3RhdHVzIGFzIEpvYlN0YXR1cyxcblx0XHRcdG5ld1N0YXR1czogbmV3U3RhdHVzIGFzIEpvYlN0YXR1cyxcblx0XHRcdGpvYjoge1xuXHRcdFx0XHRpZDogZXhpc3RpbmdKb2IuaWQsXG5cdFx0XHRcdHNjaGVkdWxlZF9zdGFydDogZXhpc3RpbmdKb2Iuc2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRzY2hlZHVsZWRfZW5kOiBleGlzdGluZ0pvYi5zY2hlZHVsZWRfZW5kLFxuXHRcdFx0XHRhc3NpZ25lZF90bzogZXhpc3RpbmdKb2IuYXNzaWduZWRfdG8sXG5cdFx0XHRcdGN1c3RvbWVyX2lkOiBleGlzdGluZ0pvYi5jdXN0b21lcl9pZCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IGV4aXN0aW5nSm9iLnByb3BlcnR5X2lkLFxuXHRcdFx0XHR0b3RhbF9hbW91bnQ6IGV4aXN0aW5nSm9iLnRvdGFsX2Ftb3VudCxcblx0XHRcdFx0aW52b2ljZXM6IGV4aXN0aW5nSm9iLmludm9pY2VzIHx8IFtdLFxuXHRcdFx0XHRlc3RpbWF0ZXM6IGV4aXN0aW5nSm9iLmVzdGltYXRlcyB8fCBbXSxcblx0XHRcdFx0dGVhbUFzc2lnbm1lbnRzOiBleGlzdGluZ0pvYi50ZWFtX2Fzc2lnbm1lbnRzIHx8IFtdLFxuXHRcdFx0fSxcblx0XHR9O1xuXG5cdFx0Ly8gVmFsaWRhdGUgdHJhbnNpdGlvbiB3aXRoIGNvbXByZWhlbnNpdmUgYnVzaW5lc3MgcnVsZXNcblx0XHRjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gdmFsaWRhdGVTdGF0dXNUcmFuc2l0aW9uKHRyYW5zaXRpb25Db250ZXh0KTtcblxuXHRcdGlmICghdmFsaWRhdGlvblJlc3VsdC5hbGxvd2VkKSB7XG5cdFx0XHRsZXQgZXJyb3JNZXNzYWdlID1cblx0XHRcdFx0dmFsaWRhdGlvblJlc3VsdC5yZWFzb24gfHwgXCJTdGF0dXMgdHJhbnNpdGlvbiBub3QgYWxsb3dlZFwiO1xuXG5cdFx0XHRpZiAoXG5cdFx0XHRcdHZhbGlkYXRpb25SZXN1bHQucmVxdWlyZWRGaWVsZHMgJiZcblx0XHRcdFx0dmFsaWRhdGlvblJlc3VsdC5yZXF1aXJlZEZpZWxkcy5sZW5ndGggPiAwXG5cdFx0XHQpIHtcblx0XHRcdFx0ZXJyb3JNZXNzYWdlICs9IGAuIE1pc3Npbmc6ICR7dmFsaWRhdGlvblJlc3VsdC5yZXF1aXJlZEZpZWxkcy5qb2luKFwiLCBcIil9YDtcblx0XHRcdH1cblxuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKGVycm9yTWVzc2FnZSwgRVJST1JfQ09ERVMuVkFMSURBVElPTl9GQUlMRUQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyB3YXJuaW5ncyBpZiBwcmVzZW50IChub24tYmxvY2tpbmcpXG5cdFx0aWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCLimqDvuI8gU3RhdHVzIHRyYW5zaXRpb24gd2FybmluZ3M6XCIsIHtcblx0XHRcdFx0am9iSWQsXG5cdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGV4aXN0aW5nSm9iLnN0YXR1cyxcblx0XHRcdFx0bmV3U3RhdHVzLFxuXHRcdFx0XHR3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBzdGF0dXNcblx0XHRjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnVwZGF0ZSh7IHN0YXR1czogbmV3U3RhdHVzIH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwidXBkYXRlIGpvYiBzdGF0dXNcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1FVRVJZX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zb2xlLmxvZyhcIuKchSBKb2Igc3RhdHVzIHVwZGF0ZWQ6XCIsIHtcblx0XHRcdGpvYklkLFxuXHRcdFx0b2xkU3RhdHVzOiBleGlzdGluZ0pvYi5zdGF0dXMsXG5cdFx0XHRuZXdTdGF0dXMsXG5cdFx0fSk7XG5cblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZC93b3JrLyR7am9iSWR9YCk7XG5cdH0pO1xufVxuXG4vKipcbiAqIEFzc2lnbiBqb2IgdG8gYSB0ZWNobmljaWFuXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5hc3NpZ25lZF90b1xuICovXG5hc3luYyBmdW5jdGlvbiBhc3NpZ25Kb2IoXG5cdGpvYklkOiBzdHJpbmcsXG5cdHRlY2huaWNpYW5JZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWRcIilcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0YXNzZXJ0RXhpc3RzKGV4aXN0aW5nSm9iLCBcIkpvYlwiKTtcblxuXHRcdGlmIChleGlzdGluZ0pvYi5jb21wYW55X2lkICE9PSBjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwiam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgdGVjaG5pY2lhbiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IHRlY2huaWNpYW4gfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImNvbXBhbnlfbWVtYmVyc2hpcHNcIilcblx0XHRcdC5zZWxlY3QoXCJ1c2VyX2lkXCIpXG5cdFx0XHQuZXEoXCJ1c2VyX2lkXCIsIHRlY2huaWNpYW5JZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWNobmljaWFuKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiVGVjaG5pY2lhbiBub3QgZm91bmQgaW4geW91ciBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1JFQ09SRF9OT1RfRk9VTkQsXG5cdFx0XHRcdDQwNCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQXNzaWduIGpvYlxuXHRcdGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQudXBkYXRlKHsgYXNzaWduZWRfdG86IHRlY2huaWNpYW5JZCB9KVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpO1xuXG5cdFx0aWYgKHVwZGF0ZUVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImFzc2lnbiBqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1FVRVJZX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZC93b3JrLyR7am9iSWR9YCk7XG5cdH0pO1xufVxuXG4vKipcbiAqIFNjaGVkdWxlIGEgam9iXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icyB0YWJsZSBzY2hlZHVsaW5nIGZpZWxkc1xuICovXG5hc3luYyBmdW5jdGlvbiBzY2hlZHVsZUpvYihcblx0am9iSWQ6IHN0cmluZyxcblx0Zm9ybURhdGE6IEZvcm1EYXRhLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSBzY2hlZHVsZUpvYlNjaGVtYS5wYXJzZSh7XG5cdFx0XHRzY2hlZHVsZWRTdGFydDogZm9ybURhdGEuZ2V0KFwic2NoZWR1bGVkU3RhcnRcIiksXG5cdFx0XHRzY2hlZHVsZWRFbmQ6IGZvcm1EYXRhLmdldChcInNjaGVkdWxlZEVuZFwiKSxcblx0XHR9KTtcblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWQsIHN0YXR1c1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBzY2hlZHVsZSBhbmQgc3RhdHVzXG5cdFx0Y29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRzdGF0dXM6XG5cdFx0XHRcdFx0ZXhpc3RpbmdKb2Iuc3RhdHVzID09PSBcInF1b3RlZFwiID8gXCJzY2hlZHVsZWRcIiA6IGV4aXN0aW5nSm9iLnN0YXR1cyxcblx0XHRcdH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwic2NoZWR1bGUgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0fSk7XG59XG5cbi8qKlxuICogU3RhcnQgYSBqb2JcbiAqIPCflKcgUkVGQUNUT1JFRCAtIE5vdyB1cGRhdGVzIGpvYl90aW1lX3RyYWNraW5nLmFjdHVhbF9zdGFydCBpbnN0ZWFkIG9mIGpvYnMuYWN0dWFsX3N0YXJ0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdGFydEpvYihqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWQsIHN0YXR1c1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbiBvbmx5IHN0YXJ0IHNjaGVkdWxlZCBqb2JzXG5cdFx0aWYgKGV4aXN0aW5nSm9iLnN0YXR1cyAhPT0gXCJzY2hlZHVsZWRcIiAmJiBleGlzdGluZ0pvYi5zdGF0dXMgIT09IFwicXVvdGVkXCIpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgbXVzdCBiZSBzY2hlZHVsZWQgYmVmb3JlIHN0YXJ0aW5nXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuXG5cdFx0Ly8gVXBkYXRlIGJvdGggam9icyB0YWJsZSAoc3RhdHVzKSBhbmQgam9iX3RpbWVfdHJhY2tpbmcgdGFibGUgKGFjdHVhbF9zdGFydCkgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0c3VwYWJhc2UuZnJvbShcImpvYnNcIikudXBkYXRlKHsgc3RhdHVzOiBcImluX3Byb2dyZXNzXCIgfSkuZXEoXCJpZFwiLCBqb2JJZCksXG5cdFx0XHRzdXBhYmFzZVxuXHRcdFx0XHQuZnJvbShcImpvYl90aW1lX3RyYWNraW5nXCIpXG5cdFx0XHRcdC51cGRhdGUoeyBhY3R1YWxfc3RhcnQ6IG5vdyB9KVxuXHRcdFx0XHQuZXEoXCJqb2JfaWRcIiwgam9iSWQpLFxuXHRcdF0pO1xuXG5cdFx0Ly8gQ2hlY2sgZm9yIGVycm9ycyBpbiBlaXRoZXIgdXBkYXRlXG5cdFx0Y29uc3QgZXJyb3JzID0gdXBkYXRlcy5maWx0ZXIoKHJlc3VsdCkgPT4gcmVzdWx0LmVycm9yKTtcblx0XHRpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwic3RhcnQgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBDb21wbGV0ZSBhIGpvYlxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgam9iX3RpbWVfdHJhY2tpbmcuYWN0dWFsX2VuZCBhbmQgY2FsY3VsYXRlcyB0b3RhbF9sYWJvcl9ob3Vyc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29tcGxldGVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHZvaWQ+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IGN1cnJlbnQgdXNlclxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdC8vIEdldCB1c2VyJ3MgYWN0aXZlIGNvbXBhbnkgdXNpbmcgaGVscGVyIChoYW5kbGVzIG11bHRpLWNvbXBhbnkgdXNlcnMpXG5cdFx0Y29uc3QgeyBnZXRBY3RpdmVDb21wYW55SWQgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL2F1dGgvY29tcGFueS1jb250ZXh0XCIpO1xuXHRcdGNvbnN0IGNvbXBhbnlJZCA9IGF3YWl0IGdldEFjdGl2ZUNvbXBhbnlJZCgpO1xuXG5cdFx0aWYgKCFjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGJlbG9uZ3MgdG8gY29tcGFueSBhbmQgZ2V0IHRpbWUgdHJhY2tpbmcgZGF0YVxuXHRcdGNvbnN0IHsgZGF0YTogZXhpc3RpbmdKb2IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkLCBzdGF0dXMsIHRpbWVUcmFja2luZzpqb2JfdGltZV90cmFja2luZygqKVwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbiBvbmx5IGNvbXBsZXRlIGluLXByb2dyZXNzIGpvYnNcblx0XHRpZiAoZXhpc3RpbmdKb2Iuc3RhdHVzICE9PSBcImluX3Byb2dyZXNzXCIpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgbXVzdCBiZSBpbiBwcm9ncmVzcyB0byBjb21wbGV0ZVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcblxuXHRcdC8vIENhbGN1bGF0ZSB0b3RhbCBsYWJvciBob3VycyBpZiB3ZSBoYXZlIGFjdHVhbF9zdGFydFxuXHRcdGNvbnN0IHRpbWVUcmFja2luZyA9IEFycmF5LmlzQXJyYXkoZXhpc3RpbmdKb2IudGltZVRyYWNraW5nKVxuXHRcdFx0PyBleGlzdGluZ0pvYi50aW1lVHJhY2tpbmdbMF1cblx0XHRcdDogZXhpc3RpbmdKb2IudGltZVRyYWNraW5nO1xuXG5cdFx0Y29uc3QgdGltZVRyYWNraW5nVXBkYXRlOiBhbnkgPSB7IGFjdHVhbF9lbmQ6IG5vdyB9O1xuXG5cdFx0aWYgKHRpbWVUcmFja2luZz8uYWN0dWFsX3N0YXJ0KSB7XG5cdFx0XHRjb25zdCBzdGFydFRpbWUgPSBuZXcgRGF0ZSh0aW1lVHJhY2tpbmcuYWN0dWFsX3N0YXJ0KS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBlbmRUaW1lID0gbmV3IERhdGUobm93KS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBob3Vyc1dvcmtlZCA9IChlbmRUaW1lIC0gc3RhcnRUaW1lKSAvICgxMDAwICogNjAgKiA2MCk7IC8vIENvbnZlcnQgbXMgdG8gaG91cnNcblx0XHRcdHRpbWVUcmFja2luZ1VwZGF0ZS50b3RhbF9sYWJvcl9ob3VycyA9IGhvdXJzV29ya2VkO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBib3RoIGpvYnMgdGFibGUgKHN0YXR1cykgYW5kIGpvYl90aW1lX3RyYWNraW5nIHRhYmxlIChhY3R1YWxfZW5kLCB0b3RhbF9sYWJvcl9ob3VycykgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0c3VwYWJhc2UuZnJvbShcImpvYnNcIikudXBkYXRlKHsgc3RhdHVzOiBcImNvbXBsZXRlZFwiIH0pLmVxKFwiaWRcIiwgam9iSWQpLFxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfdGltZV90cmFja2luZ1wiKVxuXHRcdFx0XHQudXBkYXRlKHRpbWVUcmFja2luZ1VwZGF0ZSlcblx0XHRcdFx0LmVxKFwiam9iX2lkXCIsIGpvYklkKSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gZWl0aGVyIHVwZGF0ZVxuXHRcdGNvbnN0IGVycm9ycyA9IHVwZGF0ZXMuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5lcnJvcik7XG5cdFx0aWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImNvbXBsZXRlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0fSk7XG59XG5cbi8qKlxuICogQ2FuY2VsIGEgam9iXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5zdGF0dXMgYW5kIGpvYnMubm90ZXNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gY2FuY2VsSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRyZWFzb24/OiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBjdXJyZW50IHVzZXJcblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzLCBub3Rlc1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbm5vdCBjYW5jZWwgY29tcGxldGVkIGpvYnNcblx0XHRpZiAoZXhpc3RpbmdKb2Iuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiQ2Fubm90IGNhbmNlbCBjb21wbGV0ZWQgam9ic1wiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEFkZCBjYW5jZWxsYXRpb24gcmVhc29uIHRvIG5vdGVzXG5cdFx0Y29uc3QgdXBkYXRlZE5vdGVzID0gcmVhc29uXG5cdFx0XHQ/IGAke2V4aXN0aW5nSm9iLm5vdGVzIHx8IFwiXCJ9XFxuXFxuW0NBTkNFTExFRF06ICR7cmVhc29ufWAudHJpbSgpXG5cdFx0XHQ6IGV4aXN0aW5nSm9iLm5vdGVzO1xuXG5cdFx0Ly8gQ2FuY2VsIGpvYlxuXHRcdGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0c3RhdHVzOiBcImNhbmNlbGxlZFwiLFxuXHRcdFx0XHRub3RlczogdXBkYXRlZE5vdGVzLFxuXHRcdFx0fSlcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKTtcblxuXHRcdGlmICh1cGRhdGVFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJjYW5jZWwgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBTZWFyY2ggam9icyB3aXRoIGZ1bGwtdGV4dCBzZWFyY2ggYW5kIHJhbmtpbmdcbiAqIOKchSBOTyBDSEFOR0VTIE5FRURFRCAtIE9ubHkgc2VhcmNoZXMgam9icyB0YWJsZVxuICovXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hKb2JzKFxuXHRzZWFyY2hUZXJtOiBzdHJpbmcsXG5cdG9wdGlvbnM/OiB7IGxpbWl0PzogbnVtYmVyOyBvZmZzZXQ/OiBudW1iZXIgfSxcbik6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueVtdPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiY29tcGFueV9tZW1iZXJzaGlwc1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWRcIilcblx0XHRcdC5lcShcInVzZXJfaWRcIiwgdXNlci5pZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGlmICghdGVhbU1lbWJlcj8uY29tcGFueV9pZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVzZSBmdWxsLXRleHQgc2VhcmNoIHdpdGggcmFua2luZyBmb3IgYmVzdCBtYXRjaGVzXG5cdFx0Y29uc3QgeyBzZWFyY2hKb2JzRnVsbFRleHQgfSA9IGF3YWl0IGltcG9ydChcblx0XHRcdFwiQC9saWIvc2VhcmNoL2Z1bGwtdGV4dC1zZWFyY2hcIlxuXHRcdCk7XG5cblx0XHRjb25zdCBqb2JzID0gYXdhaXQgc2VhcmNoSm9ic0Z1bGxUZXh0KHN1cGFiYXNlLCB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQsIHNlYXJjaFRlcm0sIHtcblx0XHRcdGxpbWl0OiBvcHRpb25zPy5saW1pdCB8fCA1MCxcblx0XHRcdG9mZnNldDogb3B0aW9ucz8ub2Zmc2V0IHx8IDAsXG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gam9icztcblx0fSk7XG59XG5cbi8qKlxuICogVW5pdmVyc2FsIHNlYXJjaCBhY3Jvc3MgYWxsIGVudGl0aWVzXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHNlYXJjaGVzIGpvYnMgdGFibGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2VhcmNoQWxsKFxuXHRzZWFyY2hUZXJtOiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDxhbnk+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Y29uc3QgeyBkYXRhOiB0ZWFtTWVtYmVyIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjb21wYW55X21lbWJlcnNoaXBzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWFtTWVtYmVyPy5jb21wYW55X2lkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVXNlIHVuaXZlcnNhbCBzZWFyY2ggUlBDIGZ1bmN0aW9uXG5cdFx0Y29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UucnBjKFwic2VhcmNoX2FsbF9lbnRpdGllc1wiLCB7XG5cdFx0XHRjb21wYW55X2lkX3BhcmFtOiB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQsXG5cdFx0XHRzZWFyY2hfcXVlcnk6IHNlYXJjaFRlcm0sXG5cdFx0XHRwZXJfZW50aXR5X2xpbWl0OiA1LFxuXHRcdH0pO1xuXG5cdFx0aWYgKGVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcInNlYXJjaFwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBkYXRhO1xuXHR9KTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSk9CIEFSQ0hJVkUgJiBSRVNUT1JFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogQXJjaGl2ZSBqb2IgKHNvZnQgZGVsZXRlKVxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgam9iX211bHRpX2VudGl0eS5kZWxldGVkX2J5IGFuZCBwZXJtYW5lbnRfZGVsZXRlX3NjaGVkdWxlZF9hdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXJjaGl2ZUpvYihqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHRjb25zdCB7IGRhdGE6IHRlYW1NZW1iZXIgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImNvbXBhbnlfbWVtYmVyc2hpcHNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJ1c2VyX2lkXCIsIHVzZXIuaWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoIXRlYW1NZW1iZXI/LmNvbXBhbnlfaWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogam9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGpvYi5jb21wYW55X2lkICE9PSB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwiam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBDYW5ub3QgYXJjaGl2ZSBjb21wbGV0ZWQvcGFpZCBqb2JzIChidXNpbmVzcyBydWxlKVxuXHRcdGlmIChqb2Iuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiIHx8IGpvYi5zdGF0dXMgPT09IFwiaW52b2ljZWRcIikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkNhbm5vdCBhcmNoaXZlIGNvbXBsZXRlZCBvciBpbnZvaWNlZCBqb2JzLiBUaGVzZSBtdXN0IGJlIHJldGFpbmVkIGZvciByZWNvcmRzLlwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEFyY2hpdmUgam9iIChzb2Z0IGRlbGV0ZSlcblx0XHRjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG5cdFx0Y29uc3Qgc2NoZWR1bGVkRGVsZXRpb24gPSBuZXcgRGF0ZShcblx0XHRcdERhdGUubm93KCkgKyA5MCAqIDI0ICogNjAgKiA2MCAqIDEwMDAsXG5cdFx0KS50b0lTT1N0cmluZygpO1xuXG5cdFx0Ly8gVXBkYXRlIGJvdGggam9icyB0YWJsZSBhbmQgam9iX211bHRpX2VudGl0eSB0YWJsZSBpbiBwYXJhbGxlbFxuXHRcdGNvbnN0IHVwZGF0ZXMgPSBhd2FpdCBQcm9taXNlLmFsbChbXG5cdFx0XHQvLyBVcGRhdGUgY29yZSBqb2JzIHRhYmxlIHdpdGggYXJjaGl2ZSBtZXRhZGF0YVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRcdGRlbGV0ZWRfYXQ6IG5vdyxcblx0XHRcdFx0XHRhcmNoaXZlZF9hdDogbm93LFxuXHRcdFx0XHRcdHN0YXR1czogXCJhcmNoaXZlZFwiLFxuXHRcdFx0XHR9KVxuXHRcdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCksXG5cblx0XHRcdC8vIFVwZGF0ZSBqb2JfbXVsdGlfZW50aXR5IHRhYmxlIHdpdGggZGVsZXRpb24gdHJhY2tpbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX211bHRpX2VudGl0eVwiKVxuXHRcdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0XHRkZWxldGVkX2J5OiB1c2VyLmlkLFxuXHRcdFx0XHRcdHBlcm1hbmVudF9kZWxldGVfc2NoZWR1bGVkX2F0OiBzY2hlZHVsZWREZWxldGlvbixcblx0XHRcdFx0fSlcblx0XHRcdFx0LmVxKFwiam9iX2lkXCIsIGpvYklkKSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gZWl0aGVyIHVwZGF0ZVxuXHRcdGNvbnN0IGVycm9ycyA9IHVwZGF0ZXMuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5lcnJvcik7XG5cdFx0aWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImFyY2hpdmUgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9zZXR0aW5ncy9hcmNoaXZlXCIpO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBSZXN0b3JlIGFyY2hpdmVkIGpvYlxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IGNsZWFycyBqb2JfbXVsdGlfZW50aXR5LmRlbGV0ZWRfYnkgYW5kIHBlcm1hbmVudF9kZWxldGVfc2NoZWR1bGVkX2F0XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlc3RvcmVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHZvaWQ+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Y29uc3QgeyBkYXRhOiB0ZWFtTWVtYmVyIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjb21wYW55X21lbWJlcnNoaXBzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWFtTWVtYmVyPy5jb21wYW55X2lkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnkgYW5kIGlzIGFyY2hpdmVkXG5cdFx0Y29uc3QgeyBkYXRhOiBqb2IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkLCBkZWxldGVkX2F0LCBzdGF0dXNcIilcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0YXNzZXJ0RXhpc3RzKGpvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoam9iLmNvbXBhbnlfaWQgIT09IHRlYW1NZW1iZXIuY29tcGFueV9pZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmICgham9iLmRlbGV0ZWRfYXQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgaXMgbm90IGFyY2hpdmVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmVzdG9yZSBqb2IgLSB1cGRhdGUgYm90aCB0YWJsZXMgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0Ly8gQ2xlYXIgY29yZSBqb2JzIHRhYmxlIGFyY2hpdmUgbWV0YWRhdGFcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0XHRkZWxldGVkX2F0OiBudWxsLFxuXHRcdFx0XHRcdGFyY2hpdmVkX2F0OiBudWxsLFxuXHRcdFx0XHRcdHN0YXR1czogam9iLnN0YXR1cyA9PT0gXCJhcmNoaXZlZFwiID8gXCJzY2hlZHVsZWRcIiA6IGpvYi5zdGF0dXMsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5lcShcImlkXCIsIGpvYklkKSxcblxuXHRcdFx0Ly8gQ2xlYXIgam9iX211bHRpX2VudGl0eSB0YWJsZSBkZWxldGlvbiB0cmFja2luZ1xuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfbXVsdGlfZW50aXR5XCIpXG5cdFx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRcdGRlbGV0ZWRfYnk6IG51bGwsXG5cdFx0XHRcdFx0cGVybWFuZW50X2RlbGV0ZV9zY2hlZHVsZWRfYXQ6IG51bGwsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5lcShcImpvYl9pZFwiLCBqb2JJZCksXG5cdFx0XSk7XG5cblx0XHQvLyBDaGVjayBmb3IgZXJyb3JzIGluIGVpdGhlciB1cGRhdGVcblx0XHRjb25zdCBlcnJvcnMgPSB1cGRhdGVzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuZXJyb3IpO1xuXHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJyZXN0b3JlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9zY2hlZHVsZVwiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvc2V0dGluZ3MvYXJjaGl2ZVwiKTtcblx0fSk7XG59XG5cbi8qKlxuICogUmVtb3ZlIHRlYW0gYXNzaWdubWVudCBmcm9tIGpvYlxuICog4pyFIE5PIENIQU5HRVMgTkVFREVEIC0gT25seSBkZWxldGVzIGZyb20gam9iX3RlYW1fYXNzaWdubWVudHMganVuY3Rpb24gdGFibGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVtb3ZlVGVhbUFzc2lnbm1lbnQoXG5cdGFzc2lnbm1lbnRJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IHRoZSBqdW5jdGlvbiByZWNvcmQgdG8gZmluZCBqb2JfaWQgZm9yIHJldmFsaWRhdGlvblxuXHRcdGNvbnN0IHsgZGF0YTogcmVjb3JkLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9iX3RlYW1fYXNzaWdubWVudHNcIilcblx0XHRcdC5zZWxlY3QoXCJpZCwgam9iX2lkLCBjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBhc3NpZ25tZW50SWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoZmV0Y2hFcnJvciB8fCAhcmVjb3JkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiVGVhbSBhc3NpZ25tZW50IG5vdCBmb3VuZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9SRUNPUkRfTk9UX0ZPVU5ELFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAocmVjb3JkLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJ0ZWFtIGFzc2lnbm1lbnRcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGpvYklkID0gcmVjb3JkLmpvYl9pZDtcblxuXHRcdC8vIERlbGV0ZSBqdW5jdGlvbiB0YWJsZSByb3dcblx0XHRjb25zdCB7IGVycm9yOiBkZWxldGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9iX3RlYW1fYXNzaWdubWVudHNcIilcblx0XHRcdC5kZWxldGUoKVxuXHRcdFx0LmVxKFwiaWRcIiwgYXNzaWdubWVudElkKTtcblxuXHRcdGlmIChkZWxldGVFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJyZW1vdmUgdGVhbSBhc3NpZ25tZW50IGZyb20gam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmV2YWxpZGF0ZSBqb2IgcGFnZSBhbmQgc2NoZWR1bGVcblx0XHRpZiAoam9iSWQpIHtcblx0XHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0XHR9XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBBc3NpZ24gQ3VzdG9tZXIgYW5kIFByb3BlcnR5IHRvIEpvYlxuICpcbiAqIFVwZGF0ZXMgdGhlIGpvYidzIGN1c3RvbWVyX2lkIGFuZCBwcm9wZXJ0eV9pZC5cbiAqIE9ubHkgb25lIGN1c3RvbWVyIGFuZCBwcm9wZXJ0eSBjYW4gYmUgYXNzaWduZWQgcGVyIGpvYi5cbiAqXG4gKiBAcGFyYW0gam9iSWQgLSBKb2IgSURcbiAqIEBwYXJhbSBjdXN0b21lcklkIC0gQ3VzdG9tZXIgSUQgdG8gYXNzaWduXG4gKiBAcGFyYW0gcHJvcGVydHlJZCAtIFByb3BlcnR5IElEIHRvIGFzc2lnbiAob3B0aW9uYWwpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhc3NpZ25DdXN0b21lclRvSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRjdXN0b21lcklkOiBzdHJpbmcsXG5cdHByb3BlcnR5SWQ6IHN0cmluZyB8IG51bGwsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdGNvbnN0IGNvbXBhbnlJZCA9IGF3YWl0IGdldEFjdGl2ZUNvbXBhbnlJZCgpO1xuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImNvbXBhbnkgYWNjZXNzXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGV4aXN0cyBhbmQgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBqb2IsIGVycm9yOiBqb2JFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImlkLCBjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LmlzKFwiZGVsZXRlZF9hdFwiLCBudWxsKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGpvYkVycm9yKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKFwiSm9iIHF1ZXJ5IGVycm9yOlwiLCBqb2JFcnJvcik7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmluZCBqb2I6ICR7am9iRXJyb3IubWVzc2FnZX1gLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdFx0NTAwLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRhc3NlcnRFeGlzdHMoam9iLCBcIkpvYlwiKTtcblxuXHRcdC8vIFZlcmlmeSBjdXN0b21lciBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogY3VzdG9tZXIsIGVycm9yOiBjdXN0b21lckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjdXN0b21lcnNcIilcblx0XHRcdC5zZWxlY3QoXCJpZCwgY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgY3VzdG9tZXJJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LmlzKFwiZGVsZXRlZF9hdFwiLCBudWxsKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGN1c3RvbWVyRXJyb3IpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJDdXN0b21lciBxdWVyeSBlcnJvcjpcIiwgY3VzdG9tZXJFcnJvcik7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmluZCBjdXN0b21lcjogJHtjdXN0b21lckVycm9yLm1lc3NhZ2V9YCxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHRcdDUwMCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0YXNzZXJ0RXhpc3RzKGN1c3RvbWVyLCBcIkN1c3RvbWVyXCIpO1xuXG5cdFx0Ly8gSWYgcHJvcGVydHkgaXMgcHJvdmlkZWQsIHZlcmlmeSBpdCBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY3VzdG9tZXJcblx0XHRpZiAocHJvcGVydHlJZCkge1xuXHRcdFx0Y29uc3QgeyBkYXRhOiBwcm9wZXJ0eSB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJwcm9wZXJ0aWVzXCIpXG5cdFx0XHRcdC5zZWxlY3QoXCJpZCwgY3VzdG9tZXJfaWRcIilcblx0XHRcdFx0LmVxKFwiaWRcIiwgcHJvcGVydHlJZClcblx0XHRcdFx0LmVxKFwiY3VzdG9tZXJfaWRcIiwgY3VzdG9tZXJJZClcblx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRpZiAoIXByb3BlcnR5KSB7XG5cdFx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XHRcIlByb3BlcnR5IG5vdCBmb3VuZCBvciBkb2VzIG5vdCBiZWxvbmcgdG8gdGhpcyBjdXN0b21lclwiLFxuXHRcdFx0XHRcdEVSUk9SX0NPREVTLkRCX1JFQ09SRF9OT1RfRk9VTkQsXG5cdFx0XHRcdFx0NDA0LFxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBqb2Igd2l0aCBjdXN0b21lciBhbmQgcHJvcGVydHlcblx0XHRjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnVwZGF0ZSh7XG5cdFx0XHRcdGN1c3RvbWVyX2lkOiBjdXN0b21lcklkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogcHJvcGVydHlJZCxcblx0XHRcdH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiYXNzaWduIGN1c3RvbWVyIHRvIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyBhY3Rpdml0eVxuXHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JfYWN0aXZpdHlfbG9nXCIpLmluc2VydCh7XG5cdFx0XHRqb2JfaWQ6IGpvYklkLFxuXHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0dXNlcl9pZDogdXNlci5pZCxcblx0XHRcdGFjdGl2aXR5X3R5cGU6IFwiYXNzaWduZWRcIixcblx0XHRcdGVudGl0eV90eXBlOiBcImN1c3RvbWVyXCIsXG5cdFx0XHRkZXNjcmlwdGlvbjogYEFzc2lnbmVkIGN1c3RvbWVyJHtwcm9wZXJ0eUlkID8gXCIgYW5kIHByb3BlcnR5XCIgOiBcIlwifWAsXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IHByb3BlcnR5SWQsXG5cdFx0XHR9LFxuXHRcdH0pO1xuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL3dlbGNvbWVcIik7XG5cdH0pO1xufVxuXG4vKipcbiAqIFJlbW92ZSBDdXN0b21lciBhbmQgUHJvcGVydHkgZnJvbSBKb2JcbiAqXG4gKiBSZW1vdmVzIHRoZSBjdXN0b21lcl9pZCBhbmQgcHJvcGVydHlfaWQgZnJvbSB0aGUgam9iLlxuICogUmVsYXRlZCBkYXRhIChhcHBvaW50bWVudHMsIGludm9pY2VzLCBldGMuKSByZW1haW4gYnV0IGFyZSBubyBsb25nZXIgbGlua2VkLlxuICpcbiAqIEBwYXJhbSBqb2JJZCAtIEpvYiBJRFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVtb3ZlQ3VzdG9tZXJGcm9tSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJjb21wYW55IGFjY2Vzc1wiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogam9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiaWQsIGNvbXBhbnlfaWQsIGN1c3RvbWVyX2lkLCBwcm9wZXJ0eV9pZFwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuZXEoXCJjb21wYW55X2lkXCIsIGNvbXBhbnlJZClcblx0XHRcdC5pcyhcImRlbGV0ZWRfYXRcIiwgbnVsbClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0Ly8gVXBkYXRlIGpvYiB0byByZW1vdmUgY3VzdG9tZXIgYW5kIHByb3BlcnR5XG5cdFx0Y29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRjdXN0b21lcl9pZDogbnVsbCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IG51bGwsXG5cdFx0XHR9KVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpO1xuXG5cdFx0aWYgKHVwZGF0ZUVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcInJlbW92ZSBjdXN0b21lciBmcm9tIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyBhY3Rpdml0eVxuXHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JfYWN0aXZpdHlfbG9nXCIpLmluc2VydCh7XG5cdFx0XHRqb2JfaWQ6IGpvYklkLFxuXHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0dXNlcl9pZDogdXNlci5pZCxcblx0XHRcdGFjdGl2aXR5X3R5cGU6IFwicmVtb3ZlZFwiLFxuXHRcdFx0ZW50aXR5X3R5cGU6IFwiY3VzdG9tZXJcIixcblx0XHRcdGRlc2NyaXB0aW9uOiBcIlJlbW92ZWQgY3VzdG9tZXIgYW5kIHByb3BlcnR5XCIsXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRwcmV2aW91c19jdXN0b21lcl9pZDogam9iLmN1c3RvbWVyX2lkLFxuXHRcdFx0XHRwcmV2aW91c19wcm9wZXJ0eV9pZDogam9iLnByb3BlcnR5X2lkLFxuXHRcdFx0fSxcblx0XHR9KTtcblxuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi93ZWxjb21lXCIpO1xuXHR9KTtcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiK1JBb2xCc0IifQ==
}),
"[project]/apps/web/src/actions/data:e680bd [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"60a8578e059a695585e93acde3f35aacf73ad36fda":"updateJobStatus"},"apps/web/src/actions/jobs.ts",""] */ __turbopack_context__.s([
    "updateJobStatus",
    ()=>updateJobStatus
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next@16.0.4_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
"use turbopack no side effects";
;
var updateJobStatus = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("60a8578e059a695585e93acde3f35aacf73ad36fda", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "updateJobStatus"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vam9icy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEpvYnMgU2VydmVyIEFjdGlvbnMgLSBSRUZBQ1RPUkVEIEZPUiBET01BSU4gVEFCTEUgU1RSVUNUVVJFXG4gKlxuICogSGFuZGxlcyBqb2Ivd29yayBvcmRlciBtYW5hZ2VtZW50IHdpdGggY29tcHJlaGVuc2l2ZSBDUlVEIG9wZXJhdGlvbnMsXG4gKiBzdGF0dXMgdHJhbnNpdGlvbnMsIHNjaGVkdWxpbmcsIGFuZCBhc3NpZ25tZW50IGxvZ2ljLlxuICpcbiAqIE1JR1JBVElPTiBOT1RFUzpcbiAqIC0gQ29yZSBqb2JzIHRhYmxlIG5vdyBoYXMgfjIwIGNvbHVtbnNcbiAqIC0gRG9tYWluLXNwZWNpZmljIGRhdGEgbW92ZWQgdG8gMTEgZG9tYWluIHRhYmxlc1xuICogLSBGaW5hbmNpYWwgZGF0YSAtPiBqb2JfZmluYW5jaWFsXG4gKiAtIFRpbWUgdHJhY2tpbmcgLT4gam9iX3RpbWVfdHJhY2tpbmdcbiAqIC0gQXJjaGl2ZS9kZWxldGlvbiAtPiBqb2JfbXVsdGlfZW50aXR5XG4gKiAtIEFsbCBkb21haW4gdGFibGVzIGhhdmUgQ0FTQ0FERSBkZWxldGUgb24gam9iX2lkXG4gKi9cblxuXCJ1c2Ugc2VydmVyXCI7XG5cbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5pbXBvcnQgeyBnZXRBY3RpdmVDb21wYW55SWQgfSBmcm9tIFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIjtcbmltcG9ydCB7XG5cdEFjdGlvbkVycm9yLFxuXHRFUlJPUl9DT0RFUyxcblx0RVJST1JfTUVTU0FHRVMsXG59IGZyb20gXCJAL2xpYi9lcnJvcnMvYWN0aW9uLWVycm9yXCI7XG5pbXBvcnQge1xuXHR0eXBlIEFjdGlvblJlc3VsdCxcblx0YXNzZXJ0QXV0aGVudGljYXRlZCxcblx0YXNzZXJ0RXhpc3RzLFxuXHR3aXRoRXJyb3JIYW5kbGluZyxcbn0gZnJvbSBcIkAvbGliL2Vycm9ycy93aXRoLWVycm9yLWhhbmRsaW5nXCI7XG5pbXBvcnQgeyBub3RpZnlKb2JDcmVhdGVkIH0gZnJvbSBcIkAvbGliL25vdGlmaWNhdGlvbnMvdHJpZ2dlcnNcIjtcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAL2xpYi9zdXBhYmFzZS9zZXJ2ZXJcIjtcbmltcG9ydCB7XG5cdHR5cGUgSm9iU3RhdHVzLFxuXHR0eXBlIEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0LFxuXHR2YWxpZGF0ZVN0YXR1c1RyYW5zaXRpb24sXG59IGZyb20gXCJAL2xpYi92YWxpZGF0aW9ucy9qb2Itc3RhdHVzLXRyYW5zaXRpb25zXCI7XG5cbi8vIFJlZ2V4IGNvbnN0YW50c1xuY29uc3QgSk9CX05VTUJFUl9SRUdFWCA9IC9KT0ItXFxkezR9LShcXGQrKS87XG5cbi8vIFZhbGlkYXRpb24gU2NoZW1hc1xuY29uc3QgY3JlYXRlSm9iU2NoZW1hID0gei5vYmplY3Qoe1xuXHRwcm9wZXJ0eUlkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIHByb3BlcnR5IElEXCIpLFxuXHRjdXN0b21lcklkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIGN1c3RvbWVyIElEXCIpLm9wdGlvbmFsKCksXG5cdHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCBcIkpvYiB0aXRsZSBpcyByZXF1aXJlZFwiKSxcblx0ZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblx0cHJpb3JpdHk6IHouZW51bShbXCJsb3dcIiwgXCJtZWRpdW1cIiwgXCJoaWdoXCIsIFwidXJnZW50XCJdKS5kZWZhdWx0KFwibWVkaXVtXCIpLFxuXHRqb2JUeXBlOiB6XG5cdFx0LmVudW0oW1xuXHRcdFx0XCJzZXJ2aWNlXCIsXG5cdFx0XHRcImluc3RhbGxhdGlvblwiLFxuXHRcdFx0XCJyZXBhaXJcIixcblx0XHRcdFwibWFpbnRlbmFuY2VcIixcblx0XHRcdFwiaW5zcGVjdGlvblwiLFxuXHRcdFx0XCJjb25zdWx0YXRpb25cIixcblx0XHRdKVxuXHRcdC5vcHRpb25hbCgpLFxuXHRzY2hlZHVsZWRTdGFydDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRzY2hlZHVsZWRFbmQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblx0YXNzaWduZWRUbzogei5zdHJpbmcoKS51dWlkKFwiSW52YWxpZCB1c2VyIElEXCIpLm9wdGlvbmFsKCksXG5cdG5vdGVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdC8vIEVuaGFuY2VkIHNjaGVkdWxpbmcgZmllbGRzXG5cdGlzUmVjdXJyaW5nOiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuXHRzY2hlZHVsaW5nTW9kZTogei5lbnVtKFtcInNwZWNpZmljXCIsIFwid2luZG93XCJdKS5vcHRpb25hbCgpLFxuXHR0aW1lV2luZG93OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VUeXBlOiB6XG5cdFx0LmVudW0oW1wiZGFpbHlcIiwgXCJ3ZWVrbHlcIiwgXCJiaXdlZWtseVwiLCBcIm1vbnRobHlcIiwgXCJxdWFydGVybHlcIiwgXCJ5ZWFybHlcIl0pXG5cdFx0Lm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VFbmREYXRlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VDb3VudDogei5udW1iZXIoKS5pbnQoKS5taW4oMSkubWF4KDM2NSkub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCB1cGRhdGVKb2JTY2hlbWEgPSB6Lm9iamVjdCh7XG5cdHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCBcIkpvYiB0aXRsZSBpcyByZXF1aXJlZFwiKS5vcHRpb25hbCgpLFxuXHRkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRzdGF0dXM6IHpcblx0XHQuZW51bShbXG5cdFx0XHRcInF1b3RlZFwiLFxuXHRcdFx0XCJzY2hlZHVsZWRcIixcblx0XHRcdFwiaW5fcHJvZ3Jlc3NcIixcblx0XHRcdFwib25faG9sZFwiLFxuXHRcdFx0XCJjb21wbGV0ZWRcIixcblx0XHRcdFwiY2FuY2VsbGVkXCIsXG5cdFx0XHRcImludm9pY2VkXCIsXG5cdFx0XHRcInBhaWRcIixcblx0XHRdKVxuXHRcdC5vcHRpb25hbCgpLFxuXHRwcmlvcml0eTogei5lbnVtKFtcImxvd1wiLCBcIm1lZGl1bVwiLCBcImhpZ2hcIiwgXCJ1cmdlbnRcIl0pLm9wdGlvbmFsKCksXG5cdGpvYlR5cGU6IHpcblx0XHQuZW51bShbXG5cdFx0XHRcInNlcnZpY2VcIixcblx0XHRcdFwiaW5zdGFsbGF0aW9uXCIsXG5cdFx0XHRcInJlcGFpclwiLFxuXHRcdFx0XCJtYWludGVuYW5jZVwiLFxuXHRcdFx0XCJpbnNwZWN0aW9uXCIsXG5cdFx0XHRcImNvbnN1bHRhdGlvblwiLFxuXHRcdF0pXG5cdFx0Lm9wdGlvbmFsKCksXG5cdG5vdGVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdC8vIEZpbmFuY2lhbCBmaWVsZHMgKG5vdyBpbiBqb2JfZmluYW5jaWFsIGRvbWFpbiB0YWJsZSlcblx0dG90YWxBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdHBhaWRBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdGRlcG9zaXRBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdHNjaGVkdWxlZFN0YXJ0OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHNjaGVkdWxlZEVuZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRhc3NpZ25lZFRvOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIHVzZXIgSURcIikub3B0aW9uYWwoKS5udWxsYWJsZSgpLFxuXHRjdXN0b21lcklkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIGN1c3RvbWVyIElEXCIpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcblx0cHJvcGVydHlJZDogei5zdHJpbmcoKS51dWlkKFwiSW52YWxpZCBwcm9wZXJ0eSBJRFwiKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG59KTtcblxuLy8gVHlwZSBmb3IgdXBkYXRlSm9iRGF0YSAtIG1ha2VzIGl0IGVhc2llciB0byB1c2UgcHJvZ3JhbW1hdGljYWxseVxuZXhwb3J0IHR5cGUgVXBkYXRlSm9iRGF0YSA9IHouaW5mZXI8dHlwZW9mIHVwZGF0ZUpvYlNjaGVtYT47XG5cbmNvbnN0IHNjaGVkdWxlSm9iU2NoZW1hID0gei5vYmplY3Qoe1xuXHRzY2hlZHVsZWRTdGFydDogei5zdHJpbmcoKSxcblx0c2NoZWR1bGVkRW5kOiB6LnN0cmluZygpLFxufSk7XG5cbi8qKlxuICogR2VuZXJhdGUgdW5pcXVlIGpvYiBudW1iZXJcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVKb2JOdW1iZXIoXG5cdHN1cGFiYXNlOiBhbnksXG5cdGNvbXBhbnlJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxzdHJpbmc+IHtcblx0Ly8gR2V0IHRoZSBsYXRlc3Qgam9iIG51bWJlciBmb3IgdGhpcyBjb21wYW55XG5cdGNvbnN0IHsgZGF0YTogbGF0ZXN0Sm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdC5zZWxlY3QoXCJqb2JfbnVtYmVyXCIpXG5cdFx0LmVxKFwiY29tcGFueV9pZFwiLCBjb21wYW55SWQpXG5cdFx0Lm9yZGVyKFwiY3JlYXRlZF9hdFwiLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcblx0XHQubGltaXQoMSlcblx0XHQuc2luZ2xlKCk7XG5cblx0aWYgKCFsYXRlc3RKb2IpIHtcblx0XHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tMDAxYDtcblx0fVxuXG5cdC8vIEV4dHJhY3QgbnVtYmVyIGZyb20gZm9ybWF0OiBKT0ItWVlZWS1OTk5cblx0Y29uc3QgbWF0Y2ggPSBsYXRlc3RKb2Iuam9iX251bWJlci5tYXRjaChKT0JfTlVNQkVSX1JFR0VYKTtcblx0aWYgKG1hdGNoKSB7XG5cdFx0Y29uc3QgbmV4dE51bWJlciA9IE51bWJlci5wYXJzZUludChtYXRjaFsxXSwgMTApICsgMTtcblx0XHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tJHtuZXh0TnVtYmVyLnRvU3RyaW5nKCkucGFkU3RhcnQoMywgXCIwXCIpfWA7XG5cdH1cblxuXHQvLyBGYWxsYmFja1xuXHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tJHtEYXRlLm5vdygpLnRvU3RyaW5nKCkuc2xpY2UoLTMpfWA7XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIG5leHQgcmVjdXJyZW5jZSBkYXRlXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZU5leHRSZWN1cnJlbmNlKFxuXHRjdXJyZW50RGF0ZTogRGF0ZSxcblx0cmVjdXJyZW5jZVR5cGU6IHN0cmluZyxcbik6IERhdGUge1xuXHRjb25zdCBuZXh0RGF0ZSA9IG5ldyBEYXRlKGN1cnJlbnREYXRlKTtcblxuXHRzd2l0Y2ggKHJlY3VycmVuY2VUeXBlKSB7XG5cdFx0Y2FzZSBcImRhaWx5XCI6XG5cdFx0XHRuZXh0RGF0ZS5zZXREYXRlKG5leHREYXRlLmdldERhdGUoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcIndlZWtseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RGF0ZShuZXh0RGF0ZS5nZXREYXRlKCkgKyA3KTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgXCJiaXdlZWtseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RGF0ZShuZXh0RGF0ZS5nZXREYXRlKCkgKyAxNCk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlIFwibW9udGhseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0TW9udGgobmV4dERhdGUuZ2V0TW9udGgoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcInF1YXJ0ZXJseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0TW9udGgobmV4dERhdGUuZ2V0TW9udGgoKSArIDMpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcInllYXJseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RnVsbFllYXIobmV4dERhdGUuZ2V0RnVsbFllYXIoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0ZGVmYXVsdDpcblx0XHRcdC8vIERlZmF1bHQgdG8gbW9udGhseSBpZiB1bmtub3duIHR5cGVcblx0XHRcdG5leHREYXRlLnNldE1vbnRoKG5leHREYXRlLmdldE1vbnRoKCkgKyAxKTtcblx0XHRcdGJyZWFrO1xuXHR9XG5cblx0cmV0dXJuIG5leHREYXRlO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZWN1cnJpbmcgam9ic1xuICovXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVSZWN1cnJpbmdKb2JzKFxuXHRzdXBhYmFzZTogYW55LFxuXHRjb21wYW55SWQ6IHN0cmluZyxcblx0YmFzZUpvYjogYW55LFxuXHRyZWN1cnJlbmNlVHlwZTogc3RyaW5nLFxuXHRyZWN1cnJlbmNlRW5kRGF0ZT86IHN0cmluZyxcblx0cmVjdXJyZW5jZUNvdW50PzogbnVtYmVyLFxuKTogUHJvbWlzZTx2b2lkPiB7XG5cdGlmICghYmFzZUpvYi5zY2hlZHVsZWRfc3RhcnQpIHtcblx0XHRyZXR1cm47IC8vIENhbid0IGNyZWF0ZSByZWN1cnJpbmcgam9icyB3aXRob3V0IGEgc3RhcnQgZGF0ZVxuXHR9XG5cblx0Y29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoYmFzZUpvYi5zY2hlZHVsZWRfc3RhcnQpO1xuXHRjb25zdCBlbmREYXRlID0gbmV3IERhdGUoYmFzZUpvYi5zY2hlZHVsZWRfZW5kIHx8IGJhc2VKb2Iuc2NoZWR1bGVkX3N0YXJ0KTtcblx0Y29uc3QgZHVyYXRpb24gPSBlbmREYXRlLmdldFRpbWUoKSAtIHN0YXJ0RGF0ZS5nZXRUaW1lKCk7XG5cblx0Ly8gRGV0ZXJtaW5lIGhvdyBtYW55IG9jY3VycmVuY2VzIHRvIGNyZWF0ZVxuXHRjb25zdCBtYXhPY2N1cnJlbmNlcyA9IHJlY3VycmVuY2VDb3VudCB8fCA1MjsgLy8gRGVmYXVsdCB0byAxIHllYXIgb2Ygd2Vla2x5IGpvYnNcblx0Y29uc3QgZW5kRGF0ZUxpbWl0ID0gcmVjdXJyZW5jZUVuZERhdGUgPyBuZXcgRGF0ZShyZWN1cnJlbmNlRW5kRGF0ZSkgOiBudWxsO1xuXG5cdGNvbnN0IHJlY3VycmluZ0pvYnM6ICh0eXBlb2YgYmFzZUpvYilbXSA9IFtdO1xuXHRsZXQgY3VycmVudERhdGUgPSBuZXcgRGF0ZShzdGFydERhdGUpO1xuXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgbWF4T2NjdXJyZW5jZXMgLSAxOyBpKyspIHtcblx0XHQvLyAtMSBiZWNhdXNlIHdlIGFscmVhZHkgY3JlYXRlZCB0aGUgZmlyc3Qgam9iXG5cdFx0Y3VycmVudERhdGUgPSBjYWxjdWxhdGVOZXh0UmVjdXJyZW5jZShjdXJyZW50RGF0ZSwgcmVjdXJyZW5jZVR5cGUpO1xuXG5cdFx0Ly8gU3RvcCBpZiB3ZSd2ZSByZWFjaGVkIHRoZSBlbmQgZGF0ZVxuXHRcdGlmIChlbmREYXRlTGltaXQgJiYgY3VycmVudERhdGUgPiBlbmREYXRlTGltaXQpIHtcblx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdGNvbnN0IGN1cnJlbnRFbmREYXRlID0gbmV3IERhdGUoY3VycmVudERhdGUuZ2V0VGltZSgpICsgZHVyYXRpb24pO1xuXG5cdFx0Ly8gR2VuZXJhdGUgYSB1bmlxdWUgam9iIG51bWJlciBmb3IgdGhpcyBvY2N1cnJlbmNlXG5cdFx0Y29uc3Qgam9iTnVtYmVyID0gYXdhaXQgZ2VuZXJhdGVKb2JOdW1iZXIoc3VwYWJhc2UsIGNvbXBhbnlJZCk7XG5cblx0XHRyZWN1cnJpbmdKb2JzLnB1c2goe1xuXHRcdFx0Li4uYmFzZUpvYixcblx0XHRcdGpvYl9udW1iZXI6IGpvYk51bWJlcixcblx0XHRcdHNjaGVkdWxlZF9zdGFydDogY3VycmVudERhdGUudG9JU09TdHJpbmcoKSxcblx0XHRcdHNjaGVkdWxlZF9lbmQ6IGN1cnJlbnRFbmREYXRlLnRvSVNPU3RyaW5nKCksXG5cdFx0XHR0aXRsZTogYCR7YmFzZUpvYi50aXRsZX0gKCR7aSArIDJ9LyR7bWF4T2NjdXJyZW5jZXN9KWAsIC8vIEFkZCBvY2N1cnJlbmNlIG51bWJlclxuXHRcdH0pO1xuXG5cdFx0Ly8gQ3JlYXRlIGpvYnMgaW4gYmF0Y2hlcyBvZiAxMCB0byBhdm9pZCBtZW1vcnkgaXNzdWVzXG5cdFx0aWYgKHJlY3VycmluZ0pvYnMubGVuZ3RoID49IDEwKSB7XG5cdFx0XHRhd2FpdCBzdXBhYmFzZS5mcm9tKFwiam9ic1wiKS5pbnNlcnQocmVjdXJyaW5nSm9icyk7XG5cdFx0XHRyZWN1cnJpbmdKb2JzLmxlbmd0aCA9IDA7IC8vIENsZWFyIGFycmF5XG5cdFx0fVxuXHR9XG5cblx0Ly8gSW5zZXJ0IGFueSByZW1haW5pbmcgam9ic1xuXHRpZiAocmVjdXJyaW5nSm9icy5sZW5ndGggPiAwKSB7XG5cdFx0YXdhaXQgc3VwYWJhc2UuZnJvbShcImpvYnNcIikuaW5zZXJ0KHJlY3VycmluZ0pvYnMpO1xuXHR9XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgbmV3IGpvYlxuICog4pyFIEFMUkVBRFkgTUlHUkFURUQgLSBDcmVhdGVzIGNvcmUgam9iICsgYWxsIDEwIGRvbWFpbiByZWNvcmRzIGluIHBhcmFsbGVsXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVKb2IoXG5cdGZvcm1EYXRhOiBGb3JtRGF0YSxcbik6IFByb21pc2U8QWN0aW9uUmVzdWx0PHN0cmluZz4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSBjcmVhdGVKb2JTY2hlbWEucGFyc2Uoe1xuXHRcdFx0cHJvcGVydHlJZDogZm9ybURhdGEuZ2V0KFwicHJvcGVydHlJZFwiKSxcblx0XHRcdGN1c3RvbWVySWQ6IGZvcm1EYXRhLmdldChcImN1c3RvbWVySWRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0dGl0bGU6IGZvcm1EYXRhLmdldChcInRpdGxlXCIpLFxuXHRcdFx0ZGVzY3JpcHRpb246IGZvcm1EYXRhLmdldChcImRlc2NyaXB0aW9uXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdHByaW9yaXR5OiBmb3JtRGF0YS5nZXQoXCJwcmlvcml0eVwiKSB8fCBcIm1lZGl1bVwiLFxuXHRcdFx0am9iVHlwZTogZm9ybURhdGEuZ2V0KFwiam9iVHlwZVwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRzY2hlZHVsZWRTdGFydDogZm9ybURhdGEuZ2V0KFwic2NoZWR1bGVkU3RhcnRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0c2NoZWR1bGVkRW5kOiBmb3JtRGF0YS5nZXQoXCJzY2hlZHVsZWRFbmRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0YXNzaWduZWRUbzogZm9ybURhdGEuZ2V0KFwiYXNzaWduZWRUb1wiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRub3RlczogZm9ybURhdGEuZ2V0KFwibm90ZXNcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0Ly8gRW5oYW5jZWQgc2NoZWR1bGluZyBmaWVsZHNcblx0XHRcdGlzUmVjdXJyaW5nOiBmb3JtRGF0YS5nZXQoXCJpc1JlY3VycmluZ1wiKSA9PT0gXCJ0cnVlXCIsXG5cdFx0XHRzY2hlZHVsaW5nTW9kZTogKGZvcm1EYXRhLmdldChcInNjaGVkdWxpbmdNb2RlXCIpIGFzIGFueSkgfHwgdW5kZWZpbmVkLFxuXHRcdFx0dGltZVdpbmRvdzogZm9ybURhdGEuZ2V0KFwidGltZVdpbmRvd1wiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRyZWN1cnJlbmNlVHlwZTogKGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VUeXBlXCIpIGFzIGFueSkgfHwgdW5kZWZpbmVkLFxuXHRcdFx0cmVjdXJyZW5jZUVuZERhdGU6IGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VFbmREYXRlXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdHJlY3VycmVuY2VDb3VudDogZm9ybURhdGEuZ2V0KFwicmVjdXJyZW5jZUNvdW50XCIpXG5cdFx0XHRcdD8gTnVtYmVyLnBhcnNlSW50KGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VDb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHR9KTtcblxuXHRcdC8vIFZlcmlmeSBwcm9wZXJ0eSBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IHByb3BlcnR5IH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJwcm9wZXJ0aWVzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgY3VzdG9tZXJfaWQsIGFkZHJlc3NcIilcblx0XHRcdC5lcShcImlkXCIsIGRhdGEucHJvcGVydHlJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhwcm9wZXJ0eSwgXCJQcm9wZXJ0eVwiKTtcblxuXHRcdGlmIChwcm9wZXJ0eS5jb21wYW55X2lkICE9PSBjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwicHJvcGVydHlcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVzZSBjdXN0b21lciBmcm9tIHByb3BlcnR5IGlmIG5vdCBwcm92aWRlZFxuXHRcdGNvbnN0IGN1c3RvbWVySWQgPSBkYXRhLmN1c3RvbWVySWQgfHwgcHJvcGVydHkuY3VzdG9tZXJfaWQ7XG5cblx0XHQvLyBHZW5lcmF0ZSB1bmlxdWUgam9iIG51bWJlclxuXHRcdGNvbnN0IGpvYk51bWJlciA9IGF3YWl0IGdlbmVyYXRlSm9iTnVtYmVyKHN1cGFiYXNlLCBjb21wYW55SWQpO1xuXG5cdFx0Ly8gQWRkIHRpbWUgd2luZG93IGluZm8gdG8gbm90ZXMgaWYgYXBwbGljYWJsZVxuXHRcdGxldCBqb2JOb3RlcyA9IGRhdGEubm90ZXMgfHwgXCJcIjtcblx0XHRpZiAoZGF0YS5zY2hlZHVsaW5nTW9kZSA9PT0gXCJ3aW5kb3dcIiAmJiBkYXRhLnRpbWVXaW5kb3cpIHtcblx0XHRcdGNvbnN0IHdpbmRvd0luZm8gPSBgXFxuXFxuW1NjaGVkdWxpbmddIEN1c3RvbWVyIHByZWZlcnJlZCB0aW1lIHdpbmRvdzogJHtkYXRhLnRpbWVXaW5kb3cuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBkYXRhLnRpbWVXaW5kb3cuc2xpY2UoMSl9YDtcblx0XHRcdGpvYk5vdGVzID0gam9iTm90ZXMgPyBgJHtqb2JOb3Rlc30ke3dpbmRvd0luZm99YCA6IHdpbmRvd0luZm8udHJpbSgpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBjb3JlIGpvYiByZWNvcmRcblx0XHRjb25zdCB7IGRhdGE6IG5ld0pvYiwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogZGF0YS5wcm9wZXJ0eUlkLFxuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0YXNzaWduZWRfdG86IGRhdGEuYXNzaWduZWRUbyxcblx0XHRcdFx0am9iX251bWJlcjogam9iTnVtYmVyLFxuXHRcdFx0XHR0aXRsZTogZGF0YS50aXRsZSxcblx0XHRcdFx0ZGVzY3JpcHRpb246IGRhdGEuZGVzY3JpcHRpb24sXG5cdFx0XHRcdHN0YXR1czogXCJxdW90ZWRcIixcblx0XHRcdFx0cHJpb3JpdHk6IGRhdGEucHJpb3JpdHksXG5cdFx0XHRcdGpvYl90eXBlOiBkYXRhLmpvYlR5cGUsXG5cdFx0XHRcdHNlcnZpY2VfdHlwZTogZGF0YS5qb2JUeXBlLCAvLyBEZWZhdWx0IHNlcnZpY2VfdHlwZSB0byBqb2JfdHlwZVxuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRub3Rlczogam9iTm90ZXMsXG5cdFx0XHR9KVxuXHRcdFx0LnNlbGVjdChcImlkXCIpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoY3JlYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiY3JlYXRlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBkb21haW4gcmVjb3JkcyAocGFyYWxsZWwgaW5zZXJ0cyBmb3IgcGVyZm9ybWFuY2UpXG5cdFx0Y29uc3QgZG9tYWluSW5zZXJ0cyA9IGF3YWl0IFByb21pc2UuYWxsKFtcblx0XHRcdC8vIEZpbmFuY2lhbCBkb21haW4gLSBhbHdheXMgY3JlYXRlIHdpdGggZGVmYXVsdHNcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2ZpbmFuY2lhbFwiKVxuXHRcdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0XHRqb2JfaWQ6IG5ld0pvYi5pZCxcblx0XHRcdFx0XHRjb21wYW55X2lkOiBjb21wYW55SWQsXG5cdFx0XHRcdFx0dG90YWxfYW1vdW50OiAwLFxuXHRcdFx0XHRcdHBhaWRfYW1vdW50OiAwLFxuXHRcdFx0XHRcdGRlcG9zaXRfYW1vdW50OiAwLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gV29ya2Zsb3cgZG9tYWluIC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2Jfd29ya2Zsb3dcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdHdvcmtmbG93X2NvbXBsZXRlZF9zdGFnZXM6IFtdLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gVGltZSB0cmFja2luZyAtIGFsd2F5cyBjcmVhdGVcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX3RpbWVfdHJhY2tpbmdcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdHRvdGFsX2xhYm9yX2hvdXJzOiAwLFxuXHRcdFx0XHRcdGJyZWFrX3RpbWVfbWludXRlczogMCxcblx0XHRcdFx0fSksXG5cblx0XHRcdC8vIEN1c3RvbWVyIGFwcHJvdmFsIC0gYWx3YXlzIGNyZWF0ZSB3aXRoIHBlbmRpbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2N1c3RvbWVyX2FwcHJvdmFsXCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRjdXN0b21lcl9hcHByb3ZhbF9zdGF0dXM6IFwicGVuZGluZ1wiLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gRXF1aXBtZW50IHNlcnZpY2UgLSBhbHdheXMgY3JlYXRlXG5cdFx0XHRzdXBhYmFzZVxuXHRcdFx0XHQuZnJvbShcImpvYl9lcXVpcG1lbnRfc2VydmljZVwiKVxuXHRcdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0XHRqb2JfaWQ6IG5ld0pvYi5pZCxcblx0XHRcdFx0XHRjb21wYW55X2lkOiBjb21wYW55SWQsXG5cdFx0XHRcdFx0ZXF1aXBtZW50X3NlcnZpY2VfaGlzdG9yeTogW10sXG5cdFx0XHRcdFx0ZXF1aXBtZW50X3NlcnZpY2VkOiBbXSxcblx0XHRcdFx0fSksXG5cblx0XHRcdC8vIERpc3BhdGNoIC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfZGlzcGF0Y2hcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gUXVhbGl0eSAtIGFsd2F5cyBjcmVhdGVcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX3F1YWxpdHlcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdGluc3BlY3Rpb25fcmVxdWlyZWQ6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gU2FmZXR5IC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2Jfc2FmZXR5XCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRyZXF1aXJlc19wZXJtaXQ6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gQUkgZW5yaWNobWVudCAtIGNyZWF0ZSBlbXB0eSBmb3IgZnV0dXJlIHByb2Nlc3Npbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2FpX2VucmljaG1lbnRcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gTXVsdGktZW50aXR5IC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfbXVsdGlfZW50aXR5XCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRyZXF1aXJlc19tdWx0aXBsZV9wcm9wZXJ0aWVzOiBmYWxzZSxcblx0XHRcdFx0XHRyZXF1aXJlc19tdWx0aXBsZV9jdXN0b21lcnM6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBhbnkgZG9tYWluIGluc2VydCBlcnJvcnNcblx0XHRjb25zdCBkb21haW5FcnJvcnMgPSBkb21haW5JbnNlcnRzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuZXJyb3IpO1xuXHRcdGlmIChkb21haW5FcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0Ly8gUm9sbGJhY2sgLSBkZWxldGUgdGhlIGpvYiAoQ0FTQ0FERSB3aWxsIGRlbGV0ZSBkb21haW4gcmVjb3Jkcylcblx0XHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JzXCIpLmRlbGV0ZSgpLmVxKFwiaWRcIiwgbmV3Sm9iLmlkKTtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiY3JlYXRlIGpvYiBkb21haW5zXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQ3JlYXRlIHJlY3VycmluZyBqb2JzIGlmIHJlcXVlc3RlZFxuXHRcdGlmIChkYXRhLmlzUmVjdXJyaW5nICYmIGRhdGEucmVjdXJyZW5jZVR5cGUgJiYgZGF0YS5zY2hlZHVsZWRTdGFydCkge1xuXHRcdFx0Y29uc3QgYmFzZUpvYiA9IHtcblx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogZGF0YS5wcm9wZXJ0eUlkLFxuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0YXNzaWduZWRfdG86IGRhdGEuYXNzaWduZWRUbyxcblx0XHRcdFx0dGl0bGU6IGRhdGEudGl0bGUsXG5cdFx0XHRcdGRlc2NyaXB0aW9uOiBkYXRhLmRlc2NyaXB0aW9uLFxuXHRcdFx0XHRzdGF0dXM6IFwicXVvdGVkXCIsXG5cdFx0XHRcdHByaW9yaXR5OiBkYXRhLnByaW9yaXR5LFxuXHRcdFx0XHRqb2JfdHlwZTogZGF0YS5qb2JUeXBlLFxuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRub3RlczogZGF0YS5ub3Rlcyxcblx0XHRcdH07XG5cblx0XHRcdGF3YWl0IGNyZWF0ZVJlY3VycmluZ0pvYnMoXG5cdFx0XHRcdHN1cGFiYXNlLFxuXHRcdFx0XHRjb21wYW55SWQsXG5cdFx0XHRcdGJhc2VKb2IsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZVR5cGUsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZUVuZERhdGUsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZUNvdW50LFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBTZW5kIG5vdGlmaWNhdGlvbiB0byBhc3NpZ25lZCB1c2VyIGlmIGpvYiBpcyBhc3NpZ25lZFxuXHRcdGlmIChkYXRhLmFzc2lnbmVkVG8gJiYgZGF0YS5hc3NpZ25lZFRvICE9PSB1c2VyLmlkKSB7XG5cdFx0XHRhd2FpdCBub3RpZnlKb2JDcmVhdGVkKHtcblx0XHRcdFx0dXNlcklkOiBkYXRhLmFzc2lnbmVkVG8sXG5cdFx0XHRcdGNvbXBhbnlJZDogY29tcGFueUlkLFxuXHRcdFx0XHRqb2JJZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRqb2JUaXRsZTogZGF0YS50aXRsZSxcblx0XHRcdFx0YWRkcmVzczogcHJvcGVydHkuYWRkcmVzcyB8fCBcIlVua25vd24gYWRkcmVzc1wiLFxuXHRcdFx0XHRwcmlvcml0eTpcblx0XHRcdFx0XHRkYXRhLnByaW9yaXR5ID09PSBcInVyZ2VudFwiXG5cdFx0XHRcdFx0XHQ/IFwidXJnZW50XCJcblx0XHRcdFx0XHRcdDogZGF0YS5wcmlvcml0eSA9PT0gXCJoaWdoXCJcblx0XHRcdFx0XHRcdFx0PyBcImhpZ2hcIlxuXHRcdFx0XHRcdFx0XHQ6IFwibWVkaXVtXCIsXG5cdFx0XHRcdGFjdGlvblVybDogXCIvZGFzaGJvYXJkL3dvcmtcIixcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrL2pvYnNcIik7XG5cdFx0cmV0dXJuIG5ld0pvYi5pZDtcblx0fSk7XG59XG5cbi8qKlxuICogR2V0IGEgc2luZ2xlIGpvYiBieSBJRFxuICog4pyFIEFMUkVBRFkgTUlHUkFURUQgLSBGZXRjaGVzIGpvYiB3aXRoIGFsbCBkb21haW4gZGF0YVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueT4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBqb2Igd2l0aCBiYXNpYyByZWxhdGlvbnNoaXBzXG5cdFx0Ly8gU2ltcGxpZmllZCBxdWVyeSAtIG1hbnkgZG9tYWluIHRhYmxlcyBkb24ndCBleGlzdCB5ZXRcblx0XHRjb25zdCB7IGRhdGE6IGpvYiwgZXJyb3I6IGpvYkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRgXG5cdFx0XHRcdCosXG5cdFx0XHRcdHByb3BlcnR5OnByb3BlcnRpZXMoKiksXG5cdFx0XHRcdGN1c3RvbWVyOmN1c3RvbWVycyFjdXN0b21lcl9pZChpZCwgZmlyc3RfbmFtZSwgbGFzdF9uYW1lLCBlbWFpbCwgcGhvbmUsIGRpc3BsYXlfbmFtZSlcblx0XHRcdGAsXG5cdFx0XHQpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGpvYkVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm5vdEZvdW5kKFwiSm9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9SRUNPUkRfTk9UX0ZPVU5ELFxuXHRcdFx0XHQ0MDQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRpZiAoam9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBqb2I7XG5cdH0pO1xufVxuXG4vKipcbiAqIFVwZGF0ZSBqb2IgZGV0YWlsc1xuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgYm90aCBjb3JlIGpvYnMgdGFibGUgYW5kIGRvbWFpbiB0YWJsZXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYihcblx0am9iSWQ6IHN0cmluZyxcblx0Zm9ybURhdGE6IEZvcm1EYXRhLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IGFjdGl2ZSBjb21wYW55IElEXG5cdFx0Y29uc3QgYWN0aXZlQ29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cdFx0aWYgKCFhY3RpdmVDb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgdXNlcidzIHJvbGUgdG8gY2hlY2sgaWYgdGhleSdyZSBhZG1pbi9vd25lclxuXHRcdGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiY29tcGFueV9tZW1iZXJzaGlwc1wiKVxuXHRcdFx0LnNlbGVjdChcblx0XHRcdFx0YFxuICAgICAgICByb2xlX2lkLFxuICAgICAgICBjdXN0b21fcm9sZXMhcm9sZV9pZChuYW1lLCBpc19zeXN0ZW0pXG4gICAgICBgLFxuXHRcdFx0KVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LmVxKFwiY29tcGFueV9pZFwiLCBhY3RpdmVDb21wYW55SWQpXG5cdFx0XHQuZXEoXCJzdGF0dXNcIiwgXCJhY3RpdmVcIilcblx0XHRcdC5tYXliZVNpbmdsZSgpO1xuXG5cdFx0Y29uc3Qgcm9sZSA9IEFycmF5LmlzQXJyYXkodGVhbU1lbWJlcj8uY3VzdG9tX3JvbGVzKVxuXHRcdFx0PyB0ZWFtTWVtYmVyLmN1c3RvbV9yb2xlc1swXVxuXHRcdFx0OiB0ZWFtTWVtYmVyPy5jdXN0b21fcm9sZXM7XG5cblx0XHRjb25zdCBpc0FkbWluT3JPd25lciA9XG5cdFx0XHRyb2xlPy5uYW1lID09PSBcIkFkbWluXCIgfHxcblx0XHRcdHJvbGU/Lm5hbWUgPT09IFwiT3duZXJcIiB8fFxuXHRcdFx0cm9sZT8uaXNfc3lzdGVtID09PSB0cnVlO1xuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhleGlzdGluZ0pvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoZXhpc3RpbmdKb2IuY29tcGFueV9pZCAhPT0gYWN0aXZlQ29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUHJldmVudCBlZGl0aW5nIGNvbXBsZXRlZCBvciBjYW5jZWxsZWQgam9icyAodW5sZXNzIGFkbWluL293bmVyKVxuXHRcdGlmIChcblx0XHRcdCFpc0FkbWluT3JPd25lciAmJlxuXHRcdFx0KGV4aXN0aW5nSm9iLnN0YXR1cyA9PT0gXCJjb21wbGV0ZWRcIiB8fCBleGlzdGluZ0pvYi5zdGF0dXMgPT09IFwiY2FuY2VsbGVkXCIpXG5cdFx0KSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBDYW5ub3QgZWRpdCAke2V4aXN0aW5nSm9iLnN0YXR1c30gam9ic2AsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgY3VzdG9tZXJJZFZhbHVlID0gZm9ybURhdGEuZ2V0KFwiY3VzdG9tZXJJZFwiKTtcblx0XHRjb25zdCBwcm9wZXJ0eUlkVmFsdWUgPSBmb3JtRGF0YS5nZXQoXCJwcm9wZXJ0eUlkXCIpO1xuXG5cdFx0Ly8gSGFuZGxlIGN1c3RvbWVySWQ6IGVtcHR5IHN0cmluZyBvciBcIm51bGxcIiBzdHJpbmcgbWVhbnMgcmVtb3ZlIChzZXQgdG8gbnVsbClcblx0XHQvLyB1bmRlZmluZWQgbWVhbnMgZG9uJ3QgY2hhbmdlIGl0XG5cdFx0bGV0IHBhcnNlZEN1c3RvbWVySWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG5cdFx0aWYgKGN1c3RvbWVySWRWYWx1ZSA9PT0gbnVsbCB8fCBjdXN0b21lcklkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyc2VkQ3VzdG9tZXJJZCA9IHVuZGVmaW5lZDsgLy8gRG9uJ3QgY2hhbmdlXG5cdFx0fSBlbHNlIGlmIChjdXN0b21lcklkVmFsdWUgPT09IFwiXCIgfHwgY3VzdG9tZXJJZFZhbHVlID09PSBcIm51bGxcIikge1xuXHRcdFx0cGFyc2VkQ3VzdG9tZXJJZCA9IG51bGw7IC8vIFJlbW92ZSBjdXN0b21lclxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJzZWRDdXN0b21lcklkID0gY3VzdG9tZXJJZFZhbHVlIGFzIHN0cmluZzsgLy8gU2V0IHRvIHRoaXMgY3VzdG9tZXJcblx0XHR9XG5cblx0XHQvLyBIYW5kbGUgcHJvcGVydHlJZDogZW1wdHkgc3RyaW5nIG1lYW5zIHJlbW92ZSAoc2V0IHRvIG51bGwpLCB1bmRlZmluZWQgbWVhbnMgZG9uJ3QgY2hhbmdlXG5cdFx0bGV0IHBhcnNlZFByb3BlcnR5SWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG5cdFx0aWYgKHByb3BlcnR5SWRWYWx1ZSA9PT0gbnVsbCB8fCBwcm9wZXJ0eUlkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyc2VkUHJvcGVydHlJZCA9IHVuZGVmaW5lZDsgLy8gRG9uJ3QgY2hhbmdlXG5cdFx0fSBlbHNlIGlmIChwcm9wZXJ0eUlkVmFsdWUgPT09IFwiXCIgfHwgcHJvcGVydHlJZFZhbHVlID09PSBcIm51bGxcIikge1xuXHRcdFx0cGFyc2VkUHJvcGVydHlJZCA9IG51bGw7IC8vIFJlbW92ZSBwcm9wZXJ0eVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJzZWRQcm9wZXJ0eUlkID0gcHJvcGVydHlJZFZhbHVlIGFzIHN0cmluZzsgLy8gU2V0IHRvIHRoaXMgcHJvcGVydHlcblx0XHR9XG5cblx0XHRjb25zdCBkYXRhID0gdXBkYXRlSm9iU2NoZW1hLnBhcnNlKHtcblx0XHRcdHRpdGxlOiBmb3JtRGF0YS5nZXQoXCJ0aXRsZVwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRkZXNjcmlwdGlvbjogZm9ybURhdGEuZ2V0KFwiZGVzY3JpcHRpb25cIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0c3RhdHVzOiBmb3JtRGF0YS5nZXQoXCJzdGF0dXNcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0cHJpb3JpdHk6IGZvcm1EYXRhLmdldChcInByaW9yaXR5XCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdGpvYlR5cGU6IGZvcm1EYXRhLmdldChcImpvYlR5cGVcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0bm90ZXM6IGZvcm1EYXRhLmdldChcIm5vdGVzXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdC8vIEZpbmFuY2lhbCBmaWVsZHMgKG5vdyBpbiBqb2JfZmluYW5jaWFsIGRvbWFpbiB0YWJsZSlcblx0XHRcdHRvdGFsQW1vdW50OiBmb3JtRGF0YS5nZXQoXCJ0b3RhbEFtb3VudFwiKVxuXHRcdFx0XHQ/IE51bWJlci5wYXJzZUludChmb3JtRGF0YS5nZXQoXCJ0b3RhbEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdHBhaWRBbW91bnQ6IGZvcm1EYXRhLmdldChcInBhaWRBbW91bnRcIilcblx0XHRcdFx0PyBOdW1iZXIucGFyc2VJbnQoZm9ybURhdGEuZ2V0KFwicGFpZEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdGRlcG9zaXRBbW91bnQ6IGZvcm1EYXRhLmdldChcImRlcG9zaXRBbW91bnRcIilcblx0XHRcdFx0PyBOdW1iZXIucGFyc2VJbnQoZm9ybURhdGEuZ2V0KFwiZGVwb3NpdEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdHNjaGVkdWxlZFN0YXJ0OiBmb3JtRGF0YS5nZXQoXCJzY2hlZHVsZWRTdGFydFwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRzY2hlZHVsZWRFbmQ6IGZvcm1EYXRhLmdldChcInNjaGVkdWxlZEVuZFwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRhc3NpZ25lZFRvOiBmb3JtRGF0YS5nZXQoXCJhc3NpZ25lZFRvXCIpIHx8IG51bGwsXG5cdFx0XHRjdXN0b21lcklkOiBwYXJzZWRDdXN0b21lcklkLFxuXHRcdFx0cHJvcGVydHlJZDogcGFyc2VkUHJvcGVydHlJZCxcblx0XHR9KTtcblxuXHRcdC8vIElmIHN0YXR1cyBpcyBiZWluZyBjaGFuZ2VkLCB2YWxpZGF0ZSB0aGUgdHJhbnNpdGlvblxuXHRcdGlmIChkYXRhLnN0YXR1cyAhPT0gdW5kZWZpbmVkICYmIGRhdGEuc3RhdHVzICE9PSBleGlzdGluZ0pvYi5zdGF0dXMpIHtcblx0XHRcdC8vIEZldGNoIGFkZGl0aW9uYWwgY29udGV4dCBmb3Igc3RhdHVzIHZhbGlkYXRpb25cblx0XHRcdGNvbnN0IHsgZGF0YTogam9iV2l0aENvbnRleHQgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRcdGBcblx0XHRcdFx0XHRpZCxcblx0XHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdFx0c2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRcdHNjaGVkdWxlZF9lbmQsXG5cdFx0XHRcdFx0YXNzaWduZWRfdG8sXG5cdFx0XHRcdFx0Y3VzdG9tZXJfaWQsXG5cdFx0XHRcdFx0cHJvcGVydHlfaWQsXG5cdFx0XHRcdFx0dG90YWxfYW1vdW50LFxuXHRcdFx0XHRcdGludm9pY2VzOmludm9pY2VzKHN0YXR1cywgdG90YWxfYW1vdW50KSxcblx0XHRcdFx0XHRlc3RpbWF0ZXM6ZXN0aW1hdGVzKHN0YXR1cyksXG5cdFx0XHRcdFx0dGVhbV9hc3NpZ25tZW50czpqb2JfdGVhbV9hc3NpZ25tZW50cyh0ZWFtX21lbWJlcl9pZClcblx0XHRcdFx0YCxcblx0XHRcdFx0KVxuXHRcdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRpZiAoam9iV2l0aENvbnRleHQpIHtcblx0XHRcdFx0Y29uc3QgdHJhbnNpdGlvbkNvbnRleHQ6IEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0ID0ge1xuXHRcdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGpvYldpdGhDb250ZXh0LnN0YXR1cyBhcyBKb2JTdGF0dXMsXG5cdFx0XHRcdFx0bmV3U3RhdHVzOiBkYXRhLnN0YXR1cyBhcyBKb2JTdGF0dXMsXG5cdFx0XHRcdFx0am9iOiB7XG5cdFx0XHRcdFx0XHRpZDogam9iV2l0aENvbnRleHQuaWQsXG5cdFx0XHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6XG5cdFx0XHRcdFx0XHRcdGRhdGEuc2NoZWR1bGVkU3RhcnQgfHwgam9iV2l0aENvbnRleHQuc2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRcdFx0c2NoZWR1bGVkX2VuZDogZGF0YS5zY2hlZHVsZWRFbmQgfHwgam9iV2l0aENvbnRleHQuc2NoZWR1bGVkX2VuZCxcblx0XHRcdFx0XHRcdGFzc2lnbmVkX3RvOlxuXHRcdFx0XHRcdFx0XHRkYXRhLmFzc2lnbmVkVG8gIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5hc3NpZ25lZFRvXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5hc3NpZ25lZF90byxcblx0XHRcdFx0XHRcdGN1c3RvbWVyX2lkOlxuXHRcdFx0XHRcdFx0XHRkYXRhLmN1c3RvbWVySWQgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5jdXN0b21lcklkXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5jdXN0b21lcl9pZCxcblx0XHRcdFx0XHRcdHByb3BlcnR5X2lkOlxuXHRcdFx0XHRcdFx0XHRkYXRhLnByb3BlcnR5SWQgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5wcm9wZXJ0eUlkXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5wcm9wZXJ0eV9pZCxcblx0XHRcdFx0XHRcdHRvdGFsX2Ftb3VudDpcblx0XHRcdFx0XHRcdFx0ZGF0YS50b3RhbEFtb3VudCAhPT0gdW5kZWZpbmVkXG5cdFx0XHRcdFx0XHRcdFx0PyBkYXRhLnRvdGFsQW1vdW50XG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC50b3RhbF9hbW91bnQsXG5cdFx0XHRcdFx0XHRpbnZvaWNlczogam9iV2l0aENvbnRleHQuaW52b2ljZXMgfHwgW10sXG5cdFx0XHRcdFx0XHRlc3RpbWF0ZXM6IGpvYldpdGhDb250ZXh0LmVzdGltYXRlcyB8fCBbXSxcblx0XHRcdFx0XHRcdHRlYW1Bc3NpZ25tZW50czogam9iV2l0aENvbnRleHQudGVhbV9hc3NpZ25tZW50cyB8fCBbXSxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSB2YWxpZGF0ZVN0YXR1c1RyYW5zaXRpb24odHJhbnNpdGlvbkNvbnRleHQpO1xuXG5cdFx0XHRcdGlmICghdmFsaWRhdGlvblJlc3VsdC5hbGxvd2VkKSB7XG5cdFx0XHRcdFx0bGV0IGVycm9yTWVzc2FnZSA9XG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlYXNvbiB8fCBcIlN0YXR1cyB0cmFuc2l0aW9uIG5vdCBhbGxvd2VkXCI7XG5cblx0XHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlcXVpcmVkRmllbGRzICYmXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlcXVpcmVkRmllbGRzLmxlbmd0aCA+IDBcblx0XHRcdFx0XHQpIHtcblx0XHRcdFx0XHRcdGVycm9yTWVzc2FnZSArPSBgLiBNaXNzaW5nOiAke3ZhbGlkYXRpb25SZXN1bHQucmVxdWlyZWRGaWVsZHMuam9pbihcIiwgXCIpfWA7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKGVycm9yTWVzc2FnZSwgRVJST1JfQ09ERVMuVkFMSURBVElPTl9GQUlMRUQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gTG9nIHdhcm5pbmdzIGlmIHByZXNlbnQgKG5vbi1ibG9ja2luZylcblx0XHRcdFx0aWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwi4pqg77iPIFN0YXR1cyB0cmFuc2l0aW9uIHdhcm5pbmdzOlwiLCB7XG5cdFx0XHRcdFx0XHRqb2JJZCxcblx0XHRcdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGpvYldpdGhDb250ZXh0LnN0YXR1cyxcblx0XHRcdFx0XHRcdG5ld1N0YXR1czogZGF0YS5zdGF0dXMsXG5cdFx0XHRcdFx0XHR3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIEJ1aWxkIGNvcmUgam9iIHVwZGF0ZSBvYmplY3Qgd2l0aCBvbmx5IGRlZmluZWQgdmFsdWVzXG5cdFx0Y29uc3QgY29yZVVwZGF0ZURhdGE6IGFueSA9IHt9O1xuXHRcdGlmIChkYXRhLnRpdGxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnRpdGxlID0gZGF0YS50aXRsZTtcblx0XHR9XG5cdFx0aWYgKGRhdGEuZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuZGVzY3JpcHRpb24gPSBkYXRhLmRlc2NyaXB0aW9uO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zdGF0dXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuc3RhdHVzID0gZGF0YS5zdGF0dXM7XG5cdFx0fVxuXHRcdGlmIChkYXRhLnByaW9yaXR5ICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnByaW9yaXR5ID0gZGF0YS5wcmlvcml0eTtcblx0XHR9XG5cdFx0aWYgKGRhdGEuam9iVHlwZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb3JlVXBkYXRlRGF0YS5qb2JfdHlwZSA9IGRhdGEuam9iVHlwZTtcblx0XHR9XG5cdFx0aWYgKGRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEubm90ZXMgPSBkYXRhLm5vdGVzO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zY2hlZHVsZWRTdGFydCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb3JlVXBkYXRlRGF0YS5zY2hlZHVsZWRfc3RhcnQgPSBkYXRhLnNjaGVkdWxlZFN0YXJ0O1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zY2hlZHVsZWRFbmQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuc2NoZWR1bGVkX2VuZCA9IGRhdGEuc2NoZWR1bGVkRW5kO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5hc3NpZ25lZFRvICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLmFzc2lnbmVkX3RvID0gZGF0YS5hc3NpZ25lZFRvO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLmN1c3RvbWVyX2lkID0gZGF0YS5jdXN0b21lcklkO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5wcm9wZXJ0eUlkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnByb3BlcnR5X2lkID0gZGF0YS5wcm9wZXJ0eUlkO1xuXHRcdFx0Ly8gSWYgcHJvcGVydHkgaXMgYmVpbmcgc2V0IChub3QgbnVsbCksIHZlcmlmeSBpdCBiZWxvbmdzIHRvIHRoZSBjdXN0b21lciAoaWYgY3VzdG9tZXIgaXMgc2V0KVxuXHRcdFx0aWYgKFxuXHRcdFx0XHRkYXRhLnByb3BlcnR5SWQgIT09IG51bGwgJiZcblx0XHRcdFx0ZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQgJiZcblx0XHRcdFx0ZGF0YS5jdXN0b21lcklkICE9PSBudWxsXG5cdFx0XHQpIHtcblx0XHRcdFx0Y29uc3QgeyBkYXRhOiBwcm9wZXJ0eSB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdFx0XHQuZnJvbShcInByb3BlcnRpZXNcIilcblx0XHRcdFx0XHQuc2VsZWN0KFwiY3VzdG9tZXJfaWRcIilcblx0XHRcdFx0XHQuZXEoXCJpZFwiLCBkYXRhLnByb3BlcnR5SWQpXG5cdFx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRcdGlmIChwcm9wZXJ0eSAmJiBwcm9wZXJ0eS5jdXN0b21lcl9pZCAhPT0gZGF0YS5jdXN0b21lcklkKSB7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcdFx0XCJQcm9wZXJ0eSBkb2VzIG5vdCBiZWxvbmcgdG8gdGhlIHNlbGVjdGVkIGN1c3RvbWVyXCIsXG5cdFx0XHRcdFx0XHRFUlJPUl9DT0RFUy5WQUxJREFUSU9OX0ZBSUxFRCxcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gQnVpbGQgZmluYW5jaWFsIGRvbWFpbiB1cGRhdGUgb2JqZWN0IChpZiBhbnkgZmluYW5jaWFsIGZpZWxkcyBwcm92aWRlZClcblx0XHRjb25zdCBmaW5hbmNpYWxVcGRhdGVEYXRhOiBhbnkgPSB7fTtcblx0XHRpZiAoZGF0YS50b3RhbEFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmaW5hbmNpYWxVcGRhdGVEYXRhLnRvdGFsX2Ftb3VudCA9IGRhdGEudG90YWxBbW91bnQ7XG5cdFx0fVxuXHRcdGlmIChkYXRhLnBhaWRBbW91bnQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0ZmluYW5jaWFsVXBkYXRlRGF0YS5wYWlkX2Ftb3VudCA9IGRhdGEucGFpZEFtb3VudDtcblx0XHR9XG5cdFx0aWYgKGRhdGEuZGVwb3NpdEFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmaW5hbmNpYWxVcGRhdGVEYXRhLmRlcG9zaXRfYW1vdW50ID0gZGF0YS5kZXBvc2l0QW1vdW50O1xuXHRcdH1cblxuXHRcdC8vIEV4ZWN1dGUgdXBkYXRlcyBpbiBwYXJhbGxlbCBmb3IgcGVyZm9ybWFuY2Vcblx0XHRjb25zdCB1cGRhdGVzOiBQcm9taXNlPGFueT5bXSA9IFtdO1xuXG5cdFx0Ly8gVXBkYXRlIGNvcmUgam9iIHRhYmxlIGlmIHRoZXJlIGFyZSBjaGFuZ2VzXG5cdFx0aWYgKE9iamVjdC5rZXlzKGNvcmVVcGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG5cdFx0XHR1cGRhdGVzLnB1c2goXG5cdFx0XHRcdChhc3luYyAoKSA9PiBhd2FpdCBzdXBhYmFzZS5mcm9tKFwiam9ic1wiKS51cGRhdGUoY29yZVVwZGF0ZURhdGEpLmVxKFwiaWRcIiwgam9iSWQpKSgpLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBVcGRhdGUgZmluYW5jaWFsIGRvbWFpbiB0YWJsZSBpZiB0aGVyZSBhcmUgY2hhbmdlc1xuXHRcdGlmIChPYmplY3Qua2V5cyhmaW5hbmNpYWxVcGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG5cdFx0XHR1cGRhdGVzLnB1c2goXG5cdFx0XHRcdChhc3luYyAoKSA9PlxuXHRcdFx0XHRcdGF3YWl0IHN1cGFiYXNlXG5cdFx0XHRcdFx0XHQuZnJvbShcImpvYl9maW5hbmNpYWxcIilcblx0XHRcdFx0XHRcdC51cGRhdGUoZmluYW5jaWFsVXBkYXRlRGF0YSlcblx0XHRcdFx0XHRcdC5lcShcImpvYl9pZFwiLCBqb2JJZCkpKCksXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEV4ZWN1dGUgYWxsIHVwZGF0ZXMgaW4gcGFyYWxsZWxcblx0XHRpZiAodXBkYXRlcy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwodXBkYXRlcyk7XG5cblx0XHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gYW55IHVwZGF0ZVxuXHRcdFx0Y29uc3QgZXJyb3JzID0gcmVzdWx0cy5maWx0ZXIoKHJlc3VsdCkgPT4gcmVzdWx0LmVycm9yKTtcblx0XHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRjb25zdCBlcnJvck1lc3NhZ2VzID0gZXJyb3JzLm1hcCgoZSkgPT4gZS5lcnJvci5tZXNzYWdlKS5qb2luKFwiLCBcIik7XG5cdFx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XHRgJHtFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJ1cGRhdGUgam9iXCIpfTogJHtlcnJvck1lc3NhZ2VzfWAsXG5cdFx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBVcGRhdGUgam9iIHdpdGggZGF0YSBvYmplY3QgKGVhc2llciBmb3IgcHJvZ3JhbW1hdGljIHVzZSlcbiAqIFVzZWQgYnkgam9iIGVkaXRvciBmb3IgaW4tcGxhY2UgdXBkYXRlc1xuICovXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVKb2JEYXRhKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRkYXRhOiBQYXJ0aWFsPFVwZGF0ZUpvYkRhdGE+LFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHQvLyBDb252ZXJ0IGRhdGEgb2JqZWN0IHRvIEZvcm1EYXRhIGZvciBjb21wYXRpYmlsaXR5IHdpdGggZXhpc3RpbmcgdXBkYXRlSm9iXG5cdFx0Y29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcblxuXHRcdC8vIEFkZCBhbGwgZGVmaW5lZCBmaWVsZHMgdG8gRm9ybURhdGFcblx0XHRpZiAoZGF0YS50aXRsZSAhPT0gdW5kZWZpbmVkKSBmb3JtRGF0YS5hcHBlbmQoXCJ0aXRsZVwiLCBkYXRhLnRpdGxlKTtcblx0XHRpZiAoZGF0YS5kZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwiZGVzY3JpcHRpb25cIiwgZGF0YS5kZXNjcmlwdGlvbik7XG5cdFx0aWYgKGRhdGEuc3RhdHVzICE9PSB1bmRlZmluZWQpIGZvcm1EYXRhLmFwcGVuZChcInN0YXR1c1wiLCBkYXRhLnN0YXR1cyk7XG5cdFx0aWYgKGRhdGEucHJpb3JpdHkgIT09IHVuZGVmaW5lZCkgZm9ybURhdGEuYXBwZW5kKFwicHJpb3JpdHlcIiwgZGF0YS5wcmlvcml0eSk7XG5cdFx0aWYgKGRhdGEuam9iVHlwZSAhPT0gdW5kZWZpbmVkKSBmb3JtRGF0YS5hcHBlbmQoXCJqb2JUeXBlXCIsIGRhdGEuam9iVHlwZSk7XG5cdFx0aWYgKGRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkgZm9ybURhdGEuYXBwZW5kKFwibm90ZXNcIiwgZGF0YS5ub3Rlcyk7XG5cdFx0aWYgKGRhdGEudG90YWxBbW91bnQgIT09IHVuZGVmaW5lZClcblx0XHRcdGZvcm1EYXRhLmFwcGVuZChcInRvdGFsQW1vdW50XCIsIGRhdGEudG90YWxBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEucGFpZEFtb3VudCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwicGFpZEFtb3VudFwiLCBkYXRhLnBhaWRBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEuZGVwb3NpdEFtb3VudCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwiZGVwb3NpdEFtb3VudFwiLCBkYXRhLmRlcG9zaXRBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEuc2NoZWR1bGVkU3RhcnQgIT09IHVuZGVmaW5lZClcblx0XHRcdGZvcm1EYXRhLmFwcGVuZChcInNjaGVkdWxlZFN0YXJ0XCIsIGRhdGEuc2NoZWR1bGVkU3RhcnQpO1xuXHRcdGlmIChkYXRhLnNjaGVkdWxlZEVuZCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwic2NoZWR1bGVkRW5kXCIsIGRhdGEuc2NoZWR1bGVkRW5kKTtcblx0XHRpZiAoZGF0YS5hc3NpZ25lZFRvICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJhc3NpZ25lZFRvXCIsIGRhdGEuYXNzaWduZWRUbyB8fCBcIlwiKTtcblx0XHRpZiAoZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJjdXN0b21lcklkXCIsIGRhdGEuY3VzdG9tZXJJZCB8fCBcIlwiKTtcblx0XHRpZiAoZGF0YS5wcm9wZXJ0eUlkICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJwcm9wZXJ0eUlkXCIsIGRhdGEucHJvcGVydHlJZCB8fCBcIlwiKTtcblxuXHRcdC8vIFJldXNlIGV4aXN0aW5nIHVwZGF0ZUpvYiBsb2dpY1xuXHRcdHJldHVybiBhd2FpdCB1cGRhdGVKb2Ioam9iSWQsIGZvcm1EYXRhKTtcblx0fSk7XG59XG5cbi8qKlxuICogVXBkYXRlIGpvYiBzdGF0dXMgd2l0aCB2YWxpZGF0aW9uXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5zdGF0dXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYlN0YXR1cyhcblx0am9iSWQ6IHN0cmluZyxcblx0bmV3U3RhdHVzOiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBjdXJyZW50IHVzZXJcblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmFsaWRhdGUgc3RhdHVzIHZhbHVlXG5cdFx0Y29uc3QgdmFsaWRTdGF0dXNlczogSm9iU3RhdHVzW10gPSBbXG5cdFx0XHRcInF1b3RlZFwiLFxuXHRcdFx0XCJzY2hlZHVsZWRcIixcblx0XHRcdFwiaW5fcHJvZ3Jlc3NcIixcblx0XHRcdFwib25faG9sZFwiLFxuXHRcdFx0XCJjb21wbGV0ZWRcIixcblx0XHRcdFwiY2FuY2VsbGVkXCIsXG5cdFx0XHRcImludm9pY2VkXCIsXG5cdFx0XHRcInBhaWRcIixcblx0XHRdO1xuXHRcdGlmICghdmFsaWRTdGF0dXNlcy5pbmNsdWRlcyhuZXdTdGF0dXMgYXMgSm9iU3RhdHVzKSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkludmFsaWQgam9iIHN0YXR1c1wiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5WQUxJREFUSU9OX0ZBSUxFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gRmV0Y2ggam9iIHdpdGggYWxsIGNvbnRleHQgbmVlZGVkIGZvciB0cmFuc2l0aW9uIHZhbGlkYXRpb25cblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRgXG5cdFx0XHRcdGlkLFxuXHRcdFx0XHRjb21wYW55X2lkLFxuXHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdHNjaGVkdWxlZF9zdGFydCxcblx0XHRcdFx0c2NoZWR1bGVkX2VuZCxcblx0XHRcdFx0YXNzaWduZWRfdG8sXG5cdFx0XHRcdGN1c3RvbWVyX2lkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZCxcblx0XHRcdFx0dG90YWxfYW1vdW50LFxuXHRcdFx0XHRpbnZvaWNlczppbnZvaWNlcyhzdGF0dXMsIHRvdGFsX2Ftb3VudCksXG5cdFx0XHRcdGVzdGltYXRlczplc3RpbWF0ZXMoc3RhdHVzKSxcblx0XHRcdFx0dGVhbV9hc3NpZ25tZW50czpqb2JfdGVhbV9hc3NpZ25tZW50cyh0ZWFtX21lbWJlcl9pZClcblx0XHRcdGAsXG5cdFx0XHQpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhleGlzdGluZ0pvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoZXhpc3RpbmdKb2IuY29tcGFueV9pZCAhPT0gY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQnVpbGQgY29udGV4dCBmb3IgdHJhbnNpdGlvbiB2YWxpZGF0aW9uXG5cdFx0Y29uc3QgdHJhbnNpdGlvbkNvbnRleHQ6IEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0ID0ge1xuXHRcdFx0Y3VycmVudFN0YXR1czogZXhpc3RpbmdKb2Iuc3RhdHVzIGFzIEpvYlN0YXR1cyxcblx0XHRcdG5ld1N0YXR1czogbmV3U3RhdHVzIGFzIEpvYlN0YXR1cyxcblx0XHRcdGpvYjoge1xuXHRcdFx0XHRpZDogZXhpc3RpbmdKb2IuaWQsXG5cdFx0XHRcdHNjaGVkdWxlZF9zdGFydDogZXhpc3RpbmdKb2Iuc2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRzY2hlZHVsZWRfZW5kOiBleGlzdGluZ0pvYi5zY2hlZHVsZWRfZW5kLFxuXHRcdFx0XHRhc3NpZ25lZF90bzogZXhpc3RpbmdKb2IuYXNzaWduZWRfdG8sXG5cdFx0XHRcdGN1c3RvbWVyX2lkOiBleGlzdGluZ0pvYi5jdXN0b21lcl9pZCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IGV4aXN0aW5nSm9iLnByb3BlcnR5X2lkLFxuXHRcdFx0XHR0b3RhbF9hbW91bnQ6IGV4aXN0aW5nSm9iLnRvdGFsX2Ftb3VudCxcblx0XHRcdFx0aW52b2ljZXM6IGV4aXN0aW5nSm9iLmludm9pY2VzIHx8IFtdLFxuXHRcdFx0XHRlc3RpbWF0ZXM6IGV4aXN0aW5nSm9iLmVzdGltYXRlcyB8fCBbXSxcblx0XHRcdFx0dGVhbUFzc2lnbm1lbnRzOiBleGlzdGluZ0pvYi50ZWFtX2Fzc2lnbm1lbnRzIHx8IFtdLFxuXHRcdFx0fSxcblx0XHR9O1xuXG5cdFx0Ly8gVmFsaWRhdGUgdHJhbnNpdGlvbiB3aXRoIGNvbXByZWhlbnNpdmUgYnVzaW5lc3MgcnVsZXNcblx0XHRjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gdmFsaWRhdGVTdGF0dXNUcmFuc2l0aW9uKHRyYW5zaXRpb25Db250ZXh0KTtcblxuXHRcdGlmICghdmFsaWRhdGlvblJlc3VsdC5hbGxvd2VkKSB7XG5cdFx0XHRsZXQgZXJyb3JNZXNzYWdlID1cblx0XHRcdFx0dmFsaWRhdGlvblJlc3VsdC5yZWFzb24gfHwgXCJTdGF0dXMgdHJhbnNpdGlvbiBub3QgYWxsb3dlZFwiO1xuXG5cdFx0XHRpZiAoXG5cdFx0XHRcdHZhbGlkYXRpb25SZXN1bHQucmVxdWlyZWRGaWVsZHMgJiZcblx0XHRcdFx0dmFsaWRhdGlvblJlc3VsdC5yZXF1aXJlZEZpZWxkcy5sZW5ndGggPiAwXG5cdFx0XHQpIHtcblx0XHRcdFx0ZXJyb3JNZXNzYWdlICs9IGAuIE1pc3Npbmc6ICR7dmFsaWRhdGlvblJlc3VsdC5yZXF1aXJlZEZpZWxkcy5qb2luKFwiLCBcIil9YDtcblx0XHRcdH1cblxuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKGVycm9yTWVzc2FnZSwgRVJST1JfQ09ERVMuVkFMSURBVElPTl9GQUlMRUQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyB3YXJuaW5ncyBpZiBwcmVzZW50IChub24tYmxvY2tpbmcpXG5cdFx0aWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCLimqDvuI8gU3RhdHVzIHRyYW5zaXRpb24gd2FybmluZ3M6XCIsIHtcblx0XHRcdFx0am9iSWQsXG5cdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGV4aXN0aW5nSm9iLnN0YXR1cyxcblx0XHRcdFx0bmV3U3RhdHVzLFxuXHRcdFx0XHR3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBzdGF0dXNcblx0XHRjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnVwZGF0ZSh7IHN0YXR1czogbmV3U3RhdHVzIH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwidXBkYXRlIGpvYiBzdGF0dXNcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1FVRVJZX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zb2xlLmxvZyhcIuKchSBKb2Igc3RhdHVzIHVwZGF0ZWQ6XCIsIHtcblx0XHRcdGpvYklkLFxuXHRcdFx0b2xkU3RhdHVzOiBleGlzdGluZ0pvYi5zdGF0dXMsXG5cdFx0XHRuZXdTdGF0dXMsXG5cdFx0fSk7XG5cblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZC93b3JrLyR7am9iSWR9YCk7XG5cdH0pO1xufVxuXG4vKipcbiAqIEFzc2lnbiBqb2IgdG8gYSB0ZWNobmljaWFuXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5hc3NpZ25lZF90b1xuICovXG5hc3luYyBmdW5jdGlvbiBhc3NpZ25Kb2IoXG5cdGpvYklkOiBzdHJpbmcsXG5cdHRlY2huaWNpYW5JZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWRcIilcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0YXNzZXJ0RXhpc3RzKGV4aXN0aW5nSm9iLCBcIkpvYlwiKTtcblxuXHRcdGlmIChleGlzdGluZ0pvYi5jb21wYW55X2lkICE9PSBjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwiam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgdGVjaG5pY2lhbiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IHRlY2huaWNpYW4gfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImNvbXBhbnlfbWVtYmVyc2hpcHNcIilcblx0XHRcdC5zZWxlY3QoXCJ1c2VyX2lkXCIpXG5cdFx0XHQuZXEoXCJ1c2VyX2lkXCIsIHRlY2huaWNpYW5JZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWNobmljaWFuKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiVGVjaG5pY2lhbiBub3QgZm91bmQgaW4geW91ciBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1JFQ09SRF9OT1RfRk9VTkQsXG5cdFx0XHRcdDQwNCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQXNzaWduIGpvYlxuXHRcdGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQudXBkYXRlKHsgYXNzaWduZWRfdG86IHRlY2huaWNpYW5JZCB9KVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpO1xuXG5cdFx0aWYgKHVwZGF0ZUVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImFzc2lnbiBqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1FVRVJZX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZC93b3JrLyR7am9iSWR9YCk7XG5cdH0pO1xufVxuXG4vKipcbiAqIFNjaGVkdWxlIGEgam9iXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icyB0YWJsZSBzY2hlZHVsaW5nIGZpZWxkc1xuICovXG5hc3luYyBmdW5jdGlvbiBzY2hlZHVsZUpvYihcblx0am9iSWQ6IHN0cmluZyxcblx0Zm9ybURhdGE6IEZvcm1EYXRhLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSBzY2hlZHVsZUpvYlNjaGVtYS5wYXJzZSh7XG5cdFx0XHRzY2hlZHVsZWRTdGFydDogZm9ybURhdGEuZ2V0KFwic2NoZWR1bGVkU3RhcnRcIiksXG5cdFx0XHRzY2hlZHVsZWRFbmQ6IGZvcm1EYXRhLmdldChcInNjaGVkdWxlZEVuZFwiKSxcblx0XHR9KTtcblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWQsIHN0YXR1c1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBzY2hlZHVsZSBhbmQgc3RhdHVzXG5cdFx0Y29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRzdGF0dXM6XG5cdFx0XHRcdFx0ZXhpc3RpbmdKb2Iuc3RhdHVzID09PSBcInF1b3RlZFwiID8gXCJzY2hlZHVsZWRcIiA6IGV4aXN0aW5nSm9iLnN0YXR1cyxcblx0XHRcdH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwic2NoZWR1bGUgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0fSk7XG59XG5cbi8qKlxuICogU3RhcnQgYSBqb2JcbiAqIPCflKcgUkVGQUNUT1JFRCAtIE5vdyB1cGRhdGVzIGpvYl90aW1lX3RyYWNraW5nLmFjdHVhbF9zdGFydCBpbnN0ZWFkIG9mIGpvYnMuYWN0dWFsX3N0YXJ0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdGFydEpvYihqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWQsIHN0YXR1c1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbiBvbmx5IHN0YXJ0IHNjaGVkdWxlZCBqb2JzXG5cdFx0aWYgKGV4aXN0aW5nSm9iLnN0YXR1cyAhPT0gXCJzY2hlZHVsZWRcIiAmJiBleGlzdGluZ0pvYi5zdGF0dXMgIT09IFwicXVvdGVkXCIpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgbXVzdCBiZSBzY2hlZHVsZWQgYmVmb3JlIHN0YXJ0aW5nXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuXG5cdFx0Ly8gVXBkYXRlIGJvdGggam9icyB0YWJsZSAoc3RhdHVzKSBhbmQgam9iX3RpbWVfdHJhY2tpbmcgdGFibGUgKGFjdHVhbF9zdGFydCkgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0c3VwYWJhc2UuZnJvbShcImpvYnNcIikudXBkYXRlKHsgc3RhdHVzOiBcImluX3Byb2dyZXNzXCIgfSkuZXEoXCJpZFwiLCBqb2JJZCksXG5cdFx0XHRzdXBhYmFzZVxuXHRcdFx0XHQuZnJvbShcImpvYl90aW1lX3RyYWNraW5nXCIpXG5cdFx0XHRcdC51cGRhdGUoeyBhY3R1YWxfc3RhcnQ6IG5vdyB9KVxuXHRcdFx0XHQuZXEoXCJqb2JfaWRcIiwgam9iSWQpLFxuXHRcdF0pO1xuXG5cdFx0Ly8gQ2hlY2sgZm9yIGVycm9ycyBpbiBlaXRoZXIgdXBkYXRlXG5cdFx0Y29uc3QgZXJyb3JzID0gdXBkYXRlcy5maWx0ZXIoKHJlc3VsdCkgPT4gcmVzdWx0LmVycm9yKTtcblx0XHRpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwic3RhcnQgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBDb21wbGV0ZSBhIGpvYlxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgam9iX3RpbWVfdHJhY2tpbmcuYWN0dWFsX2VuZCBhbmQgY2FsY3VsYXRlcyB0b3RhbF9sYWJvcl9ob3Vyc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29tcGxldGVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHZvaWQ+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IGN1cnJlbnQgdXNlclxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdC8vIEdldCB1c2VyJ3MgYWN0aXZlIGNvbXBhbnkgdXNpbmcgaGVscGVyIChoYW5kbGVzIG11bHRpLWNvbXBhbnkgdXNlcnMpXG5cdFx0Y29uc3QgeyBnZXRBY3RpdmVDb21wYW55SWQgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL2F1dGgvY29tcGFueS1jb250ZXh0XCIpO1xuXHRcdGNvbnN0IGNvbXBhbnlJZCA9IGF3YWl0IGdldEFjdGl2ZUNvbXBhbnlJZCgpO1xuXG5cdFx0aWYgKCFjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGJlbG9uZ3MgdG8gY29tcGFueSBhbmQgZ2V0IHRpbWUgdHJhY2tpbmcgZGF0YVxuXHRcdGNvbnN0IHsgZGF0YTogZXhpc3RpbmdKb2IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkLCBzdGF0dXMsIHRpbWVUcmFja2luZzpqb2JfdGltZV90cmFja2luZygqKVwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbiBvbmx5IGNvbXBsZXRlIGluLXByb2dyZXNzIGpvYnNcblx0XHRpZiAoZXhpc3RpbmdKb2Iuc3RhdHVzICE9PSBcImluX3Byb2dyZXNzXCIpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgbXVzdCBiZSBpbiBwcm9ncmVzcyB0byBjb21wbGV0ZVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcblxuXHRcdC8vIENhbGN1bGF0ZSB0b3RhbCBsYWJvciBob3VycyBpZiB3ZSBoYXZlIGFjdHVhbF9zdGFydFxuXHRcdGNvbnN0IHRpbWVUcmFja2luZyA9IEFycmF5LmlzQXJyYXkoZXhpc3RpbmdKb2IudGltZVRyYWNraW5nKVxuXHRcdFx0PyBleGlzdGluZ0pvYi50aW1lVHJhY2tpbmdbMF1cblx0XHRcdDogZXhpc3RpbmdKb2IudGltZVRyYWNraW5nO1xuXG5cdFx0Y29uc3QgdGltZVRyYWNraW5nVXBkYXRlOiBhbnkgPSB7IGFjdHVhbF9lbmQ6IG5vdyB9O1xuXG5cdFx0aWYgKHRpbWVUcmFja2luZz8uYWN0dWFsX3N0YXJ0KSB7XG5cdFx0XHRjb25zdCBzdGFydFRpbWUgPSBuZXcgRGF0ZSh0aW1lVHJhY2tpbmcuYWN0dWFsX3N0YXJ0KS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBlbmRUaW1lID0gbmV3IERhdGUobm93KS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBob3Vyc1dvcmtlZCA9IChlbmRUaW1lIC0gc3RhcnRUaW1lKSAvICgxMDAwICogNjAgKiA2MCk7IC8vIENvbnZlcnQgbXMgdG8gaG91cnNcblx0XHRcdHRpbWVUcmFja2luZ1VwZGF0ZS50b3RhbF9sYWJvcl9ob3VycyA9IGhvdXJzV29ya2VkO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBib3RoIGpvYnMgdGFibGUgKHN0YXR1cykgYW5kIGpvYl90aW1lX3RyYWNraW5nIHRhYmxlIChhY3R1YWxfZW5kLCB0b3RhbF9sYWJvcl9ob3VycykgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0c3VwYWJhc2UuZnJvbShcImpvYnNcIikudXBkYXRlKHsgc3RhdHVzOiBcImNvbXBsZXRlZFwiIH0pLmVxKFwiaWRcIiwgam9iSWQpLFxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfdGltZV90cmFja2luZ1wiKVxuXHRcdFx0XHQudXBkYXRlKHRpbWVUcmFja2luZ1VwZGF0ZSlcblx0XHRcdFx0LmVxKFwiam9iX2lkXCIsIGpvYklkKSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gZWl0aGVyIHVwZGF0ZVxuXHRcdGNvbnN0IGVycm9ycyA9IHVwZGF0ZXMuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5lcnJvcik7XG5cdFx0aWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImNvbXBsZXRlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0fSk7XG59XG5cbi8qKlxuICogQ2FuY2VsIGEgam9iXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5zdGF0dXMgYW5kIGpvYnMubm90ZXNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gY2FuY2VsSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRyZWFzb24/OiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBjdXJyZW50IHVzZXJcblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzLCBub3Rlc1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbm5vdCBjYW5jZWwgY29tcGxldGVkIGpvYnNcblx0XHRpZiAoZXhpc3RpbmdKb2Iuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiQ2Fubm90IGNhbmNlbCBjb21wbGV0ZWQgam9ic1wiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEFkZCBjYW5jZWxsYXRpb24gcmVhc29uIHRvIG5vdGVzXG5cdFx0Y29uc3QgdXBkYXRlZE5vdGVzID0gcmVhc29uXG5cdFx0XHQ/IGAke2V4aXN0aW5nSm9iLm5vdGVzIHx8IFwiXCJ9XFxuXFxuW0NBTkNFTExFRF06ICR7cmVhc29ufWAudHJpbSgpXG5cdFx0XHQ6IGV4aXN0aW5nSm9iLm5vdGVzO1xuXG5cdFx0Ly8gQ2FuY2VsIGpvYlxuXHRcdGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0c3RhdHVzOiBcImNhbmNlbGxlZFwiLFxuXHRcdFx0XHRub3RlczogdXBkYXRlZE5vdGVzLFxuXHRcdFx0fSlcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKTtcblxuXHRcdGlmICh1cGRhdGVFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJjYW5jZWwgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBTZWFyY2ggam9icyB3aXRoIGZ1bGwtdGV4dCBzZWFyY2ggYW5kIHJhbmtpbmdcbiAqIOKchSBOTyBDSEFOR0VTIE5FRURFRCAtIE9ubHkgc2VhcmNoZXMgam9icyB0YWJsZVxuICovXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hKb2JzKFxuXHRzZWFyY2hUZXJtOiBzdHJpbmcsXG5cdG9wdGlvbnM/OiB7IGxpbWl0PzogbnVtYmVyOyBvZmZzZXQ/OiBudW1iZXIgfSxcbik6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueVtdPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiY29tcGFueV9tZW1iZXJzaGlwc1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWRcIilcblx0XHRcdC5lcShcInVzZXJfaWRcIiwgdXNlci5pZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGlmICghdGVhbU1lbWJlcj8uY29tcGFueV9pZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVzZSBmdWxsLXRleHQgc2VhcmNoIHdpdGggcmFua2luZyBmb3IgYmVzdCBtYXRjaGVzXG5cdFx0Y29uc3QgeyBzZWFyY2hKb2JzRnVsbFRleHQgfSA9IGF3YWl0IGltcG9ydChcblx0XHRcdFwiQC9saWIvc2VhcmNoL2Z1bGwtdGV4dC1zZWFyY2hcIlxuXHRcdCk7XG5cblx0XHRjb25zdCBqb2JzID0gYXdhaXQgc2VhcmNoSm9ic0Z1bGxUZXh0KHN1cGFiYXNlLCB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQsIHNlYXJjaFRlcm0sIHtcblx0XHRcdGxpbWl0OiBvcHRpb25zPy5saW1pdCB8fCA1MCxcblx0XHRcdG9mZnNldDogb3B0aW9ucz8ub2Zmc2V0IHx8IDAsXG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gam9icztcblx0fSk7XG59XG5cbi8qKlxuICogVW5pdmVyc2FsIHNlYXJjaCBhY3Jvc3MgYWxsIGVudGl0aWVzXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHNlYXJjaGVzIGpvYnMgdGFibGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2VhcmNoQWxsKFxuXHRzZWFyY2hUZXJtOiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDxhbnk+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Y29uc3QgeyBkYXRhOiB0ZWFtTWVtYmVyIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjb21wYW55X21lbWJlcnNoaXBzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWFtTWVtYmVyPy5jb21wYW55X2lkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVXNlIHVuaXZlcnNhbCBzZWFyY2ggUlBDIGZ1bmN0aW9uXG5cdFx0Y29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UucnBjKFwic2VhcmNoX2FsbF9lbnRpdGllc1wiLCB7XG5cdFx0XHRjb21wYW55X2lkX3BhcmFtOiB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQsXG5cdFx0XHRzZWFyY2hfcXVlcnk6IHNlYXJjaFRlcm0sXG5cdFx0XHRwZXJfZW50aXR5X2xpbWl0OiA1LFxuXHRcdH0pO1xuXG5cdFx0aWYgKGVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcInNlYXJjaFwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBkYXRhO1xuXHR9KTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSk9CIEFSQ0hJVkUgJiBSRVNUT1JFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogQXJjaGl2ZSBqb2IgKHNvZnQgZGVsZXRlKVxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgam9iX211bHRpX2VudGl0eS5kZWxldGVkX2J5IGFuZCBwZXJtYW5lbnRfZGVsZXRlX3NjaGVkdWxlZF9hdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXJjaGl2ZUpvYihqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHRjb25zdCB7IGRhdGE6IHRlYW1NZW1iZXIgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImNvbXBhbnlfbWVtYmVyc2hpcHNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJ1c2VyX2lkXCIsIHVzZXIuaWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoIXRlYW1NZW1iZXI/LmNvbXBhbnlfaWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogam9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGpvYi5jb21wYW55X2lkICE9PSB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwiam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBDYW5ub3QgYXJjaGl2ZSBjb21wbGV0ZWQvcGFpZCBqb2JzIChidXNpbmVzcyBydWxlKVxuXHRcdGlmIChqb2Iuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiIHx8IGpvYi5zdGF0dXMgPT09IFwiaW52b2ljZWRcIikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkNhbm5vdCBhcmNoaXZlIGNvbXBsZXRlZCBvciBpbnZvaWNlZCBqb2JzLiBUaGVzZSBtdXN0IGJlIHJldGFpbmVkIGZvciByZWNvcmRzLlwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEFyY2hpdmUgam9iIChzb2Z0IGRlbGV0ZSlcblx0XHRjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG5cdFx0Y29uc3Qgc2NoZWR1bGVkRGVsZXRpb24gPSBuZXcgRGF0ZShcblx0XHRcdERhdGUubm93KCkgKyA5MCAqIDI0ICogNjAgKiA2MCAqIDEwMDAsXG5cdFx0KS50b0lTT1N0cmluZygpO1xuXG5cdFx0Ly8gVXBkYXRlIGJvdGggam9icyB0YWJsZSBhbmQgam9iX211bHRpX2VudGl0eSB0YWJsZSBpbiBwYXJhbGxlbFxuXHRcdGNvbnN0IHVwZGF0ZXMgPSBhd2FpdCBQcm9taXNlLmFsbChbXG5cdFx0XHQvLyBVcGRhdGUgY29yZSBqb2JzIHRhYmxlIHdpdGggYXJjaGl2ZSBtZXRhZGF0YVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRcdGRlbGV0ZWRfYXQ6IG5vdyxcblx0XHRcdFx0XHRhcmNoaXZlZF9hdDogbm93LFxuXHRcdFx0XHRcdHN0YXR1czogXCJhcmNoaXZlZFwiLFxuXHRcdFx0XHR9KVxuXHRcdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCksXG5cblx0XHRcdC8vIFVwZGF0ZSBqb2JfbXVsdGlfZW50aXR5IHRhYmxlIHdpdGggZGVsZXRpb24gdHJhY2tpbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX211bHRpX2VudGl0eVwiKVxuXHRcdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0XHRkZWxldGVkX2J5OiB1c2VyLmlkLFxuXHRcdFx0XHRcdHBlcm1hbmVudF9kZWxldGVfc2NoZWR1bGVkX2F0OiBzY2hlZHVsZWREZWxldGlvbixcblx0XHRcdFx0fSlcblx0XHRcdFx0LmVxKFwiam9iX2lkXCIsIGpvYklkKSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gZWl0aGVyIHVwZGF0ZVxuXHRcdGNvbnN0IGVycm9ycyA9IHVwZGF0ZXMuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5lcnJvcik7XG5cdFx0aWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImFyY2hpdmUgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9zZXR0aW5ncy9hcmNoaXZlXCIpO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBSZXN0b3JlIGFyY2hpdmVkIGpvYlxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IGNsZWFycyBqb2JfbXVsdGlfZW50aXR5LmRlbGV0ZWRfYnkgYW5kIHBlcm1hbmVudF9kZWxldGVfc2NoZWR1bGVkX2F0XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlc3RvcmVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHZvaWQ+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Y29uc3QgeyBkYXRhOiB0ZWFtTWVtYmVyIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjb21wYW55X21lbWJlcnNoaXBzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWFtTWVtYmVyPy5jb21wYW55X2lkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnkgYW5kIGlzIGFyY2hpdmVkXG5cdFx0Y29uc3QgeyBkYXRhOiBqb2IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkLCBkZWxldGVkX2F0LCBzdGF0dXNcIilcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0YXNzZXJ0RXhpc3RzKGpvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoam9iLmNvbXBhbnlfaWQgIT09IHRlYW1NZW1iZXIuY29tcGFueV9pZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmICgham9iLmRlbGV0ZWRfYXQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgaXMgbm90IGFyY2hpdmVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmVzdG9yZSBqb2IgLSB1cGRhdGUgYm90aCB0YWJsZXMgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0Ly8gQ2xlYXIgY29yZSBqb2JzIHRhYmxlIGFyY2hpdmUgbWV0YWRhdGFcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0XHRkZWxldGVkX2F0OiBudWxsLFxuXHRcdFx0XHRcdGFyY2hpdmVkX2F0OiBudWxsLFxuXHRcdFx0XHRcdHN0YXR1czogam9iLnN0YXR1cyA9PT0gXCJhcmNoaXZlZFwiID8gXCJzY2hlZHVsZWRcIiA6IGpvYi5zdGF0dXMsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5lcShcImlkXCIsIGpvYklkKSxcblxuXHRcdFx0Ly8gQ2xlYXIgam9iX211bHRpX2VudGl0eSB0YWJsZSBkZWxldGlvbiB0cmFja2luZ1xuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfbXVsdGlfZW50aXR5XCIpXG5cdFx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRcdGRlbGV0ZWRfYnk6IG51bGwsXG5cdFx0XHRcdFx0cGVybWFuZW50X2RlbGV0ZV9zY2hlZHVsZWRfYXQ6IG51bGwsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5lcShcImpvYl9pZFwiLCBqb2JJZCksXG5cdFx0XSk7XG5cblx0XHQvLyBDaGVjayBmb3IgZXJyb3JzIGluIGVpdGhlciB1cGRhdGVcblx0XHRjb25zdCBlcnJvcnMgPSB1cGRhdGVzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuZXJyb3IpO1xuXHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJyZXN0b3JlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9zY2hlZHVsZVwiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvc2V0dGluZ3MvYXJjaGl2ZVwiKTtcblx0fSk7XG59XG5cbi8qKlxuICogUmVtb3ZlIHRlYW0gYXNzaWdubWVudCBmcm9tIGpvYlxuICog4pyFIE5PIENIQU5HRVMgTkVFREVEIC0gT25seSBkZWxldGVzIGZyb20gam9iX3RlYW1fYXNzaWdubWVudHMganVuY3Rpb24gdGFibGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVtb3ZlVGVhbUFzc2lnbm1lbnQoXG5cdGFzc2lnbm1lbnRJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IHRoZSBqdW5jdGlvbiByZWNvcmQgdG8gZmluZCBqb2JfaWQgZm9yIHJldmFsaWRhdGlvblxuXHRcdGNvbnN0IHsgZGF0YTogcmVjb3JkLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9iX3RlYW1fYXNzaWdubWVudHNcIilcblx0XHRcdC5zZWxlY3QoXCJpZCwgam9iX2lkLCBjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBhc3NpZ25tZW50SWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoZmV0Y2hFcnJvciB8fCAhcmVjb3JkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiVGVhbSBhc3NpZ25tZW50IG5vdCBmb3VuZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9SRUNPUkRfTk9UX0ZPVU5ELFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAocmVjb3JkLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJ0ZWFtIGFzc2lnbm1lbnRcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGpvYklkID0gcmVjb3JkLmpvYl9pZDtcblxuXHRcdC8vIERlbGV0ZSBqdW5jdGlvbiB0YWJsZSByb3dcblx0XHRjb25zdCB7IGVycm9yOiBkZWxldGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9iX3RlYW1fYXNzaWdubWVudHNcIilcblx0XHRcdC5kZWxldGUoKVxuXHRcdFx0LmVxKFwiaWRcIiwgYXNzaWdubWVudElkKTtcblxuXHRcdGlmIChkZWxldGVFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJyZW1vdmUgdGVhbSBhc3NpZ25tZW50IGZyb20gam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmV2YWxpZGF0ZSBqb2IgcGFnZSBhbmQgc2NoZWR1bGVcblx0XHRpZiAoam9iSWQpIHtcblx0XHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0XHR9XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBBc3NpZ24gQ3VzdG9tZXIgYW5kIFByb3BlcnR5IHRvIEpvYlxuICpcbiAqIFVwZGF0ZXMgdGhlIGpvYidzIGN1c3RvbWVyX2lkIGFuZCBwcm9wZXJ0eV9pZC5cbiAqIE9ubHkgb25lIGN1c3RvbWVyIGFuZCBwcm9wZXJ0eSBjYW4gYmUgYXNzaWduZWQgcGVyIGpvYi5cbiAqXG4gKiBAcGFyYW0gam9iSWQgLSBKb2IgSURcbiAqIEBwYXJhbSBjdXN0b21lcklkIC0gQ3VzdG9tZXIgSUQgdG8gYXNzaWduXG4gKiBAcGFyYW0gcHJvcGVydHlJZCAtIFByb3BlcnR5IElEIHRvIGFzc2lnbiAob3B0aW9uYWwpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhc3NpZ25DdXN0b21lclRvSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRjdXN0b21lcklkOiBzdHJpbmcsXG5cdHByb3BlcnR5SWQ6IHN0cmluZyB8IG51bGwsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdGNvbnN0IGNvbXBhbnlJZCA9IGF3YWl0IGdldEFjdGl2ZUNvbXBhbnlJZCgpO1xuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImNvbXBhbnkgYWNjZXNzXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGV4aXN0cyBhbmQgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBqb2IsIGVycm9yOiBqb2JFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImlkLCBjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LmlzKFwiZGVsZXRlZF9hdFwiLCBudWxsKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGpvYkVycm9yKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKFwiSm9iIHF1ZXJ5IGVycm9yOlwiLCBqb2JFcnJvcik7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmluZCBqb2I6ICR7am9iRXJyb3IubWVzc2FnZX1gLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdFx0NTAwLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRhc3NlcnRFeGlzdHMoam9iLCBcIkpvYlwiKTtcblxuXHRcdC8vIFZlcmlmeSBjdXN0b21lciBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogY3VzdG9tZXIsIGVycm9yOiBjdXN0b21lckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjdXN0b21lcnNcIilcblx0XHRcdC5zZWxlY3QoXCJpZCwgY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgY3VzdG9tZXJJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LmlzKFwiZGVsZXRlZF9hdFwiLCBudWxsKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGN1c3RvbWVyRXJyb3IpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJDdXN0b21lciBxdWVyeSBlcnJvcjpcIiwgY3VzdG9tZXJFcnJvcik7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmluZCBjdXN0b21lcjogJHtjdXN0b21lckVycm9yLm1lc3NhZ2V9YCxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHRcdDUwMCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0YXNzZXJ0RXhpc3RzKGN1c3RvbWVyLCBcIkN1c3RvbWVyXCIpO1xuXG5cdFx0Ly8gSWYgcHJvcGVydHkgaXMgcHJvdmlkZWQsIHZlcmlmeSBpdCBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY3VzdG9tZXJcblx0XHRpZiAocHJvcGVydHlJZCkge1xuXHRcdFx0Y29uc3QgeyBkYXRhOiBwcm9wZXJ0eSB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJwcm9wZXJ0aWVzXCIpXG5cdFx0XHRcdC5zZWxlY3QoXCJpZCwgY3VzdG9tZXJfaWRcIilcblx0XHRcdFx0LmVxKFwiaWRcIiwgcHJvcGVydHlJZClcblx0XHRcdFx0LmVxKFwiY3VzdG9tZXJfaWRcIiwgY3VzdG9tZXJJZClcblx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRpZiAoIXByb3BlcnR5KSB7XG5cdFx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XHRcIlByb3BlcnR5IG5vdCBmb3VuZCBvciBkb2VzIG5vdCBiZWxvbmcgdG8gdGhpcyBjdXN0b21lclwiLFxuXHRcdFx0XHRcdEVSUk9SX0NPREVTLkRCX1JFQ09SRF9OT1RfRk9VTkQsXG5cdFx0XHRcdFx0NDA0LFxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBqb2Igd2l0aCBjdXN0b21lciBhbmQgcHJvcGVydHlcblx0XHRjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnVwZGF0ZSh7XG5cdFx0XHRcdGN1c3RvbWVyX2lkOiBjdXN0b21lcklkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogcHJvcGVydHlJZCxcblx0XHRcdH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiYXNzaWduIGN1c3RvbWVyIHRvIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyBhY3Rpdml0eVxuXHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JfYWN0aXZpdHlfbG9nXCIpLmluc2VydCh7XG5cdFx0XHRqb2JfaWQ6IGpvYklkLFxuXHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0dXNlcl9pZDogdXNlci5pZCxcblx0XHRcdGFjdGl2aXR5X3R5cGU6IFwiYXNzaWduZWRcIixcblx0XHRcdGVudGl0eV90eXBlOiBcImN1c3RvbWVyXCIsXG5cdFx0XHRkZXNjcmlwdGlvbjogYEFzc2lnbmVkIGN1c3RvbWVyJHtwcm9wZXJ0eUlkID8gXCIgYW5kIHByb3BlcnR5XCIgOiBcIlwifWAsXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IHByb3BlcnR5SWQsXG5cdFx0XHR9LFxuXHRcdH0pO1xuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL3dlbGNvbWVcIik7XG5cdH0pO1xufVxuXG4vKipcbiAqIFJlbW92ZSBDdXN0b21lciBhbmQgUHJvcGVydHkgZnJvbSBKb2JcbiAqXG4gKiBSZW1vdmVzIHRoZSBjdXN0b21lcl9pZCBhbmQgcHJvcGVydHlfaWQgZnJvbSB0aGUgam9iLlxuICogUmVsYXRlZCBkYXRhIChhcHBvaW50bWVudHMsIGludm9pY2VzLCBldGMuKSByZW1haW4gYnV0IGFyZSBubyBsb25nZXIgbGlua2VkLlxuICpcbiAqIEBwYXJhbSBqb2JJZCAtIEpvYiBJRFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVtb3ZlQ3VzdG9tZXJGcm9tSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJjb21wYW55IGFjY2Vzc1wiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogam9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiaWQsIGNvbXBhbnlfaWQsIGN1c3RvbWVyX2lkLCBwcm9wZXJ0eV9pZFwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuZXEoXCJjb21wYW55X2lkXCIsIGNvbXBhbnlJZClcblx0XHRcdC5pcyhcImRlbGV0ZWRfYXRcIiwgbnVsbClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0Ly8gVXBkYXRlIGpvYiB0byByZW1vdmUgY3VzdG9tZXIgYW5kIHByb3BlcnR5XG5cdFx0Y29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRjdXN0b21lcl9pZDogbnVsbCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IG51bGwsXG5cdFx0XHR9KVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpO1xuXG5cdFx0aWYgKHVwZGF0ZUVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcInJlbW92ZSBjdXN0b21lciBmcm9tIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyBhY3Rpdml0eVxuXHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JfYWN0aXZpdHlfbG9nXCIpLmluc2VydCh7XG5cdFx0XHRqb2JfaWQ6IGpvYklkLFxuXHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0dXNlcl9pZDogdXNlci5pZCxcblx0XHRcdGFjdGl2aXR5X3R5cGU6IFwicmVtb3ZlZFwiLFxuXHRcdFx0ZW50aXR5X3R5cGU6IFwiY3VzdG9tZXJcIixcblx0XHRcdGRlc2NyaXB0aW9uOiBcIlJlbW92ZWQgY3VzdG9tZXIgYW5kIHByb3BlcnR5XCIsXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRwcmV2aW91c19jdXN0b21lcl9pZDogam9iLmN1c3RvbWVyX2lkLFxuXHRcdFx0XHRwcmV2aW91c19wcm9wZXJ0eV9pZDogam9iLnByb3BlcnR5X2lkLFxuXHRcdFx0fSxcblx0XHR9KTtcblxuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi93ZWxjb21lXCIpO1xuXHR9KTtcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoicVNBZzhCc0IifQ==
}),
"[project]/apps/web/src/actions/data:deb155 [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"406504edbc398e68ff09bd4b91ad5a9c3ca0b44f87":"startJob"},"apps/web/src/actions/jobs.ts",""] */ __turbopack_context__.s([
    "startJob",
    ()=>startJob
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next@16.0.4_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
"use turbopack no side effects";
;
var startJob = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("406504edbc398e68ff09bd4b91ad5a9c3ca0b44f87", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "startJob"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vam9icy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEpvYnMgU2VydmVyIEFjdGlvbnMgLSBSRUZBQ1RPUkVEIEZPUiBET01BSU4gVEFCTEUgU1RSVUNUVVJFXG4gKlxuICogSGFuZGxlcyBqb2Ivd29yayBvcmRlciBtYW5hZ2VtZW50IHdpdGggY29tcHJlaGVuc2l2ZSBDUlVEIG9wZXJhdGlvbnMsXG4gKiBzdGF0dXMgdHJhbnNpdGlvbnMsIHNjaGVkdWxpbmcsIGFuZCBhc3NpZ25tZW50IGxvZ2ljLlxuICpcbiAqIE1JR1JBVElPTiBOT1RFUzpcbiAqIC0gQ29yZSBqb2JzIHRhYmxlIG5vdyBoYXMgfjIwIGNvbHVtbnNcbiAqIC0gRG9tYWluLXNwZWNpZmljIGRhdGEgbW92ZWQgdG8gMTEgZG9tYWluIHRhYmxlc1xuICogLSBGaW5hbmNpYWwgZGF0YSAtPiBqb2JfZmluYW5jaWFsXG4gKiAtIFRpbWUgdHJhY2tpbmcgLT4gam9iX3RpbWVfdHJhY2tpbmdcbiAqIC0gQXJjaGl2ZS9kZWxldGlvbiAtPiBqb2JfbXVsdGlfZW50aXR5XG4gKiAtIEFsbCBkb21haW4gdGFibGVzIGhhdmUgQ0FTQ0FERSBkZWxldGUgb24gam9iX2lkXG4gKi9cblxuXCJ1c2Ugc2VydmVyXCI7XG5cbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5pbXBvcnQgeyBnZXRBY3RpdmVDb21wYW55SWQgfSBmcm9tIFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIjtcbmltcG9ydCB7XG5cdEFjdGlvbkVycm9yLFxuXHRFUlJPUl9DT0RFUyxcblx0RVJST1JfTUVTU0FHRVMsXG59IGZyb20gXCJAL2xpYi9lcnJvcnMvYWN0aW9uLWVycm9yXCI7XG5pbXBvcnQge1xuXHR0eXBlIEFjdGlvblJlc3VsdCxcblx0YXNzZXJ0QXV0aGVudGljYXRlZCxcblx0YXNzZXJ0RXhpc3RzLFxuXHR3aXRoRXJyb3JIYW5kbGluZyxcbn0gZnJvbSBcIkAvbGliL2Vycm9ycy93aXRoLWVycm9yLWhhbmRsaW5nXCI7XG5pbXBvcnQgeyBub3RpZnlKb2JDcmVhdGVkIH0gZnJvbSBcIkAvbGliL25vdGlmaWNhdGlvbnMvdHJpZ2dlcnNcIjtcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAL2xpYi9zdXBhYmFzZS9zZXJ2ZXJcIjtcbmltcG9ydCB7XG5cdHR5cGUgSm9iU3RhdHVzLFxuXHR0eXBlIEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0LFxuXHR2YWxpZGF0ZVN0YXR1c1RyYW5zaXRpb24sXG59IGZyb20gXCJAL2xpYi92YWxpZGF0aW9ucy9qb2Itc3RhdHVzLXRyYW5zaXRpb25zXCI7XG5cbi8vIFJlZ2V4IGNvbnN0YW50c1xuY29uc3QgSk9CX05VTUJFUl9SRUdFWCA9IC9KT0ItXFxkezR9LShcXGQrKS87XG5cbi8vIFZhbGlkYXRpb24gU2NoZW1hc1xuY29uc3QgY3JlYXRlSm9iU2NoZW1hID0gei5vYmplY3Qoe1xuXHRwcm9wZXJ0eUlkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIHByb3BlcnR5IElEXCIpLFxuXHRjdXN0b21lcklkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIGN1c3RvbWVyIElEXCIpLm9wdGlvbmFsKCksXG5cdHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCBcIkpvYiB0aXRsZSBpcyByZXF1aXJlZFwiKSxcblx0ZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblx0cHJpb3JpdHk6IHouZW51bShbXCJsb3dcIiwgXCJtZWRpdW1cIiwgXCJoaWdoXCIsIFwidXJnZW50XCJdKS5kZWZhdWx0KFwibWVkaXVtXCIpLFxuXHRqb2JUeXBlOiB6XG5cdFx0LmVudW0oW1xuXHRcdFx0XCJzZXJ2aWNlXCIsXG5cdFx0XHRcImluc3RhbGxhdGlvblwiLFxuXHRcdFx0XCJyZXBhaXJcIixcblx0XHRcdFwibWFpbnRlbmFuY2VcIixcblx0XHRcdFwiaW5zcGVjdGlvblwiLFxuXHRcdFx0XCJjb25zdWx0YXRpb25cIixcblx0XHRdKVxuXHRcdC5vcHRpb25hbCgpLFxuXHRzY2hlZHVsZWRTdGFydDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRzY2hlZHVsZWRFbmQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblx0YXNzaWduZWRUbzogei5zdHJpbmcoKS51dWlkKFwiSW52YWxpZCB1c2VyIElEXCIpLm9wdGlvbmFsKCksXG5cdG5vdGVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdC8vIEVuaGFuY2VkIHNjaGVkdWxpbmcgZmllbGRzXG5cdGlzUmVjdXJyaW5nOiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuXHRzY2hlZHVsaW5nTW9kZTogei5lbnVtKFtcInNwZWNpZmljXCIsIFwid2luZG93XCJdKS5vcHRpb25hbCgpLFxuXHR0aW1lV2luZG93OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VUeXBlOiB6XG5cdFx0LmVudW0oW1wiZGFpbHlcIiwgXCJ3ZWVrbHlcIiwgXCJiaXdlZWtseVwiLCBcIm1vbnRobHlcIiwgXCJxdWFydGVybHlcIiwgXCJ5ZWFybHlcIl0pXG5cdFx0Lm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VFbmREYXRlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VDb3VudDogei5udW1iZXIoKS5pbnQoKS5taW4oMSkubWF4KDM2NSkub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCB1cGRhdGVKb2JTY2hlbWEgPSB6Lm9iamVjdCh7XG5cdHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCBcIkpvYiB0aXRsZSBpcyByZXF1aXJlZFwiKS5vcHRpb25hbCgpLFxuXHRkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRzdGF0dXM6IHpcblx0XHQuZW51bShbXG5cdFx0XHRcInF1b3RlZFwiLFxuXHRcdFx0XCJzY2hlZHVsZWRcIixcblx0XHRcdFwiaW5fcHJvZ3Jlc3NcIixcblx0XHRcdFwib25faG9sZFwiLFxuXHRcdFx0XCJjb21wbGV0ZWRcIixcblx0XHRcdFwiY2FuY2VsbGVkXCIsXG5cdFx0XHRcImludm9pY2VkXCIsXG5cdFx0XHRcInBhaWRcIixcblx0XHRdKVxuXHRcdC5vcHRpb25hbCgpLFxuXHRwcmlvcml0eTogei5lbnVtKFtcImxvd1wiLCBcIm1lZGl1bVwiLCBcImhpZ2hcIiwgXCJ1cmdlbnRcIl0pLm9wdGlvbmFsKCksXG5cdGpvYlR5cGU6IHpcblx0XHQuZW51bShbXG5cdFx0XHRcInNlcnZpY2VcIixcblx0XHRcdFwiaW5zdGFsbGF0aW9uXCIsXG5cdFx0XHRcInJlcGFpclwiLFxuXHRcdFx0XCJtYWludGVuYW5jZVwiLFxuXHRcdFx0XCJpbnNwZWN0aW9uXCIsXG5cdFx0XHRcImNvbnN1bHRhdGlvblwiLFxuXHRcdF0pXG5cdFx0Lm9wdGlvbmFsKCksXG5cdG5vdGVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdC8vIEZpbmFuY2lhbCBmaWVsZHMgKG5vdyBpbiBqb2JfZmluYW5jaWFsIGRvbWFpbiB0YWJsZSlcblx0dG90YWxBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdHBhaWRBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdGRlcG9zaXRBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdHNjaGVkdWxlZFN0YXJ0OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHNjaGVkdWxlZEVuZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRhc3NpZ25lZFRvOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIHVzZXIgSURcIikub3B0aW9uYWwoKS5udWxsYWJsZSgpLFxuXHRjdXN0b21lcklkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIGN1c3RvbWVyIElEXCIpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcblx0cHJvcGVydHlJZDogei5zdHJpbmcoKS51dWlkKFwiSW52YWxpZCBwcm9wZXJ0eSBJRFwiKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG59KTtcblxuLy8gVHlwZSBmb3IgdXBkYXRlSm9iRGF0YSAtIG1ha2VzIGl0IGVhc2llciB0byB1c2UgcHJvZ3JhbW1hdGljYWxseVxuZXhwb3J0IHR5cGUgVXBkYXRlSm9iRGF0YSA9IHouaW5mZXI8dHlwZW9mIHVwZGF0ZUpvYlNjaGVtYT47XG5cbmNvbnN0IHNjaGVkdWxlSm9iU2NoZW1hID0gei5vYmplY3Qoe1xuXHRzY2hlZHVsZWRTdGFydDogei5zdHJpbmcoKSxcblx0c2NoZWR1bGVkRW5kOiB6LnN0cmluZygpLFxufSk7XG5cbi8qKlxuICogR2VuZXJhdGUgdW5pcXVlIGpvYiBudW1iZXJcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVKb2JOdW1iZXIoXG5cdHN1cGFiYXNlOiBhbnksXG5cdGNvbXBhbnlJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxzdHJpbmc+IHtcblx0Ly8gR2V0IHRoZSBsYXRlc3Qgam9iIG51bWJlciBmb3IgdGhpcyBjb21wYW55XG5cdGNvbnN0IHsgZGF0YTogbGF0ZXN0Sm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdC5zZWxlY3QoXCJqb2JfbnVtYmVyXCIpXG5cdFx0LmVxKFwiY29tcGFueV9pZFwiLCBjb21wYW55SWQpXG5cdFx0Lm9yZGVyKFwiY3JlYXRlZF9hdFwiLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcblx0XHQubGltaXQoMSlcblx0XHQuc2luZ2xlKCk7XG5cblx0aWYgKCFsYXRlc3RKb2IpIHtcblx0XHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tMDAxYDtcblx0fVxuXG5cdC8vIEV4dHJhY3QgbnVtYmVyIGZyb20gZm9ybWF0OiBKT0ItWVlZWS1OTk5cblx0Y29uc3QgbWF0Y2ggPSBsYXRlc3RKb2Iuam9iX251bWJlci5tYXRjaChKT0JfTlVNQkVSX1JFR0VYKTtcblx0aWYgKG1hdGNoKSB7XG5cdFx0Y29uc3QgbmV4dE51bWJlciA9IE51bWJlci5wYXJzZUludChtYXRjaFsxXSwgMTApICsgMTtcblx0XHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tJHtuZXh0TnVtYmVyLnRvU3RyaW5nKCkucGFkU3RhcnQoMywgXCIwXCIpfWA7XG5cdH1cblxuXHQvLyBGYWxsYmFja1xuXHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tJHtEYXRlLm5vdygpLnRvU3RyaW5nKCkuc2xpY2UoLTMpfWA7XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIG5leHQgcmVjdXJyZW5jZSBkYXRlXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZU5leHRSZWN1cnJlbmNlKFxuXHRjdXJyZW50RGF0ZTogRGF0ZSxcblx0cmVjdXJyZW5jZVR5cGU6IHN0cmluZyxcbik6IERhdGUge1xuXHRjb25zdCBuZXh0RGF0ZSA9IG5ldyBEYXRlKGN1cnJlbnREYXRlKTtcblxuXHRzd2l0Y2ggKHJlY3VycmVuY2VUeXBlKSB7XG5cdFx0Y2FzZSBcImRhaWx5XCI6XG5cdFx0XHRuZXh0RGF0ZS5zZXREYXRlKG5leHREYXRlLmdldERhdGUoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcIndlZWtseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RGF0ZShuZXh0RGF0ZS5nZXREYXRlKCkgKyA3KTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgXCJiaXdlZWtseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RGF0ZShuZXh0RGF0ZS5nZXREYXRlKCkgKyAxNCk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlIFwibW9udGhseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0TW9udGgobmV4dERhdGUuZ2V0TW9udGgoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcInF1YXJ0ZXJseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0TW9udGgobmV4dERhdGUuZ2V0TW9udGgoKSArIDMpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcInllYXJseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RnVsbFllYXIobmV4dERhdGUuZ2V0RnVsbFllYXIoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0ZGVmYXVsdDpcblx0XHRcdC8vIERlZmF1bHQgdG8gbW9udGhseSBpZiB1bmtub3duIHR5cGVcblx0XHRcdG5leHREYXRlLnNldE1vbnRoKG5leHREYXRlLmdldE1vbnRoKCkgKyAxKTtcblx0XHRcdGJyZWFrO1xuXHR9XG5cblx0cmV0dXJuIG5leHREYXRlO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZWN1cnJpbmcgam9ic1xuICovXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVSZWN1cnJpbmdKb2JzKFxuXHRzdXBhYmFzZTogYW55LFxuXHRjb21wYW55SWQ6IHN0cmluZyxcblx0YmFzZUpvYjogYW55LFxuXHRyZWN1cnJlbmNlVHlwZTogc3RyaW5nLFxuXHRyZWN1cnJlbmNlRW5kRGF0ZT86IHN0cmluZyxcblx0cmVjdXJyZW5jZUNvdW50PzogbnVtYmVyLFxuKTogUHJvbWlzZTx2b2lkPiB7XG5cdGlmICghYmFzZUpvYi5zY2hlZHVsZWRfc3RhcnQpIHtcblx0XHRyZXR1cm47IC8vIENhbid0IGNyZWF0ZSByZWN1cnJpbmcgam9icyB3aXRob3V0IGEgc3RhcnQgZGF0ZVxuXHR9XG5cblx0Y29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoYmFzZUpvYi5zY2hlZHVsZWRfc3RhcnQpO1xuXHRjb25zdCBlbmREYXRlID0gbmV3IERhdGUoYmFzZUpvYi5zY2hlZHVsZWRfZW5kIHx8IGJhc2VKb2Iuc2NoZWR1bGVkX3N0YXJ0KTtcblx0Y29uc3QgZHVyYXRpb24gPSBlbmREYXRlLmdldFRpbWUoKSAtIHN0YXJ0RGF0ZS5nZXRUaW1lKCk7XG5cblx0Ly8gRGV0ZXJtaW5lIGhvdyBtYW55IG9jY3VycmVuY2VzIHRvIGNyZWF0ZVxuXHRjb25zdCBtYXhPY2N1cnJlbmNlcyA9IHJlY3VycmVuY2VDb3VudCB8fCA1MjsgLy8gRGVmYXVsdCB0byAxIHllYXIgb2Ygd2Vla2x5IGpvYnNcblx0Y29uc3QgZW5kRGF0ZUxpbWl0ID0gcmVjdXJyZW5jZUVuZERhdGUgPyBuZXcgRGF0ZShyZWN1cnJlbmNlRW5kRGF0ZSkgOiBudWxsO1xuXG5cdGNvbnN0IHJlY3VycmluZ0pvYnM6ICh0eXBlb2YgYmFzZUpvYilbXSA9IFtdO1xuXHRsZXQgY3VycmVudERhdGUgPSBuZXcgRGF0ZShzdGFydERhdGUpO1xuXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgbWF4T2NjdXJyZW5jZXMgLSAxOyBpKyspIHtcblx0XHQvLyAtMSBiZWNhdXNlIHdlIGFscmVhZHkgY3JlYXRlZCB0aGUgZmlyc3Qgam9iXG5cdFx0Y3VycmVudERhdGUgPSBjYWxjdWxhdGVOZXh0UmVjdXJyZW5jZShjdXJyZW50RGF0ZSwgcmVjdXJyZW5jZVR5cGUpO1xuXG5cdFx0Ly8gU3RvcCBpZiB3ZSd2ZSByZWFjaGVkIHRoZSBlbmQgZGF0ZVxuXHRcdGlmIChlbmREYXRlTGltaXQgJiYgY3VycmVudERhdGUgPiBlbmREYXRlTGltaXQpIHtcblx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdGNvbnN0IGN1cnJlbnRFbmREYXRlID0gbmV3IERhdGUoY3VycmVudERhdGUuZ2V0VGltZSgpICsgZHVyYXRpb24pO1xuXG5cdFx0Ly8gR2VuZXJhdGUgYSB1bmlxdWUgam9iIG51bWJlciBmb3IgdGhpcyBvY2N1cnJlbmNlXG5cdFx0Y29uc3Qgam9iTnVtYmVyID0gYXdhaXQgZ2VuZXJhdGVKb2JOdW1iZXIoc3VwYWJhc2UsIGNvbXBhbnlJZCk7XG5cblx0XHRyZWN1cnJpbmdKb2JzLnB1c2goe1xuXHRcdFx0Li4uYmFzZUpvYixcblx0XHRcdGpvYl9udW1iZXI6IGpvYk51bWJlcixcblx0XHRcdHNjaGVkdWxlZF9zdGFydDogY3VycmVudERhdGUudG9JU09TdHJpbmcoKSxcblx0XHRcdHNjaGVkdWxlZF9lbmQ6IGN1cnJlbnRFbmREYXRlLnRvSVNPU3RyaW5nKCksXG5cdFx0XHR0aXRsZTogYCR7YmFzZUpvYi50aXRsZX0gKCR7aSArIDJ9LyR7bWF4T2NjdXJyZW5jZXN9KWAsIC8vIEFkZCBvY2N1cnJlbmNlIG51bWJlclxuXHRcdH0pO1xuXG5cdFx0Ly8gQ3JlYXRlIGpvYnMgaW4gYmF0Y2hlcyBvZiAxMCB0byBhdm9pZCBtZW1vcnkgaXNzdWVzXG5cdFx0aWYgKHJlY3VycmluZ0pvYnMubGVuZ3RoID49IDEwKSB7XG5cdFx0XHRhd2FpdCBzdXBhYmFzZS5mcm9tKFwiam9ic1wiKS5pbnNlcnQocmVjdXJyaW5nSm9icyk7XG5cdFx0XHRyZWN1cnJpbmdKb2JzLmxlbmd0aCA9IDA7IC8vIENsZWFyIGFycmF5XG5cdFx0fVxuXHR9XG5cblx0Ly8gSW5zZXJ0IGFueSByZW1haW5pbmcgam9ic1xuXHRpZiAocmVjdXJyaW5nSm9icy5sZW5ndGggPiAwKSB7XG5cdFx0YXdhaXQgc3VwYWJhc2UuZnJvbShcImpvYnNcIikuaW5zZXJ0KHJlY3VycmluZ0pvYnMpO1xuXHR9XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgbmV3IGpvYlxuICog4pyFIEFMUkVBRFkgTUlHUkFURUQgLSBDcmVhdGVzIGNvcmUgam9iICsgYWxsIDEwIGRvbWFpbiByZWNvcmRzIGluIHBhcmFsbGVsXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVKb2IoXG5cdGZvcm1EYXRhOiBGb3JtRGF0YSxcbik6IFByb21pc2U8QWN0aW9uUmVzdWx0PHN0cmluZz4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSBjcmVhdGVKb2JTY2hlbWEucGFyc2Uoe1xuXHRcdFx0cHJvcGVydHlJZDogZm9ybURhdGEuZ2V0KFwicHJvcGVydHlJZFwiKSxcblx0XHRcdGN1c3RvbWVySWQ6IGZvcm1EYXRhLmdldChcImN1c3RvbWVySWRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0dGl0bGU6IGZvcm1EYXRhLmdldChcInRpdGxlXCIpLFxuXHRcdFx0ZGVzY3JpcHRpb246IGZvcm1EYXRhLmdldChcImRlc2NyaXB0aW9uXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdHByaW9yaXR5OiBmb3JtRGF0YS5nZXQoXCJwcmlvcml0eVwiKSB8fCBcIm1lZGl1bVwiLFxuXHRcdFx0am9iVHlwZTogZm9ybURhdGEuZ2V0KFwiam9iVHlwZVwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRzY2hlZHVsZWRTdGFydDogZm9ybURhdGEuZ2V0KFwic2NoZWR1bGVkU3RhcnRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0c2NoZWR1bGVkRW5kOiBmb3JtRGF0YS5nZXQoXCJzY2hlZHVsZWRFbmRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0YXNzaWduZWRUbzogZm9ybURhdGEuZ2V0KFwiYXNzaWduZWRUb1wiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRub3RlczogZm9ybURhdGEuZ2V0KFwibm90ZXNcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0Ly8gRW5oYW5jZWQgc2NoZWR1bGluZyBmaWVsZHNcblx0XHRcdGlzUmVjdXJyaW5nOiBmb3JtRGF0YS5nZXQoXCJpc1JlY3VycmluZ1wiKSA9PT0gXCJ0cnVlXCIsXG5cdFx0XHRzY2hlZHVsaW5nTW9kZTogKGZvcm1EYXRhLmdldChcInNjaGVkdWxpbmdNb2RlXCIpIGFzIGFueSkgfHwgdW5kZWZpbmVkLFxuXHRcdFx0dGltZVdpbmRvdzogZm9ybURhdGEuZ2V0KFwidGltZVdpbmRvd1wiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRyZWN1cnJlbmNlVHlwZTogKGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VUeXBlXCIpIGFzIGFueSkgfHwgdW5kZWZpbmVkLFxuXHRcdFx0cmVjdXJyZW5jZUVuZERhdGU6IGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VFbmREYXRlXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdHJlY3VycmVuY2VDb3VudDogZm9ybURhdGEuZ2V0KFwicmVjdXJyZW5jZUNvdW50XCIpXG5cdFx0XHRcdD8gTnVtYmVyLnBhcnNlSW50KGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VDb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHR9KTtcblxuXHRcdC8vIFZlcmlmeSBwcm9wZXJ0eSBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IHByb3BlcnR5IH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJwcm9wZXJ0aWVzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgY3VzdG9tZXJfaWQsIGFkZHJlc3NcIilcblx0XHRcdC5lcShcImlkXCIsIGRhdGEucHJvcGVydHlJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhwcm9wZXJ0eSwgXCJQcm9wZXJ0eVwiKTtcblxuXHRcdGlmIChwcm9wZXJ0eS5jb21wYW55X2lkICE9PSBjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwicHJvcGVydHlcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVzZSBjdXN0b21lciBmcm9tIHByb3BlcnR5IGlmIG5vdCBwcm92aWRlZFxuXHRcdGNvbnN0IGN1c3RvbWVySWQgPSBkYXRhLmN1c3RvbWVySWQgfHwgcHJvcGVydHkuY3VzdG9tZXJfaWQ7XG5cblx0XHQvLyBHZW5lcmF0ZSB1bmlxdWUgam9iIG51bWJlclxuXHRcdGNvbnN0IGpvYk51bWJlciA9IGF3YWl0IGdlbmVyYXRlSm9iTnVtYmVyKHN1cGFiYXNlLCBjb21wYW55SWQpO1xuXG5cdFx0Ly8gQWRkIHRpbWUgd2luZG93IGluZm8gdG8gbm90ZXMgaWYgYXBwbGljYWJsZVxuXHRcdGxldCBqb2JOb3RlcyA9IGRhdGEubm90ZXMgfHwgXCJcIjtcblx0XHRpZiAoZGF0YS5zY2hlZHVsaW5nTW9kZSA9PT0gXCJ3aW5kb3dcIiAmJiBkYXRhLnRpbWVXaW5kb3cpIHtcblx0XHRcdGNvbnN0IHdpbmRvd0luZm8gPSBgXFxuXFxuW1NjaGVkdWxpbmddIEN1c3RvbWVyIHByZWZlcnJlZCB0aW1lIHdpbmRvdzogJHtkYXRhLnRpbWVXaW5kb3cuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBkYXRhLnRpbWVXaW5kb3cuc2xpY2UoMSl9YDtcblx0XHRcdGpvYk5vdGVzID0gam9iTm90ZXMgPyBgJHtqb2JOb3Rlc30ke3dpbmRvd0luZm99YCA6IHdpbmRvd0luZm8udHJpbSgpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBjb3JlIGpvYiByZWNvcmRcblx0XHRjb25zdCB7IGRhdGE6IG5ld0pvYiwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogZGF0YS5wcm9wZXJ0eUlkLFxuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0YXNzaWduZWRfdG86IGRhdGEuYXNzaWduZWRUbyxcblx0XHRcdFx0am9iX251bWJlcjogam9iTnVtYmVyLFxuXHRcdFx0XHR0aXRsZTogZGF0YS50aXRsZSxcblx0XHRcdFx0ZGVzY3JpcHRpb246IGRhdGEuZGVzY3JpcHRpb24sXG5cdFx0XHRcdHN0YXR1czogXCJxdW90ZWRcIixcblx0XHRcdFx0cHJpb3JpdHk6IGRhdGEucHJpb3JpdHksXG5cdFx0XHRcdGpvYl90eXBlOiBkYXRhLmpvYlR5cGUsXG5cdFx0XHRcdHNlcnZpY2VfdHlwZTogZGF0YS5qb2JUeXBlLCAvLyBEZWZhdWx0IHNlcnZpY2VfdHlwZSB0byBqb2JfdHlwZVxuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRub3Rlczogam9iTm90ZXMsXG5cdFx0XHR9KVxuXHRcdFx0LnNlbGVjdChcImlkXCIpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoY3JlYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiY3JlYXRlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBkb21haW4gcmVjb3JkcyAocGFyYWxsZWwgaW5zZXJ0cyBmb3IgcGVyZm9ybWFuY2UpXG5cdFx0Y29uc3QgZG9tYWluSW5zZXJ0cyA9IGF3YWl0IFByb21pc2UuYWxsKFtcblx0XHRcdC8vIEZpbmFuY2lhbCBkb21haW4gLSBhbHdheXMgY3JlYXRlIHdpdGggZGVmYXVsdHNcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2ZpbmFuY2lhbFwiKVxuXHRcdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0XHRqb2JfaWQ6IG5ld0pvYi5pZCxcblx0XHRcdFx0XHRjb21wYW55X2lkOiBjb21wYW55SWQsXG5cdFx0XHRcdFx0dG90YWxfYW1vdW50OiAwLFxuXHRcdFx0XHRcdHBhaWRfYW1vdW50OiAwLFxuXHRcdFx0XHRcdGRlcG9zaXRfYW1vdW50OiAwLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gV29ya2Zsb3cgZG9tYWluIC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2Jfd29ya2Zsb3dcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdHdvcmtmbG93X2NvbXBsZXRlZF9zdGFnZXM6IFtdLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gVGltZSB0cmFja2luZyAtIGFsd2F5cyBjcmVhdGVcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX3RpbWVfdHJhY2tpbmdcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdHRvdGFsX2xhYm9yX2hvdXJzOiAwLFxuXHRcdFx0XHRcdGJyZWFrX3RpbWVfbWludXRlczogMCxcblx0XHRcdFx0fSksXG5cblx0XHRcdC8vIEN1c3RvbWVyIGFwcHJvdmFsIC0gYWx3YXlzIGNyZWF0ZSB3aXRoIHBlbmRpbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2N1c3RvbWVyX2FwcHJvdmFsXCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRjdXN0b21lcl9hcHByb3ZhbF9zdGF0dXM6IFwicGVuZGluZ1wiLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gRXF1aXBtZW50IHNlcnZpY2UgLSBhbHdheXMgY3JlYXRlXG5cdFx0XHRzdXBhYmFzZVxuXHRcdFx0XHQuZnJvbShcImpvYl9lcXVpcG1lbnRfc2VydmljZVwiKVxuXHRcdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0XHRqb2JfaWQ6IG5ld0pvYi5pZCxcblx0XHRcdFx0XHRjb21wYW55X2lkOiBjb21wYW55SWQsXG5cdFx0XHRcdFx0ZXF1aXBtZW50X3NlcnZpY2VfaGlzdG9yeTogW10sXG5cdFx0XHRcdFx0ZXF1aXBtZW50X3NlcnZpY2VkOiBbXSxcblx0XHRcdFx0fSksXG5cblx0XHRcdC8vIERpc3BhdGNoIC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfZGlzcGF0Y2hcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gUXVhbGl0eSAtIGFsd2F5cyBjcmVhdGVcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX3F1YWxpdHlcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdGluc3BlY3Rpb25fcmVxdWlyZWQ6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gU2FmZXR5IC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2Jfc2FmZXR5XCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRyZXF1aXJlc19wZXJtaXQ6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gQUkgZW5yaWNobWVudCAtIGNyZWF0ZSBlbXB0eSBmb3IgZnV0dXJlIHByb2Nlc3Npbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2FpX2VucmljaG1lbnRcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gTXVsdGktZW50aXR5IC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfbXVsdGlfZW50aXR5XCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRyZXF1aXJlc19tdWx0aXBsZV9wcm9wZXJ0aWVzOiBmYWxzZSxcblx0XHRcdFx0XHRyZXF1aXJlc19tdWx0aXBsZV9jdXN0b21lcnM6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBhbnkgZG9tYWluIGluc2VydCBlcnJvcnNcblx0XHRjb25zdCBkb21haW5FcnJvcnMgPSBkb21haW5JbnNlcnRzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuZXJyb3IpO1xuXHRcdGlmIChkb21haW5FcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0Ly8gUm9sbGJhY2sgLSBkZWxldGUgdGhlIGpvYiAoQ0FTQ0FERSB3aWxsIGRlbGV0ZSBkb21haW4gcmVjb3Jkcylcblx0XHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JzXCIpLmRlbGV0ZSgpLmVxKFwiaWRcIiwgbmV3Sm9iLmlkKTtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiY3JlYXRlIGpvYiBkb21haW5zXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQ3JlYXRlIHJlY3VycmluZyBqb2JzIGlmIHJlcXVlc3RlZFxuXHRcdGlmIChkYXRhLmlzUmVjdXJyaW5nICYmIGRhdGEucmVjdXJyZW5jZVR5cGUgJiYgZGF0YS5zY2hlZHVsZWRTdGFydCkge1xuXHRcdFx0Y29uc3QgYmFzZUpvYiA9IHtcblx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogZGF0YS5wcm9wZXJ0eUlkLFxuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0YXNzaWduZWRfdG86IGRhdGEuYXNzaWduZWRUbyxcblx0XHRcdFx0dGl0bGU6IGRhdGEudGl0bGUsXG5cdFx0XHRcdGRlc2NyaXB0aW9uOiBkYXRhLmRlc2NyaXB0aW9uLFxuXHRcdFx0XHRzdGF0dXM6IFwicXVvdGVkXCIsXG5cdFx0XHRcdHByaW9yaXR5OiBkYXRhLnByaW9yaXR5LFxuXHRcdFx0XHRqb2JfdHlwZTogZGF0YS5qb2JUeXBlLFxuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRub3RlczogZGF0YS5ub3Rlcyxcblx0XHRcdH07XG5cblx0XHRcdGF3YWl0IGNyZWF0ZVJlY3VycmluZ0pvYnMoXG5cdFx0XHRcdHN1cGFiYXNlLFxuXHRcdFx0XHRjb21wYW55SWQsXG5cdFx0XHRcdGJhc2VKb2IsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZVR5cGUsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZUVuZERhdGUsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZUNvdW50LFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBTZW5kIG5vdGlmaWNhdGlvbiB0byBhc3NpZ25lZCB1c2VyIGlmIGpvYiBpcyBhc3NpZ25lZFxuXHRcdGlmIChkYXRhLmFzc2lnbmVkVG8gJiYgZGF0YS5hc3NpZ25lZFRvICE9PSB1c2VyLmlkKSB7XG5cdFx0XHRhd2FpdCBub3RpZnlKb2JDcmVhdGVkKHtcblx0XHRcdFx0dXNlcklkOiBkYXRhLmFzc2lnbmVkVG8sXG5cdFx0XHRcdGNvbXBhbnlJZDogY29tcGFueUlkLFxuXHRcdFx0XHRqb2JJZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRqb2JUaXRsZTogZGF0YS50aXRsZSxcblx0XHRcdFx0YWRkcmVzczogcHJvcGVydHkuYWRkcmVzcyB8fCBcIlVua25vd24gYWRkcmVzc1wiLFxuXHRcdFx0XHRwcmlvcml0eTpcblx0XHRcdFx0XHRkYXRhLnByaW9yaXR5ID09PSBcInVyZ2VudFwiXG5cdFx0XHRcdFx0XHQ/IFwidXJnZW50XCJcblx0XHRcdFx0XHRcdDogZGF0YS5wcmlvcml0eSA9PT0gXCJoaWdoXCJcblx0XHRcdFx0XHRcdFx0PyBcImhpZ2hcIlxuXHRcdFx0XHRcdFx0XHQ6IFwibWVkaXVtXCIsXG5cdFx0XHRcdGFjdGlvblVybDogXCIvZGFzaGJvYXJkL3dvcmtcIixcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrL2pvYnNcIik7XG5cdFx0cmV0dXJuIG5ld0pvYi5pZDtcblx0fSk7XG59XG5cbi8qKlxuICogR2V0IGEgc2luZ2xlIGpvYiBieSBJRFxuICog4pyFIEFMUkVBRFkgTUlHUkFURUQgLSBGZXRjaGVzIGpvYiB3aXRoIGFsbCBkb21haW4gZGF0YVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueT4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBqb2Igd2l0aCBiYXNpYyByZWxhdGlvbnNoaXBzXG5cdFx0Ly8gU2ltcGxpZmllZCBxdWVyeSAtIG1hbnkgZG9tYWluIHRhYmxlcyBkb24ndCBleGlzdCB5ZXRcblx0XHRjb25zdCB7IGRhdGE6IGpvYiwgZXJyb3I6IGpvYkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRgXG5cdFx0XHRcdCosXG5cdFx0XHRcdHByb3BlcnR5OnByb3BlcnRpZXMoKiksXG5cdFx0XHRcdGN1c3RvbWVyOmN1c3RvbWVycyFjdXN0b21lcl9pZChpZCwgZmlyc3RfbmFtZSwgbGFzdF9uYW1lLCBlbWFpbCwgcGhvbmUsIGRpc3BsYXlfbmFtZSlcblx0XHRcdGAsXG5cdFx0XHQpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGpvYkVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm5vdEZvdW5kKFwiSm9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9SRUNPUkRfTk9UX0ZPVU5ELFxuXHRcdFx0XHQ0MDQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRpZiAoam9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBqb2I7XG5cdH0pO1xufVxuXG4vKipcbiAqIFVwZGF0ZSBqb2IgZGV0YWlsc1xuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgYm90aCBjb3JlIGpvYnMgdGFibGUgYW5kIGRvbWFpbiB0YWJsZXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYihcblx0am9iSWQ6IHN0cmluZyxcblx0Zm9ybURhdGE6IEZvcm1EYXRhLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IGFjdGl2ZSBjb21wYW55IElEXG5cdFx0Y29uc3QgYWN0aXZlQ29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cdFx0aWYgKCFhY3RpdmVDb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgdXNlcidzIHJvbGUgdG8gY2hlY2sgaWYgdGhleSdyZSBhZG1pbi9vd25lclxuXHRcdGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiY29tcGFueV9tZW1iZXJzaGlwc1wiKVxuXHRcdFx0LnNlbGVjdChcblx0XHRcdFx0YFxuICAgICAgICByb2xlX2lkLFxuICAgICAgICBjdXN0b21fcm9sZXMhcm9sZV9pZChuYW1lLCBpc19zeXN0ZW0pXG4gICAgICBgLFxuXHRcdFx0KVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LmVxKFwiY29tcGFueV9pZFwiLCBhY3RpdmVDb21wYW55SWQpXG5cdFx0XHQuZXEoXCJzdGF0dXNcIiwgXCJhY3RpdmVcIilcblx0XHRcdC5tYXliZVNpbmdsZSgpO1xuXG5cdFx0Y29uc3Qgcm9sZSA9IEFycmF5LmlzQXJyYXkodGVhbU1lbWJlcj8uY3VzdG9tX3JvbGVzKVxuXHRcdFx0PyB0ZWFtTWVtYmVyLmN1c3RvbV9yb2xlc1swXVxuXHRcdFx0OiB0ZWFtTWVtYmVyPy5jdXN0b21fcm9sZXM7XG5cblx0XHRjb25zdCBpc0FkbWluT3JPd25lciA9XG5cdFx0XHRyb2xlPy5uYW1lID09PSBcIkFkbWluXCIgfHxcblx0XHRcdHJvbGU/Lm5hbWUgPT09IFwiT3duZXJcIiB8fFxuXHRcdFx0cm9sZT8uaXNfc3lzdGVtID09PSB0cnVlO1xuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhleGlzdGluZ0pvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoZXhpc3RpbmdKb2IuY29tcGFueV9pZCAhPT0gYWN0aXZlQ29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUHJldmVudCBlZGl0aW5nIGNvbXBsZXRlZCBvciBjYW5jZWxsZWQgam9icyAodW5sZXNzIGFkbWluL293bmVyKVxuXHRcdGlmIChcblx0XHRcdCFpc0FkbWluT3JPd25lciAmJlxuXHRcdFx0KGV4aXN0aW5nSm9iLnN0YXR1cyA9PT0gXCJjb21wbGV0ZWRcIiB8fCBleGlzdGluZ0pvYi5zdGF0dXMgPT09IFwiY2FuY2VsbGVkXCIpXG5cdFx0KSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBDYW5ub3QgZWRpdCAke2V4aXN0aW5nSm9iLnN0YXR1c30gam9ic2AsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgY3VzdG9tZXJJZFZhbHVlID0gZm9ybURhdGEuZ2V0KFwiY3VzdG9tZXJJZFwiKTtcblx0XHRjb25zdCBwcm9wZXJ0eUlkVmFsdWUgPSBmb3JtRGF0YS5nZXQoXCJwcm9wZXJ0eUlkXCIpO1xuXG5cdFx0Ly8gSGFuZGxlIGN1c3RvbWVySWQ6IGVtcHR5IHN0cmluZyBvciBcIm51bGxcIiBzdHJpbmcgbWVhbnMgcmVtb3ZlIChzZXQgdG8gbnVsbClcblx0XHQvLyB1bmRlZmluZWQgbWVhbnMgZG9uJ3QgY2hhbmdlIGl0XG5cdFx0bGV0IHBhcnNlZEN1c3RvbWVySWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG5cdFx0aWYgKGN1c3RvbWVySWRWYWx1ZSA9PT0gbnVsbCB8fCBjdXN0b21lcklkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyc2VkQ3VzdG9tZXJJZCA9IHVuZGVmaW5lZDsgLy8gRG9uJ3QgY2hhbmdlXG5cdFx0fSBlbHNlIGlmIChjdXN0b21lcklkVmFsdWUgPT09IFwiXCIgfHwgY3VzdG9tZXJJZFZhbHVlID09PSBcIm51bGxcIikge1xuXHRcdFx0cGFyc2VkQ3VzdG9tZXJJZCA9IG51bGw7IC8vIFJlbW92ZSBjdXN0b21lclxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJzZWRDdXN0b21lcklkID0gY3VzdG9tZXJJZFZhbHVlIGFzIHN0cmluZzsgLy8gU2V0IHRvIHRoaXMgY3VzdG9tZXJcblx0XHR9XG5cblx0XHQvLyBIYW5kbGUgcHJvcGVydHlJZDogZW1wdHkgc3RyaW5nIG1lYW5zIHJlbW92ZSAoc2V0IHRvIG51bGwpLCB1bmRlZmluZWQgbWVhbnMgZG9uJ3QgY2hhbmdlXG5cdFx0bGV0IHBhcnNlZFByb3BlcnR5SWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG5cdFx0aWYgKHByb3BlcnR5SWRWYWx1ZSA9PT0gbnVsbCB8fCBwcm9wZXJ0eUlkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyc2VkUHJvcGVydHlJZCA9IHVuZGVmaW5lZDsgLy8gRG9uJ3QgY2hhbmdlXG5cdFx0fSBlbHNlIGlmIChwcm9wZXJ0eUlkVmFsdWUgPT09IFwiXCIgfHwgcHJvcGVydHlJZFZhbHVlID09PSBcIm51bGxcIikge1xuXHRcdFx0cGFyc2VkUHJvcGVydHlJZCA9IG51bGw7IC8vIFJlbW92ZSBwcm9wZXJ0eVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJzZWRQcm9wZXJ0eUlkID0gcHJvcGVydHlJZFZhbHVlIGFzIHN0cmluZzsgLy8gU2V0IHRvIHRoaXMgcHJvcGVydHlcblx0XHR9XG5cblx0XHRjb25zdCBkYXRhID0gdXBkYXRlSm9iU2NoZW1hLnBhcnNlKHtcblx0XHRcdHRpdGxlOiBmb3JtRGF0YS5nZXQoXCJ0aXRsZVwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRkZXNjcmlwdGlvbjogZm9ybURhdGEuZ2V0KFwiZGVzY3JpcHRpb25cIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0c3RhdHVzOiBmb3JtRGF0YS5nZXQoXCJzdGF0dXNcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0cHJpb3JpdHk6IGZvcm1EYXRhLmdldChcInByaW9yaXR5XCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdGpvYlR5cGU6IGZvcm1EYXRhLmdldChcImpvYlR5cGVcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0bm90ZXM6IGZvcm1EYXRhLmdldChcIm5vdGVzXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdC8vIEZpbmFuY2lhbCBmaWVsZHMgKG5vdyBpbiBqb2JfZmluYW5jaWFsIGRvbWFpbiB0YWJsZSlcblx0XHRcdHRvdGFsQW1vdW50OiBmb3JtRGF0YS5nZXQoXCJ0b3RhbEFtb3VudFwiKVxuXHRcdFx0XHQ/IE51bWJlci5wYXJzZUludChmb3JtRGF0YS5nZXQoXCJ0b3RhbEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdHBhaWRBbW91bnQ6IGZvcm1EYXRhLmdldChcInBhaWRBbW91bnRcIilcblx0XHRcdFx0PyBOdW1iZXIucGFyc2VJbnQoZm9ybURhdGEuZ2V0KFwicGFpZEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdGRlcG9zaXRBbW91bnQ6IGZvcm1EYXRhLmdldChcImRlcG9zaXRBbW91bnRcIilcblx0XHRcdFx0PyBOdW1iZXIucGFyc2VJbnQoZm9ybURhdGEuZ2V0KFwiZGVwb3NpdEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdHNjaGVkdWxlZFN0YXJ0OiBmb3JtRGF0YS5nZXQoXCJzY2hlZHVsZWRTdGFydFwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRzY2hlZHVsZWRFbmQ6IGZvcm1EYXRhLmdldChcInNjaGVkdWxlZEVuZFwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRhc3NpZ25lZFRvOiBmb3JtRGF0YS5nZXQoXCJhc3NpZ25lZFRvXCIpIHx8IG51bGwsXG5cdFx0XHRjdXN0b21lcklkOiBwYXJzZWRDdXN0b21lcklkLFxuXHRcdFx0cHJvcGVydHlJZDogcGFyc2VkUHJvcGVydHlJZCxcblx0XHR9KTtcblxuXHRcdC8vIElmIHN0YXR1cyBpcyBiZWluZyBjaGFuZ2VkLCB2YWxpZGF0ZSB0aGUgdHJhbnNpdGlvblxuXHRcdGlmIChkYXRhLnN0YXR1cyAhPT0gdW5kZWZpbmVkICYmIGRhdGEuc3RhdHVzICE9PSBleGlzdGluZ0pvYi5zdGF0dXMpIHtcblx0XHRcdC8vIEZldGNoIGFkZGl0aW9uYWwgY29udGV4dCBmb3Igc3RhdHVzIHZhbGlkYXRpb25cblx0XHRcdGNvbnN0IHsgZGF0YTogam9iV2l0aENvbnRleHQgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRcdGBcblx0XHRcdFx0XHRpZCxcblx0XHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdFx0c2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRcdHNjaGVkdWxlZF9lbmQsXG5cdFx0XHRcdFx0YXNzaWduZWRfdG8sXG5cdFx0XHRcdFx0Y3VzdG9tZXJfaWQsXG5cdFx0XHRcdFx0cHJvcGVydHlfaWQsXG5cdFx0XHRcdFx0dG90YWxfYW1vdW50LFxuXHRcdFx0XHRcdGludm9pY2VzOmludm9pY2VzKHN0YXR1cywgdG90YWxfYW1vdW50KSxcblx0XHRcdFx0XHRlc3RpbWF0ZXM6ZXN0aW1hdGVzKHN0YXR1cyksXG5cdFx0XHRcdFx0dGVhbV9hc3NpZ25tZW50czpqb2JfdGVhbV9hc3NpZ25tZW50cyh0ZWFtX21lbWJlcl9pZClcblx0XHRcdFx0YCxcblx0XHRcdFx0KVxuXHRcdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRpZiAoam9iV2l0aENvbnRleHQpIHtcblx0XHRcdFx0Y29uc3QgdHJhbnNpdGlvbkNvbnRleHQ6IEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0ID0ge1xuXHRcdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGpvYldpdGhDb250ZXh0LnN0YXR1cyBhcyBKb2JTdGF0dXMsXG5cdFx0XHRcdFx0bmV3U3RhdHVzOiBkYXRhLnN0YXR1cyBhcyBKb2JTdGF0dXMsXG5cdFx0XHRcdFx0am9iOiB7XG5cdFx0XHRcdFx0XHRpZDogam9iV2l0aENvbnRleHQuaWQsXG5cdFx0XHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6XG5cdFx0XHRcdFx0XHRcdGRhdGEuc2NoZWR1bGVkU3RhcnQgfHwgam9iV2l0aENvbnRleHQuc2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRcdFx0c2NoZWR1bGVkX2VuZDogZGF0YS5zY2hlZHVsZWRFbmQgfHwgam9iV2l0aENvbnRleHQuc2NoZWR1bGVkX2VuZCxcblx0XHRcdFx0XHRcdGFzc2lnbmVkX3RvOlxuXHRcdFx0XHRcdFx0XHRkYXRhLmFzc2lnbmVkVG8gIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5hc3NpZ25lZFRvXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5hc3NpZ25lZF90byxcblx0XHRcdFx0XHRcdGN1c3RvbWVyX2lkOlxuXHRcdFx0XHRcdFx0XHRkYXRhLmN1c3RvbWVySWQgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5jdXN0b21lcklkXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5jdXN0b21lcl9pZCxcblx0XHRcdFx0XHRcdHByb3BlcnR5X2lkOlxuXHRcdFx0XHRcdFx0XHRkYXRhLnByb3BlcnR5SWQgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5wcm9wZXJ0eUlkXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5wcm9wZXJ0eV9pZCxcblx0XHRcdFx0XHRcdHRvdGFsX2Ftb3VudDpcblx0XHRcdFx0XHRcdFx0ZGF0YS50b3RhbEFtb3VudCAhPT0gdW5kZWZpbmVkXG5cdFx0XHRcdFx0XHRcdFx0PyBkYXRhLnRvdGFsQW1vdW50XG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC50b3RhbF9hbW91bnQsXG5cdFx0XHRcdFx0XHRpbnZvaWNlczogam9iV2l0aENvbnRleHQuaW52b2ljZXMgfHwgW10sXG5cdFx0XHRcdFx0XHRlc3RpbWF0ZXM6IGpvYldpdGhDb250ZXh0LmVzdGltYXRlcyB8fCBbXSxcblx0XHRcdFx0XHRcdHRlYW1Bc3NpZ25tZW50czogam9iV2l0aENvbnRleHQudGVhbV9hc3NpZ25tZW50cyB8fCBbXSxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSB2YWxpZGF0ZVN0YXR1c1RyYW5zaXRpb24odHJhbnNpdGlvbkNvbnRleHQpO1xuXG5cdFx0XHRcdGlmICghdmFsaWRhdGlvblJlc3VsdC5hbGxvd2VkKSB7XG5cdFx0XHRcdFx0bGV0IGVycm9yTWVzc2FnZSA9XG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlYXNvbiB8fCBcIlN0YXR1cyB0cmFuc2l0aW9uIG5vdCBhbGxvd2VkXCI7XG5cblx0XHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlcXVpcmVkRmllbGRzICYmXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlcXVpcmVkRmllbGRzLmxlbmd0aCA+IDBcblx0XHRcdFx0XHQpIHtcblx0XHRcdFx0XHRcdGVycm9yTWVzc2FnZSArPSBgLiBNaXNzaW5nOiAke3ZhbGlkYXRpb25SZXN1bHQucmVxdWlyZWRGaWVsZHMuam9pbihcIiwgXCIpfWA7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKGVycm9yTWVzc2FnZSwgRVJST1JfQ09ERVMuVkFMSURBVElPTl9GQUlMRUQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gTG9nIHdhcm5pbmdzIGlmIHByZXNlbnQgKG5vbi1ibG9ja2luZylcblx0XHRcdFx0aWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwi4pqg77iPIFN0YXR1cyB0cmFuc2l0aW9uIHdhcm5pbmdzOlwiLCB7XG5cdFx0XHRcdFx0XHRqb2JJZCxcblx0XHRcdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGpvYldpdGhDb250ZXh0LnN0YXR1cyxcblx0XHRcdFx0XHRcdG5ld1N0YXR1czogZGF0YS5zdGF0dXMsXG5cdFx0XHRcdFx0XHR3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIEJ1aWxkIGNvcmUgam9iIHVwZGF0ZSBvYmplY3Qgd2l0aCBvbmx5IGRlZmluZWQgdmFsdWVzXG5cdFx0Y29uc3QgY29yZVVwZGF0ZURhdGE6IGFueSA9IHt9O1xuXHRcdGlmIChkYXRhLnRpdGxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnRpdGxlID0gZGF0YS50aXRsZTtcblx0XHR9XG5cdFx0aWYgKGRhdGEuZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuZGVzY3JpcHRpb24gPSBkYXRhLmRlc2NyaXB0aW9uO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zdGF0dXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuc3RhdHVzID0gZGF0YS5zdGF0dXM7XG5cdFx0fVxuXHRcdGlmIChkYXRhLnByaW9yaXR5ICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnByaW9yaXR5ID0gZGF0YS5wcmlvcml0eTtcblx0XHR9XG5cdFx0aWYgKGRhdGEuam9iVHlwZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb3JlVXBkYXRlRGF0YS5qb2JfdHlwZSA9IGRhdGEuam9iVHlwZTtcblx0XHR9XG5cdFx0aWYgKGRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEubm90ZXMgPSBkYXRhLm5vdGVzO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zY2hlZHVsZWRTdGFydCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb3JlVXBkYXRlRGF0YS5zY2hlZHVsZWRfc3RhcnQgPSBkYXRhLnNjaGVkdWxlZFN0YXJ0O1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zY2hlZHVsZWRFbmQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuc2NoZWR1bGVkX2VuZCA9IGRhdGEuc2NoZWR1bGVkRW5kO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5hc3NpZ25lZFRvICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLmFzc2lnbmVkX3RvID0gZGF0YS5hc3NpZ25lZFRvO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLmN1c3RvbWVyX2lkID0gZGF0YS5jdXN0b21lcklkO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5wcm9wZXJ0eUlkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnByb3BlcnR5X2lkID0gZGF0YS5wcm9wZXJ0eUlkO1xuXHRcdFx0Ly8gSWYgcHJvcGVydHkgaXMgYmVpbmcgc2V0IChub3QgbnVsbCksIHZlcmlmeSBpdCBiZWxvbmdzIHRvIHRoZSBjdXN0b21lciAoaWYgY3VzdG9tZXIgaXMgc2V0KVxuXHRcdFx0aWYgKFxuXHRcdFx0XHRkYXRhLnByb3BlcnR5SWQgIT09IG51bGwgJiZcblx0XHRcdFx0ZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQgJiZcblx0XHRcdFx0ZGF0YS5jdXN0b21lcklkICE9PSBudWxsXG5cdFx0XHQpIHtcblx0XHRcdFx0Y29uc3QgeyBkYXRhOiBwcm9wZXJ0eSB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdFx0XHQuZnJvbShcInByb3BlcnRpZXNcIilcblx0XHRcdFx0XHQuc2VsZWN0KFwiY3VzdG9tZXJfaWRcIilcblx0XHRcdFx0XHQuZXEoXCJpZFwiLCBkYXRhLnByb3BlcnR5SWQpXG5cdFx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRcdGlmIChwcm9wZXJ0eSAmJiBwcm9wZXJ0eS5jdXN0b21lcl9pZCAhPT0gZGF0YS5jdXN0b21lcklkKSB7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcdFx0XCJQcm9wZXJ0eSBkb2VzIG5vdCBiZWxvbmcgdG8gdGhlIHNlbGVjdGVkIGN1c3RvbWVyXCIsXG5cdFx0XHRcdFx0XHRFUlJPUl9DT0RFUy5WQUxJREFUSU9OX0ZBSUxFRCxcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gQnVpbGQgZmluYW5jaWFsIGRvbWFpbiB1cGRhdGUgb2JqZWN0IChpZiBhbnkgZmluYW5jaWFsIGZpZWxkcyBwcm92aWRlZClcblx0XHRjb25zdCBmaW5hbmNpYWxVcGRhdGVEYXRhOiBhbnkgPSB7fTtcblx0XHRpZiAoZGF0YS50b3RhbEFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmaW5hbmNpYWxVcGRhdGVEYXRhLnRvdGFsX2Ftb3VudCA9IGRhdGEudG90YWxBbW91bnQ7XG5cdFx0fVxuXHRcdGlmIChkYXRhLnBhaWRBbW91bnQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0ZmluYW5jaWFsVXBkYXRlRGF0YS5wYWlkX2Ftb3VudCA9IGRhdGEucGFpZEFtb3VudDtcblx0XHR9XG5cdFx0aWYgKGRhdGEuZGVwb3NpdEFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmaW5hbmNpYWxVcGRhdGVEYXRhLmRlcG9zaXRfYW1vdW50ID0gZGF0YS5kZXBvc2l0QW1vdW50O1xuXHRcdH1cblxuXHRcdC8vIEV4ZWN1dGUgdXBkYXRlcyBpbiBwYXJhbGxlbCBmb3IgcGVyZm9ybWFuY2Vcblx0XHRjb25zdCB1cGRhdGVzOiBQcm9taXNlPGFueT5bXSA9IFtdO1xuXG5cdFx0Ly8gVXBkYXRlIGNvcmUgam9iIHRhYmxlIGlmIHRoZXJlIGFyZSBjaGFuZ2VzXG5cdFx0aWYgKE9iamVjdC5rZXlzKGNvcmVVcGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG5cdFx0XHR1cGRhdGVzLnB1c2goXG5cdFx0XHRcdChhc3luYyAoKSA9PiBhd2FpdCBzdXBhYmFzZS5mcm9tKFwiam9ic1wiKS51cGRhdGUoY29yZVVwZGF0ZURhdGEpLmVxKFwiaWRcIiwgam9iSWQpKSgpLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBVcGRhdGUgZmluYW5jaWFsIGRvbWFpbiB0YWJsZSBpZiB0aGVyZSBhcmUgY2hhbmdlc1xuXHRcdGlmIChPYmplY3Qua2V5cyhmaW5hbmNpYWxVcGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG5cdFx0XHR1cGRhdGVzLnB1c2goXG5cdFx0XHRcdChhc3luYyAoKSA9PlxuXHRcdFx0XHRcdGF3YWl0IHN1cGFiYXNlXG5cdFx0XHRcdFx0XHQuZnJvbShcImpvYl9maW5hbmNpYWxcIilcblx0XHRcdFx0XHRcdC51cGRhdGUoZmluYW5jaWFsVXBkYXRlRGF0YSlcblx0XHRcdFx0XHRcdC5lcShcImpvYl9pZFwiLCBqb2JJZCkpKCksXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEV4ZWN1dGUgYWxsIHVwZGF0ZXMgaW4gcGFyYWxsZWxcblx0XHRpZiAodXBkYXRlcy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwodXBkYXRlcyk7XG5cblx0XHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gYW55IHVwZGF0ZVxuXHRcdFx0Y29uc3QgZXJyb3JzID0gcmVzdWx0cy5maWx0ZXIoKHJlc3VsdCkgPT4gcmVzdWx0LmVycm9yKTtcblx0XHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRjb25zdCBlcnJvck1lc3NhZ2VzID0gZXJyb3JzLm1hcCgoZSkgPT4gZS5lcnJvci5tZXNzYWdlKS5qb2luKFwiLCBcIik7XG5cdFx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XHRgJHtFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJ1cGRhdGUgam9iXCIpfTogJHtlcnJvck1lc3NhZ2VzfWAsXG5cdFx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBVcGRhdGUgam9iIHdpdGggZGF0YSBvYmplY3QgKGVhc2llciBmb3IgcHJvZ3JhbW1hdGljIHVzZSlcbiAqIFVzZWQgYnkgam9iIGVkaXRvciBmb3IgaW4tcGxhY2UgdXBkYXRlc1xuICovXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVKb2JEYXRhKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRkYXRhOiBQYXJ0aWFsPFVwZGF0ZUpvYkRhdGE+LFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHQvLyBDb252ZXJ0IGRhdGEgb2JqZWN0IHRvIEZvcm1EYXRhIGZvciBjb21wYXRpYmlsaXR5IHdpdGggZXhpc3RpbmcgdXBkYXRlSm9iXG5cdFx0Y29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcblxuXHRcdC8vIEFkZCBhbGwgZGVmaW5lZCBmaWVsZHMgdG8gRm9ybURhdGFcblx0XHRpZiAoZGF0YS50aXRsZSAhPT0gdW5kZWZpbmVkKSBmb3JtRGF0YS5hcHBlbmQoXCJ0aXRsZVwiLCBkYXRhLnRpdGxlKTtcblx0XHRpZiAoZGF0YS5kZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwiZGVzY3JpcHRpb25cIiwgZGF0YS5kZXNjcmlwdGlvbik7XG5cdFx0aWYgKGRhdGEuc3RhdHVzICE9PSB1bmRlZmluZWQpIGZvcm1EYXRhLmFwcGVuZChcInN0YXR1c1wiLCBkYXRhLnN0YXR1cyk7XG5cdFx0aWYgKGRhdGEucHJpb3JpdHkgIT09IHVuZGVmaW5lZCkgZm9ybURhdGEuYXBwZW5kKFwicHJpb3JpdHlcIiwgZGF0YS5wcmlvcml0eSk7XG5cdFx0aWYgKGRhdGEuam9iVHlwZSAhPT0gdW5kZWZpbmVkKSBmb3JtRGF0YS5hcHBlbmQoXCJqb2JUeXBlXCIsIGRhdGEuam9iVHlwZSk7XG5cdFx0aWYgKGRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkgZm9ybURhdGEuYXBwZW5kKFwibm90ZXNcIiwgZGF0YS5ub3Rlcyk7XG5cdFx0aWYgKGRhdGEudG90YWxBbW91bnQgIT09IHVuZGVmaW5lZClcblx0XHRcdGZvcm1EYXRhLmFwcGVuZChcInRvdGFsQW1vdW50XCIsIGRhdGEudG90YWxBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEucGFpZEFtb3VudCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwicGFpZEFtb3VudFwiLCBkYXRhLnBhaWRBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEuZGVwb3NpdEFtb3VudCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwiZGVwb3NpdEFtb3VudFwiLCBkYXRhLmRlcG9zaXRBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEuc2NoZWR1bGVkU3RhcnQgIT09IHVuZGVmaW5lZClcblx0XHRcdGZvcm1EYXRhLmFwcGVuZChcInNjaGVkdWxlZFN0YXJ0XCIsIGRhdGEuc2NoZWR1bGVkU3RhcnQpO1xuXHRcdGlmIChkYXRhLnNjaGVkdWxlZEVuZCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwic2NoZWR1bGVkRW5kXCIsIGRhdGEuc2NoZWR1bGVkRW5kKTtcblx0XHRpZiAoZGF0YS5hc3NpZ25lZFRvICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJhc3NpZ25lZFRvXCIsIGRhdGEuYXNzaWduZWRUbyB8fCBcIlwiKTtcblx0XHRpZiAoZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJjdXN0b21lcklkXCIsIGRhdGEuY3VzdG9tZXJJZCB8fCBcIlwiKTtcblx0XHRpZiAoZGF0YS5wcm9wZXJ0eUlkICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJwcm9wZXJ0eUlkXCIsIGRhdGEucHJvcGVydHlJZCB8fCBcIlwiKTtcblxuXHRcdC8vIFJldXNlIGV4aXN0aW5nIHVwZGF0ZUpvYiBsb2dpY1xuXHRcdHJldHVybiBhd2FpdCB1cGRhdGVKb2Ioam9iSWQsIGZvcm1EYXRhKTtcblx0fSk7XG59XG5cbi8qKlxuICogVXBkYXRlIGpvYiBzdGF0dXMgd2l0aCB2YWxpZGF0aW9uXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5zdGF0dXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYlN0YXR1cyhcblx0am9iSWQ6IHN0cmluZyxcblx0bmV3U3RhdHVzOiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBjdXJyZW50IHVzZXJcblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmFsaWRhdGUgc3RhdHVzIHZhbHVlXG5cdFx0Y29uc3QgdmFsaWRTdGF0dXNlczogSm9iU3RhdHVzW10gPSBbXG5cdFx0XHRcInF1b3RlZFwiLFxuXHRcdFx0XCJzY2hlZHVsZWRcIixcblx0XHRcdFwiaW5fcHJvZ3Jlc3NcIixcblx0XHRcdFwib25faG9sZFwiLFxuXHRcdFx0XCJjb21wbGV0ZWRcIixcblx0XHRcdFwiY2FuY2VsbGVkXCIsXG5cdFx0XHRcImludm9pY2VkXCIsXG5cdFx0XHRcInBhaWRcIixcblx0XHRdO1xuXHRcdGlmICghdmFsaWRTdGF0dXNlcy5pbmNsdWRlcyhuZXdTdGF0dXMgYXMgSm9iU3RhdHVzKSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkludmFsaWQgam9iIHN0YXR1c1wiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5WQUxJREFUSU9OX0ZBSUxFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gRmV0Y2ggam9iIHdpdGggYWxsIGNvbnRleHQgbmVlZGVkIGZvciB0cmFuc2l0aW9uIHZhbGlkYXRpb25cblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRgXG5cdFx0XHRcdGlkLFxuXHRcdFx0XHRjb21wYW55X2lkLFxuXHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdHNjaGVkdWxlZF9zdGFydCxcblx0XHRcdFx0c2NoZWR1bGVkX2VuZCxcblx0XHRcdFx0YXNzaWduZWRfdG8sXG5cdFx0XHRcdGN1c3RvbWVyX2lkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZCxcblx0XHRcdFx0dG90YWxfYW1vdW50LFxuXHRcdFx0XHRpbnZvaWNlczppbnZvaWNlcyhzdGF0dXMsIHRvdGFsX2Ftb3VudCksXG5cdFx0XHRcdGVzdGltYXRlczplc3RpbWF0ZXMoc3RhdHVzKSxcblx0XHRcdFx0dGVhbV9hc3NpZ25tZW50czpqb2JfdGVhbV9hc3NpZ25tZW50cyh0ZWFtX21lbWJlcl9pZClcblx0XHRcdGAsXG5cdFx0XHQpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhleGlzdGluZ0pvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoZXhpc3RpbmdKb2IuY29tcGFueV9pZCAhPT0gY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQnVpbGQgY29udGV4dCBmb3IgdHJhbnNpdGlvbiB2YWxpZGF0aW9uXG5cdFx0Y29uc3QgdHJhbnNpdGlvbkNvbnRleHQ6IEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0ID0ge1xuXHRcdFx0Y3VycmVudFN0YXR1czogZXhpc3RpbmdKb2Iuc3RhdHVzIGFzIEpvYlN0YXR1cyxcblx0XHRcdG5ld1N0YXR1czogbmV3U3RhdHVzIGFzIEpvYlN0YXR1cyxcblx0XHRcdGpvYjoge1xuXHRcdFx0XHRpZDogZXhpc3RpbmdKb2IuaWQsXG5cdFx0XHRcdHNjaGVkdWxlZF9zdGFydDogZXhpc3RpbmdKb2Iuc2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRzY2hlZHVsZWRfZW5kOiBleGlzdGluZ0pvYi5zY2hlZHVsZWRfZW5kLFxuXHRcdFx0XHRhc3NpZ25lZF90bzogZXhpc3RpbmdKb2IuYXNzaWduZWRfdG8sXG5cdFx0XHRcdGN1c3RvbWVyX2lkOiBleGlzdGluZ0pvYi5jdXN0b21lcl9pZCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IGV4aXN0aW5nSm9iLnByb3BlcnR5X2lkLFxuXHRcdFx0XHR0b3RhbF9hbW91bnQ6IGV4aXN0aW5nSm9iLnRvdGFsX2Ftb3VudCxcblx0XHRcdFx0aW52b2ljZXM6IGV4aXN0aW5nSm9iLmludm9pY2VzIHx8IFtdLFxuXHRcdFx0XHRlc3RpbWF0ZXM6IGV4aXN0aW5nSm9iLmVzdGltYXRlcyB8fCBbXSxcblx0XHRcdFx0dGVhbUFzc2lnbm1lbnRzOiBleGlzdGluZ0pvYi50ZWFtX2Fzc2lnbm1lbnRzIHx8IFtdLFxuXHRcdFx0fSxcblx0XHR9O1xuXG5cdFx0Ly8gVmFsaWRhdGUgdHJhbnNpdGlvbiB3aXRoIGNvbXByZWhlbnNpdmUgYnVzaW5lc3MgcnVsZXNcblx0XHRjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gdmFsaWRhdGVTdGF0dXNUcmFuc2l0aW9uKHRyYW5zaXRpb25Db250ZXh0KTtcblxuXHRcdGlmICghdmFsaWRhdGlvblJlc3VsdC5hbGxvd2VkKSB7XG5cdFx0XHRsZXQgZXJyb3JNZXNzYWdlID1cblx0XHRcdFx0dmFsaWRhdGlvblJlc3VsdC5yZWFzb24gfHwgXCJTdGF0dXMgdHJhbnNpdGlvbiBub3QgYWxsb3dlZFwiO1xuXG5cdFx0XHRpZiAoXG5cdFx0XHRcdHZhbGlkYXRpb25SZXN1bHQucmVxdWlyZWRGaWVsZHMgJiZcblx0XHRcdFx0dmFsaWRhdGlvblJlc3VsdC5yZXF1aXJlZEZpZWxkcy5sZW5ndGggPiAwXG5cdFx0XHQpIHtcblx0XHRcdFx0ZXJyb3JNZXNzYWdlICs9IGAuIE1pc3Npbmc6ICR7dmFsaWRhdGlvblJlc3VsdC5yZXF1aXJlZEZpZWxkcy5qb2luKFwiLCBcIil9YDtcblx0XHRcdH1cblxuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKGVycm9yTWVzc2FnZSwgRVJST1JfQ09ERVMuVkFMSURBVElPTl9GQUlMRUQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyB3YXJuaW5ncyBpZiBwcmVzZW50IChub24tYmxvY2tpbmcpXG5cdFx0aWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCLimqDvuI8gU3RhdHVzIHRyYW5zaXRpb24gd2FybmluZ3M6XCIsIHtcblx0XHRcdFx0am9iSWQsXG5cdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGV4aXN0aW5nSm9iLnN0YXR1cyxcblx0XHRcdFx0bmV3U3RhdHVzLFxuXHRcdFx0XHR3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBzdGF0dXNcblx0XHRjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnVwZGF0ZSh7IHN0YXR1czogbmV3U3RhdHVzIH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwidXBkYXRlIGpvYiBzdGF0dXNcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1FVRVJZX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zb2xlLmxvZyhcIuKchSBKb2Igc3RhdHVzIHVwZGF0ZWQ6XCIsIHtcblx0XHRcdGpvYklkLFxuXHRcdFx0b2xkU3RhdHVzOiBleGlzdGluZ0pvYi5zdGF0dXMsXG5cdFx0XHRuZXdTdGF0dXMsXG5cdFx0fSk7XG5cblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZC93b3JrLyR7am9iSWR9YCk7XG5cdH0pO1xufVxuXG4vKipcbiAqIEFzc2lnbiBqb2IgdG8gYSB0ZWNobmljaWFuXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5hc3NpZ25lZF90b1xuICovXG5hc3luYyBmdW5jdGlvbiBhc3NpZ25Kb2IoXG5cdGpvYklkOiBzdHJpbmcsXG5cdHRlY2huaWNpYW5JZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWRcIilcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0YXNzZXJ0RXhpc3RzKGV4aXN0aW5nSm9iLCBcIkpvYlwiKTtcblxuXHRcdGlmIChleGlzdGluZ0pvYi5jb21wYW55X2lkICE9PSBjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwiam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgdGVjaG5pY2lhbiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IHRlY2huaWNpYW4gfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImNvbXBhbnlfbWVtYmVyc2hpcHNcIilcblx0XHRcdC5zZWxlY3QoXCJ1c2VyX2lkXCIpXG5cdFx0XHQuZXEoXCJ1c2VyX2lkXCIsIHRlY2huaWNpYW5JZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWNobmljaWFuKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiVGVjaG5pY2lhbiBub3QgZm91bmQgaW4geW91ciBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1JFQ09SRF9OT1RfRk9VTkQsXG5cdFx0XHRcdDQwNCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQXNzaWduIGpvYlxuXHRcdGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQudXBkYXRlKHsgYXNzaWduZWRfdG86IHRlY2huaWNpYW5JZCB9KVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpO1xuXG5cdFx0aWYgKHVwZGF0ZUVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImFzc2lnbiBqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1FVRVJZX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZC93b3JrLyR7am9iSWR9YCk7XG5cdH0pO1xufVxuXG4vKipcbiAqIFNjaGVkdWxlIGEgam9iXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icyB0YWJsZSBzY2hlZHVsaW5nIGZpZWxkc1xuICovXG5hc3luYyBmdW5jdGlvbiBzY2hlZHVsZUpvYihcblx0am9iSWQ6IHN0cmluZyxcblx0Zm9ybURhdGE6IEZvcm1EYXRhLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSBzY2hlZHVsZUpvYlNjaGVtYS5wYXJzZSh7XG5cdFx0XHRzY2hlZHVsZWRTdGFydDogZm9ybURhdGEuZ2V0KFwic2NoZWR1bGVkU3RhcnRcIiksXG5cdFx0XHRzY2hlZHVsZWRFbmQ6IGZvcm1EYXRhLmdldChcInNjaGVkdWxlZEVuZFwiKSxcblx0XHR9KTtcblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWQsIHN0YXR1c1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBzY2hlZHVsZSBhbmQgc3RhdHVzXG5cdFx0Y29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRzdGF0dXM6XG5cdFx0XHRcdFx0ZXhpc3RpbmdKb2Iuc3RhdHVzID09PSBcInF1b3RlZFwiID8gXCJzY2hlZHVsZWRcIiA6IGV4aXN0aW5nSm9iLnN0YXR1cyxcblx0XHRcdH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwic2NoZWR1bGUgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0fSk7XG59XG5cbi8qKlxuICogU3RhcnQgYSBqb2JcbiAqIPCflKcgUkVGQUNUT1JFRCAtIE5vdyB1cGRhdGVzIGpvYl90aW1lX3RyYWNraW5nLmFjdHVhbF9zdGFydCBpbnN0ZWFkIG9mIGpvYnMuYWN0dWFsX3N0YXJ0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdGFydEpvYihqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWQsIHN0YXR1c1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbiBvbmx5IHN0YXJ0IHNjaGVkdWxlZCBqb2JzXG5cdFx0aWYgKGV4aXN0aW5nSm9iLnN0YXR1cyAhPT0gXCJzY2hlZHVsZWRcIiAmJiBleGlzdGluZ0pvYi5zdGF0dXMgIT09IFwicXVvdGVkXCIpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgbXVzdCBiZSBzY2hlZHVsZWQgYmVmb3JlIHN0YXJ0aW5nXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuXG5cdFx0Ly8gVXBkYXRlIGJvdGggam9icyB0YWJsZSAoc3RhdHVzKSBhbmQgam9iX3RpbWVfdHJhY2tpbmcgdGFibGUgKGFjdHVhbF9zdGFydCkgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0c3VwYWJhc2UuZnJvbShcImpvYnNcIikudXBkYXRlKHsgc3RhdHVzOiBcImluX3Byb2dyZXNzXCIgfSkuZXEoXCJpZFwiLCBqb2JJZCksXG5cdFx0XHRzdXBhYmFzZVxuXHRcdFx0XHQuZnJvbShcImpvYl90aW1lX3RyYWNraW5nXCIpXG5cdFx0XHRcdC51cGRhdGUoeyBhY3R1YWxfc3RhcnQ6IG5vdyB9KVxuXHRcdFx0XHQuZXEoXCJqb2JfaWRcIiwgam9iSWQpLFxuXHRcdF0pO1xuXG5cdFx0Ly8gQ2hlY2sgZm9yIGVycm9ycyBpbiBlaXRoZXIgdXBkYXRlXG5cdFx0Y29uc3QgZXJyb3JzID0gdXBkYXRlcy5maWx0ZXIoKHJlc3VsdCkgPT4gcmVzdWx0LmVycm9yKTtcblx0XHRpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwic3RhcnQgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBDb21wbGV0ZSBhIGpvYlxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgam9iX3RpbWVfdHJhY2tpbmcuYWN0dWFsX2VuZCBhbmQgY2FsY3VsYXRlcyB0b3RhbF9sYWJvcl9ob3Vyc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29tcGxldGVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHZvaWQ+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IGN1cnJlbnQgdXNlclxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdC8vIEdldCB1c2VyJ3MgYWN0aXZlIGNvbXBhbnkgdXNpbmcgaGVscGVyIChoYW5kbGVzIG11bHRpLWNvbXBhbnkgdXNlcnMpXG5cdFx0Y29uc3QgeyBnZXRBY3RpdmVDb21wYW55SWQgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL2F1dGgvY29tcGFueS1jb250ZXh0XCIpO1xuXHRcdGNvbnN0IGNvbXBhbnlJZCA9IGF3YWl0IGdldEFjdGl2ZUNvbXBhbnlJZCgpO1xuXG5cdFx0aWYgKCFjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGJlbG9uZ3MgdG8gY29tcGFueSBhbmQgZ2V0IHRpbWUgdHJhY2tpbmcgZGF0YVxuXHRcdGNvbnN0IHsgZGF0YTogZXhpc3RpbmdKb2IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkLCBzdGF0dXMsIHRpbWVUcmFja2luZzpqb2JfdGltZV90cmFja2luZygqKVwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbiBvbmx5IGNvbXBsZXRlIGluLXByb2dyZXNzIGpvYnNcblx0XHRpZiAoZXhpc3RpbmdKb2Iuc3RhdHVzICE9PSBcImluX3Byb2dyZXNzXCIpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgbXVzdCBiZSBpbiBwcm9ncmVzcyB0byBjb21wbGV0ZVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcblxuXHRcdC8vIENhbGN1bGF0ZSB0b3RhbCBsYWJvciBob3VycyBpZiB3ZSBoYXZlIGFjdHVhbF9zdGFydFxuXHRcdGNvbnN0IHRpbWVUcmFja2luZyA9IEFycmF5LmlzQXJyYXkoZXhpc3RpbmdKb2IudGltZVRyYWNraW5nKVxuXHRcdFx0PyBleGlzdGluZ0pvYi50aW1lVHJhY2tpbmdbMF1cblx0XHRcdDogZXhpc3RpbmdKb2IudGltZVRyYWNraW5nO1xuXG5cdFx0Y29uc3QgdGltZVRyYWNraW5nVXBkYXRlOiBhbnkgPSB7IGFjdHVhbF9lbmQ6IG5vdyB9O1xuXG5cdFx0aWYgKHRpbWVUcmFja2luZz8uYWN0dWFsX3N0YXJ0KSB7XG5cdFx0XHRjb25zdCBzdGFydFRpbWUgPSBuZXcgRGF0ZSh0aW1lVHJhY2tpbmcuYWN0dWFsX3N0YXJ0KS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBlbmRUaW1lID0gbmV3IERhdGUobm93KS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBob3Vyc1dvcmtlZCA9IChlbmRUaW1lIC0gc3RhcnRUaW1lKSAvICgxMDAwICogNjAgKiA2MCk7IC8vIENvbnZlcnQgbXMgdG8gaG91cnNcblx0XHRcdHRpbWVUcmFja2luZ1VwZGF0ZS50b3RhbF9sYWJvcl9ob3VycyA9IGhvdXJzV29ya2VkO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBib3RoIGpvYnMgdGFibGUgKHN0YXR1cykgYW5kIGpvYl90aW1lX3RyYWNraW5nIHRhYmxlIChhY3R1YWxfZW5kLCB0b3RhbF9sYWJvcl9ob3VycykgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0c3VwYWJhc2UuZnJvbShcImpvYnNcIikudXBkYXRlKHsgc3RhdHVzOiBcImNvbXBsZXRlZFwiIH0pLmVxKFwiaWRcIiwgam9iSWQpLFxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfdGltZV90cmFja2luZ1wiKVxuXHRcdFx0XHQudXBkYXRlKHRpbWVUcmFja2luZ1VwZGF0ZSlcblx0XHRcdFx0LmVxKFwiam9iX2lkXCIsIGpvYklkKSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gZWl0aGVyIHVwZGF0ZVxuXHRcdGNvbnN0IGVycm9ycyA9IHVwZGF0ZXMuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5lcnJvcik7XG5cdFx0aWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImNvbXBsZXRlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0fSk7XG59XG5cbi8qKlxuICogQ2FuY2VsIGEgam9iXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5zdGF0dXMgYW5kIGpvYnMubm90ZXNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gY2FuY2VsSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRyZWFzb24/OiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBjdXJyZW50IHVzZXJcblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzLCBub3Rlc1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbm5vdCBjYW5jZWwgY29tcGxldGVkIGpvYnNcblx0XHRpZiAoZXhpc3RpbmdKb2Iuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiQ2Fubm90IGNhbmNlbCBjb21wbGV0ZWQgam9ic1wiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEFkZCBjYW5jZWxsYXRpb24gcmVhc29uIHRvIG5vdGVzXG5cdFx0Y29uc3QgdXBkYXRlZE5vdGVzID0gcmVhc29uXG5cdFx0XHQ/IGAke2V4aXN0aW5nSm9iLm5vdGVzIHx8IFwiXCJ9XFxuXFxuW0NBTkNFTExFRF06ICR7cmVhc29ufWAudHJpbSgpXG5cdFx0XHQ6IGV4aXN0aW5nSm9iLm5vdGVzO1xuXG5cdFx0Ly8gQ2FuY2VsIGpvYlxuXHRcdGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0c3RhdHVzOiBcImNhbmNlbGxlZFwiLFxuXHRcdFx0XHRub3RlczogdXBkYXRlZE5vdGVzLFxuXHRcdFx0fSlcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKTtcblxuXHRcdGlmICh1cGRhdGVFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJjYW5jZWwgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBTZWFyY2ggam9icyB3aXRoIGZ1bGwtdGV4dCBzZWFyY2ggYW5kIHJhbmtpbmdcbiAqIOKchSBOTyBDSEFOR0VTIE5FRURFRCAtIE9ubHkgc2VhcmNoZXMgam9icyB0YWJsZVxuICovXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hKb2JzKFxuXHRzZWFyY2hUZXJtOiBzdHJpbmcsXG5cdG9wdGlvbnM/OiB7IGxpbWl0PzogbnVtYmVyOyBvZmZzZXQ/OiBudW1iZXIgfSxcbik6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueVtdPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiY29tcGFueV9tZW1iZXJzaGlwc1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWRcIilcblx0XHRcdC5lcShcInVzZXJfaWRcIiwgdXNlci5pZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGlmICghdGVhbU1lbWJlcj8uY29tcGFueV9pZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVzZSBmdWxsLXRleHQgc2VhcmNoIHdpdGggcmFua2luZyBmb3IgYmVzdCBtYXRjaGVzXG5cdFx0Y29uc3QgeyBzZWFyY2hKb2JzRnVsbFRleHQgfSA9IGF3YWl0IGltcG9ydChcblx0XHRcdFwiQC9saWIvc2VhcmNoL2Z1bGwtdGV4dC1zZWFyY2hcIlxuXHRcdCk7XG5cblx0XHRjb25zdCBqb2JzID0gYXdhaXQgc2VhcmNoSm9ic0Z1bGxUZXh0KHN1cGFiYXNlLCB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQsIHNlYXJjaFRlcm0sIHtcblx0XHRcdGxpbWl0OiBvcHRpb25zPy5saW1pdCB8fCA1MCxcblx0XHRcdG9mZnNldDogb3B0aW9ucz8ub2Zmc2V0IHx8IDAsXG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gam9icztcblx0fSk7XG59XG5cbi8qKlxuICogVW5pdmVyc2FsIHNlYXJjaCBhY3Jvc3MgYWxsIGVudGl0aWVzXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHNlYXJjaGVzIGpvYnMgdGFibGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2VhcmNoQWxsKFxuXHRzZWFyY2hUZXJtOiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDxhbnk+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Y29uc3QgeyBkYXRhOiB0ZWFtTWVtYmVyIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjb21wYW55X21lbWJlcnNoaXBzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWFtTWVtYmVyPy5jb21wYW55X2lkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVXNlIHVuaXZlcnNhbCBzZWFyY2ggUlBDIGZ1bmN0aW9uXG5cdFx0Y29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UucnBjKFwic2VhcmNoX2FsbF9lbnRpdGllc1wiLCB7XG5cdFx0XHRjb21wYW55X2lkX3BhcmFtOiB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQsXG5cdFx0XHRzZWFyY2hfcXVlcnk6IHNlYXJjaFRlcm0sXG5cdFx0XHRwZXJfZW50aXR5X2xpbWl0OiA1LFxuXHRcdH0pO1xuXG5cdFx0aWYgKGVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcInNlYXJjaFwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBkYXRhO1xuXHR9KTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSk9CIEFSQ0hJVkUgJiBSRVNUT1JFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogQXJjaGl2ZSBqb2IgKHNvZnQgZGVsZXRlKVxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgam9iX211bHRpX2VudGl0eS5kZWxldGVkX2J5IGFuZCBwZXJtYW5lbnRfZGVsZXRlX3NjaGVkdWxlZF9hdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXJjaGl2ZUpvYihqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHRjb25zdCB7IGRhdGE6IHRlYW1NZW1iZXIgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImNvbXBhbnlfbWVtYmVyc2hpcHNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJ1c2VyX2lkXCIsIHVzZXIuaWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoIXRlYW1NZW1iZXI/LmNvbXBhbnlfaWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogam9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGpvYi5jb21wYW55X2lkICE9PSB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwiam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBDYW5ub3QgYXJjaGl2ZSBjb21wbGV0ZWQvcGFpZCBqb2JzIChidXNpbmVzcyBydWxlKVxuXHRcdGlmIChqb2Iuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiIHx8IGpvYi5zdGF0dXMgPT09IFwiaW52b2ljZWRcIikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkNhbm5vdCBhcmNoaXZlIGNvbXBsZXRlZCBvciBpbnZvaWNlZCBqb2JzLiBUaGVzZSBtdXN0IGJlIHJldGFpbmVkIGZvciByZWNvcmRzLlwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEFyY2hpdmUgam9iIChzb2Z0IGRlbGV0ZSlcblx0XHRjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG5cdFx0Y29uc3Qgc2NoZWR1bGVkRGVsZXRpb24gPSBuZXcgRGF0ZShcblx0XHRcdERhdGUubm93KCkgKyA5MCAqIDI0ICogNjAgKiA2MCAqIDEwMDAsXG5cdFx0KS50b0lTT1N0cmluZygpO1xuXG5cdFx0Ly8gVXBkYXRlIGJvdGggam9icyB0YWJsZSBhbmQgam9iX211bHRpX2VudGl0eSB0YWJsZSBpbiBwYXJhbGxlbFxuXHRcdGNvbnN0IHVwZGF0ZXMgPSBhd2FpdCBQcm9taXNlLmFsbChbXG5cdFx0XHQvLyBVcGRhdGUgY29yZSBqb2JzIHRhYmxlIHdpdGggYXJjaGl2ZSBtZXRhZGF0YVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRcdGRlbGV0ZWRfYXQ6IG5vdyxcblx0XHRcdFx0XHRhcmNoaXZlZF9hdDogbm93LFxuXHRcdFx0XHRcdHN0YXR1czogXCJhcmNoaXZlZFwiLFxuXHRcdFx0XHR9KVxuXHRcdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCksXG5cblx0XHRcdC8vIFVwZGF0ZSBqb2JfbXVsdGlfZW50aXR5IHRhYmxlIHdpdGggZGVsZXRpb24gdHJhY2tpbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX211bHRpX2VudGl0eVwiKVxuXHRcdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0XHRkZWxldGVkX2J5OiB1c2VyLmlkLFxuXHRcdFx0XHRcdHBlcm1hbmVudF9kZWxldGVfc2NoZWR1bGVkX2F0OiBzY2hlZHVsZWREZWxldGlvbixcblx0XHRcdFx0fSlcblx0XHRcdFx0LmVxKFwiam9iX2lkXCIsIGpvYklkKSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gZWl0aGVyIHVwZGF0ZVxuXHRcdGNvbnN0IGVycm9ycyA9IHVwZGF0ZXMuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5lcnJvcik7XG5cdFx0aWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImFyY2hpdmUgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9zZXR0aW5ncy9hcmNoaXZlXCIpO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBSZXN0b3JlIGFyY2hpdmVkIGpvYlxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IGNsZWFycyBqb2JfbXVsdGlfZW50aXR5LmRlbGV0ZWRfYnkgYW5kIHBlcm1hbmVudF9kZWxldGVfc2NoZWR1bGVkX2F0XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlc3RvcmVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHZvaWQ+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Y29uc3QgeyBkYXRhOiB0ZWFtTWVtYmVyIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjb21wYW55X21lbWJlcnNoaXBzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWFtTWVtYmVyPy5jb21wYW55X2lkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnkgYW5kIGlzIGFyY2hpdmVkXG5cdFx0Y29uc3QgeyBkYXRhOiBqb2IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkLCBkZWxldGVkX2F0LCBzdGF0dXNcIilcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0YXNzZXJ0RXhpc3RzKGpvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoam9iLmNvbXBhbnlfaWQgIT09IHRlYW1NZW1iZXIuY29tcGFueV9pZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmICgham9iLmRlbGV0ZWRfYXQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgaXMgbm90IGFyY2hpdmVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmVzdG9yZSBqb2IgLSB1cGRhdGUgYm90aCB0YWJsZXMgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0Ly8gQ2xlYXIgY29yZSBqb2JzIHRhYmxlIGFyY2hpdmUgbWV0YWRhdGFcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0XHRkZWxldGVkX2F0OiBudWxsLFxuXHRcdFx0XHRcdGFyY2hpdmVkX2F0OiBudWxsLFxuXHRcdFx0XHRcdHN0YXR1czogam9iLnN0YXR1cyA9PT0gXCJhcmNoaXZlZFwiID8gXCJzY2hlZHVsZWRcIiA6IGpvYi5zdGF0dXMsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5lcShcImlkXCIsIGpvYklkKSxcblxuXHRcdFx0Ly8gQ2xlYXIgam9iX211bHRpX2VudGl0eSB0YWJsZSBkZWxldGlvbiB0cmFja2luZ1xuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfbXVsdGlfZW50aXR5XCIpXG5cdFx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRcdGRlbGV0ZWRfYnk6IG51bGwsXG5cdFx0XHRcdFx0cGVybWFuZW50X2RlbGV0ZV9zY2hlZHVsZWRfYXQ6IG51bGwsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5lcShcImpvYl9pZFwiLCBqb2JJZCksXG5cdFx0XSk7XG5cblx0XHQvLyBDaGVjayBmb3IgZXJyb3JzIGluIGVpdGhlciB1cGRhdGVcblx0XHRjb25zdCBlcnJvcnMgPSB1cGRhdGVzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuZXJyb3IpO1xuXHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJyZXN0b3JlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9zY2hlZHVsZVwiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvc2V0dGluZ3MvYXJjaGl2ZVwiKTtcblx0fSk7XG59XG5cbi8qKlxuICogUmVtb3ZlIHRlYW0gYXNzaWdubWVudCBmcm9tIGpvYlxuICog4pyFIE5PIENIQU5HRVMgTkVFREVEIC0gT25seSBkZWxldGVzIGZyb20gam9iX3RlYW1fYXNzaWdubWVudHMganVuY3Rpb24gdGFibGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVtb3ZlVGVhbUFzc2lnbm1lbnQoXG5cdGFzc2lnbm1lbnRJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IHRoZSBqdW5jdGlvbiByZWNvcmQgdG8gZmluZCBqb2JfaWQgZm9yIHJldmFsaWRhdGlvblxuXHRcdGNvbnN0IHsgZGF0YTogcmVjb3JkLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9iX3RlYW1fYXNzaWdubWVudHNcIilcblx0XHRcdC5zZWxlY3QoXCJpZCwgam9iX2lkLCBjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBhc3NpZ25tZW50SWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoZmV0Y2hFcnJvciB8fCAhcmVjb3JkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiVGVhbSBhc3NpZ25tZW50IG5vdCBmb3VuZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9SRUNPUkRfTk9UX0ZPVU5ELFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAocmVjb3JkLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJ0ZWFtIGFzc2lnbm1lbnRcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGpvYklkID0gcmVjb3JkLmpvYl9pZDtcblxuXHRcdC8vIERlbGV0ZSBqdW5jdGlvbiB0YWJsZSByb3dcblx0XHRjb25zdCB7IGVycm9yOiBkZWxldGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9iX3RlYW1fYXNzaWdubWVudHNcIilcblx0XHRcdC5kZWxldGUoKVxuXHRcdFx0LmVxKFwiaWRcIiwgYXNzaWdubWVudElkKTtcblxuXHRcdGlmIChkZWxldGVFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJyZW1vdmUgdGVhbSBhc3NpZ25tZW50IGZyb20gam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmV2YWxpZGF0ZSBqb2IgcGFnZSBhbmQgc2NoZWR1bGVcblx0XHRpZiAoam9iSWQpIHtcblx0XHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0XHR9XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBBc3NpZ24gQ3VzdG9tZXIgYW5kIFByb3BlcnR5IHRvIEpvYlxuICpcbiAqIFVwZGF0ZXMgdGhlIGpvYidzIGN1c3RvbWVyX2lkIGFuZCBwcm9wZXJ0eV9pZC5cbiAqIE9ubHkgb25lIGN1c3RvbWVyIGFuZCBwcm9wZXJ0eSBjYW4gYmUgYXNzaWduZWQgcGVyIGpvYi5cbiAqXG4gKiBAcGFyYW0gam9iSWQgLSBKb2IgSURcbiAqIEBwYXJhbSBjdXN0b21lcklkIC0gQ3VzdG9tZXIgSUQgdG8gYXNzaWduXG4gKiBAcGFyYW0gcHJvcGVydHlJZCAtIFByb3BlcnR5IElEIHRvIGFzc2lnbiAob3B0aW9uYWwpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhc3NpZ25DdXN0b21lclRvSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRjdXN0b21lcklkOiBzdHJpbmcsXG5cdHByb3BlcnR5SWQ6IHN0cmluZyB8IG51bGwsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdGNvbnN0IGNvbXBhbnlJZCA9IGF3YWl0IGdldEFjdGl2ZUNvbXBhbnlJZCgpO1xuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImNvbXBhbnkgYWNjZXNzXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGV4aXN0cyBhbmQgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBqb2IsIGVycm9yOiBqb2JFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImlkLCBjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LmlzKFwiZGVsZXRlZF9hdFwiLCBudWxsKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGpvYkVycm9yKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKFwiSm9iIHF1ZXJ5IGVycm9yOlwiLCBqb2JFcnJvcik7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmluZCBqb2I6ICR7am9iRXJyb3IubWVzc2FnZX1gLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdFx0NTAwLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRhc3NlcnRFeGlzdHMoam9iLCBcIkpvYlwiKTtcblxuXHRcdC8vIFZlcmlmeSBjdXN0b21lciBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogY3VzdG9tZXIsIGVycm9yOiBjdXN0b21lckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjdXN0b21lcnNcIilcblx0XHRcdC5zZWxlY3QoXCJpZCwgY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgY3VzdG9tZXJJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LmlzKFwiZGVsZXRlZF9hdFwiLCBudWxsKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGN1c3RvbWVyRXJyb3IpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJDdXN0b21lciBxdWVyeSBlcnJvcjpcIiwgY3VzdG9tZXJFcnJvcik7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmluZCBjdXN0b21lcjogJHtjdXN0b21lckVycm9yLm1lc3NhZ2V9YCxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHRcdDUwMCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0YXNzZXJ0RXhpc3RzKGN1c3RvbWVyLCBcIkN1c3RvbWVyXCIpO1xuXG5cdFx0Ly8gSWYgcHJvcGVydHkgaXMgcHJvdmlkZWQsIHZlcmlmeSBpdCBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY3VzdG9tZXJcblx0XHRpZiAocHJvcGVydHlJZCkge1xuXHRcdFx0Y29uc3QgeyBkYXRhOiBwcm9wZXJ0eSB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJwcm9wZXJ0aWVzXCIpXG5cdFx0XHRcdC5zZWxlY3QoXCJpZCwgY3VzdG9tZXJfaWRcIilcblx0XHRcdFx0LmVxKFwiaWRcIiwgcHJvcGVydHlJZClcblx0XHRcdFx0LmVxKFwiY3VzdG9tZXJfaWRcIiwgY3VzdG9tZXJJZClcblx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRpZiAoIXByb3BlcnR5KSB7XG5cdFx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XHRcIlByb3BlcnR5IG5vdCBmb3VuZCBvciBkb2VzIG5vdCBiZWxvbmcgdG8gdGhpcyBjdXN0b21lclwiLFxuXHRcdFx0XHRcdEVSUk9SX0NPREVTLkRCX1JFQ09SRF9OT1RfRk9VTkQsXG5cdFx0XHRcdFx0NDA0LFxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBqb2Igd2l0aCBjdXN0b21lciBhbmQgcHJvcGVydHlcblx0XHRjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnVwZGF0ZSh7XG5cdFx0XHRcdGN1c3RvbWVyX2lkOiBjdXN0b21lcklkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogcHJvcGVydHlJZCxcblx0XHRcdH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiYXNzaWduIGN1c3RvbWVyIHRvIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyBhY3Rpdml0eVxuXHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JfYWN0aXZpdHlfbG9nXCIpLmluc2VydCh7XG5cdFx0XHRqb2JfaWQ6IGpvYklkLFxuXHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0dXNlcl9pZDogdXNlci5pZCxcblx0XHRcdGFjdGl2aXR5X3R5cGU6IFwiYXNzaWduZWRcIixcblx0XHRcdGVudGl0eV90eXBlOiBcImN1c3RvbWVyXCIsXG5cdFx0XHRkZXNjcmlwdGlvbjogYEFzc2lnbmVkIGN1c3RvbWVyJHtwcm9wZXJ0eUlkID8gXCIgYW5kIHByb3BlcnR5XCIgOiBcIlwifWAsXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IHByb3BlcnR5SWQsXG5cdFx0XHR9LFxuXHRcdH0pO1xuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL3dlbGNvbWVcIik7XG5cdH0pO1xufVxuXG4vKipcbiAqIFJlbW92ZSBDdXN0b21lciBhbmQgUHJvcGVydHkgZnJvbSBKb2JcbiAqXG4gKiBSZW1vdmVzIHRoZSBjdXN0b21lcl9pZCBhbmQgcHJvcGVydHlfaWQgZnJvbSB0aGUgam9iLlxuICogUmVsYXRlZCBkYXRhIChhcHBvaW50bWVudHMsIGludm9pY2VzLCBldGMuKSByZW1haW4gYnV0IGFyZSBubyBsb25nZXIgbGlua2VkLlxuICpcbiAqIEBwYXJhbSBqb2JJZCAtIEpvYiBJRFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVtb3ZlQ3VzdG9tZXJGcm9tSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJjb21wYW55IGFjY2Vzc1wiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogam9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiaWQsIGNvbXBhbnlfaWQsIGN1c3RvbWVyX2lkLCBwcm9wZXJ0eV9pZFwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuZXEoXCJjb21wYW55X2lkXCIsIGNvbXBhbnlJZClcblx0XHRcdC5pcyhcImRlbGV0ZWRfYXRcIiwgbnVsbClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0Ly8gVXBkYXRlIGpvYiB0byByZW1vdmUgY3VzdG9tZXIgYW5kIHByb3BlcnR5XG5cdFx0Y29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRjdXN0b21lcl9pZDogbnVsbCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IG51bGwsXG5cdFx0XHR9KVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpO1xuXG5cdFx0aWYgKHVwZGF0ZUVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcInJlbW92ZSBjdXN0b21lciBmcm9tIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyBhY3Rpdml0eVxuXHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JfYWN0aXZpdHlfbG9nXCIpLmluc2VydCh7XG5cdFx0XHRqb2JfaWQ6IGpvYklkLFxuXHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0dXNlcl9pZDogdXNlci5pZCxcblx0XHRcdGFjdGl2aXR5X3R5cGU6IFwicmVtb3ZlZFwiLFxuXHRcdFx0ZW50aXR5X3R5cGU6IFwiY3VzdG9tZXJcIixcblx0XHRcdGRlc2NyaXB0aW9uOiBcIlJlbW92ZWQgY3VzdG9tZXIgYW5kIHByb3BlcnR5XCIsXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRwcmV2aW91c19jdXN0b21lcl9pZDogam9iLmN1c3RvbWVyX2lkLFxuXHRcdFx0XHRwcmV2aW91c19wcm9wZXJ0eV9pZDogam9iLnByb3BlcnR5X2lkLFxuXHRcdFx0fSxcblx0XHR9KTtcblxuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi93ZWxjb21lXCIpO1xuXHR9KTtcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOFJBaXdDc0IifQ==
}),
"[project]/apps/web/src/actions/data:f75fe3 [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"40576175987cf16f32be3023526ac2dd2b2fb21260":"completeJob"},"apps/web/src/actions/jobs.ts",""] */ __turbopack_context__.s([
    "completeJob",
    ()=>completeJob
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next@16.0.4_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
"use turbopack no side effects";
;
var completeJob = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("40576175987cf16f32be3023526ac2dd2b2fb21260", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "completeJob"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vam9icy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEpvYnMgU2VydmVyIEFjdGlvbnMgLSBSRUZBQ1RPUkVEIEZPUiBET01BSU4gVEFCTEUgU1RSVUNUVVJFXG4gKlxuICogSGFuZGxlcyBqb2Ivd29yayBvcmRlciBtYW5hZ2VtZW50IHdpdGggY29tcHJlaGVuc2l2ZSBDUlVEIG9wZXJhdGlvbnMsXG4gKiBzdGF0dXMgdHJhbnNpdGlvbnMsIHNjaGVkdWxpbmcsIGFuZCBhc3NpZ25tZW50IGxvZ2ljLlxuICpcbiAqIE1JR1JBVElPTiBOT1RFUzpcbiAqIC0gQ29yZSBqb2JzIHRhYmxlIG5vdyBoYXMgfjIwIGNvbHVtbnNcbiAqIC0gRG9tYWluLXNwZWNpZmljIGRhdGEgbW92ZWQgdG8gMTEgZG9tYWluIHRhYmxlc1xuICogLSBGaW5hbmNpYWwgZGF0YSAtPiBqb2JfZmluYW5jaWFsXG4gKiAtIFRpbWUgdHJhY2tpbmcgLT4gam9iX3RpbWVfdHJhY2tpbmdcbiAqIC0gQXJjaGl2ZS9kZWxldGlvbiAtPiBqb2JfbXVsdGlfZW50aXR5XG4gKiAtIEFsbCBkb21haW4gdGFibGVzIGhhdmUgQ0FTQ0FERSBkZWxldGUgb24gam9iX2lkXG4gKi9cblxuXCJ1c2Ugc2VydmVyXCI7XG5cbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5pbXBvcnQgeyBnZXRBY3RpdmVDb21wYW55SWQgfSBmcm9tIFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIjtcbmltcG9ydCB7XG5cdEFjdGlvbkVycm9yLFxuXHRFUlJPUl9DT0RFUyxcblx0RVJST1JfTUVTU0FHRVMsXG59IGZyb20gXCJAL2xpYi9lcnJvcnMvYWN0aW9uLWVycm9yXCI7XG5pbXBvcnQge1xuXHR0eXBlIEFjdGlvblJlc3VsdCxcblx0YXNzZXJ0QXV0aGVudGljYXRlZCxcblx0YXNzZXJ0RXhpc3RzLFxuXHR3aXRoRXJyb3JIYW5kbGluZyxcbn0gZnJvbSBcIkAvbGliL2Vycm9ycy93aXRoLWVycm9yLWhhbmRsaW5nXCI7XG5pbXBvcnQgeyBub3RpZnlKb2JDcmVhdGVkIH0gZnJvbSBcIkAvbGliL25vdGlmaWNhdGlvbnMvdHJpZ2dlcnNcIjtcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAL2xpYi9zdXBhYmFzZS9zZXJ2ZXJcIjtcbmltcG9ydCB7XG5cdHR5cGUgSm9iU3RhdHVzLFxuXHR0eXBlIEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0LFxuXHR2YWxpZGF0ZVN0YXR1c1RyYW5zaXRpb24sXG59IGZyb20gXCJAL2xpYi92YWxpZGF0aW9ucy9qb2Itc3RhdHVzLXRyYW5zaXRpb25zXCI7XG5cbi8vIFJlZ2V4IGNvbnN0YW50c1xuY29uc3QgSk9CX05VTUJFUl9SRUdFWCA9IC9KT0ItXFxkezR9LShcXGQrKS87XG5cbi8vIFZhbGlkYXRpb24gU2NoZW1hc1xuY29uc3QgY3JlYXRlSm9iU2NoZW1hID0gei5vYmplY3Qoe1xuXHRwcm9wZXJ0eUlkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIHByb3BlcnR5IElEXCIpLFxuXHRjdXN0b21lcklkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIGN1c3RvbWVyIElEXCIpLm9wdGlvbmFsKCksXG5cdHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCBcIkpvYiB0aXRsZSBpcyByZXF1aXJlZFwiKSxcblx0ZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblx0cHJpb3JpdHk6IHouZW51bShbXCJsb3dcIiwgXCJtZWRpdW1cIiwgXCJoaWdoXCIsIFwidXJnZW50XCJdKS5kZWZhdWx0KFwibWVkaXVtXCIpLFxuXHRqb2JUeXBlOiB6XG5cdFx0LmVudW0oW1xuXHRcdFx0XCJzZXJ2aWNlXCIsXG5cdFx0XHRcImluc3RhbGxhdGlvblwiLFxuXHRcdFx0XCJyZXBhaXJcIixcblx0XHRcdFwibWFpbnRlbmFuY2VcIixcblx0XHRcdFwiaW5zcGVjdGlvblwiLFxuXHRcdFx0XCJjb25zdWx0YXRpb25cIixcblx0XHRdKVxuXHRcdC5vcHRpb25hbCgpLFxuXHRzY2hlZHVsZWRTdGFydDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRzY2hlZHVsZWRFbmQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblx0YXNzaWduZWRUbzogei5zdHJpbmcoKS51dWlkKFwiSW52YWxpZCB1c2VyIElEXCIpLm9wdGlvbmFsKCksXG5cdG5vdGVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdC8vIEVuaGFuY2VkIHNjaGVkdWxpbmcgZmllbGRzXG5cdGlzUmVjdXJyaW5nOiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuXHRzY2hlZHVsaW5nTW9kZTogei5lbnVtKFtcInNwZWNpZmljXCIsIFwid2luZG93XCJdKS5vcHRpb25hbCgpLFxuXHR0aW1lV2luZG93OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VUeXBlOiB6XG5cdFx0LmVudW0oW1wiZGFpbHlcIiwgXCJ3ZWVrbHlcIiwgXCJiaXdlZWtseVwiLCBcIm1vbnRobHlcIiwgXCJxdWFydGVybHlcIiwgXCJ5ZWFybHlcIl0pXG5cdFx0Lm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VFbmREYXRlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VDb3VudDogei5udW1iZXIoKS5pbnQoKS5taW4oMSkubWF4KDM2NSkub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCB1cGRhdGVKb2JTY2hlbWEgPSB6Lm9iamVjdCh7XG5cdHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCBcIkpvYiB0aXRsZSBpcyByZXF1aXJlZFwiKS5vcHRpb25hbCgpLFxuXHRkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRzdGF0dXM6IHpcblx0XHQuZW51bShbXG5cdFx0XHRcInF1b3RlZFwiLFxuXHRcdFx0XCJzY2hlZHVsZWRcIixcblx0XHRcdFwiaW5fcHJvZ3Jlc3NcIixcblx0XHRcdFwib25faG9sZFwiLFxuXHRcdFx0XCJjb21wbGV0ZWRcIixcblx0XHRcdFwiY2FuY2VsbGVkXCIsXG5cdFx0XHRcImludm9pY2VkXCIsXG5cdFx0XHRcInBhaWRcIixcblx0XHRdKVxuXHRcdC5vcHRpb25hbCgpLFxuXHRwcmlvcml0eTogei5lbnVtKFtcImxvd1wiLCBcIm1lZGl1bVwiLCBcImhpZ2hcIiwgXCJ1cmdlbnRcIl0pLm9wdGlvbmFsKCksXG5cdGpvYlR5cGU6IHpcblx0XHQuZW51bShbXG5cdFx0XHRcInNlcnZpY2VcIixcblx0XHRcdFwiaW5zdGFsbGF0aW9uXCIsXG5cdFx0XHRcInJlcGFpclwiLFxuXHRcdFx0XCJtYWludGVuYW5jZVwiLFxuXHRcdFx0XCJpbnNwZWN0aW9uXCIsXG5cdFx0XHRcImNvbnN1bHRhdGlvblwiLFxuXHRcdF0pXG5cdFx0Lm9wdGlvbmFsKCksXG5cdG5vdGVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdC8vIEZpbmFuY2lhbCBmaWVsZHMgKG5vdyBpbiBqb2JfZmluYW5jaWFsIGRvbWFpbiB0YWJsZSlcblx0dG90YWxBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdHBhaWRBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdGRlcG9zaXRBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdHNjaGVkdWxlZFN0YXJ0OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHNjaGVkdWxlZEVuZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRhc3NpZ25lZFRvOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIHVzZXIgSURcIikub3B0aW9uYWwoKS5udWxsYWJsZSgpLFxuXHRjdXN0b21lcklkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIGN1c3RvbWVyIElEXCIpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcblx0cHJvcGVydHlJZDogei5zdHJpbmcoKS51dWlkKFwiSW52YWxpZCBwcm9wZXJ0eSBJRFwiKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG59KTtcblxuLy8gVHlwZSBmb3IgdXBkYXRlSm9iRGF0YSAtIG1ha2VzIGl0IGVhc2llciB0byB1c2UgcHJvZ3JhbW1hdGljYWxseVxuZXhwb3J0IHR5cGUgVXBkYXRlSm9iRGF0YSA9IHouaW5mZXI8dHlwZW9mIHVwZGF0ZUpvYlNjaGVtYT47XG5cbmNvbnN0IHNjaGVkdWxlSm9iU2NoZW1hID0gei5vYmplY3Qoe1xuXHRzY2hlZHVsZWRTdGFydDogei5zdHJpbmcoKSxcblx0c2NoZWR1bGVkRW5kOiB6LnN0cmluZygpLFxufSk7XG5cbi8qKlxuICogR2VuZXJhdGUgdW5pcXVlIGpvYiBudW1iZXJcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVKb2JOdW1iZXIoXG5cdHN1cGFiYXNlOiBhbnksXG5cdGNvbXBhbnlJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxzdHJpbmc+IHtcblx0Ly8gR2V0IHRoZSBsYXRlc3Qgam9iIG51bWJlciBmb3IgdGhpcyBjb21wYW55XG5cdGNvbnN0IHsgZGF0YTogbGF0ZXN0Sm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdC5zZWxlY3QoXCJqb2JfbnVtYmVyXCIpXG5cdFx0LmVxKFwiY29tcGFueV9pZFwiLCBjb21wYW55SWQpXG5cdFx0Lm9yZGVyKFwiY3JlYXRlZF9hdFwiLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcblx0XHQubGltaXQoMSlcblx0XHQuc2luZ2xlKCk7XG5cblx0aWYgKCFsYXRlc3RKb2IpIHtcblx0XHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tMDAxYDtcblx0fVxuXG5cdC8vIEV4dHJhY3QgbnVtYmVyIGZyb20gZm9ybWF0OiBKT0ItWVlZWS1OTk5cblx0Y29uc3QgbWF0Y2ggPSBsYXRlc3RKb2Iuam9iX251bWJlci5tYXRjaChKT0JfTlVNQkVSX1JFR0VYKTtcblx0aWYgKG1hdGNoKSB7XG5cdFx0Y29uc3QgbmV4dE51bWJlciA9IE51bWJlci5wYXJzZUludChtYXRjaFsxXSwgMTApICsgMTtcblx0XHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tJHtuZXh0TnVtYmVyLnRvU3RyaW5nKCkucGFkU3RhcnQoMywgXCIwXCIpfWA7XG5cdH1cblxuXHQvLyBGYWxsYmFja1xuXHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tJHtEYXRlLm5vdygpLnRvU3RyaW5nKCkuc2xpY2UoLTMpfWA7XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIG5leHQgcmVjdXJyZW5jZSBkYXRlXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZU5leHRSZWN1cnJlbmNlKFxuXHRjdXJyZW50RGF0ZTogRGF0ZSxcblx0cmVjdXJyZW5jZVR5cGU6IHN0cmluZyxcbik6IERhdGUge1xuXHRjb25zdCBuZXh0RGF0ZSA9IG5ldyBEYXRlKGN1cnJlbnREYXRlKTtcblxuXHRzd2l0Y2ggKHJlY3VycmVuY2VUeXBlKSB7XG5cdFx0Y2FzZSBcImRhaWx5XCI6XG5cdFx0XHRuZXh0RGF0ZS5zZXREYXRlKG5leHREYXRlLmdldERhdGUoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcIndlZWtseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RGF0ZShuZXh0RGF0ZS5nZXREYXRlKCkgKyA3KTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgXCJiaXdlZWtseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RGF0ZShuZXh0RGF0ZS5nZXREYXRlKCkgKyAxNCk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlIFwibW9udGhseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0TW9udGgobmV4dERhdGUuZ2V0TW9udGgoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcInF1YXJ0ZXJseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0TW9udGgobmV4dERhdGUuZ2V0TW9udGgoKSArIDMpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcInllYXJseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RnVsbFllYXIobmV4dERhdGUuZ2V0RnVsbFllYXIoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0ZGVmYXVsdDpcblx0XHRcdC8vIERlZmF1bHQgdG8gbW9udGhseSBpZiB1bmtub3duIHR5cGVcblx0XHRcdG5leHREYXRlLnNldE1vbnRoKG5leHREYXRlLmdldE1vbnRoKCkgKyAxKTtcblx0XHRcdGJyZWFrO1xuXHR9XG5cblx0cmV0dXJuIG5leHREYXRlO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZWN1cnJpbmcgam9ic1xuICovXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVSZWN1cnJpbmdKb2JzKFxuXHRzdXBhYmFzZTogYW55LFxuXHRjb21wYW55SWQ6IHN0cmluZyxcblx0YmFzZUpvYjogYW55LFxuXHRyZWN1cnJlbmNlVHlwZTogc3RyaW5nLFxuXHRyZWN1cnJlbmNlRW5kRGF0ZT86IHN0cmluZyxcblx0cmVjdXJyZW5jZUNvdW50PzogbnVtYmVyLFxuKTogUHJvbWlzZTx2b2lkPiB7XG5cdGlmICghYmFzZUpvYi5zY2hlZHVsZWRfc3RhcnQpIHtcblx0XHRyZXR1cm47IC8vIENhbid0IGNyZWF0ZSByZWN1cnJpbmcgam9icyB3aXRob3V0IGEgc3RhcnQgZGF0ZVxuXHR9XG5cblx0Y29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoYmFzZUpvYi5zY2hlZHVsZWRfc3RhcnQpO1xuXHRjb25zdCBlbmREYXRlID0gbmV3IERhdGUoYmFzZUpvYi5zY2hlZHVsZWRfZW5kIHx8IGJhc2VKb2Iuc2NoZWR1bGVkX3N0YXJ0KTtcblx0Y29uc3QgZHVyYXRpb24gPSBlbmREYXRlLmdldFRpbWUoKSAtIHN0YXJ0RGF0ZS5nZXRUaW1lKCk7XG5cblx0Ly8gRGV0ZXJtaW5lIGhvdyBtYW55IG9jY3VycmVuY2VzIHRvIGNyZWF0ZVxuXHRjb25zdCBtYXhPY2N1cnJlbmNlcyA9IHJlY3VycmVuY2VDb3VudCB8fCA1MjsgLy8gRGVmYXVsdCB0byAxIHllYXIgb2Ygd2Vla2x5IGpvYnNcblx0Y29uc3QgZW5kRGF0ZUxpbWl0ID0gcmVjdXJyZW5jZUVuZERhdGUgPyBuZXcgRGF0ZShyZWN1cnJlbmNlRW5kRGF0ZSkgOiBudWxsO1xuXG5cdGNvbnN0IHJlY3VycmluZ0pvYnM6ICh0eXBlb2YgYmFzZUpvYilbXSA9IFtdO1xuXHRsZXQgY3VycmVudERhdGUgPSBuZXcgRGF0ZShzdGFydERhdGUpO1xuXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgbWF4T2NjdXJyZW5jZXMgLSAxOyBpKyspIHtcblx0XHQvLyAtMSBiZWNhdXNlIHdlIGFscmVhZHkgY3JlYXRlZCB0aGUgZmlyc3Qgam9iXG5cdFx0Y3VycmVudERhdGUgPSBjYWxjdWxhdGVOZXh0UmVjdXJyZW5jZShjdXJyZW50RGF0ZSwgcmVjdXJyZW5jZVR5cGUpO1xuXG5cdFx0Ly8gU3RvcCBpZiB3ZSd2ZSByZWFjaGVkIHRoZSBlbmQgZGF0ZVxuXHRcdGlmIChlbmREYXRlTGltaXQgJiYgY3VycmVudERhdGUgPiBlbmREYXRlTGltaXQpIHtcblx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdGNvbnN0IGN1cnJlbnRFbmREYXRlID0gbmV3IERhdGUoY3VycmVudERhdGUuZ2V0VGltZSgpICsgZHVyYXRpb24pO1xuXG5cdFx0Ly8gR2VuZXJhdGUgYSB1bmlxdWUgam9iIG51bWJlciBmb3IgdGhpcyBvY2N1cnJlbmNlXG5cdFx0Y29uc3Qgam9iTnVtYmVyID0gYXdhaXQgZ2VuZXJhdGVKb2JOdW1iZXIoc3VwYWJhc2UsIGNvbXBhbnlJZCk7XG5cblx0XHRyZWN1cnJpbmdKb2JzLnB1c2goe1xuXHRcdFx0Li4uYmFzZUpvYixcblx0XHRcdGpvYl9udW1iZXI6IGpvYk51bWJlcixcblx0XHRcdHNjaGVkdWxlZF9zdGFydDogY3VycmVudERhdGUudG9JU09TdHJpbmcoKSxcblx0XHRcdHNjaGVkdWxlZF9lbmQ6IGN1cnJlbnRFbmREYXRlLnRvSVNPU3RyaW5nKCksXG5cdFx0XHR0aXRsZTogYCR7YmFzZUpvYi50aXRsZX0gKCR7aSArIDJ9LyR7bWF4T2NjdXJyZW5jZXN9KWAsIC8vIEFkZCBvY2N1cnJlbmNlIG51bWJlclxuXHRcdH0pO1xuXG5cdFx0Ly8gQ3JlYXRlIGpvYnMgaW4gYmF0Y2hlcyBvZiAxMCB0byBhdm9pZCBtZW1vcnkgaXNzdWVzXG5cdFx0aWYgKHJlY3VycmluZ0pvYnMubGVuZ3RoID49IDEwKSB7XG5cdFx0XHRhd2FpdCBzdXBhYmFzZS5mcm9tKFwiam9ic1wiKS5pbnNlcnQocmVjdXJyaW5nSm9icyk7XG5cdFx0XHRyZWN1cnJpbmdKb2JzLmxlbmd0aCA9IDA7IC8vIENsZWFyIGFycmF5XG5cdFx0fVxuXHR9XG5cblx0Ly8gSW5zZXJ0IGFueSByZW1haW5pbmcgam9ic1xuXHRpZiAocmVjdXJyaW5nSm9icy5sZW5ndGggPiAwKSB7XG5cdFx0YXdhaXQgc3VwYWJhc2UuZnJvbShcImpvYnNcIikuaW5zZXJ0KHJlY3VycmluZ0pvYnMpO1xuXHR9XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgbmV3IGpvYlxuICog4pyFIEFMUkVBRFkgTUlHUkFURUQgLSBDcmVhdGVzIGNvcmUgam9iICsgYWxsIDEwIGRvbWFpbiByZWNvcmRzIGluIHBhcmFsbGVsXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVKb2IoXG5cdGZvcm1EYXRhOiBGb3JtRGF0YSxcbik6IFByb21pc2U8QWN0aW9uUmVzdWx0PHN0cmluZz4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSBjcmVhdGVKb2JTY2hlbWEucGFyc2Uoe1xuXHRcdFx0cHJvcGVydHlJZDogZm9ybURhdGEuZ2V0KFwicHJvcGVydHlJZFwiKSxcblx0XHRcdGN1c3RvbWVySWQ6IGZvcm1EYXRhLmdldChcImN1c3RvbWVySWRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0dGl0bGU6IGZvcm1EYXRhLmdldChcInRpdGxlXCIpLFxuXHRcdFx0ZGVzY3JpcHRpb246IGZvcm1EYXRhLmdldChcImRlc2NyaXB0aW9uXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdHByaW9yaXR5OiBmb3JtRGF0YS5nZXQoXCJwcmlvcml0eVwiKSB8fCBcIm1lZGl1bVwiLFxuXHRcdFx0am9iVHlwZTogZm9ybURhdGEuZ2V0KFwiam9iVHlwZVwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRzY2hlZHVsZWRTdGFydDogZm9ybURhdGEuZ2V0KFwic2NoZWR1bGVkU3RhcnRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0c2NoZWR1bGVkRW5kOiBmb3JtRGF0YS5nZXQoXCJzY2hlZHVsZWRFbmRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0YXNzaWduZWRUbzogZm9ybURhdGEuZ2V0KFwiYXNzaWduZWRUb1wiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRub3RlczogZm9ybURhdGEuZ2V0KFwibm90ZXNcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0Ly8gRW5oYW5jZWQgc2NoZWR1bGluZyBmaWVsZHNcblx0XHRcdGlzUmVjdXJyaW5nOiBmb3JtRGF0YS5nZXQoXCJpc1JlY3VycmluZ1wiKSA9PT0gXCJ0cnVlXCIsXG5cdFx0XHRzY2hlZHVsaW5nTW9kZTogKGZvcm1EYXRhLmdldChcInNjaGVkdWxpbmdNb2RlXCIpIGFzIGFueSkgfHwgdW5kZWZpbmVkLFxuXHRcdFx0dGltZVdpbmRvdzogZm9ybURhdGEuZ2V0KFwidGltZVdpbmRvd1wiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRyZWN1cnJlbmNlVHlwZTogKGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VUeXBlXCIpIGFzIGFueSkgfHwgdW5kZWZpbmVkLFxuXHRcdFx0cmVjdXJyZW5jZUVuZERhdGU6IGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VFbmREYXRlXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdHJlY3VycmVuY2VDb3VudDogZm9ybURhdGEuZ2V0KFwicmVjdXJyZW5jZUNvdW50XCIpXG5cdFx0XHRcdD8gTnVtYmVyLnBhcnNlSW50KGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VDb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHR9KTtcblxuXHRcdC8vIFZlcmlmeSBwcm9wZXJ0eSBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IHByb3BlcnR5IH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJwcm9wZXJ0aWVzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgY3VzdG9tZXJfaWQsIGFkZHJlc3NcIilcblx0XHRcdC5lcShcImlkXCIsIGRhdGEucHJvcGVydHlJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhwcm9wZXJ0eSwgXCJQcm9wZXJ0eVwiKTtcblxuXHRcdGlmIChwcm9wZXJ0eS5jb21wYW55X2lkICE9PSBjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwicHJvcGVydHlcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVzZSBjdXN0b21lciBmcm9tIHByb3BlcnR5IGlmIG5vdCBwcm92aWRlZFxuXHRcdGNvbnN0IGN1c3RvbWVySWQgPSBkYXRhLmN1c3RvbWVySWQgfHwgcHJvcGVydHkuY3VzdG9tZXJfaWQ7XG5cblx0XHQvLyBHZW5lcmF0ZSB1bmlxdWUgam9iIG51bWJlclxuXHRcdGNvbnN0IGpvYk51bWJlciA9IGF3YWl0IGdlbmVyYXRlSm9iTnVtYmVyKHN1cGFiYXNlLCBjb21wYW55SWQpO1xuXG5cdFx0Ly8gQWRkIHRpbWUgd2luZG93IGluZm8gdG8gbm90ZXMgaWYgYXBwbGljYWJsZVxuXHRcdGxldCBqb2JOb3RlcyA9IGRhdGEubm90ZXMgfHwgXCJcIjtcblx0XHRpZiAoZGF0YS5zY2hlZHVsaW5nTW9kZSA9PT0gXCJ3aW5kb3dcIiAmJiBkYXRhLnRpbWVXaW5kb3cpIHtcblx0XHRcdGNvbnN0IHdpbmRvd0luZm8gPSBgXFxuXFxuW1NjaGVkdWxpbmddIEN1c3RvbWVyIHByZWZlcnJlZCB0aW1lIHdpbmRvdzogJHtkYXRhLnRpbWVXaW5kb3cuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBkYXRhLnRpbWVXaW5kb3cuc2xpY2UoMSl9YDtcblx0XHRcdGpvYk5vdGVzID0gam9iTm90ZXMgPyBgJHtqb2JOb3Rlc30ke3dpbmRvd0luZm99YCA6IHdpbmRvd0luZm8udHJpbSgpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBjb3JlIGpvYiByZWNvcmRcblx0XHRjb25zdCB7IGRhdGE6IG5ld0pvYiwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogZGF0YS5wcm9wZXJ0eUlkLFxuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0YXNzaWduZWRfdG86IGRhdGEuYXNzaWduZWRUbyxcblx0XHRcdFx0am9iX251bWJlcjogam9iTnVtYmVyLFxuXHRcdFx0XHR0aXRsZTogZGF0YS50aXRsZSxcblx0XHRcdFx0ZGVzY3JpcHRpb246IGRhdGEuZGVzY3JpcHRpb24sXG5cdFx0XHRcdHN0YXR1czogXCJxdW90ZWRcIixcblx0XHRcdFx0cHJpb3JpdHk6IGRhdGEucHJpb3JpdHksXG5cdFx0XHRcdGpvYl90eXBlOiBkYXRhLmpvYlR5cGUsXG5cdFx0XHRcdHNlcnZpY2VfdHlwZTogZGF0YS5qb2JUeXBlLCAvLyBEZWZhdWx0IHNlcnZpY2VfdHlwZSB0byBqb2JfdHlwZVxuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRub3Rlczogam9iTm90ZXMsXG5cdFx0XHR9KVxuXHRcdFx0LnNlbGVjdChcImlkXCIpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoY3JlYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiY3JlYXRlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBkb21haW4gcmVjb3JkcyAocGFyYWxsZWwgaW5zZXJ0cyBmb3IgcGVyZm9ybWFuY2UpXG5cdFx0Y29uc3QgZG9tYWluSW5zZXJ0cyA9IGF3YWl0IFByb21pc2UuYWxsKFtcblx0XHRcdC8vIEZpbmFuY2lhbCBkb21haW4gLSBhbHdheXMgY3JlYXRlIHdpdGggZGVmYXVsdHNcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2ZpbmFuY2lhbFwiKVxuXHRcdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0XHRqb2JfaWQ6IG5ld0pvYi5pZCxcblx0XHRcdFx0XHRjb21wYW55X2lkOiBjb21wYW55SWQsXG5cdFx0XHRcdFx0dG90YWxfYW1vdW50OiAwLFxuXHRcdFx0XHRcdHBhaWRfYW1vdW50OiAwLFxuXHRcdFx0XHRcdGRlcG9zaXRfYW1vdW50OiAwLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gV29ya2Zsb3cgZG9tYWluIC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2Jfd29ya2Zsb3dcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdHdvcmtmbG93X2NvbXBsZXRlZF9zdGFnZXM6IFtdLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gVGltZSB0cmFja2luZyAtIGFsd2F5cyBjcmVhdGVcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX3RpbWVfdHJhY2tpbmdcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdHRvdGFsX2xhYm9yX2hvdXJzOiAwLFxuXHRcdFx0XHRcdGJyZWFrX3RpbWVfbWludXRlczogMCxcblx0XHRcdFx0fSksXG5cblx0XHRcdC8vIEN1c3RvbWVyIGFwcHJvdmFsIC0gYWx3YXlzIGNyZWF0ZSB3aXRoIHBlbmRpbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2N1c3RvbWVyX2FwcHJvdmFsXCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRjdXN0b21lcl9hcHByb3ZhbF9zdGF0dXM6IFwicGVuZGluZ1wiLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gRXF1aXBtZW50IHNlcnZpY2UgLSBhbHdheXMgY3JlYXRlXG5cdFx0XHRzdXBhYmFzZVxuXHRcdFx0XHQuZnJvbShcImpvYl9lcXVpcG1lbnRfc2VydmljZVwiKVxuXHRcdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0XHRqb2JfaWQ6IG5ld0pvYi5pZCxcblx0XHRcdFx0XHRjb21wYW55X2lkOiBjb21wYW55SWQsXG5cdFx0XHRcdFx0ZXF1aXBtZW50X3NlcnZpY2VfaGlzdG9yeTogW10sXG5cdFx0XHRcdFx0ZXF1aXBtZW50X3NlcnZpY2VkOiBbXSxcblx0XHRcdFx0fSksXG5cblx0XHRcdC8vIERpc3BhdGNoIC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfZGlzcGF0Y2hcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gUXVhbGl0eSAtIGFsd2F5cyBjcmVhdGVcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX3F1YWxpdHlcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdGluc3BlY3Rpb25fcmVxdWlyZWQ6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gU2FmZXR5IC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2Jfc2FmZXR5XCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRyZXF1aXJlc19wZXJtaXQ6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gQUkgZW5yaWNobWVudCAtIGNyZWF0ZSBlbXB0eSBmb3IgZnV0dXJlIHByb2Nlc3Npbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2FpX2VucmljaG1lbnRcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gTXVsdGktZW50aXR5IC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfbXVsdGlfZW50aXR5XCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRyZXF1aXJlc19tdWx0aXBsZV9wcm9wZXJ0aWVzOiBmYWxzZSxcblx0XHRcdFx0XHRyZXF1aXJlc19tdWx0aXBsZV9jdXN0b21lcnM6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBhbnkgZG9tYWluIGluc2VydCBlcnJvcnNcblx0XHRjb25zdCBkb21haW5FcnJvcnMgPSBkb21haW5JbnNlcnRzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuZXJyb3IpO1xuXHRcdGlmIChkb21haW5FcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0Ly8gUm9sbGJhY2sgLSBkZWxldGUgdGhlIGpvYiAoQ0FTQ0FERSB3aWxsIGRlbGV0ZSBkb21haW4gcmVjb3Jkcylcblx0XHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JzXCIpLmRlbGV0ZSgpLmVxKFwiaWRcIiwgbmV3Sm9iLmlkKTtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiY3JlYXRlIGpvYiBkb21haW5zXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQ3JlYXRlIHJlY3VycmluZyBqb2JzIGlmIHJlcXVlc3RlZFxuXHRcdGlmIChkYXRhLmlzUmVjdXJyaW5nICYmIGRhdGEucmVjdXJyZW5jZVR5cGUgJiYgZGF0YS5zY2hlZHVsZWRTdGFydCkge1xuXHRcdFx0Y29uc3QgYmFzZUpvYiA9IHtcblx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogZGF0YS5wcm9wZXJ0eUlkLFxuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0YXNzaWduZWRfdG86IGRhdGEuYXNzaWduZWRUbyxcblx0XHRcdFx0dGl0bGU6IGRhdGEudGl0bGUsXG5cdFx0XHRcdGRlc2NyaXB0aW9uOiBkYXRhLmRlc2NyaXB0aW9uLFxuXHRcdFx0XHRzdGF0dXM6IFwicXVvdGVkXCIsXG5cdFx0XHRcdHByaW9yaXR5OiBkYXRhLnByaW9yaXR5LFxuXHRcdFx0XHRqb2JfdHlwZTogZGF0YS5qb2JUeXBlLFxuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRub3RlczogZGF0YS5ub3Rlcyxcblx0XHRcdH07XG5cblx0XHRcdGF3YWl0IGNyZWF0ZVJlY3VycmluZ0pvYnMoXG5cdFx0XHRcdHN1cGFiYXNlLFxuXHRcdFx0XHRjb21wYW55SWQsXG5cdFx0XHRcdGJhc2VKb2IsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZVR5cGUsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZUVuZERhdGUsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZUNvdW50LFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBTZW5kIG5vdGlmaWNhdGlvbiB0byBhc3NpZ25lZCB1c2VyIGlmIGpvYiBpcyBhc3NpZ25lZFxuXHRcdGlmIChkYXRhLmFzc2lnbmVkVG8gJiYgZGF0YS5hc3NpZ25lZFRvICE9PSB1c2VyLmlkKSB7XG5cdFx0XHRhd2FpdCBub3RpZnlKb2JDcmVhdGVkKHtcblx0XHRcdFx0dXNlcklkOiBkYXRhLmFzc2lnbmVkVG8sXG5cdFx0XHRcdGNvbXBhbnlJZDogY29tcGFueUlkLFxuXHRcdFx0XHRqb2JJZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRqb2JUaXRsZTogZGF0YS50aXRsZSxcblx0XHRcdFx0YWRkcmVzczogcHJvcGVydHkuYWRkcmVzcyB8fCBcIlVua25vd24gYWRkcmVzc1wiLFxuXHRcdFx0XHRwcmlvcml0eTpcblx0XHRcdFx0XHRkYXRhLnByaW9yaXR5ID09PSBcInVyZ2VudFwiXG5cdFx0XHRcdFx0XHQ/IFwidXJnZW50XCJcblx0XHRcdFx0XHRcdDogZGF0YS5wcmlvcml0eSA9PT0gXCJoaWdoXCJcblx0XHRcdFx0XHRcdFx0PyBcImhpZ2hcIlxuXHRcdFx0XHRcdFx0XHQ6IFwibWVkaXVtXCIsXG5cdFx0XHRcdGFjdGlvblVybDogXCIvZGFzaGJvYXJkL3dvcmtcIixcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrL2pvYnNcIik7XG5cdFx0cmV0dXJuIG5ld0pvYi5pZDtcblx0fSk7XG59XG5cbi8qKlxuICogR2V0IGEgc2luZ2xlIGpvYiBieSBJRFxuICog4pyFIEFMUkVBRFkgTUlHUkFURUQgLSBGZXRjaGVzIGpvYiB3aXRoIGFsbCBkb21haW4gZGF0YVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueT4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBqb2Igd2l0aCBiYXNpYyByZWxhdGlvbnNoaXBzXG5cdFx0Ly8gU2ltcGxpZmllZCBxdWVyeSAtIG1hbnkgZG9tYWluIHRhYmxlcyBkb24ndCBleGlzdCB5ZXRcblx0XHRjb25zdCB7IGRhdGE6IGpvYiwgZXJyb3I6IGpvYkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRgXG5cdFx0XHRcdCosXG5cdFx0XHRcdHByb3BlcnR5OnByb3BlcnRpZXMoKiksXG5cdFx0XHRcdGN1c3RvbWVyOmN1c3RvbWVycyFjdXN0b21lcl9pZChpZCwgZmlyc3RfbmFtZSwgbGFzdF9uYW1lLCBlbWFpbCwgcGhvbmUsIGRpc3BsYXlfbmFtZSlcblx0XHRcdGAsXG5cdFx0XHQpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGpvYkVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm5vdEZvdW5kKFwiSm9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9SRUNPUkRfTk9UX0ZPVU5ELFxuXHRcdFx0XHQ0MDQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRpZiAoam9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBqb2I7XG5cdH0pO1xufVxuXG4vKipcbiAqIFVwZGF0ZSBqb2IgZGV0YWlsc1xuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgYm90aCBjb3JlIGpvYnMgdGFibGUgYW5kIGRvbWFpbiB0YWJsZXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYihcblx0am9iSWQ6IHN0cmluZyxcblx0Zm9ybURhdGE6IEZvcm1EYXRhLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IGFjdGl2ZSBjb21wYW55IElEXG5cdFx0Y29uc3QgYWN0aXZlQ29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cdFx0aWYgKCFhY3RpdmVDb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgdXNlcidzIHJvbGUgdG8gY2hlY2sgaWYgdGhleSdyZSBhZG1pbi9vd25lclxuXHRcdGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiY29tcGFueV9tZW1iZXJzaGlwc1wiKVxuXHRcdFx0LnNlbGVjdChcblx0XHRcdFx0YFxuICAgICAgICByb2xlX2lkLFxuICAgICAgICBjdXN0b21fcm9sZXMhcm9sZV9pZChuYW1lLCBpc19zeXN0ZW0pXG4gICAgICBgLFxuXHRcdFx0KVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LmVxKFwiY29tcGFueV9pZFwiLCBhY3RpdmVDb21wYW55SWQpXG5cdFx0XHQuZXEoXCJzdGF0dXNcIiwgXCJhY3RpdmVcIilcblx0XHRcdC5tYXliZVNpbmdsZSgpO1xuXG5cdFx0Y29uc3Qgcm9sZSA9IEFycmF5LmlzQXJyYXkodGVhbU1lbWJlcj8uY3VzdG9tX3JvbGVzKVxuXHRcdFx0PyB0ZWFtTWVtYmVyLmN1c3RvbV9yb2xlc1swXVxuXHRcdFx0OiB0ZWFtTWVtYmVyPy5jdXN0b21fcm9sZXM7XG5cblx0XHRjb25zdCBpc0FkbWluT3JPd25lciA9XG5cdFx0XHRyb2xlPy5uYW1lID09PSBcIkFkbWluXCIgfHxcblx0XHRcdHJvbGU/Lm5hbWUgPT09IFwiT3duZXJcIiB8fFxuXHRcdFx0cm9sZT8uaXNfc3lzdGVtID09PSB0cnVlO1xuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhleGlzdGluZ0pvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoZXhpc3RpbmdKb2IuY29tcGFueV9pZCAhPT0gYWN0aXZlQ29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUHJldmVudCBlZGl0aW5nIGNvbXBsZXRlZCBvciBjYW5jZWxsZWQgam9icyAodW5sZXNzIGFkbWluL293bmVyKVxuXHRcdGlmIChcblx0XHRcdCFpc0FkbWluT3JPd25lciAmJlxuXHRcdFx0KGV4aXN0aW5nSm9iLnN0YXR1cyA9PT0gXCJjb21wbGV0ZWRcIiB8fCBleGlzdGluZ0pvYi5zdGF0dXMgPT09IFwiY2FuY2VsbGVkXCIpXG5cdFx0KSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBDYW5ub3QgZWRpdCAke2V4aXN0aW5nSm9iLnN0YXR1c30gam9ic2AsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgY3VzdG9tZXJJZFZhbHVlID0gZm9ybURhdGEuZ2V0KFwiY3VzdG9tZXJJZFwiKTtcblx0XHRjb25zdCBwcm9wZXJ0eUlkVmFsdWUgPSBmb3JtRGF0YS5nZXQoXCJwcm9wZXJ0eUlkXCIpO1xuXG5cdFx0Ly8gSGFuZGxlIGN1c3RvbWVySWQ6IGVtcHR5IHN0cmluZyBvciBcIm51bGxcIiBzdHJpbmcgbWVhbnMgcmVtb3ZlIChzZXQgdG8gbnVsbClcblx0XHQvLyB1bmRlZmluZWQgbWVhbnMgZG9uJ3QgY2hhbmdlIGl0XG5cdFx0bGV0IHBhcnNlZEN1c3RvbWVySWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG5cdFx0aWYgKGN1c3RvbWVySWRWYWx1ZSA9PT0gbnVsbCB8fCBjdXN0b21lcklkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyc2VkQ3VzdG9tZXJJZCA9IHVuZGVmaW5lZDsgLy8gRG9uJ3QgY2hhbmdlXG5cdFx0fSBlbHNlIGlmIChjdXN0b21lcklkVmFsdWUgPT09IFwiXCIgfHwgY3VzdG9tZXJJZFZhbHVlID09PSBcIm51bGxcIikge1xuXHRcdFx0cGFyc2VkQ3VzdG9tZXJJZCA9IG51bGw7IC8vIFJlbW92ZSBjdXN0b21lclxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJzZWRDdXN0b21lcklkID0gY3VzdG9tZXJJZFZhbHVlIGFzIHN0cmluZzsgLy8gU2V0IHRvIHRoaXMgY3VzdG9tZXJcblx0XHR9XG5cblx0XHQvLyBIYW5kbGUgcHJvcGVydHlJZDogZW1wdHkgc3RyaW5nIG1lYW5zIHJlbW92ZSAoc2V0IHRvIG51bGwpLCB1bmRlZmluZWQgbWVhbnMgZG9uJ3QgY2hhbmdlXG5cdFx0bGV0IHBhcnNlZFByb3BlcnR5SWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG5cdFx0aWYgKHByb3BlcnR5SWRWYWx1ZSA9PT0gbnVsbCB8fCBwcm9wZXJ0eUlkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyc2VkUHJvcGVydHlJZCA9IHVuZGVmaW5lZDsgLy8gRG9uJ3QgY2hhbmdlXG5cdFx0fSBlbHNlIGlmIChwcm9wZXJ0eUlkVmFsdWUgPT09IFwiXCIgfHwgcHJvcGVydHlJZFZhbHVlID09PSBcIm51bGxcIikge1xuXHRcdFx0cGFyc2VkUHJvcGVydHlJZCA9IG51bGw7IC8vIFJlbW92ZSBwcm9wZXJ0eVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJzZWRQcm9wZXJ0eUlkID0gcHJvcGVydHlJZFZhbHVlIGFzIHN0cmluZzsgLy8gU2V0IHRvIHRoaXMgcHJvcGVydHlcblx0XHR9XG5cblx0XHRjb25zdCBkYXRhID0gdXBkYXRlSm9iU2NoZW1hLnBhcnNlKHtcblx0XHRcdHRpdGxlOiBmb3JtRGF0YS5nZXQoXCJ0aXRsZVwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRkZXNjcmlwdGlvbjogZm9ybURhdGEuZ2V0KFwiZGVzY3JpcHRpb25cIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0c3RhdHVzOiBmb3JtRGF0YS5nZXQoXCJzdGF0dXNcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0cHJpb3JpdHk6IGZvcm1EYXRhLmdldChcInByaW9yaXR5XCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdGpvYlR5cGU6IGZvcm1EYXRhLmdldChcImpvYlR5cGVcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0bm90ZXM6IGZvcm1EYXRhLmdldChcIm5vdGVzXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdC8vIEZpbmFuY2lhbCBmaWVsZHMgKG5vdyBpbiBqb2JfZmluYW5jaWFsIGRvbWFpbiB0YWJsZSlcblx0XHRcdHRvdGFsQW1vdW50OiBmb3JtRGF0YS5nZXQoXCJ0b3RhbEFtb3VudFwiKVxuXHRcdFx0XHQ/IE51bWJlci5wYXJzZUludChmb3JtRGF0YS5nZXQoXCJ0b3RhbEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdHBhaWRBbW91bnQ6IGZvcm1EYXRhLmdldChcInBhaWRBbW91bnRcIilcblx0XHRcdFx0PyBOdW1iZXIucGFyc2VJbnQoZm9ybURhdGEuZ2V0KFwicGFpZEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdGRlcG9zaXRBbW91bnQ6IGZvcm1EYXRhLmdldChcImRlcG9zaXRBbW91bnRcIilcblx0XHRcdFx0PyBOdW1iZXIucGFyc2VJbnQoZm9ybURhdGEuZ2V0KFwiZGVwb3NpdEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdHNjaGVkdWxlZFN0YXJ0OiBmb3JtRGF0YS5nZXQoXCJzY2hlZHVsZWRTdGFydFwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRzY2hlZHVsZWRFbmQ6IGZvcm1EYXRhLmdldChcInNjaGVkdWxlZEVuZFwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRhc3NpZ25lZFRvOiBmb3JtRGF0YS5nZXQoXCJhc3NpZ25lZFRvXCIpIHx8IG51bGwsXG5cdFx0XHRjdXN0b21lcklkOiBwYXJzZWRDdXN0b21lcklkLFxuXHRcdFx0cHJvcGVydHlJZDogcGFyc2VkUHJvcGVydHlJZCxcblx0XHR9KTtcblxuXHRcdC8vIElmIHN0YXR1cyBpcyBiZWluZyBjaGFuZ2VkLCB2YWxpZGF0ZSB0aGUgdHJhbnNpdGlvblxuXHRcdGlmIChkYXRhLnN0YXR1cyAhPT0gdW5kZWZpbmVkICYmIGRhdGEuc3RhdHVzICE9PSBleGlzdGluZ0pvYi5zdGF0dXMpIHtcblx0XHRcdC8vIEZldGNoIGFkZGl0aW9uYWwgY29udGV4dCBmb3Igc3RhdHVzIHZhbGlkYXRpb25cblx0XHRcdGNvbnN0IHsgZGF0YTogam9iV2l0aENvbnRleHQgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRcdGBcblx0XHRcdFx0XHRpZCxcblx0XHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdFx0c2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRcdHNjaGVkdWxlZF9lbmQsXG5cdFx0XHRcdFx0YXNzaWduZWRfdG8sXG5cdFx0XHRcdFx0Y3VzdG9tZXJfaWQsXG5cdFx0XHRcdFx0cHJvcGVydHlfaWQsXG5cdFx0XHRcdFx0dG90YWxfYW1vdW50LFxuXHRcdFx0XHRcdGludm9pY2VzOmludm9pY2VzKHN0YXR1cywgdG90YWxfYW1vdW50KSxcblx0XHRcdFx0XHRlc3RpbWF0ZXM6ZXN0aW1hdGVzKHN0YXR1cyksXG5cdFx0XHRcdFx0dGVhbV9hc3NpZ25tZW50czpqb2JfdGVhbV9hc3NpZ25tZW50cyh0ZWFtX21lbWJlcl9pZClcblx0XHRcdFx0YCxcblx0XHRcdFx0KVxuXHRcdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRpZiAoam9iV2l0aENvbnRleHQpIHtcblx0XHRcdFx0Y29uc3QgdHJhbnNpdGlvbkNvbnRleHQ6IEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0ID0ge1xuXHRcdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGpvYldpdGhDb250ZXh0LnN0YXR1cyBhcyBKb2JTdGF0dXMsXG5cdFx0XHRcdFx0bmV3U3RhdHVzOiBkYXRhLnN0YXR1cyBhcyBKb2JTdGF0dXMsXG5cdFx0XHRcdFx0am9iOiB7XG5cdFx0XHRcdFx0XHRpZDogam9iV2l0aENvbnRleHQuaWQsXG5cdFx0XHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6XG5cdFx0XHRcdFx0XHRcdGRhdGEuc2NoZWR1bGVkU3RhcnQgfHwgam9iV2l0aENvbnRleHQuc2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRcdFx0c2NoZWR1bGVkX2VuZDogZGF0YS5zY2hlZHVsZWRFbmQgfHwgam9iV2l0aENvbnRleHQuc2NoZWR1bGVkX2VuZCxcblx0XHRcdFx0XHRcdGFzc2lnbmVkX3RvOlxuXHRcdFx0XHRcdFx0XHRkYXRhLmFzc2lnbmVkVG8gIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5hc3NpZ25lZFRvXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5hc3NpZ25lZF90byxcblx0XHRcdFx0XHRcdGN1c3RvbWVyX2lkOlxuXHRcdFx0XHRcdFx0XHRkYXRhLmN1c3RvbWVySWQgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5jdXN0b21lcklkXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5jdXN0b21lcl9pZCxcblx0XHRcdFx0XHRcdHByb3BlcnR5X2lkOlxuXHRcdFx0XHRcdFx0XHRkYXRhLnByb3BlcnR5SWQgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5wcm9wZXJ0eUlkXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5wcm9wZXJ0eV9pZCxcblx0XHRcdFx0XHRcdHRvdGFsX2Ftb3VudDpcblx0XHRcdFx0XHRcdFx0ZGF0YS50b3RhbEFtb3VudCAhPT0gdW5kZWZpbmVkXG5cdFx0XHRcdFx0XHRcdFx0PyBkYXRhLnRvdGFsQW1vdW50XG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC50b3RhbF9hbW91bnQsXG5cdFx0XHRcdFx0XHRpbnZvaWNlczogam9iV2l0aENvbnRleHQuaW52b2ljZXMgfHwgW10sXG5cdFx0XHRcdFx0XHRlc3RpbWF0ZXM6IGpvYldpdGhDb250ZXh0LmVzdGltYXRlcyB8fCBbXSxcblx0XHRcdFx0XHRcdHRlYW1Bc3NpZ25tZW50czogam9iV2l0aENvbnRleHQudGVhbV9hc3NpZ25tZW50cyB8fCBbXSxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSB2YWxpZGF0ZVN0YXR1c1RyYW5zaXRpb24odHJhbnNpdGlvbkNvbnRleHQpO1xuXG5cdFx0XHRcdGlmICghdmFsaWRhdGlvblJlc3VsdC5hbGxvd2VkKSB7XG5cdFx0XHRcdFx0bGV0IGVycm9yTWVzc2FnZSA9XG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlYXNvbiB8fCBcIlN0YXR1cyB0cmFuc2l0aW9uIG5vdCBhbGxvd2VkXCI7XG5cblx0XHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlcXVpcmVkRmllbGRzICYmXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlcXVpcmVkRmllbGRzLmxlbmd0aCA+IDBcblx0XHRcdFx0XHQpIHtcblx0XHRcdFx0XHRcdGVycm9yTWVzc2FnZSArPSBgLiBNaXNzaW5nOiAke3ZhbGlkYXRpb25SZXN1bHQucmVxdWlyZWRGaWVsZHMuam9pbihcIiwgXCIpfWA7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKGVycm9yTWVzc2FnZSwgRVJST1JfQ09ERVMuVkFMSURBVElPTl9GQUlMRUQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gTG9nIHdhcm5pbmdzIGlmIHByZXNlbnQgKG5vbi1ibG9ja2luZylcblx0XHRcdFx0aWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwi4pqg77iPIFN0YXR1cyB0cmFuc2l0aW9uIHdhcm5pbmdzOlwiLCB7XG5cdFx0XHRcdFx0XHRqb2JJZCxcblx0XHRcdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGpvYldpdGhDb250ZXh0LnN0YXR1cyxcblx0XHRcdFx0XHRcdG5ld1N0YXR1czogZGF0YS5zdGF0dXMsXG5cdFx0XHRcdFx0XHR3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIEJ1aWxkIGNvcmUgam9iIHVwZGF0ZSBvYmplY3Qgd2l0aCBvbmx5IGRlZmluZWQgdmFsdWVzXG5cdFx0Y29uc3QgY29yZVVwZGF0ZURhdGE6IGFueSA9IHt9O1xuXHRcdGlmIChkYXRhLnRpdGxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnRpdGxlID0gZGF0YS50aXRsZTtcblx0XHR9XG5cdFx0aWYgKGRhdGEuZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuZGVzY3JpcHRpb24gPSBkYXRhLmRlc2NyaXB0aW9uO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zdGF0dXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuc3RhdHVzID0gZGF0YS5zdGF0dXM7XG5cdFx0fVxuXHRcdGlmIChkYXRhLnByaW9yaXR5ICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnByaW9yaXR5ID0gZGF0YS5wcmlvcml0eTtcblx0XHR9XG5cdFx0aWYgKGRhdGEuam9iVHlwZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb3JlVXBkYXRlRGF0YS5qb2JfdHlwZSA9IGRhdGEuam9iVHlwZTtcblx0XHR9XG5cdFx0aWYgKGRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEubm90ZXMgPSBkYXRhLm5vdGVzO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zY2hlZHVsZWRTdGFydCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb3JlVXBkYXRlRGF0YS5zY2hlZHVsZWRfc3RhcnQgPSBkYXRhLnNjaGVkdWxlZFN0YXJ0O1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zY2hlZHVsZWRFbmQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuc2NoZWR1bGVkX2VuZCA9IGRhdGEuc2NoZWR1bGVkRW5kO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5hc3NpZ25lZFRvICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLmFzc2lnbmVkX3RvID0gZGF0YS5hc3NpZ25lZFRvO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLmN1c3RvbWVyX2lkID0gZGF0YS5jdXN0b21lcklkO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5wcm9wZXJ0eUlkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnByb3BlcnR5X2lkID0gZGF0YS5wcm9wZXJ0eUlkO1xuXHRcdFx0Ly8gSWYgcHJvcGVydHkgaXMgYmVpbmcgc2V0IChub3QgbnVsbCksIHZlcmlmeSBpdCBiZWxvbmdzIHRvIHRoZSBjdXN0b21lciAoaWYgY3VzdG9tZXIgaXMgc2V0KVxuXHRcdFx0aWYgKFxuXHRcdFx0XHRkYXRhLnByb3BlcnR5SWQgIT09IG51bGwgJiZcblx0XHRcdFx0ZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQgJiZcblx0XHRcdFx0ZGF0YS5jdXN0b21lcklkICE9PSBudWxsXG5cdFx0XHQpIHtcblx0XHRcdFx0Y29uc3QgeyBkYXRhOiBwcm9wZXJ0eSB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdFx0XHQuZnJvbShcInByb3BlcnRpZXNcIilcblx0XHRcdFx0XHQuc2VsZWN0KFwiY3VzdG9tZXJfaWRcIilcblx0XHRcdFx0XHQuZXEoXCJpZFwiLCBkYXRhLnByb3BlcnR5SWQpXG5cdFx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRcdGlmIChwcm9wZXJ0eSAmJiBwcm9wZXJ0eS5jdXN0b21lcl9pZCAhPT0gZGF0YS5jdXN0b21lcklkKSB7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcdFx0XCJQcm9wZXJ0eSBkb2VzIG5vdCBiZWxvbmcgdG8gdGhlIHNlbGVjdGVkIGN1c3RvbWVyXCIsXG5cdFx0XHRcdFx0XHRFUlJPUl9DT0RFUy5WQUxJREFUSU9OX0ZBSUxFRCxcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gQnVpbGQgZmluYW5jaWFsIGRvbWFpbiB1cGRhdGUgb2JqZWN0IChpZiBhbnkgZmluYW5jaWFsIGZpZWxkcyBwcm92aWRlZClcblx0XHRjb25zdCBmaW5hbmNpYWxVcGRhdGVEYXRhOiBhbnkgPSB7fTtcblx0XHRpZiAoZGF0YS50b3RhbEFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmaW5hbmNpYWxVcGRhdGVEYXRhLnRvdGFsX2Ftb3VudCA9IGRhdGEudG90YWxBbW91bnQ7XG5cdFx0fVxuXHRcdGlmIChkYXRhLnBhaWRBbW91bnQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0ZmluYW5jaWFsVXBkYXRlRGF0YS5wYWlkX2Ftb3VudCA9IGRhdGEucGFpZEFtb3VudDtcblx0XHR9XG5cdFx0aWYgKGRhdGEuZGVwb3NpdEFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmaW5hbmNpYWxVcGRhdGVEYXRhLmRlcG9zaXRfYW1vdW50ID0gZGF0YS5kZXBvc2l0QW1vdW50O1xuXHRcdH1cblxuXHRcdC8vIEV4ZWN1dGUgdXBkYXRlcyBpbiBwYXJhbGxlbCBmb3IgcGVyZm9ybWFuY2Vcblx0XHRjb25zdCB1cGRhdGVzOiBQcm9taXNlPGFueT5bXSA9IFtdO1xuXG5cdFx0Ly8gVXBkYXRlIGNvcmUgam9iIHRhYmxlIGlmIHRoZXJlIGFyZSBjaGFuZ2VzXG5cdFx0aWYgKE9iamVjdC5rZXlzKGNvcmVVcGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG5cdFx0XHR1cGRhdGVzLnB1c2goXG5cdFx0XHRcdChhc3luYyAoKSA9PiBhd2FpdCBzdXBhYmFzZS5mcm9tKFwiam9ic1wiKS51cGRhdGUoY29yZVVwZGF0ZURhdGEpLmVxKFwiaWRcIiwgam9iSWQpKSgpLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBVcGRhdGUgZmluYW5jaWFsIGRvbWFpbiB0YWJsZSBpZiB0aGVyZSBhcmUgY2hhbmdlc1xuXHRcdGlmIChPYmplY3Qua2V5cyhmaW5hbmNpYWxVcGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG5cdFx0XHR1cGRhdGVzLnB1c2goXG5cdFx0XHRcdChhc3luYyAoKSA9PlxuXHRcdFx0XHRcdGF3YWl0IHN1cGFiYXNlXG5cdFx0XHRcdFx0XHQuZnJvbShcImpvYl9maW5hbmNpYWxcIilcblx0XHRcdFx0XHRcdC51cGRhdGUoZmluYW5jaWFsVXBkYXRlRGF0YSlcblx0XHRcdFx0XHRcdC5lcShcImpvYl9pZFwiLCBqb2JJZCkpKCksXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEV4ZWN1dGUgYWxsIHVwZGF0ZXMgaW4gcGFyYWxsZWxcblx0XHRpZiAodXBkYXRlcy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwodXBkYXRlcyk7XG5cblx0XHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gYW55IHVwZGF0ZVxuXHRcdFx0Y29uc3QgZXJyb3JzID0gcmVzdWx0cy5maWx0ZXIoKHJlc3VsdCkgPT4gcmVzdWx0LmVycm9yKTtcblx0XHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRjb25zdCBlcnJvck1lc3NhZ2VzID0gZXJyb3JzLm1hcCgoZSkgPT4gZS5lcnJvci5tZXNzYWdlKS5qb2luKFwiLCBcIik7XG5cdFx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XHRgJHtFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJ1cGRhdGUgam9iXCIpfTogJHtlcnJvck1lc3NhZ2VzfWAsXG5cdFx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBVcGRhdGUgam9iIHdpdGggZGF0YSBvYmplY3QgKGVhc2llciBmb3IgcHJvZ3JhbW1hdGljIHVzZSlcbiAqIFVzZWQgYnkgam9iIGVkaXRvciBmb3IgaW4tcGxhY2UgdXBkYXRlc1xuICovXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVKb2JEYXRhKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRkYXRhOiBQYXJ0aWFsPFVwZGF0ZUpvYkRhdGE+LFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHQvLyBDb252ZXJ0IGRhdGEgb2JqZWN0IHRvIEZvcm1EYXRhIGZvciBjb21wYXRpYmlsaXR5IHdpdGggZXhpc3RpbmcgdXBkYXRlSm9iXG5cdFx0Y29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcblxuXHRcdC8vIEFkZCBhbGwgZGVmaW5lZCBmaWVsZHMgdG8gRm9ybURhdGFcblx0XHRpZiAoZGF0YS50aXRsZSAhPT0gdW5kZWZpbmVkKSBmb3JtRGF0YS5hcHBlbmQoXCJ0aXRsZVwiLCBkYXRhLnRpdGxlKTtcblx0XHRpZiAoZGF0YS5kZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwiZGVzY3JpcHRpb25cIiwgZGF0YS5kZXNjcmlwdGlvbik7XG5cdFx0aWYgKGRhdGEuc3RhdHVzICE9PSB1bmRlZmluZWQpIGZvcm1EYXRhLmFwcGVuZChcInN0YXR1c1wiLCBkYXRhLnN0YXR1cyk7XG5cdFx0aWYgKGRhdGEucHJpb3JpdHkgIT09IHVuZGVmaW5lZCkgZm9ybURhdGEuYXBwZW5kKFwicHJpb3JpdHlcIiwgZGF0YS5wcmlvcml0eSk7XG5cdFx0aWYgKGRhdGEuam9iVHlwZSAhPT0gdW5kZWZpbmVkKSBmb3JtRGF0YS5hcHBlbmQoXCJqb2JUeXBlXCIsIGRhdGEuam9iVHlwZSk7XG5cdFx0aWYgKGRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkgZm9ybURhdGEuYXBwZW5kKFwibm90ZXNcIiwgZGF0YS5ub3Rlcyk7XG5cdFx0aWYgKGRhdGEudG90YWxBbW91bnQgIT09IHVuZGVmaW5lZClcblx0XHRcdGZvcm1EYXRhLmFwcGVuZChcInRvdGFsQW1vdW50XCIsIGRhdGEudG90YWxBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEucGFpZEFtb3VudCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwicGFpZEFtb3VudFwiLCBkYXRhLnBhaWRBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEuZGVwb3NpdEFtb3VudCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwiZGVwb3NpdEFtb3VudFwiLCBkYXRhLmRlcG9zaXRBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEuc2NoZWR1bGVkU3RhcnQgIT09IHVuZGVmaW5lZClcblx0XHRcdGZvcm1EYXRhLmFwcGVuZChcInNjaGVkdWxlZFN0YXJ0XCIsIGRhdGEuc2NoZWR1bGVkU3RhcnQpO1xuXHRcdGlmIChkYXRhLnNjaGVkdWxlZEVuZCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwic2NoZWR1bGVkRW5kXCIsIGRhdGEuc2NoZWR1bGVkRW5kKTtcblx0XHRpZiAoZGF0YS5hc3NpZ25lZFRvICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJhc3NpZ25lZFRvXCIsIGRhdGEuYXNzaWduZWRUbyB8fCBcIlwiKTtcblx0XHRpZiAoZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJjdXN0b21lcklkXCIsIGRhdGEuY3VzdG9tZXJJZCB8fCBcIlwiKTtcblx0XHRpZiAoZGF0YS5wcm9wZXJ0eUlkICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJwcm9wZXJ0eUlkXCIsIGRhdGEucHJvcGVydHlJZCB8fCBcIlwiKTtcblxuXHRcdC8vIFJldXNlIGV4aXN0aW5nIHVwZGF0ZUpvYiBsb2dpY1xuXHRcdHJldHVybiBhd2FpdCB1cGRhdGVKb2Ioam9iSWQsIGZvcm1EYXRhKTtcblx0fSk7XG59XG5cbi8qKlxuICogVXBkYXRlIGpvYiBzdGF0dXMgd2l0aCB2YWxpZGF0aW9uXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5zdGF0dXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYlN0YXR1cyhcblx0am9iSWQ6IHN0cmluZyxcblx0bmV3U3RhdHVzOiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBjdXJyZW50IHVzZXJcblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmFsaWRhdGUgc3RhdHVzIHZhbHVlXG5cdFx0Y29uc3QgdmFsaWRTdGF0dXNlczogSm9iU3RhdHVzW10gPSBbXG5cdFx0XHRcInF1b3RlZFwiLFxuXHRcdFx0XCJzY2hlZHVsZWRcIixcblx0XHRcdFwiaW5fcHJvZ3Jlc3NcIixcblx0XHRcdFwib25faG9sZFwiLFxuXHRcdFx0XCJjb21wbGV0ZWRcIixcblx0XHRcdFwiY2FuY2VsbGVkXCIsXG5cdFx0XHRcImludm9pY2VkXCIsXG5cdFx0XHRcInBhaWRcIixcblx0XHRdO1xuXHRcdGlmICghdmFsaWRTdGF0dXNlcy5pbmNsdWRlcyhuZXdTdGF0dXMgYXMgSm9iU3RhdHVzKSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkludmFsaWQgam9iIHN0YXR1c1wiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5WQUxJREFUSU9OX0ZBSUxFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gRmV0Y2ggam9iIHdpdGggYWxsIGNvbnRleHQgbmVlZGVkIGZvciB0cmFuc2l0aW9uIHZhbGlkYXRpb25cblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRgXG5cdFx0XHRcdGlkLFxuXHRcdFx0XHRjb21wYW55X2lkLFxuXHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdHNjaGVkdWxlZF9zdGFydCxcblx0XHRcdFx0c2NoZWR1bGVkX2VuZCxcblx0XHRcdFx0YXNzaWduZWRfdG8sXG5cdFx0XHRcdGN1c3RvbWVyX2lkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZCxcblx0XHRcdFx0dG90YWxfYW1vdW50LFxuXHRcdFx0XHRpbnZvaWNlczppbnZvaWNlcyhzdGF0dXMsIHRvdGFsX2Ftb3VudCksXG5cdFx0XHRcdGVzdGltYXRlczplc3RpbWF0ZXMoc3RhdHVzKSxcblx0XHRcdFx0dGVhbV9hc3NpZ25tZW50czpqb2JfdGVhbV9hc3NpZ25tZW50cyh0ZWFtX21lbWJlcl9pZClcblx0XHRcdGAsXG5cdFx0XHQpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhleGlzdGluZ0pvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoZXhpc3RpbmdKb2IuY29tcGFueV9pZCAhPT0gY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQnVpbGQgY29udGV4dCBmb3IgdHJhbnNpdGlvbiB2YWxpZGF0aW9uXG5cdFx0Y29uc3QgdHJhbnNpdGlvbkNvbnRleHQ6IEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0ID0ge1xuXHRcdFx0Y3VycmVudFN0YXR1czogZXhpc3RpbmdKb2Iuc3RhdHVzIGFzIEpvYlN0YXR1cyxcblx0XHRcdG5ld1N0YXR1czogbmV3U3RhdHVzIGFzIEpvYlN0YXR1cyxcblx0XHRcdGpvYjoge1xuXHRcdFx0XHRpZDogZXhpc3RpbmdKb2IuaWQsXG5cdFx0XHRcdHNjaGVkdWxlZF9zdGFydDogZXhpc3RpbmdKb2Iuc2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRzY2hlZHVsZWRfZW5kOiBleGlzdGluZ0pvYi5zY2hlZHVsZWRfZW5kLFxuXHRcdFx0XHRhc3NpZ25lZF90bzogZXhpc3RpbmdKb2IuYXNzaWduZWRfdG8sXG5cdFx0XHRcdGN1c3RvbWVyX2lkOiBleGlzdGluZ0pvYi5jdXN0b21lcl9pZCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IGV4aXN0aW5nSm9iLnByb3BlcnR5X2lkLFxuXHRcdFx0XHR0b3RhbF9hbW91bnQ6IGV4aXN0aW5nSm9iLnRvdGFsX2Ftb3VudCxcblx0XHRcdFx0aW52b2ljZXM6IGV4aXN0aW5nSm9iLmludm9pY2VzIHx8IFtdLFxuXHRcdFx0XHRlc3RpbWF0ZXM6IGV4aXN0aW5nSm9iLmVzdGltYXRlcyB8fCBbXSxcblx0XHRcdFx0dGVhbUFzc2lnbm1lbnRzOiBleGlzdGluZ0pvYi50ZWFtX2Fzc2lnbm1lbnRzIHx8IFtdLFxuXHRcdFx0fSxcblx0XHR9O1xuXG5cdFx0Ly8gVmFsaWRhdGUgdHJhbnNpdGlvbiB3aXRoIGNvbXByZWhlbnNpdmUgYnVzaW5lc3MgcnVsZXNcblx0XHRjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gdmFsaWRhdGVTdGF0dXNUcmFuc2l0aW9uKHRyYW5zaXRpb25Db250ZXh0KTtcblxuXHRcdGlmICghdmFsaWRhdGlvblJlc3VsdC5hbGxvd2VkKSB7XG5cdFx0XHRsZXQgZXJyb3JNZXNzYWdlID1cblx0XHRcdFx0dmFsaWRhdGlvblJlc3VsdC5yZWFzb24gfHwgXCJTdGF0dXMgdHJhbnNpdGlvbiBub3QgYWxsb3dlZFwiO1xuXG5cdFx0XHRpZiAoXG5cdFx0XHRcdHZhbGlkYXRpb25SZXN1bHQucmVxdWlyZWRGaWVsZHMgJiZcblx0XHRcdFx0dmFsaWRhdGlvblJlc3VsdC5yZXF1aXJlZEZpZWxkcy5sZW5ndGggPiAwXG5cdFx0XHQpIHtcblx0XHRcdFx0ZXJyb3JNZXNzYWdlICs9IGAuIE1pc3Npbmc6ICR7dmFsaWRhdGlvblJlc3VsdC5yZXF1aXJlZEZpZWxkcy5qb2luKFwiLCBcIil9YDtcblx0XHRcdH1cblxuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKGVycm9yTWVzc2FnZSwgRVJST1JfQ09ERVMuVkFMSURBVElPTl9GQUlMRUQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyB3YXJuaW5ncyBpZiBwcmVzZW50IChub24tYmxvY2tpbmcpXG5cdFx0aWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCLimqDvuI8gU3RhdHVzIHRyYW5zaXRpb24gd2FybmluZ3M6XCIsIHtcblx0XHRcdFx0am9iSWQsXG5cdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGV4aXN0aW5nSm9iLnN0YXR1cyxcblx0XHRcdFx0bmV3U3RhdHVzLFxuXHRcdFx0XHR3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBzdGF0dXNcblx0XHRjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnVwZGF0ZSh7IHN0YXR1czogbmV3U3RhdHVzIH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwidXBkYXRlIGpvYiBzdGF0dXNcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1FVRVJZX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zb2xlLmxvZyhcIuKchSBKb2Igc3RhdHVzIHVwZGF0ZWQ6XCIsIHtcblx0XHRcdGpvYklkLFxuXHRcdFx0b2xkU3RhdHVzOiBleGlzdGluZ0pvYi5zdGF0dXMsXG5cdFx0XHRuZXdTdGF0dXMsXG5cdFx0fSk7XG5cblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZC93b3JrLyR7am9iSWR9YCk7XG5cdH0pO1xufVxuXG4vKipcbiAqIEFzc2lnbiBqb2IgdG8gYSB0ZWNobmljaWFuXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5hc3NpZ25lZF90b1xuICovXG5hc3luYyBmdW5jdGlvbiBhc3NpZ25Kb2IoXG5cdGpvYklkOiBzdHJpbmcsXG5cdHRlY2huaWNpYW5JZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWRcIilcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0YXNzZXJ0RXhpc3RzKGV4aXN0aW5nSm9iLCBcIkpvYlwiKTtcblxuXHRcdGlmIChleGlzdGluZ0pvYi5jb21wYW55X2lkICE9PSBjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwiam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgdGVjaG5pY2lhbiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IHRlY2huaWNpYW4gfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImNvbXBhbnlfbWVtYmVyc2hpcHNcIilcblx0XHRcdC5zZWxlY3QoXCJ1c2VyX2lkXCIpXG5cdFx0XHQuZXEoXCJ1c2VyX2lkXCIsIHRlY2huaWNpYW5JZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWNobmljaWFuKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiVGVjaG5pY2lhbiBub3QgZm91bmQgaW4geW91ciBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1JFQ09SRF9OT1RfRk9VTkQsXG5cdFx0XHRcdDQwNCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQXNzaWduIGpvYlxuXHRcdGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQudXBkYXRlKHsgYXNzaWduZWRfdG86IHRlY2huaWNpYW5JZCB9KVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpO1xuXG5cdFx0aWYgKHVwZGF0ZUVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImFzc2lnbiBqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1FVRVJZX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZC93b3JrLyR7am9iSWR9YCk7XG5cdH0pO1xufVxuXG4vKipcbiAqIFNjaGVkdWxlIGEgam9iXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icyB0YWJsZSBzY2hlZHVsaW5nIGZpZWxkc1xuICovXG5hc3luYyBmdW5jdGlvbiBzY2hlZHVsZUpvYihcblx0am9iSWQ6IHN0cmluZyxcblx0Zm9ybURhdGE6IEZvcm1EYXRhLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSBzY2hlZHVsZUpvYlNjaGVtYS5wYXJzZSh7XG5cdFx0XHRzY2hlZHVsZWRTdGFydDogZm9ybURhdGEuZ2V0KFwic2NoZWR1bGVkU3RhcnRcIiksXG5cdFx0XHRzY2hlZHVsZWRFbmQ6IGZvcm1EYXRhLmdldChcInNjaGVkdWxlZEVuZFwiKSxcblx0XHR9KTtcblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWQsIHN0YXR1c1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBzY2hlZHVsZSBhbmQgc3RhdHVzXG5cdFx0Y29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRzdGF0dXM6XG5cdFx0XHRcdFx0ZXhpc3RpbmdKb2Iuc3RhdHVzID09PSBcInF1b3RlZFwiID8gXCJzY2hlZHVsZWRcIiA6IGV4aXN0aW5nSm9iLnN0YXR1cyxcblx0XHRcdH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwic2NoZWR1bGUgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0fSk7XG59XG5cbi8qKlxuICogU3RhcnQgYSBqb2JcbiAqIPCflKcgUkVGQUNUT1JFRCAtIE5vdyB1cGRhdGVzIGpvYl90aW1lX3RyYWNraW5nLmFjdHVhbF9zdGFydCBpbnN0ZWFkIG9mIGpvYnMuYWN0dWFsX3N0YXJ0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdGFydEpvYihqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWQsIHN0YXR1c1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbiBvbmx5IHN0YXJ0IHNjaGVkdWxlZCBqb2JzXG5cdFx0aWYgKGV4aXN0aW5nSm9iLnN0YXR1cyAhPT0gXCJzY2hlZHVsZWRcIiAmJiBleGlzdGluZ0pvYi5zdGF0dXMgIT09IFwicXVvdGVkXCIpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgbXVzdCBiZSBzY2hlZHVsZWQgYmVmb3JlIHN0YXJ0aW5nXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuXG5cdFx0Ly8gVXBkYXRlIGJvdGggam9icyB0YWJsZSAoc3RhdHVzKSBhbmQgam9iX3RpbWVfdHJhY2tpbmcgdGFibGUgKGFjdHVhbF9zdGFydCkgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0c3VwYWJhc2UuZnJvbShcImpvYnNcIikudXBkYXRlKHsgc3RhdHVzOiBcImluX3Byb2dyZXNzXCIgfSkuZXEoXCJpZFwiLCBqb2JJZCksXG5cdFx0XHRzdXBhYmFzZVxuXHRcdFx0XHQuZnJvbShcImpvYl90aW1lX3RyYWNraW5nXCIpXG5cdFx0XHRcdC51cGRhdGUoeyBhY3R1YWxfc3RhcnQ6IG5vdyB9KVxuXHRcdFx0XHQuZXEoXCJqb2JfaWRcIiwgam9iSWQpLFxuXHRcdF0pO1xuXG5cdFx0Ly8gQ2hlY2sgZm9yIGVycm9ycyBpbiBlaXRoZXIgdXBkYXRlXG5cdFx0Y29uc3QgZXJyb3JzID0gdXBkYXRlcy5maWx0ZXIoKHJlc3VsdCkgPT4gcmVzdWx0LmVycm9yKTtcblx0XHRpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwic3RhcnQgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBDb21wbGV0ZSBhIGpvYlxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgam9iX3RpbWVfdHJhY2tpbmcuYWN0dWFsX2VuZCBhbmQgY2FsY3VsYXRlcyB0b3RhbF9sYWJvcl9ob3Vyc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29tcGxldGVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHZvaWQ+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IGN1cnJlbnQgdXNlclxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdC8vIEdldCB1c2VyJ3MgYWN0aXZlIGNvbXBhbnkgdXNpbmcgaGVscGVyIChoYW5kbGVzIG11bHRpLWNvbXBhbnkgdXNlcnMpXG5cdFx0Y29uc3QgeyBnZXRBY3RpdmVDb21wYW55SWQgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL2F1dGgvY29tcGFueS1jb250ZXh0XCIpO1xuXHRcdGNvbnN0IGNvbXBhbnlJZCA9IGF3YWl0IGdldEFjdGl2ZUNvbXBhbnlJZCgpO1xuXG5cdFx0aWYgKCFjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGJlbG9uZ3MgdG8gY29tcGFueSBhbmQgZ2V0IHRpbWUgdHJhY2tpbmcgZGF0YVxuXHRcdGNvbnN0IHsgZGF0YTogZXhpc3RpbmdKb2IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkLCBzdGF0dXMsIHRpbWVUcmFja2luZzpqb2JfdGltZV90cmFja2luZygqKVwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbiBvbmx5IGNvbXBsZXRlIGluLXByb2dyZXNzIGpvYnNcblx0XHRpZiAoZXhpc3RpbmdKb2Iuc3RhdHVzICE9PSBcImluX3Byb2dyZXNzXCIpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgbXVzdCBiZSBpbiBwcm9ncmVzcyB0byBjb21wbGV0ZVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcblxuXHRcdC8vIENhbGN1bGF0ZSB0b3RhbCBsYWJvciBob3VycyBpZiB3ZSBoYXZlIGFjdHVhbF9zdGFydFxuXHRcdGNvbnN0IHRpbWVUcmFja2luZyA9IEFycmF5LmlzQXJyYXkoZXhpc3RpbmdKb2IudGltZVRyYWNraW5nKVxuXHRcdFx0PyBleGlzdGluZ0pvYi50aW1lVHJhY2tpbmdbMF1cblx0XHRcdDogZXhpc3RpbmdKb2IudGltZVRyYWNraW5nO1xuXG5cdFx0Y29uc3QgdGltZVRyYWNraW5nVXBkYXRlOiBhbnkgPSB7IGFjdHVhbF9lbmQ6IG5vdyB9O1xuXG5cdFx0aWYgKHRpbWVUcmFja2luZz8uYWN0dWFsX3N0YXJ0KSB7XG5cdFx0XHRjb25zdCBzdGFydFRpbWUgPSBuZXcgRGF0ZSh0aW1lVHJhY2tpbmcuYWN0dWFsX3N0YXJ0KS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBlbmRUaW1lID0gbmV3IERhdGUobm93KS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBob3Vyc1dvcmtlZCA9IChlbmRUaW1lIC0gc3RhcnRUaW1lKSAvICgxMDAwICogNjAgKiA2MCk7IC8vIENvbnZlcnQgbXMgdG8gaG91cnNcblx0XHRcdHRpbWVUcmFja2luZ1VwZGF0ZS50b3RhbF9sYWJvcl9ob3VycyA9IGhvdXJzV29ya2VkO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBib3RoIGpvYnMgdGFibGUgKHN0YXR1cykgYW5kIGpvYl90aW1lX3RyYWNraW5nIHRhYmxlIChhY3R1YWxfZW5kLCB0b3RhbF9sYWJvcl9ob3VycykgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0c3VwYWJhc2UuZnJvbShcImpvYnNcIikudXBkYXRlKHsgc3RhdHVzOiBcImNvbXBsZXRlZFwiIH0pLmVxKFwiaWRcIiwgam9iSWQpLFxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfdGltZV90cmFja2luZ1wiKVxuXHRcdFx0XHQudXBkYXRlKHRpbWVUcmFja2luZ1VwZGF0ZSlcblx0XHRcdFx0LmVxKFwiam9iX2lkXCIsIGpvYklkKSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gZWl0aGVyIHVwZGF0ZVxuXHRcdGNvbnN0IGVycm9ycyA9IHVwZGF0ZXMuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5lcnJvcik7XG5cdFx0aWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImNvbXBsZXRlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0fSk7XG59XG5cbi8qKlxuICogQ2FuY2VsIGEgam9iXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5zdGF0dXMgYW5kIGpvYnMubm90ZXNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gY2FuY2VsSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRyZWFzb24/OiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBjdXJyZW50IHVzZXJcblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzLCBub3Rlc1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbm5vdCBjYW5jZWwgY29tcGxldGVkIGpvYnNcblx0XHRpZiAoZXhpc3RpbmdKb2Iuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiQ2Fubm90IGNhbmNlbCBjb21wbGV0ZWQgam9ic1wiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEFkZCBjYW5jZWxsYXRpb24gcmVhc29uIHRvIG5vdGVzXG5cdFx0Y29uc3QgdXBkYXRlZE5vdGVzID0gcmVhc29uXG5cdFx0XHQ/IGAke2V4aXN0aW5nSm9iLm5vdGVzIHx8IFwiXCJ9XFxuXFxuW0NBTkNFTExFRF06ICR7cmVhc29ufWAudHJpbSgpXG5cdFx0XHQ6IGV4aXN0aW5nSm9iLm5vdGVzO1xuXG5cdFx0Ly8gQ2FuY2VsIGpvYlxuXHRcdGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0c3RhdHVzOiBcImNhbmNlbGxlZFwiLFxuXHRcdFx0XHRub3RlczogdXBkYXRlZE5vdGVzLFxuXHRcdFx0fSlcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKTtcblxuXHRcdGlmICh1cGRhdGVFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJjYW5jZWwgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBTZWFyY2ggam9icyB3aXRoIGZ1bGwtdGV4dCBzZWFyY2ggYW5kIHJhbmtpbmdcbiAqIOKchSBOTyBDSEFOR0VTIE5FRURFRCAtIE9ubHkgc2VhcmNoZXMgam9icyB0YWJsZVxuICovXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hKb2JzKFxuXHRzZWFyY2hUZXJtOiBzdHJpbmcsXG5cdG9wdGlvbnM/OiB7IGxpbWl0PzogbnVtYmVyOyBvZmZzZXQ/OiBudW1iZXIgfSxcbik6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueVtdPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiY29tcGFueV9tZW1iZXJzaGlwc1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWRcIilcblx0XHRcdC5lcShcInVzZXJfaWRcIiwgdXNlci5pZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGlmICghdGVhbU1lbWJlcj8uY29tcGFueV9pZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVzZSBmdWxsLXRleHQgc2VhcmNoIHdpdGggcmFua2luZyBmb3IgYmVzdCBtYXRjaGVzXG5cdFx0Y29uc3QgeyBzZWFyY2hKb2JzRnVsbFRleHQgfSA9IGF3YWl0IGltcG9ydChcblx0XHRcdFwiQC9saWIvc2VhcmNoL2Z1bGwtdGV4dC1zZWFyY2hcIlxuXHRcdCk7XG5cblx0XHRjb25zdCBqb2JzID0gYXdhaXQgc2VhcmNoSm9ic0Z1bGxUZXh0KHN1cGFiYXNlLCB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQsIHNlYXJjaFRlcm0sIHtcblx0XHRcdGxpbWl0OiBvcHRpb25zPy5saW1pdCB8fCA1MCxcblx0XHRcdG9mZnNldDogb3B0aW9ucz8ub2Zmc2V0IHx8IDAsXG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gam9icztcblx0fSk7XG59XG5cbi8qKlxuICogVW5pdmVyc2FsIHNlYXJjaCBhY3Jvc3MgYWxsIGVudGl0aWVzXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHNlYXJjaGVzIGpvYnMgdGFibGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2VhcmNoQWxsKFxuXHRzZWFyY2hUZXJtOiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDxhbnk+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Y29uc3QgeyBkYXRhOiB0ZWFtTWVtYmVyIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjb21wYW55X21lbWJlcnNoaXBzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWFtTWVtYmVyPy5jb21wYW55X2lkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVXNlIHVuaXZlcnNhbCBzZWFyY2ggUlBDIGZ1bmN0aW9uXG5cdFx0Y29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UucnBjKFwic2VhcmNoX2FsbF9lbnRpdGllc1wiLCB7XG5cdFx0XHRjb21wYW55X2lkX3BhcmFtOiB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQsXG5cdFx0XHRzZWFyY2hfcXVlcnk6IHNlYXJjaFRlcm0sXG5cdFx0XHRwZXJfZW50aXR5X2xpbWl0OiA1LFxuXHRcdH0pO1xuXG5cdFx0aWYgKGVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcInNlYXJjaFwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBkYXRhO1xuXHR9KTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSk9CIEFSQ0hJVkUgJiBSRVNUT1JFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogQXJjaGl2ZSBqb2IgKHNvZnQgZGVsZXRlKVxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgam9iX211bHRpX2VudGl0eS5kZWxldGVkX2J5IGFuZCBwZXJtYW5lbnRfZGVsZXRlX3NjaGVkdWxlZF9hdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXJjaGl2ZUpvYihqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHRjb25zdCB7IGRhdGE6IHRlYW1NZW1iZXIgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImNvbXBhbnlfbWVtYmVyc2hpcHNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJ1c2VyX2lkXCIsIHVzZXIuaWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoIXRlYW1NZW1iZXI/LmNvbXBhbnlfaWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogam9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGpvYi5jb21wYW55X2lkICE9PSB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwiam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBDYW5ub3QgYXJjaGl2ZSBjb21wbGV0ZWQvcGFpZCBqb2JzIChidXNpbmVzcyBydWxlKVxuXHRcdGlmIChqb2Iuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiIHx8IGpvYi5zdGF0dXMgPT09IFwiaW52b2ljZWRcIikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkNhbm5vdCBhcmNoaXZlIGNvbXBsZXRlZCBvciBpbnZvaWNlZCBqb2JzLiBUaGVzZSBtdXN0IGJlIHJldGFpbmVkIGZvciByZWNvcmRzLlwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEFyY2hpdmUgam9iIChzb2Z0IGRlbGV0ZSlcblx0XHRjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG5cdFx0Y29uc3Qgc2NoZWR1bGVkRGVsZXRpb24gPSBuZXcgRGF0ZShcblx0XHRcdERhdGUubm93KCkgKyA5MCAqIDI0ICogNjAgKiA2MCAqIDEwMDAsXG5cdFx0KS50b0lTT1N0cmluZygpO1xuXG5cdFx0Ly8gVXBkYXRlIGJvdGggam9icyB0YWJsZSBhbmQgam9iX211bHRpX2VudGl0eSB0YWJsZSBpbiBwYXJhbGxlbFxuXHRcdGNvbnN0IHVwZGF0ZXMgPSBhd2FpdCBQcm9taXNlLmFsbChbXG5cdFx0XHQvLyBVcGRhdGUgY29yZSBqb2JzIHRhYmxlIHdpdGggYXJjaGl2ZSBtZXRhZGF0YVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRcdGRlbGV0ZWRfYXQ6IG5vdyxcblx0XHRcdFx0XHRhcmNoaXZlZF9hdDogbm93LFxuXHRcdFx0XHRcdHN0YXR1czogXCJhcmNoaXZlZFwiLFxuXHRcdFx0XHR9KVxuXHRcdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCksXG5cblx0XHRcdC8vIFVwZGF0ZSBqb2JfbXVsdGlfZW50aXR5IHRhYmxlIHdpdGggZGVsZXRpb24gdHJhY2tpbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX211bHRpX2VudGl0eVwiKVxuXHRcdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0XHRkZWxldGVkX2J5OiB1c2VyLmlkLFxuXHRcdFx0XHRcdHBlcm1hbmVudF9kZWxldGVfc2NoZWR1bGVkX2F0OiBzY2hlZHVsZWREZWxldGlvbixcblx0XHRcdFx0fSlcblx0XHRcdFx0LmVxKFwiam9iX2lkXCIsIGpvYklkKSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gZWl0aGVyIHVwZGF0ZVxuXHRcdGNvbnN0IGVycm9ycyA9IHVwZGF0ZXMuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5lcnJvcik7XG5cdFx0aWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImFyY2hpdmUgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9zZXR0aW5ncy9hcmNoaXZlXCIpO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBSZXN0b3JlIGFyY2hpdmVkIGpvYlxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IGNsZWFycyBqb2JfbXVsdGlfZW50aXR5LmRlbGV0ZWRfYnkgYW5kIHBlcm1hbmVudF9kZWxldGVfc2NoZWR1bGVkX2F0XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlc3RvcmVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHZvaWQ+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Y29uc3QgeyBkYXRhOiB0ZWFtTWVtYmVyIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjb21wYW55X21lbWJlcnNoaXBzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWFtTWVtYmVyPy5jb21wYW55X2lkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnkgYW5kIGlzIGFyY2hpdmVkXG5cdFx0Y29uc3QgeyBkYXRhOiBqb2IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkLCBkZWxldGVkX2F0LCBzdGF0dXNcIilcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0YXNzZXJ0RXhpc3RzKGpvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoam9iLmNvbXBhbnlfaWQgIT09IHRlYW1NZW1iZXIuY29tcGFueV9pZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmICgham9iLmRlbGV0ZWRfYXQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgaXMgbm90IGFyY2hpdmVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmVzdG9yZSBqb2IgLSB1cGRhdGUgYm90aCB0YWJsZXMgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0Ly8gQ2xlYXIgY29yZSBqb2JzIHRhYmxlIGFyY2hpdmUgbWV0YWRhdGFcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0XHRkZWxldGVkX2F0OiBudWxsLFxuXHRcdFx0XHRcdGFyY2hpdmVkX2F0OiBudWxsLFxuXHRcdFx0XHRcdHN0YXR1czogam9iLnN0YXR1cyA9PT0gXCJhcmNoaXZlZFwiID8gXCJzY2hlZHVsZWRcIiA6IGpvYi5zdGF0dXMsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5lcShcImlkXCIsIGpvYklkKSxcblxuXHRcdFx0Ly8gQ2xlYXIgam9iX211bHRpX2VudGl0eSB0YWJsZSBkZWxldGlvbiB0cmFja2luZ1xuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfbXVsdGlfZW50aXR5XCIpXG5cdFx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRcdGRlbGV0ZWRfYnk6IG51bGwsXG5cdFx0XHRcdFx0cGVybWFuZW50X2RlbGV0ZV9zY2hlZHVsZWRfYXQ6IG51bGwsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5lcShcImpvYl9pZFwiLCBqb2JJZCksXG5cdFx0XSk7XG5cblx0XHQvLyBDaGVjayBmb3IgZXJyb3JzIGluIGVpdGhlciB1cGRhdGVcblx0XHRjb25zdCBlcnJvcnMgPSB1cGRhdGVzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuZXJyb3IpO1xuXHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJyZXN0b3JlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9zY2hlZHVsZVwiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvc2V0dGluZ3MvYXJjaGl2ZVwiKTtcblx0fSk7XG59XG5cbi8qKlxuICogUmVtb3ZlIHRlYW0gYXNzaWdubWVudCBmcm9tIGpvYlxuICog4pyFIE5PIENIQU5HRVMgTkVFREVEIC0gT25seSBkZWxldGVzIGZyb20gam9iX3RlYW1fYXNzaWdubWVudHMganVuY3Rpb24gdGFibGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVtb3ZlVGVhbUFzc2lnbm1lbnQoXG5cdGFzc2lnbm1lbnRJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IHRoZSBqdW5jdGlvbiByZWNvcmQgdG8gZmluZCBqb2JfaWQgZm9yIHJldmFsaWRhdGlvblxuXHRcdGNvbnN0IHsgZGF0YTogcmVjb3JkLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9iX3RlYW1fYXNzaWdubWVudHNcIilcblx0XHRcdC5zZWxlY3QoXCJpZCwgam9iX2lkLCBjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBhc3NpZ25tZW50SWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoZmV0Y2hFcnJvciB8fCAhcmVjb3JkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiVGVhbSBhc3NpZ25tZW50IG5vdCBmb3VuZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9SRUNPUkRfTk9UX0ZPVU5ELFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAocmVjb3JkLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJ0ZWFtIGFzc2lnbm1lbnRcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGpvYklkID0gcmVjb3JkLmpvYl9pZDtcblxuXHRcdC8vIERlbGV0ZSBqdW5jdGlvbiB0YWJsZSByb3dcblx0XHRjb25zdCB7IGVycm9yOiBkZWxldGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9iX3RlYW1fYXNzaWdubWVudHNcIilcblx0XHRcdC5kZWxldGUoKVxuXHRcdFx0LmVxKFwiaWRcIiwgYXNzaWdubWVudElkKTtcblxuXHRcdGlmIChkZWxldGVFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJyZW1vdmUgdGVhbSBhc3NpZ25tZW50IGZyb20gam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmV2YWxpZGF0ZSBqb2IgcGFnZSBhbmQgc2NoZWR1bGVcblx0XHRpZiAoam9iSWQpIHtcblx0XHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0XHR9XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBBc3NpZ24gQ3VzdG9tZXIgYW5kIFByb3BlcnR5IHRvIEpvYlxuICpcbiAqIFVwZGF0ZXMgdGhlIGpvYidzIGN1c3RvbWVyX2lkIGFuZCBwcm9wZXJ0eV9pZC5cbiAqIE9ubHkgb25lIGN1c3RvbWVyIGFuZCBwcm9wZXJ0eSBjYW4gYmUgYXNzaWduZWQgcGVyIGpvYi5cbiAqXG4gKiBAcGFyYW0gam9iSWQgLSBKb2IgSURcbiAqIEBwYXJhbSBjdXN0b21lcklkIC0gQ3VzdG9tZXIgSUQgdG8gYXNzaWduXG4gKiBAcGFyYW0gcHJvcGVydHlJZCAtIFByb3BlcnR5IElEIHRvIGFzc2lnbiAob3B0aW9uYWwpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhc3NpZ25DdXN0b21lclRvSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRjdXN0b21lcklkOiBzdHJpbmcsXG5cdHByb3BlcnR5SWQ6IHN0cmluZyB8IG51bGwsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdGNvbnN0IGNvbXBhbnlJZCA9IGF3YWl0IGdldEFjdGl2ZUNvbXBhbnlJZCgpO1xuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImNvbXBhbnkgYWNjZXNzXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGV4aXN0cyBhbmQgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBqb2IsIGVycm9yOiBqb2JFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImlkLCBjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LmlzKFwiZGVsZXRlZF9hdFwiLCBudWxsKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGpvYkVycm9yKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKFwiSm9iIHF1ZXJ5IGVycm9yOlwiLCBqb2JFcnJvcik7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmluZCBqb2I6ICR7am9iRXJyb3IubWVzc2FnZX1gLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdFx0NTAwLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRhc3NlcnRFeGlzdHMoam9iLCBcIkpvYlwiKTtcblxuXHRcdC8vIFZlcmlmeSBjdXN0b21lciBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogY3VzdG9tZXIsIGVycm9yOiBjdXN0b21lckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjdXN0b21lcnNcIilcblx0XHRcdC5zZWxlY3QoXCJpZCwgY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgY3VzdG9tZXJJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LmlzKFwiZGVsZXRlZF9hdFwiLCBudWxsKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGN1c3RvbWVyRXJyb3IpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJDdXN0b21lciBxdWVyeSBlcnJvcjpcIiwgY3VzdG9tZXJFcnJvcik7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmluZCBjdXN0b21lcjogJHtjdXN0b21lckVycm9yLm1lc3NhZ2V9YCxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHRcdDUwMCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0YXNzZXJ0RXhpc3RzKGN1c3RvbWVyLCBcIkN1c3RvbWVyXCIpO1xuXG5cdFx0Ly8gSWYgcHJvcGVydHkgaXMgcHJvdmlkZWQsIHZlcmlmeSBpdCBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY3VzdG9tZXJcblx0XHRpZiAocHJvcGVydHlJZCkge1xuXHRcdFx0Y29uc3QgeyBkYXRhOiBwcm9wZXJ0eSB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJwcm9wZXJ0aWVzXCIpXG5cdFx0XHRcdC5zZWxlY3QoXCJpZCwgY3VzdG9tZXJfaWRcIilcblx0XHRcdFx0LmVxKFwiaWRcIiwgcHJvcGVydHlJZClcblx0XHRcdFx0LmVxKFwiY3VzdG9tZXJfaWRcIiwgY3VzdG9tZXJJZClcblx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRpZiAoIXByb3BlcnR5KSB7XG5cdFx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XHRcIlByb3BlcnR5IG5vdCBmb3VuZCBvciBkb2VzIG5vdCBiZWxvbmcgdG8gdGhpcyBjdXN0b21lclwiLFxuXHRcdFx0XHRcdEVSUk9SX0NPREVTLkRCX1JFQ09SRF9OT1RfRk9VTkQsXG5cdFx0XHRcdFx0NDA0LFxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBqb2Igd2l0aCBjdXN0b21lciBhbmQgcHJvcGVydHlcblx0XHRjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnVwZGF0ZSh7XG5cdFx0XHRcdGN1c3RvbWVyX2lkOiBjdXN0b21lcklkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogcHJvcGVydHlJZCxcblx0XHRcdH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiYXNzaWduIGN1c3RvbWVyIHRvIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyBhY3Rpdml0eVxuXHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JfYWN0aXZpdHlfbG9nXCIpLmluc2VydCh7XG5cdFx0XHRqb2JfaWQ6IGpvYklkLFxuXHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0dXNlcl9pZDogdXNlci5pZCxcblx0XHRcdGFjdGl2aXR5X3R5cGU6IFwiYXNzaWduZWRcIixcblx0XHRcdGVudGl0eV90eXBlOiBcImN1c3RvbWVyXCIsXG5cdFx0XHRkZXNjcmlwdGlvbjogYEFzc2lnbmVkIGN1c3RvbWVyJHtwcm9wZXJ0eUlkID8gXCIgYW5kIHByb3BlcnR5XCIgOiBcIlwifWAsXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IHByb3BlcnR5SWQsXG5cdFx0XHR9LFxuXHRcdH0pO1xuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL3dlbGNvbWVcIik7XG5cdH0pO1xufVxuXG4vKipcbiAqIFJlbW92ZSBDdXN0b21lciBhbmQgUHJvcGVydHkgZnJvbSBKb2JcbiAqXG4gKiBSZW1vdmVzIHRoZSBjdXN0b21lcl9pZCBhbmQgcHJvcGVydHlfaWQgZnJvbSB0aGUgam9iLlxuICogUmVsYXRlZCBkYXRhIChhcHBvaW50bWVudHMsIGludm9pY2VzLCBldGMuKSByZW1haW4gYnV0IGFyZSBubyBsb25nZXIgbGlua2VkLlxuICpcbiAqIEBwYXJhbSBqb2JJZCAtIEpvYiBJRFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVtb3ZlQ3VzdG9tZXJGcm9tSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJjb21wYW55IGFjY2Vzc1wiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogam9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiaWQsIGNvbXBhbnlfaWQsIGN1c3RvbWVyX2lkLCBwcm9wZXJ0eV9pZFwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuZXEoXCJjb21wYW55X2lkXCIsIGNvbXBhbnlJZClcblx0XHRcdC5pcyhcImRlbGV0ZWRfYXRcIiwgbnVsbClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0Ly8gVXBkYXRlIGpvYiB0byByZW1vdmUgY3VzdG9tZXIgYW5kIHByb3BlcnR5XG5cdFx0Y29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRjdXN0b21lcl9pZDogbnVsbCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IG51bGwsXG5cdFx0XHR9KVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpO1xuXG5cdFx0aWYgKHVwZGF0ZUVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcInJlbW92ZSBjdXN0b21lciBmcm9tIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyBhY3Rpdml0eVxuXHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JfYWN0aXZpdHlfbG9nXCIpLmluc2VydCh7XG5cdFx0XHRqb2JfaWQ6IGpvYklkLFxuXHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0dXNlcl9pZDogdXNlci5pZCxcblx0XHRcdGFjdGl2aXR5X3R5cGU6IFwicmVtb3ZlZFwiLFxuXHRcdFx0ZW50aXR5X3R5cGU6IFwiY3VzdG9tZXJcIixcblx0XHRcdGRlc2NyaXB0aW9uOiBcIlJlbW92ZWQgY3VzdG9tZXIgYW5kIHByb3BlcnR5XCIsXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRwcmV2aW91c19jdXN0b21lcl9pZDogam9iLmN1c3RvbWVyX2lkLFxuXHRcdFx0XHRwcmV2aW91c19wcm9wZXJ0eV9pZDogam9iLnByb3BlcnR5X2lkLFxuXHRcdFx0fSxcblx0XHR9KTtcblxuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi93ZWxjb21lXCIpO1xuXHR9KTtcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiaVNBbTFDc0IifQ==
}),
"[project]/apps/web/src/actions/data:2b132c [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"40b0f396cd25016925c15b3aa85a4fb904547ec22c":"archiveJob"},"apps/web/src/actions/jobs.ts",""] */ __turbopack_context__.s([
    "archiveJob",
    ()=>archiveJob
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next@16.0.4_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
"use turbopack no side effects";
;
var archiveJob = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("40b0f396cd25016925c15b3aa85a4fb904547ec22c", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "archiveJob"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vam9icy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEpvYnMgU2VydmVyIEFjdGlvbnMgLSBSRUZBQ1RPUkVEIEZPUiBET01BSU4gVEFCTEUgU1RSVUNUVVJFXG4gKlxuICogSGFuZGxlcyBqb2Ivd29yayBvcmRlciBtYW5hZ2VtZW50IHdpdGggY29tcHJlaGVuc2l2ZSBDUlVEIG9wZXJhdGlvbnMsXG4gKiBzdGF0dXMgdHJhbnNpdGlvbnMsIHNjaGVkdWxpbmcsIGFuZCBhc3NpZ25tZW50IGxvZ2ljLlxuICpcbiAqIE1JR1JBVElPTiBOT1RFUzpcbiAqIC0gQ29yZSBqb2JzIHRhYmxlIG5vdyBoYXMgfjIwIGNvbHVtbnNcbiAqIC0gRG9tYWluLXNwZWNpZmljIGRhdGEgbW92ZWQgdG8gMTEgZG9tYWluIHRhYmxlc1xuICogLSBGaW5hbmNpYWwgZGF0YSAtPiBqb2JfZmluYW5jaWFsXG4gKiAtIFRpbWUgdHJhY2tpbmcgLT4gam9iX3RpbWVfdHJhY2tpbmdcbiAqIC0gQXJjaGl2ZS9kZWxldGlvbiAtPiBqb2JfbXVsdGlfZW50aXR5XG4gKiAtIEFsbCBkb21haW4gdGFibGVzIGhhdmUgQ0FTQ0FERSBkZWxldGUgb24gam9iX2lkXG4gKi9cblxuXCJ1c2Ugc2VydmVyXCI7XG5cbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5pbXBvcnQgeyBnZXRBY3RpdmVDb21wYW55SWQgfSBmcm9tIFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIjtcbmltcG9ydCB7XG5cdEFjdGlvbkVycm9yLFxuXHRFUlJPUl9DT0RFUyxcblx0RVJST1JfTUVTU0FHRVMsXG59IGZyb20gXCJAL2xpYi9lcnJvcnMvYWN0aW9uLWVycm9yXCI7XG5pbXBvcnQge1xuXHR0eXBlIEFjdGlvblJlc3VsdCxcblx0YXNzZXJ0QXV0aGVudGljYXRlZCxcblx0YXNzZXJ0RXhpc3RzLFxuXHR3aXRoRXJyb3JIYW5kbGluZyxcbn0gZnJvbSBcIkAvbGliL2Vycm9ycy93aXRoLWVycm9yLWhhbmRsaW5nXCI7XG5pbXBvcnQgeyBub3RpZnlKb2JDcmVhdGVkIH0gZnJvbSBcIkAvbGliL25vdGlmaWNhdGlvbnMvdHJpZ2dlcnNcIjtcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAL2xpYi9zdXBhYmFzZS9zZXJ2ZXJcIjtcbmltcG9ydCB7XG5cdHR5cGUgSm9iU3RhdHVzLFxuXHR0eXBlIEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0LFxuXHR2YWxpZGF0ZVN0YXR1c1RyYW5zaXRpb24sXG59IGZyb20gXCJAL2xpYi92YWxpZGF0aW9ucy9qb2Itc3RhdHVzLXRyYW5zaXRpb25zXCI7XG5cbi8vIFJlZ2V4IGNvbnN0YW50c1xuY29uc3QgSk9CX05VTUJFUl9SRUdFWCA9IC9KT0ItXFxkezR9LShcXGQrKS87XG5cbi8vIFZhbGlkYXRpb24gU2NoZW1hc1xuY29uc3QgY3JlYXRlSm9iU2NoZW1hID0gei5vYmplY3Qoe1xuXHRwcm9wZXJ0eUlkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIHByb3BlcnR5IElEXCIpLFxuXHRjdXN0b21lcklkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIGN1c3RvbWVyIElEXCIpLm9wdGlvbmFsKCksXG5cdHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCBcIkpvYiB0aXRsZSBpcyByZXF1aXJlZFwiKSxcblx0ZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblx0cHJpb3JpdHk6IHouZW51bShbXCJsb3dcIiwgXCJtZWRpdW1cIiwgXCJoaWdoXCIsIFwidXJnZW50XCJdKS5kZWZhdWx0KFwibWVkaXVtXCIpLFxuXHRqb2JUeXBlOiB6XG5cdFx0LmVudW0oW1xuXHRcdFx0XCJzZXJ2aWNlXCIsXG5cdFx0XHRcImluc3RhbGxhdGlvblwiLFxuXHRcdFx0XCJyZXBhaXJcIixcblx0XHRcdFwibWFpbnRlbmFuY2VcIixcblx0XHRcdFwiaW5zcGVjdGlvblwiLFxuXHRcdFx0XCJjb25zdWx0YXRpb25cIixcblx0XHRdKVxuXHRcdC5vcHRpb25hbCgpLFxuXHRzY2hlZHVsZWRTdGFydDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRzY2hlZHVsZWRFbmQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblx0YXNzaWduZWRUbzogei5zdHJpbmcoKS51dWlkKFwiSW52YWxpZCB1c2VyIElEXCIpLm9wdGlvbmFsKCksXG5cdG5vdGVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdC8vIEVuaGFuY2VkIHNjaGVkdWxpbmcgZmllbGRzXG5cdGlzUmVjdXJyaW5nOiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuXHRzY2hlZHVsaW5nTW9kZTogei5lbnVtKFtcInNwZWNpZmljXCIsIFwid2luZG93XCJdKS5vcHRpb25hbCgpLFxuXHR0aW1lV2luZG93OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VUeXBlOiB6XG5cdFx0LmVudW0oW1wiZGFpbHlcIiwgXCJ3ZWVrbHlcIiwgXCJiaXdlZWtseVwiLCBcIm1vbnRobHlcIiwgXCJxdWFydGVybHlcIiwgXCJ5ZWFybHlcIl0pXG5cdFx0Lm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VFbmREYXRlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VDb3VudDogei5udW1iZXIoKS5pbnQoKS5taW4oMSkubWF4KDM2NSkub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCB1cGRhdGVKb2JTY2hlbWEgPSB6Lm9iamVjdCh7XG5cdHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCBcIkpvYiB0aXRsZSBpcyByZXF1aXJlZFwiKS5vcHRpb25hbCgpLFxuXHRkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRzdGF0dXM6IHpcblx0XHQuZW51bShbXG5cdFx0XHRcInF1b3RlZFwiLFxuXHRcdFx0XCJzY2hlZHVsZWRcIixcblx0XHRcdFwiaW5fcHJvZ3Jlc3NcIixcblx0XHRcdFwib25faG9sZFwiLFxuXHRcdFx0XCJjb21wbGV0ZWRcIixcblx0XHRcdFwiY2FuY2VsbGVkXCIsXG5cdFx0XHRcImludm9pY2VkXCIsXG5cdFx0XHRcInBhaWRcIixcblx0XHRdKVxuXHRcdC5vcHRpb25hbCgpLFxuXHRwcmlvcml0eTogei5lbnVtKFtcImxvd1wiLCBcIm1lZGl1bVwiLCBcImhpZ2hcIiwgXCJ1cmdlbnRcIl0pLm9wdGlvbmFsKCksXG5cdGpvYlR5cGU6IHpcblx0XHQuZW51bShbXG5cdFx0XHRcInNlcnZpY2VcIixcblx0XHRcdFwiaW5zdGFsbGF0aW9uXCIsXG5cdFx0XHRcInJlcGFpclwiLFxuXHRcdFx0XCJtYWludGVuYW5jZVwiLFxuXHRcdFx0XCJpbnNwZWN0aW9uXCIsXG5cdFx0XHRcImNvbnN1bHRhdGlvblwiLFxuXHRcdF0pXG5cdFx0Lm9wdGlvbmFsKCksXG5cdG5vdGVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdC8vIEZpbmFuY2lhbCBmaWVsZHMgKG5vdyBpbiBqb2JfZmluYW5jaWFsIGRvbWFpbiB0YWJsZSlcblx0dG90YWxBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdHBhaWRBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdGRlcG9zaXRBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdHNjaGVkdWxlZFN0YXJ0OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHNjaGVkdWxlZEVuZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRhc3NpZ25lZFRvOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIHVzZXIgSURcIikub3B0aW9uYWwoKS5udWxsYWJsZSgpLFxuXHRjdXN0b21lcklkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIGN1c3RvbWVyIElEXCIpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcblx0cHJvcGVydHlJZDogei5zdHJpbmcoKS51dWlkKFwiSW52YWxpZCBwcm9wZXJ0eSBJRFwiKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG59KTtcblxuLy8gVHlwZSBmb3IgdXBkYXRlSm9iRGF0YSAtIG1ha2VzIGl0IGVhc2llciB0byB1c2UgcHJvZ3JhbW1hdGljYWxseVxuZXhwb3J0IHR5cGUgVXBkYXRlSm9iRGF0YSA9IHouaW5mZXI8dHlwZW9mIHVwZGF0ZUpvYlNjaGVtYT47XG5cbmNvbnN0IHNjaGVkdWxlSm9iU2NoZW1hID0gei5vYmplY3Qoe1xuXHRzY2hlZHVsZWRTdGFydDogei5zdHJpbmcoKSxcblx0c2NoZWR1bGVkRW5kOiB6LnN0cmluZygpLFxufSk7XG5cbi8qKlxuICogR2VuZXJhdGUgdW5pcXVlIGpvYiBudW1iZXJcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVKb2JOdW1iZXIoXG5cdHN1cGFiYXNlOiBhbnksXG5cdGNvbXBhbnlJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxzdHJpbmc+IHtcblx0Ly8gR2V0IHRoZSBsYXRlc3Qgam9iIG51bWJlciBmb3IgdGhpcyBjb21wYW55XG5cdGNvbnN0IHsgZGF0YTogbGF0ZXN0Sm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdC5zZWxlY3QoXCJqb2JfbnVtYmVyXCIpXG5cdFx0LmVxKFwiY29tcGFueV9pZFwiLCBjb21wYW55SWQpXG5cdFx0Lm9yZGVyKFwiY3JlYXRlZF9hdFwiLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcblx0XHQubGltaXQoMSlcblx0XHQuc2luZ2xlKCk7XG5cblx0aWYgKCFsYXRlc3RKb2IpIHtcblx0XHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tMDAxYDtcblx0fVxuXG5cdC8vIEV4dHJhY3QgbnVtYmVyIGZyb20gZm9ybWF0OiBKT0ItWVlZWS1OTk5cblx0Y29uc3QgbWF0Y2ggPSBsYXRlc3RKb2Iuam9iX251bWJlci5tYXRjaChKT0JfTlVNQkVSX1JFR0VYKTtcblx0aWYgKG1hdGNoKSB7XG5cdFx0Y29uc3QgbmV4dE51bWJlciA9IE51bWJlci5wYXJzZUludChtYXRjaFsxXSwgMTApICsgMTtcblx0XHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tJHtuZXh0TnVtYmVyLnRvU3RyaW5nKCkucGFkU3RhcnQoMywgXCIwXCIpfWA7XG5cdH1cblxuXHQvLyBGYWxsYmFja1xuXHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tJHtEYXRlLm5vdygpLnRvU3RyaW5nKCkuc2xpY2UoLTMpfWA7XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIG5leHQgcmVjdXJyZW5jZSBkYXRlXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZU5leHRSZWN1cnJlbmNlKFxuXHRjdXJyZW50RGF0ZTogRGF0ZSxcblx0cmVjdXJyZW5jZVR5cGU6IHN0cmluZyxcbik6IERhdGUge1xuXHRjb25zdCBuZXh0RGF0ZSA9IG5ldyBEYXRlKGN1cnJlbnREYXRlKTtcblxuXHRzd2l0Y2ggKHJlY3VycmVuY2VUeXBlKSB7XG5cdFx0Y2FzZSBcImRhaWx5XCI6XG5cdFx0XHRuZXh0RGF0ZS5zZXREYXRlKG5leHREYXRlLmdldERhdGUoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcIndlZWtseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RGF0ZShuZXh0RGF0ZS5nZXREYXRlKCkgKyA3KTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgXCJiaXdlZWtseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RGF0ZShuZXh0RGF0ZS5nZXREYXRlKCkgKyAxNCk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlIFwibW9udGhseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0TW9udGgobmV4dERhdGUuZ2V0TW9udGgoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcInF1YXJ0ZXJseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0TW9udGgobmV4dERhdGUuZ2V0TW9udGgoKSArIDMpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcInllYXJseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RnVsbFllYXIobmV4dERhdGUuZ2V0RnVsbFllYXIoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0ZGVmYXVsdDpcblx0XHRcdC8vIERlZmF1bHQgdG8gbW9udGhseSBpZiB1bmtub3duIHR5cGVcblx0XHRcdG5leHREYXRlLnNldE1vbnRoKG5leHREYXRlLmdldE1vbnRoKCkgKyAxKTtcblx0XHRcdGJyZWFrO1xuXHR9XG5cblx0cmV0dXJuIG5leHREYXRlO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZWN1cnJpbmcgam9ic1xuICovXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVSZWN1cnJpbmdKb2JzKFxuXHRzdXBhYmFzZTogYW55LFxuXHRjb21wYW55SWQ6IHN0cmluZyxcblx0YmFzZUpvYjogYW55LFxuXHRyZWN1cnJlbmNlVHlwZTogc3RyaW5nLFxuXHRyZWN1cnJlbmNlRW5kRGF0ZT86IHN0cmluZyxcblx0cmVjdXJyZW5jZUNvdW50PzogbnVtYmVyLFxuKTogUHJvbWlzZTx2b2lkPiB7XG5cdGlmICghYmFzZUpvYi5zY2hlZHVsZWRfc3RhcnQpIHtcblx0XHRyZXR1cm47IC8vIENhbid0IGNyZWF0ZSByZWN1cnJpbmcgam9icyB3aXRob3V0IGEgc3RhcnQgZGF0ZVxuXHR9XG5cblx0Y29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoYmFzZUpvYi5zY2hlZHVsZWRfc3RhcnQpO1xuXHRjb25zdCBlbmREYXRlID0gbmV3IERhdGUoYmFzZUpvYi5zY2hlZHVsZWRfZW5kIHx8IGJhc2VKb2Iuc2NoZWR1bGVkX3N0YXJ0KTtcblx0Y29uc3QgZHVyYXRpb24gPSBlbmREYXRlLmdldFRpbWUoKSAtIHN0YXJ0RGF0ZS5nZXRUaW1lKCk7XG5cblx0Ly8gRGV0ZXJtaW5lIGhvdyBtYW55IG9jY3VycmVuY2VzIHRvIGNyZWF0ZVxuXHRjb25zdCBtYXhPY2N1cnJlbmNlcyA9IHJlY3VycmVuY2VDb3VudCB8fCA1MjsgLy8gRGVmYXVsdCB0byAxIHllYXIgb2Ygd2Vla2x5IGpvYnNcblx0Y29uc3QgZW5kRGF0ZUxpbWl0ID0gcmVjdXJyZW5jZUVuZERhdGUgPyBuZXcgRGF0ZShyZWN1cnJlbmNlRW5kRGF0ZSkgOiBudWxsO1xuXG5cdGNvbnN0IHJlY3VycmluZ0pvYnM6ICh0eXBlb2YgYmFzZUpvYilbXSA9IFtdO1xuXHRsZXQgY3VycmVudERhdGUgPSBuZXcgRGF0ZShzdGFydERhdGUpO1xuXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgbWF4T2NjdXJyZW5jZXMgLSAxOyBpKyspIHtcblx0XHQvLyAtMSBiZWNhdXNlIHdlIGFscmVhZHkgY3JlYXRlZCB0aGUgZmlyc3Qgam9iXG5cdFx0Y3VycmVudERhdGUgPSBjYWxjdWxhdGVOZXh0UmVjdXJyZW5jZShjdXJyZW50RGF0ZSwgcmVjdXJyZW5jZVR5cGUpO1xuXG5cdFx0Ly8gU3RvcCBpZiB3ZSd2ZSByZWFjaGVkIHRoZSBlbmQgZGF0ZVxuXHRcdGlmIChlbmREYXRlTGltaXQgJiYgY3VycmVudERhdGUgPiBlbmREYXRlTGltaXQpIHtcblx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdGNvbnN0IGN1cnJlbnRFbmREYXRlID0gbmV3IERhdGUoY3VycmVudERhdGUuZ2V0VGltZSgpICsgZHVyYXRpb24pO1xuXG5cdFx0Ly8gR2VuZXJhdGUgYSB1bmlxdWUgam9iIG51bWJlciBmb3IgdGhpcyBvY2N1cnJlbmNlXG5cdFx0Y29uc3Qgam9iTnVtYmVyID0gYXdhaXQgZ2VuZXJhdGVKb2JOdW1iZXIoc3VwYWJhc2UsIGNvbXBhbnlJZCk7XG5cblx0XHRyZWN1cnJpbmdKb2JzLnB1c2goe1xuXHRcdFx0Li4uYmFzZUpvYixcblx0XHRcdGpvYl9udW1iZXI6IGpvYk51bWJlcixcblx0XHRcdHNjaGVkdWxlZF9zdGFydDogY3VycmVudERhdGUudG9JU09TdHJpbmcoKSxcblx0XHRcdHNjaGVkdWxlZF9lbmQ6IGN1cnJlbnRFbmREYXRlLnRvSVNPU3RyaW5nKCksXG5cdFx0XHR0aXRsZTogYCR7YmFzZUpvYi50aXRsZX0gKCR7aSArIDJ9LyR7bWF4T2NjdXJyZW5jZXN9KWAsIC8vIEFkZCBvY2N1cnJlbmNlIG51bWJlclxuXHRcdH0pO1xuXG5cdFx0Ly8gQ3JlYXRlIGpvYnMgaW4gYmF0Y2hlcyBvZiAxMCB0byBhdm9pZCBtZW1vcnkgaXNzdWVzXG5cdFx0aWYgKHJlY3VycmluZ0pvYnMubGVuZ3RoID49IDEwKSB7XG5cdFx0XHRhd2FpdCBzdXBhYmFzZS5mcm9tKFwiam9ic1wiKS5pbnNlcnQocmVjdXJyaW5nSm9icyk7XG5cdFx0XHRyZWN1cnJpbmdKb2JzLmxlbmd0aCA9IDA7IC8vIENsZWFyIGFycmF5XG5cdFx0fVxuXHR9XG5cblx0Ly8gSW5zZXJ0IGFueSByZW1haW5pbmcgam9ic1xuXHRpZiAocmVjdXJyaW5nSm9icy5sZW5ndGggPiAwKSB7XG5cdFx0YXdhaXQgc3VwYWJhc2UuZnJvbShcImpvYnNcIikuaW5zZXJ0KHJlY3VycmluZ0pvYnMpO1xuXHR9XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgbmV3IGpvYlxuICog4pyFIEFMUkVBRFkgTUlHUkFURUQgLSBDcmVhdGVzIGNvcmUgam9iICsgYWxsIDEwIGRvbWFpbiByZWNvcmRzIGluIHBhcmFsbGVsXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVKb2IoXG5cdGZvcm1EYXRhOiBGb3JtRGF0YSxcbik6IFByb21pc2U8QWN0aW9uUmVzdWx0PHN0cmluZz4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSBjcmVhdGVKb2JTY2hlbWEucGFyc2Uoe1xuXHRcdFx0cHJvcGVydHlJZDogZm9ybURhdGEuZ2V0KFwicHJvcGVydHlJZFwiKSxcblx0XHRcdGN1c3RvbWVySWQ6IGZvcm1EYXRhLmdldChcImN1c3RvbWVySWRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0dGl0bGU6IGZvcm1EYXRhLmdldChcInRpdGxlXCIpLFxuXHRcdFx0ZGVzY3JpcHRpb246IGZvcm1EYXRhLmdldChcImRlc2NyaXB0aW9uXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdHByaW9yaXR5OiBmb3JtRGF0YS5nZXQoXCJwcmlvcml0eVwiKSB8fCBcIm1lZGl1bVwiLFxuXHRcdFx0am9iVHlwZTogZm9ybURhdGEuZ2V0KFwiam9iVHlwZVwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRzY2hlZHVsZWRTdGFydDogZm9ybURhdGEuZ2V0KFwic2NoZWR1bGVkU3RhcnRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0c2NoZWR1bGVkRW5kOiBmb3JtRGF0YS5nZXQoXCJzY2hlZHVsZWRFbmRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0YXNzaWduZWRUbzogZm9ybURhdGEuZ2V0KFwiYXNzaWduZWRUb1wiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRub3RlczogZm9ybURhdGEuZ2V0KFwibm90ZXNcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0Ly8gRW5oYW5jZWQgc2NoZWR1bGluZyBmaWVsZHNcblx0XHRcdGlzUmVjdXJyaW5nOiBmb3JtRGF0YS5nZXQoXCJpc1JlY3VycmluZ1wiKSA9PT0gXCJ0cnVlXCIsXG5cdFx0XHRzY2hlZHVsaW5nTW9kZTogKGZvcm1EYXRhLmdldChcInNjaGVkdWxpbmdNb2RlXCIpIGFzIGFueSkgfHwgdW5kZWZpbmVkLFxuXHRcdFx0dGltZVdpbmRvdzogZm9ybURhdGEuZ2V0KFwidGltZVdpbmRvd1wiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRyZWN1cnJlbmNlVHlwZTogKGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VUeXBlXCIpIGFzIGFueSkgfHwgdW5kZWZpbmVkLFxuXHRcdFx0cmVjdXJyZW5jZUVuZERhdGU6IGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VFbmREYXRlXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdHJlY3VycmVuY2VDb3VudDogZm9ybURhdGEuZ2V0KFwicmVjdXJyZW5jZUNvdW50XCIpXG5cdFx0XHRcdD8gTnVtYmVyLnBhcnNlSW50KGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VDb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHR9KTtcblxuXHRcdC8vIFZlcmlmeSBwcm9wZXJ0eSBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IHByb3BlcnR5IH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJwcm9wZXJ0aWVzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgY3VzdG9tZXJfaWQsIGFkZHJlc3NcIilcblx0XHRcdC5lcShcImlkXCIsIGRhdGEucHJvcGVydHlJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhwcm9wZXJ0eSwgXCJQcm9wZXJ0eVwiKTtcblxuXHRcdGlmIChwcm9wZXJ0eS5jb21wYW55X2lkICE9PSBjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwicHJvcGVydHlcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVzZSBjdXN0b21lciBmcm9tIHByb3BlcnR5IGlmIG5vdCBwcm92aWRlZFxuXHRcdGNvbnN0IGN1c3RvbWVySWQgPSBkYXRhLmN1c3RvbWVySWQgfHwgcHJvcGVydHkuY3VzdG9tZXJfaWQ7XG5cblx0XHQvLyBHZW5lcmF0ZSB1bmlxdWUgam9iIG51bWJlclxuXHRcdGNvbnN0IGpvYk51bWJlciA9IGF3YWl0IGdlbmVyYXRlSm9iTnVtYmVyKHN1cGFiYXNlLCBjb21wYW55SWQpO1xuXG5cdFx0Ly8gQWRkIHRpbWUgd2luZG93IGluZm8gdG8gbm90ZXMgaWYgYXBwbGljYWJsZVxuXHRcdGxldCBqb2JOb3RlcyA9IGRhdGEubm90ZXMgfHwgXCJcIjtcblx0XHRpZiAoZGF0YS5zY2hlZHVsaW5nTW9kZSA9PT0gXCJ3aW5kb3dcIiAmJiBkYXRhLnRpbWVXaW5kb3cpIHtcblx0XHRcdGNvbnN0IHdpbmRvd0luZm8gPSBgXFxuXFxuW1NjaGVkdWxpbmddIEN1c3RvbWVyIHByZWZlcnJlZCB0aW1lIHdpbmRvdzogJHtkYXRhLnRpbWVXaW5kb3cuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBkYXRhLnRpbWVXaW5kb3cuc2xpY2UoMSl9YDtcblx0XHRcdGpvYk5vdGVzID0gam9iTm90ZXMgPyBgJHtqb2JOb3Rlc30ke3dpbmRvd0luZm99YCA6IHdpbmRvd0luZm8udHJpbSgpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBjb3JlIGpvYiByZWNvcmRcblx0XHRjb25zdCB7IGRhdGE6IG5ld0pvYiwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogZGF0YS5wcm9wZXJ0eUlkLFxuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0YXNzaWduZWRfdG86IGRhdGEuYXNzaWduZWRUbyxcblx0XHRcdFx0am9iX251bWJlcjogam9iTnVtYmVyLFxuXHRcdFx0XHR0aXRsZTogZGF0YS50aXRsZSxcblx0XHRcdFx0ZGVzY3JpcHRpb246IGRhdGEuZGVzY3JpcHRpb24sXG5cdFx0XHRcdHN0YXR1czogXCJxdW90ZWRcIixcblx0XHRcdFx0cHJpb3JpdHk6IGRhdGEucHJpb3JpdHksXG5cdFx0XHRcdGpvYl90eXBlOiBkYXRhLmpvYlR5cGUsXG5cdFx0XHRcdHNlcnZpY2VfdHlwZTogZGF0YS5qb2JUeXBlLCAvLyBEZWZhdWx0IHNlcnZpY2VfdHlwZSB0byBqb2JfdHlwZVxuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRub3Rlczogam9iTm90ZXMsXG5cdFx0XHR9KVxuXHRcdFx0LnNlbGVjdChcImlkXCIpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoY3JlYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiY3JlYXRlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBkb21haW4gcmVjb3JkcyAocGFyYWxsZWwgaW5zZXJ0cyBmb3IgcGVyZm9ybWFuY2UpXG5cdFx0Y29uc3QgZG9tYWluSW5zZXJ0cyA9IGF3YWl0IFByb21pc2UuYWxsKFtcblx0XHRcdC8vIEZpbmFuY2lhbCBkb21haW4gLSBhbHdheXMgY3JlYXRlIHdpdGggZGVmYXVsdHNcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2ZpbmFuY2lhbFwiKVxuXHRcdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0XHRqb2JfaWQ6IG5ld0pvYi5pZCxcblx0XHRcdFx0XHRjb21wYW55X2lkOiBjb21wYW55SWQsXG5cdFx0XHRcdFx0dG90YWxfYW1vdW50OiAwLFxuXHRcdFx0XHRcdHBhaWRfYW1vdW50OiAwLFxuXHRcdFx0XHRcdGRlcG9zaXRfYW1vdW50OiAwLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gV29ya2Zsb3cgZG9tYWluIC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2Jfd29ya2Zsb3dcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdHdvcmtmbG93X2NvbXBsZXRlZF9zdGFnZXM6IFtdLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gVGltZSB0cmFja2luZyAtIGFsd2F5cyBjcmVhdGVcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX3RpbWVfdHJhY2tpbmdcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdHRvdGFsX2xhYm9yX2hvdXJzOiAwLFxuXHRcdFx0XHRcdGJyZWFrX3RpbWVfbWludXRlczogMCxcblx0XHRcdFx0fSksXG5cblx0XHRcdC8vIEN1c3RvbWVyIGFwcHJvdmFsIC0gYWx3YXlzIGNyZWF0ZSB3aXRoIHBlbmRpbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2N1c3RvbWVyX2FwcHJvdmFsXCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRjdXN0b21lcl9hcHByb3ZhbF9zdGF0dXM6IFwicGVuZGluZ1wiLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gRXF1aXBtZW50IHNlcnZpY2UgLSBhbHdheXMgY3JlYXRlXG5cdFx0XHRzdXBhYmFzZVxuXHRcdFx0XHQuZnJvbShcImpvYl9lcXVpcG1lbnRfc2VydmljZVwiKVxuXHRcdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0XHRqb2JfaWQ6IG5ld0pvYi5pZCxcblx0XHRcdFx0XHRjb21wYW55X2lkOiBjb21wYW55SWQsXG5cdFx0XHRcdFx0ZXF1aXBtZW50X3NlcnZpY2VfaGlzdG9yeTogW10sXG5cdFx0XHRcdFx0ZXF1aXBtZW50X3NlcnZpY2VkOiBbXSxcblx0XHRcdFx0fSksXG5cblx0XHRcdC8vIERpc3BhdGNoIC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfZGlzcGF0Y2hcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gUXVhbGl0eSAtIGFsd2F5cyBjcmVhdGVcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX3F1YWxpdHlcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdGluc3BlY3Rpb25fcmVxdWlyZWQ6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gU2FmZXR5IC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2Jfc2FmZXR5XCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRyZXF1aXJlc19wZXJtaXQ6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gQUkgZW5yaWNobWVudCAtIGNyZWF0ZSBlbXB0eSBmb3IgZnV0dXJlIHByb2Nlc3Npbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2FpX2VucmljaG1lbnRcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gTXVsdGktZW50aXR5IC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfbXVsdGlfZW50aXR5XCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRyZXF1aXJlc19tdWx0aXBsZV9wcm9wZXJ0aWVzOiBmYWxzZSxcblx0XHRcdFx0XHRyZXF1aXJlc19tdWx0aXBsZV9jdXN0b21lcnM6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBhbnkgZG9tYWluIGluc2VydCBlcnJvcnNcblx0XHRjb25zdCBkb21haW5FcnJvcnMgPSBkb21haW5JbnNlcnRzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuZXJyb3IpO1xuXHRcdGlmIChkb21haW5FcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0Ly8gUm9sbGJhY2sgLSBkZWxldGUgdGhlIGpvYiAoQ0FTQ0FERSB3aWxsIGRlbGV0ZSBkb21haW4gcmVjb3Jkcylcblx0XHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JzXCIpLmRlbGV0ZSgpLmVxKFwiaWRcIiwgbmV3Sm9iLmlkKTtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiY3JlYXRlIGpvYiBkb21haW5zXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQ3JlYXRlIHJlY3VycmluZyBqb2JzIGlmIHJlcXVlc3RlZFxuXHRcdGlmIChkYXRhLmlzUmVjdXJyaW5nICYmIGRhdGEucmVjdXJyZW5jZVR5cGUgJiYgZGF0YS5zY2hlZHVsZWRTdGFydCkge1xuXHRcdFx0Y29uc3QgYmFzZUpvYiA9IHtcblx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogZGF0YS5wcm9wZXJ0eUlkLFxuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0YXNzaWduZWRfdG86IGRhdGEuYXNzaWduZWRUbyxcblx0XHRcdFx0dGl0bGU6IGRhdGEudGl0bGUsXG5cdFx0XHRcdGRlc2NyaXB0aW9uOiBkYXRhLmRlc2NyaXB0aW9uLFxuXHRcdFx0XHRzdGF0dXM6IFwicXVvdGVkXCIsXG5cdFx0XHRcdHByaW9yaXR5OiBkYXRhLnByaW9yaXR5LFxuXHRcdFx0XHRqb2JfdHlwZTogZGF0YS5qb2JUeXBlLFxuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRub3RlczogZGF0YS5ub3Rlcyxcblx0XHRcdH07XG5cblx0XHRcdGF3YWl0IGNyZWF0ZVJlY3VycmluZ0pvYnMoXG5cdFx0XHRcdHN1cGFiYXNlLFxuXHRcdFx0XHRjb21wYW55SWQsXG5cdFx0XHRcdGJhc2VKb2IsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZVR5cGUsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZUVuZERhdGUsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZUNvdW50LFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBTZW5kIG5vdGlmaWNhdGlvbiB0byBhc3NpZ25lZCB1c2VyIGlmIGpvYiBpcyBhc3NpZ25lZFxuXHRcdGlmIChkYXRhLmFzc2lnbmVkVG8gJiYgZGF0YS5hc3NpZ25lZFRvICE9PSB1c2VyLmlkKSB7XG5cdFx0XHRhd2FpdCBub3RpZnlKb2JDcmVhdGVkKHtcblx0XHRcdFx0dXNlcklkOiBkYXRhLmFzc2lnbmVkVG8sXG5cdFx0XHRcdGNvbXBhbnlJZDogY29tcGFueUlkLFxuXHRcdFx0XHRqb2JJZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRqb2JUaXRsZTogZGF0YS50aXRsZSxcblx0XHRcdFx0YWRkcmVzczogcHJvcGVydHkuYWRkcmVzcyB8fCBcIlVua25vd24gYWRkcmVzc1wiLFxuXHRcdFx0XHRwcmlvcml0eTpcblx0XHRcdFx0XHRkYXRhLnByaW9yaXR5ID09PSBcInVyZ2VudFwiXG5cdFx0XHRcdFx0XHQ/IFwidXJnZW50XCJcblx0XHRcdFx0XHRcdDogZGF0YS5wcmlvcml0eSA9PT0gXCJoaWdoXCJcblx0XHRcdFx0XHRcdFx0PyBcImhpZ2hcIlxuXHRcdFx0XHRcdFx0XHQ6IFwibWVkaXVtXCIsXG5cdFx0XHRcdGFjdGlvblVybDogXCIvZGFzaGJvYXJkL3dvcmtcIixcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrL2pvYnNcIik7XG5cdFx0cmV0dXJuIG5ld0pvYi5pZDtcblx0fSk7XG59XG5cbi8qKlxuICogR2V0IGEgc2luZ2xlIGpvYiBieSBJRFxuICog4pyFIEFMUkVBRFkgTUlHUkFURUQgLSBGZXRjaGVzIGpvYiB3aXRoIGFsbCBkb21haW4gZGF0YVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueT4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBqb2Igd2l0aCBiYXNpYyByZWxhdGlvbnNoaXBzXG5cdFx0Ly8gU2ltcGxpZmllZCBxdWVyeSAtIG1hbnkgZG9tYWluIHRhYmxlcyBkb24ndCBleGlzdCB5ZXRcblx0XHRjb25zdCB7IGRhdGE6IGpvYiwgZXJyb3I6IGpvYkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRgXG5cdFx0XHRcdCosXG5cdFx0XHRcdHByb3BlcnR5OnByb3BlcnRpZXMoKiksXG5cdFx0XHRcdGN1c3RvbWVyOmN1c3RvbWVycyFjdXN0b21lcl9pZChpZCwgZmlyc3RfbmFtZSwgbGFzdF9uYW1lLCBlbWFpbCwgcGhvbmUsIGRpc3BsYXlfbmFtZSlcblx0XHRcdGAsXG5cdFx0XHQpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGpvYkVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm5vdEZvdW5kKFwiSm9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9SRUNPUkRfTk9UX0ZPVU5ELFxuXHRcdFx0XHQ0MDQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRpZiAoam9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBqb2I7XG5cdH0pO1xufVxuXG4vKipcbiAqIFVwZGF0ZSBqb2IgZGV0YWlsc1xuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgYm90aCBjb3JlIGpvYnMgdGFibGUgYW5kIGRvbWFpbiB0YWJsZXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYihcblx0am9iSWQ6IHN0cmluZyxcblx0Zm9ybURhdGE6IEZvcm1EYXRhLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IGFjdGl2ZSBjb21wYW55IElEXG5cdFx0Y29uc3QgYWN0aXZlQ29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cdFx0aWYgKCFhY3RpdmVDb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgdXNlcidzIHJvbGUgdG8gY2hlY2sgaWYgdGhleSdyZSBhZG1pbi9vd25lclxuXHRcdGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiY29tcGFueV9tZW1iZXJzaGlwc1wiKVxuXHRcdFx0LnNlbGVjdChcblx0XHRcdFx0YFxuICAgICAgICByb2xlX2lkLFxuICAgICAgICBjdXN0b21fcm9sZXMhcm9sZV9pZChuYW1lLCBpc19zeXN0ZW0pXG4gICAgICBgLFxuXHRcdFx0KVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LmVxKFwiY29tcGFueV9pZFwiLCBhY3RpdmVDb21wYW55SWQpXG5cdFx0XHQuZXEoXCJzdGF0dXNcIiwgXCJhY3RpdmVcIilcblx0XHRcdC5tYXliZVNpbmdsZSgpO1xuXG5cdFx0Y29uc3Qgcm9sZSA9IEFycmF5LmlzQXJyYXkodGVhbU1lbWJlcj8uY3VzdG9tX3JvbGVzKVxuXHRcdFx0PyB0ZWFtTWVtYmVyLmN1c3RvbV9yb2xlc1swXVxuXHRcdFx0OiB0ZWFtTWVtYmVyPy5jdXN0b21fcm9sZXM7XG5cblx0XHRjb25zdCBpc0FkbWluT3JPd25lciA9XG5cdFx0XHRyb2xlPy5uYW1lID09PSBcIkFkbWluXCIgfHxcblx0XHRcdHJvbGU/Lm5hbWUgPT09IFwiT3duZXJcIiB8fFxuXHRcdFx0cm9sZT8uaXNfc3lzdGVtID09PSB0cnVlO1xuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhleGlzdGluZ0pvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoZXhpc3RpbmdKb2IuY29tcGFueV9pZCAhPT0gYWN0aXZlQ29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUHJldmVudCBlZGl0aW5nIGNvbXBsZXRlZCBvciBjYW5jZWxsZWQgam9icyAodW5sZXNzIGFkbWluL293bmVyKVxuXHRcdGlmIChcblx0XHRcdCFpc0FkbWluT3JPd25lciAmJlxuXHRcdFx0KGV4aXN0aW5nSm9iLnN0YXR1cyA9PT0gXCJjb21wbGV0ZWRcIiB8fCBleGlzdGluZ0pvYi5zdGF0dXMgPT09IFwiY2FuY2VsbGVkXCIpXG5cdFx0KSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBDYW5ub3QgZWRpdCAke2V4aXN0aW5nSm9iLnN0YXR1c30gam9ic2AsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgY3VzdG9tZXJJZFZhbHVlID0gZm9ybURhdGEuZ2V0KFwiY3VzdG9tZXJJZFwiKTtcblx0XHRjb25zdCBwcm9wZXJ0eUlkVmFsdWUgPSBmb3JtRGF0YS5nZXQoXCJwcm9wZXJ0eUlkXCIpO1xuXG5cdFx0Ly8gSGFuZGxlIGN1c3RvbWVySWQ6IGVtcHR5IHN0cmluZyBvciBcIm51bGxcIiBzdHJpbmcgbWVhbnMgcmVtb3ZlIChzZXQgdG8gbnVsbClcblx0XHQvLyB1bmRlZmluZWQgbWVhbnMgZG9uJ3QgY2hhbmdlIGl0XG5cdFx0bGV0IHBhcnNlZEN1c3RvbWVySWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG5cdFx0aWYgKGN1c3RvbWVySWRWYWx1ZSA9PT0gbnVsbCB8fCBjdXN0b21lcklkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyc2VkQ3VzdG9tZXJJZCA9IHVuZGVmaW5lZDsgLy8gRG9uJ3QgY2hhbmdlXG5cdFx0fSBlbHNlIGlmIChjdXN0b21lcklkVmFsdWUgPT09IFwiXCIgfHwgY3VzdG9tZXJJZFZhbHVlID09PSBcIm51bGxcIikge1xuXHRcdFx0cGFyc2VkQ3VzdG9tZXJJZCA9IG51bGw7IC8vIFJlbW92ZSBjdXN0b21lclxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJzZWRDdXN0b21lcklkID0gY3VzdG9tZXJJZFZhbHVlIGFzIHN0cmluZzsgLy8gU2V0IHRvIHRoaXMgY3VzdG9tZXJcblx0XHR9XG5cblx0XHQvLyBIYW5kbGUgcHJvcGVydHlJZDogZW1wdHkgc3RyaW5nIG1lYW5zIHJlbW92ZSAoc2V0IHRvIG51bGwpLCB1bmRlZmluZWQgbWVhbnMgZG9uJ3QgY2hhbmdlXG5cdFx0bGV0IHBhcnNlZFByb3BlcnR5SWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG5cdFx0aWYgKHByb3BlcnR5SWRWYWx1ZSA9PT0gbnVsbCB8fCBwcm9wZXJ0eUlkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyc2VkUHJvcGVydHlJZCA9IHVuZGVmaW5lZDsgLy8gRG9uJ3QgY2hhbmdlXG5cdFx0fSBlbHNlIGlmIChwcm9wZXJ0eUlkVmFsdWUgPT09IFwiXCIgfHwgcHJvcGVydHlJZFZhbHVlID09PSBcIm51bGxcIikge1xuXHRcdFx0cGFyc2VkUHJvcGVydHlJZCA9IG51bGw7IC8vIFJlbW92ZSBwcm9wZXJ0eVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJzZWRQcm9wZXJ0eUlkID0gcHJvcGVydHlJZFZhbHVlIGFzIHN0cmluZzsgLy8gU2V0IHRvIHRoaXMgcHJvcGVydHlcblx0XHR9XG5cblx0XHRjb25zdCBkYXRhID0gdXBkYXRlSm9iU2NoZW1hLnBhcnNlKHtcblx0XHRcdHRpdGxlOiBmb3JtRGF0YS5nZXQoXCJ0aXRsZVwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRkZXNjcmlwdGlvbjogZm9ybURhdGEuZ2V0KFwiZGVzY3JpcHRpb25cIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0c3RhdHVzOiBmb3JtRGF0YS5nZXQoXCJzdGF0dXNcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0cHJpb3JpdHk6IGZvcm1EYXRhLmdldChcInByaW9yaXR5XCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdGpvYlR5cGU6IGZvcm1EYXRhLmdldChcImpvYlR5cGVcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0bm90ZXM6IGZvcm1EYXRhLmdldChcIm5vdGVzXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdC8vIEZpbmFuY2lhbCBmaWVsZHMgKG5vdyBpbiBqb2JfZmluYW5jaWFsIGRvbWFpbiB0YWJsZSlcblx0XHRcdHRvdGFsQW1vdW50OiBmb3JtRGF0YS5nZXQoXCJ0b3RhbEFtb3VudFwiKVxuXHRcdFx0XHQ/IE51bWJlci5wYXJzZUludChmb3JtRGF0YS5nZXQoXCJ0b3RhbEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdHBhaWRBbW91bnQ6IGZvcm1EYXRhLmdldChcInBhaWRBbW91bnRcIilcblx0XHRcdFx0PyBOdW1iZXIucGFyc2VJbnQoZm9ybURhdGEuZ2V0KFwicGFpZEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdGRlcG9zaXRBbW91bnQ6IGZvcm1EYXRhLmdldChcImRlcG9zaXRBbW91bnRcIilcblx0XHRcdFx0PyBOdW1iZXIucGFyc2VJbnQoZm9ybURhdGEuZ2V0KFwiZGVwb3NpdEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdHNjaGVkdWxlZFN0YXJ0OiBmb3JtRGF0YS5nZXQoXCJzY2hlZHVsZWRTdGFydFwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRzY2hlZHVsZWRFbmQ6IGZvcm1EYXRhLmdldChcInNjaGVkdWxlZEVuZFwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRhc3NpZ25lZFRvOiBmb3JtRGF0YS5nZXQoXCJhc3NpZ25lZFRvXCIpIHx8IG51bGwsXG5cdFx0XHRjdXN0b21lcklkOiBwYXJzZWRDdXN0b21lcklkLFxuXHRcdFx0cHJvcGVydHlJZDogcGFyc2VkUHJvcGVydHlJZCxcblx0XHR9KTtcblxuXHRcdC8vIElmIHN0YXR1cyBpcyBiZWluZyBjaGFuZ2VkLCB2YWxpZGF0ZSB0aGUgdHJhbnNpdGlvblxuXHRcdGlmIChkYXRhLnN0YXR1cyAhPT0gdW5kZWZpbmVkICYmIGRhdGEuc3RhdHVzICE9PSBleGlzdGluZ0pvYi5zdGF0dXMpIHtcblx0XHRcdC8vIEZldGNoIGFkZGl0aW9uYWwgY29udGV4dCBmb3Igc3RhdHVzIHZhbGlkYXRpb25cblx0XHRcdGNvbnN0IHsgZGF0YTogam9iV2l0aENvbnRleHQgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRcdGBcblx0XHRcdFx0XHRpZCxcblx0XHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdFx0c2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRcdHNjaGVkdWxlZF9lbmQsXG5cdFx0XHRcdFx0YXNzaWduZWRfdG8sXG5cdFx0XHRcdFx0Y3VzdG9tZXJfaWQsXG5cdFx0XHRcdFx0cHJvcGVydHlfaWQsXG5cdFx0XHRcdFx0dG90YWxfYW1vdW50LFxuXHRcdFx0XHRcdGludm9pY2VzOmludm9pY2VzKHN0YXR1cywgdG90YWxfYW1vdW50KSxcblx0XHRcdFx0XHRlc3RpbWF0ZXM6ZXN0aW1hdGVzKHN0YXR1cyksXG5cdFx0XHRcdFx0dGVhbV9hc3NpZ25tZW50czpqb2JfdGVhbV9hc3NpZ25tZW50cyh0ZWFtX21lbWJlcl9pZClcblx0XHRcdFx0YCxcblx0XHRcdFx0KVxuXHRcdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRpZiAoam9iV2l0aENvbnRleHQpIHtcblx0XHRcdFx0Y29uc3QgdHJhbnNpdGlvbkNvbnRleHQ6IEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0ID0ge1xuXHRcdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGpvYldpdGhDb250ZXh0LnN0YXR1cyBhcyBKb2JTdGF0dXMsXG5cdFx0XHRcdFx0bmV3U3RhdHVzOiBkYXRhLnN0YXR1cyBhcyBKb2JTdGF0dXMsXG5cdFx0XHRcdFx0am9iOiB7XG5cdFx0XHRcdFx0XHRpZDogam9iV2l0aENvbnRleHQuaWQsXG5cdFx0XHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6XG5cdFx0XHRcdFx0XHRcdGRhdGEuc2NoZWR1bGVkU3RhcnQgfHwgam9iV2l0aENvbnRleHQuc2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRcdFx0c2NoZWR1bGVkX2VuZDogZGF0YS5zY2hlZHVsZWRFbmQgfHwgam9iV2l0aENvbnRleHQuc2NoZWR1bGVkX2VuZCxcblx0XHRcdFx0XHRcdGFzc2lnbmVkX3RvOlxuXHRcdFx0XHRcdFx0XHRkYXRhLmFzc2lnbmVkVG8gIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5hc3NpZ25lZFRvXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5hc3NpZ25lZF90byxcblx0XHRcdFx0XHRcdGN1c3RvbWVyX2lkOlxuXHRcdFx0XHRcdFx0XHRkYXRhLmN1c3RvbWVySWQgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5jdXN0b21lcklkXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5jdXN0b21lcl9pZCxcblx0XHRcdFx0XHRcdHByb3BlcnR5X2lkOlxuXHRcdFx0XHRcdFx0XHRkYXRhLnByb3BlcnR5SWQgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5wcm9wZXJ0eUlkXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5wcm9wZXJ0eV9pZCxcblx0XHRcdFx0XHRcdHRvdGFsX2Ftb3VudDpcblx0XHRcdFx0XHRcdFx0ZGF0YS50b3RhbEFtb3VudCAhPT0gdW5kZWZpbmVkXG5cdFx0XHRcdFx0XHRcdFx0PyBkYXRhLnRvdGFsQW1vdW50XG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC50b3RhbF9hbW91bnQsXG5cdFx0XHRcdFx0XHRpbnZvaWNlczogam9iV2l0aENvbnRleHQuaW52b2ljZXMgfHwgW10sXG5cdFx0XHRcdFx0XHRlc3RpbWF0ZXM6IGpvYldpdGhDb250ZXh0LmVzdGltYXRlcyB8fCBbXSxcblx0XHRcdFx0XHRcdHRlYW1Bc3NpZ25tZW50czogam9iV2l0aENvbnRleHQudGVhbV9hc3NpZ25tZW50cyB8fCBbXSxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSB2YWxpZGF0ZVN0YXR1c1RyYW5zaXRpb24odHJhbnNpdGlvbkNvbnRleHQpO1xuXG5cdFx0XHRcdGlmICghdmFsaWRhdGlvblJlc3VsdC5hbGxvd2VkKSB7XG5cdFx0XHRcdFx0bGV0IGVycm9yTWVzc2FnZSA9XG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlYXNvbiB8fCBcIlN0YXR1cyB0cmFuc2l0aW9uIG5vdCBhbGxvd2VkXCI7XG5cblx0XHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlcXVpcmVkRmllbGRzICYmXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlcXVpcmVkRmllbGRzLmxlbmd0aCA+IDBcblx0XHRcdFx0XHQpIHtcblx0XHRcdFx0XHRcdGVycm9yTWVzc2FnZSArPSBgLiBNaXNzaW5nOiAke3ZhbGlkYXRpb25SZXN1bHQucmVxdWlyZWRGaWVsZHMuam9pbihcIiwgXCIpfWA7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKGVycm9yTWVzc2FnZSwgRVJST1JfQ09ERVMuVkFMSURBVElPTl9GQUlMRUQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gTG9nIHdhcm5pbmdzIGlmIHByZXNlbnQgKG5vbi1ibG9ja2luZylcblx0XHRcdFx0aWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwi4pqg77iPIFN0YXR1cyB0cmFuc2l0aW9uIHdhcm5pbmdzOlwiLCB7XG5cdFx0XHRcdFx0XHRqb2JJZCxcblx0XHRcdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGpvYldpdGhDb250ZXh0LnN0YXR1cyxcblx0XHRcdFx0XHRcdG5ld1N0YXR1czogZGF0YS5zdGF0dXMsXG5cdFx0XHRcdFx0XHR3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIEJ1aWxkIGNvcmUgam9iIHVwZGF0ZSBvYmplY3Qgd2l0aCBvbmx5IGRlZmluZWQgdmFsdWVzXG5cdFx0Y29uc3QgY29yZVVwZGF0ZURhdGE6IGFueSA9IHt9O1xuXHRcdGlmIChkYXRhLnRpdGxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnRpdGxlID0gZGF0YS50aXRsZTtcblx0XHR9XG5cdFx0aWYgKGRhdGEuZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuZGVzY3JpcHRpb24gPSBkYXRhLmRlc2NyaXB0aW9uO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zdGF0dXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuc3RhdHVzID0gZGF0YS5zdGF0dXM7XG5cdFx0fVxuXHRcdGlmIChkYXRhLnByaW9yaXR5ICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnByaW9yaXR5ID0gZGF0YS5wcmlvcml0eTtcblx0XHR9XG5cdFx0aWYgKGRhdGEuam9iVHlwZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb3JlVXBkYXRlRGF0YS5qb2JfdHlwZSA9IGRhdGEuam9iVHlwZTtcblx0XHR9XG5cdFx0aWYgKGRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEubm90ZXMgPSBkYXRhLm5vdGVzO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zY2hlZHVsZWRTdGFydCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb3JlVXBkYXRlRGF0YS5zY2hlZHVsZWRfc3RhcnQgPSBkYXRhLnNjaGVkdWxlZFN0YXJ0O1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zY2hlZHVsZWRFbmQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuc2NoZWR1bGVkX2VuZCA9IGRhdGEuc2NoZWR1bGVkRW5kO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5hc3NpZ25lZFRvICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLmFzc2lnbmVkX3RvID0gZGF0YS5hc3NpZ25lZFRvO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLmN1c3RvbWVyX2lkID0gZGF0YS5jdXN0b21lcklkO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5wcm9wZXJ0eUlkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnByb3BlcnR5X2lkID0gZGF0YS5wcm9wZXJ0eUlkO1xuXHRcdFx0Ly8gSWYgcHJvcGVydHkgaXMgYmVpbmcgc2V0IChub3QgbnVsbCksIHZlcmlmeSBpdCBiZWxvbmdzIHRvIHRoZSBjdXN0b21lciAoaWYgY3VzdG9tZXIgaXMgc2V0KVxuXHRcdFx0aWYgKFxuXHRcdFx0XHRkYXRhLnByb3BlcnR5SWQgIT09IG51bGwgJiZcblx0XHRcdFx0ZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQgJiZcblx0XHRcdFx0ZGF0YS5jdXN0b21lcklkICE9PSBudWxsXG5cdFx0XHQpIHtcblx0XHRcdFx0Y29uc3QgeyBkYXRhOiBwcm9wZXJ0eSB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdFx0XHQuZnJvbShcInByb3BlcnRpZXNcIilcblx0XHRcdFx0XHQuc2VsZWN0KFwiY3VzdG9tZXJfaWRcIilcblx0XHRcdFx0XHQuZXEoXCJpZFwiLCBkYXRhLnByb3BlcnR5SWQpXG5cdFx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRcdGlmIChwcm9wZXJ0eSAmJiBwcm9wZXJ0eS5jdXN0b21lcl9pZCAhPT0gZGF0YS5jdXN0b21lcklkKSB7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcdFx0XCJQcm9wZXJ0eSBkb2VzIG5vdCBiZWxvbmcgdG8gdGhlIHNlbGVjdGVkIGN1c3RvbWVyXCIsXG5cdFx0XHRcdFx0XHRFUlJPUl9DT0RFUy5WQUxJREFUSU9OX0ZBSUxFRCxcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gQnVpbGQgZmluYW5jaWFsIGRvbWFpbiB1cGRhdGUgb2JqZWN0IChpZiBhbnkgZmluYW5jaWFsIGZpZWxkcyBwcm92aWRlZClcblx0XHRjb25zdCBmaW5hbmNpYWxVcGRhdGVEYXRhOiBhbnkgPSB7fTtcblx0XHRpZiAoZGF0YS50b3RhbEFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmaW5hbmNpYWxVcGRhdGVEYXRhLnRvdGFsX2Ftb3VudCA9IGRhdGEudG90YWxBbW91bnQ7XG5cdFx0fVxuXHRcdGlmIChkYXRhLnBhaWRBbW91bnQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0ZmluYW5jaWFsVXBkYXRlRGF0YS5wYWlkX2Ftb3VudCA9IGRhdGEucGFpZEFtb3VudDtcblx0XHR9XG5cdFx0aWYgKGRhdGEuZGVwb3NpdEFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmaW5hbmNpYWxVcGRhdGVEYXRhLmRlcG9zaXRfYW1vdW50ID0gZGF0YS5kZXBvc2l0QW1vdW50O1xuXHRcdH1cblxuXHRcdC8vIEV4ZWN1dGUgdXBkYXRlcyBpbiBwYXJhbGxlbCBmb3IgcGVyZm9ybWFuY2Vcblx0XHRjb25zdCB1cGRhdGVzOiBQcm9taXNlPGFueT5bXSA9IFtdO1xuXG5cdFx0Ly8gVXBkYXRlIGNvcmUgam9iIHRhYmxlIGlmIHRoZXJlIGFyZSBjaGFuZ2VzXG5cdFx0aWYgKE9iamVjdC5rZXlzKGNvcmVVcGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG5cdFx0XHR1cGRhdGVzLnB1c2goXG5cdFx0XHRcdChhc3luYyAoKSA9PiBhd2FpdCBzdXBhYmFzZS5mcm9tKFwiam9ic1wiKS51cGRhdGUoY29yZVVwZGF0ZURhdGEpLmVxKFwiaWRcIiwgam9iSWQpKSgpLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBVcGRhdGUgZmluYW5jaWFsIGRvbWFpbiB0YWJsZSBpZiB0aGVyZSBhcmUgY2hhbmdlc1xuXHRcdGlmIChPYmplY3Qua2V5cyhmaW5hbmNpYWxVcGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG5cdFx0XHR1cGRhdGVzLnB1c2goXG5cdFx0XHRcdChhc3luYyAoKSA9PlxuXHRcdFx0XHRcdGF3YWl0IHN1cGFiYXNlXG5cdFx0XHRcdFx0XHQuZnJvbShcImpvYl9maW5hbmNpYWxcIilcblx0XHRcdFx0XHRcdC51cGRhdGUoZmluYW5jaWFsVXBkYXRlRGF0YSlcblx0XHRcdFx0XHRcdC5lcShcImpvYl9pZFwiLCBqb2JJZCkpKCksXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEV4ZWN1dGUgYWxsIHVwZGF0ZXMgaW4gcGFyYWxsZWxcblx0XHRpZiAodXBkYXRlcy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwodXBkYXRlcyk7XG5cblx0XHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gYW55IHVwZGF0ZVxuXHRcdFx0Y29uc3QgZXJyb3JzID0gcmVzdWx0cy5maWx0ZXIoKHJlc3VsdCkgPT4gcmVzdWx0LmVycm9yKTtcblx0XHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRjb25zdCBlcnJvck1lc3NhZ2VzID0gZXJyb3JzLm1hcCgoZSkgPT4gZS5lcnJvci5tZXNzYWdlKS5qb2luKFwiLCBcIik7XG5cdFx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XHRgJHtFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJ1cGRhdGUgam9iXCIpfTogJHtlcnJvck1lc3NhZ2VzfWAsXG5cdFx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBVcGRhdGUgam9iIHdpdGggZGF0YSBvYmplY3QgKGVhc2llciBmb3IgcHJvZ3JhbW1hdGljIHVzZSlcbiAqIFVzZWQgYnkgam9iIGVkaXRvciBmb3IgaW4tcGxhY2UgdXBkYXRlc1xuICovXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVKb2JEYXRhKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRkYXRhOiBQYXJ0aWFsPFVwZGF0ZUpvYkRhdGE+LFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHQvLyBDb252ZXJ0IGRhdGEgb2JqZWN0IHRvIEZvcm1EYXRhIGZvciBjb21wYXRpYmlsaXR5IHdpdGggZXhpc3RpbmcgdXBkYXRlSm9iXG5cdFx0Y29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcblxuXHRcdC8vIEFkZCBhbGwgZGVmaW5lZCBmaWVsZHMgdG8gRm9ybURhdGFcblx0XHRpZiAoZGF0YS50aXRsZSAhPT0gdW5kZWZpbmVkKSBmb3JtRGF0YS5hcHBlbmQoXCJ0aXRsZVwiLCBkYXRhLnRpdGxlKTtcblx0XHRpZiAoZGF0YS5kZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwiZGVzY3JpcHRpb25cIiwgZGF0YS5kZXNjcmlwdGlvbik7XG5cdFx0aWYgKGRhdGEuc3RhdHVzICE9PSB1bmRlZmluZWQpIGZvcm1EYXRhLmFwcGVuZChcInN0YXR1c1wiLCBkYXRhLnN0YXR1cyk7XG5cdFx0aWYgKGRhdGEucHJpb3JpdHkgIT09IHVuZGVmaW5lZCkgZm9ybURhdGEuYXBwZW5kKFwicHJpb3JpdHlcIiwgZGF0YS5wcmlvcml0eSk7XG5cdFx0aWYgKGRhdGEuam9iVHlwZSAhPT0gdW5kZWZpbmVkKSBmb3JtRGF0YS5hcHBlbmQoXCJqb2JUeXBlXCIsIGRhdGEuam9iVHlwZSk7XG5cdFx0aWYgKGRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkgZm9ybURhdGEuYXBwZW5kKFwibm90ZXNcIiwgZGF0YS5ub3Rlcyk7XG5cdFx0aWYgKGRhdGEudG90YWxBbW91bnQgIT09IHVuZGVmaW5lZClcblx0XHRcdGZvcm1EYXRhLmFwcGVuZChcInRvdGFsQW1vdW50XCIsIGRhdGEudG90YWxBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEucGFpZEFtb3VudCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwicGFpZEFtb3VudFwiLCBkYXRhLnBhaWRBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEuZGVwb3NpdEFtb3VudCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwiZGVwb3NpdEFtb3VudFwiLCBkYXRhLmRlcG9zaXRBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEuc2NoZWR1bGVkU3RhcnQgIT09IHVuZGVmaW5lZClcblx0XHRcdGZvcm1EYXRhLmFwcGVuZChcInNjaGVkdWxlZFN0YXJ0XCIsIGRhdGEuc2NoZWR1bGVkU3RhcnQpO1xuXHRcdGlmIChkYXRhLnNjaGVkdWxlZEVuZCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwic2NoZWR1bGVkRW5kXCIsIGRhdGEuc2NoZWR1bGVkRW5kKTtcblx0XHRpZiAoZGF0YS5hc3NpZ25lZFRvICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJhc3NpZ25lZFRvXCIsIGRhdGEuYXNzaWduZWRUbyB8fCBcIlwiKTtcblx0XHRpZiAoZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJjdXN0b21lcklkXCIsIGRhdGEuY3VzdG9tZXJJZCB8fCBcIlwiKTtcblx0XHRpZiAoZGF0YS5wcm9wZXJ0eUlkICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJwcm9wZXJ0eUlkXCIsIGRhdGEucHJvcGVydHlJZCB8fCBcIlwiKTtcblxuXHRcdC8vIFJldXNlIGV4aXN0aW5nIHVwZGF0ZUpvYiBsb2dpY1xuXHRcdHJldHVybiBhd2FpdCB1cGRhdGVKb2Ioam9iSWQsIGZvcm1EYXRhKTtcblx0fSk7XG59XG5cbi8qKlxuICogVXBkYXRlIGpvYiBzdGF0dXMgd2l0aCB2YWxpZGF0aW9uXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5zdGF0dXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYlN0YXR1cyhcblx0am9iSWQ6IHN0cmluZyxcblx0bmV3U3RhdHVzOiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBjdXJyZW50IHVzZXJcblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmFsaWRhdGUgc3RhdHVzIHZhbHVlXG5cdFx0Y29uc3QgdmFsaWRTdGF0dXNlczogSm9iU3RhdHVzW10gPSBbXG5cdFx0XHRcInF1b3RlZFwiLFxuXHRcdFx0XCJzY2hlZHVsZWRcIixcblx0XHRcdFwiaW5fcHJvZ3Jlc3NcIixcblx0XHRcdFwib25faG9sZFwiLFxuXHRcdFx0XCJjb21wbGV0ZWRcIixcblx0XHRcdFwiY2FuY2VsbGVkXCIsXG5cdFx0XHRcImludm9pY2VkXCIsXG5cdFx0XHRcInBhaWRcIixcblx0XHRdO1xuXHRcdGlmICghdmFsaWRTdGF0dXNlcy5pbmNsdWRlcyhuZXdTdGF0dXMgYXMgSm9iU3RhdHVzKSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkludmFsaWQgam9iIHN0YXR1c1wiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5WQUxJREFUSU9OX0ZBSUxFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gRmV0Y2ggam9iIHdpdGggYWxsIGNvbnRleHQgbmVlZGVkIGZvciB0cmFuc2l0aW9uIHZhbGlkYXRpb25cblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRgXG5cdFx0XHRcdGlkLFxuXHRcdFx0XHRjb21wYW55X2lkLFxuXHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdHNjaGVkdWxlZF9zdGFydCxcblx0XHRcdFx0c2NoZWR1bGVkX2VuZCxcblx0XHRcdFx0YXNzaWduZWRfdG8sXG5cdFx0XHRcdGN1c3RvbWVyX2lkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZCxcblx0XHRcdFx0dG90YWxfYW1vdW50LFxuXHRcdFx0XHRpbnZvaWNlczppbnZvaWNlcyhzdGF0dXMsIHRvdGFsX2Ftb3VudCksXG5cdFx0XHRcdGVzdGltYXRlczplc3RpbWF0ZXMoc3RhdHVzKSxcblx0XHRcdFx0dGVhbV9hc3NpZ25tZW50czpqb2JfdGVhbV9hc3NpZ25tZW50cyh0ZWFtX21lbWJlcl9pZClcblx0XHRcdGAsXG5cdFx0XHQpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhleGlzdGluZ0pvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoZXhpc3RpbmdKb2IuY29tcGFueV9pZCAhPT0gY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQnVpbGQgY29udGV4dCBmb3IgdHJhbnNpdGlvbiB2YWxpZGF0aW9uXG5cdFx0Y29uc3QgdHJhbnNpdGlvbkNvbnRleHQ6IEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0ID0ge1xuXHRcdFx0Y3VycmVudFN0YXR1czogZXhpc3RpbmdKb2Iuc3RhdHVzIGFzIEpvYlN0YXR1cyxcblx0XHRcdG5ld1N0YXR1czogbmV3U3RhdHVzIGFzIEpvYlN0YXR1cyxcblx0XHRcdGpvYjoge1xuXHRcdFx0XHRpZDogZXhpc3RpbmdKb2IuaWQsXG5cdFx0XHRcdHNjaGVkdWxlZF9zdGFydDogZXhpc3RpbmdKb2Iuc2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRzY2hlZHVsZWRfZW5kOiBleGlzdGluZ0pvYi5zY2hlZHVsZWRfZW5kLFxuXHRcdFx0XHRhc3NpZ25lZF90bzogZXhpc3RpbmdKb2IuYXNzaWduZWRfdG8sXG5cdFx0XHRcdGN1c3RvbWVyX2lkOiBleGlzdGluZ0pvYi5jdXN0b21lcl9pZCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IGV4aXN0aW5nSm9iLnByb3BlcnR5X2lkLFxuXHRcdFx0XHR0b3RhbF9hbW91bnQ6IGV4aXN0aW5nSm9iLnRvdGFsX2Ftb3VudCxcblx0XHRcdFx0aW52b2ljZXM6IGV4aXN0aW5nSm9iLmludm9pY2VzIHx8IFtdLFxuXHRcdFx0XHRlc3RpbWF0ZXM6IGV4aXN0aW5nSm9iLmVzdGltYXRlcyB8fCBbXSxcblx0XHRcdFx0dGVhbUFzc2lnbm1lbnRzOiBleGlzdGluZ0pvYi50ZWFtX2Fzc2lnbm1lbnRzIHx8IFtdLFxuXHRcdFx0fSxcblx0XHR9O1xuXG5cdFx0Ly8gVmFsaWRhdGUgdHJhbnNpdGlvbiB3aXRoIGNvbXByZWhlbnNpdmUgYnVzaW5lc3MgcnVsZXNcblx0XHRjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gdmFsaWRhdGVTdGF0dXNUcmFuc2l0aW9uKHRyYW5zaXRpb25Db250ZXh0KTtcblxuXHRcdGlmICghdmFsaWRhdGlvblJlc3VsdC5hbGxvd2VkKSB7XG5cdFx0XHRsZXQgZXJyb3JNZXNzYWdlID1cblx0XHRcdFx0dmFsaWRhdGlvblJlc3VsdC5yZWFzb24gfHwgXCJTdGF0dXMgdHJhbnNpdGlvbiBub3QgYWxsb3dlZFwiO1xuXG5cdFx0XHRpZiAoXG5cdFx0XHRcdHZhbGlkYXRpb25SZXN1bHQucmVxdWlyZWRGaWVsZHMgJiZcblx0XHRcdFx0dmFsaWRhdGlvblJlc3VsdC5yZXF1aXJlZEZpZWxkcy5sZW5ndGggPiAwXG5cdFx0XHQpIHtcblx0XHRcdFx0ZXJyb3JNZXNzYWdlICs9IGAuIE1pc3Npbmc6ICR7dmFsaWRhdGlvblJlc3VsdC5yZXF1aXJlZEZpZWxkcy5qb2luKFwiLCBcIil9YDtcblx0XHRcdH1cblxuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKGVycm9yTWVzc2FnZSwgRVJST1JfQ09ERVMuVkFMSURBVElPTl9GQUlMRUQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyB3YXJuaW5ncyBpZiBwcmVzZW50IChub24tYmxvY2tpbmcpXG5cdFx0aWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCLimqDvuI8gU3RhdHVzIHRyYW5zaXRpb24gd2FybmluZ3M6XCIsIHtcblx0XHRcdFx0am9iSWQsXG5cdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGV4aXN0aW5nSm9iLnN0YXR1cyxcblx0XHRcdFx0bmV3U3RhdHVzLFxuXHRcdFx0XHR3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBzdGF0dXNcblx0XHRjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnVwZGF0ZSh7IHN0YXR1czogbmV3U3RhdHVzIH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwidXBkYXRlIGpvYiBzdGF0dXNcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1FVRVJZX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zb2xlLmxvZyhcIuKchSBKb2Igc3RhdHVzIHVwZGF0ZWQ6XCIsIHtcblx0XHRcdGpvYklkLFxuXHRcdFx0b2xkU3RhdHVzOiBleGlzdGluZ0pvYi5zdGF0dXMsXG5cdFx0XHRuZXdTdGF0dXMsXG5cdFx0fSk7XG5cblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZC93b3JrLyR7am9iSWR9YCk7XG5cdH0pO1xufVxuXG4vKipcbiAqIEFzc2lnbiBqb2IgdG8gYSB0ZWNobmljaWFuXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5hc3NpZ25lZF90b1xuICovXG5hc3luYyBmdW5jdGlvbiBhc3NpZ25Kb2IoXG5cdGpvYklkOiBzdHJpbmcsXG5cdHRlY2huaWNpYW5JZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWRcIilcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0YXNzZXJ0RXhpc3RzKGV4aXN0aW5nSm9iLCBcIkpvYlwiKTtcblxuXHRcdGlmIChleGlzdGluZ0pvYi5jb21wYW55X2lkICE9PSBjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwiam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgdGVjaG5pY2lhbiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IHRlY2huaWNpYW4gfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImNvbXBhbnlfbWVtYmVyc2hpcHNcIilcblx0XHRcdC5zZWxlY3QoXCJ1c2VyX2lkXCIpXG5cdFx0XHQuZXEoXCJ1c2VyX2lkXCIsIHRlY2huaWNpYW5JZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWNobmljaWFuKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiVGVjaG5pY2lhbiBub3QgZm91bmQgaW4geW91ciBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1JFQ09SRF9OT1RfRk9VTkQsXG5cdFx0XHRcdDQwNCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQXNzaWduIGpvYlxuXHRcdGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQudXBkYXRlKHsgYXNzaWduZWRfdG86IHRlY2huaWNpYW5JZCB9KVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpO1xuXG5cdFx0aWYgKHVwZGF0ZUVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImFzc2lnbiBqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1FVRVJZX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZC93b3JrLyR7am9iSWR9YCk7XG5cdH0pO1xufVxuXG4vKipcbiAqIFNjaGVkdWxlIGEgam9iXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icyB0YWJsZSBzY2hlZHVsaW5nIGZpZWxkc1xuICovXG5hc3luYyBmdW5jdGlvbiBzY2hlZHVsZUpvYihcblx0am9iSWQ6IHN0cmluZyxcblx0Zm9ybURhdGE6IEZvcm1EYXRhLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSBzY2hlZHVsZUpvYlNjaGVtYS5wYXJzZSh7XG5cdFx0XHRzY2hlZHVsZWRTdGFydDogZm9ybURhdGEuZ2V0KFwic2NoZWR1bGVkU3RhcnRcIiksXG5cdFx0XHRzY2hlZHVsZWRFbmQ6IGZvcm1EYXRhLmdldChcInNjaGVkdWxlZEVuZFwiKSxcblx0XHR9KTtcblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWQsIHN0YXR1c1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBzY2hlZHVsZSBhbmQgc3RhdHVzXG5cdFx0Y29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRzdGF0dXM6XG5cdFx0XHRcdFx0ZXhpc3RpbmdKb2Iuc3RhdHVzID09PSBcInF1b3RlZFwiID8gXCJzY2hlZHVsZWRcIiA6IGV4aXN0aW5nSm9iLnN0YXR1cyxcblx0XHRcdH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwic2NoZWR1bGUgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0fSk7XG59XG5cbi8qKlxuICogU3RhcnQgYSBqb2JcbiAqIPCflKcgUkVGQUNUT1JFRCAtIE5vdyB1cGRhdGVzIGpvYl90aW1lX3RyYWNraW5nLmFjdHVhbF9zdGFydCBpbnN0ZWFkIG9mIGpvYnMuYWN0dWFsX3N0YXJ0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdGFydEpvYihqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWQsIHN0YXR1c1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbiBvbmx5IHN0YXJ0IHNjaGVkdWxlZCBqb2JzXG5cdFx0aWYgKGV4aXN0aW5nSm9iLnN0YXR1cyAhPT0gXCJzY2hlZHVsZWRcIiAmJiBleGlzdGluZ0pvYi5zdGF0dXMgIT09IFwicXVvdGVkXCIpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgbXVzdCBiZSBzY2hlZHVsZWQgYmVmb3JlIHN0YXJ0aW5nXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuXG5cdFx0Ly8gVXBkYXRlIGJvdGggam9icyB0YWJsZSAoc3RhdHVzKSBhbmQgam9iX3RpbWVfdHJhY2tpbmcgdGFibGUgKGFjdHVhbF9zdGFydCkgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0c3VwYWJhc2UuZnJvbShcImpvYnNcIikudXBkYXRlKHsgc3RhdHVzOiBcImluX3Byb2dyZXNzXCIgfSkuZXEoXCJpZFwiLCBqb2JJZCksXG5cdFx0XHRzdXBhYmFzZVxuXHRcdFx0XHQuZnJvbShcImpvYl90aW1lX3RyYWNraW5nXCIpXG5cdFx0XHRcdC51cGRhdGUoeyBhY3R1YWxfc3RhcnQ6IG5vdyB9KVxuXHRcdFx0XHQuZXEoXCJqb2JfaWRcIiwgam9iSWQpLFxuXHRcdF0pO1xuXG5cdFx0Ly8gQ2hlY2sgZm9yIGVycm9ycyBpbiBlaXRoZXIgdXBkYXRlXG5cdFx0Y29uc3QgZXJyb3JzID0gdXBkYXRlcy5maWx0ZXIoKHJlc3VsdCkgPT4gcmVzdWx0LmVycm9yKTtcblx0XHRpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwic3RhcnQgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBDb21wbGV0ZSBhIGpvYlxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgam9iX3RpbWVfdHJhY2tpbmcuYWN0dWFsX2VuZCBhbmQgY2FsY3VsYXRlcyB0b3RhbF9sYWJvcl9ob3Vyc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29tcGxldGVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHZvaWQ+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IGN1cnJlbnQgdXNlclxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdC8vIEdldCB1c2VyJ3MgYWN0aXZlIGNvbXBhbnkgdXNpbmcgaGVscGVyIChoYW5kbGVzIG11bHRpLWNvbXBhbnkgdXNlcnMpXG5cdFx0Y29uc3QgeyBnZXRBY3RpdmVDb21wYW55SWQgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL2F1dGgvY29tcGFueS1jb250ZXh0XCIpO1xuXHRcdGNvbnN0IGNvbXBhbnlJZCA9IGF3YWl0IGdldEFjdGl2ZUNvbXBhbnlJZCgpO1xuXG5cdFx0aWYgKCFjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGJlbG9uZ3MgdG8gY29tcGFueSBhbmQgZ2V0IHRpbWUgdHJhY2tpbmcgZGF0YVxuXHRcdGNvbnN0IHsgZGF0YTogZXhpc3RpbmdKb2IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkLCBzdGF0dXMsIHRpbWVUcmFja2luZzpqb2JfdGltZV90cmFja2luZygqKVwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbiBvbmx5IGNvbXBsZXRlIGluLXByb2dyZXNzIGpvYnNcblx0XHRpZiAoZXhpc3RpbmdKb2Iuc3RhdHVzICE9PSBcImluX3Byb2dyZXNzXCIpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgbXVzdCBiZSBpbiBwcm9ncmVzcyB0byBjb21wbGV0ZVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcblxuXHRcdC8vIENhbGN1bGF0ZSB0b3RhbCBsYWJvciBob3VycyBpZiB3ZSBoYXZlIGFjdHVhbF9zdGFydFxuXHRcdGNvbnN0IHRpbWVUcmFja2luZyA9IEFycmF5LmlzQXJyYXkoZXhpc3RpbmdKb2IudGltZVRyYWNraW5nKVxuXHRcdFx0PyBleGlzdGluZ0pvYi50aW1lVHJhY2tpbmdbMF1cblx0XHRcdDogZXhpc3RpbmdKb2IudGltZVRyYWNraW5nO1xuXG5cdFx0Y29uc3QgdGltZVRyYWNraW5nVXBkYXRlOiBhbnkgPSB7IGFjdHVhbF9lbmQ6IG5vdyB9O1xuXG5cdFx0aWYgKHRpbWVUcmFja2luZz8uYWN0dWFsX3N0YXJ0KSB7XG5cdFx0XHRjb25zdCBzdGFydFRpbWUgPSBuZXcgRGF0ZSh0aW1lVHJhY2tpbmcuYWN0dWFsX3N0YXJ0KS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBlbmRUaW1lID0gbmV3IERhdGUobm93KS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBob3Vyc1dvcmtlZCA9IChlbmRUaW1lIC0gc3RhcnRUaW1lKSAvICgxMDAwICogNjAgKiA2MCk7IC8vIENvbnZlcnQgbXMgdG8gaG91cnNcblx0XHRcdHRpbWVUcmFja2luZ1VwZGF0ZS50b3RhbF9sYWJvcl9ob3VycyA9IGhvdXJzV29ya2VkO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBib3RoIGpvYnMgdGFibGUgKHN0YXR1cykgYW5kIGpvYl90aW1lX3RyYWNraW5nIHRhYmxlIChhY3R1YWxfZW5kLCB0b3RhbF9sYWJvcl9ob3VycykgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0c3VwYWJhc2UuZnJvbShcImpvYnNcIikudXBkYXRlKHsgc3RhdHVzOiBcImNvbXBsZXRlZFwiIH0pLmVxKFwiaWRcIiwgam9iSWQpLFxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfdGltZV90cmFja2luZ1wiKVxuXHRcdFx0XHQudXBkYXRlKHRpbWVUcmFja2luZ1VwZGF0ZSlcblx0XHRcdFx0LmVxKFwiam9iX2lkXCIsIGpvYklkKSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gZWl0aGVyIHVwZGF0ZVxuXHRcdGNvbnN0IGVycm9ycyA9IHVwZGF0ZXMuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5lcnJvcik7XG5cdFx0aWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImNvbXBsZXRlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0fSk7XG59XG5cbi8qKlxuICogQ2FuY2VsIGEgam9iXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5zdGF0dXMgYW5kIGpvYnMubm90ZXNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gY2FuY2VsSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRyZWFzb24/OiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBjdXJyZW50IHVzZXJcblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzLCBub3Rlc1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbm5vdCBjYW5jZWwgY29tcGxldGVkIGpvYnNcblx0XHRpZiAoZXhpc3RpbmdKb2Iuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiQ2Fubm90IGNhbmNlbCBjb21wbGV0ZWQgam9ic1wiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEFkZCBjYW5jZWxsYXRpb24gcmVhc29uIHRvIG5vdGVzXG5cdFx0Y29uc3QgdXBkYXRlZE5vdGVzID0gcmVhc29uXG5cdFx0XHQ/IGAke2V4aXN0aW5nSm9iLm5vdGVzIHx8IFwiXCJ9XFxuXFxuW0NBTkNFTExFRF06ICR7cmVhc29ufWAudHJpbSgpXG5cdFx0XHQ6IGV4aXN0aW5nSm9iLm5vdGVzO1xuXG5cdFx0Ly8gQ2FuY2VsIGpvYlxuXHRcdGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0c3RhdHVzOiBcImNhbmNlbGxlZFwiLFxuXHRcdFx0XHRub3RlczogdXBkYXRlZE5vdGVzLFxuXHRcdFx0fSlcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKTtcblxuXHRcdGlmICh1cGRhdGVFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJjYW5jZWwgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBTZWFyY2ggam9icyB3aXRoIGZ1bGwtdGV4dCBzZWFyY2ggYW5kIHJhbmtpbmdcbiAqIOKchSBOTyBDSEFOR0VTIE5FRURFRCAtIE9ubHkgc2VhcmNoZXMgam9icyB0YWJsZVxuICovXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hKb2JzKFxuXHRzZWFyY2hUZXJtOiBzdHJpbmcsXG5cdG9wdGlvbnM/OiB7IGxpbWl0PzogbnVtYmVyOyBvZmZzZXQ/OiBudW1iZXIgfSxcbik6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueVtdPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiY29tcGFueV9tZW1iZXJzaGlwc1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWRcIilcblx0XHRcdC5lcShcInVzZXJfaWRcIiwgdXNlci5pZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGlmICghdGVhbU1lbWJlcj8uY29tcGFueV9pZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVzZSBmdWxsLXRleHQgc2VhcmNoIHdpdGggcmFua2luZyBmb3IgYmVzdCBtYXRjaGVzXG5cdFx0Y29uc3QgeyBzZWFyY2hKb2JzRnVsbFRleHQgfSA9IGF3YWl0IGltcG9ydChcblx0XHRcdFwiQC9saWIvc2VhcmNoL2Z1bGwtdGV4dC1zZWFyY2hcIlxuXHRcdCk7XG5cblx0XHRjb25zdCBqb2JzID0gYXdhaXQgc2VhcmNoSm9ic0Z1bGxUZXh0KHN1cGFiYXNlLCB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQsIHNlYXJjaFRlcm0sIHtcblx0XHRcdGxpbWl0OiBvcHRpb25zPy5saW1pdCB8fCA1MCxcblx0XHRcdG9mZnNldDogb3B0aW9ucz8ub2Zmc2V0IHx8IDAsXG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gam9icztcblx0fSk7XG59XG5cbi8qKlxuICogVW5pdmVyc2FsIHNlYXJjaCBhY3Jvc3MgYWxsIGVudGl0aWVzXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHNlYXJjaGVzIGpvYnMgdGFibGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2VhcmNoQWxsKFxuXHRzZWFyY2hUZXJtOiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDxhbnk+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Y29uc3QgeyBkYXRhOiB0ZWFtTWVtYmVyIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjb21wYW55X21lbWJlcnNoaXBzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWFtTWVtYmVyPy5jb21wYW55X2lkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVXNlIHVuaXZlcnNhbCBzZWFyY2ggUlBDIGZ1bmN0aW9uXG5cdFx0Y29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UucnBjKFwic2VhcmNoX2FsbF9lbnRpdGllc1wiLCB7XG5cdFx0XHRjb21wYW55X2lkX3BhcmFtOiB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQsXG5cdFx0XHRzZWFyY2hfcXVlcnk6IHNlYXJjaFRlcm0sXG5cdFx0XHRwZXJfZW50aXR5X2xpbWl0OiA1LFxuXHRcdH0pO1xuXG5cdFx0aWYgKGVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcInNlYXJjaFwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBkYXRhO1xuXHR9KTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSk9CIEFSQ0hJVkUgJiBSRVNUT1JFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogQXJjaGl2ZSBqb2IgKHNvZnQgZGVsZXRlKVxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgam9iX211bHRpX2VudGl0eS5kZWxldGVkX2J5IGFuZCBwZXJtYW5lbnRfZGVsZXRlX3NjaGVkdWxlZF9hdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXJjaGl2ZUpvYihqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHRjb25zdCB7IGRhdGE6IHRlYW1NZW1iZXIgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImNvbXBhbnlfbWVtYmVyc2hpcHNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJ1c2VyX2lkXCIsIHVzZXIuaWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoIXRlYW1NZW1iZXI/LmNvbXBhbnlfaWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogam9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGpvYi5jb21wYW55X2lkICE9PSB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwiam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBDYW5ub3QgYXJjaGl2ZSBjb21wbGV0ZWQvcGFpZCBqb2JzIChidXNpbmVzcyBydWxlKVxuXHRcdGlmIChqb2Iuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiIHx8IGpvYi5zdGF0dXMgPT09IFwiaW52b2ljZWRcIikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkNhbm5vdCBhcmNoaXZlIGNvbXBsZXRlZCBvciBpbnZvaWNlZCBqb2JzLiBUaGVzZSBtdXN0IGJlIHJldGFpbmVkIGZvciByZWNvcmRzLlwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEFyY2hpdmUgam9iIChzb2Z0IGRlbGV0ZSlcblx0XHRjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG5cdFx0Y29uc3Qgc2NoZWR1bGVkRGVsZXRpb24gPSBuZXcgRGF0ZShcblx0XHRcdERhdGUubm93KCkgKyA5MCAqIDI0ICogNjAgKiA2MCAqIDEwMDAsXG5cdFx0KS50b0lTT1N0cmluZygpO1xuXG5cdFx0Ly8gVXBkYXRlIGJvdGggam9icyB0YWJsZSBhbmQgam9iX211bHRpX2VudGl0eSB0YWJsZSBpbiBwYXJhbGxlbFxuXHRcdGNvbnN0IHVwZGF0ZXMgPSBhd2FpdCBQcm9taXNlLmFsbChbXG5cdFx0XHQvLyBVcGRhdGUgY29yZSBqb2JzIHRhYmxlIHdpdGggYXJjaGl2ZSBtZXRhZGF0YVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRcdGRlbGV0ZWRfYXQ6IG5vdyxcblx0XHRcdFx0XHRhcmNoaXZlZF9hdDogbm93LFxuXHRcdFx0XHRcdHN0YXR1czogXCJhcmNoaXZlZFwiLFxuXHRcdFx0XHR9KVxuXHRcdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCksXG5cblx0XHRcdC8vIFVwZGF0ZSBqb2JfbXVsdGlfZW50aXR5IHRhYmxlIHdpdGggZGVsZXRpb24gdHJhY2tpbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX211bHRpX2VudGl0eVwiKVxuXHRcdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0XHRkZWxldGVkX2J5OiB1c2VyLmlkLFxuXHRcdFx0XHRcdHBlcm1hbmVudF9kZWxldGVfc2NoZWR1bGVkX2F0OiBzY2hlZHVsZWREZWxldGlvbixcblx0XHRcdFx0fSlcblx0XHRcdFx0LmVxKFwiam9iX2lkXCIsIGpvYklkKSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gZWl0aGVyIHVwZGF0ZVxuXHRcdGNvbnN0IGVycm9ycyA9IHVwZGF0ZXMuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5lcnJvcik7XG5cdFx0aWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImFyY2hpdmUgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9zZXR0aW5ncy9hcmNoaXZlXCIpO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBSZXN0b3JlIGFyY2hpdmVkIGpvYlxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IGNsZWFycyBqb2JfbXVsdGlfZW50aXR5LmRlbGV0ZWRfYnkgYW5kIHBlcm1hbmVudF9kZWxldGVfc2NoZWR1bGVkX2F0XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlc3RvcmVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHZvaWQ+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Y29uc3QgeyBkYXRhOiB0ZWFtTWVtYmVyIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjb21wYW55X21lbWJlcnNoaXBzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWFtTWVtYmVyPy5jb21wYW55X2lkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnkgYW5kIGlzIGFyY2hpdmVkXG5cdFx0Y29uc3QgeyBkYXRhOiBqb2IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkLCBkZWxldGVkX2F0LCBzdGF0dXNcIilcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0YXNzZXJ0RXhpc3RzKGpvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoam9iLmNvbXBhbnlfaWQgIT09IHRlYW1NZW1iZXIuY29tcGFueV9pZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmICgham9iLmRlbGV0ZWRfYXQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgaXMgbm90IGFyY2hpdmVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmVzdG9yZSBqb2IgLSB1cGRhdGUgYm90aCB0YWJsZXMgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0Ly8gQ2xlYXIgY29yZSBqb2JzIHRhYmxlIGFyY2hpdmUgbWV0YWRhdGFcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0XHRkZWxldGVkX2F0OiBudWxsLFxuXHRcdFx0XHRcdGFyY2hpdmVkX2F0OiBudWxsLFxuXHRcdFx0XHRcdHN0YXR1czogam9iLnN0YXR1cyA9PT0gXCJhcmNoaXZlZFwiID8gXCJzY2hlZHVsZWRcIiA6IGpvYi5zdGF0dXMsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5lcShcImlkXCIsIGpvYklkKSxcblxuXHRcdFx0Ly8gQ2xlYXIgam9iX211bHRpX2VudGl0eSB0YWJsZSBkZWxldGlvbiB0cmFja2luZ1xuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfbXVsdGlfZW50aXR5XCIpXG5cdFx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRcdGRlbGV0ZWRfYnk6IG51bGwsXG5cdFx0XHRcdFx0cGVybWFuZW50X2RlbGV0ZV9zY2hlZHVsZWRfYXQ6IG51bGwsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5lcShcImpvYl9pZFwiLCBqb2JJZCksXG5cdFx0XSk7XG5cblx0XHQvLyBDaGVjayBmb3IgZXJyb3JzIGluIGVpdGhlciB1cGRhdGVcblx0XHRjb25zdCBlcnJvcnMgPSB1cGRhdGVzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuZXJyb3IpO1xuXHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJyZXN0b3JlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9zY2hlZHVsZVwiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvc2V0dGluZ3MvYXJjaGl2ZVwiKTtcblx0fSk7XG59XG5cbi8qKlxuICogUmVtb3ZlIHRlYW0gYXNzaWdubWVudCBmcm9tIGpvYlxuICog4pyFIE5PIENIQU5HRVMgTkVFREVEIC0gT25seSBkZWxldGVzIGZyb20gam9iX3RlYW1fYXNzaWdubWVudHMganVuY3Rpb24gdGFibGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVtb3ZlVGVhbUFzc2lnbm1lbnQoXG5cdGFzc2lnbm1lbnRJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IHRoZSBqdW5jdGlvbiByZWNvcmQgdG8gZmluZCBqb2JfaWQgZm9yIHJldmFsaWRhdGlvblxuXHRcdGNvbnN0IHsgZGF0YTogcmVjb3JkLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9iX3RlYW1fYXNzaWdubWVudHNcIilcblx0XHRcdC5zZWxlY3QoXCJpZCwgam9iX2lkLCBjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBhc3NpZ25tZW50SWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoZmV0Y2hFcnJvciB8fCAhcmVjb3JkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiVGVhbSBhc3NpZ25tZW50IG5vdCBmb3VuZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9SRUNPUkRfTk9UX0ZPVU5ELFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAocmVjb3JkLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJ0ZWFtIGFzc2lnbm1lbnRcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGpvYklkID0gcmVjb3JkLmpvYl9pZDtcblxuXHRcdC8vIERlbGV0ZSBqdW5jdGlvbiB0YWJsZSByb3dcblx0XHRjb25zdCB7IGVycm9yOiBkZWxldGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9iX3RlYW1fYXNzaWdubWVudHNcIilcblx0XHRcdC5kZWxldGUoKVxuXHRcdFx0LmVxKFwiaWRcIiwgYXNzaWdubWVudElkKTtcblxuXHRcdGlmIChkZWxldGVFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJyZW1vdmUgdGVhbSBhc3NpZ25tZW50IGZyb20gam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmV2YWxpZGF0ZSBqb2IgcGFnZSBhbmQgc2NoZWR1bGVcblx0XHRpZiAoam9iSWQpIHtcblx0XHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0XHR9XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBBc3NpZ24gQ3VzdG9tZXIgYW5kIFByb3BlcnR5IHRvIEpvYlxuICpcbiAqIFVwZGF0ZXMgdGhlIGpvYidzIGN1c3RvbWVyX2lkIGFuZCBwcm9wZXJ0eV9pZC5cbiAqIE9ubHkgb25lIGN1c3RvbWVyIGFuZCBwcm9wZXJ0eSBjYW4gYmUgYXNzaWduZWQgcGVyIGpvYi5cbiAqXG4gKiBAcGFyYW0gam9iSWQgLSBKb2IgSURcbiAqIEBwYXJhbSBjdXN0b21lcklkIC0gQ3VzdG9tZXIgSUQgdG8gYXNzaWduXG4gKiBAcGFyYW0gcHJvcGVydHlJZCAtIFByb3BlcnR5IElEIHRvIGFzc2lnbiAob3B0aW9uYWwpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhc3NpZ25DdXN0b21lclRvSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRjdXN0b21lcklkOiBzdHJpbmcsXG5cdHByb3BlcnR5SWQ6IHN0cmluZyB8IG51bGwsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdGNvbnN0IGNvbXBhbnlJZCA9IGF3YWl0IGdldEFjdGl2ZUNvbXBhbnlJZCgpO1xuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImNvbXBhbnkgYWNjZXNzXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGV4aXN0cyBhbmQgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBqb2IsIGVycm9yOiBqb2JFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImlkLCBjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LmlzKFwiZGVsZXRlZF9hdFwiLCBudWxsKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGpvYkVycm9yKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKFwiSm9iIHF1ZXJ5IGVycm9yOlwiLCBqb2JFcnJvcik7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmluZCBqb2I6ICR7am9iRXJyb3IubWVzc2FnZX1gLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdFx0NTAwLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRhc3NlcnRFeGlzdHMoam9iLCBcIkpvYlwiKTtcblxuXHRcdC8vIFZlcmlmeSBjdXN0b21lciBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogY3VzdG9tZXIsIGVycm9yOiBjdXN0b21lckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjdXN0b21lcnNcIilcblx0XHRcdC5zZWxlY3QoXCJpZCwgY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgY3VzdG9tZXJJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LmlzKFwiZGVsZXRlZF9hdFwiLCBudWxsKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGN1c3RvbWVyRXJyb3IpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJDdXN0b21lciBxdWVyeSBlcnJvcjpcIiwgY3VzdG9tZXJFcnJvcik7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmluZCBjdXN0b21lcjogJHtjdXN0b21lckVycm9yLm1lc3NhZ2V9YCxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHRcdDUwMCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0YXNzZXJ0RXhpc3RzKGN1c3RvbWVyLCBcIkN1c3RvbWVyXCIpO1xuXG5cdFx0Ly8gSWYgcHJvcGVydHkgaXMgcHJvdmlkZWQsIHZlcmlmeSBpdCBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY3VzdG9tZXJcblx0XHRpZiAocHJvcGVydHlJZCkge1xuXHRcdFx0Y29uc3QgeyBkYXRhOiBwcm9wZXJ0eSB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJwcm9wZXJ0aWVzXCIpXG5cdFx0XHRcdC5zZWxlY3QoXCJpZCwgY3VzdG9tZXJfaWRcIilcblx0XHRcdFx0LmVxKFwiaWRcIiwgcHJvcGVydHlJZClcblx0XHRcdFx0LmVxKFwiY3VzdG9tZXJfaWRcIiwgY3VzdG9tZXJJZClcblx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRpZiAoIXByb3BlcnR5KSB7XG5cdFx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XHRcIlByb3BlcnR5IG5vdCBmb3VuZCBvciBkb2VzIG5vdCBiZWxvbmcgdG8gdGhpcyBjdXN0b21lclwiLFxuXHRcdFx0XHRcdEVSUk9SX0NPREVTLkRCX1JFQ09SRF9OT1RfRk9VTkQsXG5cdFx0XHRcdFx0NDA0LFxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBqb2Igd2l0aCBjdXN0b21lciBhbmQgcHJvcGVydHlcblx0XHRjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnVwZGF0ZSh7XG5cdFx0XHRcdGN1c3RvbWVyX2lkOiBjdXN0b21lcklkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogcHJvcGVydHlJZCxcblx0XHRcdH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiYXNzaWduIGN1c3RvbWVyIHRvIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyBhY3Rpdml0eVxuXHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JfYWN0aXZpdHlfbG9nXCIpLmluc2VydCh7XG5cdFx0XHRqb2JfaWQ6IGpvYklkLFxuXHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0dXNlcl9pZDogdXNlci5pZCxcblx0XHRcdGFjdGl2aXR5X3R5cGU6IFwiYXNzaWduZWRcIixcblx0XHRcdGVudGl0eV90eXBlOiBcImN1c3RvbWVyXCIsXG5cdFx0XHRkZXNjcmlwdGlvbjogYEFzc2lnbmVkIGN1c3RvbWVyJHtwcm9wZXJ0eUlkID8gXCIgYW5kIHByb3BlcnR5XCIgOiBcIlwifWAsXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IHByb3BlcnR5SWQsXG5cdFx0XHR9LFxuXHRcdH0pO1xuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL3dlbGNvbWVcIik7XG5cdH0pO1xufVxuXG4vKipcbiAqIFJlbW92ZSBDdXN0b21lciBhbmQgUHJvcGVydHkgZnJvbSBKb2JcbiAqXG4gKiBSZW1vdmVzIHRoZSBjdXN0b21lcl9pZCBhbmQgcHJvcGVydHlfaWQgZnJvbSB0aGUgam9iLlxuICogUmVsYXRlZCBkYXRhIChhcHBvaW50bWVudHMsIGludm9pY2VzLCBldGMuKSByZW1haW4gYnV0IGFyZSBubyBsb25nZXIgbGlua2VkLlxuICpcbiAqIEBwYXJhbSBqb2JJZCAtIEpvYiBJRFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVtb3ZlQ3VzdG9tZXJGcm9tSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJjb21wYW55IGFjY2Vzc1wiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogam9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiaWQsIGNvbXBhbnlfaWQsIGN1c3RvbWVyX2lkLCBwcm9wZXJ0eV9pZFwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuZXEoXCJjb21wYW55X2lkXCIsIGNvbXBhbnlJZClcblx0XHRcdC5pcyhcImRlbGV0ZWRfYXRcIiwgbnVsbClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0Ly8gVXBkYXRlIGpvYiB0byByZW1vdmUgY3VzdG9tZXIgYW5kIHByb3BlcnR5XG5cdFx0Y29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRjdXN0b21lcl9pZDogbnVsbCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IG51bGwsXG5cdFx0XHR9KVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpO1xuXG5cdFx0aWYgKHVwZGF0ZUVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcInJlbW92ZSBjdXN0b21lciBmcm9tIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyBhY3Rpdml0eVxuXHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JfYWN0aXZpdHlfbG9nXCIpLmluc2VydCh7XG5cdFx0XHRqb2JfaWQ6IGpvYklkLFxuXHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0dXNlcl9pZDogdXNlci5pZCxcblx0XHRcdGFjdGl2aXR5X3R5cGU6IFwicmVtb3ZlZFwiLFxuXHRcdFx0ZW50aXR5X3R5cGU6IFwiY3VzdG9tZXJcIixcblx0XHRcdGRlc2NyaXB0aW9uOiBcIlJlbW92ZWQgY3VzdG9tZXIgYW5kIHByb3BlcnR5XCIsXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRwcmV2aW91c19jdXN0b21lcl9pZDogam9iLmN1c3RvbWVyX2lkLFxuXHRcdFx0XHRwcmV2aW91c19wcm9wZXJ0eV9pZDogam9iLnByb3BlcnR5X2lkLFxuXHRcdFx0fSxcblx0XHR9KTtcblxuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi93ZWxjb21lXCIpO1xuXHR9KTtcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiZ1NBb25Ec0IifQ==
}),
"[project]/apps/web/src/actions/data:2308a3 [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"700c33e2179a29b5fa66bde31d974a535701ff4e1d":"assignCustomerToJob"},"apps/web/src/actions/jobs.ts",""] */ __turbopack_context__.s([
    "assignCustomerToJob",
    ()=>assignCustomerToJob
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next@16.0.4_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
"use turbopack no side effects";
;
var assignCustomerToJob = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("700c33e2179a29b5fa66bde31d974a535701ff4e1d", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "assignCustomerToJob"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vam9icy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEpvYnMgU2VydmVyIEFjdGlvbnMgLSBSRUZBQ1RPUkVEIEZPUiBET01BSU4gVEFCTEUgU1RSVUNUVVJFXG4gKlxuICogSGFuZGxlcyBqb2Ivd29yayBvcmRlciBtYW5hZ2VtZW50IHdpdGggY29tcHJlaGVuc2l2ZSBDUlVEIG9wZXJhdGlvbnMsXG4gKiBzdGF0dXMgdHJhbnNpdGlvbnMsIHNjaGVkdWxpbmcsIGFuZCBhc3NpZ25tZW50IGxvZ2ljLlxuICpcbiAqIE1JR1JBVElPTiBOT1RFUzpcbiAqIC0gQ29yZSBqb2JzIHRhYmxlIG5vdyBoYXMgfjIwIGNvbHVtbnNcbiAqIC0gRG9tYWluLXNwZWNpZmljIGRhdGEgbW92ZWQgdG8gMTEgZG9tYWluIHRhYmxlc1xuICogLSBGaW5hbmNpYWwgZGF0YSAtPiBqb2JfZmluYW5jaWFsXG4gKiAtIFRpbWUgdHJhY2tpbmcgLT4gam9iX3RpbWVfdHJhY2tpbmdcbiAqIC0gQXJjaGl2ZS9kZWxldGlvbiAtPiBqb2JfbXVsdGlfZW50aXR5XG4gKiAtIEFsbCBkb21haW4gdGFibGVzIGhhdmUgQ0FTQ0FERSBkZWxldGUgb24gam9iX2lkXG4gKi9cblxuXCJ1c2Ugc2VydmVyXCI7XG5cbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5pbXBvcnQgeyBnZXRBY3RpdmVDb21wYW55SWQgfSBmcm9tIFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIjtcbmltcG9ydCB7XG5cdEFjdGlvbkVycm9yLFxuXHRFUlJPUl9DT0RFUyxcblx0RVJST1JfTUVTU0FHRVMsXG59IGZyb20gXCJAL2xpYi9lcnJvcnMvYWN0aW9uLWVycm9yXCI7XG5pbXBvcnQge1xuXHR0eXBlIEFjdGlvblJlc3VsdCxcblx0YXNzZXJ0QXV0aGVudGljYXRlZCxcblx0YXNzZXJ0RXhpc3RzLFxuXHR3aXRoRXJyb3JIYW5kbGluZyxcbn0gZnJvbSBcIkAvbGliL2Vycm9ycy93aXRoLWVycm9yLWhhbmRsaW5nXCI7XG5pbXBvcnQgeyBub3RpZnlKb2JDcmVhdGVkIH0gZnJvbSBcIkAvbGliL25vdGlmaWNhdGlvbnMvdHJpZ2dlcnNcIjtcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAL2xpYi9zdXBhYmFzZS9zZXJ2ZXJcIjtcbmltcG9ydCB7XG5cdHR5cGUgSm9iU3RhdHVzLFxuXHR0eXBlIEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0LFxuXHR2YWxpZGF0ZVN0YXR1c1RyYW5zaXRpb24sXG59IGZyb20gXCJAL2xpYi92YWxpZGF0aW9ucy9qb2Itc3RhdHVzLXRyYW5zaXRpb25zXCI7XG5cbi8vIFJlZ2V4IGNvbnN0YW50c1xuY29uc3QgSk9CX05VTUJFUl9SRUdFWCA9IC9KT0ItXFxkezR9LShcXGQrKS87XG5cbi8vIFZhbGlkYXRpb24gU2NoZW1hc1xuY29uc3QgY3JlYXRlSm9iU2NoZW1hID0gei5vYmplY3Qoe1xuXHRwcm9wZXJ0eUlkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIHByb3BlcnR5IElEXCIpLFxuXHRjdXN0b21lcklkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIGN1c3RvbWVyIElEXCIpLm9wdGlvbmFsKCksXG5cdHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCBcIkpvYiB0aXRsZSBpcyByZXF1aXJlZFwiKSxcblx0ZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblx0cHJpb3JpdHk6IHouZW51bShbXCJsb3dcIiwgXCJtZWRpdW1cIiwgXCJoaWdoXCIsIFwidXJnZW50XCJdKS5kZWZhdWx0KFwibWVkaXVtXCIpLFxuXHRqb2JUeXBlOiB6XG5cdFx0LmVudW0oW1xuXHRcdFx0XCJzZXJ2aWNlXCIsXG5cdFx0XHRcImluc3RhbGxhdGlvblwiLFxuXHRcdFx0XCJyZXBhaXJcIixcblx0XHRcdFwibWFpbnRlbmFuY2VcIixcblx0XHRcdFwiaW5zcGVjdGlvblwiLFxuXHRcdFx0XCJjb25zdWx0YXRpb25cIixcblx0XHRdKVxuXHRcdC5vcHRpb25hbCgpLFxuXHRzY2hlZHVsZWRTdGFydDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRzY2hlZHVsZWRFbmQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblx0YXNzaWduZWRUbzogei5zdHJpbmcoKS51dWlkKFwiSW52YWxpZCB1c2VyIElEXCIpLm9wdGlvbmFsKCksXG5cdG5vdGVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdC8vIEVuaGFuY2VkIHNjaGVkdWxpbmcgZmllbGRzXG5cdGlzUmVjdXJyaW5nOiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuXHRzY2hlZHVsaW5nTW9kZTogei5lbnVtKFtcInNwZWNpZmljXCIsIFwid2luZG93XCJdKS5vcHRpb25hbCgpLFxuXHR0aW1lV2luZG93OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VUeXBlOiB6XG5cdFx0LmVudW0oW1wiZGFpbHlcIiwgXCJ3ZWVrbHlcIiwgXCJiaXdlZWtseVwiLCBcIm1vbnRobHlcIiwgXCJxdWFydGVybHlcIiwgXCJ5ZWFybHlcIl0pXG5cdFx0Lm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VFbmREYXRlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VDb3VudDogei5udW1iZXIoKS5pbnQoKS5taW4oMSkubWF4KDM2NSkub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCB1cGRhdGVKb2JTY2hlbWEgPSB6Lm9iamVjdCh7XG5cdHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCBcIkpvYiB0aXRsZSBpcyByZXF1aXJlZFwiKS5vcHRpb25hbCgpLFxuXHRkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRzdGF0dXM6IHpcblx0XHQuZW51bShbXG5cdFx0XHRcInF1b3RlZFwiLFxuXHRcdFx0XCJzY2hlZHVsZWRcIixcblx0XHRcdFwiaW5fcHJvZ3Jlc3NcIixcblx0XHRcdFwib25faG9sZFwiLFxuXHRcdFx0XCJjb21wbGV0ZWRcIixcblx0XHRcdFwiY2FuY2VsbGVkXCIsXG5cdFx0XHRcImludm9pY2VkXCIsXG5cdFx0XHRcInBhaWRcIixcblx0XHRdKVxuXHRcdC5vcHRpb25hbCgpLFxuXHRwcmlvcml0eTogei5lbnVtKFtcImxvd1wiLCBcIm1lZGl1bVwiLCBcImhpZ2hcIiwgXCJ1cmdlbnRcIl0pLm9wdGlvbmFsKCksXG5cdGpvYlR5cGU6IHpcblx0XHQuZW51bShbXG5cdFx0XHRcInNlcnZpY2VcIixcblx0XHRcdFwiaW5zdGFsbGF0aW9uXCIsXG5cdFx0XHRcInJlcGFpclwiLFxuXHRcdFx0XCJtYWludGVuYW5jZVwiLFxuXHRcdFx0XCJpbnNwZWN0aW9uXCIsXG5cdFx0XHRcImNvbnN1bHRhdGlvblwiLFxuXHRcdF0pXG5cdFx0Lm9wdGlvbmFsKCksXG5cdG5vdGVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdC8vIEZpbmFuY2lhbCBmaWVsZHMgKG5vdyBpbiBqb2JfZmluYW5jaWFsIGRvbWFpbiB0YWJsZSlcblx0dG90YWxBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdHBhaWRBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdGRlcG9zaXRBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdHNjaGVkdWxlZFN0YXJ0OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHNjaGVkdWxlZEVuZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRhc3NpZ25lZFRvOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIHVzZXIgSURcIikub3B0aW9uYWwoKS5udWxsYWJsZSgpLFxuXHRjdXN0b21lcklkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIGN1c3RvbWVyIElEXCIpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcblx0cHJvcGVydHlJZDogei5zdHJpbmcoKS51dWlkKFwiSW52YWxpZCBwcm9wZXJ0eSBJRFwiKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG59KTtcblxuLy8gVHlwZSBmb3IgdXBkYXRlSm9iRGF0YSAtIG1ha2VzIGl0IGVhc2llciB0byB1c2UgcHJvZ3JhbW1hdGljYWxseVxuZXhwb3J0IHR5cGUgVXBkYXRlSm9iRGF0YSA9IHouaW5mZXI8dHlwZW9mIHVwZGF0ZUpvYlNjaGVtYT47XG5cbmNvbnN0IHNjaGVkdWxlSm9iU2NoZW1hID0gei5vYmplY3Qoe1xuXHRzY2hlZHVsZWRTdGFydDogei5zdHJpbmcoKSxcblx0c2NoZWR1bGVkRW5kOiB6LnN0cmluZygpLFxufSk7XG5cbi8qKlxuICogR2VuZXJhdGUgdW5pcXVlIGpvYiBudW1iZXJcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVKb2JOdW1iZXIoXG5cdHN1cGFiYXNlOiBhbnksXG5cdGNvbXBhbnlJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxzdHJpbmc+IHtcblx0Ly8gR2V0IHRoZSBsYXRlc3Qgam9iIG51bWJlciBmb3IgdGhpcyBjb21wYW55XG5cdGNvbnN0IHsgZGF0YTogbGF0ZXN0Sm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdC5zZWxlY3QoXCJqb2JfbnVtYmVyXCIpXG5cdFx0LmVxKFwiY29tcGFueV9pZFwiLCBjb21wYW55SWQpXG5cdFx0Lm9yZGVyKFwiY3JlYXRlZF9hdFwiLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcblx0XHQubGltaXQoMSlcblx0XHQuc2luZ2xlKCk7XG5cblx0aWYgKCFsYXRlc3RKb2IpIHtcblx0XHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tMDAxYDtcblx0fVxuXG5cdC8vIEV4dHJhY3QgbnVtYmVyIGZyb20gZm9ybWF0OiBKT0ItWVlZWS1OTk5cblx0Y29uc3QgbWF0Y2ggPSBsYXRlc3RKb2Iuam9iX251bWJlci5tYXRjaChKT0JfTlVNQkVSX1JFR0VYKTtcblx0aWYgKG1hdGNoKSB7XG5cdFx0Y29uc3QgbmV4dE51bWJlciA9IE51bWJlci5wYXJzZUludChtYXRjaFsxXSwgMTApICsgMTtcblx0XHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tJHtuZXh0TnVtYmVyLnRvU3RyaW5nKCkucGFkU3RhcnQoMywgXCIwXCIpfWA7XG5cdH1cblxuXHQvLyBGYWxsYmFja1xuXHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tJHtEYXRlLm5vdygpLnRvU3RyaW5nKCkuc2xpY2UoLTMpfWA7XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIG5leHQgcmVjdXJyZW5jZSBkYXRlXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZU5leHRSZWN1cnJlbmNlKFxuXHRjdXJyZW50RGF0ZTogRGF0ZSxcblx0cmVjdXJyZW5jZVR5cGU6IHN0cmluZyxcbik6IERhdGUge1xuXHRjb25zdCBuZXh0RGF0ZSA9IG5ldyBEYXRlKGN1cnJlbnREYXRlKTtcblxuXHRzd2l0Y2ggKHJlY3VycmVuY2VUeXBlKSB7XG5cdFx0Y2FzZSBcImRhaWx5XCI6XG5cdFx0XHRuZXh0RGF0ZS5zZXREYXRlKG5leHREYXRlLmdldERhdGUoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcIndlZWtseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RGF0ZShuZXh0RGF0ZS5nZXREYXRlKCkgKyA3KTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgXCJiaXdlZWtseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RGF0ZShuZXh0RGF0ZS5nZXREYXRlKCkgKyAxNCk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlIFwibW9udGhseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0TW9udGgobmV4dERhdGUuZ2V0TW9udGgoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcInF1YXJ0ZXJseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0TW9udGgobmV4dERhdGUuZ2V0TW9udGgoKSArIDMpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcInllYXJseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RnVsbFllYXIobmV4dERhdGUuZ2V0RnVsbFllYXIoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0ZGVmYXVsdDpcblx0XHRcdC8vIERlZmF1bHQgdG8gbW9udGhseSBpZiB1bmtub3duIHR5cGVcblx0XHRcdG5leHREYXRlLnNldE1vbnRoKG5leHREYXRlLmdldE1vbnRoKCkgKyAxKTtcblx0XHRcdGJyZWFrO1xuXHR9XG5cblx0cmV0dXJuIG5leHREYXRlO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZWN1cnJpbmcgam9ic1xuICovXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVSZWN1cnJpbmdKb2JzKFxuXHRzdXBhYmFzZTogYW55LFxuXHRjb21wYW55SWQ6IHN0cmluZyxcblx0YmFzZUpvYjogYW55LFxuXHRyZWN1cnJlbmNlVHlwZTogc3RyaW5nLFxuXHRyZWN1cnJlbmNlRW5kRGF0ZT86IHN0cmluZyxcblx0cmVjdXJyZW5jZUNvdW50PzogbnVtYmVyLFxuKTogUHJvbWlzZTx2b2lkPiB7XG5cdGlmICghYmFzZUpvYi5zY2hlZHVsZWRfc3RhcnQpIHtcblx0XHRyZXR1cm47IC8vIENhbid0IGNyZWF0ZSByZWN1cnJpbmcgam9icyB3aXRob3V0IGEgc3RhcnQgZGF0ZVxuXHR9XG5cblx0Y29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoYmFzZUpvYi5zY2hlZHVsZWRfc3RhcnQpO1xuXHRjb25zdCBlbmREYXRlID0gbmV3IERhdGUoYmFzZUpvYi5zY2hlZHVsZWRfZW5kIHx8IGJhc2VKb2Iuc2NoZWR1bGVkX3N0YXJ0KTtcblx0Y29uc3QgZHVyYXRpb24gPSBlbmREYXRlLmdldFRpbWUoKSAtIHN0YXJ0RGF0ZS5nZXRUaW1lKCk7XG5cblx0Ly8gRGV0ZXJtaW5lIGhvdyBtYW55IG9jY3VycmVuY2VzIHRvIGNyZWF0ZVxuXHRjb25zdCBtYXhPY2N1cnJlbmNlcyA9IHJlY3VycmVuY2VDb3VudCB8fCA1MjsgLy8gRGVmYXVsdCB0byAxIHllYXIgb2Ygd2Vla2x5IGpvYnNcblx0Y29uc3QgZW5kRGF0ZUxpbWl0ID0gcmVjdXJyZW5jZUVuZERhdGUgPyBuZXcgRGF0ZShyZWN1cnJlbmNlRW5kRGF0ZSkgOiBudWxsO1xuXG5cdGNvbnN0IHJlY3VycmluZ0pvYnM6ICh0eXBlb2YgYmFzZUpvYilbXSA9IFtdO1xuXHRsZXQgY3VycmVudERhdGUgPSBuZXcgRGF0ZShzdGFydERhdGUpO1xuXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgbWF4T2NjdXJyZW5jZXMgLSAxOyBpKyspIHtcblx0XHQvLyAtMSBiZWNhdXNlIHdlIGFscmVhZHkgY3JlYXRlZCB0aGUgZmlyc3Qgam9iXG5cdFx0Y3VycmVudERhdGUgPSBjYWxjdWxhdGVOZXh0UmVjdXJyZW5jZShjdXJyZW50RGF0ZSwgcmVjdXJyZW5jZVR5cGUpO1xuXG5cdFx0Ly8gU3RvcCBpZiB3ZSd2ZSByZWFjaGVkIHRoZSBlbmQgZGF0ZVxuXHRcdGlmIChlbmREYXRlTGltaXQgJiYgY3VycmVudERhdGUgPiBlbmREYXRlTGltaXQpIHtcblx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdGNvbnN0IGN1cnJlbnRFbmREYXRlID0gbmV3IERhdGUoY3VycmVudERhdGUuZ2V0VGltZSgpICsgZHVyYXRpb24pO1xuXG5cdFx0Ly8gR2VuZXJhdGUgYSB1bmlxdWUgam9iIG51bWJlciBmb3IgdGhpcyBvY2N1cnJlbmNlXG5cdFx0Y29uc3Qgam9iTnVtYmVyID0gYXdhaXQgZ2VuZXJhdGVKb2JOdW1iZXIoc3VwYWJhc2UsIGNvbXBhbnlJZCk7XG5cblx0XHRyZWN1cnJpbmdKb2JzLnB1c2goe1xuXHRcdFx0Li4uYmFzZUpvYixcblx0XHRcdGpvYl9udW1iZXI6IGpvYk51bWJlcixcblx0XHRcdHNjaGVkdWxlZF9zdGFydDogY3VycmVudERhdGUudG9JU09TdHJpbmcoKSxcblx0XHRcdHNjaGVkdWxlZF9lbmQ6IGN1cnJlbnRFbmREYXRlLnRvSVNPU3RyaW5nKCksXG5cdFx0XHR0aXRsZTogYCR7YmFzZUpvYi50aXRsZX0gKCR7aSArIDJ9LyR7bWF4T2NjdXJyZW5jZXN9KWAsIC8vIEFkZCBvY2N1cnJlbmNlIG51bWJlclxuXHRcdH0pO1xuXG5cdFx0Ly8gQ3JlYXRlIGpvYnMgaW4gYmF0Y2hlcyBvZiAxMCB0byBhdm9pZCBtZW1vcnkgaXNzdWVzXG5cdFx0aWYgKHJlY3VycmluZ0pvYnMubGVuZ3RoID49IDEwKSB7XG5cdFx0XHRhd2FpdCBzdXBhYmFzZS5mcm9tKFwiam9ic1wiKS5pbnNlcnQocmVjdXJyaW5nSm9icyk7XG5cdFx0XHRyZWN1cnJpbmdKb2JzLmxlbmd0aCA9IDA7IC8vIENsZWFyIGFycmF5XG5cdFx0fVxuXHR9XG5cblx0Ly8gSW5zZXJ0IGFueSByZW1haW5pbmcgam9ic1xuXHRpZiAocmVjdXJyaW5nSm9icy5sZW5ndGggPiAwKSB7XG5cdFx0YXdhaXQgc3VwYWJhc2UuZnJvbShcImpvYnNcIikuaW5zZXJ0KHJlY3VycmluZ0pvYnMpO1xuXHR9XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgbmV3IGpvYlxuICog4pyFIEFMUkVBRFkgTUlHUkFURUQgLSBDcmVhdGVzIGNvcmUgam9iICsgYWxsIDEwIGRvbWFpbiByZWNvcmRzIGluIHBhcmFsbGVsXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVKb2IoXG5cdGZvcm1EYXRhOiBGb3JtRGF0YSxcbik6IFByb21pc2U8QWN0aW9uUmVzdWx0PHN0cmluZz4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSBjcmVhdGVKb2JTY2hlbWEucGFyc2Uoe1xuXHRcdFx0cHJvcGVydHlJZDogZm9ybURhdGEuZ2V0KFwicHJvcGVydHlJZFwiKSxcblx0XHRcdGN1c3RvbWVySWQ6IGZvcm1EYXRhLmdldChcImN1c3RvbWVySWRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0dGl0bGU6IGZvcm1EYXRhLmdldChcInRpdGxlXCIpLFxuXHRcdFx0ZGVzY3JpcHRpb246IGZvcm1EYXRhLmdldChcImRlc2NyaXB0aW9uXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdHByaW9yaXR5OiBmb3JtRGF0YS5nZXQoXCJwcmlvcml0eVwiKSB8fCBcIm1lZGl1bVwiLFxuXHRcdFx0am9iVHlwZTogZm9ybURhdGEuZ2V0KFwiam9iVHlwZVwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRzY2hlZHVsZWRTdGFydDogZm9ybURhdGEuZ2V0KFwic2NoZWR1bGVkU3RhcnRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0c2NoZWR1bGVkRW5kOiBmb3JtRGF0YS5nZXQoXCJzY2hlZHVsZWRFbmRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0YXNzaWduZWRUbzogZm9ybURhdGEuZ2V0KFwiYXNzaWduZWRUb1wiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRub3RlczogZm9ybURhdGEuZ2V0KFwibm90ZXNcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0Ly8gRW5oYW5jZWQgc2NoZWR1bGluZyBmaWVsZHNcblx0XHRcdGlzUmVjdXJyaW5nOiBmb3JtRGF0YS5nZXQoXCJpc1JlY3VycmluZ1wiKSA9PT0gXCJ0cnVlXCIsXG5cdFx0XHRzY2hlZHVsaW5nTW9kZTogKGZvcm1EYXRhLmdldChcInNjaGVkdWxpbmdNb2RlXCIpIGFzIGFueSkgfHwgdW5kZWZpbmVkLFxuXHRcdFx0dGltZVdpbmRvdzogZm9ybURhdGEuZ2V0KFwidGltZVdpbmRvd1wiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRyZWN1cnJlbmNlVHlwZTogKGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VUeXBlXCIpIGFzIGFueSkgfHwgdW5kZWZpbmVkLFxuXHRcdFx0cmVjdXJyZW5jZUVuZERhdGU6IGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VFbmREYXRlXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdHJlY3VycmVuY2VDb3VudDogZm9ybURhdGEuZ2V0KFwicmVjdXJyZW5jZUNvdW50XCIpXG5cdFx0XHRcdD8gTnVtYmVyLnBhcnNlSW50KGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VDb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHR9KTtcblxuXHRcdC8vIFZlcmlmeSBwcm9wZXJ0eSBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IHByb3BlcnR5IH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJwcm9wZXJ0aWVzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgY3VzdG9tZXJfaWQsIGFkZHJlc3NcIilcblx0XHRcdC5lcShcImlkXCIsIGRhdGEucHJvcGVydHlJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhwcm9wZXJ0eSwgXCJQcm9wZXJ0eVwiKTtcblxuXHRcdGlmIChwcm9wZXJ0eS5jb21wYW55X2lkICE9PSBjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwicHJvcGVydHlcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVzZSBjdXN0b21lciBmcm9tIHByb3BlcnR5IGlmIG5vdCBwcm92aWRlZFxuXHRcdGNvbnN0IGN1c3RvbWVySWQgPSBkYXRhLmN1c3RvbWVySWQgfHwgcHJvcGVydHkuY3VzdG9tZXJfaWQ7XG5cblx0XHQvLyBHZW5lcmF0ZSB1bmlxdWUgam9iIG51bWJlclxuXHRcdGNvbnN0IGpvYk51bWJlciA9IGF3YWl0IGdlbmVyYXRlSm9iTnVtYmVyKHN1cGFiYXNlLCBjb21wYW55SWQpO1xuXG5cdFx0Ly8gQWRkIHRpbWUgd2luZG93IGluZm8gdG8gbm90ZXMgaWYgYXBwbGljYWJsZVxuXHRcdGxldCBqb2JOb3RlcyA9IGRhdGEubm90ZXMgfHwgXCJcIjtcblx0XHRpZiAoZGF0YS5zY2hlZHVsaW5nTW9kZSA9PT0gXCJ3aW5kb3dcIiAmJiBkYXRhLnRpbWVXaW5kb3cpIHtcblx0XHRcdGNvbnN0IHdpbmRvd0luZm8gPSBgXFxuXFxuW1NjaGVkdWxpbmddIEN1c3RvbWVyIHByZWZlcnJlZCB0aW1lIHdpbmRvdzogJHtkYXRhLnRpbWVXaW5kb3cuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBkYXRhLnRpbWVXaW5kb3cuc2xpY2UoMSl9YDtcblx0XHRcdGpvYk5vdGVzID0gam9iTm90ZXMgPyBgJHtqb2JOb3Rlc30ke3dpbmRvd0luZm99YCA6IHdpbmRvd0luZm8udHJpbSgpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBjb3JlIGpvYiByZWNvcmRcblx0XHRjb25zdCB7IGRhdGE6IG5ld0pvYiwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogZGF0YS5wcm9wZXJ0eUlkLFxuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0YXNzaWduZWRfdG86IGRhdGEuYXNzaWduZWRUbyxcblx0XHRcdFx0am9iX251bWJlcjogam9iTnVtYmVyLFxuXHRcdFx0XHR0aXRsZTogZGF0YS50aXRsZSxcblx0XHRcdFx0ZGVzY3JpcHRpb246IGRhdGEuZGVzY3JpcHRpb24sXG5cdFx0XHRcdHN0YXR1czogXCJxdW90ZWRcIixcblx0XHRcdFx0cHJpb3JpdHk6IGRhdGEucHJpb3JpdHksXG5cdFx0XHRcdGpvYl90eXBlOiBkYXRhLmpvYlR5cGUsXG5cdFx0XHRcdHNlcnZpY2VfdHlwZTogZGF0YS5qb2JUeXBlLCAvLyBEZWZhdWx0IHNlcnZpY2VfdHlwZSB0byBqb2JfdHlwZVxuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRub3Rlczogam9iTm90ZXMsXG5cdFx0XHR9KVxuXHRcdFx0LnNlbGVjdChcImlkXCIpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoY3JlYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiY3JlYXRlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBkb21haW4gcmVjb3JkcyAocGFyYWxsZWwgaW5zZXJ0cyBmb3IgcGVyZm9ybWFuY2UpXG5cdFx0Y29uc3QgZG9tYWluSW5zZXJ0cyA9IGF3YWl0IFByb21pc2UuYWxsKFtcblx0XHRcdC8vIEZpbmFuY2lhbCBkb21haW4gLSBhbHdheXMgY3JlYXRlIHdpdGggZGVmYXVsdHNcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2ZpbmFuY2lhbFwiKVxuXHRcdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0XHRqb2JfaWQ6IG5ld0pvYi5pZCxcblx0XHRcdFx0XHRjb21wYW55X2lkOiBjb21wYW55SWQsXG5cdFx0XHRcdFx0dG90YWxfYW1vdW50OiAwLFxuXHRcdFx0XHRcdHBhaWRfYW1vdW50OiAwLFxuXHRcdFx0XHRcdGRlcG9zaXRfYW1vdW50OiAwLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gV29ya2Zsb3cgZG9tYWluIC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2Jfd29ya2Zsb3dcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdHdvcmtmbG93X2NvbXBsZXRlZF9zdGFnZXM6IFtdLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gVGltZSB0cmFja2luZyAtIGFsd2F5cyBjcmVhdGVcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX3RpbWVfdHJhY2tpbmdcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdHRvdGFsX2xhYm9yX2hvdXJzOiAwLFxuXHRcdFx0XHRcdGJyZWFrX3RpbWVfbWludXRlczogMCxcblx0XHRcdFx0fSksXG5cblx0XHRcdC8vIEN1c3RvbWVyIGFwcHJvdmFsIC0gYWx3YXlzIGNyZWF0ZSB3aXRoIHBlbmRpbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2N1c3RvbWVyX2FwcHJvdmFsXCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRjdXN0b21lcl9hcHByb3ZhbF9zdGF0dXM6IFwicGVuZGluZ1wiLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gRXF1aXBtZW50IHNlcnZpY2UgLSBhbHdheXMgY3JlYXRlXG5cdFx0XHRzdXBhYmFzZVxuXHRcdFx0XHQuZnJvbShcImpvYl9lcXVpcG1lbnRfc2VydmljZVwiKVxuXHRcdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0XHRqb2JfaWQ6IG5ld0pvYi5pZCxcblx0XHRcdFx0XHRjb21wYW55X2lkOiBjb21wYW55SWQsXG5cdFx0XHRcdFx0ZXF1aXBtZW50X3NlcnZpY2VfaGlzdG9yeTogW10sXG5cdFx0XHRcdFx0ZXF1aXBtZW50X3NlcnZpY2VkOiBbXSxcblx0XHRcdFx0fSksXG5cblx0XHRcdC8vIERpc3BhdGNoIC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfZGlzcGF0Y2hcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gUXVhbGl0eSAtIGFsd2F5cyBjcmVhdGVcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX3F1YWxpdHlcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdGluc3BlY3Rpb25fcmVxdWlyZWQ6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gU2FmZXR5IC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2Jfc2FmZXR5XCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRyZXF1aXJlc19wZXJtaXQ6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gQUkgZW5yaWNobWVudCAtIGNyZWF0ZSBlbXB0eSBmb3IgZnV0dXJlIHByb2Nlc3Npbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2FpX2VucmljaG1lbnRcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gTXVsdGktZW50aXR5IC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfbXVsdGlfZW50aXR5XCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRyZXF1aXJlc19tdWx0aXBsZV9wcm9wZXJ0aWVzOiBmYWxzZSxcblx0XHRcdFx0XHRyZXF1aXJlc19tdWx0aXBsZV9jdXN0b21lcnM6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBhbnkgZG9tYWluIGluc2VydCBlcnJvcnNcblx0XHRjb25zdCBkb21haW5FcnJvcnMgPSBkb21haW5JbnNlcnRzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuZXJyb3IpO1xuXHRcdGlmIChkb21haW5FcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0Ly8gUm9sbGJhY2sgLSBkZWxldGUgdGhlIGpvYiAoQ0FTQ0FERSB3aWxsIGRlbGV0ZSBkb21haW4gcmVjb3Jkcylcblx0XHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JzXCIpLmRlbGV0ZSgpLmVxKFwiaWRcIiwgbmV3Sm9iLmlkKTtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiY3JlYXRlIGpvYiBkb21haW5zXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQ3JlYXRlIHJlY3VycmluZyBqb2JzIGlmIHJlcXVlc3RlZFxuXHRcdGlmIChkYXRhLmlzUmVjdXJyaW5nICYmIGRhdGEucmVjdXJyZW5jZVR5cGUgJiYgZGF0YS5zY2hlZHVsZWRTdGFydCkge1xuXHRcdFx0Y29uc3QgYmFzZUpvYiA9IHtcblx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogZGF0YS5wcm9wZXJ0eUlkLFxuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0YXNzaWduZWRfdG86IGRhdGEuYXNzaWduZWRUbyxcblx0XHRcdFx0dGl0bGU6IGRhdGEudGl0bGUsXG5cdFx0XHRcdGRlc2NyaXB0aW9uOiBkYXRhLmRlc2NyaXB0aW9uLFxuXHRcdFx0XHRzdGF0dXM6IFwicXVvdGVkXCIsXG5cdFx0XHRcdHByaW9yaXR5OiBkYXRhLnByaW9yaXR5LFxuXHRcdFx0XHRqb2JfdHlwZTogZGF0YS5qb2JUeXBlLFxuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRub3RlczogZGF0YS5ub3Rlcyxcblx0XHRcdH07XG5cblx0XHRcdGF3YWl0IGNyZWF0ZVJlY3VycmluZ0pvYnMoXG5cdFx0XHRcdHN1cGFiYXNlLFxuXHRcdFx0XHRjb21wYW55SWQsXG5cdFx0XHRcdGJhc2VKb2IsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZVR5cGUsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZUVuZERhdGUsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZUNvdW50LFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBTZW5kIG5vdGlmaWNhdGlvbiB0byBhc3NpZ25lZCB1c2VyIGlmIGpvYiBpcyBhc3NpZ25lZFxuXHRcdGlmIChkYXRhLmFzc2lnbmVkVG8gJiYgZGF0YS5hc3NpZ25lZFRvICE9PSB1c2VyLmlkKSB7XG5cdFx0XHRhd2FpdCBub3RpZnlKb2JDcmVhdGVkKHtcblx0XHRcdFx0dXNlcklkOiBkYXRhLmFzc2lnbmVkVG8sXG5cdFx0XHRcdGNvbXBhbnlJZDogY29tcGFueUlkLFxuXHRcdFx0XHRqb2JJZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRqb2JUaXRsZTogZGF0YS50aXRsZSxcblx0XHRcdFx0YWRkcmVzczogcHJvcGVydHkuYWRkcmVzcyB8fCBcIlVua25vd24gYWRkcmVzc1wiLFxuXHRcdFx0XHRwcmlvcml0eTpcblx0XHRcdFx0XHRkYXRhLnByaW9yaXR5ID09PSBcInVyZ2VudFwiXG5cdFx0XHRcdFx0XHQ/IFwidXJnZW50XCJcblx0XHRcdFx0XHRcdDogZGF0YS5wcmlvcml0eSA9PT0gXCJoaWdoXCJcblx0XHRcdFx0XHRcdFx0PyBcImhpZ2hcIlxuXHRcdFx0XHRcdFx0XHQ6IFwibWVkaXVtXCIsXG5cdFx0XHRcdGFjdGlvblVybDogXCIvZGFzaGJvYXJkL3dvcmtcIixcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrL2pvYnNcIik7XG5cdFx0cmV0dXJuIG5ld0pvYi5pZDtcblx0fSk7XG59XG5cbi8qKlxuICogR2V0IGEgc2luZ2xlIGpvYiBieSBJRFxuICog4pyFIEFMUkVBRFkgTUlHUkFURUQgLSBGZXRjaGVzIGpvYiB3aXRoIGFsbCBkb21haW4gZGF0YVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueT4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBqb2Igd2l0aCBiYXNpYyByZWxhdGlvbnNoaXBzXG5cdFx0Ly8gU2ltcGxpZmllZCBxdWVyeSAtIG1hbnkgZG9tYWluIHRhYmxlcyBkb24ndCBleGlzdCB5ZXRcblx0XHRjb25zdCB7IGRhdGE6IGpvYiwgZXJyb3I6IGpvYkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRgXG5cdFx0XHRcdCosXG5cdFx0XHRcdHByb3BlcnR5OnByb3BlcnRpZXMoKiksXG5cdFx0XHRcdGN1c3RvbWVyOmN1c3RvbWVycyFjdXN0b21lcl9pZChpZCwgZmlyc3RfbmFtZSwgbGFzdF9uYW1lLCBlbWFpbCwgcGhvbmUsIGRpc3BsYXlfbmFtZSlcblx0XHRcdGAsXG5cdFx0XHQpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGpvYkVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm5vdEZvdW5kKFwiSm9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9SRUNPUkRfTk9UX0ZPVU5ELFxuXHRcdFx0XHQ0MDQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRpZiAoam9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBqb2I7XG5cdH0pO1xufVxuXG4vKipcbiAqIFVwZGF0ZSBqb2IgZGV0YWlsc1xuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgYm90aCBjb3JlIGpvYnMgdGFibGUgYW5kIGRvbWFpbiB0YWJsZXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYihcblx0am9iSWQ6IHN0cmluZyxcblx0Zm9ybURhdGE6IEZvcm1EYXRhLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IGFjdGl2ZSBjb21wYW55IElEXG5cdFx0Y29uc3QgYWN0aXZlQ29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cdFx0aWYgKCFhY3RpdmVDb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgdXNlcidzIHJvbGUgdG8gY2hlY2sgaWYgdGhleSdyZSBhZG1pbi9vd25lclxuXHRcdGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiY29tcGFueV9tZW1iZXJzaGlwc1wiKVxuXHRcdFx0LnNlbGVjdChcblx0XHRcdFx0YFxuICAgICAgICByb2xlX2lkLFxuICAgICAgICBjdXN0b21fcm9sZXMhcm9sZV9pZChuYW1lLCBpc19zeXN0ZW0pXG4gICAgICBgLFxuXHRcdFx0KVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LmVxKFwiY29tcGFueV9pZFwiLCBhY3RpdmVDb21wYW55SWQpXG5cdFx0XHQuZXEoXCJzdGF0dXNcIiwgXCJhY3RpdmVcIilcblx0XHRcdC5tYXliZVNpbmdsZSgpO1xuXG5cdFx0Y29uc3Qgcm9sZSA9IEFycmF5LmlzQXJyYXkodGVhbU1lbWJlcj8uY3VzdG9tX3JvbGVzKVxuXHRcdFx0PyB0ZWFtTWVtYmVyLmN1c3RvbV9yb2xlc1swXVxuXHRcdFx0OiB0ZWFtTWVtYmVyPy5jdXN0b21fcm9sZXM7XG5cblx0XHRjb25zdCBpc0FkbWluT3JPd25lciA9XG5cdFx0XHRyb2xlPy5uYW1lID09PSBcIkFkbWluXCIgfHxcblx0XHRcdHJvbGU/Lm5hbWUgPT09IFwiT3duZXJcIiB8fFxuXHRcdFx0cm9sZT8uaXNfc3lzdGVtID09PSB0cnVlO1xuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhleGlzdGluZ0pvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoZXhpc3RpbmdKb2IuY29tcGFueV9pZCAhPT0gYWN0aXZlQ29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUHJldmVudCBlZGl0aW5nIGNvbXBsZXRlZCBvciBjYW5jZWxsZWQgam9icyAodW5sZXNzIGFkbWluL293bmVyKVxuXHRcdGlmIChcblx0XHRcdCFpc0FkbWluT3JPd25lciAmJlxuXHRcdFx0KGV4aXN0aW5nSm9iLnN0YXR1cyA9PT0gXCJjb21wbGV0ZWRcIiB8fCBleGlzdGluZ0pvYi5zdGF0dXMgPT09IFwiY2FuY2VsbGVkXCIpXG5cdFx0KSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBDYW5ub3QgZWRpdCAke2V4aXN0aW5nSm9iLnN0YXR1c30gam9ic2AsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgY3VzdG9tZXJJZFZhbHVlID0gZm9ybURhdGEuZ2V0KFwiY3VzdG9tZXJJZFwiKTtcblx0XHRjb25zdCBwcm9wZXJ0eUlkVmFsdWUgPSBmb3JtRGF0YS5nZXQoXCJwcm9wZXJ0eUlkXCIpO1xuXG5cdFx0Ly8gSGFuZGxlIGN1c3RvbWVySWQ6IGVtcHR5IHN0cmluZyBvciBcIm51bGxcIiBzdHJpbmcgbWVhbnMgcmVtb3ZlIChzZXQgdG8gbnVsbClcblx0XHQvLyB1bmRlZmluZWQgbWVhbnMgZG9uJ3QgY2hhbmdlIGl0XG5cdFx0bGV0IHBhcnNlZEN1c3RvbWVySWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG5cdFx0aWYgKGN1c3RvbWVySWRWYWx1ZSA9PT0gbnVsbCB8fCBjdXN0b21lcklkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyc2VkQ3VzdG9tZXJJZCA9IHVuZGVmaW5lZDsgLy8gRG9uJ3QgY2hhbmdlXG5cdFx0fSBlbHNlIGlmIChjdXN0b21lcklkVmFsdWUgPT09IFwiXCIgfHwgY3VzdG9tZXJJZFZhbHVlID09PSBcIm51bGxcIikge1xuXHRcdFx0cGFyc2VkQ3VzdG9tZXJJZCA9IG51bGw7IC8vIFJlbW92ZSBjdXN0b21lclxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJzZWRDdXN0b21lcklkID0gY3VzdG9tZXJJZFZhbHVlIGFzIHN0cmluZzsgLy8gU2V0IHRvIHRoaXMgY3VzdG9tZXJcblx0XHR9XG5cblx0XHQvLyBIYW5kbGUgcHJvcGVydHlJZDogZW1wdHkgc3RyaW5nIG1lYW5zIHJlbW92ZSAoc2V0IHRvIG51bGwpLCB1bmRlZmluZWQgbWVhbnMgZG9uJ3QgY2hhbmdlXG5cdFx0bGV0IHBhcnNlZFByb3BlcnR5SWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG5cdFx0aWYgKHByb3BlcnR5SWRWYWx1ZSA9PT0gbnVsbCB8fCBwcm9wZXJ0eUlkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyc2VkUHJvcGVydHlJZCA9IHVuZGVmaW5lZDsgLy8gRG9uJ3QgY2hhbmdlXG5cdFx0fSBlbHNlIGlmIChwcm9wZXJ0eUlkVmFsdWUgPT09IFwiXCIgfHwgcHJvcGVydHlJZFZhbHVlID09PSBcIm51bGxcIikge1xuXHRcdFx0cGFyc2VkUHJvcGVydHlJZCA9IG51bGw7IC8vIFJlbW92ZSBwcm9wZXJ0eVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJzZWRQcm9wZXJ0eUlkID0gcHJvcGVydHlJZFZhbHVlIGFzIHN0cmluZzsgLy8gU2V0IHRvIHRoaXMgcHJvcGVydHlcblx0XHR9XG5cblx0XHRjb25zdCBkYXRhID0gdXBkYXRlSm9iU2NoZW1hLnBhcnNlKHtcblx0XHRcdHRpdGxlOiBmb3JtRGF0YS5nZXQoXCJ0aXRsZVwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRkZXNjcmlwdGlvbjogZm9ybURhdGEuZ2V0KFwiZGVzY3JpcHRpb25cIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0c3RhdHVzOiBmb3JtRGF0YS5nZXQoXCJzdGF0dXNcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0cHJpb3JpdHk6IGZvcm1EYXRhLmdldChcInByaW9yaXR5XCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdGpvYlR5cGU6IGZvcm1EYXRhLmdldChcImpvYlR5cGVcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0bm90ZXM6IGZvcm1EYXRhLmdldChcIm5vdGVzXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdC8vIEZpbmFuY2lhbCBmaWVsZHMgKG5vdyBpbiBqb2JfZmluYW5jaWFsIGRvbWFpbiB0YWJsZSlcblx0XHRcdHRvdGFsQW1vdW50OiBmb3JtRGF0YS5nZXQoXCJ0b3RhbEFtb3VudFwiKVxuXHRcdFx0XHQ/IE51bWJlci5wYXJzZUludChmb3JtRGF0YS5nZXQoXCJ0b3RhbEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdHBhaWRBbW91bnQ6IGZvcm1EYXRhLmdldChcInBhaWRBbW91bnRcIilcblx0XHRcdFx0PyBOdW1iZXIucGFyc2VJbnQoZm9ybURhdGEuZ2V0KFwicGFpZEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdGRlcG9zaXRBbW91bnQ6IGZvcm1EYXRhLmdldChcImRlcG9zaXRBbW91bnRcIilcblx0XHRcdFx0PyBOdW1iZXIucGFyc2VJbnQoZm9ybURhdGEuZ2V0KFwiZGVwb3NpdEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdHNjaGVkdWxlZFN0YXJ0OiBmb3JtRGF0YS5nZXQoXCJzY2hlZHVsZWRTdGFydFwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRzY2hlZHVsZWRFbmQ6IGZvcm1EYXRhLmdldChcInNjaGVkdWxlZEVuZFwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRhc3NpZ25lZFRvOiBmb3JtRGF0YS5nZXQoXCJhc3NpZ25lZFRvXCIpIHx8IG51bGwsXG5cdFx0XHRjdXN0b21lcklkOiBwYXJzZWRDdXN0b21lcklkLFxuXHRcdFx0cHJvcGVydHlJZDogcGFyc2VkUHJvcGVydHlJZCxcblx0XHR9KTtcblxuXHRcdC8vIElmIHN0YXR1cyBpcyBiZWluZyBjaGFuZ2VkLCB2YWxpZGF0ZSB0aGUgdHJhbnNpdGlvblxuXHRcdGlmIChkYXRhLnN0YXR1cyAhPT0gdW5kZWZpbmVkICYmIGRhdGEuc3RhdHVzICE9PSBleGlzdGluZ0pvYi5zdGF0dXMpIHtcblx0XHRcdC8vIEZldGNoIGFkZGl0aW9uYWwgY29udGV4dCBmb3Igc3RhdHVzIHZhbGlkYXRpb25cblx0XHRcdGNvbnN0IHsgZGF0YTogam9iV2l0aENvbnRleHQgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRcdGBcblx0XHRcdFx0XHRpZCxcblx0XHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdFx0c2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRcdHNjaGVkdWxlZF9lbmQsXG5cdFx0XHRcdFx0YXNzaWduZWRfdG8sXG5cdFx0XHRcdFx0Y3VzdG9tZXJfaWQsXG5cdFx0XHRcdFx0cHJvcGVydHlfaWQsXG5cdFx0XHRcdFx0dG90YWxfYW1vdW50LFxuXHRcdFx0XHRcdGludm9pY2VzOmludm9pY2VzKHN0YXR1cywgdG90YWxfYW1vdW50KSxcblx0XHRcdFx0XHRlc3RpbWF0ZXM6ZXN0aW1hdGVzKHN0YXR1cyksXG5cdFx0XHRcdFx0dGVhbV9hc3NpZ25tZW50czpqb2JfdGVhbV9hc3NpZ25tZW50cyh0ZWFtX21lbWJlcl9pZClcblx0XHRcdFx0YCxcblx0XHRcdFx0KVxuXHRcdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRpZiAoam9iV2l0aENvbnRleHQpIHtcblx0XHRcdFx0Y29uc3QgdHJhbnNpdGlvbkNvbnRleHQ6IEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0ID0ge1xuXHRcdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGpvYldpdGhDb250ZXh0LnN0YXR1cyBhcyBKb2JTdGF0dXMsXG5cdFx0XHRcdFx0bmV3U3RhdHVzOiBkYXRhLnN0YXR1cyBhcyBKb2JTdGF0dXMsXG5cdFx0XHRcdFx0am9iOiB7XG5cdFx0XHRcdFx0XHRpZDogam9iV2l0aENvbnRleHQuaWQsXG5cdFx0XHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6XG5cdFx0XHRcdFx0XHRcdGRhdGEuc2NoZWR1bGVkU3RhcnQgfHwgam9iV2l0aENvbnRleHQuc2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRcdFx0c2NoZWR1bGVkX2VuZDogZGF0YS5zY2hlZHVsZWRFbmQgfHwgam9iV2l0aENvbnRleHQuc2NoZWR1bGVkX2VuZCxcblx0XHRcdFx0XHRcdGFzc2lnbmVkX3RvOlxuXHRcdFx0XHRcdFx0XHRkYXRhLmFzc2lnbmVkVG8gIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5hc3NpZ25lZFRvXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5hc3NpZ25lZF90byxcblx0XHRcdFx0XHRcdGN1c3RvbWVyX2lkOlxuXHRcdFx0XHRcdFx0XHRkYXRhLmN1c3RvbWVySWQgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5jdXN0b21lcklkXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5jdXN0b21lcl9pZCxcblx0XHRcdFx0XHRcdHByb3BlcnR5X2lkOlxuXHRcdFx0XHRcdFx0XHRkYXRhLnByb3BlcnR5SWQgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5wcm9wZXJ0eUlkXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5wcm9wZXJ0eV9pZCxcblx0XHRcdFx0XHRcdHRvdGFsX2Ftb3VudDpcblx0XHRcdFx0XHRcdFx0ZGF0YS50b3RhbEFtb3VudCAhPT0gdW5kZWZpbmVkXG5cdFx0XHRcdFx0XHRcdFx0PyBkYXRhLnRvdGFsQW1vdW50XG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC50b3RhbF9hbW91bnQsXG5cdFx0XHRcdFx0XHRpbnZvaWNlczogam9iV2l0aENvbnRleHQuaW52b2ljZXMgfHwgW10sXG5cdFx0XHRcdFx0XHRlc3RpbWF0ZXM6IGpvYldpdGhDb250ZXh0LmVzdGltYXRlcyB8fCBbXSxcblx0XHRcdFx0XHRcdHRlYW1Bc3NpZ25tZW50czogam9iV2l0aENvbnRleHQudGVhbV9hc3NpZ25tZW50cyB8fCBbXSxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSB2YWxpZGF0ZVN0YXR1c1RyYW5zaXRpb24odHJhbnNpdGlvbkNvbnRleHQpO1xuXG5cdFx0XHRcdGlmICghdmFsaWRhdGlvblJlc3VsdC5hbGxvd2VkKSB7XG5cdFx0XHRcdFx0bGV0IGVycm9yTWVzc2FnZSA9XG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlYXNvbiB8fCBcIlN0YXR1cyB0cmFuc2l0aW9uIG5vdCBhbGxvd2VkXCI7XG5cblx0XHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlcXVpcmVkRmllbGRzICYmXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlcXVpcmVkRmllbGRzLmxlbmd0aCA+IDBcblx0XHRcdFx0XHQpIHtcblx0XHRcdFx0XHRcdGVycm9yTWVzc2FnZSArPSBgLiBNaXNzaW5nOiAke3ZhbGlkYXRpb25SZXN1bHQucmVxdWlyZWRGaWVsZHMuam9pbihcIiwgXCIpfWA7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKGVycm9yTWVzc2FnZSwgRVJST1JfQ09ERVMuVkFMSURBVElPTl9GQUlMRUQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gTG9nIHdhcm5pbmdzIGlmIHByZXNlbnQgKG5vbi1ibG9ja2luZylcblx0XHRcdFx0aWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwi4pqg77iPIFN0YXR1cyB0cmFuc2l0aW9uIHdhcm5pbmdzOlwiLCB7XG5cdFx0XHRcdFx0XHRqb2JJZCxcblx0XHRcdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGpvYldpdGhDb250ZXh0LnN0YXR1cyxcblx0XHRcdFx0XHRcdG5ld1N0YXR1czogZGF0YS5zdGF0dXMsXG5cdFx0XHRcdFx0XHR3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIEJ1aWxkIGNvcmUgam9iIHVwZGF0ZSBvYmplY3Qgd2l0aCBvbmx5IGRlZmluZWQgdmFsdWVzXG5cdFx0Y29uc3QgY29yZVVwZGF0ZURhdGE6IGFueSA9IHt9O1xuXHRcdGlmIChkYXRhLnRpdGxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnRpdGxlID0gZGF0YS50aXRsZTtcblx0XHR9XG5cdFx0aWYgKGRhdGEuZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuZGVzY3JpcHRpb24gPSBkYXRhLmRlc2NyaXB0aW9uO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zdGF0dXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuc3RhdHVzID0gZGF0YS5zdGF0dXM7XG5cdFx0fVxuXHRcdGlmIChkYXRhLnByaW9yaXR5ICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnByaW9yaXR5ID0gZGF0YS5wcmlvcml0eTtcblx0XHR9XG5cdFx0aWYgKGRhdGEuam9iVHlwZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb3JlVXBkYXRlRGF0YS5qb2JfdHlwZSA9IGRhdGEuam9iVHlwZTtcblx0XHR9XG5cdFx0aWYgKGRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEubm90ZXMgPSBkYXRhLm5vdGVzO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zY2hlZHVsZWRTdGFydCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb3JlVXBkYXRlRGF0YS5zY2hlZHVsZWRfc3RhcnQgPSBkYXRhLnNjaGVkdWxlZFN0YXJ0O1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zY2hlZHVsZWRFbmQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuc2NoZWR1bGVkX2VuZCA9IGRhdGEuc2NoZWR1bGVkRW5kO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5hc3NpZ25lZFRvICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLmFzc2lnbmVkX3RvID0gZGF0YS5hc3NpZ25lZFRvO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLmN1c3RvbWVyX2lkID0gZGF0YS5jdXN0b21lcklkO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5wcm9wZXJ0eUlkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnByb3BlcnR5X2lkID0gZGF0YS5wcm9wZXJ0eUlkO1xuXHRcdFx0Ly8gSWYgcHJvcGVydHkgaXMgYmVpbmcgc2V0IChub3QgbnVsbCksIHZlcmlmeSBpdCBiZWxvbmdzIHRvIHRoZSBjdXN0b21lciAoaWYgY3VzdG9tZXIgaXMgc2V0KVxuXHRcdFx0aWYgKFxuXHRcdFx0XHRkYXRhLnByb3BlcnR5SWQgIT09IG51bGwgJiZcblx0XHRcdFx0ZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQgJiZcblx0XHRcdFx0ZGF0YS5jdXN0b21lcklkICE9PSBudWxsXG5cdFx0XHQpIHtcblx0XHRcdFx0Y29uc3QgeyBkYXRhOiBwcm9wZXJ0eSB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdFx0XHQuZnJvbShcInByb3BlcnRpZXNcIilcblx0XHRcdFx0XHQuc2VsZWN0KFwiY3VzdG9tZXJfaWRcIilcblx0XHRcdFx0XHQuZXEoXCJpZFwiLCBkYXRhLnByb3BlcnR5SWQpXG5cdFx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRcdGlmIChwcm9wZXJ0eSAmJiBwcm9wZXJ0eS5jdXN0b21lcl9pZCAhPT0gZGF0YS5jdXN0b21lcklkKSB7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcdFx0XCJQcm9wZXJ0eSBkb2VzIG5vdCBiZWxvbmcgdG8gdGhlIHNlbGVjdGVkIGN1c3RvbWVyXCIsXG5cdFx0XHRcdFx0XHRFUlJPUl9DT0RFUy5WQUxJREFUSU9OX0ZBSUxFRCxcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gQnVpbGQgZmluYW5jaWFsIGRvbWFpbiB1cGRhdGUgb2JqZWN0IChpZiBhbnkgZmluYW5jaWFsIGZpZWxkcyBwcm92aWRlZClcblx0XHRjb25zdCBmaW5hbmNpYWxVcGRhdGVEYXRhOiBhbnkgPSB7fTtcblx0XHRpZiAoZGF0YS50b3RhbEFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmaW5hbmNpYWxVcGRhdGVEYXRhLnRvdGFsX2Ftb3VudCA9IGRhdGEudG90YWxBbW91bnQ7XG5cdFx0fVxuXHRcdGlmIChkYXRhLnBhaWRBbW91bnQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0ZmluYW5jaWFsVXBkYXRlRGF0YS5wYWlkX2Ftb3VudCA9IGRhdGEucGFpZEFtb3VudDtcblx0XHR9XG5cdFx0aWYgKGRhdGEuZGVwb3NpdEFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmaW5hbmNpYWxVcGRhdGVEYXRhLmRlcG9zaXRfYW1vdW50ID0gZGF0YS5kZXBvc2l0QW1vdW50O1xuXHRcdH1cblxuXHRcdC8vIEV4ZWN1dGUgdXBkYXRlcyBpbiBwYXJhbGxlbCBmb3IgcGVyZm9ybWFuY2Vcblx0XHRjb25zdCB1cGRhdGVzOiBQcm9taXNlPGFueT5bXSA9IFtdO1xuXG5cdFx0Ly8gVXBkYXRlIGNvcmUgam9iIHRhYmxlIGlmIHRoZXJlIGFyZSBjaGFuZ2VzXG5cdFx0aWYgKE9iamVjdC5rZXlzKGNvcmVVcGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG5cdFx0XHR1cGRhdGVzLnB1c2goXG5cdFx0XHRcdChhc3luYyAoKSA9PiBhd2FpdCBzdXBhYmFzZS5mcm9tKFwiam9ic1wiKS51cGRhdGUoY29yZVVwZGF0ZURhdGEpLmVxKFwiaWRcIiwgam9iSWQpKSgpLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBVcGRhdGUgZmluYW5jaWFsIGRvbWFpbiB0YWJsZSBpZiB0aGVyZSBhcmUgY2hhbmdlc1xuXHRcdGlmIChPYmplY3Qua2V5cyhmaW5hbmNpYWxVcGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG5cdFx0XHR1cGRhdGVzLnB1c2goXG5cdFx0XHRcdChhc3luYyAoKSA9PlxuXHRcdFx0XHRcdGF3YWl0IHN1cGFiYXNlXG5cdFx0XHRcdFx0XHQuZnJvbShcImpvYl9maW5hbmNpYWxcIilcblx0XHRcdFx0XHRcdC51cGRhdGUoZmluYW5jaWFsVXBkYXRlRGF0YSlcblx0XHRcdFx0XHRcdC5lcShcImpvYl9pZFwiLCBqb2JJZCkpKCksXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEV4ZWN1dGUgYWxsIHVwZGF0ZXMgaW4gcGFyYWxsZWxcblx0XHRpZiAodXBkYXRlcy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwodXBkYXRlcyk7XG5cblx0XHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gYW55IHVwZGF0ZVxuXHRcdFx0Y29uc3QgZXJyb3JzID0gcmVzdWx0cy5maWx0ZXIoKHJlc3VsdCkgPT4gcmVzdWx0LmVycm9yKTtcblx0XHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRjb25zdCBlcnJvck1lc3NhZ2VzID0gZXJyb3JzLm1hcCgoZSkgPT4gZS5lcnJvci5tZXNzYWdlKS5qb2luKFwiLCBcIik7XG5cdFx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XHRgJHtFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJ1cGRhdGUgam9iXCIpfTogJHtlcnJvck1lc3NhZ2VzfWAsXG5cdFx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBVcGRhdGUgam9iIHdpdGggZGF0YSBvYmplY3QgKGVhc2llciBmb3IgcHJvZ3JhbW1hdGljIHVzZSlcbiAqIFVzZWQgYnkgam9iIGVkaXRvciBmb3IgaW4tcGxhY2UgdXBkYXRlc1xuICovXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVKb2JEYXRhKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRkYXRhOiBQYXJ0aWFsPFVwZGF0ZUpvYkRhdGE+LFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHQvLyBDb252ZXJ0IGRhdGEgb2JqZWN0IHRvIEZvcm1EYXRhIGZvciBjb21wYXRpYmlsaXR5IHdpdGggZXhpc3RpbmcgdXBkYXRlSm9iXG5cdFx0Y29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcblxuXHRcdC8vIEFkZCBhbGwgZGVmaW5lZCBmaWVsZHMgdG8gRm9ybURhdGFcblx0XHRpZiAoZGF0YS50aXRsZSAhPT0gdW5kZWZpbmVkKSBmb3JtRGF0YS5hcHBlbmQoXCJ0aXRsZVwiLCBkYXRhLnRpdGxlKTtcblx0XHRpZiAoZGF0YS5kZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwiZGVzY3JpcHRpb25cIiwgZGF0YS5kZXNjcmlwdGlvbik7XG5cdFx0aWYgKGRhdGEuc3RhdHVzICE9PSB1bmRlZmluZWQpIGZvcm1EYXRhLmFwcGVuZChcInN0YXR1c1wiLCBkYXRhLnN0YXR1cyk7XG5cdFx0aWYgKGRhdGEucHJpb3JpdHkgIT09IHVuZGVmaW5lZCkgZm9ybURhdGEuYXBwZW5kKFwicHJpb3JpdHlcIiwgZGF0YS5wcmlvcml0eSk7XG5cdFx0aWYgKGRhdGEuam9iVHlwZSAhPT0gdW5kZWZpbmVkKSBmb3JtRGF0YS5hcHBlbmQoXCJqb2JUeXBlXCIsIGRhdGEuam9iVHlwZSk7XG5cdFx0aWYgKGRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkgZm9ybURhdGEuYXBwZW5kKFwibm90ZXNcIiwgZGF0YS5ub3Rlcyk7XG5cdFx0aWYgKGRhdGEudG90YWxBbW91bnQgIT09IHVuZGVmaW5lZClcblx0XHRcdGZvcm1EYXRhLmFwcGVuZChcInRvdGFsQW1vdW50XCIsIGRhdGEudG90YWxBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEucGFpZEFtb3VudCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwicGFpZEFtb3VudFwiLCBkYXRhLnBhaWRBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEuZGVwb3NpdEFtb3VudCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwiZGVwb3NpdEFtb3VudFwiLCBkYXRhLmRlcG9zaXRBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEuc2NoZWR1bGVkU3RhcnQgIT09IHVuZGVmaW5lZClcblx0XHRcdGZvcm1EYXRhLmFwcGVuZChcInNjaGVkdWxlZFN0YXJ0XCIsIGRhdGEuc2NoZWR1bGVkU3RhcnQpO1xuXHRcdGlmIChkYXRhLnNjaGVkdWxlZEVuZCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwic2NoZWR1bGVkRW5kXCIsIGRhdGEuc2NoZWR1bGVkRW5kKTtcblx0XHRpZiAoZGF0YS5hc3NpZ25lZFRvICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJhc3NpZ25lZFRvXCIsIGRhdGEuYXNzaWduZWRUbyB8fCBcIlwiKTtcblx0XHRpZiAoZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJjdXN0b21lcklkXCIsIGRhdGEuY3VzdG9tZXJJZCB8fCBcIlwiKTtcblx0XHRpZiAoZGF0YS5wcm9wZXJ0eUlkICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJwcm9wZXJ0eUlkXCIsIGRhdGEucHJvcGVydHlJZCB8fCBcIlwiKTtcblxuXHRcdC8vIFJldXNlIGV4aXN0aW5nIHVwZGF0ZUpvYiBsb2dpY1xuXHRcdHJldHVybiBhd2FpdCB1cGRhdGVKb2Ioam9iSWQsIGZvcm1EYXRhKTtcblx0fSk7XG59XG5cbi8qKlxuICogVXBkYXRlIGpvYiBzdGF0dXMgd2l0aCB2YWxpZGF0aW9uXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5zdGF0dXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYlN0YXR1cyhcblx0am9iSWQ6IHN0cmluZyxcblx0bmV3U3RhdHVzOiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBjdXJyZW50IHVzZXJcblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmFsaWRhdGUgc3RhdHVzIHZhbHVlXG5cdFx0Y29uc3QgdmFsaWRTdGF0dXNlczogSm9iU3RhdHVzW10gPSBbXG5cdFx0XHRcInF1b3RlZFwiLFxuXHRcdFx0XCJzY2hlZHVsZWRcIixcblx0XHRcdFwiaW5fcHJvZ3Jlc3NcIixcblx0XHRcdFwib25faG9sZFwiLFxuXHRcdFx0XCJjb21wbGV0ZWRcIixcblx0XHRcdFwiY2FuY2VsbGVkXCIsXG5cdFx0XHRcImludm9pY2VkXCIsXG5cdFx0XHRcInBhaWRcIixcblx0XHRdO1xuXHRcdGlmICghdmFsaWRTdGF0dXNlcy5pbmNsdWRlcyhuZXdTdGF0dXMgYXMgSm9iU3RhdHVzKSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkludmFsaWQgam9iIHN0YXR1c1wiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5WQUxJREFUSU9OX0ZBSUxFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gRmV0Y2ggam9iIHdpdGggYWxsIGNvbnRleHQgbmVlZGVkIGZvciB0cmFuc2l0aW9uIHZhbGlkYXRpb25cblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRgXG5cdFx0XHRcdGlkLFxuXHRcdFx0XHRjb21wYW55X2lkLFxuXHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdHNjaGVkdWxlZF9zdGFydCxcblx0XHRcdFx0c2NoZWR1bGVkX2VuZCxcblx0XHRcdFx0YXNzaWduZWRfdG8sXG5cdFx0XHRcdGN1c3RvbWVyX2lkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZCxcblx0XHRcdFx0dG90YWxfYW1vdW50LFxuXHRcdFx0XHRpbnZvaWNlczppbnZvaWNlcyhzdGF0dXMsIHRvdGFsX2Ftb3VudCksXG5cdFx0XHRcdGVzdGltYXRlczplc3RpbWF0ZXMoc3RhdHVzKSxcblx0XHRcdFx0dGVhbV9hc3NpZ25tZW50czpqb2JfdGVhbV9hc3NpZ25tZW50cyh0ZWFtX21lbWJlcl9pZClcblx0XHRcdGAsXG5cdFx0XHQpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhleGlzdGluZ0pvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoZXhpc3RpbmdKb2IuY29tcGFueV9pZCAhPT0gY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQnVpbGQgY29udGV4dCBmb3IgdHJhbnNpdGlvbiB2YWxpZGF0aW9uXG5cdFx0Y29uc3QgdHJhbnNpdGlvbkNvbnRleHQ6IEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0ID0ge1xuXHRcdFx0Y3VycmVudFN0YXR1czogZXhpc3RpbmdKb2Iuc3RhdHVzIGFzIEpvYlN0YXR1cyxcblx0XHRcdG5ld1N0YXR1czogbmV3U3RhdHVzIGFzIEpvYlN0YXR1cyxcblx0XHRcdGpvYjoge1xuXHRcdFx0XHRpZDogZXhpc3RpbmdKb2IuaWQsXG5cdFx0XHRcdHNjaGVkdWxlZF9zdGFydDogZXhpc3RpbmdKb2Iuc2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRzY2hlZHVsZWRfZW5kOiBleGlzdGluZ0pvYi5zY2hlZHVsZWRfZW5kLFxuXHRcdFx0XHRhc3NpZ25lZF90bzogZXhpc3RpbmdKb2IuYXNzaWduZWRfdG8sXG5cdFx0XHRcdGN1c3RvbWVyX2lkOiBleGlzdGluZ0pvYi5jdXN0b21lcl9pZCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IGV4aXN0aW5nSm9iLnByb3BlcnR5X2lkLFxuXHRcdFx0XHR0b3RhbF9hbW91bnQ6IGV4aXN0aW5nSm9iLnRvdGFsX2Ftb3VudCxcblx0XHRcdFx0aW52b2ljZXM6IGV4aXN0aW5nSm9iLmludm9pY2VzIHx8IFtdLFxuXHRcdFx0XHRlc3RpbWF0ZXM6IGV4aXN0aW5nSm9iLmVzdGltYXRlcyB8fCBbXSxcblx0XHRcdFx0dGVhbUFzc2lnbm1lbnRzOiBleGlzdGluZ0pvYi50ZWFtX2Fzc2lnbm1lbnRzIHx8IFtdLFxuXHRcdFx0fSxcblx0XHR9O1xuXG5cdFx0Ly8gVmFsaWRhdGUgdHJhbnNpdGlvbiB3aXRoIGNvbXByZWhlbnNpdmUgYnVzaW5lc3MgcnVsZXNcblx0XHRjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gdmFsaWRhdGVTdGF0dXNUcmFuc2l0aW9uKHRyYW5zaXRpb25Db250ZXh0KTtcblxuXHRcdGlmICghdmFsaWRhdGlvblJlc3VsdC5hbGxvd2VkKSB7XG5cdFx0XHRsZXQgZXJyb3JNZXNzYWdlID1cblx0XHRcdFx0dmFsaWRhdGlvblJlc3VsdC5yZWFzb24gfHwgXCJTdGF0dXMgdHJhbnNpdGlvbiBub3QgYWxsb3dlZFwiO1xuXG5cdFx0XHRpZiAoXG5cdFx0XHRcdHZhbGlkYXRpb25SZXN1bHQucmVxdWlyZWRGaWVsZHMgJiZcblx0XHRcdFx0dmFsaWRhdGlvblJlc3VsdC5yZXF1aXJlZEZpZWxkcy5sZW5ndGggPiAwXG5cdFx0XHQpIHtcblx0XHRcdFx0ZXJyb3JNZXNzYWdlICs9IGAuIE1pc3Npbmc6ICR7dmFsaWRhdGlvblJlc3VsdC5yZXF1aXJlZEZpZWxkcy5qb2luKFwiLCBcIil9YDtcblx0XHRcdH1cblxuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKGVycm9yTWVzc2FnZSwgRVJST1JfQ09ERVMuVkFMSURBVElPTl9GQUlMRUQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyB3YXJuaW5ncyBpZiBwcmVzZW50IChub24tYmxvY2tpbmcpXG5cdFx0aWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCLimqDvuI8gU3RhdHVzIHRyYW5zaXRpb24gd2FybmluZ3M6XCIsIHtcblx0XHRcdFx0am9iSWQsXG5cdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGV4aXN0aW5nSm9iLnN0YXR1cyxcblx0XHRcdFx0bmV3U3RhdHVzLFxuXHRcdFx0XHR3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBzdGF0dXNcblx0XHRjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnVwZGF0ZSh7IHN0YXR1czogbmV3U3RhdHVzIH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwidXBkYXRlIGpvYiBzdGF0dXNcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1FVRVJZX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zb2xlLmxvZyhcIuKchSBKb2Igc3RhdHVzIHVwZGF0ZWQ6XCIsIHtcblx0XHRcdGpvYklkLFxuXHRcdFx0b2xkU3RhdHVzOiBleGlzdGluZ0pvYi5zdGF0dXMsXG5cdFx0XHRuZXdTdGF0dXMsXG5cdFx0fSk7XG5cblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZC93b3JrLyR7am9iSWR9YCk7XG5cdH0pO1xufVxuXG4vKipcbiAqIEFzc2lnbiBqb2IgdG8gYSB0ZWNobmljaWFuXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5hc3NpZ25lZF90b1xuICovXG5hc3luYyBmdW5jdGlvbiBhc3NpZ25Kb2IoXG5cdGpvYklkOiBzdHJpbmcsXG5cdHRlY2huaWNpYW5JZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWRcIilcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0YXNzZXJ0RXhpc3RzKGV4aXN0aW5nSm9iLCBcIkpvYlwiKTtcblxuXHRcdGlmIChleGlzdGluZ0pvYi5jb21wYW55X2lkICE9PSBjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwiam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgdGVjaG5pY2lhbiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IHRlY2huaWNpYW4gfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImNvbXBhbnlfbWVtYmVyc2hpcHNcIilcblx0XHRcdC5zZWxlY3QoXCJ1c2VyX2lkXCIpXG5cdFx0XHQuZXEoXCJ1c2VyX2lkXCIsIHRlY2huaWNpYW5JZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWNobmljaWFuKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiVGVjaG5pY2lhbiBub3QgZm91bmQgaW4geW91ciBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1JFQ09SRF9OT1RfRk9VTkQsXG5cdFx0XHRcdDQwNCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQXNzaWduIGpvYlxuXHRcdGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQudXBkYXRlKHsgYXNzaWduZWRfdG86IHRlY2huaWNpYW5JZCB9KVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpO1xuXG5cdFx0aWYgKHVwZGF0ZUVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImFzc2lnbiBqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1FVRVJZX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZC93b3JrLyR7am9iSWR9YCk7XG5cdH0pO1xufVxuXG4vKipcbiAqIFNjaGVkdWxlIGEgam9iXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icyB0YWJsZSBzY2hlZHVsaW5nIGZpZWxkc1xuICovXG5hc3luYyBmdW5jdGlvbiBzY2hlZHVsZUpvYihcblx0am9iSWQ6IHN0cmluZyxcblx0Zm9ybURhdGE6IEZvcm1EYXRhLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSBzY2hlZHVsZUpvYlNjaGVtYS5wYXJzZSh7XG5cdFx0XHRzY2hlZHVsZWRTdGFydDogZm9ybURhdGEuZ2V0KFwic2NoZWR1bGVkU3RhcnRcIiksXG5cdFx0XHRzY2hlZHVsZWRFbmQ6IGZvcm1EYXRhLmdldChcInNjaGVkdWxlZEVuZFwiKSxcblx0XHR9KTtcblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWQsIHN0YXR1c1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBzY2hlZHVsZSBhbmQgc3RhdHVzXG5cdFx0Y29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRzdGF0dXM6XG5cdFx0XHRcdFx0ZXhpc3RpbmdKb2Iuc3RhdHVzID09PSBcInF1b3RlZFwiID8gXCJzY2hlZHVsZWRcIiA6IGV4aXN0aW5nSm9iLnN0YXR1cyxcblx0XHRcdH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwic2NoZWR1bGUgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0fSk7XG59XG5cbi8qKlxuICogU3RhcnQgYSBqb2JcbiAqIPCflKcgUkVGQUNUT1JFRCAtIE5vdyB1cGRhdGVzIGpvYl90aW1lX3RyYWNraW5nLmFjdHVhbF9zdGFydCBpbnN0ZWFkIG9mIGpvYnMuYWN0dWFsX3N0YXJ0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdGFydEpvYihqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWQsIHN0YXR1c1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbiBvbmx5IHN0YXJ0IHNjaGVkdWxlZCBqb2JzXG5cdFx0aWYgKGV4aXN0aW5nSm9iLnN0YXR1cyAhPT0gXCJzY2hlZHVsZWRcIiAmJiBleGlzdGluZ0pvYi5zdGF0dXMgIT09IFwicXVvdGVkXCIpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgbXVzdCBiZSBzY2hlZHVsZWQgYmVmb3JlIHN0YXJ0aW5nXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuXG5cdFx0Ly8gVXBkYXRlIGJvdGggam9icyB0YWJsZSAoc3RhdHVzKSBhbmQgam9iX3RpbWVfdHJhY2tpbmcgdGFibGUgKGFjdHVhbF9zdGFydCkgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0c3VwYWJhc2UuZnJvbShcImpvYnNcIikudXBkYXRlKHsgc3RhdHVzOiBcImluX3Byb2dyZXNzXCIgfSkuZXEoXCJpZFwiLCBqb2JJZCksXG5cdFx0XHRzdXBhYmFzZVxuXHRcdFx0XHQuZnJvbShcImpvYl90aW1lX3RyYWNraW5nXCIpXG5cdFx0XHRcdC51cGRhdGUoeyBhY3R1YWxfc3RhcnQ6IG5vdyB9KVxuXHRcdFx0XHQuZXEoXCJqb2JfaWRcIiwgam9iSWQpLFxuXHRcdF0pO1xuXG5cdFx0Ly8gQ2hlY2sgZm9yIGVycm9ycyBpbiBlaXRoZXIgdXBkYXRlXG5cdFx0Y29uc3QgZXJyb3JzID0gdXBkYXRlcy5maWx0ZXIoKHJlc3VsdCkgPT4gcmVzdWx0LmVycm9yKTtcblx0XHRpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwic3RhcnQgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBDb21wbGV0ZSBhIGpvYlxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgam9iX3RpbWVfdHJhY2tpbmcuYWN0dWFsX2VuZCBhbmQgY2FsY3VsYXRlcyB0b3RhbF9sYWJvcl9ob3Vyc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29tcGxldGVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHZvaWQ+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IGN1cnJlbnQgdXNlclxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdC8vIEdldCB1c2VyJ3MgYWN0aXZlIGNvbXBhbnkgdXNpbmcgaGVscGVyIChoYW5kbGVzIG11bHRpLWNvbXBhbnkgdXNlcnMpXG5cdFx0Y29uc3QgeyBnZXRBY3RpdmVDb21wYW55SWQgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL2F1dGgvY29tcGFueS1jb250ZXh0XCIpO1xuXHRcdGNvbnN0IGNvbXBhbnlJZCA9IGF3YWl0IGdldEFjdGl2ZUNvbXBhbnlJZCgpO1xuXG5cdFx0aWYgKCFjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGJlbG9uZ3MgdG8gY29tcGFueSBhbmQgZ2V0IHRpbWUgdHJhY2tpbmcgZGF0YVxuXHRcdGNvbnN0IHsgZGF0YTogZXhpc3RpbmdKb2IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkLCBzdGF0dXMsIHRpbWVUcmFja2luZzpqb2JfdGltZV90cmFja2luZygqKVwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbiBvbmx5IGNvbXBsZXRlIGluLXByb2dyZXNzIGpvYnNcblx0XHRpZiAoZXhpc3RpbmdKb2Iuc3RhdHVzICE9PSBcImluX3Byb2dyZXNzXCIpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgbXVzdCBiZSBpbiBwcm9ncmVzcyB0byBjb21wbGV0ZVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcblxuXHRcdC8vIENhbGN1bGF0ZSB0b3RhbCBsYWJvciBob3VycyBpZiB3ZSBoYXZlIGFjdHVhbF9zdGFydFxuXHRcdGNvbnN0IHRpbWVUcmFja2luZyA9IEFycmF5LmlzQXJyYXkoZXhpc3RpbmdKb2IudGltZVRyYWNraW5nKVxuXHRcdFx0PyBleGlzdGluZ0pvYi50aW1lVHJhY2tpbmdbMF1cblx0XHRcdDogZXhpc3RpbmdKb2IudGltZVRyYWNraW5nO1xuXG5cdFx0Y29uc3QgdGltZVRyYWNraW5nVXBkYXRlOiBhbnkgPSB7IGFjdHVhbF9lbmQ6IG5vdyB9O1xuXG5cdFx0aWYgKHRpbWVUcmFja2luZz8uYWN0dWFsX3N0YXJ0KSB7XG5cdFx0XHRjb25zdCBzdGFydFRpbWUgPSBuZXcgRGF0ZSh0aW1lVHJhY2tpbmcuYWN0dWFsX3N0YXJ0KS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBlbmRUaW1lID0gbmV3IERhdGUobm93KS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBob3Vyc1dvcmtlZCA9IChlbmRUaW1lIC0gc3RhcnRUaW1lKSAvICgxMDAwICogNjAgKiA2MCk7IC8vIENvbnZlcnQgbXMgdG8gaG91cnNcblx0XHRcdHRpbWVUcmFja2luZ1VwZGF0ZS50b3RhbF9sYWJvcl9ob3VycyA9IGhvdXJzV29ya2VkO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBib3RoIGpvYnMgdGFibGUgKHN0YXR1cykgYW5kIGpvYl90aW1lX3RyYWNraW5nIHRhYmxlIChhY3R1YWxfZW5kLCB0b3RhbF9sYWJvcl9ob3VycykgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0c3VwYWJhc2UuZnJvbShcImpvYnNcIikudXBkYXRlKHsgc3RhdHVzOiBcImNvbXBsZXRlZFwiIH0pLmVxKFwiaWRcIiwgam9iSWQpLFxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfdGltZV90cmFja2luZ1wiKVxuXHRcdFx0XHQudXBkYXRlKHRpbWVUcmFja2luZ1VwZGF0ZSlcblx0XHRcdFx0LmVxKFwiam9iX2lkXCIsIGpvYklkKSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gZWl0aGVyIHVwZGF0ZVxuXHRcdGNvbnN0IGVycm9ycyA9IHVwZGF0ZXMuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5lcnJvcik7XG5cdFx0aWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImNvbXBsZXRlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0fSk7XG59XG5cbi8qKlxuICogQ2FuY2VsIGEgam9iXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5zdGF0dXMgYW5kIGpvYnMubm90ZXNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gY2FuY2VsSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRyZWFzb24/OiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBjdXJyZW50IHVzZXJcblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzLCBub3Rlc1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbm5vdCBjYW5jZWwgY29tcGxldGVkIGpvYnNcblx0XHRpZiAoZXhpc3RpbmdKb2Iuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiQ2Fubm90IGNhbmNlbCBjb21wbGV0ZWQgam9ic1wiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEFkZCBjYW5jZWxsYXRpb24gcmVhc29uIHRvIG5vdGVzXG5cdFx0Y29uc3QgdXBkYXRlZE5vdGVzID0gcmVhc29uXG5cdFx0XHQ/IGAke2V4aXN0aW5nSm9iLm5vdGVzIHx8IFwiXCJ9XFxuXFxuW0NBTkNFTExFRF06ICR7cmVhc29ufWAudHJpbSgpXG5cdFx0XHQ6IGV4aXN0aW5nSm9iLm5vdGVzO1xuXG5cdFx0Ly8gQ2FuY2VsIGpvYlxuXHRcdGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0c3RhdHVzOiBcImNhbmNlbGxlZFwiLFxuXHRcdFx0XHRub3RlczogdXBkYXRlZE5vdGVzLFxuXHRcdFx0fSlcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKTtcblxuXHRcdGlmICh1cGRhdGVFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJjYW5jZWwgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBTZWFyY2ggam9icyB3aXRoIGZ1bGwtdGV4dCBzZWFyY2ggYW5kIHJhbmtpbmdcbiAqIOKchSBOTyBDSEFOR0VTIE5FRURFRCAtIE9ubHkgc2VhcmNoZXMgam9icyB0YWJsZVxuICovXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hKb2JzKFxuXHRzZWFyY2hUZXJtOiBzdHJpbmcsXG5cdG9wdGlvbnM/OiB7IGxpbWl0PzogbnVtYmVyOyBvZmZzZXQ/OiBudW1iZXIgfSxcbik6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueVtdPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiY29tcGFueV9tZW1iZXJzaGlwc1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWRcIilcblx0XHRcdC5lcShcInVzZXJfaWRcIiwgdXNlci5pZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGlmICghdGVhbU1lbWJlcj8uY29tcGFueV9pZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVzZSBmdWxsLXRleHQgc2VhcmNoIHdpdGggcmFua2luZyBmb3IgYmVzdCBtYXRjaGVzXG5cdFx0Y29uc3QgeyBzZWFyY2hKb2JzRnVsbFRleHQgfSA9IGF3YWl0IGltcG9ydChcblx0XHRcdFwiQC9saWIvc2VhcmNoL2Z1bGwtdGV4dC1zZWFyY2hcIlxuXHRcdCk7XG5cblx0XHRjb25zdCBqb2JzID0gYXdhaXQgc2VhcmNoSm9ic0Z1bGxUZXh0KHN1cGFiYXNlLCB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQsIHNlYXJjaFRlcm0sIHtcblx0XHRcdGxpbWl0OiBvcHRpb25zPy5saW1pdCB8fCA1MCxcblx0XHRcdG9mZnNldDogb3B0aW9ucz8ub2Zmc2V0IHx8IDAsXG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gam9icztcblx0fSk7XG59XG5cbi8qKlxuICogVW5pdmVyc2FsIHNlYXJjaCBhY3Jvc3MgYWxsIGVudGl0aWVzXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHNlYXJjaGVzIGpvYnMgdGFibGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2VhcmNoQWxsKFxuXHRzZWFyY2hUZXJtOiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDxhbnk+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Y29uc3QgeyBkYXRhOiB0ZWFtTWVtYmVyIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjb21wYW55X21lbWJlcnNoaXBzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWFtTWVtYmVyPy5jb21wYW55X2lkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVXNlIHVuaXZlcnNhbCBzZWFyY2ggUlBDIGZ1bmN0aW9uXG5cdFx0Y29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UucnBjKFwic2VhcmNoX2FsbF9lbnRpdGllc1wiLCB7XG5cdFx0XHRjb21wYW55X2lkX3BhcmFtOiB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQsXG5cdFx0XHRzZWFyY2hfcXVlcnk6IHNlYXJjaFRlcm0sXG5cdFx0XHRwZXJfZW50aXR5X2xpbWl0OiA1LFxuXHRcdH0pO1xuXG5cdFx0aWYgKGVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcInNlYXJjaFwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBkYXRhO1xuXHR9KTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSk9CIEFSQ0hJVkUgJiBSRVNUT1JFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogQXJjaGl2ZSBqb2IgKHNvZnQgZGVsZXRlKVxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgam9iX211bHRpX2VudGl0eS5kZWxldGVkX2J5IGFuZCBwZXJtYW5lbnRfZGVsZXRlX3NjaGVkdWxlZF9hdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXJjaGl2ZUpvYihqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHRjb25zdCB7IGRhdGE6IHRlYW1NZW1iZXIgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImNvbXBhbnlfbWVtYmVyc2hpcHNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJ1c2VyX2lkXCIsIHVzZXIuaWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoIXRlYW1NZW1iZXI/LmNvbXBhbnlfaWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogam9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGpvYi5jb21wYW55X2lkICE9PSB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwiam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBDYW5ub3QgYXJjaGl2ZSBjb21wbGV0ZWQvcGFpZCBqb2JzIChidXNpbmVzcyBydWxlKVxuXHRcdGlmIChqb2Iuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiIHx8IGpvYi5zdGF0dXMgPT09IFwiaW52b2ljZWRcIikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkNhbm5vdCBhcmNoaXZlIGNvbXBsZXRlZCBvciBpbnZvaWNlZCBqb2JzLiBUaGVzZSBtdXN0IGJlIHJldGFpbmVkIGZvciByZWNvcmRzLlwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEFyY2hpdmUgam9iIChzb2Z0IGRlbGV0ZSlcblx0XHRjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG5cdFx0Y29uc3Qgc2NoZWR1bGVkRGVsZXRpb24gPSBuZXcgRGF0ZShcblx0XHRcdERhdGUubm93KCkgKyA5MCAqIDI0ICogNjAgKiA2MCAqIDEwMDAsXG5cdFx0KS50b0lTT1N0cmluZygpO1xuXG5cdFx0Ly8gVXBkYXRlIGJvdGggam9icyB0YWJsZSBhbmQgam9iX211bHRpX2VudGl0eSB0YWJsZSBpbiBwYXJhbGxlbFxuXHRcdGNvbnN0IHVwZGF0ZXMgPSBhd2FpdCBQcm9taXNlLmFsbChbXG5cdFx0XHQvLyBVcGRhdGUgY29yZSBqb2JzIHRhYmxlIHdpdGggYXJjaGl2ZSBtZXRhZGF0YVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRcdGRlbGV0ZWRfYXQ6IG5vdyxcblx0XHRcdFx0XHRhcmNoaXZlZF9hdDogbm93LFxuXHRcdFx0XHRcdHN0YXR1czogXCJhcmNoaXZlZFwiLFxuXHRcdFx0XHR9KVxuXHRcdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCksXG5cblx0XHRcdC8vIFVwZGF0ZSBqb2JfbXVsdGlfZW50aXR5IHRhYmxlIHdpdGggZGVsZXRpb24gdHJhY2tpbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX211bHRpX2VudGl0eVwiKVxuXHRcdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0XHRkZWxldGVkX2J5OiB1c2VyLmlkLFxuXHRcdFx0XHRcdHBlcm1hbmVudF9kZWxldGVfc2NoZWR1bGVkX2F0OiBzY2hlZHVsZWREZWxldGlvbixcblx0XHRcdFx0fSlcblx0XHRcdFx0LmVxKFwiam9iX2lkXCIsIGpvYklkKSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gZWl0aGVyIHVwZGF0ZVxuXHRcdGNvbnN0IGVycm9ycyA9IHVwZGF0ZXMuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5lcnJvcik7XG5cdFx0aWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImFyY2hpdmUgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9zZXR0aW5ncy9hcmNoaXZlXCIpO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBSZXN0b3JlIGFyY2hpdmVkIGpvYlxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IGNsZWFycyBqb2JfbXVsdGlfZW50aXR5LmRlbGV0ZWRfYnkgYW5kIHBlcm1hbmVudF9kZWxldGVfc2NoZWR1bGVkX2F0XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlc3RvcmVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHZvaWQ+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Y29uc3QgeyBkYXRhOiB0ZWFtTWVtYmVyIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjb21wYW55X21lbWJlcnNoaXBzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWFtTWVtYmVyPy5jb21wYW55X2lkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnkgYW5kIGlzIGFyY2hpdmVkXG5cdFx0Y29uc3QgeyBkYXRhOiBqb2IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkLCBkZWxldGVkX2F0LCBzdGF0dXNcIilcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0YXNzZXJ0RXhpc3RzKGpvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoam9iLmNvbXBhbnlfaWQgIT09IHRlYW1NZW1iZXIuY29tcGFueV9pZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmICgham9iLmRlbGV0ZWRfYXQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgaXMgbm90IGFyY2hpdmVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmVzdG9yZSBqb2IgLSB1cGRhdGUgYm90aCB0YWJsZXMgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0Ly8gQ2xlYXIgY29yZSBqb2JzIHRhYmxlIGFyY2hpdmUgbWV0YWRhdGFcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0XHRkZWxldGVkX2F0OiBudWxsLFxuXHRcdFx0XHRcdGFyY2hpdmVkX2F0OiBudWxsLFxuXHRcdFx0XHRcdHN0YXR1czogam9iLnN0YXR1cyA9PT0gXCJhcmNoaXZlZFwiID8gXCJzY2hlZHVsZWRcIiA6IGpvYi5zdGF0dXMsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5lcShcImlkXCIsIGpvYklkKSxcblxuXHRcdFx0Ly8gQ2xlYXIgam9iX211bHRpX2VudGl0eSB0YWJsZSBkZWxldGlvbiB0cmFja2luZ1xuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfbXVsdGlfZW50aXR5XCIpXG5cdFx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRcdGRlbGV0ZWRfYnk6IG51bGwsXG5cdFx0XHRcdFx0cGVybWFuZW50X2RlbGV0ZV9zY2hlZHVsZWRfYXQ6IG51bGwsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5lcShcImpvYl9pZFwiLCBqb2JJZCksXG5cdFx0XSk7XG5cblx0XHQvLyBDaGVjayBmb3IgZXJyb3JzIGluIGVpdGhlciB1cGRhdGVcblx0XHRjb25zdCBlcnJvcnMgPSB1cGRhdGVzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuZXJyb3IpO1xuXHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJyZXN0b3JlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9zY2hlZHVsZVwiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvc2V0dGluZ3MvYXJjaGl2ZVwiKTtcblx0fSk7XG59XG5cbi8qKlxuICogUmVtb3ZlIHRlYW0gYXNzaWdubWVudCBmcm9tIGpvYlxuICog4pyFIE5PIENIQU5HRVMgTkVFREVEIC0gT25seSBkZWxldGVzIGZyb20gam9iX3RlYW1fYXNzaWdubWVudHMganVuY3Rpb24gdGFibGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVtb3ZlVGVhbUFzc2lnbm1lbnQoXG5cdGFzc2lnbm1lbnRJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IHRoZSBqdW5jdGlvbiByZWNvcmQgdG8gZmluZCBqb2JfaWQgZm9yIHJldmFsaWRhdGlvblxuXHRcdGNvbnN0IHsgZGF0YTogcmVjb3JkLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9iX3RlYW1fYXNzaWdubWVudHNcIilcblx0XHRcdC5zZWxlY3QoXCJpZCwgam9iX2lkLCBjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBhc3NpZ25tZW50SWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoZmV0Y2hFcnJvciB8fCAhcmVjb3JkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiVGVhbSBhc3NpZ25tZW50IG5vdCBmb3VuZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9SRUNPUkRfTk9UX0ZPVU5ELFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAocmVjb3JkLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJ0ZWFtIGFzc2lnbm1lbnRcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGpvYklkID0gcmVjb3JkLmpvYl9pZDtcblxuXHRcdC8vIERlbGV0ZSBqdW5jdGlvbiB0YWJsZSByb3dcblx0XHRjb25zdCB7IGVycm9yOiBkZWxldGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9iX3RlYW1fYXNzaWdubWVudHNcIilcblx0XHRcdC5kZWxldGUoKVxuXHRcdFx0LmVxKFwiaWRcIiwgYXNzaWdubWVudElkKTtcblxuXHRcdGlmIChkZWxldGVFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJyZW1vdmUgdGVhbSBhc3NpZ25tZW50IGZyb20gam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmV2YWxpZGF0ZSBqb2IgcGFnZSBhbmQgc2NoZWR1bGVcblx0XHRpZiAoam9iSWQpIHtcblx0XHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0XHR9XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBBc3NpZ24gQ3VzdG9tZXIgYW5kIFByb3BlcnR5IHRvIEpvYlxuICpcbiAqIFVwZGF0ZXMgdGhlIGpvYidzIGN1c3RvbWVyX2lkIGFuZCBwcm9wZXJ0eV9pZC5cbiAqIE9ubHkgb25lIGN1c3RvbWVyIGFuZCBwcm9wZXJ0eSBjYW4gYmUgYXNzaWduZWQgcGVyIGpvYi5cbiAqXG4gKiBAcGFyYW0gam9iSWQgLSBKb2IgSURcbiAqIEBwYXJhbSBjdXN0b21lcklkIC0gQ3VzdG9tZXIgSUQgdG8gYXNzaWduXG4gKiBAcGFyYW0gcHJvcGVydHlJZCAtIFByb3BlcnR5IElEIHRvIGFzc2lnbiAob3B0aW9uYWwpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhc3NpZ25DdXN0b21lclRvSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRjdXN0b21lcklkOiBzdHJpbmcsXG5cdHByb3BlcnR5SWQ6IHN0cmluZyB8IG51bGwsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdGNvbnN0IGNvbXBhbnlJZCA9IGF3YWl0IGdldEFjdGl2ZUNvbXBhbnlJZCgpO1xuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImNvbXBhbnkgYWNjZXNzXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGV4aXN0cyBhbmQgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBqb2IsIGVycm9yOiBqb2JFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImlkLCBjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LmlzKFwiZGVsZXRlZF9hdFwiLCBudWxsKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGpvYkVycm9yKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKFwiSm9iIHF1ZXJ5IGVycm9yOlwiLCBqb2JFcnJvcik7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmluZCBqb2I6ICR7am9iRXJyb3IubWVzc2FnZX1gLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdFx0NTAwLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRhc3NlcnRFeGlzdHMoam9iLCBcIkpvYlwiKTtcblxuXHRcdC8vIFZlcmlmeSBjdXN0b21lciBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogY3VzdG9tZXIsIGVycm9yOiBjdXN0b21lckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjdXN0b21lcnNcIilcblx0XHRcdC5zZWxlY3QoXCJpZCwgY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgY3VzdG9tZXJJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LmlzKFwiZGVsZXRlZF9hdFwiLCBudWxsKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGN1c3RvbWVyRXJyb3IpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJDdXN0b21lciBxdWVyeSBlcnJvcjpcIiwgY3VzdG9tZXJFcnJvcik7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmluZCBjdXN0b21lcjogJHtjdXN0b21lckVycm9yLm1lc3NhZ2V9YCxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHRcdDUwMCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0YXNzZXJ0RXhpc3RzKGN1c3RvbWVyLCBcIkN1c3RvbWVyXCIpO1xuXG5cdFx0Ly8gSWYgcHJvcGVydHkgaXMgcHJvdmlkZWQsIHZlcmlmeSBpdCBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY3VzdG9tZXJcblx0XHRpZiAocHJvcGVydHlJZCkge1xuXHRcdFx0Y29uc3QgeyBkYXRhOiBwcm9wZXJ0eSB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJwcm9wZXJ0aWVzXCIpXG5cdFx0XHRcdC5zZWxlY3QoXCJpZCwgY3VzdG9tZXJfaWRcIilcblx0XHRcdFx0LmVxKFwiaWRcIiwgcHJvcGVydHlJZClcblx0XHRcdFx0LmVxKFwiY3VzdG9tZXJfaWRcIiwgY3VzdG9tZXJJZClcblx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRpZiAoIXByb3BlcnR5KSB7XG5cdFx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XHRcIlByb3BlcnR5IG5vdCBmb3VuZCBvciBkb2VzIG5vdCBiZWxvbmcgdG8gdGhpcyBjdXN0b21lclwiLFxuXHRcdFx0XHRcdEVSUk9SX0NPREVTLkRCX1JFQ09SRF9OT1RfRk9VTkQsXG5cdFx0XHRcdFx0NDA0LFxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBqb2Igd2l0aCBjdXN0b21lciBhbmQgcHJvcGVydHlcblx0XHRjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnVwZGF0ZSh7XG5cdFx0XHRcdGN1c3RvbWVyX2lkOiBjdXN0b21lcklkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogcHJvcGVydHlJZCxcblx0XHRcdH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiYXNzaWduIGN1c3RvbWVyIHRvIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyBhY3Rpdml0eVxuXHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JfYWN0aXZpdHlfbG9nXCIpLmluc2VydCh7XG5cdFx0XHRqb2JfaWQ6IGpvYklkLFxuXHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0dXNlcl9pZDogdXNlci5pZCxcblx0XHRcdGFjdGl2aXR5X3R5cGU6IFwiYXNzaWduZWRcIixcblx0XHRcdGVudGl0eV90eXBlOiBcImN1c3RvbWVyXCIsXG5cdFx0XHRkZXNjcmlwdGlvbjogYEFzc2lnbmVkIGN1c3RvbWVyJHtwcm9wZXJ0eUlkID8gXCIgYW5kIHByb3BlcnR5XCIgOiBcIlwifWAsXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IHByb3BlcnR5SWQsXG5cdFx0XHR9LFxuXHRcdH0pO1xuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL3dlbGNvbWVcIik7XG5cdH0pO1xufVxuXG4vKipcbiAqIFJlbW92ZSBDdXN0b21lciBhbmQgUHJvcGVydHkgZnJvbSBKb2JcbiAqXG4gKiBSZW1vdmVzIHRoZSBjdXN0b21lcl9pZCBhbmQgcHJvcGVydHlfaWQgZnJvbSB0aGUgam9iLlxuICogUmVsYXRlZCBkYXRhIChhcHBvaW50bWVudHMsIGludm9pY2VzLCBldGMuKSByZW1haW4gYnV0IGFyZSBubyBsb25nZXIgbGlua2VkLlxuICpcbiAqIEBwYXJhbSBqb2JJZCAtIEpvYiBJRFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVtb3ZlQ3VzdG9tZXJGcm9tSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJjb21wYW55IGFjY2Vzc1wiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogam9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiaWQsIGNvbXBhbnlfaWQsIGN1c3RvbWVyX2lkLCBwcm9wZXJ0eV9pZFwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuZXEoXCJjb21wYW55X2lkXCIsIGNvbXBhbnlJZClcblx0XHRcdC5pcyhcImRlbGV0ZWRfYXRcIiwgbnVsbClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0Ly8gVXBkYXRlIGpvYiB0byByZW1vdmUgY3VzdG9tZXIgYW5kIHByb3BlcnR5XG5cdFx0Y29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRjdXN0b21lcl9pZDogbnVsbCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IG51bGwsXG5cdFx0XHR9KVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpO1xuXG5cdFx0aWYgKHVwZGF0ZUVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcInJlbW92ZSBjdXN0b21lciBmcm9tIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyBhY3Rpdml0eVxuXHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JfYWN0aXZpdHlfbG9nXCIpLmluc2VydCh7XG5cdFx0XHRqb2JfaWQ6IGpvYklkLFxuXHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0dXNlcl9pZDogdXNlci5pZCxcblx0XHRcdGFjdGl2aXR5X3R5cGU6IFwicmVtb3ZlZFwiLFxuXHRcdFx0ZW50aXR5X3R5cGU6IFwiY3VzdG9tZXJcIixcblx0XHRcdGRlc2NyaXB0aW9uOiBcIlJlbW92ZWQgY3VzdG9tZXIgYW5kIHByb3BlcnR5XCIsXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRwcmV2aW91c19jdXN0b21lcl9pZDogam9iLmN1c3RvbWVyX2lkLFxuXHRcdFx0XHRwcmV2aW91c19wcm9wZXJ0eV9pZDogam9iLnByb3BlcnR5X2lkLFxuXHRcdFx0fSxcblx0XHR9KTtcblxuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi93ZWxjb21lXCIpO1xuXHR9KTtcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoieVNBNDREc0IifQ==
}),
"[project]/apps/web/src/actions/data:af9096 [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"40368993c3a55a3b44a53c6a4ebb306c38ad3322c0":"removeCustomerFromJob"},"apps/web/src/actions/jobs.ts",""] */ __turbopack_context__.s([
    "removeCustomerFromJob",
    ()=>removeCustomerFromJob
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next@16.0.4_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
"use turbopack no side effects";
;
var removeCustomerFromJob = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("40368993c3a55a3b44a53c6a4ebb306c38ad3322c0", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$4_$40$opentelemetry$2b$api$40$1$2e$9$2e$0_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "removeCustomerFromJob"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vam9icy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEpvYnMgU2VydmVyIEFjdGlvbnMgLSBSRUZBQ1RPUkVEIEZPUiBET01BSU4gVEFCTEUgU1RSVUNUVVJFXG4gKlxuICogSGFuZGxlcyBqb2Ivd29yayBvcmRlciBtYW5hZ2VtZW50IHdpdGggY29tcHJlaGVuc2l2ZSBDUlVEIG9wZXJhdGlvbnMsXG4gKiBzdGF0dXMgdHJhbnNpdGlvbnMsIHNjaGVkdWxpbmcsIGFuZCBhc3NpZ25tZW50IGxvZ2ljLlxuICpcbiAqIE1JR1JBVElPTiBOT1RFUzpcbiAqIC0gQ29yZSBqb2JzIHRhYmxlIG5vdyBoYXMgfjIwIGNvbHVtbnNcbiAqIC0gRG9tYWluLXNwZWNpZmljIGRhdGEgbW92ZWQgdG8gMTEgZG9tYWluIHRhYmxlc1xuICogLSBGaW5hbmNpYWwgZGF0YSAtPiBqb2JfZmluYW5jaWFsXG4gKiAtIFRpbWUgdHJhY2tpbmcgLT4gam9iX3RpbWVfdHJhY2tpbmdcbiAqIC0gQXJjaGl2ZS9kZWxldGlvbiAtPiBqb2JfbXVsdGlfZW50aXR5XG4gKiAtIEFsbCBkb21haW4gdGFibGVzIGhhdmUgQ0FTQ0FERSBkZWxldGUgb24gam9iX2lkXG4gKi9cblxuXCJ1c2Ugc2VydmVyXCI7XG5cbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5pbXBvcnQgeyBnZXRBY3RpdmVDb21wYW55SWQgfSBmcm9tIFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIjtcbmltcG9ydCB7XG5cdEFjdGlvbkVycm9yLFxuXHRFUlJPUl9DT0RFUyxcblx0RVJST1JfTUVTU0FHRVMsXG59IGZyb20gXCJAL2xpYi9lcnJvcnMvYWN0aW9uLWVycm9yXCI7XG5pbXBvcnQge1xuXHR0eXBlIEFjdGlvblJlc3VsdCxcblx0YXNzZXJ0QXV0aGVudGljYXRlZCxcblx0YXNzZXJ0RXhpc3RzLFxuXHR3aXRoRXJyb3JIYW5kbGluZyxcbn0gZnJvbSBcIkAvbGliL2Vycm9ycy93aXRoLWVycm9yLWhhbmRsaW5nXCI7XG5pbXBvcnQgeyBub3RpZnlKb2JDcmVhdGVkIH0gZnJvbSBcIkAvbGliL25vdGlmaWNhdGlvbnMvdHJpZ2dlcnNcIjtcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAL2xpYi9zdXBhYmFzZS9zZXJ2ZXJcIjtcbmltcG9ydCB7XG5cdHR5cGUgSm9iU3RhdHVzLFxuXHR0eXBlIEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0LFxuXHR2YWxpZGF0ZVN0YXR1c1RyYW5zaXRpb24sXG59IGZyb20gXCJAL2xpYi92YWxpZGF0aW9ucy9qb2Itc3RhdHVzLXRyYW5zaXRpb25zXCI7XG5cbi8vIFJlZ2V4IGNvbnN0YW50c1xuY29uc3QgSk9CX05VTUJFUl9SRUdFWCA9IC9KT0ItXFxkezR9LShcXGQrKS87XG5cbi8vIFZhbGlkYXRpb24gU2NoZW1hc1xuY29uc3QgY3JlYXRlSm9iU2NoZW1hID0gei5vYmplY3Qoe1xuXHRwcm9wZXJ0eUlkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIHByb3BlcnR5IElEXCIpLFxuXHRjdXN0b21lcklkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIGN1c3RvbWVyIElEXCIpLm9wdGlvbmFsKCksXG5cdHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCBcIkpvYiB0aXRsZSBpcyByZXF1aXJlZFwiKSxcblx0ZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblx0cHJpb3JpdHk6IHouZW51bShbXCJsb3dcIiwgXCJtZWRpdW1cIiwgXCJoaWdoXCIsIFwidXJnZW50XCJdKS5kZWZhdWx0KFwibWVkaXVtXCIpLFxuXHRqb2JUeXBlOiB6XG5cdFx0LmVudW0oW1xuXHRcdFx0XCJzZXJ2aWNlXCIsXG5cdFx0XHRcImluc3RhbGxhdGlvblwiLFxuXHRcdFx0XCJyZXBhaXJcIixcblx0XHRcdFwibWFpbnRlbmFuY2VcIixcblx0XHRcdFwiaW5zcGVjdGlvblwiLFxuXHRcdFx0XCJjb25zdWx0YXRpb25cIixcblx0XHRdKVxuXHRcdC5vcHRpb25hbCgpLFxuXHRzY2hlZHVsZWRTdGFydDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRzY2hlZHVsZWRFbmQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblx0YXNzaWduZWRUbzogei5zdHJpbmcoKS51dWlkKFwiSW52YWxpZCB1c2VyIElEXCIpLm9wdGlvbmFsKCksXG5cdG5vdGVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdC8vIEVuaGFuY2VkIHNjaGVkdWxpbmcgZmllbGRzXG5cdGlzUmVjdXJyaW5nOiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuXHRzY2hlZHVsaW5nTW9kZTogei5lbnVtKFtcInNwZWNpZmljXCIsIFwid2luZG93XCJdKS5vcHRpb25hbCgpLFxuXHR0aW1lV2luZG93OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VUeXBlOiB6XG5cdFx0LmVudW0oW1wiZGFpbHlcIiwgXCJ3ZWVrbHlcIiwgXCJiaXdlZWtseVwiLCBcIm1vbnRobHlcIiwgXCJxdWFydGVybHlcIiwgXCJ5ZWFybHlcIl0pXG5cdFx0Lm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VFbmREYXRlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHJlY3VycmVuY2VDb3VudDogei5udW1iZXIoKS5pbnQoKS5taW4oMSkubWF4KDM2NSkub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCB1cGRhdGVKb2JTY2hlbWEgPSB6Lm9iamVjdCh7XG5cdHRpdGxlOiB6LnN0cmluZygpLm1pbigxLCBcIkpvYiB0aXRsZSBpcyByZXF1aXJlZFwiKS5vcHRpb25hbCgpLFxuXHRkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRzdGF0dXM6IHpcblx0XHQuZW51bShbXG5cdFx0XHRcInF1b3RlZFwiLFxuXHRcdFx0XCJzY2hlZHVsZWRcIixcblx0XHRcdFwiaW5fcHJvZ3Jlc3NcIixcblx0XHRcdFwib25faG9sZFwiLFxuXHRcdFx0XCJjb21wbGV0ZWRcIixcblx0XHRcdFwiY2FuY2VsbGVkXCIsXG5cdFx0XHRcImludm9pY2VkXCIsXG5cdFx0XHRcInBhaWRcIixcblx0XHRdKVxuXHRcdC5vcHRpb25hbCgpLFxuXHRwcmlvcml0eTogei5lbnVtKFtcImxvd1wiLCBcIm1lZGl1bVwiLCBcImhpZ2hcIiwgXCJ1cmdlbnRcIl0pLm9wdGlvbmFsKCksXG5cdGpvYlR5cGU6IHpcblx0XHQuZW51bShbXG5cdFx0XHRcInNlcnZpY2VcIixcblx0XHRcdFwiaW5zdGFsbGF0aW9uXCIsXG5cdFx0XHRcInJlcGFpclwiLFxuXHRcdFx0XCJtYWludGVuYW5jZVwiLFxuXHRcdFx0XCJpbnNwZWN0aW9uXCIsXG5cdFx0XHRcImNvbnN1bHRhdGlvblwiLFxuXHRcdF0pXG5cdFx0Lm9wdGlvbmFsKCksXG5cdG5vdGVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdC8vIEZpbmFuY2lhbCBmaWVsZHMgKG5vdyBpbiBqb2JfZmluYW5jaWFsIGRvbWFpbiB0YWJsZSlcblx0dG90YWxBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdHBhaWRBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdGRlcG9zaXRBbW91bnQ6IHoubnVtYmVyKCkubWluKDApLm9wdGlvbmFsKCksXG5cdHNjaGVkdWxlZFN0YXJ0OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cdHNjaGVkdWxlZEVuZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXHRhc3NpZ25lZFRvOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIHVzZXIgSURcIikub3B0aW9uYWwoKS5udWxsYWJsZSgpLFxuXHRjdXN0b21lcklkOiB6LnN0cmluZygpLnV1aWQoXCJJbnZhbGlkIGN1c3RvbWVyIElEXCIpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcblx0cHJvcGVydHlJZDogei5zdHJpbmcoKS51dWlkKFwiSW52YWxpZCBwcm9wZXJ0eSBJRFwiKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG59KTtcblxuLy8gVHlwZSBmb3IgdXBkYXRlSm9iRGF0YSAtIG1ha2VzIGl0IGVhc2llciB0byB1c2UgcHJvZ3JhbW1hdGljYWxseVxuZXhwb3J0IHR5cGUgVXBkYXRlSm9iRGF0YSA9IHouaW5mZXI8dHlwZW9mIHVwZGF0ZUpvYlNjaGVtYT47XG5cbmNvbnN0IHNjaGVkdWxlSm9iU2NoZW1hID0gei5vYmplY3Qoe1xuXHRzY2hlZHVsZWRTdGFydDogei5zdHJpbmcoKSxcblx0c2NoZWR1bGVkRW5kOiB6LnN0cmluZygpLFxufSk7XG5cbi8qKlxuICogR2VuZXJhdGUgdW5pcXVlIGpvYiBudW1iZXJcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVKb2JOdW1iZXIoXG5cdHN1cGFiYXNlOiBhbnksXG5cdGNvbXBhbnlJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxzdHJpbmc+IHtcblx0Ly8gR2V0IHRoZSBsYXRlc3Qgam9iIG51bWJlciBmb3IgdGhpcyBjb21wYW55XG5cdGNvbnN0IHsgZGF0YTogbGF0ZXN0Sm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdC5zZWxlY3QoXCJqb2JfbnVtYmVyXCIpXG5cdFx0LmVxKFwiY29tcGFueV9pZFwiLCBjb21wYW55SWQpXG5cdFx0Lm9yZGVyKFwiY3JlYXRlZF9hdFwiLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcblx0XHQubGltaXQoMSlcblx0XHQuc2luZ2xlKCk7XG5cblx0aWYgKCFsYXRlc3RKb2IpIHtcblx0XHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tMDAxYDtcblx0fVxuXG5cdC8vIEV4dHJhY3QgbnVtYmVyIGZyb20gZm9ybWF0OiBKT0ItWVlZWS1OTk5cblx0Y29uc3QgbWF0Y2ggPSBsYXRlc3RKb2Iuam9iX251bWJlci5tYXRjaChKT0JfTlVNQkVSX1JFR0VYKTtcblx0aWYgKG1hdGNoKSB7XG5cdFx0Y29uc3QgbmV4dE51bWJlciA9IE51bWJlci5wYXJzZUludChtYXRjaFsxXSwgMTApICsgMTtcblx0XHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tJHtuZXh0TnVtYmVyLnRvU3RyaW5nKCkucGFkU3RhcnQoMywgXCIwXCIpfWA7XG5cdH1cblxuXHQvLyBGYWxsYmFja1xuXHRyZXR1cm4gYEpPQi0ke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0tJHtEYXRlLm5vdygpLnRvU3RyaW5nKCkuc2xpY2UoLTMpfWA7XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIG5leHQgcmVjdXJyZW5jZSBkYXRlXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZU5leHRSZWN1cnJlbmNlKFxuXHRjdXJyZW50RGF0ZTogRGF0ZSxcblx0cmVjdXJyZW5jZVR5cGU6IHN0cmluZyxcbik6IERhdGUge1xuXHRjb25zdCBuZXh0RGF0ZSA9IG5ldyBEYXRlKGN1cnJlbnREYXRlKTtcblxuXHRzd2l0Y2ggKHJlY3VycmVuY2VUeXBlKSB7XG5cdFx0Y2FzZSBcImRhaWx5XCI6XG5cdFx0XHRuZXh0RGF0ZS5zZXREYXRlKG5leHREYXRlLmdldERhdGUoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcIndlZWtseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RGF0ZShuZXh0RGF0ZS5nZXREYXRlKCkgKyA3KTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgXCJiaXdlZWtseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RGF0ZShuZXh0RGF0ZS5nZXREYXRlKCkgKyAxNCk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlIFwibW9udGhseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0TW9udGgobmV4dERhdGUuZ2V0TW9udGgoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcInF1YXJ0ZXJseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0TW9udGgobmV4dERhdGUuZ2V0TW9udGgoKSArIDMpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcInllYXJseVwiOlxuXHRcdFx0bmV4dERhdGUuc2V0RnVsbFllYXIobmV4dERhdGUuZ2V0RnVsbFllYXIoKSArIDEpO1xuXHRcdFx0YnJlYWs7XG5cdFx0ZGVmYXVsdDpcblx0XHRcdC8vIERlZmF1bHQgdG8gbW9udGhseSBpZiB1bmtub3duIHR5cGVcblx0XHRcdG5leHREYXRlLnNldE1vbnRoKG5leHREYXRlLmdldE1vbnRoKCkgKyAxKTtcblx0XHRcdGJyZWFrO1xuXHR9XG5cblx0cmV0dXJuIG5leHREYXRlO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZWN1cnJpbmcgam9ic1xuICovXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVSZWN1cnJpbmdKb2JzKFxuXHRzdXBhYmFzZTogYW55LFxuXHRjb21wYW55SWQ6IHN0cmluZyxcblx0YmFzZUpvYjogYW55LFxuXHRyZWN1cnJlbmNlVHlwZTogc3RyaW5nLFxuXHRyZWN1cnJlbmNlRW5kRGF0ZT86IHN0cmluZyxcblx0cmVjdXJyZW5jZUNvdW50PzogbnVtYmVyLFxuKTogUHJvbWlzZTx2b2lkPiB7XG5cdGlmICghYmFzZUpvYi5zY2hlZHVsZWRfc3RhcnQpIHtcblx0XHRyZXR1cm47IC8vIENhbid0IGNyZWF0ZSByZWN1cnJpbmcgam9icyB3aXRob3V0IGEgc3RhcnQgZGF0ZVxuXHR9XG5cblx0Y29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoYmFzZUpvYi5zY2hlZHVsZWRfc3RhcnQpO1xuXHRjb25zdCBlbmREYXRlID0gbmV3IERhdGUoYmFzZUpvYi5zY2hlZHVsZWRfZW5kIHx8IGJhc2VKb2Iuc2NoZWR1bGVkX3N0YXJ0KTtcblx0Y29uc3QgZHVyYXRpb24gPSBlbmREYXRlLmdldFRpbWUoKSAtIHN0YXJ0RGF0ZS5nZXRUaW1lKCk7XG5cblx0Ly8gRGV0ZXJtaW5lIGhvdyBtYW55IG9jY3VycmVuY2VzIHRvIGNyZWF0ZVxuXHRjb25zdCBtYXhPY2N1cnJlbmNlcyA9IHJlY3VycmVuY2VDb3VudCB8fCA1MjsgLy8gRGVmYXVsdCB0byAxIHllYXIgb2Ygd2Vla2x5IGpvYnNcblx0Y29uc3QgZW5kRGF0ZUxpbWl0ID0gcmVjdXJyZW5jZUVuZERhdGUgPyBuZXcgRGF0ZShyZWN1cnJlbmNlRW5kRGF0ZSkgOiBudWxsO1xuXG5cdGNvbnN0IHJlY3VycmluZ0pvYnM6ICh0eXBlb2YgYmFzZUpvYilbXSA9IFtdO1xuXHRsZXQgY3VycmVudERhdGUgPSBuZXcgRGF0ZShzdGFydERhdGUpO1xuXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgbWF4T2NjdXJyZW5jZXMgLSAxOyBpKyspIHtcblx0XHQvLyAtMSBiZWNhdXNlIHdlIGFscmVhZHkgY3JlYXRlZCB0aGUgZmlyc3Qgam9iXG5cdFx0Y3VycmVudERhdGUgPSBjYWxjdWxhdGVOZXh0UmVjdXJyZW5jZShjdXJyZW50RGF0ZSwgcmVjdXJyZW5jZVR5cGUpO1xuXG5cdFx0Ly8gU3RvcCBpZiB3ZSd2ZSByZWFjaGVkIHRoZSBlbmQgZGF0ZVxuXHRcdGlmIChlbmREYXRlTGltaXQgJiYgY3VycmVudERhdGUgPiBlbmREYXRlTGltaXQpIHtcblx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdGNvbnN0IGN1cnJlbnRFbmREYXRlID0gbmV3IERhdGUoY3VycmVudERhdGUuZ2V0VGltZSgpICsgZHVyYXRpb24pO1xuXG5cdFx0Ly8gR2VuZXJhdGUgYSB1bmlxdWUgam9iIG51bWJlciBmb3IgdGhpcyBvY2N1cnJlbmNlXG5cdFx0Y29uc3Qgam9iTnVtYmVyID0gYXdhaXQgZ2VuZXJhdGVKb2JOdW1iZXIoc3VwYWJhc2UsIGNvbXBhbnlJZCk7XG5cblx0XHRyZWN1cnJpbmdKb2JzLnB1c2goe1xuXHRcdFx0Li4uYmFzZUpvYixcblx0XHRcdGpvYl9udW1iZXI6IGpvYk51bWJlcixcblx0XHRcdHNjaGVkdWxlZF9zdGFydDogY3VycmVudERhdGUudG9JU09TdHJpbmcoKSxcblx0XHRcdHNjaGVkdWxlZF9lbmQ6IGN1cnJlbnRFbmREYXRlLnRvSVNPU3RyaW5nKCksXG5cdFx0XHR0aXRsZTogYCR7YmFzZUpvYi50aXRsZX0gKCR7aSArIDJ9LyR7bWF4T2NjdXJyZW5jZXN9KWAsIC8vIEFkZCBvY2N1cnJlbmNlIG51bWJlclxuXHRcdH0pO1xuXG5cdFx0Ly8gQ3JlYXRlIGpvYnMgaW4gYmF0Y2hlcyBvZiAxMCB0byBhdm9pZCBtZW1vcnkgaXNzdWVzXG5cdFx0aWYgKHJlY3VycmluZ0pvYnMubGVuZ3RoID49IDEwKSB7XG5cdFx0XHRhd2FpdCBzdXBhYmFzZS5mcm9tKFwiam9ic1wiKS5pbnNlcnQocmVjdXJyaW5nSm9icyk7XG5cdFx0XHRyZWN1cnJpbmdKb2JzLmxlbmd0aCA9IDA7IC8vIENsZWFyIGFycmF5XG5cdFx0fVxuXHR9XG5cblx0Ly8gSW5zZXJ0IGFueSByZW1haW5pbmcgam9ic1xuXHRpZiAocmVjdXJyaW5nSm9icy5sZW5ndGggPiAwKSB7XG5cdFx0YXdhaXQgc3VwYWJhc2UuZnJvbShcImpvYnNcIikuaW5zZXJ0KHJlY3VycmluZ0pvYnMpO1xuXHR9XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgbmV3IGpvYlxuICog4pyFIEFMUkVBRFkgTUlHUkFURUQgLSBDcmVhdGVzIGNvcmUgam9iICsgYWxsIDEwIGRvbWFpbiByZWNvcmRzIGluIHBhcmFsbGVsXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVKb2IoXG5cdGZvcm1EYXRhOiBGb3JtRGF0YSxcbik6IFByb21pc2U8QWN0aW9uUmVzdWx0PHN0cmluZz4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSBjcmVhdGVKb2JTY2hlbWEucGFyc2Uoe1xuXHRcdFx0cHJvcGVydHlJZDogZm9ybURhdGEuZ2V0KFwicHJvcGVydHlJZFwiKSxcblx0XHRcdGN1c3RvbWVySWQ6IGZvcm1EYXRhLmdldChcImN1c3RvbWVySWRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0dGl0bGU6IGZvcm1EYXRhLmdldChcInRpdGxlXCIpLFxuXHRcdFx0ZGVzY3JpcHRpb246IGZvcm1EYXRhLmdldChcImRlc2NyaXB0aW9uXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdHByaW9yaXR5OiBmb3JtRGF0YS5nZXQoXCJwcmlvcml0eVwiKSB8fCBcIm1lZGl1bVwiLFxuXHRcdFx0am9iVHlwZTogZm9ybURhdGEuZ2V0KFwiam9iVHlwZVwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRzY2hlZHVsZWRTdGFydDogZm9ybURhdGEuZ2V0KFwic2NoZWR1bGVkU3RhcnRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0c2NoZWR1bGVkRW5kOiBmb3JtRGF0YS5nZXQoXCJzY2hlZHVsZWRFbmRcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0YXNzaWduZWRUbzogZm9ybURhdGEuZ2V0KFwiYXNzaWduZWRUb1wiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRub3RlczogZm9ybURhdGEuZ2V0KFwibm90ZXNcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0Ly8gRW5oYW5jZWQgc2NoZWR1bGluZyBmaWVsZHNcblx0XHRcdGlzUmVjdXJyaW5nOiBmb3JtRGF0YS5nZXQoXCJpc1JlY3VycmluZ1wiKSA9PT0gXCJ0cnVlXCIsXG5cdFx0XHRzY2hlZHVsaW5nTW9kZTogKGZvcm1EYXRhLmdldChcInNjaGVkdWxpbmdNb2RlXCIpIGFzIGFueSkgfHwgdW5kZWZpbmVkLFxuXHRcdFx0dGltZVdpbmRvdzogZm9ybURhdGEuZ2V0KFwidGltZVdpbmRvd1wiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRyZWN1cnJlbmNlVHlwZTogKGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VUeXBlXCIpIGFzIGFueSkgfHwgdW5kZWZpbmVkLFxuXHRcdFx0cmVjdXJyZW5jZUVuZERhdGU6IGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VFbmREYXRlXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdHJlY3VycmVuY2VDb3VudDogZm9ybURhdGEuZ2V0KFwicmVjdXJyZW5jZUNvdW50XCIpXG5cdFx0XHRcdD8gTnVtYmVyLnBhcnNlSW50KGZvcm1EYXRhLmdldChcInJlY3VycmVuY2VDb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHR9KTtcblxuXHRcdC8vIFZlcmlmeSBwcm9wZXJ0eSBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IHByb3BlcnR5IH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJwcm9wZXJ0aWVzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgY3VzdG9tZXJfaWQsIGFkZHJlc3NcIilcblx0XHRcdC5lcShcImlkXCIsIGRhdGEucHJvcGVydHlJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhwcm9wZXJ0eSwgXCJQcm9wZXJ0eVwiKTtcblxuXHRcdGlmIChwcm9wZXJ0eS5jb21wYW55X2lkICE9PSBjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwicHJvcGVydHlcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVzZSBjdXN0b21lciBmcm9tIHByb3BlcnR5IGlmIG5vdCBwcm92aWRlZFxuXHRcdGNvbnN0IGN1c3RvbWVySWQgPSBkYXRhLmN1c3RvbWVySWQgfHwgcHJvcGVydHkuY3VzdG9tZXJfaWQ7XG5cblx0XHQvLyBHZW5lcmF0ZSB1bmlxdWUgam9iIG51bWJlclxuXHRcdGNvbnN0IGpvYk51bWJlciA9IGF3YWl0IGdlbmVyYXRlSm9iTnVtYmVyKHN1cGFiYXNlLCBjb21wYW55SWQpO1xuXG5cdFx0Ly8gQWRkIHRpbWUgd2luZG93IGluZm8gdG8gbm90ZXMgaWYgYXBwbGljYWJsZVxuXHRcdGxldCBqb2JOb3RlcyA9IGRhdGEubm90ZXMgfHwgXCJcIjtcblx0XHRpZiAoZGF0YS5zY2hlZHVsaW5nTW9kZSA9PT0gXCJ3aW5kb3dcIiAmJiBkYXRhLnRpbWVXaW5kb3cpIHtcblx0XHRcdGNvbnN0IHdpbmRvd0luZm8gPSBgXFxuXFxuW1NjaGVkdWxpbmddIEN1c3RvbWVyIHByZWZlcnJlZCB0aW1lIHdpbmRvdzogJHtkYXRhLnRpbWVXaW5kb3cuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBkYXRhLnRpbWVXaW5kb3cuc2xpY2UoMSl9YDtcblx0XHRcdGpvYk5vdGVzID0gam9iTm90ZXMgPyBgJHtqb2JOb3Rlc30ke3dpbmRvd0luZm99YCA6IHdpbmRvd0luZm8udHJpbSgpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBjb3JlIGpvYiByZWNvcmRcblx0XHRjb25zdCB7IGRhdGE6IG5ld0pvYiwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogZGF0YS5wcm9wZXJ0eUlkLFxuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0YXNzaWduZWRfdG86IGRhdGEuYXNzaWduZWRUbyxcblx0XHRcdFx0am9iX251bWJlcjogam9iTnVtYmVyLFxuXHRcdFx0XHR0aXRsZTogZGF0YS50aXRsZSxcblx0XHRcdFx0ZGVzY3JpcHRpb246IGRhdGEuZGVzY3JpcHRpb24sXG5cdFx0XHRcdHN0YXR1czogXCJxdW90ZWRcIixcblx0XHRcdFx0cHJpb3JpdHk6IGRhdGEucHJpb3JpdHksXG5cdFx0XHRcdGpvYl90eXBlOiBkYXRhLmpvYlR5cGUsXG5cdFx0XHRcdHNlcnZpY2VfdHlwZTogZGF0YS5qb2JUeXBlLCAvLyBEZWZhdWx0IHNlcnZpY2VfdHlwZSB0byBqb2JfdHlwZVxuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRub3Rlczogam9iTm90ZXMsXG5cdFx0XHR9KVxuXHRcdFx0LnNlbGVjdChcImlkXCIpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoY3JlYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiY3JlYXRlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBkb21haW4gcmVjb3JkcyAocGFyYWxsZWwgaW5zZXJ0cyBmb3IgcGVyZm9ybWFuY2UpXG5cdFx0Y29uc3QgZG9tYWluSW5zZXJ0cyA9IGF3YWl0IFByb21pc2UuYWxsKFtcblx0XHRcdC8vIEZpbmFuY2lhbCBkb21haW4gLSBhbHdheXMgY3JlYXRlIHdpdGggZGVmYXVsdHNcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2ZpbmFuY2lhbFwiKVxuXHRcdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0XHRqb2JfaWQ6IG5ld0pvYi5pZCxcblx0XHRcdFx0XHRjb21wYW55X2lkOiBjb21wYW55SWQsXG5cdFx0XHRcdFx0dG90YWxfYW1vdW50OiAwLFxuXHRcdFx0XHRcdHBhaWRfYW1vdW50OiAwLFxuXHRcdFx0XHRcdGRlcG9zaXRfYW1vdW50OiAwLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gV29ya2Zsb3cgZG9tYWluIC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2Jfd29ya2Zsb3dcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdHdvcmtmbG93X2NvbXBsZXRlZF9zdGFnZXM6IFtdLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gVGltZSB0cmFja2luZyAtIGFsd2F5cyBjcmVhdGVcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX3RpbWVfdHJhY2tpbmdcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdHRvdGFsX2xhYm9yX2hvdXJzOiAwLFxuXHRcdFx0XHRcdGJyZWFrX3RpbWVfbWludXRlczogMCxcblx0XHRcdFx0fSksXG5cblx0XHRcdC8vIEN1c3RvbWVyIGFwcHJvdmFsIC0gYWx3YXlzIGNyZWF0ZSB3aXRoIHBlbmRpbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2N1c3RvbWVyX2FwcHJvdmFsXCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRjdXN0b21lcl9hcHByb3ZhbF9zdGF0dXM6IFwicGVuZGluZ1wiLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gRXF1aXBtZW50IHNlcnZpY2UgLSBhbHdheXMgY3JlYXRlXG5cdFx0XHRzdXBhYmFzZVxuXHRcdFx0XHQuZnJvbShcImpvYl9lcXVpcG1lbnRfc2VydmljZVwiKVxuXHRcdFx0XHQuaW5zZXJ0KHtcblx0XHRcdFx0XHRqb2JfaWQ6IG5ld0pvYi5pZCxcblx0XHRcdFx0XHRjb21wYW55X2lkOiBjb21wYW55SWQsXG5cdFx0XHRcdFx0ZXF1aXBtZW50X3NlcnZpY2VfaGlzdG9yeTogW10sXG5cdFx0XHRcdFx0ZXF1aXBtZW50X3NlcnZpY2VkOiBbXSxcblx0XHRcdFx0fSksXG5cblx0XHRcdC8vIERpc3BhdGNoIC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfZGlzcGF0Y2hcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gUXVhbGl0eSAtIGFsd2F5cyBjcmVhdGVcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX3F1YWxpdHlcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRcdGluc3BlY3Rpb25fcmVxdWlyZWQ6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gU2FmZXR5IC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2Jfc2FmZXR5XCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRyZXF1aXJlc19wZXJtaXQ6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gQUkgZW5yaWNobWVudCAtIGNyZWF0ZSBlbXB0eSBmb3IgZnV0dXJlIHByb2Nlc3Npbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX2FpX2VucmljaG1lbnRcIilcblx0XHRcdFx0Lmluc2VydCh7XG5cdFx0XHRcdFx0am9iX2lkOiBuZXdKb2IuaWQsXG5cdFx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHR9KSxcblxuXHRcdFx0Ly8gTXVsdGktZW50aXR5IC0gYWx3YXlzIGNyZWF0ZVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfbXVsdGlfZW50aXR5XCIpXG5cdFx0XHRcdC5pbnNlcnQoe1xuXHRcdFx0XHRcdGpvYl9pZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRcdGNvbXBhbnlfaWQ6IGNvbXBhbnlJZCxcblx0XHRcdFx0XHRyZXF1aXJlc19tdWx0aXBsZV9wcm9wZXJ0aWVzOiBmYWxzZSxcblx0XHRcdFx0XHRyZXF1aXJlc19tdWx0aXBsZV9jdXN0b21lcnM6IGZhbHNlLFxuXHRcdFx0XHR9KSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBhbnkgZG9tYWluIGluc2VydCBlcnJvcnNcblx0XHRjb25zdCBkb21haW5FcnJvcnMgPSBkb21haW5JbnNlcnRzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuZXJyb3IpO1xuXHRcdGlmIChkb21haW5FcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0Ly8gUm9sbGJhY2sgLSBkZWxldGUgdGhlIGpvYiAoQ0FTQ0FERSB3aWxsIGRlbGV0ZSBkb21haW4gcmVjb3Jkcylcblx0XHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JzXCIpLmRlbGV0ZSgpLmVxKFwiaWRcIiwgbmV3Sm9iLmlkKTtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiY3JlYXRlIGpvYiBkb21haW5zXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQ3JlYXRlIHJlY3VycmluZyBqb2JzIGlmIHJlcXVlc3RlZFxuXHRcdGlmIChkYXRhLmlzUmVjdXJyaW5nICYmIGRhdGEucmVjdXJyZW5jZVR5cGUgJiYgZGF0YS5zY2hlZHVsZWRTdGFydCkge1xuXHRcdFx0Y29uc3QgYmFzZUpvYiA9IHtcblx0XHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogZGF0YS5wcm9wZXJ0eUlkLFxuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0YXNzaWduZWRfdG86IGRhdGEuYXNzaWduZWRUbyxcblx0XHRcdFx0dGl0bGU6IGRhdGEudGl0bGUsXG5cdFx0XHRcdGRlc2NyaXB0aW9uOiBkYXRhLmRlc2NyaXB0aW9uLFxuXHRcdFx0XHRzdGF0dXM6IFwicXVvdGVkXCIsXG5cdFx0XHRcdHByaW9yaXR5OiBkYXRhLnByaW9yaXR5LFxuXHRcdFx0XHRqb2JfdHlwZTogZGF0YS5qb2JUeXBlLFxuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRub3RlczogZGF0YS5ub3Rlcyxcblx0XHRcdH07XG5cblx0XHRcdGF3YWl0IGNyZWF0ZVJlY3VycmluZ0pvYnMoXG5cdFx0XHRcdHN1cGFiYXNlLFxuXHRcdFx0XHRjb21wYW55SWQsXG5cdFx0XHRcdGJhc2VKb2IsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZVR5cGUsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZUVuZERhdGUsXG5cdFx0XHRcdGRhdGEucmVjdXJyZW5jZUNvdW50LFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBTZW5kIG5vdGlmaWNhdGlvbiB0byBhc3NpZ25lZCB1c2VyIGlmIGpvYiBpcyBhc3NpZ25lZFxuXHRcdGlmIChkYXRhLmFzc2lnbmVkVG8gJiYgZGF0YS5hc3NpZ25lZFRvICE9PSB1c2VyLmlkKSB7XG5cdFx0XHRhd2FpdCBub3RpZnlKb2JDcmVhdGVkKHtcblx0XHRcdFx0dXNlcklkOiBkYXRhLmFzc2lnbmVkVG8sXG5cdFx0XHRcdGNvbXBhbnlJZDogY29tcGFueUlkLFxuXHRcdFx0XHRqb2JJZDogbmV3Sm9iLmlkLFxuXHRcdFx0XHRqb2JUaXRsZTogZGF0YS50aXRsZSxcblx0XHRcdFx0YWRkcmVzczogcHJvcGVydHkuYWRkcmVzcyB8fCBcIlVua25vd24gYWRkcmVzc1wiLFxuXHRcdFx0XHRwcmlvcml0eTpcblx0XHRcdFx0XHRkYXRhLnByaW9yaXR5ID09PSBcInVyZ2VudFwiXG5cdFx0XHRcdFx0XHQ/IFwidXJnZW50XCJcblx0XHRcdFx0XHRcdDogZGF0YS5wcmlvcml0eSA9PT0gXCJoaWdoXCJcblx0XHRcdFx0XHRcdFx0PyBcImhpZ2hcIlxuXHRcdFx0XHRcdFx0XHQ6IFwibWVkaXVtXCIsXG5cdFx0XHRcdGFjdGlvblVybDogXCIvZGFzaGJvYXJkL3dvcmtcIixcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrL2pvYnNcIik7XG5cdFx0cmV0dXJuIG5ld0pvYi5pZDtcblx0fSk7XG59XG5cbi8qKlxuICogR2V0IGEgc2luZ2xlIGpvYiBieSBJRFxuICog4pyFIEFMUkVBRFkgTUlHUkFURUQgLSBGZXRjaGVzIGpvYiB3aXRoIGFsbCBkb21haW4gZGF0YVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueT4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBqb2Igd2l0aCBiYXNpYyByZWxhdGlvbnNoaXBzXG5cdFx0Ly8gU2ltcGxpZmllZCBxdWVyeSAtIG1hbnkgZG9tYWluIHRhYmxlcyBkb24ndCBleGlzdCB5ZXRcblx0XHRjb25zdCB7IGRhdGE6IGpvYiwgZXJyb3I6IGpvYkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRgXG5cdFx0XHRcdCosXG5cdFx0XHRcdHByb3BlcnR5OnByb3BlcnRpZXMoKiksXG5cdFx0XHRcdGN1c3RvbWVyOmN1c3RvbWVycyFjdXN0b21lcl9pZChpZCwgZmlyc3RfbmFtZSwgbGFzdF9uYW1lLCBlbWFpbCwgcGhvbmUsIGRpc3BsYXlfbmFtZSlcblx0XHRcdGAsXG5cdFx0XHQpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGpvYkVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm5vdEZvdW5kKFwiSm9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9SRUNPUkRfTk9UX0ZPVU5ELFxuXHRcdFx0XHQ0MDQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRpZiAoam9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBqb2I7XG5cdH0pO1xufVxuXG4vKipcbiAqIFVwZGF0ZSBqb2IgZGV0YWlsc1xuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgYm90aCBjb3JlIGpvYnMgdGFibGUgYW5kIGRvbWFpbiB0YWJsZXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYihcblx0am9iSWQ6IHN0cmluZyxcblx0Zm9ybURhdGE6IEZvcm1EYXRhLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IGFjdGl2ZSBjb21wYW55IElEXG5cdFx0Y29uc3QgYWN0aXZlQ29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cdFx0aWYgKCFhY3RpdmVDb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgdXNlcidzIHJvbGUgdG8gY2hlY2sgaWYgdGhleSdyZSBhZG1pbi9vd25lclxuXHRcdGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiY29tcGFueV9tZW1iZXJzaGlwc1wiKVxuXHRcdFx0LnNlbGVjdChcblx0XHRcdFx0YFxuICAgICAgICByb2xlX2lkLFxuICAgICAgICBjdXN0b21fcm9sZXMhcm9sZV9pZChuYW1lLCBpc19zeXN0ZW0pXG4gICAgICBgLFxuXHRcdFx0KVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LmVxKFwiY29tcGFueV9pZFwiLCBhY3RpdmVDb21wYW55SWQpXG5cdFx0XHQuZXEoXCJzdGF0dXNcIiwgXCJhY3RpdmVcIilcblx0XHRcdC5tYXliZVNpbmdsZSgpO1xuXG5cdFx0Y29uc3Qgcm9sZSA9IEFycmF5LmlzQXJyYXkodGVhbU1lbWJlcj8uY3VzdG9tX3JvbGVzKVxuXHRcdFx0PyB0ZWFtTWVtYmVyLmN1c3RvbV9yb2xlc1swXVxuXHRcdFx0OiB0ZWFtTWVtYmVyPy5jdXN0b21fcm9sZXM7XG5cblx0XHRjb25zdCBpc0FkbWluT3JPd25lciA9XG5cdFx0XHRyb2xlPy5uYW1lID09PSBcIkFkbWluXCIgfHxcblx0XHRcdHJvbGU/Lm5hbWUgPT09IFwiT3duZXJcIiB8fFxuXHRcdFx0cm9sZT8uaXNfc3lzdGVtID09PSB0cnVlO1xuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhleGlzdGluZ0pvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoZXhpc3RpbmdKb2IuY29tcGFueV9pZCAhPT0gYWN0aXZlQ29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUHJldmVudCBlZGl0aW5nIGNvbXBsZXRlZCBvciBjYW5jZWxsZWQgam9icyAodW5sZXNzIGFkbWluL293bmVyKVxuXHRcdGlmIChcblx0XHRcdCFpc0FkbWluT3JPd25lciAmJlxuXHRcdFx0KGV4aXN0aW5nSm9iLnN0YXR1cyA9PT0gXCJjb21wbGV0ZWRcIiB8fCBleGlzdGluZ0pvYi5zdGF0dXMgPT09IFwiY2FuY2VsbGVkXCIpXG5cdFx0KSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBDYW5ub3QgZWRpdCAke2V4aXN0aW5nSm9iLnN0YXR1c30gam9ic2AsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgY3VzdG9tZXJJZFZhbHVlID0gZm9ybURhdGEuZ2V0KFwiY3VzdG9tZXJJZFwiKTtcblx0XHRjb25zdCBwcm9wZXJ0eUlkVmFsdWUgPSBmb3JtRGF0YS5nZXQoXCJwcm9wZXJ0eUlkXCIpO1xuXG5cdFx0Ly8gSGFuZGxlIGN1c3RvbWVySWQ6IGVtcHR5IHN0cmluZyBvciBcIm51bGxcIiBzdHJpbmcgbWVhbnMgcmVtb3ZlIChzZXQgdG8gbnVsbClcblx0XHQvLyB1bmRlZmluZWQgbWVhbnMgZG9uJ3QgY2hhbmdlIGl0XG5cdFx0bGV0IHBhcnNlZEN1c3RvbWVySWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG5cdFx0aWYgKGN1c3RvbWVySWRWYWx1ZSA9PT0gbnVsbCB8fCBjdXN0b21lcklkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyc2VkQ3VzdG9tZXJJZCA9IHVuZGVmaW5lZDsgLy8gRG9uJ3QgY2hhbmdlXG5cdFx0fSBlbHNlIGlmIChjdXN0b21lcklkVmFsdWUgPT09IFwiXCIgfHwgY3VzdG9tZXJJZFZhbHVlID09PSBcIm51bGxcIikge1xuXHRcdFx0cGFyc2VkQ3VzdG9tZXJJZCA9IG51bGw7IC8vIFJlbW92ZSBjdXN0b21lclxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJzZWRDdXN0b21lcklkID0gY3VzdG9tZXJJZFZhbHVlIGFzIHN0cmluZzsgLy8gU2V0IHRvIHRoaXMgY3VzdG9tZXJcblx0XHR9XG5cblx0XHQvLyBIYW5kbGUgcHJvcGVydHlJZDogZW1wdHkgc3RyaW5nIG1lYW5zIHJlbW92ZSAoc2V0IHRvIG51bGwpLCB1bmRlZmluZWQgbWVhbnMgZG9uJ3QgY2hhbmdlXG5cdFx0bGV0IHBhcnNlZFByb3BlcnR5SWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XG5cdFx0aWYgKHByb3BlcnR5SWRWYWx1ZSA9PT0gbnVsbCB8fCBwcm9wZXJ0eUlkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyc2VkUHJvcGVydHlJZCA9IHVuZGVmaW5lZDsgLy8gRG9uJ3QgY2hhbmdlXG5cdFx0fSBlbHNlIGlmIChwcm9wZXJ0eUlkVmFsdWUgPT09IFwiXCIgfHwgcHJvcGVydHlJZFZhbHVlID09PSBcIm51bGxcIikge1xuXHRcdFx0cGFyc2VkUHJvcGVydHlJZCA9IG51bGw7IC8vIFJlbW92ZSBwcm9wZXJ0eVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJzZWRQcm9wZXJ0eUlkID0gcHJvcGVydHlJZFZhbHVlIGFzIHN0cmluZzsgLy8gU2V0IHRvIHRoaXMgcHJvcGVydHlcblx0XHR9XG5cblx0XHRjb25zdCBkYXRhID0gdXBkYXRlSm9iU2NoZW1hLnBhcnNlKHtcblx0XHRcdHRpdGxlOiBmb3JtRGF0YS5nZXQoXCJ0aXRsZVwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRkZXNjcmlwdGlvbjogZm9ybURhdGEuZ2V0KFwiZGVzY3JpcHRpb25cIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0c3RhdHVzOiBmb3JtRGF0YS5nZXQoXCJzdGF0dXNcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0cHJpb3JpdHk6IGZvcm1EYXRhLmdldChcInByaW9yaXR5XCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdGpvYlR5cGU6IGZvcm1EYXRhLmdldChcImpvYlR5cGVcIikgfHwgdW5kZWZpbmVkLFxuXHRcdFx0bm90ZXM6IGZvcm1EYXRhLmdldChcIm5vdGVzXCIpIHx8IHVuZGVmaW5lZCxcblx0XHRcdC8vIEZpbmFuY2lhbCBmaWVsZHMgKG5vdyBpbiBqb2JfZmluYW5jaWFsIGRvbWFpbiB0YWJsZSlcblx0XHRcdHRvdGFsQW1vdW50OiBmb3JtRGF0YS5nZXQoXCJ0b3RhbEFtb3VudFwiKVxuXHRcdFx0XHQ/IE51bWJlci5wYXJzZUludChmb3JtRGF0YS5nZXQoXCJ0b3RhbEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdHBhaWRBbW91bnQ6IGZvcm1EYXRhLmdldChcInBhaWRBbW91bnRcIilcblx0XHRcdFx0PyBOdW1iZXIucGFyc2VJbnQoZm9ybURhdGEuZ2V0KFwicGFpZEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdGRlcG9zaXRBbW91bnQ6IGZvcm1EYXRhLmdldChcImRlcG9zaXRBbW91bnRcIilcblx0XHRcdFx0PyBOdW1iZXIucGFyc2VJbnQoZm9ybURhdGEuZ2V0KFwiZGVwb3NpdEFtb3VudFwiKSBhcyBzdHJpbmcsIDEwKVxuXHRcdFx0XHQ6IHVuZGVmaW5lZCxcblx0XHRcdHNjaGVkdWxlZFN0YXJ0OiBmb3JtRGF0YS5nZXQoXCJzY2hlZHVsZWRTdGFydFwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRzY2hlZHVsZWRFbmQ6IGZvcm1EYXRhLmdldChcInNjaGVkdWxlZEVuZFwiKSB8fCB1bmRlZmluZWQsXG5cdFx0XHRhc3NpZ25lZFRvOiBmb3JtRGF0YS5nZXQoXCJhc3NpZ25lZFRvXCIpIHx8IG51bGwsXG5cdFx0XHRjdXN0b21lcklkOiBwYXJzZWRDdXN0b21lcklkLFxuXHRcdFx0cHJvcGVydHlJZDogcGFyc2VkUHJvcGVydHlJZCxcblx0XHR9KTtcblxuXHRcdC8vIElmIHN0YXR1cyBpcyBiZWluZyBjaGFuZ2VkLCB2YWxpZGF0ZSB0aGUgdHJhbnNpdGlvblxuXHRcdGlmIChkYXRhLnN0YXR1cyAhPT0gdW5kZWZpbmVkICYmIGRhdGEuc3RhdHVzICE9PSBleGlzdGluZ0pvYi5zdGF0dXMpIHtcblx0XHRcdC8vIEZldGNoIGFkZGl0aW9uYWwgY29udGV4dCBmb3Igc3RhdHVzIHZhbGlkYXRpb25cblx0XHRcdGNvbnN0IHsgZGF0YTogam9iV2l0aENvbnRleHQgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRcdGBcblx0XHRcdFx0XHRpZCxcblx0XHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdFx0c2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRcdHNjaGVkdWxlZF9lbmQsXG5cdFx0XHRcdFx0YXNzaWduZWRfdG8sXG5cdFx0XHRcdFx0Y3VzdG9tZXJfaWQsXG5cdFx0XHRcdFx0cHJvcGVydHlfaWQsXG5cdFx0XHRcdFx0dG90YWxfYW1vdW50LFxuXHRcdFx0XHRcdGludm9pY2VzOmludm9pY2VzKHN0YXR1cywgdG90YWxfYW1vdW50KSxcblx0XHRcdFx0XHRlc3RpbWF0ZXM6ZXN0aW1hdGVzKHN0YXR1cyksXG5cdFx0XHRcdFx0dGVhbV9hc3NpZ25tZW50czpqb2JfdGVhbV9hc3NpZ25tZW50cyh0ZWFtX21lbWJlcl9pZClcblx0XHRcdFx0YCxcblx0XHRcdFx0KVxuXHRcdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRpZiAoam9iV2l0aENvbnRleHQpIHtcblx0XHRcdFx0Y29uc3QgdHJhbnNpdGlvbkNvbnRleHQ6IEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0ID0ge1xuXHRcdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGpvYldpdGhDb250ZXh0LnN0YXR1cyBhcyBKb2JTdGF0dXMsXG5cdFx0XHRcdFx0bmV3U3RhdHVzOiBkYXRhLnN0YXR1cyBhcyBKb2JTdGF0dXMsXG5cdFx0XHRcdFx0am9iOiB7XG5cdFx0XHRcdFx0XHRpZDogam9iV2l0aENvbnRleHQuaWQsXG5cdFx0XHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6XG5cdFx0XHRcdFx0XHRcdGRhdGEuc2NoZWR1bGVkU3RhcnQgfHwgam9iV2l0aENvbnRleHQuc2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRcdFx0c2NoZWR1bGVkX2VuZDogZGF0YS5zY2hlZHVsZWRFbmQgfHwgam9iV2l0aENvbnRleHQuc2NoZWR1bGVkX2VuZCxcblx0XHRcdFx0XHRcdGFzc2lnbmVkX3RvOlxuXHRcdFx0XHRcdFx0XHRkYXRhLmFzc2lnbmVkVG8gIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5hc3NpZ25lZFRvXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5hc3NpZ25lZF90byxcblx0XHRcdFx0XHRcdGN1c3RvbWVyX2lkOlxuXHRcdFx0XHRcdFx0XHRkYXRhLmN1c3RvbWVySWQgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5jdXN0b21lcklkXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5jdXN0b21lcl9pZCxcblx0XHRcdFx0XHRcdHByb3BlcnR5X2lkOlxuXHRcdFx0XHRcdFx0XHRkYXRhLnByb3BlcnR5SWQgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRcdD8gZGF0YS5wcm9wZXJ0eUlkXG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC5wcm9wZXJ0eV9pZCxcblx0XHRcdFx0XHRcdHRvdGFsX2Ftb3VudDpcblx0XHRcdFx0XHRcdFx0ZGF0YS50b3RhbEFtb3VudCAhPT0gdW5kZWZpbmVkXG5cdFx0XHRcdFx0XHRcdFx0PyBkYXRhLnRvdGFsQW1vdW50XG5cdFx0XHRcdFx0XHRcdFx0OiBqb2JXaXRoQ29udGV4dC50b3RhbF9hbW91bnQsXG5cdFx0XHRcdFx0XHRpbnZvaWNlczogam9iV2l0aENvbnRleHQuaW52b2ljZXMgfHwgW10sXG5cdFx0XHRcdFx0XHRlc3RpbWF0ZXM6IGpvYldpdGhDb250ZXh0LmVzdGltYXRlcyB8fCBbXSxcblx0XHRcdFx0XHRcdHRlYW1Bc3NpZ25tZW50czogam9iV2l0aENvbnRleHQudGVhbV9hc3NpZ25tZW50cyB8fCBbXSxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSB2YWxpZGF0ZVN0YXR1c1RyYW5zaXRpb24odHJhbnNpdGlvbkNvbnRleHQpO1xuXG5cdFx0XHRcdGlmICghdmFsaWRhdGlvblJlc3VsdC5hbGxvd2VkKSB7XG5cdFx0XHRcdFx0bGV0IGVycm9yTWVzc2FnZSA9XG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlYXNvbiB8fCBcIlN0YXR1cyB0cmFuc2l0aW9uIG5vdCBhbGxvd2VkXCI7XG5cblx0XHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlcXVpcmVkRmllbGRzICYmXG5cdFx0XHRcdFx0XHR2YWxpZGF0aW9uUmVzdWx0LnJlcXVpcmVkRmllbGRzLmxlbmd0aCA+IDBcblx0XHRcdFx0XHQpIHtcblx0XHRcdFx0XHRcdGVycm9yTWVzc2FnZSArPSBgLiBNaXNzaW5nOiAke3ZhbGlkYXRpb25SZXN1bHQucmVxdWlyZWRGaWVsZHMuam9pbihcIiwgXCIpfWA7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKGVycm9yTWVzc2FnZSwgRVJST1JfQ09ERVMuVkFMSURBVElPTl9GQUlMRUQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gTG9nIHdhcm5pbmdzIGlmIHByZXNlbnQgKG5vbi1ibG9ja2luZylcblx0XHRcdFx0aWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwi4pqg77iPIFN0YXR1cyB0cmFuc2l0aW9uIHdhcm5pbmdzOlwiLCB7XG5cdFx0XHRcdFx0XHRqb2JJZCxcblx0XHRcdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGpvYldpdGhDb250ZXh0LnN0YXR1cyxcblx0XHRcdFx0XHRcdG5ld1N0YXR1czogZGF0YS5zdGF0dXMsXG5cdFx0XHRcdFx0XHR3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIEJ1aWxkIGNvcmUgam9iIHVwZGF0ZSBvYmplY3Qgd2l0aCBvbmx5IGRlZmluZWQgdmFsdWVzXG5cdFx0Y29uc3QgY29yZVVwZGF0ZURhdGE6IGFueSA9IHt9O1xuXHRcdGlmIChkYXRhLnRpdGxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnRpdGxlID0gZGF0YS50aXRsZTtcblx0XHR9XG5cdFx0aWYgKGRhdGEuZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuZGVzY3JpcHRpb24gPSBkYXRhLmRlc2NyaXB0aW9uO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zdGF0dXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuc3RhdHVzID0gZGF0YS5zdGF0dXM7XG5cdFx0fVxuXHRcdGlmIChkYXRhLnByaW9yaXR5ICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnByaW9yaXR5ID0gZGF0YS5wcmlvcml0eTtcblx0XHR9XG5cdFx0aWYgKGRhdGEuam9iVHlwZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb3JlVXBkYXRlRGF0YS5qb2JfdHlwZSA9IGRhdGEuam9iVHlwZTtcblx0XHR9XG5cdFx0aWYgKGRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEubm90ZXMgPSBkYXRhLm5vdGVzO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zY2hlZHVsZWRTdGFydCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb3JlVXBkYXRlRGF0YS5zY2hlZHVsZWRfc3RhcnQgPSBkYXRhLnNjaGVkdWxlZFN0YXJ0O1xuXHRcdH1cblx0XHRpZiAoZGF0YS5zY2hlZHVsZWRFbmQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29yZVVwZGF0ZURhdGEuc2NoZWR1bGVkX2VuZCA9IGRhdGEuc2NoZWR1bGVkRW5kO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5hc3NpZ25lZFRvICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLmFzc2lnbmVkX3RvID0gZGF0YS5hc3NpZ25lZFRvO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLmN1c3RvbWVyX2lkID0gZGF0YS5jdXN0b21lcklkO1xuXHRcdH1cblx0XHRpZiAoZGF0YS5wcm9wZXJ0eUlkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvcmVVcGRhdGVEYXRhLnByb3BlcnR5X2lkID0gZGF0YS5wcm9wZXJ0eUlkO1xuXHRcdFx0Ly8gSWYgcHJvcGVydHkgaXMgYmVpbmcgc2V0IChub3QgbnVsbCksIHZlcmlmeSBpdCBiZWxvbmdzIHRvIHRoZSBjdXN0b21lciAoaWYgY3VzdG9tZXIgaXMgc2V0KVxuXHRcdFx0aWYgKFxuXHRcdFx0XHRkYXRhLnByb3BlcnR5SWQgIT09IG51bGwgJiZcblx0XHRcdFx0ZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQgJiZcblx0XHRcdFx0ZGF0YS5jdXN0b21lcklkICE9PSBudWxsXG5cdFx0XHQpIHtcblx0XHRcdFx0Y29uc3QgeyBkYXRhOiBwcm9wZXJ0eSB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdFx0XHQuZnJvbShcInByb3BlcnRpZXNcIilcblx0XHRcdFx0XHQuc2VsZWN0KFwiY3VzdG9tZXJfaWRcIilcblx0XHRcdFx0XHQuZXEoXCJpZFwiLCBkYXRhLnByb3BlcnR5SWQpXG5cdFx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRcdGlmIChwcm9wZXJ0eSAmJiBwcm9wZXJ0eS5jdXN0b21lcl9pZCAhPT0gZGF0YS5jdXN0b21lcklkKSB7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcdFx0XCJQcm9wZXJ0eSBkb2VzIG5vdCBiZWxvbmcgdG8gdGhlIHNlbGVjdGVkIGN1c3RvbWVyXCIsXG5cdFx0XHRcdFx0XHRFUlJPUl9DT0RFUy5WQUxJREFUSU9OX0ZBSUxFRCxcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gQnVpbGQgZmluYW5jaWFsIGRvbWFpbiB1cGRhdGUgb2JqZWN0IChpZiBhbnkgZmluYW5jaWFsIGZpZWxkcyBwcm92aWRlZClcblx0XHRjb25zdCBmaW5hbmNpYWxVcGRhdGVEYXRhOiBhbnkgPSB7fTtcblx0XHRpZiAoZGF0YS50b3RhbEFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmaW5hbmNpYWxVcGRhdGVEYXRhLnRvdGFsX2Ftb3VudCA9IGRhdGEudG90YWxBbW91bnQ7XG5cdFx0fVxuXHRcdGlmIChkYXRhLnBhaWRBbW91bnQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0ZmluYW5jaWFsVXBkYXRlRGF0YS5wYWlkX2Ftb3VudCA9IGRhdGEucGFpZEFtb3VudDtcblx0XHR9XG5cdFx0aWYgKGRhdGEuZGVwb3NpdEFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmaW5hbmNpYWxVcGRhdGVEYXRhLmRlcG9zaXRfYW1vdW50ID0gZGF0YS5kZXBvc2l0QW1vdW50O1xuXHRcdH1cblxuXHRcdC8vIEV4ZWN1dGUgdXBkYXRlcyBpbiBwYXJhbGxlbCBmb3IgcGVyZm9ybWFuY2Vcblx0XHRjb25zdCB1cGRhdGVzOiBQcm9taXNlPGFueT5bXSA9IFtdO1xuXG5cdFx0Ly8gVXBkYXRlIGNvcmUgam9iIHRhYmxlIGlmIHRoZXJlIGFyZSBjaGFuZ2VzXG5cdFx0aWYgKE9iamVjdC5rZXlzKGNvcmVVcGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG5cdFx0XHR1cGRhdGVzLnB1c2goXG5cdFx0XHRcdChhc3luYyAoKSA9PiBhd2FpdCBzdXBhYmFzZS5mcm9tKFwiam9ic1wiKS51cGRhdGUoY29yZVVwZGF0ZURhdGEpLmVxKFwiaWRcIiwgam9iSWQpKSgpLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBVcGRhdGUgZmluYW5jaWFsIGRvbWFpbiB0YWJsZSBpZiB0aGVyZSBhcmUgY2hhbmdlc1xuXHRcdGlmIChPYmplY3Qua2V5cyhmaW5hbmNpYWxVcGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG5cdFx0XHR1cGRhdGVzLnB1c2goXG5cdFx0XHRcdChhc3luYyAoKSA9PlxuXHRcdFx0XHRcdGF3YWl0IHN1cGFiYXNlXG5cdFx0XHRcdFx0XHQuZnJvbShcImpvYl9maW5hbmNpYWxcIilcblx0XHRcdFx0XHRcdC51cGRhdGUoZmluYW5jaWFsVXBkYXRlRGF0YSlcblx0XHRcdFx0XHRcdC5lcShcImpvYl9pZFwiLCBqb2JJZCkpKCksXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEV4ZWN1dGUgYWxsIHVwZGF0ZXMgaW4gcGFyYWxsZWxcblx0XHRpZiAodXBkYXRlcy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwodXBkYXRlcyk7XG5cblx0XHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gYW55IHVwZGF0ZVxuXHRcdFx0Y29uc3QgZXJyb3JzID0gcmVzdWx0cy5maWx0ZXIoKHJlc3VsdCkgPT4gcmVzdWx0LmVycm9yKTtcblx0XHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRjb25zdCBlcnJvck1lc3NhZ2VzID0gZXJyb3JzLm1hcCgoZSkgPT4gZS5lcnJvci5tZXNzYWdlKS5qb2luKFwiLCBcIik7XG5cdFx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XHRgJHtFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJ1cGRhdGUgam9iXCIpfTogJHtlcnJvck1lc3NhZ2VzfWAsXG5cdFx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBVcGRhdGUgam9iIHdpdGggZGF0YSBvYmplY3QgKGVhc2llciBmb3IgcHJvZ3JhbW1hdGljIHVzZSlcbiAqIFVzZWQgYnkgam9iIGVkaXRvciBmb3IgaW4tcGxhY2UgdXBkYXRlc1xuICovXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVKb2JEYXRhKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRkYXRhOiBQYXJ0aWFsPFVwZGF0ZUpvYkRhdGE+LFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHQvLyBDb252ZXJ0IGRhdGEgb2JqZWN0IHRvIEZvcm1EYXRhIGZvciBjb21wYXRpYmlsaXR5IHdpdGggZXhpc3RpbmcgdXBkYXRlSm9iXG5cdFx0Y29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcblxuXHRcdC8vIEFkZCBhbGwgZGVmaW5lZCBmaWVsZHMgdG8gRm9ybURhdGFcblx0XHRpZiAoZGF0YS50aXRsZSAhPT0gdW5kZWZpbmVkKSBmb3JtRGF0YS5hcHBlbmQoXCJ0aXRsZVwiLCBkYXRhLnRpdGxlKTtcblx0XHRpZiAoZGF0YS5kZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwiZGVzY3JpcHRpb25cIiwgZGF0YS5kZXNjcmlwdGlvbik7XG5cdFx0aWYgKGRhdGEuc3RhdHVzICE9PSB1bmRlZmluZWQpIGZvcm1EYXRhLmFwcGVuZChcInN0YXR1c1wiLCBkYXRhLnN0YXR1cyk7XG5cdFx0aWYgKGRhdGEucHJpb3JpdHkgIT09IHVuZGVmaW5lZCkgZm9ybURhdGEuYXBwZW5kKFwicHJpb3JpdHlcIiwgZGF0YS5wcmlvcml0eSk7XG5cdFx0aWYgKGRhdGEuam9iVHlwZSAhPT0gdW5kZWZpbmVkKSBmb3JtRGF0YS5hcHBlbmQoXCJqb2JUeXBlXCIsIGRhdGEuam9iVHlwZSk7XG5cdFx0aWYgKGRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkgZm9ybURhdGEuYXBwZW5kKFwibm90ZXNcIiwgZGF0YS5ub3Rlcyk7XG5cdFx0aWYgKGRhdGEudG90YWxBbW91bnQgIT09IHVuZGVmaW5lZClcblx0XHRcdGZvcm1EYXRhLmFwcGVuZChcInRvdGFsQW1vdW50XCIsIGRhdGEudG90YWxBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEucGFpZEFtb3VudCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwicGFpZEFtb3VudFwiLCBkYXRhLnBhaWRBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEuZGVwb3NpdEFtb3VudCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwiZGVwb3NpdEFtb3VudFwiLCBkYXRhLmRlcG9zaXRBbW91bnQudG9TdHJpbmcoKSk7XG5cdFx0aWYgKGRhdGEuc2NoZWR1bGVkU3RhcnQgIT09IHVuZGVmaW5lZClcblx0XHRcdGZvcm1EYXRhLmFwcGVuZChcInNjaGVkdWxlZFN0YXJ0XCIsIGRhdGEuc2NoZWR1bGVkU3RhcnQpO1xuXHRcdGlmIChkYXRhLnNjaGVkdWxlZEVuZCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKFwic2NoZWR1bGVkRW5kXCIsIGRhdGEuc2NoZWR1bGVkRW5kKTtcblx0XHRpZiAoZGF0YS5hc3NpZ25lZFRvICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJhc3NpZ25lZFRvXCIsIGRhdGEuYXNzaWduZWRUbyB8fCBcIlwiKTtcblx0XHRpZiAoZGF0YS5jdXN0b21lcklkICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJjdXN0b21lcklkXCIsIGRhdGEuY3VzdG9tZXJJZCB8fCBcIlwiKTtcblx0XHRpZiAoZGF0YS5wcm9wZXJ0eUlkICE9PSB1bmRlZmluZWQpXG5cdFx0XHRmb3JtRGF0YS5hcHBlbmQoXCJwcm9wZXJ0eUlkXCIsIGRhdGEucHJvcGVydHlJZCB8fCBcIlwiKTtcblxuXHRcdC8vIFJldXNlIGV4aXN0aW5nIHVwZGF0ZUpvYiBsb2dpY1xuXHRcdHJldHVybiBhd2FpdCB1cGRhdGVKb2Ioam9iSWQsIGZvcm1EYXRhKTtcblx0fSk7XG59XG5cbi8qKlxuICogVXBkYXRlIGpvYiBzdGF0dXMgd2l0aCB2YWxpZGF0aW9uXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5zdGF0dXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUpvYlN0YXR1cyhcblx0am9iSWQ6IHN0cmluZyxcblx0bmV3U3RhdHVzOiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBjdXJyZW50IHVzZXJcblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmFsaWRhdGUgc3RhdHVzIHZhbHVlXG5cdFx0Y29uc3QgdmFsaWRTdGF0dXNlczogSm9iU3RhdHVzW10gPSBbXG5cdFx0XHRcInF1b3RlZFwiLFxuXHRcdFx0XCJzY2hlZHVsZWRcIixcblx0XHRcdFwiaW5fcHJvZ3Jlc3NcIixcblx0XHRcdFwib25faG9sZFwiLFxuXHRcdFx0XCJjb21wbGV0ZWRcIixcblx0XHRcdFwiY2FuY2VsbGVkXCIsXG5cdFx0XHRcImludm9pY2VkXCIsXG5cdFx0XHRcInBhaWRcIixcblx0XHRdO1xuXHRcdGlmICghdmFsaWRTdGF0dXNlcy5pbmNsdWRlcyhuZXdTdGF0dXMgYXMgSm9iU3RhdHVzKSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkludmFsaWQgam9iIHN0YXR1c1wiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5WQUxJREFUSU9OX0ZBSUxFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gRmV0Y2ggam9iIHdpdGggYWxsIGNvbnRleHQgbmVlZGVkIGZvciB0cmFuc2l0aW9uIHZhbGlkYXRpb25cblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFxuXHRcdFx0XHRgXG5cdFx0XHRcdGlkLFxuXHRcdFx0XHRjb21wYW55X2lkLFxuXHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdHNjaGVkdWxlZF9zdGFydCxcblx0XHRcdFx0c2NoZWR1bGVkX2VuZCxcblx0XHRcdFx0YXNzaWduZWRfdG8sXG5cdFx0XHRcdGN1c3RvbWVyX2lkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZCxcblx0XHRcdFx0dG90YWxfYW1vdW50LFxuXHRcdFx0XHRpbnZvaWNlczppbnZvaWNlcyhzdGF0dXMsIHRvdGFsX2Ftb3VudCksXG5cdFx0XHRcdGVzdGltYXRlczplc3RpbWF0ZXMoc3RhdHVzKSxcblx0XHRcdFx0dGVhbV9hc3NpZ25tZW50czpqb2JfdGVhbV9hc3NpZ25tZW50cyh0ZWFtX21lbWJlcl9pZClcblx0XHRcdGAsXG5cdFx0XHQpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhleGlzdGluZ0pvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoZXhpc3RpbmdKb2IuY29tcGFueV9pZCAhPT0gY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQnVpbGQgY29udGV4dCBmb3IgdHJhbnNpdGlvbiB2YWxpZGF0aW9uXG5cdFx0Y29uc3QgdHJhbnNpdGlvbkNvbnRleHQ6IEpvYlN0YXR1c1RyYW5zaXRpb25Db250ZXh0ID0ge1xuXHRcdFx0Y3VycmVudFN0YXR1czogZXhpc3RpbmdKb2Iuc3RhdHVzIGFzIEpvYlN0YXR1cyxcblx0XHRcdG5ld1N0YXR1czogbmV3U3RhdHVzIGFzIEpvYlN0YXR1cyxcblx0XHRcdGpvYjoge1xuXHRcdFx0XHRpZDogZXhpc3RpbmdKb2IuaWQsXG5cdFx0XHRcdHNjaGVkdWxlZF9zdGFydDogZXhpc3RpbmdKb2Iuc2NoZWR1bGVkX3N0YXJ0LFxuXHRcdFx0XHRzY2hlZHVsZWRfZW5kOiBleGlzdGluZ0pvYi5zY2hlZHVsZWRfZW5kLFxuXHRcdFx0XHRhc3NpZ25lZF90bzogZXhpc3RpbmdKb2IuYXNzaWduZWRfdG8sXG5cdFx0XHRcdGN1c3RvbWVyX2lkOiBleGlzdGluZ0pvYi5jdXN0b21lcl9pZCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IGV4aXN0aW5nSm9iLnByb3BlcnR5X2lkLFxuXHRcdFx0XHR0b3RhbF9hbW91bnQ6IGV4aXN0aW5nSm9iLnRvdGFsX2Ftb3VudCxcblx0XHRcdFx0aW52b2ljZXM6IGV4aXN0aW5nSm9iLmludm9pY2VzIHx8IFtdLFxuXHRcdFx0XHRlc3RpbWF0ZXM6IGV4aXN0aW5nSm9iLmVzdGltYXRlcyB8fCBbXSxcblx0XHRcdFx0dGVhbUFzc2lnbm1lbnRzOiBleGlzdGluZ0pvYi50ZWFtX2Fzc2lnbm1lbnRzIHx8IFtdLFxuXHRcdFx0fSxcblx0XHR9O1xuXG5cdFx0Ly8gVmFsaWRhdGUgdHJhbnNpdGlvbiB3aXRoIGNvbXByZWhlbnNpdmUgYnVzaW5lc3MgcnVsZXNcblx0XHRjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gdmFsaWRhdGVTdGF0dXNUcmFuc2l0aW9uKHRyYW5zaXRpb25Db250ZXh0KTtcblxuXHRcdGlmICghdmFsaWRhdGlvblJlc3VsdC5hbGxvd2VkKSB7XG5cdFx0XHRsZXQgZXJyb3JNZXNzYWdlID1cblx0XHRcdFx0dmFsaWRhdGlvblJlc3VsdC5yZWFzb24gfHwgXCJTdGF0dXMgdHJhbnNpdGlvbiBub3QgYWxsb3dlZFwiO1xuXG5cdFx0XHRpZiAoXG5cdFx0XHRcdHZhbGlkYXRpb25SZXN1bHQucmVxdWlyZWRGaWVsZHMgJiZcblx0XHRcdFx0dmFsaWRhdGlvblJlc3VsdC5yZXF1aXJlZEZpZWxkcy5sZW5ndGggPiAwXG5cdFx0XHQpIHtcblx0XHRcdFx0ZXJyb3JNZXNzYWdlICs9IGAuIE1pc3Npbmc6ICR7dmFsaWRhdGlvblJlc3VsdC5yZXF1aXJlZEZpZWxkcy5qb2luKFwiLCBcIil9YDtcblx0XHRcdH1cblxuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKGVycm9yTWVzc2FnZSwgRVJST1JfQ09ERVMuVkFMSURBVElPTl9GQUlMRUQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyB3YXJuaW5ncyBpZiBwcmVzZW50IChub24tYmxvY2tpbmcpXG5cdFx0aWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCLimqDvuI8gU3RhdHVzIHRyYW5zaXRpb24gd2FybmluZ3M6XCIsIHtcblx0XHRcdFx0am9iSWQsXG5cdFx0XHRcdGN1cnJlbnRTdGF0dXM6IGV4aXN0aW5nSm9iLnN0YXR1cyxcblx0XHRcdFx0bmV3U3RhdHVzLFxuXHRcdFx0XHR3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBzdGF0dXNcblx0XHRjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnVwZGF0ZSh7IHN0YXR1czogbmV3U3RhdHVzIH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwidXBkYXRlIGpvYiBzdGF0dXNcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1FVRVJZX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zb2xlLmxvZyhcIuKchSBKb2Igc3RhdHVzIHVwZGF0ZWQ6XCIsIHtcblx0XHRcdGpvYklkLFxuXHRcdFx0b2xkU3RhdHVzOiBleGlzdGluZ0pvYi5zdGF0dXMsXG5cdFx0XHRuZXdTdGF0dXMsXG5cdFx0fSk7XG5cblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZC93b3JrLyR7am9iSWR9YCk7XG5cdH0pO1xufVxuXG4vKipcbiAqIEFzc2lnbiBqb2IgdG8gYSB0ZWNobmljaWFuXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5hc3NpZ25lZF90b1xuICovXG5hc3luYyBmdW5jdGlvbiBhc3NpZ25Kb2IoXG5cdGpvYklkOiBzdHJpbmcsXG5cdHRlY2huaWNpYW5JZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWRcIilcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0YXNzZXJ0RXhpc3RzKGV4aXN0aW5nSm9iLCBcIkpvYlwiKTtcblxuXHRcdGlmIChleGlzdGluZ0pvYi5jb21wYW55X2lkICE9PSBjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwiam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgdGVjaG5pY2lhbiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IHRlY2huaWNpYW4gfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImNvbXBhbnlfbWVtYmVyc2hpcHNcIilcblx0XHRcdC5zZWxlY3QoXCJ1c2VyX2lkXCIpXG5cdFx0XHQuZXEoXCJ1c2VyX2lkXCIsIHRlY2huaWNpYW5JZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWNobmljaWFuKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiVGVjaG5pY2lhbiBub3QgZm91bmQgaW4geW91ciBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1JFQ09SRF9OT1RfRk9VTkQsXG5cdFx0XHRcdDQwNCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gQXNzaWduIGpvYlxuXHRcdGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQudXBkYXRlKHsgYXNzaWduZWRfdG86IHRlY2huaWNpYW5JZCB9KVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpO1xuXG5cdFx0aWYgKHVwZGF0ZUVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImFzc2lnbiBqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX1FVRVJZX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZC93b3JrLyR7am9iSWR9YCk7XG5cdH0pO1xufVxuXG4vKipcbiAqIFNjaGVkdWxlIGEgam9iXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icyB0YWJsZSBzY2hlZHVsaW5nIGZpZWxkc1xuICovXG5hc3luYyBmdW5jdGlvbiBzY2hlZHVsZUpvYihcblx0am9iSWQ6IHN0cmluZyxcblx0Zm9ybURhdGE6IEZvcm1EYXRhLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSBzY2hlZHVsZUpvYlNjaGVtYS5wYXJzZSh7XG5cdFx0XHRzY2hlZHVsZWRTdGFydDogZm9ybURhdGEuZ2V0KFwic2NoZWR1bGVkU3RhcnRcIiksXG5cdFx0XHRzY2hlZHVsZWRFbmQ6IGZvcm1EYXRhLmdldChcInNjaGVkdWxlZEVuZFwiKSxcblx0XHR9KTtcblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWQsIHN0YXR1c1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBzY2hlZHVsZSBhbmQgc3RhdHVzXG5cdFx0Y29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRzY2hlZHVsZWRfc3RhcnQ6IGRhdGEuc2NoZWR1bGVkU3RhcnQsXG5cdFx0XHRcdHNjaGVkdWxlZF9lbmQ6IGRhdGEuc2NoZWR1bGVkRW5kLFxuXHRcdFx0XHRzdGF0dXM6XG5cdFx0XHRcdFx0ZXhpc3RpbmdKb2Iuc3RhdHVzID09PSBcInF1b3RlZFwiID8gXCJzY2hlZHVsZWRcIiA6IGV4aXN0aW5nSm9iLnN0YXR1cyxcblx0XHRcdH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwic2NoZWR1bGUgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0fSk7XG59XG5cbi8qKlxuICogU3RhcnQgYSBqb2JcbiAqIPCflKcgUkVGQUNUT1JFRCAtIE5vdyB1cGRhdGVzIGpvYl90aW1lX3RyYWNraW5nLmFjdHVhbF9zdGFydCBpbnN0ZWFkIG9mIGpvYnMuYWN0dWFsX3N0YXJ0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdGFydEpvYihqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBHZXQgY3VycmVudCB1c2VyXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Ly8gR2V0IHVzZXIncyBhY3RpdmUgY29tcGFueSB1c2luZyBoZWxwZXIgKGhhbmRsZXMgbXVsdGktY29tcGFueSB1c2Vycylcblx0XHRjb25zdCB7IGdldEFjdGl2ZUNvbXBhbnlJZCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvYXV0aC9jb21wYW55LWNvbnRleHRcIik7XG5cdFx0Y29uc3QgY29tcGFueUlkID0gYXdhaXQgZ2V0QWN0aXZlQ29tcGFueUlkKCk7XG5cblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFZlcmlmeSBqb2IgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBleGlzdGluZ0pvYiB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWQsIHN0YXR1c1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbiBvbmx5IHN0YXJ0IHNjaGVkdWxlZCBqb2JzXG5cdFx0aWYgKGV4aXN0aW5nSm9iLnN0YXR1cyAhPT0gXCJzY2hlZHVsZWRcIiAmJiBleGlzdGluZ0pvYi5zdGF0dXMgIT09IFwicXVvdGVkXCIpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgbXVzdCBiZSBzY2hlZHVsZWQgYmVmb3JlIHN0YXJ0aW5nXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuXG5cdFx0Ly8gVXBkYXRlIGJvdGggam9icyB0YWJsZSAoc3RhdHVzKSBhbmQgam9iX3RpbWVfdHJhY2tpbmcgdGFibGUgKGFjdHVhbF9zdGFydCkgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0c3VwYWJhc2UuZnJvbShcImpvYnNcIikudXBkYXRlKHsgc3RhdHVzOiBcImluX3Byb2dyZXNzXCIgfSkuZXEoXCJpZFwiLCBqb2JJZCksXG5cdFx0XHRzdXBhYmFzZVxuXHRcdFx0XHQuZnJvbShcImpvYl90aW1lX3RyYWNraW5nXCIpXG5cdFx0XHRcdC51cGRhdGUoeyBhY3R1YWxfc3RhcnQ6IG5vdyB9KVxuXHRcdFx0XHQuZXEoXCJqb2JfaWRcIiwgam9iSWQpLFxuXHRcdF0pO1xuXG5cdFx0Ly8gQ2hlY2sgZm9yIGVycm9ycyBpbiBlaXRoZXIgdXBkYXRlXG5cdFx0Y29uc3QgZXJyb3JzID0gdXBkYXRlcy5maWx0ZXIoKHJlc3VsdCkgPT4gcmVzdWx0LmVycm9yKTtcblx0XHRpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwic3RhcnQgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBDb21wbGV0ZSBhIGpvYlxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgam9iX3RpbWVfdHJhY2tpbmcuYWN0dWFsX2VuZCBhbmQgY2FsY3VsYXRlcyB0b3RhbF9sYWJvcl9ob3Vyc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29tcGxldGVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHZvaWQ+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IGN1cnJlbnQgdXNlclxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdC8vIEdldCB1c2VyJ3MgYWN0aXZlIGNvbXBhbnkgdXNpbmcgaGVscGVyIChoYW5kbGVzIG11bHRpLWNvbXBhbnkgdXNlcnMpXG5cdFx0Y29uc3QgeyBnZXRBY3RpdmVDb21wYW55SWQgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL2F1dGgvY29tcGFueS1jb250ZXh0XCIpO1xuXHRcdGNvbnN0IGNvbXBhbnlJZCA9IGF3YWl0IGdldEFjdGl2ZUNvbXBhbnlJZCgpO1xuXG5cdFx0aWYgKCFjb21wYW55SWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGJlbG9uZ3MgdG8gY29tcGFueSBhbmQgZ2V0IHRpbWUgdHJhY2tpbmcgZGF0YVxuXHRcdGNvbnN0IHsgZGF0YTogZXhpc3RpbmdKb2IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkLCBzdGF0dXMsIHRpbWVUcmFja2luZzpqb2JfdGltZV90cmFja2luZygqKVwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbiBvbmx5IGNvbXBsZXRlIGluLXByb2dyZXNzIGpvYnNcblx0XHRpZiAoZXhpc3RpbmdKb2Iuc3RhdHVzICE9PSBcImluX3Byb2dyZXNzXCIpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgbXVzdCBiZSBpbiBwcm9ncmVzcyB0byBjb21wbGV0ZVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcblxuXHRcdC8vIENhbGN1bGF0ZSB0b3RhbCBsYWJvciBob3VycyBpZiB3ZSBoYXZlIGFjdHVhbF9zdGFydFxuXHRcdGNvbnN0IHRpbWVUcmFja2luZyA9IEFycmF5LmlzQXJyYXkoZXhpc3RpbmdKb2IudGltZVRyYWNraW5nKVxuXHRcdFx0PyBleGlzdGluZ0pvYi50aW1lVHJhY2tpbmdbMF1cblx0XHRcdDogZXhpc3RpbmdKb2IudGltZVRyYWNraW5nO1xuXG5cdFx0Y29uc3QgdGltZVRyYWNraW5nVXBkYXRlOiBhbnkgPSB7IGFjdHVhbF9lbmQ6IG5vdyB9O1xuXG5cdFx0aWYgKHRpbWVUcmFja2luZz8uYWN0dWFsX3N0YXJ0KSB7XG5cdFx0XHRjb25zdCBzdGFydFRpbWUgPSBuZXcgRGF0ZSh0aW1lVHJhY2tpbmcuYWN0dWFsX3N0YXJ0KS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBlbmRUaW1lID0gbmV3IERhdGUobm93KS5nZXRUaW1lKCk7XG5cdFx0XHRjb25zdCBob3Vyc1dvcmtlZCA9IChlbmRUaW1lIC0gc3RhcnRUaW1lKSAvICgxMDAwICogNjAgKiA2MCk7IC8vIENvbnZlcnQgbXMgdG8gaG91cnNcblx0XHRcdHRpbWVUcmFja2luZ1VwZGF0ZS50b3RhbF9sYWJvcl9ob3VycyA9IGhvdXJzV29ya2VkO1xuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBib3RoIGpvYnMgdGFibGUgKHN0YXR1cykgYW5kIGpvYl90aW1lX3RyYWNraW5nIHRhYmxlIChhY3R1YWxfZW5kLCB0b3RhbF9sYWJvcl9ob3VycykgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0c3VwYWJhc2UuZnJvbShcImpvYnNcIikudXBkYXRlKHsgc3RhdHVzOiBcImNvbXBsZXRlZFwiIH0pLmVxKFwiaWRcIiwgam9iSWQpLFxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfdGltZV90cmFja2luZ1wiKVxuXHRcdFx0XHQudXBkYXRlKHRpbWVUcmFja2luZ1VwZGF0ZSlcblx0XHRcdFx0LmVxKFwiam9iX2lkXCIsIGpvYklkKSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gZWl0aGVyIHVwZGF0ZVxuXHRcdGNvbnN0IGVycm9ycyA9IHVwZGF0ZXMuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5lcnJvcik7XG5cdFx0aWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImNvbXBsZXRlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0fSk7XG59XG5cbi8qKlxuICogQ2FuY2VsIGEgam9iXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHVwZGF0ZXMgam9icy5zdGF0dXMgYW5kIGpvYnMubm90ZXNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gY2FuY2VsSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRyZWFzb24/OiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEdldCBjdXJyZW50IHVzZXJcblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnlcblx0XHRjb25zdCB7IGRhdGE6IGV4aXN0aW5nSm9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzLCBub3Rlc1wiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRhc3NlcnRFeGlzdHMoZXhpc3RpbmdKb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGV4aXN0aW5nSm9iLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIENhbm5vdCBjYW5jZWwgY29tcGxldGVkIGpvYnNcblx0XHRpZiAoZXhpc3RpbmdKb2Iuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiQ2Fubm90IGNhbmNlbCBjb21wbGV0ZWQgam9ic1wiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEFkZCBjYW5jZWxsYXRpb24gcmVhc29uIHRvIG5vdGVzXG5cdFx0Y29uc3QgdXBkYXRlZE5vdGVzID0gcmVhc29uXG5cdFx0XHQ/IGAke2V4aXN0aW5nSm9iLm5vdGVzIHx8IFwiXCJ9XFxuXFxuW0NBTkNFTExFRF06ICR7cmVhc29ufWAudHJpbSgpXG5cdFx0XHQ6IGV4aXN0aW5nSm9iLm5vdGVzO1xuXG5cdFx0Ly8gQ2FuY2VsIGpvYlxuXHRcdGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0c3RhdHVzOiBcImNhbmNlbGxlZFwiLFxuXHRcdFx0XHRub3RlczogdXBkYXRlZE5vdGVzLFxuXHRcdFx0fSlcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKTtcblxuXHRcdGlmICh1cGRhdGVFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJjYW5jZWwgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBTZWFyY2ggam9icyB3aXRoIGZ1bGwtdGV4dCBzZWFyY2ggYW5kIHJhbmtpbmdcbiAqIOKchSBOTyBDSEFOR0VTIE5FRURFRCAtIE9ubHkgc2VhcmNoZXMgam9icyB0YWJsZVxuICovXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hKb2JzKFxuXHRzZWFyY2hUZXJtOiBzdHJpbmcsXG5cdG9wdGlvbnM/OiB7IGxpbWl0PzogbnVtYmVyOyBvZmZzZXQ/OiBudW1iZXIgfSxcbik6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueVtdPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiY29tcGFueV9tZW1iZXJzaGlwc1wiKVxuXHRcdFx0LnNlbGVjdChcImNvbXBhbnlfaWRcIilcblx0XHRcdC5lcShcInVzZXJfaWRcIiwgdXNlci5pZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGlmICghdGVhbU1lbWJlcj8uY29tcGFueV9pZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIllvdSBtdXN0IGJlIHBhcnQgb2YgYSBjb21wYW55XCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIFVzZSBmdWxsLXRleHQgc2VhcmNoIHdpdGggcmFua2luZyBmb3IgYmVzdCBtYXRjaGVzXG5cdFx0Y29uc3QgeyBzZWFyY2hKb2JzRnVsbFRleHQgfSA9IGF3YWl0IGltcG9ydChcblx0XHRcdFwiQC9saWIvc2VhcmNoL2Z1bGwtdGV4dC1zZWFyY2hcIlxuXHRcdCk7XG5cblx0XHRjb25zdCBqb2JzID0gYXdhaXQgc2VhcmNoSm9ic0Z1bGxUZXh0KHN1cGFiYXNlLCB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQsIHNlYXJjaFRlcm0sIHtcblx0XHRcdGxpbWl0OiBvcHRpb25zPy5saW1pdCB8fCA1MCxcblx0XHRcdG9mZnNldDogb3B0aW9ucz8ub2Zmc2V0IHx8IDAsXG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gam9icztcblx0fSk7XG59XG5cbi8qKlxuICogVW5pdmVyc2FsIHNlYXJjaCBhY3Jvc3MgYWxsIGVudGl0aWVzXG4gKiDinIUgTk8gQ0hBTkdFUyBORUVERUQgLSBPbmx5IHNlYXJjaGVzIGpvYnMgdGFibGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2VhcmNoQWxsKFxuXHRzZWFyY2hUZXJtOiBzdHJpbmcsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDxhbnk+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Y29uc3QgeyBkYXRhOiB0ZWFtTWVtYmVyIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjb21wYW55X21lbWJlcnNoaXBzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWFtTWVtYmVyPy5jb21wYW55X2lkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVXNlIHVuaXZlcnNhbCBzZWFyY2ggUlBDIGZ1bmN0aW9uXG5cdFx0Y29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UucnBjKFwic2VhcmNoX2FsbF9lbnRpdGllc1wiLCB7XG5cdFx0XHRjb21wYW55X2lkX3BhcmFtOiB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQsXG5cdFx0XHRzZWFyY2hfcXVlcnk6IHNlYXJjaFRlcm0sXG5cdFx0XHRwZXJfZW50aXR5X2xpbWl0OiA1LFxuXHRcdH0pO1xuXG5cdFx0aWYgKGVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcInNlYXJjaFwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBkYXRhO1xuXHR9KTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSk9CIEFSQ0hJVkUgJiBSRVNUT1JFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogQXJjaGl2ZSBqb2IgKHNvZnQgZGVsZXRlKVxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IHVwZGF0ZXMgam9iX211bHRpX2VudGl0eS5kZWxldGVkX2J5IGFuZCBwZXJtYW5lbnRfZGVsZXRlX3NjaGVkdWxlZF9hdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXJjaGl2ZUpvYihqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHRjb25zdCB7IGRhdGE6IHRlYW1NZW1iZXIgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImNvbXBhbnlfbWVtYmVyc2hpcHNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJ1c2VyX2lkXCIsIHVzZXIuaWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoIXRlYW1NZW1iZXI/LmNvbXBhbnlfaWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJZb3UgbXVzdCBiZSBwYXJ0IG9mIGEgY29tcGFueVwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogam9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZCwgc3RhdHVzXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0aWYgKGpvYi5jb21wYW55X2lkICE9PSB0ZWFtTWVtYmVyLmNvbXBhbnlfaWQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMuZm9yYmlkZGVuKFwiam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBDYW5ub3QgYXJjaGl2ZSBjb21wbGV0ZWQvcGFpZCBqb2JzIChidXNpbmVzcyBydWxlKVxuXHRcdGlmIChqb2Iuc3RhdHVzID09PSBcImNvbXBsZXRlZFwiIHx8IGpvYi5zdGF0dXMgPT09IFwiaW52b2ljZWRcIikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkNhbm5vdCBhcmNoaXZlIGNvbXBsZXRlZCBvciBpbnZvaWNlZCBqb2JzLiBUaGVzZSBtdXN0IGJlIHJldGFpbmVkIGZvciByZWNvcmRzLlwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5PUEVSQVRJT05fTk9UX0FMTE9XRUQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIEFyY2hpdmUgam9iIChzb2Z0IGRlbGV0ZSlcblx0XHRjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG5cdFx0Y29uc3Qgc2NoZWR1bGVkRGVsZXRpb24gPSBuZXcgRGF0ZShcblx0XHRcdERhdGUubm93KCkgKyA5MCAqIDI0ICogNjAgKiA2MCAqIDEwMDAsXG5cdFx0KS50b0lTT1N0cmluZygpO1xuXG5cdFx0Ly8gVXBkYXRlIGJvdGggam9icyB0YWJsZSBhbmQgam9iX211bHRpX2VudGl0eSB0YWJsZSBpbiBwYXJhbGxlbFxuXHRcdGNvbnN0IHVwZGF0ZXMgPSBhd2FpdCBQcm9taXNlLmFsbChbXG5cdFx0XHQvLyBVcGRhdGUgY29yZSBqb2JzIHRhYmxlIHdpdGggYXJjaGl2ZSBtZXRhZGF0YVxuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRcdGRlbGV0ZWRfYXQ6IG5vdyxcblx0XHRcdFx0XHRhcmNoaXZlZF9hdDogbm93LFxuXHRcdFx0XHRcdHN0YXR1czogXCJhcmNoaXZlZFwiLFxuXHRcdFx0XHR9KVxuXHRcdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCksXG5cblx0XHRcdC8vIFVwZGF0ZSBqb2JfbXVsdGlfZW50aXR5IHRhYmxlIHdpdGggZGVsZXRpb24gdHJhY2tpbmdcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9iX211bHRpX2VudGl0eVwiKVxuXHRcdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0XHRkZWxldGVkX2J5OiB1c2VyLmlkLFxuXHRcdFx0XHRcdHBlcm1hbmVudF9kZWxldGVfc2NoZWR1bGVkX2F0OiBzY2hlZHVsZWREZWxldGlvbixcblx0XHRcdFx0fSlcblx0XHRcdFx0LmVxKFwiam9iX2lkXCIsIGpvYklkKSxcblx0XHRdKTtcblxuXHRcdC8vIENoZWNrIGZvciBlcnJvcnMgaW4gZWl0aGVyIHVwZGF0ZVxuXHRcdGNvbnN0IGVycm9ycyA9IHVwZGF0ZXMuZmlsdGVyKChyZXN1bHQpID0+IHJlc3VsdC5lcnJvcik7XG5cdFx0aWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcImFyY2hpdmUgam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3dvcmtcIik7XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9zZXR0aW5ncy9hcmNoaXZlXCIpO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBSZXN0b3JlIGFyY2hpdmVkIGpvYlxuICog8J+UpyBSRUZBQ1RPUkVEIC0gTm93IGNsZWFycyBqb2JfbXVsdGlfZW50aXR5LmRlbGV0ZWRfYnkgYW5kIHBlcm1hbmVudF9kZWxldGVfc2NoZWR1bGVkX2F0XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlc3RvcmVKb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHZvaWQ+PiB7XG5cdHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblx0XHRpZiAoIXN1cGFiYXNlKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWRcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfQ09OTkVDVElPTl9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0ZGF0YTogeyB1c2VyIH0sXG5cdFx0fSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuXHRcdGFzc2VydEF1dGhlbnRpY2F0ZWQodXNlcj8uaWQpO1xuXG5cdFx0Y29uc3QgeyBkYXRhOiB0ZWFtTWVtYmVyIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjb21wYW55X21lbWJlcnNoaXBzXCIpXG5cdFx0XHQuc2VsZWN0KFwiY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKCF0ZWFtTWVtYmVyPy5jb21wYW55X2lkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBiZWxvbmdzIHRvIGNvbXBhbnkgYW5kIGlzIGFyY2hpdmVkXG5cdFx0Y29uc3QgeyBkYXRhOiBqb2IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC5zZWxlY3QoXCJjb21wYW55X2lkLCBkZWxldGVkX2F0LCBzdGF0dXNcIilcblx0XHRcdC5lcShcImlkXCIsIGpvYklkKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0YXNzZXJ0RXhpc3RzKGpvYiwgXCJKb2JcIik7XG5cblx0XHRpZiAoam9iLmNvbXBhbnlfaWQgIT09IHRlYW1NZW1iZXIuY29tcGFueV9pZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJqb2JcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmICgham9iLmRlbGV0ZWRfYXQpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJKb2IgaXMgbm90IGFyY2hpdmVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLk9QRVJBVElPTl9OT1RfQUxMT1dFRCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmVzdG9yZSBqb2IgLSB1cGRhdGUgYm90aCB0YWJsZXMgaW4gcGFyYWxsZWxcblx0XHRjb25zdCB1cGRhdGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuXHRcdFx0Ly8gQ2xlYXIgY29yZSBqb2JzIHRhYmxlIGFyY2hpdmUgbWV0YWRhdGFcblx0XHRcdHN1cGFiYXNlXG5cdFx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0XHQudXBkYXRlKHtcblx0XHRcdFx0XHRkZWxldGVkX2F0OiBudWxsLFxuXHRcdFx0XHRcdGFyY2hpdmVkX2F0OiBudWxsLFxuXHRcdFx0XHRcdHN0YXR1czogam9iLnN0YXR1cyA9PT0gXCJhcmNoaXZlZFwiID8gXCJzY2hlZHVsZWRcIiA6IGpvYi5zdGF0dXMsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5lcShcImlkXCIsIGpvYklkKSxcblxuXHRcdFx0Ly8gQ2xlYXIgam9iX211bHRpX2VudGl0eSB0YWJsZSBkZWxldGlvbiB0cmFja2luZ1xuXHRcdFx0c3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJqb2JfbXVsdGlfZW50aXR5XCIpXG5cdFx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRcdGRlbGV0ZWRfYnk6IG51bGwsXG5cdFx0XHRcdFx0cGVybWFuZW50X2RlbGV0ZV9zY2hlZHVsZWRfYXQ6IG51bGwsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5lcShcImpvYl9pZFwiLCBqb2JJZCksXG5cdFx0XSk7XG5cblx0XHQvLyBDaGVjayBmb3IgZXJyb3JzIGluIGVpdGhlciB1cGRhdGVcblx0XHRjb25zdCBlcnJvcnMgPSB1cGRhdGVzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuZXJyb3IpO1xuXHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJyZXN0b3JlIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9zY2hlZHVsZVwiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvc2V0dGluZ3MvYXJjaGl2ZVwiKTtcblx0fSk7XG59XG5cbi8qKlxuICogUmVtb3ZlIHRlYW0gYXNzaWdubWVudCBmcm9tIGpvYlxuICog4pyFIE5PIENIQU5HRVMgTkVFREVEIC0gT25seSBkZWxldGVzIGZyb20gam9iX3RlYW1fYXNzaWdubWVudHMganVuY3Rpb24gdGFibGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVtb3ZlVGVhbUFzc2lnbm1lbnQoXG5cdGFzc2lnbm1lbnRJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHQvLyBHZXQgdXNlcidzIGFjdGl2ZSBjb21wYW55IHVzaW5nIGhlbHBlciAoaGFuZGxlcyBtdWx0aS1jb21wYW55IHVzZXJzKVxuXHRcdGNvbnN0IHsgZ2V0QWN0aXZlQ29tcGFueUlkIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9hdXRoL2NvbXBhbnktY29udGV4dFwiKTtcblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblxuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiWW91IG11c3QgYmUgcGFydCBvZiBhIGNvbXBhbnlcIixcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IHRoZSBqdW5jdGlvbiByZWNvcmQgdG8gZmluZCBqb2JfaWQgZm9yIHJldmFsaWRhdGlvblxuXHRcdGNvbnN0IHsgZGF0YTogcmVjb3JkLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9iX3RlYW1fYXNzaWdubWVudHNcIilcblx0XHRcdC5zZWxlY3QoXCJpZCwgam9iX2lkLCBjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBhc3NpZ25tZW50SWQpXG5cdFx0XHQuc2luZ2xlKCk7XG5cblx0XHRpZiAoZmV0Y2hFcnJvciB8fCAhcmVjb3JkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdFwiVGVhbSBhc3NpZ25tZW50IG5vdCBmb3VuZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9SRUNPUkRfTk9UX0ZPVU5ELFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAocmVjb3JkLmNvbXBhbnlfaWQgIT09IGNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJ0ZWFtIGFzc2lnbm1lbnRcIiksXG5cdFx0XHRcdEVSUk9SX0NPREVTLkFVVEhfRk9SQklEREVOLFxuXHRcdFx0XHQ0MDMsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IGpvYklkID0gcmVjb3JkLmpvYl9pZDtcblxuXHRcdC8vIERlbGV0ZSBqdW5jdGlvbiB0YWJsZSByb3dcblx0XHRjb25zdCB7IGVycm9yOiBkZWxldGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9iX3RlYW1fYXNzaWdubWVudHNcIilcblx0XHRcdC5kZWxldGUoKVxuXHRcdFx0LmVxKFwiaWRcIiwgYXNzaWdubWVudElkKTtcblxuXHRcdGlmIChkZWxldGVFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5vcGVyYXRpb25GYWlsZWQoXCJyZW1vdmUgdGVhbSBhc3NpZ25tZW50IGZyb20gam9iXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmV2YWxpZGF0ZSBqb2IgcGFnZSBhbmQgc2NoZWR1bGVcblx0XHRpZiAoam9iSWQpIHtcblx0XHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0XHR9XG5cdFx0cmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL3NjaGVkdWxlXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBBc3NpZ24gQ3VzdG9tZXIgYW5kIFByb3BlcnR5IHRvIEpvYlxuICpcbiAqIFVwZGF0ZXMgdGhlIGpvYidzIGN1c3RvbWVyX2lkIGFuZCBwcm9wZXJ0eV9pZC5cbiAqIE9ubHkgb25lIGN1c3RvbWVyIGFuZCBwcm9wZXJ0eSBjYW4gYmUgYXNzaWduZWQgcGVyIGpvYi5cbiAqXG4gKiBAcGFyYW0gam9iSWQgLSBKb2IgSURcbiAqIEBwYXJhbSBjdXN0b21lcklkIC0gQ3VzdG9tZXIgSUQgdG8gYXNzaWduXG4gKiBAcGFyYW0gcHJvcGVydHlJZCAtIFByb3BlcnR5IElEIHRvIGFzc2lnbiAob3B0aW9uYWwpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhc3NpZ25DdXN0b21lclRvSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuXHRjdXN0b21lcklkOiBzdHJpbmcsXG5cdHByb3BlcnR5SWQ6IHN0cmluZyB8IG51bGwsXG4pOiBQcm9taXNlPEFjdGlvblJlc3VsdDx2b2lkPj4ge1xuXHRyZXR1cm4gd2l0aEVycm9ySGFuZGxpbmcoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cdFx0aWYgKCFzdXBhYmFzZSkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkXCIsXG5cdFx0XHRcdEVSUk9SX0NPREVTLkRCX0NPTk5FQ1RJT05fRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHtcblx0XHRcdGRhdGE6IHsgdXNlciB9LFxuXHRcdH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblx0XHRhc3NlcnRBdXRoZW50aWNhdGVkKHVzZXI/LmlkKTtcblxuXHRcdGNvbnN0IGNvbXBhbnlJZCA9IGF3YWl0IGdldEFjdGl2ZUNvbXBhbnlJZCgpO1xuXHRcdGlmICghY29tcGFueUlkKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLmZvcmJpZGRlbihcImNvbXBhbnkgYWNjZXNzXCIpLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5BVVRIX0ZPUkJJRERFTixcblx0XHRcdFx0NDAzLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHQvLyBWZXJpZnkgam9iIGV4aXN0cyBhbmQgYmVsb25ncyB0byBjb21wYW55XG5cdFx0Y29uc3QgeyBkYXRhOiBqb2IsIGVycm9yOiBqb2JFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnNlbGVjdChcImlkLCBjb21wYW55X2lkXCIpXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LmlzKFwiZGVsZXRlZF9hdFwiLCBudWxsKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGpvYkVycm9yKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKFwiSm9iIHF1ZXJ5IGVycm9yOlwiLCBqb2JFcnJvcik7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmluZCBqb2I6ICR7am9iRXJyb3IubWVzc2FnZX1gLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9RVUVSWV9FUlJPUixcblx0XHRcdFx0NTAwLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRhc3NlcnRFeGlzdHMoam9iLCBcIkpvYlwiKTtcblxuXHRcdC8vIFZlcmlmeSBjdXN0b21lciBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogY3VzdG9tZXIsIGVycm9yOiBjdXN0b21lckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJjdXN0b21lcnNcIilcblx0XHRcdC5zZWxlY3QoXCJpZCwgY29tcGFueV9pZFwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgY3VzdG9tZXJJZClcblx0XHRcdC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUlkKVxuXHRcdFx0LmlzKFwiZGVsZXRlZF9hdFwiLCBudWxsKVxuXHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0aWYgKGN1c3RvbWVyRXJyb3IpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJDdXN0b21lciBxdWVyeSBlcnJvcjpcIiwgY3VzdG9tZXJFcnJvcik7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmluZCBjdXN0b21lcjogJHtjdXN0b21lckVycm9yLm1lc3NhZ2V9YCxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHRcdDUwMCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0YXNzZXJ0RXhpc3RzKGN1c3RvbWVyLCBcIkN1c3RvbWVyXCIpO1xuXG5cdFx0Ly8gSWYgcHJvcGVydHkgaXMgcHJvdmlkZWQsIHZlcmlmeSBpdCBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY3VzdG9tZXJcblx0XHRpZiAocHJvcGVydHlJZCkge1xuXHRcdFx0Y29uc3QgeyBkYXRhOiBwcm9wZXJ0eSB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oXCJwcm9wZXJ0aWVzXCIpXG5cdFx0XHRcdC5zZWxlY3QoXCJpZCwgY3VzdG9tZXJfaWRcIilcblx0XHRcdFx0LmVxKFwiaWRcIiwgcHJvcGVydHlJZClcblx0XHRcdFx0LmVxKFwiY3VzdG9tZXJfaWRcIiwgY3VzdG9tZXJJZClcblx0XHRcdFx0LnNpbmdsZSgpO1xuXG5cdFx0XHRpZiAoIXByb3BlcnR5KSB7XG5cdFx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XHRcIlByb3BlcnR5IG5vdCBmb3VuZCBvciBkb2VzIG5vdCBiZWxvbmcgdG8gdGhpcyBjdXN0b21lclwiLFxuXHRcdFx0XHRcdEVSUk9SX0NPREVTLkRCX1JFQ09SRF9OT1RfRk9VTkQsXG5cdFx0XHRcdFx0NDA0LFxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIFVwZGF0ZSBqb2Igd2l0aCBjdXN0b21lciBhbmQgcHJvcGVydHlcblx0XHRjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vcblx0XHRcdC5mcm9tKFwiam9ic1wiKVxuXHRcdFx0LnVwZGF0ZSh7XG5cdFx0XHRcdGN1c3RvbWVyX2lkOiBjdXN0b21lcklkLFxuXHRcdFx0XHRwcm9wZXJ0eV9pZDogcHJvcGVydHlJZCxcblx0XHRcdH0pXG5cdFx0XHQuZXEoXCJpZFwiLCBqb2JJZCk7XG5cblx0XHRpZiAodXBkYXRlRXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0RVJST1JfTUVTU0FHRVMub3BlcmF0aW9uRmFpbGVkKFwiYXNzaWduIGN1c3RvbWVyIHRvIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyBhY3Rpdml0eVxuXHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JfYWN0aXZpdHlfbG9nXCIpLmluc2VydCh7XG5cdFx0XHRqb2JfaWQ6IGpvYklkLFxuXHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0dXNlcl9pZDogdXNlci5pZCxcblx0XHRcdGFjdGl2aXR5X3R5cGU6IFwiYXNzaWduZWRcIixcblx0XHRcdGVudGl0eV90eXBlOiBcImN1c3RvbWVyXCIsXG5cdFx0XHRkZXNjcmlwdGlvbjogYEFzc2lnbmVkIGN1c3RvbWVyJHtwcm9wZXJ0eUlkID8gXCIgYW5kIHByb3BlcnR5XCIgOiBcIlwifWAsXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRjdXN0b21lcl9pZDogY3VzdG9tZXJJZCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IHByb3BlcnR5SWQsXG5cdFx0XHR9LFxuXHRcdH0pO1xuXG5cdFx0cmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvd29yay8ke2pvYklkfWApO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC93b3JrXCIpO1xuXHRcdHJldmFsaWRhdGVQYXRoKFwiL3dlbGNvbWVcIik7XG5cdH0pO1xufVxuXG4vKipcbiAqIFJlbW92ZSBDdXN0b21lciBhbmQgUHJvcGVydHkgZnJvbSBKb2JcbiAqXG4gKiBSZW1vdmVzIHRoZSBjdXN0b21lcl9pZCBhbmQgcHJvcGVydHlfaWQgZnJvbSB0aGUgam9iLlxuICogUmVsYXRlZCBkYXRhIChhcHBvaW50bWVudHMsIGludm9pY2VzLCBldGMuKSByZW1haW4gYnV0IGFyZSBubyBsb25nZXIgbGlua2VkLlxuICpcbiAqIEBwYXJhbSBqb2JJZCAtIEpvYiBJRFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVtb3ZlQ3VzdG9tZXJGcm9tSm9iKFxuXHRqb2JJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dm9pZD4+IHtcblx0cmV0dXJuIHdpdGhFcnJvckhhbmRsaW5nKGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXHRcdGlmICghc3VwYWJhc2UpIHtcblx0XHRcdHRocm93IG5ldyBBY3Rpb25FcnJvcihcblx0XHRcdFx0XCJEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZFwiLFxuXHRcdFx0XHRFUlJPUl9DT0RFUy5EQl9DT05ORUNUSU9OX0VSUk9SLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCB7XG5cdFx0XHRkYXRhOiB7IHVzZXIgfSxcblx0XHR9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG5cdFx0YXNzZXJ0QXV0aGVudGljYXRlZCh1c2VyPy5pZCk7XG5cblx0XHRjb25zdCBjb21wYW55SWQgPSBhd2FpdCBnZXRBY3RpdmVDb21wYW55SWQoKTtcblx0XHRpZiAoIWNvbXBhbnlJZCkge1xuXHRcdFx0dGhyb3cgbmV3IEFjdGlvbkVycm9yKFxuXHRcdFx0XHRFUlJPUl9NRVNTQUdFUy5mb3JiaWRkZW4oXCJjb21wYW55IGFjY2Vzc1wiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuQVVUSF9GT1JCSURERU4sXG5cdFx0XHRcdDQwMyxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gVmVyaWZ5IGpvYiBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gY29tcGFueVxuXHRcdGNvbnN0IHsgZGF0YTogam9iIH0gPSBhd2FpdCBzdXBhYmFzZVxuXHRcdFx0LmZyb20oXCJqb2JzXCIpXG5cdFx0XHQuc2VsZWN0KFwiaWQsIGNvbXBhbnlfaWQsIGN1c3RvbWVyX2lkLCBwcm9wZXJ0eV9pZFwiKVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpXG5cdFx0XHQuZXEoXCJjb21wYW55X2lkXCIsIGNvbXBhbnlJZClcblx0XHRcdC5pcyhcImRlbGV0ZWRfYXRcIiwgbnVsbClcblx0XHRcdC5zaW5nbGUoKTtcblxuXHRcdGFzc2VydEV4aXN0cyhqb2IsIFwiSm9iXCIpO1xuXG5cdFx0Ly8gVXBkYXRlIGpvYiB0byByZW1vdmUgY3VzdG9tZXIgYW5kIHByb3BlcnR5XG5cdFx0Y29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG5cdFx0XHQuZnJvbShcImpvYnNcIilcblx0XHRcdC51cGRhdGUoe1xuXHRcdFx0XHRjdXN0b21lcl9pZDogbnVsbCxcblx0XHRcdFx0cHJvcGVydHlfaWQ6IG51bGwsXG5cdFx0XHR9KVxuXHRcdFx0LmVxKFwiaWRcIiwgam9iSWQpO1xuXG5cdFx0aWYgKHVwZGF0ZUVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWN0aW9uRXJyb3IoXG5cdFx0XHRcdEVSUk9SX01FU1NBR0VTLm9wZXJhdGlvbkZhaWxlZChcInJlbW92ZSBjdXN0b21lciBmcm9tIGpvYlwiKSxcblx0XHRcdFx0RVJST1JfQ09ERVMuREJfUVVFUllfRVJST1IsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIExvZyBhY3Rpdml0eVxuXHRcdGF3YWl0IHN1cGFiYXNlLmZyb20oXCJqb2JfYWN0aXZpdHlfbG9nXCIpLmluc2VydCh7XG5cdFx0XHRqb2JfaWQ6IGpvYklkLFxuXHRcdFx0Y29tcGFueV9pZDogY29tcGFueUlkLFxuXHRcdFx0dXNlcl9pZDogdXNlci5pZCxcblx0XHRcdGFjdGl2aXR5X3R5cGU6IFwicmVtb3ZlZFwiLFxuXHRcdFx0ZW50aXR5X3R5cGU6IFwiY3VzdG9tZXJcIixcblx0XHRcdGRlc2NyaXB0aW9uOiBcIlJlbW92ZWQgY3VzdG9tZXIgYW5kIHByb3BlcnR5XCIsXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRwcmV2aW91c19jdXN0b21lcl9pZDogam9iLmN1c3RvbWVyX2lkLFxuXHRcdFx0XHRwcmV2aW91c19wcm9wZXJ0eV9pZDogam9iLnByb3BlcnR5X2lkLFxuXHRcdFx0fSxcblx0XHR9KTtcblxuXHRcdHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL3dvcmsvJHtqb2JJZH1gKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvd29ya1wiKTtcblx0XHRyZXZhbGlkYXRlUGF0aChcIi93ZWxjb21lXCIpO1xuXHR9KTtcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiMlNBOGdFc0IifQ==
}),
"[project]/apps/web/src/actions/jobs.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "archiveJob",
    ()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$data$3a$2b132c__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["archiveJob"],
    "assignCustomerToJob",
    ()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$data$3a$2308a3__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["assignCustomerToJob"],
    "completeJob",
    ()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$data$3a$f75fe3__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["completeJob"],
    "createJob",
    ()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$data$3a$dc8dce__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["createJob"],
    "removeCustomerFromJob",
    ()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$data$3a$af9096__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["removeCustomerFromJob"],
    "startJob",
    ()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$data$3a$deb155__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["startJob"],
    "updateJob",
    ()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$data$3a$0bef0a__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["updateJob"],
    "updateJobStatus",
    ()=>__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$data$3a$e680bd__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["updateJobStatus"]
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$jobs$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/apps/web/src/actions/jobs.ts [app-ssr] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$data$3a$dc8dce__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/apps/web/src/actions/data:dc8dce [app-ssr] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$data$3a$0bef0a__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/apps/web/src/actions/data:0bef0a [app-ssr] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$data$3a$e680bd__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/apps/web/src/actions/data:e680bd [app-ssr] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$data$3a$deb155__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/apps/web/src/actions/data:deb155 [app-ssr] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$data$3a$f75fe3__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/apps/web/src/actions/data:f75fe3 [app-ssr] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$data$3a$2b132c__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/apps/web/src/actions/data:2b132c [app-ssr] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$data$3a$2308a3__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/apps/web/src/actions/data:2308a3 [app-ssr] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$actions$2f$data$3a$af9096__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/apps/web/src/actions/data:af9096 [app-ssr] (ecmascript) <text/javascript>");
}),
];

//# sourceMappingURL=apps_web_src_actions_a11687c1._.js.map