{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/web/src/lib/telnyx/messaging-profile-fetcher.ts"],"sourcesContent":["/**\n * Messaging Profile Fetcher\n *\n * Fetches messaging profiles from Telnyx API to help with configuration.\n */\n\nimport { telnyxClient } from \"./client\";\n\nexport type MessagingProfile = {\n\tid: string;\n\tname: string;\n\tenabled: boolean;\n\twebhook_url: string | null;\n\twebhook_failover_url: string | null;\n\twebhook_api_version: string | null;\n};\n\nexport type ListMessagingProfilesResult = {\n\tsuccess: boolean;\n\tprofiles?: MessagingProfile[];\n\terror?: string;\n};\n\n/**\n * List all messaging profiles from Telnyx\n */\nasync function listMessagingProfiles(): Promise<ListMessagingProfilesResult> {\n\ttry {\n\t\tconst response = await telnyxClient.messagingProfiles.list();\n\t\tconst profiles = (response.data || []) as any[];\n\n\t\tconst formattedProfiles: MessagingProfile[] = profiles.map((profile) => ({\n\t\t\tid: profile.id,\n\t\t\tname: profile.name || \"Unnamed Profile\",\n\t\t\tenabled: profile.enabled !== false,\n\t\t\twebhook_url: profile.webhook_url || null,\n\t\t\twebhook_failover_url: profile.webhook_failover_url || null,\n\t\t\twebhook_api_version: profile.webhook_api_version || null,\n\t\t}));\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tprofiles: formattedProfiles,\n\t\t};\n\t} catch (error: any) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error?.message || \"Failed to list messaging profiles\",\n\t\t};\n\t}\n}\n\n/**\n * Get the default messaging profile (first enabled profile, or first profile if none enabled)\n */\nexport async function getDefaultMessagingProfile(): Promise<{\n\tsuccess: boolean;\n\tprofile?: MessagingProfile;\n\terror?: string;\n\trecommendation?: string;\n}> {\n\tconst result = await listMessagingProfiles();\n\n\tif (!result.success || !result.profiles) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: result.error || \"Failed to fetch messaging profiles\",\n\t\t};\n\t}\n\n\tif (result.profiles.length === 0) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: \"No messaging profiles found in Telnyx account\",\n\t\t\trecommendation:\n\t\t\t\t\"Create a messaging profile in Telnyx Portal → Messaging → Profiles\",\n\t\t};\n\t}\n\n\t// Prefer enabled profiles\n\tconst enabledProfiles = result.profiles.filter((p) => p.enabled);\n\tconst selectedProfile =\n\t\tenabledProfiles.length > 0 ? enabledProfiles[0] : result.profiles[0];\n\n\tlet recommendation: string | undefined;\n\tif (result.profiles.length > 1) {\n\t\trecommendation = `Found ${result.profiles.length} messaging profiles. Using \"${selectedProfile.name}\" (ID: ${selectedProfile.id}). To use a different profile, set TELNYX_DEFAULT_MESSAGING_PROFILE_ID to the desired profile ID.`;\n\t}\n\n\treturn {\n\t\tsuccess: true,\n\t\tprofile: selectedProfile,\n\t\trecommendation,\n\t};\n}\n\n/**\n * Get messaging profile by ID\n */\nasync function getMessagingProfileById(profileId: string): Promise<{\n\tsuccess: boolean;\n\tprofile?: MessagingProfile;\n\terror?: string;\n}> {\n\ttry {\n\t\tconst response = await telnyxClient.messagingProfiles.retrieve(profileId);\n\t\tconst profileData = response.data as any;\n\n\t\tif (!profileData) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: `Messaging profile ${profileId} not found`,\n\t\t\t};\n\t\t}\n\n\t\tconst profile: MessagingProfile = {\n\t\t\tid: profileData.id,\n\t\t\tname: profileData.name || \"Unnamed Profile\",\n\t\t\tenabled: profileData.enabled !== false,\n\t\t\twebhook_url: profileData.webhook_url || null,\n\t\t\twebhook_failover_url: profileData.webhook_failover_url || null,\n\t\t\twebhook_api_version: profileData.webhook_api_version || null,\n\t\t};\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tprofile,\n\t\t};\n\t} catch (error: any) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error?.message || \"Failed to retrieve messaging profile\",\n\t\t};\n\t}\n}\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;AAED;;AAiBA;;CAEC,GACD,eAAe;IACd,IAAI;QACH,MAAM,WAAW,MAAM,6JAAY,CAAC,iBAAiB,CAAC,IAAI;QAC1D,MAAM,WAAY,SAAS,IAAI,IAAI,EAAE;QAErC,MAAM,oBAAwC,SAAS,GAAG,CAAC,CAAC,UAAY,CAAC;gBACxE,IAAI,QAAQ,EAAE;gBACd,MAAM,QAAQ,IAAI,IAAI;gBACtB,SAAS,QAAQ,OAAO,KAAK;gBAC7B,aAAa,QAAQ,WAAW,IAAI;gBACpC,sBAAsB,QAAQ,oBAAoB,IAAI;gBACtD,qBAAqB,QAAQ,mBAAmB,IAAI;YACrD,CAAC;QAED,OAAO;YACN,SAAS;YACT,UAAU;QACX;IACD,EAAE,OAAO,OAAY;QACpB,OAAO;YACN,SAAS;YACT,OAAO,OAAO,WAAW;QAC1B;IACD;AACD;AAKO,eAAe;IAMrB,MAAM,SAAS,MAAM;IAErB,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,OAAO,QAAQ,EAAE;QACxC,OAAO;YACN,SAAS;YACT,OAAO,OAAO,KAAK,IAAI;QACxB;IACD;IAEA,IAAI,OAAO,QAAQ,CAAC,MAAM,KAAK,GAAG;QACjC,OAAO;YACN,SAAS;YACT,OAAO;YACP,gBACC;QACF;IACD;IAEA,0BAA0B;IAC1B,MAAM,kBAAkB,OAAO,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAM,EAAE,OAAO;IAC/D,MAAM,kBACL,gBAAgB,MAAM,GAAG,IAAI,eAAe,CAAC,EAAE,GAAG,OAAO,QAAQ,CAAC,EAAE;IAErE,IAAI;IACJ,IAAI,OAAO,QAAQ,CAAC,MAAM,GAAG,GAAG;QAC/B,iBAAiB,CAAC,MAAM,EAAE,OAAO,QAAQ,CAAC,MAAM,CAAC,4BAA4B,EAAE,gBAAgB,IAAI,CAAC,OAAO,EAAE,gBAAgB,EAAE,CAAC,iGAAiG,CAAC;IACnO;IAEA,OAAO;QACN,SAAS;QACT,SAAS;QACT;IACD;AACD;AAEA;;CAEC,GACD,eAAe,wBAAwB,SAAiB;IAKvD,IAAI;QACH,MAAM,WAAW,MAAM,6JAAY,CAAC,iBAAiB,CAAC,QAAQ,CAAC;QAC/D,MAAM,cAAc,SAAS,IAAI;QAEjC,IAAI,CAAC,aAAa;YACjB,OAAO;gBACN,SAAS;gBACT,OAAO,CAAC,kBAAkB,EAAE,UAAU,UAAU,CAAC;YAClD;QACD;QAEA,MAAM,UAA4B;YACjC,IAAI,YAAY,EAAE;YAClB,MAAM,YAAY,IAAI,IAAI;YAC1B,SAAS,YAAY,OAAO,KAAK;YACjC,aAAa,YAAY,WAAW,IAAI;YACxC,sBAAsB,YAAY,oBAAoB,IAAI;YAC1D,qBAAqB,YAAY,mBAAmB,IAAI;QACzD;QAEA,OAAO;YACN,SAAS;YACT;QACD;IACD,EAAE,OAAO,OAAY;QACpB,OAAO;YACN,SAAS;YACT,OAAO,OAAO,WAAW;QAC1B;IACD;AACD"}}]
}