{"version":3,"sources":["../../../../../apps/web/src/actions/customer-enrichment.ts","../../../../../apps/web/src/lib/services/customer-enrichment.ts","../../../../../apps/web/src/lib/services/business-enrichment.ts","../../../../../apps/web/src/lib/services/person-enrichment.ts","../../../../../apps/web/src/lib/services/property-enrichment.ts","../../../../../apps/web/src/lib/services/social-enrichment.ts"],"sourcesContent":["/**\n * Customer Enrichment Server Actions\n *\n * Server-side actions for enriching customer data with external APIs:\n * - Trigger enrichment for a customer\n * - Get cached enrichment data\n * - Refresh expired enrichment\n * - Check enrichment quota/limits\n * - Get usage statistics\n */\n\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { ActionError, ERROR_CODES } from \"@/lib/errors/action-error\";\nimport {\n\ttype ActionResult,\n\tassertAuthenticated,\n\tassertExists,\n\twithErrorHandling,\n} from \"@/lib/errors/with-error-handling\";\nimport {\n\ttype CustomerEnrichment,\n\tcustomerEnrichmentService,\n} from \"@/lib/services/customer-enrichment\";\nimport { createClient } from \"@/lib/supabase/server\";\n\ntype SupabaseServerClient = Exclude<\n\tAwaited<ReturnType<typeof createClient>>,\n\tnull\n>;\n\ntype TeamMemberRecord = {\n\tcompany_id: string;\n\trole?: string | null;\n};\n\ntype CustomerForEnrichment = {\n\tid: string;\n\tcompany_id: string;\n\temail: string | null;\n\tfirst_name: string | null;\n\tlast_name: string | null;\n\tcompany_name: string | null;\n\tphone: string | null;\n\taddress: string | null;\n\tcity: string | null;\n\tstate: string | null;\n\tzip_code: string | null;\n};\n\ntype EnrichmentRecord = {\n\tdata_type: string;\n\tenrichment_data: CustomerEnrichment | null;\n};\n\ntype EnrichmentGroupedData = {\n\tcombined?: EnrichmentRecord | null;\n\tperson?: EnrichmentRecord | null;\n\tbusiness?: EnrichmentRecord | null;\n\tsocial?: EnrichmentRecord | null;\n\tproperty: EnrichmentRecord[];\n};\n\ntype EnrichmentUsageRecord = {\n\tenrichments_count: number | null;\n\tenrichments_limit: number | null;\n\ttier: string | null;\n};\n\nconst ISO_MONTH_START_INDEX = 0;\nconst ISO_MONTH_FORMAT_LENGTH = 7;\n\nconst ENRICHMENT_TIER_LIMITS = {\n\tfree: 50,\n\tpro: 500,\n\tenterprise: null,\n} as const;\n\nconst CUSTOMER_ENRICHMENT_SELECT = `\n  id,\n  company_id,\n  email,\n  first_name,\n  last_name,\n  company_name,\n  phone,\n  address,\n  city,\n  state,\n  zip_code\n`;\n\n// ============================================================================\n// ENRICHMENT OPERATIONS\n// ============================================================================\n\n/**\n * Enrich customer data with external APIs\n */\nexport async function enrichCustomerData(\n\tcustomerId: string,\n\tforceRefresh = false,\n): Promise<ActionResult<CustomerEnrichment>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst supabase = await getSupabaseServerClient();\n\t\tconst { teamMember, customer, cachedEnrichment } =\n\t\t\tawait resolveCustomerContext(supabase, customerId, forceRefresh);\n\n\t\tif (cachedEnrichment) {\n\t\t\treturn cachedEnrichment;\n\t\t}\n\n\t\tconst enrichmentResult = await customerEnrichmentService.enrichCustomer({\n\t\t\tid: customer.id,\n\t\t\temail: customer.email ?? \"\",\n\t\t\tfirstName: customer.first_name ?? undefined,\n\t\t\tlastName: customer.last_name ?? undefined,\n\t\t\tcompanyName: customer.company_name ?? undefined,\n\t\t\tphone: customer.phone ?? undefined,\n\t\t\taddress: customer.address ?? undefined,\n\t\t\tcity: customer.city ?? undefined,\n\t\t\tstate: customer.state ?? undefined,\n\t\t\tzipCode: customer.zip_code ?? undefined,\n\t\t});\n\n\t\tif (enrichmentResult.enrichmentStatus === \"failed\") {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Failed to enrich customer data from all sources\",\n\t\t\t\tERROR_CODES.SERVICE_INTEGRATION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tawait storeEnrichmentResult(supabase, customerId, enrichmentResult);\n\t\tawait incrementEnrichmentUsage(supabase, teamMember.company_id);\n\n\t\trevalidatePath(`/dashboard/customers/${customerId}`);\n\t\trevalidatePath(\"/dashboard/customers\");\n\n\t\treturn enrichmentResult;\n\t});\n}\n\n/**\n * Get cached enrichment data for a customer\n */\nexport async function getEnrichmentData(\n\tcustomerId: string,\n): Promise<ActionResult<EnrichmentGroupedData | null>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst supabase = await getSupabaseServerClient();\n\t\tconst { teamMember } = await resolveCompanyMembership(supabase);\n\n\t\tawait fetchCustomerForCompany<{ id: string }>(\n\t\t\tsupabase,\n\t\t\tcustomerId,\n\t\t\tteamMember.company_id,\n\t\t\t\"id\",\n\t\t);\n\n\t\tconst { data: enrichmentRows, error } = await supabase\n\t\t\t.from(\"customer_enrichment_data\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.returns<EnrichmentRecord[]>();\n\n\t\tif (error || !enrichmentRows?.length) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn buildEnrichmentGrouping(enrichmentRows);\n\t});\n}\n\n/**\n * Refresh enrichment data (force refresh even if not expired)\n */\nexport async function refreshEnrichment(\n\tcustomerId: string,\n): Promise<ActionResult<CustomerEnrichment>> {\n\treturn await enrichCustomerData(customerId, true);\n}\n\n/**\n * Get enrichment usage statistics for company\n */\nexport async function getEnrichmentUsageStats(): Promise<\n\tActionResult<\n\t\tArray<{\n\t\t\tmonth_year: string;\n\t\t\tenrichments_count: number;\n\t\t\tenrichments_limit: number | null;\n\t\t\tapi_costs: number;\n\t\t\ttier: string;\n\t\t\tpercentage_used: number;\n\t\t}>\n\t>\n> {\n\treturn await withErrorHandling(async () => {\n\t\tconst supabase = await getSupabaseServerClient();\n\t\tconst { teamMember } = await resolveCompanyMembership(supabase);\n\n\t\t// Get usage stats\n\t\tconst { data, error } = await supabase.rpc(\"get_enrichment_stats\", {\n\t\t\tp_company_id: teamMember.company_id,\n\t\t});\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Failed to fetch usage stats\",\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\treturn data || [];\n\t});\n}\n\n/**\n * Check if company can enrich more customers this month\n */\nexport async function checkEnrichmentQuota(): Promise<\n\tActionResult<{\n\t\tcanEnrich: boolean;\n\t\tcurrent: number;\n\t\tlimit: number | null;\n\t\ttier: string;\n\t}>\n> {\n\treturn await withErrorHandling(async () => {\n\t\tconst supabase = await getSupabaseServerClient();\n\t\tconst { teamMember } = await resolveCompanyMembership(supabase);\n\n\t\t// Check if can enrich\n\t\tconst canEnrich = await assertCanEnrichCompany(\n\t\t\tsupabase,\n\t\t\tteamMember.company_id,\n\t\t\t{\n\t\t\t\tthrowOnLimit: false,\n\t\t\t},\n\t\t);\n\n\t\t// Get current usage\n\t\tconst currentMonth = getCurrentMonthStamp();\n\t\tconst { data: usageData } = await supabase\n\t\t\t.from(\"customer_enrichment_usage\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"company_id\", teamMember.company_id)\n\t\t\t.eq(\"month_year\", currentMonth)\n\t\t\t.single()\n\t\t\t.returns<EnrichmentUsageRecord>();\n\t\tconst usage = usageData as EnrichmentUsageRecord | null;\n\n\t\treturn {\n\t\t\tcanEnrich: Boolean(canEnrich),\n\t\t\tcurrent: usage?.enrichments_count ?? 0,\n\t\t\tlimit: usage?.enrichments_limit ?? null,\n\t\t\ttier: usage?.tier ?? \"free\",\n\t\t};\n\t});\n}\n\n/**\n * Update enrichment tier limits (admin only)\n */\nasync function updateEnrichmentTier(\n\ttier: \"free\" | \"pro\" | \"enterprise\",\n): Promise<ActionResult<void>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst supabase = await getSupabaseServerClient();\n\t\tconst { teamMember } = await resolveCompanyMembership(supabase, {\n\t\t\tincludeRole: true,\n\t\t});\n\n\t\t// Check if user is admin/owner\n\t\tif (![\"owner\", \"admin\"].includes(teamMember.role ?? \"\")) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Only admins can update enrichment tier\",\n\t\t\t\tERROR_CODES.OPERATION_NOT_ALLOWED,\n\t\t\t);\n\t\t}\n\n\t\tconst currentMonth = getCurrentMonthStamp();\n\n\t\t// Upsert usage record with new tier\n\t\tconst { error } = await supabase.from(\"customer_enrichment_usage\").upsert({\n\t\t\tcompany_id: teamMember.company_id,\n\t\t\tmonth_year: currentMonth,\n\t\t\ttier,\n\t\t\tenrichments_limit: ENRICHMENT_TIER_LIMITS[tier],\n\t\t});\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Failed to update tier\",\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/settings/subscriptions\");\n\t});\n}\n\n/**\n * Delete enrichment data for a customer\n */\nasync function deleteEnrichmentData(\n\tcustomerId: string,\n): Promise<ActionResult<void>> {\n\treturn await withErrorHandling(async () => {\n\t\tconst supabase = await getSupabaseServerClient();\n\t\tawait getAuthenticatedUserId(supabase);\n\n\t\t// Delete enrichment data (RLS will ensure user has access)\n\t\tconst { error } = await supabase\n\t\t\t.from(\"customer_enrichment_data\")\n\t\t\t.delete()\n\t\t\t.eq(\"customer_id\", customerId);\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Failed to delete enrichment data\",\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(`/dashboard/customers/${customerId}`);\n\t});\n}\n\nconst getSupabaseServerClient = async (): Promise<SupabaseServerClient> => {\n\tconst supabase = await createClient();\n\tif (!supabase) {\n\t\tthrow new ActionError(\n\t\t\t\"Database connection failed\",\n\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t);\n\t}\n\treturn supabase as SupabaseServerClient;\n};\n\nconst getAuthenticatedUserId = async (\n\tsupabase: SupabaseServerClient,\n): Promise<string> => {\n\tconst {\n\t\tdata: { user },\n\t} = await supabase.auth.getUser();\n\tassertAuthenticated(user?.id);\n\treturn user?.id as string;\n};\n\nconst resolveCompanyMembership = async (\n\tsupabase: SupabaseServerClient,\n\toptions?: { includeRole?: boolean },\n): Promise<{ teamMember: TeamMemberRecord }> => {\n\tconst userId = await getAuthenticatedUserId(supabase);\n\tconst teamMember = await loadActiveTeamMember(\n\t\tsupabase,\n\t\tuserId,\n\t\toptions?.includeRole ?? false,\n\t);\n\treturn { teamMember };\n};\n\nconst loadActiveTeamMember = async (\n\tsupabase: SupabaseServerClient,\n\tuserId: string,\n\tincludeRole: boolean,\n): Promise<TeamMemberRecord> => {\n\tconst { getActiveCompanyId } = await import(\"@/lib/auth/company-context\");\n\tconst activeCompanyId = await getActiveCompanyId();\n\n\tif (!activeCompanyId) {\n\t\tthrow new ActionError(\"No active company\", ERROR_CODES.AUTH_UNAUTHORIZED);\n\t}\n\n\tconst columns = includeRole ? \"company_id, role\" : \"company_id\";\n\tconst { data } = await supabase\n\t\t.from(\"company_memberships\")\n\t\t.select(columns)\n\t\t.eq(\"user_id\", userId)\n\t\t.eq(\"company_id\", activeCompanyId)\n\t\t.eq(\"status\", \"active\")\n\t\t.maybeSingle()\n\t\t.returns<TeamMemberRecord>();\n\n\tif (!data?.company_id) {\n\t\tthrow new ActionError(\n\t\t\t\"User not in active company\",\n\t\t\tERROR_CODES.AUTH_UNAUTHORIZED,\n\t\t);\n\t}\n\n\treturn data as TeamMemberRecord;\n};\n\nconst fetchCustomerForCompany = async <TData>(\n\tsupabase: SupabaseServerClient,\n\tcustomerId: string,\n\tcompanyId: string,\n\tcolumns: string,\n): Promise<TData> => {\n\tconst { data, error } = await supabase\n\t\t.from(\"customers\")\n\t\t.select(columns)\n\t\t.eq(\"id\", customerId)\n\t\t.eq(\"company_id\", companyId)\n\t\t.is(\"deleted_at\", null)\n\t\t.single()\n\t\t.returns<TData>();\n\n\tif (error) {\n\t\tthrow new ActionError(\n\t\t\t\"Customer not found\",\n\t\t\tERROR_CODES.DB_RECORD_NOT_FOUND,\n\t\t);\n\t}\n\n\tassertExists(data, \"Customer\");\n\treturn data;\n};\n\nconst getValidCachedEnrichment = async (\n\tsupabase: SupabaseServerClient,\n\tcustomerId: string,\n): Promise<CustomerEnrichment | null> => {\n\tconst { data, error } = await supabase\n\t\t.from(\"customer_enrichment_data\")\n\t\t.select(\"enrichment_data, expires_at\")\n\t\t.eq(\"customer_id\", customerId)\n\t\t.eq(\"data_type\", \"combined\")\n\t\t.eq(\"status\", \"active\")\n\t\t.gte(\"expires_at\", new Date().toISOString())\n\t\t.order(\"created_at\", { ascending: false })\n\t\t.limit(1)\n\t\t.single()\n\t\t.returns<{ enrichment_data: CustomerEnrichment | null }>();\n\n\tif (error) {\n\t\treturn null;\n\t}\n\n\treturn data?.enrichment_data ?? null;\n};\n\nconst assertCanEnrichCompany = async (\n\tsupabase: SupabaseServerClient,\n\tcompanyId: string,\n\toptions?: { throwOnLimit?: boolean },\n): Promise<boolean> => {\n\tconst { data, error } = await supabase.rpc(\"can_enrich_customer\", {\n\t\tp_company_id: companyId,\n\t});\n\n\tif (error) {\n\t\tthrow new ActionError(\n\t\t\t\"Failed to check enrichment quota\",\n\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t);\n\t}\n\n\tif (!data && options?.throwOnLimit !== false) {\n\t\tthrow new ActionError(\n\t\t\t\"Enrichment limit reached for this month. Upgrade your plan for more enrichments.\",\n\t\t\tERROR_CODES.OPERATION_NOT_ALLOWED,\n\t\t);\n\t}\n\n\treturn Boolean(data);\n};\n\nconst storeEnrichmentResult = async (\n\tsupabase: SupabaseServerClient,\n\tcustomerId: string,\n\tenrichmentResult: CustomerEnrichment,\n) => {\n\tconst { error } = await supabase.from(\"customer_enrichment_data\").insert({\n\t\tcustomer_id: customerId,\n\t\tdata_type: \"combined\",\n\t\tsource: enrichmentResult.sources.join(\",\"),\n\t\tenrichment_data: enrichmentResult,\n\t\tconfidence_score: enrichmentResult.overallConfidence,\n\t\tcached_at: new Date().toISOString(),\n\t\texpires_at: enrichmentResult.expiresAt,\n\t\tstatus: \"active\",\n\t});\n\n\tif (error) {\n\t\tthrow new ActionError(\n\t\t\t\"Failed to store enrichment data\",\n\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t);\n\t}\n};\n\nconst incrementEnrichmentUsage = async (\n\tsupabase: SupabaseServerClient,\n\tcompanyId: string,\n) => {\n\tconst { error } = await supabase.rpc(\"increment_enrichment_usage\", {\n\t\tp_company_id: companyId,\n\t\tp_api_cost: 0,\n\t});\n\n\tif (error) {\n\t\tthrow new ActionError(\n\t\t\t\"Failed to update enrichment usage\",\n\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t);\n\t}\n};\n\nconst buildEnrichmentGrouping = (\n\trows: EnrichmentRecord[],\n): EnrichmentGroupedData => ({\n\tcombined: rows.find((row) => row.data_type === \"combined\") ?? null,\n\tperson: rows.find((row) => row.data_type === \"person\") ?? null,\n\tbusiness: rows.find((row) => row.data_type === \"business\") ?? null,\n\tsocial: rows.find((row) => row.data_type === \"social\") ?? null,\n\tproperty: rows.filter((row) => row.data_type === \"property\"),\n});\n\nconst getCurrentMonthStamp = (date: Date = new Date()): string =>\n\tdate.toISOString().slice(ISO_MONTH_START_INDEX, ISO_MONTH_FORMAT_LENGTH);\n\nconst resolveCustomerContext = async (\n\tsupabase: SupabaseServerClient,\n\tcustomerId: string,\n\tforceRefresh: boolean,\n): Promise<{\n\tteamMember: TeamMemberRecord;\n\tcustomer: CustomerForEnrichment;\n\tcachedEnrichment: CustomerEnrichment | null;\n}> => {\n\tconst { teamMember } = await resolveCompanyMembership(supabase);\n\tconst customer = await fetchCustomerForCompany<CustomerForEnrichment>(\n\t\tsupabase,\n\t\tcustomerId,\n\t\tteamMember.company_id,\n\t\tCUSTOMER_ENRICHMENT_SELECT,\n\t);\n\n\tconst cachedEnrichment = forceRefresh\n\t\t? null\n\t\t: await getValidCachedEnrichment(supabase, customerId);\n\n\tif (!cachedEnrichment) {\n\t\tawait assertCanEnrichCompany(supabase, teamMember.company_id);\n\t}\n\n\treturn { teamMember, customer, cachedEnrichment };\n};\n","/**\n * Customer Data Enrichment Orchestrator\n *\n * Main service that coordinates all enrichment providers:\n * - Person enrichment (Hunter)\n * - Business enrichment (Google Places, OpenCorporates)\n * - Social enrichment (LinkedIn, Twitter, Facebook)\n * - Property enrichment (Attom, CoreLogic)\n *\n * Features:\n * - Orchestrates multiple enrichment sources\n * - Manages caching and TTL\n * - Handles errors and fallbacks\n * - Tracks usage for billing tiers\n */\n\nimport { z } from \"zod\";\nimport { businessEnrichmentService } from \"./business-enrichment\";\nimport { personEnrichmentService } from \"./person-enrichment\";\nimport { propertyEnrichmentService } from \"./property-enrichment\";\nimport { socialEnrichmentService } from \"./social-enrichment\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst CustomerEnrichmentSchema = z.object({\n\tcustomerId: z.string().uuid(),\n\n\t// Person data\n\tperson: z.any().optional(), // PersonEnrichmentSchema\n\n\t// Business data\n\tbusiness: z.any().optional(), // BusinessEnrichmentSchema\n\n\t// Social profiles\n\tsocial: z.any().optional(), // SocialEnrichmentSchema\n\n\t// Property data (if customer has properties)\n\tproperties: z.array(z.any()).optional(), // PropertyEnrichmentSchema[]\n\n\t// Metadata\n\tenrichmentStatus: z.enum([\"pending\", \"in_progress\", \"completed\", \"failed\"]),\n\tlastEnrichedAt: z.string().optional(),\n\texpiresAt: z.string().optional(),\n\tsources: z.array(z.string()),\n\toverallConfidence: z.number().min(0).max(100),\n});\n\nexport type CustomerEnrichment = z.infer<typeof CustomerEnrichmentSchema>;\n\n// ============================================================================\n// Customer Enrichment Service\n// ============================================================================\n\nclass CustomerEnrichmentService {\n\tprivate cacheTTL = 1000 * 60 * 60 * 24 * 7; // 7 days\n\n\t/**\n\t * Enrich all available customer data\n\t */\n\tasync enrichCustomer(customer: {\n\t\tid: string;\n\t\temail: string;\n\t\tfirstName?: string;\n\t\tlastName?: string;\n\t\tcompanyName?: string;\n\t\tphone?: string;\n\t\taddress?: string;\n\t\tcity?: string;\n\t\tstate?: string;\n\t\tzipCode?: string;\n\t}): Promise<CustomerEnrichment> {\n\t\tconst sources: string[] = [];\n\t\tconst enrichmentData: Partial<CustomerEnrichment> = {\n\t\t\tcustomerId: customer.id,\n\t\t\tenrichmentStatus: \"in_progress\",\n\t\t};\n\n\t\tconst fullName =\n\t\t\tcustomer.firstName && customer.lastName\n\t\t\t\t? `${customer.firstName} ${customer.lastName}`\n\t\t\t\t: undefined;\n\n\t\t// 1. Person enrichment\n\t\ttry {\n\t\t\tconst personData = await personEnrichmentService.enrichPerson(\n\t\t\t\tcustomer.email,\n\t\t\t);\n\t\t\tif (personData) {\n\t\t\t\tenrichmentData.person = personData;\n\t\t\t\tsources.push(personData.source);\n\t\t\t}\n\t\t} catch (_error) {}\n\n\t\t// 2. Business enrichment (if company name provided)\n\t\tif (customer.companyName) {\n\t\t\ttry {\n\t\t\t\tconst businessData = await businessEnrichmentService.enrichBusiness(\n\t\t\t\t\tcustomer.companyName,\n\t\t\t\t\tcustomer.address,\n\t\t\t\t\tcustomer.city,\n\t\t\t\t\tcustomer.state,\n\t\t\t\t);\n\t\t\t\tif (businessData) {\n\t\t\t\t\tenrichmentData.business = businessData;\n\t\t\t\t\tsources.push(businessData.source);\n\t\t\t\t}\n\t\t\t} catch (_error) {}\n\t\t}\n\n\t\t// 3. Social enrichment\n\t\ttry {\n\t\t\tconst socialData = await socialEnrichmentService.enrichSocial(\n\t\t\t\tcustomer.email,\n\t\t\t\tfullName,\n\t\t\t);\n\t\t\tif (socialData) {\n\t\t\t\tenrichmentData.social = socialData;\n\t\t\t\tsources.push(\"social\");\n\t\t\t}\n\t\t} catch (_error) {}\n\n\t\t// 4. Property enrichment (if address provided)\n\t\tif (\n\t\t\tcustomer.address &&\n\t\t\tcustomer.city &&\n\t\t\tcustomer.state &&\n\t\t\tcustomer.zipCode\n\t\t) {\n\t\t\ttry {\n\t\t\t\tconst propertyData = await propertyEnrichmentService.enrichProperty(\n\t\t\t\t\tcustomer.address,\n\t\t\t\t\tcustomer.city,\n\t\t\t\t\tcustomer.state,\n\t\t\t\t\tcustomer.zipCode,\n\t\t\t\t);\n\t\t\t\tif (propertyData) {\n\t\t\t\t\tenrichmentData.properties = [propertyData];\n\t\t\t\t\tsources.push(propertyData.source);\n\t\t\t\t}\n\t\t\t} catch (_error) {}\n\t\t}\n\n\t\t// Calculate overall confidence score\n\t\tconst confidenceScores: number[] = [];\n\t\tif (enrichmentData.person) {\n\t\t\tconfidenceScores.push((enrichmentData.person as any).confidence);\n\t\t}\n\t\tif (enrichmentData.business) {\n\t\t\tconfidenceScores.push((enrichmentData.business as any).confidence);\n\t\t}\n\t\tif (enrichmentData.social) {\n\t\t\tconfidenceScores.push((enrichmentData.social as any).confidence);\n\t\t}\n\t\tif (enrichmentData.properties?.length) {\n\t\t\tconfidenceScores.push((enrichmentData.properties[0] as any).confidence);\n\t\t}\n\n\t\tconst overallConfidence = confidenceScores.length\n\t\t\t? Math.round(\n\t\t\t\t\tconfidenceScores.reduce((sum, score) => sum + score, 0) /\n\t\t\t\t\t\tconfidenceScores.length,\n\t\t\t\t)\n\t\t\t: 0;\n\n\t\tconst now = new Date();\n\t\tconst expiresAt = new Date(now.getTime() + this.cacheTTL);\n\n\t\treturn CustomerEnrichmentSchema.parse({\n\t\t\t...enrichmentData,\n\t\t\tenrichmentStatus: sources.length > 0 ? \"completed\" : \"failed\",\n\t\t\tlastEnrichedAt: now.toISOString(),\n\t\t\texpiresAt: expiresAt.toISOString(),\n\t\t\tsources,\n\t\t\toverallConfidence,\n\t\t});\n\t}\n\n\t/**\n\t * Check if enrichment data is still valid (not expired)\n\t */\n\tisEnrichmentValid(enrichment: CustomerEnrichment): boolean {\n\t\tif (!enrichment.expiresAt) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst expiresAt = new Date(enrichment.expiresAt);\n\t\treturn expiresAt > new Date();\n\t}\n\n\t/**\n\t * Get cache TTL in milliseconds\n\t */\n\tgetCacheTTL(): number {\n\t\treturn this.cacheTTL;\n\t}\n\n\t/**\n\t * Set custom cache TTL (useful for premium tiers)\n\t */\n\tsetCacheTTL(ttlMs: number): void {\n\t\tthis.cacheTTL = ttlMs;\n\t}\n}\n\n// Singleton instance\nexport const customerEnrichmentService = new CustomerEnrichmentService();\n","/**\n * Business Intelligence Enrichment Service\n *\n * Integrates with business data APIs:\n * - Google Places API ($200 free credit/month)\n * - OpenCorporates API (free tier)\n *\n * Features:\n * - Business details and verification\n * - Reviews and ratings\n * - Company registration data\n * - Business hours and contact info\n */\n\nimport { z } from \"zod\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst BusinessEnrichmentSchema = z.object({\n\t// Basic info\n\tbusinessName: z.string(),\n\tbusinessType: z.string().optional(),\n\n\t// Contact info\n\tphone: z.string().optional(),\n\twebsite: z.string().url().optional(),\n\temail: z.string().email().optional(),\n\n\t// Location\n\taddress: z\n\t\t.object({\n\t\t\tstreet: z.string().optional(),\n\t\t\tcity: z.string().optional(),\n\t\t\tstate: z.string().optional(),\n\t\t\tzipCode: z.string().optional(),\n\t\t\tcountry: z.string().optional(),\n\t\t\tlatitude: z.number().optional(),\n\t\t\tlongitude: z.number().optional(),\n\t\t})\n\t\t.optional(),\n\n\t// Business details\n\tdescription: z.string().optional(),\n\tcategories: z.array(z.string()).optional(),\n\tpriceLevel: z.number().min(1).max(4).optional(), // 1-4 dollar signs\n\n\t// Reviews and ratings\n\trating: z.number().min(0).max(5).optional(),\n\treviewCount: z.number().optional(),\n\treviews: z\n\t\t.array(\n\t\t\tz.object({\n\t\t\t\tauthor: z.string(),\n\t\t\t\trating: z.number(),\n\t\t\t\ttext: z.string(),\n\t\t\t\ttime: z.string(),\n\t\t\t}),\n\t\t)\n\t\t.optional(),\n\n\t// Operating hours\n\thours: z\n\t\t.object({\n\t\t\tmonday: z.string().optional(),\n\t\t\ttuesday: z.string().optional(),\n\t\t\twednesday: z.string().optional(),\n\t\t\tthursday: z.string().optional(),\n\t\t\tfriday: z.string().optional(),\n\t\t\tsaturday: z.string().optional(),\n\t\t\tsunday: z.string().optional(),\n\t\t})\n\t\t.optional(),\n\n\t// Photos\n\tphotos: z.array(z.string().url()).optional(),\n\n\t// Company registration (from OpenCorporates)\n\tregistration: z\n\t\t.object({\n\t\t\tcompanyNumber: z.string().optional(),\n\t\t\tjurisdiction: z.string().optional(),\n\t\t\tincorporationDate: z.string().optional(),\n\t\t\tcompanyType: z.string().optional(),\n\t\t\tstatus: z.string().optional(),\n\t\t\tregisteredAddress: z.string().optional(),\n\t\t})\n\t\t.optional(),\n\n\t// Metadata\n\tsource: z.enum([\"google_places\", \"opencorporates\", \"combined\"]),\n\tconfidence: z.number().min(0).max(100),\n\tenrichedAt: z.string(),\n});\n\nexport type BusinessEnrichment = z.infer<typeof BusinessEnrichmentSchema>;\n\n// ============================================================================\n// Business Enrichment Service\n// ============================================================================\n\nclass BusinessEnrichmentService {\n\tprivate readonly googlePlacesApiKey: string | undefined;\n\tprivate readonly openCorporatesApiKey: string | undefined;\n\n\tconstructor() {\n\t\tthis.googlePlacesApiKey = process.env.GOOGLE_PLACES_API_KEY;\n\t\tthis.openCorporatesApiKey = process.env.OPENCORPORATES_API_KEY;\n\t}\n\n\t/**\n\t * Enrich business data\n\t */\n\tasync enrichBusiness(\n\t\tbusinessName: string,\n\t\taddress?: string,\n\t\tcity?: string,\n\t\tstate?: string,\n\t): Promise<BusinessEnrichment | null> {\n\t\tlet placesData: any = null;\n\t\tlet corporatesData: any = null;\n\n\t\t// Try Google Places first\n\t\ttry {\n\t\t\tplacesData = await this.enrichWithGooglePlaces(\n\t\t\t\tbusinessName,\n\t\t\t\taddress,\n\t\t\t\tcity,\n\t\t\t\tstate,\n\t\t\t);\n\t\t} catch (_error) {}\n\n\t\t// Try OpenCorporates for registration data\n\t\ttry {\n\t\t\tcorporatesData = await this.enrichWithOpenCorporates(businessName, state);\n\t\t} catch (_error) {}\n\n\t\t// Combine results\n\t\tif (!(placesData || corporatesData)) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Merge data from both sources\n\t\treturn BusinessEnrichmentSchema.parse({\n\t\t\tbusinessName:\n\t\t\t\tplacesData?.businessName ||\n\t\t\t\tcorporatesData?.businessName ||\n\t\t\t\tbusinessName,\n\t\t\tbusinessType: placesData?.businessType || corporatesData?.businessType,\n\t\t\tphone: placesData?.phone,\n\t\t\twebsite: placesData?.website,\n\t\t\temail: placesData?.email,\n\t\t\taddress: placesData?.address,\n\t\t\tdescription: placesData?.description,\n\t\t\tcategories: placesData?.categories,\n\t\t\tpriceLevel: placesData?.priceLevel,\n\t\t\trating: placesData?.rating,\n\t\t\treviewCount: placesData?.reviewCount,\n\t\t\treviews: placesData?.reviews,\n\t\t\thours: placesData?.hours,\n\t\t\tphotos: placesData?.photos,\n\t\t\tregistration: corporatesData?.registration,\n\t\t\tsource:\n\t\t\t\tplacesData && corporatesData\n\t\t\t\t\t? \"combined\"\n\t\t\t\t\t: placesData\n\t\t\t\t\t\t? \"google_places\"\n\t\t\t\t\t\t: \"opencorporates\",\n\t\t\tconfidence: placesData ? 90 : 70,\n\t\t\tenrichedAt: new Date().toISOString(),\n\t\t});\n\t}\n\n\t/**\n\t * Enrich using Google Places API\n\t */\n\tprivate async enrichWithGooglePlaces(\n\t\tbusinessName: string,\n\t\taddress?: string,\n\t\tcity?: string,\n\t\tstate?: string,\n\t): Promise<Partial<BusinessEnrichment> | null> {\n\t\tif (!this.googlePlacesApiKey) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Build search query\n\t\tconst query = [businessName, address, city, state]\n\t\t\t.filter(Boolean)\n\t\t\t.join(\", \");\n\n\t\t// Step 1: Find place\n\t\tconst searchUrl = `https://maps.googleapis.com/maps/api/place/findplacefromtext/json?input=${encodeURIComponent(query)}&inputtype=textquery&fields=place_id&key=${this.googlePlacesApiKey}`;\n\n\t\tconst searchResponse = await fetch(searchUrl);\n\t\tif (!searchResponse.ok) {\n\t\t\tthrow new Error(\n\t\t\t\t`Google Places search error: ${searchResponse.statusText}`,\n\t\t\t);\n\t\t}\n\n\t\tconst searchData = await searchResponse.json();\n\t\tif (!searchData.candidates?.length) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst placeId = searchData.candidates[0].place_id;\n\n\t\t// Step 2: Get place details\n\t\tconst detailsUrl = `https://maps.googleapis.com/maps/api/place/details/json?place_id=${placeId}&fields=name,formatted_phone_number,website,formatted_address,geometry,rating,user_ratings_total,reviews,opening_hours,photos,types,price_level,business_status&key=${this.googlePlacesApiKey}`;\n\n\t\tconst detailsResponse = await fetch(detailsUrl);\n\t\tif (!detailsResponse.ok) {\n\t\t\tthrow new Error(\n\t\t\t\t`Google Places details error: ${detailsResponse.statusText}`,\n\t\t\t);\n\t\t}\n\n\t\tconst detailsData = await detailsResponse.json();\n\t\tconst place = detailsData.result;\n\n\t\tif (!place) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Parse address components\n\t\tconst addressParts = place.formatted_address?.split(\", \") || [];\n\n\t\t// Parse opening hours\n\t\tconst hours = place.opening_hours?.weekday_text\n\t\t\t? {\n\t\t\t\t\tmonday: place.opening_hours.weekday_text[0]?.split(\": \")[1],\n\t\t\t\t\ttuesday: place.opening_hours.weekday_text[1]?.split(\": \")[1],\n\t\t\t\t\twednesday: place.opening_hours.weekday_text[2]?.split(\": \")[1],\n\t\t\t\t\tthursday: place.opening_hours.weekday_text[3]?.split(\": \")[1],\n\t\t\t\t\tfriday: place.opening_hours.weekday_text[4]?.split(\": \")[1],\n\t\t\t\t\tsaturday: place.opening_hours.weekday_text[5]?.split(\": \")[1],\n\t\t\t\t\tsunday: place.opening_hours.weekday_text[6]?.split(\": \")[1],\n\t\t\t\t}\n\t\t\t: undefined;\n\n\t\t// Get photo URLs (first 5)\n\t\tconst photos = place.photos\n\t\t\t?.slice(0, 5)\n\t\t\t.map(\n\t\t\t\t(photo: any) =>\n\t\t\t\t\t`https://maps.googleapis.com/maps/api/place/photo?maxwidth=800&photoreference=${photo.photo_reference}&key=${this.googlePlacesApiKey}`,\n\t\t\t);\n\n\t\treturn {\n\t\t\tbusinessName: place.name,\n\t\t\tbusinessType: place.types?.[0],\n\t\t\tphone: place.formatted_phone_number,\n\t\t\twebsite: place.website,\n\t\t\taddress: {\n\t\t\t\tstreet: addressParts[0],\n\t\t\t\tcity: addressParts[1],\n\t\t\t\tstate: addressParts[2]?.split(\" \")[0],\n\t\t\t\tzipCode: addressParts[2]?.split(\" \")[1],\n\t\t\t\tlatitude: place.geometry?.location?.lat,\n\t\t\t\tlongitude: place.geometry?.location?.lng,\n\t\t\t},\n\t\t\tcategories: place.types,\n\t\t\tpriceLevel: place.price_level,\n\t\t\trating: place.rating,\n\t\t\treviewCount: place.user_ratings_total,\n\t\t\treviews: place.reviews?.slice(0, 5).map((review: any) => ({\n\t\t\t\tauthor: review.author_name,\n\t\t\t\trating: review.rating,\n\t\t\t\ttext: review.text,\n\t\t\t\ttime: new Date(review.time * 1000).toISOString(),\n\t\t\t})),\n\t\t\thours,\n\t\t\tphotos,\n\t\t};\n\t}\n\n\t/**\n\t * Enrich using OpenCorporates API\n\t */\n\tprivate async enrichWithOpenCorporates(\n\t\tbusinessName: string,\n\t\tstate?: string,\n\t): Promise<Partial<BusinessEnrichment> | null> {\n\t\t// OpenCorporates has a free tier, no API key required for basic searches\n\t\tconst jurisdiction = state ? `us_${state.toLowerCase()}` : \"us\";\n\t\tconst url = `https://api.opencorporates.com/v0.4/companies/search?q=${encodeURIComponent(businessName)}&jurisdiction_code=${jurisdiction}`;\n\n\t\tconst response = await fetch(url, {\n\t\t\theaders: {\n\t\t\t\t...(this.openCorporatesApiKey && {\n\t\t\t\t\t\"X-API-Key\": this.openCorporatesApiKey,\n\t\t\t\t}),\n\t\t\t},\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error(`OpenCorporates API error: ${response.statusText}`);\n\t\t}\n\n\t\tconst data = await response.json();\n\t\tconst company = data.results?.companies?.[0]?.company;\n\n\t\tif (!company) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tbusinessName: company.name,\n\t\t\tregistration: {\n\t\t\t\tcompanyNumber: company.company_number,\n\t\t\t\tjurisdiction: company.jurisdiction_code,\n\t\t\t\tincorporationDate: company.incorporation_date,\n\t\t\t\tcompanyType: company.company_type,\n\t\t\t\tstatus: company.current_status,\n\t\t\t\tregisteredAddress: company.registered_address_in_full,\n\t\t\t},\n\t\t};\n\t}\n}\n\n// Singleton instance\nexport const businessEnrichmentService = new BusinessEnrichmentService();\n","/**\n * Person/Contact Data Enrichment Service\n *\n * Integrates with person data APIs to provide comprehensive contact information:\n * - Hunter.io (25 free/month)\n *\n * Features:\n * - Email verification\n * - Job title and company\n */\n\nimport { z } from \"zod\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst PersonEnrichmentSchema = z.object({\n\t// Basic info\n\tfullName: z.string().optional(),\n\tfirstName: z.string().optional(),\n\tlastName: z.string().optional(),\n\temail: z.string().email(),\n\temailVerified: z.boolean().optional(),\n\n\t// Professional info\n\tjobTitle: z.string().optional(),\n\tseniority: z.string().optional(), // 'executive', 'director', 'manager', 'individual'\n\n\t// Company info\n\tcompany: z\n\t\t.object({\n\t\t\tname: z.string().optional(),\n\t\t\tdomain: z.string().optional(),\n\t\t\tindustry: z.string().optional(),\n\t\t\tsize: z.string().optional(),\n\t\t\tlocation: z.string().optional(),\n\t\t\tdescription: z.string().optional(),\n\t\t})\n\t\t.optional(),\n\n\t// Social profiles\n\tsocialProfiles: z\n\t\t.object({\n\t\t\tlinkedin: z.string().url().optional(),\n\t\t\ttwitter: z.string().url().optional(),\n\t\t\tfacebook: z.string().url().optional(),\n\t\t\tgithub: z.string().url().optional(),\n\t\t})\n\t\t.optional(),\n\n\t// Contact info\n\tphone: z.string().optional(),\n\tlocation: z\n\t\t.object({\n\t\t\tcity: z.string().optional(),\n\t\t\tstate: z.string().optional(),\n\t\t\tcountry: z.string().optional(),\n\t\t})\n\t\t.optional(),\n\n\t// Metadata\n\tsource: z.enum([\"hunter\"]),\n\tconfidence: z.number().min(0).max(100),\n\tenrichedAt: z.string(),\n});\n\nexport type PersonEnrichment = z.infer<typeof PersonEnrichmentSchema>;\n\n// ============================================================================\n// Person Enrichment Service\n// ============================================================================\n\nclass PersonEnrichmentService {\n\tprivate readonly hunterApiKey: string | undefined;\n\n\tconstructor() {\n\t\tthis.hunterApiKey = process.env.HUNTER_API_KEY;\n\t}\n\n\t/**\n\t * Enrich person data from email address\n\t */\n\tasync enrichPerson(email: string): Promise<PersonEnrichment | null> {\n\t\ttry {\n\t\t\treturn await this.enrichWithHunter(email);\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Enrich using Hunter.io API\n\t * https://hunter.io/api-documentation\n\t */\n\tprivate async enrichWithHunter(\n\t\temail: string,\n\t): Promise<PersonEnrichment | null> {\n\t\tif (!this.hunterApiKey) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst url = `https://api.hunter.io/v2/email-verifier?email=${encodeURIComponent(email)}&api_key=${this.hunterApiKey}`;\n\n\t\tconst response = await fetch(url);\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error(`Hunter API error: ${response.statusText}`);\n\t\t}\n\n\t\tconst data = await response.json();\n\n\t\tif (!data.data) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Hunter gives us limited info, mainly email verification\n\t\treturn PersonEnrichmentSchema.parse({\n\t\t\temail,\n\t\t\temailVerified: data.data.status === \"valid\",\n\t\t\tfirstName: data.data.first_name,\n\t\t\tlastName: data.data.last_name,\n\t\t\tcompany: data.data.organization\n\t\t\t\t? {\n\t\t\t\t\t\tname: data.data.organization,\n\t\t\t\t\t}\n\t\t\t\t: undefined,\n\t\t\tsocialProfiles: data.data.sources?.length\n\t\t\t\t? {\n\t\t\t\t\t\tlinkedin: data.data.sources.find((s: any) =>\n\t\t\t\t\t\t\ts.uri?.includes(\"linkedin\"),\n\t\t\t\t\t\t)?.uri,\n\t\t\t\t\t}\n\t\t\t\t: undefined,\n\t\t\tsource: \"hunter\",\n\t\t\tconfidence: data.data.score || 50,\n\t\t\tenrichedAt: new Date().toISOString(),\n\t\t});\n\t}\n}\n\n// Singleton instance\nexport const personEnrichmentService = new PersonEnrichmentService();\n","/**\n * Property Data Enrichment Service\n *\n * Integrates with property data APIs to provide comprehensive property information\n * for contractors. This service enriches job property data with:\n * - Property details (square footage, year built, lot size, etc.)\n * - Ownership information\n * - Tax assessments and valuations\n * - Permit history\n * - Comparable properties\n * - Neighborhood data\n *\n * Supported APIs:\n * - Attom Data Solutions (property data aggregator)\n * - CoreLogic (property information and analytics)\n * - Zillow API (property valuations)\n * - Google Places API (location context)\n * - OpenStreetMap/Mapbox (mapping and geocoding)\n */\n\nimport { z } from \"zod\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\n/**\n * Property enrichment data from external APIs\n */\nconst PropertyEnrichmentSchema = z.object({\n\t// Basic property details\n\tpropertyId: z.string(),\n\taddress: z.object({\n\t\tstreet: z.string(),\n\t\tcity: z.string(),\n\t\tstate: z.string(),\n\t\tzipCode: z.string(),\n\t\tcounty: z.string().optional(),\n\t\tlatitude: z.number().optional(),\n\t\tlongitude: z.number().optional(),\n\t}),\n\n\t// Property characteristics\n\tdetails: z.object({\n\t\tpropertyType: z.enum([\n\t\t\t\"single_family\",\n\t\t\t\"multi_family\",\n\t\t\t\"condo\",\n\t\t\t\"townhouse\",\n\t\t\t\"commercial\",\n\t\t\t\"industrial\",\n\t\t\t\"land\",\n\t\t\t\"other\",\n\t\t]),\n\t\tsquareFootage: z.number().optional(),\n\t\tlotSizeSquareFeet: z.number().optional(),\n\t\tyearBuilt: z.number().optional(),\n\t\tbedrooms: z.number().optional(),\n\t\tbathrooms: z.number().optional(),\n\t\tstories: z.number().optional(),\n\t\tgarageSpaces: z.number().optional(),\n\t\thasPool: z.boolean().optional(),\n\t\thasBasement: z.boolean().optional(),\n\t\troofType: z.string().optional(),\n\t\texteriorWalls: z.string().optional(),\n\t\theatingType: z.string().optional(),\n\t\tcoolingType: z.string().optional(),\n\t}),\n\n\t// Ownership and valuation\n\townership: z.object({\n\t\townerName: z.string().optional(),\n\t\townerOccupied: z.boolean().optional(),\n\t\tlastSaleDate: z.string().optional(), // ISO date\n\t\tlastSalePrice: z.number().optional(), // in cents\n\t\tassessedValue: z.number().optional(), // in cents\n\t\tmarketValue: z.number().optional(), // in cents\n\t}),\n\n\t// Tax information\n\ttaxes: z.object({\n\t\tannualAmount: z.number().optional(), // in cents\n\t\ttaxYear: z.number().optional(),\n\t\tassessedLandValue: z.number().optional(), // in cents\n\t\tassessedImprovementValue: z.number().optional(), // in cents\n\t}),\n\n\t// Permit history\n\tpermits: z.array(\n\t\tz.object({\n\t\t\tpermitNumber: z.string(),\n\t\t\ttype: z.string(),\n\t\t\tdescription: z.string(),\n\t\t\tissuedDate: z.string(), // ISO date\n\t\t\tstatus: z.enum([\"issued\", \"completed\", \"expired\", \"cancelled\"]),\n\t\t\tcontractor: z.string().optional(),\n\t\t\tvalue: z.number().optional(), // in cents\n\t\t}),\n\t),\n\n\t// Utilities and services\n\tutilities: z.object({\n\t\telectricProvider: z.string().optional(),\n\t\tgasProvider: z.string().optional(),\n\t\twaterProvider: z.string().optional(),\n\t\tsewerType: z.enum([\"public\", \"septic\", \"unknown\"]).optional(),\n\t}),\n\n\t// Risk factors (for insurance and planning)\n\triskFactors: z.object({\n\t\tfloodZone: z.string().optional(),\n\t\tearthquakeZone: z.string().optional(),\n\t\tfireZone: z.string().optional(),\n\t\thurricaneZone: z.string().optional(),\n\t}),\n\n\t// Metadata\n\tenrichedAt: z.string(), // ISO timestamp\n\tsource: z.enum([\"attom\", \"corelogic\", \"zillow\", \"manual\"]),\n\tconfidence: z.number().min(0).max(100), // Data confidence score\n});\n\nexport type PropertyEnrichment = z.infer<typeof PropertyEnrichmentSchema>;\n\n/**\n * API configuration for property data providers\n */\ntype PropertyDataProvider = {\n\tname: string;\n\tapiKey: string;\n\tbaseUrl: string;\n\trateLimit: {\n\t\trequestsPerSecond: number;\n\t\trequestsPerDay: number;\n\t};\n};\n\n// ============================================================================\n// Property Enrichment Service\n// ============================================================================\n\nclass PropertyEnrichmentService {\n\tprivate readonly providers: Map<string, PropertyDataProvider> = new Map();\n\tprivate readonly cache: Map<string, PropertyEnrichment> = new Map();\n\tprivate readonly cacheTTL = 1000 * 60 * 60 * 24 * 7; // 7 days\n\n\tconstructor() {\n\t\tthis.initializeProviders();\n\t}\n\n\t/**\n\t * Initialize property data providers from environment variables\n\t */\n\tprivate initializeProviders(): void {\n\t\t// Attom Data Solutions\n\t\tif (process.env.ATTOM_API_KEY) {\n\t\t\tthis.providers.set(\"attom\", {\n\t\t\t\tname: \"Attom Data Solutions\",\n\t\t\t\tapiKey: process.env.ATTOM_API_KEY,\n\t\t\t\tbaseUrl: \"https://api.gateway.attomdata.com/propertyapi/v1.0.0\",\n\t\t\t\trateLimit: {\n\t\t\t\t\trequestsPerSecond: 10,\n\t\t\t\t\trequestsPerDay: 10_000,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\t// CoreLogic (placeholder - requires enterprise account)\n\t\tif (process.env.CORELOGIC_API_KEY) {\n\t\t\tthis.providers.set(\"corelogic\", {\n\t\t\t\tname: \"CoreLogic\",\n\t\t\t\tapiKey: process.env.CORELOGIC_API_KEY,\n\t\t\t\tbaseUrl: \"https://api.corelogic.com/v1\",\n\t\t\t\trateLimit: {\n\t\t\t\t\trequestsPerSecond: 5,\n\t\t\t\t\trequestsPerDay: 5000,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\t// Zillow (note: Zillow API is deprecated, but keeping for reference)\n\t\tif (process.env.ZILLOW_API_KEY) {\n\t\t\tthis.providers.set(\"zillow\", {\n\t\t\t\tname: \"Zillow\",\n\t\t\t\tapiKey: process.env.ZILLOW_API_KEY,\n\t\t\t\tbaseUrl: \"https://www.zillow.com/webservice\",\n\t\t\t\trateLimit: {\n\t\t\t\t\trequestsPerSecond: 1,\n\t\t\t\t\trequestsPerDay: 1000,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Enrich property data with external API information\n\t */\n\tasync enrichProperty(\n\t\taddress: string,\n\t\tcity: string,\n\t\tstate: string,\n\t\tzipCode: string,\n\t): Promise<PropertyEnrichment | null> {\n\t\tconst cacheKey = `${address}-${city}-${state}-${zipCode}`.toLowerCase();\n\n\t\t// Check cache first\n\t\tconst cached = this.cache.get(cacheKey);\n\t\tif (cached) {\n\t\t\tconst age = Date.now() - new Date(cached.enrichedAt).getTime();\n\t\t\tif (age < this.cacheTTL) {\n\t\t\t\treturn cached;\n\t\t\t}\n\t\t}\n\n\t\t// Try each provider in order of preference\n\t\tconst providers = [\"attom\", \"corelogic\", \"zillow\"];\n\n\t\tfor (const providerName of providers) {\n\t\t\tconst provider = this.providers.get(providerName);\n\t\t\tif (!provider) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst enrichment = await this.fetchFromProvider(\n\t\t\t\t\tprovider,\n\t\t\t\t\taddress,\n\t\t\t\t\tcity,\n\t\t\t\t\tstate,\n\t\t\t\t\tzipCode,\n\t\t\t\t);\n\n\t\t\t\tif (enrichment) {\n\t\t\t\t\t// Cache the result\n\t\t\t\t\tthis.cache.set(cacheKey, enrichment);\n\t\t\t\t\treturn enrichment;\n\t\t\t\t}\n\t\t\t} catch (_error) {\n\t\t\t\t// Continue to next provider\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Fetch property data from a specific provider\n\t */\n\tprivate async fetchFromProvider(\n\t\tprovider: PropertyDataProvider,\n\t\taddress: string,\n\t\tcity: string,\n\t\tstate: string,\n\t\tzipCode: string,\n\t): Promise<PropertyEnrichment | null> {\n\t\t// This is a placeholder implementation\n\t\t// In production, you would implement actual API calls to each provider\n\n\t\tif (provider.name === \"Attom Data Solutions\") {\n\t\t\treturn this.fetchFromAttom(provider, address, city, state, zipCode);\n\t\t}\n\n\t\t// Add other providers as needed\n\t\treturn null;\n\t}\n\n\t/**\n\t * Fetch from Attom Data Solutions API\n\t */\n\tprivate async fetchFromAttom(\n\t\tprovider: PropertyDataProvider,\n\t\taddress: string,\n\t\tcity: string,\n\t\tstate: string,\n\t\tzipCode: string,\n\t): Promise<PropertyEnrichment | null> {\n\t\t// Example Attom API call\n\t\t// Note: This is a simplified example - actual implementation would be more complex\n\n\t\tconst url = `${provider.baseUrl}/property/basicprofile?address1=${encodeURIComponent(address)}&address2=${encodeURIComponent(`${city}, ${state} ${zipCode}`)}`;\n\n\t\tconst response = await fetch(url, {\n\t\t\theaders: {\n\t\t\t\tAccept: \"application/json\",\n\t\t\t\tapikey: provider.apiKey,\n\t\t\t},\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error(`Attom API error: ${response.statusText}`);\n\t\t}\n\n\t\tconst data = await response.json();\n\n\t\t// Transform Attom data to our schema\n\t\t// This is a simplified transformation - actual implementation would be more comprehensive\n\t\treturn PropertyEnrichmentSchema.parse({\n\t\t\tpropertyId: data.property?.id || `${address}-${zipCode}`,\n\t\t\taddress: {\n\t\t\t\tstreet: address,\n\t\t\t\tcity,\n\t\t\t\tstate,\n\t\t\t\tzipCode,\n\t\t\t\tcounty: data.property?.address?.countrySecSubd,\n\t\t\t\tlatitude: data.property?.address?.latitude,\n\t\t\t\tlongitude: data.property?.address?.longitude,\n\t\t\t},\n\t\t\tdetails: {\n\t\t\t\tpropertyType:\n\t\t\t\t\tthis.mapPropertyType(data.property?.summary?.proptype) ||\n\t\t\t\t\t\"single_family\",\n\t\t\t\tsquareFootage: data.building?.size?.bldgsize,\n\t\t\t\tlotSizeSquareFeet: data.lot?.lotsize1,\n\t\t\t\tyearBuilt: data.building?.summary?.yearbuilt,\n\t\t\t\tbedrooms: data.building?.rooms?.beds,\n\t\t\t\tbathrooms: data.building?.rooms?.bathstotal,\n\t\t\t\tstories: data.building?.summary?.stories,\n\t\t\t\thasPool: data.building?.interior?.ftrpool === \"Y\",\n\t\t\t\troofType: data.building?.construction?.roofcover,\n\t\t\t\texteriorWalls: data.building?.construction?.walltype,\n\t\t\t\theatingType: data.building?.interior?.heating,\n\t\t\t\tcoolingType: data.building?.interior?.cooling,\n\t\t\t},\n\t\t\townership: {\n\t\t\t\townerName: data.owner?.owner1?.lastname1,\n\t\t\t\tlastSaleDate: data.sale?.saleTransDate,\n\t\t\t\tlastSalePrice: data.sale?.amount?.saleamt\n\t\t\t\t\t? data.sale.amount.saleamt * 100\n\t\t\t\t\t: undefined,\n\t\t\t\tassessedValue: data.assessment?.assessed?.assdttlvalue\n\t\t\t\t\t? data.assessment.assessed.assdttlvalue * 100\n\t\t\t\t\t: undefined,\n\t\t\t\tmarketValue: data.assessment?.market?.mktttlvalue\n\t\t\t\t\t? data.assessment.market.mktttlvalue * 100\n\t\t\t\t\t: undefined,\n\t\t\t},\n\t\t\ttaxes: {\n\t\t\t\tannualAmount: data.assessment?.tax?.taxamt\n\t\t\t\t\t? data.assessment.tax.taxamt * 100\n\t\t\t\t\t: undefined,\n\t\t\t\ttaxYear: data.assessment?.tax?.taxyear,\n\t\t\t},\n\t\t\tpermits: [], // Permits would require a separate API call\n\t\t\tutilities: {},\n\t\t\triskFactors: {},\n\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\tsource: \"attom\",\n\t\t\tconfidence: 85,\n\t\t});\n\t}\n\n\t/**\n\t * Map provider-specific property types to our enum\n\t */\n\tprivate mapPropertyType(\n\t\tproviderType: string | undefined,\n\t): PropertyEnrichment[\"details\"][\"propertyType\"] | undefined {\n\t\tif (!providerType) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst typeMap: Record<\n\t\t\tstring,\n\t\t\tPropertyEnrichment[\"details\"][\"propertyType\"]\n\t\t> = {\n\t\t\tSFR: \"single_family\",\n\t\t\tMFR: \"multi_family\",\n\t\t\tCONDO: \"condo\",\n\t\t\tTOWNHOUSE: \"townhouse\",\n\t\t\tCOMMERCIAL: \"commercial\",\n\t\t\tINDUSTRIAL: \"industrial\",\n\t\t\tLAND: \"land\",\n\t\t};\n\n\t\treturn typeMap[providerType.toUpperCase()] || \"other\";\n\t}\n\n\t/**\n\t * Get permit history for a property\n\t */\n\tasync getPermitHistory(\n\t\t_address: string,\n\t\t_city: string,\n\t\t_state: string,\n\t\t_zipCode: string,\n\t): Promise<PropertyEnrichment[\"permits\"]> {\n\t\t// This would integrate with local permit systems or aggregators\n\t\t// Implementation depends on availability of permit data APIs\n\t\treturn [];\n\t}\n\n\t/**\n\t * Clear cache (useful for testing or manual refresh)\n\t */\n\tclearCache(): void {\n\t\tthis.cache.clear();\n\t}\n}\n\n// ============================================================================\n// Singleton instance\n// ============================================================================\n\nexport const propertyEnrichmentService = new PropertyEnrichmentService();\n","/**\n * Social Media Enrichment Service\n *\n * Integrates with social media APIs:\n * - LinkedIn (via RapidAPI)\n * - Twitter/X API\n * - Facebook Graph API\n *\n * Features:\n * - Find social profiles by name/email\n * - Extract profile information\n * - Get follower counts and engagement\n */\n\nimport { z } from \"zod\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst SocialEnrichmentSchema = z.object({\n\tprofiles: z.object({\n\t\tlinkedin: z\n\t\t\t.object({\n\t\t\t\turl: z.string().url().optional(),\n\t\t\t\theadline: z.string().optional(),\n\t\t\t\tconnections: z.number().optional(),\n\t\t\t\tverified: z.boolean().optional(),\n\t\t\t})\n\t\t\t.optional(),\n\n\t\ttwitter: z\n\t\t\t.object({\n\t\t\t\turl: z.string().url().optional(),\n\t\t\t\tusername: z.string().optional(),\n\t\t\t\tfollowers: z.number().optional(),\n\t\t\t\tverified: z.boolean().optional(),\n\t\t\t\tbio: z.string().optional(),\n\t\t\t})\n\t\t\t.optional(),\n\n\t\tfacebook: z\n\t\t\t.object({\n\t\t\t\turl: z.string().url().optional(),\n\t\t\t\tname: z.string().optional(),\n\t\t\t\tverified: z.boolean().optional(),\n\t\t\t})\n\t\t\t.optional(),\n\t}),\n\n\t// Metadata\n\tconfidence: z.number().min(0).max(100),\n\tenrichedAt: z.string(),\n});\n\nexport type SocialEnrichment = z.infer<typeof SocialEnrichmentSchema>;\n\n// ============================================================================\n// Social Enrichment Service\n// ============================================================================\n\nclass SocialEnrichmentService {\n\tprivate readonly rapidApiKey: string | undefined;\n\tprivate readonly twitterBearerToken: string | undefined;\n\tprivate readonly facebookAppId: string | undefined;\n\tprivate readonly facebookAppSecret: string | undefined;\n\n\tconstructor() {\n\t\tthis.rapidApiKey = process.env.RAPIDAPI_KEY;\n\t\tthis.twitterBearerToken = process.env.TWITTER_BEARER_TOKEN;\n\t\tthis.facebookAppId = process.env.FACEBOOK_APP_ID;\n\t\tthis.facebookAppSecret = process.env.FACEBOOK_APP_SECRET;\n\t}\n\n\t/**\n\t * Enrich social media profiles\n\t */\n\tasync enrichSocial(\n\t\temail: string,\n\t\tfullName?: string,\n\t): Promise<SocialEnrichment | null> {\n\t\tconst profiles: SocialEnrichment[\"profiles\"] = {};\n\n\t\t// Try to find profiles on each platform\n\t\ttry {\n\t\t\tconst linkedinProfile = await this.findLinkedInProfile(email, fullName);\n\t\t\tif (linkedinProfile) {\n\t\t\t\tprofiles.linkedin = linkedinProfile;\n\t\t\t}\n\t\t} catch (_error) {}\n\n\t\ttry {\n\t\t\tconst twitterProfile = await this.findTwitterProfile(fullName);\n\t\t\tif (twitterProfile) {\n\t\t\t\tprofiles.twitter = twitterProfile;\n\t\t\t}\n\t\t} catch (_error) {}\n\n\t\ttry {\n\t\t\tconst facebookProfile = await this.findFacebookProfile(email);\n\t\t\tif (facebookProfile) {\n\t\t\t\tprofiles.facebook = facebookProfile;\n\t\t\t}\n\t\t} catch (_error) {}\n\n\t\t// Return null if no profiles found\n\t\tif (Object.keys(profiles).length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn SocialEnrichmentSchema.parse({\n\t\t\tprofiles,\n\t\t\tconfidence: Object.keys(profiles).length * 30, // More profiles = higher confidence\n\t\t\tenrichedAt: new Date().toISOString(),\n\t\t});\n\t}\n\n\t/**\n\t * Find LinkedIn profile using RapidAPI\n\t */\n\tprivate async findLinkedInProfile(\n\t\temail: string,\n\t\tfullName?: string,\n\t): Promise<SocialEnrichment[\"profiles\"][\"linkedin\"] | null> {\n\t\tif (!this.rapidApiKey) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Use LinkedIn Profile Scraper API from RapidAPI\n\t\t// Note: This is a placeholder - actual implementation depends on the specific API\n\t\tconst searchQuery = fullName || email;\n\t\tconst url = `https://linkedin-data-api.p.rapidapi.com/search?keywords=${encodeURIComponent(searchQuery)}`;\n\n\t\tconst response = await fetch(url, {\n\t\t\theaders: {\n\t\t\t\t\"X-RapidAPI-Key\": this.rapidApiKey,\n\t\t\t\t\"X-RapidAPI-Host\": \"linkedin-data-api.p.rapidapi.com\",\n\t\t\t},\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tif (response.status === 404) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tthrow new Error(`LinkedIn API error: ${response.statusText}`);\n\t\t}\n\n\t\tconst data = await response.json();\n\t\tconst profile = data.data?.[0];\n\n\t\tif (!profile) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\turl: profile.url,\n\t\t\theadline: profile.headline,\n\t\t\tconnections: profile.connections,\n\t\t\tverified: profile.verified,\n\t\t};\n\t}\n\n\t/**\n\t * Find Twitter profile using Twitter API v2\n\t */\n\tprivate async findTwitterProfile(\n\t\tfullName?: string,\n\t): Promise<SocialEnrichment[\"profiles\"][\"twitter\"] | null> {\n\t\tif (!this.twitterBearerToken) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (!fullName) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Search for user by name\n\t\tconst url = `https://api.twitter.com/2/users/by?usernames=${encodeURIComponent(fullName.replace(\" \", \"\"))}&user.fields=public_metrics,description,verified`;\n\n\t\tconst response = await fetch(url, {\n\t\t\theaders: {\n\t\t\t\tAuthorization: `Bearer ${this.twitterBearerToken}`,\n\t\t\t},\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tif (response.status === 404) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tthrow new Error(`Twitter API error: ${response.statusText}`);\n\t\t}\n\n\t\tconst data = await response.json();\n\t\tconst user = data.data?.[0];\n\n\t\tif (!user) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\turl: `https://twitter.com/${user.username}`,\n\t\t\tusername: user.username,\n\t\t\tfollowers: user.public_metrics?.followers_count,\n\t\t\tverified: user.verified,\n\t\t\tbio: user.description,\n\t\t};\n\t}\n\n\t/**\n\t * Find Facebook profile using Facebook Graph API\n\t */\n\tprivate async findFacebookProfile(\n\t\t_email: string,\n\t): Promise<SocialEnrichment[\"profiles\"][\"facebook\"] | null> {\n\t\tif (!(this.facebookAppId && this.facebookAppSecret)) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Get app access token\n\t\tconst tokenUrl = `https://graph.facebook.com/oauth/access_token?client_id=${this.facebookAppId}&client_secret=${this.facebookAppSecret}&grant_type=client_credentials`;\n\n\t\tconst tokenResponse = await fetch(tokenUrl);\n\t\tif (!tokenResponse.ok) {\n\t\t\tthrow new Error(`Facebook token error: ${tokenResponse.statusText}`);\n\t\t}\n\n\t\tconst tokenData = await tokenResponse.json();\n\t\tconst _accessToken = tokenData.access_token;\n\n\t\t// Note: Facebook's public search capabilities are very limited\n\t\t// This is a placeholder - actual implementation would require user consent\n\t\t// or business verification for more detailed searches\n\n\t\t// For now, we can only check if a user has a public profile\n\t\t// Real implementation would need Facebook Login integration\n\t\treturn null;\n\t}\n\n\t/**\n\t * Extract username from social media URLs\n\t */\n\textractUsername(\n\t\turl: string,\n\t\tplatform: \"linkedin\" | \"twitter\" | \"facebook\",\n\t): string | null {\n\t\ttry {\n\t\t\tconst urlObj = new URL(url);\n\t\t\tconst pathname = urlObj.pathname;\n\n\t\t\tswitch (platform) {\n\t\t\t\tcase \"linkedin\": {\n\t\t\t\t\t// Extract from /in/username or /company/companyname\n\t\t\t\t\tconst linkedinMatch = pathname.match(/\\/(in|company)\\/([^/]+)/);\n\t\t\t\t\treturn linkedinMatch?.[2] || null;\n\t\t\t\t}\n\n\t\t\t\tcase \"twitter\": {\n\t\t\t\t\t// Extract from /username\n\t\t\t\t\tconst twitterMatch = pathname.match(/\\/([^/]+)/);\n\t\t\t\t\treturn twitterMatch?.[1] || null;\n\t\t\t\t}\n\n\t\t\t\tcase \"facebook\": {\n\t\t\t\t\t// Extract from /username or /profile.php?id=\n\t\t\t\t\tconst facebookMatch = pathname.match(/\\/([^/?]+)/);\n\t\t\t\t\treturn facebookMatch?.[1] || null;\n\t\t\t\t}\n\n\t\t\t\tdefault:\n\t\t\t\t\treturn null;\n\t\t\t}\n\t\t} catch {\n\t\t\treturn null;\n\t\t}\n\t}\n}\n\n// Singleton instance\nexport const socialEnrichmentService = new SocialEnrichmentService();\n"],"names":[],"mappings":"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"}