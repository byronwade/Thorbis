module.exports=[357212,e=>{"use strict";var t=e.i(755535),a=e.i(377233),o=e.i(490003),s=e.i(492991),n=e.i(241970),r=e.i(357699),i=e.i(212454),d=e.i(48717),l=e.i(798301),p=e.i(986366),c=e.i(983537),u=e.i(147475),g=e.i(561930),m=e.i(803747),h=e.i(368557),C=e.i(42037),v=e.i(193695);e.i(432036);var f=e.i(573881);e.i(715051);var A=e.i(511368),y=e.i(297676),R=e.i(443608);let z="Thorbis-FMS/1.0 (support@thorbis.app)",E=R.z.object({componentName:R.z.object({text:R.z.string(),languageCode:R.z.string().optional()}),componentType:R.z.string(),confirmationLevel:R.z.enum(["CONFIRMATION_LEVEL_UNSPECIFIED","CONFIRMED","UNCONFIRMED_BUT_PLAUSIBLE","UNCONFIRMED_AND_SUSPICIOUS"]),inferred:R.z.boolean().optional(),spellCorrected:R.z.boolean().optional(),replaced:R.z.boolean().optional(),unexpected:R.z.boolean().optional()}),b=R.z.object({regionCode:R.z.string(),languageCode:R.z.string().optional(),postalCode:R.z.string().optional(),administrativeArea:R.z.string().optional(),locality:R.z.string().optional(),sublocality:R.z.string().optional(),addressLines:R.z.array(R.z.string()),recipients:R.z.array(R.z.string()).optional(),organization:R.z.string().optional()}),S=R.z.object({location:R.z.object({latitude:R.z.number(),longitude:R.z.number()}),plusCode:R.z.object({globalCode:R.z.string().optional(),compoundCode:R.z.string().optional()}).optional(),bounds:R.z.object({low:R.z.object({latitude:R.z.number(),longitude:R.z.number()}),high:R.z.object({latitude:R.z.number(),longitude:R.z.number()})}).optional(),featureSize:R.z.number().optional(),placeId:R.z.string().optional(),placeTypes:R.z.array(R.z.string()).optional()}),I=R.z.object({standardizedAddress:R.z.object({firstAddressLine:R.z.string().optional(),secondAddressLine:R.z.string().optional(),city:R.z.string().optional(),state:R.z.string().optional(),zipCode:R.z.string().optional(),zipCodeExtension:R.z.string().optional()}).optional(),deliveryPointCode:R.z.string().optional(),deliveryPointCheckDigit:R.z.string().optional(),dpvConfirmation:R.z.string().optional(),dpvFootnote:R.z.string().optional(),dpvCmra:R.z.string().optional(),dpvVacant:R.z.string().optional(),dpvNoStat:R.z.string().optional(),carrierRoute:R.z.string().optional(),carrierRouteIndicator:R.z.string().optional(),ewsNoMatch:R.z.boolean().optional(),postOfficeCity:R.z.string().optional(),postOfficeState:R.z.string().optional(),fipsCountyCode:R.z.string().optional(),county:R.z.string().optional(),elotNumber:R.z.string().optional(),elotFlag:R.z.string().optional(),lacsLinkReturnCode:R.z.string().optional(),lacsLinkIndicator:R.z.string().optional(),poBoxOnlyPostalCode:R.z.boolean().optional(),suitelinkFootnote:R.z.string().optional(),pmbDesignator:R.z.string().optional(),pmbNumber:R.z.string().optional(),addressRecordType:R.z.string().optional(),defaultAddress:R.z.boolean().optional(),errorMessage:R.z.string().optional(),cassProcessed:R.z.boolean().optional()}),N=R.z.object({inputGranularity:R.z.enum(["GRANULARITY_UNSPECIFIED","SUB_PREMISE","PREMISE","PREMISE_PROXIMITY","BLOCK","ROUTE","OTHER"]),validationGranularity:R.z.enum(["GRANULARITY_UNSPECIFIED","SUB_PREMISE","PREMISE","PREMISE_PROXIMITY","BLOCK","ROUTE","OTHER"]),geocodeGranularity:R.z.enum(["GRANULARITY_UNSPECIFIED","SUB_PREMISE","PREMISE","PREMISE_PROXIMITY","BLOCK","ROUTE","OTHER"]),addressComplete:R.z.boolean(),hasUnconfirmedComponents:R.z.boolean(),hasInferredComponents:R.z.boolean(),hasReplacedComponents:R.z.boolean()}),w=R.z.object({inputAddress:R.z.string(),formattedAddress:R.z.string(),postalAddress:b,verdict:N,addressComponents:R.z.array(E),geocode:S.optional(),uspsData:I.optional(),isValid:R.z.boolean(),confidence:R.z.enum(["high","medium","low"]),corrections:R.z.array(R.z.string()),warnings:R.z.array(R.z.string())});class U{apiKey;cache=new Map;constructor(){this.apiKey=process.env.GOOGLE_API_KEY||"AIzaSyCVKN0pddG230vvjT0EMP9sSIR31j1q2t0"}isAvailable(){return!!this.apiKey}async validateAddress(e,t="US"){if(!this.apiKey)return console.warn("Google Address Validation Service: No API key configured"),null;let a=`address:${e}:${t}`,o=this.cache.get(a);if(o&&Date.now()-o.timestamp<864e5)return o.data;try{let o=await fetch(`https://addressvalidation.googleapis.com/v1:validateAddress?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":z},body:JSON.stringify({address:{regionCode:t,addressLines:[e]},enableUspsCass:"US"===t})});if(!o.ok)return console.error(`Google Address Validation API error: ${o.status} ${o.statusText}`),null;let s=await o.json(),n=this.parseValidationResponse(s,e);return this.cache.set(a,{data:n,timestamp:Date.now()}),this.cleanCache(),n}catch(e){return console.error("Google Address Validation Service error:",e),null}}async validateStructuredAddress(e){if(!this.apiKey)return console.warn("Google Address Validation Service: No API key configured"),null;let t=e.regionCode||"US",a=[...e.addressLines];if(e.city||e.state||e.postalCode){let t=[e.city,e.state,e.postalCode].filter(Boolean).join(", ");t&&!a.includes(t)&&a.push(t)}let o=a.join(", "),s=`structured:${o}:${t}`,n=this.cache.get(s);if(n&&Date.now()-n.timestamp<864e5)return n.data;try{let a={address:{regionCode:t,addressLines:e.addressLines},enableUspsCass:"US"===t};e.city&&(a.address.locality=e.city),e.state&&(a.address.administrativeArea=e.state),e.postalCode&&(a.address.postalCode=e.postalCode);let n=await fetch(`https://addressvalidation.googleapis.com/v1:validateAddress?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":z},body:JSON.stringify(a)});if(!n.ok)return console.error(`Google Address Validation API error: ${n.status} ${n.statusText}`),null;let r=await n.json(),i=this.parseValidationResponse(r,o);return this.cache.set(s,{data:i,timestamp:Date.now()}),this.cleanCache(),i}catch(e){return console.error("Google Address Validation Service error:",e),null}}async quickValidate(e,t="US"){let a=await this.validateAddress(e,t);return a?{isValid:a.isValid,confidence:a.confidence,formattedAddress:a.formattedAddress,lat:a.geocode?.location.latitude??null,lng:a.geocode?.location.longitude??null}:{isValid:!1,confidence:"low",formattedAddress:null,lat:null,lng:null}}async parseAddressComponents(e,t="US"){let a=await this.validateAddress(e,t);if(!a)return null;let o=e=>{let t=a.addressComponents.find(t=>t.componentType===e);return t?.componentName.text??null};return{streetNumber:o("street_number"),route:o("route"),city:o("locality")||o("sublocality"),state:o("administrative_area_level_1"),postalCode:o("postal_code"),country:o("country"),unit:o("subpremise")||o("apartment")||o("suite")}}async isDeliverable(e){let t=await this.validateAddress(e,"US");if(!t||!t.uspsData)return{deliverable:!1,reason:"Unable to validate address",dpvCode:null};let a=t.uspsData.dpvConfirmation,o="Y"===t.uspsData.dpvVacant,s=null;return"N"===a?s="Address not found in USPS database":"S"===a?s="Secondary address (apt/suite) could not be confirmed":"D"===a?s="Secondary address (apt/suite) is missing":o&&(s="Address marked as vacant"),{deliverable:("Y"===a||"D"===a)&&!o,reason:s,dpvCode:a||null}}async getUspsStandardizedAddress(e){let t=await this.validateAddress(e,"US");if(!t?.uspsData?.standardizedAddress)return null;let a=t.uspsData.standardizedAddress;return{line1:a.firstAddressLine||"",line2:a.secondAddressLine||null,city:a.city||t.postalAddress.locality||"",state:a.state||t.postalAddress.administrativeArea||"",zip:a.zipCode||t.postalAddress.postalCode||"",zip4:a.zipCodeExtension||null,carrierRoute:t.uspsData.carrierRoute||null,county:t.uspsData.county||null}}parseValidationResponse(e,t){let a=e.result,o=a?.verdict,s=a?.address,n=a?.geocode,r="low";o?.addressComplete&&!o?.hasUnconfirmedComponents?r="high":o?.addressComplete&&(r="medium");let i=[],d=[],l=s?.addressComponents?.map(e=>({componentName:{text:e.componentName?.text||"",languageCode:e.componentName?.languageCode},componentType:e.componentType||"",confirmationLevel:e.confirmationLevel||"CONFIRMATION_LEVEL_UNSPECIFIED",inferred:e.inferred,spellCorrected:e.spellCorrected,replaced:e.replaced,unexpected:e.unexpected}))||[];for(let e of l)e.spellCorrected&&i.push(`Spelling corrected: ${e.componentName.text}`),e.replaced&&i.push(`Replaced: ${e.componentName.text}`),e.inferred&&i.push(`Inferred: ${e.componentName.text}`),e.unexpected&&d.push(`Unexpected component: ${e.componentName.text}`),"UNCONFIRMED_AND_SUSPICIOUS"===e.confirmationLevel&&d.push(`Suspicious component: ${e.componentType} - ${e.componentName.text}`);o?.hasUnconfirmedComponents&&d.push("Some address components could not be confirmed");let p={regionCode:s?.postalAddress?.regionCode||"US",languageCode:s?.postalAddress?.languageCode,postalCode:s?.postalAddress?.postalCode,administrativeArea:s?.postalAddress?.administrativeArea,locality:s?.postalAddress?.locality,sublocality:s?.postalAddress?.sublocality,addressLines:s?.postalAddress?.addressLines||[],recipients:s?.postalAddress?.recipients,organization:s?.postalAddress?.organization},c={inputAddress:t,formattedAddress:s?.formattedAddress||t,postalAddress:p,verdict:{inputGranularity:o?.inputGranularity||"GRANULARITY_UNSPECIFIED",validationGranularity:o?.validationGranularity||"GRANULARITY_UNSPECIFIED",geocodeGranularity:o?.geocodeGranularity||"GRANULARITY_UNSPECIFIED",addressComplete:o?.addressComplete??!1,hasUnconfirmedComponents:o?.hasUnconfirmedComponents??!1,hasInferredComponents:o?.hasInferredComponents??!1,hasReplacedComponents:o?.hasReplacedComponents??!1},addressComponents:l,geocode:n?.location?{location:{latitude:n.location.latitude??0,longitude:n.location.longitude??0},plusCode:n.plusCode,bounds:n.bounds?{low:{latitude:n.bounds.low?.latitude??0,longitude:n.bounds.low?.longitude??0},high:{latitude:n.bounds.high?.latitude??0,longitude:n.bounds.high?.longitude??0}}:void 0,featureSize:n.featureSize,placeId:n.placeId,placeTypes:n.placeTypes}:void 0,uspsData:a?.uspsData,isValid:o?.addressComplete===!0&&"low"!==r,confidence:r,corrections:i,warnings:d};return w.parse(c)}cleanCache(){let e=Date.now();for(let[t,a]of this.cache.entries())e-a.timestamp>1728e5&&this.cache.delete(t);if(this.cache.size>1e3){let e=Array.from(this.cache.entries());for(let[t,a]of(e.sort((e,t)=>t[1].timestamp-e[1].timestamp),this.cache.clear(),e.slice(0,500)))this.cache.set(t,a)}}clearCache(){this.cache.clear()}}let P=new U;async function T(e){let t=await (0,A.createClient)(),{data:{user:a}}=await t.auth.getUser();if(!a)return y.NextResponse.json({error:"Unauthorized"},{status:401});try{let t,{address:a,structured:o,regionCode:s="US"}=await e.json();if(!a&&!o)return y.NextResponse.json({error:"Either 'address' string or 'structured' object is required"},{status:400});if(!P.isAvailable())return y.NextResponse.json({error:"Address validation service not configured"},{status:503});if(!(t=o?await P.validateStructuredAddress({addressLines:o.addressLines||[o.address1],city:o.city,state:o.state,postalCode:o.postalCode||o.zip,regionCode:s}):await P.validateAddress(a,s)))return y.NextResponse.json({error:"Failed to validate address"},{status:500});return y.NextResponse.json({isValid:t.isValid,confidence:t.confidence,inputAddress:t.inputAddress,formattedAddress:t.formattedAddress,components:{addressLines:t.postalAddress.addressLines,city:t.postalAddress.locality,state:t.postalAddress.administrativeArea,postalCode:t.postalAddress.postalCode,country:t.postalAddress.regionCode},geocode:t.geocode?{lat:t.geocode.location.latitude,lng:t.geocode.location.longitude,placeId:t.geocode.placeId,plusCode:t.geocode.plusCode?.globalCode}:null,usps:t.uspsData?{standardized:t.uspsData.standardizedAddress,dpvConfirmation:t.uspsData.dpvConfirmation,deliveryPointCode:t.uspsData.deliveryPointCode,carrierRoute:t.uspsData.carrierRoute,county:t.uspsData.county,vacant:"Y"===t.uspsData.dpvVacant}:null,corrections:t.corrections,warnings:t.warnings,verdict:t.verdict})}catch(e){return console.error("Address validation error:",e),y.NextResponse.json({error:"Internal server error"},{status:500})}}async function x(e){let t=e.nextUrl.searchParams,a=t.get("address"),o=t.get("regionCode")||"US";if(!a)return y.NextResponse.json({error:"Address parameter is required"},{status:400});if(!P.isAvailable())return y.NextResponse.json({error:"Address validation service not configured"},{status:503});let s=await P.quickValidate(a,o);return y.NextResponse.json(s)}e.s(["GET",()=>x,"POST",()=>T],974756);var D=e.i(974756);let O=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/address/validate/route",pathname:"/api/address/validate",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/address/validate/route.ts",nextConfigOutput:"",userland:D}),{workAsyncStorage:_,workUnitAsyncStorage:L,serverHooks:j}=O;function M(){return(0,o.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:L})}async function G(e,t,o){O.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let A="/api/address/validate/route";A=A.replace(/\/index$/,"")||"/";let y=await O.prepare(e,t,{srcPage:A,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:R,params:z,nextConfig:E,parsedUrl:b,isDraftMode:S,prerenderManifest:I,routerServerContext:N,isOnDemandRevalidate:w,revalidateOnlyGenerated:U,resolvedPathname:P,clientReferenceManifest:T,serverActionsManifest:x}=y,D=(0,d.normalizeAppPath)(A),_=!!(I.dynamicRoutes[D]||I.routes[P]),L=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,b,!1):t.end("This page could not be found"),null);if(_&&!S){let e=!!I.routes[P],t=I.dynamicRoutes[D];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await L();throw new v.NoFallbackError}}let j=null;!_||O.isDev||S||(j="/index"===(j=P)?"/":j);let M=!0===O.isDev||!_,G=_&&!M;x&&T&&(0,r.setReferenceManifestsSingleton)({page:A,clientReferenceManifest:T,serverActionsManifest:x,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:x})});let F=e.method||"GET",V=(0,n.getTracer)(),k=V.getActiveScopeSpan(),$={params:z,prerenderManifest:I,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,o)=>O.onRequestError(e,t,o,N)},sharedContext:{buildId:R}},H=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),q=p.NextRequestAdapter.fromNodeNextRequest(H,(0,p.signalFromNodeResponse)(t));try{let r=async e=>O.handle(q,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=V.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=a.get("next.route");if(o){let t=`${F} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${A}`)}),i=!!(0,s.getRequestMeta)(e,"minimalMode"),d=async s=>{var n,d;let l=async({previousCacheEntry:a})=>{try{if(!i&&w&&U&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await r(s);e.fetchMetrics=$.renderOpts.fetchMetrics;let d=$.renderOpts.pendingWaitUntil;d&&o.waitUntil&&(o.waitUntil(d),d=void 0);let l=$.renderOpts.collectedTags;if(!_)return await (0,g.sendResponse)(H,K,n,$.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(n.headers);l&&(t[C.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=C.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,o=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=C.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:o}}}}catch(t){throw(null==a?void 0:a.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:A,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:G,isOnDemandRevalidate:w})},N),t}},p=await O.handleResponse({req:e,nextConfig:E,cacheKey:j,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:I,isRoutePPREnabled:!1,isOnDemandRevalidate:w,revalidateOnlyGenerated:U,responseGenerator:l,waitUntil:o.waitUntil,isMinimalMode:i});if(!_)return null;if((null==p||null==(n=p.value)?void 0:n.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(d=p.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",w?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,m.fromNodeOutgoingHttpHeaders)(p.value.headers);return i&&_||c.delete(C.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,h.getCacheControlHeader)(p.cacheControl)),await (0,g.sendResponse)(H,K,new Response(p.value.body,{headers:c,status:p.value.status||200})),null};k?await d(k):await V.withPropagatedContext(e.headers,()=>V.trace(c.BaseServerSpan.handleRequest,{spanName:`${F} ${A}`,kind:n.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},d))}catch(t){if(t instanceof v.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:G,isOnDemandRevalidate:w})}),_)throw t;return await (0,g.sendResponse)(H,K,new Response(null,{status:500})),null}}e.s(["handler",()=>G,"patchFetch",()=>M,"routeModule",()=>O,"serverHooks",()=>j,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>L],357212)}];

//# sourceMappingURL=3c0ae_next_dist_esm_build_templates_app-route_185064cc.js.map