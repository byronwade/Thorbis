module.exports=[629530,e=>{"use strict";var t=e.i(755535),a=e.i(377233),n=e.i(490003),r=e.i(492991),i=e.i(241970),o=e.i(357699),s=e.i(212454),u=e.i(48717),c=e.i(798301),l=e.i(986366),d=e.i(983537),p=e.i(147475),h=e.i(561930),g=e.i(803747),m=e.i(368557),y=e.i(42037),f=e.i(193695);e.i(432036);var C=e.i(573881),v=e.i(297676),R=e.i(443608);e.i(715051);var E=e.i(511368);let w=R.z.object({languageCodes:R.z.array(R.z.string()),name:R.z.string(),ssmlGender:R.z.enum(["SSML_VOICE_GENDER_UNSPECIFIED","MALE","FEMALE","NEUTRAL"]),naturalSampleRateHertz:R.z.number()}),S=R.z.object({voices:R.z.array(w).optional().default([])}),x=R.z.object({audioContent:R.z.string()}),T={languageCode:"en-US",name:"en-US-Neural2-F"},A={languageCode:"en-US",name:"en-US-Neural2-H"},P={languageCode:"en-US",name:"en-US-Wavenet-C"},N={languageCode:"es-US",name:"es-US-Neural2-A"};class U{static instance;apiKey;baseUrl="https://texttospeech.googleapis.com/v1";voicesCache=null;VOICES_CACHE_TTL=864e5;audioCache=new Map;AUDIO_CACHE_TTL=18e5;constructor(){this.apiKey=process.env.GOOGLE_API_KEY||"AIzaSyCVKN0pddG230vvjT0EMP9sSIR31j1q2t0",this.apiKey||console.warn("GoogleTextToSpeechService: No API key found. Set GOOGLE_API_KEY environment variable.")}static getInstance(){return U.instance||(U.instance=new U),U.instance}isConfigured(){return!!this.apiKey}hashText(e,t){let a=e+JSON.stringify(t),n=0;for(let e=0;e<a.length;e++)n=(n<<5)-n+a.charCodeAt(e),n&=n;return n.toString(36)}cleanCache(){let e=Date.now();for(let[t,a]of this.audioCache.entries())e-a.timestamp>this.AUDIO_CACHE_TTL&&this.audioCache.delete(t)}async listVoices(e){if(!this.apiKey)throw Error("Text-to-Speech API key not configured");if(this.voicesCache&&Date.now()-this.voicesCache.timestamp<this.VOICES_CACHE_TTL){let t=this.voicesCache.voices;return e?t.filter(t=>t.languageCodes.includes(e)):t}let t=new URL(`${this.baseUrl}/voices`);t.searchParams.set("key",this.apiKey),e&&t.searchParams.set("languageCode",e);let a=await fetch(t.toString());if(!a.ok){let e=await a.json();throw Error(`Text-to-Speech API error: ${e.error?.message||a.statusText}`)}let n=await a.json(),r=S.parse(n);return this.voicesCache={voices:r.voices,timestamp:Date.now()},r.voices}async synthesize(e,t={}){if(!this.apiKey)throw Error("Text-to-Speech API key not configured");let a=this.hashText(e,t);this.cleanCache();let n=this.audioCache.get(a);if(n)return n.result;let r={languageCode:"en-US",...t.voice},i={audioEncoding:"MP3",speakingRate:1,pitch:0,...t.audio},o=await fetch(`${this.baseUrl}/text:synthesize?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:e},voice:r,audioConfig:i})});if(!o.ok){let e=await o.json();throw Error(`Text-to-Speech API error: ${e.error?.message||o.statusText}`)}let s=await o.json(),u=x.parse(s),c=this.getMimeType(i.audioEncoding),l={audioContent:u.audioContent,audioUrl:`data:${c};base64,${u.audioContent}`,mimeType:c};return this.audioCache.set(a,{result:l,timestamp:Date.now()}),l}async synthesizeSSML(e,t={}){if(!this.apiKey)throw Error("Text-to-Speech API key not configured");let a={languageCode:"en-US",...t.voice},n={audioEncoding:"MP3",speakingRate:1,pitch:0,...t.audio},r=await fetch(`${this.baseUrl}/text:synthesize?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{ssml:e},voice:a,audioConfig:n})});if(!r.ok){let e=await r.json();throw Error(`Text-to-Speech API error: ${e.error?.message||r.statusText}`)}let i=await r.json(),o=x.parse(i),s=this.getMimeType(n.audioEncoding);return{audioContent:o.audioContent,audioUrl:`data:${s};base64,${o.audioContent}`,mimeType:s}}async speakNotification(e,t="normal"){return this.synthesize(e,{voice:T,audio:{audioEncoding:"MP3",speakingRate:{low:.9,normal:1,high:1.15}[t]}})}async speakInstructions(e,t="en-US"){let a=t.startsWith("es")?N:P;return this.synthesize(e,{voice:{...a,languageCode:t},audio:{audioEncoding:"MP3",speakingRate:.85,pitch:-1}})}async generateIVRPrompt(e){return this.synthesize(e,{voice:T,audio:{audioEncoding:"MULAW",sampleRateHertz:8e3,speakingRate:.95}})}async createAppointmentReminder(e,t,a,n){let r=`Hello ${e}. This is a reminder about your ${n} appointment scheduled for ${t} at ${a}. If you need to reschedule, please call us back. Thank you for choosing our services.`;return this.synthesize(r,{voice:A,audio:{audioEncoding:"MP3",speakingRate:.95}})}async createProcedureAudio(e){let t=e.map((e,t)=>`<p>Step ${t+1}: ${e}</p><break time="1s"/>`).join(""),a=`<speak>
      <prosody rate="slow">
        ${t}
        <p>Procedure complete.</p>
      </prosody>
    </speak>`;return this.synthesizeSSML(a,{voice:P,audio:{audioEncoding:"MP3"}})}getMimeType(e){return({LINEAR16:"audio/wav",MP3:"audio/mpeg",OGG_OPUS:"audio/ogg",MULAW:"audio/basic",ALAW:"audio/basic"})[e]||"audio/mpeg"}clearCache(){this.audioCache.clear(),this.voicesCache=null}}let b=U.getInstance(),k=R.z.object({text:R.z.string().min(1,"Text is required").max(5e3,"Text must be under 5000 characters"),type:R.z.enum(["notification","instructions","ivr","appointment_reminder","procedure","general"]).default("general"),urgency:R.z.enum(["low","normal","high"]).optional(),languageCode:R.z.enum(["en-US","en-GB","en-AU","es-ES","es-MX","es-US","fr-FR","fr-CA","de-DE","it-IT","pt-BR","pt-PT","zh-CN","ja-JP","ko-KR","hi-IN","ar-XA"]).default("en-US").transform(e=>e),voiceGender:R.z.enum(["MALE","FEMALE","NEUTRAL"]).optional().transform(e=>e),voiceName:R.z.string().optional(),speakingRate:R.z.number().min(.25).max(4).optional(),pitch:R.z.number().min(-20).max(20).optional(),appointment:R.z.object({customerName:R.z.string(),date:R.z.string(),time:R.z.string(),serviceType:R.z.string()}).optional(),steps:R.z.array(R.z.string()).optional()});async function z(e){try{let t,a=await (0,E.createClient)(),{data:{user:n}}=await a.auth.getUser();if(!n)return v.NextResponse.json({error:"Unauthorized"},{status:401});if(!b.isConfigured())return v.NextResponse.json({error:"Text-to-Speech service is not configured. Set GOOGLE_API_KEY environment variable."},{status:503});let r=await e.json(),i=k.parse(r);switch(i.type){case"notification":t=await b.speakNotification(i.text,i.urgency??"normal");break;case"instructions":t=await b.speakInstructions(i.text,i.languageCode);break;case"ivr":t=await b.generateIVRPrompt(i.text);break;case"appointment_reminder":if(!i.appointment)return v.NextResponse.json({error:"Appointment details required for appointment_reminder type"},{status:400});t=await b.createAppointmentReminder(i.appointment.customerName,i.appointment.date,i.appointment.time,i.appointment.serviceType);break;case"procedure":if(!i.steps||0===i.steps.length)return v.NextResponse.json({error:"Steps array required for procedure type"},{status:400});t=await b.createProcedureAudio(i.steps);break;default:t=await b.synthesize(i.text,{voice:{languageCode:i.languageCode,name:i.voiceName,ssmlGender:i.voiceGender},audio:{audioEncoding:"MP3",speakingRate:i.speakingRate,pitch:i.pitch}})}return v.NextResponse.json({success:!0,data:{audioContent:t.audioContent,audioUrl:t.audioUrl,mimeType:t.mimeType,duration:t.duration}})}catch(e){if(console.error("Speech synthesis error:",e),e instanceof R.z.ZodError)return v.NextResponse.json({error:"Invalid request data",details:e.errors},{status:400});return v.NextResponse.json({error:"Failed to synthesize speech",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function I(e){try{let t=await (0,E.createClient)(),{data:{user:a}}=await t.auth.getUser();if(!a)return v.NextResponse.json({error:"Unauthorized"},{status:401});if(!b.isConfigured())return v.NextResponse.json({error:"Text-to-Speech service is not configured. Set GOOGLE_API_KEY environment variable."},{status:503});let{searchParams:n}=new URL(e.url),r=n.get("languageCode")||void 0,i=await b.listVoices(r);return v.NextResponse.json({success:!0,data:{voices:i,count:i.length}})}catch(e){return console.error("List voices error:",e),v.NextResponse.json({error:"Failed to list voices",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}e.s(["GET",()=>I,"POST",()=>z],557987);var _=e.i(557987);let O=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/speech/synthesize/route",pathname:"/api/speech/synthesize",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/speech/synthesize/route.ts",nextConfigOutput:"",userland:_}),{workAsyncStorage:M,workUnitAsyncStorage:j,serverHooks:L}=O;function $(){return(0,n.patchFetch)({workAsyncStorage:M,workUnitAsyncStorage:j})}async function H(e,t,n){O.isDev&&(0,r.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/speech/synthesize/route";v=v.replace(/\/index$/,"")||"/";let R=await O.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:E,params:w,nextConfig:S,parsedUrl:x,isDraftMode:T,prerenderManifest:A,routerServerContext:P,isOnDemandRevalidate:N,revalidateOnlyGenerated:U,resolvedPathname:b,clientReferenceManifest:k,serverActionsManifest:z}=R,I=(0,u.normalizeAppPath)(v),_=!!(A.dynamicRoutes[I]||A.routes[b]),M=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,x,!1):t.end("This page could not be found"),null);if(_&&!T){let e=!!A.routes[b],t=A.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await M();throw new f.NoFallbackError}}let j=null;!_||O.isDev||T||(j="/index"===(j=b)?"/":j);let L=!0===O.isDev||!_,$=_&&!L;z&&k&&(0,o.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:k,serverActionsManifest:z,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:z})});let H=e.method||"GET",K=(0,i.getTracer)(),D=K.getActiveScopeSpan(),G={params:w,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:L,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,n)=>O.onRequestError(e,t,n,P)},sharedContext:{buildId:E}},q=new c.NodeNextRequest(e),F=new c.NodeNextResponse(t),V=l.NextRequestAdapter.fromNodeNextRequest(q,(0,l.signalFromNodeResponse)(t));try{let o=async e=>O.handle(V,G).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=K.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let t=`${H} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${v}`)}),s=!!(0,r.getRequestMeta)(e,"minimalMode"),u=async r=>{var i,u;let c=async({previousCacheEntry:a})=>{try{if(!s&&N&&U&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await o(r);e.fetchMetrics=G.renderOpts.fetchMetrics;let u=G.renderOpts.pendingWaitUntil;u&&n.waitUntil&&(n.waitUntil(u),u=void 0);let c=G.renderOpts.collectedTags;if(!_)return await (0,h.sendResponse)(q,F,i,G.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(i.headers);c&&(t[y.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==G.renderOpts.collectedRevalidate&&!(G.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&G.renderOpts.collectedRevalidate,n=void 0===G.renderOpts.collectedExpire||G.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:G.renderOpts.collectedExpire;return{value:{kind:C.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:n}}}}catch(t){throw(null==a?void 0:a.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:N})},P),t}},l=await O.handleResponse({req:e,nextConfig:S,cacheKey:j,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:U,responseGenerator:c,waitUntil:n.waitUntil,isMinimalMode:s});if(!_)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==C.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(u=l.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",N?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),T&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,g.fromNodeOutgoingHttpHeaders)(l.value.headers);return s&&_||d.delete(y.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,m.getCacheControlHeader)(l.cacheControl)),await (0,h.sendResponse)(q,F,new Response(l.value.body,{headers:d,status:l.value.status||200})),null};D?await u(D):await K.withPropagatedContext(e.headers,()=>K.trace(d.BaseServerSpan.handleRequest,{spanName:`${H} ${v}`,kind:i.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},u))}catch(t){if(t instanceof f.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:N})}),_)throw t;return await (0,h.sendResponse)(q,F,new Response(null,{status:500})),null}}e.s(["handler",()=>H,"patchFetch",()=>$,"routeModule",()=>O,"serverHooks",()=>L,"workAsyncStorage",()=>M,"workUnitAsyncStorage",()=>j],629530)}];

//# sourceMappingURL=3c0ae_next_dist_esm_build_templates_app-route_11fb34c4.js.map