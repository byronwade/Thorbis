module.exports=[868687,e=>{"use strict";var t=e.i(755535),n=e.i(377233),a=e.i(490003),r=e.i(492991),i=e.i(241970),o=e.i(357699),s=e.i(212454),l=e.i(48717),c=e.i(798301),u=e.i(986366),d=e.i(983537),p=e.i(147475),h=e.i(561930),m=e.i(803747),v=e.i(368557),g=e.i(42037),w=e.i(193695);e.i(432036);var R=e.i(573881),f=e.i(297676);e.i(805893),e.i(517118),e.i(511368);var _=e.i(273568);async function y(e){let t,n,a,r=(0,_.createServiceSupabaseClient)(),{data:i,error:o}=await r.from("customer_tracking_links").select(`
			*,
			companies:company_id (
				name,
				logo_url,
				phone
			)
		`).eq("token",e).single();if(o||!i||new Date(i.expires_at)<new Date)return null;if(await r.from("customer_tracking_links").update({view_count:i.view_count+1,last_viewed_at:new Date().toISOString()}).eq("id",i.id),i.show_technician_location&&["active","arrived"].includes(i.status)){let{data:e}=await r.from("technician_locations").select("lat, lng, eta_minutes, distance_remaining_meters").eq("technician_id",i.technician_id).single();e&&(t={lat:e.lat,lng:e.lng},n=e.eta_minutes,a=e.distance_remaining_meters?e.distance_remaining_meters/1609.34:void 0)}let s=new Date(i.scheduled_start_time),l=new Date(i.scheduled_end_time),c=e=>e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),u=`${c(s)} - ${c(l)}`,d=s.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),p=function(e,t,n){let a=t.split(" ")[0];switch(e){case"pending":return`Your appointment is scheduled. ${a} will be on the way soon!`;case"active":if(n&&n<=5)return`${a} is almost there! Arriving in about ${n} minutes.`;if(n&&n<=15)return`${a} is nearby and will arrive in about ${n} minutes.`;if(n)return`${a} is on the way! Estimated arrival in ${n} minutes.`;return`${a} is on the way to your location!`;case"arrived":return`${a} has arrived at your location.`;case"completed":return"Your service has been completed. Thank you!";case"cancelled":return"This appointment has been cancelled.";case"expired":return"This tracking link has expired.";default:return"Thank you for choosing our service!"}}(i.status,i.technician_name,n),h=i.companies;return{token:i.token,status:i.status,companyName:h?.name||"Service Provider",companyLogo:h?.logo_url,companyPhone:h?.phone,technicianName:i.technician_name,technicianPhoto:i.show_technician_photo?i.technician_photo:void 0,technicianStatus:i.technician_status,appointmentDate:d,scheduledWindow:u,estimatedArrival:n?c(new Date(Date.now()+60*n*1e3)):void 0,etaMinutes:n,distanceRemainingMiles:a,technicianLocation:t,statusMessage:p,lastUpdate:new Date().toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}}async function E(e,{params:t}){let{token:n}=await t;if(!n||n.length<8)return f.NextResponse.json({error:"Invalid tracking token"},{status:400});let a=await y(n);return a?f.NextResponse.json(a):f.NextResponse.json({error:"Tracking link not found or expired"},{status:404})}e.s(["GET",()=>E,"dynamic",0,"force-dynamic"],128590);var x=e.i(128590);let k=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/track/[token]/route",pathname:"/api/track/[token]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/track/[token]/route.ts",nextConfigOutput:"",userland:x}),{workAsyncStorage:C,workUnitAsyncStorage:S,serverHooks:T}=k;function A(){return(0,a.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:S})}async function b(e,t,a){k.isDev&&(0,r.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let f="/api/track/[token]/route";f=f.replace(/\/index$/,"")||"/";let _=await k.prepare(e,t,{srcPage:f,multiZoneDraftMode:!1});if(!_)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:y,params:E,nextConfig:x,parsedUrl:C,isDraftMode:S,prerenderManifest:T,routerServerContext:A,isOnDemandRevalidate:b,revalidateOnlyGenerated:N,resolvedPathname:P,clientReferenceManifest:D,serverActionsManifest:O}=_,U=(0,l.normalizeAppPath)(f),$=!!(T.dynamicRoutes[U]||T.routes[P]),q=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,C,!1):t.end("This page could not be found"),null);if($&&!S){let e=!!T.routes[P],t=T.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await q();throw new w.NoFallbackError}}let H=null;!$||k.isDev||S||(H="/index"===(H=P)?"/":H);let I=!0===k.isDev||!$,M=$&&!I;O&&D&&(0,o.setReferenceManifestsSingleton)({page:f,clientReferenceManifest:D,serverActionsManifest:O,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:O})});let j=e.method||"GET",L=(0,i.getTracer)(),F=L.getActiveScopeSpan(),K={params:E,prerenderManifest:T,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:I,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,a)=>k.onRequestError(e,t,a,A)},sharedContext:{buildId:y}},B=new c.NodeNextRequest(e),G=new c.NodeNextResponse(t),V=u.NextRequestAdapter.fromNodeNextRequest(B,(0,u.signalFromNodeResponse)(t));try{let o=async e=>k.handle(V,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=L.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=n.get("next.route");if(a){let t=`${j} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${f}`)}),s=!!(0,r.getRequestMeta)(e,"minimalMode"),l=async r=>{var i,l;let c=async({previousCacheEntry:n})=>{try{if(!s&&b&&N&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await o(r);e.fetchMetrics=K.renderOpts.fetchMetrics;let l=K.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let c=K.renderOpts.collectedTags;if(!$)return await (0,h.sendResponse)(B,G,i,K.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(i.headers);c&&(t[g.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,a=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:a}}}}catch(t){throw(null==n?void 0:n.isStale)&&await k.onRequestError(e,t,{routerKind:"App Router",routePath:f,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:b})},A),t}},u=await k.handleResponse({req:e,nextConfig:x,cacheKey:H,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:T,isRoutePPREnabled:!1,isOnDemandRevalidate:b,revalidateOnlyGenerated:N,responseGenerator:c,waitUntil:a.waitUntil,isMinimalMode:s});if(!$)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",b?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return s&&$||d.delete(g.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,v.getCacheControlHeader)(u.cacheControl)),await (0,h.sendResponse)(B,G,new Response(u.value.body,{headers:d,status:u.value.status||200})),null};F?await l(F):await L.withPropagatedContext(e.headers,()=>L.trace(d.BaseServerSpan.handleRequest,{spanName:`${j} ${f}`,kind:i.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},l))}catch(t){if(t instanceof w.NoFallbackError||await k.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:b})}),$)throw t;return await (0,h.sendResponse)(B,G,new Response(null,{status:500})),null}}e.s(["handler",()=>b,"patchFetch",()=>A,"routeModule",()=>k,"serverHooks",()=>T,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>S],868687)}];

//# sourceMappingURL=3c0ae_next_dist_esm_build_templates_app-route_39369958.js.map