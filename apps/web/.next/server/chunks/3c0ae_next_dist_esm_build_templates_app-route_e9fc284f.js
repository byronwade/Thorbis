module.exports=[333133,e=>{"use strict";var t=e.i(755535),a=e.i(377233),r=e.i(490003),n=e.i(492991),o=e.i(241970),s=e.i(357699),i=e.i(212454),l=e.i(48717),u=e.i(798301),c=e.i(986366),d=e.i(983537),p=e.i(147475),h=e.i(561930),g=e.i(803747),v=e.i(368557),m=e.i(42037),f=e.i(193695);e.i(432036);var E=e.i(573881),R=e.i(297676),w=e.i(443608);e.i(715051);var y=e.i(511368);let x="Stratos-FMS/1.0 (support@stratos.app)";w.z.object({elevation:w.z.number(),location:w.z.object({lat:w.z.number(),lng:w.z.number()}),resolution:w.z.number()});class M{apiKey;cache=new Map;cacheTTL=31536e6;constructor(){this.apiKey=process.env.GOOGLE_API_KEY||process.env.GOOGLE_MAPS_API_KEY}generateCacheKey(e,t){return`elev:${e.toFixed(5)},${t.toFixed(5)}`}metersToFeet(e){return 3.28084*e}async getElevation(e){if(!this.apiKey)return console.warn("Google Elevation API key not configured"),null;let t=this.generateCacheKey(e.latitude,e.longitude),a=this.cache.get(t);if(a&&Date.now()-a.timestamp<this.cacheTTL)return a.data;try{let a=new URLSearchParams({locations:`${e.latitude},${e.longitude}`,key:this.apiKey}),r=`https://maps.googleapis.com/maps/api/elevation/json?${a.toString()}`,n=await fetch(r,{headers:{"User-Agent":x}});if(!n.ok)return console.error("Elevation API error:",n.status),null;let o=await n.json();if("OK"!==o.status)return console.error("Elevation API status:",o.status,o.error_message),null;if(!o.results||0===o.results.length)return null;let s=o.results[0],i={latitude:s.location.lat,longitude:s.location.lng,elevationMeters:s.elevation,elevationFeet:this.metersToFeet(s.elevation),resolutionMeters:s.resolution};return this.cache.set(t,{data:i,timestamp:Date.now()}),i}catch(e){return console.error("Elevation API error:",e),null}}async getElevations(e){if(!this.apiKey)return console.warn("Google Elevation API key not configured"),null;if(0===e.length)return[];if(e.length>512){let t=[];for(let a=0;a<e.length;a+=512){let r=e.slice(a,a+512),n=await this.getElevations(r);n&&t.push(...n)}return t}let t=[],a=[];for(let r=0;r<e.length;r++){let n=this.generateCacheKey(e[r].latitude,e[r].longitude),o=this.cache.get(n);o&&Date.now()-o.timestamp<this.cacheTTL?t[r]=o.data:(t[r]=null,a.push({index:r,location:e[r]}))}if(0===a.length)return t;try{let e=a.map(({location:e})=>`${e.latitude},${e.longitude}`).join("|"),r=new URLSearchParams({locations:e,key:this.apiKey}),n=`https://maps.googleapis.com/maps/api/elevation/json?${r.toString()}`,o=await fetch(n,{headers:{"User-Agent":x}});if(!o.ok)return console.error("Elevation API error:",o.status),null;let s=await o.json();if("OK"!==s.status)return console.error("Elevation API status:",s.status,s.error_message),null;for(let e=0;e<s.results.length;e++){let r=s.results[e],n=a[e].index,o={latitude:r.location.lat,longitude:r.location.lng,elevationMeters:r.elevation,elevationFeet:this.metersToFeet(r.elevation),resolutionMeters:r.resolution};t[n]=o;let i=this.generateCacheKey(o.latitude,o.longitude);this.cache.set(i,{data:o,timestamp:Date.now()})}return t}catch(e){return console.error("Elevation API error:",e),null}}async getElevationProfile(e,t){if(!this.apiKey||e.length<2)return null;try{let a=e.map(e=>`${e.latitude},${e.longitude}`).join("|"),r=new URLSearchParams({path:a,key:this.apiKey});t&&r.set("samples",String(Math.min(t,512)));let n=`https://maps.googleapis.com/maps/api/elevation/json?${r.toString()}`,o=await fetch(n,{headers:{"User-Agent":x}});if(!o.ok)return console.error("Elevation API error:",o.status),null;let s=await o.json();if("OK"!==s.status)return console.error("Elevation API status:",s.status,s.error_message),null;let i=s.results.map(e=>({latitude:e.location.lat,longitude:e.location.lng,elevationMeters:e.elevation,elevationFeet:this.metersToFeet(e.elevation),resolutionMeters:e.resolution})),l=i[0],u=i[0],c=0,d=0,p=0;for(let e=0;e<i.length;e++){let t=i[e];if(p+=t.elevationMeters,t.elevationMeters<l.elevationMeters&&(l=t),t.elevationMeters>u.elevationMeters&&(u=t),e>0){let a=t.elevationMeters-i[e-1].elevationMeters;a>0?c+=a:d+=Math.abs(a)}}return{points:i,minElevation:l,maxElevation:u,totalAscentMeters:c,totalDescentMeters:d,elevationGainMeters:u.elevationMeters-l.elevationMeters,averageElevationMeters:p/i.length}}catch(e){return console.error("Elevation profile error:",e),null}}async analyzePropertyElevation(e,t=50){let a,r=await this.getElevation(e);if(!r)return null;let n=[],o=t/111e3,s=t/(111e3*Math.cos(e.latitude*Math.PI/180)),i=[{lat:o,lng:0,name:"north"},{lat:-o,lng:0,name:"south"},{lat:0,lng:s,name:"east"},{lat:0,lng:-s,name:"west"},{lat:o,lng:s,name:"northeast"},{lat:o,lng:-s,name:"northwest"},{lat:-o,lng:s,name:"southeast"},{lat:-o,lng:-s,name:"southwest"}];for(let t of i)n.push({latitude:e.latitude+t.lat,longitude:e.longitude+t.lng});let l=await this.getElevations(n);if(!l)return null;let u=l.reduce((e,t)=>e+t.elevationMeters,0)/l.length,c=r.elevationMeters-u,d=r.elevationMeters;for(let e=0;e<l.length;e++)l[e].elevationMeters<d&&(d=l[e].elevationMeters,a=i[e].name);let p=Math.max(Math.abs(l[0].elevationMeters-l[1].elevationMeters),Math.abs(l[2].elevationMeters-l[3].elevationMeters));return{propertyElevation:r,surroundingElevations:l,averageSurroundingElevation:u,relativeElevation:c,isHighPoint:c>1,isLowPoint:c<-1,drainageDirection:.5>Math.abs(c)?"flat":a,slopePercent:p/(2*t)*100}}isConfigured(){return!!this.apiKey}clearCache(){this.cache.clear()}}let P=new M,C=w.z.object({latitude:w.z.number(),longitude:w.z.number()}),A=w.z.object({action:w.z.literal("single"),location:C}),b=w.z.object({action:w.z.literal("multiple"),locations:w.z.array(C).min(1).max(512)}),N=w.z.object({action:w.z.literal("profile"),path:w.z.array(C).min(2).max(512),samples:w.z.number().min(2).max(512).optional()}),j=w.z.object({action:w.z.literal("property"),location:C,radiusMeters:w.z.number().min(10).max(500).optional()}),T=w.z.discriminatedUnion("action",[A,b,N,j]);async function S(e){try{let t=await (0,y.createClient)(),{data:{user:a}}=await t.auth.getUser();if(!a)return R.NextResponse.json({error:"Unauthorized"},{status:401});if(!P.isConfigured())return R.NextResponse.json({error:"Elevation service is not configured. Set GOOGLE_API_KEY environment variable."},{status:503});let{searchParams:r}=new URL(e.url),n=r.get("lat"),o=r.get("lng");if(!n||!o)return R.NextResponse.json({error:"lat and lng parameters required"},{status:400});let s=await P.getElevation({latitude:Number.parseFloat(n),longitude:Number.parseFloat(o)});if(!s)return R.NextResponse.json({error:"Could not get elevation for location"},{status:404});return R.NextResponse.json({success:!0,data:s})}catch(e){return console.error("Elevation GET error:",e),R.NextResponse.json({error:"Failed to get elevation",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function I(e){try{let t=await (0,y.createClient)(),{data:{user:a}}=await t.auth.getUser();if(!a)return R.NextResponse.json({error:"Unauthorized"},{status:401});if(!P.isConfigured())return R.NextResponse.json({error:"Elevation service is not configured. Set GOOGLE_API_KEY environment variable."},{status:503});let r=await e.json(),n=T.parse(r);switch(n.action){case"single":{let e=await P.getElevation(n.location);if(!e)return R.NextResponse.json({error:"Could not get elevation for location"},{status:404});return R.NextResponse.json({success:!0,data:e})}case"multiple":{let e=await P.getElevations(n.locations);if(!e)return R.NextResponse.json({error:"Could not get elevations for locations"},{status:500});return R.NextResponse.json({success:!0,data:{elevations:e,count:e.length}})}case"profile":{let e=await P.getElevationProfile(n.path,n.samples);if(!e)return R.NextResponse.json({error:"Could not get elevation profile"},{status:500});return R.NextResponse.json({success:!0,data:e})}case"property":{let e=await P.analyzePropertyElevation(n.location,n.radiusMeters);if(!e)return R.NextResponse.json({error:"Could not analyze property elevation"},{status:500});return R.NextResponse.json({success:!0,data:e})}default:return R.NextResponse.json({error:"Invalid action"},{status:400})}}catch(e){if(console.error("Elevation API error:",e),e instanceof w.z.ZodError)return R.NextResponse.json({error:"Invalid request data",details:e.errors},{status:400});return R.NextResponse.json({error:"Failed to process elevation request",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}e.s(["GET",()=>S,"POST",()=>I],46468);var O=e.i(46468);let _=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/elevation/route",pathname:"/api/elevation",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/elevation/route.ts",nextConfigOutput:"",userland:O}),{workAsyncStorage:U,workUnitAsyncStorage:z,serverHooks:K}=_;function k(){return(0,r.patchFetch)({workAsyncStorage:U,workUnitAsyncStorage:z})}async function F(e,t,r){_.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/elevation/route";R=R.replace(/\/index$/,"")||"/";let w=await _.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:y,params:x,nextConfig:M,parsedUrl:P,isDraftMode:C,prerenderManifest:A,routerServerContext:b,isOnDemandRevalidate:N,revalidateOnlyGenerated:j,resolvedPathname:T,clientReferenceManifest:S,serverActionsManifest:I}=w,O=(0,l.normalizeAppPath)(R),U=!!(A.dynamicRoutes[O]||A.routes[T]),z=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,P,!1):t.end("This page could not be found"),null);if(U&&!C){let e=!!A.routes[T],t=A.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(M.experimental.adapterPath)return await z();throw new f.NoFallbackError}}let K=null;!U||_.isDev||C||(K="/index"===(K=T)?"/":K);let k=!0===_.isDev||!U,F=U&&!k;I&&S&&(0,s.setReferenceManifestsSingleton)({page:R,clientReferenceManifest:S,serverActionsManifest:I,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:I})});let $=e.method||"GET",D=(0,o.getTracer)(),H=D.getActiveScopeSpan(),q={params:x,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!M.experimental.authInterrupts},cacheComponents:!!M.cacheComponents,supportsDynamicResponse:k,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:M.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>_.onRequestError(e,t,r,b)},sharedContext:{buildId:y}},L=new u.NodeNextRequest(e),G=new u.NodeNextResponse(t),B=c.NextRequestAdapter.fromNodeNextRequest(L,(0,c.signalFromNodeResponse)(t));try{let s=async e=>_.handle(B,q).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=D.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${$} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${$} ${R}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var o,l;let u=async({previousCacheEntry:a})=>{try{if(!i&&N&&j&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await s(n);e.fetchMetrics=q.renderOpts.fetchMetrics;let l=q.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let u=q.renderOpts.collectedTags;if(!U)return await (0,h.sendResponse)(L,G,o,q.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(o.headers);u&&(t[m.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==q.renderOpts.collectedRevalidate&&!(q.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&q.renderOpts.collectedRevalidate,r=void 0===q.renderOpts.collectedExpire||q.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:q.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await _.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:N})},b),t}},c=await _.handleResponse({req:e,nextConfig:M,cacheKey:K,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:j,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:i});if(!U)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",N?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,g.fromNodeOutgoingHttpHeaders)(c.value.headers);return i&&U||d.delete(m.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,v.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)(L,G,new Response(c.value.body,{headers:d,status:c.value.status||200})),null};H?await l(H):await D.withPropagatedContext(e.headers,()=>D.trace(d.BaseServerSpan.handleRequest,{spanName:`${$} ${R}`,kind:o.SpanKind.SERVER,attributes:{"http.method":$,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await _.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:N})}),U)throw t;return await (0,h.sendResponse)(L,G,new Response(null,{status:500})),null}}e.s(["handler",()=>F,"patchFetch",()=>k,"routeModule",()=>_,"serverHooks",()=>K,"workAsyncStorage",()=>U,"workUnitAsyncStorage",()=>z],333133)}];

//# sourceMappingURL=3c0ae_next_dist_esm_build_templates_app-route_e9fc284f.js.map