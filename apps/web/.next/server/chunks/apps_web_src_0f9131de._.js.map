{"version":3,"sources":["../../../../../apps/web/src/emails/templates/team/invitation.tsx","../../../../../apps/web/src/emails/components/button.tsx","../../../../../apps/web/src/emails/theme.ts","../../../../../apps/web/src/emails/components/card.tsx","../../../../../apps/web/src/emails/components/heading.tsx","../../../../../apps/web/src/emails/layouts/base-layout.tsx","../../../../../apps/web/src/lib/email/company-domain-sender.ts","../../../../../apps/web/src/lib/email/email-router.ts","../../../../../apps/web/src/lib/auth/invitation-tokens.ts","../../../../../apps/web/src/actions/team-invitations.ts"],"sourcesContent":["/**\n * Team Invitation Email Template - Invitation to join team\n *\n * Features:\n * - Invitation to join company team\n * - Secure invitation link with expiration\n * - Role and access information\n * - Getting started guide\n */\n\nimport { Text } from \"@react-email/components\";\nimport { Button } from \"@/emails/components/button\";\nimport { Card } from \"@/emails/components/card\";\nimport { Heading } from \"@/emails/components/heading\";\nimport { BaseLayout } from \"@/emails/layouts/base-layout\";\nimport { EMAIL_COLORS } from \"@/emails/theme\";\n\nexport type TeamInvitationProps = {\n\tinviteeName: string;\n\tinviterName: string;\n\tcompanyName: string;\n\trole: string;\n\tjobTitle?: string;\n\tinvitationUrl: string;\n\texpiresInDays?: number;\n\tsupportEmail?: string;\n\tsupportPhone?: string;\n\tpreviewText?: string;\n};\n\nexport default function TeamInvitationEmail({\n\tinviteeName,\n\tinviterName,\n\tcompanyName,\n\trole,\n\tjobTitle,\n\tinvitationUrl,\n\texpiresInDays = 7,\n\tsupportEmail = \"support@thorbis.com\",\n\tsupportPhone = \"(555) 123-4567\",\n\tpreviewText = `You've been invited to join ${companyName}`,\n}: TeamInvitationProps) {\n\tconst roleDisplay = role.charAt(0).toUpperCase() + role.slice(1);\n\n\treturn (\n\t\t<BaseLayout previewText={previewText}>\n\t\t\t<Heading level={1}>Welcome to the Team!</Heading>\n\n\t\t\t<Text style={paragraph}>Hi {inviteeName},</Text>\n\n\t\t\t<Text style={paragraph}>\n\t\t\t\t{inviterName} has invited you to join <strong>{companyName}</strong> on\n\t\t\t\tThorbis. We're excited to have you on board!\n\t\t\t</Text>\n\n\t\t\t<Card style={invitationCard}>\n\t\t\t\t<div style={invitationIcon}>üéâ</div>\n\t\t\t\t<Text style={invitationTitle}>You're Invited!</Text>\n\t\t\t\t<Text style={invitationText}>\n\t\t\t\t\tYou've been invited as a <strong>{roleDisplay}</strong>\n\t\t\t\t\t{jobTitle ? ` - ${jobTitle}` : \"\"}.\n\t\t\t\t</Text>\n\t\t\t\t<Text style={invitationText}>\n\t\t\t\t\tClick the button below to accept your invitation and set up your\n\t\t\t\t\taccount.\n\t\t\t\t</Text>\n\t\t\t</Card>\n\n\t\t\t<div style={buttonContainer}>\n\t\t\t\t<Button href={invitationUrl}>Accept Invitation</Button>\n\t\t\t</div>\n\n\t\t\t<Card style={expiryCard}>\n\t\t\t\t<Text style={expiryText}>\n\t\t\t\t\t‚è∞ This invitation link will expire in{\" \"}\n\t\t\t\t\t<strong>{expiresInDays} days</strong>. Please accept your invitation\n\t\t\t\t\tsoon.\n\t\t\t\t</Text>\n\t\t\t</Card>\n\n\t\t\t<Card style={featuresCard}>\n\t\t\t\t<Heading level={3}>What you can do with Thorbis:</Heading>\n\t\t\t\t<ul style={featuresList}>\n\t\t\t\t\t<li style={featureItem}>\n\t\t\t\t\t\t<strong>üìÖ Manage Jobs & Schedule:</strong> Create and track jobs,\n\t\t\t\t\t\tschedule appointments, and coordinate with your team\n\t\t\t\t\t</li>\n\t\t\t\t\t<li style={featureItem}>\n\t\t\t\t\t\t<strong>üë• Customer Management:</strong> Access complete customer\n\t\t\t\t\t\tinformation, history, and communication logs\n\t\t\t\t\t</li>\n\t\t\t\t\t<li style={featureItem}>\n\t\t\t\t\t\t<strong>üí∞ Invoicing & Payments:</strong> Generate invoices,\n\t\t\t\t\t\testimates, and track payments in real-time\n\t\t\t\t\t</li>\n\t\t\t\t\t<li style={featureItem}>\n\t\t\t\t\t\t<strong>üìä Reports & Analytics:</strong> View performance metrics\n\t\t\t\t\t\tand business insights\n\t\t\t\t\t</li>\n\t\t\t\t\t<li style={featureItem}>\n\t\t\t\t\t\t<strong>üí¨ Team Communication:</strong> Collaborate with your team\n\t\t\t\t\t\tthrough built-in messaging\n\t\t\t\t\t</li>\n\t\t\t\t\t<li style={featureItem}>\n\t\t\t\t\t\t<strong>üì± Mobile Access:</strong> Access your work from any device,\n\t\t\t\t\t\tanywhere\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</Card>\n\n\t\t\t<Card style={securityCard}>\n\t\t\t\t<Heading level={3}>Secure & Reliable</Heading>\n\t\t\t\t<Text style={securityText}>\n\t\t\t\t\tYour account is protected with industry-standard security. All data is\n\t\t\t\t\tencrypted and backed up regularly to keep your business safe.\n\t\t\t\t</Text>\n\t\t\t</Card>\n\n\t\t\t<Card style={stepsCard}>\n\t\t\t\t<Heading level={3}>Getting Started is Easy</Heading>\n\t\t\t\t<div style={stepGrid}>\n\t\t\t\t\t<div style={step}>\n\t\t\t\t\t\t<div style={stepNumber}>1</div>\n\t\t\t\t\t\t<Text style={stepText}>\n\t\t\t\t\t\t\tClick the \"Accept Invitation\" button above\n\t\t\t\t\t\t</Text>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style={step}>\n\t\t\t\t\t\t<div style={stepNumber}>2</div>\n\t\t\t\t\t\t<Text style={stepText}>\n\t\t\t\t\t\t\tComplete your profile and set a secure password\n\t\t\t\t\t\t</Text>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style={step}>\n\t\t\t\t\t\t<div style={stepNumber}>3</div>\n\t\t\t\t\t\t<Text style={stepText}>\n\t\t\t\t\t\t\tExplore the platform and start collaborating!\n\t\t\t\t\t\t</Text>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</Card>\n\n\t\t\t<Card style={helpCard}>\n\t\t\t\t<Heading level={3}>Need Help?</Heading>\n\t\t\t\t<Text style={helpText}>\n\t\t\t\t\tIf you have any questions about getting started or need assistance,\n\t\t\t\t\tour support team is here to help.\n\t\t\t\t</Text>\n\t\t\t\t<div style={contactGrid}>\n\t\t\t\t\t<div style={contactMethod}>\n\t\t\t\t\t\t<Text style={contactLabel}>Email:</Text>\n\t\t\t\t\t\t<a href={`mailto:${supportEmail}`} style={contactLink}>\n\t\t\t\t\t\t\t{supportEmail}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style={contactMethod}>\n\t\t\t\t\t\t<Text style={contactLabel}>Phone:</Text>\n\t\t\t\t\t\t<a href={`tel:${supportPhone}`} style={contactLink}>\n\t\t\t\t\t\t\t{supportPhone}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</Card>\n\n\t\t\t<Text style={footerNote}>\n\t\t\t\t<strong>Note:</strong> If you didn't expect this invitation or believe\n\t\t\t\tyou received this email in error, please contact us at{\" \"}\n\t\t\t\t<a href={`mailto:${supportEmail}`} style={inlineLink}>\n\t\t\t\t\t{supportEmail}\n\t\t\t\t</a>\n\t\t\t\t.\n\t\t\t</Text>\n\t\t</BaseLayout>\n\t);\n}\n\n// Styles\nconst paragraph = {\n\tcolor: \"#374151\",\n\tfontSize: \"16px\",\n\tlineHeight: \"24px\",\n\tmargin: \"0 0 16px 0\",\n};\n\nconst invitationCard = {\n\tbackground:\n\t\t\"linear-gradient(135deg, hsl(217 91% 60%) 0%, hsl(217 91% 50%) 100%)\",\n\tborderRadius: \"12px\",\n\tpadding: \"40px\",\n\tmargin: \"24px 0\",\n\ttextAlign: \"center\" as const,\n};\n\nconst invitationIcon = {\n\tfontSize: \"64px\",\n\tmargin: \"0 0 16px 0\",\n};\n\nconst invitationTitle = {\n\tcolor: EMAIL_COLORS.primaryText,\n\tfontSize: \"24px\",\n\tfontWeight: \"600\",\n\tmargin: \"0 0 12px 0\",\n};\n\nconst invitationText = {\n\tcolor: EMAIL_COLORS.primaryText,\n\tfontSize: \"16px\",\n\tlineHeight: \"24px\",\n\tmargin: \"0 0 12px 0\",\n\topacity: \"0.95\",\n};\n\nconst buttonContainer = {\n\tmargin: \"32px 0\",\n\ttextAlign: \"center\" as const,\n};\n\nconst expiryCard = {\n\tbackgroundColor: \"#fef3c7\",\n\tborder: \"1px solid #fde68a\",\n\tborderRadius: \"8px\",\n\tpadding: \"16px\",\n\tmargin: \"24px 0\",\n\ttextAlign: \"center\" as const,\n};\n\nconst expiryText = {\n\tcolor: \"#92400e\",\n\tfontSize: \"14px\",\n\tlineHeight: \"20px\",\n\tmargin: \"0\",\n};\n\nconst featuresCard = {\n\tbackgroundColor: \"#f0fdf4\",\n\tborder: \"1px solid #bbf7d0\",\n\tmargin: \"24px 0\",\n};\n\nconst featuresList = {\n\tcolor: \"#166534\",\n\tfontSize: \"14px\",\n\tlineHeight: \"22px\",\n\tmargin: \"12px 0 0 20px\",\n\tpadding: \"0\",\n};\n\nconst featureItem = {\n\tmargin: \"0 0 12px 0\",\n};\n\nconst securityCard = {\n\tbackgroundColor: \"#f5f3ff\",\n\tborder: \"1px solid #ddd6fe\",\n\tmargin: \"24px 0\",\n};\n\nconst securityText = {\n\tcolor: \"#5b21b6\",\n\tfontSize: \"15px\",\n\tlineHeight: \"22px\",\n\tmargin: \"12px 0 0 0\",\n};\n\nconst stepsCard = {\n\tbackgroundColor: \"#eff6ff\",\n\tborder: \"1px solid #bfdbfe\",\n\tmargin: \"24px 0\",\n};\n\nconst stepGrid = {\n\tdisplay: \"grid\" as const,\n\tgridTemplateColumns: \"1fr 1fr 1fr\",\n\tgap: \"20px\",\n\tmargin: \"20px 0 0 0\",\n};\n\nconst step = {\n\ttextAlign: \"center\" as const,\n};\n\nconst stepNumber = {\n\twidth: \"40px\",\n\theight: \"40px\",\n\tbackgroundColor: \"hsl(217 91% 60%)\",\n\tcolor: EMAIL_COLORS.primaryText,\n\tborderRadius: \"50%\",\n\tdisplay: \"inline-flex\",\n\talignItems: \"center\",\n\tjustifyContent: \"center\",\n\tfontSize: \"18px\",\n\tfontWeight: \"600\",\n\tmargin: \"0 auto 12px auto\",\n};\n\nconst stepText = {\n\tcolor: \"#1e40af\",\n\tfontSize: \"13px\",\n\tlineHeight: \"18px\",\n\tmargin: \"0\",\n};\n\nconst helpCard = {\n\tbackgroundColor: \"#fef2f2\",\n\tborder: \"1px solid #fecaca\",\n\tmargin: \"24px 0\",\n};\n\nconst helpText = {\n\tcolor: \"#991b1b\",\n\tfontSize: \"15px\",\n\tlineHeight: \"22px\",\n\tmargin: \"12px 0 20px 0\",\n};\n\nconst contactGrid = {\n\tdisplay: \"grid\" as const,\n\tgridTemplateColumns: \"1fr 1fr\",\n\tgap: \"16px\",\n};\n\nconst contactMethod = {\n\ttextAlign: \"center\" as const,\n};\n\nconst contactLabel = {\n\tcolor: \"#6b7280\",\n\tfontSize: \"12px\",\n\ttextTransform: \"uppercase\" as const,\n\tletterSpacing: \"0.05em\",\n\tmargin: \"0 0 8px 0\",\n};\n\nconst contactLink = {\n\tcolor: \"hsl(217 91% 60%)\",\n\tfontSize: \"15px\",\n\tfontWeight: \"600\",\n\ttextDecoration: \"underline\",\n};\n\nconst footerNote = {\n\tcolor: \"#6b7280\",\n\tfontSize: \"13px\",\n\tlineHeight: \"20px\",\n\tmargin: \"32px 0 0 0\",\n\tpadding: \"20px\",\n\tbackgroundColor: \"#f9fafb\",\n\tborderRadius: \"8px\",\n\ttextAlign: \"center\" as const,\n};\n\nconst inlineLink = {\n\tcolor: \"hsl(217 91% 60%)\",\n\ttextDecoration: \"underline\",\n};\n","/**\n * Email Button Component - Matches dashboard button design\n *\n * Design:\n * - Primary variant with Thorbis Electric Blue\n * - Outline variant for secondary actions\n * - Responsive and accessible\n * - Supports both link and button styles\n */\n\nimport { Button as EmailButton } from \"@react-email/components\";\nimport { EMAIL_COLORS } from \"../theme\";\n\ntype ButtonProps = {\n\thref: string;\n\tchildren: React.ReactNode;\n\tvariant?: \"primary\" | \"outline\";\n};\n\nexport function Button({ href, children, variant = \"primary\" }: ButtonProps) {\n\tconst baseStyle = {\n\t\tdisplay: \"inline-block\",\n\t\tpadding: \"12px 24px\",\n\t\tfontSize: \"16px\",\n\t\tfontWeight: \"600\",\n\t\ttextDecoration: \"none\",\n\t\tborderRadius: \"8px\",\n\t\ttextAlign: \"center\" as const,\n\t\ttransition: \"all 0.2s ease\",\n\t};\n\n\tconst variantStyles = {\n\t\tprimary: {\n\t\t\tbackgroundColor: EMAIL_COLORS.primary, // Thorbis Electric Blue\n\t\t\tcolor: EMAIL_COLORS.primaryText,\n\t\t\tborder: \"none\",\n\t\t},\n\t\toutline: {\n\t\t\tbackgroundColor: \"transparent\",\n\t\t\tcolor: EMAIL_COLORS.primary,\n\t\t\tborder: `2px solid ${EMAIL_COLORS.primary}`,\n\t\t},\n\t};\n\n\treturn (\n\t\t<EmailButton\n\t\t\thref={href}\n\t\t\tstyle={{\n\t\t\t\t...baseStyle,\n\t\t\t\t...variantStyles[variant],\n\t\t\t}}\n\t\t>\n\t\t\t{children}\n\t\t</EmailButton>\n\t);\n}\n","export const EMAIL_COLORS = {\n\tbackground: \"#fafafa\",\n\tsurface: \"#fcfcfc\",\n\tsurfaceStrong: \"#f2f2f2\",\n\tprimary: \"#3c6ff5\",\n\tprimaryText: \"#fafafa\",\n\theading: \"#171717\",\n\ttext: \"#171717\",\n\tmuted: \"#737373\",\n\tborder: \"#e6e6e6\",\n\tsuccess: \"#22c55e\",\n\twarning: \"#f59e0b\",\n\terror: \"#ef4444\",\n};\n","/**\n * Email Card Component - Information card matching dashboard cards\n *\n * Design:\n * - Clean white background with subtle border\n * - Rounded corners\n * - Padding for content spacing\n * - Optional header and footer sections\n */\n\nimport { Section, Text } from \"@react-email/components\";\nimport type { ReactNode } from \"react\";\nimport { EMAIL_COLORS } from \"../theme\";\n\ntype CardProps = {\n\tchildren: ReactNode;\n\ttitle?: string;\n\tstyle?: React.CSSProperties;\n};\n\nexport function Card({ children, title, style }: CardProps) {\n\treturn (\n\t\t<Section\n\t\t\tstyle={{\n\t\t\t\t...cardStyle,\n\t\t\t\t...style,\n\t\t\t}}\n\t\t>\n\t\t\t{title && <Text style={titleStyle}>{title}</Text>}\n\t\t\t{children}\n\t\t</Section>\n\t);\n}\n\nconst cardStyle = {\n\tbackgroundColor: EMAIL_COLORS.surface,\n\tborder: `1px solid ${EMAIL_COLORS.border}`,\n\tborderRadius: \"8px\",\n\tpadding: \"24px\",\n\tmargin: \"16px 0\",\n};\n\nconst titleStyle = {\n\tfontSize: \"18px\",\n\tfontWeight: \"600\",\n\tcolor: EMAIL_COLORS.heading,\n\tmargin: \"0 0 16px 0\",\n};\n","/**\n * Email Heading Component - Typography for email headings\n *\n * Design:\n * - H1, H2, H3 variants\n * - Matches dashboard typography\n * - Proper spacing and hierarchy\n */\n\nimport { Heading as EmailHeading } from \"@react-email/components\";\nimport { EMAIL_COLORS } from \"../theme\";\n\ntype HeadingProps = {\n\tchildren: React.ReactNode;\n\tlevel?: 1 | 2 | 3;\n\tstyle?: React.CSSProperties;\n};\n\nexport function Heading({ children, level = 1, style }: HeadingProps) {\n\tconst headingTag = `h${level}` as \"h1\" | \"h2\" | \"h3\";\n\tconst headingStyles = {\n\t\t1: {\n\t\t\tfontSize: \"32px\",\n\t\t\tfontWeight: \"700\",\n\t\t\tcolor: EMAIL_COLORS.heading,\n\t\t\tmargin: \"0 0 16px 0\",\n\t\t\tlineHeight: \"1.2\",\n\t\t},\n\t\t2: {\n\t\t\tfontSize: \"24px\",\n\t\t\tfontWeight: \"600\",\n\t\t\tcolor: EMAIL_COLORS.text,\n\t\t\tmargin: \"0 0 12px 0\",\n\t\t\tlineHeight: \"1.3\",\n\t\t},\n\t\t3: {\n\t\t\tfontSize: \"18px\",\n\t\t\tfontWeight: \"600\",\n\t\t\tcolor: EMAIL_COLORS.muted,\n\t\t\tmargin: \"0 0 8px 0\",\n\t\t\tlineHeight: \"1.4\",\n\t\t},\n\t};\n\n\treturn (\n\t\t<EmailHeading\n\t\t\tas={headingTag}\n\t\t\tstyle={{\n\t\t\t\t...headingStyles[level],\n\t\t\t\t...style,\n\t\t\t}}\n\t\t>\n\t\t\t{children}\n\t\t</EmailHeading>\n\t);\n}\n","/**\n * Thorbis-Branded Email Layout\n *\n * For platform/system emails:\n * - Clean, full-width design (no cards)\n * - Thorbis logo image from CDN/env\n * - Thorbis Electric Blue branding\n * - Professional footer with Thorbis info\n *\n * Uses environment variables for:\n * - Logo URL\n * - App URL\n * - Support email\n * - Company info\n */\n\nimport {\n\tBody,\n\tContainer,\n\tHead,\n\tHr,\n\tHtml,\n\tImg,\n\tLink,\n\tPreview,\n\tSection,\n\tText,\n} from \"@react-email/components\";\nimport type { ReactNode } from \"react\";\nimport { EMAIL_COLORS } from \"../theme\";\n\ntype BaseLayoutProps = {\n\tchildren: ReactNode;\n\tpreviewText?: string;\n};\n\n// Environment-based configuration\nconst THORBIS_LOGO_URL =\n\tprocess.env.NEXT_PUBLIC_THORBIS_LOGO_URL ||\n\t\"https://thorbis.com/logo-white.png\";\nconst THORBIS_APP_URL =\n\tprocess.env.NEXT_PUBLIC_APP_URL || \"https://app.thorbis.com\";\nconst THORBIS_WEBSITE =\n\tprocess.env.NEXT_PUBLIC_WEBSITE_URL || \"https://thorbis.com\";\nconst THORBIS_SUPPORT_EMAIL =\n\tprocess.env.THORBIS_SUPPORT_EMAIL || \"support@thorbis.com\";\nconst THORBIS_DOCS_URL = `${THORBIS_WEBSITE}/docs`;\nconst THORBIS_PRIVACY_URL = `${THORBIS_WEBSITE}/privacy`;\nconst THORBIS_TERMS_URL = `${THORBIS_WEBSITE}/terms`;\n\nexport function BaseLayout({ children, previewText }: BaseLayoutProps) {\n\treturn (\n\t\t<Html>\n\t\t\t<Head>\n\t\t\t\t<style>{`\n          @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');\n\n          /* Reset email client styles */\n          body { margin: 0; padding: 0; }\n          table { border-collapse: collapse; }\n          img { border: 0; }\n\n          /* Responsive */\n          @media only screen and (max-width: 600px) {\n            .mobile-padding { padding: 20px !important; }\n            .mobile-text { font-size: 14px !important; }\n            .mobile-heading { font-size: 24px !important; }\n          }\n        `}</style>\n\t\t\t</Head>\n\t\t\t{previewText && <Preview>{previewText}</Preview>}\n\t\t\t<Body style={main}>\n\t\t\t\t<Container style={container}>\n\t\t\t\t\t{/* Header with Thorbis logo on blue background */}\n\t\t\t\t\t<Section style={header}>\n\t\t\t\t\t\t<Img\n\t\t\t\t\t\t\tsrc={THORBIS_LOGO_URL}\n\t\t\t\t\t\t\talt=\"Thorbis\"\n\t\t\t\t\t\t\twidth=\"160\"\n\t\t\t\t\t\t\theight=\"40\"\n\t\t\t\t\t\t\tstyle={logo}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Section>\n\n\t\t\t\t\t{/* Main content - full width, no cards */}\n\t\t\t\t\t<Section style={content} className=\"mobile-padding\">\n\t\t\t\t\t\t{children}\n\t\t\t\t\t</Section>\n\n\t\t\t\t\t{/* Divider */}\n\t\t\t\t\t<Hr style={divider} />\n\n\t\t\t\t\t{/* Footer */}\n\t\t\t\t\t<Section style={footer} className=\"mobile-padding\">\n\t\t\t\t\t\t{/* Support Links */}\n\t\t\t\t\t\t<Text style={footerText}>\n\t\t\t\t\t\t\tNeed help?{\" \"}\n\t\t\t\t\t\t\t<Link href={`mailto:${THORBIS_SUPPORT_EMAIL}`} style={footerLink}>\n\t\t\t\t\t\t\t\tContact Support\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t{\" ‚Ä¢ \"}\n\t\t\t\t\t\t\t<Link href={THORBIS_DOCS_URL} style={footerLink}>\n\t\t\t\t\t\t\t\tDocumentation\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</Text>\n\n\t\t\t\t\t\t{/* Legal Links */}\n\t\t\t\t\t\t<Text style={footerText}>\n\t\t\t\t\t\t\t<Link href={THORBIS_PRIVACY_URL} style={footerLink}>\n\t\t\t\t\t\t\t\tPrivacy Policy\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t{\" ‚Ä¢ \"}\n\t\t\t\t\t\t\t<Link href={THORBIS_TERMS_URL} style={footerLink}>\n\t\t\t\t\t\t\t\tTerms of Service\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</Text>\n\n\t\t\t\t\t\t{/* Company Info */}\n\t\t\t\t\t\t<Text style={footerCopyright}>\n\t\t\t\t\t\t\t¬© {new Date().getFullYear()} Thorbis. All rights reserved.\n\t\t\t\t\t\t</Text>\n\n\t\t\t\t\t\t<Text style={footerAddress}>\n\t\t\t\t\t\t\tThorbis ‚Ä¢ 123 Innovation Drive, San Francisco, CA 94105\n\t\t\t\t\t\t</Text>\n\n\t\t\t\t\t\t{/* Unsubscribe - required for CAN-SPAM compliance */}\n\t\t\t\t\t\t<Text style={footerUnsubscribe}>\n\t\t\t\t\t\t\tYou're receiving this email because you have an account with\n\t\t\t\t\t\t\tThorbis.{\" \"}\n\t\t\t\t\t\t\t<Link href=\"{{unsubscribe_url}}\" style={footerLink}>\n\t\t\t\t\t\t\t\tUnsubscribe from marketing emails\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</Text>\n\t\t\t\t\t</Section>\n\t\t\t\t</Container>\n\t\t\t</Body>\n\t\t</Html>\n\t);\n}\n\n// Styles - Clean, full-width design\nconst main = {\n\tbackgroundColor: EMAIL_COLORS.background,\n\tfontFamily:\n\t\t'Inter, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif',\n\tWebkitFontSmoothing: \"antialiased\" as const,\n\tMozOsxFontSmoothing: \"grayscale\" as const,\n};\n\nconst container = {\n\tbackgroundColor: EMAIL_COLORS.surface,\n\tmaxWidth: \"600px\",\n\tmargin: \"0 auto\",\n};\n\nconst header = {\n\tbackgroundColor: EMAIL_COLORS.primary, // Thorbis Electric Blue\n\tpadding: \"40px 0\",\n\ttextAlign: \"center\" as const,\n};\n\nconst logo = {\n\tmargin: \"0 auto\",\n\tdisplay: \"block\",\n};\n\nconst content = {\n\tpadding: \"48px 40px\",\n\tcolor: EMAIL_COLORS.text,\n\tfontSize: \"16px\",\n\tlineHeight: \"24px\",\n};\n\nconst divider = {\n\tborderColor: EMAIL_COLORS.border,\n\tborderWidth: \"1px\",\n\tmargin: \"0\",\n};\n\nconst footer = {\n\tpadding: \"32px 40px\",\n\ttextAlign: \"center\" as const,\n\tbackgroundColor: EMAIL_COLORS.surfaceStrong,\n};\n\nconst footerText = {\n\tcolor: EMAIL_COLORS.muted,\n\tfontSize: \"14px\",\n\tlineHeight: \"24px\",\n\tmargin: \"8px 0\",\n};\n\nconst footerLink = {\n\tcolor: EMAIL_COLORS.primary,\n\ttextDecoration: \"none\",\n\tfontWeight: \"500\",\n};\n\nconst footerCopyright = {\n\tcolor: EMAIL_COLORS.muted,\n\tfontSize: \"13px\",\n\tmargin: \"16px 0 0 0\",\n\tfontWeight: \"600\",\n};\n\nconst footerAddress = {\n\tcolor: EMAIL_COLORS.muted,\n\tfontSize: \"12px\",\n\tmargin: \"8px 0\",\n};\n\nconst footerUnsubscribe = {\n\tcolor: EMAIL_COLORS.muted,\n\tfontSize: \"11px\",\n\tmargin: \"16px 0 0 0\",\n\tlineHeight: \"18px\",\n};\n","/**\n * Company Domain Email Sender\n *\n * CRITICAL RULE - Reply-To Addresses:\n * ====================================\n * Reply-to ALWAYS uses the platform subdomain (mail.thorbis.com), regardless of:\n * - Which email provider is used (platform, custom domain, Gmail)\n * - What the FROM address is\n * - Whether they have a custom domain or not\n *\n * Examples:\n * - FROM: notifications@acme-plumbing.com (custom domain)\n *   REPLY-TO: support@acme-plumbing.mail.thorbis.com (platform subdomain)\n *\n * - FROM: john@gmail.com (personal Gmail)\n *   REPLY-TO: support@acme-plumbing.mail.thorbis.com (platform subdomain)\n *\n * - FROM: notifications@acme-plumbing.mail.thorbis.com (platform subdomain)\n *   REPLY-TO: support@acme-plumbing.mail.thorbis.com (same platform subdomain)\n *\n * Why?\n * - Centralizes all replies to one inbox per company\n * - Prevents replies going to custom domains or personal emails\n * - Each company controls their reply-to prefix (support@, help@, etc.)\n * - Stored in company_email_domains.reply_to_email\n */\n\nimport { Resend } from \"resend\";\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\n\nconst resend = new Resend(process.env.RESEND_API_KEY);\n\ntype CompanyDomain = {\n\tid: string;\n\tdomain_name: string;\n\tsubdomain: string; // REQUIRED: Always use subdomain to prevent SPF conflicts\n\tfull_domain: string;\n\tstatus: string;\n\tsending_addresses: Array<{\n\t\ttype: string;\n\t\temail: string;\n\t}>;\n\treply_to_email: string | null;\n};\n\ntype EmailType =\n\t| \"invoice\"\n\t| \"estimate\"\n\t| \"reminder\"\n\t| \"notification\"\n\t| \"marketing\"\n\t| \"general\";\n\n/**\n * Get the verified email domain for a company\n * Returns null if no domain is verified\n */\nasync function getCompanyVerifiedDomain(\n\tcompanyId: string,\n): Promise<CompanyDomain | null> {\n\tconst supabase = await createServiceSupabaseClient();\n\n\tif (!supabase) {\n\t\treturn null;\n\t}\n\n\tconst { data: domain } = await supabase\n\t\t.from(\"company_email_domains\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"status\", \"verified\")\n\t\t.eq(\"sending_enabled\", true)\n\t\t.eq(\"is_suspended\", false)\n\t\t.order(\"is_platform_subdomain\", { ascending: true }) // Prefer custom domains for FROM\n\t\t.order(\"created_at\", { ascending: false })\n\t\t.limit(1)\n\t\t.maybeSingle();\n\n\tif (!domain) {\n\t\treturn null;\n\t}\n\n\t// Construct full domain (subdomain is always required)\n\tconst fullDomain = `${domain.subdomain}.${domain.domain_name}`;\n\n\treturn {\n\t\tid: domain.id,\n\t\tdomain_name: domain.domain_name,\n\t\tsubdomain: domain.subdomain,\n\t\tfull_domain: fullDomain,\n\t\tstatus: domain.status,\n\t\tsending_addresses: domain.sending_addresses || [],\n\t\treply_to_email: domain.reply_to_email,\n\t};\n}\n\n/**\n * Get the company's platform subdomain for reply-to\n * Reply-to ALWAYS uses the platform subdomain (mail.thorbis.com)\n * This ensures replies are isolated per company, never using custom domains\n */\nasync function getCompanyPlatformReplyTo(\n\tcompanyId: string,\n): Promise<string | null> {\n\tconst supabase = await createServiceSupabaseClient();\n\n\tif (!supabase) {\n\t\treturn null;\n\t}\n\n\t// Get the platform subdomain for this company\n\tconst { data: platformDomain } = await supabase\n\t\t.from(\"company_email_domains\")\n\t\t.select(\"domain_name, reply_to_email\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"is_platform_subdomain\", true)\n\t\t.eq(\"status\", \"verified\")\n\t\t.maybeSingle();\n\n\tif (!platformDomain) {\n\t\treturn null;\n\t}\n\n\t// Use configured reply-to if set, otherwise default to support@\n\tif (platformDomain.reply_to_email) {\n\t\treturn platformDomain.reply_to_email;\n\t}\n\n\t// Default: support@{company}.mail.thorbis.com\n\treturn `support@${platformDomain.domain_name}`;\n}\n\n/**\n * Get the appropriate sending address for a specific email type\n */\nfunction getSendingAddress(\n\tdomain: CompanyDomain,\n\ttype: EmailType,\n\tcompanyName: string,\n): string {\n\t// Check if company has custom sending addresses configured\n\tconst customAddress = domain.sending_addresses.find(\n\t\t(addr) => addr.type === type,\n\t);\n\n\tif (customAddress) {\n\t\treturn `${companyName} <${customAddress.email}>`;\n\t}\n\n\t// Default sending addresses based on type\n\tconst defaultEmail = `${type}@${domain.full_domain}`;\n\treturn `${companyName} <${defaultEmail}>`;\n}\n\n/**\n * Send email using company's verified domain\n * This is the PRIMARY function for ALL email sending in the platform\n */\nexport async function sendCompanyEmail({\n\tcompanyId,\n\tcompanyName,\n\ttype = \"notification\",\n\tto,\n\tsubject,\n\thtml,\n\ttext,\n\treplyTo,\n\tattachments,\n\tcommunicationId,\n}: {\n\tcompanyId: string;\n\tcompanyName: string;\n\ttype?: EmailType;\n\tto: string | string[];\n\tsubject: string;\n\thtml: string;\n\ttext?: string;\n\treplyTo?: string;\n\tattachments?: Array<{\n\t\tfilename: string;\n\t\tcontent: string;\n\t}>;\n\tcommunicationId?: string;\n}) {\n\t// 1. Get company's verified domain (for FROM address)\n\tconst domain = await getCompanyVerifiedDomain(companyId);\n\n\tif (!domain) {\n\t\tthrow new Error(\n\t\t\t`Company domain not verified. Please verify your email domain in settings before sending emails.`,\n\t\t);\n\t}\n\n\t// 2. Get appropriate sending address\n\tconst fromAddress = getSendingAddress(domain, type, companyName);\n\n\t// 3. Get reply-to from platform subdomain (NEVER custom domain)\n\t// Reply-to ALWAYS uses mail.thorbis.com, even when FROM uses a custom domain\n\t// This ensures all replies are centralized to the company's platform subdomain\n\tconst platformReplyTo = await getCompanyPlatformReplyTo(companyId);\n\tconst replyToAddress = replyTo || platformReplyTo || `support@${domain.full_domain}`;\n\n\t// 4. Add email tracking if communicationId is provided\n\tlet trackedHtml = html;\n\tif (communicationId) {\n\t\tconst { addEmailTracking } = await import(\"./email-tracking\");\n\t\ttrackedHtml = addEmailTracking(html, communicationId);\n\t}\n\n\t// 5. Send email via Resend\n\ttry {\n\t\tconst { data, error } = await resend.emails.send({\n\t\t\tfrom: fromAddress,\n\t\t\tto,\n\t\t\tsubject,\n\t\t\thtml: trackedHtml,\n\t\t\ttext,\n\t\t\treplyTo: replyToAddress,\n\t\t\tattachments,\n\t\t});\n\n\t\tif (error) {\n\t\t\tthrow new Error(`Failed to send email: ${error.message}`);\n\t\t}\n\n\t\treturn { success: true, messageId: data?.id };\n\t} catch (error) {\n\t\tconsole.error(\"Email send error:\", error);\n\t\tthrow error;\n\t}\n}\n\n/**\n * Check if company can send emails (has verified domain)\n */\nasync function canCompanySendEmail(companyId: string): Promise<boolean> {\n\tconst domain = await getCompanyVerifiedDomain(companyId);\n\treturn domain !== null && domain.status === \"verified\";\n}\n\n/**\n * Get company's email sending status and instructions\n */\nasync function getCompanyEmailStatus(companyId: string): Promise<{\n\tcanSend: boolean;\n\tdomain?: CompanyDomain;\n\tmessage: string;\n}> {\n\tconst supabase = await createServiceSupabaseClient();\n\n\tif (!supabase) {\n\t\treturn {\n\t\t\tcanSend: false,\n\t\t\tmessage: \"Database connection failed\",\n\t\t};\n\t}\n\n\tconst { data: domain } = await supabase\n\t\t.from(\"company_email_domains\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.single();\n\n\tif (!domain) {\n\t\treturn {\n\t\t\tcanSend: false,\n\t\t\tmessage:\n\t\t\t\t\"No email domain configured. Please add and verify your email domain in Settings ‚Üí Email Domain.\",\n\t\t};\n\t}\n\n\t// Subdomain is always required\n\tconst fullDomain = `${domain.subdomain}.${domain.domain_name}`;\n\n\tif (domain.status === \"verified\") {\n\t\treturn {\n\t\t\tcanSend: true,\n\t\t\tdomain: {\n\t\t\t\tid: domain.id,\n\t\t\t\tdomain_name: domain.domain_name,\n\t\t\t\tsubdomain: domain.subdomain,\n\t\t\t\tfull_domain: fullDomain,\n\t\t\t\tstatus: domain.status,\n\t\t\t\tsending_addresses: domain.sending_addresses || [],\n\t\t\t\treply_to_email: domain.reply_to_email,\n\t\t\t},\n\t\t\tmessage: `Ready to send from ${fullDomain}`,\n\t\t};\n\t}\n\n\tif (domain.status === \"pending\" || domain.status === \"verifying\") {\n\t\treturn {\n\t\t\tcanSend: false,\n\t\t\tdomain: {\n\t\t\t\tid: domain.id,\n\t\t\t\tdomain_name: domain.domain_name,\n\t\t\t\tsubdomain: domain.subdomain,\n\t\t\t\tfull_domain: fullDomain,\n\t\t\t\tstatus: domain.status,\n\t\t\t\tsending_addresses: domain.sending_addresses || [],\n\t\t\t\treply_to_email: domain.reply_to_email,\n\t\t\t},\n\t\t\tmessage: `Email domain ${fullDomain} is pending verification. Please add the required DNS records to verify.`,\n\t\t};\n\t}\n\n\treturn {\n\t\tcanSend: false,\n\t\tdomain: {\n\t\t\tid: domain.id,\n\t\t\tdomain_name: domain.domain_name,\n\t\t\tsubdomain: domain.subdomain,\n\t\t\tfull_domain: fullDomain,\n\t\t\tstatus: domain.status,\n\t\t\tsending_addresses: domain.sending_addresses || [],\n\t\t\treply_to_email: domain.reply_to_email,\n\t\t},\n\t\tmessage: `Email domain verification failed. Please check your DNS records or contact support.`,\n\t};\n}\n","/**\n * Email Router - Determines which email system to use\n *\n * Two email systems:\n * 1. Thorbis Platform Emails - System notifications, auth, team invites\n * 2. Company Branded Emails - Customer communications, invoices, estimates\n *\n * This router ensures emails use the correct sender and branding.\n */\n\"use server\";\n\nimport { render } from \"@react-email/components\";\nimport type { ReactElement } from \"react\";\nimport { sendCompanyEmail } from \"./company-domain-sender\";\nimport { sendEmail } from \"./email-sender\";\nimport type { EmailTemplate } from \"./email-types\";\n\n// Platform email options (Thorbis branding)\ntype PlatformEmailOptions = {\n\tcategory: \"platform\";\n\tto: string | string[];\n\tsubject: string;\n\ttemplate: ReactElement;\n\ttemplateType: EmailTemplate;\n\treplyTo?: string;\n\ttags?: { name: string; value: string }[];\n};\n\n// Company email options (Company branding)\ntype CompanyEmailOptions = {\n\tcategory: \"company\";\n\tcompanyId: string;\n\tcompanyName: string;\n\tto: string | string[];\n\tsubject: string;\n\ttemplate: ReactElement;\n\ttemplateType: EmailTemplate;\n\temailType?:\n\t\t| \"invoice\"\n\t\t| \"estimate\"\n\t\t| \"reminder\"\n\t\t| \"notification\"\n\t\t| \"marketing\"\n\t\t| \"general\";\n\treplyTo?: string;\n\ttags?: { name: string; value: string }[];\n\tcommunicationId?: string;\n};\n\ntype EmailOptions = PlatformEmailOptions | CompanyEmailOptions;\n\n/**\n * Smart email router - Automatically uses correct email system\n *\n * Usage:\n * ```typescript\n * // Platform email (Thorbis)\n * await routeEmail({\n *   category: \"platform\",\n *   to: \"user@example.com\",\n *   subject: \"Welcome to Thorbis\",\n *   template: <WelcomeEmail />,\n *   templateType: \"auth-welcome\"\n * });\n *\n * // Company email (Branded)\n * await routeEmail({\n *   category: \"company\",\n *   companyId: \"xxx\",\n *   companyName: \"ACME Plumbing\",\n *   to: \"customer@example.com\",\n *   subject: \"Invoice #1234\",\n *   template: <InvoiceEmail />,\n *   templateType: \"customer-invoice\",\n *   emailType: \"invoice\"\n * });\n * ```\n */\nasync function routeEmail(options: EmailOptions) {\n\tif (options.category === \"platform\") {\n\t\t// Use Thorbis platform email system\n\t\treturn await sendEmail({\n\t\t\tto: options.to,\n\t\t\tsubject: options.subject,\n\t\t\ttemplate: options.template,\n\t\t\ttemplateType: options.templateType,\n\t\t\treplyTo: options.replyTo,\n\t\t\ttags: options.tags,\n\t\t\tfromOverride: \"Thorbis <noreply@thorbis.com>\", // Always use Thorbis domain\n\t\t});\n\t} else {\n\t\t// Use company branded email system\n\t\tconst html = await render(options.template);\n\n\t\treturn await sendCompanyEmail({\n\t\t\tcompanyId: options.companyId,\n\t\t\tcompanyName: options.companyName,\n\t\t\ttype: options.emailType || \"notification\",\n\t\t\tto: options.to,\n\t\t\tsubject: options.subject,\n\t\t\thtml,\n\t\t\treplyTo: options.replyTo,\n\t\t\tcommunicationId: options.communicationId,\n\t\t});\n\t}\n}\n\n/**\n * Helper: Send platform email (Thorbis branding)\n */\nexport async function sendPlatformEmail(\n\toptions: Omit<PlatformEmailOptions, \"category\">,\n) {\n\treturn routeEmail({ ...options, category: \"platform\" });\n}\n\n/**\n * Helper: Send company email (Company branding)\n */\nexport async function sendCompanyBrandedEmail(\n\toptions: Omit<CompanyEmailOptions, \"category\">,\n) {\n\treturn routeEmail({ ...options, category: \"company\" });\n}\n","/**\n * Team Invitation Token Utilities\n *\n * Handles generation and verification of invitation tokens\n */\n\nimport { createHmac, randomBytes } from \"node:crypto\";\n\nconst INVITATION_SECRET =\n\tprocess.env.INVITATION_SECRET || \"fallback-secret-change-in-production\";\nconst INVITATION_EXPIRY_DAYS = 7;\n\n/**\n * Generate a secure token for invitation\n */\nexport function generateInvitationToken(payload: {\n\temail: string;\n\tcompanyId: string;\n\trole: string;\n}): string {\n\tconst data = {\n\t\t...payload,\n\t\texp: Date.now() + INVITATION_EXPIRY_DAYS * 24 * 60 * 60 * 1000,\n\t\tnonce: randomBytes(16).toString(\"hex\"),\n\t};\n\n\tconst encoded = Buffer.from(JSON.stringify(data)).toString(\"base64url\");\n\tconst signature = createHmac(\"sha256\", INVITATION_SECRET)\n\t\t.update(encoded)\n\t\t.digest(\"base64url\");\n\n\treturn `${encoded}.${signature}`;\n}\n\n/**\n * Verify an invitation token\n */\nfunction verifyInvitationToken(token: string): {\n\tvalid: boolean;\n\tpayload?: { email: string; companyId: string; role: string; exp: number };\n\terror?: string;\n} {\n\ttry {\n\t\tconst [encoded, signature] = token.split(\".\");\n\t\tif (!(encoded && signature)) {\n\t\t\treturn { valid: false, error: \"Invalid token format\" };\n\t\t}\n\n\t\t// Verify signature\n\t\tconst expectedSignature = createHmac(\"sha256\", INVITATION_SECRET)\n\t\t\t.update(encoded)\n\t\t\t.digest(\"base64url\");\n\n\t\tif (signature !== expectedSignature) {\n\t\t\treturn { valid: false, error: \"Invalid token signature\" };\n\t\t}\n\n\t\t// Decode payload\n\t\tconst payload = JSON.parse(Buffer.from(encoded, \"base64url\").toString());\n\n\t\t// Check expiration\n\t\tif (Date.now() > payload.exp) {\n\t\t\treturn { valid: false, error: \"Token expired\" };\n\t\t}\n\n\t\treturn { valid: true, payload };\n\t} catch (_error) {\n\t\treturn { valid: false, error: \"Token verification failed\" };\n\t}\n}\n","/**\n * Team Invitations - Magic Link System\n *\n * Handles sending and managing team member invitations with magic links\n */\n\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { z } from \"zod\";\nimport TeamInvitationEmail from \"@/emails/templates/team/invitation\";\nimport { sendPlatformEmail } from \"@/lib/email/email-router\";\nimport { EmailTemplate } from \"@/lib/email/email-types\";\nimport {\n\tActionError,\n\tERROR_CODES,\n\tERROR_MESSAGES,\n} from \"@/lib/errors/action-error\";\nimport {\n\ttype ActionResult,\n\tassertAuthenticated,\n\twithErrorHandling,\n} from \"@/lib/errors/with-error-handling\";\nimport { generateInvitationToken } from \"@/lib/auth/invitation-tokens\";\nimport { createClient } from \"@/lib/supabase/server\";\n\nconst INVITATION_EXPIRY_DAYS = 7;\n\nfunction requireSiteUrl(): string {\n\tconst siteUrl = process.env.NEXT_PUBLIC_SITE_URL;\n\tif (!siteUrl) {\n\t\tthrow new ActionError(\n\t\t\t\"NEXT_PUBLIC_SITE_URL is not configured\",\n\t\t\tERROR_CODES.INTERNAL_SERVER_ERROR,\n\t\t);\n\t}\n\treturn siteUrl.replace(/\\/$/, \"\");\n}\n\n/**\n * Send team member invitations after onboarding payment\n */\nexport async function sendTeamMemberInvitations(\n\tcompanyId: string,\n): Promise<ActionResult<{ sent: number; failed: number }>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\t// Get company and onboarding progress\n\t\tconst { data: company, error: companyError } = await supabase\n\t\t\t.from(\"companies\")\n\t\t\t.select(\"id, name, onboarding_progress\")\n\t\t\t.eq(\"id\", companyId)\n\t\t\t.single();\n\n\t\tif (companyError || !company) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Company not found\",\n\t\t\t\tERROR_CODES.DB_RECORD_NOT_FOUND,\n\t\t\t\t404,\n\t\t\t);\n\t\t}\n\n\t\t// Get team members from onboarding progress\n\t\tconst teamMembers =\n\t\t\t(company.onboarding_progress as any)?.step2?.teamMembers || [];\n\n\t\tif (!Array.isArray(teamMembers) || teamMembers.length === 0) {\n\t\t\treturn { sent: 0, failed: 0 };\n\t\t}\n\n\t\t// Get current user (the one who completed onboarding)\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst { data: inviter } = await supabase\n\t\t\t.from(\"profiles\")\n\t\t\t.select(\"full_name, email\")\n\t\t\t.eq(\"id\", user.id)\n\t\t\t.single();\n\n\t\tlet sentCount = 0;\n\t\tlet failedCount = 0;\n\n\t\tconst siteUrl = requireSiteUrl();\n\n\t\t// Process each team member\n\t\tfor (const member of teamMembers) {\n\t\t\t// Skip current user\n\t\t\tif (member.isCurrentUser) {\n\t\t\t\t// Create team_members record for current user (owner)\n\t\t\t\tconst { error: ownerError } = await supabase\n\t\t\t\t\t.from(\"company_memberships\")\n\t\t\t\t\t.upsert(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcompany_id: companyId,\n\t\t\t\t\t\t\tuser_id: user.id,\n\t\t\t\t\t\t\trole: member.role,\n\t\t\t\t\t\t\tstatus: \"active\",\n\t\t\t\t\t\t\tjob_title: \"Owner\",\n\t\t\t\t\t\t\tphone: member.phone || null,\n\t\t\t\t\t\t\tjoined_at: new Date().toISOString(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonConflict: \"user_id,company_id\",\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\n\t\t\t\tif (ownerError) {\n\t\t\t\t\tconsole.error(\"Failed to upsert owner membership:\", ownerError.message);\n\t\t\t\t\t// Continue - user may already have membership with different settings\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\t// Generate invitation token\n\t\t\t\tconst token = generateInvitationToken({\n\t\t\t\t\temail: member.email,\n\t\t\t\t\tcompanyId: company.id,\n\t\t\t\t\trole: member.role,\n\t\t\t\t});\n\n\t\t\t\tconst expiresAt = new Date();\n\t\t\t\texpiresAt.setDate(expiresAt.getDate() + INVITATION_EXPIRY_DAYS);\n\n\t\t\t\t// Store invitation in database\n\t\t\t\tconst { error: invitationError } = await supabase\n\t\t\t\t\t.from(\"team_invitations\")\n\t\t\t\t\t.insert({\n\t\t\t\t\t\tcompany_id: companyId,\n\t\t\t\t\t\temail: member.email,\n\t\t\t\t\t\tfirst_name: member.firstName,\n\t\t\t\t\t\tlast_name: member.lastName,\n\t\t\t\t\t\trole: member.role,\n\t\t\t\t\t\tphone: member.phone || null,\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t\tinvited_by: user.id,\n\t\t\t\t\t\texpires_at: expiresAt.toISOString(),\n\t\t\t\t\t});\n\n\t\t\t\tif (invitationError) {\n\t\t\t\t\tfailedCount++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Send invitation email\n\t\t\t\tconst magicLink = `${siteUrl}/accept-invitation?token=${token}`;\n\n\t\t\t\tconst emailResult = await sendPlatformEmail({\n\t\t\t\t\tto: member.email,\n\t\t\t\t\tsubject: `You've been invited to join ${company.name} on Thorbis`,\n\t\t\t\t\ttemplate: TeamInvitationEmail({\n\t\t\t\t\t\tinviteeName: `${member.firstName} ${member.lastName}`,\n\t\t\t\t\t\tinviterName: inviter?.name || inviter?.email || \"Your colleague\",\n\t\t\t\t\t\tcompanyName: company.name,\n\t\t\t\t\t\trole: member.role,\n\t\t\t\t\t\tmagicLink,\n\t\t\t\t\t\texpiresInDays: INVITATION_EXPIRY_DAYS,\n\t\t\t\t\t}),\n\t\t\t\t\ttemplateType: EmailTemplate.TEAM_INVITATION,\n\t\t\t\t});\n\n\t\t\t\tif (emailResult.success) {\n\t\t\t\t\tsentCount++;\n\t\t\t\t} else {\n\t\t\t\t\tfailedCount++;\n\t\t\t\t}\n\t\t\t} catch (_error) {\n\t\t\t\tfailedCount++;\n\t\t\t}\n\t\t}\n\n\t\treturn { sent: sentCount, failed: failedCount };\n\t});\n}\n\n/**\n * Send a single team invitation (for adding members after onboarding)\n */\nexport async function sendSingleTeamInvitation(\n\tformData: FormData,\n): Promise<ActionResult<string>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\t// Get current user\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\t// Get user's company\n\t\tconst { data: teamMember } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\"company_id, companies!inner(name)\")\n\t\t\t.eq(\"user_id\", user.id)\n\t\t\t.eq(\"status\", \"active\")\n\t\t\t.single();\n\n\t\tif (!teamMember?.company_id) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"You must be part of a company to invite team members\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\tconst email = formData.get(\"email\") as string;\n\t\tconst firstName = formData.get(\"firstName\") as string;\n\t\tconst lastName = formData.get(\"lastName\") as string;\n\t\tconst role = formData.get(\"role\") as string;\n\t\tconst phone = formData.get(\"phone\") as string | null;\n\n\t\t// Validate inputs\n\t\tconst schema = z.object({\n\t\t\temail: z.string().email(),\n\t\t\tfirstName: z.string().min(1),\n\t\t\tlastName: z.string().min(1),\n\t\t\trole: z.enum([\"owner\", \"admin\", \"manager\", \"technician\", \"dispatcher\"]),\n\t\t});\n\n\t\tconst validated = schema.parse({ email, firstName, lastName, role });\n\n\t\t// Generate invitation token\n\t\tconst token = generateInvitationToken({\n\t\t\temail: validated.email,\n\t\t\tcompanyId: teamMember.company_id,\n\t\t\trole: validated.role,\n\t\t});\n\n\t\tconst expiresAt = new Date();\n\t\texpiresAt.setDate(expiresAt.getDate() + INVITATION_EXPIRY_DAYS);\n\n\t\t// Store invitation\n\t\tconst { error: invitationError } = await supabase\n\t\t\t.from(\"team_invitations\")\n\t\t\t.insert({\n\t\t\t\tcompany_id: teamMember.company_id,\n\t\t\t\temail: validated.email,\n\t\t\t\tfirst_name: validated.firstName,\n\t\t\t\tlast_name: validated.lastName,\n\t\t\t\trole: validated.role,\n\t\t\t\tphone: phone || null,\n\t\t\t\ttoken,\n\t\t\t\tinvited_by: user.id,\n\t\t\t\texpires_at: expiresAt.toISOString(),\n\t\t\t});\n\n\t\tif (invitationError) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"send invitation\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\t// Send invitation email\n\t\tconst siteUrl = requireSiteUrl();\n\t\tconst magicLink = `${siteUrl}/accept-invitation?token=${token}`;\n\n\t\tconst companies = Array.isArray(teamMember.companies)\n\t\t\t? teamMember.companies[0]\n\t\t\t: teamMember.companies;\n\n\t\tconst { data: inviter } = await supabase\n\t\t\t.from(\"profiles\")\n\t\t\t.select(\"full_name, email\")\n\t\t\t.eq(\"id\", user.id)\n\t\t\t.single();\n\n\t\tconst emailResult = await sendPlatformEmail({\n\t\t\tto: validated.email,\n\t\t\tsubject: `You've been invited to join ${companies?.name} on Thorbis`,\n\t\t\ttemplate: TeamInvitationEmail({\n\t\t\t\tinviteeName: `${validated.firstName} ${validated.lastName}`,\n\t\t\t\tinviterName: inviter?.name || inviter?.email || \"Your colleague\",\n\t\t\t\tcompanyName: companies?.name || \"the team\",\n\t\t\t\trole: validated.role,\n\t\t\t\tmagicLink,\n\t\t\t\texpiresInDays: INVITATION_EXPIRY_DAYS,\n\t\t\t}),\n\t\t\ttemplateType: \"team-invitation\",\n\t\t});\n\n\t\tif (!emailResult.success) {\n\t\t\t// Don't fail the whole operation if email fails\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/settings/team\");\n\t\treturn \"Invitation sent successfully\";\n\t});\n}\n\n/**\n * Cancel/revoke an invitation\n */\nasync function cancelTeamInvitation(\n\tinvitationId: string,\n): Promise<ActionResult<void>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\t// Delete invitation (RLS will ensure user has permission)\n\t\tconst { error } = await supabase\n\t\t\t.from(\"team_invitations\")\n\t\t\t.delete()\n\t\t\t.eq(\"id\", invitationId);\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"cancel invitation\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/settings/team\");\n\t});\n}\n"],"names":[],"mappings":"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"}