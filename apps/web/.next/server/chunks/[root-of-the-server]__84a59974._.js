module.exports=[254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},946353,e=>{"use strict";var t=e.i(254799);class r{config;apiUrl;constructor(e){this.config=e,this.apiUrl=e.liveMode?"https://api.adyen.com":"https://api-adyen-test.adyen.com"}getSupportedChannels(){return["online","card_present","tap_to_pay","ach"]}async processPayment(e){try{let t={amount:{value:e.amount,currency:e.currency||"USD"},merchantAccount:this.config.merchantAccount,reference:e.invoiceId||`invoice-${Date.now()}`,paymentMethod:e.paymentMethodId?{type:"scheme",storedPaymentMethodId:e.paymentMethodId}:void 0,returnUrl:`http://localhost:3000/dashboard/work/invoices/${e.invoiceId}`,metadata:{company_id:this.config.companyId,customer_id:e.customerId,invoice_id:e.invoiceId,channel:e.channel,...e.metadata}},r=await fetch(`${this.apiUrl}/v68/payments`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.config.apiKey},body:JSON.stringify(t)}),a=await r.json();if(!r.ok)return{success:!1,status:"failed",error:a.message||"Payment processing failed",failureCode:a.errorCode,failureMessage:a.message};if("Authorised"===a.resultCode||"Received"===a.resultCode)return{success:!0,transactionId:a.pspReference,processorTransactionId:a.pspReference,status:"succeeded",processorMetadata:a};if("Pending"===a.resultCode||"RedirectShopper"===a.resultCode)return{success:!0,transactionId:a.pspReference,processorTransactionId:a.pspReference,status:"requires_action",clientSecret:a.action?.paymentData||a.pspReference,processorMetadata:a};return{success:!1,status:"failed",error:a.refusalReason||"Payment was refused",failureCode:a.refusalReasonCode,failureMessage:a.refusalReason,processorMetadata:a}}catch(e){return{success:!1,status:"failed",error:e instanceof Error?e.message:"Payment processing failed"}}}async refundPayment(e){try{let t={merchantAccount:this.config.merchantAccount,originalReference:e.transactionId,amount:e.amount?{value:e.amount,currency:"USD"}:void 0,reference:`refund-${Date.now()}`,metadata:{reason:e.reason,...e.metadata}},r=await fetch(`${this.apiUrl}/v68/payments/${e.transactionId}/refunds`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.config.apiKey},body:JSON.stringify(t)}),a=await r.json();if(!r.ok)return{success:!1,status:"failed",error:a.message||"Refund failed"};return{success:!0,refundId:a.pspReference,processorRefundId:a.pspReference,status:"received"===a.status?"succeeded":"processing"}}catch(e){return{success:!1,status:"failed",error:e instanceof Error?e.message:"Refund failed"}}}async getPaymentStatus(e){let t=await fetch(`${this.apiUrl}/v68/payments/${e}`,{method:"GET",headers:{"X-API-Key":this.config.apiKey}}),r=await t.json();if(!t.ok)throw Error(r.message||"Failed to get payment status");return{status:r.status||"unknown",amount:r.amount?.value||0,metadata:r}}verifyWebhook(e,r){if(!this.config.webhookHmacKey)return console.warn("[Adyen] No webhook HMAC key configured - skipping verification"),!1;try{let a=JSON.parse(e).notificationItems||[];if(0===a.length)return console.error("[Adyen] No notification items in webhook"),!1;for(let e of a){let a=e.NotificationRequestItem,n=[a.pspReference||"",a.originalReference||"",a.merchantAccountCode||"",a.merchantReference||"",a.amount?.value?.toString()||"",a.amount?.currency||"",a.eventCode||"",a.success||""].join(":"),s=Buffer.from(this.config.webhookHmacKey,"hex"),o=t.default.createHmac("sha256",s).update(n,"utf8").digest("base64"),c=a.additionalData?.hmacSignature||r;if(!c||!t.default.timingSafeEqual(Buffer.from(o),Buffer.from(c)))return console.error("[Adyen] HMAC signature verification failed"),!1}return!0}catch(e){return console.error("[Adyen] Webhook verification error:",e),!1}}}e.s(["AdyenProcessor",()=>r])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__84a59974._.js.map