module.exports=[858785,e=>{"use strict";var t=e.i(755535),a=e.i(377233),i=e.i(490003),n=e.i(492991),l=e.i(241970),o=e.i(357699),r=e.i(212454),d=e.i(48717),u=e.i(798301),s=e.i(986366),p=e.i(983537),c=e.i(147475),_=e.i(561930),m=e.i(803747),b=e.i(368557),z=e.i(42037),g=e.i(193695);e.i(432036);var y=e.i(573881),h=e.i(297676);e.i(16106);var f=e.i(985647);e.i(464524);var v=e.i(177585),j=e.i(511368),R=e.i(443608);let w=R.z.object({job_id:R.z.string().uuid(),company_id:R.z.string().uuid(),total_amount:R.z.number().int().default(0),paid_amount:R.z.number().int().default(0),deposit_amount:R.z.number().int().default(0),deposit_paid_at:R.z.date().optional().nullable(),payment_terms:R.z.string().max(200).optional().nullable(),payment_due_date:R.z.date().optional().nullable(),invoice_generated_at:R.z.date().optional().nullable()});w.partial().omit({job_id:!0,company_id:!0});let x=w.extend({id:R.z.string().uuid(),created_at:R.z.date(),updated_at:R.z.date()}),E=R.z.object({job_id:R.z.string().uuid(),company_id:R.z.string().uuid(),template_id:R.z.string().uuid().optional().nullable(),workflow_stage:R.z.string().max(100).optional().nullable(),workflow_completed_stages:R.z.array(R.z.any()).default([]),workflow_stage_changed_at:R.z.date().optional().nullable()});E.partial().omit({job_id:!0,company_id:!0});let q=E.extend({id:R.z.string().uuid(),created_at:R.z.date(),updated_at:R.z.date()}),C=R.z.object({job_id:R.z.string().uuid(),company_id:R.z.string().uuid(),technician_clock_in:R.z.date().optional().nullable(),technician_clock_out:R.z.date().optional().nullable(),actual_start:R.z.date().optional().nullable(),actual_end:R.z.date().optional().nullable(),total_labor_hours:R.z.number().default(0),estimated_labor_hours:R.z.number().optional().nullable(),break_time_minutes:R.z.number().int().default(0)});C.partial().omit({job_id:!0,company_id:!0});let A=C.extend({id:R.z.string().uuid(),created_at:R.z.date(),updated_at:R.z.date()}),N=R.z.object({job_id:R.z.string().uuid(),company_id:R.z.string().uuid(),customer_signature:R.z.any().optional().nullable(),customer_approval_status:R.z.enum(["pending","approved","rejected"]).default("pending"),customer_approval_timestamp:R.z.date().optional().nullable(),customer_notes:R.z.string().optional().nullable()});N.partial().omit({job_id:!0,company_id:!0});let T=N.extend({id:R.z.string().uuid(),created_at:R.z.date(),updated_at:R.z.date()}),k=R.z.object({job_id:R.z.string().uuid(),company_id:R.z.string().uuid(),primary_equipment_id:R.z.string().uuid().optional().nullable(),equipment_service_history:R.z.array(R.z.any()).default([]),equipment_serviced:R.z.array(R.z.any()).default([]),job_warranty_info:R.z.any().optional().nullable(),job_service_agreement_id:R.z.string().uuid().optional().nullable(),job_recurrence_id:R.z.string().uuid().optional().nullable()});k.partial().omit({job_id:!0,company_id:!0});let P=k.extend({id:R.z.string().uuid(),created_at:R.z.date(),updated_at:R.z.date()}),S=R.z.object({job_id:R.z.string().uuid(),company_id:R.z.string().uuid(),dispatch_zone:R.z.string().max(100).optional().nullable(),travel_time_minutes:R.z.number().int().optional().nullable(),route_order:R.z.number().int().optional().nullable(),previous_job_id:R.z.string().uuid().optional().nullable(),next_job_id:R.z.string().uuid().optional().nullable()});S.partial().omit({job_id:!0,company_id:!0});let O=S.extend({id:R.z.string().uuid(),created_at:R.z.date(),updated_at:R.z.date()}),M=R.z.object({job_id:R.z.string().uuid(),company_id:R.z.string().uuid(),inspection_required:R.z.boolean().default(!1),inspection_completed_at:R.z.date().optional().nullable(),quality_score:R.z.number().int().min(0).max(100).optional().nullable(),customer_satisfaction_rating:R.z.number().int().min(1).max(5).optional().nullable(),quality_notes:R.z.string().optional().nullable(),internal_priority_score:R.z.number().int().optional().nullable()});M.partial().omit({job_id:!0,company_id:!0});let H=M.extend({id:R.z.string().uuid(),created_at:R.z.date(),updated_at:R.z.date()}),I=R.z.object({job_id:R.z.string().uuid(),company_id:R.z.string().uuid(),requires_permit:R.z.boolean().default(!1),permit_obtained_at:R.z.date().optional().nullable(),hazards_identified:R.z.string().optional().nullable(),safety_notes:R.z.string().optional().nullable()});I.partial().omit({job_id:!0,company_id:!0});let U=I.extend({id:R.z.string().uuid(),created_at:R.z.date(),updated_at:R.z.date()}),D=R.z.object({job_id:R.z.string().uuid(),company_id:R.z.string().uuid(),ai_categories:R.z.any().optional().nullable(),ai_equipment:R.z.any().optional().nullable(),ai_service_type:R.z.string().optional().nullable(),ai_priority_score:R.z.number().int().optional().nullable(),ai_tags:R.z.any().optional().nullable(),ai_processed_at:R.z.date().optional().nullable()});D.partial().omit({job_id:!0,company_id:!0});let $=D.extend({id:R.z.string().uuid(),created_at:R.z.date(),updated_at:R.z.date()}),F=R.z.object({job_id:R.z.string().uuid(),company_id:R.z.string().uuid(),primary_customer_id:R.z.string().uuid().optional().nullable(),primary_property_id:R.z.string().uuid().optional().nullable(),requires_multiple_properties:R.z.boolean().default(!1),requires_multiple_customers:R.z.boolean().default(!1),deleted_by:R.z.string().uuid().optional().nullable(),permanent_delete_scheduled_at:R.z.date().optional().nullable()});F.partial().omit({job_id:!0,company_id:!0});let K=F.extend({id:R.z.string().uuid(),created_at:R.z.date(),updated_at:R.z.date()});async function B(e,{params:t}){try{var a;let e,{id:i}=await t;if(!await (0,v.getCurrentUser)())return h.NextResponse.json({error:"Not authenticated"},{status:401});let n=await (0,j.createClient)();if(!n)return h.NextResponse.json({error:"Database not configured"},{status:500});let l=await (0,f.getActiveCompanyId)();if(!l)return h.NextResponse.json({error:"No active company"},{status:403});let{data:o,error:r}=await n.from("jobs").select((a=["financial","timeTracking"],e={financial:"financial:job_financial(*)",workflow:"workflow:job_workflow(*)",timeTracking:"timeTracking:job_time_tracking(*)",customerApproval:"customerApproval:job_customer_approval(*)",equipmentService:"equipmentService:job_equipment_service(*)",dispatch:"dispatch:job_dispatch(*)",quality:"quality:job_quality(*)",safety:"safety:job_safety(*)",aiEnrichment:"aiEnrichment:job_ai_enrichment(*)",multiEntity:"multiEntity:job_multi_entity(*)"},["*",...a.map(t=>e[t])].join(", "))).eq("id",i).eq("company_id",l).is("deleted_at",null).single();if(r||!o)return h.NextResponse.json({error:"Job not found"},{status:404});let[{data:d},{data:u},{data:s},{data:p},{data:c},{data:_},{data:m}]=await Promise.all([n.from("customers").select("id, first_name, last_name, display_name, phone, email, tags, credit_limit, outstanding_balance").eq("id",o.customer_id).single(),n.from("properties").select("id, name, address, city, state, zip_code, property_type, square_footage, year_built, lat, lon, metadata").eq("id",o.property_id).single(),n.from("time_entries").select(`
          *,
          user:users!user_id(id, name, email, avatar)
        `).eq("job_id",i).is("deleted_at",null),n.from("job_team_assignments").select("*, team_member:team_members!team_member_id(*, users!user_id(*))").eq("job_id",i),n.from("invoices").select("*").eq("job_id",i).is("deleted_at",null),n.from("payments").select("*").eq("job_id",i).is("deleted_at",null),n.from("job_materials").select("*").eq("job_id",i).is("deleted_at",null)]),b=s?.reduce((e,t)=>e+(t.total_hours||0),0)||0,z=(c||[]).reduce((e,t)=>{let a=(t.line_items||[]).reduce((e,t)=>e+t.quantity*(t.unit_price||t.price||0),0);return e+a},0),g=o.financial?.total_amount||0,y=o.financial?.paid_amount||0,R=o.timeTracking?.estimated_labor_hours||0,w=g-z,x={quoted:10,scheduled:25,in_progress:50,completed:100,cancelled:0,on_hold:40}[o.status]||0;return h.NextResponse.json({job:o,customer:d||null,property:u||null,metrics:{totalAmount:g,paidAmount:y,totalLaborHours:b,estimatedLaborHours:R,materialsCost:z,profitMargin:g>0?w/g*100:0,completionPercentage:x},timeEntries:s||[],teamAssignments:p||[],invoices:c||[],payments:_||[],jobMaterials:m||[]})}catch(e){return h.NextResponse.json({error:"Internal server error"},{status:500})}}R.z.object({id:R.z.string().uuid(),company_id:R.z.string().uuid(),job_number:R.z.string(),title:R.z.string(),description:R.z.string().nullable(),status:R.z.enum(["quoted","scheduled","in_progress","on_hold","completed","cancelled","archived"]),priority:R.z.enum(["low","medium","high","urgent"]),job_type:R.z.string().nullable(),service_type:R.z.string().nullable(),property_id:R.z.string().uuid().nullable(),customer_id:R.z.string().uuid().nullable(),assigned_to:R.z.string().uuid().nullable(),scheduled_start:R.z.date().nullable(),scheduled_end:R.z.date().nullable(),notes:R.z.string().nullable(),metadata:R.z.any().nullable(),created_at:R.z.date(),updated_at:R.z.date(),deleted_at:R.z.date().nullable(),archived_at:R.z.date().nullable(),search_vector:R.z.any().nullable(),financial:x.optional().nullable(),workflow:q.optional().nullable(),timeTracking:A.optional().nullable(),customerApproval:T.optional().nullable(),equipmentService:P.optional().nullable(),dispatch:O.optional().nullable(),quality:H.optional().nullable(),safety:U.optional().nullable(),aiEnrichment:$.optional().nullable(),multiEntity:K.optional().nullable()}),e.s(["GET",()=>B],826202);var L=e.i(826202);let G=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/jobs/[id]/toolbar-data/route",pathname:"/api/jobs/[id]/toolbar-data",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/jobs/[id]/toolbar-data/route.ts",nextConfigOutput:"",userland:L}),{workAsyncStorage:V,workUnitAsyncStorage:X,serverHooks:W}=G;function J(){return(0,i.patchFetch)({workAsyncStorage:V,workUnitAsyncStorage:X})}async function Z(e,t,i){G.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let h="/api/jobs/[id]/toolbar-data/route";h=h.replace(/\/index$/,"")||"/";let f=await G.prepare(e,t,{srcPage:h,multiZoneDraftMode:!1});if(!f)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:v,params:j,nextConfig:R,parsedUrl:w,isDraftMode:x,prerenderManifest:E,routerServerContext:q,isOnDemandRevalidate:C,revalidateOnlyGenerated:A,resolvedPathname:N,clientReferenceManifest:T,serverActionsManifest:k}=f,P=(0,d.normalizeAppPath)(h),S=!!(E.dynamicRoutes[P]||E.routes[N]),O=async()=>((null==q?void 0:q.render404)?await q.render404(e,t,w,!1):t.end("This page could not be found"),null);if(S&&!x){let e=!!E.routes[N],t=E.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(R.experimental.adapterPath)return await O();throw new g.NoFallbackError}}let M=null;!S||G.isDev||x||(M="/index"===(M=N)?"/":M);let H=!0===G.isDev||!S,I=S&&!H;k&&T&&(0,o.setReferenceManifestsSingleton)({page:h,clientReferenceManifest:T,serverActionsManifest:k,serverModuleMap:(0,r.createServerModuleMap)({serverActionsManifest:k})});let U=e.method||"GET",D=(0,l.getTracer)(),$=D.getActiveScopeSpan(),F={params:j,prerenderManifest:E,renderOpts:{experimental:{authInterrupts:!!R.experimental.authInterrupts},cacheComponents:!!R.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:R.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,i)=>G.onRequestError(e,t,i,q)},sharedContext:{buildId:v}},K=new u.NodeNextRequest(e),B=new u.NodeNextResponse(t),L=s.NextRequestAdapter.fromNodeNextRequest(K,(0,s.signalFromNodeResponse)(t));try{let o=async e=>G.handle(L,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=D.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=a.get("next.route");if(i){let t=`${U} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${h}`)}),r=!!(0,n.getRequestMeta)(e,"minimalMode"),d=async n=>{var l,d;let u=async({previousCacheEntry:a})=>{try{if(!r&&C&&A&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let l=await o(n);e.fetchMetrics=F.renderOpts.fetchMetrics;let d=F.renderOpts.pendingWaitUntil;d&&i.waitUntil&&(i.waitUntil(d),d=void 0);let u=F.renderOpts.collectedTags;if(!S)return await (0,_.sendResponse)(K,B,l,F.renderOpts.pendingWaitUntil),null;{let e=await l.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(l.headers);u&&(t[z.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=z.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,i=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=z.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:l.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:i}}}}catch(t){throw(null==a?void 0:a.isStale)&&await G.onRequestError(e,t,{routerKind:"App Router",routePath:h,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:I,isOnDemandRevalidate:C})},q),t}},s=await G.handleResponse({req:e,nextConfig:R,cacheKey:M,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:E,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:A,responseGenerator:u,waitUntil:i.waitUntil,isMinimalMode:r});if(!S)return null;if((null==s||null==(l=s.value)?void 0:l.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==s||null==(d=s.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});r||t.setHeader("x-nextjs-cache",C?"REVALIDATED":s.isMiss?"MISS":s.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,m.fromNodeOutgoingHttpHeaders)(s.value.headers);return r&&S||p.delete(z.NEXT_CACHE_TAGS_HEADER),!s.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,b.getCacheControlHeader)(s.cacheControl)),await (0,_.sendResponse)(K,B,new Response(s.value.body,{headers:p,status:s.value.status||200})),null};$?await d($):await D.withPropagatedContext(e.headers,()=>D.trace(p.BaseServerSpan.handleRequest,{spanName:`${U} ${h}`,kind:l.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},d))}catch(t){if(t instanceof g.NoFallbackError||await G.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:I,isOnDemandRevalidate:C})}),S)throw t;return await (0,_.sendResponse)(K,B,new Response(null,{status:500})),null}}e.s(["handler",()=>Z,"patchFetch",()=>J,"routeModule",()=>G,"serverHooks",()=>W,"workAsyncStorage",()=>V,"workUnitAsyncStorage",()=>X],858785)}];

//# sourceMappingURL=3c0ae_next_dist_esm_build_templates_app-route_a45811b1.js.map