module.exports=[549213,e=>{"use strict";var t=e.i(755535),r=e.i(377233),a=e.i(490003),o=e.i(492991),n=e.i(241970),s=e.i(357699),i=e.i(212454),l=e.i(48717),d=e.i(798301),c=e.i(986366),u=e.i(983537),m=e.i(147475),h=e.i(561930),p=e.i(803747),f=e.i(368557),g=e.i(42037),w=e.i(193695);e.i(432036);var E=e.i(573881),v=e.i(297676),y=e.i(350318);e.i(16106);var R=e.i(985647);let F=new class{nfhlBaseUrl="https://hazards.fema.gov/gis/nfhl/rest/services";async getFloodZoneByCoordinates(e,t){try{let r=new URL(`${this.nfhlBaseUrl}/public/NFHL/MapServer/28/query`);r.searchParams.set("geometry",`${t},${e}`),r.searchParams.set("geometryType","esriGeometryPoint"),r.searchParams.set("inSR","4326"),r.searchParams.set("spatialRel","esriSpatialRelIntersects"),r.searchParams.set("outFields","*"),r.searchParams.set("returnGeometry","false"),r.searchParams.set("f","json");let a=await fetch(r.toString());if(!a.ok)throw Error(`FEMA API error: ${a.status}`);let o=await a.json();if(!o.features||0===o.features.length)return null;let n=o.features[0].attributes,s=n.FLD_ZONE||n.ZONE_SUBTY||"X";return this.parseFloodZone(s,n.STATIC_BFE)}catch(e){throw console.error("Error fetching flood zone:",e),e}}async getFloodZoneByAddress(e){let t=await this.geocodeAddress(e);return t?this.getFloodZoneByCoordinates(t.lat,t.lng):null}async getFloodMapPanel(e,t){try{let r=new URL(`${this.nfhlBaseUrl}/public/NFHL/MapServer/3/query`);r.searchParams.set("geometry",`${t},${e}`),r.searchParams.set("geometryType","esriGeometryPoint"),r.searchParams.set("inSR","4326"),r.searchParams.set("spatialRel","esriSpatialRelIntersects"),r.searchParams.set("outFields","FIRM_PAN,PANEL,SUFFIX,EFF_DATE,PCOMM,CO_NAME,ST_NAME"),r.searchParams.set("returnGeometry","false"),r.searchParams.set("f","json");let a=await fetch(r.toString());if(!a.ok)throw Error(`FEMA API error: ${a.status}`);let o=await a.json();if(!o.features||0===o.features.length)return null;let n=o.features[0].attributes;return{panelNumber:n.FIRM_PAN||n.PANEL,suffix:n.SUFFIX||"",effectiveDate:this.formatDate(n.EFF_DATE),communityName:n.PCOMM||"",countyName:n.CO_NAME||"",stateName:n.ST_NAME||""}}catch(e){throw console.error("Error fetching flood map panel:",e),e}}async getCommunityInfo(e,t){try{let r=new URL(`${this.nfhlBaseUrl}/public/NFHL/MapServer/14/query`);r.searchParams.set("geometry",`${t},${e}`),r.searchParams.set("geometryType","esriGeometryPoint"),r.searchParams.set("inSR","4326"),r.searchParams.set("spatialRel","esriSpatialRelIntersects"),r.searchParams.set("outFields","COMM_NO,COMM_NAME,CID,CO_NAME,ST_NAME"),r.searchParams.set("returnGeometry","false"),r.searchParams.set("f","json");let a=await fetch(r.toString());if(!a.ok)throw Error(`FEMA API error: ${a.status}`);let o=await a.json();if(!o.features||0===o.features.length)return null;let n=o.features[0].attributes;return{communityId:n.CID||n.COMM_NO,communityName:n.COMM_NAME||"",countyName:n.CO_NAME||"",stateName:n.ST_NAME||"",participatingNFIP:!0}}catch(e){throw console.error("Error fetching community info:",e),e}}async getBaseFloodElevation(e,t){try{let r=new URL(`${this.nfhlBaseUrl}/public/NFHL/MapServer/20/query`);r.searchParams.set("geometry",`${t},${e}`),r.searchParams.set("geometryType","esriGeometryPoint"),r.searchParams.set("inSR","4326"),r.searchParams.set("spatialRel","esriSpatialRelIntersects"),r.searchParams.set("distance","100"),r.searchParams.set("units","esriFeet"),r.searchParams.set("outFields","ELEV,BFE_LN_TYP"),r.searchParams.set("returnGeometry","false"),r.searchParams.set("f","json");let a=await fetch(r.toString());if(!a.ok)throw Error(`FEMA API error: ${a.status}`);let o=await a.json();if(!o.features||0===o.features.length)return null;return o.features[0].attributes.ELEV||null}catch(e){return console.error("Error fetching BFE:",e),null}}async getFloodRiskReport(e){let t=await this.geocodeAddress(e);if(!t)return null;let[r,a,o,n]=await Promise.all([this.getFloodZoneByCoordinates(t.lat,t.lng),this.getFloodMapPanel(t.lat,t.lng),this.getCommunityInfo(t.lat,t.lng),this.getBaseFloodElevation(t.lat,t.lng)]);return r?(null!==n&&(r.baseFloodElevation=n),{address:e,coordinates:t,floodZone:r,mapPanel:a||void 0,community:o||void 0,riskAssessment:this.generateRiskAssessment(r)}):null}parseFloodZone(e,t){let r=e;e.match(/^A\d+$/)?r="AE":e.match(/^V\d+$/)?r="VE":(e.startsWith("X")||"B"===e||"C"===e)&&(r="X");let a={A:{name:"Zone A - High Risk",desc:"Areas with 1% annual chance of flooding and 26% chance over 30-year mortgage",risk:"high",insurance:!0},AE:{name:"Zone AE - High Risk (BFE Determined)",desc:"High risk area with base flood elevations determined",risk:"high",insurance:!0},AH:{name:"Zone AH - High Risk Shallow Flooding",desc:"Areas with 1% annual chance of shallow flooding (1-3 feet)",risk:"high",insurance:!0},AO:{name:"Zone AO - High Risk Sheet Flow",desc:"Areas with 1% annual chance of shallow flooding with sheet flow",risk:"high",insurance:!0},AR:{name:"Zone AR - High Risk Restoration",desc:"Areas where flood protection system is being restored",risk:"high",insurance:!0},A99:{name:"Zone A99 - High Risk (Federal Levee)",desc:"Areas with 1% annual chance protected by federal levee system under construction",risk:"high",insurance:!0},V:{name:"Zone V - Coastal High Risk",desc:"Coastal areas with 1% annual chance of flooding and additional wave action hazard",risk:"high",insurance:!0},VE:{name:"Zone VE - Coastal High Risk (BFE Determined)",desc:"Coastal high risk area with base flood elevations determined",risk:"high",insurance:!0},X:{name:"Zone X - Moderate to Low Risk",desc:"Areas of moderate or minimal flood risk, outside 1% annual chance floodplain",risk:"low",insurance:!1},D:{name:"Zone D - Undetermined",desc:"Areas where flood hazard has not been determined",risk:"undetermined",insurance:!1},"OPEN WATER":{name:"Open Water",desc:"Lake, river, or other body of water",risk:"high",insurance:!1}}[r]||{name:`Zone ${e}`,desc:"Flood zone information",risk:"undetermined",insurance:!1};return{zoneCode:e,zoneName:a.name,riskLevel:a.risk,description:a.desc,insuranceRequired:a.insurance,staticBFE:t}}generateRiskAssessment(e){return{overallRisk:e.riskLevel,annualFloodProbability:({high:"1% annual chance (1 in 100 year flood), 26% chance over 30-year mortgage",moderate:"0.2% to 1% annual chance (100 to 500 year flood)",low:"Less than 0.2% annual chance (greater than 500 year flood)",undetermined:"Unknown - flood study not completed"})[e.riskLevel],insuranceRecommendation:({high:"Flood insurance is REQUIRED if you have a federally-backed mortgage. Standard homeowners insurance does NOT cover flood damage.",moderate:"Flood insurance is recommended. Properties in moderate risk zones account for over 20% of flood claims.",low:"Flood insurance is optional but recommended. About 25% of flood claims come from low-risk areas.",undetermined:"Strongly recommend flood insurance until flood risk can be determined."})[e.riskLevel],mitigationSuggestions:({high:["Elevate HVAC equipment above base flood elevation","Install flood vents in foundation","Use flood-resistant building materials below BFE","Secure fuel tanks and water heaters","Install backflow valves on sewer lines","Consider flood barriers or shields for openings"],moderate:["Consider elevating critical equipment","Ensure proper drainage around foundation","Keep valuable items above potential flood level","Consider flood insurance despite not being required"],low:["Maintain proper drainage","Be aware that low risk doesn't mean no risk","Consider flood insurance for peace of mind"],undetermined:["Conduct detailed flood study","Consult local floodplain administrator","Consider flood insurance regardless of determination"]})[e.riskLevel]}}async geocodeAddress(e){try{let t=new URL("https://geocoding.geo.census.gov/geocoder/locations/onelineaddress");t.searchParams.set("address",e),t.searchParams.set("benchmark","Public_AR_Current"),t.searchParams.set("format","json");let r=await fetch(t.toString());if(!r.ok)throw Error(`Geocoding error: ${r.status}`);let a=await r.json(),o=a.result?.addressMatches?.[0];if(!o)return null;return{lat:o.coordinates.y,lng:o.coordinates.x}}catch(e){return console.error("Geocoding error:",e),null}}formatDate(e){return e?new Date(e).toISOString().split("T")[0]:"Unknown"}async getPropertyFloodData(e){let t=await this.geocodeAddress(e);if(!t)return null;let[r,a,o]=await Promise.all([this.getFloodZoneByCoordinates(t.lat,t.lng),this.getFloodMapPanel(t.lat,t.lng),this.getCommunityInfo(t.lat,t.lng)]);return r?{address:e,lat:t.lat,lng:t.lng,floodZone:r.zoneCode,riskLevel:r.riskLevel,insuranceRequired:r.insuranceRequired,baseFloodElevation:r.baseFloodElevation,communityParticipatesNFIP:o?.participatingNFIP??!1,panelNumber:a?.panelNumber,effectiveDate:a?.effectiveDate}:null}async checkEquipmentPlacementCompliance(e,t){let r=await this.getPropertyFloodData(e);if(!r)return{compliant:!0,recommendation:"Unable to determine flood zone. Standard placement should be acceptable.",floodZone:"Unknown"};if("low"===r.riskLevel||"undetermined"===r.riskLevel)return{compliant:!0,recommendation:"Property is in low/moderate flood risk area. Standard equipment placement is acceptable.",floodZone:r.floodZone};let a=r.baseFloodElevation;return a&&t<a?{compliant:!1,recommendation:`Equipment should be elevated to at least ${a} feet above ground level (Base Flood Elevation). Consider elevated equipment stands or rooftop installation.`,floodZone:r.floodZone,requiredElevation:a}:{compliant:!0,recommendation:`Equipment placement meets flood zone requirements. Zone: ${r.floodZone}`,floodZone:r.floodZone,requiredElevation:a||void 0}}async getEstimateFloodConsiderations(e){let t=await this.getPropertyFloodData(e);if(!t||"low"===t.riskLevel)return{hasFloodRisk:!1,zone:t?.floodZone||"X",considerations:[],additionalCosts:[]};let r=[],a=[];return"high"===t.riskLevel&&(r.push(`Property is in high-risk flood zone ${t.floodZone}`),r.push("Equipment elevation may be required by local code"),r.push("Flood-resistant materials recommended for ground-level components"),a.push({item:"Equipment elevation stand",reason:"Required to meet flood zone regulations"}),a.push({item:"Flood-resistant electrical connections",reason:"Prevents flood damage to system"}),t.baseFloodElevation&&r.push(`Base Flood Elevation: ${t.baseFloodElevation} feet`)),{hasFloodRisk:!0,zone:t.floodZone,considerations:r,additionalCosts:a}}async checkFloodInsuranceDiscount(e){let t=await this.geocodeAddress(e);if(!t)return{discountAvailable:!1};let r=await this.getCommunityInfo(t.lat,t.lng);if(!r||!r.crsClass)return{discountAvailable:!1,communityName:r?.communityName};let a={1:45,2:40,3:35,4:30,5:25,6:20,7:15,8:10,9:5,10:0}[r.crsClass]||0;return{discountAvailable:a>0,discountPercent:a,crsClass:r.crsClass,communityName:r.communityName}}};var P=e.i(511368);async function A(e){try{let t=e.nextUrl.searchParams,r=t.get("address"),a=t.get("lat"),o=t.get("lng"),n=t.get("action")||"zone",s=await (0,P.createClient)();if(!s)return v.NextResponse.json({error:"Database connection failed"},{status:500});let{data:{user:i}}=await s.auth.getUser();if(!i)return v.NextResponse.json({error:"Unauthorized"},{status:401});let l=await (0,R.getActiveCompanyId)();if(!l)return v.NextResponse.json({error:"No active company selected"},{status:401});let d={zone:"flood_zone",panel:"map_panel",community:"community_info",bfe:"base_flood_elevation",report:"flood_report","property-data":"property_data","equipment-compliance":"equipment_compliance","estimate-considerations":"estimate_considerations","insurance-discount":"insurance_discount"}[n];if(!d)return v.NextResponse.json({error:"Invalid action"},{status:400});let c=await (0,y.withUsageTracking)(l,"fema_flood",d,async()=>{switch(n){case"zone":if(a&&o)return await F.getFloodZoneByCoordinates(parseFloat(a),parseFloat(o));if(r)return await F.getFloodZoneByAddress(r);throw Error("lat/lng or address required");case"panel":if(!(a&&o))throw Error("lat and lng required");return await F.getFloodMapPanel(parseFloat(a),parseFloat(o));case"community":if(!(a&&o))throw Error("lat and lng required");return await F.getCommunityInfo(parseFloat(a),parseFloat(o));case"bfe":if(!(a&&o))throw Error("lat and lng required");return await F.getBaseFloodElevation(parseFloat(a),parseFloat(o));case"report":if(!r)throw Error("address required");return await F.getFloodRiskReport(r);case"property-data":if(!r)throw Error("address required");return await F.getPropertyFloodData(r);case"equipment-compliance":{if(!r)throw Error("address required");let e=t.get("elevation");if(!e)throw Error("elevation required");return await F.checkEquipmentPlacementCompliance(r,parseFloat(e))}case"estimate-considerations":if(!r)throw Error("address required");return await F.getEstimateFloodConsiderations(r);case"insurance-discount":if(!r)throw Error("address required");return await F.checkFloodInsuranceDiscount(r);default:throw Error(`Unknown action: ${n}`)}},{costCents:0});if(null==c)return v.NextResponse.json({error:"No data found"},{status:404});return v.NextResponse.json(c,{headers:{"Cache-Control":"public, s-maxage=86400, stale-while-revalidate=172800"}})}catch(e){if(console.error("FEMA Flood API error:",e),e instanceof Error&&e.message.includes("required"))return v.NextResponse.json({error:e.message},{status:400});return v.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["GET",()=>A],615735);var C=e.i(615735);let k=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/risk/flood/route",pathname:"/api/risk/flood",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/risk/flood/route.ts",nextConfigOutput:"",userland:C}),{workAsyncStorage:b,workUnitAsyncStorage:N,serverHooks:M}=k;function S(){return(0,a.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:N})}async function _(e,t,a){k.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/risk/flood/route";v=v.replace(/\/index$/,"")||"/";let y=await k.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:R,params:F,nextConfig:P,parsedUrl:A,isDraftMode:C,prerenderManifest:b,routerServerContext:N,isOnDemandRevalidate:M,revalidateOnlyGenerated:S,resolvedPathname:_,clientReferenceManifest:q,serverActionsManifest:I}=y,x=(0,l.normalizeAppPath)(v),T=!!(b.dynamicRoutes[x]||b.routes[_]),O=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,A,!1):t.end("This page could not be found"),null);if(T&&!C){let e=!!b.routes[_],t=b.dynamicRoutes[x];if(t&&!1===t.fallback&&!e){if(P.experimental.adapterPath)return await O();throw new w.NoFallbackError}}let U=null;!T||k.isDev||C||(U="/index"===(U=_)?"/":U);let D=!0===k.isDev||!T,Z=T&&!D;I&&q&&(0,s.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:q,serverActionsManifest:I,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:I})});let L=e.method||"GET",$=(0,n.getTracer)(),H=$.getActiveScopeSpan(),B={params:F,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!P.experimental.authInterrupts},cacheComponents:!!P.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:P.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>k.onRequestError(e,t,a,N)},sharedContext:{buildId:R}},j=new d.NodeNextRequest(e),z=new d.NodeNextResponse(t),G=c.NextRequestAdapter.fromNodeNextRequest(j,(0,c.signalFromNodeResponse)(t));try{let s=async e=>k.handle(G,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${L} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${L} ${v}`)}),i=!!(0,o.getRequestMeta)(e,"minimalMode"),l=async o=>{var n,l;let d=async({previousCacheEntry:r})=>{try{if(!i&&M&&S&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await s(o);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=B.renderOpts.collectedTags;if(!T)return await (0,h.sendResponse)(j,z,n,B.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[g.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,a=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await k.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:Z,isOnDemandRevalidate:M})},N),t}},c=await k.handleResponse({req:e,nextConfig:P,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:M,revalidateOnlyGenerated:S,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:i});if(!T)return null;if((null==c||null==(n=c.value)?void 0:n.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",M?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,p.fromNodeOutgoingHttpHeaders)(c.value.headers);return i&&T||u.delete(g.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,f.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)(j,z,new Response(c.value.body,{headers:u,status:c.value.status||200})),null};H?await l(H):await $.withPropagatedContext(e.headers,()=>$.trace(u.BaseServerSpan.handleRequest,{spanName:`${L} ${v}`,kind:n.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},l))}catch(t){if(t instanceof w.NoFallbackError||await k.onRequestError(e,t,{routerKind:"App Router",routePath:x,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:Z,isOnDemandRevalidate:M})}),T)throw t;return await (0,h.sendResponse)(j,z,new Response(null,{status:500})),null}}e.s(["handler",()=>_,"patchFetch",()=>S,"routeModule",()=>k,"serverHooks",()=>M,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>N],549213)}];

//# sourceMappingURL=3c0ae_next_dist_esm_build_templates_app-route_29a5854b.js.map