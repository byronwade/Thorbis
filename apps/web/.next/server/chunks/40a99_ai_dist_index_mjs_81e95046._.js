module.exports=[476674,e=>{"use strict";var t,r,a,o,n,s,i,l,u,p,d,c,m,h,g,f,y,v,w,b,I,T,x,z,S,E=e.i(353344),k=e.i(424830),_=e.i(443608),M=e.i(42936),R=Symbol.for("vercel.ai.gateway.error"),C=class e extends(r=Error,t=R,r){constructor({message:e,statusCode:r=500,cause:a}){super(e),this[t]=!0,this.statusCode=r,this.cause=a}static isInstance(t){return e.hasMarker(t)}static hasMarker(e){return"object"==typeof e&&null!==e&&R in e&&!0===e[R]}},N="GatewayAuthenticationError",A=Symbol.for(`vercel.ai.gateway.error.${N}`),O=class e extends(o=C,a=A,o){constructor({message:e="Authentication failed",statusCode:t=401,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[a]=!0,this.name=N,this.type="authentication_error"}static isInstance(e){return C.hasMarker(e)&&A in e}static createContextualError({apiKeyProvided:t,oidcTokenProvided:r,message:a="Authentication failed",statusCode:o=401,cause:n}){return new e({message:t?`AI Gateway authentication failed: Invalid API key.

Create a new API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys

Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:r?`AI Gateway authentication failed: Invalid OIDC token.

Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.

Alternatively, use an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys`:`AI Gateway authentication failed: No authentication provided.

Option 1 - API key:
Create an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys
Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

Option 2 - OIDC token:
Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.`,statusCode:o,cause:n})}},j="GatewayInvalidRequestError",q=Symbol.for(`vercel.ai.gateway.error.${j}`),D=class extends(s=C,n=q,s){constructor({message:e="Invalid request",statusCode:t=400,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[n]=!0,this.name=j,this.type="invalid_request_error"}static isInstance(e){return C.hasMarker(e)&&q in e}},P="GatewayRateLimitError",U=Symbol.for(`vercel.ai.gateway.error.${P}`),$=class extends(l=C,i=U,l){constructor({message:e="Rate limit exceeded",statusCode:t=429,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[i]=!0,this.name=P,this.type="rate_limit_exceeded"}static isInstance(e){return C.hasMarker(e)&&U in e}},J="GatewayModelNotFoundError",F=Symbol.for(`vercel.ai.gateway.error.${J}`),V=(0,E.lazyValidator)(()=>(0,E.zodSchema)(_.z.object({modelId:_.z.string()}))),K=class extends(p=C,u=F,p){constructor({message:e="Model not found",statusCode:t=404,modelId:r,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[u]=!0,this.name=J,this.type="model_not_found",this.modelId=r}static isInstance(e){return C.hasMarker(e)&&F in e}},B="GatewayInternalServerError",L=Symbol.for(`vercel.ai.gateway.error.${B}`),H=class extends(c=C,d=L,c){constructor({message:e="Internal server error",statusCode:t=500,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[d]=!0,this.name=B,this.type="internal_server_error"}static isInstance(e){return C.hasMarker(e)&&L in e}},G="GatewayResponseError",W=Symbol.for(`vercel.ai.gateway.error.${G}`),Y=class extends(h=C,m=W,h){constructor({message:e="Invalid response from Gateway",statusCode:t=502,response:r,validationError:a,cause:o}={}){super({message:e,statusCode:t,cause:o}),this[m]=!0,this.name=G,this.type="response_error",this.response=r,this.validationError=a}static isInstance(e){return C.hasMarker(e)&&W in e}};async function Q({response:e,statusCode:t,defaultMessage:r="Gateway request failed",cause:a,authMethod:o}){let n=await (0,E.safeValidateTypes)({value:e,schema:X});if(!n.success)return new Y({message:`Invalid error response format: ${r}`,statusCode:t,response:e,validationError:n.error,cause:a});let s=n.value,i=s.error.type,l=s.error.message;switch(i){case"authentication_error":return O.createContextualError({apiKeyProvided:"api-key"===o,oidcTokenProvided:"oidc"===o,statusCode:t,cause:a});case"invalid_request_error":return new D({message:l,statusCode:t,cause:a});case"rate_limit_exceeded":return new $({message:l,statusCode:t,cause:a});case"model_not_found":{let e=await (0,E.safeValidateTypes)({value:s.error.param,schema:V});return new K({message:l,statusCode:t,modelId:e.success?e.value.modelId:void 0,cause:a})}default:return new H({message:l,statusCode:t,cause:a})}}var X=(0,E.lazyValidator)(()=>(0,E.zodSchema)(_.z.object({error:_.z.object({message:_.z.string(),type:_.z.string().nullish(),param:_.z.unknown().nullish(),code:_.z.union([_.z.string(),_.z.number()]).nullish()})})));function Z(e,t){var r;return C.isInstance(e)?e:k.APICallError.isInstance(e)?Q({response:function(e){if(void 0!==e.data)return e.data;if(null!=e.responseBody)try{return JSON.parse(e.responseBody)}catch(t){return e.responseBody}return{}}(e),statusCode:null!=(r=e.statusCode)?r:500,defaultMessage:"Gateway request failed",cause:e,authMethod:t}):Q({response:{},statusCode:500,defaultMessage:e instanceof Error?`Gateway request failed: ${e.message}`:"Unknown Gateway error",cause:e,authMethod:t})}var ee="ai-gateway-auth-method";async function et(e){let t=await (0,E.safeValidateTypes)({value:e[ee],schema:er});return t.success?t.value:void 0}var er=(0,E.lazyValidator)(()=>(0,E.zodSchema)(_.z.union([_.z.literal("api-key"),_.z.literal("oidc")]))),ea=class{constructor(e){this.config=e}async getAvailableModels(){try{let{value:e}=await (0,E.getFromApi)({url:`${this.config.baseURL}/config`,headers:await (0,E.resolve)(this.config.headers()),successfulResponseHandler:(0,E.createJsonResponseHandler)(eo),failedResponseHandler:(0,E.createJsonErrorResponseHandler)({errorSchema:_.z.any(),errorToMessage:e=>e}),fetch:this.config.fetch});return e}catch(e){throw await Z(e)}}async getCredits(){try{let e=new URL(this.config.baseURL),{value:t}=await (0,E.getFromApi)({url:`${e.origin}/v1/credits`,headers:await (0,E.resolve)(this.config.headers()),successfulResponseHandler:(0,E.createJsonResponseHandler)(en),failedResponseHandler:(0,E.createJsonErrorResponseHandler)({errorSchema:_.z.any(),errorToMessage:e=>e}),fetch:this.config.fetch});return t}catch(e){throw await Z(e)}}},eo=(0,E.lazyValidator)(()=>(0,E.zodSchema)(_.z.object({models:_.z.array(_.z.object({id:_.z.string(),name:_.z.string(),description:_.z.string().nullish(),pricing:_.z.object({input:_.z.string(),output:_.z.string(),input_cache_read:_.z.string().nullish(),input_cache_write:_.z.string().nullish()}).transform(({input:e,output:t,input_cache_read:r,input_cache_write:a})=>({input:e,output:t,...r?{cachedInputTokens:r}:{},...a?{cacheCreationInputTokens:a}:{}})).nullish(),specification:_.z.object({specificationVersion:_.z.literal("v2"),provider:_.z.string(),modelId:_.z.string()}),modelType:_.z.enum(["language","embedding","image"]).nullish()}))}))),en=(0,E.lazyValidator)(()=>(0,E.zodSchema)(_.z.object({balance:_.z.string(),total_used:_.z.string()}).transform(({balance:e,total_used:t})=>({balance:e,totalUsed:t})))),es=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(e){let{abortSignal:t,...r}=e;return{args:this.maybeEncodeFileParts(r),warnings:[]}}async doGenerate(e){let{args:t,warnings:r}=await this.getArgs(e),{abortSignal:a}=e,o=await (0,E.resolve)(this.config.headers());try{let{responseHeaders:n,value:s,rawValue:i}=await (0,E.postJsonToApi)({url:this.getUrl(),headers:(0,E.combineHeaders)(o,e.headers,this.getModelConfigHeaders(this.modelId,!1),await (0,E.resolve)(this.config.o11yHeaders)),body:t,successfulResponseHandler:(0,E.createJsonResponseHandler)(_.z.any()),failedResponseHandler:(0,E.createJsonErrorResponseHandler)({errorSchema:_.z.any(),errorToMessage:e=>e}),...a&&{abortSignal:a},fetch:this.config.fetch});return{...s,request:{body:t},response:{headers:n,body:i},warnings:r}}catch(e){throw await Z(e,await et(o))}}async doStream(e){let{args:t,warnings:r}=await this.getArgs(e),{abortSignal:a}=e,o=await (0,E.resolve)(this.config.headers());try{let{value:n,responseHeaders:s}=await (0,E.postJsonToApi)({url:this.getUrl(),headers:(0,E.combineHeaders)(o,e.headers,this.getModelConfigHeaders(this.modelId,!0),await (0,E.resolve)(this.config.o11yHeaders)),body:t,successfulResponseHandler:(0,E.createEventSourceResponseHandler)(_.z.any()),failedResponseHandler:(0,E.createJsonErrorResponseHandler)({errorSchema:_.z.any(),errorToMessage:e=>e}),...a&&{abortSignal:a},fetch:this.config.fetch});return{stream:n.pipeThrough(new TransformStream({start(e){r.length>0&&e.enqueue({type:"stream-start",warnings:r})},transform(t,r){if(t.success){let a=t.value;("raw"!==a.type||e.includeRawChunks)&&("response-metadata"===a.type&&a.timestamp&&"string"==typeof a.timestamp&&(a.timestamp=new Date(a.timestamp)),r.enqueue(a))}else r.error(t.error)}})),request:{body:t},response:{headers:s}}}catch(e){throw await Z(e,await et(o))}}isFilePart(e){return e&&"object"==typeof e&&"type"in e&&"file"===e.type}maybeEncodeFileParts(e){for(let t of e.prompt)for(let e of t.content)if(this.isFilePart(e)&&e.data instanceof Uint8Array){let t=Uint8Array.from(e.data),r=Buffer.from(t).toString("base64");e.data=new URL(`data:${e.mediaType||"application/octet-stream"};base64,${r}`)}return e}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(e,t){return{"ai-language-model-specification-version":"2","ai-language-model-id":e,"ai-language-model-streaming":String(t)}}},ei=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:r,providerOptions:a}){var o;let n=await (0,E.resolve)(this.config.headers());try{let{responseHeaders:s,value:i,rawValue:l}=await (0,E.postJsonToApi)({url:this.getUrl(),headers:(0,E.combineHeaders)(n,null!=t?t:{},this.getModelConfigHeaders(),await (0,E.resolve)(this.config.o11yHeaders)),body:{input:1===e.length?e[0]:e,...a?{providerOptions:a}:{}},successfulResponseHandler:(0,E.createJsonResponseHandler)(el),failedResponseHandler:(0,E.createJsonErrorResponseHandler)({errorSchema:_.z.any(),errorToMessage:e=>e}),...r&&{abortSignal:r},fetch:this.config.fetch});return{embeddings:i.embeddings,usage:null!=(o=i.usage)?o:void 0,providerMetadata:i.providerMetadata,response:{headers:s,body:l}}}catch(e){throw await Z(e,await et(n))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":"2","ai-model-id":this.modelId}}},el=(0,E.lazyValidator)(()=>(0,E.zodSchema)(_.z.object({embeddings:_.z.array(_.z.array(_.z.number())),usage:_.z.object({tokens:_.z.number()}).nullish(),providerMetadata:_.z.record(_.z.string(),_.z.record(_.z.string(),_.z.unknown())).optional()}))),eu=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.maxImagesPerCall=4}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:r,aspectRatio:a,seed:o,providerOptions:n,headers:s,abortSignal:i}){var l;let u=await (0,E.resolve)(this.config.headers());try{let{responseHeaders:p,value:d,rawValue:c}=await (0,E.postJsonToApi)({url:this.getUrl(),headers:(0,E.combineHeaders)(u,null!=s?s:{},this.getModelConfigHeaders(),await (0,E.resolve)(this.config.o11yHeaders)),body:{prompt:e,n:t,...r&&{size:r},...a&&{aspectRatio:a},...o&&{seed:o},...null!=n?n:{}},successfulResponseHandler:(0,E.createJsonResponseHandler)(ed),failedResponseHandler:(0,E.createJsonErrorResponseHandler)({errorSchema:_.z.any(),errorToMessage:e=>e}),...i&&{abortSignal:i},fetch:this.config.fetch});return{images:d.images,warnings:null!=(l=d.warnings)?l:[],providerMetadata:d.providerMetadata,response:{timestamp:new Date,modelId:this.modelId,headers:p}}}catch(e){throw Z(e,await et(u))}}getUrl(){return`${this.config.baseURL}/image-model`}getModelConfigHeaders(){return{"ai-image-model-specification-version":"2","ai-model-id":this.modelId}}},ep=_.z.object({images:_.z.array(_.z.unknown()).optional()}).catchall(_.z.unknown()),ed=_.z.object({images:_.z.array(_.z.string()),warnings:_.z.array(_.z.object({type:_.z.literal("other"),message:_.z.string()})).optional(),providerMetadata:_.z.record(_.z.string(),ep).optional()});async function ec(){var e;return null==(e=(0,M.getContext)().headers)?void 0:e["x-vercel-id"]}var em=function(e={}){var t,r;let a=null,o=null,n=null!=(t=e.metadataCacheRefreshMillis)?t:3e5,s=0,i=null!=(r=(0,E.withoutTrailingSlash)(e.baseURL))?r:"https://ai-gateway.vercel.sh/v1/ai",l=async()=>{let t=await eh(e);if(t)return(0,E.withUserAgentSuffix)({Authorization:`Bearer ${t.token}`,"ai-gateway-protocol-version":"0.0.1",[ee]:t.authMethod,...e.headers},"ai-sdk/gateway/2.0.13");throw O.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401})},u=()=>{let e=(0,E.loadOptionalSetting)({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),t=(0,E.loadOptionalSetting)({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),r=(0,E.loadOptionalSetting)({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return async()=>{let a=await ec();return{...e&&{"ai-o11y-deployment-id":e},...t&&{"ai-o11y-environment":t},...r&&{"ai-o11y-region":r},...a&&{"ai-o11y-request-id":a}}}},p=t=>new es(t,{provider:"gateway",baseURL:i,headers:l,fetch:e.fetch,o11yHeaders:u()}),d=async()=>new ea({baseURL:i,headers:l,fetch:e.fetch}).getCredits().catch(async e=>{throw await Z(e,await et(await l()))}),c=function(e){if(new.target)throw Error("The Gateway Provider model function cannot be called with the new keyword.");return p(e)};return c.getAvailableModels=async()=>{var t,r,u;let p=null!=(u=null==(r=null==(t=e._internal)?void 0:t.currentDate)?void 0:r.call(t).getTime())?u:Date.now();return(!a||p-s>n)&&(s=p,a=new ea({baseURL:i,headers:l,fetch:e.fetch}).getAvailableModels().then(e=>(o=e,e)).catch(async e=>{throw await Z(e,await et(await l()))})),o?Promise.resolve(o):a},c.getCredits=d,c.imageModel=t=>new eu(t,{provider:"gateway",baseURL:i,headers:l,fetch:e.fetch,o11yHeaders:u()}),c.languageModel=p,c.textEmbeddingModel=t=>new ei(t,{provider:"gateway",baseURL:i,headers:l,fetch:e.fetch,o11yHeaders:u()}),c}();async function eh(e){let t=(0,E.loadOptionalSetting)({settingValue:e.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});if(t)return{token:t,authMethod:"api-key"};try{return{token:await (0,M.getVercelOidcToken)(),authMethod:"oidc"}}catch(e){return null}}var eg=k,ef=e.i(274812),ey=e.i(214664),ev=Object.defineProperty,ew="AI_NoOutputSpecifiedError",eb=`vercel.ai.error.${ew}`,eI=Symbol.for(eb),eT=class extends eg.AISDKError{constructor({message:e="No output specified."}={}){super({name:ew,message:e}),this[g]=!0}static isInstance(e){return eg.AISDKError.hasMarker(e,eb)}};g=eI;var ex=!1,ez=e=>{if(0===e.length)return;let t=globalThis.AI_SDK_LOG_WARNINGS;if(!1!==t){if("function"==typeof t)return void t(e);for(let t of(ex||(ex=!0,console.info("AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.")),e))console.warn(function(e){let t="AI SDK Warning:";switch(e.type){case"unsupported-setting":{let r=`${t} The "${e.setting}" setting is not supported by this model`;return e.details&&(r+=` - ${e.details}`),r}case"unsupported-tool":{let r="name"in e.tool?e.tool.name:"unknown tool",a=`${t} The tool "${r}" is not supported by this model`;return e.details&&(a+=` - ${e.details}`),a}case"other":return`${t} ${e.message}`;default:return`${t} ${JSON.stringify(e,null,2)}`}}(t))}},eS="AI_InvalidArgumentError",eE=`vercel.ai.error.${eS}`,ek=Symbol.for(eE),e_=class extends eg.AISDKError{constructor({parameter:e,value:t,message:r}){super({name:eS,message:`Invalid argument for parameter ${e}: ${r}`}),this[f]=!0,this.parameter=e,this.value=t}static isInstance(e){return eg.AISDKError.hasMarker(e,eE)}};f=ek;Symbol.for("vercel.ai.error.AI_InvalidStreamPartError");eg.AISDKError;var eM="AI_InvalidToolInputError",eR=`vercel.ai.error.${eM}`,eC=Symbol.for(eR),eN=class extends eg.AISDKError{constructor({toolInput:e,toolName:t,cause:r,message:a=`Invalid input for tool ${t}: ${(0,eg.getErrorMessage)(r)}`}){super({name:eM,message:a,cause:r}),this[y]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return eg.AISDKError.hasMarker(e,eR)}};y=eC;Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");eg.AISDKError;var eA="AI_NoObjectGeneratedError",eO=`vercel.ai.error.${eA}`,ej=Symbol.for(eO),eq=class extends eg.AISDKError{constructor({message:e="No object generated.",cause:t,text:r,response:a,usage:o,finishReason:n}){super({name:eA,message:e,cause:t}),this[v]=!0,this.text=r,this.response=a,this.usage=o,this.finishReason=n}static isInstance(e){return eg.AISDKError.hasMarker(e,eO)}};v=ej;var eD="AI_NoOutputGeneratedError",eP=`vercel.ai.error.${eD}`,eU=Symbol.for(eP),e$=class extends eg.AISDKError{constructor({message:e="No output generated.",cause:t}={}){super({name:eD,message:e,cause:t}),this[w]=!0}static isInstance(e){return eg.AISDKError.hasMarker(e,eP)}};w=eU,eg.AISDKError;var eJ="AI_NoSuchToolError",eF=`vercel.ai.error.${eJ}`,eV=Symbol.for(eF),eK=class extends eg.AISDKError{constructor({toolName:e,availableTools:t,message:r=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:eJ,message:r}),this[b]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return eg.AISDKError.hasMarker(e,eF)}};b=eV;var eB="AI_ToolCallRepairError",eL=`vercel.ai.error.${eB}`,eH=Symbol.for(eL),eG=class extends eg.AISDKError{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${(0,eg.getErrorMessage)(e)}`}){super({name:eB,message:r,cause:e}),this[I]=!0,this.originalError=t}static isInstance(e){return eg.AISDKError.hasMarker(e,eL)}};I=eH;var eW=class extends eg.AISDKError{constructor(e){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},eY=Symbol.for("vercel.ai.error.AI_InvalidDataContentError");eg.AISDKError;var eQ="AI_InvalidMessageRoleError",eX=`vercel.ai.error.${eQ}`,eZ=Symbol.for(eX),e0=class extends eg.AISDKError{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:eQ,message:t}),this[T]=!0,this.role=e}static isInstance(e){return eg.AISDKError.hasMarker(e,eX)}};T=eZ;var e1="AI_MessageConversionError",e2=`vercel.ai.error.${e1}`,e4=Symbol.for(e2),e8=class extends eg.AISDKError{constructor({originalMessage:e,message:t}){super({name:e1,message:t}),this[x]=!0,this.originalMessage=e}static isInstance(e){return eg.AISDKError.hasMarker(e,e2)}};x=e4;var e6="AI_DownloadError",e7=`vercel.ai.error.${e6}`,e5=Symbol.for(e7),e3=class extends eg.AISDKError{constructor({url:e,statusCode:t,statusText:r,cause:a,message:o=null==a?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${a}`}){super({name:e6,message:o,cause:a}),this[z]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return eg.AISDKError.hasMarker(e,e7)}};z=e5;var e9="AI_RetryError",te=`vercel.ai.error.${e9}`,tt=Symbol.for(te),tr=class extends eg.AISDKError{constructor({message:e,reason:t,errors:r}){super({name:e9,message:e}),this[S]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return eg.AISDKError.hasMarker(e,te)}};function ta(e){var t;if("string"!=typeof e){if("v2"!==e.specificationVersion)throw new eW({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});return e}return(null!=(t=globalThis.AI_SDK_DEFAULT_PROVIDER)?t:em).languageModel(e)}S=tt;var to=[{mediaType:"image/gif",bytesPrefix:[71,73,70]},{mediaType:"image/png",bytesPrefix:[137,80,78,71]},{mediaType:"image/jpeg",bytesPrefix:[255,216]},{mediaType:"image/webp",bytesPrefix:[82,73,70,70,null,null,null,null,87,69,66,80]},{mediaType:"image/bmp",bytesPrefix:[66,77]},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0]},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42]},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102]},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99]}],tn="5.0.98",ts=async({url:e})=>{var t;let r=e.toString();try{let e=await fetch(r,{headers:(0,E.withUserAgentSuffix)({},`ai-sdk/${tn}`,(0,E.getRuntimeEnvironmentUserAgent)())});if(!e.ok)throw new e3({url:r,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mediaType:null!=(t=e.headers.get("content-type"))?t:void 0}}catch(e){if(e3.isInstance(e))throw e;throw new e3({url:r,cause:e})}},ti=_.z.union([_.z.string(),_.z.instanceof(Uint8Array),_.z.instanceof(ArrayBuffer),_.z.custom(e=>{var t,r;return null!=(r=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&r},{message:"Must be a Buffer"})]);function tl(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if("string"==typeof e)try{e=new URL(e)}catch(e){}if(e instanceof URL&&"data:"===e.protocol){let{mediaType:t,base64Content:r}=function(e){try{let[t,r]=e.split(",");return{mediaType:t.split(";")[0].split(":")[1],base64Content:r}}catch(e){return{mediaType:void 0,base64Content:void 0}}}(e.toString());if(null==t||null==r)throw new eg.AISDKError({name:"InvalidDataContentError",message:`Invalid data URL format in content ${e.toString()}`});return{data:r,mediaType:t}}return{data:e,mediaType:void 0}}async function tu({prompt:e,supportedUrls:t,download:r=((e=ts)=>t=>Promise.all(t.map(async t=>t.isUrlSupportedByModel?null:e(t))))()}){let a=await tp(e.messages,r,t);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>(function({message:e,downloadedAssets:t}){let r=e.role;switch(r){case"system":return{role:"system",content:e.content,providerOptions:e.providerOptions};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions};return{role:"user",content:e.content.map(e=>(function(e,t){var r;let a;if("text"===e.type)return{type:"text",text:e.text,providerOptions:e.providerOptions};let o=e.type;switch(o){case"image":a=e.image;break;case"file":a=e.data;break;default:throw Error(`Unsupported part type: ${o}`)}let{data:n,mediaType:s}=tl(a),i=null!=s?s:e.mediaType,l=n;if(l instanceof URL){let e=t[l.toString()];e&&(l=e.data,null!=i||(i=e.mediaType))}switch(o){case"image":return(l instanceof Uint8Array||"string"==typeof l)&&(i=null!=(r=function({data:e,signatures:t}){let r,a,o="string"==typeof e&&e.startsWith("SUQz")||"string"!=typeof e&&e.length>10&&73===e[0]&&68===e[1]&&51===e[2]?(a=(127&(r="string"==typeof e?(0,E.convertBase64ToUint8Array)(e):e)[6])<<21|(127&r[7])<<14|(127&r[8])<<7|127&r[9],r.slice(a+10)):e,n="string"==typeof o?(0,E.convertBase64ToUint8Array)(o.substring(0,Math.min(o.length,24))):o;for(let e of t)if(n.length>=e.bytesPrefix.length&&e.bytesPrefix.every((e,t)=>null===e||n[t]===e))return e.mediaType}({data:l,signatures:to}))?r:i),{type:"file",mediaType:null!=i?i:"image/*",filename:void 0,data:l,providerOptions:e.providerOptions};case"file":if(null==i)throw Error("Media type is missing for file part");return{type:"file",mediaType:i,filename:e.filename,data:l,providerOptions:e.providerOptions}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerOptions:e.providerOptions};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text||null!=e.providerOptions).map(e=>{let t=e.providerOptions;switch(e.type){case"file":{let{data:r,mediaType:a}=tl(e.data);return{type:"file",data:r,filename:e.filename,mediaType:null!=a?a:e.mediaType,providerOptions:t}}case"reasoning":return{type:"reasoning",text:e.text,providerOptions:t};case"text":return{type:"text",text:e.text,providerOptions:t};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:t};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:t}}}),providerOptions:e.providerOptions};case"tool":return{role:"tool",content:e.content.map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:e.providerOptions})),providerOptions:e.providerOptions};default:throw new e0({role:r})}})({message:e,downloadedAssets:a}))]}async function tp(e,t,r){let a=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).map(e=>{var t;let r=null!=(t=e.mediaType)?t:"image"===e.type?"image/*":void 0,a="image"===e.type?e.image:e.data;if("string"==typeof a)try{a=new URL(a)}catch(e){}return{mediaType:r,data:a}}).filter(e=>e.data instanceof URL).map(e=>({url:e.data,isUrlSupportedByModel:null!=e.mediaType&&(0,E.isUrlSupported)({url:e.data.toString(),mediaType:e.mediaType,supportedUrls:r})}));return Object.fromEntries((await t(a)).map((e,t)=>null==e?null:[a[t].url.toString(),{data:e.data,mediaType:e.mediaType}]).filter(e=>null!=e))}function td({maxOutputTokens:e,temperature:t,topP:r,topK:a,presencePenalty:o,frequencyPenalty:n,seed:s,stopSequences:i}){if(null!=e){if(!Number.isInteger(e))throw new e_({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be an integer"});if(e<1)throw new e_({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new e_({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=r&&"number"!=typeof r)throw new e_({parameter:"topP",value:r,message:"topP must be a number"});if(null!=a&&"number"!=typeof a)throw new e_({parameter:"topK",value:a,message:"topK must be a number"});if(null!=o&&"number"!=typeof o)throw new e_({parameter:"presencePenalty",value:o,message:"presencePenalty must be a number"});if(null!=n&&"number"!=typeof n)throw new e_({parameter:"frequencyPenalty",value:n,message:"frequencyPenalty must be a number"});if(null!=s&&!Number.isInteger(s))throw new e_({parameter:"seed",value:s,message:"seed must be an integer"});return{maxOutputTokens:e,temperature:t,topP:r,topK:a,presencePenalty:o,frequencyPenalty:n,stopSequences:i,seed:s}}function tc({tools:e,toolChoice:t,activeTools:r}){return null!=e&&Object.keys(e).length>0?{tools:(null!=r?Object.entries(e).filter(([e])=>r.includes(e)):Object.entries(e)).map(([e,t])=>{let r=t.type;switch(r){case void 0:case"dynamic":case"function":return{type:"function",name:e,description:t.description,inputSchema:(0,E.asSchema)(t.inputSchema).jsonSchema,providerOptions:t.providerOptions};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw Error(`Unsupported tool type: ${r}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}var tm=_.z.lazy(()=>_.z.union([_.z.null(),_.z.string(),_.z.number(),_.z.boolean(),_.z.record(_.z.string(),tm),_.z.array(tm)])),th=_.z.record(_.z.string(),_.z.record(_.z.string(),tm)),tg=_.z.object({type:_.z.literal("text"),text:_.z.string(),providerOptions:th.optional()}),tf=_.z.object({type:_.z.literal("image"),image:_.z.union([ti,_.z.instanceof(URL)]),mediaType:_.z.string().optional(),providerOptions:th.optional()}),ty=_.z.object({type:_.z.literal("file"),data:_.z.union([ti,_.z.instanceof(URL)]),filename:_.z.string().optional(),mediaType:_.z.string(),providerOptions:th.optional()}),tv=_.z.object({type:_.z.literal("reasoning"),text:_.z.string(),providerOptions:th.optional()}),tw=_.z.object({type:_.z.literal("tool-call"),toolCallId:_.z.string(),toolName:_.z.string(),input:_.z.unknown(),providerOptions:th.optional(),providerExecuted:_.z.boolean().optional()}),tb=_.z.discriminatedUnion("type",[_.z.object({type:_.z.literal("text"),value:_.z.string()}),_.z.object({type:_.z.literal("json"),value:tm}),_.z.object({type:_.z.literal("error-text"),value:_.z.string()}),_.z.object({type:_.z.literal("error-json"),value:tm}),_.z.object({type:_.z.literal("content"),value:_.z.array(_.z.union([_.z.object({type:_.z.literal("text"),text:_.z.string()}),_.z.object({type:_.z.literal("media"),data:_.z.string(),mediaType:_.z.string()})]))})]),tI=_.z.object({type:_.z.literal("tool-result"),toolCallId:_.z.string(),toolName:_.z.string(),output:tb,providerOptions:th.optional()}),tT=_.z.object({role:_.z.literal("system"),content:_.z.string(),providerOptions:th.optional()}),tx=_.z.object({role:_.z.literal("user"),content:_.z.union([_.z.string(),_.z.array(_.z.union([tg,tf,ty]))]),providerOptions:th.optional()}),tz=_.z.object({role:_.z.literal("assistant"),content:_.z.union([_.z.string(),_.z.array(_.z.union([tg,ty,tv,tw,tI]))]),providerOptions:th.optional()}),tS=_.z.object({role:_.z.literal("tool"),content:_.z.array(tI),providerOptions:th.optional()}),tE=_.z.union([tT,tx,tz,tS]);async function tk(e){let t;if(null==e.prompt&&null==e.messages)throw new eg.InvalidPromptError({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new eg.InvalidPromptError({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new eg.InvalidPromptError({prompt:e,message:"system must be a string"});if(null!=e.prompt&&"string"==typeof e.prompt)t=[{role:"user",content:e.prompt}];else if(null!=e.prompt&&Array.isArray(e.prompt))t=e.prompt;else if(null!=e.messages)t=e.messages;else throw new eg.InvalidPromptError({prompt:e,message:"prompt or messages must be defined"});if(0===t.length)throw new eg.InvalidPromptError({prompt:e,message:"messages must not be empty"});let r=await (0,E.safeValidateTypes)({value:t,schema:_.z.array(tE)});if(!r.success)throw new eg.InvalidPromptError({prompt:e,message:"The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.",cause:r.error});return{messages:t,system:e.system}}function t_(e){return O.isInstance(e)||K.isInstance(e)?new eg.AISDKError({name:"GatewayError",message:"Vercel AI Gateway access failed. If you want to use AI SDK providers directly, use the providers, e.g. @ai-sdk/openai, or register a different global default provider.",cause:e}):e}function tM({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}function tR({model:e,settings:t,telemetry:r,headers:a}){var o;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,r])=>(e[`ai.settings.${t}`]=r,e),{}),...Object.entries(null!=(o=null==r?void 0:r.metadata)?o:{}).reduce((e,[t,r])=>(e[`ai.telemetry.metadata.${t}`]=r,e),{}),...Object.entries(null!=a?a:{}).reduce((e,[t,r])=>(void 0!==r&&(e[`ai.request.headers.${t}`]=r),e),{})}}var tC={startSpan:()=>tN,startActiveSpan:(e,t,r,a)=>"function"==typeof t?t(tN):"function"==typeof r?r(tN):"function"==typeof a?a(tN):void 0},tN={spanContext:()=>tA,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},tA={traceId:"",spanId:"",traceFlags:0};function tO({isEnabled:e=!1,tracer:t}={}){return e?t||ef.trace.getTracer("ai"):tC}function tj({name:e,tracer:t,attributes:r,fn:a,endWhenDone:o=!0}){return t.startActiveSpan(e,{attributes:r},async e=>{try{let t=await a(e);return o&&e.end(),t}catch(t){try{tq(e,t)}finally{e.end()}throw t}})}function tq(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:ey.SpanStatusCode.ERROR,message:t.message})):e.setStatus({code:ey.SpanStatusCode.ERROR})}function tD({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[r,a])=>{if(null==a)return t;if("object"==typeof a&&"input"in a&&"function"==typeof a.input){if((null==e?void 0:e.recordInputs)===!1)return t;let o=a.input();return null==o?t:{...t,[r]:o}}if("object"==typeof a&&"output"in a&&"function"==typeof a.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let o=a.output();return null==o?t:{...t,[r]:o}}return{...t,[r]:a}},{})}function tP(e){return JSON.stringify(e.map(e=>({...e,content:"string"==typeof e.content?e.content:e.content.map(e=>{var t;return"file"===e.type?{...e,data:e.data instanceof Uint8Array?"string"==typeof(t=e.data)?t:t instanceof ArrayBuffer?(0,E.convertUint8ArrayToBase64)(new Uint8Array(t)):(0,E.convertUint8ArrayToBase64)(t):e.data}:e})})))}function tU(e,t){return{inputTokens:t$(e.inputTokens,t.inputTokens),outputTokens:t$(e.outputTokens,t.outputTokens),totalTokens:t$(e.totalTokens,t.totalTokens),reasoningTokens:t$(e.reasoningTokens,t.reasoningTokens),cachedInputTokens:t$(e.cachedInputTokens,t.cachedInputTokens)}}function t$(e,t){return null==e&&null==t?void 0:(null!=e?e:0)+(null!=t?t:0)}function tJ(e){return void 0===e?[]:Array.isArray(e)?e:[e]}async function tF(e,{maxRetries:t,delayInMs:r,backoffFactor:a,abortSignal:o},n=[]){try{return await e()}catch(u){if((0,E.isAbortError)(u)||0===t)throw u;let s=(0,E.getErrorMessage)(u),i=[...n,u],l=i.length;if(l>t)throw new tr({message:`Failed after ${l} attempts. Last error: ${s}`,reason:"maxRetriesExceeded",errors:i});if(u instanceof Error&&eg.APICallError.isInstance(u)&&!0===u.isRetryable&&l<=t)return await (0,E.delay)(function({error:e,exponentialBackoffDelay:t}){let r,a=e.responseHeaders;if(!a)return t;let o=a["retry-after-ms"];if(o){let e=parseFloat(o);Number.isNaN(e)||(r=e)}let n=a["retry-after"];if(n&&void 0===r){let e=parseFloat(n);r=Number.isNaN(e)?Date.parse(n)-Date.now():1e3*e}return null!=r&&!Number.isNaN(r)&&0<=r&&(r<6e4||r<t)?r:t}({error:u,exponentialBackoffDelay:r}),{abortSignal:o}),tF(e,{maxRetries:t,delayInMs:a*r,backoffFactor:a,abortSignal:o},i);if(1===l)throw u;throw new tr({message:`Failed after ${l} attempts with non-retryable error: '${s}'`,reason:"errorNotRetryable",errors:i})}}function tV({maxRetries:e,abortSignal:t}){if(null!=e){if(!Number.isInteger(e))throw new e_({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new e_({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let r=null!=e?e:2;return{maxRetries:r,retry:(({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2,abortSignal:a}={})=>async o=>tF(o,{maxRetries:e,delayInMs:t,backoffFactor:r,abortSignal:a}))({maxRetries:r,abortSignal:t})}}function tK(e){let t=e.filter(e=>"text"===e.type);if(0!==t.length)return t.map(e=>e.text).join("")}var tB=class{constructor({data:e,mediaType:t}){const r=e instanceof Uint8Array;this.base64Data=r?void 0:e,this.uint8ArrayData=r?e:void 0,this.mediaType=t}get base64(){return null==this.base64Data&&(this.base64Data=(0,E.convertUint8ArrayToBase64)(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=(0,E.convertBase64ToUint8Array)(this.base64Data)),this.uint8ArrayData}},tL=class extends tB{constructor(e){super(e),this.type="file"}};async function tH({toolCall:e,tools:t,repairToolCall:r,system:a,messages:o}){try{if(null==t)throw new eK({toolName:e.toolName});try{return await tG({toolCall:e,tools:t})}catch(s){if(null==r||!(eK.isInstance(s)||eN.isInstance(s)))throw s;let n=null;try{n=await r({toolCall:e,tools:t,inputSchema:({toolName:e})=>{let{inputSchema:r}=t[e];return(0,E.asSchema)(r).jsonSchema},system:a,messages:o,error:s})}catch(e){throw new eG({cause:e,originalError:s})}if(null==n)throw s;return await tG({toolCall:n,tools:t})}}catch(a){let t=await (0,E.safeParseJSON)({text:e.input}),r=t.success?t.value:e.input;return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:r,dynamic:!0,invalid:!0,error:a}}}async function tG({toolCall:e,tools:t}){let r=e.toolName,a=t[r];if(null==a)throw new eK({toolName:e.toolName,availableTools:Object.keys(t)});let o=(0,E.asSchema)(a.inputSchema),n=""===e.input.trim()?await (0,E.safeValidateTypes)({value:{},schema:o}):await (0,E.safeParseJSON)({text:e.input,schema:o});if(!1===n.success)throw new eN({toolName:r,toolInput:e.input,cause:n.error});return"dynamic"===a.type?{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:n.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0}:{type:"tool-call",toolCallId:e.toolCallId,toolName:r,input:n.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}var tW=class{constructor({content:e,finishReason:t,usage:r,warnings:a,request:o,response:n,providerMetadata:s}){this.content=e,this.finishReason=t,this.usage=r,this.warnings=a,this.request=o,this.response=n,this.providerMetadata=s}get text(){return this.content.filter(e=>"text"===e.type).map(e=>e.text).join("")}get reasoning(){return this.content.filter(e=>"reasoning"===e.type)}get reasoningText(){return 0===this.reasoning.length?void 0:this.reasoning.map(e=>e.text).join("")}get files(){return this.content.filter(e=>"file"===e.type).map(e=>e.file)}get sources(){return this.content.filter(e=>"source"===e.type)}get toolCalls(){return this.content.filter(e=>"tool-call"===e.type)}get staticToolCalls(){return this.toolCalls.filter(e=>!0!==e.dynamic)}get dynamicToolCalls(){return this.toolCalls.filter(e=>!0===e.dynamic)}get toolResults(){return this.content.filter(e=>"tool-result"===e.type)}get staticToolResults(){return this.toolResults.filter(e=>!0!==e.dynamic)}get dynamicToolResults(){return this.toolResults.filter(e=>!0===e.dynamic)}};function tY(e){return({steps:t})=>t.length===e}async function tQ({stopConditions:e,steps:t}){return(await Promise.all(e.map(e=>e({steps:t})))).some(e=>e)}function tX({output:e,tool:t,errorMode:r}){return"text"===r?{type:"error-text",value:(0,eg.getErrorMessage)(e)}:"json"===r?{type:"error-json",value:tZ(e)}:(null==t?void 0:t.toModelOutput)?t.toModelOutput(e):"string"==typeof e?{type:"text",value:e}:{type:"json",value:tZ(e)}}function tZ(e){return void 0===e?null:e}function t0({content:e,tools:t}){let r=[],a=e.filter(e=>"source"!==e.type).filter(e=>("tool-result"!==e.type||e.providerExecuted)&&("tool-error"!==e.type||e.providerExecuted)).filter(e=>"text"!==e.type||e.text.length>0).map(e=>{switch(e.type){case"text":return{type:"text",text:e.text,providerOptions:e.providerMetadata};case"reasoning":return{type:"reasoning",text:e.text,providerOptions:e.providerMetadata};case"file":return{type:"file",data:e.file.base64,mediaType:e.file.mediaType,providerOptions:e.providerMetadata};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:e.providerMetadata};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:tX({tool:null==t?void 0:t[e.toolName],output:e.output,errorMode:"none"}),providerExecuted:!0,providerOptions:e.providerMetadata};case"tool-error":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:tX({tool:null==t?void 0:t[e.toolName],output:e.error,errorMode:"json"}),providerOptions:e.providerMetadata}}});a.length>0&&r.push({role:"assistant",content:a});let o=e.filter(e=>"tool-result"===e.type||"tool-error"===e.type).filter(e=>!e.providerExecuted).map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:tX({tool:null==t?void 0:t[e.toolName],output:"tool-result"===e.type?e.output:e.error,errorMode:"tool-error"===e.type?"text":"none"}),...null!=e.providerMetadata?{providerOptions:e.providerMetadata}:{}}));return o.length>0&&r.push({role:"tool",content:o}),r}var t1=(0,E.createIdGenerator)({prefix:"aitxt",size:24});async function t2({model:e,tools:t,toolChoice:r,system:a,prompt:o,messages:n,maxRetries:s,abortSignal:i,headers:l,stopWhen:u=tY(1),experimental_output:p,experimental_telemetry:d,providerOptions:c,experimental_activeTools:m,activeTools:h=m,experimental_prepareStep:g,prepareStep:f=g,experimental_repairToolCall:y,experimental_download:v,experimental_context:w,_internal:{generateId:b=t1,currentDate:I=()=>new Date}={},onStepFinish:T,...x}){let z=ta(e),S=tJ(u),{maxRetries:k,retry:_}=tV({maxRetries:s,abortSignal:i}),M=td(x),R=(0,E.withUserAgentSuffix)(null!=l?l:{},`ai/${tn}`),C=tR({model:z,telemetry:d,headers:R,settings:{...M,maxRetries:k}}),N=await tk({system:a,prompt:o,messages:n}),A=tO(d);try{return await tj({name:"ai.generateText",attributes:tD({telemetry:d,attributes:{...tM({operationId:"ai.generateText",telemetry:d}),...C,"ai.model.provider":z.provider,"ai.model.id":z.modelId,"ai.prompt":{input:()=>JSON.stringify({system:a,prompt:o,messages:n})}}}),tracer:A,fn:async e=>{var o,n,s,l,u,m,g;let k,M,O=td(x),j=[],q=[],D=[],P=[];do{let e=[...N.messages,...D],S=await (null==f?void 0:f({model:z,steps:P,stepNumber:P.length,messages:e})),M=ta(null!=(o=null==S?void 0:S.model)?o:z),U=await tu({prompt:{system:null!=(n=null==S?void 0:S.system)?n:N.system,messages:null!=(s=null==S?void 0:S.messages)?s:e},supportedUrls:await M.supportedUrls,download:v}),{toolChoice:$,tools:J}=tc({tools:t,toolChoice:null!=(l=null==S?void 0:S.toolChoice)?l:r,activeTools:null!=(u=null==S?void 0:S.activeTools)?u:h});k=await _(()=>{var e;return tj({name:"ai.generateText.doGenerate",attributes:tD({telemetry:d,attributes:{...tM({operationId:"ai.generateText.doGenerate",telemetry:d}),...C,"ai.model.provider":M.provider,"ai.model.id":M.modelId,"ai.prompt.messages":{input:()=>tP(U)},"ai.prompt.tools":{input:()=>null==J?void 0:J.map(e=>JSON.stringify(e))},"ai.prompt.toolChoice":{input:()=>null!=$?JSON.stringify($):void 0},"gen_ai.system":M.provider,"gen_ai.request.model":M.modelId,"gen_ai.request.frequency_penalty":x.frequencyPenalty,"gen_ai.request.max_tokens":x.maxOutputTokens,"gen_ai.request.presence_penalty":x.presencePenalty,"gen_ai.request.stop_sequences":x.stopSequences,"gen_ai.request.temperature":null!=(e=x.temperature)?e:void 0,"gen_ai.request.top_k":x.topK,"gen_ai.request.top_p":x.topP}}),tracer:A,fn:async e=>{var t,r,a,o,n,s,l,u;let m=await M.doGenerate({...O,tools:J,toolChoice:$,responseFormat:null==p?void 0:p.responseFormat,prompt:U,providerOptions:c,abortSignal:i,headers:R}),h={id:null!=(r=null==(t=m.response)?void 0:t.id)?r:b(),timestamp:null!=(o=null==(a=m.response)?void 0:a.timestamp)?o:I(),modelId:null!=(s=null==(n=m.response)?void 0:n.modelId)?s:M.modelId,headers:null==(l=m.response)?void 0:l.headers,body:null==(u=m.response)?void 0:u.body};return e.setAttributes(tD({telemetry:d,attributes:{"ai.response.finishReason":m.finishReason,"ai.response.text":{output:()=>tK(m.content)},"ai.response.toolCalls":{output:()=>{let e=t6(m.content);return null==e?void 0:JSON.stringify(e)}},"ai.response.id":h.id,"ai.response.model":h.modelId,"ai.response.timestamp":h.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(m.providerMetadata),"ai.usage.promptTokens":m.usage.inputTokens,"ai.usage.completionTokens":m.usage.outputTokens,"gen_ai.response.finish_reasons":[m.finishReason],"gen_ai.response.id":h.id,"gen_ai.response.model":h.modelId,"gen_ai.usage.input_tokens":m.usage.inputTokens,"gen_ai.usage.output_tokens":m.usage.outputTokens}})),{...m,response:h}}})});let F=await Promise.all(k.content.filter(e=>"tool-call"===e.type).map(r=>tH({toolCall:r,tools:t,repairToolCall:y,system:a,messages:e})));for(let r of F){if(r.invalid)continue;let a=t[r.toolName];(null==a?void 0:a.onInputAvailable)!=null&&await a.onInputAvailable({input:r.input,toolCallId:r.toolCallId,messages:e,abortSignal:i,experimental_context:w})}let V=F.filter(e=>e.invalid&&e.dynamic);for(let e of(q=[],V))q.push({type:"tool-error",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,error:(0,E.getErrorMessage)(e.error),dynamic:!0});j=F.filter(e=>!e.providerExecuted),null!=t&&q.push(...await t4({toolCalls:j.filter(e=>!e.invalid),tools:t,tracer:A,telemetry:d,messages:e,abortSignal:i,experimental_context:w}));let K=function({content:e,toolCalls:t,toolOutputs:r}){return[...e.map(e=>{switch(e.type){case"text":case"reasoning":case"source":return e;case"file":return{type:"file",file:new tB(e)};case"tool-call":return t.find(t=>t.toolCallId===e.toolCallId);case"tool-result":{let r=t.find(t=>t.toolCallId===e.toolCallId);if(null==r)throw Error(`Tool call ${e.toolCallId} not found.`);if(e.isError)return{type:"tool-error",toolCallId:e.toolCallId,toolName:e.toolName,input:r.input,error:e.result,providerExecuted:!0,dynamic:r.dynamic};return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,input:r.input,output:e.result,providerExecuted:!0,dynamic:r.dynamic}}}}),...r]}({content:k.content,toolCalls:F,toolOutputs:q});D.push(...t0({content:K,tools:t}));let B=new tW({content:K,finishReason:k.finishReason,usage:k.usage,warnings:k.warnings,providerMetadata:k.providerMetadata,request:null!=(m=k.request)?m:{},response:{...k.response,messages:structuredClone(D)}});ez(null!=(g=k.warnings)?g:[]),P.push(B),await (null==T?void 0:T(B))}while(j.length>0&&q.length===j.length&&!await tQ({stopConditions:S,steps:P}))e.setAttributes(tD({telemetry:d,attributes:{"ai.response.finishReason":k.finishReason,"ai.response.text":{output:()=>tK(k.content)},"ai.response.toolCalls":{output:()=>{let e=t6(k.content);return null==e?void 0:JSON.stringify(e)}},"ai.response.providerMetadata":JSON.stringify(k.providerMetadata),"ai.usage.promptTokens":k.usage.inputTokens,"ai.usage.completionTokens":k.usage.outputTokens}}));let U=P[P.length-1];return"stop"===U.finishReason&&(M=await (null==p?void 0:p.parseOutput({text:U.text},{response:U.response,usage:U.usage,finishReason:U.finishReason}))),new t8({steps:P,resolvedOutput:M})}})}catch(e){throw t_(e)}}async function t4({toolCalls:e,tools:t,tracer:r,telemetry:a,messages:o,abortSignal:n,experimental_context:s}){return(await Promise.all(e.map(async({toolCallId:e,toolName:i,input:l})=>{let u=t[i];if((null==u?void 0:u.execute)!=null)return tj({name:"ai.toolCall",attributes:tD({telemetry:a,attributes:{...tM({operationId:"ai.toolCall",telemetry:a}),"ai.toolCall.name":i,"ai.toolCall.id":e,"ai.toolCall.args":{output:()=>JSON.stringify(l)}}}),tracer:r,fn:async t=>{try{let r;for await(let t of(0,E.executeTool)({execute:u.execute.bind(u),input:l,options:{toolCallId:e,messages:o,abortSignal:n,experimental_context:s}}))"final"===t.type&&(r=t.output);try{t.setAttributes(tD({telemetry:a,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(r)}}}))}catch(e){}return{type:"tool-result",toolCallId:e,toolName:i,input:l,output:r,dynamic:"dynamic"===u.type}}catch(r){return tq(t,r),{type:"tool-error",toolCallId:e,toolName:i,input:l,error:r,dynamic:"dynamic"===u.type}}}})}))).filter(e=>null!=e)}var t8=class{constructor(e){this.steps=e.steps,this.resolvedOutput=e.resolvedOutput}get finalStep(){return this.steps[this.steps.length-1]}get content(){return this.finalStep.content}get text(){return this.finalStep.text}get files(){return this.finalStep.files}get reasoningText(){return this.finalStep.reasoningText}get reasoning(){return this.finalStep.reasoning}get toolCalls(){return this.finalStep.toolCalls}get staticToolCalls(){return this.finalStep.staticToolCalls}get dynamicToolCalls(){return this.finalStep.dynamicToolCalls}get toolResults(){return this.finalStep.toolResults}get staticToolResults(){return this.finalStep.staticToolResults}get dynamicToolResults(){return this.finalStep.dynamicToolResults}get sources(){return this.finalStep.sources}get finishReason(){return this.finalStep.finishReason}get warnings(){return this.finalStep.warnings}get providerMetadata(){return this.finalStep.providerMetadata}get response(){return this.finalStep.response}get request(){return this.finalStep.request}get usage(){return this.finalStep.usage}get totalUsage(){return this.steps.reduce((e,t)=>tU(e,t.usage),{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0,reasoningTokens:void 0,cachedInputTokens:void 0})}get experimental_output(){if(null==this.resolvedOutput)throw new eT;return this.resolvedOutput}};function t6(e){let t=e.filter(e=>"tool-call"===e.type);if(0!==t.length)return t.map(e=>({toolCallId:e.toolCallId,toolName:e.toolName,input:e.input}))}function t7(e,t){let r=new Headers(null!=e?e:{});for(let[e,a]of Object.entries(t))r.has(e)||r.set(e,a);return r}function t5({status:e,statusText:t,headers:r,textStream:a}){return new Response(a.pipeThrough(new TextEncoderStream),{status:null!=e?e:200,statusText:t,headers:t7(r,{"content-type":"text/plain; charset=utf-8"})})}function t3({response:e,status:t,statusText:r,headers:a,stream:o}){e.writeHead(null!=t?t:200,r,a);let n=o.getReader();(async()=>{try{for(;;){let{done:t,value:r}=await n.read();if(t)break;e.write(r)||await new Promise(t=>{e.once("drain",t)})}}catch(e){throw e}finally{e.end()}})()}function t9({response:e,status:t,statusText:r,headers:a,textStream:o}){t3({response:e,status:t,statusText:r,headers:Object.fromEntries(t7(a,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:o.pipeThrough(new TextEncoderStream)})}var re=class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue("data: [DONE]\n\n")}})}},rt={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"};function rr({status:e,statusText:t,headers:r,stream:a,consumeSseStream:o}){let n=a.pipeThrough(new re);if(o){let[e,t]=n.tee();n=e,o({stream:t})}return new Response(n.pipeThrough(new TextEncoderStream),{status:e,statusText:t,headers:t7(r,rt)})}async function ra(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=await (0,E.safeParseJSON)({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await (0,E.safeParseJSON)({text:function(e){let t=["ROOT"],r=-1,a=null;function o(e,o,n){switch(e){case'"':r=o,t.pop(),t.push(n),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=o,a=o,t.pop(),t.push(n),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=o,t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"{":r=o,t.pop(),t.push(n),t.push("INSIDE_OBJECT_START");break;case"[":r=o,t.pop(),t.push(n),t.push("INSIDE_ARRAY_START")}}function n(e,a){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=a,t.pop()}}function s(e,a){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=a,t.pop()}}for(let i=0;i<e.length;i++){let l=e[i];switch(t[t.length-1]){case"ROOT":o(l,i,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=i,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":o(l,i,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(l,i);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),r=i;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=i}break;case"INSIDE_ARRAY_START":"]"===l?(r=i,t.pop()):(r=i,o(l,i,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=i,t.pop();break;default:r=i}break;case"INSIDE_ARRAY_AFTER_COMMA":o(l,i,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=i;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=i;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(l,i),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(l,i);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(l,i);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(l,i);break;default:t.pop()}break;case"INSIDE_LITERAL":{let o=e.substring(a,i+1);"false".startsWith(o)||"true".startsWith(o)||"null".startsWith(o)?r=i:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?n(l,i):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(l,i))}}}let i=e.slice(0,r+1);for(let r=t.length-1;r>=0;r--)switch(t[r]){case"INSIDE_STRING":i+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":i+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":i+="]";break;case"INSIDE_LITERAL":{let t=e.substring(a,e.length);"true".startsWith(t)?i+="true".slice(t.length):"false".startsWith(t)?i+="false".slice(t.length):"null".startsWith(t)&&(i+="null".slice(t.length))}}return i}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}function ro(e){return e.type.startsWith("data-")}function rn(e){return"text"===e.type}function rs(e){return"file"===e.type}function ri(e){return"reasoning"===e.type}function rl(e){return e.type.startsWith("tool-")}function ru(e){return"dynamic-tool"===e.type}(0,E.lazyValidator)(()=>(0,E.zodSchema)(_.z.union([_.z.strictObject({type:_.z.literal("text-start"),id:_.z.string(),providerMetadata:th.optional()}),_.z.strictObject({type:_.z.literal("text-delta"),id:_.z.string(),delta:_.z.string(),providerMetadata:th.optional()}),_.z.strictObject({type:_.z.literal("text-end"),id:_.z.string(),providerMetadata:th.optional()}),_.z.strictObject({type:_.z.literal("error"),errorText:_.z.string()}),_.z.strictObject({type:_.z.literal("tool-input-start"),toolCallId:_.z.string(),toolName:_.z.string(),providerExecuted:_.z.boolean().optional(),dynamic:_.z.boolean().optional()}),_.z.strictObject({type:_.z.literal("tool-input-delta"),toolCallId:_.z.string(),inputTextDelta:_.z.string()}),_.z.strictObject({type:_.z.literal("tool-input-available"),toolCallId:_.z.string(),toolName:_.z.string(),input:_.z.unknown(),providerExecuted:_.z.boolean().optional(),providerMetadata:th.optional(),dynamic:_.z.boolean().optional()}),_.z.strictObject({type:_.z.literal("tool-input-error"),toolCallId:_.z.string(),toolName:_.z.string(),input:_.z.unknown(),providerExecuted:_.z.boolean().optional(),providerMetadata:th.optional(),dynamic:_.z.boolean().optional(),errorText:_.z.string()}),_.z.strictObject({type:_.z.literal("tool-output-available"),toolCallId:_.z.string(),output:_.z.unknown(),providerExecuted:_.z.boolean().optional(),dynamic:_.z.boolean().optional(),preliminary:_.z.boolean().optional()}),_.z.strictObject({type:_.z.literal("tool-output-error"),toolCallId:_.z.string(),errorText:_.z.string(),providerExecuted:_.z.boolean().optional(),dynamic:_.z.boolean().optional()}),_.z.strictObject({type:_.z.literal("reasoning-start"),id:_.z.string(),providerMetadata:th.optional()}),_.z.strictObject({type:_.z.literal("reasoning-delta"),id:_.z.string(),delta:_.z.string(),providerMetadata:th.optional()}),_.z.strictObject({type:_.z.literal("reasoning-end"),id:_.z.string(),providerMetadata:th.optional()}),_.z.strictObject({type:_.z.literal("source-url"),sourceId:_.z.string(),url:_.z.string(),title:_.z.string().optional(),providerMetadata:th.optional()}),_.z.strictObject({type:_.z.literal("source-document"),sourceId:_.z.string(),mediaType:_.z.string(),title:_.z.string(),filename:_.z.string().optional(),providerMetadata:th.optional()}),_.z.strictObject({type:_.z.literal("file"),url:_.z.string(),mediaType:_.z.string(),providerMetadata:th.optional()}),_.z.strictObject({type:_.z.custom(e=>"string"==typeof e&&e.startsWith("data-"),{message:'Type must start with "data-"'}),id:_.z.string().optional(),data:_.z.unknown(),transient:_.z.boolean().optional()}),_.z.strictObject({type:_.z.literal("start-step")}),_.z.strictObject({type:_.z.literal("finish-step")}),_.z.strictObject({type:_.z.literal("start"),messageId:_.z.string().optional(),messageMetadata:_.z.unknown().optional()}),_.z.strictObject({type:_.z.literal("finish"),finishReason:_.z.enum(["stop","length","content-filter","tool-calls","error","other","unknown"]).optional(),messageMetadata:_.z.unknown().optional()}),_.z.strictObject({type:_.z.literal("abort")}),_.z.strictObject({type:_.z.literal("message-metadata"),messageMetadata:_.z.unknown()})])));function rp(e){return e.type.split("-").slice(1).join("-")}function rd({messageId:e,originalMessages:t=[],onFinish:r,onError:a,stream:o}){let n=null==t?void 0:t[t.length-1];(null==n?void 0:n.role)!=="assistant"?n=void 0:e=n.id;let s=!1,i=o.pipeThrough(new TransformStream({transform(t,r){"start"===t.type&&null==t.messageId&&null!=e&&(t.messageId=e),"abort"===t.type&&(s=!0),r.enqueue(t)}}));if(null==r)return i;let l=function({lastMessage:e,messageId:t}){return{message:(null==e?void 0:e.role)==="assistant"?e:{id:t,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}({lastMessage:n?structuredClone(n):void 0,messageId:null!=e?e:""}),u=!1,p=async()=>{if(u||!r)return;u=!0;let e=l.message.id===(null==n?void 0:n.id);await r({isAborted:s,isContinuation:e,responseMessage:l.message,messages:[...e?t.slice(0,-1):t,l.message],finishReason:l.finishReason})};return(function({stream:e,messageMetadataSchema:t,dataPartSchemas:r,runUpdateMessageJob:a,onError:o,onToolCall:n,onData:s}){return e.pipeThrough(new TransformStream({async transform(e,i){await a(async({state:a,write:l})=>{var u,p,d,c;function m(e){let t=a.message.parts.filter(rl).find(t=>t.toolCallId===e);if(null==t)throw Error("tool-output-error must be preceded by a tool-input-available");return t}function h(e){let t=a.message.parts.filter(e=>"dynamic-tool"===e.type).find(t=>t.toolCallId===e);if(null==t)throw Error("tool-output-error must be preceded by a tool-input-available");return t}function g(e){var t;let r=a.message.parts.find(t=>rl(t)&&t.toolCallId===e.toolCallId);null!=r?(r.state=e.state,r.input=e.input,r.output=e.output,r.errorText=e.errorText,r.rawInput=e.rawInput,r.preliminary=e.preliminary,r.providerExecuted=null!=(t=e.providerExecuted)?t:r.providerExecuted,null!=e.providerMetadata&&"input-available"===r.state&&(r.callProviderMetadata=e.providerMetadata)):a.message.parts.push({type:`tool-${e.toolName}`,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,rawInput:e.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted,preliminary:e.preliminary,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}function f(e){var t,r;let o=a.message.parts.find(t=>"dynamic-tool"===t.type&&t.toolCallId===e.toolCallId);null!=o?(o.state=e.state,o.toolName=e.toolName,o.input=e.input,o.output=e.output,o.errorText=e.errorText,o.rawInput=null!=(t=e.rawInput)?t:o.rawInput,o.preliminary=e.preliminary,o.providerExecuted=null!=(r=e.providerExecuted)?r:o.providerExecuted,null!=e.providerMetadata&&"input-available"===o.state&&(o.callProviderMetadata=e.providerMetadata)):a.message.parts.push({type:"dynamic-tool",toolName:e.toolName,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,errorText:e.errorText,preliminary:e.preliminary,providerExecuted:e.providerExecuted,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}async function y(e){if(null!=e){let r=null!=a.message.metadata?function e(t,r){if(void 0===t&&void 0===r)return;if(void 0===t)return r;if(void 0===r)return t;let a={...t};for(let o in r)if(Object.prototype.hasOwnProperty.call(r,o)){let n=r[o];if(void 0===n)continue;let s=o in t?t[o]:void 0,i=null!==n&&"object"==typeof n&&!Array.isArray(n)&&!(n instanceof Date)&&!(n instanceof RegExp),l=null!=s&&"object"==typeof s&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp);i&&l?a[o]=e(s,n):a[o]=n}return a}(a.message.metadata,e):e;null!=t&&await (0,E.validateTypes)({value:r,schema:t}),a.message.metadata=r}}switch(e.type){case"text-start":{let t={type:"text",text:"",providerMetadata:e.providerMetadata,state:"streaming"};a.activeTextParts[e.id]=t,a.message.parts.push(t),l();break}case"text-delta":{let t=a.activeTextParts[e.id];t.text+=e.delta,t.providerMetadata=null!=(u=e.providerMetadata)?u:t.providerMetadata,l();break}case"text-end":{let t=a.activeTextParts[e.id];t.state="done",t.providerMetadata=null!=(p=e.providerMetadata)?p:t.providerMetadata,delete a.activeTextParts[e.id],l();break}case"reasoning-start":{let t={type:"reasoning",text:"",providerMetadata:e.providerMetadata,state:"streaming"};a.activeReasoningParts[e.id]=t,a.message.parts.push(t),l();break}case"reasoning-delta":{let t=a.activeReasoningParts[e.id];t.text+=e.delta,t.providerMetadata=null!=(d=e.providerMetadata)?d:t.providerMetadata,l();break}case"reasoning-end":{let t=a.activeReasoningParts[e.id];t.providerMetadata=null!=(c=e.providerMetadata)?c:t.providerMetadata,t.state="done",delete a.activeReasoningParts[e.id],l();break}case"file":a.message.parts.push({type:"file",mediaType:e.mediaType,url:e.url}),l();break;case"source-url":a.message.parts.push({type:"source-url",sourceId:e.sourceId,url:e.url,title:e.title,providerMetadata:e.providerMetadata}),l();break;case"source-document":a.message.parts.push({type:"source-document",sourceId:e.sourceId,mediaType:e.mediaType,title:e.title,filename:e.filename,providerMetadata:e.providerMetadata}),l();break;case"tool-input-start":{let t=a.message.parts.filter(rl);a.partialToolCalls[e.toolCallId]={text:"",toolName:e.toolName,index:t.length,dynamic:e.dynamic},e.dynamic?f({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted}):g({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted}),l();break}case"tool-input-delta":{let t=a.partialToolCalls[e.toolCallId];t.text+=e.inputTextDelta;let{value:r}=await ra(t.text);t.dynamic?f({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:r}):g({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:r}),l();break}case"tool-input-available":e.dynamic?f({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}):g({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),l(),n&&!e.providerExecuted&&await n({toolCall:e});break;case"tool-input-error":e.dynamic?f({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}):g({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:void 0,rawInput:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),l();break;case"tool-output-available":if(e.dynamic){let t=h(e.toolCallId);f({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-available",input:t.input,output:e.output,preliminary:e.preliminary})}else{let t=m(e.toolCallId);g({toolCallId:e.toolCallId,toolName:rp(t),state:"output-available",input:t.input,output:e.output,providerExecuted:e.providerExecuted,preliminary:e.preliminary})}l();break;case"tool-output-error":if(e.dynamic){let t=h(e.toolCallId);f({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-error",input:t.input,errorText:e.errorText,providerExecuted:e.providerExecuted})}else{let t=m(e.toolCallId);g({toolCallId:e.toolCallId,toolName:rp(t),state:"output-error",input:t.input,rawInput:t.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted})}l();break;case"start-step":a.message.parts.push({type:"step-start"});break;case"finish-step":a.activeTextParts={},a.activeReasoningParts={};break;case"start":null!=e.messageId&&(a.message.id=e.messageId),await y(e.messageMetadata),(null!=e.messageId||null!=e.messageMetadata)&&l();break;case"finish":null!=e.finishReason&&(a.finishReason=e.finishReason),await y(e.messageMetadata),null!=e.messageMetadata&&l();break;case"message-metadata":await y(e.messageMetadata),null!=e.messageMetadata&&l();break;case"error":null==o||o(Error(e.errorText));break;default:if(e.type.startsWith("data-")){if((null==r?void 0:r[e.type])!=null&&await (0,E.validateTypes)({value:e.data,schema:r[e.type]}),e.transient){null==s||s(e);break}let t=null!=e.id?a.message.parts.find(t=>e.type===t.type&&e.id===t.id):void 0;null!=t?t.data=e.data:a.message.parts.push(e),null==s||s(e),l()}}i.enqueue(e)})}}))})({stream:i,runUpdateMessageJob:async e=>{await e({state:l,write:()=>{}})},onError:a}).pipeThrough(new TransformStream({transform(e,t){t.enqueue(e)},async cancel(){await p()},async flush(){await p()}}))}function rc(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=function(){let e=this.getReader(),t=!1;async function r(r){var a;t=!0;try{r&&await (null==(a=e.cancel)?void 0:a.call(e))}finally{try{e.releaseLock()}catch(e){}}}return{async next(){if(t)return{done:!0,value:void 0};let{done:a,value:o}=await e.read();return a?(await r(!0),{done:!0,value:void 0}):{done:!1,value:o}},return:async()=>(await r(!0),{done:!0,value:void 0}),async throw(e){throw await r(!0),e}}},t}async function rm({stream:e,onError:t}){let r=e.getReader();try{for(;;){let{done:e}=await r.read();if(e)break}}catch(e){null==t||t(e)}finally{r.releaseLock()}}function rh(){let e,t;return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}}function rg(){let e=[],t=null,r=!1,a=rh(),o=()=>{r=!0,a.resolve(),e.forEach(e=>e.cancel()),e=[],null==t||t.close()},n=async()=>{if(r&&0===e.length){null==t||t.close();return}if(0===e.length)return a=rh(),await a.promise,n();try{let{value:a,done:o}=await e[0].read();o?(e.shift(),e.length>0?await n():r&&(null==t||t.close())):null==t||t.enqueue(a)}catch(r){null==t||t.error(r),e.shift(),o()}};return{stream:new ReadableStream({start(e){t=e},pull:n,async cancel(){for(let t of e)await t.cancel();e=[],r=!0}}),addStream:t=>{if(r)throw Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader()),a.resolve()},close:()=>{r=!0,a.resolve(),0===e.length&&(null==t||t.close())},terminate:o}}var rf=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise||(this._promise=new Promise((e,t)=>{"resolved"===this.status.type?e(this.status.value):"rejected"===this.status.type&&t(this.status.error),this._resolve=e,this._reject=t})),this._promise}resolve(e){var t;this.status={type:"resolved",value:e},this._promise&&(null==(t=this._resolve)||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this._promise&&(null==(t=this._reject)||t.call(this,e))}};function ry(){var e,t;return null!=(t=null==(e=null==globalThis?void 0:globalThis.performance)?void 0:e.now())?t:Date.now()}var rv=(0,E.createIdGenerator)({prefix:"aitxt",size:24});function rw({model:e,tools:t,toolChoice:r,system:a,prompt:o,messages:n,maxRetries:s,abortSignal:i,headers:l,stopWhen:u=tY(1),experimental_output:p,experimental_telemetry:d,prepareStep:c,providerOptions:m,experimental_activeTools:h,activeTools:g=h,experimental_repairToolCall:f,experimental_transform:y,experimental_download:v,includeRawChunks:w=!1,onChunk:b,onError:I=({error:e})=>{console.error(e)},onFinish:T,onAbort:x,onStepFinish:z,experimental_context:S,_internal:{now:E=ry,generateId:k=rv,currentDate:_=()=>new Date}={},...M}){return new rb({model:ta(e),telemetry:d,headers:l,settings:M,maxRetries:s,abortSignal:i,system:a,prompt:o,messages:n,tools:t,toolChoice:r,transforms:tJ(y),activeTools:g,repairToolCall:f,stopConditions:tJ(u),output:p,providerOptions:m,prepareStep:c,includeRawChunks:w,onChunk:b,onError:I,onFinish:T,onAbort:x,onStepFinish:z,now:E,currentDate:_,generateId:k,experimental_context:S,download:v})}var rb=class{constructor({model:e,telemetry:t,headers:r,settings:a,maxRetries:o,abortSignal:n,system:s,prompt:i,messages:l,tools:u,toolChoice:p,transforms:d,activeTools:c,repairToolCall:m,stopConditions:h,output:g,providerOptions:f,prepareStep:y,includeRawChunks:v,now:w,currentDate:b,generateId:I,onChunk:T,onError:x,onFinish:z,onAbort:S,onStepFinish:k,experimental_context:_,download:M}){let R,C,N,A;this._totalUsage=new rf,this._finishReason=new rf,this._steps=new rf,this.output=g,this.includeRawChunks=v,this.tools=u;let O=[];const j=[];let q={},D=[];const P=[];let U={},$={};const J=new TransformStream({async transform(e,t){var r,a,o,n;t.enqueue(e);let{part:s}=e;if(("text-delta"===s.type||"reasoning-delta"===s.type||"source"===s.type||"tool-call"===s.type||"tool-result"===s.type||"tool-input-start"===s.type||"tool-input-delta"===s.type||"raw"===s.type)&&await (null==T?void 0:T({chunk:s})),"error"===s.type&&await x({error:t_(s.error)}),"text-start"===s.type&&(U[s.id]={type:"text",text:"",providerMetadata:s.providerMetadata},O.push(U[s.id])),"text-delta"===s.type){let e=U[s.id];if(null==e)return void t.enqueue({part:{type:"error",error:`text part ${s.id} not found`},partialOutput:void 0});e.text+=s.text,e.providerMetadata=null!=(r=s.providerMetadata)?r:e.providerMetadata}if("text-end"===s.type){let e=U[s.id];if(null==e)return void t.enqueue({part:{type:"error",error:`text part ${s.id} not found`},partialOutput:void 0});e.providerMetadata=null!=(a=s.providerMetadata)?a:e.providerMetadata,delete U[s.id]}if("reasoning-start"===s.type&&($[s.id]={type:"reasoning",text:"",providerMetadata:s.providerMetadata},O.push($[s.id])),"reasoning-delta"===s.type){let e=$[s.id];if(null==e)return void t.enqueue({part:{type:"error",error:`reasoning part ${s.id} not found`},partialOutput:void 0});e.text+=s.text,e.providerMetadata=null!=(o=s.providerMetadata)?o:e.providerMetadata}if("reasoning-end"===s.type){let e=$[s.id];if(null==e)return void t.enqueue({part:{type:"error",error:`reasoning part ${s.id} not found`},partialOutput:void 0});e.providerMetadata=null!=(n=s.providerMetadata)?n:e.providerMetadata,delete $[s.id]}if("file"===s.type&&O.push({type:"file",file:s.file}),"source"===s.type&&O.push(s),"tool-call"===s.type&&O.push(s),"tool-result"!==s.type||s.preliminary||O.push(s),"tool-error"===s.type&&O.push(s),"start-step"===s.type&&(q=s.request,D=s.warnings),"finish-step"===s.type){let e=t0({content:O,tools:u}),t=new tW({content:O,finishReason:s.finishReason,usage:s.usage,warnings:D,request:q,response:{...s.response,messages:[...j,...e]},providerMetadata:s.providerMetadata});await (null==k?void 0:k(t)),ez(D),P.push(t),O=[],$={},U={},j.push(...e),R.resolve()}"finish"===s.type&&(A=s.totalUsage,N=s.finishReason)},async flush(e){try{if(0===P.length){let e=new e$({message:"No output generated. Check the stream for errors."});Y._finishReason.reject(e),Y._totalUsage.reject(e),Y._steps.reject(e);return}let e=null!=N?N:"unknown",r=null!=A?A:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};Y._finishReason.resolve(e),Y._totalUsage.resolve(r),Y._steps.resolve(P);let a=P[P.length-1];await (null==z?void 0:z({finishReason:e,totalUsage:r,usage:a.usage,content:a.content,text:a.text,reasoningText:a.reasoningText,reasoning:a.reasoning,files:a.files,sources:a.sources,toolCalls:a.toolCalls,staticToolCalls:a.staticToolCalls,dynamicToolCalls:a.dynamicToolCalls,toolResults:a.toolResults,staticToolResults:a.staticToolResults,dynamicToolResults:a.dynamicToolResults,request:a.request,response:a.response,warnings:a.warnings,providerMetadata:a.providerMetadata,steps:P})),C.setAttributes(tD({telemetry:t,attributes:{"ai.response.finishReason":e,"ai.response.text":{output:()=>a.text},"ai.response.toolCalls":{output:()=>{var e;return(null==(e=a.toolCalls)?void 0:e.length)?JSON.stringify(a.toolCalls):void 0}},"ai.response.providerMetadata":JSON.stringify(a.providerMetadata),"ai.usage.inputTokens":r.inputTokens,"ai.usage.outputTokens":r.outputTokens,"ai.usage.totalTokens":r.totalTokens,"ai.usage.reasoningTokens":r.reasoningTokens,"ai.usage.cachedInputTokens":r.cachedInputTokens}}))}catch(t){e.error(t)}finally{C.end()}}}),F=rg();this.addStream=F.addStream,this.closeStream=F.close;const V=F.stream.getReader();let K=new ReadableStream({async start(e){e.enqueue({type:"start"})},async pull(e){function t(){null==S||S({steps:P}),e.enqueue({type:"abort"}),e.close()}try{let{done:r,value:a}=await V.read();if(r)return void e.close();if(null==n?void 0:n.aborted)return void t();e.enqueue(a)}catch(r){(0,E.isAbortError)(r)&&(null==n?void 0:n.aborted)?t():e.error(r)}},cancel:e=>F.stream.cancel(e)});for(const e of d)K=K.pipeThrough(e({tools:u,stopStream(){F.terminate()}}));this.baseStream=K.pipeThrough(function(e){let t;if(!e)return new TransformStream({transform(e,t){t.enqueue({part:e,partialOutput:void 0})}});let r="",a="",o="";function n({controller:e,partialOutput:r}){e.enqueue({part:{type:"text-delta",id:t,text:a},partialOutput:r}),a=""}return new TransformStream({async transform(s,i){if("finish-step"===s.type&&a.length>0&&n({controller:i}),"text-delta"!==s.type&&"text-start"!==s.type&&"text-end"!==s.type)return void i.enqueue({part:s,partialOutput:void 0});if(null==t)t=s.id;else if(s.id!==t)return void i.enqueue({part:s,partialOutput:void 0});if("text-start"===s.type)return void i.enqueue({part:s,partialOutput:void 0});if("text-end"===s.type){a.length>0&&n({controller:i}),i.enqueue({part:s,partialOutput:void 0});return}r+=s.text,a+=s.text;let l=await e.parsePartial({text:r});if(null!=l){let e=JSON.stringify(l.partial);e!==o&&(n({controller:i,partialOutput:l.partial}),o=e)}}})}(g)).pipeThrough(J);const{maxRetries:B,retry:L}=tV({maxRetries:o,abortSignal:n}),H=tO(t),G=td(a),W=tR({model:e,telemetry:t,headers:r,settings:{...G,maxRetries:B}}),Y=this;tj({name:"ai.streamText",attributes:tD({telemetry:t,attributes:{...tM({operationId:"ai.streamText",telemetry:t}),...W,"ai.prompt":{input:()=>JSON.stringify({system:s,prompt:i,messages:l})}}}),tracer:H,endWhenDone:!1,fn:async a=>{async function o({currentStep:a,responseMessages:d,usage:v}){var T,x,z,S,k;let C,N,A=Y.includeRawChunks;R=new rf;let O=await tk({system:s,prompt:i,messages:l}),j=[...O.messages,...d],q=await (null==y?void 0:y({model:e,steps:P,stepNumber:P.length,messages:j})),D=ta(null!=(T=null==q?void 0:q.model)?T:e),U=await tu({prompt:{system:null!=(x=null==q?void 0:q.system)?x:O.system,messages:null!=(z=null==q?void 0:q.messages)?z:j},supportedUrls:await D.supportedUrls,download:M}),{toolChoice:$,tools:J}=tc({tools:u,toolChoice:null!=(S=null==q?void 0:q.toolChoice)?S:p,activeTools:null!=(k=null==q?void 0:q.activeTools)?k:c}),{result:{stream:F,response:V,request:K},doStreamSpan:B,startTimestampMs:Q}=await L(()=>tj({name:"ai.streamText.doStream",attributes:tD({telemetry:t,attributes:{...tM({operationId:"ai.streamText.doStream",telemetry:t}),...W,"ai.model.provider":D.provider,"ai.model.id":D.modelId,"ai.prompt.messages":{input:()=>tP(U)},"ai.prompt.tools":{input:()=>null==J?void 0:J.map(e=>JSON.stringify(e))},"ai.prompt.toolChoice":{input:()=>null!=$?JSON.stringify($):void 0},"gen_ai.system":D.provider,"gen_ai.request.model":D.modelId,"gen_ai.request.frequency_penalty":G.frequencyPenalty,"gen_ai.request.max_tokens":G.maxOutputTokens,"gen_ai.request.presence_penalty":G.presencePenalty,"gen_ai.request.stop_sequences":G.stopSequences,"gen_ai.request.temperature":G.temperature,"gen_ai.request.top_k":G.topK,"gen_ai.request.top_p":G.topP}}),tracer:H,endWhenDone:!1,fn:async e=>({startTimestampMs:w(),doStreamSpan:e,result:await D.doStream({...G,tools:J,toolChoice:$,responseFormat:null==g?void 0:g.responseFormat,prompt:U,providerOptions:f,abortSignal:n,headers:r,includeRawChunks:A})})})),X=function({tools:e,generatorStream:t,tracer:r,telemetry:a,system:o,messages:n,abortSignal:s,repairToolCall:i,experimental_context:l}){let u,p=null,d=new ReadableStream({start(e){p=e}}),c=new Set,m=new Map,h=!1;function g(){h&&0===c.size&&(null!=u&&p.enqueue(u),p.close())}let f=new TransformStream({async transform(t,d){let h=t.type;switch(h){case"stream-start":case"text-start":case"text-delta":case"text-end":case"reasoning-start":case"reasoning-delta":case"reasoning-end":case"tool-input-start":case"tool-input-delta":case"tool-input-end":case"source":case"response-metadata":case"error":case"raw":d.enqueue(t);break;case"file":d.enqueue({type:"file",file:new tL({data:t.data,mediaType:t.mediaType})});break;case"finish":u={type:"finish",finishReason:t.finishReason,usage:t.usage,providerMetadata:t.providerMetadata};break;case"tool-call":try{let u=await tH({toolCall:t,tools:e,repairToolCall:i,system:o,messages:n});if(d.enqueue(u),u.invalid){p.enqueue({type:"tool-error",toolCallId:u.toolCallId,toolName:u.toolName,input:u.input,error:(0,E.getErrorMessage)(u.error),dynamic:!0});break}let h=e[u.toolName];if(m.set(u.toolCallId,u.input),null!=h.onInputAvailable&&await h.onInputAvailable({input:u.input,toolCallId:u.toolCallId,messages:n,abortSignal:s,experimental_context:l}),null!=h.execute&&!0!==u.providerExecuted){let e=(0,E.generateId)();c.add(e),tj({name:"ai.toolCall",attributes:tD({telemetry:a,attributes:{...tM({operationId:"ai.toolCall",telemetry:a}),"ai.toolCall.name":u.toolName,"ai.toolCall.id":u.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(u.input)}}}),tracer:r,fn:async t=>{let r;try{for await(let e of(0,E.executeTool)({execute:h.execute.bind(h),input:u.input,options:{toolCallId:u.toolCallId,messages:n,abortSignal:s,experimental_context:l}}))p.enqueue({...u,type:"tool-result",output:e.output,..."preliminary"===e.type&&{preliminary:!0}}),"final"===e.type&&(r=e.output)}catch(r){tq(t,r),p.enqueue({...u,type:"tool-error",error:r}),c.delete(e),g();return}c.delete(e),g();try{t.setAttributes(tD({telemetry:a,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(r)}}}))}catch(e){}}})}}catch(e){p.enqueue({type:"error",error:e})}break;case"tool-result":{let e=t.toolName;t.isError?p.enqueue({type:"tool-error",toolCallId:t.toolCallId,toolName:e,input:m.get(t.toolCallId),providerExecuted:t.providerExecuted,error:t.result}):d.enqueue({type:"tool-result",toolCallId:t.toolCallId,toolName:e,input:m.get(t.toolCallId),output:t.result,providerExecuted:t.providerExecuted});break}default:throw Error(`Unhandled chunk type: ${h}`)}},flush(){h=!0,g()}});return new ReadableStream({start:async e=>Promise.all([t.pipeThrough(f).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),d.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])})}({tools:u,generatorStream:F,tracer:H,telemetry:t,system:s,messages:j,repairToolCall:m,abortSignal:n,experimental_context:_}),Z=null!=K?K:{},ee=[],et=[],er={},ea="unknown",eo={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},en=!0,es={id:I(),timestamp:b(),modelId:e.modelId},ei="";Y.addStream(X.pipeThrough(new TransformStream({async transform(e,t){var r,a,o,s;if("stream-start"===e.type){C=e.warnings;return}if(en){let e=w()-Q;en=!1,B.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":e}),B.setAttributes({"ai.response.msToFirstChunk":e}),t.enqueue({type:"start-step",request:Z,warnings:null!=C?C:[]})}let i=e.type;switch(i){case"text-start":case"text-end":case"reasoning-start":case"reasoning-end":case"file":case"source":t.enqueue(e);break;case"text-delta":e.delta.length>0&&(t.enqueue({type:"text-delta",id:e.id,text:e.delta,providerMetadata:e.providerMetadata}),ei+=e.delta);break;case"reasoning-delta":t.enqueue({type:"reasoning-delta",id:e.id,text:e.delta,providerMetadata:e.providerMetadata});break;case"tool-call":t.enqueue(e),ee.push(e);break;case"tool-result":t.enqueue(e),e.preliminary||et.push(e);break;case"tool-error":t.enqueue(e),et.push(e);break;case"response-metadata":es={id:null!=(r=e.id)?r:es.id,timestamp:null!=(a=e.timestamp)?a:es.timestamp,modelId:null!=(o=e.modelId)?o:es.modelId};break;case"finish":{eo=e.usage,ea=e.finishReason,N=e.providerMetadata;let t=w()-Q;B.addEvent("ai.stream.finish"),B.setAttributes({"ai.response.msToFinish":t,"ai.response.avgOutputTokensPerSecond":1e3*(null!=(s=eo.outputTokens)?s:0)/t});break}case"tool-input-start":{er[e.id]=e.toolName;let r=null==u?void 0:u[e.toolName];(null==r?void 0:r.onInputStart)!=null&&await r.onInputStart({toolCallId:e.id,messages:j,abortSignal:n,experimental_context:_}),t.enqueue({...e,dynamic:(null==r?void 0:r.type)==="dynamic"});break}case"tool-input-end":delete er[e.id],t.enqueue(e);break;case"tool-input-delta":{let r=er[e.id],a=null==u?void 0:u[r];(null==a?void 0:a.onInputDelta)!=null&&await a.onInputDelta({inputTextDelta:e.delta,toolCallId:e.id,messages:j,abortSignal:n,experimental_context:_}),t.enqueue(e);break}case"error":t.enqueue(e),ea="error";break;case"raw":A&&t.enqueue(e);break;default:throw Error(`Unknown chunk type: ${i}`)}},async flush(e){let r=ee.length>0?JSON.stringify(ee):void 0;try{B.setAttributes(tD({telemetry:t,attributes:{"ai.response.finishReason":ea,"ai.response.text":{output:()=>ei},"ai.response.toolCalls":{output:()=>r},"ai.response.id":es.id,"ai.response.model":es.modelId,"ai.response.timestamp":es.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(N),"ai.usage.inputTokens":eo.inputTokens,"ai.usage.outputTokens":eo.outputTokens,"ai.usage.totalTokens":eo.totalTokens,"ai.usage.reasoningTokens":eo.reasoningTokens,"ai.usage.cachedInputTokens":eo.cachedInputTokens,"gen_ai.response.finish_reasons":[ea],"gen_ai.response.id":es.id,"gen_ai.response.model":es.modelId,"gen_ai.usage.input_tokens":eo.inputTokens,"gen_ai.usage.output_tokens":eo.outputTokens}}))}catch(e){}finally{B.end()}e.enqueue({type:"finish-step",finishReason:ea,usage:eo,providerMetadata:N,response:{...es,headers:null==V?void 0:V.headers}});let n=tU(v,eo);await R.promise;let s=ee.filter(e=>!0!==e.providerExecuted),i=et.filter(e=>!0!==e.providerExecuted);if(s.length>0&&i.length===s.length&&!await tQ({stopConditions:h,steps:P})){d.push(...t0({content:P[P.length-1].content,tools:u}));try{await o({currentStep:a+1,responseMessages:d,usage:n})}catch(t){e.enqueue({type:"error",error:t}),Y.closeStream()}}else e.enqueue({type:"finish",finishReason:ea,totalUsage:n}),Y.closeStream()}})))}C=a,await o({currentStep:0,responseMessages:[],usage:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0}})}}).catch(e=>{Y.addStream(new ReadableStream({start(t){t.enqueue({type:"error",error:e}),t.close()}})),Y.closeStream()})}get steps(){return this.consumeStream(),this._steps.promise}get finalStep(){return this.steps.then(e=>e[e.length-1])}get content(){return this.finalStep.then(e=>e.content)}get warnings(){return this.finalStep.then(e=>e.warnings)}get providerMetadata(){return this.finalStep.then(e=>e.providerMetadata)}get text(){return this.finalStep.then(e=>e.text)}get reasoningText(){return this.finalStep.then(e=>e.reasoningText)}get reasoning(){return this.finalStep.then(e=>e.reasoning)}get sources(){return this.finalStep.then(e=>e.sources)}get files(){return this.finalStep.then(e=>e.files)}get toolCalls(){return this.finalStep.then(e=>e.toolCalls)}get staticToolCalls(){return this.finalStep.then(e=>e.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then(e=>e.dynamicToolCalls)}get toolResults(){return this.finalStep.then(e=>e.toolResults)}get staticToolResults(){return this.finalStep.then(e=>e.staticToolResults)}get dynamicToolResults(){return this.finalStep.then(e=>e.dynamicToolResults)}get usage(){return this.finalStep.then(e=>e.usage)}get request(){return this.finalStep.then(e=>e.request)}get response(){return this.finalStep.then(e=>e.response)}get totalUsage(){return this.consumeStream(),this._totalUsage.promise}get finishReason(){return this.consumeStream(),this._finishReason.promise}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return rc(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){"text-delta"===e.type&&t.enqueue(e.text)}})))}get fullStream(){return rc(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await rm({stream:this.fullStream,onError:null==e?void 0:e.onError})}catch(r){null==(t=null==e?void 0:e.onError)||t.call(e,r)}}get experimental_partialOutputStream(){if(null==this.output)throw new eT;return rc(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){null!=e&&t.enqueue(e)}})))}toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:a,sendReasoning:o=!0,sendSources:n=!1,sendStart:s=!0,sendFinish:i=!0,onError:l=eg.getErrorMessage}={}){let u=null!=t?function({originalMessages:e,responseMessageId:t}){if(null==e)return;let r=e[e.length-1];return(null==r?void 0:r.role)==="assistant"?r.id:"function"==typeof t?t():t}({originalMessages:e,responseMessageId:t}):void 0,p={},d=e=>{var t,r;let a=p[e];return(null==(r=null==(t=this.tools)?void 0:t[a])?void 0:r.type)==="dynamic"||void 0};return rc(rd({stream:this.fullStream.pipeThrough(new TransformStream({transform:async(e,t)=>{let r=null==a?void 0:a({part:e}),c=e.type;switch(c){case"text-start":t.enqueue({type:"text-start",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"text-delta":t.enqueue({type:"text-delta",id:e.id,delta:e.text,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"text-end":t.enqueue({type:"text-end",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"reasoning-start":t.enqueue({type:"reasoning-start",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"reasoning-delta":o&&t.enqueue({type:"reasoning-delta",id:e.id,delta:e.text,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"reasoning-end":t.enqueue({type:"reasoning-end",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"file":t.enqueue({type:"file",mediaType:e.file.mediaType,url:`data:${e.file.mediaType};base64,${e.file.base64}`});break;case"source":n&&"url"===e.sourceType&&t.enqueue({type:"source-url",sourceId:e.id,url:e.url,title:e.title,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}}),n&&"document"===e.sourceType&&t.enqueue({type:"source-document",sourceId:e.id,mediaType:e.mediaType,title:e.title,filename:e.filename,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"tool-input-start":{p[e.id]=e.toolName;let r=d(e.id);t.enqueue({type:"tool-input-start",toolCallId:e.id,toolName:e.toolName,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=r?{dynamic:r}:{}});break}case"tool-input-delta":t.enqueue({type:"tool-input-delta",toolCallId:e.id,inputTextDelta:e.delta});break;case"tool-call":{p[e.toolCallId]=e.toolName;let r=d(e.toolCallId);e.invalid?t.enqueue({type:"tool-input-error",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{},...null!=r?{dynamic:r}:{},errorText:l(e.error)}):t.enqueue({type:"tool-input-available",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{},...null!=r?{dynamic:r}:{}});break}case"tool-result":{let r=d(e.toolCallId);t.enqueue({type:"tool-output-available",toolCallId:e.toolCallId,output:e.output,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=e.preliminary?{preliminary:e.preliminary}:{},...null!=r?{dynamic:r}:{}});break}case"tool-error":{let r=d(e.toolCallId);t.enqueue({type:"tool-output-error",toolCallId:e.toolCallId,errorText:l(e.error),...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=r?{dynamic:r}:{}});break}case"error":t.enqueue({type:"error",errorText:l(e.error)});break;case"start-step":t.enqueue({type:"start-step"});break;case"finish-step":t.enqueue({type:"finish-step"});break;case"start":s&&t.enqueue({type:"start",...null!=r?{messageMetadata:r}:{},...null!=u?{messageId:u}:{}});break;case"finish":i&&t.enqueue({type:"finish",finishReason:e.finishReason,...null!=r?{messageMetadata:r}:{}});break;case"abort":t.enqueue(e);break;case"tool-input-end":case"raw":break;default:throw Error(`Unknown chunk type: ${c}`)}null!=r&&"start"!==c&&"finish"!==c&&t.enqueue({type:"message-metadata",messageMetadata:r})}})),messageId:null!=u?u:null==t?void 0:t(),originalMessages:e,onFinish:r,onError:l}))}pipeUIMessageStreamToResponse(e,{originalMessages:t,generateMessageId:r,onFinish:a,messageMetadata:o,sendReasoning:n,sendSources:s,sendFinish:i,sendStart:l,onError:u,...p}={}){!function({response:e,status:t,statusText:r,headers:a,stream:o,consumeSseStream:n}){let s=o.pipeThrough(new re);if(n){let[e,t]=s.tee();s=e,n({stream:t})}t3({response:e,status:t,statusText:r,headers:Object.fromEntries(t7(a,rt).entries()),stream:s.pipeThrough(new TextEncoderStream)})}({response:e,stream:this.toUIMessageStream({originalMessages:t,generateMessageId:r,onFinish:a,messageMetadata:o,sendReasoning:n,sendSources:s,sendFinish:i,sendStart:l,onError:u}),...p})}pipeTextStreamToResponse(e,t){t9({response:e,textStream:this.textStream,...t})}toUIMessageStreamResponse({originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:a,sendReasoning:o,sendSources:n,sendFinish:s,sendStart:i,onError:l,...u}={}){return rr({stream:this.toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:a,sendReasoning:o,sendSources:n,sendFinish:s,sendStart:i,onError:l}),...u})}toTextStreamResponse(e){return t5({textStream:this.textStream,...e})}};function rI(e,t){let r=[];for(let o of((null==t?void 0:t.ignoreIncompleteToolCalls)&&(e=e.map(e=>({...e,parts:e.parts.filter(e=>!(rl(e)||ru(e))||"input-streaming"!==e.state&&"input-available"!==e.state)}))),e))switch(o.role){case"system":{let e=o.parts.filter(e=>"text"===e.type),t=e.reduce((e,t)=>null!=t.providerMetadata?{...e,...t.providerMetadata}:e,{});r.push({role:"system",content:e.map(e=>e.text).join(""),...Object.keys(t).length>0?{providerOptions:t}:{}});break}case"user":r.push({role:"user",content:o.parts.map(e=>{var r;return rn(e)?{type:"text",text:e.text,...null!=e.providerMetadata?{providerOptions:e.providerMetadata}:{}}:rs(e)?{type:"file",mediaType:e.mediaType,filename:e.filename,data:e.url,...null!=e.providerMetadata?{providerOptions:e.providerMetadata}:{}}:ro(e)?null==(r=null==t?void 0:t.convertDataPart)?void 0:r.call(t,e):void 0}).filter(e=>null!=e)});break;case"assistant":if(null!=o.parts){let e=function(){var e,a,o;if(0===n.length)return;let s=[];for(let r of n)if(rn(r))s.push({type:"text",text:r.text,...null!=r.providerMetadata?{providerOptions:r.providerMetadata}:{}});else if(rs(r))s.push({type:"file",mediaType:r.mediaType,filename:r.filename,data:r.url});else if(ri(r))s.push({type:"reasoning",text:r.text,providerOptions:r.providerMetadata});else if(ru(r)){let e=r.toolName;"input-streaming"!==r.state&&s.push({type:"tool-call",toolCallId:r.toolCallId,toolName:e,input:r.input,...null!=r.callProviderMetadata?{providerOptions:r.callProviderMetadata}:{}})}else if(rl(r)){let o=rp(r);"input-streaming"!==r.state&&(s.push({type:"tool-call",toolCallId:r.toolCallId,toolName:o,input:"output-error"===r.state?null!=(e=r.input)?e:r.rawInput:r.input,providerExecuted:r.providerExecuted,...null!=r.callProviderMetadata?{providerOptions:r.callProviderMetadata}:{}}),!0===r.providerExecuted&&("output-available"===r.state||"output-error"===r.state)&&s.push({type:"tool-result",toolCallId:r.toolCallId,toolName:o,output:tX({output:"output-error"===r.state?r.errorText:r.output,tool:null==(a=null==t?void 0:t.tools)?void 0:a[o],errorMode:"output-error"===r.state?"json":"none"})}))}else if(ro(r)){let e=null==(o=null==t?void 0:t.convertDataPart)?void 0:o.call(t,r);null!=e&&s.push(e)}else throw Error(`Unsupported part: ${r}`);r.push({role:"assistant",content:s});let i=n.filter(e=>rl(e)&&!0!==e.providerExecuted||"dynamic-tool"===e.type);i.length>0&&r.push({role:"tool",content:i.map(e=>{var r;switch(e.state){case"output-error":case"output-available":{let a=ru(e)?e.toolName:rp(e);return{type:"tool-result",toolCallId:e.toolCallId,toolName:a,output:tX({output:"output-error"===e.state?e.errorText:e.output,tool:null==(r=null==t?void 0:t.tools)?void 0:r[a],errorMode:"output-error"===e.state?"text":"none"})}}default:return null}}).filter(e=>null!=e)}),n=[]},n=[];for(let t of o.parts){var a;rn(t)||ri(t)||rs(t)||rl(a=t)||ru(a)||ro(t)?n.push(t):"step-start"===t.type&&e()}e()}break;default:{let e=o.role;throw new e8({originalMessage:o,message:`Unsupported role: ${e}`})}}return r}var rT=class{constructor(e){this.settings=e}get tools(){return this.settings.tools}async generate(e){return t2({...this.settings,...e})}stream(e){return rw({...this.settings,...e})}respond(e){return this.stream({prompt:rI(e.messages)}).toUIMessageStreamResponse()}},rx={type:"no-schema",jsonSchema:void 0,validatePartialResult:async({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:async(e,t)=>void 0===e?{success:!1,error:new eq({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage,finishReason:t.finishReason})}:{success:!0,value:e},createElementStream(){throw new eg.UnsupportedFunctionalityError({functionality:"element streams in no-schema mode"})}};function rz({output:e,schema:t,enumValues:r}){switch(e){case"object":let a;return{type:"object",jsonSchema:(a=(0,E.asSchema)(t)).jsonSchema,validatePartialResult:async({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:async e=>(0,E.safeValidateTypes)({value:e,schema:a}),createElementStream(){throw new eg.UnsupportedFunctionalityError({functionality:"element streams in object mode"})}};case"array":return(e=>{let{$schema:t,...r}=e.jsonSchema;return{type:"array",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:r}},required:["elements"],additionalProperties:!1},async validatePartialResult({value:t,latestObject:r,isFirstDelta:a,isFinalDelta:o}){var n;if(!(0,eg.isJSONObject)(t)||!(0,eg.isJSONArray)(t.elements))return{success:!1,error:new eg.TypeValidationError({value:t,cause:"value must be an object that contains an array of elements"})};let s=t.elements,i=[];for(let t=0;t<s.length;t++){let r=s[t],a=await (0,E.safeValidateTypes)({value:r,schema:e});if(t!==s.length-1||o){if(!a.success)return a;i.push(a.value)}}let l=null!=(n=null==r?void 0:r.length)?n:0,u="";return a&&(u+="["),l>0&&(u+=","),u+=i.slice(l).map(e=>JSON.stringify(e)).join(","),o&&(u+="]"),{success:!0,value:{partial:i,textDelta:u}}},async validateFinalResult(t){if(!(0,eg.isJSONObject)(t)||!(0,eg.isJSONArray)(t.elements))return{success:!1,error:new eg.TypeValidationError({value:t,cause:"value must be an object that contains an array of elements"})};let r=t.elements;for(let t of r){let r=await (0,E.safeValidateTypes)({value:t,schema:e});if(!r.success)return r}return{success:!0,value:r}},createElementStream(e){let t=0;return rc(e.pipeThrough(new TransformStream({transform(e,r){switch(e.type){case"object":{let a=e.object;for(;t<a.length;t++)r.enqueue(a[t]);break}case"text-delta":case"finish":case"error":break;default:throw Error(`Unsupported chunk type: ${e}`)}}})))}}})((0,E.asSchema)(t));case"enum":return{type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:r}},required:["result"],additionalProperties:!1},async validateFinalResult(e){if(!(0,eg.isJSONObject)(e)||"string"!=typeof e.result)return{success:!1,error:new eg.TypeValidationError({value:e,cause:'value must be an object that contains a string in the "result" property.'})};let t=e.result;return r.includes(t)?{success:!0,value:t}:{success:!1,error:new eg.TypeValidationError({value:e,cause:"value must be a string in the enum"})}},async validatePartialResult({value:e,textDelta:t}){if(!(0,eg.isJSONObject)(e)||"string"!=typeof e.result)return{success:!1,error:new eg.TypeValidationError({value:e,cause:'value must be an object that contains a string in the "result" property.'})};let a=e.result,o=r.filter(e=>e.startsWith(a));return 0===e.result.length||0===o.length?{success:!1,error:new eg.TypeValidationError({value:e,cause:"value must be a string in the enum"})}:{success:!0,value:{partial:o.length>1?a:o[0],textDelta:t}}},createElementStream(){throw new eg.UnsupportedFunctionalityError({functionality:"element streams in enum mode"})}};case"no-schema":return rx;default:throw Error(`Unsupported output: ${e}`)}}async function rS(e,t,r){let a=await (0,E.safeParseJSON)({text:e});if(!a.success)throw new eq({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});let o=await t.validateFinalResult(a.value,{text:e,response:r.response,usage:r.usage});if(!o.success)throw new eq({message:"No object generated: response did not match schema.",cause:o.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});return o.value}async function rE(e,t,r,a){try{return await rS(e,t,a)}catch(o){if(null!=r&&eq.isInstance(o)&&(eg.JSONParseError.isInstance(o.cause)||eg.TypeValidationError.isInstance(o.cause))){let n=await r({text:e,error:o.cause});if(null===n)throw o;return await rS(n,t,a)}throw o}}function rk({output:e,schema:t,schemaName:r,schemaDescription:a,enumValues:o}){if(null!=e&&"object"!==e&&"array"!==e&&"enum"!==e&&"no-schema"!==e)throw new e_({parameter:"output",value:e,message:"Invalid output type."});if("no-schema"===e){if(null!=t)throw new e_({parameter:"schema",value:t,message:"Schema is not supported for no-schema output."});if(null!=a)throw new e_({parameter:"schemaDescription",value:a,message:"Schema description is not supported for no-schema output."});if(null!=r)throw new e_({parameter:"schemaName",value:r,message:"Schema name is not supported for no-schema output."});if(null!=o)throw new e_({parameter:"enumValues",value:o,message:"Enum values are not supported for no-schema output."})}if("object"===e){if(null==t)throw new e_({parameter:"schema",value:t,message:"Schema is required for object output."});if(null!=o)throw new e_({parameter:"enumValues",value:o,message:"Enum values are not supported for object output."})}if("array"===e){if(null==t)throw new e_({parameter:"schema",value:t,message:"Element schema is required for array output."});if(null!=o)throw new e_({parameter:"enumValues",value:o,message:"Enum values are not supported for array output."})}if("enum"===e){if(null!=t)throw new e_({parameter:"schema",value:t,message:"Schema is not supported for enum output."});if(null!=a)throw new e_({parameter:"schemaDescription",value:a,message:"Schema description is not supported for enum output."});if(null!=r)throw new e_({parameter:"schemaName",value:r,message:"Schema name is not supported for enum output."});if(null==o)throw new e_({parameter:"enumValues",value:o,message:"Enum values are required for enum output."});for(let e of o)if("string"!=typeof e)throw new e_({parameter:"enumValues",value:e,message:"Enum values must be strings."})}}var r_=(0,E.createIdGenerator)({prefix:"aiobj",size:24});async function rM(e){let{model:t,output:r="object",system:a,prompt:o,messages:n,maxRetries:s,abortSignal:i,headers:l,experimental_repairText:u,experimental_telemetry:p,experimental_download:d,providerOptions:c,_internal:{generateId:m=r_,currentDate:h=()=>new Date}={},...g}=e,f=ta(t),y="enum"in e?e.enum:void 0,{schema:v,schemaDescription:w,schemaName:b}="schema"in e?e:{};rk({output:r,schema:v,schemaName:b,schemaDescription:w,enumValues:y});let{maxRetries:I,retry:T}=tV({maxRetries:s,abortSignal:i}),x=rz({output:r,schema:v,enumValues:y}),z=td(g),S=(0,E.withUserAgentSuffix)(null!=l?l:{},`ai/${tn}`),k=tR({model:f,telemetry:p,headers:S,settings:{...z,maxRetries:I}}),_=tO(p);try{return await tj({name:"ai.generateObject",attributes:tD({telemetry:p,attributes:{...tM({operationId:"ai.generateObject",telemetry:p}),...k,"ai.prompt":{input:()=>JSON.stringify({system:a,prompt:o,messages:n})},"ai.schema":null!=x.jsonSchema?{input:()=>JSON.stringify(x.jsonSchema)}:void 0,"ai.schema.name":b,"ai.schema.description":w,"ai.settings.output":x.type}}),tracer:_,fn:async e=>{var t;let r,s,l,y,v,I,E,M,R=await tk({system:a,prompt:o,messages:n}),C=await tu({prompt:R,supportedUrls:await f.supportedUrls,download:d}),N=await T(()=>tj({name:"ai.generateObject.doGenerate",attributes:tD({telemetry:p,attributes:{...tM({operationId:"ai.generateObject.doGenerate",telemetry:p}),...k,"ai.prompt.messages":{input:()=>tP(C)},"gen_ai.system":f.provider,"gen_ai.request.model":f.modelId,"gen_ai.request.frequency_penalty":z.frequencyPenalty,"gen_ai.request.max_tokens":z.maxOutputTokens,"gen_ai.request.presence_penalty":z.presencePenalty,"gen_ai.request.temperature":z.temperature,"gen_ai.request.top_k":z.topK,"gen_ai.request.top_p":z.topP}}),tracer:_,fn:async e=>{var t,r,a,o,n,s,l,u;let d,y=await f.doGenerate({responseFormat:{type:"json",schema:x.jsonSchema,name:b,description:w},...td(g),prompt:C,providerOptions:c,abortSignal:i,headers:S}),v={id:null!=(r=null==(t=y.response)?void 0:t.id)?r:m(),timestamp:null!=(o=null==(a=y.response)?void 0:a.timestamp)?o:h(),modelId:null!=(s=null==(n=y.response)?void 0:n.modelId)?s:f.modelId,headers:null==(l=y.response)?void 0:l.headers,body:null==(u=y.response)?void 0:u.body},I=tK(y.content),T=(d=y.content.filter(e=>"reasoning"===e.type),0===d.length?void 0:d.map(e=>e.text).join("\n"));if(void 0===I)throw new eq({message:"No object generated: the model did not return a response.",response:v,usage:y.usage,finishReason:y.finishReason});return e.setAttributes(tD({telemetry:p,attributes:{"ai.response.finishReason":y.finishReason,"ai.response.object":{output:()=>I},"ai.response.id":v.id,"ai.response.model":v.modelId,"ai.response.timestamp":v.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(y.providerMetadata),"ai.usage.promptTokens":y.usage.inputTokens,"ai.usage.completionTokens":y.usage.outputTokens,"gen_ai.response.finish_reasons":[y.finishReason],"gen_ai.response.id":v.id,"gen_ai.response.model":v.modelId,"gen_ai.usage.input_tokens":y.usage.inputTokens,"gen_ai.usage.output_tokens":y.usage.outputTokens}})),{...y,objectText:I,reasoning:T,responseData:v}}}));r=N.objectText,s=N.finishReason,l=N.usage,y=N.warnings,E=N.providerMetadata,I=null!=(t=N.request)?t:{},v=N.responseData,M=N.reasoning,ez(y);let A=await rE(r,x,u,{response:v,usage:l,finishReason:s});return e.setAttributes(tD({telemetry:p,attributes:{"ai.response.finishReason":s,"ai.response.object":{output:()=>JSON.stringify(A)},"ai.response.providerMetadata":JSON.stringify(E),"ai.usage.promptTokens":l.inputTokens,"ai.usage.completionTokens":l.outputTokens}})),new rR({object:A,reasoning:M,finishReason:s,usage:l,warnings:y,request:I,response:v,providerMetadata:E})}})}catch(e){throw t_(e)}}var rR=class{constructor(e){this.object=e.object,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.response=e.response,this.request=e.request,this.reasoning=e.reasoning}toJsonResponse(e){var t;return new Response(JSON.stringify(this.object),{status:null!=(t=null==e?void 0:e.status)?t:200,headers:t7(null==e?void 0:e.headers,{"content-type":"application/json; charset=utf-8"})})}};function rC(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if("object"!=typeof e&&"object"!=typeof t)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!rC(e[r],t[r]))return!1;return!0}let r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(let o of r)if(!a.includes(o)||!rC(e[o],t[o]))return!1;return!0}var rN=(0,E.createIdGenerator)({prefix:"aiobj",size:24});function rA(e){let{model:t,output:r="object",system:a,prompt:o,messages:n,maxRetries:s,abortSignal:i,headers:l,experimental_repairText:u,experimental_telemetry:p,experimental_download:d,providerOptions:c,onError:m=({error:e})=>{console.error(e)},onFinish:h,_internal:{generateId:g=rN,currentDate:f=()=>new Date,now:y=ry}={},...v}=e,w="enum"in e&&e.enum?e.enum:void 0,{schema:b,schemaDescription:I,schemaName:T}="schema"in e?e:{};return rk({output:r,schema:b,schemaName:T,schemaDescription:I,enumValues:w}),new rO({model:t,telemetry:p,headers:l,settings:v,maxRetries:s,abortSignal:i,outputStrategy:rz({output:r,schema:b,enumValues:w}),system:a,prompt:o,messages:n,schemaName:T,schemaDescription:I,providerOptions:c,repairText:u,onError:m,onFinish:h,download:d,generateId:g,currentDate:f,now:y})}var rO=class{constructor({model:e,headers:t,telemetry:r,settings:a,maxRetries:o,abortSignal:n,outputStrategy:s,system:i,prompt:l,messages:u,schemaName:p,schemaDescription:d,providerOptions:c,repairText:m,onError:h,onFinish:g,download:f,generateId:y,currentDate:v,now:w}){this._object=new rf,this._usage=new rf,this._providerMetadata=new rf,this._warnings=new rf,this._request=new rf,this._response=new rf,this._finishReason=new rf;const b=ta(e),{maxRetries:I,retry:T}=tV({maxRetries:o,abortSignal:n}),x=td(a),z=tR({model:b,telemetry:r,headers:t,settings:{...x,maxRetries:I}}),S=tO(r),E=this,k=rg(),_=new TransformStream({transform(e,t){t.enqueue(e),"error"===e.type&&h({error:t_(e.error)})}});this.baseStream=k.stream.pipeThrough(_),tj({name:"ai.streamObject",attributes:tD({telemetry:r,attributes:{...tM({operationId:"ai.streamObject",telemetry:r}),...z,"ai.prompt":{input:()=>JSON.stringify({system:i,prompt:l,messages:u})},"ai.schema":null!=s.jsonSchema?{input:()=>JSON.stringify(s.jsonSchema)}:void 0,"ai.schema.name":p,"ai.schema.description":d,"ai.settings.output":s.type}}),tracer:S,endWhenDone:!1,fn:async e=>{let o,h,I,_,M,R,C,N=await tk({system:i,prompt:l,messages:u}),A={responseFormat:{type:"json",schema:s.jsonSchema,name:p,description:d},...td(a),prompt:await tu({prompt:N,supportedUrls:await b.supportedUrls,download:f}),providerOptions:c,abortSignal:n,headers:t,includeRawChunks:!1},{result:{stream:O,response:j,request:q},doStreamSpan:D,startTimestampMs:P}=await T(()=>tj({name:"ai.streamObject.doStream",attributes:tD({telemetry:r,attributes:{...tM({operationId:"ai.streamObject.doStream",telemetry:r}),...z,"ai.prompt.messages":{input:()=>tP(A.prompt)},"gen_ai.system":b.provider,"gen_ai.request.model":b.modelId,"gen_ai.request.frequency_penalty":x.frequencyPenalty,"gen_ai.request.max_tokens":x.maxOutputTokens,"gen_ai.request.presence_penalty":x.presencePenalty,"gen_ai.request.temperature":x.temperature,"gen_ai.request.top_k":x.topK,"gen_ai.request.top_p":x.topP}}),tracer:S,endWhenDone:!1,fn:async e=>({startTimestampMs:w(),doStreamSpan:e,result:await b.doStream(A)})}));E._request.resolve(null!=q?q:{});let U={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},$="",J="",F={id:y(),timestamp:v(),modelId:b.modelId},V=!0,K=!0,B=O.pipeThrough(new TransformStream({transform:(e,t)=>{switch(e.type){case"text-delta":t.enqueue(e.delta);break;case"response-metadata":case"finish":case"error":case"stream-start":t.enqueue(e)}}})).pipeThrough(new TransformStream({async transform(e,t){var r,a,n;if("object"==typeof e&&"stream-start"===e.type){o=e.warnings;return}if(V){let e=w()-P;V=!1,D.addEvent("ai.stream.firstChunk",{"ai.stream.msToFirstChunk":e}),D.setAttributes({"ai.stream.msToFirstChunk":e})}if("string"==typeof e){$+=e,J+=e;let{value:r,state:a}=await ra($);if(void 0!==r&&!rC(R,r)){let e=await s.validatePartialResult({value:r,textDelta:J,latestObject:C,isFirstDelta:K,isFinalDelta:"successful-parse"===a});e.success&&!rC(C,e.value.partial)&&(R=r,C=e.value.partial,t.enqueue({type:"object",object:C}),t.enqueue({type:"text-delta",textDelta:e.value.textDelta}),J="",K=!1)}return}switch(e.type){case"response-metadata":F={id:null!=(r=e.id)?r:F.id,timestamp:null!=(a=e.timestamp)?a:F.timestamp,modelId:null!=(n=e.modelId)?n:F.modelId};break;case"finish":""!==J&&t.enqueue({type:"text-delta",textDelta:J}),h=e.finishReason,U=e.usage,I=e.providerMetadata,t.enqueue({...e,usage:U,response:F}),ez(null!=o?o:[]),E._usage.resolve(U),E._providerMetadata.resolve(I),E._warnings.resolve(o),E._response.resolve({...F,headers:null==j?void 0:j.headers}),E._finishReason.resolve(null!=h?h:"unknown");try{_=await rE($,s,m,{response:F,usage:U,finishReason:h}),E._object.resolve(_)}catch(e){M=e,E._object.reject(e)}break;default:t.enqueue(e)}},async flush(t){try{let t=null!=U?U:{promptTokens:NaN,completionTokens:NaN,totalTokens:NaN};D.setAttributes(tD({telemetry:r,attributes:{"ai.response.finishReason":h,"ai.response.object":{output:()=>JSON.stringify(_)},"ai.response.id":F.id,"ai.response.model":F.modelId,"ai.response.timestamp":F.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(I),"ai.usage.inputTokens":t.inputTokens,"ai.usage.outputTokens":t.outputTokens,"ai.usage.totalTokens":t.totalTokens,"ai.usage.reasoningTokens":t.reasoningTokens,"ai.usage.cachedInputTokens":t.cachedInputTokens,"gen_ai.response.finish_reasons":[h],"gen_ai.response.id":F.id,"gen_ai.response.model":F.modelId,"gen_ai.usage.input_tokens":t.inputTokens,"gen_ai.usage.output_tokens":t.outputTokens}})),D.end(),e.setAttributes(tD({telemetry:r,attributes:{"ai.usage.inputTokens":t.inputTokens,"ai.usage.outputTokens":t.outputTokens,"ai.usage.totalTokens":t.totalTokens,"ai.usage.reasoningTokens":t.reasoningTokens,"ai.usage.cachedInputTokens":t.cachedInputTokens,"ai.response.object":{output:()=>JSON.stringify(_)},"ai.response.providerMetadata":JSON.stringify(I)}})),await (null==g?void 0:g({usage:t,object:_,error:M,response:{...F,headers:null==j?void 0:j.headers},warnings:o,providerMetadata:I}))}catch(e){t.enqueue({type:"error",error:e})}finally{e.end()}}}));k.addStream(B)}}).catch(e=>{k.addStream(new ReadableStream({start(t){t.enqueue({type:"error",error:e}),t.close()}}))}).finally(()=>{k.close()}),this.outputStrategy=s}get object(){return this._object.promise}get usage(){return this._usage.promise}get providerMetadata(){return this._providerMetadata.promise}get warnings(){return this._warnings.promise}get request(){return this._request.promise}get response(){return this._response.promise}get finishReason(){return this._finishReason.promise}get partialObjectStream(){return rc(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case"object":t.enqueue(e.object);break;case"text-delta":case"finish":case"error":break;default:throw Error(`Unsupported chunk type: ${e}`)}}})))}get elementStream(){return this.outputStrategy.createElementStream(this.baseStream)}get textStream(){return rc(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case"text-delta":t.enqueue(e.textDelta);break;case"object":case"finish":case"error":break;default:throw Error(`Unsupported chunk type: ${e}`)}}})))}get fullStream(){return rc(this.baseStream)}pipeTextStreamToResponse(e,t){t9({response:e,textStream:this.textStream,...t})}toTextStreamResponse(e){return t5({textStream:this.textStream,...e})}},rj={},rq={object:()=>rU,text:()=>rP};for(var rD in rq)ev(rj,rD,{get:rq[rD],enumerable:!0});var rP=()=>({type:"text",responseFormat:{type:"text"},parsePartial:async({text:e})=>({partial:e}),parseOutput:async({text:e})=>e}),rU=({schema:e})=>{let t=(0,E.asSchema)(e);return{type:"object",responseFormat:{type:"json",schema:t.jsonSchema},async parsePartial({text:e}){let t=await ra(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},async parseOutput({text:e},r){let a=await (0,E.safeParseJSON)({text:e});if(!a.success)throw new eq({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});let o=await (0,E.safeValidateTypes)({value:a.value,schema:t});if(!o.success)throw new eq({message:"No object generated: response did not match schema.",cause:o.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});return o.value}}},r$=Symbol.for("vercel.ai.error.AI_NoSuchProviderError");function rJ({execute:e,onError:t=E.getErrorMessage,originalMessages:r,onFinish:a,generateId:o=E.generateId}){let n,s=[],i=new ReadableStream({start(e){n=e}});function l(e){try{n.enqueue(e)}catch(e){}}try{let r=e({writer:{write(e){l(e)},merge(e){s.push((async()=>{let t=e.getReader();for(;;){let{done:e,value:r}=await t.read();if(e)break;l(r)}})().catch(e=>{l({type:"error",errorText:t(e)})}))},onError:t}});r&&s.push(r.catch(e=>{l({type:"error",errorText:t(e)})}))}catch(e){l({type:"error",errorText:t(e)})}return new Promise(async e=>{for(;s.length>0;)await s.shift();e()}).finally(()=>{try{n.close()}catch(e){}}),rd({stream:i,messageId:o(),originalMessages:r,onFinish:a,onError:t})}eg.NoSuchModelError,eg.AISDKError,(0,E.lazyValidator)(()=>(0,E.zodSchema)(_.z.array(_.z.object({id:_.z.string(),role:_.z.enum(["system","user","assistant"]),metadata:_.z.unknown().optional(),parts:_.z.array(_.z.union([_.z.object({type:_.z.literal("text"),text:_.z.string(),state:_.z.enum(["streaming","done"]).optional(),providerMetadata:th.optional()}),_.z.object({type:_.z.literal("reasoning"),text:_.z.string(),state:_.z.enum(["streaming","done"]).optional(),providerMetadata:th.optional()}),_.z.object({type:_.z.literal("source-url"),sourceId:_.z.string(),url:_.z.string(),title:_.z.string().optional(),providerMetadata:th.optional()}),_.z.object({type:_.z.literal("source-document"),sourceId:_.z.string(),mediaType:_.z.string(),title:_.z.string(),filename:_.z.string().optional(),providerMetadata:th.optional()}),_.z.object({type:_.z.literal("file"),mediaType:_.z.string(),filename:_.z.string().optional(),url:_.z.string(),providerMetadata:th.optional()}),_.z.object({type:_.z.literal("step-start")}),_.z.object({type:_.z.string().startsWith("data-"),id:_.z.string().optional(),data:_.z.unknown()}),_.z.object({type:_.z.literal("dynamic-tool"),toolName:_.z.string(),toolCallId:_.z.string(),state:_.z.literal("input-streaming"),input:_.z.unknown().optional(),providerExecuted:_.z.boolean().optional(),output:_.z.never().optional(),errorText:_.z.never().optional()}),_.z.object({type:_.z.literal("dynamic-tool"),toolName:_.z.string(),toolCallId:_.z.string(),state:_.z.literal("input-available"),input:_.z.unknown(),providerExecuted:_.z.boolean().optional(),output:_.z.never().optional(),errorText:_.z.never().optional(),callProviderMetadata:th.optional()}),_.z.object({type:_.z.literal("dynamic-tool"),toolName:_.z.string(),toolCallId:_.z.string(),state:_.z.literal("output-available"),input:_.z.unknown(),providerExecuted:_.z.boolean().optional(),output:_.z.unknown(),errorText:_.z.never().optional(),callProviderMetadata:th.optional(),preliminary:_.z.boolean().optional()}),_.z.object({type:_.z.literal("dynamic-tool"),toolName:_.z.string(),toolCallId:_.z.string(),state:_.z.literal("output-error"),input:_.z.unknown(),providerExecuted:_.z.boolean().optional(),output:_.z.never().optional(),errorText:_.z.string(),callProviderMetadata:th.optional()}),_.z.object({type:_.z.string().startsWith("tool-"),toolCallId:_.z.string(),state:_.z.literal("input-streaming"),providerExecuted:_.z.boolean().optional(),input:_.z.unknown().optional(),output:_.z.never().optional(),errorText:_.z.never().optional(),approval:_.z.never().optional()}),_.z.object({type:_.z.string().startsWith("tool-"),toolCallId:_.z.string(),state:_.z.literal("input-available"),providerExecuted:_.z.boolean().optional(),input:_.z.unknown(),output:_.z.never().optional(),errorText:_.z.never().optional(),callProviderMetadata:th.optional(),approval:_.z.never().optional()}),_.z.object({type:_.z.string().startsWith("tool-"),toolCallId:_.z.string(),state:_.z.literal("approval-requested"),input:_.z.unknown(),providerExecuted:_.z.boolean().optional(),output:_.z.never().optional(),errorText:_.z.never().optional(),callProviderMetadata:th.optional(),approval:_.z.object({id:_.z.string(),approved:_.z.never().optional(),reason:_.z.never().optional()})}),_.z.object({type:_.z.string().startsWith("tool-"),toolCallId:_.z.string(),state:_.z.literal("approval-responded"),input:_.z.unknown(),providerExecuted:_.z.boolean().optional(),output:_.z.never().optional(),errorText:_.z.never().optional(),callProviderMetadata:th.optional(),approval:_.z.object({id:_.z.string(),approved:_.z.boolean(),reason:_.z.string().optional()})}),_.z.object({type:_.z.string().startsWith("tool-"),toolCallId:_.z.string(),state:_.z.literal("output-available"),providerExecuted:_.z.boolean().optional(),input:_.z.unknown(),output:_.z.unknown(),errorText:_.z.never().optional(),callProviderMetadata:th.optional(),preliminary:_.z.boolean().optional(),approval:_.z.object({id:_.z.string(),approved:_.z.literal(!0),reason:_.z.string().optional()}).optional()}),_.z.object({type:_.z.string().startsWith("tool-"),toolCallId:_.z.string(),state:_.z.literal("output-error"),providerExecuted:_.z.boolean().optional(),input:_.z.unknown(),output:_.z.never().optional(),errorText:_.z.string(),callProviderMetadata:th.optional(),approval:_.z.object({id:_.z.string(),approved:_.z.literal(!0),reason:_.z.string().optional()}).optional()}),_.z.object({type:_.z.string().startsWith("tool-"),toolCallId:_.z.string(),state:_.z.literal("output-denied"),providerExecuted:_.z.boolean().optional(),input:_.z.unknown(),output:_.z.never().optional(),errorText:_.z.never().optional(),callProviderMetadata:th.optional(),approval:_.z.object({id:_.z.string(),approved:_.z.literal(!1),reason:_.z.string().optional()})})])).nonempty("Message must contain at least one part")})).nonempty("Messages array must not be empty"))),e.s(["Experimental_Agent",()=>rT,"convertToModelMessages",()=>rI,"createUIMessageStream",()=>rJ,"createUIMessageStreamResponse",()=>rr,"generateObject",()=>rM,"generateText",()=>t2,"isToolUIPart",()=>rl,"stepCountIs",()=>tY,"streamObject",()=>rA,"streamText",()=>rw],476674)}];

//# sourceMappingURL=40a99_ai_dist_index_mjs_81e95046._.js.map