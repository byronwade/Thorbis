module.exports=[618874,(e,t,r)=>{},408305,692837,e=>{"use strict";var t,r=((t={}).NETWORK_ERROR="TELNYX_NETWORK_ERROR",t.TIMEOUT="TELNYX_TIMEOUT",t.CONNECTION_REFUSED="TELNYX_CONNECTION_REFUSED",t.INVALID_API_KEY="TELNYX_INVALID_API_KEY",t.UNAUTHORIZED="TELNYX_UNAUTHORIZED",t.FORBIDDEN="TELNYX_FORBIDDEN",t.RATE_LIMIT_EXCEEDED="TELNYX_RATE_LIMIT_EXCEEDED",t.INVALID_PHONE_NUMBER="TELNYX_INVALID_PHONE_NUMBER",t.INVALID_REQUEST="TELNYX_INVALID_REQUEST",t.MISSING_REQUIRED_FIELD="TELNYX_MISSING_REQUIRED_FIELD",t.NOT_FOUND="TELNYX_NOT_FOUND",t.RESOURCE_CONFLICT="TELNYX_RESOURCE_CONFLICT",t.PROVIDER_ERROR="TELNYX_PROVIDER_ERROR",t.CARRIER_ERROR="TELNYX_CARRIER_ERROR",t.DELIVERY_FAILED="TELNYX_DELIVERY_FAILED",t.CALL_REJECTED="TELNYX_CALL_REJECTED",t.CALL_BUSY="TELNYX_CALL_BUSY",t.CALL_NO_ANSWER="TELNYX_CALL_NO_ANSWER",t.CALL_FAILED="TELNYX_CALL_FAILED",t.SMS_DELIVERY_FAILED="TELNYX_SMS_DELIVERY_FAILED",t.SMS_BLOCKED="TELNYX_SMS_BLOCKED",t.SMS_SPAM_DETECTED="TELNYX_SMS_SPAM_DETECTED",t.WEBHOOK_VALIDATION_FAILED="TELNYX_WEBHOOK_VALIDATION_FAILED",t.WEBHOOK_SIGNATURE_INVALID="TELNYX_WEBHOOK_SIGNATURE_INVALID",t.WEBHOOK_TIMESTAMP_INVALID="TELNYX_WEBHOOK_TIMESTAMP_INVALID",t.WEBHOOK_REPLAY_DETECTED="TELNYX_WEBHOOK_REPLAY_DETECTED",t.CIRCUIT_BREAKER_OPEN="TELNYX_CIRCUIT_BREAKER_OPEN",t.UNKNOWN_ERROR="TELNYX_UNKNOWN_ERROR",t.INTERNAL_ERROR="TELNYX_INTERNAL_ERROR",t);class s extends Error{code;metadata;timestamp;retryable;retryAfterMs;constructor(e,t="TELNYX_UNKNOWN_ERROR",r={}){super(e),this.name="TelnyxError",this.code=t,this.metadata=r,this.timestamp=new Date,this.retryable=r.retryable??this.isRetryableCode(t),this.retryAfterMs=r.retryAfterMs,Error.captureStackTrace&&Error.captureStackTrace(this,s)}isRetryableCode(e){return["TELNYX_NETWORK_ERROR","TELNYX_TIMEOUT","TELNYX_CONNECTION_REFUSED","TELNYX_RATE_LIMIT_EXCEEDED","TELNYX_PROVIDER_ERROR","TELNYX_INTERNAL_ERROR"].includes(e)}toJSON(){return{name:this.name,message:this.message,code:this.code,metadata:this.metadata,timestamp:this.timestamp.toISOString(),retryable:this.retryable,retryAfterMs:this.retryAfterMs,stack:this.stack}}toUserMessage(){switch(this.code){case"TELNYX_INVALID_PHONE_NUMBER":return"The phone number provided is invalid. Please check and try again.";case"TELNYX_RATE_LIMIT_EXCEEDED":return"Too many requests. Please wait a moment and try again.";case"TELNYX_CALL_BUSY":return"The number is busy. Please try again later.";case"TELNYX_CALL_NO_ANSWER":return"No answer. The call was not picked up.";case"TELNYX_SMS_BLOCKED":return"Message could not be delivered. The recipient may have blocked messages.";case"TELNYX_UNAUTHORIZED":case"TELNYX_INVALID_API_KEY":return"Authentication failed. Please contact support.";case"TELNYX_NETWORK_ERROR":case"TELNYX_TIMEOUT":return"Connection issue. Please try again.";default:return"An error occurred. Please try again or contact support."}}}class n extends s{constructor(e,t={}){super(e,"TELNYX_NETWORK_ERROR",{...t,retryable:!0}),this.name="TelnyxNetworkError"}}class a extends s{timeoutMs;constructor(e,t,r={}){super(e,"TELNYX_TIMEOUT",{...r,retryable:!0}),this.name="TelnyxTimeoutError",this.timeoutMs=t}}class o extends s{constructor(e,t,r={}){super(e,"TELNYX_RATE_LIMIT_EXCEEDED",{...r,retryable:!0,retryAfterMs:t}),this.name="TelnyxRateLimitError"}}class i extends s{constructor(e,t={}){super(e,403===t.statusCode?"TELNYX_FORBIDDEN":"TELNYX_UNAUTHORIZED",{...t,retryable:!1}),this.name="TelnyxAuthError"}}class l extends s{field;validationDetails;constructor(e,t={}){super(e,"TELNYX_INVALID_REQUEST",{...t,retryable:!1}),this.name="TelnyxValidationError",this.field=t.field,this.validationDetails=t.validationDetails}}function E(e,t,r={}){let n=t?.errors?.[0]?.detail||t?.error||t?.message||"Unknown error",a=t?.errors?.[0]?.code,c={...r,statusCode:e,telnyxErrorCode:a,telnyxErrorDetail:n};switch(e){case 400:return new l(n,c);case 401:return new i("Invalid API key or unauthorized",c);case 403:return new i("Access forbidden",c);case 404:return new s("Resource not found","TELNYX_NOT_FOUND",{...c,retryable:!1});case 409:return new s("Resource conflict","TELNYX_RESOURCE_CONFLICT",{...c,retryable:!1});case 429:return new o("Rate limit exceeded",1e3*parseInt(t?.retry_after||"60",10),c);case 500:case 502:case 503:case 504:return new s("Telnyx service error","TELNYX_PROVIDER_ERROR",{...c,retryable:!0});default:return new s(n,"TELNYX_UNKNOWN_ERROR",c)}}function c(e,t={}){if(e instanceof s)return e;let r=e instanceof Error?e:Error(String(e)),o=r.code,i={...t,originalError:r};return"AbortError"===r.name||r.message.includes("timeout")?new a("Request timed out",t.timeout||3e4,i):"ECONNRESET"===o||"ECONNREFUSED"===o||"ENOTFOUND"===o||"ENETUNREACH"===o||r.message.includes("fetch failed")||r.message.includes("network")?new n(`Network error: ${r.message}`,i):new s(r.message,"TELNYX_UNKNOWN_ERROR",i)}e.s(["TelnyxError",()=>s,"TelnyxErrorCode",()=>r,"TelnyxTimeoutError",()=>a,"createErrorFromException",()=>c,"createErrorFromResponse",()=>E],408305);var u=e.i(786348);let T=new class{requests=[];operations={smsSent:0,smsDelivered:0,smsFailed:0,callsInitiated:0,callsCompleted:0,callsFailed:0,webhooksReceived:0,webhooksProcessed:0,webhooksFailed:0};retentionMs=36e5;maxEntries=1e4;cleanupInterval;constructor(){this.startCleanup()}startCleanup(){this.cleanupInterval=setInterval(()=>{this.cleanup()},6e4),this.cleanupInterval.unref&&this.cleanupInterval.unref()}cleanup(){let e=Date.now()-this.retentionMs,t=this.requests.length;this.requests=this.requests.filter(t=>t.timestamp.getTime()>e),this.requests.length>this.maxEntries&&(this.requests=this.requests.slice(-this.maxEntries));let r=t-this.requests.length;r>0&&u.telnyxLogger.debug("Metrics cleanup",{removed:r})}recordRequest(e){this.requests.push(e),e.latencyMs>2e3&&u.telnyxLogger.warn("Slow request detected",{endpoint:e.endpoint,latencyMs:e.latencyMs,correlationId:e.correlationId})}recordSmsSent(e){this.operations.smsSent++,!e&&this.operations.smsFailed++}recordSmsDelivered(){this.operations.smsDelivered++}recordCallInitiated(e){this.operations.callsInitiated++,!e&&this.operations.callsFailed++}recordCallCompleted(){this.operations.callsCompleted++}recordWebhook(e){this.operations.webhooksReceived++,e?this.operations.webhooksProcessed++:this.operations.webhooksFailed++}getAggregatedMetrics(e=3e5){let t=Date.now()-e,r=this.requests.filter(e=>e.timestamp.getTime()>t),s=r.filter(e=>e.success).length,n=r.length-s,a=r.map(e=>e.latencyMs).sort((e,t)=>e-t),o=(e,t)=>{if(0===e.length)return 0;let r=Math.ceil(t/100*e.length)-1;return e[Math.max(0,r)]},i={};for(let e of r)i[e.endpoint]||(i[e.endpoint]={count:0,errors:0,totalLatency:0}),i[e.endpoint].count++,i[e.endpoint].totalLatency+=e.latencyMs,!e.success&&i[e.endpoint].errors++;let l={};for(let e of r)l[e.statusCode]=(l[e.statusCode]||0)+1;return{totalRequests:r.length,successfulRequests:s,failedRequests:n,errorRate:r.length>0?n/r.length:0,latency:{p50:o(a,50),p95:o(a,95),p99:o(a,99),avg:a.length>0?a.reduce((e,t)=>e+t,0)/a.length:0,min:a[0]||0,max:a[a.length-1]||0},byEndpoint:Object.fromEntries(Object.entries(i).map(([e,t])=>[e,{count:t.count,errors:t.errors,avgLatency:t.totalLatency/t.count}])),byStatusCode:l}}getOperationMetrics(){return{...this.operations}}getHealthScore(e=3e5){let t=this.getAggregatedMetrics(e);return 0===t.totalRequests?100:Math.round(.5*Math.max(0,100-1e3*t.errorRate)+.3*Math.max(0,100-t.latency.p95/3e3*100)+.2*Math.max(0,100-1e3*(Object.entries(t.byStatusCode).filter(([e])=>parseInt(e)>=500).reduce((e,[,t])=>e+t,0)/t.totalRequests)))}reset(){this.requests=[],this.operations={smsSent:0,smsDelivered:0,smsFailed:0,callsInitiated:0,callsCompleted:0,callsFailed:0,webhooksReceived:0,webhooksProcessed:0,webhooksFailed:0}}stop(){this.cleanupInterval&&clearInterval(this.cleanupInterval)}};function d(e,t,r,s){let n=Date.now();return{end:(a,o)=>{T.recordRequest({endpoint:e,method:t,statusCode:a,latencyMs:Date.now()-n,success:o,timestamp:new Date,companyId:r,correlationId:s})}}}e.s(["startRequestTimer",()=>d,"telnyxMetrics",0,T],692837)},306024,e=>{"use strict";e.i(618874);var t=e.i(786348),r=e.i(628123);let s={default:{maxTokens:100,refillRate:100/60,refillInterval:1e3},sms:{maxTokens:60,refillRate:1,refillInterval:1e3},voice:{maxTokens:30,refillRate:.5,refillInterval:1e3},lookup:{maxTokens:200,refillRate:200/60,refillInterval:1e3},webhook:{maxTokens:1e3,refillRate:100,refillInterval:1e3}};class n{buckets=new Map;processingQueue=new Map;getBucket(e,t){return this.buckets.has(e)||this.buckets.set(e,{tokens:t.maxTokens,lastRefill:Date.now(),queue:[]}),this.buckets.get(e)}refillTokens(e,t){let r=Date.now(),s=Math.floor((r-e.lastRefill)/t.refillInterval);if(s>0){let n=s*t.refillRate;e.tokens=Math.min(t.maxTokens,e.tokens+n),e.lastRefill=r}}async processQueue(e,t){if(this.processingQueue.get(e))return;this.processingQueue.set(e,!0);let s=this.getBucket(e,t);for(;s.queue.length>0;)if(this.refillTokens(s,t),s.tokens>=1){let e=s.queue.shift();if(e){s.tokens-=1;let t=Date.now()-e.requestedAt;e.resolve({allowed:!0,remainingTokens:s.tokens,waitTime:t})}}else{let e=t.refillInterval/t.refillRate;await (0,r.sleep)(Math.ceil(e))}this.processingQueue.set(e,!1)}tryAcquire(e,t=s.default){let r=this.getBucket(e,t);return(this.refillTokens(r,t),r.tokens>=1)?(r.tokens-=1,{allowed:!0,remainingTokens:r.tokens}):{allowed:!1,remainingTokens:0,retryAfterMs:Math.ceil(t.refillInterval/t.refillRate)}}async acquire(e,t=s.default,r=3e4){let n=this.tryAcquire(e,t);if(n.allowed)return n;let a=this.getBucket(e,t);return new Promise((s,n)=>{let o=Date.now(),i=setTimeout(()=>{let e=a.queue.findIndex(e=>e.requestedAt===o);-1!==e&&a.queue.splice(e,1),s({allowed:!1,remainingTokens:0,retryAfterMs:r})},r);a.queue.push({resolve:e=>{clearTimeout(i),s(e)},requestedAt:o}),this.processQueue(e,t)})}getStatus(e,t=s.default){let r=this.getBucket(e,t);return this.refillTokens(r,t),{tokens:Math.floor(r.tokens),maxTokens:t.maxTokens,queueLength:r.queue.length,utilizationPercent:Math.round((t.maxTokens-r.tokens)/t.maxTokens*100)}}reset(e){this.buckets.delete(e)}resetAll(){this.buckets.clear()}}let a=new n,o=new Map;async function i(e="default",t,r=3e4){let l=s[e]||s.default,E=`global:${e}`,c=await a.acquire(E,l,r);if(!c.allowed)return c;if(t){let s=(o.has(t)||o.set(t,new n),o.get(t)),a=await s.acquire(e,l,r);return a.allowed?{...a,waitTime:Math.max(c.waitTime||0,a.waitTime||0)}:a}return c}var l=e.i(408305),E=e.i(692837);let c={default:3e4,sms:1e4,voice:3e4,lookup:5e3,webhook:2e3,balance:5e3};async function u(e,s={}){let{method:n="GET",body:a,timeout:o,timeoutType:T="default",rateLimitEndpoint:d="default",companyId:R,correlationId:_=(0,r.generateCorrelationId)(),skipRetry:h=!1,skipRateLimit:N=!1,retryOptions:m={}}=s,L=process.env.TELNYX_API_KEY;if(!L)return{success:!1,error:"TELNYX_API_KEY is not configured",errorCode:"CONFIG_ERROR",correlationId:_};let I=/^https?:\/\//i.test(e),p=I||e.startsWith("/")?e:`/${e}`,f=I?p:p.startsWith("/public/")?`https://api.telnyx.com${p}`:`https://api.telnyx.com/v2${p}`,g=o||c[T];t.telnyxLogger.debug("API request started",{correlationId:_,endpoint:e,method:n,companyId:R});let y=(0,E.startRequestTimer)(e,n,R,_),O=async()=>{let r=Date.now(),s=new AbortController,o=setTimeout(()=>s.abort(),g);try{let i=await fetch(f,{method:n,headers:{Authorization:`Bearer ${L}`,"Content-Type":"application/json","X-Correlation-ID":_},body:a?JSON.stringify(a):void 0,signal:s.signal,keepalive:!0});clearTimeout(o);let E=Date.now()-r,c=await i.json().catch(()=>({}));if(!i.ok){y.end(i.status,!1);let r=(0,l.createErrorFromResponse)(i.status,c,{correlationId:_,endpoint:e,method:n,companyId:R});if(t.telnyxLogger.warn("API request failed",{correlationId:_,endpoint:e,statusCode:i.status,error:r.message,latencyMs:E}),r.retryable)throw r;return{success:!1,error:r.message,errorCode:r.code,correlationId:_,latencyMs:E}}y.end(i.status,!0);let u=c?.data||c;return t.telnyxLogger.debug("API request completed",{correlationId:_,endpoint:e,statusCode:i.status,latencyMs:E}),{success:!0,data:u,correlationId:_,latencyMs:E}}catch(i){clearTimeout(o);let s=Date.now()-r;if(i instanceof Error&&"AbortError"===i.name){y.end(0,!1);let r=new l.TelnyxTimeoutError(`Request timed out after ${g}ms`,g,{correlationId:_,endpoint:e,method:n});throw t.telnyxLogger.error("API request timed out",{correlationId:_,endpoint:e,timeoutMs:g,latencyMs:s}),r}if(i instanceof l.TelnyxError)throw i;y.end(0,!1);let a=(0,l.createErrorFromException)(i,{correlationId:_,endpoint:e,method:n});throw t.telnyxLogger.error("API request error",{correlationId:_,endpoint:e,error:a.message,latencyMs:s}),a}};try{let s=O;if(!h){let n=s;s=()=>(0,r.withRetry)(n,{endpoint:e,correlationId:_,config:m.config,onRetry:(r,s,n)=>{t.telnyxLogger.info("Retrying request",{correlationId:_,endpoint:e,attempt:r,delayMs:n,error:s.message})}})}if(!N){let e=s;s=()=>(function(e,r={}){let{endpoint:s="default",companyId:n,maxWaitMs:a=3e4,correlationId:o}=r;return new Promise(async(r,l)=>{try{let E=await i(s,n,a);if(!E.allowed){let e=Error(`Rate limit exceeded. Retry after ${E.retryAfterMs}ms`);e.code="RATE_LIMIT_EXCEEDED",e.retryAfterMs=E.retryAfterMs,l(e);return}E.waitTime&&E.waitTime>100&&t.telnyxLogger.debug("Request waited for rate limit",{endpoint:s,companyId:n,waitTime:E.waitTime,correlationId:o});let c=await e();r(c)}catch(e){l(e)}})})(e,{endpoint:d,companyId:R,correlationId:_})}return await s()}catch(e){if(e instanceof l.TelnyxError)return{success:!1,error:e.message,errorCode:e.code,correlationId:_};return{success:!1,error:e instanceof Error?e.message:"Unknown error",correlationId:_}}}e.s(["telnyxRequest",()=>u],306024)},893099,e=>{"use strict";e.i(618874);var t=e.i(306024);async function r(e){return(0,t.telnyxRequest)("/10dlc/brand",{method:"POST",body:e})}async function s(e){return(0,t.telnyxRequest)(`/10dlc/brand/${e}`)}async function n(e){return(0,t.telnyxRequest)("/10dlc/campaignBuilder",{method:"POST",body:e})}async function a(e){return(0,t.telnyxRequest)(`/10dlc/campaign/${e}`)}async function o(e,r){return(0,t.telnyxRequest)(`/10dlc/campaigns/${e}/phone_numbers`,{method:"POST",body:{phone_numbers:[{phone_number:r}]}})}e.s(["attachNumberToCampaign",()=>o,"createTenDlcBrand",()=>r,"createTenDlcCampaign",()=>n,"getTenDlcBrand",()=>s,"getTenDlcCampaign",()=>a])}];

//# sourceMappingURL=_8cac1ed5._.js.map