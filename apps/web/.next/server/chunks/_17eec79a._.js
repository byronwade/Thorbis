module.exports=[982557,e=>{"use strict";var t=e.i(254799);let i="aes-256-gcm",r="base64";function n(){let e=process.env.TOKEN_ENCRYPTION_KEY;if(!e)throw Error("TOKEN_ENCRYPTION_KEY environment variable not set. Generate with: openssl rand -hex 32");if(64!==e.length)throw Error("TOKEN_ENCRYPTION_KEY must be 32 bytes (64 hex characters). Generate with: openssl rand -hex 32");let t=Buffer.from(e,"hex");if(32!==t.length)throw Error("Invalid TOKEN_ENCRYPTION_KEY format");return t}function s(e){try{let s=n(),o=t.default.randomBytes(12),a=t.default.createCipheriv(i,s,o),l=a.update(e,"utf8",r);l+=a.final(r);let c=a.getAuthTag();return[o.toString(r),c.toString(r),l].join(":")}catch(e){throw console.error("[Token Encryption] Encryption failed:",e),Error("Failed to encrypt token")}}function o(e){try{let s=n(),o=e.split(":");if(3!==o.length)throw Error("Invalid encrypted token format");let[a,l,c]=o,d=Buffer.from(a,r),u=Buffer.from(l,r);if(12!==d.length)throw Error("Invalid IV length");if(16!==u.length)throw Error("Invalid auth tag length");let p=t.default.createDecipheriv(i,s,d);p.setAuthTag(u);let m=p.update(c,r,"utf8");return m+=p.final("utf8")}catch(e){throw console.error("[Token Encryption] Decryption failed:",e),Error("Failed to decrypt token")}}function a(){try{return n(),!0}catch{return!1}}function l(e){return a()?s(e):(console.warn("[Token Encryption] Encryption key not configured - storing plaintext (DEV ONLY)"),e)}function c(e){if(!a())return console.warn("[Token Encryption] Encryption key not configured - returning plaintext (DEV ONLY)"),e;if(!e.includes(":"))return console.warn("[Token Encryption] Token appears to be plaintext - returning as-is (MIGRATION MODE)"),e;try{return o(e)}catch(t){return console.error("[Token Encryption] Decryption failed, returning plaintext:",t),e}}e.s(["decryptToken",()=>o,"decryptTokenSafe",()=>c,"encryptToken",()=>s,"encryptTokenSafe",()=>l])},660198,(e,t,i)=>{"use strict";t.exports=e.r(664598).vendored["react-rsc"].ReactJsxRuntime},100357,e=>{"use strict";var t=e.i(273568);let i={urgency:["act now","limited time","urgent","immediate","expires","hurry","don't miss","last chance","final notice","deadline"],money:["free","$$$","cash","discount","save big","best price","cheap","bargain","bonus","prize","winner","congratulations"],suspicious:["click here","click below","buy now","order now","subscribe now","sign up free","no obligation","risk free","100% free","act immediately"],formatting:["ALL CAPS WORDS","!!!","???","$$$","***","###"]},r={urgency:2,money:3,suspicious:4,formatting:1.5,excessiveLinks:5,noUnsubscribe:3,shortContent:2,imageHeavy:3};async function n(e,i){let r=await (0,t.createServiceSupabaseClient)(),n=new Map;for(let e of i)n.set(e.toLowerCase(),{suppressed:!1});let{data:s}=await r.from("email_suppressions").select("email, reason, created_at").eq("company_id",e).in("email",i.map(e=>e.toLowerCase()));if(s)for(let e of s)n.set(e.email,{suppressed:!0,reason:e.reason,suppressedAt:e.created_at});let{data:o}=await r.from("email_global_bounces").select("email, bounce_type, created_at").in("email",i.map(e=>e.toLowerCase())).eq("bounce_type","hard");if(o)for(let e of o){let t=n.get(e.email);t?.suppressed||n.set(e.email,{suppressed:!0,reason:`Global hard bounce: ${e.bounce_type}`,suppressedAt:e.created_at})}return n}function s(e,t,n,s){let o,a=0,l=[],c=`${e} ${n}`.toLowerCase(),d=t.toLowerCase();for(let[e,t]of Object.entries(i)){let i=r[e]||1;for(let e of t){let t=RegExp(e.toLowerCase(),"gi"),r=c.match(t);r&&(a+=r.length*i,r.length>1&&l.push(`Contains "${e}" ${r.length} times`))}}let u=e.split(" ").filter(e=>e.length>3&&e===e.toUpperCase());u.length>0&&(a+=3*u.length,l.push(`Subject contains ${u.length} ALL CAPS words`));let p=(e.match(/!/g)||[]).length;p>1&&(a+=2*p,l.push(`Excessive exclamation marks in subject (${p})`));let m=(d.match(/<a\s/gi)||[]).length,h=n.split(/\s+/).length;h>0&&m/h>.1&&(a+=r.excessiveLinks,l.push(`High link density (${m} links in ${h} words)`)),(d.match(/<img\s/gi)||[]).length>0&&n.length<200&&(a+=r.imageHeavy,l.push("Image-heavy email with little text")),s||(a+=r.noUnsubscribe,l.push("Missing unsubscribe link (required for marketing emails)")),n.length<50&&(a+=r.shortContent,l.push("Very short email content")),(d.includes("display:none")||d.includes("font-size:0"))&&(a+=10,l.push("Contains hidden text (spam technique)"));let f=/<a[^>]*href=["']([^"']+)["'][^>]*>([^<]+)<\/a>/gi;for(;null!==(o=f.exec(t));){let e=o[1].toLowerCase(),t=o[2].toLowerCase();if(t.includes("click here")||t.includes("click this")||t.startsWith("http")&&!t.includes(new URL(e).hostname)){a+=5,l.push("Contains deceptive or vague link text");break}}return{score:Math.min(a,100),issues:l}}async function o(e){let i=await (0,t.createServiceSupabaseClient)(),{data:r}=await i.from("company_email_domains").select("created_at, emails_sent_today, total_emails_sent, warmup_completed").eq("id",e).single();if(!r)return{inWarmup:!0,daysSinceCreation:0,recommendedDailyLimit:10,currentDaySent:0,suggestions:["Domain not found"]};let n=new Date(r.created_at),s=Math.floor((new Date().getTime()-n.getTime())/864e5),o=20;for(let[e,t]of Object.entries({0:20,2:50,4:100,7:200,14:500,21:1e3,28:2500,35:5e3,42:1e4}))s>=parseInt(e)&&(o=t);let a=s<42&&!r.warmup_completed,l=[];return a&&(l.push(`Domain is in warm-up period (day ${s}/42). Recommended daily limit: ${o} emails.`),r.emails_sent_today>=.8*o&&l.push("Approaching daily warm-up limit. Consider spreading sends across multiple days.")),{inWarmup:a,daysSinceCreation:s,recommendedDailyLimit:o,currentDaySent:r.emails_sent_today||0,suggestions:l}}async function a(e){let i=await (0,t.createServiceSupabaseClient)(),{data:r}=await i.from("company_email_domains").select("status, is_suspended, sending_enabled, spf_verified, dkim_verified, dmarc_verified").eq("id",e).single();if(!r)return{canSend:!1,issues:["Domain not found"],dnsStatus:{spf:!1,dkim:!1,dmarc:!1}};let n=[];return"verified"!==r.status&&n.push(`Domain not verified (status: ${r.status})`),r.is_suspended&&n.push("Domain is suspended"),r.sending_enabled||n.push("Sending is disabled for this domain"),r.spf_verified||n.push("SPF record not verified - emails may fail authentication"),r.dkim_verified||n.push("DKIM not verified - emails may fail authentication"),r.dmarc_verified||n.push("DMARC not configured - reduces deliverability"),{canSend:0===n.length,issues:n,dnsStatus:{spf:r.spf_verified||!1,dkim:r.dkim_verified||!1,dmarc:r.dmarc_verified||!1}}}async function l(e,t,i,r,c,d,u=!1){let p=[],m=[],h=[],f=await a(t);f.canSend?f.dnsStatus.dmarc||p.push("DMARC not configured - consider adding for better deliverability"):m.push(...f.issues);let g=await n(e,i),y=[],b=0;for(let[e,t]of g)y.push({email:e,suppressed:t.suppressed,reason:t.reason}),t.suppressed&&b++;b>0&&p.push(`${b} recipient(s) on suppression list and will be skipped`),b===i.length&&m.push("All recipients are on suppression list - no emails will be sent");let x=c.includes("unsubscribe")||c.includes("List-Unsubscribe"),S=s(r,c,d,x||!u);S.score>=60?(m.push(`High spam score (${S.score}/100) - email likely to be filtered`),m.push(...S.issues)):S.score>=30&&(p.push(`Moderate spam score (${S.score}/100) - consider improvements`),p.push(...S.issues));let _=await o(t);if(_.inWarmup){h.push(..._.suggestions);let e=i.length-b,t=_.recommendedDailyLimit-_.currentDaySent;e>t&&p.push(`Sending ${e} emails exceeds warm-up limit (${t} remaining today). Consider sending over multiple days.`)}return c.includes("<!DOCTYPE")||c.includes("<html")||h.push("Consider using proper HTML structure with DOCTYPE for better rendering"),d.length<100&&h.push("Consider adding more text content - very short emails may look suspicious"),u&&!x&&m.push("Marketing emails MUST include an unsubscribe link (CAN-SPAM requirement)"),c.includes("{{")||c.includes("{name}")||r.includes("{{")||h.push("Consider adding personalization (recipient name, company) for better engagement"),{allowed:0===m.length,warnings:p,errors:m,suggestions:h,spamScore:S.score,recipientStatus:y}}async function c(e,i,r,n){let s=await (0,t.createServiceSupabaseClient)(),{error:o}=await s.from("email_suppressions").upsert({company_id:e,email:i.toLowerCase(),reason:r,details:n,created_at:new Date().toISOString()},{onConflict:"company_id,email"});return o?(console.error("Error adding to suppression list:",o),{success:!1,error:o.message}):{success:!0}}async function d(e,i,r){if("hard"!==i)return{success:!0};let n=await (0,t.createServiceSupabaseClient)(),{error:s}=await n.from("email_global_bounces").upsert({email:e.toLowerCase(),bounce_type:i,bounce_reason:r,bounce_count:1,last_bounce_at:new Date().toISOString(),created_at:new Date().toISOString()},{onConflict:"email"});return s?(console.error("Error adding to global bounce list:",s),{success:!1,error:s.message}):{success:!0}}async function u(e,i){let r=await (0,t.createServiceSupabaseClient)(),{error:n}=await r.from("email_suppressions").delete().eq("company_id",e).eq("email",i.toLowerCase());return n?(console.error("Error removing from suppression list:",n),{success:!1,error:n.message}):{success:!0}}async function p(e,i=100,r=0){let n=await (0,t.createServiceSupabaseClient)(),{data:s,count:o,error:a}=await n.from("email_suppressions").select("email, reason, details, created_at",{count:"exact"}).eq("company_id",e).order("created_at",{ascending:!1}).range(r,r+i-1);return a?(console.error("Error fetching suppression list:",a),{data:[],total:0}):{data:s||[],total:o||0}}e.s(["addToGlobalBounceList",()=>d,"addToSuppressionList",()=>c,"calculateSpamScore",()=>s,"checkDomainWarmup",()=>o,"checkSuppressionList",()=>n,"getSuppressionList",()=>p,"removeFromSuppressionList",()=>u,"runPreSendChecks",()=>l,"verifyDomainStatus",()=>a])},982353,e=>{"use strict";var t=e.i(660198),i=e.i(564250),r=e.i(412481);function n({href:e,children:n,variant:s="primary"}){let o={primary:{backgroundColor:r.EMAIL_COLORS.primary,color:r.EMAIL_COLORS.primaryText,border:"none"},outline:{backgroundColor:"transparent",color:r.EMAIL_COLORS.primary,border:`2px solid ${r.EMAIL_COLORS.primary}`}};return(0,t.jsx)(i.Button,{href:e,style:{display:"inline-block",padding:"12px 24px",fontSize:"16px",fontWeight:"600",textDecoration:"none",borderRadius:"8px",textAlign:"center",transition:"all 0.2s ease",...o[s]},children:n})}e.s(["Button",()=>n])},412481,949880,e=>{"use strict";let t={background:"#fafafa",surface:"#fcfcfc",surfaceStrong:"#f2f2f2",primary:"#3c6ff5",primaryText:"#fafafa",heading:"#171717",text:"#171717",muted:"#737373",border:"#e6e6e6"};e.s(["EMAIL_COLORS",0,t],412481);var i=e.i(660198),r=e.i(137354);function n({children:e,level:n=1,style:s}){let o=`h${n}`,a={1:{fontSize:"32px",fontWeight:"700",color:t.heading,margin:"0 0 16px 0",lineHeight:"1.2"},2:{fontSize:"24px",fontWeight:"600",color:t.text,margin:"0 0 12px 0",lineHeight:"1.3"},3:{fontSize:"18px",fontWeight:"600",color:t.muted,margin:"0 0 8px 0",lineHeight:"1.4"}};return(0,i.jsx)(r.Heading,{as:o,style:{...a[n],...s},children:e})}e.s(["Heading",()=>n],949880)},484007,e=>{"use strict";var t=e.i(660198),i=e.i(151368),r=e.i(625922),n=e.i(532316),s=e.i(34093),o=e.i(384378),a=e.i(150624),l=e.i(438016),c=e.i(400812),d=e.i(242538),u=e.i(802451),p=e.i(412481);let m=process.env.NEXT_PUBLIC_THORBIS_LOGO_URL||"https://thorbis.com/logo-white.png",h=process.env.NEXT_PUBLIC_WEBSITE_URL||"https://thorbis.com",f=process.env.THORBIS_SUPPORT_EMAIL||"support@thorbis.com",g=`${h}/docs`,y=`${h}/privacy`,b=`${h}/terms`;function x({children:e,previewText:p}){return(0,t.jsxs)(o.Html,{children:[(0,t.jsx)(n.Head,{children:(0,t.jsx)("style",{children:`
          @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

          /* Reset email client styles */
          body { margin: 0; padding: 0; }
          table { border-collapse: collapse; }
          img { border: 0; }

          /* Responsive */
          @media only screen and (max-width: 600px) {
            .mobile-padding { padding: 20px !important; }
            .mobile-text { font-size: 14px !important; }
            .mobile-heading { font-size: 24px !important; }
          }
        `})}),p&&(0,t.jsx)(c.Preview,{children:p}),(0,t.jsx)(i.Body,{style:S,children:(0,t.jsxs)(r.Container,{style:_,children:[(0,t.jsx)(d.Section,{style:L,children:(0,t.jsx)(a.Img,{src:m,alt:"Thorbis",width:"160",height:"40",style:C})}),(0,t.jsx)(d.Section,{style:w,className:"mobile-padding",children:e}),(0,t.jsx)(s.Hr,{style:v}),(0,t.jsxs)(d.Section,{style:E,className:"mobile-padding",children:[(0,t.jsxs)(u.Text,{style:O,children:["Need help?"," ",(0,t.jsx)(l.Link,{href:`mailto:${f}`,style:k,children:"Contact Support"})," • ",(0,t.jsx)(l.Link,{href:g,style:k,children:"Documentation"})]}),(0,t.jsxs)(u.Text,{style:O,children:[(0,t.jsx)(l.Link,{href:y,style:k,children:"Privacy Policy"})," • ",(0,t.jsx)(l.Link,{href:b,style:k,children:"Terms of Service"})]}),(0,t.jsxs)(u.Text,{style:T,children:["© ",new Date().getFullYear()," Thorbis. All rights reserved."]}),(0,t.jsx)(u.Text,{style:I,children:"Thorbis • 123 Innovation Drive, San Francisco, CA 94105"}),(0,t.jsxs)(u.Text,{style:R,children:["You're receiving this email because you have an account with Thorbis."," ",(0,t.jsx)(l.Link,{href:"{{unsubscribe_url}}",style:k,children:"Unsubscribe from marketing emails"})]})]})]})})]})}let S={backgroundColor:p.EMAIL_COLORS.background,fontFamily:'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale"},_={backgroundColor:p.EMAIL_COLORS.surface,maxWidth:"600px",margin:"0 auto"},L={backgroundColor:p.EMAIL_COLORS.primary,padding:"40px 0",textAlign:"center"},C={margin:"0 auto",display:"block"},w={padding:"48px 40px",color:p.EMAIL_COLORS.text,fontSize:"16px",lineHeight:"24px"},v={borderColor:p.EMAIL_COLORS.border,borderWidth:"1px",margin:"0"},E={padding:"32px 40px",textAlign:"center",backgroundColor:p.EMAIL_COLORS.surfaceStrong},O={color:p.EMAIL_COLORS.muted,fontSize:"14px",lineHeight:"24px",margin:"8px 0"},k={color:p.EMAIL_COLORS.primary,textDecoration:"none",fontWeight:"500"},T={color:p.EMAIL_COLORS.muted,fontSize:"13px",margin:"16px 0 0 0",fontWeight:"600"},I={color:p.EMAIL_COLORS.muted,fontSize:"12px",margin:"8px 0"},R={color:p.EMAIL_COLORS.muted,fontSize:"11px",margin:"16px 0 0 0",lineHeight:"18px"};e.s(["BaseLayout",()=>x])},554772,e=>{"use strict";var t=e.i(660198),i=e.i(242538),r=e.i(802451),n=e.i(412481);function s({children:e,title:n,style:s}){return(0,t.jsxs)(i.Section,{style:{...o,...s},children:[n&&(0,t.jsx)(r.Text,{style:a,children:n}),e]})}let o={backgroundColor:n.EMAIL_COLORS.surface,border:`1px solid ${n.EMAIL_COLORS.border}`,borderRadius:"8px",padding:"24px",margin:"16px 0"},a={fontSize:"18px",fontWeight:"600",color:n.EMAIL_COLORS.heading,margin:"0 0 16px 0"};e.s(["Card",()=>s])}];

//# sourceMappingURL=_17eec79a._.js.map