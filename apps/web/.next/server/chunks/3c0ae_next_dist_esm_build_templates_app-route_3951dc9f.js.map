{"version":3,"sources":["../../../../../apps/web/src/app/api/job-enrichment/route.ts","../../../../../apps/web/src/lib/services/job-enrichment.ts","../../../../../node_modules/.pnpm/next%4016.0.4_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/dist/esm/build/templates/app-route.js","../../../../../apps/web/src/lib/services/building-data-service.ts","../../../../../apps/web/src/lib/services/elevation-service.ts","../../../../../apps/web/src/lib/services/property-data-service.ts","../../../../../apps/web/src/lib/services/walkability-service.ts","../../../../../apps/web/src/lib/services/water-quality-service.ts","../../../../../apps/web/src/lib/services/demographics-service.ts","../../../../../apps/web/src/lib/services/address-validation-service.ts","../../../../../apps/web/src/lib/services/google-routes-service.ts","../../../../../apps/web/src/lib/services/google-streetview-service.ts","../../../../../apps/web/src/lib/services/routing-service.ts","../../../../../apps/web/src/lib/services/timezone-service.ts","../../../../../apps/web/src/lib/services/location-services.ts","../../../../../apps/web/src/lib/services/schools-service.ts","../../../../../apps/web/src/lib/services/google-solar-service.ts"],"sourcesContent":["/**\n * Job Enrichment API Route\n *\n * Non-blocking enrichment endpoint for optimistic loading\n */\n\nimport { type NextRequest, NextResponse } from \"next/server\";\nimport { jobEnrichmentService } from \"@/lib/services/job-enrichment\";\nimport { createClient } from \"@/lib/supabase/server\";\n\nexport async function GET(request: NextRequest) {\n\ttry {\n\t\tconst searchParams = request.nextUrl.searchParams;\n\t\tconst jobId = searchParams.get(\"jobId\");\n\t\tconst address = searchParams.get(\"address\");\n\t\tconst city = searchParams.get(\"city\");\n\t\tconst state = searchParams.get(\"state\");\n\t\tconst zipCode = searchParams.get(\"zipCode\");\n\t\tconst lat = searchParams.get(\"lat\");\n\t\tconst lon = searchParams.get(\"lon\");\n\n\t\tif (!(jobId && address && city && state)) {\n\t\t\treturn NextResponse.json(\n\t\t\t\t{ error: \"Missing required parameters\" },\n\t\t\t\t{ status: 400 },\n\t\t\t);\n\t\t}\n\n\t\t// Authenticate user\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\treturn NextResponse.json(\n\t\t\t\t{ error: \"Database connection failed\" },\n\t\t\t\t{ status: 500 },\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\n\t\tif (!user) {\n\t\t\treturn NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n\t\t}\n\n\t\t// Enrich job (with timeout protection)\n\t\tconst enrichmentPromise = jobEnrichmentService.enrichJob({\n\t\t\tid: jobId,\n\t\t\taddress,\n\t\t\taddress2: undefined,\n\t\t\tcity,\n\t\t\tstate,\n\t\t\tzipCode: zipCode || \"\",\n\t\t\tlat: lat ? Number.parseFloat(lat) : undefined,\n\t\t\tlon: lon ? Number.parseFloat(lon) : undefined,\n\t\t});\n\n\t\t// Race with timeout (10 seconds max)\n\t\tconst timeoutPromise = new Promise((_, reject) =>\n\t\t\tsetTimeout(() => reject(new Error(\"Timeout\")), 10_000),\n\t\t);\n\n\t\tconst enrichment = await Promise.race([\n\t\t\tenrichmentPromise,\n\t\t\ttimeoutPromise,\n\t\t]).catch(() => null);\n\n\t\tif (!enrichment) {\n\t\t\treturn NextResponse.json(\n\t\t\t\t{ error: \"Enrichment timeout or failed\" },\n\t\t\t\t{ status: 504 },\n\t\t\t);\n\t\t}\n\n\t\treturn NextResponse.json(enrichment, {\n\t\t\theaders: {\n\t\t\t\t\"Cache-Control\": \"public, s-maxage=300, stale-while-revalidate=600\",\n\t\t\t},\n\t\t});\n\t} catch (_error) {\n\t\treturn NextResponse.json(\n\t\t\t{ error: \"Internal server error\" },\n\t\t\t{ status: 500 },\n\t\t);\n\t}\n}\n","/**\n * Job Enrichment Service\n *\n * Orchestrates all operational intelligence services for jobs:\n * - Weather data and alerts (Google Weather + NWS fallback)\n * - Air quality and pollen data (Google APIs)\n * - Solar potential analysis (Google Solar API)\n * - Routes and ETA (Google Routes API)\n * - Water quality and upsell opportunities\n * - Address validation\n * - Location intelligence (flood zones, county)\n * - Routing and nearby suppliers\n */\n\nimport { z } from \"zod\";\nimport { addressValidationService } from \"./address-validation-service\";\nimport { airQualityService } from \"./air-quality-service\";\nimport { buildingDataService } from \"./building-data-service\";\nimport { demographicsService } from \"./demographics-service\";\nimport { elevationService } from \"./elevation-service\";\nimport { googleAirQualityService } from \"./google-air-quality-service\";\nimport { googlePlacesService } from \"./google-places-service\";\nimport { googlePollenService } from \"./google-pollen-service\";\n// NEW: Google API services\nimport { googleRoutesService } from \"./google-routes-service\";\nimport { googleSolarService } from \"./google-solar-service\";\nimport { googleStreetViewService } from \"./google-streetview-service\";\nimport { googleWeatherService } from \"./google-weather-service\";\nimport { locationServices } from \"./location-services\";\nimport { propertyDataService } from \"./property-data-service\";\nimport { routingService } from \"./routing-service\";\nimport { schoolsService } from \"./schools-service\";\nimport { timeZoneService } from \"./timezone-service\";\nimport { trafficService } from \"./traffic-service\";\nimport { walkabilityService } from \"./walkability-service\";\nimport { waterQualityService } from \"./water-quality-service\";\nimport { weatherService } from \"./weather-service\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst JobEnrichmentSchema = z.object({\n\tjobId: z.string().uuid(),\n\n\t// Property location data\n\tlocation: z.object({\n\t\tlat: z.number(),\n\t\tlon: z.number(),\n\t\taddress: z.string(),\n\t}),\n\n\t// Property data (characteristics, assessment, market value)\n\tpropertyData: z.any().optional(), // PropertyData\n\n\t// Building data from OpenStreetMap\n\tbuildingData: z.any().optional(), // BuildingData\n\n\t// Weather data (Google Weather API + fallbacks)\n\tweather: z.any().optional(), // WeatherData\n\n\t// Water quality (for upsells)\n\twaterQuality: z.any().optional(), // WaterQuality\n\n\t// Address validation\n\taddressValidation: z.any().optional(), // AddressValidation\n\n\t// Location intelligence\n\tlocationIntelligence: z.any().optional(), // LocationIntelligence\n\n\t// Nearby suppliers\n\tnearbySuppliers: z.array(z.any()).optional(), // NearbySupplier[]\n\n\t// Demographics data\n\tdemographics: z.any().optional(), // Demographics\n\n\t// Air quality (Google Air Quality API)\n\tairQuality: z.any().optional(), // AirQuality\n\n\t// Pollen data (Google Pollen API) - NEW\n\tpollen: z.any().optional(), // PollenData\n\n\t// Solar potential (Google Solar API) - NEW\n\tsolar: z.any().optional(), // SolarData\n\n\t// Elevation\n\televation: z.any().optional(), // Elevation\n\n\t// Walkability\n\twalkability: z.any().optional(), // Walkability\n\n\t// Nearby schools\n\tschools: z.any().optional(), // SchoolsData\n\n\t// Google Street View\n\tstreetView: z.any().optional(), // StreetView\n\n\t// Google Places (suppliers with reviews)\n\tgooglePlaces: z.any().optional(), // GooglePlaces\n\n\t// Time Zone\n\ttimeZone: z.any().optional(), // TimeZoneInfo\n\n\t// Traffic incidents\n\ttraffic: z.any().optional(), // TrafficData\n\n\t// Recommendations\n\trecommendations: z.object({\n\t\tshouldReschedule: z.boolean(),\n\t\trescheduleReason: z.string().optional(),\n\t\tupsellOpportunities: z.array(z.string()),\n\t\tsafetyWarnings: z.array(z.string()),\n\t\t// NEW: Detailed recommendation objects\n\t\thvacRecommendations: z\n\t\t\t.array(\n\t\t\t\tz.object({\n\t\t\t\t\ttype: z.string(),\n\t\t\t\t\treason: z.string(),\n\t\t\t\t\turgency: z.enum([\"low\", \"medium\", \"high\"]),\n\t\t\t\t\testimatedValue: z.number().optional(),\n\t\t\t\t}),\n\t\t\t)\n\t\t\t.optional(),\n\t\tsolarRecommendation: z\n\t\t\t.object({\n\t\t\t\tsuitable: z.boolean(),\n\t\t\t\tsummary: z.string(),\n\t\t\t\testimatedSavings: z.number().optional(),\n\t\t\t\tpanelCount: z.number().optional(),\n\t\t\t})\n\t\t\t.optional(),\n\t}),\n\n\t// Metadata\n\tenrichmentStatus: z.enum([\"pending\", \"in_progress\", \"completed\", \"failed\"]),\n\tenrichedAt: z.string().optional(),\n\tsources: z.array(z.string()),\n});\n\nexport type JobEnrichment = z.infer<typeof JobEnrichmentSchema>;\n\n// ============================================================================\n// Job Enrichment Service\n// ============================================================================\n\n// Cache for enrichment results (5 minute TTL)\nconst enrichmentCache = new Map<\n\tstring,\n\t{ data: JobEnrichment; expires: number }\n>();\nconst CACHE_TTL_MS = 5 * 60 * 1000; // 5 minutes\n\nclass JobEnrichmentService {\n\t/**\n\t * Get cache key for job enrichment\n\t */\n\tprivate getCacheKey(job: { id: string; lat?: number; lon?: number }): string {\n\t\treturn `enrichment:${job.id}:${job.lat || 0}:${job.lon || 0}`;\n\t}\n\n\t/**\n\t * Enrich a job with all available operational intelligence\n\t * Optimized for speed with caching and parallel execution\n\t */\n\tasync enrichJob(job: {\n\t\tid: string;\n\t\taddress: string;\n\t\taddress2?: string;\n\t\tcity: string;\n\t\tstate: string;\n\t\tzipCode: string;\n\t\tlat?: number;\n\t\tlon?: number;\n\t}): Promise<JobEnrichment> {\n\t\t// Check cache first for instant response\n\t\tconst cacheKey = this.getCacheKey(job);\n\t\tconst cached = enrichmentCache.get(cacheKey);\n\t\tif (cached && cached.expires > Date.now()) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\tconst sources: string[] = [];\n\t\tconst upsellOpportunities: string[] = [];\n\t\tconst safetyWarnings: string[] = [];\n\t\tlet shouldReschedule = false;\n\t\tlet rescheduleReason: string | undefined;\n\n\t\ttry {\n\t\t\t// Step 1: Get or validate coordinates\n\t\t\tlet lat = job.lat;\n\t\t\tlet lon = job.lon;\n\n\t\t\tif (lat && lon) {\n\t\t\t\t// Coordinates already available from property - no geocoding needed\n\t\t\t\tsources.push(\"property_coordinates\");\n\t\t\t} else {\n\t\t\t\tconst fullAddress = `${job.address}, ${job.city}, ${job.state} ${job.zipCode}`;\n\n\t\t\t\tconst geocoded = await locationServices.geocode(fullAddress);\n\n\t\t\t\tif (geocoded) {\n\t\t\t\t\tlat = geocoded.lat;\n\t\t\t\t\tlon = geocoded.lon;\n\t\t\t\t\tsources.push(\"nominatim\");\n\t\t\t\t} else {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tjobId: job.id,\n\t\t\t\t\t\tlocation: {\n\t\t\t\t\t\t\tlat: 0,\n\t\t\t\t\t\t\tlon: 0,\n\t\t\t\t\t\t\taddress: fullAddress,\n\t\t\t\t\t\t},\n\t\t\t\t\t\trecommendations: {\n\t\t\t\t\t\t\tshouldReschedule: false,\n\t\t\t\t\t\t\tupsellOpportunities: [],\n\t\t\t\t\t\t\tsafetyWarnings: [\n\t\t\t\t\t\t\t\t\"Unable to geocode address - enrichment unavailable\",\n\t\t\t\t\t\t\t\t\"Nominatim geocoding service may be rate-limited or unavailable\",\n\t\t\t\t\t\t\t\t\"To fix: Add latitude/longitude coordinates to the property, or try again in a few minutes\",\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\tenrichmentStatus: \"failed\",\n\t\t\t\t\t\tsources: [],\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst [\n\t\t\t\tpropertyData,\n\t\t\t\tbuildingData,\n\t\t\t\tweather,\n\t\t\t\twaterQuality,\n\t\t\t\taddressValidation,\n\t\t\t\tlocationIntelligence,\n\t\t\t\tnearbySuppliers,\n\t\t\t\tdemographics,\n\t\t\t\tairQuality,\n\t\t\t\tpollen,\n\t\t\t\tsolar,\n\t\t\t\televation,\n\t\t\t\twalkability,\n\t\t\t\tschools,\n\t\t\t\tstreetView,\n\t\t\t\tgooglePlaces,\n\t\t\t\ttimeZone,\n\t\t\t\ttraffic,\n\t\t\t] = await Promise.all([\n\t\t\t\tpropertyDataService\n\t\t\t\t\t.getPropertyData(\n\t\t\t\t\t\tjob.address,\n\t\t\t\t\t\tjob.city,\n\t\t\t\t\t\tjob.state,\n\t\t\t\t\t\tjob.zipCode,\n\t\t\t\t\t\tlat,\n\t\t\t\t\t\tlon,\n\t\t\t\t\t)\n\t\t\t\t\t.catch((_e) => null),\n\t\t\t\tbuildingDataService.getBuildingData(lat, lon).catch((_e) => null),\n\t\t\t\t// Use Google Weather Service (with Open-Meteo/NWS fallback)\n\t\t\t\tgoogleWeatherService\n\t\t\t\t\t.getWeatherData(lat, lon)\n\t\t\t\t\t.catch((_e) => null),\n\t\t\t\twaterQualityService.getWaterQuality(lat, lon).catch((_e) => null),\n\t\t\t\taddressValidationService\n\t\t\t\t\t.validateAddress({\n\t\t\t\t\t\taddress2: job.address,\n\t\t\t\t\t\taddress1: job.address2,\n\t\t\t\t\t\tcity: job.city,\n\t\t\t\t\t\tstate: job.state,\n\t\t\t\t\t\tzip5: job.zipCode,\n\t\t\t\t\t})\n\t\t\t\t\t.catch((_e) => null),\n\t\t\t\tlocationServices.getLocationIntelligence(lat, lon).catch((_e) => null),\n\t\t\t\troutingService.findNearbySuppliers(lat, lon, 8000).catch((_e) => []),\n\t\t\t\t// Demographics\n\t\t\t\tdemographicsService\n\t\t\t\t\t.getDemographics(lat, lon)\n\t\t\t\t\t.catch((_e) => null),\n\t\t\t\t// Google Air Quality API (with fallback)\n\t\t\t\tgoogleAirQualityService\n\t\t\t\t\t.getAirQuality(lat, lon)\n\t\t\t\t\t.catch((_e) => null),\n\t\t\t\t// Google Pollen API - NEW\n\t\t\t\tgooglePollenService\n\t\t\t\t\t.getPollenData(lat, lon)\n\t\t\t\t\t.catch((_e) => null),\n\t\t\t\t// Google Solar API - NEW\n\t\t\t\tgoogleSolarService\n\t\t\t\t\t.getSolarData(lat, lon)\n\t\t\t\t\t.catch((_e) => null),\n\t\t\t\televationService.getElevation(lat, lon).catch((_e) => null),\n\t\t\t\twalkabilityService.getWalkability(lat, lon).catch((_e) => null),\n\t\t\t\tschoolsService.getNearbySchools(lat, lon).catch((_e) => null),\n\t\t\t\t// GOOGLE SERVICES\n\t\t\t\tgoogleStreetViewService\n\t\t\t\t\t.getStreetView(lat, lon, `${job.address}, ${job.city}, ${job.state}`)\n\t\t\t\t\t.catch((_e) => null),\n\t\t\t\tgooglePlacesService\n\t\t\t\t\t.findNearbySuppliers(lat, lon, 8000)\n\t\t\t\t\t.catch((_e) => null),\n\t\t\t\ttimeZoneService.getTimeZone(lat, lon).catch((_e) => null),\n\t\t\t\ttrafficService.getTrafficIncidents(lat, lon).catch((_e) => null),\n\t\t\t]);\n\n\t\t\tif (propertyData) {\n\t\t\t\t// Track sources\n\t\t\t\tsources.push(propertyData.dataSource);\n\t\t\t}\n\t\t\tif (buildingData) {\n\t\t\t\tsources.push(\"osm\");\n\t\t\t}\n\t\t\tif (weather) {\n\t\t\t\tsources.push(\"google-weather\");\n\t\t\t}\n\t\t\tif (waterQuality) {\n\t\t\t\tsources.push(\"usgs\");\n\t\t\t}\n\t\t\tif (addressValidation?.isValid) {\n\t\t\t\tsources.push(\"usps\");\n\t\t\t}\n\t\t\tif (locationIntelligence) {\n\t\t\t\tsources.push(\"fcc\", \"fema\");\n\t\t\t}\n\t\t\tif (nearbySuppliers.length > 0) {\n\t\t\t\tsources.push(\"overpass\");\n\t\t\t}\n\t\t\tif (demographics) {\n\t\t\t\tsources.push(\"census\");\n\t\t\t}\n\t\t\tif (airQuality) {\n\t\t\t\tsources.push(\"google-air-quality\");\n\t\t\t}\n\t\t\tif (pollen) {\n\t\t\t\tsources.push(\"google-pollen\");\n\t\t\t}\n\t\t\tif (solar) {\n\t\t\t\tsources.push(\"google-solar\");\n\t\t\t}\n\t\t\tif (elevation) {\n\t\t\t\tsources.push(\"usgs-elevation\");\n\t\t\t}\n\t\t\tif (walkability) {\n\t\t\t\tsources.push(\"osm-walkability\");\n\t\t\t}\n\t\t\tif (schools) {\n\t\t\t\tsources.push(\"osm-schools\");\n\t\t\t}\n\t\t\tif (streetView?.available) {\n\t\t\t\tsources.push(\"google-streetview\");\n\t\t\t}\n\t\t\tif (googlePlaces) {\n\t\t\t\tsources.push(\"google-places\");\n\t\t\t}\n\t\t\tif (timeZone) {\n\t\t\t\tsources.push(\"google-timezone\");\n\t\t\t}\n\t\t\tif (traffic) {\n\t\t\t\tsources.push(\"google-traffic\");\n\t\t\t}\n\n\t\t\t// Initialize detailed recommendations\n\t\t\tconst hvacRecommendations: Array<{\n\t\t\t\ttype: string;\n\t\t\t\treason: string;\n\t\t\t\turgency: \"low\" | \"medium\" | \"high\";\n\t\t\t\testimatedValue?: number;\n\t\t\t}> = [];\n\t\t\tlet solarRecommendation:\n\t\t\t\t| {\n\t\t\t\t\t\tsuitable: boolean;\n\t\t\t\t\t\tsummary: string;\n\t\t\t\t\t\testimatedSavings?: number;\n\t\t\t\t\t\tpanelCount?: number;\n\t\t\t\t  }\n\t\t\t\t| undefined;\n\n\t\t\tif (weather && weather.alerts && weather.alerts.length > 0) {\n\t\t\t\t// Weather-based recommendations\n\t\t\t\tconst highestAlert = weather.alerts[0];\n\t\t\t\tif (\n\t\t\t\t\tweather.highestSeverity === \"Extreme\" ||\n\t\t\t\t\tweather.highestSeverity === \"Severe\"\n\t\t\t\t) {\n\t\t\t\t\tshouldReschedule = true;\n\t\t\t\t\trescheduleReason = `Severe weather alert: ${highestAlert.headline}`;\n\t\t\t\t\tsafetyWarnings.push(highestAlert.headline);\n\t\t\t\t} else {\n\t\t\t\t\tsafetyWarnings.push(`Weather advisory: ${highestAlert.headline}`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (weather) {\n\t\t\t\t// Check outdoor work suitability using Google Weather Service\n\t\t\t\tconst suitability =\n\t\t\t\t\tgoogleWeatherService.isSuitableForOutdoorWork(weather);\n\t\t\t\tif (!suitability.suitable) {\n\t\t\t\t\tsafetyWarnings.push(\n\t\t\t\t\t\tsuitability.reason || \"Weather may impact outdoor work\",\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Air Quality recommendations (Google Air Quality API)\n\t\t\tif (airQuality) {\n\t\t\t\tconst aqSuitability =\n\t\t\t\t\tgoogleAirQualityService.isSuitableForOutdoorWork(airQuality);\n\t\t\t\tif (!aqSuitability.suitable) {\n\t\t\t\t\tsafetyWarnings.push(\n\t\t\t\t\t\taqSuitability.reason || \"Poor air quality may impact outdoor work\",\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// HVAC filter recommendation based on air quality\n\t\t\t\tconst filterRec =\n\t\t\t\t\tgoogleAirQualityService.getHVACFilterRecommendation(airQuality);\n\t\t\t\tif (filterRec.recommendation !== \"Standard filters are adequate\") {\n\t\t\t\t\thvacRecommendations.push({\n\t\t\t\t\t\ttype: \"Air Filter Upgrade\",\n\t\t\t\t\t\treason: filterRec.recommendation,\n\t\t\t\t\t\turgency:\n\t\t\t\t\t\t\tfilterRec.upgradeUrgency === \"high\"\n\t\t\t\t\t\t\t\t? \"high\"\n\t\t\t\t\t\t\t\t: filterRec.upgradeUrgency === \"medium\"\n\t\t\t\t\t\t\t\t\t? \"medium\"\n\t\t\t\t\t\t\t\t\t: \"low\",\n\t\t\t\t\t\testimatedValue: filterRec.suggestedFilter === \"HEPA\" ? 150 : 75,\n\t\t\t\t\t});\n\t\t\t\t\tupsellOpportunities.push(\n\t\t\t\t\t\t`Air Filter: ${filterRec.recommendation} (Suggested: ${filterRec.suggestedFilter})`,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Pollen-based HVAC recommendations (Google Pollen API)\n\t\t\tif (pollen) {\n\t\t\t\tconst pollenUpsell =\n\t\t\t\t\tgooglePollenService.getHVACUpsellRecommendation(pollen);\n\t\t\t\tif (pollenUpsell.shouldRecommend) {\n\t\t\t\t\thvacRecommendations.push({\n\t\t\t\t\t\ttype: \"Air Filtration\",\n\t\t\t\t\t\treason: pollenUpsell.reason,\n\t\t\t\t\t\turgency: pollenUpsell.urgency,\n\t\t\t\t\t\testimatedValue: pollenUpsell.estimatedValue,\n\t\t\t\t\t});\n\t\t\t\t\tupsellOpportunities.push(\n\t\t\t\t\t\t`${pollenUpsell.productType}: ${pollenUpsell.reason} (Est. value: $${pollenUpsell.estimatedValue})`,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Check if pollen is too high for outdoor work\n\t\t\t\tconst todaysSummary = googlePollenService.getTodaysSummary(pollen);\n\t\t\t\tif (todaysSummary.overallLevel === \"very_high\") {\n\t\t\t\t\tsafetyWarnings.push(\n\t\t\t\t\t\t`Very high pollen levels: ${todaysSummary.description}`,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Solar potential analysis (Google Solar API)\n\t\t\tif (solar && googleSolarService.isSuitableForSolar(solar)) {\n\t\t\t\tconst solarSummary = googleSolarService.getSolarSummary(solar);\n\t\t\t\tconst financialAnalysis =\n\t\t\t\t\tgoogleSolarService.getFinancialAnalysis(solar);\n\n\t\t\t\tsolarRecommendation = {\n\t\t\t\t\tsuitable: true,\n\t\t\t\t\tsummary: solarSummary,\n\t\t\t\t\testimatedSavings: financialAnalysis?.twentyYearSavings,\n\t\t\t\t\tpanelCount:\n\t\t\t\t\t\tsolar.buildingInsights?.solarPotential?.maxArrayPanelsCount,\n\t\t\t\t};\n\n\t\t\t\tif (financialAnalysis && financialAnalysis.twentyYearSavings > 5000) {\n\t\t\t\t\tupsellOpportunities.push(\n\t\t\t\t\t\t`Solar Installation: ${solarSummary} (Est. 20-year savings: $${financialAnalysis.twentyYearSavings.toLocaleString()})`,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else if (solar) {\n\t\t\t\tsolarRecommendation = {\n\t\t\t\t\tsuitable: false,\n\t\t\t\t\tsummary:\n\t\t\t\t\t\t\"Property may not be ideal for solar installation based on roof characteristics\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (waterQuality?.recommendations?.shouldInstallSoftener) {\n\t\t\t\t// Water quality upsell\n\t\t\t\tupsellOpportunities.push(\n\t\t\t\t\t`Water Softener: ${waterQuality.recommendations.reason} (Save $${(waterQuality.recommendations.estimatedAnnualSavings || 0) / 100}/year)`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (locationIntelligence?.floodZone?.inFloodZone) {\n\t\t\t\t// Flood zone warning\n\t\t\t\tconst zone = locationIntelligence.floodZone;\n\t\t\t\tif (zone.riskLevel === \"high\") {\n\t\t\t\t\tsafetyWarnings.push(`Flood Zone ${zone.zone}: ${zone.description}`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (addressValidation && !addressValidation.isValid) {\n\t\t\t\t// Address validation warning\n\t\t\t\tsafetyWarnings.push(\n\t\t\t\t\t`Address validation failed: ${addressValidation.error || \"Invalid address\"}`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (propertyData) {\n\t\t\t\t// Property data-based upsells\n\t\t\t\tconst estimates =\n\t\t\t\t\tpropertyDataService.estimateCharacteristics(propertyData);\n\n\t\t\t\tif (\n\t\t\t\t\testimates.recommendMaintenance &&\n\t\t\t\t\testimates.recommendMaintenance.length > 0\n\t\t\t\t) {\n\t\t\t\t\t// Add maintenance recommendations as upsell opportunities\n\t\t\t\t\tfor (const maintenance of estimates.recommendMaintenance) {\n\t\t\t\t\t\tupsellOpportunities.push(maintenance);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst enrichment: JobEnrichment = JobEnrichmentSchema.parse({\n\t\t\t\tjobId: job.id,\n\t\t\t\tlocation: {\n\t\t\t\t\tlat,\n\t\t\t\t\tlon,\n\t\t\t\t\taddress: `${job.address}, ${job.city}, ${job.state}`,\n\t\t\t\t},\n\t\t\t\tpropertyData,\n\t\t\t\tbuildingData,\n\t\t\t\tweather,\n\t\t\t\twaterQuality,\n\t\t\t\taddressValidation,\n\t\t\t\tlocationIntelligence,\n\t\t\t\tnearbySuppliers,\n\t\t\t\tdemographics,\n\t\t\t\tairQuality,\n\t\t\t\tpollen,\n\t\t\t\tsolar,\n\t\t\t\televation,\n\t\t\t\twalkability,\n\t\t\t\tschools,\n\t\t\t\tstreetView,\n\t\t\t\tgooglePlaces,\n\t\t\t\ttimeZone,\n\t\t\t\ttraffic,\n\t\t\t\trecommendations: {\n\t\t\t\t\tshouldReschedule,\n\t\t\t\t\trescheduleReason,\n\t\t\t\t\tupsellOpportunities,\n\t\t\t\t\tsafetyWarnings,\n\t\t\t\t\thvacRecommendations:\n\t\t\t\t\t\thvacRecommendations.length > 0 ? hvacRecommendations : undefined,\n\t\t\t\t\tsolarRecommendation,\n\t\t\t\t},\n\t\t\t\tenrichmentStatus: \"completed\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t\tsources,\n\t\t\t});\n\n\t\t\t// Cache the result for 5 minutes\n\t\t\tenrichmentCache.set(cacheKey, {\n\t\t\t\tdata: enrichment,\n\t\t\t\texpires: Date.now() + CACHE_TTL_MS,\n\t\t\t});\n\n\t\t\treturn enrichment;\n\t\t} catch (_error) {\n\t\t\treturn {\n\t\t\t\tjobId: job.id,\n\t\t\t\tlocation: {\n\t\t\t\t\tlat: job.lat || 0,\n\t\t\t\t\tlon: job.lon || 0,\n\t\t\t\t\taddress: `${job.address}, ${job.city}, ${job.state}`,\n\t\t\t\t},\n\t\t\t\trecommendations: {\n\t\t\t\t\tshouldReschedule: false,\n\t\t\t\t\tupsellOpportunities: [],\n\t\t\t\t\tsafetyWarnings: [\"Enrichment failed\"],\n\t\t\t\t},\n\t\t\t\tenrichmentStatus: \"failed\",\n\t\t\t\tsources: [],\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Quick weather check for a job (faster, only gets alerts)\n\t */\n\tasync getWeatherAlerts(lat: number, lon: number) {\n\t\ttry {\n\t\t\tconst weather = await googleWeatherService.getWeatherData(lat, lon);\n\t\t\treturn weather?.alerts || [];\n\t\t} catch (_error) {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t/**\n\t * Get full weather data for a location\n\t */\n\tasync getWeatherData(lat: number, lon: number) {\n\t\ttry {\n\t\t\treturn await googleWeatherService.getWeatherData(lat, lon);\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Calculate travel time from tech location to job using Google Routes API\n\t */\n\tasync getTravelTime(\n\t\tfrom: { lat: number; lon: number },\n\t\tto: { lat: number; lon: number },\n\t) {\n\t\ttry {\n\t\t\treturn await googleRoutesService.getRoute(from, to);\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get ETA from tech location to job with traffic consideration\n\t */\n\tasync getETA(\n\t\tfrom: { lat: number; lon: number },\n\t\tto: { lat: number; lon: number },\n\t) {\n\t\ttry {\n\t\t\treturn await googleRoutesService.getETA(from, to);\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Rank technicians by ETA to a job location\n\t */\n\tasync rankTechniciansByETA(\n\t\ttechnicianLocations: Array<{\n\t\t\tid: string;\n\t\t\tname: string;\n\t\t\tlat: number;\n\t\t\tlon: number;\n\t\t}>,\n\t\tjobLocation: { lat: number; lon: number },\n\t) {\n\t\ttry {\n\t\t\treturn await googleRoutesService.rankTechniciansByETA(\n\t\t\t\ttechnicianLocations,\n\t\t\t\tjobLocation,\n\t\t\t);\n\t\t} catch (_error) {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t/**\n\t * Get optimized multi-stop route for a technician\n\t */\n\tasync getOptimizedRoute(\n\t\tstops: Array<{\n\t\t\tlat: number;\n\t\t\tlon: number;\n\t\t\taddress?: string;\n\t\t\tjobId?: string;\n\t\t}>,\n\t\toptimizeOrder = true,\n\t) {\n\t\ttry {\n\t\t\treturn await googleRoutesService.getMultiStopRoute(stops, optimizeOrder);\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get air quality data for a location\n\t */\n\tasync getAirQuality(lat: number, lon: number) {\n\t\ttry {\n\t\t\treturn await googleAirQualityService.getAirQuality(lat, lon);\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get pollen data for a location\n\t */\n\tasync getPollenData(lat: number, lon: number) {\n\t\ttry {\n\t\t\treturn await googlePollenService.getPollenData(lat, lon);\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get solar potential for a location\n\t */\n\tasync getSolarPotential(lat: number, lon: number) {\n\t\ttry {\n\t\t\treturn await googleSolarService.getSolarData(lat, lon);\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Generate a solar proposal summary for a property\n\t */\n\tasync getSolarProposal(lat: number, lon: number) {\n\t\ttry {\n\t\t\tconst solarData = await googleSolarService.getSolarData(lat, lon);\n\t\t\tif (!solarData) return null;\n\t\t\treturn googleSolarService.generateProposalSummary(solarData);\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get weather summary for display\n\t */\n\tgetWeatherSummary(weather: NonNullable<JobEnrichment[\"weather\"]>) {\n\t\treturn googleWeatherService.getWeatherSummary(weather);\n\t}\n\n\t/**\n\t * Check if weather is suitable for outdoor work\n\t */\n\tisWeatherSuitableForWork(weather: NonNullable<JobEnrichment[\"weather\"]>) {\n\t\treturn googleWeatherService.isSuitableForOutdoorWork(weather);\n\t}\n\n\t/**\n\t * Get HVAC filter recommendations based on air quality\n\t */\n\tgetHVACFilterRecommendation(\n\t\tairQuality: NonNullable<JobEnrichment[\"airQuality\"]>,\n\t) {\n\t\treturn googleAirQualityService.getHVACFilterRecommendation(airQuality);\n\t}\n\n\t/**\n\t * Get HVAC upsell recommendations based on pollen levels\n\t */\n\tgetPollenUpsellRecommendation(pollen: NonNullable<JobEnrichment[\"pollen\"]>) {\n\t\treturn googlePollenService.getHVACUpsellRecommendation(pollen);\n\t}\n}\n\n// Singleton instance\nexport const jobEnrichmentService = new JobEnrichmentService();\n","import { AppRouteRouteModule } from \"next/dist/esm/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/esm/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/esm/server/lib/patch-fetch\";\nimport { addRequestMeta, getRequestMeta } from \"next/dist/esm/server/request-meta\";\nimport { getTracer, SpanKind } from \"next/dist/esm/server/lib/trace/tracer\";\nimport { setReferenceManifestsSingleton } from \"next/dist/esm/server/app-render/encryption-utils\";\nimport { createServerModuleMap } from \"next/dist/esm/server/app-render/action-utils\";\nimport { normalizeAppPath } from \"next/dist/esm/shared/lib/router/utils/app-paths\";\nimport { NodeNextRequest, NodeNextResponse } from \"next/dist/esm/server/base-http/node\";\nimport { NextRequestAdapter, signalFromNodeResponse } from \"next/dist/esm/server/web/spec-extension/adapters/next-request\";\nimport { BaseServerSpan } from \"next/dist/esm/server/lib/trace/constants\";\nimport { getRevalidateReason } from \"next/dist/esm/server/instrumentation/utils\";\nimport { sendResponse } from \"next/dist/esm/server/send-response\";\nimport { fromNodeOutgoingHttpHeaders, toNodeOutgoingHttpHeaders } from \"next/dist/esm/server/web/utils\";\nimport { getCacheControlHeader } from \"next/dist/esm/server/lib/cache-control\";\nimport { INFINITE_CACHE, NEXT_CACHE_TAGS_HEADER } from \"next/dist/esm/lib/constants\";\nimport { NoFallbackError } from \"next/dist/esm/shared/lib/no-fallback-error.external\";\nimport { CachedRouteKind } from \"next/dist/esm/server/response-cache\";\nimport * as userland from \"INNER_APP_ROUTE\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/job-enrichment/route\",\n        pathname: \"/api/job-enrichment\",\n        filename: \"route\",\n        bundlePath: \"\"\n    },\n    distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n    relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n    resolvedPagePath: \"[project]/apps/web/src/app/api/job-enrichment/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\nexport async function handler(req, res, ctx) {\n    if (routeModule.isDev) {\n        addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint());\n    }\n    let srcPage = \"/api/job-enrichment/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (process.env.TURBOPACK) {\n        srcPage = srcPage.replace(/\\/index$/, '') || '/';\n    } else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = process.env.__NEXT_MULTI_ZONE_DRAFT_MODE;\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, parsedUrl, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname, clientReferenceManifest, serverActionsManifest } = prepareResult;\n    const normalizedSrcPage = normalizeAppPath(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    const render404 = async ()=>{\n        // TODO: should route-module itself handle rendering the 404\n        if (routerServerContext == null ? void 0 : routerServerContext.render404) {\n            await routerServerContext.render404(req, res, parsedUrl, false);\n        } else {\n            res.end('This page could not be found');\n        }\n        return null;\n    };\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                if (nextConfig.experimental.adapterPath) {\n                    return await render404();\n                }\n                throw new NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isStaticGeneration = isIsr && !supportsDynamicResponse;\n    // Before rendering (which initializes component tree modules), we have to\n    // set the reference manifests to our global store so Server Action's\n    // encryption util can access to them at the top level of the page module.\n    if (serverActionsManifest && clientReferenceManifest) {\n        setReferenceManifestsSingleton({\n            page: srcPage,\n            clientReferenceManifest,\n            serverActionsManifest,\n            serverModuleMap: createServerModuleMap({\n                serverActionsManifest\n            })\n        });\n    }\n    const method = req.method || 'GET';\n    const tracer = getTracer();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            cacheComponents: Boolean(nextConfig.cacheComponents),\n            supportsDynamicResponse,\n            incrementalCache: getRequestMeta(req, 'incrementalCache'),\n            cacheLifeProfiles: nextConfig.cacheLife,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext)=>routeModule.onRequestError(req, error, errorContext, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new NodeNextRequest(req);\n    const nodeNextRes = new NodeNextResponse(res);\n    const nextReq = NextRequestAdapter.fromNodeNextRequest(nodeNextReq, signalFromNodeResponse(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${srcPage}`);\n                }\n            });\n        };\n        const isMinimalMode = Boolean(process.env.MINIMAL_MODE || getRequestMeta(req, 'minimalMode'));\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!isMinimalMode && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = toNodeOutgoingHttpHeaders(response.headers);\n                        if (cacheTags) {\n                            headers[NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await sendResponse(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: getRevalidateReason({\n                                isStaticGeneration,\n                                isOnDemandRevalidate\n                            })\n                        }, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil,\n                isMinimalMode\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!isMinimalMode) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = fromNodeOutgoingHttpHeaders(cacheEntry.value.headers);\n            if (!(isMinimalMode && isIsr)) {\n                headers.delete(NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', getCacheControlHeader(cacheEntry.cacheControl));\n            }\n            await sendResponse(nodeNextReq, nodeNextRes, // @ts-expect-error - Argument of type 'Buffer<ArrayBufferLike>' is not assignable to parameter of type 'BodyInit | null | undefined'.\n            new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${srcPage}`,\n                    kind: SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        if (!(err instanceof NoFallbackError)) {\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: getRevalidateReason({\n                    isStaticGeneration,\n                    isOnDemandRevalidate\n                })\n            });\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await sendResponse(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map\n","/**\n * Building Data Service\n *\n * Fetches building information from OpenStreetMap via Overpass API\n * - Building footprints, height, type\n * - Construction details\n * - 100% free, no API key needed\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst BuildingDataSchema = z.object({\n\t// Building geometry\n\tfootprint: z\n\t\t.object({\n\t\t\tarea: z.number().optional(), // square meters\n\t\t\tperimeter: z.number().optional(), // meters\n\t\t\tcoordinates: z.array(z.array(z.number())).optional(), // [[lon, lat], ...]\n\t\t})\n\t\t.optional(),\n\n\t// Building characteristics\n\tbuildingType: z.string().optional(), // residential, commercial, industrial, etc.\n\theight: z.number().optional(), // meters\n\tlevels: z.number().optional(), // number of floors\n\troofShape: z.string().optional(), // flat, gabled, hipped, etc.\n\troofMaterial: z.string().optional(), // concrete, metal, tiles, etc.\n\twallMaterial: z.string().optional(), // brick, wood, concrete, etc.\n\tconstructionDate: z.string().optional(), // YYYY or YYYY-MM-DD\n\n\t// Address data\n\taddressFromOSM: z\n\t\t.object({\n\t\t\thouseNumber: z.string().optional(),\n\t\t\tstreet: z.string().optional(),\n\t\t\tcity: z.string().optional(),\n\t\t\tstate: z.string().optional(),\n\t\t\tpostcode: z.string().optional(),\n\t\t})\n\t\t.optional(),\n\n\t// Metadata\n\tdataSource: z.literal(\"osm\"),\n\tosmId: z.number().optional(),\n\tosmType: z.enum([\"node\", \"way\", \"relation\"]).optional(),\n\tenrichedAt: z.string(),\n});\n\nexport type BuildingData = z.infer<typeof BuildingDataSchema>;\n\n// ============================================================================\n// Building Data Service\n// ============================================================================\n\nclass BuildingDataService {\n\tprivate readonly cache: Map<\n\t\tstring,\n\t\t{ data: BuildingData; timestamp: number }\n\t> = new Map();\n\t// biome-ignore lint: Cache TTL calculation with standard time units\n\tprivate readonly cacheTTL = 1000 * 60 * 60 * 24 * 30; // 30 days\n\n\t/**\n\t * Get building data from OpenStreetMap for a specific location\n\t */\n\tasync getBuildingData(\n\t\tlat: number,\n\t\tlon: number,\n\t): Promise<BuildingData | null> {\n\t\tconst cacheKey = `building:${lat.toFixed(6)},${lon.toFixed(6)}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\n\t\tif (cached && Date.now() - cached.timestamp < this.cacheTTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\t// Query Overpass API for building at this location\n\t\t\t// Search within 25m radius to account for GPS accuracy\n\t\t\tconst query = `\n        [out:json][timeout:25];\n        (\n          way(around:25,${lat},${lon})[\"building\"];\n          relation(around:25,${lat},${lon})[\"building\"];\n        );\n        out tags geom;\n      `.trim();\n\n\t\t\tconst res = await fetch(\"https://overpass-api.de/api/interpreter\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\t\"Content-Type\": \"text/plain\",\n\t\t\t\t\t\"User-Agent\": USER_AGENT,\n\t\t\t\t},\n\t\t\t\tbody: query,\n\t\t\t});\n\n\t\t\tif (!res.ok) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await res.json();\n\t\t\tconst elements = data.elements || [];\n\n\t\t\tif (elements.length === 0) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Take the first (closest) building\n\t\t\tconst building = elements[0];\n\n\t\t\t// Extract building data\n\t\t\tconst tags = building.tags || {};\n\t\t\tconst buildingData: BuildingData = {\n\t\t\t\tbuildingType: this.normalizeBuildingType(tags.building),\n\t\t\t\theight: tags.height ? Number.parseFloat(tags.height) : undefined,\n\t\t\t\tlevels: tags[\"building:levels\"]\n\t\t\t\t\t? Number.parseInt(tags[\"building:levels\"], 10)\n\t\t\t\t\t: undefined,\n\t\t\t\troofShape: tags[\"roof:shape\"],\n\t\t\t\troofMaterial: tags[\"roof:material\"],\n\t\t\t\twallMaterial: tags[\"wall:material\"] || tags[\"building:material\"],\n\t\t\t\tconstructionDate: tags.start_date || tags.construction_date,\n\t\t\t\taddressFromOSM: {\n\t\t\t\t\thouseNumber: tags[\"addr:housenumber\"],\n\t\t\t\t\tstreet: tags[\"addr:street\"],\n\t\t\t\t\tcity: tags[\"addr:city\"],\n\t\t\t\t\tstate: tags[\"addr:state\"],\n\t\t\t\t\tpostcode: tags[\"addr:postcode\"],\n\t\t\t\t},\n\t\t\t\tosmId: building.id,\n\t\t\t\tosmType: building.type as \"node\" | \"way\" | \"relation\",\n\t\t\t\tdataSource: \"osm\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\n\t\t\t// Calculate footprint if geometry is available\n\t\t\tif (building.geometry && building.geometry.length > 0) {\n\t\t\t\tconst coords = building.geometry.map((point: any) => [\n\t\t\t\t\tpoint.lon,\n\t\t\t\t\tpoint.lat,\n\t\t\t\t]);\n\t\t\t\tconst area = this.calculatePolygonArea(coords);\n\t\t\t\tconst perimeter = this.calculatePolygonPerimeter(coords);\n\n\t\t\t\tbuildingData.footprint = {\n\t\t\t\t\tarea: Math.round(area),\n\t\t\t\t\tperimeter: Math.round(perimeter),\n\t\t\t\t\tcoordinates: coords,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst parsedData = BuildingDataSchema.parse(buildingData);\n\t\t\tthis.cache.set(cacheKey, {\n\t\t\t\tdata: parsedData,\n\t\t\t\ttimestamp: Date.now(),\n\t\t\t});\n\t\t\treturn parsedData;\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Normalize building type from OSM tags\n\t */\n\tprivate normalizeBuildingType(\n\t\tbuildingTag: string | undefined,\n\t): string | undefined {\n\t\tif (!buildingTag || buildingTag === \"yes\") {\n\t\t\treturn;\n\t\t}\n\n\t\tconst typeMap: Record<string, string> = {\n\t\t\thouse: \"residential\",\n\t\t\tdetached: \"residential\",\n\t\t\tsemidetached_house: \"residential\",\n\t\t\tterrace: \"residential\",\n\t\t\tapartments: \"residential\",\n\t\t\tresidential: \"residential\",\n\t\t\tcommercial: \"commercial\",\n\t\t\tretail: \"commercial\",\n\t\t\toffice: \"commercial\",\n\t\t\tindustrial: \"industrial\",\n\t\t\twarehouse: \"industrial\",\n\t\t\tshed: \"storage\",\n\t\t\tgarage: \"storage\",\n\t\t\tgarages: \"storage\",\n\t\t\tchurch: \"religious\",\n\t\t\tschool: \"educational\",\n\t\t\thospital: \"healthcare\",\n\t\t\thotel: \"hospitality\",\n\t\t};\n\n\t\treturn typeMap[buildingTag.toLowerCase()] || buildingTag;\n\t}\n\n\t/**\n\t * Calculate area of a polygon using the Shoelace formula\n\t * Coordinates: [[lon, lat], ...]\n\t * Returns area in square meters\n\t */\n\t// biome-ignore lint: Mathematical formulas with well-known constants\n\tprivate calculatePolygonArea(coords: number[][]): number {\n\t\tif (coords.length < 3) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tlet area = 0;\n\t\tfor (let i = 0; i < coords.length; i++) {\n\t\t\tconst j = (i + 1) % coords.length;\n\t\t\tarea += coords[i][0] * coords[j][1];\n\t\t\tarea -= coords[j][0] * coords[i][1];\n\t\t}\n\n\t\tarea = Math.abs(area / 2);\n\n\t\t// Convert from degrees to meters (rough approximation at mid-latitudes)\n\t\t// 1 degree latitude  111,000 meters\n\t\t// 1 degree longitude varies by latitude\n\t\tconst lat = coords[0][1];\n\t\tconst metersPerDegreeLat = 111_000;\n\t\tconst metersPerDegreeLon = 111_000 * Math.cos((lat * Math.PI) / 180);\n\n\t\treturn area * metersPerDegreeLat * metersPerDegreeLon;\n\t}\n\n\t/**\n\t * Calculate perimeter of a polygon\n\t * Returns perimeter in meters\n\t */\n\t// biome-ignore lint: Mathematical formulas with well-known constants (Haversine)\n\tprivate calculatePolygonPerimeter(coords: number[][]): number {\n\t\tif (coords.length < 2) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tlet perimeter = 0;\n\t\tfor (let i = 0; i < coords.length; i++) {\n\t\t\tconst j = (i + 1) % coords.length;\n\t\t\tconst lat1 = coords[i][1];\n\t\t\tconst lon1 = coords[i][0];\n\t\t\tconst lat2 = coords[j][1];\n\t\t\tconst lon2 = coords[j][0];\n\n\t\t\t// Haversine formula for distance between two points\n\t\t\tconst R = 6_371_000; // Earth's radius in meters\n\t\t\tconst dLat = ((lat2 - lat1) * Math.PI) / 180;\n\t\t\tconst dLon = ((lon2 - lon1) * Math.PI) / 180;\n\t\t\tconst a =\n\t\t\t\tMath.sin(dLat / 2) * Math.sin(dLat / 2) +\n\t\t\t\tMath.cos((lat1 * Math.PI) / 180) *\n\t\t\t\t\tMath.cos((lat2 * Math.PI) / 180) *\n\t\t\t\t\tMath.sin(dLon / 2) *\n\t\t\t\t\tMath.sin(dLon / 2);\n\t\t\tconst c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\t\t\tperimeter += R * c;\n\t\t}\n\n\t\treturn perimeter;\n\t}\n}\n\n// Singleton instance\nexport const buildingDataService = new BuildingDataService();\n","/**\n * Elevation Service\n *\n * Fetches elevation data from USGS Elevation Point Query Service\n * - Elevation in feet/meters\n * - Useful for drainage, flooding, and foundation assessments\n *\n * API: FREE, no key required\n * Docs: https://nationalmap.gov/epqs/\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\nconst ElevationSchema = z.object({\n\televationFeet: z.number(),\n\televationMeters: z.number(),\n\tdataSource: z.string(),\n\tenrichedAt: z.string(),\n});\n\nexport type Elevation = z.infer<typeof ElevationSchema>;\n\nclass ElevationService {\n\tprivate readonly cache: Map<string, { data: Elevation; timestamp: number }> =\n\t\tnew Map();\n\tprivate readonly cacheTTL = 1000 * 60 * 60 * 24 * 365; // 1 year (elevation doesn't change)\n\n\tasync getElevation(lat: number, lon: number): Promise<Elevation | null> {\n\t\tconst cacheKey = `elevation:${lat.toFixed(6)},${lon.toFixed(6)}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\n\t\tif (cached && Date.now() - cached.timestamp < this.cacheTTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\t// USGS Elevation Point Query Service\n\t\t\tconst url = `https://epqs.nationalmap.gov/v1/json?x=${lon}&y=${lat}&units=Feet&includeDate=false`;\n\n\t\t\tconst res = await fetch(url, {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!res.ok) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst text = await res.text();\n\t\t\tif (!text || text.trim() === \"\") {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tlet data: unknown;\n\t\t\ttry {\n\t\t\t\tdata = JSON.parse(text);\n\t\t\t} catch (_e) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (!data || typeof data !== \"object\" || !(\"value\" in data)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst elevationData = data as { value: string };\n\t\t\tif (!elevationData.value) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst elevationFeet = Number.parseFloat(elevationData.value);\n\t\t\tconst elevationMeters = elevationFeet * 0.3048;\n\n\t\t\tconst elevation: Elevation = {\n\t\t\t\televationFeet: Math.round(elevationFeet),\n\t\t\t\televationMeters: Math.round(elevationMeters * 10) / 10,\n\t\t\t\tdataSource: \"usgs\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\n\t\t\tthis.cache.set(cacheKey, { data: elevation, timestamp: Date.now() });\n\n\t\t\treturn elevation;\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n}\n\nexport const elevationService = new ElevationService();\n","/**\n * Property Data Service\n *\n * Fetches property information from free public data sources:\n * - Attom Property API (free tier: 100 requests/month)\n * - FCC Census API (already in use, provides demographics)\n * - County tax assessor data (varies by county)\n *\n * Note: Zillow's Zestimate API was discontinued in 2021.\n * Alternatives require paid subscriptions (Zillow API, Realtor.com, etc.)\n */\n\nimport { z } from \"zod\";\n\nconst _USER_AGENT = \"ThorbisFieldService/1.0\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst PropertyDataSchema = z.object({\n\t// Basic property info\n\taddress: z.object({\n\t\tfull: z.string(),\n\t\tstreet: z.string(),\n\t\tcity: z.string(),\n\t\tstate: z.string(),\n\t\tzipCode: z.string(),\n\t}),\n\n\t// Property characteristics\n\tcharacteristics: z\n\t\t.object({\n\t\t\tpropertyType: z.string().optional(), // Residential, Commercial, etc.\n\t\t\tyearBuilt: z.number().optional(),\n\t\t\tsquareFeet: z.number().optional(),\n\t\t\tlotSize: z.number().optional(),\n\t\t\tbedrooms: z.number().optional(),\n\t\t\tbathrooms: z.number().optional(),\n\t\t\tstories: z.number().optional(),\n\t\t\tgarage: z.boolean().optional(),\n\t\t\tpool: z.boolean().optional(),\n\t\t})\n\t\t.optional(),\n\n\t// Tax assessment data\n\tassessment: z\n\t\t.object({\n\t\t\tassessedValue: z.number().optional(),\n\t\t\ttaxAmount: z.number().optional(),\n\t\t\tassessmentYear: z.number().optional(),\n\t\t})\n\t\t.optional(),\n\n\t// Market estimates (if available)\n\tmarket: z\n\t\t.object({\n\t\t\testimatedValue: z.number().optional(),\n\t\t\testimatedValueRange: z\n\t\t\t\t.object({\n\t\t\t\t\tlow: z.number(),\n\t\t\t\t\thigh: z.number(),\n\t\t\t\t})\n\t\t\t\t.optional(),\n\t\t\tpricePerSqFt: z.number().optional(),\n\t\t\tlastSoldDate: z.string().optional(),\n\t\t\tlastSoldPrice: z.number().optional(),\n\t\t})\n\t\t.optional(),\n\n\t// Demographics (from Census)\n\tdemographics: z\n\t\t.object({\n\t\t\tmedianHouseholdIncome: z.number().optional(),\n\t\t\tmedianHomeValue: z.number().optional(),\n\t\t\tpopulation: z.number().optional(),\n\t\t})\n\t\t.optional(),\n\n\t// Metadata\n\tdataSource: z.string(),\n\tenrichedAt: z.string(),\n});\n\nexport type PropertyData = z.infer<typeof PropertyDataSchema>;\n\n// ============================================================================\n// Property Data Service\n// ============================================================================\n\nclass PropertyDataService {\n\tprivate readonly rentcastApiKey: string | undefined;\n\tprivate readonly attomApiKey: string | undefined; // Optional fallback\n\tprivate readonly cache: Map<\n\t\tstring,\n\t\t{ data: PropertyData; timestamp: number }\n\t> = new Map();\n\tprivate readonly cacheTTL = 1000 * 60 * 60 * 24 * 30; // 30 days (property data doesn't change often)\n\n\tconstructor() {\n\t\tthis.rentcastApiKey = process.env.RENTCAST_API_KEY;\n\t\tthis.attomApiKey = process.env.ATTOM_API_KEY; // Optional\n\t}\n\n\t/**\n\t * Get comprehensive property data\n\t */\n\tasync getPropertyData(\n\t\taddress: string,\n\t\tcity: string,\n\t\tstate: string,\n\t\tzipCode: string,\n\t\t_lat?: number,\n\t\t_lon?: number,\n\t): Promise<PropertyData | null> {\n\t\tconst cacheKey = `${address}-${city}-${state}-${zipCode}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\n\t\tif (cached && Date.now() - cached.timestamp < this.cacheTTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\tconst fullAddress = `${address}, ${city}, ${state} ${zipCode}`;\n\n\t\t\t// Try RentCast first (free tier: 50/month)\n\t\t\tlet propertyData = await this.getRentCastData(\n\t\t\t\taddress,\n\t\t\t\tcity,\n\t\t\t\tstate,\n\t\t\t\tzipCode,\n\t\t\t);\n\n\t\t\t// Fallback to Attom if available\n\t\t\tif (!propertyData && this.attomApiKey) {\n\t\t\t\tpropertyData = await this.getAttomData(address, city, state, zipCode);\n\t\t\t}\n\n\t\t\t// Final fallback to basic data\n\t\t\tif (!propertyData) {\n\t\t\t\tpropertyData = {\n\t\t\t\t\taddress: {\n\t\t\t\t\t\tfull: fullAddress,\n\t\t\t\t\t\tstreet: address,\n\t\t\t\t\t\tcity,\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tzipCode,\n\t\t\t\t\t},\n\t\t\t\t\tdataSource: \"none\",\n\t\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Cache the result\n\t\t\tthis.cache.set(cacheKey, {\n\t\t\t\tdata: propertyData,\n\t\t\t\ttimestamp: Date.now(),\n\t\t\t});\n\n\t\t\treturn propertyData;\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get property data from RentCast API (formerly Realty Mole)\n\t * Free tier: 50 requests/month (FOREVER - no trial)\n\t * Paid: $99/month for 1,000 requests\n\t * https://rentcast.io/api\n\t */\n\tprivate async getRentCastData(\n\t\taddress: string,\n\t\tcity: string,\n\t\tstate: string,\n\t\tzipCode: string,\n\t): Promise<PropertyData | null> {\n\t\tif (!this.rentcastApiKey) {\n\t\t\treturn null;\n\t\t}\n\n\t\ttry {\n\t\t\t// RentCast Property Records API\n\t\t\tconst url = `https://api.rentcast.io/v1/properties?address=${encodeURIComponent(address)}&city=${encodeURIComponent(city)}&state=${encodeURIComponent(state)}&zipCode=${encodeURIComponent(zipCode)}`;\n\n\t\t\tconst res = await fetch(url, {\n\t\t\t\theaders: {\n\t\t\t\t\t\"X-Api-Key\": this.rentcastApiKey,\n\t\t\t\t\tAccept: \"application/json\",\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (!res.ok) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await res.json();\n\n\t\t\tif (!data?.id) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Parse RentCast response\n\t\t\treturn {\n\t\t\t\taddress: {\n\t\t\t\t\tfull: `${address}, ${city}, ${state} ${zipCode}`,\n\t\t\t\t\tstreet: address,\n\t\t\t\t\tcity,\n\t\t\t\t\tstate,\n\t\t\t\t\tzipCode,\n\t\t\t\t},\n\t\t\t\tcharacteristics: {\n\t\t\t\t\tpropertyType: data.propertyType,\n\t\t\t\t\tyearBuilt: data.yearBuilt,\n\t\t\t\t\tsquareFeet: data.squareFootage,\n\t\t\t\t\tlotSize: data.lotSize,\n\t\t\t\t\tbedrooms: data.bedrooms,\n\t\t\t\t\tbathrooms: data.bathrooms,\n\t\t\t\t\tstories: data.stories,\n\t\t\t\t\tgarage: data.garage ? true : undefined,\n\t\t\t\t\tpool: data.pool ? true : undefined,\n\t\t\t\t},\n\t\t\t\tassessment: data.assessedValue\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tassessedValue: data.assessedValue,\n\t\t\t\t\t\t\ttaxAmount: data.propertyTaxes,\n\t\t\t\t\t\t\tassessmentYear: data.assessedYear,\n\t\t\t\t\t\t}\n\t\t\t\t\t: undefined,\n\t\t\t\tmarket: {\n\t\t\t\t\testimatedValue: data.price || data.addressedValue,\n\t\t\t\t\tlastSoldDate: data.lastSaleDate,\n\t\t\t\t\tlastSoldPrice: data.lastSalePrice,\n\t\t\t\t\tpricePerSqFt:\n\t\t\t\t\t\tdata.price && data.squareFootage\n\t\t\t\t\t\t\t? Math.round(data.price / data.squareFootage)\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t},\n\t\t\t\tdataSource: \"rentcast\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get property data from Attom Data API (OPTIONAL FALLBACK)\n\t * Free tier: 30 days trial only\n\t * Paid: $500+/month\n\t * https://api.developer.attomdata.com/\n\t */\n\tprivate async getAttomData(\n\t\taddress: string,\n\t\tcity: string,\n\t\tstate: string,\n\t\tzipCode: string,\n\t): Promise<PropertyData | null> {\n\t\tif (!this.attomApiKey) {\n\t\t\treturn null;\n\t\t}\n\n\t\ttry {\n\t\t\t// Attom Property API - Basic Profile\n\t\t\tconst url = `https://api.gateway.attomdata.com/propertyapi/v1.0.0/property/basicprofile?address1=${encodeURIComponent(address)}&address2=${encodeURIComponent(`${city}, ${state} ${zipCode}`)}`;\n\n\t\t\tconst res = await fetch(url, {\n\t\t\t\theaders: {\n\t\t\t\t\tapikey: this.attomApiKey,\n\t\t\t\t\tAccept: \"application/json\",\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (!res.ok) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await res.json();\n\t\t\tconst property = data.property?.[0];\n\n\t\t\tif (!property) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Parse Attom response\n\t\t\tconst building = property.building;\n\t\t\tconst summary = property.summary;\n\t\t\tconst assessment = property.assessment;\n\t\t\tconst sale = property.sale;\n\n\t\t\treturn {\n\t\t\t\taddress: {\n\t\t\t\t\tfull: `${address}, ${city}, ${state} ${zipCode}`,\n\t\t\t\t\tstreet: address,\n\t\t\t\t\tcity,\n\t\t\t\t\tstate,\n\t\t\t\t\tzipCode,\n\t\t\t\t},\n\t\t\t\tcharacteristics: {\n\t\t\t\t\tpropertyType: building?.propertyType || summary?.proptype,\n\t\t\t\t\tyearBuilt: building?.yearBuilt\n\t\t\t\t\t\t? Number.parseInt(building.yearBuilt, 10)\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\tsquareFeet: building?.size?.livingSize\n\t\t\t\t\t\t? Number.parseInt(building.size.livingSize, 10)\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\tlotSize: summary?.lotSize\n\t\t\t\t\t\t? Number.parseInt(summary.lotSize, 10)\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\tbedrooms: building?.rooms?.beds\n\t\t\t\t\t\t? Number.parseInt(building.rooms.beds, 10)\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\tbathrooms: building?.rooms?.bathstotal\n\t\t\t\t\t\t? Number.parseInt(building.rooms.bathstotal, 10)\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\tstories: building?.stories\n\t\t\t\t\t\t? Number.parseInt(building.stories, 10)\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\tgarage: building?.parking?.garagetype ? true : undefined,\n\t\t\t\t\tpool: building?.pool ? true : undefined,\n\t\t\t\t},\n\t\t\t\tassessment: assessment\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tassessedValue: assessment.assessed?.assdTtlValue\n\t\t\t\t\t\t\t\t? Number.parseInt(assessment.assessed.assdTtlValue, 10)\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\ttaxAmount: assessment.tax?.taxAmt\n\t\t\t\t\t\t\t\t? Number.parseInt(assessment.tax.taxAmt, 10)\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\tassessmentYear: assessment.assessed?.assdYear\n\t\t\t\t\t\t\t\t? Number.parseInt(assessment.assessed.assdYear, 10)\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t}\n\t\t\t\t\t: undefined,\n\t\t\t\tmarket: sale\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tlastSoldDate: sale.saleTransDate,\n\t\t\t\t\t\t\tlastSoldPrice: sale.amount?.saleAmt\n\t\t\t\t\t\t\t\t? Number.parseInt(sale.amount.saleAmt, 10)\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t}\n\t\t\t\t\t: undefined,\n\t\t\t\tdataSource: \"attom\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Calculate estimated property characteristics based on available data\n\t */\n\testimateCharacteristics(propertyData: PropertyData): {\n\t\tageYears?: number;\n\t\tpropertyCondition?: \"new\" | \"good\" | \"average\" | \"fair\" | \"poor\";\n\t\trecommendMaintenance?: string[];\n\t} {\n\t\tconst result: {\n\t\t\tageYears?: number;\n\t\t\tpropertyCondition?: \"new\" | \"good\" | \"average\" | \"fair\" | \"poor\";\n\t\t\trecommendMaintenance?: string[];\n\t\t} = {};\n\n\t\tif (propertyData.characteristics?.yearBuilt) {\n\t\t\tconst currentYear = new Date().getFullYear();\n\t\t\tresult.ageYears = currentYear - propertyData.characteristics.yearBuilt;\n\n\t\t\t// Estimate condition based on age\n\t\t\tif (result.ageYears < 5) {\n\t\t\t\tresult.propertyCondition = \"new\";\n\t\t\t} else if (result.ageYears < 15) {\n\t\t\t\tresult.propertyCondition = \"good\";\n\t\t\t} else if (result.ageYears < 30) {\n\t\t\t\tresult.propertyCondition = \"average\";\n\t\t\t} else if (result.ageYears < 50) {\n\t\t\t\tresult.propertyCondition = \"fair\";\n\t\t\t} else {\n\t\t\t\tresult.propertyCondition = \"poor\";\n\t\t\t}\n\n\t\t\t// Maintenance recommendations based on age\n\t\t\tconst maintenance: string[] = [];\n\n\t\t\tif (result.ageYears > 15) {\n\t\t\t\tmaintenance.push(\n\t\t\t\t\t\"Water heater likely needs replacement (15-20 year lifespan)\",\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (result.ageYears > 20) {\n\t\t\t\tmaintenance.push(\n\t\t\t\t\t\"HVAC system may need replacement (15-25 year lifespan)\",\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (result.ageYears > 25) {\n\t\t\t\tmaintenance.push(\"Plumbing systems should be inspected for corrosion\");\n\t\t\t}\n\t\t\tif (result.ageYears > 30) {\n\t\t\t\tmaintenance.push(\"Electrical panel upgrade may be needed\");\n\t\t\t}\n\n\t\t\tresult.recommendMaintenance = maintenance;\n\t\t}\n\n\t\treturn result;\n\t}\n}\n\n// Singleton instance\nexport const propertyDataService = new PropertyDataService();\n","/**\n * Walkability Service\n *\n * Calculates walkability score based on nearby amenities from OpenStreetMap\n * - Nearby amenities (restaurants, shops, schools, parks)\n * - Distance to transit\n * - Walkability score (0-100)\n *\n * API: FREE, no key required (using Overpass API)\n * Data: OpenStreetMap\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\nconst WalkabilitySchema = z.object({\n\tscore: z.number(), // 0-100\n\tcategory: z.string(), // Car-Dependent, Somewhat Walkable, Very Walkable, Walker's Paradise\n\tnearbyAmenities: z.object({\n\t\trestaurants: z.number(),\n\t\tshops: z.number(),\n\t\tschools: z.number(),\n\t\tparks: z.number(),\n\t\ttransit: z.number(),\n\t\thealthcare: z.number(),\n\t}),\n\tclosestTransit: z.number().optional(), // meters\n\tdataSource: z.string(),\n\tenrichedAt: z.string(),\n});\n\nexport type Walkability = z.infer<typeof WalkabilitySchema>;\n\nclass WalkabilityService {\n\tprivate readonly cache: Map<\n\t\tstring,\n\t\t{ data: Walkability; timestamp: number }\n\t> = new Map();\n\tprivate readonly cacheTTL = 1000 * 60 * 60 * 24 * 30; // 30 days\n\n\tasync getWalkability(lat: number, lon: number): Promise<Walkability | null> {\n\t\tconst cacheKey = `walkability:${lat.toFixed(4)},${lon.toFixed(4)}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\n\t\tif (cached && Date.now() - cached.timestamp < this.cacheTTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\t// Query Overpass API for amenities within 1km\n\t\t\tconst radius = 1000; // 1km\n\t\t\tconst query = `\n        [out:json][timeout:25];\n        (\n          node(around:${radius},${lat},${lon})[\"amenity\"~\"restaurant|cafe|fast_food|bar|pub\"];\n          node(around:${radius},${lat},${lon})[\"shop\"];\n          node(around:${radius},${lat},${lon})[\"amenity\"~\"school|kindergarten|college|university\"];\n          node(around:${radius},${lat},${lon})[\"leisure\"~\"park|playground|garden\"];\n          node(around:${radius},${lat},${lon})[\"public_transport\"];\n          node(around:${radius},${lat},${lon})[\"amenity\"~\"hospital|clinic|doctors|pharmacy\"];\n        );\n        out count;\n      `.trim();\n\n\t\t\tconst res = await fetch(\"https://overpass-api.de/api/interpreter\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\t\"Content-Type\": \"text/plain\",\n\t\t\t\t\t\"User-Agent\": USER_AGENT,\n\t\t\t\t},\n\t\t\t\tbody: query,\n\t\t\t});\n\n\t\t\tif (!res.ok) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await res.json();\n\n\t\t\t// Count amenities by type\n\t\t\tconst amenityCounts = {\n\t\t\t\trestaurants: 0,\n\t\t\t\tshops: 0,\n\t\t\t\tschools: 0,\n\t\t\t\tparks: 0,\n\t\t\t\ttransit: 0,\n\t\t\t\thealthcare: 0,\n\t\t\t};\n\n\t\t\tif (data.elements) {\n\t\t\t\tfor (const element of data.elements) {\n\t\t\t\t\tconst tags = element.tags || {};\n\n\t\t\t\t\tif (tags.amenity) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t[\"restaurant\", \"cafe\", \"fast_food\", \"bar\", \"pub\"].includes(\n\t\t\t\t\t\t\t\ttags.amenity,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tamenityCounts.restaurants++;\n\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t[\"school\", \"kindergarten\", \"college\", \"university\"].includes(\n\t\t\t\t\t\t\t\ttags.amenity,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tamenityCounts.schools++;\n\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t[\"hospital\", \"clinic\", \"doctors\", \"pharmacy\"].includes(\n\t\t\t\t\t\t\t\ttags.amenity,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tamenityCounts.healthcare++;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (tags.shop) {\n\t\t\t\t\t\tamenityCounts.shops++;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\ttags.leisure &&\n\t\t\t\t\t\t[\"park\", \"playground\", \"garden\"].includes(tags.leisure)\n\t\t\t\t\t) {\n\t\t\t\t\t\tamenityCounts.parks++;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (tags.public_transport) {\n\t\t\t\t\t\tamenityCounts.transit++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Calculate walkability score (0-100)\n\t\t\t// Based on weighted amenity counts\n\t\t\tconst score = Math.min(\n\t\t\t\t100,\n\t\t\t\tamenityCounts.restaurants * 2 +\n\t\t\t\t\tamenityCounts.shops * 2 +\n\t\t\t\t\tamenityCounts.schools * 5 +\n\t\t\t\t\tamenityCounts.parks * 3 +\n\t\t\t\t\tamenityCounts.transit * 10 +\n\t\t\t\t\tamenityCounts.healthcare * 5,\n\t\t\t);\n\n\t\t\tconst category = this.getWalkabilityCategory(score);\n\n\t\t\tconst walkability: Walkability = {\n\t\t\t\tscore: Math.round(score),\n\t\t\t\tcategory,\n\t\t\t\tnearbyAmenities: amenityCounts,\n\t\t\t\tdataSource: \"osm\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\n\t\t\tthis.cache.set(cacheKey, { data: walkability, timestamp: Date.now() });\n\n\t\t\treturn walkability;\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tprivate getWalkabilityCategory(score: number): string {\n\t\tif (score >= 90) {\n\t\t\treturn \"Walker's Paradise\";\n\t\t}\n\t\tif (score >= 70) {\n\t\t\treturn \"Very Walkable\";\n\t\t}\n\t\tif (score >= 50) {\n\t\t\treturn \"Somewhat Walkable\";\n\t\t}\n\t\tif (score >= 25) {\n\t\t\treturn \"Car-Dependent\";\n\t\t}\n\t\treturn \"Very Car-Dependent\";\n\t}\n}\n\nexport const walkabilityService = new WalkabilityService();\n","/**\n * Water Quality Service\n *\n * Provides water hardness data for upselling water softeners\n * Uses USGS Water Quality Portal (free, public data)\n *\n * Features:\n * - Water hardness measurements (mg/L as CaCO3)\n * - Softener recommendations\n * - Historical data trends\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst WaterQualitySchema = z.object({\n\tlocation: z.object({\n\t\tlat: z.number(),\n\t\tlon: z.number(),\n\t\tsiteName: z.string().optional(),\n\t\torganization: z.string().optional(),\n\t}),\n\thardness: z.object({\n\t\tvalueMgL: z.number(),\n\t\tclassification: z.enum([\"soft\", \"moderate\", \"hard\", \"very_hard\"]),\n\t\tunit: z.string(),\n\t\tmeasurementDate: z.string().optional(),\n\t}),\n\trecommendations: z.object({\n\t\tshouldInstallSoftener: z.boolean(),\n\t\treason: z.string(),\n\t\testimatedAnnualSavings: z.number().optional(), // In cents\n\t}),\n\tenrichedAt: z.string(),\n});\n\nexport type WaterQuality = z.infer<typeof WaterQualitySchema>;\n\n// ============================================================================\n// Water Quality Service\n// ============================================================================\n\nclass WaterQualityService {\n\tprivate readonly cache: Map<\n\t\tstring,\n\t\t{ data: WaterQuality; timestamp: number }\n\t> = new Map();\n\tprivate readonly cacheTTL = 1000 * 60 * 60 * 24 * 30; // 30 days (data changes slowly)\n\n\t/**\n\t * Get water quality data for a location\n\t */\n\tasync getWaterQuality(\n\t\tlat: number,\n\t\tlon: number,\n\t): Promise<WaterQuality | null> {\n\t\tconst cacheKey = `${lat.toFixed(4)},${lon.toFixed(4)}`;\n\n\t\t// Check cache\n\t\tconst cached = this.cache.get(cacheKey);\n\t\tif (cached && Date.now() - cached.timestamp < this.cacheTTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\t// Query Water Quality Portal for hardness measurements\n\t\t\tconst params = new URLSearchParams({\n\t\t\t\tmimeType: \"json\",\n\t\t\t\tzip: \"no\",\n\t\t\t\t// Search for hardness as CaCO3\n\t\t\t\tcharacteristicName: \"Hardness, Ca, Mg as CaCO3\",\n\t\t\t\tlat: lat.toFixed(6),\n\t\t\t\tlong: lon.toFixed(6),\n\t\t\t\twithin: \"25\", // 25 km radius\n\t\t\t\tsorted: \"no\",\n\t\t\t\tstartDateLo: this.getDateYearsAgo(5), // Last 5 years\n\t\t\t});\n\n\t\t\tconst url = `https://www.waterqualitydata.us/data/Result/search?${params}`;\n\n\t\t\tconst res = await fetch(url, {\n\t\t\t\theaders: {\n\t\t\t\t\t\"User-Agent\": USER_AGENT,\n\t\t\t\t\tAccept: \"application/json\",\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (!res.ok) {\n\t\t\t\t// 406 (Not Acceptable) or 404 means no data available for this location (expected)\n\t\t\t\tif (res.status === 404 || res.status === 406) {\n\t\t\t\t\t// No data available for this location - this is expected for many areas\n\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t`Water quality: No data available for location (${lat}, ${lon})`,\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\t// Unexpected error from the API\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t`Water quality API error: ${res.status} for location (${lat}, ${lon})`,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await res.json();\n\n\t\t\tif (!(data && Array.isArray(data)) || data.length === 0) {\n\t\t\t\t// No data available - return default/unknown\n\t\t\t\treturn this.getDefaultWaterQuality(lat, lon);\n\t\t\t}\n\n\t\t\t// Get most recent measurement\n\t\t\tconst measurements = data\n\t\t\t\t.filter(\n\t\t\t\t\t(row: any) =>\n\t\t\t\t\t\trow.ResultMeasureValue &&\n\t\t\t\t\t\t!Number.isNaN(Number(row.ResultMeasureValue)),\n\t\t\t\t)\n\t\t\t\t.map((row: any) => ({\n\t\t\t\t\tvalue: Number(row.ResultMeasureValue),\n\t\t\t\t\tunit: row.ResultMeasure?.MeasureUnitCode || \"mg/L\",\n\t\t\t\t\tdate: row.ActivityStartDate,\n\t\t\t\t\tsite: row.MonitoringLocationName,\n\t\t\t\t\torg: row.OrganizationFormalName,\n\t\t\t\t}))\n\t\t\t\t.sort((a: any, b: any) => {\n\t\t\t\t\tconst dateA = new Date(a.date || 0);\n\t\t\t\t\tconst dateB = new Date(b.date || 0);\n\t\t\t\t\treturn dateB.getTime() - dateA.getTime();\n\t\t\t\t});\n\n\t\t\tif (measurements.length === 0) {\n\t\t\t\treturn this.getDefaultWaterQuality(lat, lon);\n\t\t\t}\n\n\t\t\tconst latest = measurements[0];\n\t\t\tconst hardnessValue = latest.value;\n\n\t\t\t// Classify hardness\n\t\t\tconst classification = this.classifyHardness(hardnessValue);\n\n\t\t\t// Generate recommendations\n\t\t\tconst recommendations = this.generateRecommendations(\n\t\t\t\thardnessValue,\n\t\t\t\tclassification,\n\t\t\t);\n\n\t\t\tconst waterQuality: WaterQuality = {\n\t\t\t\tlocation: {\n\t\t\t\t\tlat,\n\t\t\t\t\tlon,\n\t\t\t\t\tsiteName: latest.site,\n\t\t\t\t\torganization: latest.org,\n\t\t\t\t},\n\t\t\t\thardness: {\n\t\t\t\t\tvalueMgL: hardnessValue,\n\t\t\t\t\tclassification,\n\t\t\t\t\tunit: latest.unit,\n\t\t\t\t\tmeasurementDate: latest.date,\n\t\t\t\t},\n\t\t\t\trecommendations,\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\n\t\t\t// Cache the result\n\t\t\tthis.cache.set(cacheKey, { data: waterQuality, timestamp: Date.now() });\n\n\t\t\treturn WaterQualitySchema.parse(waterQuality);\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Classify water hardness\n\t */\n\tprivate classifyHardness(\n\t\tmgL: number,\n\t): WaterQuality[\"hardness\"][\"classification\"] {\n\t\tif (mgL < 60) {\n\t\t\treturn \"soft\";\n\t\t}\n\t\tif (mgL < 120) {\n\t\t\treturn \"moderate\";\n\t\t}\n\t\tif (mgL < 180) {\n\t\t\treturn \"hard\";\n\t\t}\n\t\treturn \"very_hard\";\n\t}\n\n\t/**\n\t * Generate softener recommendations\n\t */\n\tprivate generateRecommendations(\n\t\thardness: number,\n\t\tclassification: WaterQuality[\"hardness\"][\"classification\"],\n\t): WaterQuality[\"recommendations\"] {\n\t\tconst shouldInstall = hardness >= 120; // Hard or very hard\n\n\t\tlet reason = \"\";\n\t\tlet estimatedSavings: number | undefined;\n\n\t\tif (classification === \"soft\") {\n\t\t\treason = \"Your water is soft and doesn't require a softener.\";\n\t\t} else if (classification === \"moderate\") {\n\t\t\treason =\n\t\t\t\t\"Your water hardness is moderate. A softener is optional but may extend appliance life.\";\n\t\t\testimatedSavings = 20_000; // $200/year\n\t\t} else if (classification === \"hard\") {\n\t\t\treason =\n\t\t\t\t\"Your water is hard. We recommend installing a water softener to protect your pipes and appliances.\";\n\t\t\testimatedSavings = 50_000; // $500/year\n\t\t} else {\n\t\t\treason =\n\t\t\t\t\"Your water is very hard. A water softener is highly recommended to prevent scale buildup and extend equipment life.\";\n\t\t\testimatedSavings = 80_000; // $800/year\n\t\t}\n\n\t\treturn {\n\t\t\tshouldInstallSoftener: shouldInstall,\n\t\t\treason,\n\t\t\testimatedAnnualSavings: estimatedSavings,\n\t\t};\n\t}\n\n\t/**\n\t * Get default water quality when no data available\n\t */\n\tprivate getDefaultWaterQuality(lat: number, lon: number): WaterQuality {\n\t\treturn {\n\t\t\tlocation: { lat, lon },\n\t\t\thardness: {\n\t\t\t\tvalueMgL: 100, // National average\n\t\t\t\tclassification: \"moderate\",\n\t\t\t\tunit: \"mg/L\",\n\t\t\t},\n\t\t\trecommendations: {\n\t\t\t\tshouldInstallSoftener: false,\n\t\t\t\treason:\n\t\t\t\t\t\"No local water hardness data available. National average suggests moderate hardness.\",\n\t\t\t},\n\t\t\tenrichedAt: new Date().toISOString(),\n\t\t};\n\t}\n\n\t/**\n\t * Get date N years ago in YYYY-MM-DD format\n\t */\n\tprivate getDateYearsAgo(years: number): string {\n\t\tconst date = new Date();\n\t\tdate.setFullYear(date.getFullYear() - years);\n\t\treturn date.toISOString().split(\"T\")[0];\n\t}\n\n\t/**\n\t * Clear cache\n\t */\n\tclearCache(): void {\n\t\tthis.cache.clear();\n\t}\n}\n\n// Singleton instance\nexport const waterQualityService = new WaterQualityService();\n","/**\n * Demographics Service\n *\n * Fetches demographic data from US Census Bureau API\n * - Population density\n * - Median household income\n * - Age distribution\n * - Education levels\n *\n * API: FREE, no key required\n * Docs: https://www.census.gov/data/developers/data-sets.html\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\nconst DemographicsSchema = z.object({\n\tpopulation: z.number().optional(),\n\tpopulationDensity: z.number().optional(), // per sq mile\n\tmedianHouseholdIncome: z.number().optional(),\n\tmedianAge: z.number().optional(),\n\teducationBachelorsOrHigher: z.number().optional(), // percentage\n\thousingUnits: z.number().optional(),\n\tmedianHomeValue: z.number().optional(),\n\tpovertyRate: z.number().optional(), // percentage\n\tunemploymentRate: z.number().optional(), // percentage\n\tdataSource: z.string(),\n\tenrichedAt: z.string(),\n});\n\nexport type Demographics = z.infer<typeof DemographicsSchema>;\n\nclass DemographicsService {\n\tprivate readonly cache: Map<\n\t\tstring,\n\t\t{ data: Demographics; timestamp: number }\n\t> = new Map();\n\tprivate readonly cacheTTL = 1000 * 60 * 60 * 24 * 90; // 90 days (census data updates quarterly)\n\n\tasync getDemographics(\n\t\tlat: number,\n\t\tlon: number,\n\t): Promise<Demographics | null> {\n\t\tconst cacheKey = `demographics:${lat.toFixed(4)},${lon.toFixed(4)}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\n\t\tif (cached && Date.now() - cached.timestamp < this.cacheTTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\t// First, get the census tract for this location using FCC API\n\t\t\tconst geoUrl = `https://geo.fcc.gov/api/census/block/find?latitude=${lat}&longitude=${lon}&format=json`;\n\n\t\t\tconst geoRes = await fetch(geoUrl, {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!geoRes.ok) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst geoData = await geoRes.json();\n\t\t\tconst stateFips = geoData.State?.FIPS;\n\t\t\tconst countyFips = geoData.County?.FIPS;\n\t\t\tconst tractCode = geoData.Block?.FIPS?.substring(0, 11); // First 11 digits = tract\n\n\t\t\tif (!(stateFips && countyFips && tractCode)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Get ACS 5-year data (most comprehensive, updated annually)\n\t\t\t// Using ACS because it has more detailed demographic data than decennial census\n\t\t\tconst year = 2022; // Latest available ACS data\n\t\t\tconst variables = [\n\t\t\t\t\"B01003_001E\", // Total population\n\t\t\t\t\"B19013_001E\", // Median household income\n\t\t\t\t\"B01002_001E\", // Median age\n\t\t\t\t\"B15003_022E\", // Bachelor's degree\n\t\t\t\t\"B15003_023E\", // Master's degree\n\t\t\t\t\"B15003_024E\", // Professional degree\n\t\t\t\t\"B15003_025E\", // Doctorate degree\n\t\t\t\t\"B15003_001E\", // Total population for education calc\n\t\t\t\t\"B25077_001E\", // Median home value\n\t\t\t\t\"B17001_002E\", // Poverty count\n\t\t\t\t\"B17001_001E\", // Total for poverty rate\n\t\t\t\t\"B23025_005E\", // Unemployed\n\t\t\t\t\"B23025_003E\", // Total in labor force\n\t\t\t].join(\",\");\n\n\t\t\tconst censusUrl = `https://api.census.gov/data/${year}/acs/acs5?get=${variables}&for=tract:${tractCode.substring(5)}&in=state:${stateFips}%20county:${countyFips}`;\n\n\t\t\tconst censusRes = await fetch(censusUrl, {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!censusRes.ok) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Check if response has content\n\t\t\tconst text = await censusRes.text();\n\t\t\tif (!text || text.trim() === \"\") {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Parse JSON safely\n\t\t\tlet censusData: unknown;\n\t\t\ttry {\n\t\t\t\tcensusData = JSON.parse(text);\n\t\t\t} catch (_e) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (!Array.isArray(censusData) || censusData.length < 2) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Census API returns [headers, data]\n\t\t\tconst values = censusData[1];\n\t\t\tconst population = Number.parseInt(values[0], 10) || 0;\n\t\t\tconst medianIncome = Number.parseInt(values[1], 10) || 0;\n\t\t\tconst medianAge = Number.parseFloat(values[2]) || 0;\n\t\t\tconst bachelors = Number.parseInt(values[3], 10) || 0;\n\t\t\tconst masters = Number.parseInt(values[4], 10) || 0;\n\t\t\tconst professional = Number.parseInt(values[5], 10) || 0;\n\t\t\tconst doctorate = Number.parseInt(values[6], 10) || 0;\n\t\t\tconst totalEducation = Number.parseInt(values[7], 10) || 1;\n\t\t\tconst medianHomeValue = Number.parseInt(values[8], 10) || 0;\n\t\t\tconst povertyCount = Number.parseInt(values[9], 10) || 0;\n\t\t\tconst povertyTotal = Number.parseInt(values[10], 10) || 1;\n\t\t\tconst unemployed = Number.parseInt(values[11], 10) || 0;\n\t\t\tconst laborForce = Number.parseInt(values[12], 10) || 1;\n\n\t\t\tconst educationPercent =\n\t\t\t\t((bachelors + masters + professional + doctorate) / totalEducation) *\n\t\t\t\t100;\n\t\t\tconst povertyRate = (povertyCount / povertyTotal) * 100;\n\t\t\tconst unemploymentRate = (unemployed / laborForce) * 100;\n\n\t\t\tconst demographics: Demographics = {\n\t\t\t\tpopulation,\n\t\t\t\tmedianHouseholdIncome: medianIncome,\n\t\t\t\tmedianAge,\n\t\t\t\teducationBachelorsOrHigher: Math.round(educationPercent * 10) / 10,\n\t\t\t\tmedianHomeValue,\n\t\t\t\tpovertyRate: Math.round(povertyRate * 10) / 10,\n\t\t\t\tunemploymentRate: Math.round(unemploymentRate * 10) / 10,\n\t\t\t\tdataSource: \"census\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\n\t\t\tthis.cache.set(cacheKey, { data: demographics, timestamp: Date.now() });\n\n\t\t\treturn demographics;\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n}\n\nexport const demographicsService = new DemographicsService();\n","/**\n * Address Validation Service\n *\n * Validates and standardizes addresses using USPS API\n * Reduces dispatch errors and failed service calls\n *\n * Features:\n * - Address standardization\n * - Delivery point validation (DPV)\n * - ZIP+4 completion\n * - Error detection\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst AddressValidationSchema = z.object({\n\tisValid: z.boolean(),\n\tinput: z.object({\n\t\taddress1: z.string().optional(),\n\t\taddress2: z.string(),\n\t\tcity: z.string().optional(),\n\t\tstate: z.string().optional(),\n\t\tzip5: z.string().optional(),\n\t\tzip4: z.string().optional(),\n\t}),\n\tstandardized: z\n\t\t.object({\n\t\t\taddress1: z.string().optional(),\n\t\t\taddress2: z.string(),\n\t\t\tcity: z.string(),\n\t\t\tstate: z.string(),\n\t\t\tzip5: z.string(),\n\t\t\tzip4: z.string().optional(),\n\t\t\tdeliveryPoint: z.string().optional(),\n\t\t})\n\t\t.optional(),\n\terror: z.string().optional(),\n\tsuggestions: z.array(z.string()).optional(),\n\tenrichedAt: z.string(),\n});\n\nexport type AddressValidation = z.infer<typeof AddressValidationSchema>;\n\n// ============================================================================\n// Address Validation Service\n// ============================================================================\n\nclass AddressValidationService {\n\tprivate readonly uspsUserId: string | undefined;\n\n\tconstructor() {\n\t\tthis.uspsUserId = process.env.USPS_USER_ID;\n\t}\n\n\t/**\n\t * Validate and standardize an address\n\t *\n\t * Note: USPS Web Tools API is being sunset Jan 2026\n\t * Migrate to USPS \"Addresses 3.0\" API before then\n\t */\n\tasync validateAddress(address: {\n\t\taddress1?: string; // Apt/Suite\n\t\taddress2: string; // Street\n\t\tcity?: string;\n\t\tstate?: string;\n\t\tzip5?: string;\n\t\tzip4?: string;\n\t}): Promise<AddressValidation> {\n\t\tif (!this.uspsUserId) {\n\t\t\treturn {\n\t\t\t\tisValid: false,\n\t\t\t\tinput: address,\n\t\t\t\terror: \"USPS API not configured\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\t\t}\n\n\t\ttry {\n\t\t\t// Build USPS XML request\n\t\t\tconst xml = this.buildUSPSXML(address);\n\n\t\t\t// Call USPS API\n\t\t\tconst url = `https://secure.shippingapis.com/ShippingAPI.dll?API=Verify&XML=${encodeURIComponent(xml)}`;\n\n\t\t\tconst res = await fetch(url, {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!res.ok) {\n\t\t\t\tthrow new Error(`USPS API failed: ${res.status}`);\n\t\t\t}\n\n\t\t\tconst xmlResponse = await res.text();\n\n\t\t\t// Parse XML response\n\t\t\tconst result = this.parseUSPSResponse(xmlResponse, address);\n\n\t\t\treturn AddressValidationSchema.parse(result);\n\t\t} catch (error) {\n\t\t\treturn {\n\t\t\t\tisValid: false,\n\t\t\t\tinput: address,\n\t\t\t\terror:\n\t\t\t\t\terror instanceof Error ? error.message : \"Unknown validation error\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Build USPS XML request\n\t */\n\tprivate buildUSPSXML(address: {\n\t\taddress1?: string;\n\t\taddress2: string;\n\t\tcity?: string;\n\t\tstate?: string;\n\t\tzip5?: string;\n\t\tzip4?: string;\n\t}): string {\n\t\treturn (\n\t\t\t`<AddressValidateRequest USERID=\"${this.uspsUserId}\">` +\n\t\t\t\"<Revision>1</Revision>\" +\n\t\t\t`<Address ID=\"0\">` +\n\t\t\t`<Address1>${this.escapeXML(address.address1 || \"\")}</Address1>` +\n\t\t\t`<Address2>${this.escapeXML(address.address2)}</Address2>` +\n\t\t\t`<City>${this.escapeXML(address.city || \"\")}</City>` +\n\t\t\t`<State>${this.escapeXML(address.state || \"\")}</State>` +\n\t\t\t`<Zip5>${address.zip5 || \"\"}</Zip5>` +\n\t\t\t`<Zip4>${address.zip4 || \"\"}</Zip4>` +\n\t\t\t\"</Address>\" +\n\t\t\t\"</AddressValidateRequest>\"\n\t\t);\n\t}\n\n\t/**\n\t * Parse USPS XML response\n\t */\n\tprivate parseUSPSResponse(\n\t\txml: string,\n\t\tinput: any,\n\t): Omit<AddressValidation, \"enrichedAt\"> {\n\t\t// Check for error\n\t\tif (xml.includes(\"<Error>\")) {\n\t\t\tconst errorMatch = xml.match(/<Description>(.*?)<\\/Description>/);\n\t\t\tconst errorMsg = errorMatch ? errorMatch[1] : \"Unknown USPS error\";\n\n\t\t\treturn {\n\t\t\t\tisValid: false,\n\t\t\t\tinput,\n\t\t\t\terror: errorMsg,\n\t\t\t\tsuggestions: this.extractSuggestions(errorMsg),\n\t\t\t};\n\t\t}\n\n\t\t// Extract standardized address\n\t\ttry {\n\t\t\tconst address1Match = xml.match(/<Address1>(.*?)<\\/Address1>/);\n\t\t\tconst address2Match = xml.match(/<Address2>(.*?)<\\/Address2>/);\n\t\t\tconst cityMatch = xml.match(/<City>(.*?)<\\/City>/);\n\t\t\tconst stateMatch = xml.match(/<State>(.*?)<\\/State>/);\n\t\t\tconst zip5Match = xml.match(/<Zip5>(.*?)<\\/Zip5>/);\n\t\t\tconst zip4Match = xml.match(/<Zip4>(.*?)<\\/Zip4>/);\n\t\t\tconst dpvMatch = xml.match(/<DPVConfirmation>(.*?)<\\/DPVConfirmation>/);\n\n\t\t\tif (!(address2Match && cityMatch && stateMatch && zip5Match)) {\n\t\t\t\treturn {\n\t\t\t\t\tisValid: false,\n\t\t\t\t\tinput,\n\t\t\t\t\terror: \"Incomplete address data from USPS\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tisValid: true,\n\t\t\t\tinput,\n\t\t\t\tstandardized: {\n\t\t\t\t\taddress1: address1Match ? address1Match[1] : undefined,\n\t\t\t\t\taddress2: address2Match[1],\n\t\t\t\t\tcity: cityMatch[1],\n\t\t\t\t\tstate: stateMatch[1],\n\t\t\t\t\tzip5: zip5Match[1],\n\t\t\t\t\tzip4: zip4Match ? zip4Match[1] : undefined,\n\t\t\t\t\tdeliveryPoint: dpvMatch ? dpvMatch[1] : undefined,\n\t\t\t\t},\n\t\t\t};\n\t\t} catch (_error) {\n\t\t\treturn {\n\t\t\t\tisValid: false,\n\t\t\t\tinput,\n\t\t\t\terror: \"Failed to parse USPS response\",\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Extract suggestions from error message\n\t */\n\tprivate extractSuggestions(errorMsg: string): string[] {\n\t\tconst suggestions: string[] = [];\n\n\t\tif (errorMsg.toLowerCase().includes(\"invalid\")) {\n\t\t\tsuggestions.push(\"Check street address spelling\");\n\t\t\tsuggestions.push(\"Verify city and state\");\n\t\t}\n\n\t\tif (errorMsg.toLowerCase().includes(\"zip\")) {\n\t\t\tsuggestions.push(\"Verify ZIP code is correct for this city/state\");\n\t\t}\n\n\t\tif (\n\t\t\terrorMsg.toLowerCase().includes(\"apartment\") ||\n\t\t\terrorMsg.toLowerCase().includes(\"unit\")\n\t\t) {\n\t\t\tsuggestions.push(\"Include apartment or unit number if applicable\");\n\t\t}\n\n\t\treturn suggestions;\n\t}\n\n\t/**\n\t * Escape XML special characters\n\t */\n\tprivate escapeXML(str: string): string {\n\t\treturn str\n\t\t\t.replace(/&/g, \"&amp;\")\n\t\t\t.replace(/</g, \"&lt;\")\n\t\t\t.replace(/>/g, \"&gt;\")\n\t\t\t.replace(/\"/g, \"&quot;\")\n\t\t\t.replace(/'/g, \"&apos;\");\n\t}\n\n\t/**\n\t * Quick check if address appears valid (without API call)\n\t */\n\tisAddressComplete(address: {\n\t\taddress2: string;\n\t\tcity?: string;\n\t\tstate?: string;\n\t\tzip5?: string;\n\t}): boolean {\n\t\treturn !!(\n\t\t\taddress.address2 &&\n\t\t\taddress.city &&\n\t\t\taddress.state &&\n\t\t\taddress.zip5 &&\n\t\t\taddress.zip5.length === 5\n\t\t);\n\t}\n}\n\n// Singleton instance\nexport const addressValidationService = new AddressValidationService();\n","/**\n * Google Routes Service\n *\n * Provides routing, distance matrix, and ETA calculations using Google Routes API\n * - Real-time traffic-aware routing\n * - Multi-destination distance matrix\n * - Polyline encoding for map display\n * - ETA calculations with traffic\n *\n * API: Google Routes API (requires API key with Routes API enabled)\n * Docs: https://developers.google.com/maps/documentation/routes\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst LatLngSchema = z.object({\n\tlat: z.number(),\n\tlng: z.number(),\n});\n\nconst RouteSchema = z.object({\n\tdistance: z.number(), // meters\n\tduration: z.number(), // seconds (without traffic)\n\tdurationInTraffic: z.number(), // seconds (with traffic)\n\tfrom: LatLngSchema,\n\tto: LatLngSchema,\n\tpolyline: z.string().optional(), // Encoded polyline for map display\n\tsummary: z.string().optional(), // Route summary (e.g., \"via I-95 N\")\n\twarnings: z.array(z.string()).optional(),\n\ttrafficDelay: z.number(), // Additional seconds due to traffic\n});\n\nconst RouteMatrixElementSchema = z.object({\n\toriginIndex: z.number(),\n\tdestinationIndex: z.number(),\n\tdistance: z.number(), // meters\n\tduration: z.number(), // seconds\n\tdurationInTraffic: z.number(), // seconds with traffic\n\tstatus: z.enum([\"OK\", \"NOT_FOUND\", \"ZERO_RESULTS\"]),\n});\n\nconst RouteMatrixSchema = z.object({\n\telements: z.array(RouteMatrixElementSchema),\n\toriginAddresses: z.array(z.string()).optional(),\n\tdestinationAddresses: z.array(z.string()).optional(),\n});\n\nconst OptimizedRouteSchema = z.object({\n\ttotalDistance: z.number(), // meters\n\ttotalDuration: z.number(), // seconds\n\ttotalDurationInTraffic: z.number(), // seconds with traffic\n\toptimizedOrder: z.array(z.number()), // Original indices in optimized order\n\tlegs: z.array(\n\t\tz.object({\n\t\t\tfrom: LatLngSchema,\n\t\t\tto: LatLngSchema,\n\t\t\tdistance: z.number(),\n\t\t\tduration: z.number(),\n\t\t\tdurationInTraffic: z.number(),\n\t\t\tpolyline: z.string().optional(),\n\t\t}),\n\t),\n\tpolyline: z.string().optional(), // Full route polyline\n});\n\nexport type LatLng = z.infer<typeof LatLngSchema>;\nexport type Route = z.infer<typeof RouteSchema>;\nexport type RouteMatrixElement = z.infer<typeof RouteMatrixElementSchema>;\nexport type RouteMatrix = z.infer<typeof RouteMatrixSchema>;\nexport type OptimizedRoute = z.infer<typeof OptimizedRouteSchema>;\n\n// ============================================================================\n// Cache Configuration\n// ============================================================================\n\nconst CACHE_TTL = 5 * 60 * 1000; // 5 minutes for route calculations\nconst MATRIX_CACHE_TTL = 10 * 60 * 1000; // 10 minutes for matrix calculations\n\n// ============================================================================\n// Google Routes Service\n// ============================================================================\n\nclass GoogleRoutesService {\n\tprivate readonly apiKey: string | undefined;\n\tprivate readonly routeCache: Map<string, { data: Route; timestamp: number }> =\n\t\tnew Map();\n\tprivate readonly matrixCache: Map<\n\t\tstring,\n\t\t{ data: RouteMatrix; timestamp: number }\n\t> = new Map();\n\n\tconstructor() {\n\t\t// Use unified GOOGLE_API_KEY for all Google services\n\t\tthis.apiKey =\n\t\t\tprocess.env.GOOGLE_API_KEY ||\n\t\t\tprocess.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY ||\n\t\t\tprocess.env.GOOGLE_MAPS_API_KEY;\n\t}\n\n\t/**\n\t * Check if service is available\n\t */\n\tisAvailable(): boolean {\n\t\treturn !!this.apiKey;\n\t}\n\n\t/**\n\t * Calculate route between two points with real-time traffic\n\t */\n\tasync getRoute(from: LatLng, to: LatLng): Promise<Route | null> {\n\t\tif (!this.apiKey) {\n\t\t\tconsole.warn(\"Google Routes Service: No API key configured\");\n\t\t\treturn this.getFallbackRoute(from, to);\n\t\t}\n\n\t\tconst cacheKey = `route:${from.lat.toFixed(5)},${from.lng.toFixed(5)}-${to.lat.toFixed(5)},${to.lng.toFixed(5)}`;\n\t\tconst cached = this.routeCache.get(cacheKey);\n\t\tif (cached && Date.now() - cached.timestamp < CACHE_TTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\t// Use Google Directions API with traffic\n\t\t\tconst url = new URL(\n\t\t\t\t\"https://maps.googleapis.com/maps/api/directions/json\",\n\t\t\t);\n\t\t\turl.searchParams.set(\"origin\", `${from.lat},${from.lng}`);\n\t\t\turl.searchParams.set(\"destination\", `${to.lat},${to.lng}`);\n\t\t\turl.searchParams.set(\"departure_time\", \"now\");\n\t\t\turl.searchParams.set(\"traffic_model\", \"best_guess\");\n\t\t\turl.searchParams.set(\"key\", this.apiKey);\n\n\t\t\tconst response = await fetch(url.toString(), {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t`Google Routes API error: ${response.status} ${response.statusText}`,\n\t\t\t\t);\n\t\t\t\treturn this.getFallbackRoute(from, to);\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\n\t\t\tif (data.status !== \"OK\" || !data.routes?.[0]) {\n\t\t\t\tconsole.warn(`Google Routes API returned status: ${data.status}`);\n\t\t\t\treturn this.getFallbackRoute(from, to);\n\t\t\t}\n\n\t\t\tconst googleRoute = data.routes[0];\n\t\t\tconst leg = googleRoute.legs[0];\n\n\t\t\tconst duration = leg.duration?.value || 0;\n\t\t\tconst durationInTraffic = leg.duration_in_traffic?.value || duration;\n\n\t\t\tconst route: Route = {\n\t\t\t\tdistance: leg.distance?.value || 0,\n\t\t\t\tduration,\n\t\t\t\tdurationInTraffic,\n\t\t\t\tfrom,\n\t\t\t\tto,\n\t\t\t\tpolyline: googleRoute.overview_polyline?.points,\n\t\t\t\tsummary: googleRoute.summary,\n\t\t\t\twarnings: googleRoute.warnings || [],\n\t\t\t\ttrafficDelay: Math.max(0, durationInTraffic - duration),\n\t\t\t};\n\n\t\t\tconst validated = RouteSchema.parse(route);\n\t\t\tthis.routeCache.set(cacheKey, { data: validated, timestamp: Date.now() });\n\n\t\t\t// Clean up old cache entries\n\t\t\tthis.cleanCache(this.routeCache, CACHE_TTL);\n\n\t\t\treturn validated;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Google Routes Service error:\", error);\n\t\t\treturn this.getFallbackRoute(from, to);\n\t\t}\n\t}\n\n\t/**\n\t * Calculate routes from multiple origins to multiple destinations (matrix)\n\t * More efficient than individual route requests when dealing with many points\n\t */\n\tasync getRouteMatrix(\n\t\torigins: LatLng[],\n\t\tdestinations: LatLng[],\n\t): Promise<RouteMatrix | null> {\n\t\tif (!this.apiKey) {\n\t\t\tconsole.warn(\"Google Routes Service: No API key configured for matrix\");\n\t\t\treturn null;\n\t\t}\n\n\t\tif (origins.length === 0 || destinations.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Limit to avoid API limits (max 25 origins or 25 destinations)\n\t\tconst limitedOrigins = origins.slice(0, 25);\n\t\tconst limitedDestinations = destinations.slice(0, 25);\n\n\t\tconst cacheKey = `matrix:${limitedOrigins.map((o) => `${o.lat.toFixed(4)},${o.lng.toFixed(4)}`).join(\"|\")}-${limitedDestinations.map((d) => `${d.lat.toFixed(4)},${d.lng.toFixed(4)}`).join(\"|\")}`;\n\n\t\tconst cached = this.matrixCache.get(cacheKey);\n\t\tif (cached && Date.now() - cached.timestamp < MATRIX_CACHE_TTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\tconst url = new URL(\n\t\t\t\t\"https://maps.googleapis.com/maps/api/distancematrix/json\",\n\t\t\t);\n\t\t\turl.searchParams.set(\n\t\t\t\t\"origins\",\n\t\t\t\tlimitedOrigins.map((o) => `${o.lat},${o.lng}`).join(\"|\"),\n\t\t\t);\n\t\t\turl.searchParams.set(\n\t\t\t\t\"destinations\",\n\t\t\t\tlimitedDestinations.map((d) => `${d.lat},${d.lng}`).join(\"|\"),\n\t\t\t);\n\t\t\turl.searchParams.set(\"departure_time\", \"now\");\n\t\t\turl.searchParams.set(\"traffic_model\", \"best_guess\");\n\t\t\turl.searchParams.set(\"key\", this.apiKey);\n\n\t\t\tconst response = await fetch(url.toString(), {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t`Google Distance Matrix API error: ${response.status} ${response.statusText}`,\n\t\t\t\t);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\n\t\t\tif (data.status !== \"OK\") {\n\t\t\t\tconsole.warn(`Google Distance Matrix API status: ${data.status}`);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst elements: RouteMatrixElement[] = [];\n\n\t\t\tfor (let i = 0; i < data.rows.length; i++) {\n\t\t\t\tfor (let j = 0; j < data.rows[i].elements.length; j++) {\n\t\t\t\t\tconst element = data.rows[i].elements[j];\n\t\t\t\t\tconst duration = element.duration?.value || 0;\n\t\t\t\t\tconst durationInTraffic =\n\t\t\t\t\t\telement.duration_in_traffic?.value || duration;\n\n\t\t\t\t\telements.push({\n\t\t\t\t\t\toriginIndex: i,\n\t\t\t\t\t\tdestinationIndex: j,\n\t\t\t\t\t\tdistance: element.distance?.value || 0,\n\t\t\t\t\t\tduration,\n\t\t\t\t\t\tdurationInTraffic,\n\t\t\t\t\t\tstatus:\n\t\t\t\t\t\t\telement.status === \"OK\"\n\t\t\t\t\t\t\t\t? \"OK\"\n\t\t\t\t\t\t\t\t: element.status === \"ZERO_RESULTS\"\n\t\t\t\t\t\t\t\t\t? \"ZERO_RESULTS\"\n\t\t\t\t\t\t\t\t\t: \"NOT_FOUND\",\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst matrix: RouteMatrix = {\n\t\t\t\telements,\n\t\t\t\toriginAddresses: data.origin_addresses,\n\t\t\t\tdestinationAddresses: data.destination_addresses,\n\t\t\t};\n\n\t\t\tconst validated = RouteMatrixSchema.parse(matrix);\n\t\t\tthis.matrixCache.set(cacheKey, {\n\t\t\t\tdata: validated,\n\t\t\t\ttimestamp: Date.now(),\n\t\t\t});\n\n\t\t\t// Clean up old cache entries\n\t\t\tthis.cleanCache(this.matrixCache, MATRIX_CACHE_TTL);\n\n\t\t\treturn validated;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Google Distance Matrix error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get ETA from one location to another with traffic\n\t */\n\tasync getETA(\n\t\tfrom: LatLng,\n\t\tto: LatLng,\n\t): Promise<{\n\t\teta: Date;\n\t\tdurationMinutes: number;\n\t\tdurationText: string;\n\t\ttrafficDelayMinutes: number;\n\t} | null> {\n\t\tconst route = await this.getRoute(from, to);\n\t\tif (!route) return null;\n\n\t\tconst now = new Date();\n\t\tconst eta = new Date(now.getTime() + route.durationInTraffic * 1000);\n\t\tconst durationMinutes = Math.ceil(route.durationInTraffic / 60);\n\t\tconst trafficDelayMinutes = Math.ceil(route.trafficDelay / 60);\n\n\t\treturn {\n\t\t\teta,\n\t\t\tdurationMinutes,\n\t\t\tdurationText: this.formatDuration(route.durationInTraffic),\n\t\t\ttrafficDelayMinutes,\n\t\t};\n\t}\n\n\t/**\n\t * Get optimal technician assignment based on current location and traffic\n\t * Returns technicians sorted by ETA to the job location\n\t */\n\tasync rankTechniciansByETA(\n\t\ttechnicianLocations: Array<{ id: string; location: LatLng; name?: string }>,\n\t\tjobLocation: LatLng,\n\t): Promise<\n\t\tArray<{\n\t\t\tid: string;\n\t\t\tname?: string;\n\t\t\tetaMinutes: number;\n\t\t\tdistanceKm: number;\n\t\t\ttrafficDelayMinutes: number;\n\t\t}>\n\t> {\n\t\tif (technicianLocations.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\t// Use matrix API for efficiency\n\t\tconst origins = technicianLocations.map((t) => t.location);\n\t\tconst destinations = [jobLocation];\n\n\t\tconst matrix = await this.getRouteMatrix(origins, destinations);\n\n\t\tif (!matrix) {\n\t\t\t// Fallback: use individual routes\n\t\t\tconst results = await Promise.all(\n\t\t\t\ttechnicianLocations.map(async (tech) => {\n\t\t\t\t\tconst route = await this.getRoute(tech.location, jobLocation);\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: tech.id,\n\t\t\t\t\t\tname: tech.name,\n\t\t\t\t\t\tetaMinutes: route\n\t\t\t\t\t\t\t? Math.ceil(route.durationInTraffic / 60)\n\t\t\t\t\t\t\t: Number.POSITIVE_INFINITY,\n\t\t\t\t\t\tdistanceKm: route ? route.distance / 1000 : 0,\n\t\t\t\t\t\ttrafficDelayMinutes: route ? Math.ceil(route.trafficDelay / 60) : 0,\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\treturn results.sort((a, b) => a.etaMinutes - b.etaMinutes);\n\t\t}\n\n\t\t// Process matrix results\n\t\tconst results = technicianLocations.map((tech, index) => {\n\t\t\tconst element = matrix.elements.find(\n\t\t\t\t(e) => e.originIndex === index && e.destinationIndex === 0,\n\t\t\t);\n\n\t\t\tif (!element || element.status !== \"OK\") {\n\t\t\t\treturn {\n\t\t\t\t\tid: tech.id,\n\t\t\t\t\tname: tech.name,\n\t\t\t\t\tetaMinutes: Number.POSITIVE_INFINITY,\n\t\t\t\t\tdistanceKm: 0,\n\t\t\t\t\ttrafficDelayMinutes: 0,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tid: tech.id,\n\t\t\t\tname: tech.name,\n\t\t\t\tetaMinutes: Math.ceil(element.durationInTraffic / 60),\n\t\t\t\tdistanceKm: element.distance / 1000,\n\t\t\t\ttrafficDelayMinutes: Math.ceil(\n\t\t\t\t\t(element.durationInTraffic - element.duration) / 60,\n\t\t\t\t),\n\t\t\t};\n\t\t});\n\n\t\treturn results.sort((a, b) => a.etaMinutes - b.etaMinutes);\n\t}\n\n\t/**\n\t * Calculate optimal route visiting multiple stops (simple greedy nearest neighbor)\n\t * For more complex optimization, use RouteOptimizationService\n\t */\n\tasync getMultiStopRoute(\n\t\torigin: LatLng,\n\t\tstops: LatLng[],\n\t\treturnToOrigin = false,\n\t): Promise<OptimizedRoute | null> {\n\t\tif (stops.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (stops.length === 1) {\n\t\t\tconst route = await this.getRoute(origin, stops[0]);\n\t\t\tif (!route) return null;\n\n\t\t\treturn {\n\t\t\t\ttotalDistance: route.distance,\n\t\t\t\ttotalDuration: route.duration,\n\t\t\t\ttotalDurationInTraffic: route.durationInTraffic,\n\t\t\t\toptimizedOrder: [0],\n\t\t\t\tlegs: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfrom: origin,\n\t\t\t\t\t\tto: stops[0],\n\t\t\t\t\t\tdistance: route.distance,\n\t\t\t\t\t\tduration: route.duration,\n\t\t\t\t\t\tdurationInTraffic: route.durationInTraffic,\n\t\t\t\t\t\tpolyline: route.polyline,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tpolyline: route.polyline,\n\t\t\t};\n\t\t}\n\n\t\t// Get distance matrix from origin to all stops\n\t\tconst allPoints = [origin, ...stops];\n\t\tconst matrix = await this.getRouteMatrix(allPoints, allPoints);\n\n\t\tif (!matrix) {\n\t\t\t// Fallback: sequential route\n\t\t\treturn this.getSequentialRoute(origin, stops, returnToOrigin);\n\t\t}\n\n\t\t// Greedy nearest neighbor algorithm\n\t\tconst visited = new Set<number>();\n\t\tconst order: number[] = [];\n\t\tlet currentIndex = 0; // Start at origin\n\n\t\twhile (order.length < stops.length) {\n\t\t\tlet nearestIndex = -1;\n\t\t\tlet nearestDuration = Number.POSITIVE_INFINITY;\n\n\t\t\tfor (let i = 1; i <= stops.length; i++) {\n\t\t\t\tif (visited.has(i)) continue;\n\n\t\t\t\tconst element = matrix.elements.find(\n\t\t\t\t\t(e) => e.originIndex === currentIndex && e.destinationIndex === i,\n\t\t\t\t);\n\n\t\t\t\tif (element && element.status === \"OK\") {\n\t\t\t\t\tif (element.durationInTraffic < nearestDuration) {\n\t\t\t\t\t\tnearestDuration = element.durationInTraffic;\n\t\t\t\t\t\tnearestIndex = i;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (nearestIndex === -1) break;\n\n\t\t\tvisited.add(nearestIndex);\n\t\t\torder.push(nearestIndex - 1); // Convert back to stops index (0-based)\n\t\t\tcurrentIndex = nearestIndex;\n\t\t}\n\n\t\t// Build the optimized route\n\t\tconst legs: OptimizedRoute[\"legs\"] = [];\n\t\tlet totalDistance = 0;\n\t\tlet totalDuration = 0;\n\t\tlet totalDurationInTraffic = 0;\n\t\tlet currentPoint = origin;\n\n\t\tfor (const stopIndex of order) {\n\t\t\tconst targetPoint = stops[stopIndex];\n\t\t\tconst route = await this.getRoute(currentPoint, targetPoint);\n\n\t\t\tif (route) {\n\t\t\t\tlegs.push({\n\t\t\t\t\tfrom: currentPoint,\n\t\t\t\t\tto: targetPoint,\n\t\t\t\t\tdistance: route.distance,\n\t\t\t\t\tduration: route.duration,\n\t\t\t\t\tdurationInTraffic: route.durationInTraffic,\n\t\t\t\t\tpolyline: route.polyline,\n\t\t\t\t});\n\t\t\t\ttotalDistance += route.distance;\n\t\t\t\ttotalDuration += route.duration;\n\t\t\t\ttotalDurationInTraffic += route.durationInTraffic;\n\t\t\t}\n\n\t\t\tcurrentPoint = targetPoint;\n\t\t}\n\n\t\t// Optionally add return leg\n\t\tif (returnToOrigin && legs.length > 0) {\n\t\t\tconst returnRoute = await this.getRoute(currentPoint, origin);\n\t\t\tif (returnRoute) {\n\t\t\t\tlegs.push({\n\t\t\t\t\tfrom: currentPoint,\n\t\t\t\t\tto: origin,\n\t\t\t\t\tdistance: returnRoute.distance,\n\t\t\t\t\tduration: returnRoute.duration,\n\t\t\t\t\tdurationInTraffic: returnRoute.durationInTraffic,\n\t\t\t\t\tpolyline: returnRoute.polyline,\n\t\t\t\t});\n\t\t\t\ttotalDistance += returnRoute.distance;\n\t\t\t\ttotalDuration += returnRoute.duration;\n\t\t\t\ttotalDurationInTraffic += returnRoute.durationInTraffic;\n\t\t\t}\n\t\t}\n\n\t\treturn OptimizedRouteSchema.parse({\n\t\t\ttotalDistance,\n\t\t\ttotalDuration,\n\t\t\ttotalDurationInTraffic,\n\t\t\toptimizedOrder: order,\n\t\t\tlegs,\n\t\t});\n\t}\n\n\t/**\n\t * Sequential route (fallback when matrix unavailable)\n\t */\n\tprivate async getSequentialRoute(\n\t\torigin: LatLng,\n\t\tstops: LatLng[],\n\t\treturnToOrigin: boolean,\n\t): Promise<OptimizedRoute | null> {\n\t\tconst legs: OptimizedRoute[\"legs\"] = [];\n\t\tlet totalDistance = 0;\n\t\tlet totalDuration = 0;\n\t\tlet totalDurationInTraffic = 0;\n\t\tlet currentPoint = origin;\n\n\t\tfor (let i = 0; i < stops.length; i++) {\n\t\t\tconst route = await this.getRoute(currentPoint, stops[i]);\n\t\t\tif (route) {\n\t\t\t\tlegs.push({\n\t\t\t\t\tfrom: currentPoint,\n\t\t\t\t\tto: stops[i],\n\t\t\t\t\tdistance: route.distance,\n\t\t\t\t\tduration: route.duration,\n\t\t\t\t\tdurationInTraffic: route.durationInTraffic,\n\t\t\t\t\tpolyline: route.polyline,\n\t\t\t\t});\n\t\t\t\ttotalDistance += route.distance;\n\t\t\t\ttotalDuration += route.duration;\n\t\t\t\ttotalDurationInTraffic += route.durationInTraffic;\n\t\t\t}\n\t\t\tcurrentPoint = stops[i];\n\t\t}\n\n\t\tif (returnToOrigin) {\n\t\t\tconst returnRoute = await this.getRoute(currentPoint, origin);\n\t\t\tif (returnRoute) {\n\t\t\t\tlegs.push({\n\t\t\t\t\tfrom: currentPoint,\n\t\t\t\t\tto: origin,\n\t\t\t\t\tdistance: returnRoute.distance,\n\t\t\t\t\tduration: returnRoute.duration,\n\t\t\t\t\tdurationInTraffic: returnRoute.durationInTraffic,\n\t\t\t\t\tpolyline: returnRoute.polyline,\n\t\t\t\t});\n\t\t\t\ttotalDistance += returnRoute.distance;\n\t\t\t\ttotalDuration += returnRoute.duration;\n\t\t\t\ttotalDurationInTraffic += returnRoute.durationInTraffic;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\ttotalDistance,\n\t\t\ttotalDuration,\n\t\t\ttotalDurationInTraffic,\n\t\t\toptimizedOrder: stops.map((_, i) => i),\n\t\t\tlegs,\n\t\t};\n\t}\n\n\t/**\n\t * Fallback route using Haversine distance (when API unavailable)\n\t */\n\tprivate getFallbackRoute(from: LatLng, to: LatLng): Route {\n\t\tconst distance = this.calculateHaversineDistance(from, to);\n\t\t// Estimate duration: 40 km/h average city speed\n\t\tconst duration = Math.round((distance / 40000) * 3600);\n\n\t\treturn {\n\t\t\tdistance: Math.round(distance),\n\t\t\tduration,\n\t\t\tdurationInTraffic: duration, // No traffic data available\n\t\t\tfrom,\n\t\t\tto,\n\t\t\ttrafficDelay: 0,\n\t\t\twarnings: [\"Using estimated route - Google API unavailable\"],\n\t\t};\n\t}\n\n\t/**\n\t * Calculate Haversine distance between two points (meters)\n\t */\n\tprivate calculateHaversineDistance(from: LatLng, to: LatLng): number {\n\t\tconst R = 6371e3; // Earth radius in meters\n\t\tconst 1 = (from.lat * Math.PI) / 180;\n\t\tconst 2 = (to.lat * Math.PI) / 180;\n\t\tconst  = ((to.lat - from.lat) * Math.PI) / 180;\n\t\tconst  = ((to.lng - from.lng) * Math.PI) / 180;\n\n\t\tconst a =\n\t\t\tMath.sin( / 2) * Math.sin( / 2) +\n\t\t\tMath.cos(1) * Math.cos(2) * Math.sin( / 2) * Math.sin( / 2);\n\t\tconst c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n\t\treturn R * c;\n\t}\n\n\t/**\n\t * Format duration in human-readable form\n\t */\n\tformatDuration(seconds: number): string {\n\t\tif (seconds < 60) {\n\t\t\treturn `${Math.round(seconds)} sec`;\n\t\t}\n\t\tif (seconds < 3600) {\n\t\t\treturn `${Math.round(seconds / 60)} min`;\n\t\t}\n\t\tconst hours = Math.floor(seconds / 3600);\n\t\tconst mins = Math.round((seconds % 3600) / 60);\n\t\treturn `${hours}h ${mins}min`;\n\t}\n\n\t/**\n\t * Format distance in human-readable form\n\t */\n\tformatDistance(meters: number): string {\n\t\tif (meters < 1000) {\n\t\t\treturn `${Math.round(meters)} m`;\n\t\t}\n\t\tconst km = meters / 1000;\n\t\tconst miles = km * 0.621371;\n\t\treturn `${miles.toFixed(1)} mi`;\n\t}\n\n\t/**\n\t * Clean up old cache entries\n\t */\n\tprivate cleanCache(\n\t\tcache: Map<string, { data: unknown; timestamp: number }>,\n\t\tttl: number,\n\t): void {\n\t\tconst now = Date.now();\n\t\tfor (const [key, value] of cache.entries()) {\n\t\t\tif (now - value.timestamp > ttl * 2) {\n\t\t\t\tcache.delete(key);\n\t\t\t}\n\t\t}\n\n\t\t// Keep cache size reasonable\n\t\tif (cache.size > 500) {\n\t\t\tconst entries = Array.from(cache.entries());\n\t\t\tentries.sort((a, b) => b[1].timestamp - a[1].timestamp);\n\t\t\tcache.clear();\n\t\t\tfor (const [key, value] of entries.slice(0, 250)) {\n\t\t\t\tcache.set(key, value);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Clear all caches\n\t */\n\tclearCache(): void {\n\t\tthis.routeCache.clear();\n\t\tthis.matrixCache.clear();\n\t}\n}\n\n// Singleton instance\nexport const googleRoutesService = new GoogleRoutesService();\n","/**\n * Google Street View Service\n *\n * Generates Street View images of properties\n * - Static street view images\n * - Property visual confirmation\n * - Multiple viewing angles\n *\n * API: Google Street View Static API\n * Free Tier: 25,000 requests/month\n * Docs: https://developers.google.com/maps/documentation/streetview\n */\n\nimport { z } from \"zod\";\n\nconst StreetViewSchema = z.object({\n\tmainView: z.string(), // URL to street view image\n\talternateViews: z.array(z.string()).optional(), // URLs from different angles\n\theading: z.number().optional(), // Camera heading (0-360)\n\tpitch: z.number().optional(), // Camera pitch (-90 to 90)\n\tfov: z.number().optional(), // Field of view (0-120)\n\tavailable: z.boolean(), // Whether street view is available for this location\n\tdataSource: z.string(),\n\tenrichedAt: z.string(),\n});\n\nexport type StreetView = z.infer<typeof StreetViewSchema>;\n\nconst CACHE_TTL_MS = 1000 * 60 * 60 * 24 * 90; // 90 days\n\n// biome-ignore lint/suspicious/noConsole: Backend service logging is acceptable\nclass GoogleStreetViewService {\n\tprivate readonly apiKey: string | undefined;\n\tprivate readonly cache: Map<string, { data: StreetView; timestamp: number }> =\n\t\tnew Map();\n\tprivate readonly cacheTTL = CACHE_TTL_MS;\n\n\tconstructor() {\n\t\tthis.apiKey = process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY;\n\t}\n\n\tasync getStreetView(\n\t\tlat: number,\n\t\tlon: number,\n\t\taddress?: string,\n\t): Promise<StreetView | null> {\n\t\tif (!this.apiKey) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst cacheKey = `streetview:${lat.toFixed(6)},${lon.toFixed(6)}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\n\t\tif (cached && Date.now() - cached.timestamp < this.cacheTTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\t// First, check if Street View is available for this location\n\t\t\tconst metadataUrl = `https://maps.googleapis.com/maps/api/streetview/metadata?location=${lat},${lon}&key=${this.apiKey}`;\n\n\t\t\tconst metadataRes = await fetch(metadataUrl);\n\n\t\t\tif (!metadataRes.ok) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst metadata = await metadataRes.json();\n\n\t\t\tif (metadata.status !== \"OK\") {\n\t\t\t\treturn {\n\t\t\t\t\tmainView: \"\",\n\t\t\t\t\tavailable: false,\n\t\t\t\t\tdataSource: \"google-streetview\",\n\t\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Generate Street View image URLs\n\t\t\tconst size = \"600x400\"; // Width x Height\n\t\t\tconst defaultHeading = 0; // North\n\t\t\tconst defaultPitch = 0; // Straight ahead\n\t\t\tconst defaultFov = 90; // Field of view\n\n\t\t\t// Use address if provided, otherwise use coordinates\n\t\t\tconst locationParam = address\n\t\t\t\t? `location=${encodeURIComponent(address)}`\n\t\t\t\t: `location=${lat},${lon}`;\n\n\t\t\t// Main view (street facing)\n\t\t\tconst mainView = `https://maps.googleapis.com/maps/api/streetview?size=${size}&${locationParam}&heading=${defaultHeading}&pitch=${defaultPitch}&fov=${defaultFov}&key=${this.apiKey}`;\n\n\t\t\t// Alternate views (different angles)\n\t\t\tconst alternateViews = [\n\t\t\t\t`https://maps.googleapis.com/maps/api/streetview?size=${size}&${locationParam}&heading=90&pitch=${defaultPitch}&fov=${defaultFov}&key=${this.apiKey}`, // Right side\n\t\t\t\t`https://maps.googleapis.com/maps/api/streetview?size=${size}&${locationParam}&heading=180&pitch=${defaultPitch}&fov=${defaultFov}&key=${this.apiKey}`, // Rear\n\t\t\t\t`https://maps.googleapis.com/maps/api/streetview?size=${size}&${locationParam}&heading=270&pitch=${defaultPitch}&fov=${defaultFov}&key=${this.apiKey}`, // Left side\n\t\t\t];\n\n\t\t\tconst streetView: StreetView = {\n\t\t\t\tmainView,\n\t\t\t\talternateViews,\n\t\t\t\theading: defaultHeading,\n\t\t\t\tpitch: defaultPitch,\n\t\t\t\tfov: defaultFov,\n\t\t\t\tavailable: true,\n\t\t\t\tdataSource: \"google-streetview\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\n\t\t\tthis.cache.set(cacheKey, { data: streetView, timestamp: Date.now() });\n\n\t\t\treturn streetView;\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get direct Street View image URL (for embedding)\n\t */\n\tgetImageUrl(\n\t\tlat: number,\n\t\tlon: number,\n\t\theading = 0,\n\t\tsize = \"600x400\",\n\t): string | null {\n\t\tif (!this.apiKey) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn `https://maps.googleapis.com/maps/api/streetview?size=${size}&location=${lat},${lon}&heading=${heading}&key=${this.apiKey}`;\n\t}\n\n\t/**\n\t * Get Street View panorama URL (for interactive viewing)\n\t */\n\tgetPanoramaUrl(lat: number, lon: number): string {\n\t\treturn `https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${lat},${lon}`;\n\t}\n}\n\nexport const googleStreetViewService = new GoogleStreetViewService();\n","/**\n * Routing Service\n *\n * Provides travel time calculations and nearby supplier lookups\n * - OpenRouteService for drive times and distances\n * - Overpass API (OSM) for nearby hardware/plumbing suppliers\n *\n * Use cases:\n * - Tech-to-job ETA calculation\n * - Batch job routing optimization\n * - Emergency parts run planning\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\n// Overpass API instances (fallback if one is rate-limited)\nconst OVERPASS_INSTANCES = [\n\t\"https://overpass-api.de/api/interpreter\",\n\t\"https://overpass.kumi.systems/api/interpreter\",\n\t\"https://overpass.openstreetmap.ru/api/interpreter\",\n] as const;\n\n// Rate limiting configuration for Overpass API\nconst OVERPASS_RATE_LIMIT = {\n\tmaxRequests: 2, // Conservative limit per window\n\twindowMs: 60 * 1000, // 1 minute window\n};\n\n// Cache configuration\nconst CACHE_TTL = 60 * 60 * 1000; // 1 hour cache for supplier data\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst RouteSchema = z.object({\n\tdistance: z.number(), // meters\n\tduration: z.number(), // seconds\n\tfrom: z.object({\n\t\tlat: z.number(),\n\t\tlon: z.number(),\n\t}),\n\tto: z.object({\n\t\tlat: z.number(),\n\t\tlon: z.number(),\n\t}),\n});\n\nconst NearbySupplierSchema = z.object({\n\tid: z.number(),\n\tname: z.string().optional(),\n\tlat: z.number(),\n\tlon: z.number(),\n\ttype: z.string(),\n\tdistance: z.number().optional(), // meters from reference point\n});\n\nexport type Route = z.infer<typeof RouteSchema>;\nexport type NearbySupplier = z.infer<typeof NearbySupplierSchema>;\n\n// ============================================================================\n// Routing Service\n// ============================================================================\n\nclass RoutingService {\n\tprivate readonly orsApiKey: string | undefined;\n\tprivate overpassCache: Map<\n\t\tstring,\n\t\t{ data: NearbySupplier[]; timestamp: number }\n\t>;\n\tprivate overpassRequestTimestamps: number[] = [];\n\tprivate currentOverpassInstanceIndex = 0;\n\n\tconstructor() {\n\t\tthis.orsApiKey = process.env.ORS_API_KEY;\n\t\tthis.overpassCache = new Map();\n\t}\n\n\t/**\n\t * Calculate route between two points\n\t */\n\tasync getRoute(\n\t\tfrom: { lat: number; lon: number },\n\t\tto: { lat: number; lon: number },\n\t): Promise<Route | null> {\n\t\tif (!this.orsApiKey) {\n\t\t\treturn this.getStraightLineRoute(from, to);\n\t\t}\n\n\t\ttry {\n\t\t\tconst res = await fetch(\n\t\t\t\t\"https://api.openrouteservice.org/v2/directions/driving-car\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\theaders: {\n\t\t\t\t\t\tAuthorization: this.orsApiKey,\n\t\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\t\"User-Agent\": USER_AGENT,\n\t\t\t\t\t},\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tcoordinates: [\n\t\t\t\t\t\t\t[from.lon, from.lat],\n\t\t\t\t\t\t\t[to.lon, to.lat],\n\t\t\t\t\t\t],\n\t\t\t\t\t\tpreference: \"fastest\",\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tif (!res.ok) {\n\t\t\t\treturn this.getStraightLineRoute(from, to);\n\t\t\t}\n\n\t\t\tconst data = await res.json();\n\t\t\tconst route = data.routes?.[0];\n\n\t\t\tif (!route) {\n\t\t\t\treturn this.getStraightLineRoute(from, to);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tdistance: route.summary.distance,\n\t\t\t\tduration: route.summary.duration,\n\t\t\t\tfrom,\n\t\t\t\tto,\n\t\t\t};\n\t\t} catch (_error) {\n\t\t\treturn this.getStraightLineRoute(from, to);\n\t\t}\n\t}\n\n\t/**\n\t * Calculate routes from one point to multiple destinations (matrix)\n\t */\n\tasync getRouteMatrix(\n\t\torigins: Array<{ lat: number; lon: number }>,\n\t\tdestinations: Array<{ lat: number; lon: number }>,\n\t): Promise<{\n\t\tdurations: number[][]; // seconds\n\t\tdistances: number[][]; // meters\n\t} | null> {\n\t\tif (!this.orsApiKey) {\n\t\t\treturn null;\n\t\t}\n\n\t\ttry {\n\t\t\t// Convert to ORS format [lon, lat]\n\t\t\tconst locations = [\n\t\t\t\t...origins.map((p) => [p.lon, p.lat]),\n\t\t\t\t...destinations.map((p) => [p.lon, p.lat]),\n\t\t\t];\n\n\t\t\tconst sources = origins.map((_, i) => i);\n\t\t\tconst dests = destinations.map((_, i) => origins.length + i);\n\n\t\t\tconst res = await fetch(\n\t\t\t\t\"https://api.openrouteservice.org/v2/matrix/driving-car\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\theaders: {\n\t\t\t\t\t\tAuthorization: this.orsApiKey,\n\t\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\t\"User-Agent\": USER_AGENT,\n\t\t\t\t\t},\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tlocations,\n\t\t\t\t\t\tsources,\n\t\t\t\t\t\tdestinations: dests,\n\t\t\t\t\t\tmetrics: [\"duration\", \"distance\"],\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tif (!res.ok) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await res.json();\n\n\t\t\treturn {\n\t\t\t\tdurations: data.durations || [],\n\t\t\t\tdistances: data.distances || [],\n\t\t\t};\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Check if we can make an Overpass API request (rate limiting)\n\t */\n\tprivate canMakeOverpassRequest(): boolean {\n\t\tconst now = Date.now();\n\t\t// Remove timestamps outside the window\n\t\tthis.overpassRequestTimestamps = this.overpassRequestTimestamps.filter(\n\t\t\t(timestamp) => timestamp > now - OVERPASS_RATE_LIMIT.windowMs,\n\t\t);\n\n\t\t// Check if we're within the rate limit\n\t\treturn (\n\t\t\tthis.overpassRequestTimestamps.length < OVERPASS_RATE_LIMIT.maxRequests\n\t\t);\n\t}\n\n\t/**\n\t * Record an Overpass API request\n\t */\n\tprivate recordOverpassRequest(): void {\n\t\tthis.overpassRequestTimestamps.push(Date.now());\n\t}\n\n\t/**\n\t * Wait until we can make a request (rate limiting)\n\t */\n\tprivate async waitForRateLimit(): Promise<void> {\n\t\tif (this.canMakeOverpassRequest()) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Calculate wait time based on oldest request in window\n\t\tif (this.overpassRequestTimestamps.length === 0) {\n\t\t\treturn; // No requests recorded, safe to proceed\n\t\t}\n\n\t\tconst oldestRequest = Math.min(...this.overpassRequestTimestamps);\n\t\tconst waitTime =\n\t\t\toldestRequest + OVERPASS_RATE_LIMIT.windowMs - Date.now() + 1000; // Add 1s buffer\n\n\t\tif (waitTime > 0) {\n\t\t\tawait new Promise((resolve) => setTimeout(resolve, waitTime));\n\t\t}\n\t}\n\n\t/**\n\t * Make Overpass API request with retry logic\n\t */\n\tprivate async makeOverpassRequest(\n\t\tquery: string,\n\t\tmaxRetries = 3,\n\t): Promise<Response> {\n\t\tlet lastError: Error | undefined;\n\n\t\tfor (let attempt = 0; attempt <= maxRetries; attempt++) {\n\t\t\t// Wait for rate limit before each attempt\n\t\t\tawait this.waitForRateLimit();\n\n\t\t\t// Try each instance in round-robin fashion\n\t\t\tconst instanceIndex =\n\t\t\t\t(this.currentOverpassInstanceIndex + attempt) %\n\t\t\t\tOVERPASS_INSTANCES.length;\n\t\t\tconst instanceUrl = OVERPASS_INSTANCES[instanceIndex];\n\n\t\t\ttry {\n\t\t\t\t// Record the request attempt\n\t\t\t\tthis.recordOverpassRequest();\n\n\t\t\t\tconst res = await fetch(instanceUrl, {\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"Content-Type\": \"text/plain\",\n\t\t\t\t\t\t\"User-Agent\": USER_AGENT,\n\t\t\t\t\t},\n\t\t\t\t\tbody: query,\n\t\t\t\t});\n\n\t\t\t\t// Handle rate limiting (429)\n\t\t\t\tif (res.status === 429) {\n\t\t\t\t\tconst retryAfter = res.headers.get(\"Retry-After\");\n\t\t\t\t\tconst waitTime = retryAfter\n\t\t\t\t\t\t? Number.parseInt(retryAfter, 10) * 1000\n\t\t\t\t\t\t: 2 ** attempt * 1000; // Exponential backoff\n\n\t\t\t\t\tif (attempt < maxRetries) {\n\t\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, waitTime));\n\t\t\t\t\t\t// Switch to next instance for next attempt\n\t\t\t\t\t\tthis.currentOverpassInstanceIndex =\n\t\t\t\t\t\t\t(instanceIndex + 1) % OVERPASS_INSTANCES.length;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Handle other errors\n\t\t\t\tif (!res.ok) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t`Overpass API returned ${res.status} from ${instanceUrl}`,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Success - update instance index for next request\n\t\t\t\tthis.currentOverpassInstanceIndex =\n\t\t\t\t\t(instanceIndex + 1) % OVERPASS_INSTANCES.length;\n\t\t\t\treturn res;\n\t\t\t} catch (error) {\n\t\t\t\tlastError = error instanceof Error ? error : new Error(String(error));\n\n\t\t\t\tif (attempt < maxRetries) {\n\t\t\t\t\t// Exponential backoff for other errors\n\t\t\t\t\tconst waitTime = 2 ** attempt * 1000;\n\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, waitTime));\n\t\t\t\t\t// Try next instance\n\t\t\t\t\tthis.currentOverpassInstanceIndex =\n\t\t\t\t\t\t(instanceIndex + 1) % OVERPASS_INSTANCES.length;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthrow lastError || new Error(\"Max retries exceeded for Overpass API\");\n\t}\n\n\t/**\n\t * Find nearby hardware/plumbing suppliers\n\t */\n\tasync findNearbySuppliers(\n\t\tlat: number,\n\t\tlon: number,\n\t\tradiusMeters = 8000,\n\t): Promise<NearbySupplier[]> {\n\t\t// Create cache key based on location and radius\n\t\tconst cacheKey = `${lat.toFixed(4)}_${lon.toFixed(4)}_${radiusMeters}`;\n\n\t\t// Check cache first\n\t\tconst cached = this.overpassCache.get(cacheKey);\n\t\tif (cached) {\n\t\t\tconst age = Date.now() - cached.timestamp;\n\t\t\tif (age < CACHE_TTL) {\n\t\t\t\treturn cached.data;\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\t// Overpass query for hardware stores, DIY stores, and plumbing suppliers\n\t\t\tconst query = `\n        [out:json][timeout:25];\n        (\n          node(around:${radiusMeters},${lat},${lon})[\"shop\"=\"hardware\"];\n          node(around:${radiusMeters},${lat},${lon})[\"shop\"=\"doityourself\"];\n          node(around:${radiusMeters},${lat},${lon})[\"shop\"=\"trade\"][\"trade\"=\"plumbing\"];\n          way(around:${radiusMeters},${lat},${lon})[\"shop\"=\"hardware\"];\n          way(around:${radiusMeters},${lat},${lon})[\"shop\"=\"doityourself\"];\n        );\n        out center 30;\n      `.trim();\n\n\t\t\tconst res = await this.makeOverpassRequest(query);\n\n\t\t\tconst data = await res.json();\n\t\t\tconst elements = data.elements || [];\n\n\t\t\tconst suppliers: NearbySupplier[] = elements\n\t\t\t\t.map((e: any) => {\n\t\t\t\t\tconst supplierLat = e.lat ?? e.center?.lat;\n\t\t\t\t\tconst supplierLon = e.lon ?? e.center?.lon;\n\n\t\t\t\t\tif (!(supplierLat && supplierLon)) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst distance = this.calculateDistance(\n\t\t\t\t\t\tlat,\n\t\t\t\t\t\tlon,\n\t\t\t\t\t\tsupplierLat,\n\t\t\t\t\t\tsupplierLon,\n\t\t\t\t\t);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: e.id,\n\t\t\t\t\t\tname: e.tags?.name || \"Unknown Supplier\",\n\t\t\t\t\t\tlat: supplierLat,\n\t\t\t\t\t\tlon: supplierLon,\n\t\t\t\t\t\ttype: e.tags?.shop || e.tags?.trade || \"hardware\",\n\t\t\t\t\t\tdistance,\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t\t.filter((s: any) => s !== null)\n\t\t\t\t.sort((a: any, b: any) => (a.distance || 0) - (b.distance || 0))\n\t\t\t\t.slice(0, 10); // Top 10 closest\n\n\t\t\tconst parsedSuppliers = suppliers.map((s) =>\n\t\t\t\tNearbySupplierSchema.parse(s),\n\t\t\t);\n\n\t\t\t// Cache the result\n\t\t\tthis.overpassCache.set(cacheKey, {\n\t\t\t\tdata: parsedSuppliers,\n\t\t\t\ttimestamp: Date.now(),\n\t\t\t});\n\n\t\t\t// Clean up old cache entries (keep last 100)\n\t\t\tif (this.overpassCache.size > 100) {\n\t\t\t\tconst entries = Array.from(this.overpassCache.entries());\n\t\t\t\tentries.sort((a, b) => b[1].timestamp - a[1].timestamp);\n\t\t\t\tthis.overpassCache = new Map(entries.slice(0, 100));\n\t\t\t}\n\n\t\t\treturn parsedSuppliers;\n\t\t} catch (_error) {\n\t\t\t// Return cached data if available, even if expired\n\t\t\tif (cached) {\n\t\t\t\treturn cached.data;\n\t\t\t}\n\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t/**\n\t * Calculate straight-line distance (fallback when routing not available)\n\t */\n\tprivate getStraightLineRoute(\n\t\tfrom: { lat: number; lon: number },\n\t\tto: { lat: number; lon: number },\n\t): Route {\n\t\tconst distance = this.calculateDistance(from.lat, from.lon, to.lat, to.lon);\n\t\t// Rough estimate: 40 km/h average speed in city\n\t\tconst duration = (distance / 40_000) * 3600;\n\n\t\treturn {\n\t\t\tdistance,\n\t\t\tduration,\n\t\t\tfrom,\n\t\t\tto,\n\t\t};\n\t}\n\n\t/**\n\t * Calculate distance between two points using Haversine formula\n\t */\n\tprivate calculateDistance(\n\t\tlat1: number,\n\t\tlon1: number,\n\t\tlat2: number,\n\t\tlon2: number,\n\t): number {\n\t\tconst R = 6371e3; // Earth radius in meters\n\t\tconst 1 = (lat1 * Math.PI) / 180;\n\t\tconst 2 = (lat2 * Math.PI) / 180;\n\t\tconst  = ((lat2 - lat1) * Math.PI) / 180;\n\t\tconst  = ((lon2 - lon1) * Math.PI) / 180;\n\n\t\tconst a =\n\t\t\tMath.sin( / 2) * Math.sin( / 2) +\n\t\t\tMath.cos(1) * Math.cos(2) * Math.sin( / 2) * Math.sin( / 2);\n\t\tconst c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n\t\treturn R * c; // Distance in meters\n\t}\n\n\t/**\n\t * Format duration in human-readable form\n\t */\n\tformatDuration(seconds: number): string {\n\t\tif (seconds < 60) {\n\t\t\treturn `${Math.round(seconds)}s`;\n\t\t}\n\t\tif (seconds < 3600) {\n\t\t\treturn `${Math.round(seconds / 60)}min`;\n\t\t}\n\t\tconst hours = Math.floor(seconds / 3600);\n\t\tconst mins = Math.round((seconds % 3600) / 60);\n\t\treturn `${hours}h ${mins}min`;\n\t}\n\n\t/**\n\t * Format distance in human-readable form\n\t */\n\tformatDistance(meters: number): string {\n\t\tif (meters < 1000) {\n\t\t\treturn `${Math.round(meters)}m`;\n\t\t}\n\t\treturn `${(meters / 1000).toFixed(1)}km`;\n\t}\n}\n\n// Singleton instance\nexport const routingService = new RoutingService();\n","/**\n * Time Zone Service\n *\n * Fetches time zone information for a location\n * - Time zone ID\n * - Time zone name\n * - UTC offset\n * - DST offset\n *\n * API: Google Time Zone API\n * Free Tier: UNLIMITED (no charge)\n * Docs: https://developers.google.com/maps/documentation/timezone\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\nconst TimeZoneSchema = z.object({\n\ttimeZoneId: z.string(), // e.g., \"America/New_York\"\n\ttimeZoneName: z.string(), // e.g., \"Eastern Daylight Time\"\n\trawOffset: z.number(), // Offset from UTC in seconds (not including DST)\n\tdstOffset: z.number(), // DST offset in seconds\n\ttotalOffset: z.number(), // Total offset in seconds (rawOffset + dstOffset)\n\ttotalOffsetHours: z.number(), // Total offset in hours (for display)\n\tisDST: z.boolean(), // Whether DST is currently in effect\n\tdataSource: z.string(),\n\tenrichedAt: z.string(),\n});\n\nexport type TimeZoneInfo = z.infer<typeof TimeZoneSchema>;\n\nconst CACHE_TTL_MS = 1000 * 60 * 60 * 24 * 30; // 30 days\nconst SECONDS_TO_HOURS = 3600;\nconst MS_TO_SECONDS = 1000;\nconst COORDINATE_PRECISION = 4;\n\n// biome-ignore lint/suspicious/noConsole: Backend service logging is acceptable\nclass TimeZoneService {\n\tprivate readonly apiKey: string | undefined;\n\tprivate readonly cache: Map<\n\t\tstring,\n\t\t{ data: TimeZoneInfo; timestamp: number }\n\t> = new Map();\n\tprivate readonly cacheTTL = CACHE_TTL_MS;\n\n\tconstructor() {\n\t\tthis.apiKey = process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY;\n\t}\n\n\tasync getTimeZone(lat: number, lon: number): Promise<TimeZoneInfo | null> {\n\t\tif (!this.apiKey) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst cacheKey = `timezone:${lat.toFixed(COORDINATE_PRECISION)},${lon.toFixed(COORDINATE_PRECISION)}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\n\t\tif (cached && Date.now() - cached.timestamp < this.cacheTTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\t// Google Time Zone API requires a timestamp to calculate DST correctly\n\t\t\tconst timestamp = Math.floor(Date.now() / MS_TO_SECONDS);\n\n\t\t\tconst url = `https://maps.googleapis.com/maps/api/timezone/json?location=${lat},${lon}&timestamp=${timestamp}&key=${this.apiKey}`;\n\n\t\t\tconst res = await fetch(url, {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!res.ok) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await res.json();\n\n\t\t\tif (data.status !== \"OK\") {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst totalOffset = data.rawOffset + data.dstOffset;\n\t\t\tconst totalOffsetHours = totalOffset / SECONDS_TO_HOURS;\n\t\t\tconst isDST = data.dstOffset !== 0;\n\n\t\t\tconst timeZone: TimeZoneInfo = {\n\t\t\t\ttimeZoneId: data.timeZoneId,\n\t\t\t\ttimeZoneName: data.timeZoneName,\n\t\t\t\trawOffset: data.rawOffset,\n\t\t\t\tdstOffset: data.dstOffset,\n\t\t\t\ttotalOffset,\n\t\t\t\ttotalOffsetHours,\n\t\t\t\tisDST,\n\t\t\t\tdataSource: \"google-timezone\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\n\t\t\tthis.cache.set(cacheKey, { data: timeZone, timestamp: Date.now() });\n\n\t\t\treturn timeZone;\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Format time zone offset for display\n\t */\n\tformatOffset(totalOffsetHours: number): string {\n\t\tconst sign = totalOffsetHours >= 0 ? \"+\" : \"-\";\n\t\tconst absHours = Math.abs(totalOffsetHours);\n\t\tconst hours = Math.floor(absHours);\n\t\tconst minutes = Math.round((absHours - hours) * 60);\n\n\t\tif (minutes === 0) {\n\t\t\treturn `UTC${sign}${hours}`;\n\t\t}\n\t\treturn `UTC${sign}${hours}:${minutes.toString().padStart(2, \"0\")}`;\n\t}\n\n\t/**\n\t * Get current local time for a timezone\n\t */\n\tgetCurrentLocalTime(timeZoneId: string): Date {\n\t\treturn new Date(\n\t\t\tnew Date().toLocaleString(\"en-US\", { timeZone: timeZoneId }),\n\t\t);\n\t}\n\n\t/**\n\t * Check if location is in same timezone as user\n\t */\n\tisSameTimeZone(locationTimeZoneId: string): boolean {\n\t\tconst userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n\t\treturn locationTimeZoneId === userTimeZone;\n\t}\n}\n\nexport const timeZoneService = new TimeZoneService();\n","/**\n * Location Services\n *\n * Provides location intelligence:\n * - Geocoding (address to lat/lon)\n * - Reverse geocoding (lat/lon to address)\n * - County/FIPS data for permit requirements\n * - Flood zone risk assessment\n *\n * APIs Used:\n * - Nominatim (OSM) for geocoding\n * - FCC Census Block API for county/FIPS\n * - FEMA NFHL for flood zones\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst GeocodingResultSchema = z.object({\n\tlat: z.number(),\n\tlon: z.number(),\n\tdisplayName: z.string(),\n\taddress: z\n\t\t.object({\n\t\t\thouse_number: z.string().optional(),\n\t\t\troad: z.string().optional(),\n\t\t\tcity: z.string().optional(),\n\t\t\tstate: z.string().optional(),\n\t\t\tpostcode: z.string().optional(),\n\t\t\tcountry: z.string().optional(),\n\t\t})\n\t\t.optional(),\n});\n\nconst CountyDataSchema = z.object({\n\tcountyFips: z.string(),\n\tcountyName: z.string(),\n\tstateFips: z.string(),\n\tstateCode: z.string(),\n\tblockFips: z.string().optional(),\n});\n\nconst FloodZoneSchema = z.object({\n\tinFloodZone: z.boolean(),\n\tzone: z.string().optional(),\n\tfloodway: z.boolean().optional(),\n\triskLevel: z.enum([\"high\", \"moderate\", \"minimal\", \"unknown\"]),\n\tdescription: z.string(),\n});\n\nconst LocationIntelligenceSchema = z.object({\n\tcoordinates: z.object({\n\t\tlat: z.number(),\n\t\tlon: z.number(),\n\t}),\n\tcounty: CountyDataSchema.optional(),\n\tfloodZone: FloodZoneSchema.optional(),\n\tenrichedAt: z.string(),\n});\n\nexport type GeocodingResult = z.infer<typeof GeocodingResultSchema>;\nexport type CountyData = z.infer<typeof CountyDataSchema>;\nexport type FloodZone = z.infer<typeof FloodZoneSchema>;\nexport type LocationIntelligence = z.infer<typeof LocationIntelligenceSchema>;\n\n// ============================================================================\n// Location Services\n// ============================================================================\n\nclass LocationServices {\n\tprivate readonly cache: Map<string, { data: any; timestamp: number }> =\n\t\tnew Map();\n\tprivate readonly cacheTTL = 1000 * 60 * 60 * 24 * 7; // 7 days\n\n\t/**\n\t * Geocode using Google Geocoding API (more accurate than Nominatim)\n\t */\n\tprivate async geocodeWithGoogle(\n\t\taddress: string,\n\t): Promise<GeocodingResult | null> {\n\t\tconst apiKey = process.env.NEXT_PUBLIC_GOOGLE_PLACES_API_KEY;\n\n\t\tif (!apiKey) {\n\t\t\treturn null;\n\t\t}\n\n\t\ttry {\n\t\t\tconst params = new URLSearchParams({\n\t\t\t\taddress,\n\t\t\t\tkey: apiKey,\n\t\t\t});\n\n\t\t\tconst res = await fetch(\n\t\t\t\t`https://maps.googleapis.com/maps/api/geocode/json?${params}`,\n\t\t\t\t{\n\t\t\t\t\tsignal: AbortSignal.timeout(10_000), // 10 second timeout\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tif (!res.ok) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await res.json();\n\n\t\t\tif (data.status !== \"OK\" || !data.results || data.results.length === 0) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst first = data.results[0];\n\t\t\tconst location = first.geometry.location;\n\n\t\t\t// Parse address components\n\t\t\tconst addressComponents = first.address_components || [];\n\t\t\tconst getComponent = (type: string) =>\n\t\t\t\taddressComponents.find((c: any) => c.types.includes(type))?.long_name;\n\t\t\tconst getComponentShort = (type: string) =>\n\t\t\t\taddressComponents.find((c: any) => c.types.includes(type))?.short_name;\n\n\t\t\tconst result: GeocodingResult = {\n\t\t\t\tlat: location.lat,\n\t\t\t\tlon: location.lng,\n\t\t\t\tdisplayName: first.formatted_address,\n\t\t\t\taddress: {\n\t\t\t\t\thouse_number: getComponent(\"street_number\"),\n\t\t\t\t\troad: getComponent(\"route\"),\n\t\t\t\t\tcity:\n\t\t\t\t\t\tgetComponent(\"locality\") ||\n\t\t\t\t\t\tgetComponent(\"sublocality\") ||\n\t\t\t\t\t\tgetComponent(\"postal_town\"),\n\t\t\t\t\tstate: getComponentShort(\"administrative_area_level_1\"),\n\t\t\t\t\tpostcode: getComponent(\"postal_code\"),\n\t\t\t\t\tcountry: getComponent(\"country\"),\n\t\t\t\t},\n\t\t\t};\n\t\t\treturn GeocodingResultSchema.parse(result);\n\t\t} catch (error: any) {\n\t\t\tif (error.name === \"TimeoutError\" || error.name === \"AbortError\") {\n\t\t\t\tconsole.warn(\"Google Geocoding: Request timed out for address\");\n\t\t\t} else {\n\t\t\t\tconsole.error(\"Google Geocoding error:\", error.message);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Geocode using Nominatim (OpenStreetMap) - fallback option\n\t */\n\tprivate async geocodeWithNominatim(\n\t\taddress: string,\n\t): Promise<GeocodingResult | null> {\n\t\ttry {\n\t\t\tconst params = new URLSearchParams({\n\t\t\t\tq: address,\n\t\t\t\tformat: \"jsonv2\",\n\t\t\t\taddressdetails: \"1\",\n\t\t\t\tlimit: \"1\",\n\t\t\t});\n\n\t\t\tconst res = await fetch(\n\t\t\t\t`https://nominatim.openstreetmap.org/search?${params}`,\n\t\t\t\t{\n\t\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t\t\tsignal: AbortSignal.timeout(15_000), // 15 second timeout\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tif (!res.ok) {\n\t\t\t\tif (res.status === 429) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\"Nominatim Geocoding: Rate limited - try again in a few seconds\",\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn(`Nominatim Geocoding: HTTP ${res.status} error`);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await res.json();\n\n\t\t\tif (!Array.isArray(data) || data.length === 0) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst first = data[0];\n\t\t\tconst result: GeocodingResult = {\n\t\t\t\tlat: Number.parseFloat(first.lat),\n\t\t\t\tlon: Number.parseFloat(first.lon),\n\t\t\t\tdisplayName: first.display_name,\n\t\t\t\taddress: first.address\n\t\t\t\t\t? {\n\t\t\t\t\t\t\thouse_number: first.address.house_number,\n\t\t\t\t\t\t\troad: first.address.road,\n\t\t\t\t\t\t\tcity:\n\t\t\t\t\t\t\t\tfirst.address.city ||\n\t\t\t\t\t\t\t\tfirst.address.town ||\n\t\t\t\t\t\t\t\tfirst.address.village,\n\t\t\t\t\t\t\tstate: first.address.state,\n\t\t\t\t\t\t\tpostcode: first.address.postcode,\n\t\t\t\t\t\t\tcountry: first.address.country,\n\t\t\t\t\t\t}\n\t\t\t\t\t: undefined,\n\t\t\t};\n\t\t\treturn GeocodingResultSchema.parse(result);\n\t\t} catch (error: any) {\n\t\t\tif (error.name === \"TimeoutError\" || error.name === \"AbortError\") {\n\t\t\t\tconsole.warn(\"Nominatim Geocoding: Request timed out\");\n\t\t\t} else {\n\t\t\t\tconsole.error(\"Nominatim Geocoding error:\", error.message);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Geocode an address to coordinates\n\t * Tries Google first (more accurate), falls back to Nominatim\n\t */\n\tasync geocode(address: string): Promise<GeocodingResult | null> {\n\t\tconst cacheKey = `geocode:${address}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\t\tif (cached && Date.now() - cached.timestamp < this.cacheTTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\t// Try Google first (more accurate for US addresses)\n\t\tlet result = await this.geocodeWithGoogle(address);\n\n\t\t// Fall back to Nominatim if Google fails\n\t\tif (!result) {\n\t\t\tresult = await this.geocodeWithNominatim(address);\n\t\t}\n\n\t\tif (result) {\n\t\t\tthis.cache.set(cacheKey, { data: result, timestamp: Date.now() });\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Reverse geocode coordinates to address\n\t */\n\tasync reverseGeocode(\n\t\tlat: number,\n\t\tlon: number,\n\t): Promise<GeocodingResult | null> {\n\t\tconst cacheKey = `reverse:${lat},${lon}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\t\tif (cached && Date.now() - cached.timestamp < this.cacheTTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\tconst params = new URLSearchParams({\n\t\t\t\tlat: lat.toString(),\n\t\t\t\tlon: lon.toString(),\n\t\t\t\tformat: \"jsonv2\",\n\t\t\t\taddressdetails: \"1\",\n\t\t\t});\n\n\t\t\tconst res = await fetch(\n\t\t\t\t`https://nominatim.openstreetmap.org/reverse?${params}`,\n\t\t\t\t{\n\t\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tif (!res.ok) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await res.json();\n\n\t\t\tconst result: GeocodingResult = {\n\t\t\t\tlat: Number.parseFloat(data.lat),\n\t\t\t\tlon: Number.parseFloat(data.lon),\n\t\t\t\tdisplayName: data.display_name,\n\t\t\t\taddress: data.address\n\t\t\t\t\t? {\n\t\t\t\t\t\t\thouse_number: data.address.house_number,\n\t\t\t\t\t\t\troad: data.address.road,\n\t\t\t\t\t\t\tcity:\n\t\t\t\t\t\t\t\tdata.address.city || data.address.town || data.address.village,\n\t\t\t\t\t\t\tstate: data.address.state,\n\t\t\t\t\t\t\tpostcode: data.address.postcode,\n\t\t\t\t\t\t\tcountry: data.address.country,\n\t\t\t\t\t\t}\n\t\t\t\t\t: undefined,\n\t\t\t};\n\n\t\t\tthis.cache.set(cacheKey, { data: result, timestamp: Date.now() });\n\t\t\treturn GeocodingResultSchema.parse(result);\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get county and FIPS data from coordinates\n\t */\n\tasync getCountyData(lat: number, lon: number): Promise<CountyData | null> {\n\t\tconst cacheKey = `county:${lat},${lon}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\t\tif (cached && Date.now() - cached.timestamp < this.cacheTTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\tconst url = `https://geo.fcc.gov/api/census/block/find?latitude=${lat}&longitude=${lon}&format=json`;\n\n\t\t\tconst res = await fetch(url, {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!res.ok) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await res.json();\n\n\t\t\tconst result: CountyData = {\n\t\t\t\tcountyFips: data.County?.FIPS || \"\",\n\t\t\t\tcountyName: data.County?.name || \"\",\n\t\t\t\tstateFips: data.State?.FIPS || \"\",\n\t\t\t\tstateCode: data.State?.code || \"\",\n\t\t\t\tblockFips: data.Block?.FIPS,\n\t\t\t};\n\n\t\t\tthis.cache.set(cacheKey, { data: result, timestamp: Date.now() });\n\t\t\treturn CountyDataSchema.parse(result);\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Check if location is in a flood zone\n\t */\n\tasync getFloodZoneData(lat: number, lon: number): Promise<FloodZone | null> {\n\t\tconst cacheKey = `flood:${lat},${lon}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\t\tif (cached && Date.now() - cached.timestamp < this.cacheTTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\tconst params = new URLSearchParams({\n\t\t\t\tf: \"json\",\n\t\t\t\tgeometry: JSON.stringify({\n\t\t\t\t\tx: lon,\n\t\t\t\t\ty: lat,\n\t\t\t\t\tspatialReference: { wkid: 4326 },\n\t\t\t\t}),\n\t\t\t\tgeometryType: \"esriGeometryPoint\",\n\t\t\t\tsr: \"4326\",\n\t\t\t\tlayers: \"all:28\",\n\t\t\t\ttolerance: \"1\",\n\t\t\t\tmapExtent: `${lon - 0.01},${lat - 0.01},${lon + 0.01},${lat + 0.01}`,\n\t\t\t\timageDisplay: \"800,600,96\",\n\t\t\t\treturnGeometry: \"false\",\n\t\t\t});\n\n\t\t\tconst url = `https://hazards.fema.gov/gis/nfhl/rest/services/public/NFHL/MapServer/identify?${params.toString()}`;\n\n\t\t\tconst res = await fetch(url, {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!res.ok) {\n\t\t\t\t// 404 just means no flood zone data available for this location (expected)\n\t\t\t\tif (res.status === 404) {\n\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t`Flood Zone: No data available for location (${lat}, ${lon})`,\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t`Flood Zone API error: ${res.status} for location (${lat}, ${lon})`,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await res.json();\n\t\t\tconst features: any[] = data.results || [];\n\n\t\t\t// Check for Special Flood Hazard Area\n\t\t\tconst floodFeature = features.find((f) =>\n\t\t\t\t/Zone [A|AE|AO|AH|VE|V]/i.test(f.attributes?.FLD_ZONE || \"\"),\n\t\t\t);\n\n\t\t\tif (floodFeature) {\n\t\t\t\tconst zone = floodFeature.attributes.FLD_ZONE;\n\t\t\t\tconst isFloodway = floodFeature.attributes.FLOODWAY === \"FLOODWAY\";\n\n\t\t\t\tlet riskLevel: FloodZone[\"riskLevel\"] = \"high\";\n\t\t\t\tlet description = \"\";\n\n\t\t\t\tif (zone.startsWith(\"V\")) {\n\t\t\t\t\triskLevel = \"high\";\n\t\t\t\t\tdescription = \"High-risk coastal flood zone with wave action.\";\n\t\t\t\t} else if (zone.startsWith(\"A\")) {\n\t\t\t\t\triskLevel = \"high\";\n\t\t\t\t\tdescription = \"High-risk flood zone. Flood insurance required.\";\n\t\t\t\t} else if (zone.startsWith(\"X\")) {\n\t\t\t\t\triskLevel = \"moderate\";\n\t\t\t\t\tdescription = \"Moderate flood risk area.\";\n\t\t\t\t}\n\n\t\t\t\tif (isFloodway) {\n\t\t\t\t\tdescription += \" Located in regulatory floodway.\";\n\t\t\t\t}\n\n\t\t\t\tconst result: FloodZone = {\n\t\t\t\t\tinFloodZone: true,\n\t\t\t\t\tzone,\n\t\t\t\t\tfloodway: isFloodway,\n\t\t\t\t\triskLevel,\n\t\t\t\t\tdescription,\n\t\t\t\t};\n\n\t\t\t\tthis.cache.set(cacheKey, { data: result, timestamp: Date.now() });\n\t\t\t\treturn FloodZoneSchema.parse(result);\n\t\t\t}\n\n\t\t\t// No flood zone found\n\t\t\tconst result: FloodZone = {\n\t\t\t\tinFloodZone: false,\n\t\t\t\triskLevel: \"minimal\",\n\t\t\t\tdescription: \"Not in a mapped flood zone.\",\n\t\t\t};\n\n\t\t\tthis.cache.set(cacheKey, { data: result, timestamp: Date.now() });\n\t\t\treturn FloodZoneSchema.parse(result);\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get complete location intelligence for a point\n\t */\n\tasync getLocationIntelligence(\n\t\tlat: number,\n\t\tlon: number,\n\t): Promise<LocationIntelligence> {\n\t\tconst [county, floodZone] = await Promise.all([\n\t\t\tthis.getCountyData(lat, lon),\n\t\t\tthis.getFloodZoneData(lat, lon),\n\t\t]);\n\n\t\treturn {\n\t\t\tcoordinates: { lat, lon },\n\t\t\tcounty: county || undefined,\n\t\t\tfloodZone: floodZone || undefined,\n\t\t\tenrichedAt: new Date().toISOString(),\n\t\t};\n\t}\n\n\t/**\n\t * Clear cache\n\t */\n\tclearCache(): void {\n\t\tthis.cache.clear();\n\t}\n}\n\n// Singleton instance\nexport const locationServices = new LocationServices();\n","/**\n * Schools Service\n *\n * Fetches nearby schools from OpenStreetMap\n * - Elementary, Middle, High Schools\n * - Distance from property\n * - School type (public, private, charter)\n *\n * API: FREE, no key required (using Overpass API)\n * Data: OpenStreetMap\n *\n * Note: For US school ratings, would need GreatSchools API (requires paid subscription)\n * This provides basic school locations and types only\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\nconst SchoolSchema = z.object({\n\tname: z.string(),\n\ttype: z.string().optional(), // elementary, middle, high, university\n\toperator: z.string().optional(), // public, private, charter\n\tdistance: z.number(), // meters\n\tlat: z.number(),\n\tlon: z.number(),\n});\n\nconst SchoolsDataSchema = z.object({\n\tschools: z.array(SchoolSchema),\n\tclosestSchool: z.number().optional(), // meters\n\ttotalSchools: z.number(),\n\tdataSource: z.string(),\n\tenrichedAt: z.string(),\n});\n\nexport type School = z.infer<typeof SchoolSchema>;\nexport type SchoolsData = z.infer<typeof SchoolsDataSchema>;\n\nclass SchoolsService {\n\tprivate readonly cache: Map<\n\t\tstring,\n\t\t{ data: SchoolsData; timestamp: number }\n\t> = new Map();\n\tprivate readonly cacheTTL = 1000 * 60 * 60 * 24 * 90; // 90 days\n\n\tasync getNearbySchools(\n\t\tlat: number,\n\t\tlon: number,\n\t\tradius = 5000,\n\t): Promise<SchoolsData | null> {\n\t\tconst cacheKey = `schools:${lat.toFixed(4)},${lon.toFixed(4)}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\n\t\tif (cached && Date.now() - cached.timestamp < this.cacheTTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\t// Query Overpass API for schools within radius\n\t\t\tconst query = `\n        [out:json][timeout:25];\n        (\n          node(around:${radius},${lat},${lon})[\"amenity\"=\"school\"];\n          way(around:${radius},${lat},${lon})[\"amenity\"=\"school\"];\n          node(around:${radius},${lat},${lon})[\"amenity\"=\"kindergarten\"];\n          node(around:${radius},${lat},${lon})[\"amenity\"=\"college\"];\n          node(around:${radius},${lat},${lon})[\"amenity\"=\"university\"];\n        );\n        out center tags;\n      `.trim();\n\n\t\t\tconst res = await fetch(\"https://overpass-api.de/api/interpreter\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\t\"Content-Type\": \"text/plain\",\n\t\t\t\t\t\"User-Agent\": USER_AGENT,\n\t\t\t\t},\n\t\t\t\tbody: query,\n\t\t\t});\n\n\t\t\tif (!res.ok) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await res.json();\n\n\t\t\tif (!data.elements || data.elements.length === 0) {\n\t\t\t\treturn {\n\t\t\t\t\tschools: [],\n\t\t\t\t\ttotalSchools: 0,\n\t\t\t\t\tdataSource: \"osm\",\n\t\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst schools: School[] = data.elements.map((element: any) => {\n\t\t\t\tconst tags = element.tags || {};\n\t\t\t\tconst schoolLat = element.center?.lat || element.lat;\n\t\t\t\tconst schoolLon = element.center?.lon || element.lon;\n\n\t\t\t\tconst distance = this.calculateDistance(lat, lon, schoolLat, schoolLon);\n\n\t\t\t\treturn {\n\t\t\t\t\tname: tags.name || \"Unnamed School\",\n\t\t\t\t\ttype: this.getSchoolType(tags),\n\t\t\t\t\toperator: tags.operator || tags[\"operator:type\"],\n\t\t\t\t\tdistance: Math.round(distance),\n\t\t\t\t\tlat: schoolLat,\n\t\t\t\t\tlon: schoolLon,\n\t\t\t\t};\n\t\t\t});\n\n\t\t\t// Sort by distance\n\t\t\tschools.sort((a, b) => a.distance - b.distance);\n\n\t\t\tconst schoolsData: SchoolsData = {\n\t\t\t\tschools: schools.slice(0, 10), // Top 10 closest\n\t\t\t\tclosestSchool: schools[0]?.distance,\n\t\t\t\ttotalSchools: schools.length,\n\t\t\t\tdataSource: \"osm\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\n\t\t\tthis.cache.set(cacheKey, { data: schoolsData, timestamp: Date.now() });\n\n\t\t\treturn schoolsData;\n\t\t} catch (_error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tprivate getSchoolType(tags: any): string {\n\t\tif (tags.amenity === \"kindergarten\") {\n\t\t\treturn \"Preschool\";\n\t\t}\n\t\tif (tags.amenity === \"university\") {\n\t\t\treturn \"University\";\n\t\t}\n\t\tif (tags.amenity === \"college\") {\n\t\t\treturn \"College\";\n\t\t}\n\n\t\t// Check for grade levels\n\t\tif (tags[\"isced:level\"]) {\n\t\t\tconst level = tags[\"isced:level\"];\n\t\t\tif (level.includes(\"0\") || level.includes(\"1\")) {\n\t\t\t\treturn \"Elementary\";\n\t\t\t}\n\t\t\tif (level.includes(\"2\")) {\n\t\t\t\treturn \"Middle School\";\n\t\t\t}\n\t\t\tif (level.includes(\"3\")) {\n\t\t\t\treturn \"High School\";\n\t\t\t}\n\t\t}\n\n\t\treturn \"School\";\n\t}\n\n\tprivate calculateDistance(\n\t\tlat1: number,\n\t\tlon1: number,\n\t\tlat2: number,\n\t\tlon2: number,\n\t): number {\n\t\tconst R = 6_371_000; // Earth's radius in meters\n\t\tconst 1 = (lat1 * Math.PI) / 180;\n\t\tconst 2 = (lat2 * Math.PI) / 180;\n\t\tconst  = ((lat2 - lat1) * Math.PI) / 180;\n\t\tconst  = ((lon2 - lon1) * Math.PI) / 180;\n\n\t\tconst a =\n\t\t\tMath.sin( / 2) * Math.sin( / 2) +\n\t\t\tMath.cos(1) * Math.cos(2) * Math.sin( / 2) * Math.sin( / 2);\n\t\tconst c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n\t\treturn R * c;\n\t}\n}\n\nexport const schoolsService = new SchoolsService();\n","/**\n * Google Solar Service\n *\n * Provides solar potential analysis using Google Solar API\n * - Building insights (roof area, pitch, azimuth)\n * - Solar potential calculations\n * - Financial analysis (savings, payback period)\n * - Panel configuration recommendations\n *\n * API: Google Solar API\n * Docs: https://developers.google.com/maps/documentation/solar\n *\n * Use Cases for Field Service:\n * - Solar installation proposals\n * - HVAC + Solar bundle offers\n * - Property assessment for roofing contractors\n * - Energy efficiency consultations\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst LatLngBoxSchema = z.object({\n\tsw: z.object({ lat: z.number(), lng: z.number() }),\n\tne: z.object({ lat: z.number(), lng: z.number() }),\n});\n\nconst RoofSegmentSchema = z.object({\n\tpitchDegrees: z.number(), // Roof pitch in degrees\n\tazimuthDegrees: z.number(), // Direction roof faces (0=N, 90=E, 180=S, 270=W)\n\tstats: z.object({\n\t\tareaMeters2: z.number(), // Roof segment area\n\t\tsunshineQuantiles: z.array(z.number()).optional(), // Sunshine distribution\n\t\tgroundAreaMeters2: z.number().optional(),\n\t}),\n\tcenter: z.object({ lat: z.number(), lng: z.number() }).optional(),\n\tboundingBox: LatLngBoxSchema.optional(),\n\tplaneHeightAtCenterMeters: z.number().optional(),\n});\n\nconst SolarPanelConfigSchema = z.object({\n\tpanelsCount: z.number(),\n\tyearlyEnergyDcKwh: z.number(), // DC energy production per year\n\troofSegmentSummaries: z\n\t\t.array(\n\t\t\tz.object({\n\t\t\t\tpitchDegrees: z.number(),\n\t\t\t\tazimuthDegrees: z.number(),\n\t\t\t\tpanelsCount: z.number(),\n\t\t\t\tyearlyEnergyDcKwh: z.number(),\n\t\t\t\tsegmentIndex: z.number(),\n\t\t\t}),\n\t\t)\n\t\t.optional(),\n});\n\nconst FinancialAnalysisSchema = z.object({\n\tmonthlyBill: z.object({\n\t\tcurrencyCode: z.string(),\n\t\tunits: z.string(),\n\t\tnanos: z.number().optional(),\n\t}),\n\tpanelConfigIndex: z.number(),\n\tfinancialDetails: z\n\t\t.object({\n\t\t\tinitialAcKwhPerYear: z.number(), // First year production\n\t\t\tremainingLifetimeUtilityBill: z.object({\n\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\tunits: z.string(),\n\t\t\t}),\n\t\t\tfederalIncentive: z\n\t\t\t\t.object({\n\t\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\t\tunits: z.string(),\n\t\t\t\t})\n\t\t\t\t.optional(),\n\t\t\tstateIncentive: z\n\t\t\t\t.object({\n\t\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\t\tunits: z.string(),\n\t\t\t\t})\n\t\t\t\t.optional(),\n\t\t\tutilityIncentive: z\n\t\t\t\t.object({\n\t\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\t\tunits: z.string(),\n\t\t\t\t})\n\t\t\t\t.optional(),\n\t\t\tlifetimeSrecTotal: z\n\t\t\t\t.object({\n\t\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\t\tunits: z.string(),\n\t\t\t\t})\n\t\t\t\t.optional(),\n\t\t\tcostOfElectricityWithoutSolar: z\n\t\t\t\t.object({\n\t\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\t\tunits: z.string(),\n\t\t\t\t})\n\t\t\t\t.optional(),\n\t\t\tnetMeteringAllowed: z.boolean().optional(),\n\t\t\tsolarPercentage: z.number().optional(), // % of energy from solar\n\t\t\tpercentageExportedToGrid: z.number().optional(),\n\t\t})\n\t\t.optional(),\n\tleasingSavings: z\n\t\t.object({\n\t\t\tleasesAllowed: z.boolean(),\n\t\t\tleasesSupported: z.boolean(),\n\t\t\tannualLeasingCost: z\n\t\t\t\t.object({\n\t\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\t\tunits: z.string(),\n\t\t\t\t})\n\t\t\t\t.optional(),\n\t\t\tsavings: z\n\t\t\t\t.object({\n\t\t\t\t\tsavingsYear1: z.object({\n\t\t\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\t\t\tunits: z.string(),\n\t\t\t\t\t}),\n\t\t\t\t\tsavingsYear20: z.object({\n\t\t\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\t\t\tunits: z.string(),\n\t\t\t\t\t}),\n\t\t\t\t\tsavingsLifetime: z.object({\n\t\t\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\t\t\tunits: z.string(),\n\t\t\t\t\t}),\n\t\t\t\t})\n\t\t\t\t.optional(),\n\t\t})\n\t\t.optional(),\n\tcashPurchaseSavings: z\n\t\t.object({\n\t\t\toutOfPocketCost: z.object({\n\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\tunits: z.string(),\n\t\t\t}),\n\t\t\tupfrontCost: z.object({\n\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\tunits: z.string(),\n\t\t\t}),\n\t\t\trebateValue: z\n\t\t\t\t.object({\n\t\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\t\tunits: z.string(),\n\t\t\t\t})\n\t\t\t\t.optional(),\n\t\t\tpaybackYears: z.number().optional(),\n\t\t\tsavings: z.object({\n\t\t\t\tsavingsYear1: z.object({\n\t\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\t\tunits: z.string(),\n\t\t\t\t}),\n\t\t\t\tsavingsYear20: z.object({\n\t\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\t\tunits: z.string(),\n\t\t\t\t}),\n\t\t\t\tsavingsLifetime: z.object({\n\t\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\t\tunits: z.string(),\n\t\t\t\t}),\n\t\t\t}),\n\t\t})\n\t\t.optional(),\n\tfinancedPurchaseSavings: z\n\t\t.object({\n\t\t\tannualLoanPayment: z.object({\n\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\tunits: z.string(),\n\t\t\t}),\n\t\t\tloanInterestRate: z.number(),\n\t\t\tsavings: z\n\t\t\t\t.object({\n\t\t\t\t\tsavingsYear1: z.object({\n\t\t\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\t\t\tunits: z.string(),\n\t\t\t\t\t}),\n\t\t\t\t\tsavingsYear20: z.object({\n\t\t\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\t\t\tunits: z.string(),\n\t\t\t\t\t}),\n\t\t\t\t\tsavingsLifetime: z.object({\n\t\t\t\t\t\tcurrencyCode: z.string(),\n\t\t\t\t\t\tunits: z.string(),\n\t\t\t\t\t}),\n\t\t\t\t})\n\t\t\t\t.optional(),\n\t\t})\n\t\t.optional(),\n});\n\nconst BuildingInsightsSchema = z.object({\n\tname: z.string().optional(),\n\tcenter: z.object({ lat: z.number(), lng: z.number() }),\n\tboundingBox: LatLngBoxSchema.optional(),\n\timageryDate: z\n\t\t.object({\n\t\t\tyear: z.number(),\n\t\t\tmonth: z.number(),\n\t\t\tday: z.number(),\n\t\t})\n\t\t.optional(),\n\timageryProcessedDate: z\n\t\t.object({\n\t\t\tyear: z.number(),\n\t\t\tmonth: z.number(),\n\t\t\tday: z.number(),\n\t\t})\n\t\t.optional(),\n\tpostalCode: z.string().optional(),\n\tadministrativeArea: z.string().optional(),\n\tstatisticalArea: z.string().optional(),\n\tregionCode: z.string().optional(),\n\tsolarPotential: z.object({\n\t\tmaxArrayPanelsCount: z.number(),\n\t\tmaxArrayAreaMeters2: z.number(),\n\t\tmaxSunshineHoursPerYear: z.number(),\n\t\tcarbonOffsetFactorKgPerMwh: z.number(),\n\t\twholeRoofStats: z\n\t\t\t.object({\n\t\t\t\tareaMeters2: z.number(),\n\t\t\t\tsunshineQuantiles: z.array(z.number()).optional(),\n\t\t\t\tgroundAreaMeters2: z.number().optional(),\n\t\t\t})\n\t\t\t.optional(),\n\t\troofSegmentStats: z.array(RoofSegmentSchema).optional(),\n\t\tsolarPanelConfigs: z.array(SolarPanelConfigSchema).optional(),\n\t\tfinancialAnalyses: z.array(FinancialAnalysisSchema).optional(),\n\t\tpanelCapacityWatts: z.number().optional(),\n\t\tpanelHeightMeters: z.number().optional(),\n\t\tpanelWidthMeters: z.number().optional(),\n\t\tpanelLifetimeYears: z.number().optional(),\n\t}),\n});\n\nconst SolarDataSchema = z.object({\n\tlocation: z.object({\n\t\tlat: z.number(),\n\t\tlng: z.number(),\n\t}),\n\tbuildingInsights: BuildingInsightsSchema.optional(),\n\tdataQuality: z.enum([\"HIGH\", \"MEDIUM\", \"LOW\", \"IMAGERY_UNAVAILABLE\"]),\n\tsource: z.enum([\"google\"]),\n\tenrichedAt: z.string(),\n});\n\nexport type RoofSegment = z.infer<typeof RoofSegmentSchema>;\nexport type SolarPanelConfig = z.infer<typeof SolarPanelConfigSchema>;\nexport type FinancialAnalysis = z.infer<typeof FinancialAnalysisSchema>;\nexport type BuildingInsights = z.infer<typeof BuildingInsightsSchema>;\nexport type SolarData = z.infer<typeof SolarDataSchema>;\n\n// ============================================================================\n// Cache Configuration\n// ============================================================================\n\nconst CACHE_TTL = 24 * 60 * 60 * 1000; // 24 hours (building data doesn't change often)\n\n// ============================================================================\n// Google Solar Service\n// ============================================================================\n\nclass GoogleSolarService {\n\tprivate readonly apiKey: string | undefined;\n\tprivate readonly cache: Map<string, { data: SolarData; timestamp: number }> =\n\t\tnew Map();\n\n\tconstructor() {\n\t\t// Use unified GOOGLE_API_KEY for all Google services\n\t\tthis.apiKey =\n\t\t\tprocess.env.GOOGLE_API_KEY ||\n\t\t\tprocess.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY ||\n\t\t\tprocess.env.GOOGLE_MAPS_API_KEY;\n\t}\n\n\t/**\n\t * Check if service is available\n\t */\n\tisAvailable(): boolean {\n\t\treturn !!this.apiKey;\n\t}\n\n\t/**\n\t * Get solar potential data for a building\n\t */\n\tasync getSolarData(lat: number, lng: number): Promise<SolarData | null> {\n\t\tconst cacheKey = `solar:${lat.toFixed(6)},${lng.toFixed(6)}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\t\tif (cached && Date.now() - cached.timestamp < CACHE_TTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\tif (!this.apiKey) {\n\t\t\tconsole.warn(\"Google Solar Service: No API key configured\");\n\t\t\treturn null;\n\t\t}\n\n\t\ttry {\n\t\t\tconst url = new URL(\n\t\t\t\t\"https://solar.googleapis.com/v1/buildingInsights:findClosest\",\n\t\t\t);\n\t\t\turl.searchParams.set(\"location.latitude\", lat.toString());\n\t\t\turl.searchParams.set(\"location.longitude\", lng.toString());\n\t\t\turl.searchParams.set(\"requiredQuality\", \"LOW\"); // Get data even if quality isn't perfect\n\t\t\turl.searchParams.set(\"key\", this.apiKey);\n\n\t\t\tconst response = await fetch(url.toString(), {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tif (response.status === 404) {\n\t\t\t\t\t// No building data available\n\t\t\t\t\treturn {\n\t\t\t\t\t\tlocation: { lat, lng },\n\t\t\t\t\t\tdataQuality: \"IMAGERY_UNAVAILABLE\",\n\t\t\t\t\t\tsource: \"google\",\n\t\t\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tconsole.error(`Google Solar API error: ${response.status}`);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\n\t\t\tconst solarData: SolarData = {\n\t\t\t\tlocation: { lat, lng },\n\t\t\t\tbuildingInsights: data,\n\t\t\t\tdataQuality: data.imageryQuality || \"MEDIUM\",\n\t\t\t\tsource: \"google\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\n\t\t\tconst validated = SolarDataSchema.parse(solarData);\n\t\t\tthis.cache.set(cacheKey, { data: validated, timestamp: Date.now() });\n\t\t\tthis.cleanCache();\n\n\t\t\treturn validated;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Google Solar fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get solar potential summary for a property\n\t */\n\tgetSolarSummary(data: SolarData): {\n\t\thasData: boolean;\n\t\tmaxPanels: number;\n\t\tmaxAreaSqFt: number;\n\t\tyearlyEnergyKwh: number;\n\t\tcarbonOffsetLbs: number;\n\t\tsunshineHoursPerYear: number;\n\t\troofSegments: number;\n\t\tbestRoofPitch: number;\n\t\tbestRoofDirection: string;\n\t\tdataQuality: string;\n\t} | null {\n\t\tif (!data.buildingInsights?.solarPotential) {\n\t\t\treturn {\n\t\t\t\thasData: false,\n\t\t\t\tmaxPanels: 0,\n\t\t\t\tmaxAreaSqFt: 0,\n\t\t\t\tyearlyEnergyKwh: 0,\n\t\t\t\tcarbonOffsetLbs: 0,\n\t\t\t\tsunshineHoursPerYear: 0,\n\t\t\t\troofSegments: 0,\n\t\t\t\tbestRoofPitch: 0,\n\t\t\t\tbestRoofDirection: \"Unknown\",\n\t\t\t\tdataQuality: data.dataQuality,\n\t\t\t};\n\t\t}\n\n\t\tconst sp = data.buildingInsights.solarPotential;\n\t\tconst configs = sp.solarPanelConfigs || [];\n\t\tconst segments = sp.roofSegmentStats || [];\n\n\t\t// Find best configuration (most panels)\n\t\tconst bestConfig = configs.reduce(\n\t\t\t(best, config) =>\n\t\t\t\tconfig.panelsCount > (best?.panelsCount || 0) ? config : best,\n\t\t\tconfigs[0],\n\t\t);\n\n\t\t// Find best roof segment (most sunshine, south-facing preferred)\n\t\tconst bestSegment = segments.reduce((best, seg) => {\n\t\t\tif (!best) return seg;\n\t\t\t// Prefer south-facing (180) roofs\n\t\t\tconst bestSouthScore = 180 - Math.abs(180 - best.azimuthDegrees);\n\t\t\tconst segSouthScore = 180 - Math.abs(180 - seg.azimuthDegrees);\n\t\t\treturn segSouthScore > bestSouthScore ? seg : best;\n\t\t}, segments[0]);\n\n\t\tconst directionFromAzimuth = (az: number): string => {\n\t\t\tconst dirs = [\"N\", \"NE\", \"E\", \"SE\", \"S\", \"SW\", \"W\", \"NW\"];\n\t\t\tconst index = Math.round(az / 45) % 8;\n\t\t\treturn dirs[index];\n\t\t};\n\n\t\treturn {\n\t\t\thasData: true,\n\t\t\tmaxPanels: sp.maxArrayPanelsCount,\n\t\t\tmaxAreaSqFt: Math.round(sp.maxArrayAreaMeters2 * 10.764), // m to ft\n\t\t\tyearlyEnergyKwh: Math.round(bestConfig?.yearlyEnergyDcKwh || 0),\n\t\t\tcarbonOffsetLbs: Math.round(\n\t\t\t\t(sp.carbonOffsetFactorKgPerMwh *\n\t\t\t\t\t((bestConfig?.yearlyEnergyDcKwh || 0) / 1000) *\n\t\t\t\t\t2.205) /\n\t\t\t\t\t1, // kg to lbs\n\t\t\t),\n\t\t\tsunshineHoursPerYear: Math.round(sp.maxSunshineHoursPerYear),\n\t\t\troofSegments: segments.length,\n\t\t\tbestRoofPitch: Math.round(bestSegment?.pitchDegrees || 0),\n\t\t\tbestRoofDirection: bestSegment\n\t\t\t\t? directionFromAzimuth(bestSegment.azimuthDegrees)\n\t\t\t\t: \"Unknown\",\n\t\t\tdataQuality: data.dataQuality,\n\t\t};\n\t}\n\n\t/**\n\t * Get financial analysis for solar installation\n\t */\n\tgetFinancialAnalysis(\n\t\tdata: SolarData,\n\t\tmonthlyBill: number,\n\t): {\n\t\thasData: boolean;\n\t\trecommendedPanels: number;\n\t\testimatedCost: number;\n\t\tyearlyProduction: number;\n\t\tyearlyValueGenerated: number;\n\t\tmonthlyBillReduction: number;\n\t\tpaybackYears: number;\n\t\ttwentyYearSavings: number;\n\t\tfederalTaxCredit: number;\n\t\tsolarPercentage: number;\n\t} | null {\n\t\tif (!data.buildingInsights?.solarPotential) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst sp = data.buildingInsights.solarPotential;\n\t\tconst analyses = sp.financialAnalyses || [];\n\n\t\t// Find analysis closest to the given monthly bill\n\t\tconst analysis = analyses.reduce((closest, current) => {\n\t\t\tif (!closest) return current;\n\t\t\tconst closestBill = parseFloat(closest.monthlyBill.units);\n\t\t\tconst currentBill = parseFloat(current.monthlyBill.units);\n\t\t\treturn Math.abs(currentBill - monthlyBill) <\n\t\t\t\tMath.abs(closestBill - monthlyBill)\n\t\t\t\t? current\n\t\t\t\t: closest;\n\t\t}, analyses[0]);\n\n\t\tif (!analysis) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst configs = sp.solarPanelConfigs || [];\n\t\tconst config = configs[analysis.panelConfigIndex] || configs[0];\n\t\tconst cash = analysis.cashPurchaseSavings;\n\t\tconst details = analysis.financialDetails;\n\n\t\t// Calculate estimated values\n\t\tconst panelWatts = sp.panelCapacityWatts || 400;\n\t\tconst costPerWatt = 2.75; // Average installed cost per watt in 2024\n\t\tconst estimatedCost = config\n\t\t\t? config.panelsCount * panelWatts * costPerWatt\n\t\t\t: 0;\n\t\tconst federalCredit = estimatedCost * 0.3; // 30% federal ITC\n\n\t\t// Estimate electricity rate from production and savings\n\t\tconst yearlyProduction = config?.yearlyEnergyDcKwh || 0;\n\t\tconst avgElectricityRate = 0.15; // $0.15/kWh average\n\t\tconst yearlyValue = yearlyProduction * avgElectricityRate;\n\n\t\treturn {\n\t\t\thasData: true,\n\t\t\trecommendedPanels: config?.panelsCount || 0,\n\t\t\testimatedCost: Math.round(estimatedCost),\n\t\t\tyearlyProduction: Math.round(yearlyProduction),\n\t\t\tyearlyValueGenerated: Math.round(yearlyValue),\n\t\t\tmonthlyBillReduction: Math.round(yearlyValue / 12),\n\t\t\tpaybackYears:\n\t\t\t\tcash?.paybackYears || Math.round(estimatedCost / yearlyValue),\n\t\t\ttwentyYearSavings: cash?.savings?.savingsYear20\n\t\t\t\t? parseFloat(cash.savings.savingsYear20.units)\n\t\t\t\t: Math.round(yearlyValue * 20 - estimatedCost + federalCredit),\n\t\t\tfederalTaxCredit: Math.round(federalCredit),\n\t\t\tsolarPercentage: details?.solarPercentage || 0,\n\t\t};\n\t}\n\n\t/**\n\t * Check if property is suitable for solar\n\t */\n\tisSuitableForSolar(data: SolarData): {\n\t\tsuitable: boolean;\n\t\tscore: number; // 0-100\n\t\treasons: string[];\n\t\tconcerns: string[];\n\t} {\n\t\tif (!data.buildingInsights?.solarPotential) {\n\t\t\treturn {\n\t\t\t\tsuitable: false,\n\t\t\t\tscore: 0,\n\t\t\t\treasons: [],\n\t\t\t\tconcerns: [\"No solar data available for this location\"],\n\t\t\t};\n\t\t}\n\n\t\tconst sp = data.buildingInsights.solarPotential;\n\t\tconst reasons: string[] = [];\n\t\tconst concerns: string[] = [];\n\t\tlet score = 50; // Base score\n\n\t\t// Check sunshine hours\n\t\tif (sp.maxSunshineHoursPerYear > 1500) {\n\t\t\treasons.push(\n\t\t\t\t`Excellent sunshine: ${Math.round(sp.maxSunshineHoursPerYear)} hours/year`,\n\t\t\t);\n\t\t\tscore += 20;\n\t\t} else if (sp.maxSunshineHoursPerYear > 1200) {\n\t\t\treasons.push(\n\t\t\t\t`Good sunshine: ${Math.round(sp.maxSunshineHoursPerYear)} hours/year`,\n\t\t\t);\n\t\t\tscore += 10;\n\t\t} else {\n\t\t\tconcerns.push(\n\t\t\t\t`Limited sunshine: ${Math.round(sp.maxSunshineHoursPerYear)} hours/year`,\n\t\t\t);\n\t\t\tscore -= 10;\n\t\t}\n\n\t\t// Check roof area\n\t\tif (sp.maxArrayAreaMeters2 > 50) {\n\t\t\treasons.push(\n\t\t\t\t`Large roof area: ${Math.round(sp.maxArrayAreaMeters2 * 10.764)} sq ft available`,\n\t\t\t);\n\t\t\tscore += 15;\n\t\t} else if (sp.maxArrayAreaMeters2 > 25) {\n\t\t\treasons.push(\n\t\t\t\t`Adequate roof area: ${Math.round(sp.maxArrayAreaMeters2 * 10.764)} sq ft`,\n\t\t\t);\n\t\t\tscore += 5;\n\t\t} else {\n\t\t\tconcerns.push(\n\t\t\t\t`Limited roof area: ${Math.round(sp.maxArrayAreaMeters2 * 10.764)} sq ft`,\n\t\t\t);\n\t\t\tscore -= 15;\n\t\t}\n\n\t\t// Check panel capacity\n\t\tif (sp.maxArrayPanelsCount > 30) {\n\t\t\treasons.push(`Can fit ${sp.maxArrayPanelsCount} panels`);\n\t\t\tscore += 10;\n\t\t} else if (sp.maxArrayPanelsCount > 15) {\n\t\t\treasons.push(`Can fit ${sp.maxArrayPanelsCount} panels`);\n\t\t\tscore += 5;\n\t\t} else if (sp.maxArrayPanelsCount < 10) {\n\t\t\tconcerns.push(`Limited panel capacity: ${sp.maxArrayPanelsCount} panels`);\n\t\t\tscore -= 10;\n\t\t}\n\n\t\t// Check roof segments for south-facing sections\n\t\tconst segments = sp.roofSegmentStats || [];\n\t\tconst southFacing = segments.filter(\n\t\t\t(s) => s.azimuthDegrees >= 135 && s.azimuthDegrees <= 225,\n\t\t);\n\t\tif (southFacing.length > 0) {\n\t\t\treasons.push(`${southFacing.length} south-facing roof section(s)`);\n\t\t\tscore += 10;\n\t\t} else {\n\t\t\tconcerns.push(\"No south-facing roof sections\");\n\t\t\tscore -= 5;\n\t\t}\n\n\t\t// Data quality\n\t\tif (data.dataQuality === \"HIGH\") {\n\t\t\tscore += 5;\n\t\t} else if (data.dataQuality === \"LOW\") {\n\t\t\tconcerns.push(\"Limited imagery quality - estimates may be less accurate\");\n\t\t\tscore -= 5;\n\t\t}\n\n\t\t// Clamp score\n\t\tscore = Math.max(0, Math.min(100, score));\n\n\t\treturn {\n\t\t\tsuitable: score >= 50,\n\t\t\tscore,\n\t\t\treasons,\n\t\t\tconcerns,\n\t\t};\n\t}\n\n\t/**\n\t * Generate solar proposal summary for customer\n\t */\n\tgenerateProposalSummary(\n\t\tdata: SolarData,\n\t\tmonthlyBill: number,\n\t): {\n\t\theadline: string;\n\t\tsystemSize: string;\n\t\tpanelCount: number;\n\t\testimatedCost: string;\n\t\tfederalCredit: string;\n\t\tnetCost: string;\n\t\tyearlyProduction: string;\n\t\tmonthlyOffset: string;\n\t\tpaybackPeriod: string;\n\t\ttwentyYearSavings: string;\n\t\tcarbonOffset: string;\n\t\tsuitable: boolean;\n\t\tconcerns: string[];\n\t} {\n\t\tconst summary = this.getSolarSummary(data);\n\t\tconst financial = this.getFinancialAnalysis(data, monthlyBill);\n\t\tconst suitability = this.isSuitableForSolar(data);\n\n\t\tif (!summary?.hasData || !financial?.hasData) {\n\t\t\treturn {\n\t\t\t\theadline: \"Solar assessment unavailable\",\n\t\t\t\tsystemSize: \"N/A\",\n\t\t\t\tpanelCount: 0,\n\t\t\t\testimatedCost: \"N/A\",\n\t\t\t\tfederalCredit: \"N/A\",\n\t\t\t\tnetCost: \"N/A\",\n\t\t\t\tyearlyProduction: \"N/A\",\n\t\t\t\tmonthlyOffset: \"N/A\",\n\t\t\t\tpaybackPeriod: \"N/A\",\n\t\t\t\ttwentyYearSavings: \"N/A\",\n\t\t\t\tcarbonOffset: \"N/A\",\n\t\t\t\tsuitable: false,\n\t\t\t\tconcerns: [\"Solar data not available for this location\"],\n\t\t\t};\n\t\t}\n\n\t\tconst systemKw = (\n\t\t\t(financial.recommendedPanels *\n\t\t\t\t(data.buildingInsights?.solarPotential?.panelCapacityWatts || 400)) /\n\t\t\t1000\n\t\t).toFixed(1);\n\n\t\treturn {\n\t\t\theadline: suitability.suitable\n\t\t\t\t? `Great solar potential! Save up to $${financial.twentyYearSavings.toLocaleString()} over 20 years`\n\t\t\t\t: `Solar may be limited at this property`,\n\t\t\tsystemSize: `${systemKw} kW system`,\n\t\t\tpanelCount: financial.recommendedPanels,\n\t\t\testimatedCost: `$${financial.estimatedCost.toLocaleString()}`,\n\t\t\tfederalCredit: `$${financial.federalTaxCredit.toLocaleString()} (30% ITC)`,\n\t\t\tnetCost: `$${(financial.estimatedCost - financial.federalTaxCredit).toLocaleString()}`,\n\t\t\tyearlyProduction: `${financial.yearlyProduction.toLocaleString()} kWh/year`,\n\t\t\tmonthlyOffset: `$${financial.monthlyBillReduction}/month`,\n\t\t\tpaybackPeriod: `${financial.paybackYears} years`,\n\t\t\ttwentyYearSavings: `$${financial.twentyYearSavings.toLocaleString()}`,\n\t\t\tcarbonOffset: `${summary.carbonOffsetLbs.toLocaleString()} lbs CO/year`,\n\t\t\tsuitable: suitability.suitable,\n\t\t\tconcerns: suitability.concerns,\n\t\t};\n\t}\n\n\t/**\n\t * Clean up old cache entries\n\t */\n\tprivate cleanCache(): void {\n\t\tconst now = Date.now();\n\t\tfor (const [key, value] of this.cache.entries()) {\n\t\t\tif (now - value.timestamp > CACHE_TTL * 2) {\n\t\t\t\tthis.cache.delete(key);\n\t\t\t}\n\t\t}\n\n\t\tif (this.cache.size > 200) {\n\t\t\tconst entries = Array.from(this.cache.entries());\n\t\t\tentries.sort((a, b) => b[1].timestamp - a[1].timestamp);\n\t\t\tthis.cache.clear();\n\t\t\tfor (const [key, value] of entries.slice(0, 100)) {\n\t\t\t\tthis.cache.set(key, value);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Clear cache\n\t */\n\tclearCache(): void {\n\t\tthis.cache.clear();\n\t}\n}\n\n// Singleton instance\nexport const googleSolarService = new GoogleSolarService();\n"],"names":[],"mappings":"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","ignoreList":[2]}