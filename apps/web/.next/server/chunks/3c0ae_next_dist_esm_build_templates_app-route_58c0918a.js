module.exports=[448762,e=>{"use strict";var t=e.i(755535),a=e.i(377233),r=e.i(490003),n=e.i(492991),i=e.i(241970),s=e.i(357699),o=e.i(212454),d=e.i(48717),l=e.i(798301),u=e.i(986366),c=e.i(983537),p=e.i(147475),m=e.i(561930),h=e.i(803747),f=e.i(368557),_=e.i(42037),v=e.i(193695);e.i(432036);var y=e.i(573881),g=e.i(297676);e.i(16106);var b=e.i(985647),w=e.i(511368),R=e.i(273568);async function A(){try{return await (0,R.createServiceSupabaseClient)()}catch(e){return console.warn("[Schedule] Service role unavailable, falling back to authenticated client",e),await (0,w.createClient)()}}function E(e){var t;return{...e,startTime:e.startTime.toISOString(),endTime:e.endTime.toISOString(),createdAt:e.createdAt.toISOString(),updatedAt:e.updatedAt.toISOString(),customer:{...e.customer,createdAt:e.customer.createdAt.toISOString(),updatedAt:e.customer.updatedAt.toISOString()},recurrence:e.recurrence?{...t=e.recurrence,endDate:t.endDate?t.endDate.toISOString():void 0}:void 0}}Symbol.for("constructDateFrom");let S=`
  *,
  customer:customers!customer_id(
    id,
    first_name,
    last_name,
    email,
    phone,
    created_at,
    updated_at
  ),
  property:properties!property_id(
    id,
    name,
    address,
    address2,
    city,
    state,
    zip_code,
    country,
    lat,
    lon
  ),
  job_team_assignments:job_team_assignments!job_team_assignments_job_id_fkey(
    id,
    role,
    team_member_id,
    removed_at,
    team_member:team_members(
      id,
      company_id,
      status,
      job_title,
      department,
      archived_at,
      user_id,
      phone,
      email,
      invited_name,
      created_at,
      updated_at
    )
  )
`,C={workingHours:{start:"08:00",end:"17:00"},daysOff:[],availableHours:{start:0,end:40}},I={address:{street:"",city:"",state:"",zip:"",country:""},coordinates:{lat:0,lng:0}};async function j(e,t){let{data:a,error:r}=await e.from("company_memberships").select(`
			*,
			users:profiles!company_memberships_profile_id_fkey(
				id,
				full_name,
				email,
				phone,
				avatar_url
			)
		`).eq("company_id",t).eq("status","active").is("archived_at",null);return r?(console.warn("Join query failed, falling back to sequential queries:",r.message),x(e,t)):(a??[]).map(e=>({...e,users:e.users?{id:e.users.id,name:e.users.full_name,email:e.users.email,phone:e.users.phone,avatar:e.users.avatar_url}:null}))}async function x(e,t){let{data:a,error:r}=await e.from("company_memberships").select("*").eq("company_id",t).eq("status","active").is("archived_at",null);if(r)throw r;let n=Array.from(new Set((a??[]).map(e=>e.user_id).filter(e=>!!e))),i=new Map;if(n.length>0){let{data:t,error:a}=await e.from("profiles").select("id, full_name, email, phone, avatar_url").in("id",n);if(a)throw a;(t??[]).forEach(e=>{i.set(e.id,e)})}return(a??[]).map(e=>({...e,users:e.user_id?i.get(e.user_id)??null:null}))}async function T(e,t,a){let r,n,i,s=a.limit??50,o=a.offset??0,d=e.from("jobs").select(S,{count:"exact"}).eq("company_id",t).is("deleted_at",null).is("archived_at",null).is("scheduled_start",null).is("scheduled_end",null).not("status","in",'("completed","cancelled")').order("created_at",{ascending:!1}).range(o,o+s-1);if(a.search?.trim()){let e=a.search.trim().replace(/,/g,"\\,"),t=`%${e}%`;d=d.or(`title.ilike.${t},job_number.ilike.${t},description.ilike.${t}`)}try{let e=await d;r=e.data,n=e.count,i=e.error}catch(e){return console.error("[Schedule] Unscheduled jobs fetch failed:",e),{rows:[],totalCount:0,hasMore:!1}}if(i)return console.error("[Schedule] Unscheduled jobs query error:",i),{rows:[],totalCount:0,hasMore:!1};let l=r??[],u="number"==typeof n?n:l.length,c=o+l.length<u;return{rows:l,totalCount:u,hasMore:c}}async function M(e,t){let a=new Map;if(0===t.length)return a;for(let r=0;r<t.length;r+=100){let n=t.slice(r,r+100);try{let{data:t,error:r}=await e.from("properties").select("id, name, address, address2, city, state, zip_code, country, lat, lon").in("id",n);if(r){console.error("[Schedule] Properties query error:",r);continue}(t??[]).forEach(e=>a.set(e.id,e))}catch(e){console.error(`[Schedule] Failed to fetch properties chunk ${r/100+1}:`,e)}}return a}async function O({supabase:e,companyId:t,limit:a=50,offset:r=0,search:n=""}){var i,s;let o,d,l,u,c,p=(i=await j(e,t),o=[],d=new Map,l=new Map,u=new Map,i.forEach(e=>{let t=e.user_id??e.id;if(!t)return;let a=e.users,r={id:t,userId:e.user_id??void 0,teamMemberId:e.id,name:a?.name||e.invited_name||e.job_title||"Team Member",email:a?.email||e.email||void 0,phone:a?.phone||e.phone||void 0,avatar:a?.avatar||void 0,role:e.job_title||e.role||"Team Member",department:e.department||void 0,status:"active"===e.status?"available":"offline",isActive:"active"===e.status&&!e.archived_at,schedule:{...C},color:"#3B82F6",createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)};o.push(r),d.set(r.id,r),r.userId&&l.set(r.userId,r),r.teamMemberId&&u.set(r.teamMemberId,r)}),{technicians:o,byId:d,byUserId:l,byTeamMemberId:u}),{rows:m,totalCount:h,hasMore:f}=await T(e,t,{limit:a,offset:r,search:n}),_=await M(e,(s=[],c=new Set,s.forEach(e=>{e.property_id&&c.add(e.property_id)}),m.forEach(e=>{e.property_id&&c.add(e.property_id)}),Array.from(c)));return{jobs:m.map(e=>{var t,a,r,n,i;let s,o,d,l,u,c,m,h;return s=(t=_.get(e.property_id??"")??null)?{address:{street:t.address||t.address2||t.name||"",city:t.city||"",state:t.state||"",zip:t.zip_code||"",country:t.country||""},coordinates:{lat:t.lat||0,lng:t.lon||0}}:{...I},a=e,r=s.address.street,c=Array.isArray(n=a.customer)?n[0]??null:n??null,m=[c?.first_name?.trim()??"",c?.last_name?.trim()??""].filter(Boolean).join(" ").trim(),o={id:c?.id||a.customer_id||`customer-${a.id}`,name:m||a.title||"Unspecified Customer",email:c?.email||void 0,phone:c?.phone||void 0,location:{...I,address:{...I.address,street:r}},createdAt:new Date(c?.created_at??a.created_at),updatedAt:new Date(c?.updated_at??a.updated_at)},d=function(e,t){var a;let r,n=[];if(e.assigned_to){let a=t.byUserId.get(e.assigned_to)||t.byId.get(e.assigned_to);n.push({technicianId:null,teamMemberId:a?.teamMemberId,displayName:a?.name||"Primary Technician",avatar:a?.avatar??null,role:"primary",status:a?.status??"available",isActive:a?.isActive??!0})}return(Array.isArray(e.job_team_assignments)?e.job_team_assignments:e.job_team_assignments?[e.job_team_assignments]:[]).filter(e=>!e.removed_at).forEach(e=>{let a=e.team_member;if(!a)return;let r=a.user_id&&t.byUserId.get(a.user_id)||t.byTeamMemberId.get(a.id);n.push({technicianId:null,teamMemberId:a.id,displayName:r?.name||a.invited_name||a.job_title||"Crew Member",avatar:r?.avatar??null,role:e.role||"crew",status:r?.status??("active"===a.status?"available":"offline"),isActive:r?.isActive??"active"===a.status})}),a=n,r=new Set,a.filter(e=>{let t=`${e.role}-${e.technicianId??e.teamMemberId??""}`;return!r.has(t)&&(r.add(t),!0)})}(e,p),l=new Date(e.scheduled_start?e.scheduled_start:e.created_at),u=new Date(e.scheduled_end?e.scheduled_end:l.getTime()+36e5),{id:e.id,jobId:e.id,technicianId:"",assignments:d,isUnassigned:!0,title:e.title||e.job_number||"Job",description:e.description||void 0,jobType:e.job_type||void 0,customer:o,location:s,startTime:l,endTime:u,status:function(e){if(!e)return"scheduled";let t=e.toLowerCase();switch(t){case"scheduled":case"dispatched":case"arrived":case"closed":case"cancelled":return t;case"in-progress":case"in_progress":case"inprogress":return"in-progress";case"completed":case"complete":case"done":return"completed";default:return"scheduled"}}(e.status),priority:function(e){if(!e)return"medium";let t=e.toLowerCase();switch(t){case"low":case"medium":case"high":case"urgent":return t;case"critical":case"emergency":return"urgent";default:return"medium"}}(e.priority),metadata:(h={...(i=e).metadata&&"object"==typeof i.metadata?i.metadata:{}},i.notes&&(h.notes=i.notes),h),createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}),meta:{limit:a,nextOffset:r+m.length,hasMore:f,search:n,totalCount:h}}}async function N(e){try{let t=await e.json().catch(()=>({})),a="string"==typeof t?.search?t.search:"",r="number"==typeof t?.limit&&t.limit>0?t.limit:void 0,n="number"==typeof t?.offset&&t.offset>=0?t.offset:0,i=await (0,b.getActiveCompanyId)();if(!i)return g.NextResponse.json({error:"No active company selected"},{status:401});let s=await A();if(!s)return g.NextResponse.json({error:"Database unavailable"},{status:500});let{jobs:o,meta:d}=await O({supabase:s,companyId:i,limit:r,offset:n,search:a});return g.NextResponse.json({jobs:o.map(E),meta:d})}catch(e){return console.error("[Schedule] Failed to load additional unscheduled jobs",e),g.NextResponse.json({error:e instanceof Error?e.message:"Unable to load unscheduled jobs"},{status:500})}}e.s(["POST",()=>N],162855);var D=e.i(162855);let P=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/schedule/unscheduled/route",pathname:"/api/schedule/unscheduled",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/schedule/unscheduled/route.ts",nextConfigOutput:"",userland:D}),{workAsyncStorage:q,workUnitAsyncStorage:k,serverHooks:U}=P;function H(){return(0,r.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:k})}async function $(e,t,r){P.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let g="/api/schedule/unscheduled/route";g=g.replace(/\/index$/,"")||"/";let b=await P.prepare(e,t,{srcPage:g,multiZoneDraftMode:!1});if(!b)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:w,params:R,nextConfig:A,parsedUrl:E,isDraftMode:S,prerenderManifest:C,routerServerContext:I,isOnDemandRevalidate:j,revalidateOnlyGenerated:x,resolvedPathname:T,clientReferenceManifest:M,serverActionsManifest:O}=b,N=(0,d.normalizeAppPath)(g),D=!!(C.dynamicRoutes[N]||C.routes[T]),q=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,E,!1):t.end("This page could not be found"),null);if(D&&!S){let e=!!C.routes[T],t=C.dynamicRoutes[N];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await q();throw new v.NoFallbackError}}let k=null;!D||P.isDev||S||(k="/index"===(k=T)?"/":k);let U=!0===P.isDev||!D,H=D&&!U;O&&M&&(0,s.setReferenceManifestsSingleton)({page:g,clientReferenceManifest:M,serverActionsManifest:O,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:O})});let $=e.method||"GET",F=(0,i.getTracer)(),K=F.getActiveScopeSpan(),B={params:R,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>P.onRequestError(e,t,r,I)},sharedContext:{buildId:w}},L=new l.NodeNextRequest(e),z=new l.NodeNextResponse(t),G=u.NextRequestAdapter.fromNodeNextRequest(L,(0,u.signalFromNodeResponse)(t));try{let s=async e=>P.handle(G,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=F.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${$} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${$} ${g}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),d=async n=>{var i,d;let l=async({previousCacheEntry:a})=>{try{if(!o&&j&&x&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(n);e.fetchMetrics=B.renderOpts.fetchMetrics;let d=B.renderOpts.pendingWaitUntil;d&&r.waitUntil&&(r.waitUntil(d),d=void 0);let l=B.renderOpts.collectedTags;if(!D)return await (0,m.sendResponse)(L,z,i,B.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(i.headers);l&&(t[_.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=_.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,r=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=_.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await P.onRequestError(e,t,{routerKind:"App Router",routePath:g,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:j})},I),t}},u=await P.handleResponse({req:e,nextConfig:A,cacheKey:k,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:j,revalidateOnlyGenerated:x,responseGenerator:l,waitUntil:r.waitUntil,isMinimalMode:o});if(!D)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",j?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&D||c.delete(_.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)(L,z,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};K?await d(K):await F.withPropagatedContext(e.headers,()=>F.trace(c.BaseServerSpan.handleRequest,{spanName:`${$} ${g}`,kind:i.SpanKind.SERVER,attributes:{"http.method":$,"http.target":e.url}},d))}catch(t){if(t instanceof v.NoFallbackError||await P.onRequestError(e,t,{routerKind:"App Router",routePath:N,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:j})}),D)throw t;return await (0,m.sendResponse)(L,z,new Response(null,{status:500})),null}}e.s(["handler",()=>$,"patchFetch",()=>H,"routeModule",()=>P,"serverHooks",()=>U,"workAsyncStorage",()=>q,"workUnitAsyncStorage",()=>k],448762)}];

//# sourceMappingURL=3c0ae_next_dist_esm_build_templates_app-route_58c0918a.js.map