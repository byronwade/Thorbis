module.exports=[849797,356622,266299,e=>{"use strict";var t=e.i(443608);let o="Thorbis-FMS/1.0 (support@thorbis.app)",r=t.z.object({code:t.z.string(),description:t.z.string(),icon:t.z.string()}),n=t.z.object({temperature:t.z.number(),temperatureFeelsLike:t.z.number(),humidity:t.z.number(),pressure:t.z.number(),windSpeed:t.z.number(),windDirection:t.z.number(),windGust:t.z.number().optional(),visibility:t.z.number().optional(),uvIndex:t.z.number().optional(),cloudCover:t.z.number().optional(),precipitation:t.z.number().optional(),condition:r,observationTime:t.z.string()}),i=t.z.object({time:t.z.string(),temperature:t.z.number(),temperatureFeelsLike:t.z.number(),humidity:t.z.number(),windSpeed:t.z.number(),windDirection:t.z.number(),precipitationProbability:t.z.number(),precipitationAmount:t.z.number().optional(),condition:r,uvIndex:t.z.number().optional(),solarRadiation:t.z.number().optional()}),a=t.z.object({date:t.z.string(),temperatureHigh:t.z.number(),temperatureLow:t.z.number(),humidity:t.z.number(),windSpeed:t.z.number(),windDirection:t.z.number(),precipitationProbability:t.z.number(),precipitationAmount:t.z.number().optional(),condition:r,uvIndexMax:t.z.number().optional(),sunrise:t.z.string().optional(),sunset:t.z.string().optional(),moonPhase:t.z.string().optional(),solarRadiation:t.z.number().optional()}),l=t.z.object({event:t.z.string(),headline:t.z.string(),description:t.z.string(),severity:t.z.enum(["Extreme","Severe","Moderate","Minor","Unknown"]),urgency:t.z.enum(["Immediate","Expected","Future","Past","Unknown"]),start:t.z.string().optional(),end:t.z.string().optional(),instruction:t.z.string().optional(),source:t.z.string().optional()});t.z.object({location:t.z.object({lat:t.z.number(),lng:t.z.number(),name:t.z.string().optional(),timezone:t.z.string().optional()}),current:n.optional(),hourly:t.z.array(i).optional(),daily:t.z.array(a).optional(),alerts:t.z.array(l),source:t.z.enum(["google","nws","openmeteo"]),enrichedAt:t.z.string()});class s{apiKey;cache=new Map;constructor(){this.apiKey=process.env.GOOGLE_API_KEY||"AIzaSyCVKN0pddG230vvjT0EMP9sSIR31j1q2t0"}isAvailable(){return!!this.apiKey}async getWeatherData(e,t){let o=`weather:${e.toFixed(4)},${t.toFixed(4)}`,r=this.cache.get(o);if(r&&Date.now()-r.timestamp<18e5)return r.data;try{let r=await this.fetchFromOpenMeteo(e,t);if(r)return this.cache.set(o,{data:r,timestamp:Date.now()}),this.cleanCache(),r;if(this.isUSLocation(e,t)){let r=await this.fetchFromNWS(e,t);if(r)return this.cache.set(o,{data:r,timestamp:Date.now()}),r}return null}catch(e){return console.error("Weather service error:",e),null}}async fetchFromOpenMeteo(e,t){try{let r=new URL("https://api.open-meteo.com/v1/forecast");r.searchParams.set("latitude",e.toString()),r.searchParams.set("longitude",t.toString()),r.searchParams.set("current","temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,cloud_cover,pressure_msl,wind_speed_10m,wind_direction_10m,wind_gusts_10m,uv_index"),r.searchParams.set("hourly","temperature_2m,relative_humidity_2m,apparent_temperature,precipitation_probability,precipitation,weather_code,wind_speed_10m,wind_direction_10m,uv_index,direct_radiation"),r.searchParams.set("daily","weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,precipitation_probability_max,wind_speed_10m_max,wind_direction_10m_dominant,uv_index_max,sunrise,sunset"),r.searchParams.set("timezone","auto"),r.searchParams.set("forecast_days","10");let n=await fetch(r.toString(),{headers:{"User-Agent":o}});if(!n.ok)return console.error(`Open-Meteo API error: ${n.status}`),null;let i=await n.json(),a={temperature:i.current.temperature_2m,temperatureFeelsLike:i.current.apparent_temperature,humidity:i.current.relative_humidity_2m,pressure:i.current.pressure_msl,windSpeed:i.current.wind_speed_10m/3.6,windDirection:i.current.wind_direction_10m,windGust:i.current.wind_gusts_10m?i.current.wind_gusts_10m/3.6:void 0,uvIndex:i.current.uv_index,cloudCover:i.current.cloud_cover,precipitation:i.current.precipitation,condition:this.getConditionFromCode(i.current.weather_code),observationTime:i.current.time},l=[],s=Math.min(48,i.hourly.time.length);for(let e=0;e<s;e++)l.push({time:i.hourly.time[e],temperature:i.hourly.temperature_2m[e],temperatureFeelsLike:i.hourly.apparent_temperature[e],humidity:i.hourly.relative_humidity_2m[e],windSpeed:i.hourly.wind_speed_10m[e]/3.6,windDirection:i.hourly.wind_direction_10m[e],precipitationProbability:i.hourly.precipitation_probability[e],precipitationAmount:i.hourly.precipitation[e],condition:this.getConditionFromCode(i.hourly.weather_code[e]),uvIndex:i.hourly.uv_index[e],solarRadiation:i.hourly.direct_radiation?.[e]});let c=[];for(let e=0;e<i.daily.time.length;e++)c.push({date:i.daily.time[e],temperatureHigh:i.daily.temperature_2m_max[e],temperatureLow:i.daily.temperature_2m_min[e],humidity:0,windSpeed:i.daily.wind_speed_10m_max[e]/3.6,windDirection:i.daily.wind_direction_10m_dominant[e],precipitationProbability:i.daily.precipitation_probability_max[e],precipitationAmount:i.daily.precipitation_sum[e],condition:this.getConditionFromCode(i.daily.weather_code[e]),uvIndexMax:i.daily.uv_index_max[e],sunrise:i.daily.sunrise[e],sunset:i.daily.sunset[e]});return{location:{lat:e,lng:t,timezone:i.timezone},current:a,hourly:l,daily:c,alerts:[],source:"openmeteo",enrichedAt:new Date().toISOString()}}catch(e){return console.error("Open-Meteo fetch error:",e),null}}async fetchFromNWS(e,t){try{let r=await fetch(`https://api.weather.gov/points/${e.toFixed(4)},${t.toFixed(4)}`,{headers:{"User-Agent":o,Accept:"application/geo+json"}});if(!r.ok)return null;let n=(await r.json()).properties,[i,a]=await Promise.all([fetch(n.forecast,{headers:{"User-Agent":o,Accept:"application/geo+json"}}),fetch(`https://api.weather.gov/alerts/active?point=${e},${t}`,{headers:{"User-Agent":o,Accept:"application/geo+json"}})]),l=i.ok?await i.json():null,s=a.ok?await a.json():null,c=(s?.features||[]).map(e=>({event:e.properties.event||"Unknown",headline:e.properties.headline||"",description:e.properties.description||"",severity:this.mapNWSSeverity(e.properties.severity),urgency:this.mapNWSUrgency(e.properties.urgency),start:e.properties.onset,end:e.properties.expires,instruction:e.properties.instruction,source:"NWS"})),d=[];if(l?.properties?.periods){let e=l.properties.periods;for(let t=0;t<e.length;t+=2){let o=e[t],r=e[t+1];d.push({date:o.startTime.split("T")[0],temperatureHigh:o.isDaytime?o.temperature:r?.temperature||o.temperature,temperatureLow:r?.temperature||o.temperature,humidity:0,windSpeed:this.parseWindSpeed(o.windSpeed),windDirection:this.parseWindDirection(o.windDirection),precipitationProbability:0,condition:this.mapNWSCondition(o.shortForecast),uvIndexMax:void 0})}}return{location:{lat:e,lng:t,name:n.relativeLocation?.properties?.city,timezone:n.timeZone},daily:d,alerts:c,source:"nws",enrichedAt:new Date().toISOString()}}catch(e){return console.error("NWS fetch error:",e),null}}getConditionFromCode(e){return({0:{code:"CLEAR",description:"Clear sky",icon:"01d"},1:{code:"MOSTLY_CLEAR",description:"Mostly clear",icon:"02d"},2:{code:"PARTLY_CLOUDY",description:"Partly cloudy",icon:"03d"},3:{code:"OVERCAST",description:"Overcast",icon:"04d"},45:{code:"FOG",description:"Foggy",icon:"50d"},48:{code:"FOG",description:"Freezing fog",icon:"50d"},51:{code:"DRIZZLE",description:"Light drizzle",icon:"09d"},53:{code:"DRIZZLE",description:"Moderate drizzle",icon:"09d"},55:{code:"DRIZZLE",description:"Dense drizzle",icon:"09d"},56:{code:"FREEZING_DRIZZLE",description:"Freezing drizzle",icon:"09d"},57:{code:"FREEZING_DRIZZLE",description:"Dense freezing drizzle",icon:"09d"},61:{code:"RAIN",description:"Light rain",icon:"10d"},63:{code:"RAIN",description:"Moderate rain",icon:"10d"},65:{code:"RAIN",description:"Heavy rain",icon:"10d"},66:{code:"FREEZING_RAIN",description:"Freezing rain",icon:"13d"},67:{code:"FREEZING_RAIN",description:"Heavy freezing rain",icon:"13d"},71:{code:"SNOW",description:"Light snow",icon:"13d"},73:{code:"SNOW",description:"Moderate snow",icon:"13d"},75:{code:"SNOW",description:"Heavy snow",icon:"13d"},77:{code:"SNOW_GRAINS",description:"Snow grains",icon:"13d"},80:{code:"RAIN_SHOWERS",description:"Light rain showers",icon:"09d"},81:{code:"RAIN_SHOWERS",description:"Moderate rain showers",icon:"09d"},82:{code:"RAIN_SHOWERS",description:"Heavy rain showers",icon:"09d"},85:{code:"SNOW_SHOWERS",description:"Light snow showers",icon:"13d"},86:{code:"SNOW_SHOWERS",description:"Heavy snow showers",icon:"13d"},95:{code:"THUNDERSTORM",description:"Thunderstorm",icon:"11d"},96:{code:"THUNDERSTORM",description:"Thunderstorm with hail",icon:"11d"},99:{code:"THUNDERSTORM",description:"Severe thunderstorm",icon:"11d"}})[e]||{code:"UNKNOWN",description:"Unknown",icon:"03d"}}mapNWSCondition(e){let t=e.toLowerCase();return t.includes("thunder")?{code:"THUNDERSTORM",description:e,icon:"11d"}:t.includes("snow")?{code:"SNOW",description:e,icon:"13d"}:t.includes("rain")||t.includes("showers")?{code:"RAIN",description:e,icon:"10d"}:t.includes("cloudy")||t.includes("overcast")?{code:"CLOUDY",description:e,icon:"04d"}:t.includes("partly")?{code:"PARTLY_CLOUDY",description:e,icon:"03d"}:t.includes("clear")||t.includes("sunny")?{code:"CLEAR",description:e,icon:"01d"}:{code:"UNKNOWN",description:e,icon:"03d"}}mapNWSSeverity(e){switch(e?.toLowerCase()){case"extreme":return"Extreme";case"severe":return"Severe";case"moderate":return"Moderate";case"minor":return"Minor";default:return"Unknown"}}mapNWSUrgency(e){switch(e?.toLowerCase()){case"immediate":return"Immediate";case"expected":return"Expected";case"future":return"Future";case"past":return"Past";default:return"Unknown"}}parseWindSpeed(e){let t=e.match(/(\d+)\s*(?:to\s*(\d+))?\s*mph/i);if(t){let e=parseInt(t[1]),o=t[2]?parseInt(t[2]):e;return(e+o)/2*.44704}return 0}parseWindDirection(e){return({N:0,NNE:22.5,NE:45,ENE:67.5,E:90,ESE:112.5,SE:135,SSE:157.5,S:180,SSW:202.5,SW:225,WSW:247.5,W:270,WNW:292.5,NW:315,NNW:337.5})[e.toUpperCase()]||0}isUSLocation(e,t){return e>=24.5&&e<=49.5&&t>=-125&&t<=-66.9||e>=51&&e<=71.5&&t>=-180&&t<=-130||e>=18.5&&e<=22.5&&t>=-161&&t<=-154}isSuitableForOutdoorWork(e){let t=e.alerts.filter(e=>"Extreme"===e.severity||"Severe"===e.severity);if(t.length>0)return{suitable:!1,reason:t[0].headline||t[0].event,severity:"high"};if(e.current){let{condition:t,temperature:o,windSpeed:r}=e.current;if("THUNDERSTORM"===t.code||t.code.includes("FREEZING"))return{suitable:!1,reason:t.description,severity:"high"};if(o<-10)return{suitable:!1,reason:"Extreme cold (-10°C or below)",severity:"high"};if(o>40)return{suitable:!1,reason:"Extreme heat (40°C or above)",severity:"high"};if(r>20)return{suitable:!1,reason:"High winds",severity:"medium"};if("RAIN"===t.code||"SNOW"===t.code)return{suitable:!0,reason:t.description,severity:"medium"};if(o<0||o>35)return{suitable:!0,reason:`Temperature: ${Math.round(o)}\xb0C`,severity:"low"}}return{suitable:!0,severity:"none"}}getWeatherSummary(e){let t=e.current,o=this.isSuitableForOutdoorWork(e);return{temperature:t?`${Math.round(t.temperature)}\xb0C / ${Math.round(1.8*t.temperature+32)}\xb0F`:"N/A",condition:t?.condition.description||"Unknown",icon:t?.condition.icon||"03d",feelsLike:t?`${Math.round(t.temperatureFeelsLike)}\xb0C`:"N/A",humidity:t?`${Math.round(t.humidity)}%`:"N/A",wind:t?`${Math.round(2.237*t.windSpeed)} mph`:"N/A",alerts:e.alerts.length,suitableForWork:o.suitable}}cleanCache(){let e=Date.now();for(let[t,o]of this.cache.entries())e-o.timestamp>36e5&&this.cache.delete(t);if(this.cache.size>100){let e=Array.from(this.cache.entries());for(let[t,o]of(e.sort((e,t)=>t[1].timestamp-e[1].timestamp),this.cache.clear(),e.slice(0,50)))this.cache.set(t,o)}}clearCache(){this.cache.clear()}}let c=new s;e.s(["googleWeatherService",0,c],849797);let d="Thorbis-FMS/1.0 (support@thorbis.app)",u=t.z.object({code:t.z.string(),displayName:t.z.string(),concentration:t.z.object({value:t.z.number(),units:t.z.string()}),additionalInfo:t.z.object({sources:t.z.string().optional(),effects:t.z.string().optional()}).optional()}),p=t.z.object({code:t.z.string(),displayName:t.z.string(),aqi:t.z.number(),category:t.z.string(),color:t.z.object({red:t.z.number(),green:t.z.number(),blue:t.z.number()}).optional(),dominantPollutant:t.z.string().optional()}),m=t.z.object({generalPopulation:t.z.string().optional(),elderly:t.z.string().optional(),lungDiseasePopulation:t.z.string().optional(),heartDiseasePopulation:t.z.string().optional(),athletes:t.z.string().optional(),pregnantWomen:t.z.string().optional(),children:t.z.string().optional()});t.z.object({location:t.z.object({lat:t.z.number(),lng:t.z.number()}),dateTime:t.z.string(),regionCode:t.z.string().optional(),indexes:t.z.array(p),pollutants:t.z.array(u),healthRecommendations:m.optional(),source:t.z.enum(["google","airnow","openaq"]),enrichedAt:t.z.string()}),t.z.object({dateTime:t.z.string(),indexes:t.z.array(p),pollutants:t.z.array(u).optional()});class h{apiKey;cache=new Map;constructor(){this.apiKey=process.env.GOOGLE_API_KEY||"AIzaSyCVKN0pddG230vvjT0EMP9sSIR31j1q2t0"}isAvailable(){return!!this.apiKey}async getAirQuality(e,t){let o=`aq:${e.toFixed(4)},${t.toFixed(4)}`,r=this.cache.get(o);if(r&&Date.now()-r.timestamp<36e5)return r.data;if(this.apiKey){let r=await this.fetchFromGoogle(e,t);if(r)return this.cache.set(o,{data:r,timestamp:Date.now()}),this.cleanCache(),r}let n=await this.fetchFromOpenMeteo(e,t);return n?(this.cache.set(o,{data:n,timestamp:Date.now()}),this.cleanCache(),n):null}async fetchFromGoogle(e,t){try{let o=`https://airquality.googleapis.com/v1/currentConditions:lookup?key=${this.apiKey}`,r=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":d},body:JSON.stringify({location:{latitude:e,longitude:t},extraComputations:["HEALTH_RECOMMENDATIONS","DOMINANT_POLLUTANT_CONCENTRATION","POLLUTANT_CONCENTRATION","LOCAL_AQI","POLLUTANT_ADDITIONAL_INFO"],languageCode:"en"})});if(!r.ok)return console.error(`Google Air Quality API error: ${r.status}`),null;let n=await r.json(),i=(n.indexes||[]).map(e=>({code:e.code||"unknown",displayName:e.displayName||"Air Quality Index",aqi:e.aqi||0,category:e.category||"Unknown",color:e.color,dominantPollutant:e.dominantPollutant})),a=(n.pollutants||[]).map(e=>({code:e.code||"unknown",displayName:e.displayName||e.code,concentration:{value:e.concentration?.value||0,units:e.concentration?.units||"μg/m³"},additionalInfo:e.additionalInfo})),l=n.healthRecommendations,s=l?{generalPopulation:l.generalPopulation,elderly:l.elderly,lungDiseasePopulation:l.lungDiseasePopulation,heartDiseasePopulation:l.heartDiseasePopulation,athletes:l.athletes,pregnantWomen:l.pregnantWomen,children:l.children}:void 0;return{location:{lat:e,lng:t},dateTime:n.dateTime||new Date().toISOString(),regionCode:n.regionCode,indexes:i,pollutants:a,healthRecommendations:s,source:"google",enrichedAt:new Date().toISOString()}}catch(e){return console.error("Google Air Quality fetch error:",e),null}}async fetchFromOpenMeteo(e,t){try{let o=new URL("https://air-quality-api.open-meteo.com/v1/air-quality");o.searchParams.set("latitude",e.toString()),o.searchParams.set("longitude",t.toString()),o.searchParams.set("current","us_aqi,pm10,pm2_5,carbon_monoxide,nitrogen_dioxide,sulphur_dioxide,ozone");let r=await fetch(o.toString(),{headers:{"User-Agent":d}});if(!r.ok)return console.error(`Open-Meteo Air Quality API error: ${r.status}`),null;let n=(await r.json()).current;if(!n)return null;let i=n.us_aqi||0,a=this.getAQICategory(i),l=[{code:"us-epa",displayName:"US EPA AQI",aqi:i,category:a.name,color:a.color,dominantPollutant:this.getDominantPollutant(n)}],s=[{code:"PM25",displayName:"PM2.5",concentration:{value:n.pm2_5||0,units:"μg/m³"}},{code:"PM10",displayName:"PM10",concentration:{value:n.pm10||0,units:"μg/m³"}},{code:"O3",displayName:"Ozone",concentration:{value:n.ozone||0,units:"μg/m³"}},{code:"NO2",displayName:"Nitrogen Dioxide",concentration:{value:n.nitrogen_dioxide||0,units:"μg/m³"}},{code:"SO2",displayName:"Sulfur Dioxide",concentration:{value:n.sulphur_dioxide||0,units:"μg/m³"}},{code:"CO",displayName:"Carbon Monoxide",concentration:{value:n.carbon_monoxide||0,units:"μg/m³"}}].filter(e=>e.concentration.value>0);return{location:{lat:e,lng:t},dateTime:n.time||new Date().toISOString(),indexes:l,pollutants:s,healthRecommendations:{generalPopulation:a.recommendation},source:"openaq",enrichedAt:new Date().toISOString()}}catch(e){return console.error("Open-Meteo Air Quality fetch error:",e),null}}async getAirQualityForecast(e,t){try{let o=new URL("https://air-quality-api.open-meteo.com/v1/air-quality");o.searchParams.set("latitude",e.toString()),o.searchParams.set("longitude",t.toString()),o.searchParams.set("hourly","us_aqi,pm10,pm2_5,ozone,nitrogen_dioxide"),o.searchParams.set("forecast_days","5");let r=await fetch(o.toString(),{headers:{"User-Agent":d}});if(!r.ok)return null;let n=(await r.json()).hourly;if(!n?.time)return null;let i=[];for(let e=0;e<n.time.length;e++){let t=n.us_aqi?.[e]||0,o=this.getAQICategory(t);i.push({dateTime:n.time[e],indexes:[{code:"us-epa",displayName:"US EPA AQI",aqi:t,category:o.name,color:o.color}],pollutants:[{code:"PM25",displayName:"PM2.5",concentration:{value:n.pm2_5?.[e]||0,units:"μg/m³"}},{code:"PM10",displayName:"PM10",concentration:{value:n.pm10?.[e]||0,units:"μg/m³"}},{code:"O3",displayName:"Ozone",concentration:{value:n.ozone?.[e]||0,units:"μg/m³"}}]})}return i}catch(e){return console.error("Air quality forecast fetch error:",e),null}}getAQICategory(e){return e<=50?{name:"Good",color:{red:0,green:228,blue:0},recommendation:"Air quality is satisfactory. Enjoy outdoor activities."}:e<=100?{name:"Moderate",color:{red:255,green:255,blue:0},recommendation:"Air quality is acceptable. Unusually sensitive individuals should consider limiting prolonged outdoor exertion."}:e<=150?{name:"Unhealthy for Sensitive Groups",color:{red:255,green:126,blue:0},recommendation:"Members of sensitive groups may experience health effects. The general public is less likely to be affected."}:e<=200?{name:"Unhealthy",color:{red:255,green:0,blue:0},recommendation:"Everyone may begin to experience health effects. Members of sensitive groups may experience more serious health effects."}:e<=300?{name:"Very Unhealthy",color:{red:143,green:63,blue:151},recommendation:"Health alert: everyone may experience more serious health effects. Consider rescheduling outdoor work."}:{name:"Hazardous",color:{red:126,green:0,blue:35},recommendation:"Health emergency: reschedule all outdoor work immediately."}}getDominantPollutant(e){let t=[{code:"PM25",value:e.pm2_5||0,threshold:12},{code:"PM10",value:e.pm10||0,threshold:54},{code:"O3",value:e.ozone||0,threshold:100},{code:"NO2",value:e.nitrogen_dioxide||0,threshold:100}],o=t[0],r=0;for(let e of t){let t=e.value/e.threshold;t>r&&(r=t,o=e)}return o.code}isSuitableForOutdoorWork(e){let t=e.indexes.find(e=>"us-epa"===e.code),o=t?.aqi||0;return o>200?{suitable:!1,reason:`Very Unhealthy air quality (AQI: ${o})`,severity:"high"}:o>150?{suitable:!1,reason:`Unhealthy air quality (AQI: ${o})`,severity:"medium"}:o>100?{suitable:!0,reason:`Unhealthy for sensitive groups (AQI: ${o})`,severity:"low"}:{suitable:!0,severity:"none"}}getAirQualitySummary(e){let t=e.indexes.find(e=>"us-epa"===e.code)||e.indexes[0],o=e.pollutants.find(e=>"PM25"===e.code),r=this.isSuitableForOutdoorWork(e);return{aqi:t?.aqi||0,category:t?.category||"Unknown",color:t?.color?`rgb(${t.color.red},${t.color.green},${t.color.blue})`:"#808080",dominantPollutant:t?.dominantPollutant||"PM2.5",pm25:o?.concentration.value||0,recommendation:e.healthRecommendations?.generalPopulation||"No recommendations",suitableForWork:r.suitable}}getHVACFilterRecommendation(e){let t=e.pollutants.find(e=>"PM25"===e.code),o=t?.concentration.value||0,r=e.indexes.find(e=>"us-epa"===e.code),n=r?.aqi||0;return n>150||o>35?{shouldReplace:!0,urgency:"urgent",reason:"Poor air quality detected in area",upsellMessage:"Consider upgrading to a HEPA filter for better protection against high PM2.5 levels."}:n>100||o>25?{shouldReplace:!0,urgency:"soon",reason:"Moderate air quality - filters working harder",upsellMessage:"Air quality in this area is moderate. A higher-rated filter (MERV 11+) can provide better filtration."}:n>50||o>12?{shouldReplace:!1,urgency:"normal",reason:"Air quality is acceptable"}:{shouldReplace:!1,urgency:"normal",reason:"Air quality is good"}}cleanCache(){let e=Date.now();for(let[t,o]of this.cache.entries())e-o.timestamp>72e5&&this.cache.delete(t)}clearCache(){this.cache.clear()}}let g=new h;e.s(["googleAirQualityService",0,g],356622);let y="Thorbis-FMS/1.0 (support@thorbis.app)",f=t.z.object({code:t.z.string(),displayName:t.z.string(),indexInfo:t.z.object({code:t.z.string(),displayName:t.z.string(),value:t.z.number(),category:t.z.string(),indexDescription:t.z.string().optional(),color:t.z.object({red:t.z.number(),green:t.z.number(),blue:t.z.number()}).optional()}),healthRecommendations:t.z.array(t.z.string()).optional(),inSeason:t.z.boolean()}),z=t.z.object({code:t.z.string(),displayName:t.z.string(),indexInfo:t.z.object({value:t.z.number(),category:t.z.string()}),plantDescription:t.z.object({type:t.z.string(),family:t.z.string().optional(),season:t.z.string().optional(),crossReaction:t.z.string().optional()}).optional(),inSeason:t.z.boolean()}),v=t.z.object({date:t.z.string(),pollenTypes:t.z.array(f),plants:t.z.array(z).optional()});t.z.object({location:t.z.object({lat:t.z.number(),lng:t.z.number()}),regionCode:t.z.string().optional(),dailyInfo:t.z.array(v),source:t.z.enum(["google","openmeteo"]),enrichedAt:t.z.string()});class b{apiKey;cache=new Map;constructor(){this.apiKey=process.env.GOOGLE_API_KEY||"AIzaSyCVKN0pddG230vvjT0EMP9sSIR31j1q2t0"}isAvailable(){return!!this.apiKey}async getPollenData(e,t){let o=`pollen:${e.toFixed(3)},${t.toFixed(3)}`,r=this.cache.get(o);if(r&&Date.now()-r.timestamp<216e5)return r.data;if(this.apiKey){let r=await this.fetchFromGoogle(e,t);if(r)return this.cache.set(o,{data:r,timestamp:Date.now()}),this.cleanCache(),r}let n=await this.fetchFromOpenMeteo(e,t);return n?(this.cache.set(o,{data:n,timestamp:Date.now()}),this.cleanCache(),n):null}async fetchFromGoogle(e,t){try{let o=`https://pollen.googleapis.com/v1/forecast:lookup?key=${this.apiKey}`,r=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":y},body:JSON.stringify({location:{latitude:e,longitude:t},days:5,languageCode:"en",plantsDescription:!0})});if(!r.ok)return console.error(`Google Pollen API error: ${r.status}`),null;let n=await r.json();if(!n.dailyInfo)return null;let i=n.dailyInfo.map(e=>{let t=(e.pollenTypeInfo||[]).map(e=>({code:e.code||"UNKNOWN",displayName:e.displayName||e.code,indexInfo:{code:e.indexInfo?.code||"UPI",displayName:e.indexInfo?.displayName||"Universal Pollen Index",value:e.indexInfo?.value||0,category:e.indexInfo?.category||"None",indexDescription:e.indexInfo?.indexDescription,color:e.indexInfo?.color},healthRecommendations:e.healthRecommendations,inSeason:e.inSeason||!1})),o=(e.plantInfo||[]).map(e=>({code:e.code||"UNKNOWN",displayName:e.displayName||e.code,indexInfo:{value:e.indexInfo?.value||0,category:e.indexInfo?.category||"None"},plantDescription:e.plantDescription,inSeason:e.inSeason||!1}));return{date:e.date?.year?`${e.date.year}-${String(e.date.month).padStart(2,"0")}-${String(e.date.day).padStart(2,"0")}`:new Date().toISOString().split("T")[0],pollenTypes:t,plants:o.length>0?o:void 0}});return{location:{lat:e,lng:t},regionCode:n.regionCode,dailyInfo:i,source:"google",enrichedAt:new Date().toISOString()}}catch(e){return console.error("Google Pollen fetch error:",e),null}}async fetchFromOpenMeteo(e,t){try{let o=new URL("https://air-quality-api.open-meteo.com/v1/air-quality");o.searchParams.set("latitude",e.toString()),o.searchParams.set("longitude",t.toString()),o.searchParams.set("hourly","alder_pollen,birch_pollen,grass_pollen,mugwort_pollen,olive_pollen,ragweed_pollen"),o.searchParams.set("forecast_days","5");let r=await fetch(o.toString(),{headers:{"User-Agent":y}});if(!r.ok)return null;let n=(await r.json()).hourly;if(!n?.time)return null;let i=new Map;for(let e=0;e<n.time.length;e++){let t=n.time[e].split("T")[0];i.has(t)||i.set(t,{tree:[],grass:[],weed:[]});let o=i.get(t),r=(n.alder_pollen?.[e]||0)+(n.birch_pollen?.[e]||0)+(n.olive_pollen?.[e]||0);o.tree.push(r),o.grass.push(n.grass_pollen?.[e]||0);let a=(n.mugwort_pollen?.[e]||0)+(n.ragweed_pollen?.[e]||0);o.weed.push(a)}let a=Array.from(i.entries()).slice(0,5).map(([e,t])=>{let o=this.average(t.tree),r=this.average(t.grass),n=this.average(t.weed);return{date:e,pollenTypes:[this.createPollenType("TREE","Tree Pollen",o),this.createPollenType("GRASS","Grass Pollen",r),this.createPollenType("WEED","Weed Pollen",n)]}});return{location:{lat:e,lng:t},dailyInfo:a,source:"openmeteo",enrichedAt:new Date().toISOString()}}catch(e){return console.error("Open-Meteo pollen fetch error:",e),null}}createPollenType(e,t,o){let{value:r,category:n,color:i}=this.concentrationToIndex(o);return{code:e,displayName:t,indexInfo:{code:"UPI",displayName:"Universal Pollen Index",value:r,category:n,color:i},inSeason:r>0}}concentrationToIndex(e){return e<10?{value:0,category:"None",color:{red:128,green:128,blue:128}}:e<30?{value:1,category:"Very Low",color:{red:144,green:238,blue:144}}:e<60?{value:2,category:"Low",color:{red:255,green:255,blue:0}}:e<100?{value:3,category:"Moderate",color:{red:255,green:165,blue:0}}:e<200?{value:4,category:"High",color:{red:255,green:0,blue:0}}:{value:5,category:"Very High",color:{red:128,green:0,blue:128}}}average(e){return 0===e.length?0:e.reduce((e,t)=>e+t,0)/e.length}getTodaysSummary(e){let t=e.dailyInfo[0];if(!t)return null;let o=t.pollenTypes.find(e=>"TREE"===e.code),r=t.pollenTypes.find(e=>"GRASS"===e.code),n=t.pollenTypes.find(e=>"WEED"===e.code),i=Math.max(o?.indexInfo.value||0,r?.indexInfo.value||0,n?.indexInfo.value||0),a=i===(o?.indexInfo.value||0)?"Tree":i===(r?.indexInfo.value||0)?"Grass":"Weed",{category:l,color:s}=this.valueToCategory(i);return{overallLevel:l,overallValue:i,color:`rgb(${s.red},${s.green},${s.blue})`,tree:{level:o?.indexInfo.category||"None",value:o?.indexInfo.value||0},grass:{level:r?.indexInfo.category||"None",value:r?.indexInfo.value||0},weed:{level:n?.indexInfo.category||"None",value:n?.indexInfo.value||0},highestType:a,isHighPollenDay:i>=4}}valueToCategory(e){return[{category:"None",color:{red:128,green:128,blue:128}},{category:"Very Low",color:{red:144,green:238,blue:144}},{category:"Low",color:{red:255,green:255,blue:0}},{category:"Moderate",color:{red:255,green:165,blue:0}},{category:"High",color:{red:255,green:0,blue:0}},{category:"Very High",color:{red:128,green:0,blue:128}}][Math.min(e,5)]}getHVACUpsellRecommendation(e){let t=this.getTodaysSummary(e);return t?t.overallValue>=4?{shouldUpsell:!0,urgency:"high",message:`Very high ${t.highestType.toLowerCase()} pollen levels in this area.`,filterRecommendation:"Recommend HEPA filter or MERV 13+ for optimal allergen filtration.",highestPollenType:t.highestType}:t.overallValue>=3?{shouldUpsell:!0,urgency:"medium",message:`Moderate to high ${t.highestType.toLowerCase()} pollen detected.`,filterRecommendation:"Consider upgrading to MERV 11+ filter for better pollen filtration.",highestPollenType:t.highestType}:t.overallValue>=2?{shouldUpsell:!1,urgency:"low",message:`Low ${t.highestType.toLowerCase()} pollen levels.`}:{shouldUpsell:!1,urgency:"none",message:"Pollen levels are minimal."}:{shouldUpsell:!1,urgency:"none",message:"Pollen data unavailable"}}get5DayForecast(e){let t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return e.dailyInfo.map(e=>{let o=e.pollenTypes.find(e=>"TREE"===e.code)?.indexInfo.value||0,r=e.pollenTypes.find(e=>"GRASS"===e.code)?.indexInfo.value||0,n=e.pollenTypes.find(e=>"WEED"===e.code)?.indexInfo.value||0,i=Math.max(o,r,n),{category:a,color:l}=this.valueToCategory(i),s=new Date(e.date);return{date:e.date,dayName:t[s.getDay()],overall:{level:a,value:i,color:`rgb(${l.red},${l.green},${l.blue})`},tree:o,grass:r,weed:n,isBadDay:i>=4}})}cleanCache(){let e=Date.now();for(let[t,o]of this.cache.entries())e-o.timestamp>432e5&&this.cache.delete(t)}clearCache(){this.cache.clear()}}let w=new b;e.s(["googlePollenService",0,w],266299)}];

//# sourceMappingURL=apps_web_src_lib_services_google-weather-service_ts_b1420924._.js.map