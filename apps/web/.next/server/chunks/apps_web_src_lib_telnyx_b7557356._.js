module.exports=[155611,841937,267706,e=>{"use strict";var s=e.i(895811);function r(){let e=["http://localhost:3000",process.env.SITE_URL,"http://localhost:3000",process.env.APP_URL],s="production"!==process.env.VERCEL_ENV||"production"!==process.env.DEPLOYMENT_ENV;for(let r of e)if(r&&r.trim()){let e=r.trim();if((e.includes("localhost")||e.includes("127.0.0.1")||e.includes("0.0.0.0"))&&!s)continue;let i=e.startsWith("http")?e:`https://${e}`;return`${i.replace(/\/+$/,"")}/api/webhooks/telnyx`}}async function i(e){let i=e||s.TELNYX_CONFIG.messagingProfileId,o={exists:!1,isActive:!1,hasWebhookUrl:!1,webhookUrl:null,webhookFailoverUrl:null,webhookApiVersion:null,needsFix:!1,issues:[]};if(!i||""===i.trim())return o.issues.push("Messaging profile ID is not configured"),o.needsFix=!0,o;try{let e=(await s.telnyxClient.messagingProfiles.retrieve(i)).data;if(!e)return o.issues.push(`Messaging profile ${i} not found in Telnyx`),o.needsFix=!0,o;o.exists=!0,o.isActive=!1!==e.enabled,o.webhookUrl=e.webhook_url||null,o.webhookFailoverUrl=e.webhook_failover_url||null,o.webhookApiVersion=e.webhook_api_version||null;let t=r();if(t)if(o.webhookUrl){let e=o.webhookUrl.split("?")[0];e===t||o.webhookUrl===t?o.hasWebhookUrl=!0:(o.issues.push(`Webhook URL base is not set correctly. Expected: ${t}, Current: ${e}`),o.needsFix=!0)}else o.issues.push(`Webhook URL is not set. Expected: ${t} (with optional ?company=... for multi-tenant)`),o.needsFix=!0;else"production"!==process.env.VERCEL_ENV||"production"!==process.env.DEPLOYMENT_ENV?o.issues.push("NEXT_PUBLIC_SITE_URL is not set. Set it to your production URL (e.g., https://yourdomain.com) or use a tool like ngrok for local testing."):o.issues.push("NEXT_PUBLIC_SITE_URL is not set to a valid production URL. Set it to your production domain (e.g., https://yourdomain.com) in your environment variables."),o.needsFix=!0;return"2"!==o.webhookApiVersion&&(o.issues.push(`Webhook API version should be "2", but is "${o.webhookApiVersion||"not set"}"`),o.needsFix=!0),o.isActive||(o.issues.push("Messaging profile is not enabled"),o.needsFix=!0),o}catch(e){return e?.statusCode===404?o.issues.push(`Messaging profile ${i} not found in Telnyx`):o.issues.push(e?.message||"Failed to retrieve messaging profile"),o.needsFix=!0,o}}async function o(e,o){let t=e||s.TELNYX_CONFIG.messagingProfileId,n=[];if(!t||""===t.trim())return{success:!1,fixed:!1,error:"Messaging profile ID is not configured",changes:[]};try{let e=await i(t);if(!e.needsFix)return{success:!0,fixed:!1,changes:[]};let a=o?.webhookUrl||r();if(!a)return{success:!1,fixed:!1,error:"NEXT_PUBLIC_SITE_URL must be set to a valid production URL to configure webhooks",changes:[]};let c={};e.webhookUrl!==a&&(c.webhook_url=a,n.push(`Updated webhook URL to ${a}`));let u=o?.webhookFailoverUrl||process.env.TELNYX_WEBHOOK_FAILOVER_URL||null;return e.webhookFailoverUrl!==u&&(c.webhook_failover_url=u,u?n.push(`Updated webhook failover URL to ${u}`):n.push("Removed webhook failover URL")),"2"!==e.webhookApiVersion&&(c.webhook_api_version="2",n.push("Updated webhook API version to 2")),e.isActive||(c.enabled=!0,n.push("Enabled messaging profile")),Object.keys(c).length>0&&await s.telnyxClient.messagingProfiles.update(t,c),{success:!0,fixed:n.length>0,changes:n}}catch(e){return{success:!1,fixed:!1,error:e?.message||"Failed to update messaging profile",changes:n}}}async function t(e){try{let r=await s.telnyxClient.availablePhoneNumbers.list({filter:{country_code:e.countryCode||"US",national_destination_code:e.areaCode,features:e.features,limit:e.limit||10,starts_with:e.startsWith,ends_with:e.endsWith,contains:e.contains}});return{success:!0,data:r.data}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to search numbers"}}}async function n(e){try{let r=await s.telnyxClient.numberOrders.create({phone_numbers:[{phone_number:e.phoneNumber}],messaging_profile_id:e.messagingProfileId,connection_id:e.connectionId,billing_group_id:e.billingGroupId,customer_reference:e.customerReference});return{success:!0,orderId:r.data?.id,data:r.data}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to purchase number"}}}async function a(e){try{let r=await s.telnyxClient.phoneNumbers.list({page:{size:e?.pageSize||20,number:e?.pageNumber||1},filter:{tag:e?.filterTag,status:e?.filterStatus}});return{success:!0,data:r.data,meta:r.meta}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to list numbers"}}}async function c(e){try{let r=await s.telnyxClient.phoneNumbers.retrieve(e);return{success:!0,data:r.data}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to retrieve number"}}}async function u(e){try{let r=await s.telnyxClient.phoneNumbers.update(e.phoneNumberId,{connection_id:e.connectionId,messaging_profile_id:e.messagingProfileId,billing_group_id:e.billingGroupId,tags:e.tags,customer_reference:e.customerReference});return{success:!0,data:r.data}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to update number"}}}async function l(e){try{return await s.telnyxClient.phoneNumbers.del(e),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to release number"}}}async function d(e){try{let s=e.replace(/\D/g,""),r=s.startsWith("+")?e:s.startsWith("1")&&11===s.length?`+${s}`:`+1${s}`,i=await a({pageSize:100});if(!i.success||!i.data)return{success:!1,error:"Failed to list phone numbers from Telnyx"};let o=(Array.isArray(i.data)?i.data:[i.data]).find(i=>i.phone_number===r||i.phone_number===e||i.phone_number?.replace(/\D/g,"")===s);if(!o)return{success:!1,error:`Phone number ${e} not found in Telnyx account`};return{success:!0,phoneNumberId:o.id}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to find phone number"}}}async function h(e){let s={exists:!1,hasMessagingProfile:!1,hasConnection:!1,capabilities:{sms:!1,voice:!1,mms:!1},needsFix:!1,issues:[]};try{let r=await d(e);if(!r.success||!r.phoneNumberId)return s.issues.push(r.error||"Phone number not found in Telnyx"),s.needsFix=!0,s;s.exists=!0;let i=await c(r.phoneNumberId);if(!i.success||!i.data)return s.issues.push("Failed to retrieve phone number details"),s.needsFix=!0,s;let o=i.data;o.messaging_profile_id?s.hasMessagingProfile=!0:(s.issues.push("Phone number is not associated with a messaging profile"),s.needsFix=!0),o.connection_id?s.hasConnection=!0:(s.issues.push("Phone number is not associated with a connection"),s.needsFix=!0);let t=o.features||[],n=t.includes("sms"),a=t.includes("voice"),u=t.includes("mms"),l=!1;try{let e=process.env.TELNYX_API_KEY;if(e){let s=await fetch(`https://api.telnyx.com/v2/phone_numbers/${r.phoneNumberId}/messaging`,{headers:{Authorization:`Bearer ${e}`}});if(s.ok){let e=await s.json(),r=e?.data?.features;(r?.sms?.domestic_two_way||r?.mms?.domestic_two_way)&&(l=!0)}}}catch{}return s.capabilities.sms=n||l,s.capabilities.voice=a,s.capabilities.mms=u||l,s.capabilities.sms||s.issues.push("Phone number does not have SMS capability"),s.capabilities.voice||s.issues.push("Phone number does not have voice capability"),s}catch(e){return s.issues.push(e instanceof Error?e.message:"Unknown error"),s.needsFix=!0,s}}async function p(e,r){let i=[];try{let o=await d(e);if(!o.success||!o.phoneNumberId)return{success:!1,fixed:!1,error:o.error||"Phone number not found",changes:[]};let t=await h(e);if(!t.needsFix)return{success:!0,fixed:!1,changes:[]};let n={phoneNumberId:o.phoneNumberId};if(!t.hasMessagingProfile){let e=r?.messagingProfileId||s.TELNYX_CONFIG.messagingProfileId;if(!e)return{success:!1,fixed:!1,error:"Messaging profile ID is required but not configured. Set TELNYX_DEFAULT_MESSAGING_PROFILE_ID.",changes:[]};n.messagingProfileId=e,i.push(`Assigned messaging profile ${e} to phone number`)}if(!t.hasConnection){let e=r?.connectionId||s.TELNYX_CONFIG.connectionId;if(!e)return{success:!1,fixed:!1,error:"Connection ID is required but not configured. Set NEXT_PUBLIC_TELNYX_CONNECTION_ID.",changes:[]};n.connectionId=e,i.push(`Assigned connection ${e} to phone number`)}if(n.messagingProfileId||n.connectionId){let e=await u(n);if(!e.success)return{success:!1,fixed:!1,error:e.error||"Failed to update phone number",changes:i}}return{success:!0,fixed:i.length>0,changes:i}}catch(e){return{success:!1,fixed:!1,error:e instanceof Error?e.message:"Unknown error",changes:i}}}async function f(e){let s=await h(e);return s.exists?s.capabilities.sms?s.hasMessagingProfile?{hasSms:!0}:{hasSms:!1,error:"Phone number is not associated with a messaging profile"}:{hasSms:!1,error:"Phone number does not have SMS capability"}:{hasSms:!1,error:"Phone number not found in Telnyx"}}async function m(e){let s=await h(e);return s.exists?s.capabilities.voice?s.hasConnection?{hasVoice:!0}:{hasVoice:!1,error:"Phone number is not associated with a connection"}:{hasVoice:!1,error:"Phone number does not have voice capability"}:{hasVoice:!1,error:"Phone number not found in Telnyx"}}e.s(["fixMessagingProfile",()=>o,"verifyMessagingProfile",()=>i],155611),e.s(["getNumberDetails",()=>c,"listOwnedNumbers",()=>a,"purchaseNumber",()=>n,"releaseNumber",()=>l,"searchAvailableNumbers",()=>t,"updateNumber",()=>u],841937),e.s(["fixPhoneNumber",()=>p,"verifySmsCapability",()=>f,"verifyVoiceCapability",()=>m],267706)},244284,e=>{"use strict";var s=e.i(895811);function r(e){let s=e.toLowerCase();return s.includes("localhost")||s.includes("127.0.0.1")||s.includes("0.0.0.0")||s.endsWith(".local")||s.includes("://local")}function i(){let e=[],i=[],o={apiKey:!1,connectionId:!1,messagingProfileId:!1,webhookSecret:!1,publicKey:!1,siteUrl:!1};s.TELNYX_CONFIG.apiKey&&""!==s.TELNYX_CONFIG.apiKey.trim()?s.TELNYX_CONFIG.apiKey.length<20?e.push("TELNYX_API_KEY appears to be invalid (too short). Get your API key from https://portal.telnyx.com"):o.apiKey=!0:e.push("TELNYX_API_KEY is not set. This is required for all Telnyx operations."),s.TELNYX_CONFIG.connectionId&&""!==s.TELNYX_CONFIG.connectionId.trim()?o.connectionId=!0:e.push("NEXT_PUBLIC_TELNYX_CONNECTION_ID is not set. This is required for phone calls. Get it from Telnyx Portal → Mission Control → Connections."),s.TELNYX_CONFIG.messagingProfileId&&""!==s.TELNYX_CONFIG.messagingProfileId.trim()?o.messagingProfileId=!0:e.push("TELNYX_DEFAULT_MESSAGING_PROFILE_ID or NEXT_PUBLIC_TELNYX_MESSAGING_PROFILE_ID is not set. This is required for SMS/MMS. Run getDefaultMessagingProfile() to fetch it automatically from Telnyx."),s.TELNYX_CONFIG.webhookSecret&&""!==s.TELNYX_CONFIG.webhookSecret.trim()?o.webhookSecret=!0:i.push("TELNYX_WEBHOOK_SECRET is not set. Webhook signature verification will be disabled. Set this in production for security."),s.TELNYX_CONFIG.publicKey&&""!==s.TELNYX_CONFIG.publicKey.trim()?o.publicKey=!0:i.push("TELNYX_PUBLIC_KEY is not set. Webhook signature verification may not work correctly. Get it from Telnyx Portal → API Keys.");let t=function(){for(let e of["http://localhost:3000",process.env.SITE_URL,"http://localhost:3000",process.env.APP_URL])if(e&&e.trim()){let s=e.trim();if(!r(s))return s.startsWith("http")?s:`https://${s}`}let e=process.env.VERCEL_URL;if(e&&!r(e))return e.startsWith("http")?e:`https://${e}`}();return t?r(t)?"production"===process.env.VERCEL_ENV||"production"===process.env.DEPLOYMENT_ENV?e.push(`Site URL is set to localhost (${t}) but you're in production. Set NEXT_PUBLIC_SITE_URL to your production domain.`):i.push(`Site URL is set to localhost (${t}). This will not work in production.`):o.siteUrl=!0:e.push("NEXT_PUBLIC_SITE_URL or SITE_URL is not set to a valid production URL. This is required for webhook callbacks. Set it to your production domain (e.g., https://thorbis.co)."),{valid:0===e.length,errors:e,warnings:i,config:o}}async function o(){let s=i();if(!s.config.apiKey)return{valid:!1,error:"TELNYX_API_KEY is required for SMS operations"};if(!s.config.messagingProfileId){try{let{getDefaultMessagingProfile:s}=await e.A(989318),r=await s();if(r.success&&r.profile)return{valid:!1,error:"TELNYX_DEFAULT_MESSAGING_PROFILE_ID is required for SMS operations.",suggestedProfileId:r.profile.id}}catch{}return{valid:!1,error:"TELNYX_DEFAULT_MESSAGING_PROFILE_ID is required for SMS operations. Run getDefaultMessagingProfile() to fetch it automatically from Telnyx."}}return s.config.siteUrl?{valid:!0}:{valid:!1,error:"NEXT_PUBLIC_SITE_URL must be set to a valid production URL for SMS webhooks."}}function t(){let e=i();return e.config.apiKey?e.config.connectionId?e.config.siteUrl?{valid:!0}:{valid:!1,error:"NEXT_PUBLIC_SITE_URL must be set to a valid production URL for call webhooks."}:{valid:!1,error:"NEXT_PUBLIC_TELNYX_CONNECTION_ID is required for phone calls. Get it from Telnyx Portal → Mission Control → Connections."}:{valid:!1,error:"TELNYX_API_KEY is required for phone calls"}}e.s(["validateCallConfig",()=>t,"validateSmsConfig",()=>o,"validateTelnyxConfig",()=>i])}];

//# sourceMappingURL=apps_web_src_lib_telnyx_b7557356._.js.map