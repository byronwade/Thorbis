module.exports=[181184,e=>{"use strict";var t=e.i(660198),i=e.i(802451),s=e.i(982353),r=e.i(554772),n=e.i(949880),a=e.i(484007);function o({companyName:e,contactName:o,verificationTypes:_,dashboardUrl:T,messagingUrl:S,previewText:w="Your business messaging is now fully enabled!"}){let L=_.includes("toll-free"),R=_.includes("10dlc");return(0,t.jsxs)(a.BaseLayout,{previewText:w,children:[(0,t.jsx)(n.Heading,{level:1,children:"ðŸŽ‰ Your Messaging is Live!"}),(0,t.jsxs)(i.Text,{style:l,children:["Hi ",o,","]}),(0,t.jsxs)(i.Text,{style:l,children:["Excellent news! Your business messaging verification for"," ",(0,t.jsx)("strong",{children:e})," has been approved. You can now send SMS and MMS messages to your customers."]}),(0,t.jsxs)(r.Card,{style:c,children:[(0,t.jsx)("div",{style:d,children:"âœ…"}),(0,t.jsx)(n.Heading,{level:3,style:u,children:"All Systems Ready"}),(0,t.jsxs)(i.Text,{style:p,children:[L&&R&&(0,t.jsx)(t.Fragment,{children:"Both your toll-free and regular (10DLC) numbers are now approved and ready to send messages."}),L&&!R&&(0,t.jsx)(t.Fragment,{children:"Your toll-free numbers have been approved and are ready to send messages."}),!L&&R&&(0,t.jsx)(t.Fragment,{children:"Your 10DLC (regular) numbers have been approved and are ready to send messages."})]})]}),(0,t.jsx)(n.Heading,{level:3,children:"What You Can Do Now"}),(0,t.jsxs)("ul",{style:m,children:[(0,t.jsxs)("li",{style:f,children:[(0,t.jsx)("strong",{children:"Send SMS/MMS:"})," Text your customers with appointment reminders, estimates, invoices, and updates"]}),(0,t.jsxs)("li",{style:f,children:[(0,t.jsx)("strong",{children:"Two-Way Messaging:"})," Receive and respond to customer texts directly in your dashboard"]}),(0,t.jsxs)("li",{style:f,children:[(0,t.jsx)("strong",{children:"Automated Messages:"})," Set up automatic text notifications for jobs, appointments, and payments"]}),(0,t.jsxs)("li",{style:f,children:[(0,t.jsx)("strong",{children:"Rich Media:"})," Send photos, documents, and other attachments via MMS"]}),L&&(0,t.jsxs)("li",{style:f,children:[(0,t.jsx)("strong",{children:"RCS Messaging:"})," Support for read receipts and rich messaging features on compatible devices"]})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(n.Heading,{level:3,children:"Quick Start Guide"}),(0,t.jsxs)(i.Text,{style:g,children:[(0,t.jsx)("strong",{children:"1. Set Up Message Templates"}),(0,t.jsx)("br",{}),"Create reusable templates for common messages like appointment confirmations and reminders."]}),(0,t.jsxs)(i.Text,{style:g,children:[(0,t.jsx)("strong",{children:"2. Configure Notifications"}),(0,t.jsx)("br",{}),"Enable automatic text notifications for job updates, invoice payments, and more."]}),(0,t.jsxs)(i.Text,{style:g,children:[(0,t.jsx)("strong",{children:"3. Start Messaging"}),(0,t.jsx)("br",{}),"Send your first text message! Try texting a test appointment reminder or estimate notification."]})]}),(0,t.jsx)("div",{style:h,children:(0,t.jsx)(s.Button,{href:S,children:"Open Messaging Dashboard"})}),(0,t.jsx)("div",{style:y,children:(0,t.jsx)("a",{href:T,style:b,children:"Back to Main Dashboard â†’"})}),(0,t.jsxs)(i.Text,{style:x,children:[(0,t.jsx)("strong",{children:"Need help getting started?"})," Check out our"," ",(0,t.jsx)("a",{href:"https://thorbis.com/docs/messaging",style:C,children:"messaging guide"})," ","or contact support at"," ",(0,t.jsx)("a",{href:"mailto:support@thorbis.com",style:C,children:"support@thorbis.com"})]}),(0,t.jsx)(i.Text,{style:v,children:"Your approval was issued by The Campaign Registry and is valid for all US carriers. Keep sending great messages! ðŸ“±"})]})}let l={color:"#374151",fontSize:"16px",lineHeight:"24px",margin:"0 0 16px 0"},c={backgroundColor:"#f0fdf4",border:"1px solid #86efac",borderRadius:"8px",padding:"24px",margin:"24px 0",textAlign:"center"},d={fontSize:"48px",marginBottom:"12px"},u={color:"#166534",fontSize:"20px",fontWeight:"600",margin:"0 0 8px 0"},p={color:"#15803d",fontSize:"16px",lineHeight:"24px",margin:"0"},m={color:"#374151",fontSize:"16px",lineHeight:"24px",margin:"16px 0 24px 24px",padding:"0"},f={margin:"0 0 12px 0"},g={color:"#6b7280",fontSize:"15px",lineHeight:"22px",margin:"0 0 16px 0"},h={margin:"32px 0 16px 0",textAlign:"center"},y={margin:"0 0 32px 0",textAlign:"center"},b={color:"hsl(217 91% 60%)",fontSize:"16px",textDecoration:"none",fontWeight:"500"},x={color:"#374151",fontSize:"16px",lineHeight:"24px",margin:"24px 0 0 0",padding:"16px",backgroundColor:"#f9fafb",borderRadius:"8px",textAlign:"center"},v={color:"#9ca3af",fontSize:"13px",lineHeight:"18px",margin:"24px 0 0 0",textAlign:"center",fontStyle:"italic"},C={color:"hsl(217 91% 60%)",textDecoration:"underline"};e.s(["default",()=>o])},131644,e=>{"use strict";var t=e.i(660198),i=e.i(802451),s=e.i(982353),r=e.i(554772),n=e.i(949880),a=e.i(484007);function o({companyName:e,contactName:o,hasTollFreeNumbers:C,has10DLCNumbers:_,tollFreeCount:T=0,dlcCount:S=0,dashboardUrl:w,previewText:L="Your messaging verification has been submitted successfully"}){return(0,t.jsxs)(a.BaseLayout,{previewText:L,children:[(0,t.jsx)(n.Heading,{level:1,children:"Verification Submitted Successfully!"}),(0,t.jsxs)(i.Text,{style:l,children:["Hi ",o,","]}),(0,t.jsxs)(i.Text,{style:l,children:["Great news! We've successfully submitted your business messaging verification for ",(0,t.jsx)("strong",{children:e}),". Here's what happens next:"]}),(0,t.jsxs)("div",{style:c,children:[_&&(0,t.jsxs)(r.Card,{style:d,children:[(0,t.jsx)("div",{style:p,children:"âœ…"}),(0,t.jsx)(n.Heading,{level:3,style:m,children:"10DLC Registration Complete"}),(0,t.jsxs)(i.Text,{style:f,children:[(0,t.jsxs)("strong",{children:[S," regular number",1!==S?"s":""]})," ","enabled for SMS immediately. You can start sending text messages right away!"]})]}),C&&(0,t.jsxs)(r.Card,{style:u,children:[(0,t.jsx)("div",{style:p,children:"â°"}),(0,t.jsx)(n.Heading,{level:3,style:m,children:"Toll-Free Verification Pending"}),(0,t.jsxs)(i.Text,{style:f,children:[(0,t.jsxs)("strong",{children:[T," toll-free number",1!==T?"s":""]})," ","submitted for verification. Approval typically takes"," ",(0,t.jsx)("strong",{children:"5-7 business days"}),"."]})]})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(n.Heading,{level:3,children:"What to Expect"}),(0,t.jsxs)("ul",{style:g,children:[_&&(0,t.jsxs)("li",{style:h,children:[(0,t.jsx)("strong",{children:"Regular Numbers (10DLC):"})," Ready to use! Start sending SMS/MMS to your customers right away."]}),C&&(0,t.jsxs)("li",{style:h,children:[(0,t.jsx)("strong",{children:"Toll-Free Numbers:"})," Under review by our carrier partners. We'll email you when they're approved (usually within 5-7 business days)."]}),(0,t.jsxs)("li",{style:h,children:[(0,t.jsx)("strong",{children:"No Action Required:"})," We're handling everything automatically. You can continue setting up your account."]}),(0,t.jsxs)("li",{style:h,children:[(0,t.jsx)("strong",{children:"Notification:"})," You'll receive another email once your toll-free verification is complete."]})]})]}),(0,t.jsx)("div",{style:y,children:(0,t.jsx)(s.Button,{href:w,children:"Go to Dashboard"})}),(0,t.jsxs)(i.Text,{style:b,children:[(0,t.jsx)("strong",{children:"Need help?"})," If you have any questions about the verification process, our support team is here to help at"," ",(0,t.jsx)("a",{href:"mailto:support@thorbis.com",style:v,children:"support@thorbis.com"})]}),(0,t.jsx)(i.Text,{style:x,children:"This is a federal requirement enforced by The Campaign Registry and US carriers to prevent spam and ensure legitimate business messaging."})]})}let l={color:"#374151",fontSize:"16px",lineHeight:"24px",margin:"0 0 16px 0"},c={margin:"32px 0",display:"grid",gap:"16px"},d={backgroundColor:"#f0fdf4",border:"1px solid #86efac",borderRadius:"8px",padding:"24px"},u={backgroundColor:"#fffbeb",border:"1px solid #fde047",borderRadius:"8px",padding:"24px"},p={fontSize:"32px",marginBottom:"8px"},m={color:"#374151",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},f={color:"#6b7280",fontSize:"14px",lineHeight:"20px",margin:"0"},g={color:"#374151",fontSize:"16px",lineHeight:"24px",margin:"16px 0 0 24px",padding:"0"},h={margin:"0 0 12px 0"},y={margin:"32px 0",textAlign:"center"},b={color:"#374151",fontSize:"16px",lineHeight:"24px",margin:"24px 0 0 0",padding:"16px",backgroundColor:"#f9fafb",borderRadius:"8px",textAlign:"center"},x={color:"#9ca3af",fontSize:"13px",lineHeight:"18px",margin:"24px 0 0 0",textAlign:"center",fontStyle:"italic"},v={color:"hsl(217 91% 60%)",textDecoration:"underline"};e.s(["default",()=>o])},234400,e=>e.a(async(t,i)=>{try{var s=e.i(471312),r=e.i(511368);e.i(181184);var n=e.i(131644),a=e.i(641979),o=e.i(14646),l=e.i(264591),c=e.i(798348),d=t([a]);async function u(e,t,i){try{let s=await (0,r.createClient)(),{data:c,error:d}=await s.from("companies").select("name").eq("id",e).single();if(d||!c)return{success:!1,error:`Company not found: ${d?.message}`};let{data:u,error:p}=await s.from("company_memberships").select("full_name").eq("company_id",e).eq("role","owner").single(),m=u?.full_name||"there",f=`${l.emailConfig.appUrl}/dashboard`,g=(0,n.default)({companyName:c.name,contactName:m,hasTollFreeNumbers:i.hasTollFreeNumbers,has10DLCNumbers:i.has10DLCNumbers,tollFreeCount:i.tollFreeCount||0,dlcCount:i.dlcCount||0,dashboardUrl:f});return await (0,a.sendEmail)({to:t,subject:`Messaging Verification Submitted - ${c.name}`,template:g,templateType:o.EmailTemplate.VERIFICATION_SUBMITTED,companyId:e,tags:[{name:"type",value:"onboarding"},{name:"verification",value:"submitted"}]})}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to send verification submitted email"}}}[a]=d.then?(await d)():d,(0,c.ensureServerEntryExports)([u]),(0,s.registerServerReference)(u,"70f58c5ba46ef02b620d7dc87bae8fc83f6d480755",null),e.s(["sendVerificationSubmittedEmail",()=>u]),i()}catch(e){i(e)}},!1),162181,e=>{"use strict";var t=e.i(306024);async function i(){try{let e=await (0,t.telnyxRequest)("/account/verifications",{method:"GET"});if(e.success&&e.data){let{verifications:t}=e.data,i=t.identity_verification?.status==="verified",s=t.business_verification?.status==="verified",r=[],n=0;return i||(r.push("Complete Level 1 verification (ID, payment method, contact info)"),n=Math.max(n,2)),s||(r.push("Complete Level 2 verification (EIN letter, business license, proof of address)"),n=Math.max(n,5)),{success:!0,data:{currentLevel:s?"level_2":i?"level_1":"none",isLevel1Complete:i,isLevel2Complete:s,canCreate10DLC:s,requirementsRemaining:r,estimatedCompletionDays:r.length>0?n:void 0}}}let i=await (0,t.telnyxRequest)("/10dlc/brand",{method:"GET"});if(i.success)return{success:!0,data:{currentLevel:"level_2",isLevel1Complete:!0,isLevel2Complete:!0,canCreate10DLC:!0,requirementsRemaining:[]}};if(i.error?.includes("403")||i.error?.includes("verification"))return{success:!0,data:{currentLevel:"level_1",isLevel1Complete:!0,isLevel2Complete:!1,canCreate10DLC:!1,requirementsRemaining:["Complete Level 2 verification (EIN letter, business license, proof of address)"],estimatedCompletionDays:5}};return{success:!0,data:{currentLevel:"none",isLevel1Complete:!1,isLevel2Complete:!1,canCreate10DLC:!1,requirementsRemaining:["Complete Level 1 verification (ID, payment method, contact info)","Complete Level 2 verification (EIN letter, business license, proof of address)"],estimatedCompletionDays:7}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to check verification status"}}}function s(e){return{level1:{required:"none"===e,items:["Valid government-issued ID (Driver's License, Passport, etc.)","Payment method (Credit card or bank account)","Phone number verification","Email verification","Business address confirmation"]},level2:{required:"none"===e||"level_1"===e,items:["IRS EIN Confirmation Letter (CP 575 or 147C)","Business License or Articles of Incorporation","Proof of Business Address (Utility bill, lease agreement)","Government-issued ID for business representative","Tax documents (W-9 or recent tax return)"]}}}function r(e){let t=[];return e.isLevel1Complete||t.push({step:"Complete Level 1 Verification",action:"Visit Telnyx Portal â†’ Account â†’ Public Profile and complete identity verification",url:"https://portal.telnyx.com/#/app/account/public-profile"}),!e.isLevel2Complete&&e.isLevel1Complete&&t.push({step:"Complete Level 2 Verification",action:"Visit Telnyx Portal â†’ Account â†’ Verifications and upload business documents",url:"https://portal.telnyx.com/#/app/account/verifications"}),e.canCreate10DLC&&t.push({step:"Create 10DLC Brand & Campaign",action:"Run automated setup to create 10DLC brand and campaign (fully automated)",url:"/test-telnyx-setup"}),t}e.s(["checkAccountVerificationStatus",()=>i,"getNextSteps",()=>r,"getVerificationRequirements",()=>s])},8583,e=>e.a(async(t,i)=>{try{var s=e.i(471312),r=e.i(234400),n=e.i(511368),a=e.i(273568),o=e.i(162181),l=e.i(893099),c=e.i(798348),d=t([r]);async function u(e){let t=[],i=await (0,n.createClient)();if(!i)return{success:!1,error:"Failed to create Supabase client",log:t};try{let s;t.push("Fetching company data...");let{data:r,error:n}=await i.from("companies").select(`
				id,
				name,
				ein,
				website,
				industry,
				address,
				city,
				state,
				zip_code,
				phone,
				email,
				support_email,
				support_phone
			`).eq("id",e).single();if(n||!r)return{success:!1,error:`Company not found: ${n?.message}`,log:t};if(!r.ein)return{success:!1,error:"Company EIN is required for 10DLC registration. Please add the company's Tax ID.",log:t};if(!r.address||!r.city||!r.state||!r.zip_code)return{success:!1,error:"Company address is incomplete. Please add full address, city, state, and ZIP code.",log:t};let o=r.email||r.support_email,c=r.phone||r.support_phone;if(!o||!c)return{success:!1,error:"Company contact email and phone are required for 10DLC registration.",log:t};t.push("Verifying company email domain...");let d=await (0,a.createServiceSupabaseClient)();if(!d)return{success:!1,error:"Database service client failed",log:t};let{data:u}=await d.from("company_email_domains").select("*").eq("company_id",e).eq("status","verified").single();if(!u)return{success:!1,error:"Company email domain must be verified before 10DLC registration. TCR (The Campaign Registry) requires a verified business email domain with proper SPF/DKIM/DMARC records. Please complete email domain setup in the onboarding steps.",log:t};let m=u.subdomain?`${u.subdomain}.${u.domain_name}`:u.domain_name;t.push(`Email domain verified: ${m}`);let f=(s=c.replace(/\D/g,""),10===s.length?`+1${s}`:(11===s.length&&s.startsWith("1"),`+${s}`));t.push("Checking existing 10DLC registration...");let{data:g}=await i.from("company_telnyx_settings").select("ten_dlc_brand_id, ten_dlc_campaign_id").eq("company_id",e).single();if(g?.ten_dlc_brand_id&&g?.ten_dlc_campaign_id)return t.push("Company already has 10DLC registration"),{success:!0,brandId:g.ten_dlc_brand_id,campaignId:g.ten_dlc_campaign_id,log:t};t.push("Creating 10DLC brand with Telnyx...");let h={entityType:"PRIVATE_PROFIT",displayName:r.name||"Unknown Company",companyName:r.name||"Unknown Company",firstName:"Business",lastName:"Owner",ein:r.ein,phone:f,street:r.address||"",city:r.city||"",state:r.state||"",postalCode:r.zip_code||"",country:"US",email:o,website:r.website,vertical:function(e){if(!e)return"PROFESSIONAL";let t=e.toLowerCase();return t.includes("healthcare")||t.includes("medical")?"HEALTHCARE":t.includes("finance")||t.includes("banking")?"FINANCIAL":t.includes("insurance")?"INSURANCE":t.includes("real estate")?"REAL_ESTATE":t.includes("retail")||t.includes("ecommerce")?"RETAIL":t.includes("hospitality")||t.includes("restaurant")||t.includes("food")||t.includes("hotel")?"HOSPITALITY":t.includes("education")?"EDUCATION":t.includes("technology")||t.includes("software")?"TECHNOLOGY":t.includes("nonprofit")||t.includes("charity")||t.includes("ngo")?"NGO":t.includes("construction")||t.includes("plumbing")||t.includes("hvac")||t.includes("electrical")||t.includes("contractor")?"CONSTRUCTION":t.includes("legal")||t.includes("law")?"LEGAL":t.includes("manufacturing")?"MANUFACTURING":t.includes("transportation")||t.includes("logistics")?"TRANSPORTATION":t.includes("energy")||t.includes("utilities")?"ENERGY":t.includes("agriculture")||t.includes("farming")?"AGRICULTURE":t.includes("entertainment")||t.includes("media")?"ENTERTAINMENT":"PROFESSIONAL"}(r.industry),businessContactEmail:o,isReseller:!0},y=await (0,l.createTenDlcBrand)(h);if(!y.success||!y.data?.brandId)return{success:!1,error:`Failed to create 10DLC brand: ${y.error}`,log:t};let b=y.data.brandId;t.push(`Brand created: ${b}`),t.push("Waiting for brand approval...");let x=await p(()=>(0,l.getTenDlcBrand)(b),60);if(!x.approved){if(t.push(`Brand approval failed: ${x.failureReason||"Unknown reason"}`),x.failureReason?.toLowerCase().includes("email"))return{success:!1,error:`Email validation failed: ${x.failureReason}. TCR requires a verified business email domain (not personal/free providers). Options: 1) Use toll-free numbers (bypasses TCR), 2) Set up Google Workspace/Microsoft 365, 3) See /TELNYX_10DLC_EMAIL_REQUIREMENTS.md`,brandId:b,log:t};return await i.from("company_telnyx_settings").update({ten_dlc_brand_id:b}).eq("company_id",e),{success:!1,error:x.failureReason||"Brand created but approval pending. Please check back in a few minutes.",brandId:b,log:t}}t.push("Brand approved"),t.push("Creating 10DLC campaign...");let v={brandId:b,usecase:"MIXED",description:`Business messaging for ${r.name}`,messageFlow:"Customers opt-in when providing phone number. Messages sent for appointments, invoices, and general updates.",helpMessage:"Reply HELP for assistance or call us.",helpKeywords:"HELP",optinKeywords:"START YES SUBSCRIBE",optinMessage:"You are now subscribed to messages from "+r.name+". Reply STOP to unsubscribe.",optoutKeywords:"STOP END UNSUBSCRIBE CANCEL QUIT",optoutMessage:"You have been unsubscribed from "+r.name+" messages. Reply START to resubscribe.",sample1:"Your appointment is confirmed for tomorrow at 2 PM.",sample2:"Thank you for your payment. Receipt: #12345",sample3:"Reminder: Service scheduled for next week.",autoRenewal:!0,termsAndConditions:!0,termsAndConditionsLink:r.website?`${r.website}/terms`:"https://stratos.thorbis.com/terms",subscriberHelp:!0,subscriberOptin:!0,subscriberOptout:!0},C=await (0,l.createTenDlcCampaign)(v);if(!C.success||!C.data?.campaignId)return{success:!1,error:`Failed to create 10DLC campaign: ${C.error}`,brandId:b,log:t};let _=C.data.campaignId;t.push(`Campaign created: ${_}`),t.push("Waiting for campaign approval...");let T=await p(()=>(0,l.getTenDlcCampaign)(_),60);if(!T.approved)return t.push(`Campaign approval failed: ${T.failureReason||"Unknown reason"}`),await i.from("company_telnyx_settings").update({ten_dlc_brand_id:b,ten_dlc_campaign_id:_}).eq("company_id",e),{success:!1,error:T.failureReason||"Campaign created but approval pending. Please check back in a few minutes.",brandId:b,campaignId:_,log:t};t.push("Campaign approved"),t.push("Attaching phone numbers to campaign...");let{data:S}=await i.from("phone_numbers").select("phone_number").eq("company_id",e).eq("status","active"),w=0;for(let e of S||[]){let i=await (0,l.attachNumberToCampaign)(_,e.phone_number);i.success?w++:t.push(`Failed to attach ${e.phone_number}: ${i.error}`)}return t.push(`Attached ${w} phone numbers to campaign`),t.push("Updating company Telnyx settings..."),await i.from("company_telnyx_settings").update({ten_dlc_brand_id:b,ten_dlc_campaign_id:_}).eq("company_id",e),{success:!0,brandId:b,campaignId:_,log:t}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error",log:t}}}async function p(e,t){let i=Date.now();for(;Date.now()-i<1e3*t;){let t=await e();if(!t.success||!t.data)return{approved:!1,failureReason:"Failed to fetch status"};let i=t.data.status.toLowerCase();if("approved"===i||"active"===i)return{approved:!0};if("rejected"===i||"failed"===i||"registration_failed"===i){let e=t.data.failureReasons?.[0]?.description||`Registration ${i}`;return{approved:!1,failureReason:e}}await new Promise(e=>setTimeout(e,5e3))}return{approved:!1,failureReason:"Timeout waiting for approval"}}async function m(){try{let e=await (0,o.checkAccountVerificationStatus)();if(!e.success)return{success:!1,error:e.error||"Failed to check verification status"};let t=e.data,i=(0,o.getNextSteps)(t),s=(0,o.getVerificationRequirements)(t.currentLevel);return{success:!0,data:{...t,nextSteps:i,requirements:s}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to check verification status"}}}async function f(e){let t=await (0,n.createClient)(),i=[];if(!t)return{success:!1,error:"Failed to create Supabase client",log:i};try{let s,n,a,o,{data:l,error:c}=await t.from("companies").select(`
				id,
				name,
				ein,
				website,
				industry,
				address,
				city,
				state,
				zip_code,
				phone,
				email,
				support_email,
				support_phone
			`).eq("id",e).single();if(c||!l)return i.push("Company lookup failed"),{success:!1,error:`Company not found: ${c?.message}`,log:i};if(i.push(`Company loaded: ${l.name} (${l.id})`),!l.ein)return i.push("Missing EIN"),{success:!1,error:"Company EIN is required for messaging verification. Please add your Tax ID in Step 1.",log:i};if(!l.address||!l.city||!l.state||!l.zip_code)return i.push("Incomplete address"),{success:!1,error:"Company address is incomplete. Please complete all address fields in Step 1.",log:i};let d=(e=>{if(!e)return null;let t=e.replace(/\D/g,"");return t?10===t.length?`+1${t}`:11===t.length&&t.startsWith("1")?`+${t}`:e.startsWith("+")?e:`+${t}`:null})(l.phone||l.support_phone);if(!d)return i.push("Missing company phone"),{success:!1,error:"Company phone number is required for verification.",log:i};let{data:p,error:m}=await t.from("phone_numbers").select("phone_number, number_type").eq("company_id",e).eq("status","active");if(m||!p||0===p.length)return i.push("No phone numbers found for company"),{success:!1,error:"No phone numbers found. Please add a phone number before enabling messaging.",log:i};let f=p.filter(e=>"toll-free"===e.number_type),g=p.filter(e=>"local"===e.number_type);i.push(`Detected toll-free numbers: ${f.length}, 10DLC numbers: ${g.length}`),0===f.length&&g.length;let h=l.email||l.support_email||null;if(!h)return{success:!1,error:"A primary email is required for toll-free verification.",log:i};let{data:y}=await t.from("company_memberships").select("user_id, user_profiles!inner(first_name, last_name)").eq("company_id",e).eq("role","owner").eq("status","active").single(),b=y?.user_profiles,x=b?.first_name||"Admin",v=b?.last_name||"User";if(f.length>0){i.push("Preparing toll-free verification payload");let r=l.website||`https://${l.name.toLowerCase().replace(/\s+/g,"")}.com`,n=`${r.replace(/\/$/,"")}/opt-in`,a=`${l.name} sends timely service notifications, scheduling updates, and customer support follow-ups for ${l.industry||"field service"} operations.`,o=l.ein.replace(/[^\d]/g,""),c={businessName:l.name,corporateWebsite:r,businessAddr1:l.address,businessCity:l.city,businessState:l.state,businessZip:l.zip_code,businessContactFirstName:x,businessContactLastName:v,businessContactEmail:h,businessContactPhone:d,phoneNumbers:f.map(e=>({phoneNumber:e.phone_number})),useCase:"Customer Support",useCaseSummary:`${l.industry} business communications including appointment reminders, service notifications, and customer support`,productionMessageContent:`Hi! This is ${l.name}. Your appointment is scheduled for tomorrow at 10 AM. Reply STOP to opt out.`,messageVolume:"10000",optInWorkflow:"Customers opt-in during service booking and account creation",optInWorkflowImageURLs:[{url:n||"https://dummyimage.com/600x400/cccccc/000000&text=Opt-In",description:"Opt-in form screenshot"}],optInKeywords:"YES,START",optOutKeywords:"STOP,UNSUBSCRIBE",optOutMessage:`You have opted out of ${l.name} messages. Reply START to opt in again.`,helpKeywords:"HELP,INFO",businessRegistrationNumber:o,businessRegistrationType:"EIN",businessRegistrationCountry:"US",entityType:"PRIVATE_PROFIT",additionalInformation:a,helpMessageResponse:`For help, reply HELP or call ${d}.`,optInConfirmationResponse:`Thanks for subscribing to ${l.name} updates.`};i.push("Submitting toll-free verification to Telnyx");let u=await submitTollFreeVerification(c);if(!u.success||!u.data)return i.push(`Toll-free verification failed: ${u.error||"unknown"}`),{success:!1,error:`Toll-free verification failed: ${u.error}`,log:i};s=u.data.id,i.push(`Toll-free verification request created: ${s}`),await t.from("company_telnyx_settings").upsert({company_id:e,toll_free_verification_request_id:s,toll_free_verification_status:"pending",toll_free_verification_submitted_at:new Date().toISOString()})}if(g.length>0){i.push("Attempting 10DLC registration");let t=await u(e);if(t.success)n=t.brandId,a=t.campaignId,i.push(`10DLC registration completed: brand=${n}, campaign=${a}`);else if(t.error?.includes("403")||t.error?.includes("verifications required")){if(o="10DLC requires Level 2 verification (see /TELNYX_PLATFORM_SETUP.md). Toll-free verification will proceed.",console.warn(o),i.push(o),0===f.length)return{success:!1,error:"Platform setup required: Your Telnyx account needs Level 2 verification to enable 10DLC registration for local numbers. Alternative: Add toll-free numbers which work immediately without Level 2 verification. See /TELNYX_PLATFORM_SETUP.md for details.",requiresPlatformSetup:!0,log:i}}else if(o=`10DLC registration failed: ${t.error}`,console.error(o),i.push(o),0===f.length)return{success:!1,error:o,log:i}}if(l.email)try{await (0,r.sendVerificationSubmittedEmail)(e,l.email,{hasTollFreeNumbers:f.length>0,has10DLCNumbers:g.length>0,tollFreeCount:f.length,dlcCount:g.length}),i.push("Verification submitted email sent")}catch(e){console.error("Failed to send verification email:",e),i.push(`Failed to send verification email: ${e instanceof Error?e.message:e}`)}let C=[];return s&&C.push(`âœ… Toll-free verification submitted (${f.length} number${f.length>1?"s":""}) - Approval in 5-7 business days`),n&&a&&C.push(`âœ… 10DLC registration completed (${g.length} number${g.length>1?"s":""}) - Active immediately`),o&&C.push(`âš ï¸ ${o}`),i.push(...C),{success:!0,tollFreeRequestId:s,brandId:n,campaignId:a,message:C.join(". "),log:i}}catch(e){return i.push(`Unhandled verification error: ${e instanceof Error?e.message:e}`),{success:!1,error:e instanceof Error?e.message:"Failed to submit verification",log:i}}}[r]=d.then?(await d)():d,(0,c.ensureServerEntryExports)([u,m,f]),(0,s.registerServerReference)(u,"40ae25402a089e45aa071d979e8cc6ad136205cc98",null),(0,s.registerServerReference)(m,"007505a78985e53e083a498c97761ed8a463d3d379",null),(0,s.registerServerReference)(f,"4087f0badccd6aaf6a28b640ab4bbc513f0832d105",null),e.s(["checkTelnyxVerificationStatus",()=>m,"registerCompanyFor10DLC",()=>u,"submitAutomatedVerification",()=>f]),i()}catch(e){i(e)}},!1)];

//# sourceMappingURL=apps_web_7b2fec1c._.js.map