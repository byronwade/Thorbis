module.exports=[951615,(t,e,r)=>{e.exports=t.x("node:buffer",()=>require("node:buffer"))},333085,t=>{"use strict";var e=t.i(951615);async function r(t){try{let r=process.env.TELNYX_API_KEY;if(!r)return{success:!1,error:"TELNYX_API_KEY is not configured"};let n=t.username.replace(/[^a-zA-Z0-9]/g,""),s=n.length>0?n:e.Buffer.from(t.username||"user").toString("hex"),o=Date.now().toString(36),i=Math.max(1,64-o.length),c=s.slice(0,i),u=`${c}${o}`,l=await fetch("https://api.telnyx.com/v2/credential_connections",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}});if(l.ok){let t=await l.json();if(t.data&&Array.isArray(t.data))for(let e of t.data.filter(t=>t.connection_name?.startsWith(c)))try{await fetch(`https://api.telnyx.com/v2/credential_connections/${e.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}})}catch(t){}}let d=a(32),p=await fetch("https://api.telnyx.com/v2/credential_connections",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({connection_name:u,user_name:u,password:d,ttl:t.ttl||86400})});if(!p.ok){let e=await p.text(),n=a(32),s=await fetch("https://api.telnyx.com/v2/texml_credentials",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({connection_name:u,user_name:u,password:n})});if(!s.ok)throw await s.text(),Error(`Telnyx API error: ${p.status} - ${e}`);let o=await s.json(),i={username:o.data?.user_name||u,password:o.data?.password||n,expires_at:Date.now()+1e3*(t.ttl||86400),realm:"sip.telnyx.com",sip_uri:`sip:${u}@sip.telnyx.com`,stun_servers:["stun:stun.telnyx.com:3478","stun:stun.telnyx.com:3479"],turn_servers:[{urls:["turn:turn.telnyx.com:3478?transport=udp","turn:turn.telnyx.com:3478?transport=tcp"],username:o.data?.user_name||u,credential:o.data?.password||a(24)}]};return{success:!0,credential:i}}let m=await p.json(),h={username:m.data?.user_name||u,password:m.data?.password||d,expires_at:m.data?.expires_at?new Date(m.data.expires_at).getTime():Date.now()+1e3*(t.ttl||86400),realm:m.data?.realm||"sip.telnyx.com",sip_uri:m.data?.sip_uri||`sip:${u}@sip.telnyx.com`,stun_servers:m.data?.ice_servers?.stun||["stun:stun.telnyx.com:3478","stun:stun.telnyx.com:3479"],turn_servers:m.data?.ice_servers?.turn||[{urls:["turn:turn.telnyx.com:3478?transport=udp","turn:turn.telnyx.com:3478?transport=tcp"],username:m.data?.user_name||u,credential:m.data?.password}]};return{success:!0,credential:h}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to generate WebRTC token"}}}function a(t=32){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*",r="";for(let a=0;a<t;a++)r+=e.charAt(Math.floor(Math.random()*e.length));return r}t.s(["generateWebRTCToken",()=>r])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__d1ab72d3._.js.map