module.exports=[413526,e=>{"use strict";var t=e.i(755535),o=e.i(377233),r=e.i(490003),s=e.i(492991),a=e.i(241970),n=e.i(357699),i=e.i(212454),l=e.i(48717),d=e.i(798301),u=e.i(986366),c=e.i(983537),p=e.i(147475),g=e.i(561930),h=e.i(803747),m=e.i(368557),y=e.i(42037),f=e.i(193695);e.i(432036);var R=e.i(573881),v=e.i(297676),w=e.i(443608);e.i(715051);var b=e.i(511368);let _="Stratos-FMS/1.0 (support@stratos.app)";w.z.object({longName:w.z.string(),shortName:w.z.string(),types:w.z.array(w.z.string())}),w.z.object({location:w.z.object({lat:w.z.number(),lng:w.z.number()}),locationType:w.z.enum(["ROOFTOP","RANGE_INTERPOLATED","GEOMETRIC_CENTER","APPROXIMATE"]),viewport:w.z.object({northeast:w.z.object({lat:w.z.number(),lng:w.z.number()}),southwest:w.z.object({lat:w.z.number(),lng:w.z.number()})}),bounds:w.z.object({northeast:w.z.object({lat:w.z.number(),lng:w.z.number()}),southwest:w.z.object({lat:w.z.number(),lng:w.z.number()})}).optional()});class E{apiKey;forwardCache=new Map;reverseCache=new Map;cacheTTL=2592e6;constructor(){this.apiKey=process.env.GOOGLE_API_KEY||process.env.GOOGLE_MAPS_API_KEY}async geocode(e,t={}){if(!this.apiKey)return console.warn("Google Geocoding API key not configured"),null;let o=`fwd:${e}:${JSON.stringify(t)}`,r=this.forwardCache.get(o);if(r&&Date.now()-r.timestamp<this.cacheTTL)return r.data;try{let r=new URLSearchParams({address:e,key:this.apiKey});if(t.bounds&&r.set("bounds",`${t.bounds.southwest.lat},${t.bounds.southwest.lng}|${t.bounds.northeast.lat},${t.bounds.northeast.lng}`),t.region&&r.set("region",t.region),t.components){let e=[];t.components.country&&e.push(`country:${t.components.country}`),t.components.postalCode&&e.push(`postal_code:${t.components.postalCode}`),t.components.administrativeArea&&e.push(`administrative_area:${t.components.administrativeArea}`),t.components.locality&&e.push(`locality:${t.components.locality}`),t.components.route&&e.push(`route:${t.components.route}`),e.length>0&&r.set("components",e.join("|"))}t.language&&r.set("language",t.language);let s=`https://maps.googleapis.com/maps/api/geocode/json?${r.toString()}`,a=await fetch(s,{headers:{"User-Agent":_}});if(!a.ok)return console.error("Geocoding API error:",a.status),null;let n=await a.json();if("OK"!==n.status&&"ZERO_RESULTS"!==n.status)return console.error("Geocoding API status:",n.status,n.error_message),null;if(!n.results||0===n.results.length)return[];let i=n.results.map(e=>({placeId:e.place_id,formattedAddress:e.formatted_address,latitude:e.geometry.location.lat,longitude:e.geometry.location.lng,locationType:e.geometry.location_type,types:e.types,addressComponents:(e.address_components||[]).map(e=>({longName:e.long_name,shortName:e.short_name,types:e.types})),viewport:{northeast:e.geometry.viewport.northeast,southwest:e.geometry.viewport.southwest},plusCode:e.plus_code?.global_code,partialMatch:e.partial_match}));return this.forwardCache.set(o,{data:i,timestamp:Date.now()}),i}catch(e){return console.error("Geocoding error:",e),null}}async reverseGeocode(e,t,o={}){if(!this.apiKey)return console.warn("Google Geocoding API key not configured"),null;let r=`rev:${e.toFixed(6)},${t.toFixed(6)}:${JSON.stringify(o)}`,s=this.reverseCache.get(r);if(s&&Date.now()-s.timestamp<this.cacheTTL)return s.data;try{let s=new URLSearchParams({latlng:`${e},${t}`,key:this.apiKey});o.resultTypes&&o.resultTypes.length>0&&s.set("result_type",o.resultTypes.join("|")),o.locationTypes&&o.locationTypes.length>0&&s.set("location_type",o.locationTypes.join("|")),o.language&&s.set("language",o.language);let a=`https://maps.googleapis.com/maps/api/geocode/json?${s.toString()}`,n=await fetch(a,{headers:{"User-Agent":_}});if(!n.ok)return console.error("Reverse geocoding API error:",n.status),null;let i=await n.json();if("OK"!==i.status&&"ZERO_RESULTS"!==i.status)return console.error("Reverse geocoding API status:",i.status,i.error_message),null;if(!i.results||0===i.results.length)return[];let l=i.results.map(e=>({placeId:e.place_id,formattedAddress:e.formatted_address,latitude:e.geometry.location.lat,longitude:e.geometry.location.lng,locationType:e.geometry.location_type,types:e.types,addressComponents:(e.address_components||[]).map(e=>({longName:e.long_name,shortName:e.short_name,types:e.types})),viewport:{northeast:e.geometry.viewport.northeast,southwest:e.geometry.viewport.southwest},plusCode:e.plus_code?.global_code}));return this.reverseCache.set(r,{data:l,timestamp:Date.now()}),l}catch(e){return console.error("Reverse geocoding error:",e),null}}async geocodeSingle(e,t={}){let o=await this.geocode(e,t);return o&&o.length>0?o[0]:null}async reverseGeocodeSingle(e,t,o={}){let r=await this.reverseGeocode(e,t,o);return r&&r.length>0?r[0]:null}parseAddress(e){let t=(t,o=!1)=>{let r=e.addressComponents.find(e=>e.types.includes(t));return r?o?r.shortName:r.longName:void 0};return{streetNumber:t("street_number"),street:t("route"),neighborhood:t("neighborhood")||t("sublocality_level_1"),city:t("locality")||t("sublocality_level_1")||t("administrative_area_level_2"),county:t("administrative_area_level_2"),state:t("administrative_area_level_1"),stateCode:t("administrative_area_level_1",!0),postalCode:t("postal_code"),postalCodeSuffix:t("postal_code_suffix"),country:t("country"),countryCode:t("country",!0),formattedAddress:e.formattedAddress,latitude:e.latitude,longitude:e.longitude,placeId:e.placeId,accuracy:e.locationType}}async geocodeAndParse(e,t={}){let o=await this.geocodeSingle(e,t);return o?this.parseAddress(o):null}async reverseGeocodeAndParse(e,t,o={}){let r=await this.reverseGeocodeSingle(e,t,o);return r?this.parseAddress(r):null}async batchGeocode(e,t={}){let o=new Map;for(let r=0;r<e.length;r+=10){let s=e.slice(r,r+10).map(async e=>{let r=await this.geocodeSingle(e,t);o.set(e,r)});await Promise.all(s)}return o}async getCoordinates(e,t={}){let o=await this.geocodeSingle(e,t);return o?{latitude:o.latitude,longitude:o.longitude}:null}async getAddress(e,t,o={}){let r=await this.reverseGeocodeSingle(e,t,o);return r?.formattedAddress||null}isConfigured(){return!!this.apiKey}clearCache(){this.forwardCache.clear(),this.reverseCache.clear()}}let z=new E,C=w.z.object({northeast:w.z.object({lat:w.z.number(),lng:w.z.number()}),southwest:w.z.object({lat:w.z.number(),lng:w.z.number()})}).optional(),A=w.z.object({country:w.z.string().optional(),postalCode:w.z.string().optional(),administrativeArea:w.z.string().optional(),locality:w.z.string().optional(),route:w.z.string().optional()}).optional(),N=w.z.object({bounds:C,region:w.z.string().optional(),components:A,language:w.z.string().optional()}).optional(),j=w.z.object({resultTypes:w.z.array(w.z.string()).optional(),locationTypes:w.z.array(w.z.enum(["ROOFTOP","RANGE_INTERPOLATED","GEOMETRIC_CENTER","APPROXIMATE"])).optional(),language:w.z.string().optional()}).optional(),x=w.z.object({action:w.z.literal("geocode"),address:w.z.string().min(1),options:N}),T=w.z.object({action:w.z.literal("reverse"),latitude:w.z.number(),longitude:w.z.number(),options:j}),P=w.z.object({action:w.z.literal("batch"),addresses:w.z.array(w.z.string().min(1)).min(1).max(100),options:N}),O=w.z.object({action:w.z.literal("coordinates"),address:w.z.string().min(1),options:N}),S=w.z.object({action:w.z.literal("address"),latitude:w.z.number(),longitude:w.z.number(),options:j}),G=w.z.object({action:w.z.literal("parse"),address:w.z.string().min(1),options:N}),I=w.z.discriminatedUnion("action",[x,T,P,O,S,G]);async function U(e){try{let t=await (0,b.createClient)(),{data:{user:o}}=await t.auth.getUser();if(!o)return v.NextResponse.json({error:"Unauthorized"},{status:401});if(!z.isConfigured())return v.NextResponse.json({error:"Geocoding service is not configured. Set GOOGLE_API_KEY environment variable."},{status:503});let{searchParams:r}=new URL(e.url),s=r.get("address"),a=r.get("lat"),n=r.get("lng"),i=r.get("region");if(s){let e=await z.geocodeSingle(s,{region:i||void 0});if(!e)return v.NextResponse.json({error:"Could not geocode address"},{status:404});return v.NextResponse.json({success:!0,data:e})}if(a&&n){let e=await z.reverseGeocodeSingle(Number.parseFloat(a),Number.parseFloat(n));if(!e)return v.NextResponse.json({error:"Could not reverse geocode location"},{status:404});return v.NextResponse.json({success:!0,data:e})}return v.NextResponse.json({error:"Either address or lat/lng parameters required"},{status:400})}catch(e){return console.error("Geocoding GET error:",e),v.NextResponse.json({error:"Failed to geocode",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function $(e){try{let t=await (0,b.createClient)(),{data:{user:o}}=await t.auth.getUser();if(!o)return v.NextResponse.json({error:"Unauthorized"},{status:401});if(!z.isConfigured())return v.NextResponse.json({error:"Geocoding service is not configured. Set GOOGLE_API_KEY environment variable."},{status:503});let r=await e.json(),s=I.parse(r);switch(s.action){case"geocode":{let e=await z.geocode(s.address,s.options||{});if(!e)return v.NextResponse.json({error:"Geocoding failed"},{status:500});return v.NextResponse.json({success:!0,data:{results:e,count:e.length}})}case"reverse":{let e=await z.reverseGeocode(s.latitude,s.longitude,s.options||{});if(!e)return v.NextResponse.json({error:"Reverse geocoding failed"},{status:500});return v.NextResponse.json({success:!0,data:{results:e,count:e.length}})}case"batch":{let e=await z.batchGeocode(s.addresses,s.options||{}),t={};return e.forEach((e,o)=>{t[o]=e}),v.NextResponse.json({success:!0,data:{results:t,count:e.size,successful:Array.from(e.values()).filter(e=>null!==e).length}})}case"coordinates":{let e=await z.getCoordinates(s.address,s.options||{});if(!e)return v.NextResponse.json({error:"Could not get coordinates for address"},{status:404});return v.NextResponse.json({success:!0,data:e})}case"address":{let e=await z.getAddress(s.latitude,s.longitude,s.options||{});if(!e)return v.NextResponse.json({error:"Could not get address for coordinates"},{status:404});return v.NextResponse.json({success:!0,data:{address:e}})}case"parse":{let e=await z.geocodeAndParse(s.address,s.options||{});if(!e)return v.NextResponse.json({error:"Could not geocode and parse address"},{status:404});return v.NextResponse.json({success:!0,data:e})}default:return v.NextResponse.json({error:"Invalid action"},{status:400})}}catch(e){if(console.error("Geocoding API error:",e),e instanceof w.z.ZodError)return v.NextResponse.json({error:"Invalid request data",details:e.errors},{status:400});return v.NextResponse.json({error:"Failed to process geocoding request",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}e.s(["GET",()=>U,"POST",()=>$],23842);var M=e.i(23842);let k=new t.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/geocode/route",pathname:"/api/geocode",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/geocode/route.ts",nextConfigOutput:"",userland:M}),{workAsyncStorage:K,workUnitAsyncStorage:D,serverHooks:L}=k;function q(){return(0,r.patchFetch)({workAsyncStorage:K,workUnitAsyncStorage:D})}async function F(e,t,r){k.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/geocode/route";v=v.replace(/\/index$/,"")||"/";let w=await k.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:b,params:_,nextConfig:E,parsedUrl:z,isDraftMode:C,prerenderManifest:A,routerServerContext:N,isOnDemandRevalidate:j,revalidateOnlyGenerated:x,resolvedPathname:T,clientReferenceManifest:P,serverActionsManifest:O}=w,S=(0,l.normalizeAppPath)(v),G=!!(A.dynamicRoutes[S]||A.routes[T]),I=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,z,!1):t.end("This page could not be found"),null);if(G&&!C){let e=!!A.routes[T],t=A.dynamicRoutes[S];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await I();throw new f.NoFallbackError}}let U=null;!G||k.isDev||C||(U="/index"===(U=T)?"/":U);let $=!0===k.isDev||!G,M=G&&!$;O&&P&&(0,n.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:P,serverActionsManifest:O,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:O})});let K=e.method||"GET",D=(0,a.getTracer)(),L=D.getActiveScopeSpan(),q={params:_,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,o,r)=>k.onRequestError(e,t,r,N)},sharedContext:{buildId:b}},F=new d.NodeNextRequest(e),H=new d.NodeNextResponse(t),B=u.NextRequestAdapter.fromNodeNextRequest(F,(0,u.signalFromNodeResponse)(t));try{let n=async e=>k.handle(B,q).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let o=D.getRootSpanAttributes();if(!o)return;if(o.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${o.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=o.get("next.route");if(r){let t=`${K} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${K} ${v}`)}),i=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var a,l;let d=async({previousCacheEntry:o})=>{try{if(!i&&j&&x&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await n(s);e.fetchMetrics=q.renderOpts.fetchMetrics;let l=q.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let d=q.renderOpts.collectedTags;if(!G)return await (0,g.sendResponse)(F,H,a,q.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(a.headers);d&&(t[y.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let o=void 0!==q.renderOpts.collectedRevalidate&&!(q.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&q.renderOpts.collectedRevalidate,r=void 0===q.renderOpts.collectedExpire||q.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:q.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:o,expire:r}}}}catch(t){throw(null==o?void 0:o.isStale)&&await k.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:j})},N),t}},u=await k.handleResponse({req:e,nextConfig:E,cacheKey:U,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:j,revalidateOnlyGenerated:x,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:i});if(!G)return null;if((null==u||null==(a=u.value)?void 0:a.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",j?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return i&&G||c.delete(y.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,m.getCacheControlHeader)(u.cacheControl)),await (0,g.sendResponse)(F,H,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};L?await l(L):await D.withPropagatedContext(e.headers,()=>D.trace(c.BaseServerSpan.handleRequest,{spanName:`${K} ${v}`,kind:a.SpanKind.SERVER,attributes:{"http.method":K,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await k.onRequestError(e,t,{routerKind:"App Router",routePath:S,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:j})}),G)throw t;return await (0,g.sendResponse)(F,H,new Response(null,{status:500})),null}}e.s(["handler",()=>F,"patchFetch",()=>q,"routeModule",()=>k,"serverHooks",()=>L,"workAsyncStorage",()=>K,"workUnitAsyncStorage",()=>D],413526)}];

//# sourceMappingURL=3c0ae_next_dist_esm_build_templates_app-route_c6d79fbe.js.map