module.exports=[413526,e=>{"use strict";var t=e.i(755535),o=e.i(377233),r=e.i(490003),s=e.i(492991),a=e.i(241970),n=e.i(357699),i=e.i(212454),l=e.i(48717),c=e.i(798301),d=e.i(986366),u=e.i(983537),p=e.i(147475),g=e.i(561930),m=e.i(803747),h=e.i(368557),y=e.i(42037),w=e.i(193695);e.i(432036);var f=e.i(573881);e.i(715051);var v=e.i(511368),R=e.i(297676),b=e.i(443608),T=e.i(278378);let _="Stratos-FMS/1.0 (support@stratos.app)";b.z.object({longName:b.z.string(),shortName:b.z.string(),types:b.z.array(b.z.string())}),b.z.object({location:b.z.object({lat:b.z.number(),lng:b.z.number()}),locationType:b.z.enum(["ROOFTOP","RANGE_INTERPOLATED","GEOMETRIC_CENTER","APPROXIMATE"]),viewport:b.z.object({northeast:b.z.object({lat:b.z.number(),lng:b.z.number()}),southwest:b.z.object({lat:b.z.number(),lng:b.z.number()})}),bounds:b.z.object({northeast:b.z.object({lat:b.z.number(),lng:b.z.number()}),southwest:b.z.object({lat:b.z.number(),lng:b.z.number()})}).optional()});class C{apiKey;forwardCache=new Map;reverseCache=new Map;cacheTTL=2592e6;constructor(){this.apiKey=process.env.GOOGLE_API_KEY||process.env.GOOGLE_MAPS_API_KEY}async geocode(e,t={}){if(!this.apiKey)return console.warn("Google Geocoding API key not configured"),null;let o=`fwd:${e}:${JSON.stringify(t)}`,r=this.forwardCache.get(o);if(r&&Date.now()-r.timestamp<this.cacheTTL)return r.data;let s=Date.now();try{let r=new URLSearchParams({address:e,key:this.apiKey});if(t.bounds&&r.set("bounds",`${t.bounds.southwest.lat},${t.bounds.southwest.lng}|${t.bounds.northeast.lat},${t.bounds.northeast.lng}`),t.region&&r.set("region",t.region),t.components){let e=[];t.components.country&&e.push(`country:${t.components.country}`),t.components.postalCode&&e.push(`postal_code:${t.components.postalCode}`),t.components.administrativeArea&&e.push(`administrative_area:${t.components.administrativeArea}`),t.components.locality&&e.push(`locality:${t.components.locality}`),t.components.route&&e.push(`route:${t.components.route}`),e.length>0&&r.set("components",e.join("|"))}t.language&&r.set("language",t.language);let a=`https://maps.googleapis.com/maps/api/geocode/json?${r.toString()}`,n=await fetch(a,{headers:{"User-Agent":_}});if(!n.ok)return console.error("Geocoding API error:",n.status),t.companyId&&T.googleMapsTracker.track("geocode",t.companyId,{success:!1,responseTimeMs:Date.now()-s,errorMessage:`HTTP ${n.status}`}).catch(()=>{}),null;let i=await n.json();if("OK"!==i.status&&"ZERO_RESULTS"!==i.status)return console.error("Geocoding API status:",i.status,i.error_message),t.companyId&&T.googleMapsTracker.track("geocode",t.companyId,{success:!1,responseTimeMs:Date.now()-s,errorMessage:i.status}).catch(()=>{}),null;if(!i.results||0===i.results.length)return t.companyId&&T.googleMapsTracker.track("geocode",t.companyId,{success:!0,responseTimeMs:Date.now()-s,estimatedCostCents:.5}).catch(()=>{}),[];let l=i.results.map(e=>({placeId:e.place_id,formattedAddress:e.formatted_address,latitude:e.geometry.location.lat,longitude:e.geometry.location.lng,locationType:e.geometry.location_type,types:e.types,addressComponents:(e.address_components||[]).map(e=>({longName:e.long_name,shortName:e.short_name,types:e.types})),viewport:{northeast:e.geometry.viewport.northeast,southwest:e.geometry.viewport.southwest},plusCode:e.plus_code?.global_code,partialMatch:e.partial_match}));return this.forwardCache.set(o,{data:l,timestamp:Date.now()}),t.companyId&&T.googleMapsTracker.track("geocode",t.companyId,{success:!0,responseTimeMs:Date.now()-s,estimatedCostCents:.5}).catch(()=>{}),l}catch(e){return console.error("Geocoding error:",e),t.companyId&&T.googleMapsTracker.track("geocode",t.companyId,{success:!1,responseTimeMs:Date.now()-s,errorMessage:e instanceof Error?e.message:"Unknown error"}).catch(()=>{}),null}}async reverseGeocode(e,t,o={}){if(!this.apiKey)return console.warn("Google Geocoding API key not configured"),null;let r=`rev:${e.toFixed(6)},${t.toFixed(6)}:${JSON.stringify(o)}`,s=this.reverseCache.get(r);if(s&&Date.now()-s.timestamp<this.cacheTTL)return s.data;let a=Date.now();try{let s=new URLSearchParams({latlng:`${e},${t}`,key:this.apiKey});o.resultTypes&&o.resultTypes.length>0&&s.set("result_type",o.resultTypes.join("|")),o.locationTypes&&o.locationTypes.length>0&&s.set("location_type",o.locationTypes.join("|")),o.language&&s.set("language",o.language);let n=`https://maps.googleapis.com/maps/api/geocode/json?${s.toString()}`,i=await fetch(n,{headers:{"User-Agent":_}});if(!i.ok)return console.error("Reverse geocoding API error:",i.status),o.companyId&&T.googleMapsTracker.track("reverse_geocode",o.companyId,{success:!1,responseTimeMs:Date.now()-a,errorMessage:`HTTP ${i.status}`}).catch(()=>{}),null;let l=await i.json();if("OK"!==l.status&&"ZERO_RESULTS"!==l.status)return console.error("Reverse geocoding API status:",l.status,l.error_message),o.companyId&&T.googleMapsTracker.track("reverse_geocode",o.companyId,{success:!1,responseTimeMs:Date.now()-a,errorMessage:l.status}).catch(()=>{}),null;if(!l.results||0===l.results.length)return o.companyId&&T.googleMapsTracker.track("reverse_geocode",o.companyId,{success:!0,responseTimeMs:Date.now()-a,estimatedCostCents:.5}).catch(()=>{}),[];let c=l.results.map(e=>({placeId:e.place_id,formattedAddress:e.formatted_address,latitude:e.geometry.location.lat,longitude:e.geometry.location.lng,locationType:e.geometry.location_type,types:e.types,addressComponents:(e.address_components||[]).map(e=>({longName:e.long_name,shortName:e.short_name,types:e.types})),viewport:{northeast:e.geometry.viewport.northeast,southwest:e.geometry.viewport.southwest},plusCode:e.plus_code?.global_code}));return this.reverseCache.set(r,{data:c,timestamp:Date.now()}),o.companyId&&T.googleMapsTracker.track("reverse_geocode",o.companyId,{success:!0,responseTimeMs:Date.now()-a,estimatedCostCents:.5}).catch(()=>{}),c}catch(e){return console.error("Reverse geocoding error:",e),o.companyId&&T.googleMapsTracker.track("reverse_geocode",o.companyId,{success:!1,responseTimeMs:Date.now()-a,errorMessage:e instanceof Error?e.message:"Unknown error"}).catch(()=>{}),null}}async geocodeSingle(e,t={}){let o=await this.geocode(e,t);return o&&o.length>0?o[0]:null}async reverseGeocodeSingle(e,t,o={}){let r=await this.reverseGeocode(e,t,o);return r&&r.length>0?r[0]:null}parseAddress(e){let t=(t,o=!1)=>{let r=e.addressComponents.find(e=>e.types.includes(t));return r?o?r.shortName:r.longName:void 0};return{streetNumber:t("street_number"),street:t("route"),neighborhood:t("neighborhood")||t("sublocality_level_1"),city:t("locality")||t("sublocality_level_1")||t("administrative_area_level_2"),county:t("administrative_area_level_2"),state:t("administrative_area_level_1"),stateCode:t("administrative_area_level_1",!0),postalCode:t("postal_code"),postalCodeSuffix:t("postal_code_suffix"),country:t("country"),countryCode:t("country",!0),formattedAddress:e.formattedAddress,latitude:e.latitude,longitude:e.longitude,placeId:e.placeId,accuracy:e.locationType}}async geocodeAndParse(e,t={}){let o=await this.geocodeSingle(e,t);return o?this.parseAddress(o):null}async reverseGeocodeAndParse(e,t,o={}){let r=await this.reverseGeocodeSingle(e,t,o);return r?this.parseAddress(r):null}async batchGeocode(e,t={}){let o=new Map;for(let r=0;r<e.length;r+=10){let s=e.slice(r,r+10).map(async e=>{let r=await this.geocodeSingle(e,t);o.set(e,r)});await Promise.all(s)}return o}async getCoordinates(e,t={}){let o=await this.geocodeSingle(e,t);return o?{latitude:o.latitude,longitude:o.longitude}:null}async getAddress(e,t,o={}){let r=await this.reverseGeocodeSingle(e,t,o);return r?.formattedAddress||null}isConfigured(){return!!this.apiKey}clearCache(){this.forwardCache.clear(),this.reverseCache.clear()}}let E=new C,z=b.z.object({northeast:b.z.object({lat:b.z.number(),lng:b.z.number()}),southwest:b.z.object({lat:b.z.number(),lng:b.z.number()})}).optional(),A=b.z.object({country:b.z.string().optional(),postalCode:b.z.string().optional(),administrativeArea:b.z.string().optional(),locality:b.z.string().optional(),route:b.z.string().optional()}).optional(),N=b.z.object({bounds:z,region:b.z.string().optional(),components:A,language:b.z.string().optional()}).optional(),j=b.z.object({resultTypes:b.z.array(b.z.string()).optional(),locationTypes:b.z.array(b.z.enum(["ROOFTOP","RANGE_INTERPOLATED","GEOMETRIC_CENTER","APPROXIMATE"])).optional(),language:b.z.string().optional()}).optional(),x=b.z.object({action:b.z.literal("geocode"),address:b.z.string().min(1),options:N}),I=b.z.object({action:b.z.literal("reverse"),latitude:b.z.number(),longitude:b.z.number(),options:j}),M=b.z.object({action:b.z.literal("batch"),addresses:b.z.array(b.z.string().min(1)).min(1).max(100),options:N}),P=b.z.object({action:b.z.literal("coordinates"),address:b.z.string().min(1),options:N}),O=b.z.object({action:b.z.literal("address"),latitude:b.z.number(),longitude:b.z.number(),options:j}),S=b.z.object({action:b.z.literal("parse"),address:b.z.string().min(1),options:N}),k=b.z.discriminatedUnion("action",[x,I,M,P,O,S]);async function G(e){try{let t=await (0,v.createClient)(),{data:{user:o}}=await t.auth.getUser();if(!o)return R.NextResponse.json({error:"Unauthorized"},{status:401});if(!E.isConfigured())return R.NextResponse.json({error:"Geocoding service is not configured. Set GOOGLE_API_KEY environment variable."},{status:503});let{searchParams:r}=new URL(e.url),s=r.get("address"),a=r.get("lat"),n=r.get("lng"),i=r.get("region");if(s){let e=await E.geocodeSingle(s,{region:i||void 0});if(!e)return R.NextResponse.json({error:"Could not geocode address"},{status:404});return R.NextResponse.json({success:!0,data:e})}if(a&&n){let e=await E.reverseGeocodeSingle(Number.parseFloat(a),Number.parseFloat(n));if(!e)return R.NextResponse.json({error:"Could not reverse geocode location"},{status:404});return R.NextResponse.json({success:!0,data:e})}return R.NextResponse.json({error:"Either address or lat/lng parameters required"},{status:400})}catch(e){return console.error("Geocoding GET error:",e),R.NextResponse.json({error:"Failed to geocode",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function U(e){try{let t=await (0,v.createClient)(),{data:{user:o}}=await t.auth.getUser();if(!o)return R.NextResponse.json({error:"Unauthorized"},{status:401});if(!E.isConfigured())return R.NextResponse.json({error:"Geocoding service is not configured. Set GOOGLE_API_KEY environment variable."},{status:503});let r=await e.json(),s=k.parse(r);switch(s.action){case"geocode":{let e=await E.geocode(s.address,s.options||{});if(!e)return R.NextResponse.json({error:"Geocoding failed"},{status:500});return R.NextResponse.json({success:!0,data:{results:e,count:e.length}})}case"reverse":{let e=await E.reverseGeocode(s.latitude,s.longitude,s.options||{});if(!e)return R.NextResponse.json({error:"Reverse geocoding failed"},{status:500});return R.NextResponse.json({success:!0,data:{results:e,count:e.length}})}case"batch":{let e=await E.batchGeocode(s.addresses,s.options||{}),t={};return e.forEach((e,o)=>{t[o]=e}),R.NextResponse.json({success:!0,data:{results:t,count:e.size,successful:Array.from(e.values()).filter(e=>null!==e).length}})}case"coordinates":{let e=await E.getCoordinates(s.address,s.options||{});if(!e)return R.NextResponse.json({error:"Could not get coordinates for address"},{status:404});return R.NextResponse.json({success:!0,data:e})}case"address":{let e=await E.getAddress(s.latitude,s.longitude,s.options||{});if(!e)return R.NextResponse.json({error:"Could not get address for coordinates"},{status:404});return R.NextResponse.json({success:!0,data:{address:e}})}case"parse":{let e=await E.geocodeAndParse(s.address,s.options||{});if(!e)return R.NextResponse.json({error:"Could not geocode and parse address"},{status:404});return R.NextResponse.json({success:!0,data:e})}default:return R.NextResponse.json({error:"Invalid action"},{status:400})}}catch(e){if(console.error("Geocoding API error:",e),e instanceof b.z.ZodError)return R.NextResponse.json({error:"Invalid request data",details:e.errors},{status:400});return R.NextResponse.json({error:"Failed to process geocoding request",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}e.s(["GET",()=>G,"POST",()=>U],23842);var D=e.i(23842);let $=new t.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/geocode/route",pathname:"/api/geocode",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/geocode/route.ts",nextConfigOutput:"",userland:D}),{workAsyncStorage:K,workUnitAsyncStorage:H,serverHooks:L}=$;function q(){return(0,r.patchFetch)({workAsyncStorage:K,workUnitAsyncStorage:H})}async function F(e,t,r){$.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/geocode/route";v=v.replace(/\/index$/,"")||"/";let R=await $.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:b,params:T,nextConfig:_,parsedUrl:C,isDraftMode:E,prerenderManifest:z,routerServerContext:A,isOnDemandRevalidate:N,revalidateOnlyGenerated:j,resolvedPathname:x,clientReferenceManifest:I,serverActionsManifest:M}=R,P=(0,l.normalizeAppPath)(v),O=!!(z.dynamicRoutes[P]||z.routes[x]),S=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,C,!1):t.end("This page could not be found"),null);if(O&&!E){let e=!!z.routes[x],t=z.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(_.experimental.adapterPath)return await S();throw new w.NoFallbackError}}let k=null;!O||$.isDev||E||(k="/index"===(k=x)?"/":k);let G=!0===$.isDev||!O,U=O&&!G;M&&I&&(0,n.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:I,serverActionsManifest:M,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:M})});let D=e.method||"GET",K=(0,a.getTracer)(),H=K.getActiveScopeSpan(),L={params:T,prerenderManifest:z,renderOpts:{experimental:{authInterrupts:!!_.experimental.authInterrupts},cacheComponents:!!_.cacheComponents,supportsDynamicResponse:G,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:_.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,o,r)=>$.onRequestError(e,t,r,A)},sharedContext:{buildId:b}},q=new c.NodeNextRequest(e),F=new c.NodeNextResponse(t),B=d.NextRequestAdapter.fromNodeNextRequest(q,(0,d.signalFromNodeResponse)(t));try{let n=async e=>$.handle(B,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let o=K.getRootSpanAttributes();if(!o)return;if(o.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${o.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=o.get("next.route");if(r){let t=`${D} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${D} ${v}`)}),i=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var a,l;let c=async({previousCacheEntry:o})=>{try{if(!i&&N&&j&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await n(s);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let c=L.renderOpts.collectedTags;if(!O)return await (0,g.sendResponse)(q,F,a,L.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(a.headers);c&&(t[y.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let o=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,r=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:o,expire:r}}}}catch(t){throw(null==o?void 0:o.isStale)&&await $.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:N})},A),t}},d=await $.handleResponse({req:e,nextConfig:_,cacheKey:k,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:z,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:j,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:i});if(!O)return null;if((null==d||null==(a=d.value)?void 0:a.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",N?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&O||u.delete(y.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,h.getCacheControlHeader)(d.cacheControl)),await (0,g.sendResponse)(q,F,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};H?await l(H):await K.withPropagatedContext(e.headers,()=>K.trace(u.BaseServerSpan.handleRequest,{spanName:`${D} ${v}`,kind:a.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},l))}catch(t){if(t instanceof w.NoFallbackError||await $.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:N})}),O)throw t;return await (0,g.sendResponse)(q,F,new Response(null,{status:500})),null}}e.s(["handler",()=>F,"patchFetch",()=>q,"routeModule",()=>$,"serverHooks",()=>L,"workAsyncStorage",()=>K,"workUnitAsyncStorage",()=>H],413526)}];

//# sourceMappingURL=3c0ae_next_dist_esm_build_templates_app-route_c6d79fbe.js.map