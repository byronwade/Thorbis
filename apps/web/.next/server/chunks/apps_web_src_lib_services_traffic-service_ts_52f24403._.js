module.exports=[136200,e=>{"use strict";var t=e.i(443608);let n=t.z.object({type:t.z.enum(["crash","construction","road_closed","police","congestion","other"]),severity:t.z.enum(["minor","moderate","major"]),description:t.z.string(),location:t.z.object({lat:t.z.number(),lon:t.z.number(),address:t.z.string().optional()}),distance:t.z.number(),affectsRoute:t.z.boolean(),startTime:t.z.string().optional(),endTime:t.z.string().optional(),enrichedAt:t.z.string()}),r=t.z.object({incidents:t.z.array(n),totalIncidents:t.z.number(),nearbyIncidents:t.z.number(),routeAffectingIncidents:t.z.number(),dataSource:t.z.string(),enrichedAt:t.z.string()}),i=new class{async getTrafficIncidents(e,t,n,i){try{let a="AIzaSyCVKN0pddG230vvjT0EMP9sSIR31j1q2t0",s=[];if(n&&i){let r=await this.getRouteIncidents(n,i,e,t,a);s.push(...r)}let o=await this.getNearbyIncidents(e,t,a);s.push(...o);let c=s.filter(e=>e.distance<=5).length,d=s.filter(e=>e.affectsRoute).length,l={incidents:s,totalIncidents:s.length,nearbyIncidents:c,routeAffectingIncidents:d,dataSource:"google-maps",enrichedAt:new Date().toISOString()};return r.parse(l)}catch(e){return null}}async getRouteIncidents(e,t,n,r,i){try{let a=new URL("https://maps.googleapis.com/maps/api/directions/json");a.searchParams.set("origin",`${e},${t}`),a.searchParams.set("destination",`${n},${r}`),a.searchParams.set("departure_time","now"),a.searchParams.set("traffic_model","best_guess"),a.searchParams.set("key",i);let s=await fetch(a.toString());if(!s.ok)return[];let o=await s.json();if("OK"!==o.status||!o.routes?.[0])return[];let c=o.routes[0],d=[];if(c.warnings)for(let e of c.warnings)d.push({type:this.categorizeWarning(e),severity:"moderate",description:e,location:{lat:n,lon:r},distance:0,affectsRoute:!0,enrichedAt:new Date().toISOString()});let l=c.legs[0];if(l.duration_in_traffic&&l.duration){let e=l.duration_in_traffic.value-l.duration.value,t=Math.floor(e/60);t>10&&d.push({type:"congestion",severity:t>30?"major":"moderate",description:`Heavy traffic causing ${t} minute delay`,location:{lat:n,lon:r},distance:0,affectsRoute:!0,enrichedAt:new Date().toISOString()})}return d}catch(e){return[]}}async getNearbyIncidents(e,t,n){return[]}categorizeWarning(e){let t=e.toLowerCase();return t.includes("construction")||t.includes("work")?"construction":t.includes("closed")||t.includes("closure")?"road_closed":t.includes("accident")||t.includes("crash")?"crash":"other"}};e.s(["trafficService",0,i])}];

//# sourceMappingURL=apps_web_src_lib_services_traffic-service_ts_52f24403._.js.map