{"version":3,"sources":["../../../../../apps/web/src/lib/services/google-weather-service.ts","../../../../../apps/web/src/lib/services/google-air-quality-service.ts","../../../../../apps/web/src/lib/services/google-pollen-service.ts"],"sourcesContent":["/**\n * Google Weather Service\n *\n * Provides weather data using Google Weather API\n * - Current conditions\n * - Hourly forecast (48 hours)\n * - Daily forecast (10 days)\n * - Weather alerts\n * - Solar radiation data (for HVAC/Solar industries)\n *\n * API: Google Weather API\n * Docs: https://developers.google.com/maps/documentation/weather\n *\n * Fallback: Uses existing NWS service for US locations\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst WeatherConditionSchema = z.object({\n\tcode: z.string(), // Weather condition code (e.g., \"CLEAR\", \"RAIN\", \"SNOW\")\n\tdescription: z.string(), // Human-readable description\n\ticon: z.string(), // Icon URL or code\n});\n\nconst CurrentWeatherSchema = z.object({\n\ttemperature: z.number(), // Celsius\n\ttemperatureFeelsLike: z.number(), // Celsius\n\thumidity: z.number(), // Percentage\n\tpressure: z.number(), // hPa\n\twindSpeed: z.number(), // m/s\n\twindDirection: z.number(), // Degrees\n\twindGust: z.number().optional(), // m/s\n\tvisibility: z.number().optional(), // meters\n\tuvIndex: z.number().optional(),\n\tcloudCover: z.number().optional(), // Percentage\n\tprecipitation: z.number().optional(), // mm in last hour\n\tcondition: WeatherConditionSchema,\n\tobservationTime: z.string(), // ISO timestamp\n});\n\nconst HourlyForecastSchema = z.object({\n\ttime: z.string(), // ISO timestamp\n\ttemperature: z.number(),\n\ttemperatureFeelsLike: z.number(),\n\thumidity: z.number(),\n\twindSpeed: z.number(),\n\twindDirection: z.number(),\n\tprecipitationProbability: z.number(), // Percentage\n\tprecipitationAmount: z.number().optional(), // mm\n\tcondition: WeatherConditionSchema,\n\tuvIndex: z.number().optional(),\n\tsolarRadiation: z.number().optional(), // W/m² (for solar calculations)\n});\n\nconst DailyForecastSchema = z.object({\n\tdate: z.string(), // YYYY-MM-DD\n\ttemperatureHigh: z.number(),\n\ttemperatureLow: z.number(),\n\thumidity: z.number(),\n\twindSpeed: z.number(),\n\twindDirection: z.number(),\n\tprecipitationProbability: z.number(),\n\tprecipitationAmount: z.number().optional(),\n\tcondition: WeatherConditionSchema,\n\tuvIndexMax: z.number().optional(),\n\tsunrise: z.string().optional(),\n\tsunset: z.string().optional(),\n\tmoonPhase: z.string().optional(),\n\tsolarRadiation: z.number().optional(), // Daily average W/m²\n});\n\nconst WeatherAlertSchema = z.object({\n\tevent: z.string(),\n\theadline: z.string(),\n\tdescription: z.string(),\n\tseverity: z.enum([\"Extreme\", \"Severe\", \"Moderate\", \"Minor\", \"Unknown\"]),\n\turgency: z.enum([\"Immediate\", \"Expected\", \"Future\", \"Past\", \"Unknown\"]),\n\tstart: z.string().optional(),\n\tend: z.string().optional(),\n\tinstruction: z.string().optional(),\n\tsource: z.string().optional(),\n});\n\nconst WeatherDataSchema = z.object({\n\tlocation: z.object({\n\t\tlat: z.number(),\n\t\tlng: z.number(),\n\t\tname: z.string().optional(),\n\t\ttimezone: z.string().optional(),\n\t}),\n\tcurrent: CurrentWeatherSchema.optional(),\n\thourly: z.array(HourlyForecastSchema).optional(),\n\tdaily: z.array(DailyForecastSchema).optional(),\n\talerts: z.array(WeatherAlertSchema),\n\tsource: z.enum([\"google\", \"nws\", \"openmeteo\"]),\n\tenrichedAt: z.string(),\n});\n\nexport type WeatherCondition = z.infer<typeof WeatherConditionSchema>;\nexport type CurrentWeather = z.infer<typeof CurrentWeatherSchema>;\nexport type HourlyForecast = z.infer<typeof HourlyForecastSchema>;\nexport type DailyForecast = z.infer<typeof DailyForecastSchema>;\nexport type WeatherAlert = z.infer<typeof WeatherAlertSchema>;\nexport type WeatherData = z.infer<typeof WeatherDataSchema>;\n\n// ============================================================================\n// Cache Configuration\n// ============================================================================\n\nconst CACHE_TTL = 30 * 60 * 1000; // 30 minutes\n\n// ============================================================================\n// Google Weather Service\n// ============================================================================\n\nclass GoogleWeatherService {\n\tprivate readonly apiKey: string | undefined;\n\tprivate readonly cache: Map<\n\t\tstring,\n\t\t{ data: WeatherData; timestamp: number }\n\t> = new Map();\n\n\tconstructor() {\n\t\t// Use unified GOOGLE_API_KEY for all Google services\n\t\tthis.apiKey =\n\t\t\tprocess.env.GOOGLE_API_KEY ||\n\t\t\tprocess.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY ||\n\t\t\tprocess.env.GOOGLE_MAPS_API_KEY;\n\t}\n\n\t/**\n\t * Check if service is available\n\t */\n\tisAvailable(): boolean {\n\t\treturn !!this.apiKey;\n\t}\n\n\t/**\n\t * Get complete weather data for a location\n\t * Uses Open-Meteo API (free, no API key required) as primary source\n\t * since Google Weather API requires special access\n\t */\n\tasync getWeatherData(lat: number, lng: number): Promise<WeatherData | null> {\n\t\tconst cacheKey = `weather:${lat.toFixed(4)},${lng.toFixed(4)}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\t\tif (cached && Date.now() - cached.timestamp < CACHE_TTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\t// Use Open-Meteo API (free, reliable, global coverage)\n\t\t\tconst weather = await this.fetchFromOpenMeteo(lat, lng);\n\t\t\tif (weather) {\n\t\t\t\tthis.cache.set(cacheKey, { data: weather, timestamp: Date.now() });\n\t\t\t\tthis.cleanCache();\n\t\t\t\treturn weather;\n\t\t\t}\n\n\t\t\t// Fallback to NWS for US locations\n\t\t\tif (this.isUSLocation(lat, lng)) {\n\t\t\t\tconst nwsWeather = await this.fetchFromNWS(lat, lng);\n\t\t\t\tif (nwsWeather) {\n\t\t\t\t\tthis.cache.set(cacheKey, {\n\t\t\t\t\t\tdata: nwsWeather,\n\t\t\t\t\t\ttimestamp: Date.now(),\n\t\t\t\t\t});\n\t\t\t\t\treturn nwsWeather;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Weather service error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Fetch weather from Open-Meteo (free, global coverage)\n\t */\n\tprivate async fetchFromOpenMeteo(\n\t\tlat: number,\n\t\tlng: number,\n\t): Promise<WeatherData | null> {\n\t\ttry {\n\t\t\tconst url = new URL(\"https://api.open-meteo.com/v1/forecast\");\n\t\t\turl.searchParams.set(\"latitude\", lat.toString());\n\t\t\turl.searchParams.set(\"longitude\", lng.toString());\n\t\t\turl.searchParams.set(\n\t\t\t\t\"current\",\n\t\t\t\t\"temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,cloud_cover,pressure_msl,wind_speed_10m,wind_direction_10m,wind_gusts_10m,uv_index\",\n\t\t\t);\n\t\t\turl.searchParams.set(\n\t\t\t\t\"hourly\",\n\t\t\t\t\"temperature_2m,relative_humidity_2m,apparent_temperature,precipitation_probability,precipitation,weather_code,wind_speed_10m,wind_direction_10m,uv_index,direct_radiation\",\n\t\t\t);\n\t\t\turl.searchParams.set(\n\t\t\t\t\"daily\",\n\t\t\t\t\"weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,precipitation_probability_max,wind_speed_10m_max,wind_direction_10m_dominant,uv_index_max,sunrise,sunset\",\n\t\t\t);\n\t\t\turl.searchParams.set(\"timezone\", \"auto\");\n\t\t\turl.searchParams.set(\"forecast_days\", \"10\");\n\n\t\t\tconst response = await fetch(url.toString(), {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.error(`Open-Meteo API error: ${response.status}`);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\n\t\t\t// Parse current weather\n\t\t\tconst current: CurrentWeather = {\n\t\t\t\ttemperature: data.current.temperature_2m,\n\t\t\t\ttemperatureFeelsLike: data.current.apparent_temperature,\n\t\t\t\thumidity: data.current.relative_humidity_2m,\n\t\t\t\tpressure: data.current.pressure_msl,\n\t\t\t\twindSpeed: data.current.wind_speed_10m / 3.6, // km/h to m/s\n\t\t\t\twindDirection: data.current.wind_direction_10m,\n\t\t\t\twindGust: data.current.wind_gusts_10m\n\t\t\t\t\t? data.current.wind_gusts_10m / 3.6\n\t\t\t\t\t: undefined,\n\t\t\t\tuvIndex: data.current.uv_index,\n\t\t\t\tcloudCover: data.current.cloud_cover,\n\t\t\t\tprecipitation: data.current.precipitation,\n\t\t\t\tcondition: this.getConditionFromCode(data.current.weather_code),\n\t\t\t\tobservationTime: data.current.time,\n\t\t\t};\n\n\t\t\t// Parse hourly forecast (next 48 hours)\n\t\t\tconst hourly: HourlyForecast[] = [];\n\t\t\tconst hourlyLen = Math.min(48, data.hourly.time.length);\n\t\t\tfor (let i = 0; i < hourlyLen; i++) {\n\t\t\t\thourly.push({\n\t\t\t\t\ttime: data.hourly.time[i],\n\t\t\t\t\ttemperature: data.hourly.temperature_2m[i],\n\t\t\t\t\ttemperatureFeelsLike: data.hourly.apparent_temperature[i],\n\t\t\t\t\thumidity: data.hourly.relative_humidity_2m[i],\n\t\t\t\t\twindSpeed: data.hourly.wind_speed_10m[i] / 3.6,\n\t\t\t\t\twindDirection: data.hourly.wind_direction_10m[i],\n\t\t\t\t\tprecipitationProbability: data.hourly.precipitation_probability[i],\n\t\t\t\t\tprecipitationAmount: data.hourly.precipitation[i],\n\t\t\t\t\tcondition: this.getConditionFromCode(data.hourly.weather_code[i]),\n\t\t\t\t\tuvIndex: data.hourly.uv_index[i],\n\t\t\t\t\tsolarRadiation: data.hourly.direct_radiation?.[i],\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Parse daily forecast\n\t\t\tconst daily: DailyForecast[] = [];\n\t\t\tfor (let i = 0; i < data.daily.time.length; i++) {\n\t\t\t\tdaily.push({\n\t\t\t\t\tdate: data.daily.time[i],\n\t\t\t\t\ttemperatureHigh: data.daily.temperature_2m_max[i],\n\t\t\t\t\ttemperatureLow: data.daily.temperature_2m_min[i],\n\t\t\t\t\thumidity: 0, // Not available in daily\n\t\t\t\t\twindSpeed: data.daily.wind_speed_10m_max[i] / 3.6,\n\t\t\t\t\twindDirection: data.daily.wind_direction_10m_dominant[i],\n\t\t\t\t\tprecipitationProbability: data.daily.precipitation_probability_max[i],\n\t\t\t\t\tprecipitationAmount: data.daily.precipitation_sum[i],\n\t\t\t\t\tcondition: this.getConditionFromCode(data.daily.weather_code[i]),\n\t\t\t\t\tuvIndexMax: data.daily.uv_index_max[i],\n\t\t\t\t\tsunrise: data.daily.sunrise[i],\n\t\t\t\t\tsunset: data.daily.sunset[i],\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tlocation: {\n\t\t\t\t\tlat,\n\t\t\t\t\tlng,\n\t\t\t\t\ttimezone: data.timezone,\n\t\t\t\t},\n\t\t\t\tcurrent,\n\t\t\t\thourly,\n\t\t\t\tdaily,\n\t\t\t\talerts: [], // Open-Meteo doesn't provide alerts\n\t\t\t\tsource: \"openmeteo\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Open-Meteo fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Fetch weather from NWS (US only, free)\n\t */\n\tprivate async fetchFromNWS(\n\t\tlat: number,\n\t\tlng: number,\n\t): Promise<WeatherData | null> {\n\t\ttry {\n\t\t\t// Get grid point\n\t\t\tconst pointsRes = await fetch(\n\t\t\t\t`https://api.weather.gov/points/${lat.toFixed(4)},${lng.toFixed(4)}`,\n\t\t\t\t{\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"User-Agent\": USER_AGENT,\n\t\t\t\t\t\tAccept: \"application/geo+json\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tif (!pointsRes.ok) return null;\n\n\t\t\tconst pointsData = await pointsRes.json();\n\t\t\tconst props = pointsData.properties;\n\n\t\t\t// Fetch forecast and alerts in parallel\n\t\t\tconst [forecastRes, alertsRes] = await Promise.all([\n\t\t\t\tfetch(props.forecast, {\n\t\t\t\t\theaders: { \"User-Agent\": USER_AGENT, Accept: \"application/geo+json\" },\n\t\t\t\t}),\n\t\t\t\tfetch(`https://api.weather.gov/alerts/active?point=${lat},${lng}`, {\n\t\t\t\t\theaders: { \"User-Agent\": USER_AGENT, Accept: \"application/geo+json\" },\n\t\t\t\t}),\n\t\t\t]);\n\n\t\t\tconst forecastData = forecastRes.ok ? await forecastRes.json() : null;\n\t\t\tconst alertsData = alertsRes.ok ? await alertsRes.json() : null;\n\n\t\t\t// Parse alerts\n\t\t\tconst alerts: WeatherAlert[] = (alertsData?.features || []).map(\n\t\t\t\t(f: any) => ({\n\t\t\t\t\tevent: f.properties.event || \"Unknown\",\n\t\t\t\t\theadline: f.properties.headline || \"\",\n\t\t\t\t\tdescription: f.properties.description || \"\",\n\t\t\t\t\tseverity: this.mapNWSSeverity(f.properties.severity),\n\t\t\t\t\turgency: this.mapNWSUrgency(f.properties.urgency),\n\t\t\t\t\tstart: f.properties.onset,\n\t\t\t\t\tend: f.properties.expires,\n\t\t\t\t\tinstruction: f.properties.instruction,\n\t\t\t\t\tsource: \"NWS\",\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\t// Parse daily forecast from periods\n\t\t\tconst daily: DailyForecast[] = [];\n\t\t\tif (forecastData?.properties?.periods) {\n\t\t\t\tconst periods = forecastData.properties.periods;\n\t\t\t\tfor (let i = 0; i < periods.length; i += 2) {\n\t\t\t\t\tconst dayPeriod = periods[i];\n\t\t\t\t\tconst nightPeriod = periods[i + 1];\n\n\t\t\t\t\tdaily.push({\n\t\t\t\t\t\tdate: dayPeriod.startTime.split(\"T\")[0],\n\t\t\t\t\t\ttemperatureHigh: dayPeriod.isDaytime\n\t\t\t\t\t\t\t? dayPeriod.temperature\n\t\t\t\t\t\t\t: nightPeriod?.temperature || dayPeriod.temperature,\n\t\t\t\t\t\ttemperatureLow: nightPeriod?.temperature || dayPeriod.temperature,\n\t\t\t\t\t\thumidity: 0,\n\t\t\t\t\t\twindSpeed: this.parseWindSpeed(dayPeriod.windSpeed),\n\t\t\t\t\t\twindDirection: this.parseWindDirection(dayPeriod.windDirection),\n\t\t\t\t\t\tprecipitationProbability: 0,\n\t\t\t\t\t\tcondition: this.mapNWSCondition(dayPeriod.shortForecast),\n\t\t\t\t\t\tuvIndexMax: undefined,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tlocation: {\n\t\t\t\t\tlat,\n\t\t\t\t\tlng,\n\t\t\t\t\tname: props.relativeLocation?.properties?.city,\n\t\t\t\t\ttimezone: props.timeZone,\n\t\t\t\t},\n\t\t\t\tdaily,\n\t\t\t\talerts,\n\t\t\t\tsource: \"nws\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tconsole.error(\"NWS fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get weather condition from WMO code\n\t */\n\tprivate getConditionFromCode(code: number): WeatherCondition {\n\t\tconst conditions: Record<\n\t\t\tnumber,\n\t\t\t{ code: string; description: string; icon: string }\n\t\t> = {\n\t\t\t0: { code: \"CLEAR\", description: \"Clear sky\", icon: \"01d\" },\n\t\t\t1: { code: \"MOSTLY_CLEAR\", description: \"Mostly clear\", icon: \"02d\" },\n\t\t\t2: { code: \"PARTLY_CLOUDY\", description: \"Partly cloudy\", icon: \"03d\" },\n\t\t\t3: { code: \"OVERCAST\", description: \"Overcast\", icon: \"04d\" },\n\t\t\t45: { code: \"FOG\", description: \"Foggy\", icon: \"50d\" },\n\t\t\t48: { code: \"FOG\", description: \"Freezing fog\", icon: \"50d\" },\n\t\t\t51: { code: \"DRIZZLE\", description: \"Light drizzle\", icon: \"09d\" },\n\t\t\t53: { code: \"DRIZZLE\", description: \"Moderate drizzle\", icon: \"09d\" },\n\t\t\t55: { code: \"DRIZZLE\", description: \"Dense drizzle\", icon: \"09d\" },\n\t\t\t56: { code: \"FREEZING_DRIZZLE\", description: \"Freezing drizzle\", icon: \"09d\" },\n\t\t\t57: { code: \"FREEZING_DRIZZLE\", description: \"Dense freezing drizzle\", icon: \"09d\" },\n\t\t\t61: { code: \"RAIN\", description: \"Light rain\", icon: \"10d\" },\n\t\t\t63: { code: \"RAIN\", description: \"Moderate rain\", icon: \"10d\" },\n\t\t\t65: { code: \"RAIN\", description: \"Heavy rain\", icon: \"10d\" },\n\t\t\t66: { code: \"FREEZING_RAIN\", description: \"Freezing rain\", icon: \"13d\" },\n\t\t\t67: { code: \"FREEZING_RAIN\", description: \"Heavy freezing rain\", icon: \"13d\" },\n\t\t\t71: { code: \"SNOW\", description: \"Light snow\", icon: \"13d\" },\n\t\t\t73: { code: \"SNOW\", description: \"Moderate snow\", icon: \"13d\" },\n\t\t\t75: { code: \"SNOW\", description: \"Heavy snow\", icon: \"13d\" },\n\t\t\t77: { code: \"SNOW_GRAINS\", description: \"Snow grains\", icon: \"13d\" },\n\t\t\t80: { code: \"RAIN_SHOWERS\", description: \"Light rain showers\", icon: \"09d\" },\n\t\t\t81: { code: \"RAIN_SHOWERS\", description: \"Moderate rain showers\", icon: \"09d\" },\n\t\t\t82: { code: \"RAIN_SHOWERS\", description: \"Heavy rain showers\", icon: \"09d\" },\n\t\t\t85: { code: \"SNOW_SHOWERS\", description: \"Light snow showers\", icon: \"13d\" },\n\t\t\t86: { code: \"SNOW_SHOWERS\", description: \"Heavy snow showers\", icon: \"13d\" },\n\t\t\t95: { code: \"THUNDERSTORM\", description: \"Thunderstorm\", icon: \"11d\" },\n\t\t\t96: { code: \"THUNDERSTORM\", description: \"Thunderstorm with hail\", icon: \"11d\" },\n\t\t\t99: { code: \"THUNDERSTORM\", description: \"Severe thunderstorm\", icon: \"11d\" },\n\t\t};\n\n\t\treturn (\n\t\t\tconditions[code] || {\n\t\t\t\tcode: \"UNKNOWN\",\n\t\t\t\tdescription: \"Unknown\",\n\t\t\t\ticon: \"03d\",\n\t\t\t}\n\t\t);\n\t}\n\n\t/**\n\t * Map NWS condition text to WeatherCondition\n\t */\n\tprivate mapNWSCondition(forecast: string): WeatherCondition {\n\t\tconst lower = forecast.toLowerCase();\n\t\tif (lower.includes(\"thunder\")) {\n\t\t\treturn {\n\t\t\t\tcode: \"THUNDERSTORM\",\n\t\t\t\tdescription: forecast,\n\t\t\t\ticon: \"11d\",\n\t\t\t};\n\t\t}\n\t\tif (lower.includes(\"snow\")) {\n\t\t\treturn { code: \"SNOW\", description: forecast, icon: \"13d\" };\n\t\t}\n\t\tif (lower.includes(\"rain\") || lower.includes(\"showers\")) {\n\t\t\treturn { code: \"RAIN\", description: forecast, icon: \"10d\" };\n\t\t}\n\t\tif (lower.includes(\"cloudy\") || lower.includes(\"overcast\")) {\n\t\t\treturn { code: \"CLOUDY\", description: forecast, icon: \"04d\" };\n\t\t}\n\t\tif (lower.includes(\"partly\")) {\n\t\t\treturn {\n\t\t\t\tcode: \"PARTLY_CLOUDY\",\n\t\t\t\tdescription: forecast,\n\t\t\t\ticon: \"03d\",\n\t\t\t};\n\t\t}\n\t\tif (lower.includes(\"clear\") || lower.includes(\"sunny\")) {\n\t\t\treturn { code: \"CLEAR\", description: forecast, icon: \"01d\" };\n\t\t}\n\t\treturn { code: \"UNKNOWN\", description: forecast, icon: \"03d\" };\n\t}\n\n\tprivate mapNWSSeverity(severity: string): WeatherAlert[\"severity\"] {\n\t\tswitch (severity?.toLowerCase()) {\n\t\t\tcase \"extreme\":\n\t\t\t\treturn \"Extreme\";\n\t\t\tcase \"severe\":\n\t\t\t\treturn \"Severe\";\n\t\t\tcase \"moderate\":\n\t\t\t\treturn \"Moderate\";\n\t\t\tcase \"minor\":\n\t\t\t\treturn \"Minor\";\n\t\t\tdefault:\n\t\t\t\treturn \"Unknown\";\n\t\t}\n\t}\n\n\tprivate mapNWSUrgency(urgency: string): WeatherAlert[\"urgency\"] {\n\t\tswitch (urgency?.toLowerCase()) {\n\t\t\tcase \"immediate\":\n\t\t\t\treturn \"Immediate\";\n\t\t\tcase \"expected\":\n\t\t\t\treturn \"Expected\";\n\t\t\tcase \"future\":\n\t\t\t\treturn \"Future\";\n\t\t\tcase \"past\":\n\t\t\t\treturn \"Past\";\n\t\t\tdefault:\n\t\t\t\treturn \"Unknown\";\n\t\t}\n\t}\n\n\tprivate parseWindSpeed(windStr: string): number {\n\t\t// \"10 to 15 mph\" -> 12.5 mph -> m/s\n\t\tconst match = windStr.match(/(\\d+)\\s*(?:to\\s*(\\d+))?\\s*mph/i);\n\t\tif (match) {\n\t\t\tconst low = parseInt(match[1]);\n\t\t\tconst high = match[2] ? parseInt(match[2]) : low;\n\t\t\tconst mph = (low + high) / 2;\n\t\t\treturn mph * 0.44704; // Convert to m/s\n\t\t}\n\t\treturn 0;\n\t}\n\n\tprivate parseWindDirection(dir: string): number {\n\t\tconst directions: Record<string, number> = {\n\t\t\tN: 0, NNE: 22.5, NE: 45, ENE: 67.5,\n\t\t\tE: 90, ESE: 112.5, SE: 135, SSE: 157.5,\n\t\t\tS: 180, SSW: 202.5, SW: 225, WSW: 247.5,\n\t\t\tW: 270, WNW: 292.5, NW: 315, NNW: 337.5,\n\t\t};\n\t\treturn directions[dir.toUpperCase()] || 0;\n\t}\n\n\tprivate isUSLocation(lat: number, lng: number): boolean {\n\t\t// Rough bounds for continental US + Alaska + Hawaii\n\t\treturn (\n\t\t\t(lat >= 24.5 && lat <= 49.5 && lng >= -125 && lng <= -66.9) || // Continental\n\t\t\t(lat >= 51 && lat <= 71.5 && lng >= -180 && lng <= -130) || // Alaska\n\t\t\t(lat >= 18.5 && lat <= 22.5 && lng >= -161 && lng <= -154) // Hawaii\n\t\t);\n\t}\n\n\t/**\n\t * Check if weather is suitable for outdoor work\n\t */\n\tisSuitableForOutdoorWork(weather: WeatherData): {\n\t\tsuitable: boolean;\n\t\treason?: string;\n\t\tseverity: \"none\" | \"low\" | \"medium\" | \"high\";\n\t} {\n\t\t// Check for severe alerts\n\t\tconst severeAlerts = weather.alerts.filter(\n\t\t\t(a) => a.severity === \"Extreme\" || a.severity === \"Severe\",\n\t\t);\n\t\tif (severeAlerts.length > 0) {\n\t\t\treturn {\n\t\t\t\tsuitable: false,\n\t\t\t\treason: severeAlerts[0].headline || severeAlerts[0].event,\n\t\t\t\tseverity: \"high\",\n\t\t\t};\n\t\t}\n\n\t\t// Check current conditions\n\t\tif (weather.current) {\n\t\t\tconst { condition, temperature, windSpeed } = weather.current;\n\n\t\t\t// Check for dangerous conditions\n\t\t\tif (\n\t\t\t\tcondition.code === \"THUNDERSTORM\" ||\n\t\t\t\tcondition.code.includes(\"FREEZING\")\n\t\t\t) {\n\t\t\t\treturn {\n\t\t\t\t\tsuitable: false,\n\t\t\t\t\treason: condition.description,\n\t\t\t\t\tseverity: \"high\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Check temperature (in Celsius)\n\t\t\tif (temperature < -10) {\n\t\t\t\treturn {\n\t\t\t\t\tsuitable: false,\n\t\t\t\t\treason: \"Extreme cold (-10°C or below)\",\n\t\t\t\t\tseverity: \"high\",\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (temperature > 40) {\n\t\t\t\treturn {\n\t\t\t\t\tsuitable: false,\n\t\t\t\t\treason: \"Extreme heat (40°C or above)\",\n\t\t\t\t\tseverity: \"high\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Check wind\n\t\t\tif (windSpeed > 20) {\n\t\t\t\t// ~45 mph\n\t\t\t\treturn {\n\t\t\t\t\tsuitable: false,\n\t\t\t\t\treason: \"High winds\",\n\t\t\t\t\tseverity: \"medium\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Moderate concerns\n\t\t\tif (condition.code === \"RAIN\" || condition.code === \"SNOW\") {\n\t\t\t\treturn {\n\t\t\t\t\tsuitable: true,\n\t\t\t\t\treason: condition.description,\n\t\t\t\t\tseverity: \"medium\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (temperature < 0 || temperature > 35) {\n\t\t\t\treturn {\n\t\t\t\t\tsuitable: true,\n\t\t\t\t\treason: `Temperature: ${Math.round(temperature)}°C`,\n\t\t\t\t\tseverity: \"low\",\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\treturn { suitable: true, severity: \"none\" };\n\t}\n\n\t/**\n\t * Get weather summary for display\n\t */\n\tgetWeatherSummary(weather: WeatherData): {\n\t\ttemperature: string;\n\t\tcondition: string;\n\t\ticon: string;\n\t\tfeelsLike: string;\n\t\thumidity: string;\n\t\twind: string;\n\t\talerts: number;\n\t\tsuitableForWork: boolean;\n\t} {\n\t\tconst current = weather.current;\n\t\tconst workSuitability = this.isSuitableForOutdoorWork(weather);\n\n\t\treturn {\n\t\t\ttemperature: current\n\t\t\t\t? `${Math.round(current.temperature)}°C / ${Math.round(current.temperature * 1.8 + 32)}°F`\n\t\t\t\t: \"N/A\",\n\t\t\tcondition: current?.condition.description || \"Unknown\",\n\t\t\ticon: current?.condition.icon || \"03d\",\n\t\t\tfeelsLike: current\n\t\t\t\t? `${Math.round(current.temperatureFeelsLike)}°C`\n\t\t\t\t: \"N/A\",\n\t\t\thumidity: current ? `${Math.round(current.humidity)}%` : \"N/A\",\n\t\t\twind: current\n\t\t\t\t? `${Math.round(current.windSpeed * 2.237)} mph`\n\t\t\t\t: \"N/A\", // m/s to mph\n\t\t\talerts: weather.alerts.length,\n\t\t\tsuitableForWork: workSuitability.suitable,\n\t\t};\n\t}\n\n\t/**\n\t * Clean up old cache entries\n\t */\n\tprivate cleanCache(): void {\n\t\tconst now = Date.now();\n\t\tfor (const [key, value] of this.cache.entries()) {\n\t\t\tif (now - value.timestamp > CACHE_TTL * 2) {\n\t\t\t\tthis.cache.delete(key);\n\t\t\t}\n\t\t}\n\n\t\tif (this.cache.size > 100) {\n\t\t\tconst entries = Array.from(this.cache.entries());\n\t\t\tentries.sort((a, b) => b[1].timestamp - a[1].timestamp);\n\t\t\tthis.cache.clear();\n\t\t\tfor (const [key, value] of entries.slice(0, 50)) {\n\t\t\t\tthis.cache.set(key, value);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Clear cache\n\t */\n\tclearCache(): void {\n\t\tthis.cache.clear();\n\t}\n}\n\n// Singleton instance\nexport const googleWeatherService = new GoogleWeatherService();\n","/**\n * Google Air Quality Service\n *\n * Provides air quality data using Google Air Quality API\n * - Current air quality index (AQI)\n * - Pollutant concentrations (PM2.5, PM10, O3, NO2, SO2, CO)\n * - Health recommendations\n * - 500m resolution data\n *\n * API: Google Air Quality API\n * Docs: https://developers.google.com/maps/documentation/air-quality\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst PollutantSchema = z.object({\n\tcode: z.string(), // PM25, PM10, O3, NO2, SO2, CO\n\tdisplayName: z.string(),\n\tconcentration: z.object({\n\t\tvalue: z.number(),\n\t\tunits: z.string(), // μg/m³ or ppb\n\t}),\n\tadditionalInfo: z\n\t\t.object({\n\t\t\tsources: z.string().optional(),\n\t\t\teffects: z.string().optional(),\n\t\t})\n\t\t.optional(),\n});\n\nconst AirQualityIndexSchema = z.object({\n\tcode: z.string(), // us-epa, who, etc.\n\tdisplayName: z.string(),\n\taqi: z.number(), // 0-500 scale\n\tcategory: z.string(), // Good, Moderate, Unhealthy, etc.\n\tcolor: z\n\t\t.object({\n\t\t\tred: z.number(),\n\t\t\tgreen: z.number(),\n\t\t\tblue: z.number(),\n\t\t})\n\t\t.optional(),\n\tdominantPollutant: z.string().optional(),\n});\n\nconst HealthRecommendationsSchema = z.object({\n\tgeneralPopulation: z.string().optional(),\n\telderly: z.string().optional(),\n\tlungDiseasePopulation: z.string().optional(),\n\theartDiseasePopulation: z.string().optional(),\n\tathletes: z.string().optional(),\n\tpregnantWomen: z.string().optional(),\n\tchildren: z.string().optional(),\n});\n\nconst AirQualityDataSchema = z.object({\n\tlocation: z.object({\n\t\tlat: z.number(),\n\t\tlng: z.number(),\n\t}),\n\tdateTime: z.string(),\n\tregionCode: z.string().optional(),\n\tindexes: z.array(AirQualityIndexSchema),\n\tpollutants: z.array(PollutantSchema),\n\thealthRecommendations: HealthRecommendationsSchema.optional(),\n\tsource: z.enum([\"google\", \"airnow\", \"openaq\"]),\n\tenrichedAt: z.string(),\n});\n\nconst AirQualityForecastSchema = z.object({\n\tdateTime: z.string(),\n\tindexes: z.array(AirQualityIndexSchema),\n\tpollutants: z.array(PollutantSchema).optional(),\n});\n\nexport type Pollutant = z.infer<typeof PollutantSchema>;\nexport type AirQualityIndex = z.infer<typeof AirQualityIndexSchema>;\nexport type HealthRecommendations = z.infer<typeof HealthRecommendationsSchema>;\nexport type AirQualityData = z.infer<typeof AirQualityDataSchema>;\nexport type AirQualityForecast = z.infer<typeof AirQualityForecastSchema>;\n\n// ============================================================================\n// Cache Configuration\n// ============================================================================\n\nconst CACHE_TTL = 60 * 60 * 1000; // 1 hour (AQI updates hourly)\n\n// ============================================================================\n// Google Air Quality Service\n// ============================================================================\n\nclass GoogleAirQualityService {\n\tprivate readonly apiKey: string | undefined;\n\tprivate readonly cache: Map<\n\t\tstring,\n\t\t{ data: AirQualityData; timestamp: number }\n\t> = new Map();\n\n\tconstructor() {\n\t\t// Use unified GOOGLE_API_KEY for all Google services\n\t\tthis.apiKey =\n\t\t\tprocess.env.GOOGLE_API_KEY ||\n\t\t\tprocess.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY ||\n\t\t\tprocess.env.GOOGLE_MAPS_API_KEY;\n\t}\n\n\t/**\n\t * Check if service is available\n\t */\n\tisAvailable(): boolean {\n\t\treturn !!this.apiKey;\n\t}\n\n\t/**\n\t * Get current air quality data for a location\n\t */\n\tasync getAirQuality(lat: number, lng: number): Promise<AirQualityData | null> {\n\t\tconst cacheKey = `aq:${lat.toFixed(4)},${lng.toFixed(4)}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\t\tif (cached && Date.now() - cached.timestamp < CACHE_TTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\t// Try Google Air Quality API first\n\t\tif (this.apiKey) {\n\t\t\tconst googleData = await this.fetchFromGoogle(lat, lng);\n\t\t\tif (googleData) {\n\t\t\t\tthis.cache.set(cacheKey, { data: googleData, timestamp: Date.now() });\n\t\t\t\tthis.cleanCache();\n\t\t\t\treturn googleData;\n\t\t\t}\n\t\t}\n\n\t\t// Fallback to Open-Meteo Air Quality (free)\n\t\tconst openMeteoData = await this.fetchFromOpenMeteo(lat, lng);\n\t\tif (openMeteoData) {\n\t\t\tthis.cache.set(cacheKey, { data: openMeteoData, timestamp: Date.now() });\n\t\t\tthis.cleanCache();\n\t\t\treturn openMeteoData;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Fetch from Google Air Quality API\n\t */\n\tprivate async fetchFromGoogle(\n\t\tlat: number,\n\t\tlng: number,\n\t): Promise<AirQualityData | null> {\n\t\ttry {\n\t\t\tconst url = `https://airquality.googleapis.com/v1/currentConditions:lookup?key=${this.apiKey}`;\n\n\t\t\tconst response = await fetch(url, {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\"User-Agent\": USER_AGENT,\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tlocation: { latitude: lat, longitude: lng },\n\t\t\t\t\textraComputations: [\n\t\t\t\t\t\t\"HEALTH_RECOMMENDATIONS\",\n\t\t\t\t\t\t\"DOMINANT_POLLUTANT_CONCENTRATION\",\n\t\t\t\t\t\t\"POLLUTANT_CONCENTRATION\",\n\t\t\t\t\t\t\"LOCAL_AQI\",\n\t\t\t\t\t\t\"POLLUTANT_ADDITIONAL_INFO\",\n\t\t\t\t\t],\n\t\t\t\t\tlanguageCode: \"en\",\n\t\t\t\t}),\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.error(`Google Air Quality API error: ${response.status}`);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\n\t\t\t// Parse indexes\n\t\t\tconst indexes: AirQualityIndex[] = (data.indexes || []).map(\n\t\t\t\t(idx: any) => ({\n\t\t\t\t\tcode: idx.code || \"unknown\",\n\t\t\t\t\tdisplayName: idx.displayName || \"Air Quality Index\",\n\t\t\t\t\taqi: idx.aqi || 0,\n\t\t\t\t\tcategory: idx.category || \"Unknown\",\n\t\t\t\t\tcolor: idx.color,\n\t\t\t\t\tdominantPollutant: idx.dominantPollutant,\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\t// Parse pollutants\n\t\t\tconst pollutants: Pollutant[] = (data.pollutants || []).map((p: any) => ({\n\t\t\t\tcode: p.code || \"unknown\",\n\t\t\t\tdisplayName: p.displayName || p.code,\n\t\t\t\tconcentration: {\n\t\t\t\t\tvalue: p.concentration?.value || 0,\n\t\t\t\t\tunits: p.concentration?.units || \"μg/m³\",\n\t\t\t\t},\n\t\t\t\tadditionalInfo: p.additionalInfo,\n\t\t\t}));\n\n\t\t\t// Parse health recommendations\n\t\t\tconst healthRecs = data.healthRecommendations;\n\t\t\tconst healthRecommendations: HealthRecommendations | undefined = healthRecs\n\t\t\t\t? {\n\t\t\t\t\t\tgeneralPopulation: healthRecs.generalPopulation,\n\t\t\t\t\t\telderly: healthRecs.elderly,\n\t\t\t\t\t\tlungDiseasePopulation: healthRecs.lungDiseasePopulation,\n\t\t\t\t\t\theartDiseasePopulation: healthRecs.heartDiseasePopulation,\n\t\t\t\t\t\tathletes: healthRecs.athletes,\n\t\t\t\t\t\tpregnantWomen: healthRecs.pregnantWomen,\n\t\t\t\t\t\tchildren: healthRecs.children,\n\t\t\t\t\t}\n\t\t\t\t: undefined;\n\n\t\t\treturn {\n\t\t\t\tlocation: { lat, lng },\n\t\t\t\tdateTime: data.dateTime || new Date().toISOString(),\n\t\t\t\tregionCode: data.regionCode,\n\t\t\t\tindexes,\n\t\t\t\tpollutants,\n\t\t\t\thealthRecommendations,\n\t\t\t\tsource: \"google\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Google Air Quality fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Fetch from Open-Meteo Air Quality API (free fallback)\n\t */\n\tprivate async fetchFromOpenMeteo(\n\t\tlat: number,\n\t\tlng: number,\n\t): Promise<AirQualityData | null> {\n\t\ttry {\n\t\t\tconst url = new URL(\"https://air-quality-api.open-meteo.com/v1/air-quality\");\n\t\t\turl.searchParams.set(\"latitude\", lat.toString());\n\t\t\turl.searchParams.set(\"longitude\", lng.toString());\n\t\t\turl.searchParams.set(\n\t\t\t\t\"current\",\n\t\t\t\t\"us_aqi,pm10,pm2_5,carbon_monoxide,nitrogen_dioxide,sulphur_dioxide,ozone\",\n\t\t\t);\n\n\t\t\tconst response = await fetch(url.toString(), {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.error(`Open-Meteo Air Quality API error: ${response.status}`);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\t\t\tconst current = data.current;\n\n\t\t\tif (!current) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Map US AQI to category\n\t\t\tconst aqi = current.us_aqi || 0;\n\t\t\tconst category = this.getAQICategory(aqi);\n\n\t\t\tconst indexes: AirQualityIndex[] = [\n\t\t\t\t{\n\t\t\t\t\tcode: \"us-epa\",\n\t\t\t\t\tdisplayName: \"US EPA AQI\",\n\t\t\t\t\taqi,\n\t\t\t\t\tcategory: category.name,\n\t\t\t\t\tcolor: category.color,\n\t\t\t\t\tdominantPollutant: this.getDominantPollutant(current),\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tconst pollutants: Pollutant[] = [\n\t\t\t\t{\n\t\t\t\t\tcode: \"PM25\",\n\t\t\t\t\tdisplayName: \"PM2.5\",\n\t\t\t\t\tconcentration: { value: current.pm2_5 || 0, units: \"μg/m³\" },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcode: \"PM10\",\n\t\t\t\t\tdisplayName: \"PM10\",\n\t\t\t\t\tconcentration: { value: current.pm10 || 0, units: \"μg/m³\" },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcode: \"O3\",\n\t\t\t\t\tdisplayName: \"Ozone\",\n\t\t\t\t\tconcentration: { value: current.ozone || 0, units: \"μg/m³\" },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcode: \"NO2\",\n\t\t\t\t\tdisplayName: \"Nitrogen Dioxide\",\n\t\t\t\t\tconcentration: {\n\t\t\t\t\t\tvalue: current.nitrogen_dioxide || 0,\n\t\t\t\t\t\tunits: \"μg/m³\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcode: \"SO2\",\n\t\t\t\t\tdisplayName: \"Sulfur Dioxide\",\n\t\t\t\t\tconcentration: {\n\t\t\t\t\t\tvalue: current.sulphur_dioxide || 0,\n\t\t\t\t\t\tunits: \"μg/m³\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcode: \"CO\",\n\t\t\t\t\tdisplayName: \"Carbon Monoxide\",\n\t\t\t\t\tconcentration: {\n\t\t\t\t\t\tvalue: current.carbon_monoxide || 0,\n\t\t\t\t\t\tunits: \"μg/m³\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t].filter((p) => p.concentration.value > 0);\n\n\t\t\treturn {\n\t\t\t\tlocation: { lat, lng },\n\t\t\t\tdateTime: current.time || new Date().toISOString(),\n\t\t\t\tindexes,\n\t\t\t\tpollutants,\n\t\t\t\thealthRecommendations: {\n\t\t\t\t\tgeneralPopulation: category.recommendation,\n\t\t\t\t},\n\t\t\t\tsource: \"openaq\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Open-Meteo Air Quality fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get air quality forecast for the next 5 days\n\t */\n\tasync getAirQualityForecast(\n\t\tlat: number,\n\t\tlng: number,\n\t): Promise<AirQualityForecast[] | null> {\n\t\ttry {\n\t\t\tconst url = new URL(\"https://air-quality-api.open-meteo.com/v1/air-quality\");\n\t\t\turl.searchParams.set(\"latitude\", lat.toString());\n\t\t\turl.searchParams.set(\"longitude\", lng.toString());\n\t\t\turl.searchParams.set(\n\t\t\t\t\"hourly\",\n\t\t\t\t\"us_aqi,pm10,pm2_5,ozone,nitrogen_dioxide\",\n\t\t\t);\n\t\t\turl.searchParams.set(\"forecast_days\", \"5\");\n\n\t\t\tconst response = await fetch(url.toString(), {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\t\t\tconst hourly = data.hourly;\n\n\t\t\tif (!hourly?.time) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst forecasts: AirQualityForecast[] = [];\n\n\t\t\tfor (let i = 0; i < hourly.time.length; i++) {\n\t\t\t\tconst aqi = hourly.us_aqi?.[i] || 0;\n\t\t\t\tconst category = this.getAQICategory(aqi);\n\n\t\t\t\tforecasts.push({\n\t\t\t\t\tdateTime: hourly.time[i],\n\t\t\t\t\tindexes: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcode: \"us-epa\",\n\t\t\t\t\t\t\tdisplayName: \"US EPA AQI\",\n\t\t\t\t\t\t\taqi,\n\t\t\t\t\t\t\tcategory: category.name,\n\t\t\t\t\t\t\tcolor: category.color,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tpollutants: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcode: \"PM25\",\n\t\t\t\t\t\t\tdisplayName: \"PM2.5\",\n\t\t\t\t\t\t\tconcentration: {\n\t\t\t\t\t\t\t\tvalue: hourly.pm2_5?.[i] || 0,\n\t\t\t\t\t\t\t\tunits: \"μg/m³\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcode: \"PM10\",\n\t\t\t\t\t\t\tdisplayName: \"PM10\",\n\t\t\t\t\t\t\tconcentration: {\n\t\t\t\t\t\t\t\tvalue: hourly.pm10?.[i] || 0,\n\t\t\t\t\t\t\t\tunits: \"μg/m³\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcode: \"O3\",\n\t\t\t\t\t\t\tdisplayName: \"Ozone\",\n\t\t\t\t\t\t\tconcentration: {\n\t\t\t\t\t\t\t\tvalue: hourly.ozone?.[i] || 0,\n\t\t\t\t\t\t\t\tunits: \"μg/m³\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn forecasts;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Air quality forecast fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get AQI category from numeric value\n\t */\n\tprivate getAQICategory(aqi: number): {\n\t\tname: string;\n\t\tcolor: { red: number; green: number; blue: number };\n\t\trecommendation: string;\n\t} {\n\t\tif (aqi <= 50) {\n\t\t\treturn {\n\t\t\t\tname: \"Good\",\n\t\t\t\tcolor: { red: 0, green: 228, blue: 0 },\n\t\t\t\trecommendation:\n\t\t\t\t\t\"Air quality is satisfactory. Enjoy outdoor activities.\",\n\t\t\t};\n\t\t}\n\t\tif (aqi <= 100) {\n\t\t\treturn {\n\t\t\t\tname: \"Moderate\",\n\t\t\t\tcolor: { red: 255, green: 255, blue: 0 },\n\t\t\t\trecommendation:\n\t\t\t\t\t\"Air quality is acceptable. Unusually sensitive individuals should consider limiting prolonged outdoor exertion.\",\n\t\t\t};\n\t\t}\n\t\tif (aqi <= 150) {\n\t\t\treturn {\n\t\t\t\tname: \"Unhealthy for Sensitive Groups\",\n\t\t\t\tcolor: { red: 255, green: 126, blue: 0 },\n\t\t\t\trecommendation:\n\t\t\t\t\t\"Members of sensitive groups may experience health effects. The general public is less likely to be affected.\",\n\t\t\t};\n\t\t}\n\t\tif (aqi <= 200) {\n\t\t\treturn {\n\t\t\t\tname: \"Unhealthy\",\n\t\t\t\tcolor: { red: 255, green: 0, blue: 0 },\n\t\t\t\trecommendation:\n\t\t\t\t\t\"Everyone may begin to experience health effects. Members of sensitive groups may experience more serious health effects.\",\n\t\t\t};\n\t\t}\n\t\tif (aqi <= 300) {\n\t\t\treturn {\n\t\t\t\tname: \"Very Unhealthy\",\n\t\t\t\tcolor: { red: 143, green: 63, blue: 151 },\n\t\t\t\trecommendation:\n\t\t\t\t\t\"Health alert: everyone may experience more serious health effects. Consider rescheduling outdoor work.\",\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tname: \"Hazardous\",\n\t\t\tcolor: { red: 126, green: 0, blue: 35 },\n\t\t\trecommendation:\n\t\t\t\t\"Health emergency: reschedule all outdoor work immediately.\",\n\t\t};\n\t}\n\n\t/**\n\t * Determine dominant pollutant\n\t */\n\tprivate getDominantPollutant(current: Record<string, number>): string {\n\t\t// Simple heuristic based on typical threshold exceedances\n\t\tconst pollutants = [\n\t\t\t{ code: \"PM25\", value: current.pm2_5 || 0, threshold: 12 },\n\t\t\t{ code: \"PM10\", value: current.pm10 || 0, threshold: 54 },\n\t\t\t{ code: \"O3\", value: current.ozone || 0, threshold: 100 },\n\t\t\t{ code: \"NO2\", value: current.nitrogen_dioxide || 0, threshold: 100 },\n\t\t];\n\n\t\tlet dominant = pollutants[0];\n\t\tlet maxRatio = 0;\n\n\t\tfor (const p of pollutants) {\n\t\t\tconst ratio = p.value / p.threshold;\n\t\t\tif (ratio > maxRatio) {\n\t\t\t\tmaxRatio = ratio;\n\t\t\t\tdominant = p;\n\t\t\t}\n\t\t}\n\n\t\treturn dominant.code;\n\t}\n\n\t/**\n\t * Check if air quality is suitable for outdoor work\n\t */\n\tisSuitableForOutdoorWork(data: AirQualityData): {\n\t\tsuitable: boolean;\n\t\treason?: string;\n\t\tseverity: \"none\" | \"low\" | \"medium\" | \"high\";\n\t} {\n\t\tconst usEpaIndex = data.indexes.find((i) => i.code === \"us-epa\");\n\t\tconst aqi = usEpaIndex?.aqi || 0;\n\n\t\tif (aqi > 200) {\n\t\t\treturn {\n\t\t\t\tsuitable: false,\n\t\t\t\treason: `Very Unhealthy air quality (AQI: ${aqi})`,\n\t\t\t\tseverity: \"high\",\n\t\t\t};\n\t\t}\n\t\tif (aqi > 150) {\n\t\t\treturn {\n\t\t\t\tsuitable: false,\n\t\t\t\treason: `Unhealthy air quality (AQI: ${aqi})`,\n\t\t\t\tseverity: \"medium\",\n\t\t\t};\n\t\t}\n\t\tif (aqi > 100) {\n\t\t\treturn {\n\t\t\t\tsuitable: true,\n\t\t\t\treason: `Unhealthy for sensitive groups (AQI: ${aqi})`,\n\t\t\t\tseverity: \"low\",\n\t\t\t};\n\t\t}\n\n\t\treturn { suitable: true, severity: \"none\" };\n\t}\n\n\t/**\n\t * Get air quality summary for display\n\t */\n\tgetAirQualitySummary(data: AirQualityData): {\n\t\taqi: number;\n\t\tcategory: string;\n\t\tcolor: string;\n\t\tdominantPollutant: string;\n\t\tpm25: number;\n\t\trecommendation: string;\n\t\tsuitableForWork: boolean;\n\t} {\n\t\tconst usEpaIndex = data.indexes.find((i) => i.code === \"us-epa\") ||\n\t\t\tdata.indexes[0];\n\t\tconst pm25 = data.pollutants.find((p) => p.code === \"PM25\");\n\t\tconst workSuitability = this.isSuitableForOutdoorWork(data);\n\n\t\treturn {\n\t\t\taqi: usEpaIndex?.aqi || 0,\n\t\t\tcategory: usEpaIndex?.category || \"Unknown\",\n\t\t\tcolor: usEpaIndex?.color\n\t\t\t\t? `rgb(${usEpaIndex.color.red},${usEpaIndex.color.green},${usEpaIndex.color.blue})`\n\t\t\t\t: \"#808080\",\n\t\t\tdominantPollutant: usEpaIndex?.dominantPollutant || \"PM2.5\",\n\t\t\tpm25: pm25?.concentration.value || 0,\n\t\t\trecommendation:\n\t\t\t\tdata.healthRecommendations?.generalPopulation || \"No recommendations\",\n\t\t\tsuitableForWork: workSuitability.suitable,\n\t\t};\n\t}\n\n\t/**\n\t * Get HVAC filter replacement recommendation based on air quality\n\t */\n\tgetHVACFilterRecommendation(data: AirQualityData): {\n\t\tshouldReplace: boolean;\n\t\turgency: \"normal\" | \"soon\" | \"urgent\";\n\t\treason: string;\n\t\tupsellMessage?: string;\n\t} {\n\t\tconst pm25 = data.pollutants.find((p) => p.code === \"PM25\");\n\t\tconst pm25Value = pm25?.concentration.value || 0;\n\t\tconst usEpaIndex = data.indexes.find((i) => i.code === \"us-epa\");\n\t\tconst aqi = usEpaIndex?.aqi || 0;\n\n\t\tif (aqi > 150 || pm25Value > 35) {\n\t\t\treturn {\n\t\t\t\tshouldReplace: true,\n\t\t\t\turgency: \"urgent\",\n\t\t\t\treason: \"Poor air quality detected in area\",\n\t\t\t\tupsellMessage:\n\t\t\t\t\t\"Consider upgrading to a HEPA filter for better protection against high PM2.5 levels.\",\n\t\t\t};\n\t\t}\n\n\t\tif (aqi > 100 || pm25Value > 25) {\n\t\t\treturn {\n\t\t\t\tshouldReplace: true,\n\t\t\t\turgency: \"soon\",\n\t\t\t\treason: \"Moderate air quality - filters working harder\",\n\t\t\t\tupsellMessage:\n\t\t\t\t\t\"Air quality in this area is moderate. A higher-rated filter (MERV 11+) can provide better filtration.\",\n\t\t\t};\n\t\t}\n\n\t\tif (aqi > 50 || pm25Value > 12) {\n\t\t\treturn {\n\t\t\t\tshouldReplace: false,\n\t\t\t\turgency: \"normal\",\n\t\t\t\treason: \"Air quality is acceptable\",\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tshouldReplace: false,\n\t\t\turgency: \"normal\",\n\t\t\treason: \"Air quality is good\",\n\t\t};\n\t}\n\n\t/**\n\t * Clean up old cache entries\n\t */\n\tprivate cleanCache(): void {\n\t\tconst now = Date.now();\n\t\tfor (const [key, value] of this.cache.entries()) {\n\t\t\tif (now - value.timestamp > CACHE_TTL * 2) {\n\t\t\t\tthis.cache.delete(key);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Clear cache\n\t */\n\tclearCache(): void {\n\t\tthis.cache.clear();\n\t}\n}\n\n// Singleton instance\nexport const googleAirQualityService = new GoogleAirQualityService();\n","/**\n * Google Pollen Service\n *\n * Provides pollen data using Google Pollen API\n * - Tree pollen levels\n * - Grass pollen levels\n * - Weed pollen levels\n * - Daily forecasts\n * - 1km resolution data\n *\n * API: Google Pollen API\n * Docs: https://developers.google.com/maps/documentation/pollen\n *\n * Use Cases for Field Service:\n * - HVAC filter upsells during high pollen seasons\n * - Air quality recommendations\n * - Scheduling outdoor work\n * - Customer health notifications\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst PollenTypeSchema = z.object({\n\tcode: z.string(), // TREE, GRASS, WEED\n\tdisplayName: z.string(),\n\tindexInfo: z.object({\n\t\tcode: z.string(), // UPI (Universal Pollen Index)\n\t\tdisplayName: z.string(),\n\t\tvalue: z.number(), // 0-5 scale\n\t\tcategory: z.string(), // None, Very Low, Low, Moderate, High, Very High\n\t\tindexDescription: z.string().optional(),\n\t\tcolor: z\n\t\t\t.object({\n\t\t\t\tred: z.number(),\n\t\t\t\tgreen: z.number(),\n\t\t\t\tblue: z.number(),\n\t\t\t})\n\t\t\t.optional(),\n\t}),\n\thealthRecommendations: z.array(z.string()).optional(),\n\tinSeason: z.boolean(),\n});\n\nconst PlantInfoSchema = z.object({\n\tcode: z.string(), // e.g., OAK, BIRCH, RAGWEED\n\tdisplayName: z.string(),\n\tindexInfo: z.object({\n\t\tvalue: z.number(),\n\t\tcategory: z.string(),\n\t}),\n\tplantDescription: z\n\t\t.object({\n\t\t\ttype: z.string(),\n\t\t\tfamily: z.string().optional(),\n\t\t\tseason: z.string().optional(),\n\t\t\tcrossReaction: z.string().optional(),\n\t\t})\n\t\t.optional(),\n\tinSeason: z.boolean(),\n});\n\nconst DailyPollenForecastSchema = z.object({\n\tdate: z.string(), // YYYY-MM-DD\n\tpollenTypes: z.array(PollenTypeSchema),\n\tplants: z.array(PlantInfoSchema).optional(),\n});\n\nconst PollenDataSchema = z.object({\n\tlocation: z.object({\n\t\tlat: z.number(),\n\t\tlng: z.number(),\n\t}),\n\tregionCode: z.string().optional(),\n\tdailyInfo: z.array(DailyPollenForecastSchema),\n\tsource: z.enum([\"google\", \"openmeteo\"]),\n\tenrichedAt: z.string(),\n});\n\nexport type PollenType = z.infer<typeof PollenTypeSchema>;\nexport type PlantInfo = z.infer<typeof PlantInfoSchema>;\nexport type DailyPollenForecast = z.infer<typeof DailyPollenForecastSchema>;\nexport type PollenData = z.infer<typeof PollenDataSchema>;\n\n// ============================================================================\n// Cache Configuration\n// ============================================================================\n\nconst CACHE_TTL = 6 * 60 * 60 * 1000; // 6 hours (pollen doesn't change quickly)\n\n// ============================================================================\n// Google Pollen Service\n// ============================================================================\n\nclass GooglePollenService {\n\tprivate readonly apiKey: string | undefined;\n\tprivate readonly cache: Map<\n\t\tstring,\n\t\t{ data: PollenData; timestamp: number }\n\t> = new Map();\n\n\tconstructor() {\n\t\t// Use unified GOOGLE_API_KEY for all Google services\n\t\tthis.apiKey =\n\t\t\tprocess.env.GOOGLE_API_KEY ||\n\t\t\tprocess.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY ||\n\t\t\tprocess.env.GOOGLE_MAPS_API_KEY;\n\t}\n\n\t/**\n\t * Check if service is available\n\t */\n\tisAvailable(): boolean {\n\t\treturn !!this.apiKey;\n\t}\n\n\t/**\n\t * Get pollen data for a location (5-day forecast)\n\t */\n\tasync getPollenData(lat: number, lng: number): Promise<PollenData | null> {\n\t\tconst cacheKey = `pollen:${lat.toFixed(3)},${lng.toFixed(3)}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\t\tif (cached && Date.now() - cached.timestamp < CACHE_TTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\t// Try Google Pollen API first\n\t\tif (this.apiKey) {\n\t\t\tconst googleData = await this.fetchFromGoogle(lat, lng);\n\t\t\tif (googleData) {\n\t\t\t\tthis.cache.set(cacheKey, { data: googleData, timestamp: Date.now() });\n\t\t\t\tthis.cleanCache();\n\t\t\t\treturn googleData;\n\t\t\t}\n\t\t}\n\n\t\t// Fallback to Open-Meteo (limited pollen data)\n\t\tconst openMeteoData = await this.fetchFromOpenMeteo(lat, lng);\n\t\tif (openMeteoData) {\n\t\t\tthis.cache.set(cacheKey, {\n\t\t\t\tdata: openMeteoData,\n\t\t\t\ttimestamp: Date.now(),\n\t\t\t});\n\t\t\tthis.cleanCache();\n\t\t\treturn openMeteoData;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Fetch from Google Pollen API\n\t */\n\tprivate async fetchFromGoogle(\n\t\tlat: number,\n\t\tlng: number,\n\t): Promise<PollenData | null> {\n\t\ttry {\n\t\t\tconst url = `https://pollen.googleapis.com/v1/forecast:lookup?key=${this.apiKey}`;\n\n\t\t\tconst response = await fetch(url, {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\"User-Agent\": USER_AGENT,\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tlocation: { latitude: lat, longitude: lng },\n\t\t\t\t\tdays: 5,\n\t\t\t\t\tlanguageCode: \"en\",\n\t\t\t\t\tplantsDescription: true,\n\t\t\t\t}),\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.error(`Google Pollen API error: ${response.status}`);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\n\t\t\tif (!data.dailyInfo) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst dailyInfo: DailyPollenForecast[] = data.dailyInfo.map(\n\t\t\t\t(day: any) => {\n\t\t\t\t\tconst pollenTypes: PollenType[] = (day.pollenTypeInfo || []).map(\n\t\t\t\t\t\t(pt: any) => ({\n\t\t\t\t\t\t\tcode: pt.code || \"UNKNOWN\",\n\t\t\t\t\t\t\tdisplayName: pt.displayName || pt.code,\n\t\t\t\t\t\t\tindexInfo: {\n\t\t\t\t\t\t\t\tcode: pt.indexInfo?.code || \"UPI\",\n\t\t\t\t\t\t\t\tdisplayName: pt.indexInfo?.displayName || \"Universal Pollen Index\",\n\t\t\t\t\t\t\t\tvalue: pt.indexInfo?.value || 0,\n\t\t\t\t\t\t\t\tcategory: pt.indexInfo?.category || \"None\",\n\t\t\t\t\t\t\t\tindexDescription: pt.indexInfo?.indexDescription,\n\t\t\t\t\t\t\t\tcolor: pt.indexInfo?.color,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\thealthRecommendations: pt.healthRecommendations,\n\t\t\t\t\t\t\tinSeason: pt.inSeason || false,\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\n\t\t\t\t\tconst plants: PlantInfo[] = (day.plantInfo || []).map((p: any) => ({\n\t\t\t\t\t\tcode: p.code || \"UNKNOWN\",\n\t\t\t\t\t\tdisplayName: p.displayName || p.code,\n\t\t\t\t\t\tindexInfo: {\n\t\t\t\t\t\t\tvalue: p.indexInfo?.value || 0,\n\t\t\t\t\t\t\tcategory: p.indexInfo?.category || \"None\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tplantDescription: p.plantDescription,\n\t\t\t\t\t\tinSeason: p.inSeason || false,\n\t\t\t\t\t}));\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdate: day.date?.year\n\t\t\t\t\t\t\t? `${day.date.year}-${String(day.date.month).padStart(2, \"0\")}-${String(day.date.day).padStart(2, \"0\")}`\n\t\t\t\t\t\t\t: new Date().toISOString().split(\"T\")[0],\n\t\t\t\t\t\tpollenTypes,\n\t\t\t\t\t\tplants: plants.length > 0 ? plants : undefined,\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t);\n\n\t\t\treturn {\n\t\t\t\tlocation: { lat, lng },\n\t\t\t\tregionCode: data.regionCode,\n\t\t\t\tdailyInfo,\n\t\t\t\tsource: \"google\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Google Pollen fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Fetch from Open-Meteo (limited pollen data as fallback)\n\t */\n\tprivate async fetchFromOpenMeteo(\n\t\tlat: number,\n\t\tlng: number,\n\t): Promise<PollenData | null> {\n\t\ttry {\n\t\t\tconst url = new URL(\"https://air-quality-api.open-meteo.com/v1/air-quality\");\n\t\t\turl.searchParams.set(\"latitude\", lat.toString());\n\t\t\turl.searchParams.set(\"longitude\", lng.toString());\n\t\t\turl.searchParams.set(\n\t\t\t\t\"hourly\",\n\t\t\t\t\"alder_pollen,birch_pollen,grass_pollen,mugwort_pollen,olive_pollen,ragweed_pollen\",\n\t\t\t);\n\t\t\turl.searchParams.set(\"forecast_days\", \"5\");\n\n\t\t\tconst response = await fetch(url.toString(), {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\t\t\tconst hourly = data.hourly;\n\n\t\t\tif (!hourly?.time) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Group by day and aggregate\n\t\t\tconst dayMap = new Map<string, { tree: number[]; grass: number[]; weed: number[] }>();\n\n\t\t\tfor (let i = 0; i < hourly.time.length; i++) {\n\t\t\t\tconst date = hourly.time[i].split(\"T\")[0];\n\t\t\t\tif (!dayMap.has(date)) {\n\t\t\t\t\tdayMap.set(date, { tree: [], grass: [], weed: [] });\n\t\t\t\t}\n\n\t\t\t\tconst day = dayMap.get(date)!;\n\n\t\t\t\t// Tree pollen (alder, birch, olive)\n\t\t\t\tconst treePollen =\n\t\t\t\t\t(hourly.alder_pollen?.[i] || 0) +\n\t\t\t\t\t(hourly.birch_pollen?.[i] || 0) +\n\t\t\t\t\t(hourly.olive_pollen?.[i] || 0);\n\t\t\t\tday.tree.push(treePollen);\n\n\t\t\t\t// Grass pollen\n\t\t\t\tday.grass.push(hourly.grass_pollen?.[i] || 0);\n\n\t\t\t\t// Weed pollen (mugwort, ragweed)\n\t\t\t\tconst weedPollen =\n\t\t\t\t\t(hourly.mugwort_pollen?.[i] || 0) +\n\t\t\t\t\t(hourly.ragweed_pollen?.[i] || 0);\n\t\t\t\tday.weed.push(weedPollen);\n\t\t\t}\n\n\t\t\tconst dailyInfo: DailyPollenForecast[] = Array.from(dayMap.entries())\n\t\t\t\t.slice(0, 5)\n\t\t\t\t.map(([date, values]) => {\n\t\t\t\t\tconst avgTree = this.average(values.tree);\n\t\t\t\t\tconst avgGrass = this.average(values.grass);\n\t\t\t\t\tconst avgWeed = this.average(values.weed);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdate,\n\t\t\t\t\t\tpollenTypes: [\n\t\t\t\t\t\t\tthis.createPollenType(\"TREE\", \"Tree Pollen\", avgTree),\n\t\t\t\t\t\t\tthis.createPollenType(\"GRASS\", \"Grass Pollen\", avgGrass),\n\t\t\t\t\t\t\tthis.createPollenType(\"WEED\", \"Weed Pollen\", avgWeed),\n\t\t\t\t\t\t],\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\treturn {\n\t\t\t\tlocation: { lat, lng },\n\t\t\t\tdailyInfo,\n\t\t\t\tsource: \"openmeteo\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Open-Meteo pollen fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Create a PollenType object from concentration\n\t */\n\tprivate createPollenType(\n\t\tcode: string,\n\t\tdisplayName: string,\n\t\tconcentration: number,\n\t): PollenType {\n\t\tconst { value, category, color } =\n\t\t\tthis.concentrationToIndex(concentration);\n\n\t\treturn {\n\t\t\tcode,\n\t\t\tdisplayName,\n\t\t\tindexInfo: {\n\t\t\t\tcode: \"UPI\",\n\t\t\t\tdisplayName: \"Universal Pollen Index\",\n\t\t\t\tvalue,\n\t\t\t\tcategory,\n\t\t\t\tcolor,\n\t\t\t},\n\t\t\tinSeason: value > 0,\n\t\t};\n\t}\n\n\t/**\n\t * Convert concentration to pollen index (0-5)\n\t */\n\tprivate concentrationToIndex(concentration: number): {\n\t\tvalue: number;\n\t\tcategory: string;\n\t\tcolor: { red: number; green: number; blue: number };\n\t} {\n\t\t// Rough mapping based on typical thresholds (grains/m³)\n\t\tif (concentration < 10) {\n\t\t\treturn {\n\t\t\t\tvalue: 0,\n\t\t\t\tcategory: \"None\",\n\t\t\t\tcolor: { red: 128, green: 128, blue: 128 },\n\t\t\t};\n\t\t}\n\t\tif (concentration < 30) {\n\t\t\treturn {\n\t\t\t\tvalue: 1,\n\t\t\t\tcategory: \"Very Low\",\n\t\t\t\tcolor: { red: 144, green: 238, blue: 144 },\n\t\t\t};\n\t\t}\n\t\tif (concentration < 60) {\n\t\t\treturn {\n\t\t\t\tvalue: 2,\n\t\t\t\tcategory: \"Low\",\n\t\t\t\tcolor: { red: 255, green: 255, blue: 0 },\n\t\t\t};\n\t\t}\n\t\tif (concentration < 100) {\n\t\t\treturn {\n\t\t\t\tvalue: 3,\n\t\t\t\tcategory: \"Moderate\",\n\t\t\t\tcolor: { red: 255, green: 165, blue: 0 },\n\t\t\t};\n\t\t}\n\t\tif (concentration < 200) {\n\t\t\treturn {\n\t\t\t\tvalue: 4,\n\t\t\t\tcategory: \"High\",\n\t\t\t\tcolor: { red: 255, green: 0, blue: 0 },\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tvalue: 5,\n\t\t\tcategory: \"Very High\",\n\t\t\tcolor: { red: 128, green: 0, blue: 128 },\n\t\t};\n\t}\n\n\tprivate average(arr: number[]): number {\n\t\tif (arr.length === 0) return 0;\n\t\treturn arr.reduce((a, b) => a + b, 0) / arr.length;\n\t}\n\n\t/**\n\t * Get today's pollen summary\n\t */\n\tgetTodaysSummary(data: PollenData): {\n\t\toverallLevel: string;\n\t\toverallValue: number;\n\t\tcolor: string;\n\t\ttree: { level: string; value: number };\n\t\tgrass: { level: string; value: number };\n\t\tweed: { level: string; value: number };\n\t\thighestType: string;\n\t\tisHighPollenDay: boolean;\n\t} | null {\n\t\tconst today = data.dailyInfo[0];\n\t\tif (!today) return null;\n\n\t\tconst tree = today.pollenTypes.find((p) => p.code === \"TREE\");\n\t\tconst grass = today.pollenTypes.find((p) => p.code === \"GRASS\");\n\t\tconst weed = today.pollenTypes.find((p) => p.code === \"WEED\");\n\n\t\tconst maxValue = Math.max(\n\t\t\ttree?.indexInfo.value || 0,\n\t\t\tgrass?.indexInfo.value || 0,\n\t\t\tweed?.indexInfo.value || 0,\n\t\t);\n\n\t\tconst highestType =\n\t\t\tmaxValue === (tree?.indexInfo.value || 0)\n\t\t\t\t? \"Tree\"\n\t\t\t\t: maxValue === (grass?.indexInfo.value || 0)\n\t\t\t\t\t? \"Grass\"\n\t\t\t\t\t: \"Weed\";\n\n\t\tconst { category: overallLevel, color } = this.valueToCategory(maxValue);\n\n\t\treturn {\n\t\t\toverallLevel,\n\t\t\toverallValue: maxValue,\n\t\t\tcolor: `rgb(${color.red},${color.green},${color.blue})`,\n\t\t\ttree: {\n\t\t\t\tlevel: tree?.indexInfo.category || \"None\",\n\t\t\t\tvalue: tree?.indexInfo.value || 0,\n\t\t\t},\n\t\t\tgrass: {\n\t\t\t\tlevel: grass?.indexInfo.category || \"None\",\n\t\t\t\tvalue: grass?.indexInfo.value || 0,\n\t\t\t},\n\t\t\tweed: {\n\t\t\t\tlevel: weed?.indexInfo.category || \"None\",\n\t\t\t\tvalue: weed?.indexInfo.value || 0,\n\t\t\t},\n\t\t\thighestType,\n\t\t\tisHighPollenDay: maxValue >= 4,\n\t\t};\n\t}\n\n\tprivate valueToCategory(value: number): {\n\t\tcategory: string;\n\t\tcolor: { red: number; green: number; blue: number };\n\t} {\n\t\tconst categories = [\n\t\t\t{ category: \"None\", color: { red: 128, green: 128, blue: 128 } },\n\t\t\t{ category: \"Very Low\", color: { red: 144, green: 238, blue: 144 } },\n\t\t\t{ category: \"Low\", color: { red: 255, green: 255, blue: 0 } },\n\t\t\t{ category: \"Moderate\", color: { red: 255, green: 165, blue: 0 } },\n\t\t\t{ category: \"High\", color: { red: 255, green: 0, blue: 0 } },\n\t\t\t{ category: \"Very High\", color: { red: 128, green: 0, blue: 128 } },\n\t\t];\n\t\treturn categories[Math.min(value, 5)];\n\t}\n\n\t/**\n\t * Check if pollen levels warrant HVAC filter upsell\n\t */\n\tgetHVACUpsellRecommendation(data: PollenData): {\n\t\tshouldUpsell: boolean;\n\t\turgency: \"none\" | \"low\" | \"medium\" | \"high\";\n\t\tmessage: string;\n\t\tfilterRecommendation?: string;\n\t\thighestPollenType?: string;\n\t} {\n\t\tconst summary = this.getTodaysSummary(data);\n\t\tif (!summary) {\n\t\t\treturn {\n\t\t\t\tshouldUpsell: false,\n\t\t\t\turgency: \"none\",\n\t\t\t\tmessage: \"Pollen data unavailable\",\n\t\t\t};\n\t\t}\n\n\t\tif (summary.overallValue >= 4) {\n\t\t\treturn {\n\t\t\t\tshouldUpsell: true,\n\t\t\t\turgency: \"high\",\n\t\t\t\tmessage: `Very high ${summary.highestType.toLowerCase()} pollen levels in this area.`,\n\t\t\t\tfilterRecommendation:\n\t\t\t\t\t\"Recommend HEPA filter or MERV 13+ for optimal allergen filtration.\",\n\t\t\t\thighestPollenType: summary.highestType,\n\t\t\t};\n\t\t}\n\n\t\tif (summary.overallValue >= 3) {\n\t\t\treturn {\n\t\t\t\tshouldUpsell: true,\n\t\t\t\turgency: \"medium\",\n\t\t\t\tmessage: `Moderate to high ${summary.highestType.toLowerCase()} pollen detected.`,\n\t\t\t\tfilterRecommendation:\n\t\t\t\t\t\"Consider upgrading to MERV 11+ filter for better pollen filtration.\",\n\t\t\t\thighestPollenType: summary.highestType,\n\t\t\t};\n\t\t}\n\n\t\tif (summary.overallValue >= 2) {\n\t\t\treturn {\n\t\t\t\tshouldUpsell: false,\n\t\t\t\turgency: \"low\",\n\t\t\t\tmessage: `Low ${summary.highestType.toLowerCase()} pollen levels.`,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tshouldUpsell: false,\n\t\t\turgency: \"none\",\n\t\t\tmessage: \"Pollen levels are minimal.\",\n\t\t};\n\t}\n\n\t/**\n\t * Get 5-day pollen forecast for scheduling\n\t */\n\tget5DayForecast(data: PollenData): Array<{\n\t\tdate: string;\n\t\tdayName: string;\n\t\toverall: { level: string; value: number; color: string };\n\t\ttree: number;\n\t\tgrass: number;\n\t\tweed: number;\n\t\tisBadDay: boolean;\n\t}> {\n\t\tconst days = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n\n\t\treturn data.dailyInfo.map((day) => {\n\t\t\tconst tree =\n\t\t\t\tday.pollenTypes.find((p) => p.code === \"TREE\")?.indexInfo.value || 0;\n\t\t\tconst grass =\n\t\t\t\tday.pollenTypes.find((p) => p.code === \"GRASS\")?.indexInfo.value || 0;\n\t\t\tconst weed =\n\t\t\t\tday.pollenTypes.find((p) => p.code === \"WEED\")?.indexInfo.value || 0;\n\n\t\t\tconst maxValue = Math.max(tree, grass, weed);\n\t\t\tconst { category, color } = this.valueToCategory(maxValue);\n\t\t\tconst date = new Date(day.date);\n\n\t\t\treturn {\n\t\t\t\tdate: day.date,\n\t\t\t\tdayName: days[date.getDay()],\n\t\t\t\toverall: {\n\t\t\t\t\tlevel: category,\n\t\t\t\t\tvalue: maxValue,\n\t\t\t\t\tcolor: `rgb(${color.red},${color.green},${color.blue})`,\n\t\t\t\t},\n\t\t\t\ttree,\n\t\t\t\tgrass,\n\t\t\t\tweed,\n\t\t\t\tisBadDay: maxValue >= 4,\n\t\t\t};\n\t\t});\n\t}\n\n\t/**\n\t * Clean up old cache entries\n\t */\n\tprivate cleanCache(): void {\n\t\tconst now = Date.now();\n\t\tfor (const [key, value] of this.cache.entries()) {\n\t\t\tif (now - value.timestamp > CACHE_TTL * 2) {\n\t\t\t\tthis.cache.delete(key);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Clear cache\n\t */\n\tclearCache(): void {\n\t\tthis.cache.clear();\n\t}\n}\n\n// Singleton instance\nexport const googlePollenService = new GooglePollenService();\n"],"names":[],"mappings":"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"}