module.exports=[456295,e=>{"use strict";var t=e.i(443608);let r="Thorbis-FMS/1.0 (support@thorbis.app)",i=t.z.object({event:t.z.string(),headline:t.z.string(),description:t.z.string(),severity:t.z.enum(["Extreme","Severe","Moderate","Minor","Unknown"]),urgency:t.z.enum(["Immediate","Expected","Future","Past","Unknown"]),onset:t.z.string().optional(),expires:t.z.string().optional(),instruction:t.z.string().nullable().optional()}),n=t.z.object({number:t.z.number(),name:t.z.string(),temperature:t.z.number(),temperatureUnit:t.z.string(),windSpeed:t.z.string(),windDirection:t.z.string(),shortForecast:t.z.string(),detailedForecast:t.z.string(),startTime:t.z.string(),endTime:t.z.string()}),s=t.z.object({location:t.z.object({lat:t.z.number(),lon:t.z.number(),gridId:t.z.string().optional(),gridX:t.z.number().optional(),gridY:t.z.number().optional()}),forecast:t.z.object({periods:t.z.array(n),updated:t.z.string().optional()}).optional(),hourly:t.z.object({periods:t.z.array(n),updated:t.z.string().optional()}).optional(),alerts:t.z.array(i),hasActiveAlerts:t.z.boolean(),highestSeverity:t.z.enum(["Extreme","Severe","Moderate","Minor","None"]),enrichedAt:t.z.string()});class o{cache=new Map;cacheTTL=18e5;async getWeatherData(e,t){let i=`${e.toFixed(4)},${t.toFixed(4)}`,n=this.cache.get(i);if(n&&Date.now()-n.timestamp<this.cacheTTL)return n.data;try{let n=await fetch(`https://api.weather.gov/points/${e.toFixed(4)},${t.toFixed(4)}`,{headers:{"User-Agent":r,Accept:"application/geo+json"}});if(!n.ok)return null;let o=(await n.json()).properties,[a,c,p]=await Promise.all([o.forecast?this.fetchJson(o.forecast):Promise.resolve(null),o.forecastHourly?this.fetchJson(o.forecastHourly):Promise.resolve(null),this.fetchJson(`https://api.weather.gov/alerts/active?point=${e},${t}`)]),d=[],u="None";if(p?.features)for(let e of p.features){let t=e.properties,r={event:t.event||"Unknown Event",headline:t.headline||"",description:t.description||"",severity:this.normalizeSeverity(t.severity),urgency:this.normalizeUrgency(t.urgency),onset:t.onset,expires:t.expires,instruction:t.instruction};d.push(r),"Unknown"!==r.severity&&this.severityRank(r.severity)>this.severityRank(u)&&(u=r.severity)}let l={location:{lat:e,lon:t,gridId:o.gridId,gridX:o.gridX,gridY:o.gridY},forecast:a?{periods:a.properties.periods.map(e=>({number:e.number,name:e.name,temperature:e.temperature,temperatureUnit:e.temperatureUnit,windSpeed:e.windSpeed,windDirection:e.windDirection,shortForecast:e.shortForecast,detailedForecast:e.detailedForecast,startTime:e.startTime,endTime:e.endTime})),updated:a.properties.updated||a.properties.generatedAt}:void 0,hourly:c?{periods:c.properties.periods.slice(0,24).map(e=>({number:e.number,name:e.name,temperature:e.temperature,temperatureUnit:e.temperatureUnit,windSpeed:e.windSpeed,windDirection:e.windDirection,shortForecast:e.shortForecast,detailedForecast:e.detailedForecast,startTime:e.startTime,endTime:e.endTime})),updated:c.properties.updated||c.properties.generatedAt}:void 0,alerts:d,hasActiveAlerts:d.length>0,highestSeverity:u,enrichedAt:new Date().toISOString()};return this.cache.set(i,{data:l,timestamp:Date.now()}),s.parse(l)}catch(e){return null}}async getActiveAlerts(e,t){try{let r=await this.fetchJson(`https://api.weather.gov/alerts/active?point=${e},${t}`);if(!r?.features)return[];return r.features.map(e=>({event:e.properties.event||"Unknown Event",headline:e.properties.headline||"",description:e.properties.description||"",severity:this.normalizeSeverity(e.properties.severity),urgency:this.normalizeUrgency(e.properties.urgency),onset:e.properties.onset,expires:e.properties.expires,instruction:e.properties.instruction}))}catch(e){return[]}}isSuitableForOutdoorWork(e){if("Extreme"===e.highestSeverity||"Severe"===e.highestSeverity)return{suitable:!1,reason:"Severe weather alert in effect"};if(e.hourly?.periods?.[0]){let t=e.hourly.periods[0];if(t.shortForecast.toLowerCase().includes("rain")||t.shortForecast.toLowerCase().includes("storm")||t.shortForecast.toLowerCase().includes("snow"))return{suitable:!1,reason:`${t.shortForecast} expected`};if(t.temperature<32)return{suitable:!1,reason:"Freezing temperatures"};if(t.temperature>100)return{suitable:!1,reason:"Extreme heat"}}return{suitable:!0}}async fetchJson(e){let t=await fetch(e,{headers:{"User-Agent":r,Accept:"application/geo+json"}});if(!t.ok)throw Error(`Fetch failed: ${t.status} ${e}`);return t.json()}normalizeSeverity(e){if(!e)return"Unknown";let t=e.toLowerCase();return t.includes("extreme")?"Extreme":t.includes("severe")?"Severe":t.includes("moderate")?"Moderate":t.includes("minor")?"Minor":"Unknown"}normalizeUrgency(e){if(!e)return"Unknown";let t=e.toLowerCase();return t.includes("immediate")?"Immediate":t.includes("expected")?"Expected":t.includes("future")?"Future":t.includes("past")?"Past":"Unknown"}severityRank(e){switch(e){case"Extreme":return 4;case"Severe":return 3;case"Moderate":return 2;case"Minor":return 1;default:return 0}}clearCache(){this.cache.clear()}}let a=new o;e.s(["WeatherService",()=>o,"weatherService",0,a])}];

//# sourceMappingURL=apps_web_src_lib_services_weather-service_ts_6a46781d._.js.map