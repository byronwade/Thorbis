module.exports=[605497,e=>{"use strict";var t=e.i(755535),a=e.i(377233),r=e.i(490003),n=e.i(492991),s=e.i(241970),i=e.i(357699),o=e.i(212454),l=e.i(48717),u=e.i(798301),c=e.i(986366),d=e.i(983537),g=e.i(147475),p=e.i(561930),h=e.i(803747),f=e.i(368557),m=e.i(42037),w=e.i(193695);e.i(432036);var y=e.i(573881),R=e.i(297676),x=e.i(443608);e.i(715051);var T=e.i(511368);let v=x.z.object({translatedText:x.z.string(),detectedSourceLanguage:x.z.string().optional(),model:x.z.string().optional()}),C=x.z.object({data:x.z.object({translations:x.z.array(v)})}),E=x.z.object({data:x.z.object({detections:x.z.array(x.z.array(x.z.object({language:x.z.string(),confidence:x.z.number(),isReliable:x.z.boolean().optional()})))})}),b=x.z.object({data:x.z.object({languages:x.z.array(x.z.object({language:x.z.string(),name:x.z.string().optional()}))})}),S={es:{"work order":"orden de trabajo",estimate:"presupuesto",invoice:"factura",appointment:"cita",technician:"técnico",customer:"cliente",property:"propiedad","service call":"llamada de servicio",warranty:"garantía","parts and labor":"piezas y mano de obra","air conditioning":"aire acondicionado",heating:"calefacción",plumbing:"plomería",electrical:"eléctrico","water heater":"calentador de agua",thermostat:"termostato",compressor:"compresor","circuit breaker":"disyuntor","scheduled for":"programado para","en route":"en camino",completed:"completado",pending:"pendiente"}};class A{static instance;apiKey;baseUrl="https://translation.googleapis.com/language/translate/v2";translationCache=new Map;TRANSLATION_CACHE_TTL=36e5;languagesCache=null;LANGUAGES_CACHE_TTL=864e5;constructor(){this.apiKey=process.env.GOOGLE_API_KEY||"AIzaSyCVKN0pddG230vvjT0EMP9sSIR31j1q2t0",this.apiKey||console.warn("GoogleTranslationService: No API key found. Set GOOGLE_API_KEY environment variable.")}static getInstance(){return A.instance||(A.instance=new A),A.instance}isConfigured(){return!!this.apiKey}getCacheKey(e,t,a){return`${e}_${t}_${a||"auto"}`}cleanCache(){let e=Date.now();for(let[t,a]of this.translationCache.entries())e-a.timestamp>this.TRANSLATION_CACHE_TTL&&this.translationCache.delete(t)}async translate(e,t,a,r="text"){if(!this.apiKey)throw Error("Translation API key not configured");let n=this.getCacheKey(e,t,a);this.cleanCache();let s=this.translationCache.get(n);if(s)return s.result;let i=new URLSearchParams({key:this.apiKey,q:e,target:t,format:r});a&&i.set("source",a);let o=await fetch(`${this.baseUrl}?${i.toString()}`,{method:"POST"});if(!o.ok){let e=await o.json();throw Error(`Translation API error: ${e.error?.message||o.statusText}`)}let l=await o.json(),u=C.parse(l).data.translations[0];return this.translationCache.set(n,{result:u,timestamp:Date.now()}),u}async translateBatch(e,t,a){if(!this.apiKey)throw Error("Translation API key not configured");if(0===e.length)return[];let r=new URLSearchParams({key:this.apiKey,target:t,format:"text"});a&&r.set("source",a);let n=[r.toString(),...e.map(e=>`q=${encodeURIComponent(e)}`)],s=await fetch(`${this.baseUrl}?${n.join("&")}`,{method:"POST"});if(!s.ok){let e=await s.json();throw Error(`Translation API error: ${e.error?.message||s.statusText}`)}let i=await s.json();return C.parse(i).data.translations}async detectLanguage(e){if(!this.apiKey)throw Error("Translation API key not configured");let t=new URLSearchParams({key:this.apiKey,q:e}),a=await fetch(`${this.baseUrl}/detect?${t.toString()}`,{method:"POST"});if(!a.ok){let e=await a.json();throw Error(`Language detection error: ${e.error?.message||a.statusText}`)}let r=await a.json(),n=E.parse(r).data.detections[0][0];return{language:n.language,confidence:n.confidence,isReliable:n.isReliable??n.confidence>.5}}async getSupportedLanguages(e="en"){if(!this.apiKey)throw Error("Translation API key not configured");if(this.languagesCache&&Date.now()-this.languagesCache.timestamp<this.LANGUAGES_CACHE_TTL)return this.languagesCache.languages;let t=new URLSearchParams({key:this.apiKey,target:e}),a=await fetch(`${this.baseUrl}/languages?${t.toString()}`);if(!a.ok){let e=await a.json();throw Error(`Get languages error: ${e.error?.message||a.statusText}`)}let r=await a.json(),n=b.parse(r).data.languages.map(e=>({language:e.language,name:e.name||e.language,supportSource:!0,supportTarget:!0}));return this.languagesCache={languages:n,timestamp:Date.now()},n}async translateCustomerMessage(e,t){let a=await this.detectLanguage(e);return a.language===t?{translatedText:e,detectedSourceLanguage:a.language}:this.translate(e,t,a.language)}async translateNotification(e,t){if("en"===t)return e;let[a,r]=await this.translateBatch([e.title,e.body],t,"en");return{title:a.translatedText,body:r.translatedText}}async translateDocument(e,t){if("en"===t)return e;let a=[],r=[];if(e.description&&(a.push(e.description),r.push({field:"description"})),e.notes&&(a.push(e.notes),r.push({field:"notes"})),e.lineItems&&e.lineItems.forEach((e,t)=>{a.push(e.description),r.push({field:"lineItem",index:t})}),0===a.length)return e;let n=await this.translateBatch(a,t,"en"),s={},i=e.lineItems?[...e.lineItems]:[];return n.forEach((e,t)=>{let a=r[t];"description"===a.field?s.description=e.translatedText:"notes"===a.field?s.notes=e.translatedText:"lineItem"===a.field&&void 0!==a.index&&(i[a.index]={description:e.translatedText})}),e.lineItems&&(s.lineItems=i),s}async getFieldServicePhrase(e,t){let a=S[t];if(a){let t=e.toLowerCase();if(a[t])return a[t]}return(await this.translate(e,t,"en")).translatedText}async translateChatMessage(e,t){let a=await this.detectLanguage(e);if(a.language===t)return{original:e,translated:e,sourceLanguage:a.language,targetLanguage:t,wasTranslated:!1};let r=await this.translate(e,t,a.language);return{original:e,translated:r.translatedText,sourceLanguage:a.language,targetLanguage:t,wasTranslated:!0}}clearCache(){this.translationCache.clear(),this.languagesCache=null}}let L=A.getInstance(),j=x.z.object({text:x.z.union([x.z.string().min(1,"Text is required"),x.z.array(x.z.string().min(1))]),targetLanguage:x.z.string().min(2,"Target language is required"),sourceLanguage:x.z.string().optional(),type:x.z.enum(["general","customer_message","notification","document","chat","field_service_phrase"]).default("general"),notification:x.z.object({title:x.z.string(),body:x.z.string()}).optional(),document:x.z.object({description:x.z.string().optional(),notes:x.z.string().optional(),lineItems:x.z.array(x.z.object({description:x.z.string()})).optional()}).optional(),preferredLanguage:x.z.string().optional()});async function N(e){try{let t,a=await (0,T.createClient)(),{data:{user:r}}=await a.auth.getUser();if(!r)return R.NextResponse.json({error:"Unauthorized"},{status:401});if(!L.isConfigured())return R.NextResponse.json({error:"Translation service is not configured. Set GOOGLE_API_KEY environment variable."},{status:503});let n=await e.json(),s=j.parse(n),i=s.targetLanguage,o=s.sourceLanguage;switch(s.type){case"customer_message":if("string"!=typeof s.text)return R.NextResponse.json({error:"Single text string required for customer_message type"},{status:400});let l=await L.translateCustomerMessage(s.text,i);t={translatedText:l.translatedText,detectedSourceLanguage:l.detectedSourceLanguage};break;case"notification":if(!s.notification)return R.NextResponse.json({error:"Notification object required for notification type"},{status:400});t={notification:await L.translateNotification(s.notification,i)};break;case"document":if(!s.document)return R.NextResponse.json({error:"Document object required for document type"},{status:400});t={document:await L.translateDocument(s.document,i)};break;case"chat":if("string"!=typeof s.text)return R.NextResponse.json({error:"Single text string required for chat type"},{status:400});let u=s.preferredLanguage||i,c=await L.translateChatMessage(s.text,u);t={original:c.original,translated:c.translated,sourceLanguage:c.sourceLanguage,targetLanguage:c.targetLanguage,wasTranslated:c.wasTranslated};break;case"field_service_phrase":if("string"!=typeof s.text)return R.NextResponse.json({error:"Single text string required for field_service_phrase type"},{status:400});t={translatedText:await L.getFieldServicePhrase(s.text,i),sourceLanguage:"en",targetLanguage:i};break;default:if(Array.isArray(s.text))t={translations:(await L.translateBatch(s.text,i,o)).map(e=>({translatedText:e.translatedText,detectedSourceLanguage:e.detectedSourceLanguage}))};else{let e=await L.translate(s.text,i,o);t={translatedText:e.translatedText,detectedSourceLanguage:e.detectedSourceLanguage}}}return R.NextResponse.json({success:!0,data:t})}catch(e){if(console.error("Translation error:",e),e instanceof x.z.ZodError)return R.NextResponse.json({error:"Invalid request data",details:e.errors},{status:400});return R.NextResponse.json({error:"Failed to translate",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function _(e){try{let t=await (0,T.createClient)(),{data:{user:a}}=await t.auth.getUser();if(!a)return R.NextResponse.json({error:"Unauthorized"},{status:401});if(!L.isConfigured())return R.NextResponse.json({error:"Translation service is not configured. Set GOOGLE_API_KEY environment variable."},{status:503});let{searchParams:r}=new URL(e.url),n=r.get("action");if("detect"===n){let e=r.get("text");if(!e)return R.NextResponse.json({error:"Text parameter required"},{status:400});let t=await L.detectLanguage(e);return R.NextResponse.json({success:!0,data:{language:t.language,confidence:t.confidence,isReliable:t.isReliable}})}if("languages"===n){let e=r.get("displayLanguage")||"en",t=await L.getSupportedLanguages(e);return R.NextResponse.json({success:!0,data:{languages:t,count:t.length}})}return R.NextResponse.json({error:'Invalid action. Use "detect" or "languages"'},{status:400})}catch(e){return console.error("Translation GET error:",e),R.NextResponse.json({error:"Failed to process request",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}e.s(["GET",()=>_,"POST",()=>N],334470);var z=e.i(334470);let P=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/translate/route",pathname:"/api/translate",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/translate/route.ts",nextConfigOutput:"",userland:z}),{workAsyncStorage:I,workUnitAsyncStorage:U,serverHooks:k}=P;function O(){return(0,r.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:U})}async function q(e,t,r){P.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/translate/route";R=R.replace(/\/index$/,"")||"/";let x=await P.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:T,params:v,nextConfig:C,parsedUrl:E,isDraftMode:b,prerenderManifest:S,routerServerContext:A,isOnDemandRevalidate:L,revalidateOnlyGenerated:j,resolvedPathname:N,clientReferenceManifest:_,serverActionsManifest:z}=x,I=(0,l.normalizeAppPath)(R),U=!!(S.dynamicRoutes[I]||S.routes[N]),k=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,E,!1):t.end("This page could not be found"),null);if(U&&!b){let e=!!S.routes[N],t=S.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(C.experimental.adapterPath)return await k();throw new w.NoFallbackError}}let O=null;!U||P.isDev||b||(O="/index"===(O=N)?"/":O);let q=!0===P.isDev||!U,K=U&&!q;z&&_&&(0,i.setReferenceManifestsSingleton)({page:R,clientReferenceManifest:_,serverActionsManifest:z,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:z})});let $=e.method||"GET",M=(0,s.getTracer)(),H=M.getActiveScopeSpan(),D={params:v,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!C.experimental.authInterrupts},cacheComponents:!!C.cacheComponents,supportsDynamicResponse:q,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:C.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>P.onRequestError(e,t,r,A)},sharedContext:{buildId:T}},G=new u.NodeNextRequest(e),F=new u.NodeNextResponse(t),B=c.NextRequestAdapter.fromNodeNextRequest(G,(0,c.signalFromNodeResponse)(t));try{let i=async e=>P.handle(B,D).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=M.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${$} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${$} ${R}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var s,l;let u=async({previousCacheEntry:a})=>{try{if(!o&&L&&j&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await i(n);e.fetchMetrics=D.renderOpts.fetchMetrics;let l=D.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let u=D.renderOpts.collectedTags;if(!U)return await (0,p.sendResponse)(G,F,s,D.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(s.headers);u&&(t[m.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==D.renderOpts.collectedRevalidate&&!(D.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&D.renderOpts.collectedRevalidate,r=void 0===D.renderOpts.collectedExpire||D.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:D.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await P.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:K,isOnDemandRevalidate:L})},A),t}},c=await P.handleResponse({req:e,nextConfig:C,cacheKey:O,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:L,revalidateOnlyGenerated:j,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:o});if(!U)return null;if((null==c||null==(s=c.value)?void 0:s.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",L?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,h.fromNodeOutgoingHttpHeaders)(c.value.headers);return o&&U||d.delete(m.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,f.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)(G,F,new Response(c.value.body,{headers:d,status:c.value.status||200})),null};H?await l(H):await M.withPropagatedContext(e.headers,()=>M.trace(d.BaseServerSpan.handleRequest,{spanName:`${$} ${R}`,kind:s.SpanKind.SERVER,attributes:{"http.method":$,"http.target":e.url}},l))}catch(t){if(t instanceof w.NoFallbackError||await P.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:K,isOnDemandRevalidate:L})}),U)throw t;return await (0,p.sendResponse)(G,F,new Response(null,{status:500})),null}}e.s(["handler",()=>q,"patchFetch",()=>O,"routeModule",()=>P,"serverHooks",()=>k,"workAsyncStorage",()=>I,"workUnitAsyncStorage",()=>U],605497)}];

//# sourceMappingURL=3c0ae_next_dist_esm_build_templates_app-route_001fdc08.js.map