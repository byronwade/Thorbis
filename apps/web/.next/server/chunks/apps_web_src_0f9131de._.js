module.exports=[109409,e=>{"use strict";var t=e.i(660198),i=e.i(802451),n=e.i(564250);let r="#fcfcfc",a="#3c6ff5",o="#fafafa",s="#171717",l="#171717",c="#737373",d="#e6e6e6";function m({href:e,children:i,variant:r="primary"}){let s={primary:{backgroundColor:a,color:o,border:"none"},outline:{backgroundColor:"transparent",color:a,border:`2px solid ${a}`}};return(0,t.jsx)(n.Button,{href:e,style:{display:"inline-block",padding:"12px 24px",fontSize:"16px",fontWeight:"600",textDecoration:"none",borderRadius:"8px",textAlign:"center",transition:"all 0.2s ease",...s[r]},children:i})}var p=e.i(242538);function x({children:e,title:n,style:r}){return(0,t.jsxs)(p.Section,{style:{...h,...r},children:[n&&(0,t.jsx)(i.Text,{style:f,children:n}),e]})}let h={backgroundColor:r,border:`1px solid ${d}`,borderRadius:"8px",padding:"24px",margin:"16px 0"},f={fontSize:"18px",fontWeight:"600",color:s,margin:"0 0 16px 0"};var u=e.i(137354);function g({children:e,level:i=1,style:n}){let r=`h${i}`;return(0,t.jsx)(u.Heading,{as:r,style:{...{1:{fontSize:"32px",fontWeight:"700",color:s,margin:"0 0 16px 0",lineHeight:"1.2"},2:{fontSize:"24px",fontWeight:"600",color:l,margin:"0 0 12px 0",lineHeight:"1.3"},3:{fontSize:"18px",fontWeight:"600",color:c,margin:"0 0 8px 0",lineHeight:"1.4"}}[i],...n},children:e})}var y=e.i(151368),b=e.i(625922),v=e.i(532316),j=e.i(34093),_=e.i(384378),S=e.i(150624),w=e.i(438016),T=e.i(400812);let E=process.env.NEXT_PUBLIC_THORBIS_LOGO_URL||"https://thorbis.com/logo-white.png",R=process.env.NEXT_PUBLIC_WEBSITE_URL||"https://thorbis.com",C=process.env.THORBIS_SUPPORT_EMAIL||"support@thorbis.com",I=`${R}/docs`,N=`${R}/privacy`,k=`${R}/terms`;function A({children:e,previewText:n}){return(0,t.jsxs)(_.Html,{children:[(0,t.jsx)(v.Head,{children:(0,t.jsx)("style",{children:`
          @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

          /* Reset email client styles */
          body { margin: 0; padding: 0; }
          table { border-collapse: collapse; }
          img { border: 0; }

          /* Responsive */
          @media only screen and (max-width: 600px) {
            .mobile-padding { padding: 20px !important; }
            .mobile-text { font-size: 14px !important; }
            .mobile-heading { font-size: 24px !important; }
          }
        `})}),n&&(0,t.jsx)(T.Preview,{children:n}),(0,t.jsx)(y.Body,{style:O,children:(0,t.jsxs)(b.Container,{style:$,children:[(0,t.jsx)(p.Section,{style:D,children:(0,t.jsx)(S.Img,{src:E,alt:"Thorbis",width:"160",height:"40",style:z})}),(0,t.jsx)(p.Section,{style:H,className:"mobile-padding",children:e}),(0,t.jsx)(j.Hr,{style:W}),(0,t.jsxs)(p.Section,{style:P,className:"mobile-padding",children:[(0,t.jsxs)(i.Text,{style:B,children:["Need help?"," ",(0,t.jsx)(w.Link,{href:`mailto:${C}`,style:U,children:"Contact Support"})," â€¢ ",(0,t.jsx)(w.Link,{href:I,style:U,children:"Documentation"})]}),(0,t.jsxs)(i.Text,{style:B,children:[(0,t.jsx)(w.Link,{href:N,style:U,children:"Privacy Policy"})," â€¢ ",(0,t.jsx)(w.Link,{href:k,style:U,children:"Terms of Service"})]}),(0,t.jsxs)(i.Text,{style:q,children:["Â© ",new Date().getFullYear()," Thorbis. All rights reserved."]}),(0,t.jsx)(i.Text,{style:Y,children:"Thorbis â€¢ 123 Innovation Drive, San Francisco, CA 94105"}),(0,t.jsxs)(i.Text,{style:F,children:["You're receiving this email because you have an account with Thorbis."," ",(0,t.jsx)(w.Link,{href:"{{unsubscribe_url}}",style:U,children:"Unsubscribe from marketing emails"})]})]})]})})]})}let O={backgroundColor:"#fafafa",fontFamily:'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale"},$={backgroundColor:r,maxWidth:"600px",margin:"0 auto"},D={backgroundColor:a,padding:"40px 0",textAlign:"center"},z={margin:"0 auto",display:"block"},H={padding:"48px 40px",color:l,fontSize:"16px",lineHeight:"24px"},W={borderColor:d,borderWidth:"1px",margin:"0"},P={padding:"32px 40px",textAlign:"center",backgroundColor:"#f2f2f2"},B={color:c,fontSize:"14px",lineHeight:"24px",margin:"8px 0"},U={color:a,textDecoration:"none",fontWeight:"500"},q={color:c,fontSize:"13px",margin:"16px 0 0 0",fontWeight:"600"},Y={color:c,fontSize:"12px",margin:"8px 0"},F={color:c,fontSize:"11px",margin:"16px 0 0 0",lineHeight:"18px"};function L({inviteeName:e,inviterName:n,companyName:r,role:a,jobTitle:o,invitationUrl:s,expiresInDays:l=7,supportEmail:c="support@thorbis.com",supportPhone:d="(555) 123-4567",previewText:p=`You've been invited to join ${r}`}){let h=a.charAt(0).toUpperCase()+a.slice(1);return(0,t.jsxs)(A,{previewText:p,children:[(0,t.jsx)(g,{level:1,children:"Welcome to the Team!"}),(0,t.jsxs)(i.Text,{style:M,children:["Hi ",e,","]}),(0,t.jsxs)(i.Text,{style:M,children:[n," has invited you to join ",(0,t.jsx)("strong",{children:r})," on Thorbis. We're excited to have you on board!"]}),(0,t.jsxs)(x,{style:G,children:[(0,t.jsx)("div",{style:V,children:"ðŸŽ‰"}),(0,t.jsx)(i.Text,{style:J,children:"You're Invited!"}),(0,t.jsxs)(i.Text,{style:X,children:["You've been invited as a ",(0,t.jsx)("strong",{children:h}),o?` - ${o}`:"","."]}),(0,t.jsx)(i.Text,{style:X,children:"Click the button below to accept your invitation and set up your account."})]}),(0,t.jsx)("div",{style:K,children:(0,t.jsx)(m,{href:s,children:"Accept Invitation"})}),(0,t.jsx)(x,{style:Q,children:(0,t.jsxs)(i.Text,{style:Z,children:["â° This invitation link will expire in"," ",(0,t.jsxs)("strong",{children:[l," days"]}),". Please accept your invitation soon."]})}),(0,t.jsxs)(x,{style:ee,children:[(0,t.jsx)(g,{level:3,children:"What you can do with Thorbis:"}),(0,t.jsxs)("ul",{style:et,children:[(0,t.jsxs)("li",{style:ei,children:[(0,t.jsx)("strong",{children:"ðŸ“… Manage Jobs & Schedule:"})," Create and track jobs, schedule appointments, and coordinate with your team"]}),(0,t.jsxs)("li",{style:ei,children:[(0,t.jsx)("strong",{children:"ðŸ‘¥ Customer Management:"})," Access complete customer information, history, and communication logs"]}),(0,t.jsxs)("li",{style:ei,children:[(0,t.jsx)("strong",{children:"ðŸ’° Invoicing & Payments:"})," Generate invoices, estimates, and track payments in real-time"]}),(0,t.jsxs)("li",{style:ei,children:[(0,t.jsx)("strong",{children:"ðŸ“Š Reports & Analytics:"})," View performance metrics and business insights"]}),(0,t.jsxs)("li",{style:ei,children:[(0,t.jsx)("strong",{children:"ðŸ’¬ Team Communication:"})," Collaborate with your team through built-in messaging"]}),(0,t.jsxs)("li",{style:ei,children:[(0,t.jsx)("strong",{children:"ðŸ“± Mobile Access:"})," Access your work from any device, anywhere"]})]})]}),(0,t.jsxs)(x,{style:en,children:[(0,t.jsx)(g,{level:3,children:"Secure & Reliable"}),(0,t.jsx)(i.Text,{style:er,children:"Your account is protected with industry-standard security. All data is encrypted and backed up regularly to keep your business safe."})]}),(0,t.jsxs)(x,{style:ea,children:[(0,t.jsx)(g,{level:3,children:"Getting Started is Easy"}),(0,t.jsxs)("div",{style:eo,children:[(0,t.jsxs)("div",{style:es,children:[(0,t.jsx)("div",{style:el,children:"1"}),(0,t.jsx)(i.Text,{style:ec,children:'Click the "Accept Invitation" button above'})]}),(0,t.jsxs)("div",{style:es,children:[(0,t.jsx)("div",{style:el,children:"2"}),(0,t.jsx)(i.Text,{style:ec,children:"Complete your profile and set a secure password"})]}),(0,t.jsxs)("div",{style:es,children:[(0,t.jsx)("div",{style:el,children:"3"}),(0,t.jsx)(i.Text,{style:ec,children:"Explore the platform and start collaborating!"})]})]})]}),(0,t.jsxs)(x,{style:ed,children:[(0,t.jsx)(g,{level:3,children:"Need Help?"}),(0,t.jsx)(i.Text,{style:em,children:"If you have any questions about getting started or need assistance, our support team is here to help."}),(0,t.jsxs)("div",{style:ep,children:[(0,t.jsxs)("div",{style:ex,children:[(0,t.jsx)(i.Text,{style:eh,children:"Email:"}),(0,t.jsx)("a",{href:`mailto:${c}`,style:ef,children:c})]}),(0,t.jsxs)("div",{style:ex,children:[(0,t.jsx)(i.Text,{style:eh,children:"Phone:"}),(0,t.jsx)("a",{href:`tel:${d}`,style:ef,children:d})]})]})]}),(0,t.jsxs)(i.Text,{style:eu,children:[(0,t.jsx)("strong",{children:"Note:"})," If you didn't expect this invitation or believe you received this email in error, please contact us at"," ",(0,t.jsx)("a",{href:`mailto:${c}`,style:eg,children:c}),"."]})]})}let M={color:"#374151",fontSize:"16px",lineHeight:"24px",margin:"0 0 16px 0"},G={background:"linear-gradient(135deg, hsl(217 91% 60%) 0%, hsl(217 91% 50%) 100%)",borderRadius:"12px",padding:"40px",margin:"24px 0",textAlign:"center"},V={fontSize:"64px",margin:"0 0 16px 0"},J={color:o,fontSize:"24px",fontWeight:"600",margin:"0 0 12px 0"},X={color:o,fontSize:"16px",lineHeight:"24px",margin:"0 0 12px 0",opacity:"0.95"},K={margin:"32px 0",textAlign:"center"},Q={backgroundColor:"#fef3c7",border:"1px solid #fde68a",borderRadius:"8px",padding:"16px",margin:"24px 0",textAlign:"center"},Z={color:"#92400e",fontSize:"14px",lineHeight:"20px",margin:"0"},ee={backgroundColor:"#f0fdf4",border:"1px solid #bbf7d0",margin:"24px 0"},et={color:"#166534",fontSize:"14px",lineHeight:"22px",margin:"12px 0 0 20px",padding:"0"},ei={margin:"0 0 12px 0"},en={backgroundColor:"#f5f3ff",border:"1px solid #ddd6fe",margin:"24px 0"},er={color:"#5b21b6",fontSize:"15px",lineHeight:"22px",margin:"12px 0 0 0"},ea={backgroundColor:"#eff6ff",border:"1px solid #bfdbfe",margin:"24px 0"},eo={display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"20px",margin:"20px 0 0 0"},es={textAlign:"center"},el={width:"40px",height:"40px",backgroundColor:"hsl(217 91% 60%)",color:o,borderRadius:"50%",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"18px",fontWeight:"600",margin:"0 auto 12px auto"},ec={color:"#1e40af",fontSize:"13px",lineHeight:"18px",margin:"0"},ed={backgroundColor:"#fef2f2",border:"1px solid #fecaca",margin:"24px 0"},em={color:"#991b1b",fontSize:"15px",lineHeight:"22px",margin:"12px 0 20px 0"},ep={display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},ex={textAlign:"center"},eh={color:"#6b7280",fontSize:"12px",textTransform:"uppercase",letterSpacing:"0.05em",margin:"0 0 8px 0"},ef={color:"hsl(217 91% 60%)",fontSize:"15px",fontWeight:"600",textDecoration:"underline"},eu={color:"#6b7280",fontSize:"13px",lineHeight:"20px",margin:"32px 0 0 0",padding:"20px",backgroundColor:"#f9fafb",borderRadius:"8px",textAlign:"center"},eg={color:"hsl(217 91% 60%)",textDecoration:"underline"};e.s(["default",()=>L],109409)},941610,e=>{"use strict";var t=e.i(620703),i=e.i(273568);let n=new t.Resend(process.env.RESEND_API_KEY);async function r(e){let t=await (0,i.createServiceSupabaseClient)();if(!t)return null;let{data:n}=await t.from("company_email_domains").select("*").eq("company_id",e).eq("status","verified").eq("sending_enabled",!0).eq("is_suspended",!1).order("is_platform_subdomain",{ascending:!0}).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(!n)return null;let r=`${n.subdomain}.${n.domain_name}`;return{id:n.id,domain_name:n.domain_name,subdomain:n.subdomain,full_domain:r,status:n.status,sending_addresses:n.sending_addresses||[],reply_to_email:n.reply_to_email}}async function a(e){let t=await (0,i.createServiceSupabaseClient)();if(!t)return null;let{data:n}=await t.from("company_email_domains").select("domain_name, reply_to_email").eq("company_id",e).eq("is_platform_subdomain",!0).eq("status","verified").maybeSingle();return n?n.reply_to_email?n.reply_to_email:`support@${n.domain_name}`:null}async function o({companyId:t,companyName:i,type:o="notification",to:s,subject:l,html:c,text:d,replyTo:m,attachments:p,communicationId:x}){let h=await r(t);if(!h)throw Error("Company domain not verified. Please verify your email domain in settings before sending emails.");let f=function(e,t,i){let n=e.sending_addresses.find(e=>e.type===t);if(n)return`${i} <${n.email}>`;let r=`${t}@${e.full_domain}`;return`${i} <${r}>`}(h,o,i),u=await a(t),g=m||u||`support@${h.full_domain}`,y=c;if(x){let{addEmailTracking:t}=await e.A(137050);y=t(c,x)}try{let{data:e,error:t}=await n.emails.send({from:f,to:s,subject:l,html:y,text:d,replyTo:g,attachments:p});if(t)throw Error(`Failed to send email: ${t.message}`);return{success:!0,messageId:e?.id}}catch(e){throw console.error("Email send error:",e),e}}e.s(["sendCompanyEmail",()=>o])},834102,e=>e.a(async(t,i)=>{try{var n=e.i(471312),r=e.i(291770),a=e.i(941610),o=e.i(641979),s=e.i(798348),l=t([r,o]);async function c(e){if("platform"===e.category)return await (0,o.sendEmail)({to:e.to,subject:e.subject,template:e.template,templateType:e.templateType,replyTo:e.replyTo,tags:e.tags,fromOverride:"Thorbis <noreply@thorbis.com>"});{let t=await (0,r.render)(e.template);return await (0,a.sendCompanyEmail)({companyId:e.companyId,companyName:e.companyName,type:e.emailType||"notification",to:e.to,subject:e.subject,html:t,replyTo:e.replyTo,communicationId:e.communicationId})}}async function d(e){return c({...e,category:"platform"})}async function m(e){return c({...e,category:"company"})}[r,o]=l.then?(await l)():l,(0,s.ensureServerEntryExports)([d,m]),(0,n.registerServerReference)(d,"408c508c267fcd2e1ff09ec30f3465256e45367723",null),(0,n.registerServerReference)(m,"40b271177f27fa853615b9469b91b83ce9f448c839",null),e.s(["sendPlatformEmail",()=>d]),i()}catch(e){i(e)}},!1),274314,e=>{"use strict";var t=e.i(666680);let i=process.env.INVITATION_SECRET||"fallback-secret-change-in-production";function n(e){let n={...e,exp:Date.now()+6048e5,nonce:(0,t.randomBytes)(16).toString("hex")},r=Buffer.from(JSON.stringify(n)).toString("base64url"),a=(0,t.createHmac)("sha256",i).update(r).digest("base64url");return`${r}.${a}`}e.s(["generateInvitationToken",()=>n])},454519,e=>e.a(async(t,i)=>{try{var n=e.i(471312),r=e.i(717899),a=e.i(443608),o=e.i(109409),s=e.i(834102),l=e.i(14646),c=e.i(899616),d=e.i(225746),m=e.i(274314),p=e.i(511368),x=e.i(798348),h=t([s]);function f(){return"http://localhost:3000".replace(/\/$/,"")}async function u(e){return(0,d.withErrorHandling)(async()=>{let t=await (0,p.createClient)();if(!t)throw new c.ActionError("Database connection failed",c.ERROR_CODES.DB_CONNECTION_ERROR);let{data:i,error:n}=await t.from("companies").select("id, name, onboarding_progress").eq("id",e).single();if(n||!i)throw new c.ActionError("Company not found",c.ERROR_CODES.DB_RECORD_NOT_FOUND,404);let r=i.onboarding_progress?.step2?.teamMembers||[];if(!Array.isArray(r)||0===r.length)return{sent:0,failed:0};let{data:{user:a}}=await t.auth.getUser();(0,d.assertAuthenticated)(a?.id);let{data:x}=await t.from("profiles").select("full_name, email").eq("id",a.id).single(),h=0,u=0,g=f();for(let n of r){if(n.isCurrentUser){let{error:i}=await t.from("company_memberships").upsert({company_id:e,user_id:a.id,role:n.role,status:"active",job_title:"Owner",phone:n.phone||null,joined_at:new Date().toISOString()},{onConflict:"user_id,company_id"});i&&console.error("Failed to upsert owner membership:",i.message);continue}try{let r=(0,m.generateInvitationToken)({email:n.email,companyId:i.id,role:n.role}),c=new Date;c.setDate(c.getDate()+7);let{error:d}=await t.from("team_invitations").insert({company_id:e,email:n.email,first_name:n.firstName,last_name:n.lastName,role:n.role,phone:n.phone||null,token:r,invited_by:a.id,expires_at:c.toISOString()});if(d){u++;continue}let p=`${g}/accept-invitation?token=${r}`;(await (0,s.sendPlatformEmail)({to:n.email,subject:`You've been invited to join ${i.name} on Thorbis`,template:(0,o.default)({inviteeName:`${n.firstName} ${n.lastName}`,inviterName:x?.name||x?.email||"Your colleague",companyName:i.name,role:n.role,magicLink:p,expiresInDays:7}),templateType:l.EmailTemplate.TEAM_INVITATION})).success?h++:u++}catch(e){u++}}return{sent:h,failed:u}})}async function g(e){return(0,d.withErrorHandling)(async()=>{let t=await (0,p.createClient)();if(!t)throw new c.ActionError("Database connection failed",c.ERROR_CODES.DB_CONNECTION_ERROR);let{data:{user:i}}=await t.auth.getUser();(0,d.assertAuthenticated)(i?.id);let{data:n}=await t.from("company_memberships").select("company_id, companies!inner(name)").eq("user_id",i.id).eq("status","active").single();if(!n?.company_id)throw new c.ActionError("You must be part of a company to invite team members",c.ERROR_CODES.AUTH_FORBIDDEN,403);let l=e.get("email"),x=e.get("firstName"),h=e.get("lastName"),u=e.get("role"),g=e.get("phone"),y=a.z.object({email:a.z.string().email(),firstName:a.z.string().min(1),lastName:a.z.string().min(1),role:a.z.enum(["owner","admin","manager","technician","dispatcher"])}).parse({email:l,firstName:x,lastName:h,role:u}),b=(0,m.generateInvitationToken)({email:y.email,companyId:n.company_id,role:y.role}),v=new Date;v.setDate(v.getDate()+7);let{error:j}=await t.from("team_invitations").insert({company_id:n.company_id,email:y.email,first_name:y.firstName,last_name:y.lastName,role:y.role,phone:g||null,token:b,invited_by:i.id,expires_at:v.toISOString()});if(j)throw new c.ActionError(c.ERROR_MESSAGES.operationFailed("send invitation"),c.ERROR_CODES.DB_QUERY_ERROR);let _=f(),S=`${_}/accept-invitation?token=${b}`,w=Array.isArray(n.companies)?n.companies[0]:n.companies,{data:T}=await t.from("profiles").select("full_name, email").eq("id",i.id).single();return!(await (0,s.sendPlatformEmail)({to:y.email,subject:`You've been invited to join ${w?.name} on Thorbis`,template:(0,o.default)({inviteeName:`${y.firstName} ${y.lastName}`,inviterName:T?.name||T?.email||"Your colleague",companyName:w?.name||"the team",role:y.role,magicLink:S,expiresInDays:7}),templateType:"team-invitation"})).success,(0,r.revalidatePath)("/dashboard/settings/team"),"Invitation sent successfully"})}[s]=h.then?(await h)():h,(0,x.ensureServerEntryExports)([u,g]),(0,n.registerServerReference)(u,"40f98f6926a8ec07816315d95d659e5059859476ef",null),(0,n.registerServerReference)(g,"402687fa9fb62ed4a942d5e407b78cf6702d51ceb7",null),e.s(["sendSingleTeamInvitation",()=>g,"sendTeamMemberInvitations",()=>u]),i()}catch(e){i(e)}},!1)];

//# sourceMappingURL=apps_web_src_0f9131de._.js.map