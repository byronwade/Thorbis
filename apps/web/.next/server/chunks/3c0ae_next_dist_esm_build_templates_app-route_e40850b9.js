module.exports=[950494,e=>{"use strict";var t=e.i(755535),r=e.i(377233),a=e.i(490003),n=e.i(492991),i=e.i(241970),s=e.i(357699),o=e.i(212454),l=e.i(48717),u=e.i(798301),p=e.i(986366),d=e.i(983537),c=e.i(147475),g=e.i(561930),y=e.i(803747),h=e.i(368557),m=e.i(42037),w=e.i(193695);e.i(432036);var f=e.i(573881),v=e.i(297676);class R{baseUrl="https://api.gateway.attomdata.com/propertyapi/v1.0.0";apiKey=process.env.ATTOM_API_KEY;isConfigured(){return!!this.apiKey}async request(e,t){try{let r=new URL(`${this.baseUrl}${e}`);t&&Object.entries(t).forEach(([e,t])=>{null!=t&&r.searchParams.set(e,String(t))});let a=await fetch(r.toString(),{headers:{apikey:this.apiKey,Accept:"application/json"}});if(!a.ok)return console.error("ATTOM API error:",a.status,await a.text()),null;return await a.json()}catch(e){return console.error("ATTOM API error:",e),null}}async getPropertyByAddress(e,t){let r=await this.request("/property/basicprofile",{address1:e,address2:t});return r?.property?.[0]||null}async getPropertyById(e){let t=await this.request("/property/basicprofile",{attomid:e});return t?.property?.[0]||null}async getPropertyByAPN(e,t){let r=await this.request("/property/basicprofile",{apn:e,fips:t});return r?.property?.[0]||null}async getExpandedProfile(e,t){let r=await this.request("/property/expandedprofile",{address1:e,address2:t});return r?.property?.[0]||null}async getPropertyDetails(e,t){let r=await this.request("/property/detail",{address1:e,address2:t});return r?.property?.[0]||null}async getValuation(e,t){let r=await this.request("/valuation/homevalue",{address1:e,address2:t});return r?.property?.[0]?.avm||null}async getAVMDetail(e,t){let r=await this.request("/avm/detail",{address1:e,address2:t}),a=r?.property?.[0];return a?{property:a,valuation:a.avm}:null}async getSalesHistory(e,t){let r=await this.request("/saleshistory/detail",{address1:e,address2:t});return r?.property?.[0]?.saleHistory||null}async getLastSale(e,t){let r=await this.getSalesHistory(e,t);return r?.[0]||null}async getTaxAssessment(e,t){let r=await this.request("/assessment/detail",{address1:e,address2:t});return r?.property?.[0]?.assessment||null}async getAssessmentHistory(e,t){let r=await this.request("/assessment/history",{address1:e,address2:t});return r?.property?.[0]?.assessmentHistory||null}async getOwner(e,t){let r=await this.request("/property/owner",{address1:e,address2:t});return r?.property?.[0]?.owner||null}async getMortgage(e,t){let r=await this.request("/mortgage/detail",{address1:e,address2:t});return r?.property?.[0]?.mortgage||null}async searchByArea(e){let t={};e.geoid&&(t.geoid=e.geoid),e.geoType&&(t.geoType=e.geoType),e.radius&&(t.radius=e.radius),e.latitude&&(t.latitude=e.latitude),e.longitude&&(t.longitude=e.longitude),e.page&&(t.page=e.page),e.pageSize&&(t.pageSize=e.pageSize),e.propertyType&&(t.propertyType=e.propertyType),e.minBeds&&(t.minBeds=e.minBeds),e.maxBeds&&(t.maxBeds=e.maxBeds),e.minBaths&&(t.minBaths=e.minBaths),e.maxBaths&&(t.maxBaths=e.maxBaths),e.minSqFt&&(t.minSqFt=e.minSqFt),e.maxSqFt&&(t.maxSqFt=e.maxSqFt),e.minYearBuilt&&(t.minYearBuilt=e.minYearBuilt),e.maxYearBuilt&&(t.maxYearBuilt=e.maxYearBuilt);let r=await this.request("/property/snapshot",t);return r?{properties:r.property||[],totalCount:r.status?.total||0,page:r.status?.page||1,pageSize:r.status?.pagesize||25}:null}async searchByRadius(e,t,r,a){return this.searchByArea({latitude:e,longitude:t,radius:r,page:a?.page,pageSize:a?.pageSize})}async getComparables(e,t,r){let a={address1:e,address2:t};r?.searchType&&(a.searchType=r.searchType),r?.radius&&(a.radius=r.radius),r?.maxComps&&(a.maxComps=r.maxComps);let n=await this.request("/sale/comparables",a);return n?.property?.[0]?.comps||null}async getServiceCallPropertyReport(e,t){let[r,a,n,i,s,o]=await Promise.all([this.getPropertyByAddress(e,t),this.getExpandedProfile(e,t),this.getOwner(e,t),this.getValuation(e,t),this.getLastSale(e,t),this.getTaxAssessment(e,t)]);return{basic:r,details:a,owner:n,valuation:i,lastSale:s,tax:o}}async getEquipmentRelevantInfo(e,t){let r=await this.getExpandedProfile(e,t);return r?{squareFootage:r.area?.livingSize||r.area?.universalSize||null,yearBuilt:r.summary?.yearBuilt||null,stories:r.summary?.stories||null,coolingType:r.building?.utilities?.coolingType||null,heatingType:r.building?.utilities?.heatingType||null,heatingFuel:r.building?.utilities?.heatingFuel||null,basementSize:r.building?.interior?.bsmtSize||null,garageSize:r.building?.parking?.garageSize||null}:null}async getMaintenanceRelevantInfo(e,t){let r=await this.getExpandedProfile(e,t);if(!r)return null;let a=r.summary?.yearBuilt,n=a?new Date().getFullYear()-a:null;return{yearBuilt:a||null,propertyAge:n,condition:r.building?.construction?.condition||null,roofType:r.building?.construction?.roofType||null,foundationType:r.building?.construction?.foundationType||null,waterSource:r.building?.utilities?.waterSource||null,sewerType:r.building?.utilities?.sewerType||null}}async verifyPropertyOwner(e,t,r){let a=await this.getOwner(e,t);if(!a)return{verified:!1,ownerOnRecord:null,isAbsentee:!1};let n=a.owner1?.fullName||`${a.owner1?.firstName} ${a.owner1?.lastName}`,i=r.toLowerCase().replace(/\s+/g," ").trim(),s=n?.toLowerCase().replace(/\s+/g," ").trim()||"";return{verified:s.includes(i)||i.includes(s),ownerOnRecord:n,isAbsentee:a.absenteeOwner||!1}}async getNeighborhoodContext(e,t){let r=await this.searchByRadius(e,t,.5,{pageSize:50});return r&&0!==r.properties.length?{averageValue:0,medianValue:0,propertyCount:r.totalCount,priceRange:{low:0,high:0}}:null}}let x=new R;var T=e.i(511368);e.i(16106);var A=e.i(985647),C=e.i(350318);async function E(e){try{let t=e.nextUrl.searchParams,r=t.get("address"),a=t.get("address2"),n=t.get("locality"),i=t.get("state"),s=t.get("postal"),o=t.get("action")||"profile";if(!(r&&n&&i))return v.NextResponse.json({error:"Missing required parameters: address, locality, state"},{status:400});let l=await (0,T.createClient)();if(!l)return v.NextResponse.json({error:"Database connection failed"},{status:500});let{data:{user:u}}=await l.auth.getUser();if(!u)return v.NextResponse.json({error:"Unauthorized"},{status:401});let p=await (0,A.getActiveCompanyId)();if(!p)return v.NextResponse.json({error:"No active company selected"},{status:401});let d=await (0,C.checkApiQuota)(p,"attom_property");if(d&&!d.has_quota)return v.NextResponse.json({error:"API quota exceeded",currentUsage:d.current_usage,limit:d.monthly_limit},{status:429});let c={address1:r,address2:a||void 0,locality:n,stateOrProvince:i,postalCode:s||void 0},g={profile:"profile",expanded:"expanded_profile",valuation:"valuation","sales-history":"sales_history",tax:"tax_assessment",owner:"owner","service-report":"service_report","equipment-info":"equipment_info","maintenance-info":"maintenance_info"}[o];if(!g)return v.NextResponse.json({error:"Invalid action"},{status:400});let y=await (0,C.withUsageTracking)(p,"attom_property",g,async()=>{switch(o){case"profile":return await x.getPropertyByAddress(c);case"expanded":return await x.getExpandedProfile(c);case"valuation":return await x.getValuation(c);case"sales-history":return await x.getSalesHistory(c);case"tax":return await x.getTaxAssessment(c);case"owner":return await x.getOwner(c);case"service-report":return await x.getServiceCallPropertyReport(c);case"equipment-info":return await x.getEquipmentRelevantInfo(c);case"maintenance-info":return await x.getMaintenanceRelevantInfo(c);default:throw Error(`Unknown action: ${o}`)}});if(!y)return v.NextResponse.json({error:"Property not found"},{status:404});return v.NextResponse.json(y,{headers:{"Cache-Control":"public, s-maxage=3600, stale-while-revalidate=7200"}})}catch(e){return console.error("ATTOM API error:",e),v.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["GET",()=>E],100677);var S=e.i(100677);let b=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/property/attom/route",pathname:"/api/property/attom",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/property/attom/route.ts",nextConfigOutput:"",userland:S}),{workAsyncStorage:P,workUnitAsyncStorage:q,serverHooks:N}=b;function B(){return(0,a.patchFetch)({workAsyncStorage:P,workUnitAsyncStorage:q})}async function O(e,t,a){b.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/property/attom/route";v=v.replace(/\/index$/,"")||"/";let R=await b.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:x,params:T,nextConfig:A,parsedUrl:C,isDraftMode:E,prerenderManifest:S,routerServerContext:P,isOnDemandRevalidate:q,revalidateOnlyGenerated:N,resolvedPathname:B,clientReferenceManifest:O,serverActionsManifest:_}=R,I=(0,l.normalizeAppPath)(v),M=!!(S.dynamicRoutes[I]||S.routes[B]),U=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,C,!1):t.end("This page could not be found"),null);if(M&&!E){let e=!!S.routes[B],t=S.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await U();throw new w.NoFallbackError}}let H=null;!M||b.isDev||E||(H="/index"===(H=B)?"/":H);let j=!0===b.isDev||!M,k=M&&!j;_&&O&&(0,s.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:O,serverActionsManifest:_,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:_})});let F=e.method||"GET",D=(0,i.getTracer)(),z=D.getActiveScopeSpan(),$={params:T,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>b.onRequestError(e,t,a,P)},sharedContext:{buildId:x}},K=new u.NodeNextRequest(e),L=new u.NodeNextResponse(t),V=p.NextRequestAdapter.fromNodeNextRequest(K,(0,p.signalFromNodeResponse)(t));try{let s=async e=>b.handle(V,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=D.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${F} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${v}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var i,l;let u=async({previousCacheEntry:r})=>{try{if(!o&&q&&N&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(n);e.fetchMetrics=$.renderOpts.fetchMetrics;let l=$.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=$.renderOpts.collectedTags;if(!M)return await (0,g.sendResponse)(K,L,i,$.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,y.toNodeOutgoingHttpHeaders)(i.headers);u&&(t[m.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,a=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await b.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:q})},P),t}},p=await b.handleResponse({req:e,nextConfig:A,cacheKey:H,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:q,revalidateOnlyGenerated:N,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:o});if(!M)return null;if((null==p||null==(i=p.value)?void 0:i.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(l=p.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",q?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,y.fromNodeOutgoingHttpHeaders)(p.value.headers);return o&&M||d.delete(m.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,h.getCacheControlHeader)(p.cacheControl)),await (0,g.sendResponse)(K,L,new Response(p.value.body,{headers:d,status:p.value.status||200})),null};z?await l(z):await D.withPropagatedContext(e.headers,()=>D.trace(d.BaseServerSpan.handleRequest,{spanName:`${F} ${v}`,kind:i.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},l))}catch(t){if(t instanceof w.NoFallbackError||await b.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:q})}),M)throw t;return await (0,g.sendResponse)(K,L,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>B,"routeModule",()=>b,"serverHooks",()=>N,"workAsyncStorage",()=>P,"workUnitAsyncStorage",()=>q],950494)}];

//# sourceMappingURL=3c0ae_next_dist_esm_build_templates_app-route_e40850b9.js.map