module.exports=[540907,e=>{"use strict";var t=e.i(755535),r=e.i(377233),a=e.i(490003),s=e.i(492991),i=e.i(241970),o=e.i(357699),n=e.i(212454),l=e.i(48717),c=e.i(798301),u=e.i(986366),p=e.i(983537),d=e.i(147475),h=e.i(561930),g=e.i(803747),m=e.i(368557),f=e.i(42037),v=e.i(193695);e.i(432036);var y=e.i(573881),R=e.i(297676),b=e.i(443608);e.i(715051);var w=e.i(511368);let z=b.z.object({id:b.z.string(),title:b.z.string(),description:b.z.string().optional().default(""),score:b.z.number().nullable(),displayValue:b.z.string().optional(),numericValue:b.z.number().optional(),details:b.z.object({type:b.z.string(),items:b.z.array(b.z.record(b.z.unknown())).optional()}).optional()}),x=b.z.object({id:b.z.string(),title:b.z.string(),score:b.z.number().nullable().transform(e=>e??0),description:b.z.string().optional()}),E=b.z.object({fetchTime:b.z.string(),requestedUrl:b.z.string(),finalUrl:b.z.string(),lighthouseVersion:b.z.string(),userAgent:b.z.string(),categories:b.z.record(x),audits:b.z.record(z)}),C=b.z.object({captchaResult:b.z.string().optional(),id:b.z.string(),loadingExperience:b.z.object({id:b.z.string(),metrics:b.z.record(b.z.unknown()).optional(),overall_category:b.z.string().optional()}).optional(),originLoadingExperience:b.z.object({id:b.z.string(),metrics:b.z.record(b.z.unknown()).optional(),overall_category:b.z.string().optional()}).optional(),lighthouseResult:E,analysisUTCTimestamp:b.z.string()});class S{static instance;apiKey;baseUrl="https://www.googleapis.com/pagespeedonline/v5/runPagespeed";cache=new Map;CACHE_TTL=36e5;constructor(){this.apiKey=process.env.GOOGLE_API_KEY||"AIzaSyCVKN0pddG230vvjT0EMP9sSIR31j1q2t0",this.apiKey||console.warn("GooglePageSpeedService: No API key found. Set GOOGLE_API_KEY environment variable.")}static getInstance(){return S.instance||(S.instance=new S),S.instance}isConfigured(){return!!this.apiKey}getCacheKey(e,t){return`${e}_${t}`}cleanCache(){let e=Date.now();for(let[t,r]of this.cache.entries())e-r.timestamp>this.CACHE_TTL&&this.cache.delete(t)}async analyzeUrl(e,t="mobile",r=["performance","accessibility","best-practices","seo"]){if(!this.apiKey)throw Error("PageSpeed API key not configured");let a=this.getCacheKey(e,t);this.cleanCache();let s=this.cache.get(a);if(s)return s.result;let i=new URLSearchParams({url:e,key:this.apiKey,strategy:t});r.forEach(e=>{i.append("category",e.toUpperCase())});let o=await fetch(`${this.baseUrl}?${i.toString()}`);if(!o.ok){let e=await o.json();throw Error(`PageSpeed API error: ${e.error?.message||o.statusText}`)}let n=await o.json(),l=C.parse(n),c=this.convertToPerformanceReport(l.lighthouseResult,e,t);return this.cache.set(a,{result:c,timestamp:Date.now()}),c}async analyzeUrlBothStrategies(e){let[t,r]=await Promise.all([this.analyzeUrl(e,"mobile"),this.analyzeUrl(e,"desktop")]),a=Math.abs(t.overallScore-r.overallScore),s=t.overallScore>r.overallScore,i=[];return a>20&&i.push(s?"Desktop experience needs significant optimization":"Mobile experience needs significant optimization"),"poor"===t.coreWebVitals.lcp.rating&&i.push("Optimize Largest Contentful Paint on mobile"),"poor"===t.coreWebVitals.cls.rating&&i.push("Fix layout shift issues on mobile"),t.categoryScores.accessibility<80&&i.push("Improve accessibility for mobile users"),{mobile:t,desktop:r,comparison:{performanceDiff:a,mobileFaster:s,recommendations:i}}}async getCoreWebVitals(e,t="mobile"){return(await this.analyzeUrl(e,t,["performance"])).coreWebVitals}async checkCoreWebVitalsThresholds(e){let t=await this.getCoreWebVitals(e),r=t.lcp.value<=2500,a=t.fid.value<=100,s=t.cls.value<=.1;return{passesAll:r&&a&&s,lcp:{passes:r,value:t.lcp.value,threshold:2500},fid:{passes:a,value:t.fid.value,threshold:100},cls:{passes:s,value:t.cls.value,threshold:.1}}}async monitorUrls(e,t){return await Promise.all(e.map(async e=>{try{let r=await this.analyzeUrl(e,"mobile",["performance"]),a=t?.[e];return{url:e,score:r.overallScore,baselineScore:a,regression:void 0!==a&&r.overallScore<a-5,regressionAmount:void 0!==a?a-r.overallScore:void 0}}catch(t){return{url:e,score:0,regression:!1,error:t instanceof Error?t.message:"Analysis failed"}}}))}async getTopOpportunities(e,t=5){return(await this.analyzeUrl(e,"mobile")).opportunities.slice(0,t)}convertToPerformanceReport(e,t,r){let a=e.audits,s=e.categories,i={lcp:this.extractMetric(a["largest-contentful-paint"]),fid:this.extractMetric(a["max-potential-fid"])||{value:0,score:1,rating:"good"},cls:this.extractMetric(a["cumulative-layout-shift"]),fcp:this.extractMetric(a["first-contentful-paint"]),ttfb:this.extractMetric(a["server-response-time"])||{value:0,score:1,rating:"good"}};a["interaction-to-next-paint"]&&(i.inp=this.extractMetric(a["interaction-to-next-paint"]));let o=Object.values(a).filter(e=>null!==e.score&&e.score<.9&&e.details?.type==="opportunity").map(e=>({id:e.id,title:e.title,description:e.description,savings:e.displayValue,priority:this.getPriority(e.score)})).sort((e,t)=>{let r={high:0,medium:1,low:2};return r[e.priority]-r[t.priority]}),n=Object.values(a).filter(e=>null!==e.score&&e.score<.9&&e.details?.type==="table").map(e=>({id:e.id,title:e.title,description:e.description,displayValue:e.displayValue})),l=Object.values(a),c=l.filter(e=>1===e.score).length;return{url:t,strategy:r,fetchTime:new Date(e.fetchTime),overallScore:Math.round(100*(s.performance?.score||0)),coreWebVitals:i,categoryScores:{performance:Math.round(100*(s.performance?.score||0)),accessibility:Math.round(100*(s.accessibility?.score||0)),bestPractices:Math.round(100*(s["best-practices"]?.score||0)),seo:Math.round(100*(s.seo?.score||0))},opportunities:o,diagnostics:n,passedAudits:c,totalAudits:l.length}}extractMetric(e){if(!e)return{value:0,score:1,rating:"good"};let t=e.numericValue||0,r=e.score||0;return{value:Math.round(t),score:r,rating:r>=.9?"good":r>=.5?"needs-improvement":"poor"}}getPriority(e){return null===e?"low":e<.5?"high":e<.9?"medium":"low"}clearCache(){this.cache.clear()}}let T=S.getInstance(),P=b.z.object({url:b.z.string().url(),strategy:b.z.enum(["mobile","desktop"]).optional().default("mobile"),action:b.z.enum(["analyze","vitals","check","compare","opportunities"]).optional().default("analyze"),categories:b.z.array(b.z.enum(["performance","accessibility","best-practices","seo","pwa"])).optional(),limit:b.z.number().min(1).max(20).optional()}),A=b.z.object({urls:b.z.array(b.z.string().url()).min(1).max(10),baseline:b.z.record(b.z.number()).optional()});async function U(e){try{let t=await (0,w.createClient)(),{data:{user:r}}=await t.auth.getUser();if(!r)return R.NextResponse.json({error:"Unauthorized"},{status:401});if(!T.isConfigured())return R.NextResponse.json({error:"PageSpeed service is not configured. Set GOOGLE_API_KEY environment variable."},{status:503});let a=await e.json(),{searchParams:s}=new URL(e.url),i=s.get("action");if("monitor"===i){let e=A.parse(a),t=await T.monitorUrls(e.urls,e.baseline);return R.NextResponse.json({success:!0,data:{results:t,summary:{totalUrls:t.length,regressions:t.filter(e=>e.regression).length,averageScore:Math.round(t.reduce((e,t)=>e+t.score,0)/t.length)}}})}let o=P.parse(a);switch(o.action){case"analyze":{let e=await T.analyzeUrl(o.url,o.strategy,o.categories);return R.NextResponse.json({success:!0,data:{...e,fetchTime:e.fetchTime.toISOString()}})}case"vitals":{let e=await T.getCoreWebVitals(o.url,o.strategy);return R.NextResponse.json({success:!0,data:e})}case"check":{let e=await T.checkCoreWebVitalsThresholds(o.url);return R.NextResponse.json({success:!0,data:e})}case"compare":{let e=await T.analyzeUrlBothStrategies(o.url);return R.NextResponse.json({success:!0,data:{mobile:{...e.mobile,fetchTime:e.mobile.fetchTime.toISOString()},desktop:{...e.desktop,fetchTime:e.desktop.fetchTime.toISOString()},comparison:e.comparison}})}case"opportunities":{let e=await T.getTopOpportunities(o.url,o.limit);return R.NextResponse.json({success:!0,data:e})}default:return R.NextResponse.json({error:"Invalid action"},{status:400})}}catch(e){if(console.error("PageSpeed analysis error:",e),e instanceof b.z.ZodError)return R.NextResponse.json({error:"Invalid request data",details:e.errors},{status:400});return R.NextResponse.json({error:"Failed to analyze performance",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function N(e){try{let t=await (0,w.createClient)(),{data:{user:r}}=await t.auth.getUser();if(!r)return R.NextResponse.json({error:"Unauthorized"},{status:401});if(!T.isConfigured())return R.NextResponse.json({error:"PageSpeed service is not configured. Set GOOGLE_API_KEY environment variable."},{status:503});let{searchParams:a}=new URL(e.url),s=a.get("url"),i=a.get("strategy")||"mobile";if(!s)return R.NextResponse.json({error:"URL parameter required"},{status:400});try{new URL(s)}catch{return R.NextResponse.json({error:"Invalid URL"},{status:400})}let o=await T.getCoreWebVitals(s,i),n=await T.checkCoreWebVitalsThresholds(s);return R.NextResponse.json({success:!0,data:{url:s,strategy:i,vitals:o,passesAllThresholds:n.passesAll,thresholdDetails:{lcp:n.lcp,fid:n.fid,cls:n.cls}}})}catch(e){return console.error("PageSpeed quick check error:",e),R.NextResponse.json({error:"Failed to check performance",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}e.s(["GET",()=>N,"POST",()=>U],368182);var j=e.i(368182);let O=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/performance/route",pathname:"/api/performance",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/performance/route.ts",nextConfigOutput:"",userland:j}),{workAsyncStorage:k,workUnitAsyncStorage:M,serverHooks:I}=O;function _(){return(0,a.patchFetch)({workAsyncStorage:k,workUnitAsyncStorage:M})}async function K(e,t,a){O.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/performance/route";R=R.replace(/\/index$/,"")||"/";let b=await O.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!b)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:w,params:z,nextConfig:x,parsedUrl:E,isDraftMode:C,prerenderManifest:S,routerServerContext:T,isOnDemandRevalidate:P,revalidateOnlyGenerated:A,resolvedPathname:U,clientReferenceManifest:N,serverActionsManifest:j}=b,k=(0,l.normalizeAppPath)(R),M=!!(S.dynamicRoutes[k]||S.routes[U]),I=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,E,!1):t.end("This page could not be found"),null);if(M&&!C){let e=!!S.routes[U],t=S.dynamicRoutes[k];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await I();throw new v.NoFallbackError}}let _=null;!M||O.isDev||C||(_="/index"===(_=U)?"/":_);let K=!0===O.isDev||!M,V=M&&!K;j&&N&&(0,o.setReferenceManifestsSingleton)({page:R,clientReferenceManifest:N,serverActionsManifest:j,serverModuleMap:(0,n.createServerModuleMap)({serverActionsManifest:j})});let q=e.method||"GET",H=(0,i.getTracer)(),L=H.getActiveScopeSpan(),D={params:z,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:K,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>O.onRequestError(e,t,a,T)},sharedContext:{buildId:w}},G=new c.NodeNextRequest(e),$=new c.NodeNextResponse(t),W=u.NextRequestAdapter.fromNodeNextRequest(G,(0,u.signalFromNodeResponse)(t));try{let o=async e=>O.handle(W,D).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${q} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${R}`)}),n=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var i,l;let c=async({previousCacheEntry:r})=>{try{if(!n&&P&&A&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await o(s);e.fetchMetrics=D.renderOpts.fetchMetrics;let l=D.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let c=D.renderOpts.collectedTags;if(!M)return await (0,h.sendResponse)(G,$,i,D.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(i.headers);c&&(t[f.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==D.renderOpts.collectedRevalidate&&!(D.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&D.renderOpts.collectedRevalidate,a=void 0===D.renderOpts.collectedExpire||D.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:D.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:V,isOnDemandRevalidate:P})},T),t}},u=await O.handleResponse({req:e,nextConfig:x,cacheKey:_,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:A,responseGenerator:c,waitUntil:a.waitUntil,isMinimalMode:n});if(!M)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});n||t.setHeader("x-nextjs-cache",P?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,g.fromNodeOutgoingHttpHeaders)(u.value.headers);return n&&M||p.delete(f.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,m.getCacheControlHeader)(u.cacheControl)),await (0,h.sendResponse)(G,$,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};L?await l(L):await H.withPropagatedContext(e.headers,()=>H.trace(p.BaseServerSpan.handleRequest,{spanName:`${q} ${R}`,kind:i.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:V,isOnDemandRevalidate:P})}),M)throw t;return await (0,h.sendResponse)(G,$,new Response(null,{status:500})),null}}e.s(["handler",()=>K,"patchFetch",()=>_,"routeModule",()=>O,"serverHooks",()=>I,"workAsyncStorage",()=>k,"workUnitAsyncStorage",()=>M],540907)}];

//# sourceMappingURL=3c0ae_next_dist_esm_build_templates_app-route_ea934d87.js.map