module.exports=[467151,e=>{"use strict";var r=e.i(471312),t=e.i(717899),n=e.i(766988),i=e.i(511368),a=e.i(614952),o=e.i(895811),s=e.i(244284),c=e.i(381979),l=e.i(155611),u=e.i(841937),d=e.i(267706);let m=["sms","mms","voice"],f="company_telnyx_settings";async function p(){for(let e of["http://localhost:3000",process.env.SITE_URL,"http://localhost:3000",process.env.APP_URL]){if(!e)continue;let r=e.trim();if(r&&!/localhost|127\.0\.0\.1|0\.0\.0\.0/i.test(r)){if(r.startsWith("http"))return r.replace(/\/+$/,"");return`https://${r.replace(/\/+$/,"")}`}}}async function _(e){let r=await p();if(r)return`${r}/api/webhooks/telnyx?company=${e}`}async function g(e,r,t,n){if(0!==t.length)for(let i of t){let t=i.phoneNumber.replace(/[^0-9]/g,""),a=t.startsWith("+")?t:t.startsWith("1")&&11===t.length?`+${t}`:`+1${t}`,o={company_id:r,phone_number:a,formatted_number:function(e){let r=e.replace(/[^0-9]/g,"");return 11===r.length&&r.startsWith("1")?`(${r.slice(1,4)}) ${r.slice(4,7)}-${r.slice(7)}`:10===r.length?`(${r.slice(0,3)}) ${r.slice(3,6)}-${r.slice(6)}`:e}(a),area_code:i.areaCode||a.slice(2,5),country_code:i.countryCode||"US",number_type:i.numberType||"local",status:"active",features:m,telnyx_phone_number_id:i.telnyxPhoneNumberId||null,telnyx_messaging_profile_id:n.messagingProfileId,telnyx_connection_id:n.connectionId},{data:s}=await e.from("phone_numbers").select("id").eq("company_id",r).eq("phone_number",a).maybeSingle();s?.id?await e.from("phone_numbers").update(o).eq("id",s.id):await e.from("phone_numbers").insert(o)}}async function b(e,r){return(await o.telnyxClient.messagingProfiles.create({name:`${e} - Thorbis`,enabled:!0,webhook_url:r,webhook_api_version:"2"})).data}async function h(e,r){return(await o.telnyxClient.callControlApplications.create({application_name:`${e} - Thorbis`,webhook_event_url:r,webhook_api_version:"2",answering_machine_detection:"premium"})).data}async function y(e,r){let t=await (0,u.searchAvailableNumbers)({areaCode:r.areaCode,features:r.features||m,limit:Math.max(2*r.quantity,r.quantity)});if(!t.success||!t.data||0===t.data.length)throw Error("No available phone numbers found for requested criteria");let n=[];for(let i of t.data){if(n.length>=r.quantity)break;let t=i.phone_number,a=await (0,u.purchaseNumber)({phoneNumber:t,messagingProfileId:r.messagingProfileId,connectionId:r.connectionId,customerReference:`company:${e}`});if(!a.success)throw Error(a.error||`Failed to purchase number ${t} from Telnyx`);n.push({phoneNumber:t,areaCode:i.national_destination_code||i.area_code,telnyxPhoneNumberId:i.id||i.phone_number,numberType:i.number_type})}if(0===n.length)throw Error("Failed to purchase any phone numbers");for(let e of n)if(e.telnyxPhoneNumberId)try{let t=process.env.TELNYX_API_KEY;if(!t)throw Error("TELNYX_API_KEY not configured");await fetch(`https://api.telnyx.com/v2/phone_numbers/${e.telnyxPhoneNumberId}/messaging`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({messaging_profile_id:r.messagingProfileId})})}catch(r){console.warn(`Failed to enable messaging on ${e.phoneNumber}:`,r)}return n}async function v(e,r){let{data:t}=await e.from(f).select("*").eq("company_id",r).maybeSingle();return t??null}async function w(e){let{supabase:r,companyId:t}=e,n=[],i=await v(r,t);if(i&&"ready"===i.status&&i.messaging_profile_id&&i.call_control_application_id)return n.push("Existing Telnyx configuration found"),{success:!0,settings:i,log:n};let{data:a}=await r.from("companies").select("id, name").eq("id",t).maybeSingle();if(!a)return{success:!1,error:"Company not found",log:n};let o=await _(t);if(!o)return{success:!1,error:"NEXT_PUBLIC_SITE_URL must be configured with a public URL to provision Telnyx resources",log:n};try{n.push("Creating messaging profile");let i=await b(a.name||"Company",o),s=i?.id;n.push("Creating call control application");let c=await h(a.name||"Company",o),l=c?.id;if(!s||!l)throw Error("Failed to provision messaging profile or call control application");n.push("Purchasing phone numbers");let u=await y(t,{quantity:Math.max(e.numberQuantity||1,1),areaCode:e.areaCode,features:e.features||m,messagingProfileId:s,connectionId:l});await g(r,t,u,{messagingProfileId:s,connectionId:l});let d=u.find(e=>"toll-free"===e.numberType)||u[0],p=await r.from(f).upsert({company_id:t,status:"ready",messaging_profile_id:s,call_control_application_id:l,default_outbound_number:d?.phoneNumber||null,default_outbound_phone_number_id:d?.telnyxPhoneNumberId||null,metadata:{log:n,purchased_numbers:u.map(e=>e.phoneNumber)},last_provisioned_at:new Date().toISOString()},{onConflict:"company_id"}).select("*").single();return{success:!0,settings:p.data,log:n}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to provision Telnyx resources",log:n}}}var S=e.i(291546),I=e.i(798348);function E(e){return(0,c.formatPhoneNumber)(e)}function C(e){let r=e.replace(/\D/g,"");return 11===r.length&&r.startsWith("1")?r.slice(1,4):10===r.length?r.slice(0,3):null}let T=process.env.TELNYX_DEFAULT_MESSAGING_PROFILE_ID||process.env.NEXT_PUBLIC_TELNYX_MESSAGING_PROFILE_ID||"",P=["voice","sms","mms"];function R(e){let r=e.replace(/\D/g,"");return 11===r.length&&r.startsWith("1")?`+1 (${r.slice(1,4)}) ${r.slice(4,7)}-${r.slice(7)}`:10===r.length?`(${r.slice(0,3)}) ${r.slice(3,6)}-${r.slice(6)}`:e}async function N(e,r){if(!r)return null;let t=await v(e,r);if(t&&"ready"===t.status)return t;let n=await w({companyId:r,supabase:e});return n.success?n.settings??null:null}function x(e){let r=e.trim().replace(/\/+$/,"");return/^https?:\/\//i.test(r)?/^http:\/\//i.test(r)&&!L(r)?r.replace(/^http:\/\//i,"https://"):r:`https://${r}`}function L(e){let r=e.toLowerCase();return r.includes("localhost")||r.includes("127.0.0.1")||r.includes("0.0.0.0")||r.endsWith(".local")||r.includes("://local")}function U(e){if(!e)return!1;let r=e.trim();return!(!r||("1"===process.env.VERCEL&&"production"===process.env.VERCEL_ENV||"production"===process.env.DEPLOYMENT_ENV)&&L(r))}async function $(){for(let e of["http://localhost:3000",process.env.SITE_URL,"http://localhost:3000",process.env.APP_URL])if(e&&U(e))return x(e);let e=process.env.VERCEL_URL;if(e&&U(e))return x(e.startsWith("http")?e:`https://${e}`);try{let e=await (0,n.headers)(),r=e.get("origin");if(r&&U(r))return x(r);let t=e.get("host");if(t&&U(t)){let e=t.includes("localhost")?"http":"https";return x(`${e}://${t}`)}}catch{}}async function M(e){let r=await $();if(!r)return;let t=e.startsWith("/")?e:`/${e}`;return`${r}${t}`}async function F(e){return e?M(`/api/webhooks/telnyx?company=${e}`):M("/api/webhooks/telnyx")}async function A(e,r){let t=E(r),{data:n}=await e.from("phone_numbers").select("id").eq("phone_number",t).is("deleted_at",null).maybeSingle();return n?.id??null}async function q(e,r,t){if(!t)return;let n=E(t),{data:i}=await e.from("phone_numbers").select("id").eq("company_id",r).eq("phone_number",n).limit(1);i&&i.length>0||await e.from("phone_numbers").insert({company_id:r,phone_number:n,formatted_number:R(n),country_code:"US",area_code:C(n),number_type:"local",status:"active",features:P})}async function k(e,r,t,n){if(t)return E(t);let i=n?E(n):null;try{let{data:t}=await e.from("phone_numbers").select("phone_number, number_type").eq("company_id",r).eq("status","active");if(t&&t.length>0){let e=t.find(e=>"toll-free"===e.number_type);if(e)return E(e.phone_number);if(i&&t.some(e=>E(e.phone_number)===i))return i;return E(t[0].phone_number)}}catch(e){console.warn("Failed to load company phone numbers for outbound selection:",e)}return i}async function D(e,r,t){let{data:n}=await e.from("communications").select("provider_metadata").eq("id",r).maybeSingle(),i={...n?.provider_metadata??{},...t};await e.from("communications").update({provider_metadata:i}).eq("id",r)}async function G(e){try{return await (0,u.searchAvailableNumbers)({countryCode:"US",areaCode:e.areaCode,numberType:e.numberType,features:e.features,limit:e.limit||10})}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to search phone numbers"}}}async function X(e){try{let r=await (0,s.validateSmsConfig)(),n=(0,s.validateCallConfig)();if(!r.valid||!n.valid){let e="Telnyx configuration is incomplete. Please configure all required environment variables.";return r.suggestedProfileId&&(e+=` Found messaging profile "${r.suggestedProfileId}" in your Telnyx account. Set TELNYX_DEFAULT_MESSAGING_PROFILE_ID=${r.suggestedProfileId} to use it.`),{success:!1,error:e}}let a=await (0,i.createClient)();if(!a)return{success:!1,error:"Service unavailable"};let c=E(e.phoneNumber),l=R(c),d=C(c),m=await (0,u.purchaseNumber)({phoneNumber:c,connectionId:o.TELNYX_CONFIG.connectionId,messagingProfileId:T||void 0,billingGroupId:e.billingGroupId,customerReference:`company_${e.companyId}`});if(!m.success)return m;let{data:f,error:p}=await a.from("phone_numbers").insert({company_id:e.companyId,telnyx_phone_number_id:m.orderId,telnyx_connection_id:o.TELNYX_CONFIG.connectionId,phone_number:c,formatted_number:l,country_code:"US",area_code:d,number_type:"local",features:["voice","sms"],status:"pending"}).select().single();if(p)throw p;(0,t.revalidatePath)("/dashboard/settings/communications/phone-numbers");try{await (0,S.ensureMessagingCampaign)(e.companyId,{id:f.id,e164:c},{supabase:a})}catch(e){}return{success:!0,data:f}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to purchase phone number"}}}async function O(e){try{let r=await (0,i.createClient)();if(!r)return{success:!1,error:"Service unavailable"};let{data:t,error:n}=await r.from("phone_numbers").select("*").eq("company_id",e).is("deleted_at",null).order("created_at",{ascending:!1});if(n)throw n;return{success:!0,data:t||[]}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get phone numbers"}}}async function Y(e){try{let r=(0,s.validateCallConfig)();if(!r.valid)return{success:!1,error:r.error||"Call configuration is invalid"};let t=await (0,i.createClient)();if(!t)return{success:!1,error:"Service unavailable"};let n=await N(t,e.companyId);await q(t,e.companyId,n?.default_outbound_number||null);let c=n?.call_control_application_id||o.TELNYX_CONFIG.connectionId,l=await k(t,e.companyId,e.from,n?.default_outbound_number||null);if(!c)return{success:!1,error:"No Telnyx connection configured for this company."};if(!l)return{success:!1,error:"Company does not have a default outbound phone number configured. Please provision numbers first."};let u=E(e.to),d=await F(e.companyId);if(!d)return{success:!1,error:"Site URL is not configured. Set NEXT_PUBLIC_SITE_URL or SITE_URL to a public https domain."};let m=await (0,a.initiateCall)({to:u,from:l,connectionId:c,webhookUrl:d,answeringMachineDetection:"premium"});if(!m.success)return m;let f=await A(t,l),{data:p,error:_}=await t.from("communications").insert({company_id:companyId,customer_id:e.customerId,job_id:e.jobId??null,property_id:e.propertyId??null,invoice_id:e.invoiceId??null,estimate_id:e.estimateId??null,type:"phone",channel:"telnyx",direction:"outbound",from_address:l,to_address:u,body:"",status:"queued",priority:"normal",phone_number_id:f,is_archived:!1,is_automated:!1,is_internal:!1,is_thread_starter:!0,telnyx_call_control_id:m.callControlId,telnyx_call_session_id:m.callSessionId}).select().single();if(_)throw _;return{success:!0,callControlId:m.callControlId,data:p}}catch(e){return console.error("❌ makeCall error:",e),console.error("Error details:",{message:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}),{success:!1,error:e instanceof Error?e.message:"Failed to make call"}}}async function W(e){try{return await (0,a.startRecording)({callControlId:e,format:"mp3",channels:"single"})}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to start recording"}}}async function j(e){try{return await (0,a.stopRecording)({callControlId:e})}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to stop recording"}}}async function B(r){try{let{transferCall:t}=await e.A(764856);return await t({callControlId:r.callControlId,to:r.to,from:r.from})}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to transfer call"}}}async function H(r){try{let{submitTranscription:t}=await e.A(229637),n=await (0,i.createClient)();if(!n)return{success:!1,error:"Service unavailable"};let a=await M("/api/webhooks/assemblyai");if(!a)return{success:!1,error:"Site URL is not configured. Set NEXT_PUBLIC_SITE_URL or SITE_URL."};let o=await t({audio_url:r.recordingUrl,speaker_labels:!0,webhook_url:a});if(!(o.success&&o.data))return{success:!1,error:o.error||"Failed to submit transcription"};return await D(n,r.communicationId,{assemblyai_transcription_id:o.data.id,assemblyai_status:o.data.status}),{success:!0,transcriptionId:o.data.id,status:o.data.status}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to transcribe recording"}}}async function V(r){try{let n=await (0,i.createClient)();if(!n)return console.error("❌ Supabase client unavailable"),{success:!1,error:"Service unavailable"};let a=r.companyId;if(!a){let{getActiveCompanyId:r}=await e.A(175702);if(!(a=await r()))return{success:!1,error:"No active company found"}}let o=await N(n,a);if(!o)return console.error("❌ Company settings not found"),{success:!1,error:"Unable to provision Telnyx resources for this company. Please verify the company's onboarding is complete and try again."};await q(n,a,o.default_outbound_number);let u=await (0,s.validateSmsConfig)();if(!u.valid&&!o?.messaging_profile_id){let e=u.error||"SMS configuration is invalid";return u.suggestedProfileId&&(e+=` Found messaging profile "${u.suggestedProfileId}" in your Telnyx account. Set TELNYX_DEFAULT_MESSAGING_PROFILE_ID=${u.suggestedProfileId} or provision company-specific settings.`),console.error("❌ SMS config invalid:",e),{success:!1,error:e}}let m=o?.messaging_profile_id||T;if(!m)return console.error("❌ No messaging profile ID"),{success:!1,error:"Messaging profile is not configured for this company. Please provision communications before sending SMS."};if(m){let e=await (0,l.verifyMessagingProfile)(m);if(e.needsFix)return console.error("❌ Messaging profile needs fix:",e.issues),{success:!1,error:`Messaging profile configuration issue: ${e.issues.join(", ")}. Run fixMessagingProfile() or reprovision the company.`}}let f=await k(n,a,r.from,o.default_outbound_number);if(!f)return console.error("❌ No from number available"),{success:!1,error:"Company does not have a default outbound phone number configured. Please provision numbers first."};let p=E(r.to),_=await (0,d.verifySmsCapability)(f);if(!_.hasSms)return console.error("❌ SMS capability check failed:",_.error),{success:!1,error:_.error||"Phone number does not support SMS"};let g=await F(a);if(!g)return console.error("❌ No webhook URL"),{success:!1,error:"Site URL is not configured. Set NEXT_PUBLIC_SITE_URL or SITE_URL to a public https domain."};let b=await (0,c.sendSMS)({to:p,from:f,text:r.text,webhookUrl:g,messagingProfileId:m});if(!b.success){if(console.error("❌ Telnyx API failed:",b.error),!(b.error&&(b.error.includes("10DLC")||b.error.includes("Not 10DLC registered")||b.error.includes("A2P"))))return b;{let{registerCompanyFor10DLC:t}=await e.A(925531),n=await t(a);if(!n.success)return{success:!1,error:`10DLC registration failed: ${n.error}. Original error: ${b.error}`};{let e=await (0,c.sendSMS)({to:p,from:f,text:r.text,webhookUrl:g,messagingProfileId:m});if(!e.success)return{success:!1,error:`10DLC registration completed but SMS still failed: ${e.error}. The campaign may need additional approval time.`};b.success=!0,b.messageId=e.messageId}}}let h=await A(n,f),{data:y,error:v}=await n.from("communications").insert({company_id:a,customer_id:r.customerId,job_id:r.jobId??null,invoice_id:r.invoiceId??null,estimate_id:r.estimateId??null,type:"sms",channel:"telnyx",direction:"outbound",from_address:f,to_address:p,body:r.text,status:"queued",priority:"normal",phone_number_id:h,is_archived:!1,is_automated:!1,is_internal:!1,is_thread_starter:!0,telnyx_message_id:b.messageId}).select().single();if(v)throw v;return(0,t.revalidatePath)("/dashboard/communication"),{success:!0,messageId:b.messageId,data:y}}catch(e){return console.error("SMS send error:",e),console.error("Error details:",{message:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0,type:typeof e,stringified:JSON.stringify(e,null,2)}),{success:!1,error:e instanceof Error?e.message:`Failed to send SMS: ${String(e)}`}}}async function z(r){try{let n=await (0,i.createClient)();if(!n)return{success:!1,error:"Service unavailable"};let a=r.companyId;if(!a){let{getActiveCompanyId:r}=await e.A(175702);if(!(a=await r()))return{success:!1,error:"No active company found"}}let o=await N(n,a);if(!o)return{success:!1,error:"Unable to provision Telnyx resources for this company. Please verify onboarding is complete."};await q(n,a,o.default_outbound_number);let u=await (0,s.validateSmsConfig)();if(!u.valid&&!o.messaging_profile_id){let e=u.error||"SMS configuration is invalid";return u.suggestedProfileId&&(e+=` Found messaging profile "${u.suggestedProfileId}" in your Telnyx account. Set TELNYX_DEFAULT_MESSAGING_PROFILE_ID=${u.suggestedProfileId} or reprovision the company.`),{success:!1,error:e}}let m=o.messaging_profile_id||T;if(!m)return{success:!1,error:"Messaging profile is not configured for this company. Please provision communications before sending MMS."};let f=await k(n,a,r.from,o.default_outbound_number);if(!f)return{success:!1,error:"Company does not have a default outbound phone number configured."};let p=E(r.to),_=await F(a);if(!_)return{success:!1,error:"Site URL is not configured. Set NEXT_PUBLIC_SITE_URL or SITE_URL to a public https domain."};if(m){let e=await (0,l.verifyMessagingProfile)(m);if(e.needsFix)return{success:!1,error:`Messaging profile configuration issue: ${e.issues.join(", ")}. Run fixMessagingProfile() or reprovision the company.`}}let g=await (0,d.verifySmsCapability)(f);if(!g.hasSms)return{success:!1,error:g.error||"Phone number does not support SMS/MMS"};let b=await (0,c.sendMMS)({to:p,from:f,text:r.text,mediaUrls:r.mediaUrls,webhookUrl:_,messagingProfileId:m});if(!b.success)return b;let h=await A(n,f),{data:y,error:v}=await n.from("communications").insert({company_id:a,customer_id:r.customerId,job_id:r.jobId??null,property_id:r.propertyId??null,invoice_id:r.invoiceId??null,estimate_id:r.estimateId??null,type:"sms",channel:"telnyx",direction:"outbound",from_address:f,to_address:p,body:r.text||"",attachments:r.mediaUrls.map(e=>({url:e,type:"image"})),attachment_count:r.mediaUrls.length,status:"queued",priority:"normal",phone_number_id:h,is_archived:!1,is_automated:!1,is_internal:!1,is_thread_starter:!0,telnyx_message_id:b.messageId}).select().single();if(v)throw v;return(0,t.revalidatePath)("/dashboard/communication"),{success:!0,messageId:b.messageId,data:y}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to send MMS"}}}async function J(){try{let r=await (0,i.createClient)();if(!r)return{success:!1,error:"Service unavailable"};let{data:{user:t},error:n}=await r.auth.getUser();if(n||!t)return{success:!1,error:"User not authenticated"};let a=process.env.TELNYX_WEBRTC_USERNAME,o=process.env.TELNYX_WEBRTC_PASSWORD;if(a&&o){let e={username:a,password:o,expires_at:Date.now()+864e5,realm:"sip.telnyx.com",sip_uri:`sip:${a}@sip.telnyx.com`,stun_servers:["stun:stun.telnyx.com:3478","stun:stun.telnyx.com:3479"],turn_servers:[{urls:["turn:turn.telnyx.com:3478?transport=udp","turn:turn.telnyx.com:3478?transport=tcp"],username:a,credential:o}]};return{success:!0,credential:e}}let{generateWebRTCToken:s}=await e.A(633428),c=await s({username:t.email||t.id,ttl:86400});if(!c.success)return c;return{success:!0,credential:c.credential}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get WebRTC credentials"}}}async function K(e){try{let r=await (0,i.createClient)();if(!r)return{success:!1,error:"Service unavailable"};let{data:t,error:n}=await r.from("call_routing_rules").select(`
        *,
        created_by_user:users!call_routing_rules_created_by_fkey(id, name, email),
        forward_to_user:users!call_routing_rules_forward_to_user_id_fkey(id, name, email)
      `).eq("company_id",e).is("deleted_at",null).order("priority",{ascending:!1});if(n)throw n;return{success:!0,data:t||[]}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get call routing rules"}}}async function Q(e){try{let r=await (0,i.createClient)();if(!r)return{success:!1,error:"Service unavailable"};let n={};void 0!==e.name&&(n.name=e.name),void 0!==e.description&&(n.description=e.description),void 0!==e.priority&&(n.priority=e.priority),void 0!==e.businessHours&&(n.business_hours=e.businessHours),void 0!==e.timezone&&(n.timezone=e.timezone),void 0!==e.afterHoursAction&&(n.after_hours_action=e.afterHoursAction),void 0!==e.afterHoursForwardTo&&(n.after_hours_forward_to=e.afterHoursForwardTo),void 0!==e.teamMembers&&(n.team_members=e.teamMembers),void 0!==e.ringTimeout&&(n.ring_timeout=e.ringTimeout),void 0!==e.ivrMenu&&(n.ivr_menu=e.ivrMenu),void 0!==e.ivrGreetingUrl&&(n.ivr_greeting_url=e.ivrGreetingUrl),void 0!==e.forwardToNumber&&(n.forward_to_number=e.forwardToNumber),void 0!==e.forwardToUserId&&(n.forward_to_user_id=e.forwardToUserId),void 0!==e.enableVoicemail&&(n.enable_voicemail=e.enableVoicemail),void 0!==e.voicemailGreetingUrl&&(n.voicemail_greeting_url=e.voicemailGreetingUrl),void 0!==e.voicemailTranscriptionEnabled&&(n.voicemail_transcription_enabled=e.voicemailTranscriptionEnabled),void 0!==e.voicemailEmailNotifications&&(n.voicemail_email_notifications=e.voicemailEmailNotifications),void 0!==e.recordCalls&&(n.record_calls=e.recordCalls),void 0!==e.isActive&&(n.is_active=e.isActive);let{data:a,error:o}=await r.from("call_routing_rules").update(n).eq("id",e.ruleId).select().single();if(o)throw o;return(0,t.revalidatePath)("/dashboard/settings/communications/call-routing"),{success:!0,data:a}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to update call routing rule"}}}async function Z(e,r){try{let n=await (0,i.createClient)();if(!n)return{success:!1,error:"Service unavailable"};let{error:a}=await n.from("call_routing_rules").update({deleted_at:new Date().toISOString(),deleted_by:r}).eq("id",e);if(a)throw a;return(0,t.revalidatePath)("/dashboard/settings/communications/call-routing"),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to delete call routing rule"}}}async function ee(e,r){try{let n=await (0,i.createClient)();if(!n)return{success:!1,error:"Service unavailable"};let{data:a,error:o}=await n.from("call_routing_rules").update({is_active:r}).eq("id",e).select().single();if(o)throw o;return(0,t.revalidatePath)("/dashboard/settings/communications/call-routing"),{success:!0,data:a}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to toggle call routing rule"}}}(0,I.ensureServerEntryExports)([G,X,O,Y,W,j,B,H,V,z,J,K,Q,Z,ee]),(0,r.registerServerReference)(G,"406864ae05b8b51c66cc2c335999e5011a41cb521f",null),(0,r.registerServerReference)(X,"40fd6a80b32792fab749933f98f07503d8e94c0305",null),(0,r.registerServerReference)(O,"4019cf9f81eb3c06f82b5c2f8eb042f3d95d91e933",null),(0,r.registerServerReference)(Y,"40b2df540ec465c5dc19545c96486485bb50b5633b",null),(0,r.registerServerReference)(W,"404e47931374ad2a1b54bc11f357703790f6104530",null),(0,r.registerServerReference)(j,"40d5cc291162e2fd61245bdb851d5e8ed609e4ed19",null),(0,r.registerServerReference)(B,"405a16958f97c37bd4b5711bd8761510bdab55839f",null),(0,r.registerServerReference)(H,"4002f454c46f4c21ca6e9e26362583ccff69c9f914",null),(0,r.registerServerReference)(V,"40d050abdabe2ee7293436c505c5f27b4408a2f27c",null),(0,r.registerServerReference)(z,"40edd91786b2a482e617fb16f2474d26ec295435e7",null),(0,r.registerServerReference)(J,"000478fbf5363dae5000d525663da13e29908cb952",null),(0,r.registerServerReference)(K,"40247c617842c31b242455a0961cbd2c3297606a16",null),(0,r.registerServerReference)(Q,"40413bfa888916480edbc33ebb812158fddf960f89",null),(0,r.registerServerReference)(Z,"607d0f958daf66b2a0d5277cdda17600dace5156bb",null),(0,r.registerServerReference)(ee,"60853f1e409364f7e171e27229217994ff224414e6",null),e.s(["deleteCallRoutingRule",()=>Z,"getCallRoutingRules",()=>K,"getCompanyPhoneNumbers",()=>O,"getWebRTCCredentials",()=>J,"makeCall",()=>Y,"purchasePhoneNumber",()=>X,"searchPhoneNumbers",()=>G,"sendMMSMessage",()=>z,"sendTextMessage",()=>V,"startCallRecording",()=>W,"stopCallRecording",()=>j,"toggleCallRoutingRule",()=>ee,"transcribeCallRecording",()=>H,"transferActiveCall",()=>B,"updateCallRoutingRule",()=>Q],467151)}];

//# sourceMappingURL=apps_web_src_actions_telnyx_ts_b41bb243._.js.map