{"version":3,"sources":["../../../../../apps/web/src/lib/telnyx/messaging-profile-fetcher.ts"],"sourcesContent":["/**\n * Messaging Profile Fetcher\n *\n * Fetches messaging profiles from Telnyx API to help with configuration.\n */\n\nimport { telnyxClient } from \"./client\";\n\nexport type MessagingProfile = {\n\tid: string;\n\tname: string;\n\tenabled: boolean;\n\twebhook_url: string | null;\n\twebhook_failover_url: string | null;\n\twebhook_api_version: string | null;\n};\n\nexport type ListMessagingProfilesResult = {\n\tsuccess: boolean;\n\tprofiles?: MessagingProfile[];\n\terror?: string;\n};\n\n/**\n * List all messaging profiles from Telnyx\n */\nasync function listMessagingProfiles(): Promise<ListMessagingProfilesResult> {\n\ttry {\n\t\tconst response = await telnyxClient.messagingProfiles.list();\n\t\tconst profiles = (response.data || []) as any[];\n\n\t\tconst formattedProfiles: MessagingProfile[] = profiles.map((profile) => ({\n\t\t\tid: profile.id,\n\t\t\tname: profile.name || \"Unnamed Profile\",\n\t\t\tenabled: profile.enabled !== false,\n\t\t\twebhook_url: profile.webhook_url || null,\n\t\t\twebhook_failover_url: profile.webhook_failover_url || null,\n\t\t\twebhook_api_version: profile.webhook_api_version || null,\n\t\t}));\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tprofiles: formattedProfiles,\n\t\t};\n\t} catch (error: any) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error?.message || \"Failed to list messaging profiles\",\n\t\t};\n\t}\n}\n\n/**\n * Get the default messaging profile (first enabled profile, or first profile if none enabled)\n */\nexport async function getDefaultMessagingProfile(): Promise<{\n\tsuccess: boolean;\n\tprofile?: MessagingProfile;\n\terror?: string;\n\trecommendation?: string;\n}> {\n\tconst result = await listMessagingProfiles();\n\n\tif (!result.success || !result.profiles) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: result.error || \"Failed to fetch messaging profiles\",\n\t\t};\n\t}\n\n\tif (result.profiles.length === 0) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: \"No messaging profiles found in Telnyx account\",\n\t\t\trecommendation:\n\t\t\t\t\"Create a messaging profile in Telnyx Portal → Messaging → Profiles\",\n\t\t};\n\t}\n\n\t// Prefer enabled profiles\n\tconst enabledProfiles = result.profiles.filter((p) => p.enabled);\n\tconst selectedProfile =\n\t\tenabledProfiles.length > 0 ? enabledProfiles[0] : result.profiles[0];\n\n\tlet recommendation: string | undefined;\n\tif (result.profiles.length > 1) {\n\t\trecommendation = `Found ${result.profiles.length} messaging profiles. Using \"${selectedProfile.name}\" (ID: ${selectedProfile.id}). To use a different profile, set TELNYX_DEFAULT_MESSAGING_PROFILE_ID to the desired profile ID.`;\n\t}\n\n\treturn {\n\t\tsuccess: true,\n\t\tprofile: selectedProfile,\n\t\trecommendation,\n\t};\n}\n\n/**\n * Get messaging profile by ID\n */\nasync function getMessagingProfileById(profileId: string): Promise<{\n\tsuccess: boolean;\n\tprofile?: MessagingProfile;\n\terror?: string;\n}> {\n\ttry {\n\t\tconst response = await telnyxClient.messagingProfiles.retrieve(profileId);\n\t\tconst profileData = response.data as any;\n\n\t\tif (!profileData) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: `Messaging profile ${profileId} not found`,\n\t\t\t};\n\t\t}\n\n\t\tconst profile: MessagingProfile = {\n\t\t\tid: profileData.id,\n\t\t\tname: profileData.name || \"Unnamed Profile\",\n\t\t\tenabled: profileData.enabled !== false,\n\t\t\twebhook_url: profileData.webhook_url || null,\n\t\t\twebhook_failover_url: profileData.webhook_failover_url || null,\n\t\t\twebhook_api_version: profileData.webhook_api_version || null,\n\t\t};\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tprofile,\n\t\t};\n\t} catch (error: any) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error?.message || \"Failed to retrieve messaging profile\",\n\t\t};\n\t}\n}\n"],"names":[],"mappings":"wCAMA,IAAA,EAAA,EAAA,CAAA,CAAA,QAoBA,eAAe,IACd,GAAI,CAIH,IAAM,EAAwC,CAF5B,CADD,MAAM,EAAA,YAAY,CAAC,iBAAiB,CAAC,IAAI,EAAA,EAC/B,IAAI,EAAI,EAAA,AAAE,EAEkB,GAAG,CAAC,AAAC,IAAa,CACxE,GAAI,EAAQ,AAD2D,EACzD,CACd,KAAM,EAAQ,IAAI,EAAI,kBACtB,SAA6B,IAApB,EAAQ,OAAO,CACxB,YAAa,EAAQ,WAAW,EAAI,KACpC,qBAAsB,EAAQ,oBAAoB,EAAI,KACtD,oBAAqB,EAAQ,mBAAmB,EAAI,KACrD,CAAC,EAED,MAAO,CACN,SAAS,EACT,SAAU,CACX,CACD,CAAE,MAAO,EAAY,CACpB,MAAO,CACN,QAAS,GACT,MAAO,GAAO,SAAW,mCAC1B,CACD,CACD,CAKO,eAAe,IAMrB,IAuBI,EAvBE,EAAS,MAAM,IAErB,GAAI,CAAC,EAAO,OAAO,EAAI,CAAC,EAAO,QAAQ,CACtC,CADwC,KACjC,CACN,SAAS,EACT,MAAO,EAAO,KAAK,EAAI,oCACxB,EAGD,GAA+B,GAAG,CAA9B,EAAO,QAAQ,CAAC,MAAM,CACzB,MAAO,CACN,SAAS,EACT,MAAO,gDACP,eACC,oEACF,EAID,IAAM,EAAkB,EAAO,QAAQ,CAAC,MAAM,CAAC,AAAC,GAAM,EAAE,OAAO,EACzD,EACL,EAAgB,MAAM,CAAG,EAAI,CAAe,CAAC,EAAE,CAAG,EAAO,QAAQ,CAAC,EAAE,CAOrE,OAJI,EAAO,QAAQ,CAAC,MAAM,CAAG,GAAG,CAC/B,EAAiB,CAAC,MAAM,EAAE,EAAO,QAAQ,CAAC,MAAM,CAAC,4BAA4B,EAAE,EAAgB,IAAI,CAAC,OAAO,EAAE,EAAgB,EAAE,CAAC,kGAAiG,AAAC,EAG5N,CACN,SAAS,EACT,QAAS,iBACT,CACD,CACD"}