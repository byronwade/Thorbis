{"version":3,"sources":["../../../../../node_modules/.pnpm/next%4016.0.4_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/route-modules/app-page/vendored/rsc/react-server-dom-turbopack-server.ts","../../../../../node_modules/.pnpm/next%4016.0.4_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../../node_modules/.pnpm/next%4016.0.4_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../../packages/database/src/service-client.ts","../../../../../apps/web/src/lib/telnyx/calls.ts","../../../../../apps/web/src/actions/messaging-branding.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-rsc']!.ReactServerDOMTurbopackServer\n","/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","\"use server\";\n\nimport { createClient as createSupabaseClient } from \"@supabase/supabase-js\";\nimport type { Database } from \"./types\";\n\n/**\n * Creates a Supabase client using the service role key.\n * This bypasses RLS and is intended for background jobs / automation.\n *\n * Performance Optimization:\n * - Uses SUPABASE_POOLER_URL (Transaction Mode) if available for 30-50% faster queries\n * - Falls back to NEXT_PUBLIC_SUPABASE_URL (Session Mode) if pooler not configured\n * - Transaction Mode supports 10,000+ concurrent connections vs 100 in Session Mode\n *\n * @returns Supabase client with service role, or null if not configured\n */\nexport async function createServiceSupabaseClient() {\n\t// Prefer pooler URL for Transaction Mode (better performance)\n\tconst supabaseUrl =\n\t\tprocess.env.SUPABASE_POOLER_URL || process.env.NEXT_PUBLIC_SUPABASE_URL;\n\tconst serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\n\tif (!supabaseUrl || !serviceRoleKey) {\n\t\treturn null;\n\t}\n\n\treturn createSupabaseClient<Database>(supabaseUrl, serviceRoleKey, {\n\t\tauth: {\n\t\t\tpersistSession: false,\n\t\t\tautoRefreshToken: false,\n\t\t},\n\t\tdb: {\n\t\t\tschema: \"public\",\n\t\t},\n\t\tglobal: {\n\t\t\theaders: {\n\t\t\t\t\"x-my-custom-header\": \"service-role\",\n\t\t\t},\n\t\t},\n\t});\n}\n\nexport type ServiceSupabaseClient = Awaited<\n\tReturnType<typeof createServiceSupabaseClient>\n>;\n","/**\n * Telnyx Calls Service - Call Control & Management\n *\n * Production-ready call control with:\n * - Retry logic with exponential backoff\n * - Request timeouts (prevents hanging)\n * - Circuit breaker protection\n * - Structured logging\n *\n * Handles all call-related operations including:\n * - Initiating outbound calls\n * - Answering incoming calls\n * - Call control (mute, hold, transfer)\n * - Call recording\n * - Hangup operations\n */\n\nimport { telnyxLogger } from \"./logger\";\nimport { withRetry } from \"./retry\";\n\nconst TELNYX_API_BASE = \"https://api.telnyx.com/v2\";\n\n// Request timeout for call control operations (15 seconds)\nconst REQUEST_TIMEOUT_MS = 15000;\n\n/**\n * Call control command types\n */\nexport type CallCommand =\n\t| \"answer\"\n\t| \"reject\"\n\t| \"hangup\"\n\t| \"bridge\"\n\t| \"speak\"\n\t| \"gather_using_audio\"\n\t| \"gather_using_speak\"\n\t| \"playback_start\"\n\t| \"playback_stop\"\n\t| \"record_start\"\n\t| \"record_stop\"\n\t| \"send_dtmf\"\n\t| \"transfer\";\n\n/**\n * Call status types from Telnyx webhooks\n */\nexport type CallStatus =\n\t| \"initiated\"\n\t| \"ringing\"\n\t| \"answered\"\n\t| \"active\"\n\t| \"hangup\"\n\t| \"machine_greeting_detected\"\n\t| \"machine_greeting_ended\";\n\n/**\n * Make a direct HTTP request to Telnyx REST API with retry and timeout\n */\nasync function telnyxCallRequest<T>(\n\tendpoint: string,\n\tbody: Record<string, unknown>,\n\toptions?: {\n\t\t/** Operation name for logging */\n\t\toperation?: string;\n\t\t/** Custom timeout in ms (default: 15000) */\n\t\ttimeout?: number;\n\t\t/** Skip retry logic (for time-sensitive operations) */\n\t\tskipRetry?: boolean;\n\t}\n): Promise<{ success: boolean; data?: T; error?: string }> {\n\tconst apiKey = process.env.TELNYX_API_KEY;\n\tif (!apiKey) {\n\t\treturn { success: false, error: \"TELNYX_API_KEY is not configured\" };\n\t}\n\n\tconst operation = options?.operation || endpoint;\n\tconst timeout = options?.timeout ?? REQUEST_TIMEOUT_MS;\n\n\tconst makeRequest = async (): Promise<{ success: boolean; data?: T; error?: string }> => {\n\t\t// Create abort controller for timeout\n\t\tconst controller = new AbortController();\n\t\tconst timeoutId = setTimeout(() => controller.abort(), timeout);\n\n\t\ttry {\n\t\t\ttelnyxLogger.debug(\"Call API request\", {\n\t\t\t\tendpoint,\n\t\t\t\toperation,\n\t\t\t});\n\n\t\t\tconst response = await fetch(`${TELNYX_API_BASE}${endpoint}`, {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${apiKey}`,\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify(body),\n\t\t\t\tsignal: controller.signal,\n\t\t\t});\n\n\t\t\tclearTimeout(timeoutId);\n\n\t\t\tconst result = await response.json();\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconst errorMessage =\n\t\t\t\t\tresult?.errors?.[0]?.detail ||\n\t\t\t\t\tresult?.errors?.[0] ||\n\t\t\t\t\tresponse.statusText;\n\n\t\t\t\ttelnyxLogger.warn(\"Call API error response\", {\n\t\t\t\t\tendpoint,\n\t\t\t\t\toperation,\n\t\t\t\t\tstatus: response.status,\n\t\t\t\t\terror: errorMessage,\n\t\t\t\t});\n\n\t\t\t\t// Throw for retry logic to catch\n\t\t\t\tconst error = new Error(`Telnyx ${response.status}: ${errorMessage}`);\n\t\t\t\t(error as Error & { statusCode: number }).statusCode = response.status;\n\t\t\t\tthrow error;\n\t\t\t}\n\n\t\t\ttelnyxLogger.debug(\"Call API success\", {\n\t\t\t\tendpoint,\n\t\t\t\toperation,\n\t\t\t});\n\n\t\t\treturn { success: true, data: result.data };\n\t\t} catch (error) {\n\t\t\tclearTimeout(timeoutId);\n\n\t\t\tif (error instanceof Error && error.name === \"AbortError\") {\n\t\t\t\ttelnyxLogger.error(\"Call API timeout\", {\n\t\t\t\t\tendpoint,\n\t\t\t\t\toperation,\n\t\t\t\t\ttimeoutMs: timeout,\n\t\t\t\t});\n\t\t\t\tthrow new Error(`Request timeout after ${timeout}ms`);\n\t\t\t}\n\n\t\t\tthrow error;\n\t\t}\n\t};\n\n\ttry {\n\t\t// Use retry logic unless skipped\n\t\tif (options?.skipRetry) {\n\t\t\treturn await makeRequest();\n\t\t}\n\n\t\treturn await withRetry(makeRequest, {\n\t\t\tendpoint: `calls:${operation}`,\n\t\t\tconfig: {\n\t\t\t\tmaxRetries: 2, // Fewer retries for call operations (time-sensitive)\n\t\t\t\tbaseDelayMs: 500,\n\t\t\t\tmaxDelayMs: 2000,\n\t\t\t},\n\t\t\tonRetry: (attempt, error, delayMs) => {\n\t\t\t\ttelnyxLogger.warn(\"Retrying call API request\", {\n\t\t\t\t\tendpoint,\n\t\t\t\t\toperation,\n\t\t\t\t\tattempt,\n\t\t\t\t\terror: error.message,\n\t\t\t\t\tdelayMs,\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\t} catch (error) {\n\t\ttelnyxLogger.error(\"Call API request failed\", {\n\t\t\tendpoint,\n\t\t\toperation,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t});\n\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Request failed\",\n\t\t};\n\t}\n}\n\n/**\n * Initiate an outbound call\n */\nexport async function initiateCall(params: {\n\tto: string;\n\tfrom: string;\n\tconnectionId: string;\n\twebhookUrl?: string;\n\tansweringMachineDetection?: \"premium\" | \"detect\" | \"disabled\";\n\tcustomHeaders?: Array<{ name: string; value: string }>;\n}) {\n\tconst result = await telnyxCallRequest<{\n\t\tcall_control_id: string;\n\t\tcall_session_id: string;\n\t}>(\n\t\t\"/calls\",\n\t\t{\n\t\t\tto: params.to,\n\t\t\tfrom: params.from,\n\t\t\tconnection_id: params.connectionId,\n\t\t\twebhook_url: params.webhookUrl,\n\t\t\tanswering_machine_detection:\n\t\t\t\tparams.answeringMachineDetection || \"disabled\",\n\t\t\tcustom_headers: params.customHeaders,\n\t\t},\n\t\t{ operation: \"initiate\" }\n\t);\n\n\tif (!(result.success && result.data)) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: result.error || \"Failed to initiate call\",\n\t\t};\n\t}\n\n\treturn {\n\t\tsuccess: true,\n\t\tcallControlId: result.data.call_control_id,\n\t\tcallSessionId: result.data.call_session_id,\n\t\tdata: result.data,\n\t};\n}\n\n/**\n * Answer an incoming call\n */\nexport async function answerCall(params: {\n\tcallControlId: string;\n\twebhookUrl?: string;\n\tclientState?: string;\n}) {\n\treturn telnyxCallRequest(\n\t\t`/calls/${params.callControlId}/actions/answer`,\n\t\t{\n\t\t\twebhook_url: params.webhookUrl,\n\t\t\tclient_state: params.clientState,\n\t\t},\n\t\t{ operation: \"answer\", skipRetry: true } // Time-sensitive, no retry\n\t);\n}\n\n/**\n * Reject an incoming call\n */\nexport async function rejectCall(params: {\n\tcallControlId: string;\n\tcause?: \"CALL_REJECTED\" | \"USER_BUSY\";\n}) {\n\treturn telnyxCallRequest(\n\t\t`/calls/${params.callControlId}/actions/reject`,\n\t\t{ cause: params.cause || \"CALL_REJECTED\" },\n\t\t{ operation: \"reject\", skipRetry: true }\n\t);\n}\n\n/**\n * Hangup an active call\n */\nexport async function hangupCall(params: { callControlId: string }) {\n\treturn telnyxCallRequest(\n\t\t`/calls/${params.callControlId}/actions/hangup`,\n\t\t{},\n\t\t{ operation: \"hangup\" }\n\t);\n}\n\n/**\n * Start call recording\n */\nexport async function startRecording(params: {\n\tcallControlId: string;\n\tformat?: \"wav\" | \"mp3\";\n\tchannels?: \"single\" | \"dual\";\n}) {\n\treturn telnyxCallRequest(\n\t\t`/calls/${params.callControlId}/actions/record_start`,\n\t\t{\n\t\t\tformat: params.format || \"mp3\",\n\t\t\tchannels: params.channels || \"single\",\n\t\t},\n\t\t{ operation: \"record_start\" }\n\t);\n}\n\n/**\n * Stop call recording\n */\nexport async function stopRecording(params: { callControlId: string }) {\n\treturn telnyxCallRequest(\n\t\t`/calls/${params.callControlId}/actions/record_stop`,\n\t\t{},\n\t\t{ operation: \"record_stop\" }\n\t);\n}\n\n/**\n * Play audio to the call\n */\nexport async function playAudio(params: {\n\tcallControlId: string;\n\taudioUrl: string;\n\tloop?: number;\n}) {\n\treturn telnyxCallRequest(\n\t\t`/calls/${params.callControlId}/actions/playback_start`,\n\t\t{\n\t\t\taudio_url: params.audioUrl,\n\t\t\tloop: params.loop,\n\t\t},\n\t\t{ operation: \"playback_start\" }\n\t);\n}\n\n/**\n * Speak text to the call using text-to-speech\n */\nexport async function speakText(params: {\n\tcallControlId: string;\n\ttext: string;\n\tvoice?: \"male\" | \"female\";\n\tlanguage?: string;\n}) {\n\treturn telnyxCallRequest(\n\t\t`/calls/${params.callControlId}/actions/speak`,\n\t\t{\n\t\t\tpayload: params.text,\n\t\t\tvoice: params.voice || \"female\",\n\t\t\tlanguage: params.language || \"en-US\",\n\t\t},\n\t\t{ operation: \"speak\" }\n\t);\n}\n\n/**\n * Transfer a call to another number\n */\nexport async function transferCall(params: {\n\tcallControlId: string;\n\tto: string;\n\tfrom: string;\n}) {\n\treturn telnyxCallRequest(\n\t\t`/calls/${params.callControlId}/actions/transfer`,\n\t\t{\n\t\t\tto: params.to,\n\t\t\tfrom: params.from,\n\t\t},\n\t\t{ operation: \"transfer\" }\n\t);\n}\n\n/**\n * Send DTMF tones (phone keypad presses)\n */\nexport async function sendDTMF(params: {\n\tcallControlId: string;\n\tdigits: string;\n}) {\n\treturn telnyxCallRequest(\n\t\t`/calls/${params.callControlId}/actions/send_dtmf`,\n\t\t{ digits: params.digits },\n\t\t{ operation: \"send_dtmf\" }\n\t);\n}\n\n/**\n * Gather user input using audio prompts\n */\nexport async function gatherInput(params: {\n\tcallControlId: string;\n\taudioUrl?: string;\n\tspeakText?: string;\n\tvalidDigits?: string;\n\tmaxDigits?: number;\n\tminDigits?: number;\n\ttimeout?: number;\n\tterminatingDigit?: string;\n}) {\n\tconst useAudio = !!params.audioUrl;\n\tconst endpoint = useAudio\n\t\t? `/calls/${params.callControlId}/actions/gather_using_audio`\n\t\t: `/calls/${params.callControlId}/actions/gather_using_speak`;\n\n\tconst body = useAudio\n\t\t? {\n\t\t\t\taudio_url: params.audioUrl,\n\t\t\t\tvalid_digits: params.validDigits,\n\t\t\t\tmax: params.maxDigits,\n\t\t\t\tmin: params.minDigits,\n\t\t\t\ttimeout_millis: params.timeout,\n\t\t\t\tterminating_digit: params.terminatingDigit || \"#\",\n\t\t\t}\n\t\t: {\n\t\t\t\tpayload: params.speakText || \"\",\n\t\t\t\tvalid_digits: params.validDigits,\n\t\t\t\tmax: params.maxDigits,\n\t\t\t\tmin: params.minDigits,\n\t\t\t\ttimeout_millis: params.timeout,\n\t\t\t\tterminating_digit: params.terminatingDigit || \"#\",\n\t\t\t};\n\n\treturn telnyxCallRequest(endpoint, body, {\n\t\toperation: useAudio ? \"gather_audio\" : \"gather_speak\",\n\t});\n}\n","\"use server\";\n\nimport type { SupabaseClient as SupabaseJsClient } from \"@supabase/supabase-js\";\nimport { revalidatePath } from \"next/cache\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport {\n\tattachNumberToCampaign,\n\tcreateTenDlcBrand,\n\tcreateTenDlcCampaign,\n\tgetTenDlcBrand,\n\tgetTenDlcCampaign,\n} from \"@/lib/telnyx/ten-dlc\";\nimport type { Database } from \"@/types/supabase\";\n\ntype TypedSupabaseClient = SupabaseJsClient<Database>;\n\ntype OwnerContactRow = {\n\tfull_name?: string | null;\n\temail?: string | null;\n\tphone?: string | null;\n};\n\nconst DEFAULT_MESSAGING_PROFILE_ID =\n\tprocess.env.TELNYX_DEFAULT_MESSAGING_PROFILE_ID ||\n\tprocess.env.NEXT_PUBLIC_TELNYX_MESSAGING_PROFILE_ID ||\n\t\"\";\n\nconst NANP_WITH_COUNTRY_DIGITS = 11;\nconst NANP_LOCAL_DIGITS = 10;\nconst WHITESPACE_SPLIT_REGEX = /\\s+/;\n\nfunction formatPhone(phone?: string | null): string | null {\n\tif (!phone) {\n\t\treturn null;\n\t}\n\tconst digits = phone.replace(/\\D/g, \"\");\n\tif (!digits) {\n\t\treturn null;\n\t}\n\tif (digits.length === NANP_WITH_COUNTRY_DIGITS && digits.startsWith(\"1\")) {\n\t\treturn `+${digits}`;\n\t}\n\tif (digits.length === NANP_LOCAL_DIGITS) {\n\t\treturn `+1${digits}`;\n\t}\n\treturn phone.startsWith(\"+\") ? phone : `+${digits}`;\n}\n\nfunction splitName(fullName?: string | null) {\n\tif (!fullName) {\n\t\treturn { first: \"Support\", last: \"Team\" };\n\t}\n\tconst parts = fullName.trim().split(WHITESPACE_SPLIT_REGEX);\n\tif (parts.length === 1) {\n\t\treturn { first: parts[0], last: \"Team\" };\n\t}\n\treturn { first: parts[0], last: parts.slice(1).join(\" \") };\n}\n\nfunction mapIndustryToVertical(industry?: string | null) {\n\tif (!industry) {\n\t\treturn \"PROFESSIONAL\";\n\t}\n\tconst normalized = industry.toLowerCase();\n\tif (normalized.includes(\"plumb\")) {\n\t\treturn \"HOME_SERVICES\";\n\t}\n\tif (normalized.includes(\"hvac\")) {\n\t\treturn \"HOME_SERVICES\";\n\t}\n\tif (normalized.includes(\"electric\")) {\n\t\treturn \"HOME_SERVICES\";\n\t}\n\tif (normalized.includes(\"clean\")) {\n\t\treturn \"PROFESSIONAL\";\n\t}\n\treturn \"PROFESSIONAL\";\n}\n\nasync function upsertBrandRecord(\n\tsupabase: TypedSupabaseClient,\n\tdata: Partial<Database[\"public\"][\"Tables\"][\"messaging_brands\"][\"Insert\"]> & {\n\t\tcompany_id: string;\n\t},\n) {\n\tconst { data: existing } = await supabase\n\t\t.from(\"messaging_brands\")\n\t\t.select(\"id\")\n\t\t.eq(\"company_id\", data.company_id)\n\t\t.maybeSingle();\n\n\tif (existing) {\n\t\tawait supabase\n\t\t\t.from(\"messaging_brands\")\n\t\t\t.update({ ...data, updated_at: new Date().toISOString() })\n\t\t\t.eq(\"id\", existing.id);\n\t} else {\n\t\tawait supabase\n\t\t\t.from(\"messaging_brands\")\n\t\t\t.insert(\n\t\t\t\tdata as Database[\"public\"][\"Tables\"][\"messaging_brands\"][\"Insert\"],\n\t\t\t);\n\t}\n}\n\nasync function upsertCampaignRecord(\n\tsupabase: TypedSupabaseClient,\n\tdata: Partial<\n\t\tDatabase[\"public\"][\"Tables\"][\"messaging_campaigns\"][\"Insert\"]\n\t> & {\n\t\tmessaging_brand_id: string;\n\t\tusecase: string;\n\t},\n) {\n\tconst { data: existing } = await supabase\n\t\t.from(\"messaging_campaigns\")\n\t\t.select(\"id\")\n\t\t.eq(\"messaging_brand_id\", data.messaging_brand_id)\n\t\t.eq(\"usecase\", data.usecase)\n\t\t.maybeSingle();\n\n\tif (existing) {\n\t\tawait supabase\n\t\t\t.from(\"messaging_campaigns\")\n\t\t\t.update({ ...data, updated_at: new Date().toISOString() })\n\t\t\t.eq(\"id\", existing.id);\n\t\treturn existing.id;\n\t}\n\n\tconst { data: inserted } = await supabase\n\t\t.from(\"messaging_campaigns\")\n\t\t.insert(data)\n\t\t.select(\"id\")\n\t\t.single();\n\n\treturn inserted?.id ?? null;\n}\n\n// Telnyx onboarding requires multiple guarded steps\nexport async function ensureMessagingBranding(\n\tcompanyId: string,\n\toptions?: { supabase?: TypedSupabaseClient | null },\n) {\n\tconst supabase = options?.supabase ?? (await createClient());\n\tif (!supabase) {\n\t\treturn { success: false, error: \"Supabase unavailable\" };\n\t}\n\n\tconst { data: company, error } = await supabase\n\t\t.from(\"companies\")\n\t\t.select(\n\t\t\t\"id, name, legal_name, doing_business_as, phone, support_email, support_phone, website, website_url, brand_color, industry, address, city, state, zip_code, owner_id, ein, tax_id\",\n\t\t)\n\t\t.eq(\"id\", companyId)\n\t\t.single();\n\n\tif (error || !company) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error?.message || \"Company not found\",\n\t\t};\n\t}\n\n\tconst { data: ownerContact } = await supabase\n\t\t.from(\"profiles\")\n\t\t.select(\"full_name, email, phone\")\n\t\t.eq(\"id\", company.owner_id)\n\t\t.maybeSingle<OwnerContactRow>();\n\n\tconst contactName = splitName(ownerContact?.full_name);\n\tconst contactEmail =\n\t\townerContact?.email || company.support_email || \"support@example.com\";\n\tconst contactPhone =\n\t\tformatPhone(ownerContact?.phone) ||\n\t\tformatPhone(company.support_phone) ||\n\t\tformatPhone(company.phone) ||\n\t\t\"+18314280176\";\n\n\tconst { data: brandRow } = await supabase\n\t\t.from(\"messaging_brands\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.maybeSingle();\n\n\tif (brandRow?.telnyx_brand_id) {\n\t\tconst brandStatus = await getTenDlcBrand(brandRow.telnyx_brand_id);\n\t\tif (brandStatus.success && brandStatus.data) {\n\t\t\tawait supabase\n\t\t\t\t.from(\"messaging_brands\")\n\t\t\t\t.update({\n\t\t\t\t\tstatus: brandStatus.data.status,\n\t\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t\t})\n\t\t\t\t.eq(\"id\", brandRow.id);\n\t\t}\n\t}\n\n\tif (!brandRow?.telnyx_brand_id) {\n\t\tconst brandPayload = {\n\t\t\tcustomer_reference: companyId,\n\t\t\tbrand_name: company.legal_name || company.name,\n\t\t\tein:\n\t\t\t\tcompany.ein ||\n\t\t\t\tcompany.tax_id ||\n\t\t\t\tprocess.env.FALLBACK_TEST_EIN ||\n\t\t\t\t\"00-0000000\",\n\t\t\tein_issuing_country: \"US\",\n\t\t\tvertical: mapIndustryToVertical(company.industry),\n\t\t\twebsite: company.website || company.website_url || null,\n\t\t\tcompany_type: \"PRIVATE_PROFIT\" as const,\n\t\t\taddress: {\n\t\t\t\tline1: company.address || \"115 Flintlock Lane\",\n\t\t\t\tcity: company.city || \"Ben Lomond\",\n\t\t\t\tstate: company.state || \"CA\",\n\t\t\t\tpostal_code: company.zip_code || \"95005\",\n\t\t\t\tcountry: \"US\",\n\t\t\t},\n\t\t\tcontact: {\n\t\t\t\tfirst_name: contactName.first,\n\t\t\t\tlast_name: contactName.last,\n\t\t\t\temail: contactEmail,\n\t\t\t\tphone: contactPhone,\n\t\t\t},\n\t\t\toptional_attributes: {\n\t\t\t\tdoing_business_as: company.doing_business_as || company.name,\n\t\t\t},\n\t\t};\n\n\t\tconst brandResult = await createTenDlcBrand(brandPayload);\n\t\tif (!(brandResult.success && brandResult.data)) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: brandResult.error || \"Failed to create 10DLC brand\",\n\t\t\t};\n\t\t}\n\n\t\tawait upsertBrandRecord(supabase, {\n\t\t\tcompany_id: companyId,\n\t\t\ttelnyx_brand_id: brandResult.data.id,\n\t\t\tstatus: \"submitted\",\n\t\t\tlegal_name: brandPayload.brand_name,\n\t\t\tdoing_business_as: company.doing_business_as || company.name,\n\t\t\tein: brandPayload.ein,\n\t\t\tvertical: brandPayload.vertical,\n\t\t\twebsite: brandPayload.website,\n\t\t\tsupport_email: contactEmail,\n\t\t\tsupport_phone: contactPhone,\n\t\t\taddress_line1: brandPayload.address.line1,\n\t\t\tcity: brandPayload.address.city,\n\t\t\tstate: brandPayload.address.state,\n\t\t\tpostal_code: brandPayload.address.postal_code,\n\t\t\tbrand_color: company.brand_color,\n\t\t});\n\t}\n\n\trevalidatePath(\"/dashboard/settings/communications/brand\");\n\treturn { success: true };\n}\n\n// Linking campaigns touches several Telnyx APIs sequentially\nexport async function ensureMessagingCampaign(\n\tcompanyId: string,\n\tphoneNumber: { id: string; e164: string },\n\toptions?: { supabase?: TypedSupabaseClient | null },\n) {\n\tconst supabase = options?.supabase ?? (await createClient());\n\tif (!supabase) {\n\t\treturn { success: false, error: \"Supabase unavailable\" };\n\t}\n\n\tconst { data: brand } = await supabase\n\t\t.from(\"messaging_brands\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.maybeSingle();\n\n\tif (!brand?.telnyx_brand_id) {\n\t\tconst brandResult = await ensureMessagingBranding(companyId, {\n\t\t\tsupabase,\n\t\t});\n\t\tif (!brandResult.success) {\n\t\t\treturn brandResult;\n\t\t}\n\t\treturn ensureMessagingCampaign(companyId, phoneNumber);\n\t}\n\n\tconst usecase = \"CUSTOMER_CARE\";\n\n\tconst { data: campaignRow } = await supabase\n\t\t.from(\"messaging_campaigns\")\n\t\t.select(\"*\")\n\t\t.eq(\"messaging_brand_id\", brand.id)\n\t\t.eq(\"usecase\", usecase)\n\t\t.maybeSingle();\n\n\tif (campaignRow?.telnyx_campaign_id) {\n\t\tconst campaignStatus = await getTenDlcCampaign(\n\t\t\tcampaignRow.telnyx_campaign_id,\n\t\t);\n\t\tif (campaignStatus.success && campaignStatus.data) {\n\t\t\tawait supabase\n\t\t\t\t.from(\"messaging_campaigns\")\n\t\t\t\t.update({\n\t\t\t\t\tstatus: campaignStatus.data.status,\n\t\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t\t})\n\t\t\t\t.eq(\"id\", campaignRow.id);\n\t\t}\n\t}\n\n\tlet campaignId = campaignRow?.id ?? null;\n\tlet telnyxCampaignId = campaignRow?.telnyx_campaign_id ?? null;\n\n\tif (!campaignRow?.telnyx_campaign_id) {\n\t\tif (!DEFAULT_MESSAGING_PROFILE_ID) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"TELNYX_DEFAULT_MESSAGING_PROFILE_ID not configured\",\n\t\t\t};\n\t\t}\n\n\t\tconst description = `${brand.doing_business_as || brand.legal_name} provides appointment updates, reminders, and service notifications to existing customers.`;\n\t\tconst sampleMessage = `Hi {{customer_name}}, this is ${\n\t\t\tbrand.doing_business_as || brand.legal_name\n\t\t} confirming your upcoming appointment. Reply HELP for assistance or STOP to opt out.`;\n\n\t\tconst campaignPayload = {\n\t\t\tbrand_id: brand.telnyx_brand_id,\n\t\t\tcampaign_alias: `${companyId}-customer-care`,\n\t\t\tusecase,\n\t\t\tdescription,\n\t\t\tsample_messages: [sampleMessage],\n\t\t\tmessage_flow:\n\t\t\t\t\"Customers opt in during onboarding or by texting our business line. They receive service updates and can opt out by replying STOP.\",\n\t\t\tterms_and_conditions:\n\t\t\t\t\"Msg & data rates may apply. Reply STOP to opt out, HELP for help.\",\n\t\t\thelp_message: `Thanks for contacting ${brand.doing_business_as || brand.legal_name}. Reply STOP to unsubscribe.`,\n\t\t\thelp_phone_number: brand.support_phone || \"+18314280176\",\n\t\t\thelp_email: brand.support_email || \"support@example.com\",\n\t\t\tauto_renewal: true,\n\t\t\tmessage_fee_credits: 0,\n\t\t\topt_in_keywords: [\"START\", \"YES\"],\n\t\t\topt_out_keywords: [\"STOP\", \"UNSUBSCRIBE\"],\n\t\t\topt_in_message:\n\t\t\t\t\"Thanks for opting in to receive messages from us. Reply STOP to opt out.\",\n\t\t\topt_out_message:\n\t\t\t\t\"You have successfully been unsubscribed and will no longer receive messages. Reply START to opt in again.\",\n\t\t};\n\n\t\tconst campaignResult = await createTenDlcCampaign(campaignPayload);\n\t\tif (!(campaignResult.success && campaignResult.data)) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: campaignResult.error || \"Failed to create 10DLC campaign\",\n\t\t\t};\n\t\t}\n\n\t\tcampaignId =\n\t\t\t(await upsertCampaignRecord(supabase, {\n\t\t\t\tmessaging_brand_id: brand.id,\n\t\t\t\ttelnyx_campaign_id: campaignResult.data.id,\n\t\t\t\tstatus: \"submitted\",\n\t\t\t\tusecase,\n\t\t\t\tdescription,\n\t\t\t\tsample_messages: campaignPayload.sample_messages,\n\t\t\t\tmessaging_profile_id: DEFAULT_MESSAGING_PROFILE_ID,\n\t\t\t})) ||\n\t\t\tcampaignRow?.id ||\n\t\t\tnull;\n\t\ttelnyxCampaignId = campaignResult.data.id;\n\t}\n\n\tif (!(campaignId && telnyxCampaignId)) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: \"Campaign not ready\",\n\t\t};\n\t}\n\n\tconst { data: linkRecord } = await supabase\n\t\t.from(\"messaging_campaign_phone_numbers\")\n\t\t.select(\"*\")\n\t\t.eq(\"messaging_campaign_id\", campaignId)\n\t\t.eq(\"phone_number_id\", phoneNumber.id)\n\t\t.maybeSingle();\n\n\tif (!linkRecord?.telnyx_relationship_id) {\n\t\tconst attachResult = await attachNumberToCampaign(\n\t\t\ttelnyxCampaignId,\n\t\t\tphoneNumber.e164,\n\t\t);\n\t\tif (!(attachResult.success && attachResult.data)) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: attachResult.error || \"Failed to link number to campaign\",\n\t\t\t};\n\t\t}\n\n\t\tif (linkRecord) {\n\t\t\tawait supabase\n\t\t\t\t.from(\"messaging_campaign_phone_numbers\")\n\t\t\t\t.update({\n\t\t\t\t\ttelnyx_relationship_id: attachResult.data.id,\n\t\t\t\t\tstatus: \"submitted\",\n\t\t\t\t})\n\t\t\t\t.eq(\"id\", linkRecord.id);\n\t\t} else {\n\t\t\tawait supabase.from(\"messaging_campaign_phone_numbers\").insert({\n\t\t\t\tmessaging_campaign_id: campaignId,\n\t\t\t\tphone_number_id: phoneNumber.id,\n\t\t\t\ttelnyx_relationship_id: attachResult.data.id,\n\t\t\t\tstatus: \"submitted\",\n\t\t\t});\n\t\t}\n\t}\n\n\tawait supabase\n\t\t.from(\"phone_numbers\")\n\t\t.update({\n\t\t\ttelnyx_messaging_profile_id: DEFAULT_MESSAGING_PROFILE_ID,\n\t\t\tmetadata: {\n\t\t\t\tten_dlc_campaign_id: telnyxCampaignId,\n\t\t\t},\n\t\t})\n\t\t.eq(\"id\", phoneNumber.id);\n\n\trevalidatePath(\"/dashboard/settings/communications/phone-numbers\");\n\treturn { success: true };\n}\n"],"names":["module","exports","require","vendored","ReactServerDOMTurbopackServer","registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,1,2]}