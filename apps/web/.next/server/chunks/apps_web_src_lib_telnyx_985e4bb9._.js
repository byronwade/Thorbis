module.exports=[786348,e=>{"use strict";let t={debug:0,info:1,warn:2,error:3},r=process.env.TELNYX_LOG_LEVEL||"info",a=["phone","phoneNumber","phone_number","from","to","fromNumber","toNumber","from_number","to_number","apiKey","api_key","authToken","auth_token","password","secret","token"];function n(e){let t=e.replace(/\D/g,"");return t.length<4?"****":`***${t.slice(-4)}`}function o(e){let[t,r]=e.split("@");if(!r)return"***@***";let a=t.length>2?`${t[0]}***${t[t.length-1]}`:"***";return`${a}@${r}`}class s{parent;context;constructor(e,t){this.parent=e,this.context=t}debug(e,t){this.parent.debug(e,{...this.context,...t})}info(e,t){this.parent.info(e,{...this.context,...t})}warn(e,t){this.parent.warn(e,{...this.context,...t})}error(e,t){this.parent.error(e,{...this.context,...t})}}let i=new class{service="telnyx";defaultContext={};setDefaultContext(e){this.defaultContext={...this.defaultContext,...e}}clearDefaultContext(){this.defaultContext={}}shouldLog(e){return t[e]>=t[r]}log(e,t,r){if(!this.shouldLog(e))return;let s={timestamp:new Date().toISOString(),level:e,service:this.service,message:t},i={...this.defaultContext,...r};Object.keys(i).length>0&&(s.context=function e(t,r=0){if(r>10)return"[MAX_DEPTH]";if(null==t)return t;if("string"==typeof t)return t.replace(/\+?1?\d{10,15}/g,e=>n(e)).replace(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,e=>o(e));if("number"==typeof t||"boolean"==typeof t)return t;if(Array.isArray(t))return t.map(t=>e(t,r+1));if("object"==typeof t){let s={};for(let[i,l]of Object.entries(t))a.some(e=>i.toLowerCase().includes(e.toLowerCase()))?"string"==typeof l?l.includes("@")?s[i]=o(l):/\d/.test(l)?s[i]=n(l):s[i]="[REDACTED]":s[i]="[REDACTED]":s[i]=e(l,r+1);return s}return t}(i));{let t=JSON.stringify(s);switch(e){case"error":console.error(t);break;case"warn":console.warn(t)}}}debug(e,t){this.log("debug",e,t)}info(e,t){this.log("info",e,t)}warn(e,t){this.log("warn",e,t)}error(e,t){this.log("error",e,t)}child(e){return new s(this,e)}logRequestStart(e,t,r){let a=r?.correlationId||`tlx_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,n=Date.now();return this.debug(`${e} ${t} started`,{...r,correlationId:a,endpoint:t}),{correlationId:a,startTime:n}}logRequestEnd(e,t,r,a,n){let o=Date.now()-a;(r>=400?this.warn.bind(this):this.info.bind(this))(`${e} ${t} completed`,{...n,endpoint:t,statusCode:r,latencyMs:o})}logRequestError(e,t,r,a,n){let o=Date.now()-a;this.error(`${e} ${t} failed`,{...n,endpoint:t,error:r.message,latencyMs:o})}};e.s(["telnyxLogger",0,i])},628123,e=>{"use strict";var t=e.i(786348);let r={maxRetries:5,baseDelayMs:1e3,maxDelayMs:32e3,jitterFactor:.3,retryableStatusCodes:[408,429,500,502,503,504],retryableErrorCodes:["ECONNRESET","ETIMEDOUT","ECONNREFUSED","EPIPE","ENOTFOUND","ENETUNREACH","EAI_AGAIN"]},a={failureThreshold:5,resetTimeoutMs:6e4,halfOpenRequests:3},n=new Map;function o(e){return n.has(e)||n.set(e,{state:"closed",failures:0,lastFailureTime:0,halfOpenSuccesses:0,halfOpenFailures:0}),n.get(e)}function s(e,r,n=a){let i=o(e),l=Date.now();r?"half-open"===i.state?(i.halfOpenSuccesses++,i.halfOpenSuccesses>=n.halfOpenRequests&&(i.state="closed",i.failures=0,i.halfOpenSuccesses=0,i.halfOpenFailures=0,t.telnyxLogger.info("Circuit breaker closed",{endpoint:e}))):"closed"===i.state&&(i.failures=0):(i.lastFailureTime=l,"half-open"===i.state?(i.halfOpenFailures++,i.state="open",i.halfOpenSuccesses=0,i.halfOpenFailures=0,t.telnyxLogger.warn("Circuit breaker reopened",{endpoint:e})):"closed"===i.state&&(i.failures++,i.failures>=n.failureThreshold&&(i.state="open",t.telnyxLogger.error("Circuit breaker opened",{endpoint:e,failures:i.failures}))))}function i(e,t){let r=Error(e);return r.name="RetryError",r.statusCode=t.statusCode,r.errorCode=t.errorCode,r.retryable=t.retryable,r.attempts=t.attempts,r.lastError=t.lastError,r}function l(e){return new Promise(t=>setTimeout(t,e))}async function c(e,n={}){let d,f={...r,...n.config},g={...a,...n.circuitBreakerConfig},p=n.endpoint||"default",h=n.correlationId||u();if(!function(e,r=a){let n=o(e),s=Date.now();return"closed"===n.state||"open"!==n.state||s-n.lastFailureTime>=r.resetTimeoutMs&&(n.state="half-open",n.halfOpenSuccesses=0,n.halfOpenFailures=0,t.telnyxLogger.info("Circuit breaker half-open",{endpoint:e}),!0)}(p,g)){let e=i(`Circuit breaker open for endpoint: ${p}`,{retryable:!1,attempts:0});throw t.telnyxLogger.warn("Request blocked by circuit breaker",{endpoint:p,correlationId:h}),e}let m=0;for(;m<=f.maxRetries;)try{let r=await e();return s(p,!0,g),m>0&&t.telnyxLogger.info("Request succeeded after retry",{endpoint:p,attempt:m,correlationId:h}),r}catch(o){d=o instanceof Error?o:Error(String(o));let e=function(e,t=r){if(!e)return!1;if(e instanceof Error){let r=e.code;if(r&&t.retryableErrorCodes.includes(r)||e.message.includes("fetch failed")||e.message.includes("network")||e.message.includes("timeout")||e.message.includes("ECONNRESET"))return!0}if("object"==typeof e&&null!==e){let r=e.statusCode||e.status;if(r&&t.retryableStatusCodes.includes(r))return!0}return!1}(o,f);if(t.telnyxLogger.warn("Request failed",{endpoint:p,attempt:m,retryable:e,error:d.message,correlationId:h}),s(p,!1,g),!e||m>=f.maxRetries)throw i(`Request failed after ${m+1} attempt(s): ${d.message}`,{retryable:e,attempts:m+1,lastError:d,statusCode:o.statusCode,errorCode:o.code});let a=function(e,t=r){let a=Math.min(t.baseDelayMs*Math.pow(2,e),t.maxDelayMs),n=a*t.jitterFactor*Math.random();return Math.floor(a+n)}(m,f);if("object"==typeof o&&null!==o&&"response"in o){let e=o.response;if(e){let t=function(e){let t=e.headers.get("Retry-After");if(!t)return null;let r=parseInt(t,10);if(!isNaN(r))return 1e3*r;let a=Date.parse(t);return isNaN(a)?null:Math.max(0,a-Date.now())}(e);t&&(a=Math.min(t,f.maxDelayMs))}}n.onRetry&&n.onRetry(m,d,a),t.telnyxLogger.info("Retrying request",{endpoint:p,attempt:m+1,delayMs:a,correlationId:h}),await l(a),m++}throw i(`Request failed after ${f.maxRetries+1} attempts`,{retryable:!1,attempts:f.maxRetries+1,lastError:d})}function u(){return`tlx_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}e.s(["generateCorrelationId",()=>u,"sleep",()=>l,"withRetry",()=>c])},614952,e=>{"use strict";var t=e.i(786348),r=e.i(628123);async function a(e,a,n){let o=process.env.TELNYX_API_KEY;if(!o)return{success:!1,error:"TELNYX_API_KEY is not configured"};let s=n?.operation||e,i=n?.timeout??15e3,l=async()=>{let r=new AbortController,n=setTimeout(()=>r.abort(),i);try{t.telnyxLogger.debug("Call API request",{endpoint:e,operation:s});let i=await fetch(`https://api.telnyx.com/v2${e}`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify(a),signal:r.signal});clearTimeout(n);let l=await i.json();if(!i.ok){let r=l?.errors?.[0]?.detail||l?.errors?.[0]||i.statusText;t.telnyxLogger.warn("Call API error response",{endpoint:e,operation:s,status:i.status,error:r});let a=Error(`Telnyx ${i.status}: ${r}`);throw a.statusCode=i.status,a}return t.telnyxLogger.debug("Call API success",{endpoint:e,operation:s}),{success:!0,data:l.data}}catch(r){if(clearTimeout(n),r instanceof Error&&"AbortError"===r.name)throw t.telnyxLogger.error("Call API timeout",{endpoint:e,operation:s,timeoutMs:i}),Error(`Request timeout after ${i}ms`);throw r}};try{if(n?.skipRetry)return await l();return await (0,r.withRetry)(l,{endpoint:`calls:${s}`,config:{maxRetries:2,baseDelayMs:500,maxDelayMs:2e3},onRetry:(r,a,n)=>{t.telnyxLogger.warn("Retrying call API request",{endpoint:e,operation:s,attempt:r,error:a.message,delayMs:n})}})}catch(r){return t.telnyxLogger.error("Call API request failed",{endpoint:e,operation:s,error:r instanceof Error?r.message:"Unknown error"}),{success:!1,error:r instanceof Error?r.message:"Request failed"}}}async function n(e){let t=await a("/calls",{to:e.to,from:e.from,connection_id:e.connectionId,webhook_url:e.webhookUrl,answering_machine_detection:e.answeringMachineDetection||"disabled",custom_headers:e.customHeaders},{operation:"initiate"});return t.success&&t.data?{success:!0,callControlId:t.data.call_control_id,callSessionId:t.data.call_session_id,data:t.data}:{success:!1,error:t.error||"Failed to initiate call"}}async function o(e){return a(`/calls/${e.callControlId}/actions/answer`,{webhook_url:e.webhookUrl,client_state:e.clientState},{operation:"answer",skipRetry:!0})}async function s(e){return a(`/calls/${e.callControlId}/actions/reject`,{cause:e.cause||"CALL_REJECTED"},{operation:"reject",skipRetry:!0})}async function i(e){return a(`/calls/${e.callControlId}/actions/hangup`,{},{operation:"hangup"})}async function l(e){return a(`/calls/${e.callControlId}/actions/record_start`,{format:e.format||"mp3",channels:e.channels||"single"},{operation:"record_start"})}async function c(e){return a(`/calls/${e.callControlId}/actions/record_stop`,{},{operation:"record_stop"})}async function u(e){return a(`/calls/${e.callControlId}/actions/playback_start`,{audio_url:e.audioUrl,loop:e.loop},{operation:"playback_start"})}async function d(e){return a(`/calls/${e.callControlId}/actions/speak`,{payload:e.text,voice:e.voice||"female",language:e.language||"en-US"},{operation:"speak"})}async function f(e){return a(`/calls/${e.callControlId}/actions/transfer`,{to:e.to,from:e.from},{operation:"transfer"})}async function g(e){return a(`/calls/${e.callControlId}/actions/send_dtmf`,{digits:e.digits},{operation:"send_dtmf"})}async function p(e){let t=!!e.audioUrl;return a(t?`/calls/${e.callControlId}/actions/gather_using_audio`:`/calls/${e.callControlId}/actions/gather_using_speak`,t?{audio_url:e.audioUrl,valid_digits:e.validDigits,max:e.maxDigits,min:e.minDigits,timeout_millis:e.timeout,terminating_digit:e.terminatingDigit||"#"}:{payload:e.speakText||"",valid_digits:e.validDigits,max:e.maxDigits,min:e.minDigits,timeout_millis:e.timeout,terminating_digit:e.terminatingDigit||"#"},{operation:t?"gather_audio":"gather_speak"})}e.s(["answerCall",()=>o,"gatherInput",()=>p,"hangupCall",()=>i,"initiateCall",()=>n,"playAudio",()=>u,"rejectCall",()=>s,"sendDTMF",()=>g,"speakText",()=>d,"startRecording",()=>l,"stopRecording",()=>c,"transferCall",()=>f])}];

//# sourceMappingURL=apps_web_src_lib_telnyx_985e4bb9._.js.map