module.exports=[872790,a=>{"use strict";var b=a.i(504348),c=a.i(280105),d=a.i(459208),e=a.i(995146),f=a.i(550042),g=a.i(173686),h=a.i(858257),i=a.i(835929),j=a.i(843775),k=a.i(225249),l=a.i(424340),m=a.i(402239);function n({teamMemberName:a,resetByName:n,resetLink:x,companyName:y,expiresInHours:z=24}){return(0,b.jsxs)(i.Html,{children:[(0,b.jsx)(f.Head,{}),(0,b.jsxs)(k.Preview,{children:["Password reset for ",y]}),(0,b.jsx)(c.Body,{style:o,children:(0,b.jsxs)(e.Container,{style:p,children:[(0,b.jsx)(g.Heading,{style:q,children:"Password Reset"}),(0,b.jsxs)(m.Text,{style:r,children:["Hi ",a,","]}),(0,b.jsxs)(m.Text,{style:r,children:[n," from ",y," has initiated a password reset for your account."]}),(0,b.jsx)(m.Text,{style:r,children:"Click the button below to set a new password for your account:"}),(0,b.jsx)(l.Section,{style:s,children:(0,b.jsx)(d.Button,{href:x,style:t,children:"Reset Password"})}),(0,b.jsx)(m.Text,{style:r,children:"Or copy and paste this URL into your browser:"}),(0,b.jsx)(j.Link,{href:x,style:u,children:x}),(0,b.jsx)(h.Hr,{style:v}),(0,b.jsxs)(m.Text,{style:w,children:["This link will expire in ",z," hours. If you didn't request this password reset, please contact your administrator immediately."]}),(0,b.jsxs)(m.Text,{style:w,children:["Best regards,",(0,b.jsx)("br",{}),"The ",y," Team"]})]})})]})}let o={backgroundColor:"#f6f9fc",fontFamily:'-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Ubuntu,sans-serif'},p={backgroundColor:"#f3f7fd",margin:"0 auto",padding:"20px 0 48px",marginBottom:"64px"},q={color:"#333",fontSize:"24px",fontWeight:"bold",textAlign:"center",margin:"30px 0",padding:"0"},r={color:"#333",fontSize:"16px",lineHeight:"26px",textAlign:"left",padding:"0 48px"},s={padding:"27px 48px"},t={backgroundColor:"#1f2938",borderRadius:"5px",color:"#f8fafe",fontSize:"16px",fontWeight:"bold",textDecoration:"none",textAlign:"center",display:"block",width:"100%",padding:"12px 20px"},u={color:"#0066cc",fontSize:"14px",textDecoration:"underline",padding:"0 48px",wordBreak:"break-all"},v={borderColor:"#e6ebf1",margin:"20px 48px"},w={color:"#8898aa",fontSize:"12px",lineHeight:"16px",padding:"0 48px"};a.s(["PasswordResetTemplate",()=>n])},499694,a=>a.a(async(b,c)=>{try{var d=a.i(780195),e=a.i(218188),f=a.i(146057),g=a.i(872790);a.i(467361);var h=a.i(445074);a.i(997053);var i=a.i(311487),j=a.i(198114),k=a.i(818944),l=a.i(974406),m=a.i(136874),n=a.i(395731),o=b([j]);async function p(a){return(0,l.withErrorHandling)(async()=>{let b,c=await (0,m.createClient)();if(!c)throw new k.ActionError("Database connection failed",k.ERROR_CODES.DB_CONNECTION_ERROR);let{data:{user:d}}=await c.auth.getUser();(0,l.assertAuthenticated)(d?.id);let{data:f}=await c.from("company_memberships").select("company_id").eq("user_id",d.id).single();if(!f?.company_id)throw new k.ActionError("You must be part of a company to create team members",k.ERROR_CODES.AUTH_FORBIDDEN,403);let g=a.get("email"),h=a.get("firstName"),i=a.get("lastName"),n=a.get("role");if(!g||!h||!i||!n)throw new k.ActionError("Email, first name, last name, and role are required",k.ERROR_CODES.INVALID_INPUT);let{data:o}=await c.from("profiles").select("id").eq("email",g).single();if(o)b=o.id;else{let d=a.get("temp_password");if(!d)throw new k.ActionError("Temporary password is required for direct creation",k.ERROR_CODES.INVALID_INPUT);let{data:e,error:f}=await c.auth.admin.createUser({email:g,password:d,email_confirm:!0,user_metadata:{full_name:`${h} ${i}`}});if(f||!e.user)throw new k.ActionError(`Failed to create user: ${f?.message}`,k.ERROR_CODES.DB_QUERY_ERROR);b=e.user.id;let{error:j}=await c.from("profiles").insert({id:b,email:g,full_name:`${h} ${i}`,phone:a.get("phone")||null});if(j)throw new k.ActionError(k.ERROR_MESSAGES.operationFailed("create profile"),k.ERROR_CODES.DB_QUERY_ERROR)}let p=(a.get("skills")||"").split(",").map(a=>a.trim()).filter(Boolean),q=(a.get("licenses")||"").split(",").map(a=>a.trim()).filter(Boolean),r=(a.get("service_areas")||"").split(",").map(a=>a.trim()).filter(Boolean),s=(a.get("preferred_job_types")||"").split(",").map(a=>a.trim()).filter(Boolean),t=null,u=a.get("certifications");if(u)try{t=JSON.parse(u)}catch{t=u.split(",").map(a=>a.trim()).filter(Boolean)}let v=null,w=a.get("commission_structure");if(w)try{v=JSON.parse(w)}catch{console.warn("Invalid JSON for commission_structure:",w)}let x=null,y=a.get("availability_schedule");if(y)try{x=JSON.parse(y)}catch{console.warn("Invalid JSON for availability_schedule:",y)}let{data:z,error:A}=await c.from("company_memberships").insert({company_id:f.company_id,user_id:b,role:n,status:"active",job_title:a.get("job_title")||null,department_id:a.get("department_id")||null,emergency_contact_name:a.get("emergency_contact_name")||null,emergency_contact_phone:a.get("emergency_contact_phone")||null,emergency_contact_relationship:a.get("emergency_contact_relationship")||null,employee_id:a.get("employee_id")||null,hire_date:a.get("hire_date")||null,employment_type:a.get("employment_type")||null,work_schedule:a.get("work_schedule")||null,work_location:a.get("work_location")||null,pay_type:a.get("pay_type")||null,hourly_rate:a.get("hourly_rate")?parseFloat(a.get("hourly_rate")):null,annual_salary:a.get("annual_salary")?parseFloat(a.get("annual_salary")):null,commission_rate:a.get("commission_rate")?parseFloat(a.get("commission_rate")):null,commission_structure:v,overtime_eligible:"true"===a.get("overtime_eligible"),street_address:a.get("street_address")||null,city:a.get("city")||null,state:a.get("state")||null,postal_code:a.get("postal_code")||null,country:a.get("country")||"US",skills:p.length>0?p:null,certifications:t,licenses:q.length>0?q:null,service_areas:r.length>0?r:null,availability_schedule:x,max_weekly_hours:a.get("max_weekly_hours")?parseInt(a.get("max_weekly_hours")):null,preferred_job_types:s.length>0?s:null,performance_notes:a.get("performance_notes")||null,last_review_date:a.get("last_review_date")||null,next_review_date:a.get("next_review_date")||null,notes:a.get("notes")||null,invited_at:new Date().toISOString(),accepted_at:new Date().toISOString()}).select("id").single();if(A)throw new k.ActionError(k.ERROR_MESSAGES.operationFailed("create team member"),k.ERROR_CODES.DB_QUERY_ERROR);if("true"===a.get("send_welcome_email")&&g)try{let{data:a}=await c.from("companies").select("name").eq("id",f.company_id).single(),b=a?.name||"the team",d=`${h} ${i}`;await (0,j.sendEmail)({to:g,subject:`Welcome to ${b}!`,text:`Hi ${d},

You've been added as a team member at ${b}. You can now log in to access your dashboard and start working.

Login here: http://localhost:3000/login

If you have any questions, please reach out to your team administrator.

Welcome aboard!`})}catch(a){console.error("Failed to send welcome email:",a)}return(0,e.revalidatePath)("/dashboard/settings/team"),(0,e.revalidatePath)("/dashboard/work/team"),z.id})}async function q(b){return(0,l.withErrorHandling)(async()=>{let c=await (0,m.createClient)();if(!c)throw new k.ActionError("Database connection failed",k.ERROR_CODES.DB_CONNECTION_ERROR);let{data:{user:d}}=await c.auth.getUser();(0,l.assertAuthenticated)(d?.id);let f=await (0,h.getActiveCompanyId)();if(!f)throw new k.ActionError("You must be part of a company",k.ERROR_CODES.AUTH_FORBIDDEN,403);let{data:g}=await c.from("company_memberships").select("company_id, user_id, status").eq("id",b).eq("company_id",f).single();if((0,l.assertExists)(g,"Team member"),g.user_id===d.id)throw new k.ActionError("You cannot suspend yourself",k.ERROR_CODES.BUSINESS_RULE_VIOLATION);if("suspended"===g.status)throw new k.ActionError("Team member is already suspended",k.ERROR_CODES.BUSINESS_RULE_VIOLATION);let{canDeleteTeamMember:i}=await a.A(395340),j=await i(b);if(j.success&&j.data&&!j.data.canDelete)throw new k.ActionError(j.data.reason||"Cannot suspend this team member",k.ERROR_CODES.BUSINESS_RULE_VIOLATION);let{error:n}=await c.from("company_memberships").update({status:"suspended"}).eq("id",b);if(n)throw new k.ActionError(k.ERROR_MESSAGES.operationFailed("suspend team member"),k.ERROR_CODES.DB_QUERY_ERROR);(0,e.revalidatePath)("/dashboard/settings/team"),(0,e.revalidatePath)("/dashboard/work/team"),(0,e.revalidatePath)(`/dashboard/work/team/${b}`)})}async function r(a){return(0,l.withErrorHandling)(async()=>{let b=await (0,m.createClient)();if(!b)throw new k.ActionError("Database connection failed",k.ERROR_CODES.DB_CONNECTION_ERROR);let{data:{user:c}}=await b.auth.getUser();(0,l.assertAuthenticated)(c?.id);let d=await (0,h.getActiveCompanyId)();if(!d)throw new k.ActionError("You must be part of a company",k.ERROR_CODES.AUTH_FORBIDDEN,403);let{data:f}=await b.from("company_memberships").select("company_id, status").eq("id",a).eq("company_id",d).single();if((0,l.assertExists)(f,"Team member"),"active"===f.status)throw new k.ActionError("Team member is already active",k.ERROR_CODES.BUSINESS_RULE_VIOLATION);let{error:g}=await b.from("company_memberships").update({status:"active"}).eq("id",a);if(g)throw new k.ActionError(k.ERROR_MESSAGES.operationFailed("activate team member"),k.ERROR_CODES.DB_QUERY_ERROR);(0,e.revalidatePath)("/dashboard/settings/team"),(0,e.revalidatePath)("/dashboard/work/team"),(0,e.revalidatePath)(`/dashboard/work/team/${a}`)})}async function s(b){return(0,l.withErrorHandling)(async()=>{let c=await (0,m.createClient)();if(!c)throw new k.ActionError("Database connection failed",k.ERROR_CODES.DB_CONNECTION_ERROR);let{data:{user:d}}=await c.auth.getUser();(0,l.assertAuthenticated)(d?.id);let f=await (0,h.getActiveCompanyId)();if(!f)throw new k.ActionError("You must be part of a company",k.ERROR_CODES.AUTH_FORBIDDEN,403);let{data:g}=await c.from("company_memberships").select("company_id, user_id").eq("id",b).eq("company_id",f).single();if((0,l.assertExists)(g,"Team member"),g.user_id===d.id)throw new k.ActionError("You cannot archive yourself",k.ERROR_CODES.BUSINESS_RULE_VIOLATION);let{canDeleteTeamMember:i}=await a.A(395340),j=await i(b);if(j.success&&j.data&&!j.data.canDelete)throw new k.ActionError(j.data.reason||"Cannot archive this team member",k.ERROR_CODES.BUSINESS_RULE_VIOLATION);let{error:n}=await c.from("company_memberships").update({archived_at:new Date().toISOString()}).eq("id",b);if(n)throw new k.ActionError(k.ERROR_MESSAGES.operationFailed("archive team member"),k.ERROR_CODES.DB_QUERY_ERROR);await c.from("activity_logs").insert({company_id:f,user_id:d.id,action_type:"team_member_archived",entity_type:"team_member",entity_id:b,metadata:{archived_by_name:(await c.from("profiles").select("full_name").eq("id",d.id).single()).data?.full_name||"Unknown"}}),(0,e.revalidatePath)("/dashboard/settings/team"),(0,e.revalidatePath)("/dashboard/work/team")})}async function t(a){return(0,l.withErrorHandling)(async()=>{let b=await (0,m.createClient)();if(!b)throw new k.ActionError("Database connection failed",k.ERROR_CODES.DB_CONNECTION_ERROR);let{data:{user:c}}=await b.auth.getUser();(0,l.assertAuthenticated)(c?.id);let d=await (0,h.getActiveCompanyId)();if(!d)throw new k.ActionError("You must be part of a company",k.ERROR_CODES.AUTH_FORBIDDEN,403);let f=await (0,i.isCompanyOwner)(b,c.id,d),g=await (0,i.hasRole)(b,c.id,"manager",d);if(!(f||g))throw new k.ActionError("Only owners and managers can restore team members",k.ERROR_CODES.AUTH_FORBIDDEN,403);let{data:j}=await b.from("company_memberships").select("company_id, user_id, archived_at").eq("id",a).eq("company_id",d).single();if((0,l.assertExists)(j,"Team member"),!j.archived_at)throw new k.ActionError("Team member is not archived",k.ERROR_CODES.BUSINESS_RULE_VIOLATION);let{error:n}=await b.from("company_memberships").update({archived_at:null}).eq("id",a);if(n)throw new k.ActionError(k.ERROR_MESSAGES.operationFailed("restore team member"),k.ERROR_CODES.DB_QUERY_ERROR);await b.from("activity_logs").insert({company_id:d,user_id:c.id,action_type:"team_member_restored",entity_type:"team_member",entity_id:a,metadata:{restored_by_name:(await b.from("profiles").select("name").eq("id",c.id).single()).data?.name||"Unknown"}}),(0,e.revalidatePath)("/dashboard/settings/team"),(0,e.revalidatePath)("/dashboard/work/team")})}async function u(a){return(0,l.withErrorHandling)(async()=>{let b=await (0,m.createClient)();if(!b)throw new k.ActionError("Database connection failed",k.ERROR_CODES.DB_CONNECTION_ERROR);let{data:{user:c}}=await b.auth.getUser();(0,l.assertAuthenticated)(c?.id);let d=await (0,h.getActiveCompanyId)();if(!d)throw new k.ActionError("You must be part of a company",k.ERROR_CODES.AUTH_FORBIDDEN,403);let e=await (0,i.isCompanyOwner)(b,c.id,d),f=await (0,i.hasRole)(b,c.id,"manager",d);if(!(e||f))throw new k.ActionError("Only owners and managers can reset passwords",k.ERROR_CODES.AUTH_FORBIDDEN,403);let{data:n}=await b.from("company_memberships").select("user_id, company_id").eq("id",a).eq("company_id",d).single();(0,l.assertExists)(n,"Team member");let{data:o}=await b.from("profiles").select("full_name, email").eq("id",n.user_id).single(),{data:p}=await b.from("profiles").select("full_name").eq("id",c.id).single(),{data:q}=await b.from("companies").select("name").eq("id",d).single();if(!o?.email)throw new k.ActionError("Team member email not found",k.ERROR_CODES.DB_RECORD_NOT_FOUND);let{data:r,error:s}=await b.auth.admin.generateLink({type:"recovery",email:o.email});if(s||!r?.properties?.action_link)throw new k.ActionError("Failed to generate password reset link",k.ERROR_CODES.INTERNAL_SERVER_ERROR);let t=await (0,j.sendEmail)({to:o.email,subject:`Password Reset - ${q?.name||"Your Account"}`,template:(0,g.PasswordResetTemplate)({teamMemberName:o.full_name||"Team Member",resetByName:p?.full_name||"Your Manager",resetLink:r.properties.action_link,companyName:q?.name||"Your Company",expiresInHours:24}),templateType:"password_reset",tags:[{name:"action",value:"password_reset"},{name:"initiated_by",value:c.id}]});if(!t.success)throw new k.ActionError(t.error||"Failed to send password reset email",k.ERROR_CODES.INTERNAL_SERVER_ERROR);await b.from("activity_logs").insert({company_id:d,user_id:c.id,action_type:"password_reset_sent",resource_type:"team_member",resource_id:a,metadata:{target_user_id:n.user_id,target_email:o.email}})})}async function v(a){return(0,l.withErrorHandling)(async()=>{let a=await (0,m.createClient)();if(!a)throw new k.ActionError("Database connection failed",k.ERROR_CODES.DB_CONNECTION_ERROR);let{data:{user:b}}=await a.auth.getUser();(0,l.assertAuthenticated)(b?.id);let c=await (0,h.getActiveCompanyId)();if(!c)return!1;let d=await (0,i.isCompanyOwner)(a,b.id,c),e=await (0,i.hasRole)(a,b.id,"manager",c),f=await (0,i.hasRole)(a,b.id,"admin",c);return d||e||f})}[j]=o.then?(await o)():o,f.z.object({email:f.z.string().email("Invalid email address"),firstName:f.z.string().min(1,"First name is required"),lastName:f.z.string().min(1,"Last name is required"),role:f.z.enum(["admin","manager","technician","dispatcher"],{message:"Role is required"}),department:f.z.string().optional()}),f.z.object({name:f.z.string().min(1,"Role name is required"),description:f.z.string().optional(),color:f.z.string().regex(/^#([0-9A-Fa-f]{6})$/,"Color must be a hex value").optional(),permissions:f.z.array(f.z.string()).min(1,"At least one permission is required")}),f.z.object({name:f.z.string().min(1,"Department name is required"),description:f.z.string().optional(),managerId:f.z.string().optional()}),(0,n.ensureServerEntryExports)([p,q,r,s,t,u,v]),(0,d.registerServerReference)(p,"405c2c08ccd5fdee1a83c53642640f8c2a029c2ad7",null),(0,d.registerServerReference)(q,"400c0855ffe936de380d5e592d535a452e7a73f3b2",null),(0,d.registerServerReference)(r,"406cd0821f31dc7d54f98797adea80832d2b6fc7ad",null),(0,d.registerServerReference)(s,"40524cbe26971606421e3b2852ce4718e5471453bf",null),(0,d.registerServerReference)(t,"40db9edb974b527ef5a25ed29961cced43f846c4bb",null),(0,d.registerServerReference)(u,"40c647699ded9d36de535e4e42a55b9acac0e87148",null),(0,d.registerServerReference)(v,"409d41a17fdc8c899628874dba4fba75b2147a6966",null),a.s(["activateTeamMember",()=>r,"archiveTeamMember",()=>s,"canManageTeamMember",()=>v,"createTeamMemberDirect",()=>p,"restoreTeamMember",()=>t,"sendPasswordResetEmail",()=>u,"suspendTeamMember",()=>q]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=apps_web_src_7bcbddd9._.js.map