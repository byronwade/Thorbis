{"version":3,"sources":["../../../../../../node_modules/.pnpm/%40vercel%2Boidc%403.0.5/node_modules/%40vercel/oidc/dist/token-error.js","../../../../../../node_modules/.pnpm/is-plain-obj%404.1.0/node_modules/is-plain-obj/index.js","../../../../../../apps/web/src/actions/onboarding-billing.ts","../../../../../../apps/web/src/lib/onboarding/onboarding-fees.ts","../../../../../../apps/web/src/lib/email/resend-domains.ts","../../../../../../apps/web/src/lib/email/domain-validation.ts","../../../../../../apps/web/src/lib/telnyx/porting.ts","../../../../../../apps/web/src/actions/phone-porting.ts","../../../../../../apps/web/.next-internal/server/app/%28dashboard%29/dashboard/welcome/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["\"use strict\";\nvar __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __export = (target, all) => {\n  for (var name in all)\n    __defProp(target, name, { get: all[name], enumerable: true });\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from))\n      if (!__hasOwnProp.call(to, key) && key !== except)\n        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n  }\n  return to;\n};\nvar __toCommonJS = (mod) => __copyProps(__defProp({}, \"__esModule\", { value: true }), mod);\nvar token_error_exports = {};\n__export(token_error_exports, {\n  VercelOidcTokenError: () => VercelOidcTokenError\n});\nmodule.exports = __toCommonJS(token_error_exports);\nclass VercelOidcTokenError extends Error {\n  constructor(message, cause) {\n    super(message);\n    this.name = \"VercelOidcTokenError\";\n    this.cause = cause;\n  }\n  toString() {\n    if (this.cause) {\n      return `${this.name}: ${this.message}: ${this.cause}`;\n    }\n    return `${this.name}: ${this.message}`;\n  }\n}\n// Annotate the CommonJS export names for ESM import in node:\n0 && (module.exports = {\n  VercelOidcTokenError\n});\n","export default function isPlainObject(value) {\n\tif (typeof value !== 'object' || value === null) {\n\t\treturn false;\n\t}\n\n\tconst prototype = Object.getPrototypeOf(value);\n\treturn (prototype === null || prototype === Object.prototype || Object.getPrototypeOf(prototype) === null) && !(Symbol.toStringTag in value) && !(Symbol.iterator in value);\n}\n","\"use server\";\n\n/**\n * Onboarding Billing Actions\n *\n * Server actions for Stripe payment collection during onboarding.\n * Handles checkout session creation and post-checkout processing.\n */\n\nimport Stripe from \"stripe\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport {\n\tbuildStripeSubscriptionItems,\n\tbuildOneTimeChargesLineItems,\n\tSTRIPE_PRICE_IDS,\n\tvalidateStripePriceIds,\n\ttype OnboardingBillingSelections,\n} from \"@/lib/onboarding/onboarding-fees\";\n\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, {\n\tapiVersion: \"2024-11-20.acacia\",\n});\n\ninterface CheckoutSessionParams {\n\tcompanyId: string;\n\tteamMemberId: string;\n\tselections: OnboardingBillingSelections;\n\tsuccessUrl: string;\n\tcancelUrl: string;\n}\n\ninterface CheckoutSessionResult {\n\tsuccess: boolean;\n\tcheckoutUrl?: string;\n\tsessionId?: string;\n\terror?: string;\n}\n\n/**\n * Create Stripe Checkout session for onboarding payment collection\n *\n * Features:\n * - 14-day free trial\n * - Subscription with multiple line items\n * - One-time charges for setup fees\n * - Support for card and ACH payments\n * - Metadata for tracking\n *\n * @param params - Checkout session parameters\n * @returns Checkout URL or error\n */\nexport async function createOnboardingCheckoutSession(\n\tparams: CheckoutSessionParams\n): Promise<CheckoutSessionResult> {\n\ttry {\n\t\t// Validate Stripe price IDs are configured\n\t\tconst validation = validateStripePriceIds();\n\t\tif (!validation.isValid) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: `Missing Stripe configuration: ${validation.missing.join(\", \")}`,\n\t\t\t};\n\t\t}\n\n\t\tconst supabase = await createClient();\n\n\t\t// Get company and team member info\n\t\tconst { data: company, error: companyError } = await supabase\n\t\t\t.from(\"companies\")\n\t\t\t.select(\"id, name, email\")\n\t\t\t.eq(\"id\", params.companyId)\n\t\t\t.single();\n\n\t\tif (companyError || !company) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Company not found\",\n\t\t\t};\n\t\t}\n\n\t\t// Check if company already has a Stripe customer ID\n\t\tlet customerId = company.stripe_customer_id;\n\n\t\t// Create Stripe customer if needed\n\t\tif (!customerId) {\n\t\t\tconst customer = await stripe.customers.create({\n\t\t\t\temail: company.email || undefined,\n\t\t\t\tname: company.name,\n\t\t\t\tmetadata: {\n\t\t\t\t\tcompany_id: params.companyId,\n\t\t\t\t\tteam_member_id: params.teamMemberId,\n\t\t\t\t\tsource: \"onboarding\",\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tcustomerId = customer.id;\n\n\t\t\t// Save customer ID to database\n\t\t\tawait supabase\n\t\t\t\t.from(\"companies\")\n\t\t\t\t.update({ stripe_customer_id: customerId })\n\t\t\t\t.eq(\"id\", params.companyId);\n\t\t}\n\n\t\t// Build subscription items (recurring charges)\n\t\tconst subscriptionItems = buildStripeSubscriptionItems(params.selections);\n\n\t\t// Build one-time charges (porting + setup fees)\n\t\tconst oneTimeCharges = buildOneTimeChargesLineItems(params.selections);\n\n\t\t// Calculate trial end date (14 days from now)\n\t\tconst trialEnd = Math.floor(Date.now() / 1000) + 14 * 24 * 60 * 60;\n\n\t\t// Combine subscription items and one-time charges\n\t\tconst allLineItems = [\n\t\t\t...subscriptionItems.map((item) => ({\n\t\t\t\tprice: item.price,\n\t\t\t\tquantity: item.quantity || 1,\n\t\t\t})),\n\t\t\t...oneTimeCharges.map((item) => ({\n\t\t\t\tprice: item.price,\n\t\t\t\tquantity: item.quantity || 1,\n\t\t\t})),\n\t\t];\n\n\t\t// Create Stripe Checkout session\n\t\tconst session = await stripe.checkout.sessions.create({\n\t\t\tcustomer: customerId,\n\t\t\tmode: \"subscription\",\n\t\t\tpayment_method_types: [\"card\", \"us_bank_account\"],\n\n\t\t\t// All line items (recurring + one-time)\n\t\t\tline_items: allLineItems,\n\n\t\t\tsubscription_data: {\n\t\t\t\ttrial_end: trialEnd,\n\t\t\t\tmetadata: {\n\t\t\t\t\tcompany_id: params.companyId,\n\t\t\t\t\tteam_member_id: params.teamMemberId,\n\t\t\t\t\tphone_porting_count: params.selections.phonePortingCount.toString(),\n\t\t\t\t\tnew_phone_count: params.selections.newPhoneNumberCount.toString(),\n\t\t\t\t\tgmail_users: params.selections.gmailWorkspaceUsers.toString(),\n\t\t\t\t\tprofit_rhino: params.selections.profitRhinoEnabled.toString(),\n\t\t\t\t},\n\t\t\t},\n\n\t\t\tmetadata: {\n\t\t\t\tcompany_id: params.companyId,\n\t\t\t\tteam_member_id: params.teamMemberId,\n\t\t\t\tsource: \"onboarding\",\n\t\t\t},\n\n\t\t\tsuccess_url: params.successUrl,\n\t\t\tcancel_url: params.cancelUrl,\n\n\t\t\t// Collect billing address\n\t\t\tbilling_address_collection: \"required\",\n\n\t\t\t// Allow promotion codes\n\t\t\tallow_promotion_codes: true,\n\t\t});\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tcheckoutUrl: session.url || undefined,\n\t\t\tsessionId: session.id,\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Error creating checkout session:\", error);\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror:\n\t\t\t\terror instanceof Error\n\t\t\t\t\t? error.message\n\t\t\t\t\t: \"Failed to create checkout session\",\n\t\t};\n\t}\n}\n\ninterface CheckoutSuccessParams {\n\tsessionId: string;\n\tcompanyId: string;\n}\n\ninterface CheckoutSuccessResult {\n\tsuccess: boolean;\n\tsubscriptionId?: string;\n\tcustomerId?: string;\n\terror?: string;\n}\n\n/**\n * Handle successful checkout - save payment details to database\n *\n * Called after Stripe Checkout completes successfully.\n * Updates company record with subscription and payment info.\n *\n * @param params - Session ID and company ID\n * @returns Success status with subscription details\n */\nexport async function handleCheckoutSuccess(\n\tparams: CheckoutSuccessParams\n): Promise<CheckoutSuccessResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Retrieve checkout session from Stripe\n\t\tconst session = await stripe.checkout.sessions.retrieve(params.sessionId, {\n\t\t\texpand: [\"subscription\", \"customer\"],\n\t\t});\n\n\t\tif (!session.subscription) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"No subscription found in checkout session\",\n\t\t\t};\n\t\t}\n\n\t\tconst subscription =\n\t\t\ttypeof session.subscription === \"string\"\n\t\t\t\t? await stripe.subscriptions.retrieve(session.subscription)\n\t\t\t\t: session.subscription;\n\n\t\tconst customerId =\n\t\t\ttypeof session.customer === \"string\"\n\t\t\t\t? session.customer\n\t\t\t\t: session.customer?.id;\n\n\t\t// Calculate trial end date\n\t\tconst trialEnd = subscription.trial_end\n\t\t\t? new Date(subscription.trial_end * 1000).toISOString()\n\t\t\t: null;\n\n\t\t// Update company with subscription details\n\t\tconst { error: updateError } = await supabase\n\t\t\t.from(\"companies\")\n\t\t\t.update({\n\t\t\t\tstripe_customer_id: customerId,\n\t\t\t\tstripe_subscription_id: subscription.id,\n\t\t\t\tstripe_subscription_status: subscription.status,\n\t\t\t\ttrial_ends_at: trialEnd,\n\t\t\t\tpayment_method_collected: true,\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", params.companyId);\n\n\t\tif (updateError) {\n\t\t\tconsole.error(\"Error updating company:\", updateError);\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Failed to save subscription details\",\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tsubscriptionId: subscription.id,\n\t\t\tcustomerId: customerId || undefined,\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Error handling checkout success:\", error);\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror:\n\t\t\t\terror instanceof Error\n\t\t\t\t\t? error.message\n\t\t\t\t\t: \"Failed to process checkout success\",\n\t\t};\n\t}\n}\n\n/**\n * Get checkout session status\n *\n * Checks if a checkout session was completed successfully.\n * Used on the success page to verify payment.\n *\n * @param sessionId - Stripe checkout session ID\n * @returns Session status and details\n */\nexport async function getCheckoutSessionStatus(sessionId: string) {\n\ttry {\n\t\tconst session = await stripe.checkout.sessions.retrieve(sessionId);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tstatus: session.payment_status,\n\t\t\tcompleted: session.payment_status === \"paid\",\n\t\t\tsubscriptionId:\n\t\t\t\ttypeof session.subscription === \"string\"\n\t\t\t\t\t? session.subscription\n\t\t\t\t\t: session.subscription?.id,\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Error retrieving session status:\", error);\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror:\n\t\t\t\terror instanceof Error\n\t\t\t\t\t? error.message\n\t\t\t\t\t: \"Failed to retrieve session status\",\n\t\t};\n\t}\n}\n","/**\n * Onboarding Fees & Pricing Configuration\n *\n * Defines all fees, add-on pricing, and cost calculations for the onboarding flow.\n * Used to calculate upfront costs and monthly recurring charges based on\n * contractor selections during onboarding.\n *\n * Pricing Structure:\n * - Phone Porting: $15 one-time per number\n * - New Phone Number: $5 one-time + $2/month per number\n * - Gmail Workspace: $6/user/month (Google Workspace passthrough)\n * - Profit Rhino: $149/month (flat rate add-on)\n * - Base Platform: $200/month (existing)\n *\n * Payment Flow:\n * 1. Collect payment method during onboarding\n * 2. Start 14-day free trial\n * 3. Charge upfront fees immediately (porting + new number setup)\n * 4. Charge monthly fees at end of trial (recurring charges)\n *\n * @see /docs/billing/ONBOARDING_PAYMENT_FLOW.md\n */\n\n// =============================================================================\n// ONE-TIME FEES\n// =============================================================================\n\n/**\n * Phone number porting fee (per number)\n * One-time charge when contractor ports existing phone number from another carrier\n */\nexport const PHONE_PORTING_FEE = 15.0;\n\n/**\n * New phone number setup fee (per number)\n * One-time charge when contractor gets a new phone number from Telnyx\n */\nexport const PHONE_NEW_NUMBER_SETUP_FEE = 5.0;\n\n// =============================================================================\n// MONTHLY RECURRING FEES\n// =============================================================================\n\n/**\n * Base platform fee (per company)\n * Includes: CRM, scheduling, unlimited users, base communication features\n */\nexport const BASE_PLATFORM_FEE = 200.0;\n\n/**\n * New phone number monthly fee (per number)\n * Recurring charge for each phone number provisioned through Telnyx\n */\nexport const PHONE_NEW_NUMBER_MONTHLY_FEE = 2.0;\n\n/**\n * Gmail Workspace fee (per user per month)\n * Passthrough of Google Workspace Business Starter cost ($6/user/month)\n * Includes: Gmail, Google Drive (30GB), Calendar, Meet\n */\nexport const GMAIL_WORKSPACE_PER_USER_FEE = 6.0;\n\n/**\n * Profit Rhino flat rate pricing add-on (per month)\n * Customer financing platform with prebuilt price books\n * Includes: Flat rate price book, quarterly updates, financing options\n *\n * @see https://profitrhino.com/\n */\nexport const PROFIT_RHINO_MONTHLY_FEE = 149.0;\n\n// =============================================================================\n// STRIPE PRICE ID MAPPINGS\n// =============================================================================\n\n/**\n * Stripe Price IDs for onboarding charges\n * These must match the price IDs created in Stripe Dashboard\n *\n * To create these prices:\n * 1. Go to Stripe Dashboard â†’ Products\n * 2. Create products for each item below\n * 3. Create prices (one-time or recurring as noted)\n * 4. Copy price IDs and set in environment variables\n * 5. Update this mapping\n *\n * @see /docs/billing/STRIPE_SETUP.md\n */\nexport const STRIPE_PRICE_IDS = {\n\t// One-time charges\n\tPHONE_PORTING: process.env.STRIPE_PRICE_ID_PHONE_PORTING || \"\",\n\tPHONE_NEW_NUMBER_SETUP:\n\t\tprocess.env.STRIPE_PRICE_ID_PHONE_NEW_NUMBER_SETUP || \"\",\n\n\t// Monthly recurring charges\n\tBASE_PLAN: process.env.STRIPE_PRICE_ID_BASE_PLAN || \"\",\n\tPHONE_NEW_NUMBER_MONTHLY:\n\t\tprocess.env.STRIPE_PRICE_ID_PHONE_NEW_NUMBER_MONTHLY || \"\",\n\tGMAIL_WORKSPACE_PER_USER:\n\t\tprocess.env.STRIPE_PRICE_ID_GMAIL_WORKSPACE_PER_USER || \"\",\n\tPROFIT_RHINO: process.env.STRIPE_PRICE_ID_PROFIT_RHINO || \"\",\n} as const;\n\n// =============================================================================\n// TYPES\n// =============================================================================\n\n/**\n * Onboarding selections that affect billing\n */\nexport interface OnboardingBillingSelections {\n\t/** Number of phone numbers being ported from another carrier */\n\tphonePortingCount: number;\n\n\t/** Number of new phone numbers being purchased */\n\tnewPhoneNumberCount: number;\n\n\t/** Number of users who need Gmail Workspace access */\n\tgmailWorkspaceUsers: number;\n\n\t/** Whether Profit Rhino financing add-on is enabled */\n\tprofitRhinoEnabled: boolean;\n}\n\n/**\n * Calculated costs breakdown\n */\nexport interface OnboardingCostBreakdown {\n\t/** One-time upfront charges (charged immediately) */\n\toneTime: {\n\t\tphonePorting: number;\n\t\tphoneSetup: number;\n\t\ttotal: number;\n\t};\n\n\t/** Monthly recurring charges (charged after 14-day trial) */\n\tmonthly: {\n\t\tbasePlatform: number;\n\t\tphoneNumbers: number;\n\t\tgmailWorkspace: number;\n\t\tprofitRhino: number;\n\t\ttotal: number;\n\t};\n\n\t/** Grand total of first month (upfront + monthly after trial) */\n\tfirstMonthTotal: number;\n}\n\n/**\n * Stripe subscription items for onboarding\n */\nexport interface StripeSubscriptionItem {\n\tprice: string; // Stripe price ID\n\tquantity?: number; // For per-user or per-number charges\n}\n\n// =============================================================================\n// COST CALCULATION FUNCTIONS\n// =============================================================================\n\n/**\n * Calculate all onboarding costs based on contractor selections\n *\n * @param selections - Contractor's choices during onboarding\n * @returns Detailed cost breakdown\n *\n * @example\n * const selections = {\n *   phonePortingCount: 1,\n *   newPhoneNumberCount: 1,\n *   gmailWorkspaceUsers: 5,\n *   profitRhinoEnabled: true\n * };\n *\n * const costs = calculateOnboardingCosts(selections);\n * console.log(costs.oneTime.total); // $20 ($15 porting + $5 setup)\n * console.log(costs.monthly.total); // $381 ($200 + $2 + $30 + $149)\n */\nexport function calculateOnboardingCosts(\n\tselections: OnboardingBillingSelections\n): OnboardingCostBreakdown {\n\t// Calculate one-time charges\n\tconst phonePortingCost =\n\t\tselections.phonePortingCount * PHONE_PORTING_FEE;\n\tconst phoneSetupCost =\n\t\tselections.newPhoneNumberCount * PHONE_NEW_NUMBER_SETUP_FEE;\n\tconst oneTimeTotal = phonePortingCost + phoneSetupCost;\n\n\t// Calculate monthly recurring charges\n\tconst basePlatformCost = BASE_PLATFORM_FEE;\n\tconst phoneNumbersMonthlyCost =\n\t\tselections.newPhoneNumberCount * PHONE_NEW_NUMBER_MONTHLY_FEE;\n\tconst gmailWorkspaceCost =\n\t\tselections.gmailWorkspaceUsers * GMAIL_WORKSPACE_PER_USER_FEE;\n\tconst profitRhinoCost = selections.profitRhinoEnabled\n\t\t? PROFIT_RHINO_MONTHLY_FEE\n\t\t: 0;\n\tconst monthlyTotal =\n\t\tbasePlatformCost +\n\t\tphoneNumbersMonthlyCost +\n\t\tgmailWorkspaceCost +\n\t\tprofitRhinoCost;\n\n\t// Grand total for first month (upfront + first month after trial)\n\tconst firstMonthTotal = oneTimeTotal + monthlyTotal;\n\n\treturn {\n\t\toneTime: {\n\t\t\tphonePorting: phonePortingCost,\n\t\t\tphoneSetup: phoneSetupCost,\n\t\t\ttotal: oneTimeTotal,\n\t\t},\n\t\tmonthly: {\n\t\t\tbasePlatform: basePlatformCost,\n\t\t\tphoneNumbers: phoneNumbersMonthlyCost,\n\t\t\tgmailWorkspace: gmailWorkspaceCost,\n\t\t\tprofitRhino: profitRhinoCost,\n\t\t\ttotal: monthlyTotal,\n\t\t},\n\t\tfirstMonthTotal,\n\t};\n}\n\n/**\n * Build Stripe subscription items array for onboarding checkout\n *\n * Creates the subscription items array needed for Stripe Checkout Session\n * or Subscription creation, including base plan and all selected add-ons.\n *\n * @param selections - Contractor's onboarding selections\n * @returns Array of Stripe subscription items\n *\n * @example\n * const selections = {\n *   phonePortingCount: 0,\n *   newPhoneNumberCount: 2,\n *   gmailWorkspaceUsers: 5,\n *   profitRhinoEnabled: true\n * };\n *\n * const items = buildStripeSubscriptionItems(selections);\n * // Returns:\n * // [\n * //   { price: 'price_base_plan', quantity: 1 },\n * //   { price: 'price_phone_monthly', quantity: 2 },\n * //   { price: 'price_gmail_per_user', quantity: 5 },\n * //   { price: 'price_profit_rhino', quantity: 1 }\n * // ]\n */\nexport function buildStripeSubscriptionItems(\n\tselections: OnboardingBillingSelections\n): StripeSubscriptionItem[] {\n\tconst items: StripeSubscriptionItem[] = [];\n\n\t// Base platform (always included)\n\titems.push({\n\t\tprice: STRIPE_PRICE_IDS.BASE_PLAN,\n\t\tquantity: 1,\n\t});\n\n\t// New phone numbers (monthly recurring)\n\tif (selections.newPhoneNumberCount > 0) {\n\t\titems.push({\n\t\t\tprice: STRIPE_PRICE_IDS.PHONE_NEW_NUMBER_MONTHLY,\n\t\t\tquantity: selections.newPhoneNumberCount,\n\t\t});\n\t}\n\n\t// Gmail Workspace users\n\tif (selections.gmailWorkspaceUsers > 0) {\n\t\titems.push({\n\t\t\tprice: STRIPE_PRICE_IDS.GMAIL_WORKSPACE_PER_USER,\n\t\t\tquantity: selections.gmailWorkspaceUsers,\n\t\t});\n\t}\n\n\t// Profit Rhino add-on\n\tif (selections.profitRhinoEnabled) {\n\t\titems.push({\n\t\t\tprice: STRIPE_PRICE_IDS.PROFIT_RHINO,\n\t\t\tquantity: 1,\n\t\t});\n\t}\n\n\treturn items;\n}\n\n/**\n * Build Stripe line items for one-time charges\n *\n * Creates line items array for one-time charges (porting, setup fees)\n * that should be invoiced immediately, separate from the subscription.\n *\n * @param selections - Contractor's onboarding selections\n * @returns Array of Stripe line items for one-time charges\n *\n * @example\n * const selections = {\n *   phonePortingCount: 1,\n *   newPhoneNumberCount: 1,\n *   gmailWorkspaceUsers: 0,\n *   profitRhinoEnabled: false\n * };\n *\n * const lineItems = buildOneTimeChargesLineItems(selections);\n * // Returns:\n * // [\n * //   { price: 'price_porting', quantity: 1 },\n * //   { price: 'price_phone_setup', quantity: 1 }\n * // ]\n */\nexport function buildOneTimeChargesLineItems(\n\tselections: OnboardingBillingSelections\n): StripeSubscriptionItem[] {\n\tconst lineItems: StripeSubscriptionItem[] = [];\n\n\t// Phone porting fees\n\tif (selections.phonePortingCount > 0) {\n\t\tlineItems.push({\n\t\t\tprice: STRIPE_PRICE_IDS.PHONE_PORTING,\n\t\t\tquantity: selections.phonePortingCount,\n\t\t});\n\t}\n\n\t// New phone number setup fees\n\tif (selections.newPhoneNumberCount > 0) {\n\t\tlineItems.push({\n\t\t\tprice: STRIPE_PRICE_IDS.PHONE_NEW_NUMBER_SETUP,\n\t\t\tquantity: selections.newPhoneNumberCount,\n\t\t});\n\t}\n\n\treturn lineItems;\n}\n\n/**\n * Format cost as USD currency string\n *\n * @param amount - Amount in dollars\n * @returns Formatted string (e.g., \"$123.45\")\n *\n * @example\n * formatCurrency(123.45); // \"$123.45\"\n * formatCurrency(0); // \"$0.00\"\n * formatCurrency(1234.5); // \"$1,234.50\"\n */\nexport function formatCurrency(amount: number): string {\n\treturn new Intl.NumberFormat(\"en-US\", {\n\t\tstyle: \"currency\",\n\t\tcurrency: \"USD\",\n\t\tminimumFractionDigits: 2,\n\t\tmaximumFractionDigits: 2,\n\t}).format(amount);\n}\n\n/**\n * Validate that all required Stripe price IDs are configured\n *\n * Checks environment variables to ensure all necessary Stripe prices\n * are set before attempting to create checkout sessions.\n *\n * @returns Object with validation result and missing price IDs\n *\n * @example\n * const validation = validateStripePriceIds();\n * if (!validation.isValid) {\n *   console.error('Missing price IDs:', validation.missing);\n * }\n */\nexport function validateStripePriceIds(): {\n\tisValid: boolean;\n\tmissing: string[];\n} {\n\tconst missing: string[] = [];\n\n\tif (!STRIPE_PRICE_IDS.PHONE_PORTING)\n\t\tmissing.push(\"STRIPE_PRICE_ID_PHONE_PORTING\");\n\tif (!STRIPE_PRICE_IDS.PHONE_NEW_NUMBER_SETUP)\n\t\tmissing.push(\"STRIPE_PRICE_ID_PHONE_NEW_NUMBER_SETUP\");\n\tif (!STRIPE_PRICE_IDS.BASE_PLAN)\n\t\tmissing.push(\"STRIPE_PRICE_ID_BASE_PLAN\");\n\tif (!STRIPE_PRICE_IDS.PHONE_NEW_NUMBER_MONTHLY)\n\t\tmissing.push(\"STRIPE_PRICE_ID_PHONE_NEW_NUMBER_MONTHLY\");\n\tif (!STRIPE_PRICE_IDS.GMAIL_WORKSPACE_PER_USER)\n\t\tmissing.push(\"STRIPE_PRICE_ID_GMAIL_WORKSPACE_PER_USER\");\n\tif (!STRIPE_PRICE_IDS.PROFIT_RHINO)\n\t\tmissing.push(\"STRIPE_PRICE_ID_PROFIT_RHINO\");\n\n\treturn {\n\t\tisValid: missing.length === 0,\n\t\tmissing,\n\t};\n}\n","\"use server\";\n\nimport crypto from \"node:crypto\";\nimport {\n\tvalidateDomain,\n\tgeneratePlatformSubdomain,\n\tgetDomainConfig,\n\tcanRegisterMoreDomains,\n\tsuggestSubdomains,\n\ttype DomainValidationResult,\n} from \"./domain-validation\";\n\nconst RESEND_API_BASE = \"https://api.resend.com\";\n\ntype ResendResponse<T> =\n\t| { success: true; data: T }\n\t| { success: false; error: string };\n\ninterface ResendDomainData {\n\tid: string;\n\tname: string;\n\tstatus: string;\n\tregion: string;\n\trecords: Array<{\n\t\ttype: string;\n\t\tname: string;\n\t\tvalue: string;\n\t\tpriority?: number;\n\t\tttl?: string;\n\t}>;\n\tcreated_at: string;\n}\n\ninterface ResendInboundRouteData {\n\tid: string;\n\tname: string;\n\trecipients: string[];\n\turl: string;\n\tenabled: boolean;\n\tcreated_at: string;\n}\n\nasync function resendRequest<T>(\n\tpath: string,\n\tinit: RequestInit\n): Promise<ResendResponse<T>> {\n\tconst apiKey = process.env.RESEND_API_KEY;\n\tif (!apiKey) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: \"Resend API key is not configured\",\n\t\t};\n\t}\n\n\tconst response = await fetch(`${RESEND_API_BASE}${path}`, {\n\t\t...init,\n\t\theaders: {\n\t\t\tAuthorization: `Bearer ${apiKey}`,\n\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t...init.headers,\n\t\t},\n\t});\n\n\tif (!response.ok) {\n\t\tconst message =\n\t\t\t(await response.json().catch(() => null))?.message || response.statusText;\n\t\treturn { success: false, error: message };\n\t}\n\n\tconst data = (await response.json().catch(() => ({}))) as T;\n\treturn { success: true, data };\n}\n\n/**\n * Validate and create a Resend domain\n */\nexport async function createResendDomainWithValidation(params: {\n\tdomain: string;\n\tcurrentDomainCount: number;\n\tcompanySlug: string;\n}): Promise<\n\tResendResponse<ResendDomainData> & {\n\t\tvalidation?: DomainValidationResult;\n\t\tsuggestions?: string[];\n\t}\n> {\n\tconst { domain, currentDomainCount } = params;\n\n\t// Check if company can register more domains\n\tconst canRegister = canRegisterMoreDomains(currentDomainCount);\n\tif (!canRegister.allowed) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: canRegister.reason || \"Cannot register more domains\",\n\t\t};\n\t}\n\n\t// Validate the domain\n\tconst validation = validateDomain(domain);\n\tif (!validation.valid) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: validation.error || \"Invalid domain\",\n\t\t\tvalidation,\n\t\t};\n\t}\n\n\t// Create domain in Resend\n\tconst result = await resendRequest<ResendDomainData>(\"/domains\", {\n\t\tmethod: \"POST\",\n\t\tbody: JSON.stringify({ name: validation.normalizedDomain }),\n\t});\n\n\treturn {\n\t\t...result,\n\t\tvalidation,\n\t};\n}\n\n/**\n * Create a Resend domain (basic, without validation - for internal use)\n */\nexport async function createResendDomain(name: string) {\n\treturn resendRequest<ResendDomainData>(\"/domains\", {\n\t\tmethod: \"POST\",\n\t\tbody: JSON.stringify({ name }),\n\t});\n}\n\n/**\n * Get domain details from Resend\n */\nexport async function getResendDomain(domainId: string) {\n\treturn resendRequest<ResendDomainData>(`/domains/${domainId}`, {\n\t\tmethod: \"GET\",\n\t});\n}\n\n/**\n * Trigger domain verification in Resend\n */\nexport async function verifyResendDomain(domainId: string) {\n\treturn resendRequest<ResendDomainData>(`/domains/${domainId}/verify`, {\n\t\tmethod: \"POST\",\n\t});\n}\n\n/**\n * Delete a domain from Resend\n */\nexport async function deleteResendDomain(domainId: string) {\n\treturn resendRequest<void>(`/domains/${domainId}`, {\n\t\tmethod: \"DELETE\",\n\t});\n}\n\n/**\n * List all domains in Resend account\n */\nexport async function listResendDomains() {\n\treturn resendRequest<{ data: ResendDomainData[] }>(\"/domains\", {\n\t\tmethod: \"GET\",\n\t});\n}\n\n/**\n * Create an inbound email route\n */\nexport async function createInboundRoute(params: {\n\tname: string;\n\trecipients: string[];\n\turl: string;\n}) {\n\treturn resendRequest<ResendInboundRouteData>(\"/inbound\", {\n\t\tmethod: \"POST\",\n\t\tbody: JSON.stringify(params),\n\t});\n}\n\n/**\n * Delete an inbound route\n */\nexport async function deleteInboundRoute(routeId: string) {\n\treturn resendRequest<void>(`/inbound/${routeId}`, {\n\t\tmethod: \"DELETE\",\n\t});\n}\n\n/**\n * List all inbound routes\n */\nexport async function listInboundRoutes() {\n\treturn resendRequest<{ data: ResendInboundRouteData[] }>(\"/inbound\", {\n\t\tmethod: \"GET\",\n\t});\n}\n\n/**\n * Get domain metrics from Resend (for deliverability monitoring)\n */\nexport async function getResendDomainMetrics(domainId: string) {\n\t// Resend doesn't have a direct metrics endpoint per domain\n\t// We track metrics in our database via webhook events\n\treturn resendRequest<any>(`/domains/${domainId}`, {\n\t\tmethod: \"GET\",\n\t});\n}\n\n/**\n * Verify Resend webhook signature (Svix)\n */\nexport async function verifyResendWebhookSignature({\n\tpayload,\n\theaders,\n}: {\n\tpayload: string;\n\theaders: {\n\t\tsvixId?: string;\n\t\tsvixTimestamp?: string;\n\t\tsvixSignature?: string;\n\t};\n}): Promise<boolean> {\n\tconst secret = process.env.RESEND_WEBHOOK_SECRET;\n\tconst { svixId, svixTimestamp, svixSignature } = headers;\n\n\tif (!secret || !svixId || !svixTimestamp || !svixSignature) {\n\t\treturn false;\n\t}\n\n\t// Svix signature format: v1,<base64_signature>\n\tconst signatures = svixSignature.split(\" \");\n\tconst signedPayload = `${svixId}.${svixTimestamp}.${payload}`;\n\n\t// Try to decode the secret (Svix uses whsec_ prefix)\n\tconst secretBytes = secret.startsWith(\"whsec_\")\n\t\t? Buffer.from(secret.slice(6), \"base64\")\n\t\t: Buffer.from(secret);\n\n\tconst computed = crypto\n\t\t.createHmac(\"sha256\", secretBytes)\n\t\t.update(signedPayload)\n\t\t.digest(\"base64\");\n\n\t// Check against all provided signatures\n\tfor (const sig of signatures) {\n\t\tconst [version, expectedSig] = sig.split(\",\");\n\t\tif (version === \"v1\" && expectedSig === computed) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\n// =============================================================================\n// RECEIVED EMAIL FUNCTIONS (Inbound)\n// =============================================================================\n\ninterface ReceivedEmailData {\n\tid: string;\n\tfrom: string;\n\tto: string[];\n\tsubject: string;\n\ttext?: string;\n\thtml?: string;\n\tcreated_at: string;\n\tattachments?: { id: string; filename: string; content_type: string }[];\n}\n\ninterface ReceivedAttachmentData {\n\tid: string;\n\tfilename: string;\n\tcontent_type: string;\n\tcontent: string; // base64 encoded\n}\n\n/**\n * Get a received email by ID\n */\nexport async function getReceivedEmail(\n\temailId: string\n): Promise<ResendResponse<ReceivedEmailData>> {\n\treturn resendRequest<ReceivedEmailData>(`/emails/${emailId}`, {\n\t\tmethod: \"GET\",\n\t});\n}\n\n/**\n * List attachments for a received email\n */\nexport async function listReceivedEmailAttachments(\n\temailId: string\n): Promise<ResendResponse<{ data: ReceivedAttachmentData[] }>> {\n\treturn resendRequest<{ data: ReceivedAttachmentData[] }>(\n\t\t`/emails/${emailId}/attachments`,\n\t\t{ method: \"GET\" }\n\t);\n}\n\n/**\n * Get a specific attachment from a received email\n */\nexport async function getReceivedEmailAttachment(\n\temailId: string,\n\tattachmentId: string\n): Promise<ResendResponse<ReceivedAttachmentData>> {\n\treturn resendRequest<ReceivedAttachmentData>(\n\t\t`/emails/${emailId}/attachments/${attachmentId}`,\n\t\t{ method: \"GET\" }\n\t);\n}\n\n/**\n * Verify DNS records for a domain (for onboarding tracker)\n */\nexport async function verifyDomainDNS(domain: string): Promise<{\n\tsuccess: boolean;\n\trecords: Array<{\n\t\tid: string;\n\t\ttype: string;\n\t\tname: string;\n\t\tvalue: string;\n\t\tpurpose: string;\n\t\tverified: boolean;\n\t}>;\n\terror?: string;\n}> {\n\ttry {\n\t\t// First, get all domains to find the one matching our domain\n\t\tconst listResult = await listResendDomains();\n\n\t\tif (!listResult.success || !listResult.data) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\trecords: [],\n\t\t\t\terror: \"Failed to fetch domains from Resend\",\n\t\t\t};\n\t\t}\n\n\t\t// Find the domain by name\n\t\tconst domainData = listResult.data.data?.find((d) => d.name === domain);\n\n\t\tif (!domainData) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\trecords: [],\n\t\t\t\terror: `Domain ${domain} not found in Resend`,\n\t\t\t};\n\t\t}\n\n\t\t// Trigger verification\n\t\tawait verifyResendDomain(domainData.id);\n\n\t\t// Get fresh domain data after verification\n\t\tconst verifyResult = await getResendDomain(domainData.id);\n\n\t\tif (!verifyResult.success || !verifyResult.data) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\trecords: [],\n\t\t\t\terror: \"Failed to verify domain\",\n\t\t\t};\n\t\t}\n\n\t\t// Format records for the tracker\n\t\tconst records = (verifyResult.data.records || []).map((record, index) => ({\n\t\t\tid: `${record.type.toLowerCase()}-${index}`,\n\t\t\ttype: record.type,\n\t\t\tname: record.name,\n\t\t\tvalue: record.value,\n\t\t\tpurpose: getPurposeLabel(record.type),\n\t\t\tverified: verifyResult.data.status === \"verified\",\n\t\t}));\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\trecords,\n\t\t};\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\trecords: [],\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t};\n\t}\n}\n\n/**\n * Get purpose label for DNS record type\n */\nfunction getPurposeLabel(type: string): string {\n\tconst purposes: Record<string, string> = {\n\t\tTXT: \"SPF - Authorizes sending\",\n\t\tCNAME: \"DKIM - Email signing\",\n\t\tMX: \"Email routing\",\n\t\tDMARC: \"DMARC - Policy\",\n\t};\n\treturn purposes[type] || \"Email authentication\";\n}\n\n// Re-export validation utilities for convenience\nexport {\n\tvalidateDomain,\n\tgeneratePlatformSubdomain,\n\tgetDomainConfig,\n\tcanRegisterMoreDomains,\n\tsuggestSubdomains,\n\ttype DomainValidationResult,\n};\n","/**\n * Domain Validation Utilities for Multi-Tenant Email System\n *\n * Features:\n * - Subdomain enforcement for reputation isolation\n * - Domain ownership validation\n * - Blocked domain detection (public email providers)\n * - Tier-based domain allocation\n */\n\n// Blocked domains - public email providers that shouldn't be registered\nconst BLOCKED_DOMAINS = new Set([\n\t// Major providers\n\t\"gmail.com\",\n\t\"yahoo.com\",\n\t\"hotmail.com\",\n\t\"outlook.com\",\n\t\"live.com\",\n\t\"msn.com\",\n\t\"aol.com\",\n\t\"icloud.com\",\n\t\"me.com\",\n\t\"mac.com\",\n\t// Other common providers\n\t\"protonmail.com\",\n\t\"proton.me\",\n\t\"zoho.com\",\n\t\"mail.com\",\n\t\"gmx.com\",\n\t\"yandex.com\",\n\t\"fastmail.com\",\n\t// Temporary email services\n\t\"tempmail.com\",\n\t\"guerrillamail.com\",\n\t\"mailinator.com\",\n\t\"10minutemail.com\",\n\t\"throwaway.email\",\n\t// Big tech\n\t\"google.com\",\n\t\"microsoft.com\",\n\t\"apple.com\",\n\t\"amazon.com\",\n\t\"facebook.com\",\n\t\"meta.com\",\n]);\n\n// Reserved subdomains that companies cannot use\nconst RESERVED_SUBDOMAINS = new Set([\n\t\"mail\",\n\t\"email\",\n\t\"smtp\",\n\t\"pop\",\n\t\"imap\",\n\t\"webmail\",\n\t\"mx\",\n\t\"ns\",\n\t\"dns\",\n\t\"www\",\n\t\"api\",\n\t\"app\",\n\t\"admin\",\n\t\"support\",\n\t\"help\",\n\t\"billing\",\n\t\"status\",\n]);\n\nexport interface DomainValidationResult {\n\tvalid: boolean;\n\terror?: string;\n\tnormalizedDomain?: string;\n\tisSubdomain?: boolean;\n\trootDomain?: string;\n\tsubdomain?: string;\n}\n\nexport interface DomainConfig {\n\tallowCustomDomain: boolean;\n\trequireSubdomain: boolean;\n\tmaxDomainsAllowed: number;\n}\n\n/**\n * Get domain configuration - all companies have the same config (no tiers)\n */\nexport function getDomainConfig(): DomainConfig {\n\treturn {\n\t\tallowCustomDomain: true,\n\t\trequireSubdomain: false, // Can use root domain or subdomain\n\t\tmaxDomainsAllowed: 10, // Reasonable limit for organization\n\t};\n}\n\n/**\n * Parse a domain into its components\n */\nexport function parseDomain(domain: string): {\n\tsubdomain: string | null;\n\trootDomain: string;\n\ttld: string;\n} {\n\tconst normalized = domain.toLowerCase().trim();\n\tconst parts = normalized.split(\".\");\n\n\tif (parts.length < 2) {\n\t\treturn { subdomain: null, rootDomain: normalized, tld: \"\" };\n\t}\n\n\t// Handle common multi-part TLDs (co.uk, com.au, etc.)\n\tconst multiPartTlds = [\"co.uk\", \"com.au\", \"co.nz\", \"com.br\", \"co.jp\"];\n\tconst lastTwo = parts.slice(-2).join(\".\");\n\n\tif (multiPartTlds.includes(lastTwo) && parts.length > 2) {\n\t\tconst tld = lastTwo;\n\t\tconst rootDomain = parts.slice(-3).join(\".\");\n\t\tconst subdomain = parts.length > 3 ? parts.slice(0, -3).join(\".\") : null;\n\t\treturn { subdomain, rootDomain, tld };\n\t}\n\n\tconst tld = parts[parts.length - 1];\n\tconst rootDomain = parts.slice(-2).join(\".\");\n\tconst subdomain = parts.length > 2 ? parts.slice(0, -2).join(\".\") : null;\n\n\treturn { subdomain, rootDomain, tld };\n}\n\n/**\n * Validate a domain for registration\n */\nexport function validateDomain(domain: string): DomainValidationResult {\n\tif (!domain || typeof domain !== \"string\") {\n\t\treturn { valid: false, error: \"Domain is required\" };\n\t}\n\n\tconst normalized = domain.toLowerCase().trim();\n\n\t// Basic format validation\n\tconst domainRegex = /^[a-z0-9]([a-z0-9-]*[a-z0-9])?(\\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*\\.[a-z]{2,}$/;\n\tif (!domainRegex.test(normalized)) {\n\t\treturn { valid: false, error: \"Invalid domain format\" };\n\t}\n\n\t// Check for blocked domains\n\tconst { rootDomain, subdomain } = parseDomain(normalized);\n\tif (BLOCKED_DOMAINS.has(rootDomain)) {\n\t\treturn {\n\t\t\tvalid: false,\n\t\t\terror: `Cannot register public email provider domain: ${rootDomain}`,\n\t\t};\n\t}\n\n\t// Check for reserved subdomains\n\tif (subdomain && RESERVED_SUBDOMAINS.has(subdomain.split(\".\")[0])) {\n\t\treturn {\n\t\t\tvalid: false,\n\t\t\terror: `Subdomain \"${subdomain}\" is reserved. Please use a different subdomain.`,\n\t\t};\n\t}\n\n\treturn {\n\t\tvalid: true,\n\t\tnormalizedDomain: normalized,\n\t\tisSubdomain: !!subdomain,\n\t\trootDomain,\n\t\tsubdomain: subdomain || undefined,\n\t};\n}\n\n/**\n * Generate platform subdomain for companies without custom domains\n * Format: {company-slug}.mail.stratos.app\n */\nexport function generatePlatformSubdomain(companySlug: string): string {\n\tconst sanitized = companySlug\n\t\t.toLowerCase()\n\t\t.replace(/[^a-z0-9-]/g, \"-\")\n\t\t.replace(/-+/g, \"-\")\n\t\t.replace(/^-|-$/g, \"\");\n\n\tconst platformDomain = process.env.PLATFORM_EMAIL_DOMAIN || \"mail.stratos.app\";\n\treturn `${sanitized}.${platformDomain}`;\n}\n\n/**\n * Generate default sending address for a company\n */\nexport function generateSendingAddress(\n\tcompanySlug: string,\n\tdomain: string,\n\ttype: \"notifications\" | \"support\" | \"billing\" | \"noreply\" = \"notifications\"\n): string {\n\treturn `${type}@${domain}`;\n}\n\n/**\n * Check if company can register more domains\n */\nexport function canRegisterMoreDomains(\n\tcurrentDomainCount: number\n): { allowed: boolean; reason?: string } {\n\tconst config = getDomainConfig();\n\n\tif (currentDomainCount >= config.maxDomainsAllowed) {\n\t\treturn {\n\t\t\tallowed: false,\n\t\t\treason: `Maximum ${config.maxDomainsAllowed} domain(s) allowed. Contact support if you need more.`,\n\t\t};\n\t}\n\n\treturn { allowed: true };\n}\n\n/**\n * Suggest subdomain options for a domain\n */\nexport function suggestSubdomains(rootDomain: string): string[] {\n\treturn [\n\t\t`mail.${rootDomain}`,\n\t\t`notifications.${rootDomain}`,\n\t\t`updates.${rootDomain}`,\n\t\t`alerts.${rootDomain}`,\n\t\t`messages.${rootDomain}`,\n\t];\n}\n\n/**\n * Validate email address format\n */\nexport function validateEmailAddress(email: string): {\n\tvalid: boolean;\n\terror?: string;\n\tlocal?: string;\n\tdomain?: string;\n} {\n\tconst emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\n\tif (!emailRegex.test(email)) {\n\t\treturn { valid: false, error: \"Invalid email format\" };\n\t}\n\n\tconst [local, domain] = email.split(\"@\");\n\n\tif (local.length > 64) {\n\t\treturn { valid: false, error: \"Local part of email is too long\" };\n\t}\n\n\tif (domain.length > 255) {\n\t\treturn { valid: false, error: \"Domain part of email is too long\" };\n\t}\n\n\treturn { valid: true, local, domain };\n}\n","/**\n * Telnyx Number Porting API\n *\n * Handles submitting porting orders, checking status, and managing the porting process.\n * Documentation: https://developers.telnyx.com/api/v2/number-portability/Porting-Orders\n */\n\nimport { TELNYX_CONFIG } from \"./client\";\n\nexport type PortingOrderStatus =\n\t| \"draft\"\n\t| \"in-process\"\n\t| \"submitted\"\n\t| \"exception\"\n\t| \"foc-date-confirmed\"\n\t| \"ported\"\n\t| \"cancelled\";\n\nexport interface PortingOrderRequest {\n\tphoneNumbers: string[]; // Numbers to port (E.164 format)\n\t// Current carrier info\n\tcurrentCarrierName: string;\n\tcurrentAccountNumber: string;\n\tcurrentPinPassword?: string; // Required by some carriers\n\tcurrentBillingTelephoneNumber?: string; // BTN\n\n\t// Business info (from company onboarding)\n\tbusinessName: string;\n\tbusinessAddress: string;\n\tbusinessCity: string;\n\tbusinessState: string;\n\tbusinessZip: string;\n\tbusinessContactName: string;\n\tbusinessContactEmail: string;\n\tbusinessContactPhone: string;\n\n\t// Additional info\n\trequestedFocDate?: string; // Preferred FOC date (YYYY-MM-DD)\n\tspecialInstructions?: string;\n}\n\nexport interface PortingOrder {\n\tid: string;\n\tstatus: PortingOrderStatus;\n\tphoneNumbers: string[];\n\tcurrentCarrierName: string;\n\tfocDate?: string; // Firm Order Commitment date\n\tcreatedAt: string;\n\tupdatedAt: string;\n\tportOutPin?: string; // PIN for future port-outs\n\tsupportKey?: string; // For Telnyx support reference\n}\n\nexport interface PortingOrderResult {\n\tsuccess: boolean;\n\tdata?: PortingOrder;\n\terror?: string;\n\tvalidationErrors?: Record<string, string[]>;\n}\n\n/**\n * Create a new porting order\n */\nexport async function createPortingOrder(\n\trequest: PortingOrderRequest\n): Promise<PortingOrderResult> {\n\ttry {\n\t\tconst TELNYX_API_KEY = process.env.TELNYX_API_KEY;\n\t\tif (!TELNYX_API_KEY) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Telnyx API key not configured (TELNYX_API_KEY)\",\n\t\t\t};\n\t\t}\n\n\t\t// Validate phone numbers format (E.164)\n\t\tconst validPhoneNumbers = request.phoneNumbers.filter((num) =>\n\t\t\t/^\\+1[0-9]{10}$/.test(num)\n\t\t);\n\t\tif (validPhoneNumbers.length === 0) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror:\n\t\t\t\t\t\"No valid phone numbers provided. Format must be E.164 (+1XXXXXXXXXX)\",\n\t\t\t};\n\t\t}\n\n\t\t// Prepare porting order payload\n\t\tconst payload = {\n\t\t\tphone_numbers: validPhoneNumbers,\n\t\t\t// Losing carrier info\n\t\t\told_service_provider_details: {\n\t\t\t\tname: request.currentCarrierName,\n\t\t\t\taccount_number: request.currentAccountNumber,\n\t\t\t\tpin_password: request.currentPinPassword,\n\t\t\t\tbilling_telephone_number: request.currentBillingTelephoneNumber,\n\t\t\t},\n\t\t\t// Business address\n\t\t\tperson_or_business_name: request.businessName,\n\t\t\taddress_line_1: request.businessAddress,\n\t\t\tlocality: request.businessCity,\n\t\t\tadministrative_area: request.businessState,\n\t\t\tpostal_code: request.businessZip,\n\t\t\tcountry_code: \"US\",\n\t\t\t// Contact info\n\t\t\tcontact_name: request.businessContactName,\n\t\t\tcontact_email: request.businessContactEmail,\n\t\t\tcontact_phone: request.businessContactPhone,\n\t\t\t// Optional settings\n\t\t\trequested_foc_date: request.requestedFocDate,\n\t\t\tspecial_instructions: request.specialInstructions,\n\t\t\t// Bill of Lading - set to false if we want to use existing service address\n\t\t\t// (Typically false for most cases)\n\t\t\tenduser_location_type: \"business\",\n\t\t};\n\n\t\tconst response = await fetch(\"https://api.telnyx.com/v2/porting_orders\", {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\tAuthorization: `Bearer ${TELNYX_API_KEY}`,\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t},\n\t\t\tbody: JSON.stringify(payload),\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tconst errorData = await response.json();\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: errorData.errors?.[0]?.detail || \"Failed to create porting order\",\n\t\t\t\tvalidationErrors: errorData.errors?.reduce(\n\t\t\t\t\t(acc: Record<string, string[]>, err: any) => {\n\t\t\t\t\t\tconst field = err.source?.pointer?.split(\"/\").pop() || \"general\";\n\t\t\t\t\t\tif (!acc[field]) acc[field] = [];\n\t\t\t\t\t\tacc[field].push(err.detail);\n\t\t\t\t\t\treturn acc;\n\t\t\t\t\t},\n\t\t\t\t\t{}\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\n\t\tconst result = await response.json();\n\t\tconst portingOrder = result.data;\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: {\n\t\t\t\tid: portingOrder.id,\n\t\t\t\tstatus: portingOrder.status,\n\t\t\t\tphoneNumbers: portingOrder.phone_numbers,\n\t\t\t\tcurrentCarrierName: portingOrder.old_service_provider_details?.name,\n\t\t\t\tfocDate: portingOrder.foc_date,\n\t\t\t\tcreatedAt: portingOrder.created_at,\n\t\t\t\tupdatedAt: portingOrder.updated_at,\n\t\t\t\tportOutPin: portingOrder.port_out_pin,\n\t\t\t\tsupportKey: portingOrder.support_key,\n\t\t\t},\n\t\t};\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t};\n\t}\n}\n\n/**\n * Get porting order status\n */\nexport async function getPortingOrderStatus(\n\tportingOrderId: string\n): Promise<PortingOrderResult> {\n\ttry {\n\t\tconst TELNYX_API_KEY = process.env.TELNYX_API_KEY;\n\t\tif (!TELNYX_API_KEY) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Telnyx API key not configured\",\n\t\t\t};\n\t\t}\n\n\t\tconst response = await fetch(\n\t\t\t`https://api.telnyx.com/v2/porting_orders/${portingOrderId}`,\n\t\t\t{\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${TELNYX_API_KEY}`,\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\n\t\tif (!response.ok) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: `Failed to fetch porting order: ${response.statusText}`,\n\t\t\t};\n\t\t}\n\n\t\tconst result = await response.json();\n\t\tconst portingOrder = result.data;\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: {\n\t\t\t\tid: portingOrder.id,\n\t\t\t\tstatus: portingOrder.status,\n\t\t\t\tphoneNumbers: portingOrder.phone_numbers,\n\t\t\t\tcurrentCarrierName: portingOrder.old_service_provider_details?.name,\n\t\t\t\tfocDate: portingOrder.foc_date,\n\t\t\t\tcreatedAt: portingOrder.created_at,\n\t\t\t\tupdatedAt: portingOrder.updated_at,\n\t\t\t\tportOutPin: portingOrder.port_out_pin,\n\t\t\t\tsupportKey: portingOrder.support_key,\n\t\t\t},\n\t\t};\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t};\n\t}\n}\n\n/**\n * Cancel a porting order\n */\nexport async function cancelPortingOrder(\n\tportingOrderId: string\n): Promise<{ success: boolean; error?: string }> {\n\ttry {\n\t\tconst TELNYX_API_KEY = process.env.TELNYX_API_KEY;\n\t\tif (!TELNYX_API_KEY) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Telnyx API key not configured\",\n\t\t\t};\n\t\t}\n\n\t\tconst response = await fetch(\n\t\t\t`https://api.telnyx.com/v2/porting_orders/${portingOrderId}/actions/cancel`,\n\t\t\t{\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${TELNYX_API_KEY}`,\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\n\t\tif (!response.ok) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: `Failed to cancel porting order: ${response.statusText}`,\n\t\t\t};\n\t\t}\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t};\n\t}\n}\n\n/**\n * Validate if a number is portable\n */\nexport async function checkNumberPortability(\n\tphoneNumber: string\n): Promise<{\n\tsuccess: boolean;\n\tportable?: boolean;\n\tcarrier?: string;\n\tnumberType?: string;\n\terror?: string;\n}> {\n\ttry {\n\t\tconst TELNYX_API_KEY = process.env.TELNYX_API_KEY;\n\t\tif (!TELNYX_API_KEY) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Telnyx API key not configured\",\n\t\t\t};\n\t\t}\n\n\t\t// Normalize phone number to E.164\n\t\tconst normalized = phoneNumber.replace(/\\D/g, \"\");\n\t\tconst e164 =\n\t\t\tnormalized.startsWith(\"1\") && normalized.length === 11\n\t\t\t\t? `+${normalized}`\n\t\t\t\t: `+1${normalized}`;\n\n\t\tconst response = await fetch(\n\t\t\t`https://api.telnyx.com/v2/number_lookup/${e164}`,\n\t\t\t{\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${TELNYX_API_KEY}`,\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\n\t\tif (!response.ok) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: `Failed to lookup number: ${response.statusText}`,\n\t\t\t};\n\t\t}\n\n\t\tconst result = await response.json();\n\t\tconst data = result.data;\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tportable: data.portability?.portable !== false,\n\t\t\tcarrier: data.carrier?.name,\n\t\t\tnumberType: data.carrier?.type,\n\t\t};\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t};\n\t}\n}\n\n/**\n * Get estimated FOC date for a porting order\n * Returns the earliest possible completion date based on carrier rules\n */\nexport function getEstimatedFocDate(): string {\n\t// Most carriers require 2-4 weeks\n\t// Let's use 3 weeks (21 days) as a reasonable estimate\n\tconst today = new Date();\n\ttoday.setDate(today.getDate() + 21);\n\treturn today.toISOString().split(\"T\")[0]; // YYYY-MM-DD\n}\n\n/**\n * Format porting status for display\n */\nexport function formatPortingStatus(status: PortingOrderStatus): string {\n\tconst statusLabels: Record<PortingOrderStatus, string> = {\n\t\tdraft: \"Draft\",\n\t\t\"in-process\": \"In Process\",\n\t\tsubmitted: \"Submitted to Carrier\",\n\t\texception: \"Requires Attention\",\n\t\t\"foc-date-confirmed\": \"Scheduled for Porting\",\n\t\tported: \"Complete\",\n\t\tcancelled: \"Cancelled\",\n\t};\n\treturn statusLabels[status] || status;\n}\n\n/**\n * Check if porting order requires action\n */\nexport function requiresAction(status: PortingOrderStatus): boolean {\n\treturn status === \"exception\" || status === \"draft\";\n}\n","\"use server\";\n\n/**\n * Server Actions for Phone Number Porting\n */\n\nimport { createPortingOrder, checkNumberPortability, getPortingOrderStatus, type PortingOrderRequest } from \"@/lib/telnyx/porting\";\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\n\nexport async function submitPortingOrder(data: {\n\tcompanyId: string;\n\tphoneNumbers: string[];\n\tcurrentCarrierName: string;\n\tcurrentAccountNumber: string;\n\tcurrentPinPassword?: string;\n\tbusinessName: string;\n\tbusinessAddress: string;\n\tbusinessCity: string;\n\tbusinessState: string;\n\tbusinessZip: string;\n\tbusinessContactName: string;\n\tbusinessContactEmail: string;\n\tbusinessContactPhone: string;\n\trequestedFocDate?: string;\n}): Promise<{\n\tsuccess: boolean;\n\tportingOrderId?: string;\n\tfocDate?: string;\n\terror?: string;\n\tvalidationErrors?: Record<string, string[]>;\n}> {\n\ttry {\n\t\t// Create porting order with Telnyx\n\t\tconst result = await createPortingOrder({\n\t\t\tphoneNumbers: data.phoneNumbers,\n\t\t\tcurrentCarrierName: data.currentCarrierName,\n\t\t\tcurrentAccountNumber: data.currentAccountNumber,\n\t\t\tcurrentPinPassword: data.currentPinPassword,\n\t\t\tbusinessName: data.businessName,\n\t\t\tbusinessAddress: data.businessAddress,\n\t\t\tbusinessCity: data.businessCity,\n\t\t\tbusinessState: data.businessState,\n\t\t\tbusinessZip: data.businessZip,\n\t\t\tbusinessContactName: data.businessContactName,\n\t\t\tbusinessContactEmail: data.businessContactEmail,\n\t\t\tbusinessContactPhone: data.businessContactPhone,\n\t\t\trequestedFocDate: data.requestedFocDate,\n\t\t});\n\n\t\tif (!result.success || !result.data) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: result.error,\n\t\t\t\tvalidationErrors: result.validationErrors,\n\t\t\t};\n\t\t}\n\n\t\t// Store porting order in database\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tconst { error: dbError } = await supabase.from(\"porting_orders\").insert({\n\t\t\tcompany_id: data.companyId,\n\t\t\ttelnyx_porting_order_id: result.data.id,\n\t\t\tphone_numbers: result.data.phoneNumbers,\n\t\t\tcurrent_carrier: result.data.currentCarrierName,\n\t\t\tstatus: result.data.status,\n\t\t\tfoc_date: result.data.focDate,\n\t\t\tsupport_key: result.data.supportKey,\n\t\t\tcreated_at: new Date().toISOString(),\n\t\t});\n\n\t\tif (dbError) {\n\t\t\tconsole.error(\"Failed to save porting order to database:\", dbError);\n\t\t\t// Don't fail the request - porting order was created successfully\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tportingOrderId: result.data.id,\n\t\t\tfocDate: result.data.focDate,\n\t\t};\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Failed to submit porting order\",\n\t\t};\n\t}\n}\n\nexport async function checkPortability(phoneNumber: string): Promise<{\n\tsuccess: boolean;\n\tportable?: boolean;\n\tcarrier?: string;\n\tnumberType?: string;\n\terror?: string;\n}> {\n\treturn await checkNumberPortability(phoneNumber);\n}\n\nexport async function getPortingStatus(portingOrderId: string): Promise<{\n\tsuccess: boolean;\n\tstatus?: string;\n\tfocDate?: string;\n\terror?: string;\n}> {\n\tconst result = await getPortingOrderStatus(portingOrderId);\n\n\tif (!result.success || !result.data) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: result.error,\n\t\t};\n\t}\n\n\treturn {\n\t\tsuccess: true,\n\t\tstatus: result.data.status,\n\t\tfocDate: result.data.focDate,\n\t};\n}\n","export {getCurrentUserRole as '001f005176797ef23488068124fb9a744915a477de'} from 'ACTIONS_MODULE0'\nexport {canDeleteTeamMember as '406f6624261c6dd1a908026fa1408a3f6d507b6e7d'} from 'ACTIONS_MODULE0'\nexport {getPayrixMerchantAccount as '40704f0e856ad801ef93b43436f219a36f7c0efd2c'} from 'ACTIONS_MODULE1'\nexport {getWebRTCCredentials as '000478fbf5363dae5000d525663da13e29908cb952'} from 'ACTIONS_MODULE2'\nexport {transcribeCallRecording as '4002f454c46f4c21ca6e9e26362583ccff69c9f914'} from 'ACTIONS_MODULE2'\nexport {getCompanyPhoneNumbers as '4019cf9f81eb3c06f82b5c2f8eb042f3d95d91e933'} from 'ACTIONS_MODULE2'\nexport {getCallRoutingRules as '40247c617842c31b242455a0961cbd2c3297606a16'} from 'ACTIONS_MODULE2'\nexport {updateCallRoutingRule as '40413bfa888916480edbc33ebb812158fddf960f89'} from 'ACTIONS_MODULE2'\nexport {startCallRecording as '404e47931374ad2a1b54bc11f357703790f6104530'} from 'ACTIONS_MODULE2'\nexport {transferActiveCall as '405a16958f97c37bd4b5711bd8761510bdab55839f'} from 'ACTIONS_MODULE2'\nexport {searchPhoneNumbers as '406864ae05b8b51c66cc2c335999e5011a41cb521f'} from 'ACTIONS_MODULE2'\nexport {makeCall as '40b2df540ec465c5dc19545c96486485bb50b5633b'} from 'ACTIONS_MODULE2'\nexport {sendTextMessage as '40d050abdabe2ee7293436c505c5f27b4408a2f27c'} from 'ACTIONS_MODULE2'\nexport {stopCallRecording as '40d5cc291162e2fd61245bdb851d5e8ed609e4ed19'} from 'ACTIONS_MODULE2'\nexport {sendMMSMessage as '40edd91786b2a482e617fb16f2474d26ec295435e7'} from 'ACTIONS_MODULE2'\nexport {purchasePhoneNumber as '40fd6a80b32792fab749933f98f07503d8e94c0305'} from 'ACTIONS_MODULE2'\nexport {deleteCallRoutingRule as '607d0f958daf66b2a0d5277cdda17600dace5156bb'} from 'ACTIONS_MODULE2'\nexport {toggleCallRoutingRule as '60853f1e409364f7e171e27229217994ff224414e6'} from 'ACTIONS_MODULE2'\nexport {createServiceSupabaseClient as '00a13dbd00149949fc1367d3e76ae7d789e07f5321'} from 'ACTIONS_MODULE3'\nexport {ensureMessagingBranding as '606753f8910b46d5792f4bdeb457cdf29d1a8bbadc'} from 'ACTIONS_MODULE4'\nexport {ensureMessagingCampaign as '70a648f43fa62ae3dcf2070eb90413e96e81591e77'} from 'ACTIONS_MODULE4'\nexport {checkTelnyxVerificationStatus as '007505a78985e53e083a498c97761ed8a463d3d379'} from 'ACTIONS_MODULE5'\nexport {submitAutomatedVerification as '4087f0badccd6aaf6a28b640ab4bbc513f0832d105'} from 'ACTIONS_MODULE5'\nexport {registerCompanyFor10DLC as '40ae25402a089e45aa071d979e8cc6ad136205cc98'} from 'ACTIONS_MODULE5'\nexport {sendVerificationSubmittedEmail as '70f58c5ba46ef02b620d7dc87bae8fc83f6d480755'} from 'ACTIONS_MODULE6'\nexport {sendEmail as '40f8c061cf84f884e77af3425bc24b8a8d72f598fb'} from 'ACTIONS_MODULE7'\nexport {handleComplaintWebhook as '6045f8436f9cdfdadb7bfe3955677adfc5f4102de0'} from 'ACTIONS_MODULE7'\nexport {handleBounceWebhook as '78a8ea4f1cfa571a366adccf36ac04b1c85d61ae2b'} from 'ACTIONS_MODULE7'\nexport {runHealthCheckForAllDomains as '00c53a1f02416c3261983f8096f19a3450bfd51775'} from 'ACTIONS_MODULE8'\nexport {getDomainHealth as '400b8fb96146bfd004a3166563a5ab5536bb610c70'} from 'ACTIONS_MODULE8'\nexport {recordDeliveryEvent as '404d6f2891af89c71d5bde33d110a216bdd3ee4729'} from 'ACTIONS_MODULE8'\nexport {getCompanyDomainsHealth as '405c57a8fed352b8679525b56014eb8c49105c850c'} from 'ACTIONS_MODULE8'\nexport {processResendWebhookEvent as '40ad037af6f6ab1a3004746d3a1b65afa65527002d'} from 'ACTIONS_MODULE8'\nexport {generateDeliverabilityReport as '40ecf2c792e84ef4b898fda98ec27277b4a9dddef2'} from 'ACTIONS_MODULE8'\nexport {resetHourlyCounters as '004cdde5e6ae8991bab4ba61ae40647c2b823200ba'} from 'ACTIONS_MODULE9'\nexport {resetDailyCounters as '006acf41615a2f7795c47b6d7a3016e18300f2ad17'} from 'ACTIONS_MODULE9'\nexport {incrementEmailCounter as '4029b163c1c0acfd806352a72fe8030c8ae4f7f8ac'} from 'ACTIONS_MODULE9'\nexport {getCompanyActiveDomain as '407a5a7d0a7dd7989a963eb2485a3527c1dcb20a70'} from 'ACTIONS_MODULE9'\nexport {checkRateLimit as '40af86a915f04df8d7cc189fe26e45e0cc24663080'} from 'ACTIONS_MODULE9'\nexport {isGmailIntegrationEnabled as '00fe74bdf14126b5ad89e9480e82978d6357f356b3'} from 'ACTIONS_MODULE10'\nexport {getUserGmailTokens as '400ce95360aaffa14a99dfdf969ba5166c69a59eb6'} from 'ACTIONS_MODULE10'\nexport {disconnectCompanyGmail as '401d3d830065dd7c4777fad67f642392f48735c4ab'} from 'ACTIONS_MODULE10'\nexport {disconnectUserGmail as '404575d602ef4c60c0058b592b8c3e42fbcd13fc4c'} from 'ACTIONS_MODULE10'\nexport {getCompanyEmailProvider as '40787b1598849126560f9f0b0f8fe8967338c7bf28'} from 'ACTIONS_MODULE10'\nexport {getCompanyGmailTokens as '40beeb56302a20d27cd8ba7a0988310f855633d7e6'} from 'ACTIONS_MODULE10'\nexport {refreshUserGmailToken as '602fab67313b110e6ccb66e54b1e16450b2a772cc7'} from 'ACTIONS_MODULE10'\nexport {sendCompanyGmailEmail as '60302947fc4caffa53a719728f3c2cebace926098c'} from 'ACTIONS_MODULE10'\nexport {syncUserInbox as '603643b13bf288cc628303bb4d12df0311b11434c7'} from 'ACTIONS_MODULE10'\nexport {checkCompanyGmailHealth as '60856182db5eaec7f85eda2a5a94c5d7d3524325d6'} from 'ACTIONS_MODULE10'\nexport {refreshCompanyGmailToken as '60eeb51685ac265a4ad793a230a515fe6e462f16f4'} from 'ACTIONS_MODULE10'\nexport {fetchUserInbox as '708daa303e36e37247e22b5b828b6aad8c73ac283b'} from 'ACTIONS_MODULE10'\nexport {setCompanyEmailProvider as '70dd3bc4222a87350dc137fa9cbcb849fa1913b397'} from 'ACTIONS_MODULE10'\nexport {storeGmailMessage as '78d41ef818e75fef94d65a87ea1f0faf418132e3c5'} from 'ACTIONS_MODULE10'\nexport {storeUserGmailTokens as '7e3a356960ddd52a3fa4dc6d981ae7202a59eb9a3d'} from 'ACTIONS_MODULE10'\nexport {storeCompanyGmailTokens as '7f06df826c4fff42950e712c0f548254e275be2a52'} from 'ACTIONS_MODULE10'\nexport {getProviderHealthDashboard as '00a122f9d5fe3a1603c636c3a251886129b66154f8'} from 'ACTIONS_MODULE11'\nexport {checkProviderAlert as '40c7885bdc4fe4cdd5f57e78579230c58088adbef4'} from 'ACTIONS_MODULE11'\nexport {cleanupOldEvents as '40d3c4ceeaee653aa257a28ed429a7fd272fa9fb66'} from 'ACTIONS_MODULE11'\nexport {recordProviderEvent as '40e06418f4b93b40c84a25511e0468e1e8a41ddecf'} from 'ACTIONS_MODULE11'\nexport {getProviderStats as '60c643a41ce1a8e6cc8338da6e2f3678c386910460'} from 'ACTIONS_MODULE11'\nexport {recordSendFailure as '78255c3fa8c9facf7c3f353202f2907836e8eb5539'} from 'ACTIONS_MODULE11'\nexport {recordSendSuccess as '783861d25688b32ba086bbe9e45444975c36a1b285'} from 'ACTIONS_MODULE11'\nexport {recordFallbackTriggered as '78766431b437b16f7cb00b4d64a2f3be5e092ed724'} from 'ACTIONS_MODULE11'\nexport {deleteNotification as '40fab1894acc5e3d1fdd8d8c6128a7cecee06e7e6a'} from 'ACTIONS_MODULE12'\nexport {markAllAsRead as '00cf212b0097820096122537beac12e3403b97d564'} from 'ACTIONS_MODULE12'\nexport {markAsRead as '4094cf679b4a10ca0f969f4fc1b55602aac4e0fbc3'} from 'ACTIONS_MODULE12'\nexport {makeCall as '40b2df540ec465c5dc19545c96486485bb50b5633b'} from 'ACTIONS_MODULE2'\nexport {getWebRTCCredentials as '000478fbf5363dae5000d525663da13e29908cb952'} from 'ACTIONS_MODULE2'\nexport {signOut as '0043ae510c3322ea499beb9e1bb77d06afb4ef19bd'} from 'ACTIONS_MODULE13'\nexport {switchCompany as '4097c3c574342661f9a3c8244961d001234449f36f'} from 'ACTIONS_MODULE14'\nexport {updateUserStatus as '4081009dd4dff14ff4ece62648bad23a83f2f9f63c'} from 'ACTIONS_MODULE15'\nexport {getTotalUnreadCountAction as '00ebc03a4ffc993aea7ec2e541686105c2bace2437'} from 'ACTIONS_MODULE16'\nexport {getCompanyPendingActions as '40e9589cb639f2902eb841bedc1247d966486d6fd7'} from 'ACTIONS_MODULE17'\nexport {checkIsCompanyOwner as '001be5cf82b793f19f6a7d010c91c14577fa7a130d'} from 'ACTIONS_MODULE17'\nexport {getCustomerByPhone as '6013add076e3eaed7dc37e8b800ce977d5abb8d49a'} from 'ACTIONS_MODULE18'\nexport {startCallRecording as '404e47931374ad2a1b54bc11f357703790f6104530'} from 'ACTIONS_MODULE2'\nexport {stopCallRecording as '40d5cc291162e2fd61245bdb851d5e8ed609e4ed19'} from 'ACTIONS_MODULE2'\nexport {deleteCustomer as '4082b52123c24a95685a53c36313418a95c259c65b'} from 'ACTIONS_MODULE18'\nexport {searchCustomers as '60193685409a9d118f1b364e14ecf57d05fa5638a9'} from 'ACTIONS_MODULE18'\nexport {getCustomersForDialer as '0077abd0cb1e555f91adaa482ad0b2f565bbd0629a'} from 'ACTIONS_MODULE18'\nexport {getPendingSupportSessions as '000f90f949d6a2f5484d061d5a738a59a8c846aeaa'} from 'ACTIONS_MODULE19'\nexport {getActiveSupportSessions as '00665c1bbcd52d612d5bb4bf3be5e7fc75554132e6'} from 'ACTIONS_MODULE19'\nexport {approveSupportSessionRequest as '602e89ae7ace85fc30cd3b4b1dd865d517c0cb1cd5'} from 'ACTIONS_MODULE19'\nexport {rejectSupportSessionRequest as '60886af124323873afd4d5b64bb4143abbcba2c154'} from 'ACTIONS_MODULE19'\nexport {endActiveSupportSession as '40369e8ea4eced7bdaef8203d369469ee7b630db8c'} from 'ACTIONS_MODULE19'\nexport {completeOnboardingWizard as '40e3ab2b653a7e94bf8b49023e3451e93598db4932'} from 'ACTIONS_MODULE20'\nexport {checkPortability as '40a9f674fc951b955911a357335a67599afc762e52'} from 'ACTIONS_MODULE21'\nexport {createOnboardingCheckoutSession as '40a8e3dc048482f4958e757e844a571c2aa09fb85f'} from 'ACTIONS_MODULE22'\n"],"names":[],"mappings":"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","ignoreList":[0,1]}