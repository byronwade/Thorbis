{"version":3,"sources":["../../../../../../apps/web/src/components/settings/api-usage/api-usage-data.tsx","../../../../../../apps/web/src/lib/api/usage-sync-service.ts","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/settings/api-usage/page.tsx","../../../../../../apps/web/src/components/settings/api-usage/api-usage-skeleton.tsx","../../../../../../node_modules/.pnpm/lucide-react%400.552.0_react%4019.2.0/node_modules/lucide-react/src/icons/server.ts","../../../../../../apps/web/src/lib/api/providers/supabase-usage-client.ts","../../../../../../apps/web/src/lib/api/health-check-service.ts","../../../../../../apps/web/src/lib/api/providers/stripe-billing-client.ts","../../../../../../apps/web/src/lib/api/providers/telnyx-usage-client.ts","../../../../../../apps/web/src/lib/api/api-service-config.ts","../../../../../../apps/web/src/lib/api/providers/google-cloud-client.ts"],"sourcesContent":["import { AlertCircle, AlertTriangle, CheckCircle, Clock, DollarSign, Server, TrendingUp, Wifi, WifiOff } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\nimport { getUsageSummary, getServicesApproachingLimits } from \"@/lib/api/usage-sync-service\";\nimport { getSystemHealthSummary } from \"@/lib/api/health-check-service\";\nimport { API_SERVICES } from \"@/lib/api/api-service-config\";\n\n/**\n * Format currency from cents to dollars\n */\nfunction formatCurrency(cents: number): string {\n\treturn new Intl.NumberFormat(\"en-US\", {\n\t\tstyle: \"currency\",\n\t\tcurrency: \"USD\",\n\t}).format(cents / 100);\n}\n\n/**\n * Format large numbers with K/M suffixes\n */\nfunction formatNumber(num: number): string {\n\tif (num >= 1_000_000) {\n\t\treturn `${(num / 1_000_000).toFixed(1)}M`;\n\t}\n\tif (num >= 1_000) {\n\t\treturn `${(num / 1_000).toFixed(1)}K`;\n\t}\n\treturn num.toString();\n}\n\n/**\n * Get alert level color classes\n */\nfunction getAlertColor(level: string): string {\n\tswitch (level) {\n\t\tcase \"critical\":\n\t\t\treturn \"text-red-600 bg-red-100 dark:bg-red-900/30\";\n\t\tcase \"warning\":\n\t\t\treturn \"text-yellow-600 bg-yellow-100 dark:bg-yellow-900/30\";\n\t\tdefault:\n\t\t\treturn \"text-green-600 bg-green-100 dark:bg-green-900/30\";\n\t}\n}\n\n/**\n * Get health status color classes\n */\nfunction getHealthColor(status: string): string {\n\tswitch (status) {\n\t\tcase \"down\":\n\t\t\treturn \"text-red-600\";\n\t\tcase \"degraded\":\n\t\t\treturn \"text-yellow-600\";\n\t\tdefault:\n\t\t\treturn \"text-green-600\";\n\t}\n}\n\nexport async function ApiUsageData() {\n\t// Fetch all data\n\tconst [usageSummary, approachingLimits, healthSummary] = await Promise.all([getUsageSummary(), getServicesApproachingLimits(), getSystemHealthSummary()]);\n\n\t// Calculate monthly cost projection\n\tconst currentDay = new Date().getDate();\n\tconst daysInMonth = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate();\n\tconst projectedMonthlyCost = usageSummary ? Math.round((usageSummary.total_cost_cents / Math.max(currentDay, 1)) * daysInMonth) : 0;\n\n\t// Group services by category\n\tconst servicesByCategory: Record<string, typeof usageSummary.services> = {};\n\tif (usageSummary?.services) {\n\t\tfor (const service of usageSummary.services) {\n\t\t\tif (!servicesByCategory[service.category]) {\n\t\t\t\tservicesByCategory[service.category] = [];\n\t\t\t}\n\t\t\tservicesByCategory[service.category].push(service);\n\t\t}\n\t}\n\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t{/* Header */}\n\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t<div>\n\t\t\t\t\t<h1 className=\"text-3xl font-bold tracking-tight\">API Usage & Costs</h1>\n\t\t\t\t\t<p className=\"text-muted-foreground mt-2\">Monitor API usage, costs, and service health across all integrations</p>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t{healthSummary && (\n\t\t\t\t\t\t<Badge variant={healthSummary.overall_status === \"healthy\" ? \"default\" : healthSummary.overall_status === \"degraded\" ? \"secondary\" : \"destructive\"} className=\"text-sm\">\n\t\t\t\t\t\t\t{healthSummary.overall_status === \"healthy\" && <CheckCircle className=\"mr-1 h-3 w-3\" />}\n\t\t\t\t\t\t\t{healthSummary.overall_status === \"degraded\" && <AlertTriangle className=\"mr-1 h-3 w-3\" />}\n\t\t\t\t\t\t\t{healthSummary.overall_status === \"critical\" && <AlertCircle className=\"mr-1 h-3 w-3\" />}\n\t\t\t\t\t\t\tSystem {healthSummary.overall_status}\n\t\t\t\t\t\t</Badge>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Overview Stats */}\n\t\t\t<div className=\"grid grid-cols-1 gap-4 md:grid-cols-4\">\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-muted-foreground flex items-center gap-2 text-sm font-medium\">\n\t\t\t\t\t\t\t<DollarSign className=\"h-4 w-4\" />\n\t\t\t\t\t\t\tCurrent Month Cost\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-3xl font-bold\">{formatCurrency(usageSummary?.total_cost_cents || 0)}</div>\n\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-xs\">\n\t\t\t\t\t\t\tProjected: {formatCurrency(projectedMonthlyCost)} by month end\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-muted-foreground flex items-center gap-2 text-sm font-medium\">\n\t\t\t\t\t\t\t<TrendingUp className=\"h-4 w-4\" />\n\t\t\t\t\t\t\tServices at Risk\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className={`text-3xl font-bold ${approachingLimits.length > 0 ? \"text-yellow-600\" : \"text-green-600\"}`}>{approachingLimits.length}</div>\n\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-xs\">Approaching free tier limits</p>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-muted-foreground flex items-center gap-2 text-sm font-medium\">\n\t\t\t\t\t\t\t<Server className=\"h-4 w-4\" />\n\t\t\t\t\t\t\tServices Monitored\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-3xl font-bold\">{usageSummary?.services.length || 0}</div>\n\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-xs\">Active integrations tracked</p>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-muted-foreground flex items-center gap-2 text-sm font-medium\">\n\t\t\t\t\t\t\t<Wifi className=\"h-4 w-4\" />\n\t\t\t\t\t\t\tSystem Uptime\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className={`text-3xl font-bold ${getHealthColor(healthSummary?.overall_status || \"healthy\")}`}>{healthSummary?.average_uptime_24h.toFixed(1) || 100}%</div>\n\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-xs\">24-hour average</p>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\n\t\t\t{/* Services Approaching Limits Alert */}\n\t\t\t{approachingLimits.length > 0 && (\n\t\t\t\t<Card className=\"border-yellow-300 bg-yellow-50 dark:border-yellow-900 dark:bg-yellow-900/20\">\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<CardTitle className=\"flex items-center gap-2 text-yellow-700 dark:text-yellow-400\">\n\t\t\t\t\t\t\t<AlertTriangle className=\"h-5 w-5\" />\n\t\t\t\t\t\t\tServices Approaching Free Tier Limits\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t<CardDescription className=\"text-yellow-600 dark:text-yellow-500\">These services are nearing their free tier limits and may incur charges soon</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{approachingLimits.map((service) => (\n\t\t\t\t\t\t\t\t<div key={service.service_id} className=\"flex items-center justify-between rounded-lg bg-white p-4 dark:bg-gray-900\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">{service.display_name}</span>\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant={service.alert_level === \"critical\" ? \"destructive\" : \"secondary\"} className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t{service.alert_level === \"critical\" ? \"Critical\" : \"Warning\"}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t{formatNumber(service.usage_count)} / {formatNumber(service.free_tier_limit)} used\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"w-32\">\n\t\t\t\t\t\t\t\t\t\t<Progress value={service.percentage_used} className={service.alert_level === \"critical\" ? \"[&>div]:bg-red-500\" : \"[&>div]:bg-yellow-500\"} />\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-right text-xs\">{service.percentage_used.toFixed(1)}%</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t)}\n\n\t\t\t{/* Health Status */}\n\t\t\t{healthSummary && (\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Wifi className=\"h-5 w-5\" />\n\t\t\t\t\t\t\tService Health Status\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t<CardDescription>Real-time availability monitoring for all external services</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"mb-4 flex gap-4\">\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<div className=\"h-3 w-3 rounded-full bg-green-500\" />\n\t\t\t\t\t\t\t\t<span className=\"text-sm\">{healthSummary.healthy_services} Healthy</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{healthSummary.degraded_services > 0 && (\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<div className=\"h-3 w-3 rounded-full bg-yellow-500\" />\n\t\t\t\t\t\t\t\t\t<span className=\"text-sm\">{healthSummary.degraded_services} Degraded</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{healthSummary.down_services > 0 && (\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<div className=\"h-3 w-3 rounded-full bg-red-500\" />\n\t\t\t\t\t\t\t\t\t<span className=\"text-sm\">{healthSummary.down_services} Down</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-2 md:grid-cols-4 lg:grid-cols-6\">\n\t\t\t\t\t\t\t{healthSummary.services.map((service) => (\n\t\t\t\t\t\t\t\t<div key={service.service_id} className=\"flex items-center gap-2 rounded-lg border p-2\">\n\t\t\t\t\t\t\t\t\t{service.current_status === \"healthy\" ? (\n\t\t\t\t\t\t\t\t\t\t<CheckCircle className=\"h-4 w-4 text-green-500\" />\n\t\t\t\t\t\t\t\t\t) : service.current_status === \"degraded\" ? (\n\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-4 w-4 text-yellow-500\" />\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<WifiOff className=\"h-4 w-4 text-red-500\" />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t<span className=\"truncate text-xs\">{service.display_name}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t)}\n\n\t\t\t{/* Usage by Category */}\n\t\t\t{Object.entries(servicesByCategory).map(([category, services]) => (\n\t\t\t\t<Card key={category}>\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<CardTitle className=\"capitalize\">{category.replace(/_/g, \" \")}</CardTitle>\n\t\t\t\t\t\t<CardDescription>Usage and costs for {category.replace(/_/g, \" \").toLowerCase()} services</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{services.map((service) => {\n\t\t\t\t\t\t\t\tconst config = API_SERVICES[service.service_id];\n\t\t\t\t\t\t\t\tconst hasFreeTier = config?.free_tier;\n\t\t\t\t\t\t\t\tconst freeTierLimit = config?.free_tier?.monthly_limit || 0;\n\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<div key={service.service_id} className=\"rounded-lg border p-4\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">{service.display_name}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{service.alert_level !== \"normal\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant={service.alert_level === \"critical\" ? \"destructive\" : \"secondary\"} className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{service.alert_level === \"critical\" ? \"95%+\" : \"80%+\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground mt-1 flex items-center gap-4 text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tUsage: <strong>{formatNumber(service.usage_count)}</strong>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{hasFreeTier && ` / ${formatNumber(freeTierLimit)}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{service.cost_cents > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCost: <strong>{formatCurrency(service.cost_cents)}</strong>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{service.last_synced && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"flex items-center gap-1 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Clock className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSynced {new Date(service.last_synced).toLocaleTimeString()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{hasFreeTier && (\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-40\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Progress\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={service.free_tier_percentage}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={`${\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tservice.alert_level === \"critical\" ? \"[&>div]:bg-red-500\" : service.alert_level === \"warning\" ? \"[&>div]:bg-yellow-500\" : \"[&>div]:bg-green-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground mt-1 flex justify-between text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>Free tier</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>{service.free_tier_percentage.toFixed(1)}%</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t))}\n\n\t\t\t{/* Cost Breakdown */}\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<DollarSign className=\"h-5 w-5\" />\n\t\t\t\t\t\tMonthly Cost Breakdown\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>Estimated costs by service category</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t{Object.entries(servicesByCategory).map(([category, services]) => {\n\t\t\t\t\t\t\tconst categoryCost = services.reduce((sum, s) => sum + s.cost_cents, 0);\n\t\t\t\t\t\t\tconst percentage = usageSummary?.total_cost_cents ? (categoryCost / usageSummary.total_cost_cents) * 100 : 0;\n\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<div key={category} className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"font-medium capitalize\">{category.replace(/_/g, \" \")}</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-sm\">{services.length} services</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-4\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"w-32\">\n\t\t\t\t\t\t\t\t\t\t\t<Progress value={percentage} />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"w-20 text-right font-medium\">{formatCurrency(categoryCost)}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})}\n\t\t\t\t\t\t<div className=\"mt-4 flex items-center justify-between border-t pt-4\">\n\t\t\t\t\t\t\t<div className=\"text-lg font-bold\">Total Estimated Cost</div>\n\t\t\t\t\t\t\t<div className=\"text-lg font-bold\">{formatCurrency(usageSummary?.total_cost_cents || 0)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t{/* Info Card */}\n\t\t\t<Card className=\"bg-muted/50\">\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle>About API Usage Tracking</CardTitle>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">This dashboard provides real-time monitoring of all external API integrations used by Stratos:</p>\n\t\t\t\t\t<ul className=\"text-muted-foreground list-inside list-disc space-y-2 text-sm\">\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<strong>Usage Tracking</strong> - Monitor API calls, tokens, and resource consumption\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<strong>Free Tier Alerts</strong> - Get warned at 80% and 95% of free tier limits\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<strong>Cost Estimation</strong> - Track actual costs and project monthly expenses\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<strong>Health Monitoring</strong> - Real-time availability and uptime tracking\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<strong>Automatic Sync</strong> - Usage data is synced hourly from provider APIs\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t\t<div className=\"border-t pt-4\">\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t<strong>Note:</strong> Cost estimates are based on current usage patterns. Actual charges may vary. Some services (like internal tracking) show usage without costs as they are included in your subscription.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n","/**\n * API Usage Sync Service\n *\n * Aggregates usage data from all provider APIs and syncs to database\n * Designed to run on a schedule (cron) or on-demand\n */\n\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\nimport { telnyxUsageClient } from \"./providers/telnyx-usage-client\";\nimport { supabaseUsageClient } from \"./providers/supabase-usage-client\";\nimport { googleCloudClient, GoogleAITracker } from \"./providers/google-cloud-client\";\nimport { stripeBillingClient } from \"./providers/stripe-billing-client\";\nimport { API_SERVICES, calculateFreeTierPercentage, getAlertLevel } from \"./api-service-config\";\n\nexport interface SyncResult {\n\tservice_id: string;\n\tsuccess: boolean;\n\tusage_count?: number;\n\tcost_cents?: number;\n\tfree_tier_percentage?: number;\n\talert_level?: \"normal\" | \"warning\" | \"critical\";\n\terror?: string;\n\tsynced_at: string;\n}\n\nexport interface SyncJobResult {\n\tjob_id: string;\n\tstarted_at: string;\n\tcompleted_at: string;\n\ttotal_services: number;\n\tsuccessful: number;\n\tfailed: number;\n\tresults: SyncResult[];\n}\n\n/**\n * Sync all provider usage data to database\n */\nexport async function syncAllUsage(): Promise<SyncJobResult> {\n\tconst supabase = createServiceSupabaseClient();\n\tconst jobId = crypto.randomUUID();\n\tconst startedAt = new Date().toISOString();\n\tconst results: SyncResult[] = [];\n\n\t// Create sync job record\n\tawait supabase.from(\"api_sync_jobs\").insert({\n\t\tid: jobId,\n\t\tstatus: \"running\",\n\t\tstarted_at: startedAt,\n\t});\n\n\t// Sync each provider in parallel\n\tconst syncPromises = [syncTelnyxUsage(), syncSupabaseUsage(), syncGoogleUsage(), syncStripeUsage()];\n\n\tconst syncResults = await Promise.allSettled(syncPromises);\n\n\tfor (const result of syncResults) {\n\t\tif (result.status === \"fulfilled\") {\n\t\t\tresults.push(...result.value);\n\t\t} else {\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"unknown\",\n\t\t\t\tsuccess: false,\n\t\t\t\terror: result.reason?.message || \"Unknown error\",\n\t\t\t\tsynced_at: new Date().toISOString(),\n\t\t\t});\n\t\t}\n\t}\n\n\t// Save usage data to database\n\tfor (const result of results) {\n\t\tif (result.success && result.usage_count !== undefined) {\n\t\t\tconst service = API_SERVICES[result.service_id];\n\t\t\tif (service) {\n\t\t\t\t// Update or insert realtime usage\n\t\t\t\tawait supabase.from(\"api_usage_realtime\").upsert(\n\t\t\t\t\t{\n\t\t\t\t\t\tservice_id: result.service_id,\n\t\t\t\t\t\tusage_count: result.usage_count,\n\t\t\t\t\t\tcost_cents: result.cost_cents || 0,\n\t\t\t\t\t\tfree_tier_remaining: service.free_tier ? Math.max(0, service.free_tier.monthly_limit - result.usage_count) : null,\n\t\t\t\t\t\tlast_synced: result.synced_at,\n\t\t\t\t\t\tmonth: new Date().toISOString().slice(0, 7),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tonConflict: \"service_id,month\",\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\t// Update service config with current usage\n\t\t\t\tawait supabase\n\t\t\t\t\t.from(\"api_service_config\")\n\t\t\t\t\t.update({\n\t\t\t\t\t\tcurrent_usage: result.usage_count,\n\t\t\t\t\t\tlast_checked: result.synced_at,\n\t\t\t\t\t})\n\t\t\t\t\t.eq(\"service_id\", result.service_id);\n\t\t\t}\n\t\t}\n\t}\n\n\tconst completedAt = new Date().toISOString();\n\tconst successful = results.filter((r) => r.success).length;\n\tconst failed = results.filter((r) => !r.success).length;\n\n\t// Update sync job status\n\tawait supabase\n\t\t.from(\"api_sync_jobs\")\n\t\t.update({\n\t\t\tstatus: failed === 0 ? \"completed\" : \"partial\",\n\t\t\tcompleted_at: completedAt,\n\t\t\tresults_summary: {\n\t\t\t\ttotal: results.length,\n\t\t\t\tsuccessful,\n\t\t\t\tfailed,\n\t\t\t},\n\t\t})\n\t\t.eq(\"id\", jobId);\n\n\treturn {\n\t\tjob_id: jobId,\n\t\tstarted_at: startedAt,\n\t\tcompleted_at: completedAt,\n\t\ttotal_services: results.length,\n\t\tsuccessful,\n\t\tfailed,\n\t\tresults,\n\t};\n}\n\n/**\n * Sync Telnyx voice and SMS usage\n */\nasync function syncTelnyxUsage(): Promise<SyncResult[]> {\n\tconst results: SyncResult[] = [];\n\tconst now = new Date().toISOString();\n\n\ttry {\n\t\tconst usage = await telnyxUsageClient.getCurrentMonthUsage();\n\n\t\t// Voice usage\n\t\tif (usage.voice) {\n\t\t\tconst voiceService = API_SERVICES[\"telnyx_voice\"];\n\t\t\tconst usageCount = usage.voice.total_minutes;\n\t\t\tconst freeTierPct = voiceService?.free_tier ? calculateFreeTierPercentage(usageCount, voiceService.free_tier) : 0;\n\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"telnyx_voice\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: usageCount,\n\t\t\t\tcost_cents: usage.voice.total_cost_cents,\n\t\t\t\tfree_tier_percentage: freeTierPct,\n\t\t\t\talert_level: getAlertLevel(freeTierPct),\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t} else {\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"telnyx_voice\",\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"No voice data returned\",\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t}\n\n\t\t// SMS usage\n\t\tif (usage.sms) {\n\t\t\tconst smsService = API_SERVICES[\"telnyx_sms\"];\n\t\t\tconst usageCount = usage.sms.total_messages;\n\t\t\tconst freeTierPct = smsService?.free_tier ? calculateFreeTierPercentage(usageCount, smsService.free_tier) : 0;\n\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"telnyx_sms\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: usageCount,\n\t\t\t\tcost_cents: usage.sms.total_cost_cents,\n\t\t\t\tfree_tier_percentage: freeTierPct,\n\t\t\t\talert_level: getAlertLevel(freeTierPct),\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t} else {\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"telnyx_sms\",\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"No SMS data returned\",\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t}\n\t} catch (error) {\n\t\tresults.push({\n\t\t\tservice_id: \"telnyx_voice\",\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\tsynced_at: now,\n\t\t});\n\t\tresults.push({\n\t\t\tservice_id: \"telnyx_sms\",\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\tsynced_at: now,\n\t\t});\n\t}\n\n\treturn results;\n}\n\n/**\n * Sync Supabase API usage\n */\nasync function syncSupabaseUsage(): Promise<SyncResult[]> {\n\tconst results: SyncResult[] = [];\n\tconst now = new Date().toISOString();\n\n\ttry {\n\t\tconst usage = await supabaseUsageClient.getCurrentPeriodUsage();\n\n\t\tif (usage) {\n\t\t\t// Auth requests\n\t\t\tconst authService = API_SERVICES[\"supabase_auth\"];\n\t\t\tconst authFreeTierPct = authService?.free_tier ? calculateFreeTierPercentage(usage.auth_requests, authService.free_tier) : 0;\n\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"supabase_auth\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: usage.auth_requests,\n\t\t\t\tcost_cents: 0, // Free tier\n\t\t\t\tfree_tier_percentage: authFreeTierPct,\n\t\t\t\talert_level: getAlertLevel(authFreeTierPct),\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\n\t\t\t// Database requests (REST API)\n\t\t\tconst dbService = API_SERVICES[\"supabase_database\"];\n\t\t\tconst dbFreeTierPct = dbService?.free_tier ? calculateFreeTierPercentage(usage.rest_requests, dbService.free_tier) : 0;\n\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"supabase_database\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: usage.rest_requests,\n\t\t\t\tcost_cents: 0,\n\t\t\t\tfree_tier_percentage: dbFreeTierPct,\n\t\t\t\talert_level: getAlertLevel(dbFreeTierPct),\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\n\t\t\t// Realtime requests\n\t\t\tconst realtimeService = API_SERVICES[\"supabase_realtime\"];\n\t\t\tconst realtimeFreeTierPct = realtimeService?.free_tier ? calculateFreeTierPercentage(usage.realtime_requests, realtimeService.free_tier) : 0;\n\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"supabase_realtime\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: usage.realtime_requests,\n\t\t\t\tcost_cents: 0,\n\t\t\t\tfree_tier_percentage: realtimeFreeTierPct,\n\t\t\t\talert_level: getAlertLevel(realtimeFreeTierPct),\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\n\t\t\t// Storage requests\n\t\t\tconst storageService = API_SERVICES[\"supabase_storage\"];\n\t\t\tconst storageFreeTierPct = storageService?.free_tier ? calculateFreeTierPercentage(usage.storage_requests, storageService.free_tier) : 0;\n\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"supabase_storage\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: usage.storage_requests,\n\t\t\t\tcost_cents: 0,\n\t\t\t\tfree_tier_percentage: storageFreeTierPct,\n\t\t\t\talert_level: getAlertLevel(storageFreeTierPct),\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t} else {\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"supabase_database\",\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"No usage data returned\",\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t}\n\t} catch (error) {\n\t\tresults.push({\n\t\t\tservice_id: \"supabase_database\",\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\tsynced_at: now,\n\t\t});\n\t}\n\n\treturn results;\n}\n\n/**\n * Sync Google Cloud/AI usage\n * Note: For accurate Google AI usage, internal tracking is required\n */\nasync function syncGoogleUsage(): Promise<SyncResult[]> {\n\tconst results: SyncResult[] = [];\n\tconst now = new Date().toISOString();\n\n\ttry {\n\t\tconst aiUsage = await googleCloudClient.getAIUsage();\n\t\tconst mapsUsage = await googleCloudClient.getMapsUsage();\n\n\t\t// Gemini AI\n\t\tif (aiUsage) {\n\t\t\tconst geminiService = API_SERVICES[\"google_gemini\"];\n\t\t\t// For Gemini, we track requests/tokens - need internal tracking\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"google_gemini\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: aiUsage.gemini_requests,\n\t\t\t\tcost_cents: aiUsage.total_cost_cents,\n\t\t\t\tfree_tier_percentage: 0, // Calculated internally\n\t\t\t\talert_level: \"normal\",\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t}\n\n\t\t// Google Maps\n\t\tif (mapsUsage) {\n\t\t\tconst mapsService = API_SERVICES[\"google_maps_geocoding\"];\n\t\t\tconst usageCount = mapsUsage.geocoding_requests;\n\t\t\tconst freeTierPct = mapsService?.free_tier ? calculateFreeTierPercentage(usageCount, mapsService.free_tier) : 0;\n\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"google_maps_geocoding\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: usageCount,\n\t\t\t\tcost_cents: mapsUsage.total_cost_cents,\n\t\t\t\tfree_tier_percentage: freeTierPct,\n\t\t\t\talert_level: getAlertLevel(freeTierPct),\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t}\n\t} catch (error) {\n\t\tresults.push({\n\t\t\tservice_id: \"google_gemini\",\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\tsynced_at: now,\n\t\t});\n\t}\n\n\treturn results;\n}\n\n/**\n * Sync Stripe billing/fees\n */\nasync function syncStripeUsage(): Promise<SyncResult[]> {\n\tconst results: SyncResult[] = [];\n\tconst now = new Date().toISOString();\n\n\ttry {\n\t\tconst stats = await stripeBillingClient.getCurrentMonthStats();\n\n\t\tif (stats) {\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"stripe_payments\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: stats.transaction_count,\n\t\t\t\tcost_cents: stats.fees_cents,\n\t\t\t\tfree_tier_percentage: 0, // Stripe has no free tier\n\t\t\t\talert_level: \"normal\",\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t} else {\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"stripe_payments\",\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"No billing data returned\",\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t}\n\t} catch (error) {\n\t\tresults.push({\n\t\t\tservice_id: \"stripe_payments\",\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\tsynced_at: now,\n\t\t});\n\t}\n\n\treturn results;\n}\n\n/**\n * Get current usage summary from database\n */\nexport async function getUsageSummary(): Promise<{\n\tservices: Array<{\n\t\tservice_id: string;\n\t\tdisplay_name: string;\n\t\tcategory: string;\n\t\tusage_count: number;\n\t\tcost_cents: number;\n\t\tfree_tier_remaining: number | null;\n\t\tfree_tier_percentage: number;\n\t\talert_level: string;\n\t\tlast_synced: string | null;\n\t}>;\n\ttotal_cost_cents: number;\n\tservices_at_risk: number;\n} | null> {\n\tconst supabase = createServiceSupabaseClient();\n\n\t// Get current month's usage\n\tconst currentMonth = new Date().toISOString().slice(0, 7);\n\n\tconst { data: usageData, error: usageError } = await supabase.from(\"api_usage_realtime\").select(\"*\").eq(\"month\", currentMonth);\n\n\tif (usageError) {\n\t\tconsole.error(\"Error fetching usage:\", usageError);\n\t\treturn null;\n\t}\n\n\t// Build summary from config + usage data\n\tconst services = Object.entries(API_SERVICES).map(([serviceId, config]) => {\n\t\tconst usage = usageData?.find((u) => u.service_id === serviceId);\n\t\tconst usageCount = usage?.usage_count || 0;\n\t\tconst costCents = usage?.cost_cents || 0;\n\t\tconst freeTierRemaining = usage?.free_tier_remaining;\n\t\tconst freeTierPct = config.free_tier ? calculateFreeTierPercentage(usageCount, config.free_tier) : 0;\n\n\t\treturn {\n\t\t\tservice_id: serviceId,\n\t\t\tdisplay_name: config.display_name,\n\t\t\tcategory: config.category,\n\t\t\tusage_count: usageCount,\n\t\t\tcost_cents: costCents,\n\t\t\tfree_tier_remaining: freeTierRemaining,\n\t\t\tfree_tier_percentage: freeTierPct,\n\t\t\talert_level: getAlertLevel(freeTierPct),\n\t\t\tlast_synced: usage?.last_synced || null,\n\t\t};\n\t});\n\n\tconst totalCostCents = services.reduce((sum, s) => sum + s.cost_cents, 0);\n\tconst servicesAtRisk = services.filter((s) => s.alert_level === \"warning\" || s.alert_level === \"critical\").length;\n\n\treturn {\n\t\tservices,\n\t\ttotal_cost_cents: totalCostCents,\n\t\tservices_at_risk: servicesAtRisk,\n\t};\n}\n\n/**\n * Get services approaching their free tier limits\n */\nexport async function getServicesApproachingLimits(): Promise<\n\tArray<{\n\t\tservice_id: string;\n\t\tdisplay_name: string;\n\t\tusage_count: number;\n\t\tfree_tier_limit: number;\n\t\tpercentage_used: number;\n\t\talert_level: string;\n\t}>\n> {\n\tconst summary = await getUsageSummary();\n\tif (!summary) return [];\n\n\treturn summary.services\n\t\t.filter((s) => s.alert_level === \"warning\" || s.alert_level === \"critical\")\n\t\t.map((s) => {\n\t\t\tconst config = API_SERVICES[s.service_id];\n\t\t\treturn {\n\t\t\t\tservice_id: s.service_id,\n\t\t\t\tdisplay_name: s.display_name,\n\t\t\t\tusage_count: s.usage_count,\n\t\t\t\tfree_tier_limit: config?.free_tier?.monthly_limit || 0,\n\t\t\t\tpercentage_used: s.free_tier_percentage,\n\t\t\t\talert_level: s.alert_level,\n\t\t\t};\n\t\t})\n\t\t.sort((a, b) => b.percentage_used - a.percentage_used);\n}\n\n/**\n * Track internal API usage (for APIs without external tracking)\n */\nexport async function trackInternalUsage(serviceId: string, incrementBy: number = 1, costCents: number = 0): Promise<void> {\n\tconst supabase = createServiceSupabaseClient();\n\tconst currentMonth = new Date().toISOString().slice(0, 7);\n\n\t// Upsert usage record\n\tconst { data: existing } = await supabase.from(\"api_usage_realtime\").select(\"usage_count, cost_cents\").eq(\"service_id\", serviceId).eq(\"month\", currentMonth).single();\n\n\tconst newUsageCount = (existing?.usage_count || 0) + incrementBy;\n\tconst newCostCents = (existing?.cost_cents || 0) + costCents;\n\n\tconst service = API_SERVICES[serviceId];\n\tconst freeTierRemaining = service?.free_tier ? Math.max(0, service.free_tier.monthly_limit - newUsageCount) : null;\n\n\tawait supabase.from(\"api_usage_realtime\").upsert(\n\t\t{\n\t\t\tservice_id: serviceId,\n\t\t\tmonth: currentMonth,\n\t\t\tusage_count: newUsageCount,\n\t\t\tcost_cents: newCostCents,\n\t\t\tfree_tier_remaining: freeTierRemaining,\n\t\t\tlast_synced: new Date().toISOString(),\n\t\t},\n\t\t{\n\t\t\tonConflict: \"service_id,month\",\n\t\t}\n\t);\n}\n","/**\n * API Usage Dashboard Page\n *\n * Displays real-time API usage, costs, and health status.\n * Admin-only access for monitoring external service integrations.\n */\n\nimport { Suspense } from \"react\";\nimport { ApiUsageData } from \"@/components/settings/api-usage/api-usage-data\";\nimport { ApiUsageSkeleton } from \"@/components/settings/api-usage/api-usage-skeleton\";\n\n// Force dynamic rendering - this page requires authentication and real-time data\nexport const dynamic = \"force-dynamic\";\n\nexport const metadata = {\n\ttitle: \"API Usage & Costs | Settings\",\n\tdescription: \"Monitor API usage, costs, and service health across all integrations\",\n};\n\nexport default function ApiUsagePage() {\n\treturn (\n\t\t<Suspense fallback={<ApiUsageSkeleton />}>\n\t\t\t<ApiUsageData />\n\t\t</Suspense>\n\t);\n}\n","import { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nexport function ApiUsageSkeleton() {\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t{/* Header */}\n\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t<div>\n\t\t\t\t\t<Skeleton className=\"h-9 w-64\" />\n\t\t\t\t\t<Skeleton className=\"mt-2 h-5 w-96\" />\n\t\t\t\t</div>\n\t\t\t\t<Skeleton className=\"h-6 w-32\" />\n\t\t\t</div>\n\n\t\t\t{/* Overview Stats */}\n\t\t\t<div className=\"grid grid-cols-1 gap-4 md:grid-cols-4\">\n\t\t\t\t{[...Array(4)].map((_, i) => (\n\t\t\t\t\t<Card key={i}>\n\t\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t\t<Skeleton className=\"h-4 w-32\" />\n\t\t\t\t\t\t</CardHeader>\n\t\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t\t<Skeleton className=\"h-9 w-24\" />\n\t\t\t\t\t\t\t<Skeleton className=\"mt-2 h-3 w-40\" />\n\t\t\t\t\t\t</CardContent>\n\t\t\t\t\t</Card>\n\t\t\t\t))}\n\t\t\t</div>\n\n\t\t\t{/* Alert Card */}\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<Skeleton className=\"h-6 w-64\" />\n\t\t\t\t\t<Skeleton className=\"mt-2 h-4 w-96\" />\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t{[...Array(2)].map((_, i) => (\n\t\t\t\t\t\t\t<div key={i} className=\"flex items-center justify-between rounded-lg border p-4\">\n\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-5 w-40\" />\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"mt-2 h-4 w-32\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<Skeleton className=\"h-2 w-32\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t{/* Health Status */}\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<Skeleton className=\"h-6 w-48\" />\n\t\t\t\t\t<Skeleton className=\"mt-2 h-4 w-72\" />\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"mb-4 flex gap-4\">\n\t\t\t\t\t\t<Skeleton className=\"h-5 w-24\" />\n\t\t\t\t\t\t<Skeleton className=\"h-5 w-24\" />\n\t\t\t\t\t\t<Skeleton className=\"h-5 w-24\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-2 md:grid-cols-4 lg:grid-cols-6\">\n\t\t\t\t\t\t{[...Array(12)].map((_, i) => (\n\t\t\t\t\t\t\t<Skeleton key={i} className=\"h-10 w-full\" />\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t{/* Usage Cards */}\n\t\t\t{[...Array(3)].map((_, i) => (\n\t\t\t\t<Card key={i}>\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<Skeleton className=\"h-6 w-40\" />\n\t\t\t\t\t\t<Skeleton className=\"mt-2 h-4 w-64\" />\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{[...Array(3)].map((_, j) => (\n\t\t\t\t\t\t\t\t<div key={j} className=\"rounded-lg border p-4\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-5 w-48\" />\n\t\t\t\t\t\t\t\t\t\t\t<Skeleton className=\"mt-2 h-4 w-64\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-2 w-40\" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t))}\n\n\t\t\t{/* Cost Breakdown */}\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<Skeleton className=\"h-6 w-48\" />\n\t\t\t\t\t<Skeleton className=\"mt-2 h-4 w-56\" />\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t{[...Array(4)].map((_, i) => (\n\t\t\t\t\t\t\t<div key={i} className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-5 w-32\" />\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"mt-1 h-4 w-24\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-4\">\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-2 w-32\" />\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-5 w-20\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t))}\n\t\t\t\t\t\t<div className=\"mt-4 flex items-center justify-between border-t pt-4\">\n\t\t\t\t\t\t\t<Skeleton className=\"h-6 w-48\" />\n\t\t\t\t\t\t\t<Skeleton className=\"h-6 w-24\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['rect', { width: '20', height: '8', x: '2', y: '2', rx: '2', ry: '2', key: 'ngkwjq' }],\n  ['rect', { width: '20', height: '8', x: '2', y: '14', rx: '2', ry: '2', key: 'iecqi9' }],\n  ['line', { x1: '6', x2: '6.01', y1: '6', y2: '6', key: '16zg32' }],\n  ['line', { x1: '6', x2: '6.01', y1: '18', y2: '18', key: 'nzw8ys' }],\n];\n\n/**\n * @component @name Server\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cmVjdCB3aWR0aD0iMjAiIGhlaWdodD0iOCIgeD0iMiIgeT0iMiIgcng9IjIiIHJ5PSIyIiAvPgogIDxyZWN0IHdpZHRoPSIyMCIgaGVpZ2h0PSI4IiB4PSIyIiB5PSIxNCIgcng9IjIiIHJ5PSIyIiAvPgogIDxsaW5lIHgxPSI2IiB4Mj0iNi4wMSIgeTE9IjYiIHkyPSI2IiAvPgogIDxsaW5lIHgxPSI2IiB4Mj0iNi4wMSIgeTE9IjE4IiB5Mj0iMTgiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/server\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Server = createLucideIcon('server', __iconNode);\n\nexport default Server;\n","/**\n * Supabase Management API Usage Client\n *\n * Fetches real usage data from Supabase Management API\n * Docs: https://supabase.com/docs/reference/api/introduction\n */\n\nexport interface SupabaseUsageStats {\n\ttotal_auth_requests: number;\n\ttotal_realtime_requests: number;\n\ttotal_rest_requests: number;\n\ttotal_storage_requests: number;\n\ttimestamp: string;\n}\n\nexport interface SupabaseProjectStats {\n\tdatabase_size_bytes: number;\n\tstorage_size_bytes: number;\n\tegress_bytes: number;\n\tmau: number;\n\tedge_function_invocations: number;\n}\n\ninterface ApiCountsResponse {\n\tdata: Array<{\n\t\ttotal_auth_requests: number;\n\t\ttotal_realtime_requests: number;\n\t\ttotal_rest_requests: number;\n\t\ttotal_storage_requests: number;\n\t\ttimestamp: string;\n\t}>;\n}\n\n/**\n * Supabase Usage Client\n * Requires SUPABASE_MANAGEMENT_PAT environment variable\n */\nexport class SupabaseUsageClient {\n\tprivate baseUrl = \"https://api.supabase.com/v1\";\n\tprivate accessToken: string;\n\tprivate projectRef: string;\n\n\tconstructor() {\n\t\tconst token = process.env.SUPABASE_MANAGEMENT_PAT;\n\t\tconst projectRef = process.env.NEXT_PUBLIC_SUPABASE_URL?.match(/https:\\/\\/([^.]+)\\.supabase\\.co/)?.[1];\n\n\t\tif (!token) {\n\t\t\tconsole.warn(\"SUPABASE_MANAGEMENT_PAT not set - Supabase usage tracking disabled\");\n\t\t}\n\n\t\tthis.accessToken = token || \"\";\n\t\tthis.projectRef = projectRef || \"\";\n\t}\n\n\tprivate async fetch<T>(endpoint: string, params?: Record<string, string>): Promise<T | null> {\n\t\tif (!this.accessToken || !this.projectRef) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst url = new URL(`${this.baseUrl}${endpoint}`);\n\t\tif (params) {\n\t\t\tObject.entries(params).forEach(([key, value]) => {\n\t\t\t\turl.searchParams.append(key, value);\n\t\t\t});\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await fetch(url.toString(), {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${this.accessToken}`,\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.error(`Supabase API error: ${response.status} ${response.statusText}`);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn (await response.json()) as T;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Supabase API fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get API request counts for the project\n\t * Returns auth, realtime, rest, and storage request counts\n\t */\n\tasync getApiCounts(interval: \"hourly\" | \"daily\" = \"daily\"): Promise<SupabaseUsageStats[] | null> {\n\t\tconst response = await this.fetch<ApiCountsResponse>(`/projects/${this.projectRef}/analytics/endpoints/usage.api-counts`, {\n\t\t\tinterval,\n\t\t});\n\n\t\treturn response?.data || null;\n\t}\n\n\t/**\n\t * Get total API request count for the project\n\t */\n\tasync getTotalApiRequestCount(): Promise<number | null> {\n\t\tconst response = await this.fetch<{ count: number }>(`/projects/${this.projectRef}/analytics/endpoints/usage.api-requests-count`);\n\n\t\treturn response?.count || null;\n\t}\n\n\t/**\n\t * Get project database size\n\t */\n\tasync getDatabaseSize(): Promise<number | null> {\n\t\t// This would require querying the database directly\n\t\t// The Management API doesn't expose database size directly\n\t\t// We can get this from pg_database_size() if needed\n\t\treturn null;\n\t}\n\n\t/**\n\t * Get aggregated usage for the current billing period\n\t */\n\tasync getCurrentPeriodUsage(): Promise<{\n\t\tauth_requests: number;\n\t\trest_requests: number;\n\t\trealtime_requests: number;\n\t\tstorage_requests: number;\n\t\ttotal_requests: number;\n\t} | null> {\n\t\tconst stats = await this.getApiCounts(\"daily\");\n\t\tif (!stats || stats.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Aggregate all stats for the current period\n\t\tconst aggregated = stats.reduce(\n\t\t\t(acc, stat) => ({\n\t\t\t\tauth_requests: acc.auth_requests + stat.total_auth_requests,\n\t\t\t\trest_requests: acc.rest_requests + stat.total_rest_requests,\n\t\t\t\trealtime_requests: acc.realtime_requests + stat.total_realtime_requests,\n\t\t\t\tstorage_requests: acc.storage_requests + stat.total_storage_requests,\n\t\t\t\ttotal_requests: acc.total_requests + stat.total_auth_requests + stat.total_rest_requests + stat.total_realtime_requests + stat.total_storage_requests,\n\t\t\t}),\n\t\t\t{\n\t\t\t\tauth_requests: 0,\n\t\t\t\trest_requests: 0,\n\t\t\t\trealtime_requests: 0,\n\t\t\t\tstorage_requests: 0,\n\t\t\t\ttotal_requests: 0,\n\t\t\t}\n\t\t);\n\n\t\treturn aggregated;\n\t}\n\n\t/**\n\t * Check if the Supabase API is healthy\n\t */\n\tasync checkHealth(): Promise<{ healthy: boolean; responseTimeMs: number; error?: string }> {\n\t\tconst startTime = Date.now();\n\n\t\ttry {\n\t\t\tconst response = await fetch(`${this.baseUrl}/projects`, {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${this.accessToken}`,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst responseTimeMs = Date.now() - startTime;\n\n\t\t\tif (response.ok) {\n\t\t\t\treturn { healthy: true, responseTimeMs };\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\thealthy: false,\n\t\t\t\tresponseTimeMs,\n\t\t\t\terror: `HTTP ${response.status}: ${response.statusText}`,\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn {\n\t\t\t\thealthy: false,\n\t\t\t\tresponseTimeMs: Date.now() - startTime,\n\t\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\t};\n\t\t}\n\t}\n}\n\n// Export singleton instance\nexport const supabaseUsageClient = new SupabaseUsageClient();\n","/**\n * API Health Check Service\n *\n * Monitors availability and response times for all external APIs\n * Calculates uptime percentages and tracks service health history\n */\n\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\nimport { telnyxUsageClient } from \"./providers/telnyx-usage-client\";\nimport { supabaseUsageClient } from \"./providers/supabase-usage-client\";\nimport { googleCloudClient } from \"./providers/google-cloud-client\";\nimport { stripeBillingClient } from \"./providers/stripe-billing-client\";\nimport { API_SERVICES } from \"./api-service-config\";\n\nexport interface HealthCheckResult {\n\tservice_id: string;\n\thealthy: boolean;\n\tresponse_time_ms: number;\n\terror?: string;\n\tchecked_at: string;\n}\n\nexport interface ServiceHealthStatus {\n\tservice_id: string;\n\tdisplay_name: string;\n\tcategory: string;\n\tcurrent_status: \"healthy\" | \"degraded\" | \"down\";\n\tuptime_24h: number;\n\tuptime_7d: number;\n\tuptime_30d: number;\n\taverage_response_ms: number;\n\tlast_checked: string | null;\n\tlast_error: string | null;\n\tconsecutive_failures: number;\n}\n\nexport interface HealthCheckJobResult {\n\tjob_id: string;\n\tstarted_at: string;\n\tcompleted_at: string;\n\ttotal_services: number;\n\thealthy: number;\n\tunhealthy: number;\n\tresults: HealthCheckResult[];\n}\n\n/**\n * Health check endpoints for each service\n */\nconst HEALTH_ENDPOINTS: Record<\n\tstring,\n\t{\n\t\tcheck: () => Promise<{ healthy: boolean; responseTimeMs: number; error?: string }>;\n\t}\n> = {\n\t// Telnyx\n\ttelnyx_voice: { check: () => telnyxUsageClient.checkHealth() },\n\ttelnyx_sms: { check: () => telnyxUsageClient.checkHealth() },\n\n\t// Supabase\n\tsupabase_database: { check: () => supabaseUsageClient.checkHealth() },\n\tsupabase_auth: { check: () => supabaseUsageClient.checkHealth() },\n\tsupabase_storage: { check: () => supabaseUsageClient.checkHealth() },\n\tsupabase_realtime: { check: () => supabaseUsageClient.checkHealth() },\n\n\t// Google Cloud\n\tgoogle_gemini: { check: () => googleCloudClient.checkHealth() },\n\tgoogle_maps_geocoding: { check: () => checkGoogleMapsHealth() },\n\n\t// Stripe\n\tstripe_payments: { check: () => stripeBillingClient.checkHealth() },\n\n\t// External APIs - simple HTTP checks\n\tresend: { check: () => checkHttpEndpoint(\"https://api.resend.com/emails\", \"Resend\") },\n\tassembly_ai: { check: () => checkHttpEndpoint(\"https://api.assemblyai.com/v2/transcript\", \"AssemblyAI\") },\n\twalkscore: { check: () => checkHttpEndpoint(\"https://api.walkscore.com/score\", \"WalkScore\") },\n\tcensus_bureau: { check: () => checkHttpEndpoint(\"https://api.census.gov/data.json\", \"Census Bureau\") },\n\n\t// Vercel\n\tvercel_hosting: { check: () => checkVercelHealth() },\n};\n\n/**\n * Run health checks on all configured services\n */\nexport async function runHealthChecks(): Promise<HealthCheckJobResult> {\n\tconst supabase = createServiceSupabaseClient();\n\tconst jobId = crypto.randomUUID();\n\tconst startedAt = new Date().toISOString();\n\tconst results: HealthCheckResult[] = [];\n\n\t// Run all health checks in parallel\n\tconst checkPromises = Object.entries(HEALTH_ENDPOINTS).map(async ([serviceId, { check }]) => {\n\t\ttry {\n\t\t\tconst result = await check();\n\t\t\treturn {\n\t\t\t\tservice_id: serviceId,\n\t\t\t\thealthy: result.healthy,\n\t\t\t\tresponse_time_ms: result.responseTimeMs,\n\t\t\t\terror: result.error,\n\t\t\t\tchecked_at: new Date().toISOString(),\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn {\n\t\t\t\tservice_id: serviceId,\n\t\t\t\thealthy: false,\n\t\t\t\tresponse_time_ms: 0,\n\t\t\t\terror: error instanceof Error ? error.message : \"Health check failed\",\n\t\t\t\tchecked_at: new Date().toISOString(),\n\t\t\t};\n\t\t}\n\t});\n\n\tconst checkResults = await Promise.allSettled(checkPromises);\n\n\tfor (const result of checkResults) {\n\t\tif (result.status === \"fulfilled\") {\n\t\t\tresults.push(result.value);\n\t\t}\n\t}\n\n\t// Save health check results to database\n\tfor (const result of results) {\n\t\t// Insert health log entry\n\t\tawait supabase.from(\"api_health_log\").insert({\n\t\t\tservice_id: result.service_id,\n\t\t\tis_healthy: result.healthy,\n\t\t\tresponse_time_ms: result.response_time_ms,\n\t\t\terror_message: result.error || null,\n\t\t\tchecked_at: result.checked_at,\n\t\t});\n\n\t\t// Update service config with health status\n\t\tawait supabase\n\t\t\t.from(\"api_service_config\")\n\t\t\t.update({\n\t\t\t\tis_healthy: result.healthy,\n\t\t\t\tlast_checked: result.checked_at,\n\t\t\t\tlast_response_time_ms: result.response_time_ms,\n\t\t\t})\n\t\t\t.eq(\"service_id\", result.service_id);\n\t}\n\n\tconst completedAt = new Date().toISOString();\n\tconst healthy = results.filter((r) => r.healthy).length;\n\tconst unhealthy = results.filter((r) => !r.healthy).length;\n\n\treturn {\n\t\tjob_id: jobId,\n\t\tstarted_at: startedAt,\n\t\tcompleted_at: completedAt,\n\t\ttotal_services: results.length,\n\t\thealthy,\n\t\tunhealthy,\n\t\tresults,\n\t};\n}\n\n/**\n * Get current health status for all services\n */\nexport async function getServiceHealthStatus(): Promise<ServiceHealthStatus[]> {\n\tconst supabase = createServiceSupabaseClient();\n\n\t// Get recent health logs\n\tconst now = new Date();\n\tconst twentyFourHoursAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n\tconst sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n\tconst thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\n\n\tconst results: ServiceHealthStatus[] = [];\n\n\tfor (const [serviceId, config] of Object.entries(API_SERVICES)) {\n\t\t// Skip services without health checks\n\t\tif (!HEALTH_ENDPOINTS[serviceId]) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Get health logs for different time periods\n\t\tconst { data: logs24h } = await supabase.from(\"api_health_log\").select(\"is_healthy, response_time_ms\").eq(\"service_id\", serviceId).gte(\"checked_at\", twentyFourHoursAgo.toISOString());\n\n\t\tconst { data: logs7d } = await supabase.from(\"api_health_log\").select(\"is_healthy\").eq(\"service_id\", serviceId).gte(\"checked_at\", sevenDaysAgo.toISOString());\n\n\t\tconst { data: logs30d } = await supabase.from(\"api_health_log\").select(\"is_healthy\").eq(\"service_id\", serviceId).gte(\"checked_at\", thirtyDaysAgo.toISOString());\n\n\t\t// Get most recent log\n\t\tconst { data: latestLog } = await supabase.from(\"api_health_log\").select(\"*\").eq(\"service_id\", serviceId).order(\"checked_at\", { ascending: false }).limit(1).single();\n\n\t\t// Calculate uptimes\n\t\tconst calculateUptime = (logs: Array<{ is_healthy: boolean }> | null): number => {\n\t\t\tif (!logs || logs.length === 0) return 100;\n\t\t\tconst healthy = logs.filter((l) => l.is_healthy).length;\n\t\t\treturn Math.round((healthy / logs.length) * 10000) / 100;\n\t\t};\n\n\t\t// Calculate average response time\n\t\tconst calculateAvgResponseTime = (logs: Array<{ response_time_ms: number }> | null): number => {\n\t\t\tif (!logs || logs.length === 0) return 0;\n\t\t\tconst total = logs.reduce((sum, l) => sum + (l.response_time_ms || 0), 0);\n\t\t\treturn Math.round(total / logs.length);\n\t\t};\n\n\t\t// Count consecutive failures\n\t\tconst { data: recentLogs } = await supabase.from(\"api_health_log\").select(\"is_healthy\").eq(\"service_id\", serviceId).order(\"checked_at\", { ascending: false }).limit(10);\n\n\t\tlet consecutiveFailures = 0;\n\t\tif (recentLogs) {\n\t\t\tfor (const log of recentLogs) {\n\t\t\t\tif (!log.is_healthy) {\n\t\t\t\t\tconsecutiveFailures++;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Determine current status\n\t\tlet currentStatus: \"healthy\" | \"degraded\" | \"down\" = \"healthy\";\n\t\tconst uptime24h = calculateUptime(logs24h);\n\n\t\tif (consecutiveFailures >= 3 || uptime24h < 50) {\n\t\t\tcurrentStatus = \"down\";\n\t\t} else if (consecutiveFailures >= 1 || uptime24h < 95) {\n\t\t\tcurrentStatus = \"degraded\";\n\t\t}\n\n\t\tresults.push({\n\t\t\tservice_id: serviceId,\n\t\t\tdisplay_name: config.display_name,\n\t\t\tcategory: config.category,\n\t\t\tcurrent_status: currentStatus,\n\t\t\tuptime_24h: uptime24h,\n\t\t\tuptime_7d: calculateUptime(logs7d),\n\t\t\tuptime_30d: calculateUptime(logs30d),\n\t\t\taverage_response_ms: calculateAvgResponseTime(logs24h),\n\t\t\tlast_checked: latestLog?.checked_at || null,\n\t\t\tlast_error: latestLog?.error_message || null,\n\t\t\tconsecutive_failures: consecutiveFailures,\n\t\t});\n\t}\n\n\treturn results;\n}\n\n/**\n * Get overall system health summary\n */\nexport async function getSystemHealthSummary(): Promise<{\n\toverall_status: \"healthy\" | \"degraded\" | \"critical\";\n\thealthy_services: number;\n\tdegraded_services: number;\n\tdown_services: number;\n\taverage_uptime_24h: number;\n\tservices: ServiceHealthStatus[];\n}> {\n\tconst services = await getServiceHealthStatus();\n\n\tconst healthy = services.filter((s) => s.current_status === \"healthy\").length;\n\tconst degraded = services.filter((s) => s.current_status === \"degraded\").length;\n\tconst down = services.filter((s) => s.current_status === \"down\").length;\n\n\t// Calculate average 24h uptime\n\tconst avgUptime = services.length > 0 ? services.reduce((sum, s) => sum + s.uptime_24h, 0) / services.length : 100;\n\n\t// Determine overall status\n\tlet overallStatus: \"healthy\" | \"degraded\" | \"critical\" = \"healthy\";\n\tif (down > 0 || avgUptime < 90) {\n\t\toverallStatus = \"critical\";\n\t} else if (degraded > 0 || avgUptime < 99) {\n\t\toverallStatus = \"degraded\";\n\t}\n\n\treturn {\n\t\toverall_status: overallStatus,\n\t\thealthy_services: healthy,\n\t\tdegraded_services: degraded,\n\t\tdown_services: down,\n\t\taverage_uptime_24h: Math.round(avgUptime * 100) / 100,\n\t\tservices,\n\t};\n}\n\n/**\n * Helper: Check a simple HTTP endpoint\n */\nasync function checkHttpEndpoint(url: string, serviceName: string): Promise<{ healthy: boolean; responseTimeMs: number; error?: string }> {\n\tconst startTime = Date.now();\n\n\ttry {\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: \"HEAD\",\n\t\t\tsignal: AbortSignal.timeout(10000), // 10 second timeout\n\t\t});\n\n\t\tconst responseTimeMs = Date.now() - startTime;\n\n\t\t// Consider 2xx-4xx as healthy (API is responding)\n\t\t// 5xx indicates server issues\n\t\tif (response.status < 500) {\n\t\t\treturn { healthy: true, responseTimeMs };\n\t\t}\n\n\t\treturn {\n\t\t\thealthy: false,\n\t\t\tresponseTimeMs,\n\t\t\terror: `HTTP ${response.status}`,\n\t\t};\n\t} catch (error) {\n\t\treturn {\n\t\t\thealthy: false,\n\t\t\tresponseTimeMs: Date.now() - startTime,\n\t\t\terror: error instanceof Error ? error.message : \"Connection failed\",\n\t\t};\n\t}\n}\n\n/**\n * Helper: Check Google Maps API health\n */\nasync function checkGoogleMapsHealth(): Promise<{ healthy: boolean; responseTimeMs: number; error?: string }> {\n\tconst apiKey = process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY;\n\n\tif (!apiKey) {\n\t\treturn { healthy: true, responseTimeMs: 0, error: \"API key not configured\" };\n\t}\n\n\treturn checkHttpEndpoint(`https://maps.googleapis.com/maps/api/geocode/json?address=test&key=${apiKey}`, \"Google Maps\");\n}\n\n/**\n * Helper: Check Vercel hosting health\n */\nasync function checkVercelHealth(): Promise<{ healthy: boolean; responseTimeMs: number; error?: string }> {\n\tconst projectUrl = process.env.NEXT_PUBLIC_APP_URL || process.env.VERCEL_URL;\n\n\tif (!projectUrl) {\n\t\treturn { healthy: true, responseTimeMs: 0, error: \"URL not configured\" };\n\t}\n\n\tconst url = projectUrl.startsWith(\"http\") ? projectUrl : `https://${projectUrl}`;\n\treturn checkHttpEndpoint(`${url}/api/health`, \"Vercel\");\n}\n\n/**\n * Get service health history for charting\n */\nexport async function getServiceHealthHistory(\n\tserviceId: string,\n\thours: number = 24\n): Promise<\n\tArray<{\n\t\ttimestamp: string;\n\t\tis_healthy: boolean;\n\t\tresponse_time_ms: number;\n\t}>\n> {\n\tconst supabase = createServiceSupabaseClient();\n\tconst since = new Date(Date.now() - hours * 60 * 60 * 1000);\n\n\tconst { data, error } = await supabase.from(\"api_health_log\").select(\"checked_at, is_healthy, response_time_ms\").eq(\"service_id\", serviceId).gte(\"checked_at\", since.toISOString()).order(\"checked_at\", { ascending: true });\n\n\tif (error) {\n\t\tconsole.error(\"Error fetching health history:\", error);\n\t\treturn [];\n\t}\n\n\treturn (\n\t\tdata?.map((log) => ({\n\t\t\ttimestamp: log.checked_at,\n\t\t\tis_healthy: log.is_healthy,\n\t\t\tresponse_time_ms: log.response_time_ms,\n\t\t})) || []\n\t);\n}\n","/**\n * Stripe Billing & Usage Client\n *\n * Fetches transaction data and calculates processing fees from Stripe\n * Docs: https://stripe.com/docs/api\n *\n * Stripe fees are percentage-based:\n * - 2.9% + $0.30 per successful card charge (US)\n * - 0.5% additional for international cards\n * - 1% additional for currency conversion\n */\n\nexport interface StripeUsage {\n\ttotal_transactions: number;\n\ttotal_volume_cents: number;\n\ttotal_fees_cents: number;\n\tsuccessful_charges: number;\n\tfailed_charges: number;\n\trefunds_count: number;\n\trefunds_amount_cents: number;\n\tdisputes_count: number;\n}\n\nexport interface StripeMonthlyStats {\n\tgross_volume_cents: number;\n\tnet_volume_cents: number;\n\tfees_cents: number;\n\trefunds_cents: number;\n\ttransaction_count: number;\n\taverage_transaction_cents: number;\n}\n\ninterface StripeBalanceTransaction {\n\tid: string;\n\tamount: number;\n\tfee: number;\n\tnet: number;\n\ttype: string;\n\tcreated: number;\n\tstatus: string;\n}\n\ninterface StripeListResponse<T> {\n\tobject: \"list\";\n\tdata: T[];\n\thas_more: boolean;\n\turl: string;\n}\n\n/**\n * Stripe Billing Client\n * Requires STRIPE_SECRET_KEY environment variable\n */\nexport class StripeBillingClient {\n\tprivate baseUrl = \"https://api.stripe.com/v1\";\n\tprivate secretKey: string;\n\n\tconstructor() {\n\t\tconst secretKey = process.env.STRIPE_SECRET_KEY;\n\n\t\tif (!secretKey) {\n\t\t\tconsole.warn(\"STRIPE_SECRET_KEY not set - Stripe billing tracking disabled\");\n\t\t}\n\n\t\tthis.secretKey = secretKey || \"\";\n\t}\n\n\tprivate async fetch<T>(endpoint: string, params?: Record<string, string>): Promise<T | null> {\n\t\tif (!this.secretKey) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst url = new URL(`${this.baseUrl}${endpoint}`);\n\t\tif (params) {\n\t\t\tObject.entries(params).forEach(([key, value]) => {\n\t\t\t\turl.searchParams.append(key, value);\n\t\t\t});\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await fetch(url.toString(), {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${this.secretKey}`,\n\t\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded\",\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.error(`Stripe API error: ${response.status} ${response.statusText}`);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn (await response.json()) as T;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Stripe API fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get the current month's date range as Unix timestamps\n\t */\n\tprivate getCurrentMonthRange(): { startTimestamp: number; endTimestamp: number } {\n\t\tconst now = new Date();\n\t\tconst startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n\t\tconst endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59);\n\n\t\treturn {\n\t\t\tstartTimestamp: Math.floor(startOfMonth.getTime() / 1000),\n\t\t\tendTimestamp: Math.floor(endOfMonth.getTime() / 1000),\n\t\t};\n\t}\n\n\t/**\n\t * Get balance transactions for the current month\n\t * This includes all fees, charges, refunds, etc.\n\t */\n\tasync getBalanceTransactions(limit = 100): Promise<StripeBalanceTransaction[] | null> {\n\t\tconst { startTimestamp, endTimestamp } = this.getCurrentMonthRange();\n\n\t\tconst response = await this.fetch<StripeListResponse<StripeBalanceTransaction>>(\"/balance_transactions\", {\n\t\t\tlimit: limit.toString(),\n\t\t\t\"created[gte]\": startTimestamp.toString(),\n\t\t\t\"created[lte]\": endTimestamp.toString(),\n\t\t});\n\n\t\treturn response?.data || null;\n\t}\n\n\t/**\n\t * Get monthly statistics including fees\n\t */\n\tasync getCurrentMonthStats(): Promise<StripeMonthlyStats | null> {\n\t\tconst transactions = await this.getBalanceTransactions(100);\n\n\t\tif (!transactions) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet grossVolume = 0;\n\t\tlet netVolume = 0;\n\t\tlet totalFees = 0;\n\t\tlet refundsAmount = 0;\n\t\tlet chargeCount = 0;\n\n\t\tfor (const txn of transactions) {\n\t\t\tswitch (txn.type) {\n\t\t\t\tcase \"charge\":\n\t\t\t\t\tgrossVolume += txn.amount;\n\t\t\t\t\tnetVolume += txn.net;\n\t\t\t\t\ttotalFees += txn.fee;\n\t\t\t\t\tchargeCount++;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"refund\":\n\t\t\t\t\trefundsAmount += Math.abs(txn.amount);\n\t\t\t\t\tnetVolume += txn.net; // Negative for refunds\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"payout\":\n\t\t\t\t\t// Don't count payouts in volume\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t// Other transaction types (adjustments, etc.)\n\t\t\t\t\tnetVolume += txn.net;\n\t\t\t\t\ttotalFees += txn.fee;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tgross_volume_cents: grossVolume,\n\t\t\tnet_volume_cents: netVolume,\n\t\t\tfees_cents: totalFees,\n\t\t\trefunds_cents: refundsAmount,\n\t\t\ttransaction_count: chargeCount,\n\t\t\taverage_transaction_cents: chargeCount > 0 ? Math.round(grossVolume / chargeCount) : 0,\n\t\t};\n\t}\n\n\t/**\n\t * Get detailed usage statistics\n\t */\n\tasync getUsage(): Promise<StripeUsage | null> {\n\t\tconst { startTimestamp, endTimestamp } = this.getCurrentMonthRange();\n\n\t\t// Fetch charges for the month\n\t\tconst chargesResponse = await this.fetch<\n\t\t\tStripeListResponse<{\n\t\t\t\tid: string;\n\t\t\t\tamount: number;\n\t\t\t\tstatus: string;\n\t\t\t\trefunded: boolean;\n\t\t\t\tamount_refunded: number;\n\t\t\t}>\n\t\t>(\"/charges\", {\n\t\t\tlimit: \"100\",\n\t\t\t\"created[gte]\": startTimestamp.toString(),\n\t\t\t\"created[lte]\": endTimestamp.toString(),\n\t\t});\n\n\t\t// Fetch disputes for the month\n\t\tconst disputesResponse = await this.fetch<\n\t\t\tStripeListResponse<{\n\t\t\t\tid: string;\n\t\t\t\tamount: number;\n\t\t\t\tstatus: string;\n\t\t\t}>\n\t\t>(\"/disputes\", {\n\t\t\tlimit: \"100\",\n\t\t\t\"created[gte]\": startTimestamp.toString(),\n\t\t\t\"created[lte]\": endTimestamp.toString(),\n\t\t});\n\n\t\tif (!chargesResponse?.data) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst charges = chargesResponse.data;\n\t\tconst disputes = disputesResponse?.data || [];\n\n\t\tlet totalVolume = 0;\n\t\tlet successfulCharges = 0;\n\t\tlet failedCharges = 0;\n\t\tlet refundsCount = 0;\n\t\tlet refundsAmount = 0;\n\n\t\tfor (const charge of charges) {\n\t\t\tif (charge.status === \"succeeded\") {\n\t\t\t\tsuccessfulCharges++;\n\t\t\t\ttotalVolume += charge.amount;\n\t\t\t} else if (charge.status === \"failed\") {\n\t\t\t\tfailedCharges++;\n\t\t\t}\n\n\t\t\tif (charge.refunded || charge.amount_refunded > 0) {\n\t\t\t\trefundsCount++;\n\t\t\t\trefundsAmount += charge.amount_refunded;\n\t\t\t}\n\t\t}\n\n\t\t// Calculate estimated fees (2.9% + $0.30 per transaction)\n\t\tconst estimatedFees = Math.round(totalVolume * 0.029 + successfulCharges * 30);\n\n\t\treturn {\n\t\t\ttotal_transactions: charges.length,\n\t\t\ttotal_volume_cents: totalVolume,\n\t\t\ttotal_fees_cents: estimatedFees,\n\t\t\tsuccessful_charges: successfulCharges,\n\t\t\tfailed_charges: failedCharges,\n\t\t\trefunds_count: refundsCount,\n\t\t\trefunds_amount_cents: refundsAmount,\n\t\t\tdisputes_count: disputes.length,\n\t\t};\n\t}\n\n\t/**\n\t * Get current Stripe balance\n\t */\n\tasync getBalance(): Promise<{\n\t\tavailable_cents: number;\n\t\tpending_cents: number;\n\t\tcurrency: string;\n\t} | null> {\n\t\tconst response = await this.fetch<{\n\t\t\tavailable: Array<{ amount: number; currency: string }>;\n\t\t\tpending: Array<{ amount: number; currency: string }>;\n\t\t}>(\"/balance\");\n\n\t\tif (!response) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Get USD balance (or first available currency)\n\t\tconst availableUsd = response.available.find((b) => b.currency === \"usd\") || response.available[0];\n\t\tconst pendingUsd = response.pending.find((b) => b.currency === \"usd\") || response.pending[0];\n\n\t\treturn {\n\t\t\tavailable_cents: availableUsd?.amount || 0,\n\t\t\tpending_cents: pendingUsd?.amount || 0,\n\t\t\tcurrency: availableUsd?.currency || \"usd\",\n\t\t};\n\t}\n\n\t/**\n\t * Calculate Stripe fee for a given amount\n\t * Standard US pricing: 2.9% + $0.30\n\t */\n\tstatic calculateFee(\n\t\tamountCents: number,\n\t\toptions: {\n\t\t\tisInternational?: boolean;\n\t\t\thasCurrencyConversion?: boolean;\n\t\t} = {}\n\t): number {\n\t\tlet percentage = 0.029; // 2.9% base\n\n\t\tif (options.isInternational) {\n\t\t\tpercentage += 0.005; // +0.5% for international\n\t\t}\n\n\t\tif (options.hasCurrencyConversion) {\n\t\t\tpercentage += 0.01; // +1% for currency conversion\n\t\t}\n\n\t\tconst percentageFee = Math.round(amountCents * percentage);\n\t\tconst flatFee = 30; // $0.30\n\n\t\treturn percentageFee + flatFee;\n\t}\n\n\t/**\n\t * Calculate net amount after Stripe fees\n\t */\n\tstatic calculateNetAmount(\n\t\tamountCents: number,\n\t\toptions: {\n\t\t\tisInternational?: boolean;\n\t\t\thasCurrencyConversion?: boolean;\n\t\t} = {}\n\t): number {\n\t\tconst fee = this.calculateFee(amountCents, options);\n\t\treturn amountCents - fee;\n\t}\n\n\t/**\n\t * Check if the Stripe API is healthy\n\t */\n\tasync checkHealth(): Promise<{ healthy: boolean; responseTimeMs: number; error?: string }> {\n\t\tconst startTime = Date.now();\n\n\t\ttry {\n\t\t\tconst response = await fetch(`${this.baseUrl}/balance`, {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${this.secretKey}`,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst responseTimeMs = Date.now() - startTime;\n\n\t\t\tif (response.ok) {\n\t\t\t\treturn { healthy: true, responseTimeMs };\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\thealthy: false,\n\t\t\t\tresponseTimeMs,\n\t\t\t\terror: `HTTP ${response.status}: ${response.statusText}`,\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn {\n\t\t\t\thealthy: false,\n\t\t\t\tresponseTimeMs: Date.now() - startTime,\n\t\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\t};\n\t\t}\n\t}\n}\n\n// Export singleton instance\nexport const stripeBillingClient = new StripeBillingClient();\n","/**\n * Telnyx Usage Reports API Client\n *\n * Fetches real voice and SMS usage data from Telnyx\n * Docs: https://developers.telnyx.com/docs/reporting/usage-reports\n */\n\nexport interface TelnyxVoiceUsage {\n\ttotal_minutes: number;\n\tinbound_minutes: number;\n\toutbound_minutes: number;\n\ttotal_calls: number;\n\ttotal_cost_cents: number;\n}\n\nexport interface TelnyxSmsUsage {\n\ttotal_messages: number;\n\toutbound_messages: number;\n\tinbound_messages: number;\n\ttotal_cost_cents: number;\n}\n\ninterface CdrUsageReportResponse {\n\tdata: {\n\t\taggregations: {\n\t\t\ttotal_cost: number;\n\t\t\ttotal_duration: number;\n\t\t\trecord_count: number;\n\t\t};\n\t\trecords?: Array<{\n\t\t\tdirection: string;\n\t\t\tduration: number;\n\t\t\tcost: number;\n\t\t}>;\n\t};\n}\n\ninterface MessagingReportResponse {\n\tdata: Array<{\n\t\tdirection: \"outbound\" | \"inbound\";\n\t\tparts: number;\n\t\tcost: {\n\t\t\tamount: string;\n\t\t\tcurrency: string;\n\t\t};\n\t}>;\n\tmeta: {\n\t\ttotal_results: number;\n\t};\n}\n\n/**\n * Telnyx Usage Client\n * Requires TELNYX_API_KEY environment variable\n */\nexport class TelnyxUsageClient {\n\tprivate baseUrl = \"https://api.telnyx.com/v2\";\n\tprivate apiKey: string;\n\n\tconstructor() {\n\t\tconst apiKey = process.env.TELNYX_API_KEY;\n\n\t\tif (!apiKey) {\n\t\t\tconsole.warn(\"TELNYX_API_KEY not set - Telnyx usage tracking disabled\");\n\t\t}\n\n\t\tthis.apiKey = apiKey || \"\";\n\t}\n\n\tprivate async fetch<T>(endpoint: string, params?: Record<string, string>): Promise<T | null> {\n\t\tif (!this.apiKey) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst url = new URL(`${this.baseUrl}${endpoint}`);\n\t\tif (params) {\n\t\t\tObject.entries(params).forEach(([key, value]) => {\n\t\t\t\turl.searchParams.append(key, value);\n\t\t\t});\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await fetch(url.toString(), {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${this.apiKey}`,\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.error(`Telnyx API error: ${response.status} ${response.statusText}`);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn (await response.json()) as T;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Telnyx API fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get the current month's date range\n\t */\n\tprivate getCurrentMonthRange(): { startDate: string; endDate: string } {\n\t\tconst now = new Date();\n\t\tconst startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n\t\tconst endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59);\n\n\t\treturn {\n\t\t\tstartDate: startOfMonth.toISOString(),\n\t\t\tendDate: endOfMonth.toISOString(),\n\t\t};\n\t}\n\n\t/**\n\t * Get voice CDR usage report\n\t * Synchronous endpoint - may take up to a couple minutes\n\t */\n\tasync getVoiceUsage(startDate?: string, endDate?: string): Promise<TelnyxVoiceUsage | null> {\n\t\tconst dateRange = startDate && endDate ? { startDate, endDate } : this.getCurrentMonthRange();\n\n\t\tconst response = await this.fetch<CdrUsageReportResponse>(\"/reports/cdr_usage_reports/sync\", {\n\t\t\tstart_date: dateRange.startDate,\n\t\t\tend_date: dateRange.endDate,\n\t\t});\n\n\t\tif (!response?.data) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst { aggregations, records } = response.data;\n\n\t\t// Calculate inbound vs outbound from records if available\n\t\tlet inboundMinutes = 0;\n\t\tlet outboundMinutes = 0;\n\n\t\tif (records) {\n\t\t\tfor (const record of records) {\n\t\t\t\tconst minutes = record.duration / 60; // Convert seconds to minutes\n\t\t\t\tif (record.direction === \"inbound\") {\n\t\t\t\t\tinboundMinutes += minutes;\n\t\t\t\t} else {\n\t\t\t\t\toutboundMinutes += minutes;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\ttotal_minutes: aggregations.total_duration / 60, // Convert seconds to minutes\n\t\t\tinbound_minutes: inboundMinutes,\n\t\t\toutbound_minutes: outboundMinutes,\n\t\t\ttotal_calls: aggregations.record_count,\n\t\t\ttotal_cost_cents: Math.round(aggregations.total_cost * 100), // Convert to cents\n\t\t};\n\t}\n\n\t/**\n\t * Get SMS/MMS messaging usage\n\t * Note: API can only retrieve messages from the last 10 days\n\t * For older messages, use MDR reports\n\t */\n\tasync getSmsUsage(startDate?: string, endDate?: string): Promise<TelnyxSmsUsage | null> {\n\t\t// For current month, we may need to use MDR reports for full data\n\t\t// The messages endpoint is limited to 10 days\n\t\tconst now = new Date();\n\t\tconst tenDaysAgo = new Date(now.getTime() - 10 * 24 * 60 * 60 * 1000);\n\n\t\tconst response = await this.fetch<MessagingReportResponse>(\"/messages\", {\n\t\t\t\"page[size]\": \"250\",\n\t\t\t\"filter[created_at][gte]\": tenDaysAgo.toISOString(),\n\t\t\t\"filter[created_at][lte]\": now.toISOString(),\n\t\t});\n\n\t\tif (!response?.data) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet outboundMessages = 0;\n\t\tlet inboundMessages = 0;\n\t\tlet totalCostCents = 0;\n\n\t\tfor (const message of response.data) {\n\t\t\tif (message.direction === \"outbound\") {\n\t\t\t\toutboundMessages += message.parts;\n\t\t\t} else {\n\t\t\t\tinboundMessages += message.parts;\n\t\t\t}\n\t\t\ttotalCostCents += Math.round(parseFloat(message.cost.amount) * 100);\n\t\t}\n\n\t\treturn {\n\t\t\ttotal_messages: outboundMessages + inboundMessages,\n\t\t\toutbound_messages: outboundMessages,\n\t\t\tinbound_messages: inboundMessages,\n\t\t\ttotal_cost_cents: totalCostCents,\n\t\t};\n\t}\n\n\t/**\n\t * Get combined voice and SMS usage for current month\n\t */\n\tasync getCurrentMonthUsage(): Promise<{\n\t\tvoice: TelnyxVoiceUsage | null;\n\t\tsms: TelnyxSmsUsage | null;\n\t\ttotal_cost_cents: number;\n\t}> {\n\t\tconst [voice, sms] = await Promise.all([this.getVoiceUsage(), this.getSmsUsage()]);\n\n\t\treturn {\n\t\t\tvoice,\n\t\t\tsms,\n\t\t\ttotal_cost_cents: (voice?.total_cost_cents || 0) + (sms?.total_cost_cents || 0),\n\t\t};\n\t}\n\n\t/**\n\t * Check if the Telnyx API is healthy\n\t */\n\tasync checkHealth(): Promise<{ healthy: boolean; responseTimeMs: number; error?: string }> {\n\t\tconst startTime = Date.now();\n\n\t\ttry {\n\t\t\tconst response = await fetch(`${this.baseUrl}/connections`, {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${this.apiKey}`,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst responseTimeMs = Date.now() - startTime;\n\n\t\t\tif (response.ok) {\n\t\t\t\treturn { healthy: true, responseTimeMs };\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\thealthy: false,\n\t\t\t\tresponseTimeMs,\n\t\t\t\terror: `HTTP ${response.status}: ${response.statusText}`,\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn {\n\t\t\t\thealthy: false,\n\t\t\t\tresponseTimeMs: Date.now() - startTime,\n\t\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\t};\n\t\t}\n\t}\n}\n\n// Export singleton instance\nexport const telnyxUsageClient = new TelnyxUsageClient();\n","/**\n * API Service Configuration\n *\n * Comprehensive configuration for all external API services including:\n * - Free tier limits and thresholds\n * - Pricing after free tier\n * - Health check endpoints\n * - Provider API availability\n */\n\nexport type ServiceCategory = \"ai\" | \"google_maps\" | \"infrastructure\" | \"communication\" | \"data\" | \"payments\";\nexport type FreeTierPeriod = \"daily\" | \"monthly\" | \"yearly\";\nexport type SyncSource = \"provider_api\" | \"internal_tracking\" | \"manual\" | \"estimated\";\n\nexport interface FreeTierConfig {\n\tlimit: number;\n\tperiod: FreeTierPeriod;\n\tunit: string;\n}\n\nexport interface CostConfig {\n\t/** Cost in cents */\n\tcents?: number;\n\t/** Cost applies per this many units */\n\tperUnits?: number;\n\t/** Unit type (request, page, minute, etc) */\n\tunit?: string;\n\t/** For percentage-based pricing (e.g., Stripe) */\n\tpercentage?: number;\n\t/** Fixed fee in cents per transaction */\n\tfixedCents?: number;\n}\n\nexport interface ApiServiceConfig {\n\tserviceName: string;\n\tdisplayName: string;\n\tcategory: ServiceCategory;\n\tprovider: string;\n\t/** Free tier configuration, null if no free tier */\n\tfreeTier: FreeTierConfig | null;\n\t/** Cost after free tier is exhausted */\n\tcostAfterFree: CostConfig | null;\n\t/** Base monthly cost in cents (for subscription services) */\n\tbaseCostCents: number;\n\t/** Whether this service has an external API for fetching usage */\n\thasExternalApi: boolean;\n\t/** Endpoint to check for health status */\n\thealthCheckEndpoint?: string;\n\t/** Alert thresholds */\n\twarningThresholdPct: number;\n\tcriticalThresholdPct: number;\n\t/** Description of what this service is used for */\n\tdescription?: string;\n}\n\n/**\n * All API service configurations\n * Organized by category for easy access\n */\nexport const API_SERVICES: Record<string, ApiServiceConfig> = {\n\t// ==========================================\n\t// Google AI Services\n\t// ==========================================\n\tgoogle_gemini: {\n\t\tserviceName: \"google_gemini\",\n\t\tdisplayName: \"Google Gemini AI\",\n\t\tcategory: \"ai\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 1500, period: \"daily\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 7.5, perUnits: 1000000, unit: \"tokens\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\thealthCheckEndpoint: \"https://generativelanguage.googleapis.com/v1/models\",\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Gemini AI for text generation, chat, and multimodal tasks\",\n\t},\n\tgoogle_document_ai: {\n\t\tserviceName: \"google_document_ai\",\n\t\tdisplayName: \"Document AI\",\n\t\tcategory: \"ai\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 1000, period: \"monthly\", unit: \"pages\" },\n\t\tcostAfterFree: { cents: 1, perUnits: 1, unit: \"page\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Document parsing, OCR, and form extraction\",\n\t},\n\tgoogle_vision: {\n\t\tserviceName: \"google_vision\",\n\t\tdisplayName: \"Vision AI\",\n\t\tcategory: \"ai\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 1000, period: \"monthly\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 150, perUnits: 1000, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Image analysis, OCR, and object detection\",\n\t},\n\tgoogle_speech_to_text: {\n\t\tserviceName: \"google_speech_to_text\",\n\t\tdisplayName: \"Speech-to-Text\",\n\t\tcategory: \"ai\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 60, period: \"monthly\", unit: \"minutes\" },\n\t\tcostAfterFree: { cents: 60, perUnits: 1, unit: \"minute\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Audio transcription and speech recognition\",\n\t},\n\tgoogle_text_to_speech: {\n\t\tserviceName: \"google_text_to_speech\",\n\t\tdisplayName: \"Text-to-Speech\",\n\t\tcategory: \"ai\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 4000000, period: \"monthly\", unit: \"characters\" },\n\t\tcostAfterFree: { cents: 400, perUnits: 1000000, unit: \"characters\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Text to natural speech synthesis\",\n\t},\n\tgoogle_translation: {\n\t\tserviceName: \"google_translation\",\n\t\tdisplayName: \"Translation\",\n\t\tcategory: \"ai\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 500000, period: \"monthly\", unit: \"characters\" },\n\t\tcostAfterFree: { cents: 2000, perUnits: 1000000, unit: \"characters\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Language translation services\",\n\t},\n\n\t// ==========================================\n\t// Google Maps Services\n\t// ==========================================\n\tgoogle_geocoding: {\n\t\tserviceName: \"google_geocoding\",\n\t\tdisplayName: \"Geocoding\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 10000, period: \"monthly\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 50, perUnits: 100, unit: \"request\" }, // $5/1000 = $0.50/100\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Address to coordinates conversion\",\n\t},\n\tgoogle_directions: {\n\t\tserviceName: \"google_directions\",\n\t\tdisplayName: \"Directions\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 10000, period: \"monthly\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 50, perUnits: 100, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Route planning and navigation\",\n\t},\n\tgoogle_places: {\n\t\tserviceName: \"google_places\",\n\t\tdisplayName: \"Places\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 10000, period: \"monthly\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 170, perUnits: 100, unit: \"request\" }, // $17/1000\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Place search, details, and autocomplete\",\n\t},\n\tgoogle_distance_matrix: {\n\t\tserviceName: \"google_distance_matrix\",\n\t\tdisplayName: \"Distance Matrix\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 10000, period: \"monthly\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 50, perUnits: 100, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Travel distance and time calculations\",\n\t},\n\tgoogle_maps_static: {\n\t\tserviceName: \"google_maps_static\",\n\t\tdisplayName: \"Maps Static\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 25000, period: \"monthly\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 20, perUnits: 100, unit: \"request\" }, // $2/1000\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Static map image generation\",\n\t},\n\tgoogle_street_view: {\n\t\tserviceName: \"google_street_view\",\n\t\tdisplayName: \"Street View\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 25000, period: \"monthly\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 70, perUnits: 100, unit: \"request\" }, // $7/1000\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Street-level imagery\",\n\t},\n\tgoogle_routes: {\n\t\tserviceName: \"google_routes\",\n\t\tdisplayName: \"Routes API\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 10000, period: \"monthly\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 50, perUnits: 100, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Advanced routing with traffic awareness\",\n\t},\n\tgoogle_elevation: {\n\t\tserviceName: \"google_elevation\",\n\t\tdisplayName: \"Elevation\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: null,\n\t\tcostAfterFree: { cents: 50, perUnits: 100, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Terrain elevation data\",\n\t},\n\tgoogle_timezone: {\n\t\tserviceName: \"google_timezone\",\n\t\tdisplayName: \"Time Zone\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: null,\n\t\tcostAfterFree: { cents: 50, perUnits: 100, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Time zone lookups by location\",\n\t},\n\n\t// ==========================================\n\t// Infrastructure Services\n\t// ==========================================\n\tsupabase: {\n\t\tserviceName: \"supabase\",\n\t\tdisplayName: \"Supabase\",\n\t\tcategory: \"infrastructure\",\n\t\tprovider: \"supabase\",\n\t\tfreeTier: null, // Pro plan, usage-based after base\n\t\tcostAfterFree: null,\n\t\tbaseCostCents: 2500, // $25/month\n\t\thasExternalApi: true,\n\t\thealthCheckEndpoint: \"https://api.supabase.com/v1/projects\",\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Database, Auth, Storage, Edge Functions\",\n\t},\n\tvercel: {\n\t\tserviceName: \"vercel\",\n\t\tdisplayName: \"Vercel\",\n\t\tcategory: \"infrastructure\",\n\t\tprovider: \"vercel\",\n\t\tfreeTier: { limit: 1000, period: \"monthly\", unit: \"GB\" }, // 1TB bandwidth included\n\t\tcostAfterFree: { cents: 15, perUnits: 1, unit: \"GB\" }, // $0.15/GB\n\t\tbaseCostCents: 2000, // $20/month Pro plan\n\t\thasExternalApi: false, // Limited API, track internally\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Hosting, Edge Functions, Analytics\",\n\t},\n\n\t// ==========================================\n\t// Communication Services\n\t// ==========================================\n\ttelnyx_voice: {\n\t\tserviceName: \"telnyx_voice\",\n\t\tdisplayName: \"Telnyx Voice\",\n\t\tcategory: \"communication\",\n\t\tprovider: \"telnyx\",\n\t\tfreeTier: null, // No free tier\n\t\tcostAfterFree: { cents: 90, perUnits: 100, unit: \"minute\" }, // $0.009/min\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\thealthCheckEndpoint: \"https://api.telnyx.com/v2/connections\",\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"VoIP calls and call control\",\n\t},\n\ttelnyx_sms: {\n\t\tserviceName: \"telnyx_sms\",\n\t\tdisplayName: \"Telnyx SMS\",\n\t\tcategory: \"communication\",\n\t\tprovider: \"telnyx\",\n\t\tfreeTier: null, // No free tier\n\t\tcostAfterFree: { cents: 25, perUnits: 100, unit: \"message\" }, // $0.0025/msg\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"SMS and MMS messaging\",\n\t},\n\tresend: {\n\t\tserviceName: \"resend\",\n\t\tdisplayName: \"Resend Email\",\n\t\tcategory: \"communication\",\n\t\tprovider: \"resend\",\n\t\tfreeTier: { limit: 3000, period: \"monthly\", unit: \"emails\" },\n\t\tcostAfterFree: { cents: 9, perUnits: 100, unit: \"email\" }, // ~$0.0009/email\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: false, // Track internally\n\t\thealthCheckEndpoint: \"https://api.resend.com/emails\",\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Transactional email delivery\",\n\t},\n\tassemblyai: {\n\t\tserviceName: \"assemblyai\",\n\t\tdisplayName: \"AssemblyAI\",\n\t\tcategory: \"communication\",\n\t\tprovider: \"assemblyai\",\n\t\tfreeTier: { limit: 500, period: \"monthly\", unit: \"credits\" }, // $50 in credits\n\t\tcostAfterFree: { cents: 15, perUnits: 1, unit: \"hour\" }, // $0.15/hour\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Call transcription and audio intelligence\",\n\t},\n\n\t// ==========================================\n\t// Data APIs\n\t// ==========================================\n\tattom: {\n\t\tserviceName: \"attom\",\n\t\tdisplayName: \"ATTOM Property\",\n\t\tcategory: \"data\",\n\t\tprovider: \"attom\",\n\t\tfreeTier: null, // No free tier\n\t\tcostAfterFree: { cents: 500, perUnits: 100, unit: \"request\" }, // ~$0.05/request\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: false,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Property data, valuations, sales history\",\n\t},\n\tshovels: {\n\t\tserviceName: \"shovels\",\n\t\tdisplayName: \"Shovels Permits\",\n\t\tcategory: \"data\",\n\t\tprovider: \"shovels\",\n\t\tfreeTier: null,\n\t\tcostAfterFree: { cents: 300, perUnits: 100, unit: \"request\" }, // ~$0.03/request\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: false,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Building permits and contractor data\",\n\t},\n\twalk_score: {\n\t\tserviceName: \"walk_score\",\n\t\tdisplayName: \"Walk Score\",\n\t\tcategory: \"data\",\n\t\tprovider: \"walkscore\",\n\t\tfreeTier: { limit: 5000, period: \"daily\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 10, perUnits: 100, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: false,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Walkability, transit, and bike scores\",\n\t},\n\tcrimeometer: {\n\t\tserviceName: \"crimeometer\",\n\t\tdisplayName: \"CrimeoMeter\",\n\t\tcategory: \"data\",\n\t\tprovider: \"crimeometer\",\n\t\tfreeTier: null,\n\t\tcostAfterFree: { cents: 500, perUnits: 100, unit: \"request\" }, // ~$0.05/request\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: false,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Real-time crime data and safety scores\",\n\t},\n\tfema_flood: {\n\t\tserviceName: \"fema_flood\",\n\t\tdisplayName: \"FEMA Flood\",\n\t\tcategory: \"data\",\n\t\tprovider: \"fema\",\n\t\tfreeTier: null, // Free government API\n\t\tcostAfterFree: { cents: 0, perUnits: 1, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: false,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Flood zone and risk data (free)\",\n\t},\n\tcensus_bureau: {\n\t\tserviceName: \"census_bureau\",\n\t\tdisplayName: \"Census Bureau\",\n\t\tcategory: \"data\",\n\t\tprovider: \"census\",\n\t\tfreeTier: null, // Free government API\n\t\tcostAfterFree: { cents: 0, perUnits: 1, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: false,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Demographics and housing data (free)\",\n\t},\n\tfbi_crime: {\n\t\tserviceName: \"fbi_crime\",\n\t\tdisplayName: \"FBI Crime Data\",\n\t\tcategory: \"data\",\n\t\tprovider: \"fbi\",\n\t\tfreeTier: null, // Free government API\n\t\tcostAfterFree: { cents: 0, perUnits: 1, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: false,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Crime statistics by state (free)\",\n\t},\n\n\t// ==========================================\n\t// Payment Services\n\t// ==========================================\n\tstripe: {\n\t\tserviceName: \"stripe\",\n\t\tdisplayName: \"Stripe\",\n\t\tcategory: \"payments\",\n\t\tprovider: \"stripe\",\n\t\tfreeTier: null,\n\t\tcostAfterFree: { percentage: 2.9, fixedCents: 30, unit: \"transaction\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\thealthCheckEndpoint: \"https://api.stripe.com/v1/balance\",\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Payment processing (2.9% + $0.30)\",\n\t},\n};\n\n/**\n * Get services by category\n */\nexport function getServicesByCategory(category: ServiceCategory): ApiServiceConfig[] {\n\treturn Object.values(API_SERVICES).filter((s) => s.category === category);\n}\n\n/**\n * Get services by provider\n */\nexport function getServicesByProvider(provider: string): ApiServiceConfig[] {\n\treturn Object.values(API_SERVICES).filter((s) => s.provider === provider);\n}\n\n/**\n * Get all services with free tiers\n */\nexport function getServicesWithFreeTier(): ApiServiceConfig[] {\n\treturn Object.values(API_SERVICES).filter((s) => s.freeTier !== null);\n}\n\n/**\n * Get all services that have external APIs for usage data\n */\nexport function getServicesWithExternalApi(): ApiServiceConfig[] {\n\treturn Object.values(API_SERVICES).filter((s) => s.hasExternalApi);\n}\n\n/**\n * Calculate cost for usage\n */\nexport function calculateCost(serviceName: string, usage: number, transactionAmount?: number): number {\n\tconst service = API_SERVICES[serviceName];\n\tif (!service || !service.costAfterFree) return 0;\n\n\tconst { cents, perUnits, percentage, fixedCents } = service.costAfterFree;\n\n\t// For percentage-based pricing (Stripe)\n\tif (percentage !== undefined && transactionAmount !== undefined) {\n\t\tconst percentageCost = (transactionAmount * percentage) / 100;\n\t\tconst fixedCost = (fixedCents || 0) / 100;\n\t\treturn percentageCost + fixedCost;\n\t}\n\n\t// For unit-based pricing\n\tif (cents !== undefined && perUnits !== undefined) {\n\t\treturn (usage / perUnits) * cents;\n\t}\n\n\treturn 0;\n}\n\n/**\n * Calculate free tier percentage used\n */\nexport function calculateFreeTierPercentage(serviceName: string, used: number): number | null {\n\tconst service = API_SERVICES[serviceName];\n\tif (!service || !service.freeTier) return null;\n\n\treturn Math.min(100, (used / service.freeTier.limit) * 100);\n}\n\n/**\n * Get alert level based on usage\n */\nexport function getAlertLevel(serviceName: string, percentUsed: number): \"ok\" | \"warning\" | \"critical\" {\n\tconst service = API_SERVICES[serviceName];\n\tif (!service) return \"ok\";\n\n\tif (percentUsed >= service.criticalThresholdPct) return \"critical\";\n\tif (percentUsed >= service.warningThresholdPct) return \"warning\";\n\treturn \"ok\";\n}\n\n/**\n * Service categories with display names\n */\nexport const SERVICE_CATEGORIES: Record<ServiceCategory, { displayName: string; icon: string }> = {\n\tai: { displayName: \"AI Services\", icon: \"brain\" },\n\tgoogle_maps: { displayName: \"Google Maps\", icon: \"map\" },\n\tinfrastructure: { displayName: \"Infrastructure\", icon: \"server\" },\n\tcommunication: { displayName: \"Communication\", icon: \"message-square\" },\n\tdata: { displayName: \"Data APIs\", icon: \"database\" },\n\tpayments: { displayName: \"Payments\", icon: \"credit-card\" },\n};\n","/**\n * Google Cloud Usage & Billing Client\n *\n * Fetches usage data from Google Cloud APIs\n * - Cloud Billing API for cost data\n * - Service Usage API for API call counts\n *\n * Docs:\n * - https://cloud.google.com/billing/docs/reference/rest\n * - https://cloud.google.com/service-usage/docs/reference/rest\n */\n\nexport interface GoogleCloudUsage {\n\tservice_name: string;\n\tdisplay_name: string;\n\tusage_amount: number;\n\tusage_unit: string;\n\tcost_usd: number;\n\tmonth: string;\n}\n\nexport interface GoogleAIUsage {\n\tgemini_requests: number;\n\tgemini_tokens_input: number;\n\tgemini_tokens_output: number;\n\tdocument_ai_pages: number;\n\tvision_requests: number;\n\tspeech_minutes: number;\n\ttranslation_characters: number;\n\ttotal_cost_cents: number;\n}\n\ninterface ServiceUsageResponse {\n\tservices: Array<{\n\t\tname: string;\n\t\tconfig: {\n\t\t\tname: string;\n\t\t\ttitle: string;\n\t\t};\n\t}>;\n}\n\ninterface BillingReportResponse {\n\trows?: Array<{\n\t\tservice: { id: string; description: string };\n\t\tsku: { id: string; description: string };\n\t\tusage: { amount: string; unit: string };\n\t\tcost: { amount: string; currency: string };\n\t}>;\n}\n\n/**\n * Google Cloud Client\n *\n * Required environment variables:\n * - GOOGLE_CLOUD_PROJECT_ID\n * - GOOGLE_CLOUD_BILLING_ACCOUNT_ID\n * - GOOGLE_CLOUD_API_KEY or GOOGLE_APPLICATION_CREDENTIALS\n */\nexport class GoogleCloudClient {\n\tprivate projectId: string;\n\tprivate billingAccountId: string;\n\tprivate accessToken: string;\n\n\tconstructor() {\n\t\tthis.projectId = process.env.GOOGLE_CLOUD_PROJECT_ID || \"\";\n\t\tthis.billingAccountId = process.env.GOOGLE_CLOUD_BILLING_ACCOUNT_ID || \"\";\n\t\tthis.accessToken = process.env.GOOGLE_CLOUD_ACCESS_TOKEN || \"\";\n\n\t\tif (!this.projectId) {\n\t\t\tconsole.warn(\"GOOGLE_CLOUD_PROJECT_ID not set - Google Cloud tracking disabled\");\n\t\t}\n\t}\n\n\tprivate async fetch<T>(url: string): Promise<T | null> {\n\t\tif (!this.accessToken) {\n\t\t\treturn null;\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await fetch(url, {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${this.accessToken}`,\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.error(`Google Cloud API error: ${response.status} ${response.statusText}`);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn (await response.json()) as T;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Google Cloud API fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get enabled services for the project\n\t */\n\tasync getEnabledServices(): Promise<string[] | null> {\n\t\tconst response = await this.fetch<ServiceUsageResponse>(`https://serviceusage.googleapis.com/v1/projects/${this.projectId}/services?filter=state:ENABLED`);\n\n\t\tif (!response?.services) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn response.services.map((s) => s.config.name);\n\t}\n\n\t/**\n\t * Get AI-specific usage from the current month\n\t * Note: This is a simplified implementation. In production, you'd use\n\t * the Cloud Billing Export to BigQuery for detailed usage data.\n\t */\n\tasync getAIUsage(): Promise<GoogleAIUsage | null> {\n\t\t// For accurate Google AI usage, you typically need to:\n\t\t// 1. Enable Cloud Billing export to BigQuery\n\t\t// 2. Query the billing export table\n\n\t\t// As a fallback, we can estimate from the billing API\n\t\t// but it doesn't provide granular token/request counts\n\n\t\t// Return structure for manual tracking until BigQuery export is set up\n\t\treturn {\n\t\t\tgemini_requests: 0,\n\t\t\tgemini_tokens_input: 0,\n\t\t\tgemini_tokens_output: 0,\n\t\t\tdocument_ai_pages: 0,\n\t\t\tvision_requests: 0,\n\t\t\tspeech_minutes: 0,\n\t\t\ttranslation_characters: 0,\n\t\t\ttotal_cost_cents: 0,\n\t\t};\n\t}\n\n\t/**\n\t * Get current month billing summary\n\t * Requires Cloud Billing API access\n\t */\n\tasync getCurrentMonthBilling(): Promise<GoogleCloudUsage[] | null> {\n\t\tif (!this.billingAccountId) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Note: The Cloud Billing API requires special permissions\n\t\t// For most use cases, you'd query BigQuery export instead\n\t\tconst now = new Date();\n\t\tconst startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n\n\t\t// This is a simplified example - actual implementation would use\n\t\t// the Cloud Billing Budget API or BigQuery export\n\t\tconst budgetsUrl = `https://cloudbilling.googleapis.com/v1/billingAccounts/${this.billingAccountId}/budgets`;\n\n\t\tconst response = await this.fetch<{\n\t\t\tbudgets?: Array<{\n\t\t\t\tamount: { specifiedAmount: { currencyCode: string; units: string } };\n\t\t\t\tcurrentSpend?: { currencyCode: string; units: string };\n\t\t\t}>;\n\t\t}>(budgetsUrl);\n\n\t\tif (!response?.budgets) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Transform budget data to usage format\n\t\treturn response.budgets.map((budget) => ({\n\t\t\tservice_name: \"all_services\",\n\t\t\tdisplay_name: \"All Google Cloud Services\",\n\t\t\tusage_amount: 1,\n\t\t\tusage_unit: \"budget\",\n\t\t\tcost_usd: parseFloat(budget.currentSpend?.units || \"0\"),\n\t\t\tmonth: startOfMonth.toISOString().slice(0, 7),\n\t\t}));\n\t}\n\n\t/**\n\t * Get Maps Platform usage\n\t * Uses the Cloud Billing API to fetch Maps-specific costs\n\t */\n\tasync getMapsUsage(): Promise<{\n\t\tgeocoding_requests: number;\n\t\tplaces_requests: number;\n\t\tdirections_requests: number;\n\t\tstatic_maps_requests: number;\n\t\ttotal_cost_cents: number;\n\t} | null> {\n\t\t// Maps usage is typically tracked via:\n\t\t// 1. Cloud Console usage reports\n\t\t// 2. BigQuery billing export\n\n\t\t// For now, return structure for manual tracking\n\t\treturn {\n\t\t\tgeocoding_requests: 0,\n\t\t\tplaces_requests: 0,\n\t\t\tdirections_requests: 0,\n\t\t\tstatic_maps_requests: 0,\n\t\t\ttotal_cost_cents: 0,\n\t\t};\n\t}\n\n\t/**\n\t * Check if Google Cloud APIs are healthy\n\t */\n\tasync checkHealth(): Promise<{ healthy: boolean; responseTimeMs: number; error?: string }> {\n\t\tconst startTime = Date.now();\n\n\t\ttry {\n\t\t\t// Check Service Usage API availability\n\t\t\tconst response = await fetch(`https://serviceusage.googleapis.com/v1/projects/${this.projectId}/services?pageSize=1`, {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${this.accessToken}`,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst responseTimeMs = Date.now() - startTime;\n\n\t\t\tif (response.ok) {\n\t\t\t\treturn { healthy: true, responseTimeMs };\n\t\t\t}\n\n\t\t\t// Special case: 401/403 means API is up but we need auth\n\t\t\tif (response.status === 401 || response.status === 403) {\n\t\t\t\treturn {\n\t\t\t\t\thealthy: true, // API is responding\n\t\t\t\t\tresponseTimeMs,\n\t\t\t\t\terror: \"Authentication required - API is available\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\thealthy: false,\n\t\t\t\tresponseTimeMs,\n\t\t\t\terror: `HTTP ${response.status}: ${response.statusText}`,\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn {\n\t\t\t\thealthy: false,\n\t\t\t\tresponseTimeMs: Date.now() - startTime,\n\t\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\t};\n\t\t}\n\t}\n}\n\n// Export singleton instance\nexport const googleCloudClient = new GoogleCloudClient();\n\n/**\n * Google AI Internal Tracker\n *\n * Since Google Cloud doesn't provide real-time token/request counts via API,\n * we need to track these internally in our application.\n *\n * This class provides utilities for internal tracking that syncs with our database.\n */\nexport class GoogleAITracker {\n\t/**\n\t * Calculate cost for Gemini API usage\n\t * Based on: https://ai.google.dev/pricing\n\t */\n\tstatic calculateGeminiCost(inputTokens: number, outputTokens: number, model: \"gemini-1.5-flash\" | \"gemini-1.5-pro\" = \"gemini-1.5-flash\"): number {\n\t\t// Pricing as of 2024 (per million tokens)\n\t\tconst pricing = {\n\t\t\t\"gemini-1.5-flash\": {\n\t\t\t\tinput: 0.075, // $0.075 per 1M tokens\n\t\t\t\toutput: 0.3, // $0.30 per 1M tokens\n\t\t\t},\n\t\t\t\"gemini-1.5-pro\": {\n\t\t\t\tinput: 1.25, // $1.25 per 1M tokens\n\t\t\t\toutput: 5.0, // $5.00 per 1M tokens\n\t\t\t},\n\t\t};\n\n\t\tconst modelPricing = pricing[model];\n\t\tconst inputCost = (inputTokens / 1_000_000) * modelPricing.input;\n\t\tconst outputCost = (outputTokens / 1_000_000) * modelPricing.output;\n\n\t\treturn Math.round((inputCost + outputCost) * 100); // Return cents\n\t}\n\n\t/**\n\t * Calculate cost for Document AI\n\t * First 1,000 pages/month are free\n\t */\n\tstatic calculateDocumentAICost(pages: number): number {\n\t\tconst FREE_TIER = 1000;\n\t\tconst PRICE_PER_1000 = 1.5; // $1.50 per 1000 pages\n\n\t\tif (pages <= FREE_TIER) return 0;\n\n\t\tconst billablePages = pages - FREE_TIER;\n\t\treturn Math.round((billablePages / 1000) * PRICE_PER_1000 * 100);\n\t}\n\n\t/**\n\t * Calculate cost for Vision AI\n\t * First 1,000 units/month are free\n\t */\n\tstatic calculateVisionCost(requests: number): number {\n\t\tconst FREE_TIER = 1000;\n\t\tconst PRICE_PER_1000 = 1.5; // $1.50 per 1000 requests\n\n\t\tif (requests <= FREE_TIER) return 0;\n\n\t\tconst billableRequests = requests - FREE_TIER;\n\t\treturn Math.round((billableRequests / 1000) * PRICE_PER_1000 * 100);\n\t}\n\n\t/**\n\t * Calculate cost for Speech-to-Text\n\t * First 60 minutes/month are free\n\t */\n\tstatic calculateSpeechCost(minutes: number): number {\n\t\tconst FREE_TIER = 60;\n\t\tconst PRICE_PER_MINUTE = 0.024; // $0.024 per minute\n\n\t\tif (minutes <= FREE_TIER) return 0;\n\n\t\tconst billableMinutes = minutes - FREE_TIER;\n\t\treturn Math.round(billableMinutes * PRICE_PER_MINUTE * 100);\n\t}\n\n\t/**\n\t * Calculate cost for Translation API\n\t * First 500,000 characters/month are free\n\t */\n\tstatic calculateTranslationCost(characters: number): number {\n\t\tconst FREE_TIER = 500_000;\n\t\tconst PRICE_PER_MILLION = 20; // $20 per million characters\n\n\t\tif (characters <= FREE_TIER) return 0;\n\n\t\tconst billableChars = characters - FREE_TIER;\n\t\treturn Math.round((billableChars / 1_000_000) * PRICE_PER_MILLION * 100);\n\t}\n\n\t/**\n\t * Calculate total Google AI costs\n\t */\n\tstatic calculateTotalCost(usage: {\n\t\tgemini_input_tokens?: number;\n\t\tgemini_output_tokens?: number;\n\t\tgemini_model?: \"gemini-1.5-flash\" | \"gemini-1.5-pro\";\n\t\tdocument_ai_pages?: number;\n\t\tvision_requests?: number;\n\t\tspeech_minutes?: number;\n\t\ttranslation_characters?: number;\n\t}): number {\n\t\tlet total = 0;\n\n\t\tif (usage.gemini_input_tokens || usage.gemini_output_tokens) {\n\t\t\ttotal += this.calculateGeminiCost(usage.gemini_input_tokens || 0, usage.gemini_output_tokens || 0, usage.gemini_model || \"gemini-1.5-flash\");\n\t\t}\n\n\t\tif (usage.document_ai_pages) {\n\t\t\ttotal += this.calculateDocumentAICost(usage.document_ai_pages);\n\t\t}\n\n\t\tif (usage.vision_requests) {\n\t\t\ttotal += this.calculateVisionCost(usage.vision_requests);\n\t\t}\n\n\t\tif (usage.speech_minutes) {\n\t\t\ttotal += this.calculateSpeechCost(usage.speech_minutes);\n\t\t}\n\n\t\tif (usage.translation_characters) {\n\t\t\ttotal += this.calculateTranslationCost(usage.translation_characters);\n\t\t}\n\n\t\treturn total;\n\t}\n}\n"],"names":[],"mappings":"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","ignoreList":[4]}