{"version":3,"sources":["../../../../../../apps/web/src/components/settings/api-usage/api-usage-data.tsx","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/settings/api-usage/page.tsx","../../../../../../apps/web/src/lib/api/health-check-service.ts","../../../../../../apps/web/src/lib/api/providers/twilio-usage-client.ts","../../../../../../apps/web/src/components/settings/api-usage/api-usage-skeleton.tsx","../../../../../../node_modules/.pnpm/lucide-react%400.552.0_react%4019.2.0/node_modules/lucide-react/src/icons/server.ts","../../../../../../apps/web/src/lib/api/providers/supabase-usage-client.ts","../../../../../../apps/web/src/lib/api/usage-sync-service.ts","../../../../../../apps/web/src/lib/api/providers/stripe-billing-client.ts","../../../../../../apps/web/src/lib/api/providers/google-cloud-client.ts","../../../../../../apps/web/src/lib/api/api-service-config.ts"],"sourcesContent":["import {\n\tAlertCircle,\n\tAlertTriangle,\n\tCheckCircle,\n\tClock,\n\tDollarSign,\n\tServer,\n\tTrendingUp,\n\tWifi,\n\tWifiOff,\n} from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n\tCard,\n\tCardContent,\n\tCardDescription,\n\tCardHeader,\n\tCardTitle,\n} from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { API_SERVICES } from \"@/lib/api/api-service-config\";\nimport { getSystemHealthSummary } from \"@/lib/api/health-check-service\";\nimport {\n\tgetServicesApproachingLimits,\n\tgetUsageSummary,\n} from \"@/lib/api/usage-sync-service\";\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\n\n/**\n * Format currency from cents to dollars\n */\nfunction formatCurrency(cents: number): string {\n\treturn new Intl.NumberFormat(\"en-US\", {\n\t\tstyle: \"currency\",\n\t\tcurrency: \"USD\",\n\t}).format(cents / 100);\n}\n\n/**\n * Format large numbers with K/M suffixes\n */\nfunction formatNumber(num: number): string {\n\tif (num >= 1_000_000) {\n\t\treturn `${(num / 1_000_000).toFixed(1)}M`;\n\t}\n\tif (num >= 1_000) {\n\t\treturn `${(num / 1_000).toFixed(1)}K`;\n\t}\n\treturn num.toString();\n}\n\n/**\n * Get alert level color classes\n */\nfunction getAlertColor(level: string): string {\n\tswitch (level) {\n\t\tcase \"critical\":\n\t\t\treturn \"text-red-600 bg-red-100 dark:bg-red-900/30\";\n\t\tcase \"warning\":\n\t\t\treturn \"text-yellow-600 bg-yellow-100 dark:bg-yellow-900/30\";\n\t\tdefault:\n\t\t\treturn \"text-green-600 bg-green-100 dark:bg-green-900/30\";\n\t}\n}\n\n/**\n * Get health status color classes\n */\nfunction getHealthColor(status: string): string {\n\tswitch (status) {\n\t\tcase \"down\":\n\t\t\treturn \"text-red-600\";\n\t\tcase \"degraded\":\n\t\t\treturn \"text-yellow-600\";\n\t\tdefault:\n\t\t\treturn \"text-green-600\";\n\t}\n}\n\nexport async function ApiUsageData() {\n\t// Fetch all data\n\tconst [usageSummary, approachingLimits, healthSummary] = await Promise.all([\n\t\tgetUsageSummary(),\n\t\tgetServicesApproachingLimits(),\n\t\tgetSystemHealthSummary(),\n\t]);\n\n\t// Calculate monthly cost projection\n\tconst currentDay = new Date().getDate();\n\tconst daysInMonth = new Date(\n\t\tnew Date().getFullYear(),\n\t\tnew Date().getMonth() + 1,\n\t\t0,\n\t).getDate();\n\tconst projectedMonthlyCost = usageSummary\n\t\t? Math.round(\n\t\t\t\t(usageSummary.total_cost_cents / Math.max(currentDay, 1)) * daysInMonth,\n\t\t\t)\n\t\t: 0;\n\n\t// Group services by category\n\tconst servicesByCategory: Record<string, typeof usageSummary.services> = {};\n\tif (usageSummary?.services) {\n\t\tfor (const service of usageSummary.services) {\n\t\t\tif (!servicesByCategory[service.category]) {\n\t\t\t\tservicesByCategory[service.category] = [];\n\t\t\t}\n\t\t\tservicesByCategory[service.category].push(service);\n\t\t}\n\t}\n\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t{/* Header */}\n\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t<div>\n\t\t\t\t\t<h1 className=\"text-3xl font-bold tracking-tight\">\n\t\t\t\t\t\tAPI Usage & Costs\n\t\t\t\t\t</h1>\n\t\t\t\t\t<p className=\"text-muted-foreground mt-2\">\n\t\t\t\t\t\tMonitor API usage, costs, and service health across all integrations\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t{healthSummary && (\n\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\tvariant={\n\t\t\t\t\t\t\t\thealthSummary.overall_status === \"healthy\"\n\t\t\t\t\t\t\t\t\t? \"default\"\n\t\t\t\t\t\t\t\t\t: healthSummary.overall_status === \"degraded\"\n\t\t\t\t\t\t\t\t\t\t? \"secondary\"\n\t\t\t\t\t\t\t\t\t\t: \"destructive\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tclassName=\"text-sm\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{healthSummary.overall_status === \"healthy\" && (\n\t\t\t\t\t\t\t\t<CheckCircle className=\"mr-1 h-3 w-3\" />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{healthSummary.overall_status === \"degraded\" && (\n\t\t\t\t\t\t\t\t<AlertTriangle className=\"mr-1 h-3 w-3\" />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{healthSummary.overall_status === \"critical\" && (\n\t\t\t\t\t\t\t\t<AlertCircle className=\"mr-1 h-3 w-3\" />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\tSystem {healthSummary.overall_status}\n\t\t\t\t\t\t</Badge>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Overview Stats */}\n\t\t\t<div className=\"grid grid-cols-1 gap-4 md:grid-cols-4\">\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-muted-foreground flex items-center gap-2 text-sm font-medium\">\n\t\t\t\t\t\t\t<DollarSign className=\"h-4 w-4\" />\n\t\t\t\t\t\t\tCurrent Month Cost\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-3xl font-bold\">\n\t\t\t\t\t\t\t{formatCurrency(usageSummary?.total_cost_cents || 0)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-xs\">\n\t\t\t\t\t\t\tProjected: {formatCurrency(projectedMonthlyCost)} by month end\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-muted-foreground flex items-center gap-2 text-sm font-medium\">\n\t\t\t\t\t\t\t<TrendingUp className=\"h-4 w-4\" />\n\t\t\t\t\t\t\tServices at Risk\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={`text-3xl font-bold ${approachingLimits.length > 0 ? \"text-yellow-600\" : \"text-green-600\"}`}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{approachingLimits.length}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-xs\">\n\t\t\t\t\t\t\tApproaching free tier limits\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-muted-foreground flex items-center gap-2 text-sm font-medium\">\n\t\t\t\t\t\t\t<Server className=\"h-4 w-4\" />\n\t\t\t\t\t\t\tServices Monitored\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-3xl font-bold\">\n\t\t\t\t\t\t\t{usageSummary?.services.length || 0}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-xs\">\n\t\t\t\t\t\t\tActive integrations tracked\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-muted-foreground flex items-center gap-2 text-sm font-medium\">\n\t\t\t\t\t\t\t<Wifi className=\"h-4 w-4\" />\n\t\t\t\t\t\t\tSystem Uptime\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={`text-3xl font-bold ${getHealthColor(healthSummary?.overall_status || \"healthy\")}`}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{healthSummary?.average_uptime_24h.toFixed(1) || 100}%\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-xs\">\n\t\t\t\t\t\t\t24-hour average\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\n\t\t\t{/* Services Approaching Limits Alert */}\n\t\t\t{approachingLimits.length > 0 && (\n\t\t\t\t<Card className=\"border-yellow-300 bg-yellow-50 dark:border-yellow-900 dark:bg-yellow-900/20\">\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<CardTitle className=\"flex items-center gap-2 text-yellow-700 dark:text-yellow-400\">\n\t\t\t\t\t\t\t<AlertTriangle className=\"h-5 w-5\" />\n\t\t\t\t\t\t\tServices Approaching Free Tier Limits\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t<CardDescription className=\"text-yellow-600 dark:text-yellow-500\">\n\t\t\t\t\t\t\tThese services are nearing their free tier limits and may incur\n\t\t\t\t\t\t\tcharges soon\n\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{approachingLimits.map((service) => (\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tkey={service.service_id}\n\t\t\t\t\t\t\t\t\tclassName=\"flex items-center justify-between rounded-lg bg-white p-4 dark:bg-gray-900\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t{service.display_name}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\tvariant={\n\t\t\t\t\t\t\t\t\t\t\t\t\tservice.alert_level === \"critical\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"secondary\"\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{service.alert_level === \"critical\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"Critical\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Warning\"}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t{formatNumber(service.usage_count)} /{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t{formatNumber(service.free_tier_limit)} used\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"w-32\">\n\t\t\t\t\t\t\t\t\t\t<Progress\n\t\t\t\t\t\t\t\t\t\t\tvalue={service.percentage_used}\n\t\t\t\t\t\t\t\t\t\t\tclassName={\n\t\t\t\t\t\t\t\t\t\t\t\tservice.alert_level === \"critical\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"[&>div]:bg-red-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"[&>div]:bg-yellow-500\"\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-right text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{service.percentage_used.toFixed(1)}%\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t)}\n\n\t\t\t{/* Health Status */}\n\t\t\t{healthSummary && (\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Wifi className=\"h-5 w-5\" />\n\t\t\t\t\t\t\tService Health Status\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\tReal-time availability monitoring for all external services\n\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"mb-4 flex gap-4\">\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<div className=\"h-3 w-3 rounded-full bg-green-500\" />\n\t\t\t\t\t\t\t\t<span className=\"text-sm\">\n\t\t\t\t\t\t\t\t\t{healthSummary.healthy_services} Healthy\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{healthSummary.degraded_services > 0 && (\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<div className=\"h-3 w-3 rounded-full bg-yellow-500\" />\n\t\t\t\t\t\t\t\t\t<span className=\"text-sm\">\n\t\t\t\t\t\t\t\t\t\t{healthSummary.degraded_services} Degraded\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{healthSummary.down_services > 0 && (\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<div className=\"h-3 w-3 rounded-full bg-red-500\" />\n\t\t\t\t\t\t\t\t\t<span className=\"text-sm\">\n\t\t\t\t\t\t\t\t\t\t{healthSummary.down_services} Down\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-2 md:grid-cols-4 lg:grid-cols-6\">\n\t\t\t\t\t\t\t{healthSummary.services.map((service) => (\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tkey={service.service_id}\n\t\t\t\t\t\t\t\t\tclassName=\"flex items-center gap-2 rounded-lg border p-2\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{service.current_status === \"healthy\" ? (\n\t\t\t\t\t\t\t\t\t\t<CheckCircle className=\"h-4 w-4 text-green-500\" />\n\t\t\t\t\t\t\t\t\t) : service.current_status === \"degraded\" ? (\n\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-4 w-4 text-yellow-500\" />\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<WifiOff className=\"h-4 w-4 text-red-500\" />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t<span className=\"truncate text-xs\">\n\t\t\t\t\t\t\t\t\t\t{service.display_name}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t)}\n\n\t\t\t{/* Usage by Category */}\n\t\t\t{Object.entries(servicesByCategory).map(([category, services]) => (\n\t\t\t\t<Card key={category}>\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<CardTitle className=\"capitalize\">\n\t\t\t\t\t\t\t{category.replace(/_/g, \" \")}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\tUsage and costs for {category.replace(/_/g, \" \").toLowerCase()}{\" \"}\n\t\t\t\t\t\t\tservices\n\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{services.map((service) => {\n\t\t\t\t\t\t\t\tconst config = API_SERVICES[service.service_id];\n\t\t\t\t\t\t\t\tconst hasFreeTier = config?.free_tier;\n\t\t\t\t\t\t\t\tconst freeTierLimit = config?.free_tier?.monthly_limit || 0;\n\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tkey={service.service_id}\n\t\t\t\t\t\t\t\t\t\tclassName=\"rounded-lg border p-4\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{service.display_name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{service.alert_level !== \"normal\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tservice.alert_level === \"critical\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"secondary\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{service.alert_level === \"critical\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"95%+\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"80%+\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground mt-1 flex items-center gap-4 text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tUsage:{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong>{formatNumber(service.usage_count)}</strong>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{hasFreeTier && ` / ${formatNumber(freeTierLimit)}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{service.cost_cents > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCost:{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(service.cost_cents)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</strong>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{service.last_synced && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"flex items-center gap-1 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Clock className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSynced{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{new Date(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tservice.last_synced,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t).toLocaleTimeString()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{hasFreeTier && (\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-40\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Progress\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={service.free_tier_percentage}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={`${\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tservice.alert_level === \"critical\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"[&>div]:bg-red-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: service.alert_level === \"warning\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"[&>div]:bg-yellow-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"[&>div]:bg-green-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground mt-1 flex justify-between text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>Free tier</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{service.free_tier_percentage.toFixed(1)}%\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t))}\n\n\t\t\t{/* Cost Breakdown */}\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<DollarSign className=\"h-5 w-5\" />\n\t\t\t\t\t\tMonthly Cost Breakdown\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>Estimated costs by service category</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t{Object.entries(servicesByCategory).map(([category, services]) => {\n\t\t\t\t\t\t\tconst categoryCost = services.reduce(\n\t\t\t\t\t\t\t\t(sum, s) => sum + s.cost_cents,\n\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tconst percentage = usageSummary?.total_cost_cents\n\t\t\t\t\t\t\t\t? (categoryCost / usageSummary.total_cost_cents) * 100\n\t\t\t\t\t\t\t\t: 0;\n\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tkey={category}\n\t\t\t\t\t\t\t\t\tclassName=\"flex items-center justify-between\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"font-medium capitalize\">\n\t\t\t\t\t\t\t\t\t\t\t{category.replace(/_/g, \" \")}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t{services.length} services\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-4\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"w-32\">\n\t\t\t\t\t\t\t\t\t\t\t<Progress value={percentage} />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"w-20 text-right font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(categoryCost)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})}\n\t\t\t\t\t\t<div className=\"mt-4 flex items-center justify-between border-t pt-4\">\n\t\t\t\t\t\t\t<div className=\"text-lg font-bold\">Total Estimated Cost</div>\n\t\t\t\t\t\t\t<div className=\"text-lg font-bold\">\n\t\t\t\t\t\t\t\t{formatCurrency(usageSummary?.total_cost_cents || 0)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t{/* Info Card */}\n\t\t\t<Card className=\"bg-muted/50\">\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle>About API Usage Tracking</CardTitle>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\tThis dashboard provides real-time monitoring of all external API\n\t\t\t\t\t\tintegrations used by Stratos:\n\t\t\t\t\t</p>\n\t\t\t\t\t<ul className=\"text-muted-foreground list-inside list-disc space-y-2 text-sm\">\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<strong>Usage Tracking</strong> - Monitor API calls, tokens, and\n\t\t\t\t\t\t\tresource consumption\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<strong>Free Tier Alerts</strong> - Get warned at 80% and 95% of\n\t\t\t\t\t\t\tfree tier limits\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<strong>Cost Estimation</strong> - Track actual costs and project\n\t\t\t\t\t\t\tmonthly expenses\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<strong>Health Monitoring</strong> - Real-time availability and\n\t\t\t\t\t\t\tuptime tracking\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<strong>Automatic Sync</strong> - Usage data is synced hourly from\n\t\t\t\t\t\t\tprovider APIs\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t\t<div className=\"border-t pt-4\">\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t<strong>Note:</strong> Cost estimates are based on current usage\n\t\t\t\t\t\t\tpatterns. Actual charges may vary. Some services (like internal\n\t\t\t\t\t\t\ttracking) show usage without costs as they are included in your\n\t\t\t\t\t\t\tsubscription.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n","/**\n * API Usage Dashboard Page\n *\n * Displays real-time API usage, costs, and health status.\n * Admin-only access for monitoring external service integrations.\n */\n\nimport { Suspense } from \"react\";\nimport { ApiUsageData } from \"@/components/settings/api-usage/api-usage-data\";\nimport { ApiUsageSkeleton } from \"@/components/settings/api-usage/api-usage-skeleton\";\n\n// Force dynamic rendering - this page requires authentication and real-time data\nexport const dynamic = \"force-dynamic\";\n\nexport const metadata = {\n\ttitle: \"API Usage & Costs | Settings\",\n\tdescription:\n\t\t\"Monitor API usage, costs, and service health across all integrations\",\n};\n\nexport default function ApiUsagePage() {\n\treturn (\n\t\t<Suspense fallback={<ApiUsageSkeleton />}>\n\t\t\t<ApiUsageData />\n\t\t</Suspense>\n\t);\n}\n","/**\n * API Health Check Service\n *\n * Monitors availability and response times for all external APIs\n * Calculates uptime percentages and tracks service health history\n */\n\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\nimport { API_SERVICES } from \"./api-service-config\";\nimport { googleCloudClient } from \"./providers/google-cloud-client\";\nimport { stripeBillingClient } from \"./providers/stripe-billing-client\";\nimport { supabaseUsageClient } from \"./providers/supabase-usage-client\";\n// Twilio health checks are done via simple HTTP endpoint check\n\nexport interface HealthCheckResult {\n\tservice_id: string;\n\thealthy: boolean;\n\tresponse_time_ms: number;\n\terror?: string;\n\tchecked_at: string;\n}\n\nexport interface ServiceHealthStatus {\n\tservice_id: string;\n\tdisplay_name: string;\n\tcategory: string;\n\tcurrent_status: \"healthy\" | \"degraded\" | \"down\";\n\tuptime_24h: number;\n\tuptime_7d: number;\n\tuptime_30d: number;\n\taverage_response_ms: number;\n\tlast_checked: string | null;\n\tlast_error: string | null;\n\tconsecutive_failures: number;\n}\n\nexport interface HealthCheckJobResult {\n\tjob_id: string;\n\tstarted_at: string;\n\tcompleted_at: string;\n\ttotal_services: number;\n\thealthy: number;\n\tunhealthy: number;\n\tresults: HealthCheckResult[];\n}\n\n/**\n * Health check endpoints for each service\n */\nconst HEALTH_ENDPOINTS: Record<\n\tstring,\n\t{\n\t\tcheck: () => Promise<{\n\t\t\thealthy: boolean;\n\t\t\tresponseTimeMs: number;\n\t\t\terror?: string;\n\t\t}>;\n\t}\n> = {\n\t// Twilio\n\ttwilio_voice: {\n\t\tcheck: () => checkHttpEndpoint(\"https://api.twilio.com/2010-04-01\", \"Twilio\"),\n\t},\n\ttwilio_sms: {\n\t\tcheck: () => checkHttpEndpoint(\"https://api.twilio.com/2010-04-01\", \"Twilio\"),\n\t},\n\n\t// Supabase\n\tsupabase_database: { check: () => supabaseUsageClient.checkHealth() },\n\tsupabase_auth: { check: () => supabaseUsageClient.checkHealth() },\n\tsupabase_storage: { check: () => supabaseUsageClient.checkHealth() },\n\tsupabase_realtime: { check: () => supabaseUsageClient.checkHealth() },\n\n\t// Google Cloud\n\tgoogle_gemini: { check: () => googleCloudClient.checkHealth() },\n\tgoogle_maps_geocoding: { check: () => checkGoogleMapsHealth() },\n\n\t// Stripe\n\tstripe_payments: { check: () => stripeBillingClient.checkHealth() },\n\n\t// External APIs - simple HTTP checks\n\tsendgrid: {\n\t\tcheck: () => checkHttpEndpoint(\"https://api.sendgrid.com/v3/mail/send\", \"SendGrid\"),\n\t},\n\tassembly_ai: {\n\t\tcheck: () =>\n\t\t\tcheckHttpEndpoint(\n\t\t\t\t\"https://api.assemblyai.com/v2/transcript\",\n\t\t\t\t\"AssemblyAI\",\n\t\t\t),\n\t},\n\twalkscore: {\n\t\tcheck: () =>\n\t\t\tcheckHttpEndpoint(\"https://api.walkscore.com/score\", \"WalkScore\"),\n\t},\n\tcensus_bureau: {\n\t\tcheck: () =>\n\t\t\tcheckHttpEndpoint(\"https://api.census.gov/data.json\", \"Census Bureau\"),\n\t},\n\n\t// Vercel\n\tvercel_hosting: { check: () => checkVercelHealth() },\n};\n\n/**\n * Run health checks on all configured services\n */\nexport async function runHealthChecks(): Promise<HealthCheckJobResult> {\n\tconst supabase = createServiceSupabaseClient();\n\tconst jobId = crypto.randomUUID();\n\tconst startedAt = new Date().toISOString();\n\tconst results: HealthCheckResult[] = [];\n\n\t// Run all health checks in parallel\n\tconst checkPromises = Object.entries(HEALTH_ENDPOINTS).map(\n\t\tasync ([serviceId, { check }]) => {\n\t\t\ttry {\n\t\t\t\tconst result = await check();\n\t\t\t\treturn {\n\t\t\t\t\tservice_id: serviceId,\n\t\t\t\t\thealthy: result.healthy,\n\t\t\t\t\tresponse_time_ms: result.responseTimeMs,\n\t\t\t\t\terror: result.error,\n\t\t\t\t\tchecked_at: new Date().toISOString(),\n\t\t\t\t};\n\t\t\t} catch (error) {\n\t\t\t\treturn {\n\t\t\t\t\tservice_id: serviceId,\n\t\t\t\t\thealthy: false,\n\t\t\t\t\tresponse_time_ms: 0,\n\t\t\t\t\terror: error instanceof Error ? error.message : \"Health check failed\",\n\t\t\t\t\tchecked_at: new Date().toISOString(),\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\t);\n\n\tconst checkResults = await Promise.allSettled(checkPromises);\n\n\tfor (const result of checkResults) {\n\t\tif (result.status === \"fulfilled\") {\n\t\t\tresults.push(result.value);\n\t\t}\n\t}\n\n\t// Save health check results to database\n\tfor (const result of results) {\n\t\t// Insert health log entry\n\t\tawait supabase.from(\"api_health_log\").insert({\n\t\t\tservice_id: result.service_id,\n\t\t\tis_healthy: result.healthy,\n\t\t\tresponse_time_ms: result.response_time_ms,\n\t\t\terror_message: result.error || null,\n\t\t\tchecked_at: result.checked_at,\n\t\t});\n\n\t\t// Update service config with health status\n\t\tawait supabase\n\t\t\t.from(\"api_service_config\")\n\t\t\t.update({\n\t\t\t\tis_healthy: result.healthy,\n\t\t\t\tlast_checked: result.checked_at,\n\t\t\t\tlast_response_time_ms: result.response_time_ms,\n\t\t\t})\n\t\t\t.eq(\"service_id\", result.service_id);\n\t}\n\n\tconst completedAt = new Date().toISOString();\n\tconst healthy = results.filter((r) => r.healthy).length;\n\tconst unhealthy = results.filter((r) => !r.healthy).length;\n\n\treturn {\n\t\tjob_id: jobId,\n\t\tstarted_at: startedAt,\n\t\tcompleted_at: completedAt,\n\t\ttotal_services: results.length,\n\t\thealthy,\n\t\tunhealthy,\n\t\tresults,\n\t};\n}\n\n/**\n * Get current health status for all services\n */\nexport async function getServiceHealthStatus(): Promise<ServiceHealthStatus[]> {\n\tconst supabase = createServiceSupabaseClient();\n\n\t// Get recent health logs\n\tconst now = new Date();\n\tconst twentyFourHoursAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n\tconst sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n\tconst thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\n\n\tconst results: ServiceHealthStatus[] = [];\n\n\tfor (const [serviceId, config] of Object.entries(API_SERVICES)) {\n\t\t// Skip services without health checks\n\t\tif (!HEALTH_ENDPOINTS[serviceId]) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Get health logs for different time periods\n\t\tconst { data: logs24h } = await supabase\n\t\t\t.from(\"api_health_log\")\n\t\t\t.select(\"is_healthy, response_time_ms\")\n\t\t\t.eq(\"service_id\", serviceId)\n\t\t\t.gte(\"checked_at\", twentyFourHoursAgo.toISOString());\n\n\t\tconst { data: logs7d } = await supabase\n\t\t\t.from(\"api_health_log\")\n\t\t\t.select(\"is_healthy\")\n\t\t\t.eq(\"service_id\", serviceId)\n\t\t\t.gte(\"checked_at\", sevenDaysAgo.toISOString());\n\n\t\tconst { data: logs30d } = await supabase\n\t\t\t.from(\"api_health_log\")\n\t\t\t.select(\"is_healthy\")\n\t\t\t.eq(\"service_id\", serviceId)\n\t\t\t.gte(\"checked_at\", thirtyDaysAgo.toISOString());\n\n\t\t// Get most recent log\n\t\tconst { data: latestLog } = await supabase\n\t\t\t.from(\"api_health_log\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"service_id\", serviceId)\n\t\t\t.order(\"checked_at\", { ascending: false })\n\t\t\t.limit(1)\n\t\t\t.single();\n\n\t\t// Calculate uptimes\n\t\tconst calculateUptime = (\n\t\t\tlogs: Array<{ is_healthy: boolean }> | null,\n\t\t): number => {\n\t\t\tif (!logs || logs.length === 0) return 100;\n\t\t\tconst healthy = logs.filter((l) => l.is_healthy).length;\n\t\t\treturn Math.round((healthy / logs.length) * 10000) / 100;\n\t\t};\n\n\t\t// Calculate average response time\n\t\tconst calculateAvgResponseTime = (\n\t\t\tlogs: Array<{ response_time_ms: number }> | null,\n\t\t): number => {\n\t\t\tif (!logs || logs.length === 0) return 0;\n\t\t\tconst total = logs.reduce((sum, l) => sum + (l.response_time_ms || 0), 0);\n\t\t\treturn Math.round(total / logs.length);\n\t\t};\n\n\t\t// Count consecutive failures\n\t\tconst { data: recentLogs } = await supabase\n\t\t\t.from(\"api_health_log\")\n\t\t\t.select(\"is_healthy\")\n\t\t\t.eq(\"service_id\", serviceId)\n\t\t\t.order(\"checked_at\", { ascending: false })\n\t\t\t.limit(10);\n\n\t\tlet consecutiveFailures = 0;\n\t\tif (recentLogs) {\n\t\t\tfor (const log of recentLogs) {\n\t\t\t\tif (!log.is_healthy) {\n\t\t\t\t\tconsecutiveFailures++;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Determine current status\n\t\tlet currentStatus: \"healthy\" | \"degraded\" | \"down\" = \"healthy\";\n\t\tconst uptime24h = calculateUptime(logs24h);\n\n\t\tif (consecutiveFailures >= 3 || uptime24h < 50) {\n\t\t\tcurrentStatus = \"down\";\n\t\t} else if (consecutiveFailures >= 1 || uptime24h < 95) {\n\t\t\tcurrentStatus = \"degraded\";\n\t\t}\n\n\t\tresults.push({\n\t\t\tservice_id: serviceId,\n\t\t\tdisplay_name: config.display_name,\n\t\t\tcategory: config.category,\n\t\t\tcurrent_status: currentStatus,\n\t\t\tuptime_24h: uptime24h,\n\t\t\tuptime_7d: calculateUptime(logs7d),\n\t\t\tuptime_30d: calculateUptime(logs30d),\n\t\t\taverage_response_ms: calculateAvgResponseTime(logs24h),\n\t\t\tlast_checked: latestLog?.checked_at || null,\n\t\t\tlast_error: latestLog?.error_message || null,\n\t\t\tconsecutive_failures: consecutiveFailures,\n\t\t});\n\t}\n\n\treturn results;\n}\n\n/**\n * Get overall system health summary\n */\nexport async function getSystemHealthSummary(): Promise<{\n\toverall_status: \"healthy\" | \"degraded\" | \"critical\";\n\thealthy_services: number;\n\tdegraded_services: number;\n\tdown_services: number;\n\taverage_uptime_24h: number;\n\tservices: ServiceHealthStatus[];\n}> {\n\tconst services = await getServiceHealthStatus();\n\n\tconst healthy = services.filter((s) => s.current_status === \"healthy\").length;\n\tconst degraded = services.filter(\n\t\t(s) => s.current_status === \"degraded\",\n\t).length;\n\tconst down = services.filter((s) => s.current_status === \"down\").length;\n\n\t// Calculate average 24h uptime\n\tconst avgUptime =\n\t\tservices.length > 0\n\t\t\t? services.reduce((sum, s) => sum + s.uptime_24h, 0) / services.length\n\t\t\t: 100;\n\n\t// Determine overall status\n\tlet overallStatus: \"healthy\" | \"degraded\" | \"critical\" = \"healthy\";\n\tif (down > 0 || avgUptime < 90) {\n\t\toverallStatus = \"critical\";\n\t} else if (degraded > 0 || avgUptime < 99) {\n\t\toverallStatus = \"degraded\";\n\t}\n\n\treturn {\n\t\toverall_status: overallStatus,\n\t\thealthy_services: healthy,\n\t\tdegraded_services: degraded,\n\t\tdown_services: down,\n\t\taverage_uptime_24h: Math.round(avgUptime * 100) / 100,\n\t\tservices,\n\t};\n}\n\n/**\n * Helper: Check a simple HTTP endpoint\n */\nasync function checkHttpEndpoint(\n\turl: string,\n\tserviceName: string,\n): Promise<{ healthy: boolean; responseTimeMs: number; error?: string }> {\n\tconst startTime = Date.now();\n\n\ttry {\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: \"HEAD\",\n\t\t\tsignal: AbortSignal.timeout(10000), // 10 second timeout\n\t\t});\n\n\t\tconst responseTimeMs = Date.now() - startTime;\n\n\t\t// Consider 2xx-4xx as healthy (API is responding)\n\t\t// 5xx indicates server issues\n\t\tif (response.status < 500) {\n\t\t\treturn { healthy: true, responseTimeMs };\n\t\t}\n\n\t\treturn {\n\t\t\thealthy: false,\n\t\t\tresponseTimeMs,\n\t\t\terror: `HTTP ${response.status}`,\n\t\t};\n\t} catch (error) {\n\t\treturn {\n\t\t\thealthy: false,\n\t\t\tresponseTimeMs: Date.now() - startTime,\n\t\t\terror: error instanceof Error ? error.message : \"Connection failed\",\n\t\t};\n\t}\n}\n\n/**\n * Helper: Check Google Maps API health\n */\nasync function checkGoogleMapsHealth(): Promise<{\n\thealthy: boolean;\n\tresponseTimeMs: number;\n\terror?: string;\n}> {\n\tconst apiKey = process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY;\n\n\tif (!apiKey) {\n\t\treturn {\n\t\t\thealthy: true,\n\t\t\tresponseTimeMs: 0,\n\t\t\terror: \"API key not configured\",\n\t\t};\n\t}\n\n\treturn checkHttpEndpoint(\n\t\t`https://maps.googleapis.com/maps/api/geocode/json?address=test&key=${apiKey}`,\n\t\t\"Google Maps\",\n\t);\n}\n\n/**\n * Helper: Check Vercel hosting health\n */\nasync function checkVercelHealth(): Promise<{\n\thealthy: boolean;\n\tresponseTimeMs: number;\n\terror?: string;\n}> {\n\tconst projectUrl = process.env.NEXT_PUBLIC_APP_URL || process.env.VERCEL_URL;\n\n\tif (!projectUrl) {\n\t\treturn { healthy: true, responseTimeMs: 0, error: \"URL not configured\" };\n\t}\n\n\tconst url = projectUrl.startsWith(\"http\")\n\t\t? projectUrl\n\t\t: `https://${projectUrl}`;\n\treturn checkHttpEndpoint(`${url}/api/health`, \"Vercel\");\n}\n\n/**\n * Get service health history for charting\n */\nexport async function getServiceHealthHistory(\n\tserviceId: string,\n\thours: number = 24,\n): Promise<\n\tArray<{\n\t\ttimestamp: string;\n\t\tis_healthy: boolean;\n\t\tresponse_time_ms: number;\n\t}>\n> {\n\tconst supabase = createServiceSupabaseClient();\n\tconst since = new Date(Date.now() - hours * 60 * 60 * 1000);\n\n\tconst { data, error } = await supabase\n\t\t.from(\"api_health_log\")\n\t\t.select(\"checked_at, is_healthy, response_time_ms\")\n\t\t.eq(\"service_id\", serviceId)\n\t\t.gte(\"checked_at\", since.toISOString())\n\t\t.order(\"checked_at\", { ascending: true });\n\n\tif (error) {\n\t\tconsole.error(\"Error fetching health history:\", error);\n\t\treturn [];\n\t}\n\n\treturn (\n\t\tdata?.map((log) => ({\n\t\t\ttimestamp: log.checked_at,\n\t\t\tis_healthy: log.is_healthy,\n\t\t\tresponse_time_ms: log.response_time_ms,\n\t\t})) || []\n\t);\n}\n","/**\n * Twilio Usage Client\n *\n * Fetches voice and SMS usage data from Twilio API\n * for billing and usage tracking\n */\n\nimport Twilio from \"twilio\";\n\ninterface TwilioVoiceUsage {\n\ttotal_minutes: number;\n\tinbound_minutes: number;\n\toutbound_minutes: number;\n\ttotal_cost_cents: number;\n}\n\ninterface TwilioSmsUsage {\n\ttotal_messages: number;\n\tinbound_messages: number;\n\toutbound_messages: number;\n\ttotal_cost_cents: number;\n}\n\ninterface TwilioUsageResponse {\n\tvoice: TwilioVoiceUsage | null;\n\tsms: TwilioSmsUsage | null;\n}\n\nclass TwilioUsageClient {\n\tprivate client: ReturnType<typeof Twilio> | null = null;\n\tprivate accountSid: string | undefined;\n\n\tprivate getClient() {\n\t\tif (this.client) return this.client;\n\n\t\tconst accountSid = process.env.TWILIO_ACCOUNT_SID;\n\t\tconst authToken = process.env.TWILIO_AUTH_TOKEN;\n\n\t\tif (!accountSid || !authToken) {\n\t\t\tconsole.warn(\"Twilio credentials not configured\");\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.accountSid = accountSid;\n\t\tthis.client = Twilio(accountSid, authToken);\n\t\treturn this.client;\n\t}\n\n\tasync getCurrentMonthUsage(): Promise<TwilioUsageResponse> {\n\t\tconst client = this.getClient();\n\t\tif (!client || !this.accountSid) {\n\t\t\treturn { voice: null, sms: null };\n\t\t}\n\n\t\ttry {\n\t\t\t// Get current month date range\n\t\t\tconst now = new Date();\n\t\t\tconst startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n\t\t\tconst endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);\n\n\t\t\t// Fetch usage records for the current month\n\t\t\tconst usageRecords = await client.usage.records.list({\n\t\t\t\tstartDate: startOfMonth,\n\t\t\t\tendDate: endOfMonth,\n\t\t\t});\n\n\t\t\t// Parse voice usage\n\t\t\tconst voiceRecords = usageRecords.filter(\n\t\t\t\t(r) =>\n\t\t\t\t\tr.category === \"calls\" ||\n\t\t\t\t\tr.category === \"calls-inbound\" ||\n\t\t\t\t\tr.category === \"calls-outbound\",\n\t\t\t);\n\n\t\t\tlet voiceInboundMinutes = 0;\n\t\t\tlet voiceOutboundMinutes = 0;\n\t\t\tlet voiceTotalCost = 0;\n\n\t\t\tfor (const record of voiceRecords) {\n\t\t\t\tconst minutes = parseFloat(record.usage || \"0\") / 60; // Convert seconds to minutes\n\t\t\t\tconst cost = parseFloat(record.price || \"0\");\n\n\t\t\t\tif (record.category === \"calls-inbound\") {\n\t\t\t\t\tvoiceInboundMinutes += minutes;\n\t\t\t\t} else if (record.category === \"calls-outbound\") {\n\t\t\t\t\tvoiceOutboundMinutes += minutes;\n\t\t\t\t}\n\t\t\t\tvoiceTotalCost += cost;\n\t\t\t}\n\n\t\t\t// Parse SMS usage\n\t\t\tconst smsRecords = usageRecords.filter(\n\t\t\t\t(r) =>\n\t\t\t\t\tr.category === \"sms\" ||\n\t\t\t\t\tr.category === \"sms-inbound\" ||\n\t\t\t\t\tr.category === \"sms-outbound\",\n\t\t\t);\n\n\t\t\tlet smsInbound = 0;\n\t\t\tlet smsOutbound = 0;\n\t\t\tlet smsTotalCost = 0;\n\n\t\t\tfor (const record of smsRecords) {\n\t\t\t\tconst count = parseInt(record.count || \"0\", 10);\n\t\t\t\tconst cost = parseFloat(record.price || \"0\");\n\n\t\t\t\tif (record.category === \"sms-inbound\") {\n\t\t\t\t\tsmsInbound += count;\n\t\t\t\t} else if (record.category === \"sms-outbound\") {\n\t\t\t\t\tsmsOutbound += count;\n\t\t\t\t}\n\t\t\t\tsmsTotalCost += cost;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tvoice: {\n\t\t\t\t\ttotal_minutes: voiceInboundMinutes + voiceOutboundMinutes,\n\t\t\t\t\tinbound_minutes: voiceInboundMinutes,\n\t\t\t\t\toutbound_minutes: voiceOutboundMinutes,\n\t\t\t\t\ttotal_cost_cents: Math.round(voiceTotalCost * 100),\n\t\t\t\t},\n\t\t\t\tsms: {\n\t\t\t\t\ttotal_messages: smsInbound + smsOutbound,\n\t\t\t\t\tinbound_messages: smsInbound,\n\t\t\t\t\toutbound_messages: smsOutbound,\n\t\t\t\t\ttotal_cost_cents: Math.round(smsTotalCost * 100),\n\t\t\t\t},\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error fetching Twilio usage:\", error);\n\t\t\treturn { voice: null, sms: null };\n\t\t}\n\t}\n\n\tasync checkHealth(): Promise<{\n\t\thealthy: boolean;\n\t\tresponseTimeMs: number;\n\t\terror?: string;\n\t}> {\n\t\tconst startTime = Date.now();\n\t\tconst client = this.getClient();\n\n\t\tif (!client || !this.accountSid) {\n\t\t\treturn {\n\t\t\t\thealthy: false,\n\t\t\t\tresponseTimeMs: Date.now() - startTime,\n\t\t\t\terror: \"Twilio credentials not configured\",\n\t\t\t};\n\t\t}\n\n\t\ttry {\n\t\t\t// Simple health check - fetch account info\n\t\t\tawait client.api.v2010.accounts(this.accountSid).fetch();\n\t\t\treturn {\n\t\t\t\thealthy: true,\n\t\t\t\tresponseTimeMs: Date.now() - startTime,\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn {\n\t\t\t\thealthy: false,\n\t\t\t\tresponseTimeMs: Date.now() - startTime,\n\t\t\t\terror: error instanceof Error ? error.message : \"Health check failed\",\n\t\t\t};\n\t\t}\n\t}\n}\n\nexport const twilioUsageClient = new TwilioUsageClient();\n","import { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nexport function ApiUsageSkeleton() {\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t{/* Header */}\n\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t<div>\n\t\t\t\t\t<Skeleton className=\"h-9 w-64\" />\n\t\t\t\t\t<Skeleton className=\"mt-2 h-5 w-96\" />\n\t\t\t\t</div>\n\t\t\t\t<Skeleton className=\"h-6 w-32\" />\n\t\t\t</div>\n\n\t\t\t{/* Overview Stats */}\n\t\t\t<div className=\"grid grid-cols-1 gap-4 md:grid-cols-4\">\n\t\t\t\t{[...Array(4)].map((_, i) => (\n\t\t\t\t\t<Card key={i}>\n\t\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t\t<Skeleton className=\"h-4 w-32\" />\n\t\t\t\t\t\t</CardHeader>\n\t\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t\t<Skeleton className=\"h-9 w-24\" />\n\t\t\t\t\t\t\t<Skeleton className=\"mt-2 h-3 w-40\" />\n\t\t\t\t\t\t</CardContent>\n\t\t\t\t\t</Card>\n\t\t\t\t))}\n\t\t\t</div>\n\n\t\t\t{/* Alert Card */}\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<Skeleton className=\"h-6 w-64\" />\n\t\t\t\t\t<Skeleton className=\"mt-2 h-4 w-96\" />\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t{[...Array(2)].map((_, i) => (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\t\t\tclassName=\"flex items-center justify-between rounded-lg border p-4\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-5 w-40\" />\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"mt-2 h-4 w-32\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<Skeleton className=\"h-2 w-32\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t{/* Health Status */}\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<Skeleton className=\"h-6 w-48\" />\n\t\t\t\t\t<Skeleton className=\"mt-2 h-4 w-72\" />\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"mb-4 flex gap-4\">\n\t\t\t\t\t\t<Skeleton className=\"h-5 w-24\" />\n\t\t\t\t\t\t<Skeleton className=\"h-5 w-24\" />\n\t\t\t\t\t\t<Skeleton className=\"h-5 w-24\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-2 md:grid-cols-4 lg:grid-cols-6\">\n\t\t\t\t\t\t{[...Array(12)].map((_, i) => (\n\t\t\t\t\t\t\t<Skeleton key={i} className=\"h-10 w-full\" />\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t{/* Usage Cards */}\n\t\t\t{[...Array(3)].map((_, i) => (\n\t\t\t\t<Card key={i}>\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<Skeleton className=\"h-6 w-40\" />\n\t\t\t\t\t\t<Skeleton className=\"mt-2 h-4 w-64\" />\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{[...Array(3)].map((_, j) => (\n\t\t\t\t\t\t\t\t<div key={j} className=\"rounded-lg border p-4\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-5 w-48\" />\n\t\t\t\t\t\t\t\t\t\t\t<Skeleton className=\"mt-2 h-4 w-64\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-2 w-40\" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t))}\n\n\t\t\t{/* Cost Breakdown */}\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<Skeleton className=\"h-6 w-48\" />\n\t\t\t\t\t<Skeleton className=\"mt-2 h-4 w-56\" />\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t{[...Array(4)].map((_, i) => (\n\t\t\t\t\t\t\t<div key={i} className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-5 w-32\" />\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"mt-1 h-4 w-24\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-4\">\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-2 w-32\" />\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-5 w-20\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t))}\n\t\t\t\t\t\t<div className=\"mt-4 flex items-center justify-between border-t pt-4\">\n\t\t\t\t\t\t\t<Skeleton className=\"h-6 w-48\" />\n\t\t\t\t\t\t\t<Skeleton className=\"h-6 w-24\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['rect', { width: '20', height: '8', x: '2', y: '2', rx: '2', ry: '2', key: 'ngkwjq' }],\n  ['rect', { width: '20', height: '8', x: '2', y: '14', rx: '2', ry: '2', key: 'iecqi9' }],\n  ['line', { x1: '6', x2: '6.01', y1: '6', y2: '6', key: '16zg32' }],\n  ['line', { x1: '6', x2: '6.01', y1: '18', y2: '18', key: 'nzw8ys' }],\n];\n\n/**\n * @component @name Server\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cmVjdCB3aWR0aD0iMjAiIGhlaWdodD0iOCIgeD0iMiIgeT0iMiIgcng9IjIiIHJ5PSIyIiAvPgogIDxyZWN0IHdpZHRoPSIyMCIgaGVpZ2h0PSI4IiB4PSIyIiB5PSIxNCIgcng9IjIiIHJ5PSIyIiAvPgogIDxsaW5lIHgxPSI2IiB4Mj0iNi4wMSIgeTE9IjYiIHkyPSI2IiAvPgogIDxsaW5lIHgxPSI2IiB4Mj0iNi4wMSIgeTE9IjE4IiB5Mj0iMTgiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/server\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Server = createLucideIcon('server', __iconNode);\n\nexport default Server;\n","/**\n * Supabase Management API Usage Client\n *\n * Fetches real usage data from Supabase Management API\n * Docs: https://supabase.com/docs/reference/api/introduction\n */\n\nexport interface SupabaseUsageStats {\n\ttotal_auth_requests: number;\n\ttotal_realtime_requests: number;\n\ttotal_rest_requests: number;\n\ttotal_storage_requests: number;\n\ttimestamp: string;\n}\n\nexport interface SupabaseProjectStats {\n\tdatabase_size_bytes: number;\n\tstorage_size_bytes: number;\n\tegress_bytes: number;\n\tmau: number;\n\tedge_function_invocations: number;\n}\n\ninterface ApiCountsResponse {\n\tdata: Array<{\n\t\ttotal_auth_requests: number;\n\t\ttotal_realtime_requests: number;\n\t\ttotal_rest_requests: number;\n\t\ttotal_storage_requests: number;\n\t\ttimestamp: string;\n\t}>;\n}\n\n/**\n * Supabase Usage Client\n * Requires SUPABASE_MANAGEMENT_PAT environment variable\n */\nexport class SupabaseUsageClient {\n\tprivate baseUrl = \"https://api.supabase.com/v1\";\n\tprivate accessToken: string;\n\tprivate projectRef: string;\n\n\tconstructor() {\n\t\tconst token = process.env.SUPABASE_MANAGEMENT_PAT;\n\t\tconst projectRef = process.env.NEXT_PUBLIC_SUPABASE_URL?.match(\n\t\t\t/https:\\/\\/([^.]+)\\.supabase\\.co/,\n\t\t)?.[1];\n\n\t\tif (!token) {\n\t\t\tconsole.warn(\n\t\t\t\t\"SUPABASE_MANAGEMENT_PAT not set - Supabase usage tracking disabled\",\n\t\t\t);\n\t\t}\n\n\t\tthis.accessToken = token || \"\";\n\t\tthis.projectRef = projectRef || \"\";\n\t}\n\n\tprivate async fetch<T>(\n\t\tendpoint: string,\n\t\tparams?: Record<string, string>,\n\t): Promise<T | null> {\n\t\tif (!this.accessToken || !this.projectRef) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst url = new URL(`${this.baseUrl}${endpoint}`);\n\t\tif (params) {\n\t\t\tObject.entries(params).forEach(([key, value]) => {\n\t\t\t\turl.searchParams.append(key, value);\n\t\t\t});\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await fetch(url.toString(), {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${this.accessToken}`,\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t`Supabase API error: ${response.status} ${response.statusText}`,\n\t\t\t\t);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn (await response.json()) as T;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Supabase API fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get API request counts for the project\n\t * Returns auth, realtime, rest, and storage request counts\n\t */\n\tasync getApiCounts(\n\t\tinterval: \"hourly\" | \"daily\" = \"daily\",\n\t): Promise<SupabaseUsageStats[] | null> {\n\t\tconst response = await this.fetch<ApiCountsResponse>(\n\t\t\t`/projects/${this.projectRef}/analytics/endpoints/usage.api-counts`,\n\t\t\t{\n\t\t\t\tinterval,\n\t\t\t},\n\t\t);\n\n\t\treturn response?.data || null;\n\t}\n\n\t/**\n\t * Get total API request count for the project\n\t */\n\tasync getTotalApiRequestCount(): Promise<number | null> {\n\t\tconst response = await this.fetch<{ count: number }>(\n\t\t\t`/projects/${this.projectRef}/analytics/endpoints/usage.api-requests-count`,\n\t\t);\n\n\t\treturn response?.count || null;\n\t}\n\n\t/**\n\t * Get project database size\n\t */\n\tasync getDatabaseSize(): Promise<number | null> {\n\t\t// This would require querying the database directly\n\t\t// The Management API doesn't expose database size directly\n\t\t// We can get this from pg_database_size() if needed\n\t\treturn null;\n\t}\n\n\t/**\n\t * Get aggregated usage for the current billing period\n\t */\n\tasync getCurrentPeriodUsage(): Promise<{\n\t\tauth_requests: number;\n\t\trest_requests: number;\n\t\trealtime_requests: number;\n\t\tstorage_requests: number;\n\t\ttotal_requests: number;\n\t} | null> {\n\t\tconst stats = await this.getApiCounts(\"daily\");\n\t\tif (!stats || stats.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Aggregate all stats for the current period\n\t\tconst aggregated = stats.reduce(\n\t\t\t(acc, stat) => ({\n\t\t\t\tauth_requests: acc.auth_requests + stat.total_auth_requests,\n\t\t\t\trest_requests: acc.rest_requests + stat.total_rest_requests,\n\t\t\t\trealtime_requests: acc.realtime_requests + stat.total_realtime_requests,\n\t\t\t\tstorage_requests: acc.storage_requests + stat.total_storage_requests,\n\t\t\t\ttotal_requests:\n\t\t\t\t\tacc.total_requests +\n\t\t\t\t\tstat.total_auth_requests +\n\t\t\t\t\tstat.total_rest_requests +\n\t\t\t\t\tstat.total_realtime_requests +\n\t\t\t\t\tstat.total_storage_requests,\n\t\t\t}),\n\t\t\t{\n\t\t\t\tauth_requests: 0,\n\t\t\t\trest_requests: 0,\n\t\t\t\trealtime_requests: 0,\n\t\t\t\tstorage_requests: 0,\n\t\t\t\ttotal_requests: 0,\n\t\t\t},\n\t\t);\n\n\t\treturn aggregated;\n\t}\n\n\t/**\n\t * Check if the Supabase API is healthy\n\t */\n\tasync checkHealth(): Promise<{\n\t\thealthy: boolean;\n\t\tresponseTimeMs: number;\n\t\terror?: string;\n\t}> {\n\t\tconst startTime = Date.now();\n\n\t\ttry {\n\t\t\tconst response = await fetch(`${this.baseUrl}/projects`, {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${this.accessToken}`,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst responseTimeMs = Date.now() - startTime;\n\n\t\t\tif (response.ok) {\n\t\t\t\treturn { healthy: true, responseTimeMs };\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\thealthy: false,\n\t\t\t\tresponseTimeMs,\n\t\t\t\terror: `HTTP ${response.status}: ${response.statusText}`,\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn {\n\t\t\t\thealthy: false,\n\t\t\t\tresponseTimeMs: Date.now() - startTime,\n\t\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\t};\n\t\t}\n\t}\n}\n\n// Export singleton instance\nexport const supabaseUsageClient = new SupabaseUsageClient();\n","/**\n * API Usage Sync Service\n *\n * Aggregates usage data from all provider APIs and syncs to database\n * Designed to run on a schedule (cron) or on-demand\n */\n\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\nimport {\n\tAPI_SERVICES,\n\tcalculateFreeTierPercentage,\n\tgetAlertLevel,\n} from \"./api-service-config\";\nimport {\n\tGoogleAITracker,\n\tgoogleCloudClient,\n} from \"./providers/google-cloud-client\";\nimport { stripeBillingClient } from \"./providers/stripe-billing-client\";\nimport { supabaseUsageClient } from \"./providers/supabase-usage-client\";\nimport { twilioUsageClient } from \"./providers/twilio-usage-client\";\n\nexport interface SyncResult {\n\tservice_id: string;\n\tsuccess: boolean;\n\tusage_count?: number;\n\tcost_cents?: number;\n\tfree_tier_percentage?: number;\n\talert_level?: \"normal\" | \"warning\" | \"critical\";\n\terror?: string;\n\tsynced_at: string;\n}\n\nexport interface SyncJobResult {\n\tjob_id: string;\n\tstarted_at: string;\n\tcompleted_at: string;\n\ttotal_services: number;\n\tsuccessful: number;\n\tfailed: number;\n\tresults: SyncResult[];\n}\n\n/**\n * Sync all provider usage data to database\n */\nexport async function syncAllUsage(): Promise<SyncJobResult> {\n\tconst supabase = createServiceSupabaseClient();\n\tconst jobId = crypto.randomUUID();\n\tconst startedAt = new Date().toISOString();\n\tconst results: SyncResult[] = [];\n\n\t// Create sync job record\n\tawait supabase.from(\"api_sync_jobs\").insert({\n\t\tid: jobId,\n\t\tstatus: \"running\",\n\t\tstarted_at: startedAt,\n\t});\n\n\t// Sync each provider in parallel\n\tconst syncPromises = [\n\t\tsyncTwilioUsage(),\n\t\tsyncSupabaseUsage(),\n\t\tsyncGoogleUsage(),\n\t\tsyncStripeUsage(),\n\t];\n\n\tconst syncResults = await Promise.allSettled(syncPromises);\n\n\tfor (const result of syncResults) {\n\t\tif (result.status === \"fulfilled\") {\n\t\t\tresults.push(...result.value);\n\t\t} else {\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"unknown\",\n\t\t\t\tsuccess: false,\n\t\t\t\terror: result.reason?.message || \"Unknown error\",\n\t\t\t\tsynced_at: new Date().toISOString(),\n\t\t\t});\n\t\t}\n\t}\n\n\t// Save usage data to database\n\tfor (const result of results) {\n\t\tif (result.success && result.usage_count !== undefined) {\n\t\t\tconst service = API_SERVICES[result.service_id];\n\t\t\tif (service) {\n\t\t\t\t// Update or insert realtime usage\n\t\t\t\tawait supabase.from(\"api_usage_realtime\").upsert(\n\t\t\t\t\t{\n\t\t\t\t\t\tservice_id: result.service_id,\n\t\t\t\t\t\tusage_count: result.usage_count,\n\t\t\t\t\t\tcost_cents: result.cost_cents || 0,\n\t\t\t\t\t\tfree_tier_remaining: service.free_tier\n\t\t\t\t\t\t\t? Math.max(\n\t\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\t\tservice.free_tier.monthly_limit - result.usage_count,\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tlast_synced: result.synced_at,\n\t\t\t\t\t\tmonth: new Date().toISOString().slice(0, 7),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tonConflict: \"service_id,month\",\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\t// Update service config with current usage\n\t\t\t\tawait supabase\n\t\t\t\t\t.from(\"api_service_config\")\n\t\t\t\t\t.update({\n\t\t\t\t\t\tcurrent_usage: result.usage_count,\n\t\t\t\t\t\tlast_checked: result.synced_at,\n\t\t\t\t\t})\n\t\t\t\t\t.eq(\"service_id\", result.service_id);\n\t\t\t}\n\t\t}\n\t}\n\n\tconst completedAt = new Date().toISOString();\n\tconst successful = results.filter((r) => r.success).length;\n\tconst failed = results.filter((r) => !r.success).length;\n\n\t// Update sync job status\n\tawait supabase\n\t\t.from(\"api_sync_jobs\")\n\t\t.update({\n\t\t\tstatus: failed === 0 ? \"completed\" : \"partial\",\n\t\t\tcompleted_at: completedAt,\n\t\t\tresults_summary: {\n\t\t\t\ttotal: results.length,\n\t\t\t\tsuccessful,\n\t\t\t\tfailed,\n\t\t\t},\n\t\t})\n\t\t.eq(\"id\", jobId);\n\n\treturn {\n\t\tjob_id: jobId,\n\t\tstarted_at: startedAt,\n\t\tcompleted_at: completedAt,\n\t\ttotal_services: results.length,\n\t\tsuccessful,\n\t\tfailed,\n\t\tresults,\n\t};\n}\n\n/**\n * Sync Twilio voice and SMS usage\n */\nasync function syncTwilioUsage(): Promise<SyncResult[]> {\n\tconst results: SyncResult[] = [];\n\tconst now = new Date().toISOString();\n\n\ttry {\n\t\tconst usage = await twilioUsageClient.getCurrentMonthUsage();\n\n\t\t// Voice usage\n\t\tif (usage.voice) {\n\t\t\tconst voiceService = API_SERVICES[\"twilio_voice\"];\n\t\t\tconst usageCount = usage.voice.total_minutes;\n\t\t\tconst freeTierPct = voiceService?.free_tier\n\t\t\t\t? calculateFreeTierPercentage(usageCount, voiceService.free_tier)\n\t\t\t\t: 0;\n\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"twilio_voice\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: usageCount,\n\t\t\t\tcost_cents: usage.voice.total_cost_cents,\n\t\t\t\tfree_tier_percentage: freeTierPct,\n\t\t\t\talert_level: getAlertLevel(freeTierPct),\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t} else {\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"twilio_voice\",\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"No voice data returned\",\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t}\n\n\t\t// SMS usage\n\t\tif (usage.sms) {\n\t\t\tconst smsService = API_SERVICES[\"twilio_sms\"];\n\t\t\tconst usageCount = usage.sms.total_messages;\n\t\t\tconst freeTierPct = smsService?.free_tier\n\t\t\t\t? calculateFreeTierPercentage(usageCount, smsService.free_tier)\n\t\t\t\t: 0;\n\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"twilio_sms\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: usageCount,\n\t\t\t\tcost_cents: usage.sms.total_cost_cents,\n\t\t\t\tfree_tier_percentage: freeTierPct,\n\t\t\t\talert_level: getAlertLevel(freeTierPct),\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t} else {\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"twilio_sms\",\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"No SMS data returned\",\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t}\n\t} catch (error) {\n\t\tresults.push({\n\t\t\tservice_id: \"twilio_voice\",\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\tsynced_at: now,\n\t\t});\n\t\tresults.push({\n\t\t\tservice_id: \"twilio_sms\",\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\tsynced_at: now,\n\t\t});\n\t}\n\n\treturn results;\n}\n\n/**\n * Sync Supabase API usage\n */\nasync function syncSupabaseUsage(): Promise<SyncResult[]> {\n\tconst results: SyncResult[] = [];\n\tconst now = new Date().toISOString();\n\n\ttry {\n\t\tconst usage = await supabaseUsageClient.getCurrentPeriodUsage();\n\n\t\tif (usage) {\n\t\t\t// Auth requests\n\t\t\tconst authService = API_SERVICES[\"supabase_auth\"];\n\t\t\tconst authFreeTierPct = authService?.free_tier\n\t\t\t\t? calculateFreeTierPercentage(\n\t\t\t\t\t\tusage.auth_requests,\n\t\t\t\t\t\tauthService.free_tier,\n\t\t\t\t\t)\n\t\t\t\t: 0;\n\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"supabase_auth\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: usage.auth_requests,\n\t\t\t\tcost_cents: 0, // Free tier\n\t\t\t\tfree_tier_percentage: authFreeTierPct,\n\t\t\t\talert_level: getAlertLevel(authFreeTierPct),\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\n\t\t\t// Database requests (REST API)\n\t\t\tconst dbService = API_SERVICES[\"supabase_database\"];\n\t\t\tconst dbFreeTierPct = dbService?.free_tier\n\t\t\t\t? calculateFreeTierPercentage(usage.rest_requests, dbService.free_tier)\n\t\t\t\t: 0;\n\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"supabase_database\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: usage.rest_requests,\n\t\t\t\tcost_cents: 0,\n\t\t\t\tfree_tier_percentage: dbFreeTierPct,\n\t\t\t\talert_level: getAlertLevel(dbFreeTierPct),\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\n\t\t\t// Realtime requests\n\t\t\tconst realtimeService = API_SERVICES[\"supabase_realtime\"];\n\t\t\tconst realtimeFreeTierPct = realtimeService?.free_tier\n\t\t\t\t? calculateFreeTierPercentage(\n\t\t\t\t\t\tusage.realtime_requests,\n\t\t\t\t\t\trealtimeService.free_tier,\n\t\t\t\t\t)\n\t\t\t\t: 0;\n\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"supabase_realtime\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: usage.realtime_requests,\n\t\t\t\tcost_cents: 0,\n\t\t\t\tfree_tier_percentage: realtimeFreeTierPct,\n\t\t\t\talert_level: getAlertLevel(realtimeFreeTierPct),\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\n\t\t\t// Storage requests\n\t\t\tconst storageService = API_SERVICES[\"supabase_storage\"];\n\t\t\tconst storageFreeTierPct = storageService?.free_tier\n\t\t\t\t? calculateFreeTierPercentage(\n\t\t\t\t\t\tusage.storage_requests,\n\t\t\t\t\t\tstorageService.free_tier,\n\t\t\t\t\t)\n\t\t\t\t: 0;\n\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"supabase_storage\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: usage.storage_requests,\n\t\t\t\tcost_cents: 0,\n\t\t\t\tfree_tier_percentage: storageFreeTierPct,\n\t\t\t\talert_level: getAlertLevel(storageFreeTierPct),\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t} else {\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"supabase_database\",\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"No usage data returned\",\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t}\n\t} catch (error) {\n\t\tresults.push({\n\t\t\tservice_id: \"supabase_database\",\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\tsynced_at: now,\n\t\t});\n\t}\n\n\treturn results;\n}\n\n/**\n * Sync Google Cloud/AI usage\n * Note: For accurate Google AI usage, internal tracking is required\n */\nasync function syncGoogleUsage(): Promise<SyncResult[]> {\n\tconst results: SyncResult[] = [];\n\tconst now = new Date().toISOString();\n\n\ttry {\n\t\tconst aiUsage = await googleCloudClient.getAIUsage();\n\t\tconst mapsUsage = await googleCloudClient.getMapsUsage();\n\n\t\t// Gemini AI\n\t\tif (aiUsage) {\n\t\t\tconst geminiService = API_SERVICES[\"google_gemini\"];\n\t\t\t// For Gemini, we track requests/tokens - need internal tracking\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"google_gemini\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: aiUsage.gemini_requests,\n\t\t\t\tcost_cents: aiUsage.total_cost_cents,\n\t\t\t\tfree_tier_percentage: 0, // Calculated internally\n\t\t\t\talert_level: \"normal\",\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t}\n\n\t\t// Google Maps\n\t\tif (mapsUsage) {\n\t\t\tconst mapsService = API_SERVICES[\"google_maps_geocoding\"];\n\t\t\tconst usageCount = mapsUsage.geocoding_requests;\n\t\t\tconst freeTierPct = mapsService?.free_tier\n\t\t\t\t? calculateFreeTierPercentage(usageCount, mapsService.free_tier)\n\t\t\t\t: 0;\n\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"google_maps_geocoding\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: usageCount,\n\t\t\t\tcost_cents: mapsUsage.total_cost_cents,\n\t\t\t\tfree_tier_percentage: freeTierPct,\n\t\t\t\talert_level: getAlertLevel(freeTierPct),\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t}\n\t} catch (error) {\n\t\tresults.push({\n\t\t\tservice_id: \"google_gemini\",\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\tsynced_at: now,\n\t\t});\n\t}\n\n\treturn results;\n}\n\n/**\n * Sync Stripe billing/fees\n */\nasync function syncStripeUsage(): Promise<SyncResult[]> {\n\tconst results: SyncResult[] = [];\n\tconst now = new Date().toISOString();\n\n\ttry {\n\t\tconst stats = await stripeBillingClient.getCurrentMonthStats();\n\n\t\tif (stats) {\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"stripe_payments\",\n\t\t\t\tsuccess: true,\n\t\t\t\tusage_count: stats.transaction_count,\n\t\t\t\tcost_cents: stats.fees_cents,\n\t\t\t\tfree_tier_percentage: 0, // Stripe has no free tier\n\t\t\t\talert_level: \"normal\",\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t} else {\n\t\t\tresults.push({\n\t\t\t\tservice_id: \"stripe_payments\",\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"No billing data returned\",\n\t\t\t\tsynced_at: now,\n\t\t\t});\n\t\t}\n\t} catch (error) {\n\t\tresults.push({\n\t\t\tservice_id: \"stripe_payments\",\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\tsynced_at: now,\n\t\t});\n\t}\n\n\treturn results;\n}\n\n/**\n * Get current usage summary from database\n */\nexport async function getUsageSummary(): Promise<{\n\tservices: Array<{\n\t\tservice_id: string;\n\t\tdisplay_name: string;\n\t\tcategory: string;\n\t\tusage_count: number;\n\t\tcost_cents: number;\n\t\tfree_tier_remaining: number | null;\n\t\tfree_tier_percentage: number;\n\t\talert_level: string;\n\t\tlast_synced: string | null;\n\t}>;\n\ttotal_cost_cents: number;\n\tservices_at_risk: number;\n} | null> {\n\tconst supabase = createServiceSupabaseClient();\n\n\t// Get current month's usage\n\tconst currentMonth = new Date().toISOString().slice(0, 7);\n\n\tconst { data: usageData, error: usageError } = await supabase\n\t\t.from(\"api_usage_realtime\")\n\t\t.select(\"*\")\n\t\t.eq(\"month\", currentMonth);\n\n\tif (usageError) {\n\t\tconsole.error(\"Error fetching usage:\", usageError);\n\t\treturn null;\n\t}\n\n\t// Build summary from config + usage data\n\tconst services = Object.entries(API_SERVICES).map(([serviceId, config]) => {\n\t\tconst usage = usageData?.find((u) => u.service_id === serviceId);\n\t\tconst usageCount = usage?.usage_count || 0;\n\t\tconst costCents = usage?.cost_cents || 0;\n\t\tconst freeTierRemaining = usage?.free_tier_remaining;\n\t\tconst freeTierPct = config.free_tier\n\t\t\t? calculateFreeTierPercentage(usageCount, config.free_tier)\n\t\t\t: 0;\n\n\t\treturn {\n\t\t\tservice_id: serviceId,\n\t\t\tdisplay_name: config.display_name,\n\t\t\tcategory: config.category,\n\t\t\tusage_count: usageCount,\n\t\t\tcost_cents: costCents,\n\t\t\tfree_tier_remaining: freeTierRemaining,\n\t\t\tfree_tier_percentage: freeTierPct,\n\t\t\talert_level: getAlertLevel(freeTierPct),\n\t\t\tlast_synced: usage?.last_synced || null,\n\t\t};\n\t});\n\n\tconst totalCostCents = services.reduce((sum, s) => sum + s.cost_cents, 0);\n\tconst servicesAtRisk = services.filter(\n\t\t(s) => s.alert_level === \"warning\" || s.alert_level === \"critical\",\n\t).length;\n\n\treturn {\n\t\tservices,\n\t\ttotal_cost_cents: totalCostCents,\n\t\tservices_at_risk: servicesAtRisk,\n\t};\n}\n\n/**\n * Get services approaching their free tier limits\n */\nexport async function getServicesApproachingLimits(): Promise<\n\tArray<{\n\t\tservice_id: string;\n\t\tdisplay_name: string;\n\t\tusage_count: number;\n\t\tfree_tier_limit: number;\n\t\tpercentage_used: number;\n\t\talert_level: string;\n\t}>\n> {\n\tconst summary = await getUsageSummary();\n\tif (!summary) return [];\n\n\treturn summary.services\n\t\t.filter((s) => s.alert_level === \"warning\" || s.alert_level === \"critical\")\n\t\t.map((s) => {\n\t\t\tconst config = API_SERVICES[s.service_id];\n\t\t\treturn {\n\t\t\t\tservice_id: s.service_id,\n\t\t\t\tdisplay_name: s.display_name,\n\t\t\t\tusage_count: s.usage_count,\n\t\t\t\tfree_tier_limit: config?.free_tier?.monthly_limit || 0,\n\t\t\t\tpercentage_used: s.free_tier_percentage,\n\t\t\t\talert_level: s.alert_level,\n\t\t\t};\n\t\t})\n\t\t.sort((a, b) => b.percentage_used - a.percentage_used);\n}\n\n/**\n * Track internal API usage (for APIs without external tracking)\n */\nexport async function trackInternalUsage(\n\tserviceId: string,\n\tincrementBy: number = 1,\n\tcostCents: number = 0,\n): Promise<void> {\n\tconst supabase = createServiceSupabaseClient();\n\tconst currentMonth = new Date().toISOString().slice(0, 7);\n\n\t// Upsert usage record\n\tconst { data: existing } = await supabase\n\t\t.from(\"api_usage_realtime\")\n\t\t.select(\"usage_count, cost_cents\")\n\t\t.eq(\"service_id\", serviceId)\n\t\t.eq(\"month\", currentMonth)\n\t\t.single();\n\n\tconst newUsageCount = (existing?.usage_count || 0) + incrementBy;\n\tconst newCostCents = (existing?.cost_cents || 0) + costCents;\n\n\tconst service = API_SERVICES[serviceId];\n\tconst freeTierRemaining = service?.free_tier\n\t\t? Math.max(0, service.free_tier.monthly_limit - newUsageCount)\n\t\t: null;\n\n\tawait supabase.from(\"api_usage_realtime\").upsert(\n\t\t{\n\t\t\tservice_id: serviceId,\n\t\t\tmonth: currentMonth,\n\t\t\tusage_count: newUsageCount,\n\t\t\tcost_cents: newCostCents,\n\t\t\tfree_tier_remaining: freeTierRemaining,\n\t\t\tlast_synced: new Date().toISOString(),\n\t\t},\n\t\t{\n\t\t\tonConflict: \"service_id,month\",\n\t\t},\n\t);\n}\n","/**\n * Stripe Billing & Usage Client\n *\n * Fetches transaction data and calculates processing fees from Stripe\n * Docs: https://stripe.com/docs/api\n *\n * Stripe fees are percentage-based:\n * - 2.9% + $0.30 per successful card charge (US)\n * - 0.5% additional for international cards\n * - 1% additional for currency conversion\n */\n\nexport interface StripeUsage {\n\ttotal_transactions: number;\n\ttotal_volume_cents: number;\n\ttotal_fees_cents: number;\n\tsuccessful_charges: number;\n\tfailed_charges: number;\n\trefunds_count: number;\n\trefunds_amount_cents: number;\n\tdisputes_count: number;\n}\n\nexport interface StripeMonthlyStats {\n\tgross_volume_cents: number;\n\tnet_volume_cents: number;\n\tfees_cents: number;\n\trefunds_cents: number;\n\ttransaction_count: number;\n\taverage_transaction_cents: number;\n}\n\ninterface StripeBalanceTransaction {\n\tid: string;\n\tamount: number;\n\tfee: number;\n\tnet: number;\n\ttype: string;\n\tcreated: number;\n\tstatus: string;\n}\n\ninterface StripeListResponse<T> {\n\tobject: \"list\";\n\tdata: T[];\n\thas_more: boolean;\n\turl: string;\n}\n\n/**\n * Stripe Billing Client\n * Requires STRIPE_SECRET_KEY environment variable\n */\nexport class StripeBillingClient {\n\tprivate baseUrl = \"https://api.stripe.com/v1\";\n\tprivate secretKey: string;\n\n\tconstructor() {\n\t\tconst secretKey = process.env.STRIPE_SECRET_KEY;\n\n\t\tif (!secretKey) {\n\t\t\tconsole.warn(\n\t\t\t\t\"STRIPE_SECRET_KEY not set - Stripe billing tracking disabled\",\n\t\t\t);\n\t\t}\n\n\t\tthis.secretKey = secretKey || \"\";\n\t}\n\n\tprivate async fetch<T>(\n\t\tendpoint: string,\n\t\tparams?: Record<string, string>,\n\t): Promise<T | null> {\n\t\tif (!this.secretKey) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst url = new URL(`${this.baseUrl}${endpoint}`);\n\t\tif (params) {\n\t\t\tObject.entries(params).forEach(([key, value]) => {\n\t\t\t\turl.searchParams.append(key, value);\n\t\t\t});\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await fetch(url.toString(), {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${this.secretKey}`,\n\t\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded\",\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t`Stripe API error: ${response.status} ${response.statusText}`,\n\t\t\t\t);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn (await response.json()) as T;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Stripe API fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get the current month's date range as Unix timestamps\n\t */\n\tprivate getCurrentMonthRange(): {\n\t\tstartTimestamp: number;\n\t\tendTimestamp: number;\n\t} {\n\t\tconst now = new Date();\n\t\tconst startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n\t\tconst endOfMonth = new Date(\n\t\t\tnow.getFullYear(),\n\t\t\tnow.getMonth() + 1,\n\t\t\t0,\n\t\t\t23,\n\t\t\t59,\n\t\t\t59,\n\t\t);\n\n\t\treturn {\n\t\t\tstartTimestamp: Math.floor(startOfMonth.getTime() / 1000),\n\t\t\tendTimestamp: Math.floor(endOfMonth.getTime() / 1000),\n\t\t};\n\t}\n\n\t/**\n\t * Get balance transactions for the current month\n\t * This includes all fees, charges, refunds, etc.\n\t */\n\tasync getBalanceTransactions(\n\t\tlimit = 100,\n\t): Promise<StripeBalanceTransaction[] | null> {\n\t\tconst { startTimestamp, endTimestamp } = this.getCurrentMonthRange();\n\n\t\tconst response = await this.fetch<\n\t\t\tStripeListResponse<StripeBalanceTransaction>\n\t\t>(\"/balance_transactions\", {\n\t\t\tlimit: limit.toString(),\n\t\t\t\"created[gte]\": startTimestamp.toString(),\n\t\t\t\"created[lte]\": endTimestamp.toString(),\n\t\t});\n\n\t\treturn response?.data || null;\n\t}\n\n\t/**\n\t * Get monthly statistics including fees\n\t */\n\tasync getCurrentMonthStats(): Promise<StripeMonthlyStats | null> {\n\t\tconst transactions = await this.getBalanceTransactions(100);\n\n\t\tif (!transactions) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet grossVolume = 0;\n\t\tlet netVolume = 0;\n\t\tlet totalFees = 0;\n\t\tlet refundsAmount = 0;\n\t\tlet chargeCount = 0;\n\n\t\tfor (const txn of transactions) {\n\t\t\tswitch (txn.type) {\n\t\t\t\tcase \"charge\":\n\t\t\t\t\tgrossVolume += txn.amount;\n\t\t\t\t\tnetVolume += txn.net;\n\t\t\t\t\ttotalFees += txn.fee;\n\t\t\t\t\tchargeCount++;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"refund\":\n\t\t\t\t\trefundsAmount += Math.abs(txn.amount);\n\t\t\t\t\tnetVolume += txn.net; // Negative for refunds\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"payout\":\n\t\t\t\t\t// Don't count payouts in volume\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t// Other transaction types (adjustments, etc.)\n\t\t\t\t\tnetVolume += txn.net;\n\t\t\t\t\ttotalFees += txn.fee;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tgross_volume_cents: grossVolume,\n\t\t\tnet_volume_cents: netVolume,\n\t\t\tfees_cents: totalFees,\n\t\t\trefunds_cents: refundsAmount,\n\t\t\ttransaction_count: chargeCount,\n\t\t\taverage_transaction_cents:\n\t\t\t\tchargeCount > 0 ? Math.round(grossVolume / chargeCount) : 0,\n\t\t};\n\t}\n\n\t/**\n\t * Get detailed usage statistics\n\t */\n\tasync getUsage(): Promise<StripeUsage | null> {\n\t\tconst { startTimestamp, endTimestamp } = this.getCurrentMonthRange();\n\n\t\t// Fetch charges for the month\n\t\tconst chargesResponse = await this.fetch<\n\t\t\tStripeListResponse<{\n\t\t\t\tid: string;\n\t\t\t\tamount: number;\n\t\t\t\tstatus: string;\n\t\t\t\trefunded: boolean;\n\t\t\t\tamount_refunded: number;\n\t\t\t}>\n\t\t>(\"/charges\", {\n\t\t\tlimit: \"100\",\n\t\t\t\"created[gte]\": startTimestamp.toString(),\n\t\t\t\"created[lte]\": endTimestamp.toString(),\n\t\t});\n\n\t\t// Fetch disputes for the month\n\t\tconst disputesResponse = await this.fetch<\n\t\t\tStripeListResponse<{\n\t\t\t\tid: string;\n\t\t\t\tamount: number;\n\t\t\t\tstatus: string;\n\t\t\t}>\n\t\t>(\"/disputes\", {\n\t\t\tlimit: \"100\",\n\t\t\t\"created[gte]\": startTimestamp.toString(),\n\t\t\t\"created[lte]\": endTimestamp.toString(),\n\t\t});\n\n\t\tif (!chargesResponse?.data) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst charges = chargesResponse.data;\n\t\tconst disputes = disputesResponse?.data || [];\n\n\t\tlet totalVolume = 0;\n\t\tlet successfulCharges = 0;\n\t\tlet failedCharges = 0;\n\t\tlet refundsCount = 0;\n\t\tlet refundsAmount = 0;\n\n\t\tfor (const charge of charges) {\n\t\t\tif (charge.status === \"succeeded\") {\n\t\t\t\tsuccessfulCharges++;\n\t\t\t\ttotalVolume += charge.amount;\n\t\t\t} else if (charge.status === \"failed\") {\n\t\t\t\tfailedCharges++;\n\t\t\t}\n\n\t\t\tif (charge.refunded || charge.amount_refunded > 0) {\n\t\t\t\trefundsCount++;\n\t\t\t\trefundsAmount += charge.amount_refunded;\n\t\t\t}\n\t\t}\n\n\t\t// Calculate estimated fees (2.9% + $0.30 per transaction)\n\t\tconst estimatedFees = Math.round(\n\t\t\ttotalVolume * 0.029 + successfulCharges * 30,\n\t\t);\n\n\t\treturn {\n\t\t\ttotal_transactions: charges.length,\n\t\t\ttotal_volume_cents: totalVolume,\n\t\t\ttotal_fees_cents: estimatedFees,\n\t\t\tsuccessful_charges: successfulCharges,\n\t\t\tfailed_charges: failedCharges,\n\t\t\trefunds_count: refundsCount,\n\t\t\trefunds_amount_cents: refundsAmount,\n\t\t\tdisputes_count: disputes.length,\n\t\t};\n\t}\n\n\t/**\n\t * Get current Stripe balance\n\t */\n\tasync getBalance(): Promise<{\n\t\tavailable_cents: number;\n\t\tpending_cents: number;\n\t\tcurrency: string;\n\t} | null> {\n\t\tconst response = await this.fetch<{\n\t\t\tavailable: Array<{ amount: number; currency: string }>;\n\t\t\tpending: Array<{ amount: number; currency: string }>;\n\t\t}>(\"/balance\");\n\n\t\tif (!response) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Get USD balance (or first available currency)\n\t\tconst availableUsd =\n\t\t\tresponse.available.find((b) => b.currency === \"usd\") ||\n\t\t\tresponse.available[0];\n\t\tconst pendingUsd =\n\t\t\tresponse.pending.find((b) => b.currency === \"usd\") || response.pending[0];\n\n\t\treturn {\n\t\t\tavailable_cents: availableUsd?.amount || 0,\n\t\t\tpending_cents: pendingUsd?.amount || 0,\n\t\t\tcurrency: availableUsd?.currency || \"usd\",\n\t\t};\n\t}\n\n\t/**\n\t * Calculate Stripe fee for a given amount\n\t * Standard US pricing: 2.9% + $0.30\n\t */\n\tstatic calculateFee(\n\t\tamountCents: number,\n\t\toptions: {\n\t\t\tisInternational?: boolean;\n\t\t\thasCurrencyConversion?: boolean;\n\t\t} = {},\n\t): number {\n\t\tlet percentage = 0.029; // 2.9% base\n\n\t\tif (options.isInternational) {\n\t\t\tpercentage += 0.005; // +0.5% for international\n\t\t}\n\n\t\tif (options.hasCurrencyConversion) {\n\t\t\tpercentage += 0.01; // +1% for currency conversion\n\t\t}\n\n\t\tconst percentageFee = Math.round(amountCents * percentage);\n\t\tconst flatFee = 30; // $0.30\n\n\t\treturn percentageFee + flatFee;\n\t}\n\n\t/**\n\t * Calculate net amount after Stripe fees\n\t */\n\tstatic calculateNetAmount(\n\t\tamountCents: number,\n\t\toptions: {\n\t\t\tisInternational?: boolean;\n\t\t\thasCurrencyConversion?: boolean;\n\t\t} = {},\n\t): number {\n\t\tconst fee = StripeBillingClient.calculateFee(amountCents, options);\n\t\treturn amountCents - fee;\n\t}\n\n\t/**\n\t * Check if the Stripe API is healthy\n\t */\n\tasync checkHealth(): Promise<{\n\t\thealthy: boolean;\n\t\tresponseTimeMs: number;\n\t\terror?: string;\n\t}> {\n\t\tconst startTime = Date.now();\n\n\t\ttry {\n\t\t\tconst response = await fetch(`${this.baseUrl}/balance`, {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${this.secretKey}`,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst responseTimeMs = Date.now() - startTime;\n\n\t\t\tif (response.ok) {\n\t\t\t\treturn { healthy: true, responseTimeMs };\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\thealthy: false,\n\t\t\t\tresponseTimeMs,\n\t\t\t\terror: `HTTP ${response.status}: ${response.statusText}`,\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn {\n\t\t\t\thealthy: false,\n\t\t\t\tresponseTimeMs: Date.now() - startTime,\n\t\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\t};\n\t\t}\n\t}\n}\n\n// Export singleton instance\nexport const stripeBillingClient = new StripeBillingClient();\n","/**\n * Google Cloud Usage & Billing Client\n *\n * Fetches usage data from Google Cloud APIs\n * - Cloud Billing API for cost data\n * - Service Usage API for API call counts\n *\n * Docs:\n * - https://cloud.google.com/billing/docs/reference/rest\n * - https://cloud.google.com/service-usage/docs/reference/rest\n */\n\nexport interface GoogleCloudUsage {\n\tservice_name: string;\n\tdisplay_name: string;\n\tusage_amount: number;\n\tusage_unit: string;\n\tcost_usd: number;\n\tmonth: string;\n}\n\nexport interface GoogleAIUsage {\n\tgemini_requests: number;\n\tgemini_tokens_input: number;\n\tgemini_tokens_output: number;\n\tdocument_ai_pages: number;\n\tvision_requests: number;\n\tspeech_minutes: number;\n\ttranslation_characters: number;\n\ttotal_cost_cents: number;\n}\n\ninterface ServiceUsageResponse {\n\tservices: Array<{\n\t\tname: string;\n\t\tconfig: {\n\t\t\tname: string;\n\t\t\ttitle: string;\n\t\t};\n\t}>;\n}\n\ninterface BillingReportResponse {\n\trows?: Array<{\n\t\tservice: { id: string; description: string };\n\t\tsku: { id: string; description: string };\n\t\tusage: { amount: string; unit: string };\n\t\tcost: { amount: string; currency: string };\n\t}>;\n}\n\n/**\n * Google Cloud Client\n *\n * Required environment variables:\n * - GOOGLE_CLOUD_PROJECT_ID\n * - GOOGLE_CLOUD_BILLING_ACCOUNT_ID\n * - GOOGLE_CLOUD_API_KEY or GOOGLE_APPLICATION_CREDENTIALS\n */\nexport class GoogleCloudClient {\n\tprivate projectId: string;\n\tprivate billingAccountId: string;\n\tprivate accessToken: string;\n\n\tconstructor() {\n\t\tthis.projectId = process.env.GOOGLE_CLOUD_PROJECT_ID || \"\";\n\t\tthis.billingAccountId = process.env.GOOGLE_CLOUD_BILLING_ACCOUNT_ID || \"\";\n\t\tthis.accessToken = process.env.GOOGLE_CLOUD_ACCESS_TOKEN || \"\";\n\n\t\tif (!this.projectId) {\n\t\t\tconsole.warn(\n\t\t\t\t\"GOOGLE_CLOUD_PROJECT_ID not set - Google Cloud tracking disabled\",\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate async fetch<T>(url: string): Promise<T | null> {\n\t\tif (!this.accessToken) {\n\t\t\treturn null;\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await fetch(url, {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${this.accessToken}`,\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t`Google Cloud API error: ${response.status} ${response.statusText}`,\n\t\t\t\t);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn (await response.json()) as T;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Google Cloud API fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get enabled services for the project\n\t */\n\tasync getEnabledServices(): Promise<string[] | null> {\n\t\tconst response = await this.fetch<ServiceUsageResponse>(\n\t\t\t`https://serviceusage.googleapis.com/v1/projects/${this.projectId}/services?filter=state:ENABLED`,\n\t\t);\n\n\t\tif (!response?.services) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn response.services.map((s) => s.config.name);\n\t}\n\n\t/**\n\t * Get AI-specific usage from the current month\n\t * Note: This is a simplified implementation. In production, you'd use\n\t * the Cloud Billing Export to BigQuery for detailed usage data.\n\t */\n\tasync getAIUsage(): Promise<GoogleAIUsage | null> {\n\t\t// For accurate Google AI usage, you typically need to:\n\t\t// 1. Enable Cloud Billing export to BigQuery\n\t\t// 2. Query the billing export table\n\n\t\t// As a fallback, we can estimate from the billing API\n\t\t// but it doesn't provide granular token/request counts\n\n\t\t// Return structure for manual tracking until BigQuery export is set up\n\t\treturn {\n\t\t\tgemini_requests: 0,\n\t\t\tgemini_tokens_input: 0,\n\t\t\tgemini_tokens_output: 0,\n\t\t\tdocument_ai_pages: 0,\n\t\t\tvision_requests: 0,\n\t\t\tspeech_minutes: 0,\n\t\t\ttranslation_characters: 0,\n\t\t\ttotal_cost_cents: 0,\n\t\t};\n\t}\n\n\t/**\n\t * Get current month billing summary\n\t * Requires Cloud Billing API access\n\t */\n\tasync getCurrentMonthBilling(): Promise<GoogleCloudUsage[] | null> {\n\t\tif (!this.billingAccountId) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Note: The Cloud Billing API requires special permissions\n\t\t// For most use cases, you'd query BigQuery export instead\n\t\tconst now = new Date();\n\t\tconst startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n\n\t\t// This is a simplified example - actual implementation would use\n\t\t// the Cloud Billing Budget API or BigQuery export\n\t\tconst budgetsUrl = `https://cloudbilling.googleapis.com/v1/billingAccounts/${this.billingAccountId}/budgets`;\n\n\t\tconst response = await this.fetch<{\n\t\t\tbudgets?: Array<{\n\t\t\t\tamount: { specifiedAmount: { currencyCode: string; units: string } };\n\t\t\t\tcurrentSpend?: { currencyCode: string; units: string };\n\t\t\t}>;\n\t\t}>(budgetsUrl);\n\n\t\tif (!response?.budgets) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Transform budget data to usage format\n\t\treturn response.budgets.map((budget) => ({\n\t\t\tservice_name: \"all_services\",\n\t\t\tdisplay_name: \"All Google Cloud Services\",\n\t\t\tusage_amount: 1,\n\t\t\tusage_unit: \"budget\",\n\t\t\tcost_usd: parseFloat(budget.currentSpend?.units || \"0\"),\n\t\t\tmonth: startOfMonth.toISOString().slice(0, 7),\n\t\t}));\n\t}\n\n\t/**\n\t * Get Maps Platform usage\n\t * Uses the Cloud Billing API to fetch Maps-specific costs\n\t */\n\tasync getMapsUsage(): Promise<{\n\t\tgeocoding_requests: number;\n\t\tplaces_requests: number;\n\t\tdirections_requests: number;\n\t\tstatic_maps_requests: number;\n\t\ttotal_cost_cents: number;\n\t} | null> {\n\t\t// Maps usage is typically tracked via:\n\t\t// 1. Cloud Console usage reports\n\t\t// 2. BigQuery billing export\n\n\t\t// For now, return structure for manual tracking\n\t\treturn {\n\t\t\tgeocoding_requests: 0,\n\t\t\tplaces_requests: 0,\n\t\t\tdirections_requests: 0,\n\t\t\tstatic_maps_requests: 0,\n\t\t\ttotal_cost_cents: 0,\n\t\t};\n\t}\n\n\t/**\n\t * Check if Google Cloud APIs are healthy\n\t */\n\tasync checkHealth(): Promise<{\n\t\thealthy: boolean;\n\t\tresponseTimeMs: number;\n\t\terror?: string;\n\t}> {\n\t\tconst startTime = Date.now();\n\n\t\ttry {\n\t\t\t// Check Service Usage API availability\n\t\t\tconst response = await fetch(\n\t\t\t\t`https://serviceusage.googleapis.com/v1/projects/${this.projectId}/services?pageSize=1`,\n\t\t\t\t{\n\t\t\t\t\theaders: {\n\t\t\t\t\t\tAuthorization: `Bearer ${this.accessToken}`,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tconst responseTimeMs = Date.now() - startTime;\n\n\t\t\tif (response.ok) {\n\t\t\t\treturn { healthy: true, responseTimeMs };\n\t\t\t}\n\n\t\t\t// Special case: 401/403 means API is up but we need auth\n\t\t\tif (response.status === 401 || response.status === 403) {\n\t\t\t\treturn {\n\t\t\t\t\thealthy: true, // API is responding\n\t\t\t\t\tresponseTimeMs,\n\t\t\t\t\terror: \"Authentication required - API is available\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\thealthy: false,\n\t\t\t\tresponseTimeMs,\n\t\t\t\terror: `HTTP ${response.status}: ${response.statusText}`,\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn {\n\t\t\t\thealthy: false,\n\t\t\t\tresponseTimeMs: Date.now() - startTime,\n\t\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\t};\n\t\t}\n\t}\n}\n\n// Export singleton instance\nexport const googleCloudClient = new GoogleCloudClient();\n\n/**\n * Google AI Internal Tracker\n *\n * Since Google Cloud doesn't provide real-time token/request counts via API,\n * we need to track these internally in our application.\n *\n * This class provides utilities for internal tracking that syncs with our database.\n */\nexport class GoogleAITracker {\n\t/**\n\t * Calculate cost for Gemini API usage\n\t * Based on: https://ai.google.dev/pricing\n\t */\n\tstatic calculateGeminiCost(\n\t\tinputTokens: number,\n\t\toutputTokens: number,\n\t\tmodel: \"gemini-1.5-flash\" | \"gemini-1.5-pro\" = \"gemini-1.5-flash\",\n\t): number {\n\t\t// Pricing as of 2024 (per million tokens)\n\t\tconst pricing = {\n\t\t\t\"gemini-1.5-flash\": {\n\t\t\t\tinput: 0.075, // $0.075 per 1M tokens\n\t\t\t\toutput: 0.3, // $0.30 per 1M tokens\n\t\t\t},\n\t\t\t\"gemini-1.5-pro\": {\n\t\t\t\tinput: 1.25, // $1.25 per 1M tokens\n\t\t\t\toutput: 5.0, // $5.00 per 1M tokens\n\t\t\t},\n\t\t};\n\n\t\tconst modelPricing = pricing[model];\n\t\tconst inputCost = (inputTokens / 1_000_000) * modelPricing.input;\n\t\tconst outputCost = (outputTokens / 1_000_000) * modelPricing.output;\n\n\t\treturn Math.round((inputCost + outputCost) * 100); // Return cents\n\t}\n\n\t/**\n\t * Calculate cost for Document AI\n\t * First 1,000 pages/month are free\n\t */\n\tstatic calculateDocumentAICost(pages: number): number {\n\t\tconst FREE_TIER = 1000;\n\t\tconst PRICE_PER_1000 = 1.5; // $1.50 per 1000 pages\n\n\t\tif (pages <= FREE_TIER) return 0;\n\n\t\tconst billablePages = pages - FREE_TIER;\n\t\treturn Math.round((billablePages / 1000) * PRICE_PER_1000 * 100);\n\t}\n\n\t/**\n\t * Calculate cost for Vision AI\n\t * First 1,000 units/month are free\n\t */\n\tstatic calculateVisionCost(requests: number): number {\n\t\tconst FREE_TIER = 1000;\n\t\tconst PRICE_PER_1000 = 1.5; // $1.50 per 1000 requests\n\n\t\tif (requests <= FREE_TIER) return 0;\n\n\t\tconst billableRequests = requests - FREE_TIER;\n\t\treturn Math.round((billableRequests / 1000) * PRICE_PER_1000 * 100);\n\t}\n\n\t/**\n\t * Calculate cost for Speech-to-Text\n\t * First 60 minutes/month are free\n\t */\n\tstatic calculateSpeechCost(minutes: number): number {\n\t\tconst FREE_TIER = 60;\n\t\tconst PRICE_PER_MINUTE = 0.024; // $0.024 per minute\n\n\t\tif (minutes <= FREE_TIER) return 0;\n\n\t\tconst billableMinutes = minutes - FREE_TIER;\n\t\treturn Math.round(billableMinutes * PRICE_PER_MINUTE * 100);\n\t}\n\n\t/**\n\t * Calculate cost for Translation API\n\t * First 500,000 characters/month are free\n\t */\n\tstatic calculateTranslationCost(characters: number): number {\n\t\tconst FREE_TIER = 500_000;\n\t\tconst PRICE_PER_MILLION = 20; // $20 per million characters\n\n\t\tif (characters <= FREE_TIER) return 0;\n\n\t\tconst billableChars = characters - FREE_TIER;\n\t\treturn Math.round((billableChars / 1_000_000) * PRICE_PER_MILLION * 100);\n\t}\n\n\t/**\n\t * Calculate total Google AI costs\n\t */\n\tstatic calculateTotalCost(usage: {\n\t\tgemini_input_tokens?: number;\n\t\tgemini_output_tokens?: number;\n\t\tgemini_model?: \"gemini-1.5-flash\" | \"gemini-1.5-pro\";\n\t\tdocument_ai_pages?: number;\n\t\tvision_requests?: number;\n\t\tspeech_minutes?: number;\n\t\ttranslation_characters?: number;\n\t}): number {\n\t\tlet total = 0;\n\n\t\tif (usage.gemini_input_tokens || usage.gemini_output_tokens) {\n\t\t\ttotal += GoogleAITracker.calculateGeminiCost(\n\t\t\t\tusage.gemini_input_tokens || 0,\n\t\t\t\tusage.gemini_output_tokens || 0,\n\t\t\t\tusage.gemini_model || \"gemini-1.5-flash\",\n\t\t\t);\n\t\t}\n\n\t\tif (usage.document_ai_pages) {\n\t\t\ttotal += GoogleAITracker.calculateDocumentAICost(usage.document_ai_pages);\n\t\t}\n\n\t\tif (usage.vision_requests) {\n\t\t\ttotal += GoogleAITracker.calculateVisionCost(usage.vision_requests);\n\t\t}\n\n\t\tif (usage.speech_minutes) {\n\t\t\ttotal += GoogleAITracker.calculateSpeechCost(usage.speech_minutes);\n\t\t}\n\n\t\tif (usage.translation_characters) {\n\t\t\ttotal += GoogleAITracker.calculateTranslationCost(\n\t\t\t\tusage.translation_characters,\n\t\t\t);\n\t\t}\n\n\t\treturn total;\n\t}\n}\n","/**\n * API Service Configuration\n *\n * Comprehensive configuration for all external API services including:\n * - Free tier limits and thresholds\n * - Pricing after free tier\n * - Health check endpoints\n * - Provider API availability\n */\n\nexport type ServiceCategory =\n\t| \"ai\"\n\t| \"google_maps\"\n\t| \"infrastructure\"\n\t| \"communication\"\n\t| \"data\"\n\t| \"payments\";\nexport type FreeTierPeriod = \"daily\" | \"monthly\" | \"yearly\";\nexport type SyncSource =\n\t| \"provider_api\"\n\t| \"internal_tracking\"\n\t| \"manual\"\n\t| \"estimated\";\n\nexport interface FreeTierConfig {\n\tlimit: number;\n\tperiod: FreeTierPeriod;\n\tunit: string;\n}\n\nexport interface CostConfig {\n\t/** Cost in cents */\n\tcents?: number;\n\t/** Cost applies per this many units */\n\tperUnits?: number;\n\t/** Unit type (request, page, minute, etc) */\n\tunit?: string;\n\t/** For percentage-based pricing (e.g., Stripe) */\n\tpercentage?: number;\n\t/** Fixed fee in cents per transaction */\n\tfixedCents?: number;\n}\n\nexport interface ApiServiceConfig {\n\tserviceName: string;\n\tdisplayName: string;\n\tcategory: ServiceCategory;\n\tprovider: string;\n\t/** Free tier configuration, null if no free tier */\n\tfreeTier: FreeTierConfig | null;\n\t/** Cost after free tier is exhausted */\n\tcostAfterFree: CostConfig | null;\n\t/** Base monthly cost in cents (for subscription services) */\n\tbaseCostCents: number;\n\t/** Whether this service has an external API for fetching usage */\n\thasExternalApi: boolean;\n\t/** Endpoint to check for health status */\n\thealthCheckEndpoint?: string;\n\t/** Alert thresholds */\n\twarningThresholdPct: number;\n\tcriticalThresholdPct: number;\n\t/** Description of what this service is used for */\n\tdescription?: string;\n}\n\n/**\n * All API service configurations\n * Organized by category for easy access\n */\nexport const API_SERVICES: Record<string, ApiServiceConfig> = {\n\t// ==========================================\n\t// Google AI Services\n\t// ==========================================\n\tgoogle_gemini: {\n\t\tserviceName: \"google_gemini\",\n\t\tdisplayName: \"Google Gemini AI\",\n\t\tcategory: \"ai\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 1500, period: \"daily\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 7.5, perUnits: 1000000, unit: \"tokens\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\thealthCheckEndpoint: \"https://generativelanguage.googleapis.com/v1/models\",\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Gemini AI for text generation, chat, and multimodal tasks\",\n\t},\n\tgoogle_document_ai: {\n\t\tserviceName: \"google_document_ai\",\n\t\tdisplayName: \"Document AI\",\n\t\tcategory: \"ai\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 1000, period: \"monthly\", unit: \"pages\" },\n\t\tcostAfterFree: { cents: 1, perUnits: 1, unit: \"page\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Document parsing, OCR, and form extraction\",\n\t},\n\tgoogle_vision: {\n\t\tserviceName: \"google_vision\",\n\t\tdisplayName: \"Vision AI\",\n\t\tcategory: \"ai\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 1000, period: \"monthly\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 150, perUnits: 1000, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Image analysis, OCR, and object detection\",\n\t},\n\tgoogle_speech_to_text: {\n\t\tserviceName: \"google_speech_to_text\",\n\t\tdisplayName: \"Speech-to-Text\",\n\t\tcategory: \"ai\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 60, period: \"monthly\", unit: \"minutes\" },\n\t\tcostAfterFree: { cents: 60, perUnits: 1, unit: \"minute\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Audio transcription and speech recognition\",\n\t},\n\tgoogle_text_to_speech: {\n\t\tserviceName: \"google_text_to_speech\",\n\t\tdisplayName: \"Text-to-Speech\",\n\t\tcategory: \"ai\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 4000000, period: \"monthly\", unit: \"characters\" },\n\t\tcostAfterFree: { cents: 400, perUnits: 1000000, unit: \"characters\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Text to natural speech synthesis\",\n\t},\n\tgoogle_translation: {\n\t\tserviceName: \"google_translation\",\n\t\tdisplayName: \"Translation\",\n\t\tcategory: \"ai\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 500000, period: \"monthly\", unit: \"characters\" },\n\t\tcostAfterFree: { cents: 2000, perUnits: 1000000, unit: \"characters\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Language translation services\",\n\t},\n\n\t// ==========================================\n\t// Google Maps Services\n\t// ==========================================\n\tgoogle_geocoding: {\n\t\tserviceName: \"google_geocoding\",\n\t\tdisplayName: \"Geocoding\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 10000, period: \"monthly\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 50, perUnits: 100, unit: \"request\" }, // $5/1000 = $0.50/100\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Address to coordinates conversion\",\n\t},\n\tgoogle_directions: {\n\t\tserviceName: \"google_directions\",\n\t\tdisplayName: \"Directions\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 10000, period: \"monthly\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 50, perUnits: 100, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Route planning and navigation\",\n\t},\n\tgoogle_places: {\n\t\tserviceName: \"google_places\",\n\t\tdisplayName: \"Places\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 10000, period: \"monthly\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 170, perUnits: 100, unit: \"request\" }, // $17/1000\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Place search, details, and autocomplete\",\n\t},\n\tgoogle_distance_matrix: {\n\t\tserviceName: \"google_distance_matrix\",\n\t\tdisplayName: \"Distance Matrix\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 10000, period: \"monthly\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 50, perUnits: 100, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Travel distance and time calculations\",\n\t},\n\tgoogle_maps_static: {\n\t\tserviceName: \"google_maps_static\",\n\t\tdisplayName: \"Maps Static\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 25000, period: \"monthly\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 20, perUnits: 100, unit: \"request\" }, // $2/1000\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Static map image generation\",\n\t},\n\tgoogle_street_view: {\n\t\tserviceName: \"google_street_view\",\n\t\tdisplayName: \"Street View\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 25000, period: \"monthly\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 70, perUnits: 100, unit: \"request\" }, // $7/1000\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Street-level imagery\",\n\t},\n\tgoogle_routes: {\n\t\tserviceName: \"google_routes\",\n\t\tdisplayName: \"Routes API\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: { limit: 10000, period: \"monthly\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 50, perUnits: 100, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Advanced routing with traffic awareness\",\n\t},\n\tgoogle_elevation: {\n\t\tserviceName: \"google_elevation\",\n\t\tdisplayName: \"Elevation\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: null,\n\t\tcostAfterFree: { cents: 50, perUnits: 100, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Terrain elevation data\",\n\t},\n\tgoogle_timezone: {\n\t\tserviceName: \"google_timezone\",\n\t\tdisplayName: \"Time Zone\",\n\t\tcategory: \"google_maps\",\n\t\tprovider: \"google\",\n\t\tfreeTier: null,\n\t\tcostAfterFree: { cents: 50, perUnits: 100, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Time zone lookups by location\",\n\t},\n\n\t// ==========================================\n\t// Infrastructure Services\n\t// ==========================================\n\tsupabase: {\n\t\tserviceName: \"supabase\",\n\t\tdisplayName: \"Supabase\",\n\t\tcategory: \"infrastructure\",\n\t\tprovider: \"supabase\",\n\t\tfreeTier: null, // Pro plan, usage-based after base\n\t\tcostAfterFree: null,\n\t\tbaseCostCents: 2500, // $25/month\n\t\thasExternalApi: true,\n\t\thealthCheckEndpoint: \"https://api.supabase.com/v1/projects\",\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Database, Auth, Storage, Edge Functions\",\n\t},\n\tvercel: {\n\t\tserviceName: \"vercel\",\n\t\tdisplayName: \"Vercel\",\n\t\tcategory: \"infrastructure\",\n\t\tprovider: \"vercel\",\n\t\tfreeTier: { limit: 1000, period: \"monthly\", unit: \"GB\" }, // 1TB bandwidth included\n\t\tcostAfterFree: { cents: 15, perUnits: 1, unit: \"GB\" }, // $0.15/GB\n\t\tbaseCostCents: 2000, // $20/month Pro plan\n\t\thasExternalApi: false, // Limited API, track internally\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Hosting, Edge Functions, Analytics\",\n\t},\n\n\t// ==========================================\n\t// Communication Services\n\t// ==========================================\n\ttwilio_voice: {\n\t\tserviceName: \"twilio_voice\",\n\t\tdisplayName: \"Twilio Voice\",\n\t\tcategory: \"communication\",\n\t\tprovider: \"twilio\",\n\t\tfreeTier: null, // No free tier\n\t\tcostAfterFree: { cents: 130, perUnits: 100, unit: \"minute\" }, // $0.013/min\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\thealthCheckEndpoint: \"https://api.twilio.com/2010-04-01\",\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"VoIP calls and call control\",\n\t},\n\ttwilio_sms: {\n\t\tserviceName: \"twilio_sms\",\n\t\tdisplayName: \"Twilio SMS\",\n\t\tcategory: \"communication\",\n\t\tprovider: \"twilio\",\n\t\tfreeTier: null, // No free tier\n\t\tcostAfterFree: { cents: 79, perUnits: 100, unit: \"message\" }, // $0.0079/msg\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"SMS and MMS messaging\",\n\t},\n\tsendgrid: {\n\t\tserviceName: \"sendgrid\",\n\t\tdisplayName: \"SendGrid Email\",\n\t\tcategory: \"communication\",\n\t\tprovider: \"sendgrid\",\n\t\tfreeTier: { limit: 100, period: \"daily\", unit: \"emails\" },\n\t\tcostAfterFree: { cents: 8, perUnits: 100, unit: \"email\" }, // ~$0.0008/email\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: false, // Track internally\n\t\thealthCheckEndpoint: \"https://api.sendgrid.com/v3/mail/send\",\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Transactional email delivery\",\n\t},\n\tassemblyai: {\n\t\tserviceName: \"assemblyai\",\n\t\tdisplayName: \"AssemblyAI\",\n\t\tcategory: \"communication\",\n\t\tprovider: \"assemblyai\",\n\t\tfreeTier: { limit: 500, period: \"monthly\", unit: \"credits\" }, // $50 in credits\n\t\tcostAfterFree: { cents: 15, perUnits: 1, unit: \"hour\" }, // $0.15/hour\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Call transcription and audio intelligence\",\n\t},\n\n\t// ==========================================\n\t// Data APIs\n\t// ==========================================\n\tattom: {\n\t\tserviceName: \"attom\",\n\t\tdisplayName: \"ATTOM Property\",\n\t\tcategory: \"data\",\n\t\tprovider: \"attom\",\n\t\tfreeTier: null, // No free tier\n\t\tcostAfterFree: { cents: 500, perUnits: 100, unit: \"request\" }, // ~$0.05/request\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: false,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Property data, valuations, sales history\",\n\t},\n\tshovels: {\n\t\tserviceName: \"shovels\",\n\t\tdisplayName: \"Shovels Permits\",\n\t\tcategory: \"data\",\n\t\tprovider: \"shovels\",\n\t\tfreeTier: null,\n\t\tcostAfterFree: { cents: 300, perUnits: 100, unit: \"request\" }, // ~$0.03/request\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: false,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Building permits and contractor data\",\n\t},\n\twalk_score: {\n\t\tserviceName: \"walk_score\",\n\t\tdisplayName: \"Walk Score\",\n\t\tcategory: \"data\",\n\t\tprovider: \"walkscore\",\n\t\tfreeTier: { limit: 5000, period: \"daily\", unit: \"requests\" },\n\t\tcostAfterFree: { cents: 10, perUnits: 100, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: false,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Walkability, transit, and bike scores\",\n\t},\n\tcrimeometer: {\n\t\tserviceName: \"crimeometer\",\n\t\tdisplayName: \"CrimeoMeter\",\n\t\tcategory: \"data\",\n\t\tprovider: \"crimeometer\",\n\t\tfreeTier: null,\n\t\tcostAfterFree: { cents: 500, perUnits: 100, unit: \"request\" }, // ~$0.05/request\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: false,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Real-time crime data and safety scores\",\n\t},\n\tfema_flood: {\n\t\tserviceName: \"fema_flood\",\n\t\tdisplayName: \"FEMA Flood\",\n\t\tcategory: \"data\",\n\t\tprovider: \"fema\",\n\t\tfreeTier: null, // Free government API\n\t\tcostAfterFree: { cents: 0, perUnits: 1, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: false,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Flood zone and risk data (free)\",\n\t},\n\tcensus_bureau: {\n\t\tserviceName: \"census_bureau\",\n\t\tdisplayName: \"Census Bureau\",\n\t\tcategory: \"data\",\n\t\tprovider: \"census\",\n\t\tfreeTier: null, // Free government API\n\t\tcostAfterFree: { cents: 0, perUnits: 1, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: false,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Demographics and housing data (free)\",\n\t},\n\tfbi_crime: {\n\t\tserviceName: \"fbi_crime\",\n\t\tdisplayName: \"FBI Crime Data\",\n\t\tcategory: \"data\",\n\t\tprovider: \"fbi\",\n\t\tfreeTier: null, // Free government API\n\t\tcostAfterFree: { cents: 0, perUnits: 1, unit: \"request\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: false,\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Crime statistics by state (free)\",\n\t},\n\n\t// ==========================================\n\t// Payment Services\n\t// ==========================================\n\tstripe: {\n\t\tserviceName: \"stripe\",\n\t\tdisplayName: \"Stripe\",\n\t\tcategory: \"payments\",\n\t\tprovider: \"stripe\",\n\t\tfreeTier: null,\n\t\tcostAfterFree: { percentage: 2.9, fixedCents: 30, unit: \"transaction\" },\n\t\tbaseCostCents: 0,\n\t\thasExternalApi: true,\n\t\thealthCheckEndpoint: \"https://api.stripe.com/v1/balance\",\n\t\twarningThresholdPct: 80,\n\t\tcriticalThresholdPct: 95,\n\t\tdescription: \"Payment processing (2.9% + $0.30)\",\n\t},\n};\n\n/**\n * Get services by category\n */\nexport function getServicesByCategory(\n\tcategory: ServiceCategory,\n): ApiServiceConfig[] {\n\treturn Object.values(API_SERVICES).filter((s) => s.category === category);\n}\n\n/**\n * Get services by provider\n */\nexport function getServicesByProvider(provider: string): ApiServiceConfig[] {\n\treturn Object.values(API_SERVICES).filter((s) => s.provider === provider);\n}\n\n/**\n * Get all services with free tiers\n */\nexport function getServicesWithFreeTier(): ApiServiceConfig[] {\n\treturn Object.values(API_SERVICES).filter((s) => s.freeTier !== null);\n}\n\n/**\n * Get all services that have external APIs for usage data\n */\nexport function getServicesWithExternalApi(): ApiServiceConfig[] {\n\treturn Object.values(API_SERVICES).filter((s) => s.hasExternalApi);\n}\n\n/**\n * Calculate cost for usage\n */\nexport function calculateCost(\n\tserviceName: string,\n\tusage: number,\n\ttransactionAmount?: number,\n): number {\n\tconst service = API_SERVICES[serviceName];\n\tif (!service || !service.costAfterFree) return 0;\n\n\tconst { cents, perUnits, percentage, fixedCents } = service.costAfterFree;\n\n\t// For percentage-based pricing (Stripe)\n\tif (percentage !== undefined && transactionAmount !== undefined) {\n\t\tconst percentageCost = (transactionAmount * percentage) / 100;\n\t\tconst fixedCost = (fixedCents || 0) / 100;\n\t\treturn percentageCost + fixedCost;\n\t}\n\n\t// For unit-based pricing\n\tif (cents !== undefined && perUnits !== undefined) {\n\t\treturn (usage / perUnits) * cents;\n\t}\n\n\treturn 0;\n}\n\n/**\n * Calculate free tier percentage used\n */\nexport function calculateFreeTierPercentage(\n\tserviceName: string,\n\tused: number,\n): number | null {\n\tconst service = API_SERVICES[serviceName];\n\tif (!service || !service.freeTier) return null;\n\n\treturn Math.min(100, (used / service.freeTier.limit) * 100);\n}\n\n/**\n * Get alert level based on usage\n */\nexport function getAlertLevel(\n\tserviceName: string,\n\tpercentUsed: number,\n): \"ok\" | \"warning\" | \"critical\" {\n\tconst service = API_SERVICES[serviceName];\n\tif (!service) return \"ok\";\n\n\tif (percentUsed >= service.criticalThresholdPct) return \"critical\";\n\tif (percentUsed >= service.warningThresholdPct) return \"warning\";\n\treturn \"ok\";\n}\n\n/**\n * Service categories with display names\n */\nexport const SERVICE_CATEGORIES: Record<\n\tServiceCategory,\n\t{ displayName: string; icon: string }\n> = {\n\tai: { displayName: \"AI Services\", icon: \"brain\" },\n\tgoogle_maps: { displayName: \"Google Maps\", icon: \"map\" },\n\tinfrastructure: { displayName: \"Infrastructure\", icon: \"server\" },\n\tcommunication: { displayName: \"Communication\", icon: \"message-square\" },\n\tdata: { displayName: \"Data APIs\", icon: \"database\" },\n\tpayments: { displayName: \"Payments\", icon: \"credit-card\" },\n};\n"],"names":[],"mappings":"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","ignoreList":[5]}