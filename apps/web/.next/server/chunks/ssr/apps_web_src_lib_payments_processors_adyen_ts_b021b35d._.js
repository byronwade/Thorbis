module.exports=[189239,a=>{"use strict";var b=a.i(254799);class c{config;apiUrl;constructor(a){this.config=a,this.apiUrl=a.liveMode?"https://api.adyen.com":"https://api-adyen-test.adyen.com"}getSupportedChannels(){return["online","card_present","tap_to_pay","ach"]}async processPayment(a){try{let b={amount:{value:a.amount,currency:a.currency||"USD"},merchantAccount:this.config.merchantAccount,reference:a.invoiceId||`invoice-${Date.now()}`,paymentMethod:a.paymentMethodId?{type:"scheme",storedPaymentMethodId:a.paymentMethodId}:void 0,returnUrl:`http://localhost:3000/dashboard/work/invoices/${a.invoiceId}`,metadata:{company_id:this.config.companyId,customer_id:a.customerId,invoice_id:a.invoiceId,channel:a.channel,...a.metadata}},c=await fetch(`${this.apiUrl}/v68/payments`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.config.apiKey},body:JSON.stringify(b)}),d=await c.json();if(!c.ok)return{success:!1,status:"failed",error:d.message||"Payment processing failed",failureCode:d.errorCode,failureMessage:d.message};if("Authorised"===d.resultCode||"Received"===d.resultCode)return{success:!0,transactionId:d.pspReference,processorTransactionId:d.pspReference,status:"succeeded",processorMetadata:d};if("Pending"===d.resultCode||"RedirectShopper"===d.resultCode)return{success:!0,transactionId:d.pspReference,processorTransactionId:d.pspReference,status:"requires_action",clientSecret:d.action?.paymentData||d.pspReference,processorMetadata:d};return{success:!1,status:"failed",error:d.refusalReason||"Payment was refused",failureCode:d.refusalReasonCode,failureMessage:d.refusalReason,processorMetadata:d}}catch(a){return{success:!1,status:"failed",error:a instanceof Error?a.message:"Payment processing failed"}}}async refundPayment(a){try{let b={merchantAccount:this.config.merchantAccount,originalReference:a.transactionId,amount:a.amount?{value:a.amount,currency:"USD"}:void 0,reference:`refund-${Date.now()}`,metadata:{reason:a.reason,...a.metadata}},c=await fetch(`${this.apiUrl}/v68/payments/${a.transactionId}/refunds`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.config.apiKey},body:JSON.stringify(b)}),d=await c.json();if(!c.ok)return{success:!1,status:"failed",error:d.message||"Refund failed"};return{success:!0,refundId:d.pspReference,processorRefundId:d.pspReference,status:"received"===d.status?"succeeded":"processing"}}catch(a){return{success:!1,status:"failed",error:a instanceof Error?a.message:"Refund failed"}}}async getPaymentStatus(a){let b=await fetch(`${this.apiUrl}/v68/payments/${a}`,{method:"GET",headers:{"X-API-Key":this.config.apiKey}}),c=await b.json();if(!b.ok)throw Error(c.message||"Failed to get payment status");return{status:c.status||"unknown",amount:c.amount?.value||0,metadata:c}}verifyWebhook(a,c){if(!this.config.webhookHmacKey)return console.warn("[Adyen] No webhook HMAC key configured - skipping verification"),!1;try{let d=JSON.parse(a).notificationItems||[];if(0===d.length)return console.error("[Adyen] No notification items in webhook"),!1;for(let a of d){let d=a.NotificationRequestItem,e=[d.pspReference||"",d.originalReference||"",d.merchantAccountCode||"",d.merchantReference||"",d.amount?.value?.toString()||"",d.amount?.currency||"",d.eventCode||"",d.success||""].join(":"),f=Buffer.from(this.config.webhookHmacKey,"hex"),g=b.default.createHmac("sha256",f).update(e,"utf8").digest("base64"),h=d.additionalData?.hmacSignature||c;if(!h||!b.default.timingSafeEqual(Buffer.from(g),Buffer.from(h)))return console.error("[Adyen] HMAC signature verification failed"),!1}return!0}catch(a){return console.error("[Adyen] Webhook verification error:",a),!1}}}a.s(["AdyenProcessor",()=>c])}];

//# sourceMappingURL=apps_web_src_lib_payments_processors_adyen_ts_b021b35d._.js.map