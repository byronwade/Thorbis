{"version":3,"sources":["../../../../../../apps/web/src/components/schedule/schedule-toolbar-actions.tsx","../../../../../../apps/web/src/components/ui/toggle-group.tsx","../../../../../../apps/web/src/hooks/use-schedule.ts","../../../../../../apps/web/src/lib/schedule-utils.ts","../../../../../../apps/web/src/components/schedule/route-optimization-panel.tsx","../../../../../../apps/web/src/actions/data%3Aa1a08b%20%3Ctext/javascript%3E","../../../../../../apps/web/src/actions/data%3Abedfe5%20%3Ctext/javascript%3E","../../../../../../apps/web/src/components/schedule/schedule-toolbar-title.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n\tAlertTriangle,\n\tArrowRight,\n\tCalendarDays,\n\tChevronLeft,\n\tChevronRight,\n\tCircleDot,\n\tColumns3,\n\tHelpCircle,\n\tKeyboard,\n\tLayoutGrid,\n\tMap as MapIcon,\n\tPalette,\n\tPhone,\n\tRepeat,\n\tRoute,\n\tSettings2,\n\tWrench,\n\tZap,\n} from \"lucide-react\";\nimport { usePathname, useRouter } from \"next/navigation\";\nimport { useEffect, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { ToggleGroup, ToggleGroupItem } from \"@/components/ui/toggle-group\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { useSchedule } from \"@/hooks/use-schedule\";\nimport type { TimelineViewMode } from \"@/lib/stores/schedule-view-store\";\nimport { useScheduleViewStore } from \"@/lib/stores/schedule-view-store\";\nimport { cn } from \"@/lib/utils\";\nimport { RouteOptimizationSheet } from \"./route-optimization-panel\";\nimport type { Job, Technician } from \"./schedule-types\";\n\nconst jobTypeLegend = [\n\t{\n\t\tlabel: \"Emergency / Urgent\",\n\t\tdescription: \"High priority service calls\",\n\t\ticon: AlertTriangle,\n\t\tborderClass: \"border-l-red-400 dark:border-l-red-700\",\n\t\tdotClass: \"bg-red-500\",\n\t},\n\t{\n\t\tlabel: \"Callback / Follow Up\",\n\t\tdescription: \"Return visits & follow-ups\",\n\t\ticon: Phone,\n\t\tborderClass: \"border-l-orange-400 dark:border-l-orange-700\",\n\t\tdotClass: \"bg-orange-500\",\n\t},\n\t{\n\t\tlabel: \"Meetings / Events\",\n\t\tdescription: \"Training & team events\",\n\t\ticon: CalendarDays,\n\t\tborderClass: \"border-l-purple-400 dark:border-l-purple-700\",\n\t\tdotClass: \"bg-purple-500\",\n\t},\n\t{\n\t\tlabel: \"Install / New Work\",\n\t\tdescription: \"New installations & setups\",\n\t\ticon: Settings2,\n\t\tborderClass: \"border-l-green-400 dark:border-l-green-700\",\n\t\tdotClass: \"bg-green-500\",\n\t},\n\t{\n\t\tlabel: \"Service / Maintenance\",\n\t\tdescription: \"Regular service calls\",\n\t\ticon: Wrench,\n\t\tborderClass: \"border-l-blue-400 dark:border-l-blue-700\",\n\t\tdotClass: \"bg-blue-500\",\n\t},\n\t{\n\t\tlabel: \"Standard / Other\",\n\t\tdescription: \"General appointments\",\n\t\ticon: CircleDot,\n\t\tborderClass: \"border-l-slate-300 dark:border-l-slate-700\",\n\t\tdotClass: \"bg-slate-400\",\n\t},\n];\n\nconst statusWorkflow = [\n\t{\n\t\tlabel: \"Scheduled\",\n\t\tdescription: \"Job is booked\",\n\t\tcolor: \"bg-blue-500\",\n\t\tstep: 1,\n\t},\n\t{\n\t\tlabel: \"Dispatched\",\n\t\tdescription: \"Tech en route\",\n\t\tcolor: \"bg-sky-500\",\n\t\tstep: 2,\n\t},\n\t{\n\t\tlabel: \"Arrived\",\n\t\tdescription: \"Tech on site\",\n\t\tcolor: \"bg-emerald-400\",\n\t\tstep: 3,\n\t},\n\t{\n\t\tlabel: \"In Progress\",\n\t\tdescription: \"Work started\",\n\t\tcolor: \"bg-amber-500\",\n\t\tstep: 4,\n\t\tpulse: true,\n\t},\n\t{\n\t\tlabel: \"Closed\",\n\t\tdescription: \"Work complete\",\n\t\tcolor: \"bg-emerald-600\",\n\t\tstep: 5,\n\t},\n];\n\nconst keyboardShortcuts = [\n\t{ keys: [\"T\"], description: \"Go to Today\" },\n\t{ keys: [\"N\"], description: \"New Job\" },\n\t{ keys: [\"[\"], description: \"Previous Period\" },\n\t{ keys: [\"]\"], description: \"Next Period\" },\n\t{ keys: [\"1\"], description: \"Timeline View\" },\n\t{ keys: [\"2\"], description: \"Monthly View\" },\n\t{ keys: [\"3\"], description: \"Kanban View\" },\n];\n\nexport function ScheduleToolbarActions() {\n\tconst [mounted, setMounted] = useState(false);\n\tconst pathname = usePathname();\n\tconst router = useRouter();\n\tconst { goToToday, navigatePrevious, navigateNext, viewMode, setViewMode, currentDate } =\n\t\tuseScheduleViewStore();\n\tconst { jobs, technicians } = useSchedule();\n\n\tconst isMapView = pathname === \"/dashboard/schedule/dispatch-map\";\n\n\t// Group jobs by technician for route optimization\n\tconst jobsByTechnician = new Map<string, Job[]>();\n\tfor (const job of jobs.values()) {\n\t\tfor (const assignment of job.assignments) {\n\t\t\tif (assignment.technicianId) {\n\t\t\t\tconst existing = jobsByTechnician.get(assignment.technicianId) || [];\n\t\t\t\texisting.push(job);\n\t\t\t\tjobsByTechnician.set(assignment.technicianId, existing);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Sync viewMode with pathname\n\tuseEffect(() => {\n\t\tif (isMapView && viewMode !== \"map\") {\n\t\t\tsetViewMode(\"map\");\n\t\t} else if (!isMapView && viewMode === \"map\") {\n\t\t\tsetViewMode(\"day\");\n\t\t}\n\t}, [isMapView, viewMode, setViewMode]);\n\n\tuseEffect(() => {\n\t\tsetMounted(true);\n\t}, []);\n\n\t// Handle view mode change with navigation for map\n\tconst handleViewModeChange = (value: string) => {\n\t\tif (!value) return;\n\n\t\tif (value === \"map\") {\n\t\t\tsetViewMode(\"map\");\n\t\t\trouter.push(\"/dashboard/schedule/dispatch-map\");\n\t\t} else {\n\t\t\tif (isMapView) {\n\t\t\t\trouter.push(\"/dashboard/schedule\");\n\t\t\t}\n\t\t\tsetViewMode(value as TimelineViewMode);\n\t\t}\n\t};\n\n\tif (!mounted) {\n\t\treturn (\n\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t<div className=\"bg-muted h-8 w-8 rounded-md\" />\n\t\t\t\t<div className=\"bg-muted h-8 w-20 rounded-md\" />\n\t\t\t\t<div className=\"bg-muted h-8 w-32 rounded-md\" />\n\t\t\t\t<div className=\"bg-muted h-8 w-10 rounded-md\" />\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className=\"flex items-center gap-2\">\n\t\t\t{!isMapView && (\n\t\t\t\t<Button onClick={goToToday} size=\"sm\" variant=\"outline\">\n\t\t\t\t\tToday\n\t\t\t\t</Button>\n\t\t\t)}\n\n\t\t\t{/* Route Optimization - Only show in day/timeline view */}\n\t\t\t{!isMapView && viewMode === \"day\" && (\n\t\t\t\t<RouteOptimizationSheet\n\t\t\t\t\ttechnicians={technicians}\n\t\t\t\t\tjobsByTechnician={jobsByTechnician}\n\t\t\t\t\tselectedDate={currentDate}\n\t\t\t\t/>\n\t\t\t)}\n\n\t\t\t<TooltipProvider>\n\t\t\t\t{/* View Mode Toggle Group */}\n\t\t\t\t<ToggleGroup\n\t\t\t\t\tclassName=\"border\"\n\t\t\t\t\tonValueChange={handleViewModeChange}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\ttype=\"single\"\n\t\t\t\t\tvalue={viewMode}\n\t\t\t\t>\n\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t<ToggleGroupItem aria-label=\"Timeline view\" value=\"day\">\n\t\t\t\t\t\t\t\t<Columns3 className=\"size-4\" />\n\t\t\t\t\t\t\t</ToggleGroupItem>\n\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t<p>Timeline View</p>\n\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t<ToggleGroupItem aria-label=\"Monthly view\" value=\"month\">\n\t\t\t\t\t\t\t\t<CalendarDays className=\"size-4\" />\n\t\t\t\t\t\t\t</ToggleGroupItem>\n\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t<p>Monthly Calendar</p>\n\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t<ToggleGroupItem aria-label=\"Kanban view\" value=\"week\">\n\t\t\t\t\t\t\t\t<LayoutGrid className=\"size-4\" />\n\t\t\t\t\t\t\t</ToggleGroupItem>\n\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t<p>Status Board</p>\n\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t<ToggleGroupItem aria-label=\"Map view\" value=\"map\">\n\t\t\t\t\t\t\t\t<MapIcon className=\"size-4\" />\n\t\t\t\t\t\t\t</ToggleGroupItem>\n\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t<p>Dispatch Map</p>\n\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</ToggleGroup>\n\t\t\t</TooltipProvider>\n\n\t\t\t{!isMapView && (\n\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t<Button onClick={navigatePrevious} size=\"icon\" variant=\"ghost\">\n\t\t\t\t\t\t<ChevronLeft className=\"size-4\" />\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button onClick={navigateNext} size=\"icon\" variant=\"ghost\">\n\t\t\t\t\t\t<ChevronRight className=\"size-4\" />\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{!isMapView && (\n\t\t\t\t<Popover>\n\t\t\t\t\t<PopoverTrigger asChild>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\taria-label=\"Show schedule legend\"\n\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<HelpCircle className=\"size-4\" />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</PopoverTrigger>\n\t\t\t\t\t<PopoverContent align=\"end\" className=\"w-80 p-0\">\n\t\t\t\t\t\t{/* Header */}\n\t\t\t\t\t\t<div className=\"border-b px-4 py-3\">\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<div className=\"bg-primary/10 flex size-8 items-center justify-center rounded-md\">\n\t\t\t\t\t\t\t\t\t<Palette className=\"text-primary size-4\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<h4 className=\"text-sm font-semibold\">Schedule Guide</h4>\n\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\tColors, statuses & shortcuts\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"max-h-[400px] overflow-y-auto\">\n\t\t\t\t\t\t\t{/* Job Type Colors */}\n\t\t\t\t\t\t\t<div className=\"p-4\">\n\t\t\t\t\t\t\t\t<div className=\"mb-3 flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<Zap className=\"text-muted-foreground size-3.5\" />\n\t\t\t\t\t\t\t\t\t<span className=\"text-xs font-semibold uppercase tracking-wide\">\n\t\t\t\t\t\t\t\t\t\tJob Types\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t{jobTypeLegend.map((item) => {\n\t\t\t\t\t\t\t\t\t\tconst Icon = item.icon;\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex items-center gap-3 rounded-lg border-l-4 bg-card/50 px-3 py-2\",\n\t\t\t\t\t\t\t\t\t\t\t\t\titem.borderClass,\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\tkey={item.label}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"bg-muted flex size-7 shrink-0 items-center justify-center rounded-md\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Icon className=\"text-muted-foreground size-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-medium truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{item.label}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{item.description}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<Separator />\n\n\t\t\t\t\t\t\t{/* Status Workflow */}\n\t\t\t\t\t\t\t<div className=\"p-4\">\n\t\t\t\t\t\t\t\t<div className=\"mb-3 flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<ArrowRight className=\"text-muted-foreground size-3.5\" />\n\t\t\t\t\t\t\t\t\t<span className=\"text-xs font-semibold uppercase tracking-wide\">\n\t\t\t\t\t\t\t\t\t\tStatus Workflow\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{/* Visual workflow diagram */}\n\t\t\t\t\t\t\t\t<div className=\"mb-3\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-1\">\n\t\t\t\t\t\t\t\t\t\t{statusWorkflow.map((status, idx) => (\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tkey={status.label}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center flex-1\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"h-1.5 flex-1 rounded-full\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstatus.color,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstatus.pulse && \"animate-pulse\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t{idx < statusWorkflow.length - 1 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<ArrowRight className=\"text-muted-foreground mx-0.5 size-2.5 shrink-0\" />\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-2\">\n\t\t\t\t\t\t\t\t\t{statusWorkflow.map((status) => (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center gap-2 rounded-md px-2 py-1.5\"\n\t\t\t\t\t\t\t\t\t\t\tkey={status.label}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"size-2.5 rounded-full shrink-0\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tstatus.color,\n\t\t\t\t\t\t\t\t\t\t\t\t\tstatus.pulse && \"animate-pulse\",\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs font-medium\">{status.label}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-[10px] truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{status.description}\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t{/* Cancelled status - separate */}\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 rounded-md px-2 py-1.5\">\n\t\t\t\t\t\t\t\t\t\t<span className=\"bg-slate-400 size-2.5 rounded-full shrink-0\" />\n\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs font-medium\">Cancelled</p>\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-[10px]\">\n\t\t\t\t\t\t\t\t\t\t\t\tJob cancelled\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<Separator />\n\n\t\t\t\t\t\t\t{/* Special Indicators */}\n\t\t\t\t\t\t\t<div className=\"p-4\">\n\t\t\t\t\t\t\t\t<div className=\"mb-3 flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<Repeat className=\"text-muted-foreground size-3.5\" />\n\t\t\t\t\t\t\t\t\t<span className=\"text-xs font-semibold uppercase tracking-wide\">\n\t\t\t\t\t\t\t\t\t\tSpecial Indicators\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t<div className=\"bg-card/50 flex items-center gap-3 rounded-lg border px-3 py-2\">\n\t\t\t\t\t\t\t\t\t\t<Repeat className=\"text-primary size-4 shrink-0\" />\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs font-medium\">Recurring Job</p>\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-[10px]\">\n\t\t\t\t\t\t\t\t\t\t\t\tRepeats on a schedule\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"bg-card/50 flex items-center gap-3 rounded-lg border px-3 py-2\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex -space-x-1\">\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"bg-primary size-4 rounded-full border-2 border-background\" />\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"bg-emerald-500 size-4 rounded-full border-2 border-background\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs font-medium\">Multi-Tech Job</p>\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-[10px]\">\n\t\t\t\t\t\t\t\t\t\t\t\tMultiple technicians assigned\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<Separator />\n\n\t\t\t\t\t\t\t{/* Keyboard Shortcuts */}\n\t\t\t\t\t\t\t<div className=\"p-4\">\n\t\t\t\t\t\t\t\t<div className=\"mb-3 flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<Keyboard className=\"text-muted-foreground size-3.5\" />\n\t\t\t\t\t\t\t\t\t<span className=\"text-xs font-semibold uppercase tracking-wide\">\n\t\t\t\t\t\t\t\t\t\tKeyboard Shortcuts\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-x-4 gap-y-1.5\">\n\t\t\t\t\t\t\t\t\t{keyboardShortcuts.map((shortcut) => (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center justify-between\"\n\t\t\t\t\t\t\t\t\t\t\tkey={shortcut.description}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t{shortcut.description}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t{shortcut.keys.map((key) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<kbd\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"bg-muted text-muted-foreground rounded px-1.5 py-0.5 font-mono text-[10px]\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={key}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{key}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</kbd>\n\t\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</PopoverContent>\n\t\t\t\t</Popover>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","// Re-export from @stratos/ui package\nexport * from \"@stratos/ui\";\n","import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport type { Job, Technician } from \"@/components/schedule/schedule-types\";\nimport { fetchScheduleData } from \"@/lib/schedule-data\";\nimport { filterJobs, sortJobsByStartTime } from \"@/lib/schedule-utils\";\nimport { useScheduleStore } from \"@/lib/stores/schedule-store\";\nimport { useViewStore } from \"@/lib/stores/view-store\";\nimport { createClient } from \"@/lib/supabase/client\";\n\nexport function useSchedule() {\n\t// Use granular selectors to avoid closure issues\n\tconst isLoading = useScheduleStore((state) => state.isLoading);\n\tconst error = useScheduleStore((state) => state.error);\n\tconst lastSync = useScheduleStore((state) => state.lastSync);\n\tconst jobs = useScheduleStore((state) => state.jobs);\n\tconst technicians = useScheduleStore((state) => state.technicians);\n\tconst selectedJobId = useScheduleStore((state) => state.selectedJobId);\n\tconst selectedTechnicianId = useScheduleStore(\n\t\t(state) => state.selectedTechnicianId,\n\t);\n\tconst lastFetchedRange = useScheduleStore((state) => state.lastFetchedRange);\n\tconst storeCompanyId = useScheduleStore((state) => state.companyId);\n\tconst unassignedHasMore = useScheduleStore(\n\t\t(state) => state.unassignedHasMore,\n\t);\n\tconst unassignedSearch = useScheduleStore((state) => state.unassignedSearch);\n\tconst isLoadingUnassigned = useScheduleStore(\n\t\t(state) => state.isLoadingUnassigned,\n\t);\n\tconst unassignedTotalCount = useScheduleStore(\n\t\t(state) => state.unassignedTotalCount,\n\t);\n\n\t// Get actions\n\tconst setLoading = useScheduleStore((state) => state.setLoading);\n\tconst setError = useScheduleStore((state) => state.setError);\n\tconst setJobs = useScheduleStore((state) => state.setJobs);\n\tconst setTechnicians = useScheduleStore((state) => state.setTechnicians);\n\tconst selectJob = useScheduleStore((state) => state.selectJob);\n\tconst selectTechnician = useScheduleStore((state) => state.selectTechnician);\n\tconst addJob = useScheduleStore((state) => state.addJob);\n\tconst updateJob = useScheduleStore((state) => state.updateJob);\n\tconst moveJob = useScheduleStore((state) => state.moveJob);\n\tconst deleteJob = useScheduleStore((state) => state.deleteJob);\n\tconst duplicateJob = useScheduleStore((state) => state.duplicateJob);\n\tconst getJobById = useScheduleStore((state) => state.getJobById);\n\tconst syncWithServer = useScheduleStore((state) => state.syncWithServer);\n\tconst setLastSync = useScheduleStore((state) => state.setLastSync);\n\tconst setCompanyId = useScheduleStore((state) => state.setCompanyId);\n\tconst setLastFetchedRange = useScheduleStore(\n\t\t(state) => state.setLastFetchedRange,\n\t);\n\tconst setUnassignedMeta = useScheduleStore(\n\t\t(state) => state.setUnassignedMeta,\n\t);\n\tconst getUnassignedJobsFromStore = useScheduleStore(\n\t\t(state) => state.getUnassignedJobs,\n\t);\n\tconst getJobsGroupedByTechnicianFromStore = useScheduleStore(\n\t\t(state) => state.getJobsGroupedByTechnician,\n\t);\n\tconst loadMoreUnassignedJobs = useScheduleStore(\n\t\t(state) => state.loadMoreUnassignedJobs,\n\t);\n\n\t// Get view store values with selectors to avoid re-renders\n\tconst filters = useViewStore((state) => state.filters);\n\tconst showCompletedJobs = useViewStore((state) => state.showCompletedJobs);\n\tconst _currentDate = useViewStore((state) => state.currentDate);\n\tconst _zoom = useViewStore((state) => state.zoom);\n\n\t// Calculate visible time range once\n\tconst visibleTimeRange = useMemo(\n\t\t() => useViewStore.getState().getVisibleTimeRange(),\n\t\t[],\n\t);\n\n\tconst rangeStart = visibleTimeRange.start.getTime();\n\tconst rangeEnd = visibleTimeRange.end.getTime();\n\tconst companyIdRef = useRef<string | null>(\n\t\tuseScheduleStore.getState().companyId,\n\t);\n\n\tuseEffect(() => {\n\t\tcompanyIdRef.current = storeCompanyId;\n\t}, [storeCompanyId]);\n\n\tconst jobCount = jobs.size;\n\n\tconst hasCoverage = useMemo(() => {\n\t\tif (!lastFetchedRange || jobCount === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst fetchedStart = lastFetchedRange.start.getTime();\n\t\tconst fetchedEnd = lastFetchedRange.end.getTime();\n\n\t\treturn fetchedStart <= rangeStart && fetchedEnd >= rangeEnd;\n\t}, [jobCount, lastFetchedRange, rangeEnd, rangeStart]);\n\n\tuseEffect(() => {\n\t\tlet isMounted = true;\n\n\t\tif (hasCoverage && companyIdRef.current) {\n\t\t\treturn () => {\n\t\t\t\tisMounted = false;\n\t\t\t};\n\t\t}\n\n\t\tconst loadData = async () => {\n\t\t\tsetLoading(true);\n\t\t\tsetError(null);\n\n\t\t\ttry {\n\t\t\t\tconst supabase = createClient();\n\n\t\t\t\tif (!supabase) {\n\t\t\t\t\tthrow new Error(\"Database connection not available\");\n\t\t\t\t}\n\n\t\t\t\tconst {\n\t\t\t\t\tdata: { user },\n\t\t\t\t\terror: authError,\n\t\t\t\t} = await supabase.auth.getUser();\n\n\t\t\t\tif (authError) {\n\t\t\t\t\tthrow authError;\n\t\t\t\t}\n\n\t\t\t\tif (!user) {\n\t\t\t\t\tthrow new Error(\"User session not found\");\n\t\t\t\t}\n\n\t\t\t\tlet companyId = companyIdRef.current;\n\n\t\t\t\tif (!companyId) {\n\t\t\t\t\tconst { data: membership, error: membershipError } = await supabase\n\t\t\t\t\t\t.from(\"company_memberships\")\n\t\t\t\t\t\t.select(\"company_id\")\n\t\t\t\t\t\t.eq(\"user_id\", user.id)\n\t\t\t\t\t\t.eq(\"status\", \"active\")\n\t\t\t\t\t\t.order(\"joined_at\", { ascending: false, nullsFirst: false })\n\t\t\t\t\t\t.limit(1)\n\t\t\t\t\t\t.maybeSingle();\n\n\t\t\t\t\tif (membershipError) {\n\t\t\t\t\t\tthrow membershipError;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!membership?.company_id) {\n\t\t\t\t\t\tthrow new Error(\"No active company membership found\");\n\t\t\t\t\t}\n\n\t\t\t\t\tcompanyId = membership.company_id;\n\t\t\t\t\tcompanyIdRef.current = companyId;\n\t\t\t\t\tsetCompanyId(companyId);\n\t\t\t\t}\n\n\t\t\t\tif (!companyId) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\"Unable to resolve company context for schedule data\",\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tconst {\n\t\t\t\t\tjobs: convertedJobs,\n\t\t\t\t\ttechnicians: convertedTechnicians,\n\t\t\t\t\tunassignedMeta,\n\t\t\t\t} = await fetchScheduleData({\n\t\t\t\t\tsupabase,\n\t\t\t\t\tcompanyId,\n\t\t\t\t\trange: {\n\t\t\t\t\t\tstart: new Date(rangeStart),\n\t\t\t\t\t\tend: new Date(rangeEnd),\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tif (!isMounted) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsetTechnicians(convertedTechnicians);\n\t\t\t\tsetJobs(convertedJobs);\n\t\t\t\tconst fetchedRange = {\n\t\t\t\t\tstart: new Date(rangeStart),\n\t\t\t\t\tend: new Date(rangeEnd),\n\t\t\t\t};\n\n\t\t\t\tsetTechnicians(convertedTechnicians);\n\t\t\t\tsetJobs(convertedJobs);\n\t\t\t\tconst unassignedCount = convertedJobs.filter(\n\t\t\t\t\t(job) => job.isUnassigned,\n\t\t\t\t).length;\n\t\t\t\tsetUnassignedMeta(unassignedMeta, unassignedCount);\n\t\t\t\tsetLastSync(new Date());\n\t\t\t\tsetLastFetchedRange(fetchedRange);\n\t\t\t} catch (error) {\n\t\t\t\tif (!isMounted) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst errorMessage =\n\t\t\t\t\terror instanceof Error\n\t\t\t\t\t\t? error.message\n\t\t\t\t\t\t: typeof error === \"object\" && error !== null && \"message\" in error\n\t\t\t\t\t\t\t? String((error as { message: string }).message)\n\t\t\t\t\t\t\t: \"Unknown error\";\n\t\t\t\tsetError(errorMessage);\n\t\t\t} finally {\n\t\t\t\tif (isMounted) {\n\t\t\t\t\tsetLoading(false);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tloadData();\n\n\t\treturn () => {\n\t\t\tisMounted = false;\n\t\t};\n\t}, [\n\t\thasCoverage,\n\t\trangeEnd,\n\t\trangeStart,\n\t\tsetCompanyId,\n\t\tsetLastFetchedRange,\n\t\tsetError,\n\t\tsetJobs,\n\t\tsetLastSync,\n\t\tsetLoading,\n\t\tsetTechnicians,\n\t]);\n\n\t// Get filtered and sorted jobs - MEMOIZED\n\tconst filteredJobs = useMemo((): Job[] => {\n\t\tconst allJobs = Array.from(jobs.values());\n\n\t\t// Apply view filters\n\t\tconst filtered = filterJobs(allJobs, {\n\t\t\ttechnicianIds: filters.technicianIds,\n\t\t\tstatuses: filters.statuses,\n\t\t\tpriorities: filters.priorities,\n\t\t\tsearchQuery: filters.searchQuery,\n\t\t});\n\n\t\t// Filter by completed jobs visibility\n\t\tconst visible = showCompletedJobs\n\t\t\t? filtered\n\t\t\t: filtered.filter((job) => job.status !== \"completed\");\n\n\t\t// Sort by start time\n\t\treturn sortJobsByStartTime(visible);\n\t}, [jobs, filters, showCompletedJobs]);\n\n\t// Get filtered technicians - MEMOIZED\n\tconst filteredTechnicians = useMemo((): Technician[] => {\n\t\tconst allTechnicians = Array.from(technicians.values());\n\n\t\t// If technician filter is active, only show filtered technicians\n\t\tif (filters.technicianIds.length > 0) {\n\t\t\treturn allTechnicians.filter((tech) =>\n\t\t\t\tfilters.technicianIds.includes(tech.id),\n\t\t\t);\n\t\t}\n\n\t\treturn allTechnicians;\n\t}, [technicians, filters.technicianIds]);\n\n\t// Pre-index jobs by technician ID for O(1) lookups instead of O(n) filter\n\tconst jobsByTechnicianId = useMemo(() => {\n\t\tconst map = new Map<string, Job[]>();\n\t\tfor (const job of filteredJobs) {\n\t\t\tconst techId = job.technicianId;\n\t\t\tif (techId) {\n\t\t\t\tconst existing = map.get(techId);\n\t\t\t\tif (existing) {\n\t\t\t\t\texisting.push(job);\n\t\t\t\t} else {\n\t\t\t\t\tmap.set(techId, [job]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn map;\n\t}, [filteredJobs]);\n\n\t// Get jobs for a specific technician - now O(1) lookup\n\tconst getJobsForTechnician = useCallback(\n\t\t(technicianId: string): Job[] => jobsByTechnicianId.get(technicianId) ?? [],\n\t\t[jobsByTechnicianId],\n\t);\n\n\t// Get jobs within visible time range - MEMOIZED\n\tconst visibleJobs = useMemo((): Job[] => {\n\t\tconst { start, end } = visibleTimeRange;\n\n\t\treturn filteredJobs.filter((job) => {\n\t\t\t// Job overlaps with visible range\n\t\t\treturn job.startTime <= end && job.endTime >= start;\n\t\t});\n\t}, [filteredJobs, visibleTimeRange]);\n\n\t// Get all jobs (unfiltered)\n\tconst getAllJobs = useCallback(\n\t\t(): Job[] => Array.from(jobs.values()),\n\t\t[jobs],\n\t);\n\n\treturn {\n\t\t// State\n\t\tisLoading,\n\t\terror,\n\t\tlastSync,\n\n\t\t// Data\n\t\ttechnicians: filteredTechnicians,\n\t\tjobs: filteredJobs,\n\t\tvisibleJobs,\n\n\t\t// Selection\n\t\tselectedJobId,\n\t\tselectedTechnicianId,\n\t\tselectedJob: selectedJobId ? getJobById(selectedJobId) : null,\n\n\t\t// Actions\n\t\tgetJobsForTechnician,\n\t\tgetAllJobs,\n\t\tselectJob,\n\t\tselectTechnician,\n\t\tgetUnassignedJobs: getUnassignedJobsFromStore,\n\t\tgetJobsGroupedByTechnician: getJobsGroupedByTechnicianFromStore,\n\t\tunassignedHasMore,\n\t\tunassignedSearch,\n\t\tisLoadingUnassigned,\n\t\tunassignedTotalCount,\n\t\tloadMoreUnassignedJobs,\n\n\t\t// Mutations\n\t\taddJob,\n\t\tupdateJob,\n\t\tmoveJob,\n\t\tdeleteJob,\n\t\tduplicateJob,\n\n\t\t// Sync\n\t\trefresh: syncWithServer,\n\t};\n}\n\n/**\n * Hook for real-time schedule updates via Supabase\n * Subscribes to appointments table for INSERT, UPDATE, DELETE events\n */\nexport function useScheduleRealtime() {\n\tconst companyId = useScheduleStore((state) => state.companyId);\n\tconst updateJob = useScheduleStore((state) => state.updateJob);\n\tconst deleteJob = useScheduleStore((state) => state.deleteJob);\n\tconst addJob = useScheduleStore((state) => state.addJob);\n\tconst getJobById = useScheduleStore((state) => state.getJobById);\n\tconst syncWithServer = useScheduleStore((state) => state.syncWithServer);\n\tconst lastSync = useScheduleStore((state) => state.lastSync);\n\tconst [isConnected, setIsConnected] = useState(false);\n\tconst [connectionError, setConnectionError] = useState<string | null>(null);\n\n\tuseEffect(() => {\n\t\tif (!companyId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst supabase = createClient();\n\t\tif (!supabase) {\n\t\t\tsetConnectionError(\"Database connection not available\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst channelName = `schedule-realtime-${companyId}`;\n\n\t\tconst channel = supabase\n\t\t\t.channel(channelName)\n\t\t\t.on(\n\t\t\t\t\"postgres_changes\",\n\t\t\t\t{\n\t\t\t\t\tevent: \"*\",\n\t\t\t\t\tschema: \"public\",\n\t\t\t\t\ttable: \"appointments\",\n\t\t\t\t\tfilter: `company_id=eq.${companyId}`,\n\t\t\t\t},\n\t\t\t\tasync (payload) => {\n\t\t\t\t\tconst { eventType, new: newRecord, old: oldRecord } = payload;\n\n\t\t\t\t\tswitch (eventType) {\n\t\t\t\t\t\tcase \"DELETE\": {\n\t\t\t\t\t\t\t// Remove job from store\n\t\t\t\t\t\t\tconst jobId = (oldRecord as { id?: string })?.id;\n\t\t\t\t\t\t\tif (jobId) {\n\t\t\t\t\t\t\t\tdeleteJob(jobId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase \"UPDATE\": {\n\t\t\t\t\t\t\t// For updates, try to merge changes into existing job\n\t\t\t\t\t\t\tconst record = newRecord as Record<string, unknown>;\n\t\t\t\t\t\t\tconst jobId = record.id as string;\n\n\t\t\t\t\t\t\tif (!jobId) break;\n\n\t\t\t\t\t\t\tconst existingJob = getJobById(jobId);\n\n\t\t\t\t\t\t\tif (existingJob) {\n\t\t\t\t\t\t\t\t// Merge updates into existing job\n\t\t\t\t\t\t\t\tconst updates: Partial<Job> = {};\n\n\t\t\t\t\t\t\t\tif (record.title !== undefined) {\n\t\t\t\t\t\t\t\t\tupdates.title = record.title as string;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (record.description !== undefined) {\n\t\t\t\t\t\t\t\t\tupdates.description = record.description as string;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (record.status !== undefined) {\n\t\t\t\t\t\t\t\t\tupdates.status = mapStatus(record.status as string);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (record.start_time !== undefined) {\n\t\t\t\t\t\t\t\t\tupdates.startTime = new Date(record.start_time as string);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (record.end_time !== undefined) {\n\t\t\t\t\t\t\t\t\tupdates.endTime = new Date(record.end_time as string);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (record.assigned_to !== undefined) {\n\t\t\t\t\t\t\t\t\t// Assignment changed - need to handle technician change\n\t\t\t\t\t\t\t\t\tif (record.assigned_to === null) {\n\t\t\t\t\t\t\t\t\t\tupdates.isUnassigned = true;\n\t\t\t\t\t\t\t\t\t\tupdates.technicianId = \"\";\n\t\t\t\t\t\t\t\t\t\tupdates.assignments = [];\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tupdates.isUnassigned = false;\n\t\t\t\t\t\t\t\t\t\tupdates.technicianId = record.assigned_to as string;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (Object.keys(updates).length > 0) {\n\t\t\t\t\t\t\t\t\tupdateJob(jobId, updates);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Job not in store - fetch fresh data\n\t\t\t\t\t\t\t\tawait syncWithServer();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase \"INSERT\": {\n\t\t\t\t\t\t\t// For new jobs, we need full data with joins\n\t\t\t\t\t\t\t// Trigger a sync to get complete job with customer/property data\n\t\t\t\t\t\t\tawait syncWithServer();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t)\n\t\t\t.subscribe((status) => {\n\t\t\t\tif (status === \"SUBSCRIBED\") {\n\t\t\t\t\tsetIsConnected(true);\n\t\t\t\t\tsetConnectionError(null);\n\t\t\t\t} else if (status === \"CHANNEL_ERROR\") {\n\t\t\t\t\tsetIsConnected(false);\n\t\t\t\t\tsetConnectionError(\"Failed to connect to real-time updates\");\n\t\t\t\t} else if (status === \"CLOSED\") {\n\t\t\t\t\tsetIsConnected(false);\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn () => {\n\t\t\tsupabase.removeChannel(channel);\n\t\t\tsetIsConnected(false);\n\t\t};\n\t}, [companyId, updateJob, deleteJob, addJob, getJobById, syncWithServer]);\n\n\treturn {\n\t\tisConnected,\n\t\tconnectionError,\n\t\tlastUpdate: lastSync,\n\t};\n}\n\n// Helper to map database status to Job status\nfunction mapStatus(status: string): Job[\"status\"] {\n\tconst normalized = status?.toLowerCase() ?? \"scheduled\";\n\tswitch (normalized) {\n\t\tcase \"scheduled\":\n\t\tcase \"dispatched\":\n\t\tcase \"arrived\":\n\t\tcase \"closed\":\n\t\tcase \"cancelled\":\n\t\t\treturn normalized as Job[\"status\"];\n\t\tcase \"in-progress\":\n\t\tcase \"in_progress\":\n\t\tcase \"inprogress\":\n\t\t\treturn \"in-progress\";\n\t\tcase \"completed\":\n\t\tcase \"complete\":\n\t\tcase \"done\":\n\t\t\treturn \"completed\";\n\t\tdefault:\n\t\t\treturn \"scheduled\";\n\t}\n}\n\n/**\n * Hook for schedule statistics\n */\nfunction useScheduleStats() {\n\tconst { technicians, jobs, visibleJobs } = useSchedule();\n\n\tconst stats = {\n\t\ttotalTechnicians: technicians.length,\n\t\ttotalJobs: jobs.length,\n\t\tvisibleJobs: visibleJobs.length,\n\t\tscheduledJobs: jobs.filter((j) => j.status === \"scheduled\").length,\n\t\tinProgressJobs: jobs.filter((j) => j.status === \"in-progress\").length,\n\t\tcompletedJobs: jobs.filter((j) => j.status === \"completed\").length,\n\t\tcancelledJobs: jobs.filter((j) => j.status === \"cancelled\").length,\n\t\turgentJobs: jobs.filter((j) => j.priority === \"urgent\").length,\n\t};\n\n\treturn stats;\n}\n","import type {\n\tAddress,\n\tCustomer,\n\tJob,\n\tJobAssignment,\n\tLegacyJob,\n\tLocation,\n\tTechnician,\n\tTechnicianSchedule,\n} from \"@/components/schedule/schedule-types\";\n\n/**\n * Utilities for schedule management\n */\n\n// ============================================\n// CONFLICT DETECTION\n// ============================================\n\nfunction hasTimeConflict(\n\tjob1Start: Date | string,\n\tjob1End: Date | string,\n\tjob2Start: Date | string,\n\tjob2End: Date | string,\n): boolean {\n\tconst start1 = job1Start instanceof Date ? job1Start : new Date(job1Start);\n\tconst end1 = job1End instanceof Date ? job1End : new Date(job1End);\n\tconst start2 = job2Start instanceof Date ? job2Start : new Date(job2Start);\n\tconst end2 = job2End instanceof Date ? job2End : new Date(job2End);\n\n\treturn (\n\t\t(start1 >= start2 && start1 < end2) ||\n\t\t(end1 > start2 && end1 <= end2) ||\n\t\t(start1 <= start2 && end1 >= end2)\n\t);\n}\n\nfunction findConflictingJobs(\n\tjobs: Job[],\n\ttechnicianId: string,\n\tstartTime: Date,\n\tendTime: Date,\n\texcludeJobId?: string,\n): Job[] {\n\treturn jobs.filter((job) => {\n\t\tif (excludeJobId && job.id === excludeJobId) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!jobHasTechnician(job, technicianId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn hasTimeConflict(startTime, endTime, job.startTime, job.endTime);\n\t});\n}\n\n// ============================================\n// MIGRATION UTILITIES\n// ============================================\n\nfunction legacyJobToJob(legacy: LegacyJob, technicianId: string): Job {\n\tconst today = new Date();\n\ttoday.setHours(0, 0, 0, 0);\n\n\t// Parse time strings\n\tconst [startHour, startMin] = legacy.startTime.split(\":\").map(Number);\n\tconst [endHour, endMin] = legacy.endTime.split(\":\").map(Number);\n\n\tconst startTime = new Date(today);\n\tstartTime.setHours(startHour, startMin, 0, 0);\n\n\tconst endTime = new Date(today);\n\tendTime.setHours(endHour, endMin, 0, 0);\n\n\t// Create address and location\n\tconst address: Address = {\n\t\tstreet: legacy.address,\n\t\tcity: \"\",\n\t\tstate: \"\",\n\t\tzip: \"\",\n\t\tcountry: \"USA\",\n\t};\n\n\tconst location: Location = {\n\t\taddress,\n\t\tcoordinates: {\n\t\t\tlat: legacy.lat,\n\t\t\tlng: legacy.lng,\n\t\t},\n\t};\n\n\t// Create customer\n\tconst customer: Customer = {\n\t\tid: `customer-${legacy.customer.toLowerCase().replace(/\\s+/g, \"-\")}`,\n\t\tname: legacy.customer,\n\t\tlocation,\n\t\tcreatedAt: new Date(),\n\t\tupdatedAt: new Date(),\n\t};\n\n\t// Calculate estimated duration in minutes\n\tconst estimatedDuration = legacy.estimatedDuration\n\t\t? Number.parseFloat(legacy.estimatedDuration.replace(/[^\\d.]/g, \"\")) * 60\n\t\t: undefined;\n\n\tconst assignments: JobAssignment[] = technicianId\n\t\t? [\n\t\t\t\t{\n\t\t\t\t\ttechnicianId,\n\t\t\t\t\tteamMemberId: undefined,\n\t\t\t\t\tdisplayName: \"Technician\",\n\t\t\t\t\tavatar: null,\n\t\t\t\t\trole: \"primary\",\n\t\t\t\t\tstatus: \"available\",\n\t\t\t\t\tisActive: true,\n\t\t\t\t},\n\t\t\t]\n\t\t: [];\n\n\treturn {\n\t\tid: legacy.id,\n\t\ttechnicianId,\n\t\tassignments,\n\t\tisUnassigned: assignments.length === 0,\n\t\ttitle: legacy.title,\n\t\tdescription: legacy.description,\n\t\tcustomer,\n\t\tlocation,\n\t\tstartTime,\n\t\tendTime,\n\t\tstatus: legacy.status,\n\t\tpriority: legacy.priority,\n\t\tmetadata: {\n\t\t\testimatedDuration,\n\t\t},\n\t\tcreatedAt: new Date(),\n\t\tupdatedAt: new Date(),\n\t};\n}\n\n// ============================================\n// TIME CALCULATIONS\n// ============================================\n\nfunction calculateDuration(\n\tstartTime: Date | string,\n\tendTime: Date | string,\n): number {\n\tconst start = startTime instanceof Date ? startTime : new Date(startTime);\n\tconst end = endTime instanceof Date ? endTime : new Date(endTime);\n\treturn Math.round((end.getTime() - start.getTime()) / (1000 * 60)); // minutes\n}\n\nfunction formatDuration(minutes: number): string {\n\tif (minutes < 60) {\n\t\treturn `${minutes}m`;\n\t}\n\n\tconst hours = Math.floor(minutes / 60);\n\tconst mins = minutes % 60;\n\n\treturn mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;\n}\n\nfunction addMinutes(date: Date, minutes: number): Date {\n\treturn new Date(date.getTime() + minutes * 60 * 1000);\n}\n\n// ============================================\n// WORK HOURS CALCULATIONS\n// ============================================\n\nfunction calculateWorkload(\n\tjobs: Job[],\n\ttechnicianSchedule: TechnicianSchedule,\n\tdate: Date,\n): {\n\ttotalMinutes: number;\n\tavailableMinutes: number;\n\tutilizationRate: number;\n} {\n\tconst dayStart = new Date(date);\n\tdayStart.setHours(technicianSchedule.availableHours.start, 0, 0, 0);\n\n\tconst dayEnd = new Date(date);\n\tdayEnd.setHours(technicianSchedule.availableHours.end, 0, 0, 0);\n\n\tconst availableMinutes = calculateDuration(dayStart, dayEnd);\n\n\t// Calculate total job duration for this day\n\tconst totalMinutes = jobs.reduce((sum, job) => {\n\t\t// Check if job is on this date\n\t\tif (\n\t\t\tjob.startTime.toDateString() === date.toDateString() ||\n\t\t\tjob.endTime.toDateString() === date.toDateString()\n\t\t) {\n\t\t\treturn sum + calculateDuration(job.startTime, job.endTime);\n\t\t}\n\t\treturn sum;\n\t}, 0);\n\n\tconst utilizationRate =\n\t\tavailableMinutes > 0 ? (totalMinutes / availableMinutes) * 100 : 0;\n\n\treturn {\n\t\ttotalMinutes,\n\t\tavailableMinutes,\n\t\tutilizationRate: Math.min(utilizationRate, 100),\n\t};\n}\n\n// ============================================\n// DATE UTILITIES\n// ============================================\n\nfunction isSameDay(date1: Date, date2: Date): boolean {\n\treturn (\n\t\tdate1.getFullYear() === date2.getFullYear() &&\n\t\tdate1.getMonth() === date2.getMonth() &&\n\t\tdate1.getDate() === date2.getDate()\n\t);\n}\n\nfunction isToday(date: Date): boolean {\n\treturn isSameDay(date, new Date());\n}\n\nexport function startOfDay(date: Date): Date {\n\tconst result = new Date(date);\n\tresult.setHours(0, 0, 0, 0);\n\treturn result;\n}\n\nexport function endOfDay(date: Date): Date {\n\tconst result = new Date(date);\n\tresult.setHours(23, 59, 59, 999);\n\treturn result;\n}\n\n// ============================================\n// RECURRING JOBS\n// ============================================\n\nfunction generateRecurringJobInstances(\n\tbaseJob: Job,\n\tstartDate: Date,\n\tendDate: Date,\n): Job[] {\n\tif (!baseJob.recurrence) {\n\t\treturn [baseJob];\n\t}\n\n\tconst instances: Job[] = [];\n\tconst {\n\t\tfrequency,\n\t\tinterval,\n\t\tcount,\n\t\tendDate: recurrenceEndDate,\n\t} = baseJob.recurrence;\n\n\tconst currentDate = new Date(baseJob.startTime);\n\tlet instanceCount = 0;\n\n\twhile (currentDate <= endDate) {\n\t\tif (currentDate >= startDate) {\n\t\t\t// Calculate job duration\n\t\t\tconst duration = calculateDuration(baseJob.startTime, baseJob.endTime);\n\n\t\t\t// Create new instance\n\t\t\tconst instance: Job = {\n\t\t\t\t...baseJob,\n\t\t\t\tid: `${baseJob.id}-instance-${instanceCount}`,\n\t\t\t\tparentJobId: baseJob.id,\n\t\t\t\tstartTime: new Date(currentDate),\n\t\t\t\tendTime: addMinutes(new Date(currentDate), duration),\n\t\t\t};\n\n\t\t\tinstances.push(instance);\n\t\t}\n\n\t\t// Move to next occurrence\n\t\tinstanceCount++;\n\n\t\tif (count && instanceCount >= count) {\n\t\t\tbreak;\n\t\t}\n\t\tif (recurrenceEndDate && currentDate >= recurrenceEndDate) {\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch (frequency) {\n\t\t\tcase \"daily\":\n\t\t\t\tcurrentDate.setDate(currentDate.getDate() + interval);\n\t\t\t\tbreak;\n\t\t\tcase \"weekly\":\n\t\t\t\tcurrentDate.setDate(currentDate.getDate() + interval * 7);\n\t\t\t\tbreak;\n\t\t\tcase \"monthly\":\n\t\t\t\tcurrentDate.setMonth(currentDate.getMonth() + interval);\n\t\t\t\tbreak;\n\t\t\tcase \"yearly\":\n\t\t\t\tcurrentDate.setFullYear(currentDate.getFullYear() + interval);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn instances;\n}\n\n// ============================================\n// FILTERING\n// ============================================\n\nexport function filterJobs(\n\tjobs: Job[],\n\tfilters: {\n\t\ttechnicianIds?: string[];\n\t\tstatuses?: Job[\"status\"][];\n\t\tpriorities?: Job[\"priority\"][];\n\t\tsearchQuery?: string;\n\t},\n): Job[] {\n\treturn jobs.filter((job) => {\n\t\t// Filter by technician\n\t\tif (\n\t\t\tfilters.technicianIds &&\n\t\t\tfilters.technicianIds.length > 0 &&\n\t\t\t!filters.technicianIds.some((technicianId) =>\n\t\t\t\tjobHasTechnician(job, technicianId),\n\t\t\t)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Filter by status\n\t\tif (\n\t\t\tfilters.statuses &&\n\t\t\tfilters.statuses.length > 0 &&\n\t\t\t!filters.statuses.includes(job.status)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Filter by priority\n\t\tif (\n\t\t\tfilters.priorities &&\n\t\t\tfilters.priorities.length > 0 &&\n\t\t\t!filters.priorities.includes(job.priority)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Filter by search query\n\t\tif (filters.searchQuery && filters.searchQuery.trim() !== \"\") {\n\t\t\tconst query = filters.searchQuery.toLowerCase();\n\t\t\tconst matchesTitle = job.title.toLowerCase().includes(query);\n\t\t\tconst matchesCustomer = job.customer.name.toLowerCase().includes(query);\n\t\t\tconst matchesDescription = job.description?.toLowerCase().includes(query);\n\n\t\t\tif (!(matchesTitle || matchesCustomer || matchesDescription)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t});\n}\n\n// ============================================\n// SORTING\n// ============================================\n\nexport function sortJobsByStartTime(jobs: Job[]): Job[] {\n\treturn [...jobs].sort((a, b) => {\n\t\t// Ensure dates are Date objects\n\t\tconst aTime =\n\t\t\ta.startTime instanceof Date ? a.startTime : new Date(a.startTime);\n\t\tconst bTime =\n\t\t\tb.startTime instanceof Date ? b.startTime : new Date(b.startTime);\n\t\treturn aTime.getTime() - bTime.getTime();\n\t});\n}\n\nfunction sortTechniciansByName(technicians: Technician[]): Technician[] {\n\treturn [...technicians].sort((a, b) => a.name.localeCompare(b.name));\n}\n\n// ============================================\n// VALIDATION\n// ============================================\n\nfunction validateJobTimes(\n\tstartTime: Date,\n\tendTime: Date,\n): {\n\tvalid: boolean;\n\terror?: string;\n} {\n\tif (startTime >= endTime) {\n\t\treturn {\n\t\t\tvalid: false,\n\t\t\terror: \"End time must be after start time\",\n\t\t};\n\t}\n\n\tconst duration = calculateDuration(startTime, endTime);\n\tif (duration < 15) {\n\t\treturn {\n\t\t\tvalid: false,\n\t\t\terror: \"Job must be at least 15 minutes long\",\n\t\t};\n\t}\n\n\treturn { valid: true };\n}\n\nfunction validateJob(job: Partial<Job>): {\n\tvalid: boolean;\n\terrors: string[];\n} {\n\tconst errors: string[] = [];\n\n\tif (!job.title || job.title.trim() === \"\") {\n\t\terrors.push(\"Title is required\");\n\t}\n\n\tconst hasTechnician =\n\t\t!!job.technicianId ||\n\t\tjob.assignments?.some((assignment) => assignment.technicianId);\n\n\tif (!hasTechnician) {\n\t\terrors.push(\"Technician must be assigned\");\n\t}\n\n\tif (!job.startTime) {\n\t\terrors.push(\"Start time is required\");\n\t}\n\n\tif (!job.endTime) {\n\t\terrors.push(\"End time is required\");\n\t}\n\n\tif (job.startTime && job.endTime) {\n\t\tconst timeValidation = validateJobTimes(job.startTime, job.endTime);\n\t\tif (!timeValidation.valid) {\n\t\t\terrors.push(timeValidation.error!);\n\t\t}\n\t}\n\n\treturn {\n\t\tvalid: errors.length === 0,\n\t\terrors,\n\t};\n}\n\nfunction jobHasTechnician(job: Job, technicianId: string): boolean {\n\tif (job.technicianId === technicianId) {\n\t\treturn true;\n\t}\n\n\treturn job.assignments.some(\n\t\t(assignment) => assignment.technicianId === technicianId,\n\t);\n}\n","\"use client\";\n\n/**\n * Route Optimization Panel\n *\n * Displays route optimization opportunities for technicians.\n * Uses Google Distance Matrix API to calculate optimal job order.\n * Features:\n * - Shows potential time/distance savings per technician\n * - One-click route optimization\n * - Before/after comparison\n */\n\nimport {\n\tArrowRight,\n\tCar,\n\tCheck,\n\tChevronDown,\n\tChevronRight,\n\tClock,\n\tMapPin,\n\tRoute,\n\tSparkles,\n\tTrendingDown,\n\tTrendingUp,\n\tTruck,\n\tZap,\n} from \"lucide-react\";\nimport { memo, useCallback, useState, useTransition } from \"react\";\nimport { toast } from \"sonner\";\nimport {\n\tapplyOptimizedRoute,\n\tgetDailyRouteOptimizations,\n\toptimizeTechnicianRoute,\n} from \"@/actions/route-optimization\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tCard,\n\tCardContent,\n\tCardDescription,\n\tCardHeader,\n\tCardTitle,\n} from \"@/components/ui/card\";\nimport {\n\tCollapsible,\n\tCollapsibleContent,\n\tCollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\nimport {\n\tSheet,\n\tSheetContent,\n\tSheetDescription,\n\tSheetHeader,\n\tSheetTitle,\n\tSheetTrigger,\n} from \"@/components/ui/sheet\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { cn } from \"@/lib/utils\";\nimport type { Job, Technician } from \"./schedule-types\";\n\n// ============================================================================\n// Types\n// ============================================================================\n\ntype RouteOptimizationResult = {\n\ttechnicianId: string;\n\ttechnicianName: string;\n\tjobCount: number;\n\toriginalOrder: string[];\n\toptimizedOrder: string[];\n\tsavings: {\n\t\ttimeSeconds: number;\n\t\tdistanceMeters: number;\n\t\tpercentImprovement: number;\n\t};\n\troute: Array<{\n\t\tjobId: string;\n\t\tjobTitle?: string;\n\t\tfromPrevious: {\n\t\t\tdurationSeconds: number;\n\t\t\tdistanceMeters: number;\n\t\t} | null;\n\t}>;\n};\n\ntype TechnicianOptimizationCardProps = {\n\ttechnicianId: string;\n\ttechnicianName: string;\n\tjobs: Job[];\n\tonOptimize: () => void;\n\tisOptimizing: boolean;\n\tresult: RouteOptimizationResult | null;\n\tonApply: () => void;\n\tisApplying: boolean;\n};\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nfunction formatDuration(seconds: number): string {\n\tconst minutes = Math.round(seconds / 60);\n\tif (minutes < 60) return `${minutes} min`;\n\tconst hours = Math.floor(minutes / 60);\n\tconst mins = minutes % 60;\n\treturn mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;\n}\n\nfunction formatDistance(meters: number): string {\n\tconst miles = meters / 1609.344;\n\treturn `${miles.toFixed(1)} mi`;\n}\n\n// ============================================================================\n// Technician Optimization Card\n// ============================================================================\n\nconst TechnicianOptimizationCard = memo(function TechnicianOptimizationCard({\n\ttechnicianId,\n\ttechnicianName,\n\tjobs,\n\tonOptimize,\n\tisOptimizing,\n\tresult,\n\tonApply,\n\tisApplying,\n}: TechnicianOptimizationCardProps) {\n\tconst [isExpanded, setIsExpanded] = useState(false);\n\tconst hasSavings = result && result.savings.timeSeconds > 0;\n\tconst initials = technicianName\n\t\t.split(\" \")\n\t\t.map((n) => n[0])\n\t\t.join(\"\")\n\t\t.toUpperCase();\n\n\treturn (\n\t\t<Card\n\t\t\tclassName={cn(\n\t\t\t\t\"transition-all\",\n\t\t\t\thasSavings && \"border-green-500/30 bg-green-500/5\",\n\t\t\t)}\n\t\t>\n\t\t\t<CardContent className=\"p-4\">\n\t\t\t\t{/* Header */}\n\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t\t<Avatar className=\"h-9 w-9\">\n\t\t\t\t\t\t\t<AvatarFallback className=\"bg-primary/10 text-primary text-xs font-semibold\">\n\t\t\t\t\t\t\t\t{initials}\n\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div className=\"font-medium\">{technicianName}</div>\n\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\t\t\t{jobs.length} job{jobs.length !== 1 ? \"s\" : \"\"} scheduled\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Action buttons */}\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t{result ? (\n\t\t\t\t\t\t\thasSavings ? (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"bg-green-500/10 text-green-600\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<TrendingDown className=\"mr-1 h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\tSave {formatDuration(result.savings.timeSeconds)}\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tonClick={onApply}\n\t\t\t\t\t\t\t\t\t\tdisabled={isApplying}\n\t\t\t\t\t\t\t\t\t\tclassName=\"gap-1\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{isApplying ? (\n\t\t\t\t\t\t\t\t\t\t\t\"Applying...\"\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\tApply\n\t\t\t\t\t\t\t\t\t\t\t\t<Check className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<Badge variant=\"outline\" className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t\t\tAlready optimal\n\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\tonClick={onOptimize}\n\t\t\t\t\t\t\t\tdisabled={isOptimizing || jobs.length < 2}\n\t\t\t\t\t\t\t\tclassName=\"gap-1\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{isOptimizing ? (\n\t\t\t\t\t\t\t\t\t\"Calculating...\"\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t<Route className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\tOptimize\n\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Optimization Result */}\n\t\t\t\t{result && hasSavings && (\n\t\t\t\t\t<Collapsible open={isExpanded} onOpenChange={setIsExpanded}>\n\t\t\t\t\t\t<CollapsibleTrigger className=\"mt-3 flex w-full items-center justify-between rounded-md bg-muted/50 px-3 py-2 text-sm hover:bg-muted transition-colors\">\n\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t\tView optimized route details\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t{isExpanded ? (\n\t\t\t\t\t\t\t\t<ChevronDown className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<ChevronRight className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</CollapsibleTrigger>\n\n\t\t\t\t\t\t<CollapsibleContent className=\"mt-3 space-y-3\">\n\t\t\t\t\t\t\t{/* Savings Summary */}\n\t\t\t\t\t\t\t<div className=\"grid grid-cols-3 gap-3\">\n\t\t\t\t\t\t\t\t<div className=\"rounded-lg bg-muted/50 p-2.5 text-center\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center gap-1 text-green-600\">\n\t\t\t\t\t\t\t\t\t\t<Clock className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t{formatDuration(result.savings.timeSeconds)}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-xs\">Time saved</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"rounded-lg bg-muted/50 p-2.5 text-center\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center gap-1 text-green-600\">\n\t\t\t\t\t\t\t\t\t\t<Car className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t{formatDistance(result.savings.distanceMeters)}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\tDistance saved\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"rounded-lg bg-muted/50 p-2.5 text-center\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center gap-1 text-green-600\">\n\t\t\t\t\t\t\t\t\t\t<TrendingDown className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t{result.savings.percentImprovement}%\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-xs\">Improvement</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Route Order */}\n\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-xs font-medium uppercase tracking-wide\">\n\t\t\t\t\t\t\t\t\tOptimized Route Order\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"space-y-1.5\">\n\t\t\t\t\t\t\t\t\t{result.route.map((stop, idx) => {\n\t\t\t\t\t\t\t\t\t\tconst job = jobs.find((j) => j.id === stop.jobId);\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tkey={stop.jobId}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center gap-2 rounded-md bg-background/80 p-2 text-sm\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-primary/10 text-xs font-semibold text-primary\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{idx + 1}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"truncate font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{job?.customer?.name || \"Unknown\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground truncate text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{job?.location?.address?.street}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t{stop.fromPrevious && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground shrink-0 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Car className=\"mr-1 inline-block h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatDuration(stop.fromPrevious.durationSeconds)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</CollapsibleContent>\n\t\t\t\t\t</Collapsible>\n\t\t\t\t)}\n\n\t\t\t\t{/* Job list when not enough jobs */}\n\t\t\t\t{jobs.length < 2 && (\n\t\t\t\t\t<div className=\"text-muted-foreground mt-2 text-sm\">\n\t\t\t\t\t\tNeed at least 2 jobs to optimize route\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</CardContent>\n\t\t</Card>\n\t);\n});\n\n// ============================================================================\n// Main Panel Component\n// ============================================================================\n\ntype RouteOptimizationPanelProps = {\n\ttechnicians: Map<string, Technician>;\n\tjobsByTechnician: Map<string, Job[]>;\n\tselectedDate: Date;\n\tclassName?: string;\n};\n\nexport function RouteOptimizationPanel({\n\ttechnicians,\n\tjobsByTechnician,\n\tselectedDate,\n\tclassName,\n}: RouteOptimizationPanelProps) {\n\tconst [isPending, startTransition] = useTransition();\n\tconst [optimizingTechId, setOptimizingTechId] = useState<string | null>(null);\n\tconst [applyingTechId, setApplyingTechId] = useState<string | null>(null);\n\tconst [results, setResults] = useState<Map<string, RouteOptimizationResult>>(\n\t\tnew Map(),\n\t);\n\n\t// Filter technicians with 2+ jobs\n\tconst techsWithJobs = Array.from(technicians.values())\n\t\t.map((tech) => ({\n\t\t\ttech,\n\t\t\tjobs: jobsByTechnician.get(tech.id) || [],\n\t\t}))\n\t\t.filter(({ jobs }) => jobs.length > 0)\n\t\t.sort((a, b) => b.jobs.length - a.jobs.length);\n\n\tconst techsToOptimize = techsWithJobs.filter(({ jobs }) => jobs.length >= 2);\n\tconst totalPotentialSavings = Array.from(results.values()).reduce(\n\t\t(acc, r) => acc + r.savings.timeSeconds,\n\t\t0,\n\t);\n\n\t// Optimize single technician route\n\tconst handleOptimizeTechnician = useCallback(\n\t\t(techId: string, jobs: Job[]) => {\n\t\t\tsetOptimizingTechId(techId);\n\n\t\t\tstartTransition(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst jobInputs = jobs.map((j) => ({\n\t\t\t\t\t\tid: j.id,\n\t\t\t\t\t\ttitle: j.title,\n\t\t\t\t\t\tlocation: {\n\t\t\t\t\t\t\taddress: j.location?.address\n\t\t\t\t\t\t\t\t? `${j.location.address.street}, ${j.location.address.city}, ${j.location.address.state}`\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\tlatitude: j.location?.coordinates?.lat,\n\t\t\t\t\t\t\tlongitude: j.location?.coordinates?.lng,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tscheduledStart: j.startTime,\n\t\t\t\t\t\tscheduledEnd: j.endTime,\n\t\t\t\t\t}));\n\n\t\t\t\t\tconst result = await optimizeTechnicianRoute(techId, jobInputs);\n\n\t\t\t\t\tif (result.success && result.data) {\n\t\t\t\t\t\tconst tech = technicians.get(techId);\n\t\t\t\t\t\tsetResults((prev) => {\n\t\t\t\t\t\t\tconst newMap = new Map(prev);\n\t\t\t\t\t\t\tnewMap.set(techId, {\n\t\t\t\t\t\t\t\ttechnicianId: techId,\n\t\t\t\t\t\t\t\ttechnicianName: tech?.name || \"Technician\",\n\t\t\t\t\t\t\t\tjobCount: jobs.length,\n\t\t\t\t\t\t\t\toriginalOrder: jobs.map((j) => j.id),\n\t\t\t\t\t\t\t\toptimizedOrder: result.data!.optimizedOrder,\n\t\t\t\t\t\t\t\tsavings: result.data!.savings,\n\t\t\t\t\t\t\t\troute: result.data!.route.map((r) => ({\n\t\t\t\t\t\t\t\t\t...r,\n\t\t\t\t\t\t\t\t\tjobTitle: jobs.find((j) => j.id === r.jobId)?.title,\n\t\t\t\t\t\t\t\t})),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn newMap;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (result.data.savings.timeSeconds > 0) {\n\t\t\t\t\t\t\ttoast.success(\n\t\t\t\t\t\t\t\t`Found ${formatDuration(result.data.savings.timeSeconds)} potential savings!`,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttoast.info(\"Route is already optimal\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoast.error(result.error || \"Failed to optimize route\");\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(\"Route optimization error:\", error);\n\t\t\t\t\ttoast.error(\"Failed to calculate optimal route\");\n\t\t\t\t} finally {\n\t\t\t\t\tsetOptimizingTechId(null);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t[technicians],\n\t);\n\n\t// Apply optimized route\n\tconst handleApplyRoute = useCallback(\n\t\t(techId: string) => {\n\t\t\tconst result = results.get(techId);\n\t\t\tif (!result) return;\n\n\t\t\tsetApplyingTechId(techId);\n\n\t\t\tstartTransition(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst applyResult = await applyOptimizedRoute(\n\t\t\t\t\t\ttechId,\n\t\t\t\t\t\tresult.originalOrder,\n\t\t\t\t\t\tresult.optimizedOrder,\n\t\t\t\t\t);\n\n\t\t\t\t\tif (applyResult.success) {\n\t\t\t\t\t\ttoast.success(\"Route optimized and applied!\", {\n\t\t\t\t\t\t\tdescription: `Saved ${formatDuration(result.savings.timeSeconds)} travel time`,\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// Clear the result since it's been applied\n\t\t\t\t\t\tsetResults((prev) => {\n\t\t\t\t\t\t\tconst newMap = new Map(prev);\n\t\t\t\t\t\t\tnewMap.delete(techId);\n\t\t\t\t\t\t\treturn newMap;\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoast.error(applyResult.error || \"Failed to apply route\");\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(\"Apply route error:\", error);\n\t\t\t\t\ttoast.error(\"Failed to apply optimized route\");\n\t\t\t\t} finally {\n\t\t\t\t\tsetApplyingTechId(null);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t[results],\n\t);\n\n\t// Optimize all technicians\n\tconst handleOptimizeAll = useCallback(async () => {\n\t\tfor (const { tech, jobs } of techsToOptimize) {\n\t\t\tif (!results.has(tech.id)) {\n\t\t\t\tawait handleOptimizeTechnician(tech.id, jobs);\n\t\t\t}\n\t\t}\n\t}, [techsToOptimize, results, handleOptimizeTechnician]);\n\n\treturn (\n\t\t<div className={cn(\"flex flex-col gap-4\", className)}>\n\t\t\t{/* Header */}\n\t\t\t<div className=\"space-y-2\">\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<Route className=\"text-primary h-5 w-5\" />\n\t\t\t\t\t<h3 className=\"text-lg font-semibold\">Route Optimization</h3>\n\t\t\t\t</div>\n\t\t\t\t<p className=\"text-muted-foreground text-sm\">\n\t\t\t\t\tOptimize technician routes to minimize travel time and fuel costs\n\t\t\t\t</p>\n\t\t\t</div>\n\n\t\t\t{/* Summary */}\n\t\t\t{totalPotentialSavings > 0 && (\n\t\t\t\t<Card className=\"border-green-500/30 bg-green-500/5\">\n\t\t\t\t\t<CardContent className=\"flex items-center justify-between p-4\">\n\t\t\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t\t\t<div className=\"rounded-full bg-green-500/20 p-2\">\n\t\t\t\t\t\t\t\t<Zap className=\"h-5 w-5 text-green-600\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div className=\"font-semibold text-green-700 dark:text-green-400\">\n\t\t\t\t\t\t\t\t\t{formatDuration(totalPotentialSavings)} potential savings\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\t\t\t\tAcross {results.size} technician\n\t\t\t\t\t\t\t\t\t{results.size !== 1 ? \"s\" : \"\"}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\tfor (const [techId] of results) {\n\t\t\t\t\t\t\t\t\thandleApplyRoute(techId);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tdisabled={isPending}\n\t\t\t\t\t\t\tclassName=\"gap-2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tApply All\n\t\t\t\t\t\t\t<Check className=\"h-4 w-4\" />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t)}\n\n\t\t\t{/* Optimize All Button */}\n\t\t\t{techsToOptimize.length > 0 && results.size < techsToOptimize.length && (\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\tonClick={handleOptimizeAll}\n\t\t\t\t\tdisabled={isPending}\n\t\t\t\t\tclassName=\"gap-2\"\n\t\t\t\t>\n\t\t\t\t\t<Sparkles className=\"h-4 w-4\" />\n\t\t\t\t\tCalculate All Routes ({techsToOptimize.length - results.size}{\" \"}\n\t\t\t\t\tremaining)\n\t\t\t\t</Button>\n\t\t\t)}\n\n\t\t\t{/* Technician Cards */}\n\t\t\t<div className=\"space-y-3\">\n\t\t\t\t{techsWithJobs.length === 0 ? (\n\t\t\t\t\t<Card>\n\t\t\t\t\t\t<CardContent className=\"flex flex-col items-center justify-center p-8 text-center\">\n\t\t\t\t\t\t\t<Truck className=\"text-muted-foreground/50 mb-4 h-12 w-12\" />\n\t\t\t\t\t\t\t<p className=\"font-medium\">No jobs scheduled</p>\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\t\t\tRoute optimization is available when technicians have jobs\n\t\t\t\t\t\t\t\tassigned\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</CardContent>\n\t\t\t\t\t</Card>\n\t\t\t\t) : (\n\t\t\t\t\ttechsWithJobs.map(({ tech, jobs }) => (\n\t\t\t\t\t\t<TechnicianOptimizationCard\n\t\t\t\t\t\t\tkey={tech.id}\n\t\t\t\t\t\t\ttechnicianId={tech.id}\n\t\t\t\t\t\t\ttechnicianName={tech.name}\n\t\t\t\t\t\t\tjobs={jobs}\n\t\t\t\t\t\t\tonOptimize={() => handleOptimizeTechnician(tech.id, jobs)}\n\t\t\t\t\t\t\tisOptimizing={optimizingTechId === tech.id}\n\t\t\t\t\t\t\tresult={results.get(tech.id) || null}\n\t\t\t\t\t\t\tonApply={() => handleApplyRoute(tech.id)}\n\t\t\t\t\t\t\tisApplying={applyingTechId === tech.id}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))\n\t\t\t\t)}\n\t\t\t</div>\n\n\t\t\t{/* Info */}\n\t\t\t<div className=\"text-muted-foreground rounded-lg border border-dashed p-3 text-xs\">\n\t\t\t\t<div className=\"flex items-start gap-2\">\n\t\t\t\t\t<MapPin className=\"mt-0.5 h-4 w-4 shrink-0\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p className=\"font-medium\">How it works</p>\n\t\t\t\t\t\t<p className=\"mt-1\">\n\t\t\t\t\t\t\tRoute optimization uses the Google Distance Matrix API to\n\t\t\t\t\t\t\tcalculate the most efficient order for technician visits, reducing\n\t\t\t\t\t\t\ttravel time and fuel costs while keeping your team on schedule.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n// ============================================================================\n// Sheet Wrapper\n// ============================================================================\n\ntype RouteOptimizationSheetProps = {\n\ttechnicians: Map<string, Technician>;\n\tjobsByTechnician: Map<string, Job[]>;\n\tselectedDate: Date;\n\ttrigger?: React.ReactNode;\n};\n\nexport function RouteOptimizationSheet({\n\ttechnicians,\n\tjobsByTechnician,\n\tselectedDate,\n\ttrigger,\n}: RouteOptimizationSheetProps) {\n\tconst [open, setOpen] = useState(false);\n\n\tconst techsWithMultipleJobs = Array.from(technicians.values()).filter(\n\t\t(tech) => {\n\t\t\tconst jobs = jobsByTechnician.get(tech.id) || [];\n\t\t\treturn jobs.length >= 2;\n\t\t},\n\t).length;\n\n\treturn (\n\t\t<Sheet open={open} onOpenChange={setOpen}>\n\t\t\t<SheetTrigger asChild>\n\t\t\t\t{trigger || (\n\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\tclassName=\"gap-1.5\"\n\t\t\t\t\t\t\t\tdisabled={techsWithMultipleJobs === 0}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Route className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t<span className=\"hidden sm:inline\">Optimize Routes</span>\n\t\t\t\t\t\t\t\t{techsWithMultipleJobs > 0 && (\n\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"ml-1 h-5 px-1.5 text-xs\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{techsWithMultipleJobs}\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t{techsWithMultipleJobs > 0\n\t\t\t\t\t\t\t\t? `Optimize routes for ${techsWithMultipleJobs} technician${techsWithMultipleJobs !== 1 ? \"s\" : \"\"}`\n\t\t\t\t\t\t\t\t: \"Need technicians with 2+ jobs to optimize\"}\n\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t)}\n\t\t\t</SheetTrigger>\n\t\t\t<SheetContent className=\"w-full overflow-y-auto sm:max-w-lg\">\n\t\t\t\t<SheetHeader className=\"sr-only\">\n\t\t\t\t\t<SheetTitle>Route Optimization</SheetTitle>\n\t\t\t\t\t<SheetDescription>\n\t\t\t\t\t\tOptimize technician routes to minimize travel time\n\t\t\t\t\t</SheetDescription>\n\t\t\t\t</SheetHeader>\n\t\t\t\t<RouteOptimizationPanel\n\t\t\t\t\ttechnicians={technicians}\n\t\t\t\t\tjobsByTechnician={jobsByTechnician}\n\t\t\t\t\tselectedDate={selectedDate}\n\t\t\t\t/>\n\t\t\t</SheetContent>\n\t\t</Sheet>\n\t);\n}\n\nexport default RouteOptimizationPanel;\n","/* __next_internal_action_entry_do_not_use__ [{\"709ff518b423ff85ccdab8fd8c525866ab7c2e1e84\":\"applyOptimizedRoute\"},\"apps/web/src/actions/route-optimization.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var applyOptimizedRoute=/*#__PURE__*/createServerReference(\"709ff518b423ff85ccdab8fd8c525866ab7c2e1e84\",callServer,void 0,findSourceMapURL,\"applyOptimizedRoute\");","/* __next_internal_action_entry_do_not_use__ [{\"700bf3a7c25407ce7fad3c374625a5f2d9a161744c\":\"optimizeTechnicianRoute\"},\"apps/web/src/actions/route-optimization.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var optimizeTechnicianRoute=/*#__PURE__*/createServerReference(\"700bf3a7c25407ce7fad3c374625a5f2d9a161744c\",callServer,void 0,findSourceMapURL,\"optimizeTechnicianRoute\");","\"use client\";\n\nimport {\n\taddDays,\n\taddMonths,\n\taddWeeks,\n\tformat,\n\tisToday,\n\tstartOfWeek,\n} from \"date-fns\";\nimport {\n\tCalendar as CalendarIcon,\n\tChevronDown,\n\tClock,\n\tSparkles,\n} from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useScheduleViewStore } from \"@/lib/stores/schedule-view-store\";\nimport { cn } from \"@/lib/utils\";\n\n// Quick jump options\nconst getQuickJumpOptions = (viewMode: string) => {\n\tconst today = new Date();\n\n\tif (viewMode === \"month\") {\n\t\treturn [\n\t\t\t{ label: \"This Month\", date: today },\n\t\t\t{ label: \"Next Month\", date: addMonths(today, 1) },\n\t\t\t{ label: \"In 2 Months\", date: addMonths(today, 2) },\n\t\t];\n\t}\n\n\tif (viewMode === \"week\") {\n\t\treturn [\n\t\t\t{ label: \"This Week\", date: startOfWeek(today) },\n\t\t\t{ label: \"Next Week\", date: addWeeks(today, 1) },\n\t\t\t{ label: \"In 2 Weeks\", date: addWeeks(today, 2) },\n\t\t];\n\t}\n\n\treturn [\n\t\t{ label: \"Today\", date: today },\n\t\t{ label: \"Tomorrow\", date: addDays(today, 1) },\n\t\t{ label: \"Next Week\", date: addWeeks(today, 1) },\n\t];\n};\n\nexport function ScheduleToolbarTitle() {\n\tconst [mounted, setMounted] = useState(false);\n\tconst [isOpen, setIsOpen] = useState(false);\n\tconst { currentDate, setCurrentDate, viewMode } = useScheduleViewStore();\n\n\tuseEffect(() => {\n\t\tsetMounted(true);\n\t}, []);\n\n\tconst dateObj =\n\t\tcurrentDate instanceof Date ? currentDate : new Date(currentDate);\n\n\tconst getDateFormat = () => {\n\t\tswitch (viewMode) {\n\t\t\tcase \"month\":\n\t\t\t\treturn format(dateObj, \"MMMM yyyy\");\n\t\t\tcase \"week\":\n\t\t\t\treturn format(dateObj, \"MMM dd, yyyy\");\n\t\t\tdefault:\n\t\t\t\treturn format(dateObj, \"EEEE, MMMM dd, yyyy\");\n\t\t}\n\t};\n\n\tconst quickJumpOptions = getQuickJumpOptions(viewMode);\n\tconst showTodayBadge = isToday(dateObj);\n\n\tif (!mounted) {\n\t\treturn <div className=\"bg-muted h-8 w-[220px] rounded-md\" />;\n\t}\n\n\treturn (\n\t\t<Popover open={isOpen} onOpenChange={setIsOpen}>\n\t\t\t<PopoverTrigger asChild>\n\t\t\t\t<button\n\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\"group flex items-center gap-2 rounded-md px-2 py-1.5 transition-colors\",\n\t\t\t\t\t\t\"hover:bg-accent/50\",\n\t\t\t\t\t)}\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t>\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<span className=\"text-foreground text-xl font-semibold tracking-tight\">\n\t\t\t\t\t\t\t{getDateFormat()}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t{showTodayBadge && (\n\t\t\t\t\t\t\t<span className=\"bg-primary/10 text-primary rounded-full px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide\">\n\t\t\t\t\t\t\t\tToday\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<ChevronDown\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"text-muted-foreground size-4 transition-transform\",\n\t\t\t\t\t\t\tisOpen && \"rotate-180\",\n\t\t\t\t\t\t)}\n\t\t\t\t\t/>\n\t\t\t\t</button>\n\t\t\t</PopoverTrigger>\n\t\t\t<PopoverContent align=\"start\" className=\"w-auto p-0\">\n\t\t\t\t{/* Quick Jump Header */}\n\t\t\t\t<div className=\"border-b p-3\">\n\t\t\t\t\t<div className=\"mb-2 flex items-center gap-2\">\n\t\t\t\t\t\t<Sparkles className=\"text-primary size-3.5\" />\n\t\t\t\t\t\t<span className=\"text-xs font-medium\">Quick Jump</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex gap-1.5\">\n\t\t\t\t\t\t{quickJumpOptions.map((option) => (\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tkey={option.label}\n\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\tclassName=\"h-7 text-xs\"\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tsetCurrentDate(option.date);\n\t\t\t\t\t\t\t\t\tsetIsOpen(false);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{option.label}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Calendar */}\n\t\t\t\t<Calendar\n\t\t\t\t\tinitialFocus\n\t\t\t\t\tmode=\"single\"\n\t\t\t\t\tonSelect={(newDate) => {\n\t\t\t\t\t\tif (newDate) {\n\t\t\t\t\t\t\tsetCurrentDate(newDate);\n\t\t\t\t\t\t\tsetIsOpen(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tselected={dateObj}\n\t\t\t\t\tclassName=\"p-3\"\n\t\t\t\t\tmodifiers={{\n\t\t\t\t\t\ttoday: new Date(),\n\t\t\t\t\t}}\n\t\t\t\t\tmodifiersClassNames={{\n\t\t\t\t\t\ttoday: \"bg-primary text-primary-foreground\",\n\t\t\t\t\t}}\n\t\t\t\t/>\n\n\t\t\t\t<Separator />\n\n\t\t\t\t{/* Current time indicator */}\n\t\t\t\t<div className=\"flex items-center justify-between px-3 py-2\">\n\t\t\t\t\t<div className=\"text-muted-foreground flex items-center gap-1.5 text-xs\">\n\t\t\t\t\t\t<Clock className=\"size-3\" />\n\t\t\t\t\t\t<span>Current time: {format(new Date(), \"h:mm a\")}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\tclassName=\"h-6 text-xs\"\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tsetCurrentDate(new Date());\n\t\t\t\t\t\t\tsetIsOpen(false);\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\tGo to now\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</PopoverContent>\n\t\t</Popover>\n\t);\n}\n"],"names":[],"mappings":"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"}