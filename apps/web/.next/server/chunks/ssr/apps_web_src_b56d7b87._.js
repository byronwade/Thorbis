module.exports=[468748,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call POSystemToggle() from the server but POSystemToggle is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/settings/po-system-toggle.tsx <module evaluation>","POSystemToggle");a.s(["POSystemToggle",0,b])},224664,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call POSystemToggle() from the server but POSystemToggle is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/settings/po-system-toggle.tsx","POSystemToggle");a.s(["POSystemToggle",0,b])},580255,a=>{"use strict";a.i(468748);var b=a.i(224664);a.n(b)},440660,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call SettingsSearch() from the server but SettingsSearch is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/settings/settings-search.tsx <module evaluation>","SettingsSearch");a.s(["SettingsSearch",0,b])},176537,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call SettingsSearch() from the server but SettingsSearch is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/settings/settings-search.tsx","SettingsSearch");a.s(["SettingsSearch",0,b])},503649,a=>{"use strict";a.i(440660);var b=a.i(176537);a.n(b)},900519,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call SettingsQuickActions() from the server but SettingsQuickActions is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/settings/settings-quick-actions.tsx <module evaluation>","SettingsQuickActions");a.s(["SettingsQuickActions",0,b])},349550,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call SettingsQuickActions() from the server but SettingsQuickActions is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/settings/settings-quick-actions.tsx","SettingsQuickActions");a.s(["SettingsQuickActions",0,b])},813245,a=>{"use strict";a.i(900519);var b=a.i(349550);a.n(b)},442884,a=>{"use strict";var b=a.i(504348),c=a.i(208768),d=a.i(102688),e=a.i(26291),f=a.i(359732),g=a.i(770414),h=a.i(382865);function i(a,b){let c=(0,h.toDate)(a)-(0,h.toDate)(b);return c<0?-1:c>0?1:c}var j=a.i(118489),k=a.i(465807),l=a.i(429969),m=a.i(580255),n=a.i(503649),o=a.i(835475),p=a.i(543474);let q=(0,p.default)("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var r=a.i(239258),s=a.i(8868);a.i(174010);var t=a.i(705991);function u(a){return"number"!=typeof a||Number.isNaN(a)?0:a===1/0?100:Math.min(100,Math.max(0,Math.round(a)))}function v(a){let b=u(a);return b>=85?"ready":b>=50?"warning":"danger"}function w(a){switch(a){case"ready":return"Fully configured";case"warning":return"Needs attention";case"danger":return"Action required";default:return"Unknown status"}}function x(a){switch(a){case"ready":return{text:"text-success",background:"bg-success/10",border:"border-success/50"};case"warning":return{text:"text-warning",background:"bg-warning/10",border:"border-warning/50"};default:return{text:"text-destructive",background:"bg-destructive/10",border:"border-destructive/50"}}}function y(a,b){return b<=0?0:u(a/b*100)}function z(a){if("number"!=typeof a||Number.isNaN(a)||0===a)return"0%";let b=Math.abs(Math.round(a));return`${a>0?"+":"-"}${b}%`}var A=a.i(828472);function B({metric:a}){let c=a.status?x(a.status):null;return(0,b.jsx)(t.Card,{className:"border-muted-foreground/20 h-full",children:(0,b.jsxs)(t.CardContent,{className:"space-y-2 pt-6",children:[(0,b.jsx)("p",{className:"text-muted-foreground text-xs font-medium tracking-wide uppercase",children:a.label}),(0,b.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,b.jsx)("span",{className:"text-2xl font-semibold tracking-tight",children:a.value}),"number"==typeof a.trend&&(0,b.jsx)("span",{className:(0,A.cn)("text-xs font-medium",a.trend>=0?"text-success":"text-destructive"),children:z(a.trend)})]}),a.helper&&(0,b.jsx)("p",{className:"text-muted-foreground text-sm leading-relaxed",children:a.helper}),a.status&&(0,b.jsx)("span",{className:(0,A.cn)("inline-flex items-center rounded-full border px-2 py-0.5 text-xs font-medium",c?.text,c?.border,c?.background),children:w(a.status)})]})})}var C=a.i(813245);a.i(502549);var D=a.i(236433);function E({section:a}){let c=x(a.status);return(0,b.jsxs)("section",{className:"scroll-mt-28 space-y-5",id:a.slug,children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"bg-primary/10 rounded-2xl p-3",children:(0,b.jsx)(a.icon,{className:"text-primary size-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-semibold tracking-tight",children:a.title}),(0,b.jsx)("p",{className:"text-muted-foreground",children:a.description})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Health"}),(0,b.jsx)("p",{className:(0,A.cn)("font-semibold",c.text),children:w(a.status)})]})]}),(0,b.jsxs)(t.Card,{className:"border-muted-foreground/30",children:[(0,b.jsxs)(t.CardHeader,{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)(t.CardTitle,{children:"Configuration summary"}),(0,b.jsx)(t.CardDescription,{children:a.summary})]}),(0,b.jsxs)("div",{className:"min-w-[180px]",children:[(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Completion"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("span",{className:"text-3xl font-semibold",children:[a.progress,"%"]}),(0,b.jsx)(D.Progress,{className:"h-2 flex-1",value:a.progress})]})]})]}),a.quickActions.length>0&&(0,b.jsx)(t.CardFooter,{className:"flex flex-wrap gap-2",children:(0,b.jsx)(C.SettingsQuickActions,{actions:a.quickActions,section:a.slug})})]}),a.metrics.length>0&&(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:a.metrics.map(c=>(0,b.jsx)(B,{metric:c},`${a.slug}-${c.key}`))}),a.checklist.length>0&&(0,b.jsxs)(t.Card,{className:"border-dashed",children:[(0,b.jsxs)(t.CardHeader,{children:[(0,b.jsx)(t.CardTitle,{className:"text-base",children:"Next best actions"}),(0,b.jsx)(t.CardDescription,{children:"Quick tasks to improve this area"})]}),(0,b.jsx)(t.CardContent,{children:(0,b.jsx)("ul",{className:"space-y-3",children:a.checklist.map(a=>(0,b.jsxs)("li",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"pt-0.5",children:a.completed?(0,b.jsx)(o.CheckCircle2,{className:"text-success size-4"}):(0,b.jsx)(q,{className:"text-muted-foreground size-4"})}),(0,b.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)(s.default,{className:"text-foreground hover:text-primary text-sm font-medium",href:a.href,children:a.label}),!a.completed&&(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:w("warning")})]}),a.helper&&(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:a.helper})]})]},a.key))})})]}),a.links.length>0&&(0,b.jsxs)(t.Card,{children:[(0,b.jsxs)(t.CardHeader,{children:[(0,b.jsx)(t.CardTitle,{className:"text-base",children:"Deep links"}),(0,b.jsx)(t.CardDescription,{children:"Jump directly into detailed settings pages"})]}),(0,b.jsx)(t.CardContent,{className:"grid gap-3 md:grid-cols-2",children:a.links.map(a=>(0,b.jsxs)(s.default,{className:"group hover:border-primary flex items-start justify-between rounded-xl border px-4 py-3 transition",href:a.href,children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.title}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:a.description})]}),(0,b.jsx)(r.ExternalLink,{className:"text-muted-foreground group-hover:text-primary mt-1 size-4 transition"})]},a.href))})]})]})}a.i(150644);var F=a.i(236028);function G({sections:a,children:c}){return a.length<=1?(0,b.jsx)("div",{className:"space-y-12",children:c}):(0,b.jsxs)("div",{className:"space-y-10",children:[(0,b.jsxs)("div",{className:"bg-card/90 rounded-2xl border p-4 shadow-sm",children:[(0,b.jsx)("div",{className:"flex items-center justify-between gap-3",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground text-xs font-semibold tracking-wide uppercase",children:"Settings clusters"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Jump between areas without leaving the page"})]})}),(0,b.jsx)("nav",{"aria-label":"Settings clusters",className:"mt-4 flex gap-3 overflow-x-auto pb-2",children:a.map(a=>{let c=x(a.status);return(0,b.jsx)(s.default,{className:"group hover:border-primary/60 hover:bg-muted/50 focus-visible:ring-primary min-w-[180px] flex-1 rounded-2xl border px-4 py-3 transition focus-visible:ring-2 focus-visible:outline-none",href:`#${a.slug}`,children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"bg-muted rounded-lg border p-1",children:(0,b.jsx)(a.icon,{className:"text-primary size-4"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:a.title}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:w(a.status)})]})]}),(0,b.jsxs)(F.Badge,{className:(0,A.cn)("text-xs font-semibold",c.text,c.background,c.border),variant:"outline",children:[a.progress,"%"]})]})},a.slug)})})]}),(0,b.jsx)("div",{className:"space-y-12",children:c})]})}a.i(467361);var H=a.i(445074);a.i(262820);var I=a.i(883385),J=a.i(136874),K=a.i(784036),L=a.i(946445),M=a.i(977073),N=a.i(736983);let O=(0,p.default)("settings-2",[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);var P=a.i(676001),Q=a.i(853208);let R=[{slug:"account",title:"Account",description:"Personal identity, authentication, preferences, and alerts",icon:P.User,supabaseSources:["users","profiles","user_preferences","user_notification_preferences"],links:[{title:"Personal Information",description:"Name, avatar, and verified contact details",href:"/dashboard/settings/profile/personal",supabaseSources:["users","profiles"]},{title:"Security",description:"Passwords, device logins, and 2FA",href:"/dashboard/settings/profile/security",supabaseSources:["users"]},{title:"Notifications",description:"Email, push, SMS, and digest cadence",href:"/dashboard/settings/profile/notifications",supabaseSources:["user_notification_preferences"]},{title:"Preferences",description:"Theme, timezone, language, and UI density",href:"/dashboard/settings/profile/preferences",supabaseSources:["user_preferences"]}]},{slug:"workspace",title:"Workspace",description:"Company identity, subscription, and team governance",icon:L.Building2,supabaseSources:["companies","company_settings","team_members","team_invitations","departments","custom_roles","api_keys","tags","lead_sources"],links:[{title:"Company Profile",description:"Legal details, branding, and public contact info",href:"/dashboard/settings/company",supabaseSources:["companies","company_settings"]},{title:"Billing & Subscription",description:"Plan, invoices, payment methods, and usage caps",href:"/dashboard/settings/billing",supabaseSources:["companies","invoices"]},{title:"Team & Permissions",description:"Members, invites, departments, and roles",href:"/dashboard/settings/team",supabaseSources:["team_members","team_invitations","custom_roles","departments"]},{title:"API Keys",description:"Machine-to-machine access and rate limits",href:"/dashboard/settings/integrations",supabaseSources:["api_keys"]},{title:"Tags & Lead Sources",description:"Taxonomy for routing, reporting, and attribution",href:"/dashboard/settings/tags",supabaseSources:["tags","lead_sources"]}]},{slug:"communications",title:"Communications",description:"Email, SMS, phone, voicemail, and notification defaults",icon:N.MessageSquare,supabaseSources:["communication_email_settings","communication_sms_settings","communication_phone_settings","communication_notification_settings","phone_numbers","call_logs","messaging_brands","messaging_campaigns","notification_queue","phone_porting_requests"],links:[{title:"Email Settings",description:"SMTP, signatures, open tracking, deliverability",href:"/dashboard/settings/communications/email",supabaseSources:["communication_email_settings"]},{title:"SMS & MMS",description:"Provider credentials, compliance, and auto-replies",href:"/dashboard/settings/communications/sms",supabaseSources:["communication_sms_settings"]},{title:"Phone System",description:"Routing, IVR, voicemail, recordings, and usage",href:"/dashboard/settings/communications/phone",supabaseSources:["communication_phone_settings","phone_numbers"]},{title:"Notification Defaults",description:"Job, customer, invoice, and queue health",href:"/dashboard/settings/communications/notifications",supabaseSources:["communication_notification_settings","notification_queue"]},{title:"10DLC & Compliance",description:"Messaging brand and campaign registration",href:"/dashboard/settings/communications/usage",supabaseSources:["messaging_brands","messaging_campaigns"]},{title:"Porting Status",description:"Track number port requests and SLAs",href:"/dashboard/settings/communications/porting-status",supabaseSources:["phone_porting_requests"]}]},{slug:"operations",title:"Operations",description:"Booking, scheduling, job workflows, and customer experiences",icon:O,supabaseSources:["job_settings","schedule_availability_settings","schedule_calendar_settings","schedule_dispatch_rules","schedule_team_rules","customer_portal_settings","customer_intake_settings","customer_loyalty_settings"],links:[{title:"Booking Rules",description:"Availability windows, buffers, and automation",href:"/dashboard/settings/booking",supabaseSources:["schedule_availability_settings"]},{title:"Job Configuration",description:"Job types, statuses, numbering, and completion requirements",href:"/dashboard/settings/jobs",supabaseSources:["job_settings"]},{title:"Customer Intake",description:"Lead capture, custom questions, and assignments",href:"/dashboard/settings/customer-intake",supabaseSources:["customer_intake_settings"]},{title:"Customer Portal",description:"Self-service access, branding, and feature toggles",href:"/dashboard/settings/customer-portal",supabaseSources:["customer_portal_settings"]},{title:"Scheduling",description:"Team rules, dispatch policies, calendar defaults",href:"/dashboard/settings/schedule",supabaseSources:["schedule_calendar_settings","schedule_dispatch_rules","schedule_team_rules"]},{title:"Loyalty & Rewards",description:"Points, rewards, and program notifications",href:"/dashboard/settings/customers/loyalty",supabaseSources:["customer_loyalty_settings"]}]},{slug:"finance",title:"Finance",description:"Accounting syncs, billing tools, payments, and capital",icon:M.CreditCard,supabaseSources:["finance_accounting_settings","finance_bookkeeping_settings","finance_bank_accounts","finance_virtual_bucket_settings","finance_virtual_buckets","finance_business_financing_settings","finance_consumer_financing_settings","finance_debit_cards","finance_gift_card_settings","finance_gift_cards","invoices","payments"],links:[{title:"Accounting Integrations",description:"QuickBooks, Xero, sync cadence, and mappings",href:"/dashboard/settings/finance/accounting",supabaseSources:["finance_accounting_settings"]},{title:"Bank Accounts",description:"Plaid connections, balances, and auto-import",href:"/dashboard/settings/finance/bank-accounts",supabaseSources:["finance_bank_accounts"]},{title:"Virtual Buckets",description:"Profit-first allocations and automation",href:"/dashboard/settings/finance/virtual-buckets",supabaseSources:["finance_virtual_bucket_settings","finance_virtual_buckets"]},{title:"Gift & Debit Cards",description:"Spend controls, expiration policies, redemption data",href:"/dashboard/settings/finance/gift-cards",supabaseSources:["finance_gift_card_settings","finance_gift_cards","finance_debit_cards"]},{title:"Payment Processors",description:"Adyen, Plaid, check deposits, and payout schedules",href:"/dashboard/settings/finance/payments",supabaseSources:["company_payment_processors","payout_schedules"]},{title:"Financing Programs",description:"Consumer and business financing eligibility",href:"/dashboard/settings/finance/business-financing",supabaseSources:["finance_business_financing_settings","finance_consumer_financing_settings"]}]},{slug:"integrations",title:"Integrations",description:"Connected apps, webhooks, supplier feeds, and API usage",icon:Q.Zap,supabaseSources:["supplier_integrations","api_keys","communication_sms_settings","finance_accounting_settings","finance_bank_accounts","webhooks","webhook_logs"],links:[{title:"Integration Hub",description:"View and manage all connected platforms",href:"/dashboard/settings/integrations",supabaseSources:["supplier_integrations","api_keys"]},{title:"QuickBooks",description:"Two-way sync, error monitoring, and sync logs",href:"/dashboard/settings/finance/accounting",supabaseSources:["finance_accounting_settings"]},{title:"Twilio & Communications",description:"Phone numbers, SMS campaigns, and 10DLC",href:"/dashboard/settings/communications/phone-numbers",supabaseSources:["phone_numbers","communication_sms_settings"]},{title:"Supplier Catalogs",description:"Automated pricebook imports and refreshes",href:"/dashboard/settings/pricebook/integrations",supabaseSources:["supplier_integrations"]},{title:"Webhooks & API access",description:"Keys, secrets, and delivery monitoring",href:"/dashboard/settings/development",supabaseSources:["api_keys","webhooks","webhook_logs"]}]},{slug:"analytics",title:"Analytics & Telemetry",description:"Usage insights, automation health, and alerting",icon:K.BarChart3,supabaseSources:["activities","notifications","call_logs","jobs","customers","invoices"],links:[{title:"Mission Control",description:"Unified KPIs for operations and growth",href:"/dashboard/mission-control",supabaseSources:["activities","jobs","customers"],tag:"beta"},{title:"Automation Runs",description:"Workflow throughput, failures, and retries",href:"/dashboard/settings/automation",supabaseSources:["activities"]},{title:"Usage & Limits",description:"Plan allocation, metering, and alert policies",href:"/dashboard/settings/subscriptions",supabaseSources:["activities","companies"]}],documentation:[{title:"Thorbis Analytics Framework",href:"/docs/ANALYTICS.md"},{title:"Event Taxonomy",href:"/docs/ANALYTICS.md#event-taxonomy"}]}];R.map(a=>[a.slug,a]);let S={generatedAt:new Date(0).toISOString(),company:null,companySettings:null,profile:null,userPreferences:null,userNotificationPreferences:null,communicationEmailSettings:null,communicationSmsSettings:null,communicationPhoneSettings:null,communicationNotificationSettings:null,jobSettings:null,scheduleAvailabilitySettings:null,scheduleCalendarSettings:null,accountingSettings:null,bookkeepingSettings:null,bankAccounts:[],virtualBucketSettings:null,businessFinancingSettings:null,consumerFinancingSettings:null,giftCardSettings:null,portalSettings:null,intakeSettings:null,loyaltySettings:null,messagingBrand:null,messagingCampaign:null,teamCounts:{active:0,pendingInvites:0},customRolesCount:0,apiKeysCount:0,phoneNumbersCount:0,departmentsCount:0,leadSourcesCount:0,tagsCount:0,debitCardsCount:0,giftCardsActiveCount:0,virtualBucketsCount:0,scheduleDispatchRulesCount:0,scheduleTeamRulesCount:0,supplierIntegrationsCount:0,jobsTotalCount:0,jobsWeekCount:0,customersCount:0,invoicesOpenCount:0,activitiesWeekCount:0,automationWeekCount:0,notificationsWeekCount:0,callLogsWeekCount:0,portingPendingCount:0,notificationQueuePendingCount:0,notificationQueueFailedCount:0,webhooksCount:0,webhookFailuresWeekCount:0},T=(0,l.cache)(async()=>{let a=await (0,J.createClient)();if(!a)return V(S);let b=await (0,I.requireUser)(),c=await (0,H.requireActiveCompany)();return V(await U(a,c,b.id))});async function U(a,b,c){try{let d=new Date().toISOString(),e=new Date;e.setDate(e.getDate()-7);let f=e.toISOString(),[g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,X,Y,Z,$,_,aa,ab]=await Promise.all([a.from("companies").select("id,name,logo,legal_name,phone,email,website,website_url,stripe_subscription_status,onboarding_step,onboarding_completed_at,subscription_cancel_at_period_end").eq("id",b).maybeSingle(),a.from("company_settings").select("company_id,company_feed_enabled,feed_visibility,service_area_type,po_system_enabled,po_system_last_enabled_at").eq("company_id",b).maybeSingle(),a.from("profiles").select("id,onboarding_completed").eq("id",c).maybeSingle(),a.from("user_preferences").select("user_id,timezone,theme,language,date_format,time_format,default_dashboard_view,default_page_size").eq("user_id",c).maybeSingle(),a.from("user_notification_preferences").select("user_id,email_new_jobs,email_job_updates,email_mentions,email_messages,push_new_jobs,push_job_updates,push_mentions,push_messages,sms_schedule_changes,sms_urgent_jobs,digest_enabled,digest_frequency,in_app_all").eq("user_id",c).maybeSingle(),a.from("communication_email_settings").select("company_id,smtp_enabled,smtp_host,smtp_from_email,auto_cc_enabled,default_signature,track_opens,track_clicks").eq("company_id",b).maybeSingle(),a.from("communication_sms_settings").select("company_id,provider,sender_number,auto_reply_enabled,auto_reply_message,opt_out_message,consent_required").eq("company_id",b).maybeSingle(),a.from("communication_phone_settings").select("company_id,routing_strategy,business_hours_only,fallback_number,voicemail_enabled,voicemail_email_notifications,recording_enabled,ivr_enabled").eq("company_id",b).maybeSingle(),a.from("communication_notification_settings").select("company_id,email_notifications,sms_notifications,push_notifications,in_app_notifications,notify_new_jobs,notify_job_updates,notify_invoice_overdue").eq("company_id",b).maybeSingle(),a.from("job_settings").select("company_id,default_job_status,auto_invoice_on_completion,require_customer_signature,require_completion_notes,track_technician_time,send_review_link_on_completion").eq("company_id",b).maybeSingle(),a.from("schedule_availability_settings").select("company_id,default_work_hours,default_appointment_duration_minutes,buffer_time_minutes,min_booking_notice_hours,max_booking_advance_days").eq("company_id",b).maybeSingle(),a.from("schedule_calendar_settings").select("company_id,default_view,start_day_of_week,time_slot_duration_minutes,show_technician_colors,sync_with_google_calendar,sync_with_outlook").eq("company_id",b).maybeSingle(),a.from("finance_accounting_settings").select("company_id,provider,provider_enabled,auto_sync_enabled,last_sync_at,sync_frequency,sync_invoices,sync_payments,sync_expenses,sync_customers").eq("company_id",b).maybeSingle(),a.from("finance_bookkeeping_settings").select("company_id,auto_categorize_transactions,auto_reconcile_payments,report_frequency,email_reports,report_recipients").eq("company_id",b).maybeSingle(),a.from("finance_bank_accounts").select("*").eq("company_id",b).eq("is_active",!0),a.from("finance_virtual_bucket_settings").select("company_id,virtual_buckets_enabled,auto_allocate_funds,allocation_frequency,operating_expenses_percentage,tax_reserve_percentage,profit_percentage,emergency_fund_percentage").eq("company_id",b).maybeSingle(),a.from("finance_business_financing_settings").select("company_id,enable_business_loans,enable_line_of_credit,enable_equipment_financing,financing_provider,auto_calculate_eligibility,show_offers_in_dashboard").eq("company_id",b).maybeSingle(),a.from("finance_consumer_financing_settings").select("company_id,financing_enabled,provider,min_amount,max_amount,available_terms,show_in_estimates,show_in_invoices,promote_financing").eq("company_id",b).maybeSingle(),a.from("finance_gift_card_settings").select("company_id,gift_cards_enabled,program_name,fixed_denominations,available_amounts,allow_online_purchase,allow_in_person_purchase,cards_expire,expiration_months").eq("company_id",b).maybeSingle(),a.from("customer_portal_settings").select("company_id,portal_enabled,allow_booking,allow_invoice_payment,allow_estimate_approval,show_service_history,welcome_message").eq("company_id",b).maybeSingle(),a.from("customer_intake_settings").select("company_id,require_phone,require_email,require_address,require_property_type,track_lead_source,auto_assign_technician,auto_create_job").eq("company_id",b).maybeSingle(),a.from("customer_loyalty_settings").select("company_id,loyalty_enabled,program_name,points_per_dollar_spent,auto_apply_rewards,notify_on_points_earned").eq("company_id",b).maybeSingle(),W(a,"team_members",a=>a.eq("company_id",b).eq("status","active")),W(a,"team_invitations",a=>a.eq("company_id",b).is("used_at",null).gt("expires_at",d)),W(a,"custom_roles",a=>a.eq("company_id",b).eq("is_active",!0)),W(a,"api_keys",a=>a.eq("company_id",b).is("revoked_at",null)),W(a,"phone_numbers",a=>a.eq("company_id",b).eq("status","active")),W(a,"finance_debit_cards",a=>a.eq("company_id",b).eq("is_active",!0)),W(a,"finance_gift_cards",a=>a.eq("company_id",b).eq("status","active")),W(a,"finance_virtual_buckets",a=>a.eq("company_id",b)),W(a,"supplier_integrations",a=>a.eq("company_id",b)),W(a,"schedule_dispatch_rules",a=>a.eq("company_id",b)),W(a,"schedule_team_rules",a=>a.eq("company_id",b)),W(a,"jobs",a=>a.eq("company_id",b)),W(a,"jobs",a=>a.eq("company_id",b).gte("created_at",f)),W(a,"customers",a=>a.eq("company_id",b)),W(a,"invoices",a=>a.eq("company_id",b).in("status",["open","overdue"])),W(a,"activities",a=>a.eq("company_id",b).gte("occurred_at",f)),W(a,"activities",a=>a.eq("company_id",b).eq("category","automation").gte("occurred_at",f)),W(a,"notifications",a=>a.eq("company_id",b).gte("created_at",f)),W(a,"call_logs",a=>a.eq("company_id",b).gte("created_at",f)),a.from("messaging_brands").select("id,company_id,status,telnyx_brand_id,legal_name,vertical,created_at,updated_at").eq("company_id",b).maybeSingle(),a.from("webhooks").select("id,active,created_at").eq("company_id",b),W(a,"phone_porting_requests",a=>a.eq("company_id",b).is("completed_at",null).is("cancelled_at",null)),W(a,"notification_queue",a=>a.eq("company_id",b).is("sent_at",null)),W(a,"notification_queue",a=>a.eq("company_id",b).eq("status","failed")),W(a,"departments",a=>a.eq("company_id",b)),W(a,"lead_sources",a=>a.eq("company_id",b)),W(a,"tags",a=>a.eq("company_id",b))]),ac=g.data,ad=h.data,ae=i.data,af=j.data,ag=k.data,ah=l.data,ai=m.data,aj=n.data,ak=o.data,al=p.data,am=q.data,an=r.data,ao=s.data,ap=t.data,aq=u.data??[],ar=v.data,as=w.data,at=x.data,au=y.data,av=z.data,aw=A.data,ax=B.data,ay=V.data,az=null;if(ay?.id){let{data:b}=await a.from("messaging_campaigns").select("id,status,usecase,telnyx_campaign_id,messaging_brand_id,created_at,updated_at").eq("messaging_brand_id",ay.id).order("created_at",{ascending:!1}).limit(1).maybeSingle();az=b??null}let aA=X.data??[],aB=aA.filter(a=>a.active).length,aC=0;if(aA.length>0){let b=aA.map(a=>a.id),{count:c}=await a.from("webhook_logs").select("id",{count:"exact",head:!0}).in("webhook_id",b).gte("created_at",f).or("response_status.gte.400,delivered_at.is.null");aC=c??0}return{generatedAt:d,company:ac??null,companySettings:ad??null,profile:ae??null,userPreferences:af??null,userNotificationPreferences:ag??null,communicationEmailSettings:ah??null,communicationSmsSettings:ai??null,communicationPhoneSettings:aj??null,communicationNotificationSettings:ak??null,jobSettings:al??null,scheduleAvailabilitySettings:am??null,scheduleCalendarSettings:an??null,accountingSettings:ao??null,bookkeepingSettings:ap??null,bankAccounts:aq??[],virtualBucketSettings:ar??null,businessFinancingSettings:as??null,consumerFinancingSettings:at??null,giftCardSettings:au??null,portalSettings:av??null,intakeSettings:aw??null,loyaltySettings:ax??null,messagingBrand:ay??null,messagingCampaign:az,teamCounts:{active:C??0,pendingInvites:D??0},customRolesCount:E??0,apiKeysCount:F??0,phoneNumbersCount:G??0,departmentsCount:_??0,leadSourcesCount:aa??0,tagsCount:ab??0,debitCardsCount:H??0,giftCardsActiveCount:I??0,virtualBucketsCount:J??0,scheduleDispatchRulesCount:L??0,scheduleTeamRulesCount:M??0,supplierIntegrationsCount:K??0,jobsTotalCount:N??0,jobsWeekCount:O??0,customersCount:P??0,invoicesOpenCount:Q??0,activitiesWeekCount:R??0,automationWeekCount:S??0,notificationsWeekCount:T??0,callLogsWeekCount:U??0,portingPendingCount:Y??0,notificationQueuePendingCount:Z??0,notificationQueueFailedCount:$??0,webhooksCount:aB,webhookFailuresWeekCount:aC}}catch{return{...S,generatedAt:new Date().toISOString()}}}function V(a){let b=R.map(b=>(function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;switch(a.slug){case"account":let q,r,s,t,x,A,B;return c=a,d=b,s=v(r=y((q=[!!d.profile?.onboarding_completed,!!d.userPreferences?.timezone,!!d.userNotificationPreferences?.email_new_jobs,!!d.userNotificationPreferences?.push_new_jobs]).filter(Boolean).length,q.length)),t=d.profile?.onboarding_completed&&r>=85?"Your personal account is fully configured.":"Finish personal details and notification channels to unlock all admin tools.",x=[d.userNotificationPreferences?.email_new_jobs,d.userNotificationPreferences?.push_new_jobs,d.userNotificationPreferences?.sms_urgent_jobs].filter(Boolean).length,A=[{key:"profile-completion",label:"Profile completion",value:`${r}%`,helper:w(s),status:s},{key:"notification-channels",label:"Notification channels",value:`${x}/3`,helper:"Email, push, SMS",status:x>=2?"ready":"warning"},{key:"timezone",label:"Timezone",value:d.userPreferences?.timezone??"Not set",helper:d.userPreferences?.language??"English",status:d.userPreferences?.timezone?"ready":"warning"}],B=[{key:"verify-email",label:"Verify login email",href:"/dashboard/settings/profile/personal",completed:!!d.profile?.onboarding_completed,supabaseSources:["profiles"]},{key:"notifications",label:"Enable at least two notification channels",href:"/dashboard/settings/profile/notifications",completed:x>=2,supabaseSources:["user_notification_preferences"]}],{slug:c.slug,title:c.title,description:c.description,icon:c.icon,progress:r,status:s,summary:t,metrics:A,checklist:B,quickActions:[{key:"personal",label:"Update personal info",href:"/dashboard/settings/profile/personal",analyticsEvent:"settings.quick_action.personal_info"},{key:"notifications",label:"Tune notifications",href:"/dashboard/settings/profile/notifications",variant:"outline",analyticsEvent:"settings.quick_action.notifications"}],links:c.links,documentation:c.documentation};case"workspace":let C,D,E,F,G,H,I,J,K,L;return e=a,f=b,D=y((C=[f.company?.legal_name,f.company?.phone,f.company?.website]).filter(Boolean).length,C.length),E=f.company?.stripe_subscription_status==="active"||f.company?.stripe_subscription_status==="trialing",F=f.departmentsCount>0,G=f.tagsCount>0&&f.leadSourcesCount>0,J=v(I=y((H=[D>=85,E,f.teamCounts.active>0,F,G]).filter(Boolean).length,H.length)),K=[{key:"team-members",label:"Active teammates",value:f.teamCounts.active.toString(),helper:`${f.teamCounts.pendingInvites} pending invite(s)`,status:f.teamCounts.active>0?"ready":"warning"},{key:"roles",label:"Custom roles",value:f.customRolesCount.toString(),helper:f.customRolesCount?"Granular access in place":"Using defaults",status:f.customRolesCount?"ready":"warning"},{key:"api-keys",label:"API keys",value:f.apiKeysCount.toString(),helper:"Machine integrations",status:f.apiKeysCount?"ready":"warning"},{key:"departments",label:"Departments",value:f.departmentsCount.toString(),helper:F?"Org chart structured":"No departments",status:F?"ready":"warning"},{key:"taxonomy",label:"Tags / lead sources",value:`${f.tagsCount}/${f.leadSourcesCount}`,helper:"Tags / sources",status:G?"ready":"warning"}],L=[{key:"company-profile",label:"Complete company profile",href:"/dashboard/settings/company",completed:D>=85,helper:"Legal name, phone, and website",supabaseSources:["companies","company_settings"]},{key:"billing",label:"Verify billing + plan",href:"/dashboard/settings/billing",completed:E,helper:f.company?.stripe_subscription_status??"unknown",supabaseSources:["companies","invoices"]},{key:"departments",label:"Map departments",href:"/dashboard/settings/team/departments",completed:F,helper:F?"Org chart defined":"No departments yet",supabaseSources:["departments"]},{key:"taxonomy",label:"Define tags & lead sources",href:"/dashboard/settings/tags",completed:G,helper:`${f.tagsCount} tags / ${f.leadSourcesCount} sources`,supabaseSources:["tags","lead_sources"]}],{slug:e.slug,title:e.title,description:e.description,icon:e.icon,progress:u(I),status:J,summary:E?G?"Workspace billing, team, and taxonomy are in good standing.":"Define tags and lead sources to improve attribution.":"Add a payment method to keep automations running.",metrics:K,checklist:L,quickActions:[{key:"invite",label:"Invite teammate",href:"/dashboard/settings/team/invite",analyticsEvent:"settings.quick_action.invite_teammate"},{key:"roles",label:"Manage roles",href:"/dashboard/settings/team/roles",variant:"outline",analyticsEvent:"settings.quick_action.manage_roles"}],links:e.links,documentation:e.documentation};case"communications":let M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_;return g=a,h=b,M=!!(h.communicationEmailSettings?.smtp_enabled&&h.communicationEmailSettings?.smtp_from_email),N=!!(h.communicationSmsSettings?.provider&&h.communicationSmsSettings?.sender_number),O=!!(h.communicationPhoneSettings?.routing_strategy&&h.phoneNumbersCount>0),P=["approved","active","verified","running"],Q=(a,b="Not configured")=>a?a.replace(/_/g," "):b,R=h.messagingBrand?.status??"",S=h.messagingCampaign?.status??"",T=P.includes(R.toLowerCase())?"ready":h.messagingBrand?"warning":"danger",X=v(W=y((V=[M,N,O,"ready"===T,"ready"==(U=P.includes(S.toLowerCase())?"ready":h.messagingCampaign?"warning":"danger")]).filter(Boolean).length,V.length)),Y="ready"===T&&"ready"===U&&W>=85?"Messaging compliance and channels are fully configured.":"Finish 10DLC registration and clear communication backlogs.",Z=h.notificationQueueFailedCount>0||h.notificationQueuePendingCount>10?"warning":"ready",$=[{key:"brand-status",label:"Messaging brand",value:Q(h.messagingBrand?.status,"Not registered"),helper:h.messagingBrand?.telnyx_brand_id?`Brand ID: ${h.messagingBrand.telnyx_brand_id}`:"10DLC verification required",status:T},{key:"campaign-status",label:"Campaign status",value:Q(h.messagingCampaign?.status,"No campaign"),helper:h.messagingCampaign?.usecase??"No use case assigned",status:U},{key:"phone-numbers",label:"Active numbers",value:h.phoneNumbersCount.toString(),helper:`${h.callLogsWeekCount} calls last 7d`,status:h.phoneNumbersCount?"ready":"warning"},{key:"notification-backlog",label:"Notification queue",value:h.notificationQueuePendingCount.toString(),helper:`${h.notificationQueueFailedCount} failed`,status:Z},{key:"porting-backlog",label:"Porting backlog",value:h.portingPendingCount.toString(),helper:"Open requests",status:h.portingPendingCount?"warning":"ready"}],_=[{key:"a2p-registration",label:"Complete 10DLC brand + campaign",href:"/dashboard/settings/communications/phone-numbers",completed:"ready"===T&&"ready"===U,supabaseSources:["messaging_brands","messaging_campaigns"]},{key:"smtp",label:"Connect SMTP or branded email",href:"/dashboard/settings/communications/email",completed:M,supabaseSources:["communication_email_settings"]},{key:"sms",label:"Provision messaging number",href:"/dashboard/settings/communications/sms",completed:N,supabaseSources:["communication_sms_settings"]},{key:"notification-queue",label:"Resolve notification failures",href:"/dashboard/settings/communications/notifications",completed:0===h.notificationQueueFailedCount,supabaseSources:["notification_queue"]},{key:"porting",label:"Clear porting backlog",href:"/dashboard/settings/communications/porting-status",completed:0===h.portingPendingCount,supabaseSources:["phone_porting_requests"]}],{slug:g.slug,title:g.title,description:g.description,icon:g.icon,progress:W,status:X,summary:Y,metrics:$,checklist:_,quickActions:[{key:"review-10dlc",label:"Review 10DLC status",href:"/dashboard/settings/communications/usage",analyticsEvent:"settings.quick_action.review_10dlc"},{key:"porting",label:"Open porting queue",href:"/dashboard/settings/communications/porting-status",analyticsEvent:"settings.quick_action.porting_queue"},{key:"email-template",label:"Edit email templates",href:"/dashboard/settings/communications/email-templates",variant:"outline",analyticsEvent:"settings.quick_action.email_template"}],links:g.links,documentation:g.documentation};case"operations":let aa,ab,ac,ad,ae,af,ag,ah,ai,aj;return i=a,aa=!!(j=b).scheduleAvailabilitySettings,ab=j.scheduleDispatchRulesCount>0,ac=!!j.portalSettings?.portal_enabled,ad=!!j.intakeSettings,ae=!!j.loyaltySettings?.loyalty_enabled,ah=v(ag=y((af=[aa,ab,ac,ad]).filter(Boolean).length,af.length)),ai=ag>=85?"Scheduling, portal, and workflows are dialed in.":"Tighten booking + dispatch rules to reduce slack time.",aj=[{key:"jobs-week",label:"Jobs created (7d)",value:j.jobsWeekCount.toString(),helper:`${j.jobsTotalCount} total`},{key:"dispatch-rules",label:"Dispatch rules",value:j.scheduleDispatchRulesCount.toString(),helper:j.scheduleTeamRulesCount?`${j.scheduleTeamRulesCount} team rules`:"No team overrides",status:j.scheduleDispatchRulesCount?"ready":"warning"},{key:"portal",label:"Customer portal",value:j.portalSettings?.portal_enabled?"Enabled":"Disabled",helper:j.portalSettings?.welcome_message?"Custom welcome":"Default copy",status:j.portalSettings?.portal_enabled?"ready":"warning"},{key:"intake",label:"Intake form",value:ad?"Customized":"Defaults",helper:j.intakeSettings?.auto_assign_technician?"Auto-assign on":"Manual triage",status:ad?"ready":"warning"},{key:"loyalty",label:"Loyalty program",value:ae?"Enabled":"Disabled",helper:j.loyaltySettings?.program_name??"No program",status:ae?"ready":"warning"}],{slug:i.slug,title:i.title,description:i.description,icon:i.icon,progress:ag,status:ah,summary:ai,metrics:aj,checklist:[{key:"booking",label:"Review booking rules",href:"/dashboard/settings/booking",completed:aa,supabaseSources:["schedule_availability_settings"]},{key:"dispatch",label:"Define dispatch automation",href:"/dashboard/settings/schedule/dispatch-rules",completed:ab,supabaseSources:["schedule_dispatch_rules"]},{key:"portal",label:"Enable customer portal",href:"/dashboard/settings/customer-portal",completed:ac,supabaseSources:["customer_portal_settings"]},{key:"intake",label:"Customize intake form",href:"/dashboard/settings/customer-intake",completed:ad,supabaseSources:["customer_intake_settings"]},{key:"loyalty",label:"Enable loyalty program",href:"/dashboard/settings/customers/loyalty",completed:ae,supabaseSources:["customer_loyalty_settings"]}],quickActions:[{key:"intake",label:"Customize intake form",href:"/dashboard/settings/customer-intake",analyticsEvent:"settings.quick_action.intake"},{key:"service-areas",label:"Manage service areas",href:"/dashboard/settings/schedule/service-areas",variant:"outline",analyticsEvent:"settings.quick_action.service_areas"}],links:i.links,documentation:i.documentation};case"finance":let ak,al,am,an,ao,ap,aq,ar;return k=a,l=b,ak=!!l.accountingSettings?.provider_enabled&&!!l.accountingSettings?.provider,al=l.bankAccounts.length>0,ao=v(an=y([ak,al,am=l.invoicesOpenCount<Math.max(5,l.jobsWeekCount)].filter(Boolean).length,3)),ap=an>=85?"Accounting syncs and billing tools look healthy.":"Connect accounting + banking to unlock automations.",aq=[{key:"bank-accounts",label:"Connected accounts",value:l.bankAccounts.length.toString(),helper:l.bankAccounts.find(a=>a.is_primary)?.bank_name??"None primary",status:al?"ready":"danger"},{key:"open-invoices",label:"Open invoices",value:l.invoicesOpenCount.toString(),helper:"Awaiting payment",status:am?"ready":"warning"},{key:"virtual-buckets",label:"Virtual buckets",value:l.virtualBucketsCount.toString(),helper:l.virtualBucketSettings?.virtual_buckets_enabled?"Automation enabled":"Automation off",status:l.virtualBucketSettings?.virtual_buckets_enabled?"ready":"warning"},{key:"debit-cards",label:"Debit cards",value:l.debitCardsCount.toString(),helper:l.debitCardsCount?"Spend controls enabled":"No cards issued",status:l.debitCardsCount?"ready":"warning"},{key:"gift-cards",label:"Gift cards",value:l.giftCardsActiveCount.toString(),helper:l.giftCardSettings?.gift_cards_enabled?"Program live":"Program disabled",status:l.giftCardSettings?.gift_cards_enabled?"ready":"warning"}],ar=[{key:"accounting",label:"Connect accounting provider",href:"/dashboard/settings/finance/accounting",completed:ak,supabaseSources:["finance_accounting_settings"]},{key:"banking",label:"Add a primary bank account",href:"/dashboard/settings/finance/bank-accounts",completed:al,supabaseSources:["finance_bank_accounts"]},{key:"financing",label:"Enable financing programs",href:"/dashboard/settings/finance/consumer-financing",completed:!!l.consumerFinancingSettings?.financing_enabled||!!l.businessFinancingSettings?.enable_business_loans,supabaseSources:["finance_consumer_financing_settings","finance_business_financing_settings"]}],{slug:k.slug,title:k.title,description:k.description,icon:k.icon,progress:an,status:ao,summary:ap,metrics:aq,checklist:ar,quickActions:[{key:"gift-cards",label:"Launch gift cards",href:"/dashboard/settings/finance/gift-cards",analyticsEvent:"settings.quick_action.gift_cards"},{key:"virtual-buckets",label:"Tune profit buckets",href:"/dashboard/settings/finance/virtual-buckets",variant:"outline",analyticsEvent:"settings.quick_action.virtual_buckets"}],links:k.links,documentation:k.documentation};case"integrations":let as,at,au,av,aw,ax;return m=a,au=v(at=(as=(n=b).supplierIntegrationsCount>0||n.apiKeysCount>0||!!n.accountingSettings?.provider_enabled||n.phoneNumbersCount>0||n.webhooksCount>0)?90:45),av=as?n.webhookFailuresWeekCount>0?"Investigate webhook failures to keep automations reliable.":"Key integrations are active.":"Connect at least one system to unlock automation.",aw=[{key:"api-usage",label:"API keys",value:n.apiKeysCount.toString(),helper:n.apiKeysCount?"Rotate regularly":"No active keys",status:n.apiKeysCount?"ready":"warning"},{key:"supplier-feeds",label:"Supplier integrations",value:n.supplierIntegrationsCount.toString(),helper:n.supplierIntegrationsCount?"Catalog sync enabled":"No supplier feeds",status:n.supplierIntegrationsCount?"ready":"warning"},{key:"bank-sync",label:"Accounting sync",value:n.accountingSettings?.provider??"Not connected",helper:n.accountingSettings?.last_sync_at?`Last sync ${new Date(n.accountingSettings.last_sync_at).toLocaleDateString()}`:"Never synced",status:n.accountingSettings?.provider_enabled?"ready":"warning"},{key:"phone-integrations",label:"Telecom integrations",value:n.phoneNumbersCount?"Active":"None",helper:`${n.callLogsWeekCount} calls last 7d`,status:n.phoneNumbersCount?"ready":"warning"},{key:"webhooks",label:"Active webhooks",value:n.webhooksCount.toString(),helper:`${n.webhookFailuresWeekCount} failures last 7d`,status:0===n.webhooksCount||n.webhookFailuresWeekCount>0?"warning":"ready"}],ax=[{key:"supplier-integrations",label:"Connect supplier catalogs",href:"/dashboard/settings/pricebook/integrations",completed:n.supplierIntegrationsCount>0,supabaseSources:["supplier_integrations"]},{key:"webhooks",label:"Issue API key + webhook secret",href:"/dashboard/settings/integrations",completed:n.apiKeysCount>0,supabaseSources:["api_keys"]},{key:"webhook-monitoring",label:"Monitor webhook failures",href:"/dashboard/settings/development",completed:0===n.webhookFailuresWeekCount,supabaseSources:["webhooks","webhook_logs"]}],{slug:m.slug,title:m.title,description:m.description,icon:m.icon,progress:at,status:au,summary:av,metrics:aw,checklist:ax,quickActions:[{key:"integration-hub",label:"Open integration hub",href:"/dashboard/settings/integrations",analyticsEvent:"settings.quick_action.integration_hub"},{key:"api-docs",label:"View API docs",href:"/docs/api",variant:"outline",analyticsEvent:"settings.quick_action.api_docs"}],links:m.links,documentation:m.documentation};default:let ay,az,aA,aB,aC,aD;return o=a,ay=(p=b).activitiesWeekCount&&p.jobsWeekCount?u(p.activitiesWeekCount/(p.jobsWeekCount||1)*100):0,aA=v(az=u(Math.round((ay+(p.notificationsWeekCount?100:40))/2))),aB=p.activitiesWeekCount>0?"Telemetry is flowing across automation, comms, and jobs.":"No analytics events detected in the last 7 days.",aC=[{key:"activities",label:"Activity stream",value:p.activitiesWeekCount.toString(),helper:"Events last 7 days",status:p.activitiesWeekCount?"ready":"danger"},{key:"automation",label:"Automation runs",value:p.automationWeekCount.toString(),helper:z(p.activitiesWeekCount?p.automationWeekCount/p.activitiesWeekCount*100-50:0)},{key:"alerts",label:"Notifications delivered",value:p.notificationsWeekCount.toString(),helper:`${p.callLogsWeekCount} calls logged`}],aD=[{key:"mission-control",label:"Pin mission control dashboard",href:"/dashboard/mission-control",completed:p.activitiesWeekCount>0,supabaseSources:["activities"]},{key:"automation-audit",label:"Audit automation failures weekly",href:"/dashboard/settings/automation",completed:p.automationWeekCount>0,supabaseSources:["activities"]}],{slug:o.slug,title:o.title,description:o.description,icon:o.icon,progress:az,status:aA,summary:aB,metrics:aC,checklist:aD,quickActions:[{key:"open-analytics-docs",label:"Review analytics playbook",href:"/docs/ANALYTICS.md",analyticsEvent:"settings.quick_action.analytics_docs"},{key:"instrument",label:"Instrument new event",href:"/dashboard/settings/development",variant:"outline",analyticsEvent:"settings.quick_action.instrument_event"}],links:o.links,documentation:o.documentation}}})(b,a)),c=b.filter(a=>"ready"!==a.status).map(a=>`${w(a.status)}: ${a.title}`);return{meta:{companyName:a.company?.name??null,subscriptionStatus:a.company?.stripe_subscription_status??null,teamCount:a.teamCounts.active,alerts:c,poSystemEnabled:!!a.companySettings?.po_system_enabled,poSystemLastEnabledAt:a.companySettings?.po_system_last_enabled_at??null,generatedAt:a.generatedAt},sections:b}}async function W(a,b,c){let d=a.from(b).select("id",{count:"exact",head:!0});c&&(d=c(d));let{count:e}=await d;return e??0}async function X({searchParams:a}){var o,p;let{q:q=""}=await a,r=await T(),s=q.trim().toLowerCase(),u=s?r.sections.filter(a=>{let b=a.title.toLowerCase().includes(s),c=a.description.toLowerCase().includes(s),d=a.links.some(a=>a.title.toLowerCase().includes(s)||a.description.toLowerCase().includes(s));return b||c||d}):r.sections,v=(o=new Date(r.meta.generatedAt),p={addSuffix:!0},function(a,b,c){var k;let l,m=(0,e.getDefaultOptions)(),n=c?.locale??m.locale??d.defaultLocale,o=i(a,b);if(isNaN(o))throw RangeError("Invalid time value");let p=Object.assign({},c,{addSuffix:c?.addSuffix,comparison:o}),[q,r]=(0,g.normalizeDates)(c?.in,...o>0?[b,a]:[a,b]),s=(k=void 0,a=>{let b=(k?Math[k]:Math.trunc)(a);return 0===b?0:b})(((0,h.toDate)(r)-(0,h.toDate)(q))/1e3),t=Math.round((s-((0,f.getTimezoneOffsetInMilliseconds)(r)-(0,f.getTimezoneOffsetInMilliseconds)(q))/1e3)/60);if(t<2)if(c?.includeSeconds)if(s<5)return n.formatDistance("lessThanXSeconds",5,p);else if(s<10)return n.formatDistance("lessThanXSeconds",10,p);else if(s<20)return n.formatDistance("lessThanXSeconds",20,p);else if(s<40)return n.formatDistance("halfAMinute",0,p);else if(s<60)return n.formatDistance("lessThanXMinutes",1,p);else return n.formatDistance("xMinutes",1,p);else if(0===t)return n.formatDistance("lessThanXMinutes",1,p);else return n.formatDistance("xMinutes",t,p);if(t<45)return n.formatDistance("xMinutes",t,p);if(t<90)return n.formatDistance("aboutXHours",1,p);if(t<j.minutesInDay){let a=Math.round(t/60);return n.formatDistance("aboutXHours",a,p)}if(t<2520)return n.formatDistance("xDays",1,p);else if(t<j.minutesInMonth){let a=Math.round(t/j.minutesInDay);return n.formatDistance("xDays",a,p)}else if(t<2*j.minutesInMonth)return l=Math.round(t/j.minutesInMonth),n.formatDistance("aboutXMonths",l,p);if((l=function(a,b,c){var d,e;let f,j,k,l,[m,n,o]=(0,g.normalizeDates)(void 0,a,a,b),p=i(n,o),q=Math.abs(function(a,b,c){let[d,e]=(0,g.normalizeDates)(void 0,a,b);return 12*(d.getFullYear()-e.getFullYear())+(d.getMonth()-e.getMonth())}(n,o));if(q<1)return 0;1===n.getMonth()&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-p*q);let r=i(n,o)===-p;+(f=(0,h.toDate)(m,void 0),d=void 0,(j=(0,h.toDate)(f,d?.in)).setHours(23,59,59,999),j)==+(e=void 0,l=(k=(0,h.toDate)(f,e?.in)).getMonth(),k.setFullYear(k.getFullYear(),l+1,0),k.setHours(23,59,59,999),k)&&1===q&&1===i(m,o)&&(r=!1);let s=p*(q-r);return 0===s?0:s}(r,q))<12){let a=Math.round(t/j.minutesInMonth);return n.formatDistance("xMonths",a,p)}{let a=l%12,b=Math.trunc(l/12);return a<3?n.formatDistance("aboutXYears",b,p):a<9?n.formatDistance("overXYears",b,p):n.formatDistance("almostXYears",b+1,p)}}(o,(0,c.constructFrom)(o,Date.now()),p)),w=r.meta.subscriptionStatus??"unknown",x=r.sections.find(a=>"analytics"===a.slug);return(0,b.jsxs)("div",{className:"space-y-8 md:space-y-12 p-4 md:p-6",children:[(0,b.jsxs)("header",{className:"space-y-4 md:space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl md:text-3xl lg:text-4xl font-bold tracking-tight",children:"Settings"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm md:text-base",children:"Workspace controls, advanced configuration, and telemetry"})]}),(0,b.jsx)("div",{className:"w-full max-w-md",children:(0,b.jsx)(l.Suspense,{fallback:null,children:(0,b.jsx)(n.SettingsSearch,{})})})]}),(0,b.jsxs)("div",{className:"grid gap-3 md:gap-4 grid-cols-1 sm:grid-cols-2 xl:grid-cols-4",children:[(0,b.jsxs)(t.Card,{children:[(0,b.jsxs)(t.CardHeader,{children:[(0,b.jsx)(t.CardTitle,{className:"text-base",children:"Team"}),(0,b.jsx)(t.CardDescription,{children:"Active workspace members"})]}),(0,b.jsxs)(t.CardContent,{className:"flex items-baseline gap-2",children:[(0,b.jsx)("span",{className:"text-3xl font-semibold tracking-tight",children:r.meta.teamCount}),(0,b.jsx)("span",{className:"text-muted-foreground text-sm",children:"active"})]})]}),(0,b.jsxs)(t.Card,{className:"border-warning/40",children:[(0,b.jsxs)(t.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(t.CardTitle,{className:"text-base",children:"Alerts"}),(0,b.jsx)(t.CardDescription,{children:"Clusters needing attention"})]}),(0,b.jsx)(F.Badge,{variant:r.meta.alerts.length?"destructive":"secondary",children:r.meta.alerts.length})]}),(0,b.jsx)(t.CardContent,{className:"text-muted-foreground space-y-1.5 text-sm",children:r.meta.alerts.length?r.meta.alerts.slice(0,2).map(a=>(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(k.AlertCircle,{className:"text-warning mt-0.5 size-4"}),(0,b.jsx)("span",{children:a})]},a)):(0,b.jsx)("p",{children:"All configuration clusters look healthy."})})]}),(0,b.jsxs)(t.Card,{children:[(0,b.jsxs)(t.CardHeader,{className:"flex flex-row items-center justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(t.CardTitle,{className:"text-base",children:"Plan status"}),(0,b.jsx)(t.CardDescription,{children:"Billing + subscription"})]}),(0,b.jsx)(F.Badge,{variant:"active"===w||"trialing"===w?"default":"destructive",children:w})]}),(0,b.jsxs)(t.CardContent,{className:"text-muted-foreground text-sm",children:["Last refreshed ",v]})]}),(0,b.jsx)(m.POSystemToggle,{enabled:r.meta.poSystemEnabled,lastEnabledAt:r.meta.poSystemLastEnabledAt})]}),x&&x.metrics.length>0&&(0,b.jsxs)(t.Card,{className:"border-primary/30 bg-primary/5",children:[(0,b.jsxs)(t.CardHeader,{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(t.CardTitle,{className:"text-base",children:"Telemetry snapshot"}),(0,b.jsx)(t.CardDescription,{children:"Live signals from automation, activity, and communications"})]}),(0,b.jsx)(F.Badge,{variant:"outline",children:"Last 7 days"})]}),(0,b.jsx)(t.CardContent,{className:"grid gap-4 md:grid-cols-3",children:x.metrics.slice(0,3).map(a=>(0,b.jsxs)("div",{className:"border-primary/20 bg-background/80 rounded-xl border p-4 shadow-sm",children:[(0,b.jsx)("p",{className:"text-primary text-xs font-semibold tracking-wide uppercase",children:a.label}),(0,b.jsx)("p",{className:"mt-1 text-2xl font-semibold tracking-tight",children:a.value}),a.helper&&(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:a.helper})]},`${x.slug}-${a.key}-snapshot`))})]})]}),(0,b.jsx)("div",{className:"space-y-8",children:0===u.length?(0,b.jsx)(t.Card,{className:"py-12",children:(0,b.jsxs)(t.CardContent,{className:"flex flex-col items-center gap-3 text-center",children:[(0,b.jsxs)("p",{className:"text-lg font-semibold",children:["No settings match ",q,"."]}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Try another query or clear the search bar."})]})}):(0,b.jsx)(G,{sections:u,children:u.map(a=>(0,b.jsx)(E,{section:a},a.slug))})})]})}function Y(){return(0,b.jsxs)("div",{className:"space-y-8 md:space-y-12 p-4 md:p-6",children:[(0,b.jsxs)("header",{className:"space-y-4 md:space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl md:text-3xl lg:text-4xl font-bold tracking-tight",children:"Settings"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm md:text-base",children:"Workspace controls, advanced configuration, and telemetry"})]}),(0,b.jsx)("div",{className:"w-full max-w-md",children:(0,b.jsx)(l.Suspense,{fallback:null,children:(0,b.jsx)(n.SettingsSearch,{})})})]}),(0,b.jsx)("div",{className:"grid gap-3 md:gap-4 grid-cols-1 sm:grid-cols-2 xl:grid-cols-4",children:[1,2,3,4].map(a=>(0,b.jsx)("div",{className:"bg-muted h-32 animate-pulse rounded-lg"},a))})]}),(0,b.jsx)("div",{className:"space-y-8",children:[1,2,3].map(a=>(0,b.jsx)("div",{className:"bg-muted h-48 animate-pulse rounded-lg"},a))})]})}function Z(a){return(0,b.jsx)(l.Suspense,{fallback:(0,b.jsx)(Y,{}),children:(0,b.jsx)(X,{...a})})}a.s(["default",()=>Z],442884)}];

//# sourceMappingURL=apps_web_src_b56d7b87._.js.map