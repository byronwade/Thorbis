{"version":3,"sources":["../../../../../../apps/web/src/components/ui/skeleton.tsx","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/schedule/dispatch-map/dispatch-map-view.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/schedule/dispatch-map/page.tsx"],"sourcesContent":["// Re-export from @stratos/ui package\nexport * from \"@stratos/ui\";\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const DispatchMapView = registerClientReference(\n    function() { throw new Error(\"Attempted to call DispatchMapView() from the server but DispatchMapView is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/app/(dashboard)/dashboard/schedule/dispatch-map/dispatch-map-view.tsx\",\n    \"DispatchMapView\",\n);\n","import { Suspense } from \"react\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { getActiveCompanyId } from \"@stratos/auth/company-context\";\nimport { DispatchMapView } from \"./dispatch-map-view\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nexport const metadata = {\n\ttitle: \"Dispatch Map - Live Fleet View\",\n\tdescription: \"Real-time map view of all technicians and jobs\",\n};\n\nfunction MapSkeleton() {\n\treturn (\n\t\t<div className=\"relative h-full w-full bg-muted/30\">\n\t\t\t<Skeleton className=\"absolute inset-0\" />\n\t\t\t<div className=\"absolute left-4 top-4 w-80\">\n\t\t\t\t<Skeleton className=\"h-[500px] rounded-lg\" />\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nasync function DispatchMapData() {\n\tconst supabase = await createClient();\n\tconst companyId = await getActiveCompanyId();\n\n\tif (!companyId) {\n\t\treturn (\n\t\t\t<div className=\"flex h-full items-center justify-center\">\n\t\t\t\t<p>Please sign in to view the dispatch map</p>\n\t\t\t</div>\n\t\t);\n\t}\n\n\t// Get today's date range\n\tconst today = new Date();\n\ttoday.setHours(0, 0, 0, 0);\n\tconst tomorrow = new Date(today);\n\ttomorrow.setDate(tomorrow.getDate() + 1);\n\n\t// Fetch technicians with their current locations (join with users for name/avatar)\n\tconst { data: technicianData } = await supabase\n\t\t.from(\"team_members\")\n\t\t.select(\n\t\t\t`\n\t\t\tid,\n\t\t\tinvited_name,\n\t\t\temail,\n\t\t\tphone,\n\t\t\trole,\n\t\t\tstatus,\n\t\t\tuser:users (\n\t\t\t\tname,\n\t\t\t\tavatar\n\t\t\t)\n\t\t`\n\t\t)\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"role\", \"technician\")\n\t\t.is(\"archived_at\", null);\n\n\t// Transform technician data to expected format\n\tconst technicians = (technicianData || []).map((tech) => ({\n\t\tid: tech.id,\n\t\tname: tech.user?.name || tech.invited_name || \"Unknown\",\n\t\temail: tech.email,\n\t\tphone: tech.phone,\n\t\tavatar: tech.user?.avatar,\n\t\trole: tech.role,\n\t\tstatus: tech.status,\n\t}));\n\n\t// Fetch GPS locations for all technicians\n\tconst { data: gpsLocations } = await supabase\n\t\t.from(\"technician_locations\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId);\n\n\t// Fetch today's appointments with job details\n\tconst { data: appointments } = await supabase\n\t\t.from(\"appointments\")\n\t\t.select(\n\t\t\t`\n\t\t\tid,\n\t\t\tscheduled_start,\n\t\t\tscheduled_end,\n\t\t\tstatus,\n\t\t\tassigned_technician_ids,\n\t\t\tjob:jobs (\n\t\t\t\tid,\n\t\t\t\ttitle,\n\t\t\t\tjob_type,\n\t\t\t\tpriority,\n\t\t\t\tstatus,\n\t\t\t\ttotal_amount,\n\t\t\t\tcustomer:customers (\n\t\t\t\t\tid,\n\t\t\t\t\tdisplay_name,\n\t\t\t\t\tphone,\n\t\t\t\t\taddress,\n\t\t\t\t\tcity,\n\t\t\t\t\tstate,\n\t\t\t\t\tzip_code,\n\t\t\t\t\tlat,\n\t\t\t\t\tlon\n\t\t\t\t),\n\t\t\t\tproperty:properties (\n\t\t\t\t\tid,\n\t\t\t\t\taddress,\n\t\t\t\t\tcity,\n\t\t\t\t\tstate,\n\t\t\t\t\tzip_code,\n\t\t\t\t\tlat,\n\t\t\t\t\tlon\n\t\t\t\t)\n\t\t\t)\n\t\t`\n\t\t)\n\t\t.eq(\"company_id\", companyId)\n\t\t.gte(\"scheduled_start\", today.toISOString())\n\t\t.lt(\"scheduled_start\", tomorrow.toISOString())\n\t\t.order(\"scheduled_start\", { ascending: true });\n\n\t// Fetch unassigned jobs\n\tconst { data: unassignedJobs } = await supabase\n\t\t.from(\"jobs\")\n\t\t.select(\n\t\t\t`\n\t\t\tid,\n\t\t\ttitle,\n\t\t\tjob_type,\n\t\t\tpriority,\n\t\t\tstatus,\n\t\t\ttotal_amount,\n\t\t\tcustomer:customers (\n\t\t\t\tid,\n\t\t\t\tdisplay_name,\n\t\t\t\tphone,\n\t\t\t\taddress,\n\t\t\t\tcity,\n\t\t\t\tstate,\n\t\t\t\tlat,\n\t\t\t\tlon\n\t\t\t),\n\t\t\tproperty:properties (\n\t\t\t\tid,\n\t\t\t\taddress,\n\t\t\t\tcity,\n\t\t\t\tstate,\n\t\t\t\tlat,\n\t\t\t\tlon\n\t\t\t)\n\t\t`\n\t\t)\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"status\", \"pending\")\n\t\t.is(\"archived_at\", null)\n\t\t.limit(50);\n\n\t// Get company settings for default map center\n\tconst { data: companySettings } = await supabase\n\t\t.from(\"company_settings\")\n\t\t.select(\"address, city, state\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.single();\n\n\treturn (\n\t\t<DispatchMapView\n\t\t\ttechnicians={technicians || []}\n\t\t\tgpsLocations={gpsLocations || []}\n\t\t\tappointments={appointments || []}\n\t\t\tunassignedJobs={unassignedJobs || []}\n\t\t\tcompanyId={companyId}\n\t\t\tdefaultCenter={\n\t\t\t\tcompanySettings?.city\n\t\t\t\t\t? { address: `${companySettings.address}, ${companySettings.city}, ${companySettings.state}` }\n\t\t\t\t\t: undefined\n\t\t\t}\n\t\t/>\n\t);\n}\n\nexport default function DispatchMapPage() {\n\treturn (\n\t\t<div className=\"h-[calc(100vh-4rem)] w-full overflow-hidden\">\n\t\t\t<Suspense fallback={<MapSkeleton />}>\n\t\t\t\t<DispatchMapData />\n\t\t\t</Suspense>\n\t\t</div>\n\t);\n}\n"],"names":[],"mappings":"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","ignoreList":[1]}