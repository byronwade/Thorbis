{"version":3,"sources":["../../../../../../apps/web/src/lib/communication/sms-service.ts","../../../../../../apps/web/src/actions/sms-actions.ts","../../../../../../apps/web/src/emails/plain-text-email.tsx","../../../../../../apps/web/src/actions/communications.ts","../../../../../../apps/web/.next-internal/server/app/%28dashboard%29/dashboard/communication/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["/**\n * SMS Service\n * \n * Handles fetching and managing SMS messages from the communications table\n * Similar structure to email-service.ts but for SMS type communications\n */\n\nimport { createClient } from \"@/lib/supabase/server\";\nimport type { TypedSupabaseClient } from \"@/types/supabase\";\n\nexport type CompanySms = {\n\tid: string;\n\tfrom_address: string | null;\n\tfrom_name: string | null;\n\tto_address: string | null;\n\tbody: string;\n\tbody_html: string | null;\n\tcreated_at: string;\n\tread_at: string | null;\n\tdirection: \"inbound\" | \"outbound\";\n\tcustomer_id: string | null;\n\tcustomer?: {\n\t\tid: string;\n\t\tfirst_name: string | null;\n\t\tlast_name: string | null;\n\t\tdisplay_name: string | null;\n\t\temail: string | null;\n\t\tphone: string | null;\n\t\tcompany_name: string | null;\n\t} | null;\n\tsent_at: string | null;\n\tdelivered_at: string | null;\n\tstatus: string;\n\tchannel: string | null;\n\tprovider_metadata: Record<string, unknown> | null;\n\tis_archived: boolean;\n\tsnoozed_until: string | null;\n\tcategory: string | null;\n\ttags: string[] | null;\n\ttelnyx_message_id: string | null;\n};\n\nexport type GetCompanySmsInput = {\n\tlimit?: number;\n\toffset?: number;\n\ttype?: \"sent\" | \"received\" | \"all\";\n\tfolder?: \"inbox\" | \"sent\" | \"archive\" | \"trash\" | \"bin\";\n\tlabel?: string;\n\tsearch?: string | null;\n\tsortBy?: \"created_at\" | \"sent_at\";\n\tsortOrder?: \"asc\" | \"desc\";\n};\n\nexport type GetCompanySmsResult = {\n\tsms: CompanySms[];\n\ttotal: number;\n\thasMore: boolean;\n};\n\nexport async function getCompanySms(\n\tcompanyId: string,\n\tinput: GetCompanySmsInput = {},\n): Promise<GetCompanySmsResult> {\n\tconst supabase = await createClient();\n\n\tif (!supabase) {\n\t\treturn { sms: [], total: 0, hasMore: false };\n\t}\n\n\tconst {\n\t\tlimit = 50,\n\t\toffset = 0,\n\t\ttype = \"all\",\n\t\tfolder,\n\t\tlabel,\n\t\tsearch,\n\t\tsortBy = \"created_at\",\n\t\tsortOrder = \"desc\",\n\t} = input;\n\n\t// Build the query - get all SMS messages\n\tlet query = supabase\n\t\t.from(\"communications\")\n\t\t.select(\n\t\t\t`\n\t\t\tid,\n\t\t\tfrom_address,\n\t\t\tfrom_name,\n\t\t\tto_address,\n\t\t\tbody,\n\t\t\tbody_html,\n\t\t\tcreated_at,\n\t\t\tread_at,\n\t\t\tdirection,\n\t\t\tcustomer_id,\n\t\t\tcustomer:customers!left(id, first_name, last_name, display_name, email, phone, company_name),\n\t\t\tsent_at,\n\t\t\tdelivered_at,\n\t\t\tstatus,\n\t\t\tchannel,\n\t\t\tprovider_metadata,\n\t\t\tis_archived,\n\t\t\tsnoozed_until,\n\t\t\tcategory,\n\t\t\ttags,\n\t\t\ttelnyx_message_id\n\t\t`,\n\t\t\t{ count: \"exact\" },\n\t\t)\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"type\", \"sms\");\n\n\t// Apply folder filtering\n\tif (folder) {\n\t\tswitch (folder) {\n\t\t\tcase \"inbox\":\n\t\t\t\t// Inbox: inbound, not archived, not deleted, not snoozed (or snooze expired)\n\t\t\t\tquery = query\n\t\t\t\t\t.eq(\"direction\", \"inbound\")\n\t\t\t\t\t.eq(\"is_archived\", false)\n\t\t\t\t\t.is(\"deleted_at\", null)\n\t\t\t\t\t.or(\"snoozed_until.is.null,snoozed_until.lt.now()\");\n\t\t\t\tbreak;\n\t\t\tcase \"sent\":\n\t\t\t\t// Sent: outbound, not archived, not deleted\n\t\t\t\tquery = query\n\t\t\t\t\t.eq(\"direction\", \"outbound\")\n\t\t\t\t\t.eq(\"is_archived\", false)\n\t\t\t\t\t.is(\"deleted_at\", null);\n\t\t\t\tbreak;\n\t\t\tcase \"archive\":\n\t\t\t\t// Archive: is_archived = true, not deleted\n\t\t\t\tquery = query.eq(\"is_archived\", true).is(\"deleted_at\", null);\n\t\t\t\tbreak;\n\t\t\tcase \"trash\":\n\t\t\tcase \"bin\":\n\t\t\t\t// Trash: deleted_at is not null\n\t\t\t\tquery = query.not(\"deleted_at\", \"is\", null);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\t// Custom folder or label filtering - done in memory after fetch\n\t\t\t\t// (JSONB array containment not supported by PostgREST cs operator)\n\t\t\t\tquery = query.is(\"deleted_at\", null);\n\t\t\t\tbreak;\n\t\t}\n\t} else {\n\t\t// Default: exclude deleted SMS\n\t\tquery = query.is(\"deleted_at\", null);\n\t}\n\n\t// Apply direction filter\n\tif (type === \"sent\") {\n\t\tquery = query.eq(\"direction\", \"outbound\");\n\t} else if (type === \"received\") {\n\t\tquery = query.eq(\"direction\", \"inbound\");\n\t}\n\n\t// Apply search filter\n\tif (search) {\n\t\tconst searchLower = search.toLowerCase();\n\t\tquery = query.or(\n\t\t\t`from_address.ilike.%${searchLower}%,to_address.ilike.%${searchLower}%,body.ilike.%${searchLower}%`,\n\t\t);\n\t}\n\n\t// Apply sorting\n\tconst ascending = sortOrder === \"asc\";\n\tif (sortBy === \"sent_at\") {\n\t\tquery = query.order(\"sent_at\", { ascending, nullsFirst: false });\n\t} else {\n\t\tquery = query.order(\"created_at\", { ascending });\n\t}\n\n\t// Apply pagination\n\tquery = query.range(offset, offset + limit - 1);\n\n\tconst { data, error, count } = await query;\n\n\tif (error) {\n\t\tconsole.error(\"Error fetching SMS messages:\", error);\n\t\treturn { sms: [], total: 0, hasMore: false };\n\t}\n\n\tlet sms = (data || []).map((msg) => ({\n\t\t...msg,\n\t\ttags: (msg.tags as string[]) || null,\n\t\tprovider_metadata: (msg.provider_metadata as Record<string, unknown>) || null,\n\t})) as CompanySms[];\n\n\t// Post-process custom folder/label filtering (JSONB array containment not supported by PostgREST)\n\tconst standardFolders = [\"inbox\", \"sent\", \"archive\", \"trash\", \"bin\"];\n\tconst folderName = label || folder;\n\tif (folderName && !standardFolders.includes(folderName)) {\n\t\tsms = sms.filter((msg) => {\n\t\t\tconst msgTags = msg.tags || [];\n\t\t\treturn Array.isArray(msgTags) && msgTags.includes(folderName);\n\t\t});\n\t\treturn {\n\t\t\tsms,\n\t\t\ttotal: sms.length,\n\t\t\thasMore: false,\n\t\t};\n\t}\n\n\tconst total = count || 0;\n\tconst hasMore = offset + sms.length < total;\n\n\treturn {\n\t\tsms,\n\t\ttotal,\n\t\thasMore,\n\t};\n}\n\nexport async function getSmsById(\n\tcompanyId: string,\n\tsmsId: string,\n): Promise<CompanySms | null> {\n\tconst supabase = await createClient();\n\n\tif (!supabase) {\n\t\treturn null;\n\t}\n\n\tconst { data, error } = await supabase\n\t\t.from(\"communications\")\n\t\t.select(\n\t\t\t`\n\t\t\tid,\n\t\t\tfrom_address,\n\t\t\tfrom_name,\n\t\t\tto_address,\n\t\t\tbody,\n\t\t\tbody_html,\n\t\t\tcreated_at,\n\t\t\tread_at,\n\t\t\tdirection,\n\t\t\tcustomer_id,\n\t\t\tcustomer:customers!left(id, first_name, last_name, display_name, email, phone, company_name),\n\t\t\tsent_at,\n\t\t\tdelivered_at,\n\t\t\tstatus,\n\t\t\tchannel,\n\t\t\tprovider_metadata,\n\t\t\tis_archived,\n\t\t\tsnoozed_until,\n\t\t\tcategory,\n\t\t\ttags,\n\t\t\ttelnyx_message_id\n\t\t`,\n\t\t)\n\t\t.eq(\"id\", smsId)\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"type\", \"sms\")\n\t\t.single();\n\n\tif (error || !data) {\n\t\treturn null;\n\t}\n\n\treturn {\n\t\t...data,\n\t\ttags: (data.tags as string[]) || null,\n\t\tprovider_metadata: (data.provider_metadata as Record<string, unknown>) || null,\n\t} as CompanySms;\n}\n\nexport async function markSmsAsRead(\n\tcompanyId: string,\n\tsmsId: string,\n): Promise<boolean> {\n\tconst supabase = await createClient();\n\n\tif (!supabase) {\n\t\tconsole.error(\"❌ markSmsAsRead: Missing supabase\");\n\t\treturn false;\n\t}\n\n\tconst readAt = new Date().toISOString();\n\tconst { data, error } = await supabase\n\t\t.from(\"communications\")\n\t\t.update({ read_at: readAt })\n\t\t.eq(\"id\", smsId)\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"type\", \"sms\")\n\t\t.select(\"id, read_at\")\n\t\t.single();\n\n\tif (error) {\n\t\tconsole.error(\"❌ markSmsAsRead error:\", error);\n\t\treturn false;\n\t}\n\n\tif (!data) {\n\t\tconsole.error(\"❌ markSmsAsRead: No data returned\");\n\t\treturn false;\n\t}\n\n\tconsole.log(\"✅ markSmsAsRead success:\", { smsId, read_at: data.read_at });\n\treturn true;\n}\n\n/**\n * Get all SMS messages for a conversation thread (by phone number)\n */\nexport async function getSmsConversation(\n\tcompanyId: string,\n\tphoneNumber: string,\n): Promise<CompanySms[]> {\n\tconst supabase = await createClient();\n\n\tif (!supabase) {\n\t\treturn [];\n\t}\n\n\t// Normalize phone number for matching\n\tconst normalizePhone = (phone: string) => {\n\t\tconst digits = phone.replace(/[^0-9]/g, \"\");\n\t\tif (digits.length === 11 && digits.startsWith(\"1\")) {\n\t\t\treturn `+${digits}`;\n\t\t}\n\t\tif (digits.length === 10) {\n\t\t\treturn `+1${digits}`;\n\t\t}\n\t\treturn phone.startsWith(\"+\") ? phone : `+${phone}`;\n\t};\n\n\tconst normalizedPhone = normalizePhone(phoneNumber);\n\n\t// Fetch all messages where this phone number is either from or to\n\tconst { data, error } = await supabase\n\t\t.from(\"communications\")\n\t\t.select(\n\t\t\t`\n\t\t\tid,\n\t\t\tfrom_address,\n\t\t\tfrom_name,\n\t\t\tto_address,\n\t\t\tbody,\n\t\t\tbody_html,\n\t\t\tcreated_at,\n\t\t\tread_at,\n\t\t\tdirection,\n\t\t\tcustomer_id,\n\t\t\tcustomer:customers!left(id, first_name, last_name, display_name, email, phone, company_name),\n\t\t\tsent_at,\n\t\t\tdelivered_at,\n\t\t\tstatus,\n\t\t\tchannel,\n\t\t\tprovider_metadata,\n\t\t\tis_archived,\n\t\t\tsnoozed_until,\n\t\t\tcategory,\n\t\t\ttags,\n\t\t\ttelnyx_message_id\n\t\t`,\n\t\t)\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"type\", \"sms\")\n\t\t.is(\"deleted_at\", null)\n\t\t.or(`from_address.eq.${normalizedPhone},to_address.eq.${normalizedPhone}`)\n\t\t.order(\"created_at\", { ascending: true });\n\n\tif (error) {\n\t\tconsole.error(\"Error fetching SMS conversation:\", error);\n\t\treturn [];\n\t}\n\n\treturn (data || []).map((msg) => ({\n\t\t...msg,\n\t\ttags: (msg.tags as string[]) || null,\n\t\tprovider_metadata: (msg.provider_metadata as Record<string, unknown>) || null,\n\t})) as CompanySms[];\n}\n\n/**\n * Mark all unread messages in an SMS conversation as read\n */\nexport async function markSmsConversationAsRead(\n\tcompanyId: string,\n\tphoneNumber: string,\n): Promise<boolean> {\n\tconst supabase = await createClient();\n\n\tif (!supabase) {\n\t\treturn false;\n\t}\n\n\t// Normalize phone number for matching\n\tconst normalizePhone = (phone: string) => {\n\t\tconst digits = phone.replace(/[^0-9]/g, \"\");\n\t\tif (digits.length === 11 && digits.startsWith(\"1\")) {\n\t\t\treturn `+${digits}`;\n\t\t}\n\t\tif (digits.length === 10) {\n\t\t\treturn `+1${digits}`;\n\t\t}\n\t\treturn phone.startsWith(\"+\") ? phone : `+${phone}`;\n\t};\n\n\tconst normalizedPhone = normalizePhone(phoneNumber);\n\n\t// Mark all unread inbound messages in this conversation as read\n\tconst readAt = new Date().toISOString();\n\tconst { data, error } = await supabase\n\t\t.from(\"communications\")\n\t\t.update({ read_at: readAt })\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"type\", \"sms\")\n\t\t.eq(\"direction\", \"inbound\")\n\t\t.is(\"read_at\", null)\n\t\t.is(\"deleted_at\", null)\n\t\t.or(`from_address.eq.${normalizedPhone},to_address.eq.${normalizedPhone}`)\n\t\t.select(\"id, read_at\");\n\n\tif (error) {\n\t\tconsole.error(\"❌ markSmsConversationAsRead error:\", error);\n\t\treturn false;\n\t}\n\n\tconsole.log(`✅ markSmsConversationAsRead success: Marked ${data?.length || 0} messages as read`);\n\treturn true;\n}\n\n","\"use server\";\n\nimport {\n    getCompanySms,\n    getSmsById,\n    markSmsAsRead,\n    markSmsConversationAsRead,\n    type CompanySms,\n} from \"@/lib/communication/sms-service\";\nimport { z } from \"zod\";\n\nconst getSmsSchema = z.object({\n  limit: z.coerce.number().min(1).max(500).optional().default(50),\n  offset: z.coerce.number().min(0).optional().default(0),\n  type: z.enum([\"sent\", \"received\", \"all\"]).optional().default(\"all\"),\n  folder: z.enum([\"inbox\", \"sent\", \"archive\", \"trash\", \"bin\"]).optional(),\n  label: z.string().optional(),\n  search: z.string().optional().nullable(),\n  sortBy: z.enum([\"created_at\", \"sent_at\"]).optional().default(\"created_at\"),\n  sortOrder: z.enum([\"asc\", \"desc\"]).optional().default(\"desc\"),\n}).passthrough();\n\nconst markSmsReadSchema = z.object({\n  smsId: z.string().min(1),\n});\n\nexport type GetSmsInput = z.infer<typeof getSmsSchema>;\nexport type MarkSmsReadInput = z.infer<typeof markSmsReadSchema>;\n\n// Re-export SMS types from sms-service\nexport type { CompanySms };\n\nexport type GetSmsResult = Awaited<ReturnType<typeof getCompanySms>>;\n\n/**\n * Get SMS messages for the active company\n */\nexport async function getSmsAction(\n  input: GetSmsInput\n): Promise<GetSmsResult> {\n  try {\n    const parseResult = getSmsSchema.safeParse(input);\n    \n    if (!parseResult.success) {\n      throw new Error(`Invalid input parameters: ${parseResult.error.errors.map(e => `${e.path.join('.')}: ${e.message}`).join(', ')}`);\n    }\n    \n    const validatedInput = parseResult.data;\n    const { getActiveCompanyId } = await import(\"@/lib/auth/company-context\");\n    const companyId = await getActiveCompanyId();\n\n    if (!companyId) {\n      throw new Error(\"No active company found\");\n    }\n\n    return await getCompanySms(companyId, validatedInput);\n  } catch (error) {\n    console.error(\"❌ getSmsAction error:\", error);\n    throw error;\n  }\n}\n\n/**\n * Get a specific SMS by ID\n */\nexport async function getSmsByIdAction(smsId: string): Promise<{\n  success: boolean;\n  sms?: CompanySms;\n  error?: string;\n}> {\n  try {\n    const { getActiveCompanyId } = await import(\"@/lib/auth/company-context\");\n    const companyId = await getActiveCompanyId();\n\n    if (!companyId) {\n      return { success: false, error: \"No active company found\" };\n    }\n\n    const sms = await getSmsById(companyId, smsId);\n    \n    if (!sms) {\n      return { success: false, error: \"SMS not found\" };\n    }\n\n    return { success: true, sms };\n  } catch (error) {\n    console.error(\"Error getting SMS by ID:\", error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    };\n  }\n}\n\n/**\n * Mark an SMS as read\n */\nexport async function markSmsAsReadAction(\n  input: MarkSmsReadInput\n): Promise<boolean> {\n  try {\n    const validatedInput = markSmsReadSchema.parse(input);\n    const { getActiveCompanyId } = await import(\"@/lib/auth/company-context\");\n    const companyId = await getActiveCompanyId();\n\n    if (!companyId) {\n      throw new Error(\"Invalid input parameters\");\n    }\n\n    return await markSmsAsRead(companyId, validatedInput.smsId);\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      throw new Error(\"Invalid input parameters\");\n    }\n    throw error;\n  }\n}\n\n/**\n * Mark all unread messages in an SMS conversation as read\n */\nexport async function markSmsConversationAsReadAction(phoneNumber: string): Promise<{\n  success: boolean;\n  error?: string;\n}> {\n  \"use server\";\n  \n  try {\n    const { getActiveCompanyId } = await import(\"@/lib/auth/company-context\");\n    const companyId = await getActiveCompanyId();\n    \n    if (!companyId) {\n      return { success: false, error: \"No active company found\" };\n    }\n    \n    const success = await markSmsConversationAsRead(companyId, phoneNumber);\n    return { success };\n  } catch (error) {\n    console.error(\"Error marking SMS conversation as read:\", error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    };\n  }\n}\n\n/**\n * Get SMS conversation thread by phone number\n */\nexport async function getSmsConversationAction(phoneNumber: string): Promise<{\n  success: boolean;\n  messages?: CompanySms[];\n  error?: string;\n}> {\n  \"use server\";\n  \n  try {\n    const { getSmsConversation } = await import(\"@/lib/sms/sms-service\");\n    const { getActiveCompanyId } = await import(\"@/lib/auth/company-context\");\n    \n    const companyId = await getActiveCompanyId();\n    if (!companyId) {\n      return { success: false, error: \"No active company found\" };\n    }\n\n    const messages = await getSmsConversation(companyId, phoneNumber);\n    return { success: true, messages };\n  } catch (error) {\n    console.error(\"Error fetching SMS conversation:\", error);\n    // Handle cookies() error gracefully\n    if (error instanceof Error && error.message.includes(\"cookies\")) {\n      return {\n        success: false,\n        error: \"Request context not available. Please refresh the page.\",\n      };\n    }\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    };\n  }\n}\n\n/**\n * Get SMS folder counts\n */\nexport async function getSmsFolderCountsAction(): Promise<{\n  success: boolean;\n  counts?: {\n    inbox: number;\n    sent: number;\n    archive: number;\n    trash: number;\n    [label: string]: number;\n  };\n  error?: string;\n}> {\n  \"use server\";\n  \n  try {\n    const { createClient } = await import(\"@/lib/supabase/server\");\n    const { getActiveCompanyId } = await import(\"@/lib/auth/company-context\");\n    \n    const companyId = await getActiveCompanyId();\n    if (!companyId) {\n      return { success: false, error: \"No active company found\" };\n    }\n    \n    const supabase = await createClient();\n    if (!supabase) {\n      return { success: false, error: \"Database connection failed\" };\n    }\n    \n    const baseQuery = supabase\n      .from(\"communications\")\n      .select(\"*\", { count: \"exact\", head: true })\n      .eq(\"company_id\", companyId)\n      .eq(\"type\", \"sms\");\n    \n    // Get counts for each folder\n    const [inboxResult, sentResult, archiveResult, trashResult] = await Promise.all([\n      // Inbox\n      baseQuery\n        .eq(\"direction\", \"inbound\")\n        .eq(\"is_archived\", false)\n        .is(\"deleted_at\", null)\n        .or(\"snoozed_until.is.null,snoozed_until.lt.now()\"),\n      // Sent\n      baseQuery\n        .eq(\"direction\", \"outbound\")\n        .eq(\"is_archived\", false)\n        .is(\"deleted_at\", null),\n      // Archive\n      baseQuery.eq(\"is_archived\", true).is(\"deleted_at\", null),\n      // Trash\n      baseQuery.not(\"deleted_at\", \"is\", null),\n    ]);\n    \n    const counts = {\n      inbox: inboxResult.count || 0,\n      sent: sentResult.count || 0,\n      archive: archiveResult.count || 0,\n      trash: trashResult.count || 0,\n    };\n    \n    return { success: true, counts };\n  } catch (error) {\n    return { success: false, error: error instanceof Error ? error.message : \"Unknown error\" };\n  }\n}\n\n/**\n * Upload SMS attachments to storage\n */\nexport async function uploadSmsAttachments(\n  files: File[]\n): Promise<{\n  success: boolean;\n  urls?: string[];\n  error?: string;\n}> {\n  \"use server\";\n  \n  try {\n    const { getActiveCompanyId } = await import(\"@/lib/auth/company-context\");\n    const companyId = await getActiveCompanyId();\n    \n    if (!companyId) {\n      return { success: false, error: \"No active company found\" };\n    }\n    \n    const { createClient } = await import(\"@/lib/supabase/server\");\n    const supabase = await createClient();\n    \n    if (!supabase) {\n      return { success: false, error: \"Database connection failed\" };\n    }\n\n    const urls: string[] = [];\n    \n      // Upload each file to Supabase Storage\n      // Use company-files bucket which has proper RLS policies for company members\n      for (const file of files) {\n        const fileExt = file.name.split('.').pop();\n        const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\n        // Path structure: companyId must be at index [0] for RLS policy (matches document-manager pattern)\n        // Format: companyId/folder/filename (storage.foldername(name))[0] = companyId\n        const filePath = `${companyId}/sms-attachments/${fileName}`;\n        \n        // Convert file to array buffer\n        const arrayBuffer = await file.arrayBuffer();\n        const { data, error: uploadError } = await supabase.storage\n          .from('company-files') // Use company-files bucket with proper RLS\n          .upload(filePath, arrayBuffer, {\n            contentType: file.type,\n            upsert: false,\n          });\n        \n        if (uploadError) {\n          console.error(\"Upload error:\", uploadError);\n          return { success: false, error: `Failed to upload ${file.name}: ${uploadError.message}` };\n        }\n        \n        // Get public URL (or signed URL for private bucket)\n        const { data: { publicUrl } } = supabase.storage\n          .from('company-files')\n          .getPublicUrl(filePath);\n        \n        urls.push(publicUrl);\n      }\n    \n    return { success: true, urls };\n  } catch (error) {\n    console.error(\"Error uploading SMS attachments:\", error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    };\n  }\n}\n\n/**\n * SMS Template Context Type\n * Data available for auto-filling SMS templates\n */\nexport type SmsTemplateContext = {\n  companyName?: string;\n  companyPhone?: string;\n  companyEmail?: string;\n};\n\n/**\n * Get company context for SMS templates\n * Returns company info for auto-filling template messages\n */\nexport async function getCompanyContextAction(): Promise<{\n  success: boolean;\n  context?: SmsTemplateContext;\n  error?: string;\n}> {\n  \"use server\";\n\n  try {\n    const { getActiveCompany } = await import(\"@/lib/auth/company-context\");\n\n    const company = await getActiveCompany();\n    if (!company) {\n      return { success: false, error: \"No active company found\" };\n    }\n\n    return {\n      success: true,\n      context: {\n        companyName: company.name,\n        companyPhone: company.phone || undefined,\n        companyEmail: company.email || undefined,\n      },\n    };\n  } catch (error) {\n    console.error(\"Error getting company context:\", error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    };\n  }\n}\n\n","import { Container, Html, Section, Text } from \"@react-email/components\";\n\nexport interface PlainTextEmailProps {\n\tmessage: string;\n}\n\n/**\n * Plain text email template - renders text with line breaks preserved\n * Keeps the email looking like a simple, natural text message\n */\nexport const PlainTextEmail = ({ message }: PlainTextEmailProps) => (\n\t<Html>\n\t\t<Container style={container}>\n\t\t\t<Section style={section}>\n\t\t\t\t{message.split(\"\\n\").map((line, index) => (\n\t\t\t\t\t<Text key={index} style={text}>\n\t\t\t\t\t\t{line || \"\\u00A0\"}\n\t\t\t\t\t</Text>\n\t\t\t\t))}\n\t\t\t</Section>\n\t\t</Container>\n\t</Html>\n);\n\nPlainTextEmail.PreviewText = \"New message\";\n\nconst container = {\n\tmargin: \"0 auto\",\n\tpadding: \"20px 0 48px\",\n\tmaxWidth: \"580px\",\n};\n\nconst section = {\n\tpadding: \"0\",\n};\n\nconst text = {\n\tfontFamily: \"Arial, sans-serif\",\n\tfontSize: \"14px\",\n\tlineHeight: \"24px\",\n\tcolor: \"#333\",\n\tmargin: \"0\",\n\tpadding: \"0\",\n};\n","\"use server\";\n\nimport { PlainTextEmail } from \"@/emails/plain-text-email\";\nimport { sendEmail } from \"@/lib/email/email-sender\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { revalidatePath } from \"next/cache\";\nimport { z } from \"zod\";\n\nconst COMMUNICATIONS_PATH = \"/dashboard/communication\";\n\nconst attachmentSchema = z.object({\n\tfilename: z.string(),\n\tcontent: z.string(), // Base64 encoded\n\tcontentType: z.string().optional(),\n});\n\nconst sendCustomerEmailSchema = z.object({\n\tto: z.union([z.string().email(), z.array(z.string().email())]),\n\tsubject: z.string().min(1),\n\tbody: z.string().min(1),\n\tcustomerName: z.string().min(1),\n\tcompanyId: z.string().min(1),\n\tcustomerId: z.string().optional(),\n\tjobId: z.string().optional(),\n\tpropertyId: z.string().optional(),\n\tinvoiceId: z.string().optional(),\n\testimateId: z.string().optional(),\n\tcc: z.union([z.string().email(), z.array(z.string().email())]).optional(),\n\tbcc: z.union([z.string().email(), z.array(z.string().email())]).optional(),\n\tattachments: z.array(attachmentSchema).optional(),\n\tscheduledFor: z.string().optional(), // ISO date string for scheduled send\n});\n\nexport type SendCustomerEmailInput = z.infer<typeof sendCustomerEmailSchema>;\n\ntype SendCustomerEmailActionResult = {\n\tsuccess: boolean;\n\terror?: string;\n\tdata?: Record<string, unknown>;\n};\n\nexport async function sendCustomerEmailAction(\n\tinput: SendCustomerEmailInput,\n): Promise<SendCustomerEmailActionResult> {\n\tconst payload = sendCustomerEmailSchema.parse(input);\n\tconst supabase = await createClient();\n\n\tif (!supabase) {\n\t\treturn { success: false, error: \"Unable to access database\" };\n\t}\n\n\t// Normalize to/cc/bcc to string format for database storage\n\tconst toAddress = Array.isArray(payload.to) ? payload.to.join(\", \") : payload.to;\n\tconst ccAddress = payload.cc\n\t\t? Array.isArray(payload.cc) ? payload.cc.join(\", \") : payload.cc\n\t\t: null;\n\tconst bccAddress = payload.bcc\n\t\t? Array.isArray(payload.bcc) ? payload.bcc.join(\", \") : payload.bcc\n\t\t: null;\n\n\t// Check if this is a scheduled send\n\tconst isScheduled = !!payload.scheduledFor;\n\tconst scheduledTime = isScheduled ? new Date(payload.scheduledFor!) : null;\n\n\tconst insertResult = await supabase\n\t\t.from(\"communications\")\n\t\t.insert({\n\t\t\tcompany_id: payload.companyId,\n\t\t\tcustomer_id: payload.customerId ?? null,\n\t\t\tjob_id: payload.jobId ?? null,\n\t\t\tinvoice_id: payload.invoiceId ?? null,\n\t\t\testimate_id: payload.estimateId ?? null,\n\t\t\ttype: \"email\",\n\t\t\tchannel: \"resend\",\n\t\t\tdirection: \"outbound\",\n\t\t\tfrom_address: null,\n\t\t\tto_address: toAddress,\n\t\t\tcc_address: ccAddress,\n\t\t\tbcc_address: bccAddress,\n\t\t\tsubject: payload.subject,\n\t\t\tbody: payload.body,\n\t\t\tstatus: isScheduled ? \"scheduled\" : \"queued\",\n\t\t\tpriority: \"normal\",\n\t\t\tis_archived: false,\n\t\t\tis_automated: false,\n\t\t\tis_internal: false,\n\t\t\tis_thread_starter: true,\n\t\t\tscheduled_for: scheduledTime?.toISOString() ?? null,\n\t\t\t// Store attachments for scheduled emails\n\t\t\tprovider_metadata: isScheduled && payload.attachments\n\t\t\t\t? { scheduled_attachments: payload.attachments }\n\t\t\t\t: null,\n\t\t})\n\t\t.select()\n\t\t.single();\n\n\tif (insertResult.error || !insertResult.data) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: insertResult.error?.message\n\t\t\t\t? `Failed to log communication: ${insertResult.error.message}`\n\t\t\t\t: \"Failed to log communication before sending email\",\n\t\t};\n\t}\n\n\tconst communication = insertResult.data;\n\n\t// If scheduled, don't send now - return success\n\tif (isScheduled) {\n\t\trevalidatePath(COMMUNICATIONS_PATH);\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: { ...communication, isScheduled: true },\n\t\t};\n\t}\n\n\t// Send immediately\n\tconst sendResult = await sendEmail({\n\t\tto: payload.to,\n\t\tsubject: payload.subject,\n\t\ttemplate: PlainTextEmail({ message: payload.body }),\n\t\ttemplateType: \"generic\" as any,\n\t\tcompanyId: payload.companyId,\n\t\tcommunicationId: communication.id,\n\t\tcc: payload.cc,\n\t\tbcc: payload.bcc,\n\t\tattachments: payload.attachments,\n\t});\n\n\tif (!sendResult.success) {\n\t\tawait supabase\n\t\t\t.from(\"communications\")\n\t\t\t.update({\n\t\t\t\tstatus: \"failed\",\n\t\t\t\tfailure_reason: sendResult.error || \"Email send failed\",\n\t\t\t})\n\t\t\t.eq(\"id\", communication.id);\n\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: sendResult.error || \"Failed to send email\",\n\t\t};\n\t}\n\n\tawait supabase\n\t\t.from(\"communications\")\n\t\t.update({\n\t\t\tstatus: \"sent\",\n\t\t\tsent_at: new Date().toISOString(),\n\t\t\tprovider_message_id: sendResult.data?.id || null,\n\t\t})\n\t\t.eq(\"id\", communication.id);\n\n\trevalidatePath(COMMUNICATIONS_PATH);\n\n\treturn {\n\t\tsuccess: true,\n\t\tdata: communication,\n\t};\n}\n\n/**\n * Bulk archive multiple communications by their IDs\n * Works for any communication type (email, sms, call)\n */\nexport async function bulkArchiveCommunicationsAction(\n\tcommunicationIds: string[],\n\ttype?: \"email\" | \"sms\" | \"call\"\n): Promise<{\n\tsuccess: boolean;\n\tarchived: number;\n\terror?: string;\n}> {\n\tif (!communicationIds || communicationIds.length === 0) {\n\t\treturn { success: false, archived: 0, error: \"No IDs provided\" };\n\t}\n\n\ttry {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\treturn { success: false, archived: 0, error: \"Database connection failed\" };\n\t\t}\n\n\t\t// Get user's company for security\n\t\tconst { data: { user } } = await supabase.auth.getUser();\n\t\tif (!user) {\n\t\t\treturn { success: false, archived: 0, error: \"Not authenticated\" };\n\t\t}\n\n\t\tconst { data: profile } = await supabase\n\t\t\t.from(\"profiles\")\n\t\t\t.select(\"company_id\")\n\t\t\t.eq(\"id\", user.id)\n\t\t\t.single();\n\n\t\tif (!profile?.company_id) {\n\t\t\treturn { success: false, archived: 0, error: \"No company found\" };\n\t\t}\n\n\t\tlet query = supabase\n\t\t\t.from(\"communications\")\n\t\t\t.update({ is_archived: true })\n\t\t\t.in(\"id\", communicationIds)\n\t\t\t.eq(\"company_id\", profile.company_id);\n\n\t\t// Optionally filter by type\n\t\tif (type) {\n\t\t\tquery = query.eq(\"type\", type);\n\t\t}\n\n\t\tconst { data, error } = await query.select(\"id\");\n\n\t\tif (error) {\n\t\t\treturn { success: false, archived: 0, error: error.message };\n\t\t}\n\n\t\trevalidatePath(COMMUNICATIONS_PATH);\n\n\t\treturn { success: true, archived: data?.length ?? 0 };\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\tarchived: 0,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t};\n\t}\n}\n\n/**\n * Save internal notes for a communication\n * Internal notes are private team notes not visible to customers\n */\nconst saveInternalNotesSchema = z.object({\n\tcommunicationId: z.string().uuid(),\n\tnotes: z.string(),\n});\n\nexport type SaveInternalNotesInput = z.infer<typeof saveInternalNotesSchema>;\n\nexport async function saveInternalNotesAction(\n\tinput: SaveInternalNotesInput\n): Promise<{\n\tsuccess: boolean;\n\terror?: string;\n}> {\n\ttry {\n\t\tconst payload = saveInternalNotesSchema.parse(input);\n\t\tconst supabase = await createClient();\n\n\t\tif (!supabase) {\n\t\t\treturn { success: false, error: \"Unable to access database\" };\n\t\t}\n\n\t\t// Get authenticated user\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tif (!user) {\n\t\t\treturn { success: false, error: \"Not authenticated\" };\n\t\t}\n\n\t\t// Update internal notes\n\t\tconst { error } = await supabase\n\t\t\t.from(\"communications\")\n\t\t\t.update({\n\t\t\t\tinternal_notes: payload.notes,\n\t\t\t\tinternal_notes_updated_at: new Date().toISOString(),\n\t\t\t\tinternal_notes_updated_by: user.id,\n\t\t\t})\n\t\t\t.eq(\"id\", payload.communicationId);\n\n\t\tif (error) {\n\t\t\treturn { success: false, error: error.message };\n\t\t}\n\n\t\trevalidatePath(COMMUNICATIONS_PATH);\n\t\treturn { success: true };\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t};\n\t}\n}\n\n/**\n * Get communications with filters (for client-side refresh)\n */\nconst getCommunicationsSchema = z.object({\n\tcompanyId: z.string().uuid(),\n\tteamMemberId: z.string().uuid(),\n\ttype: z.enum([\"email\", \"sms\", \"call\", \"voicemail\"]).optional(),\n\tcustomerId: z.string().uuid().optional(),\n\tjobId: z.string().uuid().optional(),\n\tlimit: z.number().min(1).max(200).default(100),\n\toffset: z.number().min(0).default(0),\n});\n\nexport type GetCommunicationsInput = z.infer<typeof getCommunicationsSchema>;\n\nexport async function getCommunicationsAction(input: GetCommunicationsInput) {\n\ttry {\n\t\tconst payload = getCommunicationsSchema.parse(input);\n\t\tconst supabase = await createClient();\n\n\t\tif (!supabase) {\n\t\t\treturn { success: false, error: \"Unable to access database\", data: [] };\n\t\t}\n\n\t\t// Build query\n\t\tlet query = supabase\n\t\t\t.from(\"communications\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"company_id\", payload.companyId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(payload.limit);\n\n\t\t// Apply filters\n\t\tif (payload.type) {\n\t\t\tquery = query.eq(\"type\", payload.type);\n\t\t}\n\t\tif (payload.customerId) {\n\t\t\tquery = query.eq(\"customer_id\", payload.customerId);\n\t\t}\n\t\tif (payload.jobId) {\n\t\t\tquery = query.eq(\"job_id\", payload.jobId);\n\t\t}\n\t\tif (payload.offset > 0) {\n\t\t\tquery = query.range(payload.offset, payload.offset + payload.limit - 1);\n\t\t}\n\n\t\tconst { data, error } = await query;\n\n\t\tif (error) {\n\t\t\treturn { success: false, error: error.message, data: [] };\n\t\t}\n\n\t\treturn { success: true, data: data || [] };\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\tdata: [],\n\t\t};\n\t}\n}\n\n/**\n * Auto-link a communication to a customer/job/property\n * Uses confidence scoring and link method tracking\n */\nconst autoLinkCommunicationSchema = z.object({\n\tcommunicationId: z.string().uuid(),\n\tcustomerId: z.string().uuid().optional(),\n\tjobId: z.string().uuid().optional(),\n\tpropertyId: z.string().uuid().optional(),\n\tlinkConfidence: z.number().min(0).max(1),\n\tlinkMethod: z.enum([\"manual\", \"ai\", \"regex\", \"phone_match\", \"email_match\"]),\n});\n\nexport type AutoLinkCommunicationInput = z.infer<typeof autoLinkCommunicationSchema>;\n\nexport async function autoLinkCommunicationAction(\n\tinput: AutoLinkCommunicationInput\n): Promise<{\n\tsuccess: boolean;\n\terror?: string;\n}> {\n\ttry {\n\t\tconst payload = autoLinkCommunicationSchema.parse(input);\n\t\tconst supabase = await createClient();\n\n\t\tif (!supabase) {\n\t\t\treturn { success: false, error: \"Unable to access database\" };\n\t\t}\n\n\t\t// Validate at least one link target is provided\n\t\tif (!payload.customerId && !payload.jobId && !payload.propertyId) {\n\t\t\treturn { success: false, error: \"At least one link target required\" };\n\t\t}\n\n\t\t// Update communication with auto-link data\n\t\tconst { error } = await supabase\n\t\t\t.from(\"communications\")\n\t\t\t.update({\n\t\t\t\tcustomer_id: payload.customerId || null,\n\t\t\t\tjob_id: payload.jobId || null,\n\t\t\t\tproperty_id: payload.propertyId || null,\n\t\t\t\tauto_linked: true,\n\t\t\t\tlink_confidence: payload.linkConfidence,\n\t\t\t\tlink_method: payload.linkMethod,\n\t\t\t})\n\t\t\t.eq(\"id\", payload.communicationId);\n\n\t\tif (error) {\n\t\t\treturn { success: false, error: error.message };\n\t\t}\n\n\t\trevalidatePath(COMMUNICATIONS_PATH);\n\t\treturn { success: true };\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t};\n\t}\n}\n\n/**\n * Get auto-link suggestions for a communication\n * Finds potential customer/job/property matches based on email/phone\n */\nexport interface MatchSuggestion {\n\tid: string;\n\ttype: \"customer\" | \"job\" | \"property\";\n\tname: string;\n\tsubtitle?: string;\n\tconfidence: number;\n\tmatchMethod: \"email_match\" | \"phone_match\" | \"regex\" | \"ai\";\n\tmatchDetails?: string;\n}\n\nconst getAutoLinkSuggestionsSchema = z.object({\n\tcommunicationId: z.string().uuid(),\n\tcompanyId: z.string().uuid(),\n});\n\nexport type GetAutoLinkSuggestionsInput = z.infer<typeof getAutoLinkSuggestionsSchema>;\n\nexport async function getAutoLinkSuggestionsAction(\n\tinput: GetAutoLinkSuggestionsInput\n): Promise<{\n\tsuccess: boolean;\n\terror?: string;\n\tsuggestions?: MatchSuggestion[];\n}> {\n\ttry {\n\t\tconst payload = getAutoLinkSuggestionsSchema.parse(input);\n\t\tconst supabase = await createClient();\n\n\t\tif (!supabase) {\n\t\t\treturn { success: false, error: \"Unable to access database\" };\n\t\t}\n\n\t\t// Get the communication to extract email/phone\n\t\tconst { data: communication, error: commError } = await supabase\n\t\t\t.from(\"communications\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"id\", payload.communicationId)\n\t\t\t.eq(\"company_id\", payload.companyId)\n\t\t\t.single();\n\n\t\tif (commError || !communication) {\n\t\t\treturn { success: false, error: \"Communication not found\" };\n\t\t}\n\n\t\t// Extract email and phone from communication\n\t\tconst emailToMatch = communication.direction === \"inbound\"\n\t\t\t? communication.from_address\n\t\t\t: communication.to_address;\n\n\t\t// Extract phone number (if it's a call or SMS)\n\t\tconst phoneToMatch = communication.type === \"call\" || communication.type === \"sms\"\n\t\t\t? (communication.direction === \"inbound\" ? communication.from_address : communication.to_address)\n\t\t\t: null;\n\n\t\tconst suggestions: MatchSuggestion[] = [];\n\n\t\t// Search for customer matches by email\n\t\tif (emailToMatch && emailToMatch.includes(\"@\")) {\n\t\t\tconst { data: customersByEmail } = await supabase\n\t\t\t\t.from(\"customers\")\n\t\t\t\t.select(\"id, first_name, last_name, email, phone\")\n\t\t\t\t.eq(\"company_id\", payload.companyId)\n\t\t\t\t.ilike(\"email\", `%${emailToMatch}%`)\n\t\t\t\t.limit(3);\n\n\t\t\tif (customersByEmail && customersByEmail.length > 0) {\n\t\t\t\tcustomersByEmail.forEach((customer) => {\n\t\t\t\t\tsuggestions.push({\n\t\t\t\t\t\tid: customer.id,\n\t\t\t\t\t\ttype: \"customer\",\n\t\t\t\t\t\tname: `${customer.first_name || \"\"} ${customer.last_name || \"\"}`.trim() || \"Unnamed Customer\",\n\t\t\t\t\t\tsubtitle: customer.email || customer.phone || undefined,\n\t\t\t\t\t\tconfidence: 0.95,\n\t\t\t\t\t\tmatchMethod: \"email_match\",\n\t\t\t\t\t\tmatchDetails: \"Email address match\",\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Search for customer matches by phone\n\t\tif (phoneToMatch) {\n\t\t\t// Clean phone number (remove formatting)\n\t\t\tconst cleanPhone = phoneToMatch.replace(/[^\\d]/g, \"\");\n\n\t\t\tif (cleanPhone.length >= 10) {\n\t\t\t\tconst { data: customersByPhone } = await supabase\n\t\t\t\t\t.from(\"customers\")\n\t\t\t\t\t.select(\"id, first_name, last_name, email, phone\")\n\t\t\t\t\t.eq(\"company_id\", payload.companyId)\n\t\t\t\t\t.or(`phone.ilike.%${cleanPhone.slice(-10)}%,mobile_phone.ilike.%${cleanPhone.slice(-10)}%`)\n\t\t\t\t\t.limit(3);\n\n\t\t\t\tif (customersByPhone && customersByPhone.length > 0) {\n\t\t\t\t\tcustomersByPhone.forEach((customer) => {\n\t\t\t\t\t\t// Don't add duplicate if already matched by email\n\t\t\t\t\t\tif (!suggestions.find((s) => s.id === customer.id)) {\n\t\t\t\t\t\t\tsuggestions.push({\n\t\t\t\t\t\t\t\tid: customer.id,\n\t\t\t\t\t\t\t\ttype: \"customer\",\n\t\t\t\t\t\t\t\tname: `${customer.first_name || \"\"} ${customer.last_name || \"\"}`.trim() || \"Unnamed Customer\",\n\t\t\t\t\t\t\t\tsubtitle: customer.phone || customer.email || undefined,\n\t\t\t\t\t\t\t\tconfidence: 0.90,\n\t\t\t\t\t\t\t\tmatchMethod: \"phone_match\",\n\t\t\t\t\t\t\t\tmatchDetails: \"Phone number match\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// For matched customers, find active jobs\n\t\tconst customerIds = suggestions.filter((s) => s.type === \"customer\").map((s) => s.id);\n\n\t\tif (customerIds.length > 0) {\n\t\t\tconst { data: jobs } = await supabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\"id, title, customer_id, property_id, status, customers(first_name, last_name), properties(address)\")\n\t\t\t\t.eq(\"company_id\", payload.companyId)\n\t\t\t\t.in(\"customer_id\", customerIds)\n\t\t\t\t.in(\"status\", [\"scheduled\", \"in_progress\", \"pending\"])\n\t\t\t\t.order(\"scheduled_date\", { ascending: false })\n\t\t\t\t.limit(5);\n\n\t\t\tif (jobs && jobs.length > 0) {\n\t\t\t\tjobs.forEach((job: any) => {\n\t\t\t\t\tsuggestions.push({\n\t\t\t\t\t\tid: job.id,\n\t\t\t\t\t\ttype: \"job\",\n\t\t\t\t\t\tname: job.title || \"Untitled Job\",\n\t\t\t\t\t\tsubtitle: job.properties?.address || `Job for ${job.customers?.first_name || \"\"} ${job.customers?.last_name || \"\"}`.trim(),\n\t\t\t\t\t\tconfidence: 0.85,\n\t\t\t\t\t\tmatchMethod: \"email_match\",\n\t\t\t\t\t\tmatchDetails: \"Via matched customer\",\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn { success: true, suggestions };\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t};\n\t}\n}\n","export {getCurrentUserRole as '001f005176797ef23488068124fb9a744915a477de'} from 'ACTIONS_MODULE0'\nexport {canDeleteTeamMember as '406f6624261c6dd1a908026fa1408a3f6d507b6e7d'} from 'ACTIONS_MODULE0'\nexport {getPayrixMerchantAccount as '40704f0e856ad801ef93b43436f219a36f7c0efd2c'} from 'ACTIONS_MODULE1'\nexport {getWebRTCCredentials as '000478fbf5363dae5000d525663da13e29908cb952'} from 'ACTIONS_MODULE2'\nexport {transcribeCallRecording as '4002f454c46f4c21ca6e9e26362583ccff69c9f914'} from 'ACTIONS_MODULE2'\nexport {getCompanyPhoneNumbers as '4019cf9f81eb3c06f82b5c2f8eb042f3d95d91e933'} from 'ACTIONS_MODULE2'\nexport {getCallRoutingRules as '40247c617842c31b242455a0961cbd2c3297606a16'} from 'ACTIONS_MODULE2'\nexport {updateCallRoutingRule as '40413bfa888916480edbc33ebb812158fddf960f89'} from 'ACTIONS_MODULE2'\nexport {startCallRecording as '404e47931374ad2a1b54bc11f357703790f6104530'} from 'ACTIONS_MODULE2'\nexport {transferActiveCall as '405a16958f97c37bd4b5711bd8761510bdab55839f'} from 'ACTIONS_MODULE2'\nexport {searchPhoneNumbers as '406864ae05b8b51c66cc2c335999e5011a41cb521f'} from 'ACTIONS_MODULE2'\nexport {makeCall as '40b2df540ec465c5dc19545c96486485bb50b5633b'} from 'ACTIONS_MODULE2'\nexport {sendTextMessage as '40d050abdabe2ee7293436c505c5f27b4408a2f27c'} from 'ACTIONS_MODULE2'\nexport {stopCallRecording as '40d5cc291162e2fd61245bdb851d5e8ed609e4ed19'} from 'ACTIONS_MODULE2'\nexport {sendMMSMessage as '40edd91786b2a482e617fb16f2474d26ec295435e7'} from 'ACTIONS_MODULE2'\nexport {purchasePhoneNumber as '40fd6a80b32792fab749933f98f07503d8e94c0305'} from 'ACTIONS_MODULE2'\nexport {deleteCallRoutingRule as '607d0f958daf66b2a0d5277cdda17600dace5156bb'} from 'ACTIONS_MODULE2'\nexport {toggleCallRoutingRule as '60853f1e409364f7e171e27229217994ff224414e6'} from 'ACTIONS_MODULE2'\nexport {createServiceSupabaseClient as '00a13dbd00149949fc1367d3e76ae7d789e07f5321'} from 'ACTIONS_MODULE3'\nexport {ensureMessagingBranding as '606753f8910b46d5792f4bdeb457cdf29d1a8bbadc'} from 'ACTIONS_MODULE4'\nexport {ensureMessagingCampaign as '70a648f43fa62ae3dcf2070eb90413e96e81591e77'} from 'ACTIONS_MODULE4'\nexport {checkTelnyxVerificationStatus as '007505a78985e53e083a498c97761ed8a463d3d379'} from 'ACTIONS_MODULE5'\nexport {submitAutomatedVerification as '4087f0badccd6aaf6a28b640ab4bbc513f0832d105'} from 'ACTIONS_MODULE5'\nexport {registerCompanyFor10DLC as '40ae25402a089e45aa071d979e8cc6ad136205cc98'} from 'ACTIONS_MODULE5'\nexport {sendVerificationSubmittedEmail as '70f58c5ba46ef02b620d7dc87bae8fc83f6d480755'} from 'ACTIONS_MODULE6'\nexport {sendEmail as '40f8c061cf84f884e77af3425bc24b8a8d72f598fb'} from 'ACTIONS_MODULE7'\nexport {handleComplaintWebhook as '6045f8436f9cdfdadb7bfe3955677adfc5f4102de0'} from 'ACTIONS_MODULE7'\nexport {handleBounceWebhook as '78a8ea4f1cfa571a366adccf36ac04b1c85d61ae2b'} from 'ACTIONS_MODULE7'\nexport {runHealthCheckForAllDomains as '00c53a1f02416c3261983f8096f19a3450bfd51775'} from 'ACTIONS_MODULE8'\nexport {getDomainHealth as '400b8fb96146bfd004a3166563a5ab5536bb610c70'} from 'ACTIONS_MODULE8'\nexport {recordDeliveryEvent as '404d6f2891af89c71d5bde33d110a216bdd3ee4729'} from 'ACTIONS_MODULE8'\nexport {getCompanyDomainsHealth as '405c57a8fed352b8679525b56014eb8c49105c850c'} from 'ACTIONS_MODULE8'\nexport {processResendWebhookEvent as '40ad037af6f6ab1a3004746d3a1b65afa65527002d'} from 'ACTIONS_MODULE8'\nexport {generateDeliverabilityReport as '40ecf2c792e84ef4b898fda98ec27277b4a9dddef2'} from 'ACTIONS_MODULE8'\nexport {resetHourlyCounters as '004cdde5e6ae8991bab4ba61ae40647c2b823200ba'} from 'ACTIONS_MODULE9'\nexport {resetDailyCounters as '006acf41615a2f7795c47b6d7a3016e18300f2ad17'} from 'ACTIONS_MODULE9'\nexport {incrementEmailCounter as '4029b163c1c0acfd806352a72fe8030c8ae4f7f8ac'} from 'ACTIONS_MODULE9'\nexport {getCompanyActiveDomain as '407a5a7d0a7dd7989a963eb2485a3527c1dcb20a70'} from 'ACTIONS_MODULE9'\nexport {checkRateLimit as '40af86a915f04df8d7cc189fe26e45e0cc24663080'} from 'ACTIONS_MODULE9'\nexport {isGmailIntegrationEnabled as '00fe74bdf14126b5ad89e9480e82978d6357f356b3'} from 'ACTIONS_MODULE10'\nexport {getUserGmailTokens as '400ce95360aaffa14a99dfdf969ba5166c69a59eb6'} from 'ACTIONS_MODULE10'\nexport {disconnectCompanyGmail as '401d3d830065dd7c4777fad67f642392f48735c4ab'} from 'ACTIONS_MODULE10'\nexport {disconnectUserGmail as '404575d602ef4c60c0058b592b8c3e42fbcd13fc4c'} from 'ACTIONS_MODULE10'\nexport {getCompanyEmailProvider as '40787b1598849126560f9f0b0f8fe8967338c7bf28'} from 'ACTIONS_MODULE10'\nexport {getCompanyGmailTokens as '40beeb56302a20d27cd8ba7a0988310f855633d7e6'} from 'ACTIONS_MODULE10'\nexport {refreshUserGmailToken as '602fab67313b110e6ccb66e54b1e16450b2a772cc7'} from 'ACTIONS_MODULE10'\nexport {sendCompanyGmailEmail as '60302947fc4caffa53a719728f3c2cebace926098c'} from 'ACTIONS_MODULE10'\nexport {syncUserInbox as '603643b13bf288cc628303bb4d12df0311b11434c7'} from 'ACTIONS_MODULE10'\nexport {checkCompanyGmailHealth as '60856182db5eaec7f85eda2a5a94c5d7d3524325d6'} from 'ACTIONS_MODULE10'\nexport {refreshCompanyGmailToken as '60eeb51685ac265a4ad793a230a515fe6e462f16f4'} from 'ACTIONS_MODULE10'\nexport {fetchUserInbox as '708daa303e36e37247e22b5b828b6aad8c73ac283b'} from 'ACTIONS_MODULE10'\nexport {setCompanyEmailProvider as '70dd3bc4222a87350dc137fa9cbcb849fa1913b397'} from 'ACTIONS_MODULE10'\nexport {storeGmailMessage as '78d41ef818e75fef94d65a87ea1f0faf418132e3c5'} from 'ACTIONS_MODULE10'\nexport {storeUserGmailTokens as '7e3a356960ddd52a3fa4dc6d981ae7202a59eb9a3d'} from 'ACTIONS_MODULE10'\nexport {storeCompanyGmailTokens as '7f06df826c4fff42950e712c0f548254e275be2a52'} from 'ACTIONS_MODULE10'\nexport {getProviderHealthDashboard as '00a122f9d5fe3a1603c636c3a251886129b66154f8'} from 'ACTIONS_MODULE11'\nexport {checkProviderAlert as '40c7885bdc4fe4cdd5f57e78579230c58088adbef4'} from 'ACTIONS_MODULE11'\nexport {cleanupOldEvents as '40d3c4ceeaee653aa257a28ed429a7fd272fa9fb66'} from 'ACTIONS_MODULE11'\nexport {recordProviderEvent as '40e06418f4b93b40c84a25511e0468e1e8a41ddecf'} from 'ACTIONS_MODULE11'\nexport {getProviderStats as '60c643a41ce1a8e6cc8338da6e2f3678c386910460'} from 'ACTIONS_MODULE11'\nexport {recordSendFailure as '78255c3fa8c9facf7c3f353202f2907836e8eb5539'} from 'ACTIONS_MODULE11'\nexport {recordSendSuccess as '783861d25688b32ba086bbe9e45444975c36a1b285'} from 'ACTIONS_MODULE11'\nexport {recordFallbackTriggered as '78766431b437b16f7cb00b4d64a2f3be5e092ed724'} from 'ACTIONS_MODULE11'\nexport {deleteNotification as '40fab1894acc5e3d1fdd8d8c6128a7cecee06e7e6a'} from 'ACTIONS_MODULE12'\nexport {markAllAsRead as '00cf212b0097820096122537beac12e3403b97d564'} from 'ACTIONS_MODULE12'\nexport {markAsRead as '4094cf679b4a10ca0f969f4fc1b55602aac4e0fbc3'} from 'ACTIONS_MODULE12'\nexport {makeCall as '40b2df540ec465c5dc19545c96486485bb50b5633b'} from 'ACTIONS_MODULE2'\nexport {getWebRTCCredentials as '000478fbf5363dae5000d525663da13e29908cb952'} from 'ACTIONS_MODULE2'\nexport {signOut as '0043ae510c3322ea499beb9e1bb77d06afb4ef19bd'} from 'ACTIONS_MODULE13'\nexport {switchCompany as '4097c3c574342661f9a3c8244961d001234449f36f'} from 'ACTIONS_MODULE14'\nexport {updateUserStatus as '4081009dd4dff14ff4ece62648bad23a83f2f9f63c'} from 'ACTIONS_MODULE15'\nexport {getTotalUnreadCountAction as '00ebc03a4ffc993aea7ec2e541686105c2bace2437'} from 'ACTIONS_MODULE16'\nexport {getCompanyPendingActions as '40e9589cb639f2902eb841bedc1247d966486d6fd7'} from 'ACTIONS_MODULE17'\nexport {checkIsCompanyOwner as '001be5cf82b793f19f6a7d010c91c14577fa7a130d'} from 'ACTIONS_MODULE17'\nexport {getCustomerByPhone as '6013add076e3eaed7dc37e8b800ce977d5abb8d49a'} from 'ACTIONS_MODULE18'\nexport {startCallRecording as '404e47931374ad2a1b54bc11f357703790f6104530'} from 'ACTIONS_MODULE2'\nexport {stopCallRecording as '40d5cc291162e2fd61245bdb851d5e8ed609e4ed19'} from 'ACTIONS_MODULE2'\nexport {deleteCustomer as '4082b52123c24a95685a53c36313418a95c259c65b'} from 'ACTIONS_MODULE18'\nexport {searchCustomers as '60193685409a9d118f1b364e14ecf57d05fa5638a9'} from 'ACTIONS_MODULE18'\nexport {getCustomersForDialer as '0077abd0cb1e555f91adaa482ad0b2f565bbd0629a'} from 'ACTIONS_MODULE18'\nexport {getPendingSupportSessions as '000f90f949d6a2f5484d061d5a738a59a8c846aeaa'} from 'ACTIONS_MODULE19'\nexport {getActiveSupportSessions as '00665c1bbcd52d612d5bb4bf3be5e7fc75554132e6'} from 'ACTIONS_MODULE19'\nexport {approveSupportSessionRequest as '602e89ae7ace85fc30cd3b4b1dd865d517c0cb1cd5'} from 'ACTIONS_MODULE19'\nexport {rejectSupportSessionRequest as '60886af124323873afd4d5b64bb4143abbcba2c154'} from 'ACTIONS_MODULE19'\nexport {endActiveSupportSession as '40369e8ea4eced7bdaef8203d369469ee7b630db8c'} from 'ACTIONS_MODULE19'\nexport {createEmailFolderAction as '408d3694fd0dd48e424f53c9bf5083b946ab3ec990'} from 'ACTIONS_MODULE20'\nexport {getEmailFolderCountsAction as '009e962eae57bf128b2023081fd7259048edd8884a'} from 'ACTIONS_MODULE16'\nexport {getEmailFoldersAction as '00235a0ba91f1ba226f33fa40dcf4c93a2c3548c70'} from 'ACTIONS_MODULE20'\nexport {deleteEmailFolderAction as '40c55f8e0922f2c7fd8d502e4c75395bf5f0470430'} from 'ACTIONS_MODULE20'\nexport {searchVendors as '404a3266e0319dbd8c24fec80bb69ecfe029d2a768'} from 'ACTIONS_MODULE21'\nexport {getSmsFolderCountsAction as '0006f7bd89b72f0836ec7bf4db73019f1b32e6c24a'} from 'ACTIONS_MODULE22'\nexport {autoLinkCommunicationAction as '403ea65f9c2fca71bfc045bb6385cb305ee814e033'} from 'ACTIONS_MODULE23'\nexport {getAutoLinkSuggestionsAction as '40cc931dda50eedd0e238813824fa3e4330a2065ab'} from 'ACTIONS_MODULE23'\nexport {markEmailAsReadAction as '406861cd5224a1d7b671811bfed22c95dd73829df5'} from 'ACTIONS_MODULE16'\nexport {archiveEmailAction as '40fce90de48a3dc3624e62d6ae8fe22c5d103d1f6b'} from 'ACTIONS_MODULE16'\nexport {toggleStarEmailAction as '4072a3f09fd79f89952570ec80a7c57e18f5dadea3'} from 'ACTIONS_MODULE16'\nexport {bulkDeleteEmailsAction as '4058cd3d49d375b37cef03bec92ad4d75901c4c01b'} from 'ACTIONS_MODULE16'\nexport {sendCustomerEmailAction as '405ece0ba656f365847d37de3eec9016362a453a0b'} from 'ACTIONS_MODULE23'\nexport {bulkArchiveCommunicationsAction as '601b5c8c5c1f2a7ed5d6b7f36740d1b6307dca9ea1'} from 'ACTIONS_MODULE23'\nexport {saveInternalNotesAction as '40e91d23e225ba475df77a0afd0fb155c8ac4c06d1'} from 'ACTIONS_MODULE23'\nexport {getCommunicationsAction as '402a04fabd7fa330b2e21dfee0fa6e944f68006a49'} from 'ACTIONS_MODULE23'\n"],"names":[],"mappings":"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"}