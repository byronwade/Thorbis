{"version":3,"sources":["../../../../../../apps/web/src/components/work/new/new-skeleton.tsx","../../../../../../apps/web/src/components/work/jobs/job-create-form.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/work/new/page.tsx","../../../../../../apps/web/src/components/work/jobs/job-new-data.tsx"],"sourcesContent":["/**\n * Skeleton UI for generic work \"new\" routes (e.g. appointments/contracts).\n * Used as a Suspense fallback while loading creation forms.\n */\nexport function WorkNewSkeleton() {\n\treturn (\n\t\t<div className=\"flex h-full flex-col gap-4 p-4\">\n\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t<div className=\"bg-muted h-8 w-64 animate-pulse rounded\" />\n\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t<div className=\"bg-muted h-8 w-24 animate-pulse rounded\" />\n\t\t\t\t\t<div className=\"bg-muted h-8 w-24 animate-pulse rounded\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"space-y-3\">\n\t\t\t\t{[...new Array(6)].map((_, index) => (\n\t\t\t\t\t<div className=\"space-y-2\" key={index}>\n\t\t\t\t\t\t<div className=\"bg-muted h-4 w-40 animate-pulse rounded\" />\n\t\t\t\t\t\t<div className=\"bg-muted h-9 w-full animate-pulse rounded\" />\n\t\t\t\t\t</div>\n\t\t\t\t))}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const JobCreateForm = registerClientReference(\n    function() { throw new Error(\"Attempted to call JobCreateForm() from the server but JobCreateForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/work/jobs/job-create-form.tsx\",\n    \"JobCreateForm\",\n);\n","/**\n * New Job Page - PPR Enabled\n *\n * Creates a new job/work order with optional pre-filled data from:\n * - Schedule (date, startTime, assignTo)\n * - Properties (propertyId)\n * - Customers (customerId)\n * - Equipment (equipmentId)\n * - Team members (teamMemberId)\n * - Clone from existing job (cloneFrom)\n */\n\nimport { Suspense } from \"react\";\nimport { JobNewData } from \"@/components/work/jobs/job-new-data\";\nimport { WorkNewSkeleton } from \"@/components/work/new/new-skeleton\";\n\ntype SearchParams = Promise<{\n\tdate?: string;\n\tstartTime?: string;\n\tassignTo?: string;\n\tpropertyId?: string;\n\tcustomerId?: string;\n\tequipmentId?: string;\n\tteamMemberId?: string;\n\tcloneFrom?: string;\n}>;\n\ntype PageProps = {\n\tsearchParams: SearchParams;\n};\n\nexport default async function WorkNewPage({ searchParams }: PageProps) {\n\tconst params = await searchParams;\n\n\treturn (\n\t\t<Suspense fallback={<WorkNewSkeleton />}>\n\t\t\t<JobNewData searchParams={params} />\n\t\t</Suspense>\n\t);\n}\n","import { notFound } from \"next/navigation\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { JobCreateForm } from \"./job-create-form\";\n\ntype SearchParams = {\n\tdate?: string;\n\tstartTime?: string;\n\tassignTo?: string;\n\tpropertyId?: string;\n\tcustomerId?: string;\n\tequipmentId?: string;\n\tteamMemberId?: string;\n\tcloneFrom?: string;\n};\n\nexport async function JobNewData({\n\tsearchParams,\n}: {\n\tsearchParams: SearchParams;\n}) {\n\tconst supabase = await createClient();\n\tif (!supabase) {\n\t\treturn notFound();\n\t}\n\n\tconst {\n\t\tdata: { user },\n\t} = await supabase.auth.getUser();\n\tif (!user) {\n\t\treturn notFound();\n\t}\n\n\tconst activeCompanyId = await getActiveCompanyId();\n\tif (!activeCompanyId) {\n\t\treturn notFound();\n\t}\n\n\t// Load customers\n\tconst { data: customers } = await supabase\n\t\t.from(\"customers\")\n\t\t.select(\"id, first_name, last_name, display_name, email, phone\")\n\t\t.eq(\"company_id\", activeCompanyId)\n\t\t.is(\"deleted_at\", null)\n\t\t.order(\"display_name\")\n\t\t.limit(100);\n\n\t// Load properties\n\tconst { data: properties } = await supabase\n\t\t.from(\"properties\")\n\t\t.select(\"id, customer_id, address, city, state, zip_code\")\n\t\t.eq(\"company_id\", activeCompanyId)\n\t\t.is(\"deleted_at\", null)\n\t\t.order(\"address\")\n\t\t.limit(500);\n\n\t// Load team members for assignment\n\tconst { data: teamMembers } = await supabase\n\t\t.from(\"team_members\")\n\t\t.select(\"id, user_id, job_title, profiles!inner(id, full_name, email)\")\n\t\t.eq(\"company_id\", activeCompanyId)\n\t\t.eq(\"status\", \"active\")\n\t\t.limit(100);\n\n\t// If cloning from existing job, load that job's data\n\tlet cloneJobData = null;\n\tif (searchParams.cloneFrom) {\n\t\tconst { data: existingJob } = await supabase\n\t\t\t.from(\"jobs\")\n\t\t\t.select(\n\t\t\t\t`\n\t\t\t\tid,\n\t\t\t\ttitle,\n\t\t\t\tdescription,\n\t\t\t\tpriority,\n\t\t\t\tjob_type,\n\t\t\t\tcustomer_id,\n\t\t\t\tproperty_id,\n\t\t\t\tnotes\n\t\t\t`,\n\t\t\t)\n\t\t\t.eq(\"id\", searchParams.cloneFrom)\n\t\t\t.eq(\"company_id\", activeCompanyId)\n\t\t\t.single();\n\n\t\tif (existingJob) {\n\t\t\tcloneJobData = existingJob;\n\t\t}\n\t}\n\n\t// If we have a specific customer, pre-select their properties\n\tconst preSelectedCustomerId =\n\t\tsearchParams.customerId || cloneJobData?.customer_id;\n\tconst preSelectedPropertyId =\n\t\tsearchParams.propertyId || cloneJobData?.property_id;\n\n\t// If assignTo is provided, try to find the team member\n\tconst preSelectedAssignee =\n\t\tsearchParams.assignTo || searchParams.teamMemberId;\n\n\t// Build scheduled time from date and startTime params\n\tlet scheduledStart: string | undefined;\n\tif (searchParams.date) {\n\t\tconst dateStr = searchParams.date;\n\t\tconst timeStr = searchParams.startTime || \"09:00\";\n\t\tscheduledStart = `${dateStr}T${timeStr}:00`;\n\t}\n\n\treturn (\n\t\t<JobCreateForm\n\t\t\tcustomers={customers || []}\n\t\t\tproperties={properties || []}\n\t\t\tteamMembers={\n\t\t\t\tteamMembers?.map((tm) => ({\n\t\t\t\t\tid: tm.id,\n\t\t\t\t\tuserId: tm.user_id,\n\t\t\t\t\tname:\n\t\t\t\t\t\t(tm.profiles as any)?.full_name ||\n\t\t\t\t\t\t(tm.profiles as any)?.email ||\n\t\t\t\t\t\t\"Unknown\",\n\t\t\t\t\tjobTitle: tm.job_title,\n\t\t\t\t})) || []\n\t\t\t}\n\t\t\tdefaultValues={{\n\t\t\t\tcustomerId: preSelectedCustomerId,\n\t\t\t\tpropertyId: preSelectedPropertyId,\n\t\t\t\tassignedTo: preSelectedAssignee,\n\t\t\t\tscheduledStart,\n\t\t\t\ttitle: cloneJobData?.title ? `${cloneJobData.title} (Copy)` : undefined,\n\t\t\t\tdescription: cloneJobData?.description,\n\t\t\t\tpriority: cloneJobData?.priority || \"medium\",\n\t\t\t\tjobType: cloneJobData?.job_type,\n\t\t\t\tnotes: cloneJobData?.notes,\n\t\t\t}}\n\t\t/>\n\t);\n}\n"],"names":[],"mappings":"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","ignoreList":[1]}