{"version":3,"sources":["../../../../../../apps/web/src/components/layout/toolbar-stats-provider.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/lib/queries/stats-utils.ts","../../../../../../apps/web/src/components/layout/toolbar-actions-provider.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/lib/queries/customers.ts","../../../../../../apps/web/src/components/customers/customer-page-content.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/customers/%5Bid%5D/page.tsx","../../../../../../apps/web/src/components/customers/customer-detail-data.tsx","../../../../../../apps/web/src/components/customers/customer-detail-skeleton.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ToolbarStatsProvider = registerClientReference(\n    function() { throw new Error(\"Attempted to call ToolbarStatsProvider() from the server but ToolbarStatsProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/layout/toolbar-stats-provider.tsx\",\n    \"ToolbarStatsProvider\",\n);\n","/**\n * Statistics Utilities\n *\n * Helper functions to generate StatCard arrays from entity metrics\n * Used to generate toolbar stats from various entity types\n */\n\nimport type { StatCard } from \"@/components/ui/stats-cards\";\n\n/**\n * Format currency from cents to string\n */\nfunction formatCurrency(cents: number): string {\n\treturn new Intl.NumberFormat(\"en-US\", {\n\t\tstyle: \"currency\",\n\t\tcurrency: \"USD\",\n\t\tminimumFractionDigits: 0,\n\t\tmaximumFractionDigits: 0,\n\t}).format(cents / 100);\n}\n\n/**\n * Format hours to string\n */\nfunction formatHours(hours: number): string {\n\treturn `${hours.toFixed(1)}h`;\n}\n\n/**\n * Format percentage to string\n */\nfunction formatPercentage(value: number): string {\n\treturn `${value.toFixed(0)}%`;\n}\n\n/**\n * Generate job stats from metrics\n */\nfunction generateJobStats(metrics: {\n\ttotalAmount: number; // in cents\n\tpaidAmount: number; // in cents\n\ttotalLaborHours: number; // decimal hours\n\testimatedLaborHours: number; // decimal hours\n\tmaterialsCost: number; // in cents\n\tprofitMargin: number; // percentage\n\tcompletionPercentage: number; // 0-100\n\tstatus: string;\n}): StatCard[] {\n\t// Calculate outstanding balance\n\tconst outstanding = metrics.totalAmount - metrics.paidAmount;\n\n\t// Calculate profit (revenue minus costs)\n\tconst estimatedProfit = metrics.totalAmount - metrics.materialsCost;\n\tconst profitMarginCalc =\n\t\tmetrics.totalAmount > 0\n\t\t\t? ((estimatedProfit / metrics.totalAmount) * 100).toFixed(0)\n\t\t\t: 0;\n\n\t// Calculate labor efficiency (actual vs estimated)\n\tconst laborEfficiency =\n\t\tmetrics.estimatedLaborHours > 0\n\t\t\t? (\n\t\t\t\t\t(metrics.totalLaborHours / metrics.estimatedLaborHours) * 100 -\n\t\t\t\t\t100\n\t\t\t\t).toFixed(0)\n\t\t\t: 0;\n\n\treturn [\n\t\t{\n\t\t\tlabel: \"Job Value\",\n\t\t\tvalue: formatCurrency(metrics.totalAmount),\n\t\t\tchange:\n\t\t\t\toutstanding > 0\n\t\t\t\t\t? Number((-((outstanding / metrics.totalAmount) * 100)).toFixed(2))\n\t\t\t\t\t: undefined,\n\t\t\tchangeLabel:\n\t\t\t\toutstanding > 0 ? `${formatCurrency(outstanding)} due` : \"paid in full\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Labor Hours\",\n\t\t\tvalue: formatHours(metrics.totalLaborHours),\n\t\t\tchange: metrics.estimatedLaborHours > 0 ? Number(laborEfficiency) : 0,\n\t\t\tchangeLabel:\n\t\t\t\tmetrics.estimatedLaborHours > 0\n\t\t\t\t\t? `vs ${formatHours(metrics.estimatedLaborHours)} est`\n\t\t\t\t\t: \"no estimate\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Profitability\",\n\t\t\tvalue: formatCurrency(estimatedProfit),\n\t\t\tchange: Number(profitMarginCalc),\n\t\t\tchangeLabel: `${profitMarginCalc}% margin`,\n\t\t},\n\t\t{\n\t\t\tlabel: \"Progress\",\n\t\t\tvalue: formatPercentage(metrics.completionPercentage),\n\t\t\tchange: metrics.completionPercentage === 100 ? 100 : undefined,\n\t\t\tchangeLabel: metrics.status,\n\t\t},\n\t];\n}\n\n/**\n * Generate customer stats from metrics\n */\nexport function generateCustomerStats(metrics: {\n\ttotalRevenue: number; // in cents\n\ttotalJobs: number;\n\ttotalProperties: number;\n\toutstandingBalance: number; // in cents\n}): StatCard[] {\n\treturn [\n\t\t{\n\t\t\tlabel: \"Total Revenue\",\n\t\t\tvalue: formatCurrency(metrics.totalRevenue),\n\t\t\tchange: undefined, // Cumulative stat - no period comparison\n\t\t\tchangeLabel: \"all time\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Jobs\",\n\t\t\tvalue: metrics.totalJobs.toString(),\n\t\t\tchange: undefined, // Cumulative stat - no period comparison\n\t\t\tchangeLabel: \"total\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Properties\",\n\t\t\tvalue: metrics.totalProperties.toString(),\n\t\t\tchange: 0,\n\t\t\tchangeLabel: \"locations\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Outstanding\",\n\t\t\tvalue: formatCurrency(metrics.outstandingBalance),\n\t\t\tchange: metrics.outstandingBalance > 0 ? -1 : 0, // Negative if balance exists\n\t\t\tchangeLabel: \"balance due\",\n\t\t},\n\t];\n}\n\n/**\n * Format relative date string\n */\nfunction formatDate(dateString: string | null): string {\n\tif (!dateString) {\n\t\treturn \"Never\";\n\t}\n\tconst date = new Date(dateString);\n\tconst now = new Date();\n\tconst diffTime = now.getTime() - date.getTime();\n\tconst diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\n\n\tif (diffDays === 0) {\n\t\treturn \"Today\";\n\t}\n\tif (diffDays === 1) {\n\t\treturn \"Yesterday\";\n\t}\n\tif (diffDays < 7) {\n\t\treturn `${diffDays} days ago`;\n\t}\n\tif (diffDays < 30) {\n\t\treturn `${Math.floor(diffDays / 7)} weeks ago`;\n\t}\n\tif (diffDays < 365) {\n\t\treturn `${Math.floor(diffDays / 30)} months ago`;\n\t}\n\treturn `${Math.floor(diffDays / 365)} years ago`;\n}\n\n/**\n * Format next scheduled date\n */\nfunction formatNextScheduled(dateString: string | null): string {\n\tif (!dateString) {\n\t\treturn \"Not scheduled\";\n\t}\n\tconst date = new Date(dateString);\n\tconst now = new Date();\n\tconst diffTime = date.getTime() - now.getTime();\n\tconst diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\n\n\tif (diffDays < 0) {\n\t\treturn \"Overdue\";\n\t}\n\tif (diffDays === 0) {\n\t\treturn \"Today\";\n\t}\n\tif (diffDays === 1) {\n\t\treturn \"Tomorrow\";\n\t}\n\tif (diffDays < 7) {\n\t\treturn `In ${diffDays} days`;\n\t}\n\tif (diffDays < 30) {\n\t\treturn `In ${Math.floor(diffDays / 7)} weeks`;\n\t}\n\treturn date.toLocaleDateString(undefined, {\n\t\tmonth: \"short\",\n\t\tday: \"numeric\",\n\t});\n}\n\n/**\n * Generate property stats from metrics\n */\nexport function generatePropertyStats(metrics: {\n\ttotalJobs: number;\n\tactiveJobs: number;\n\ttotalRevenue: number; // in cents\n\tlastServiceDate: string | null;\n\tnextScheduledDate: string | null;\n\tequipmentCount: number;\n}): StatCard[] {\n\tconst jobActivityChange = metrics.activeJobs > 0 ? 100 : 0;\n\n\treturn [\n\t\t{\n\t\t\tlabel: \"Total Jobs\",\n\t\t\tvalue: metrics.totalJobs.toString(),\n\t\t\tchange: metrics.activeJobs > 0 ? jobActivityChange : undefined,\n\t\t\tchangeLabel:\n\t\t\t\tmetrics.activeJobs > 0\n\t\t\t\t\t? `${metrics.activeJobs} active`\n\t\t\t\t\t: \"no active jobs\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Total Revenue\",\n\t\t\tvalue: formatCurrency(metrics.totalRevenue),\n\t\t\tchange: metrics.totalRevenue > 0 ? undefined : 0,\n\t\t\tchangeLabel:\n\t\t\t\tmetrics.totalJobs > 0\n\t\t\t\t\t? `${metrics.totalJobs} job${metrics.totalJobs !== 1 ? \"s\" : \"\"}`\n\t\t\t\t\t: \"no jobs yet\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Last Service\",\n\t\t\tvalue: formatDate(metrics.lastServiceDate),\n\t\t\tchange: undefined,\n\t\t\tchangeLabel: metrics.lastServiceDate ? \"completed\" : \"no history\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Next Scheduled\",\n\t\t\tvalue: formatNextScheduled(metrics.nextScheduledDate),\n\t\t\tchange: metrics.nextScheduledDate ? 100 : undefined,\n\t\t\tchangeLabel: metrics.equipmentCount\n\t\t\t\t? `${metrics.equipmentCount} equipment`\n\t\t\t\t: \"no equipment\",\n\t\t},\n\t];\n}\n\n/**\n * Calculate days until due date\n */\nfunction daysUntilDue(dueDate: string | null): number | null {\n\tif (!dueDate) {\n\t\treturn null;\n\t}\n\tconst due = new Date(dueDate);\n\tconst now = new Date();\n\tconst diffTime = due.getTime() - now.getTime();\n\treturn Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n}\n\n/**\n * Generate invoice stats from metrics\n */\nexport function generateInvoiceStats(metrics: {\n\ttotalAmount: number; // in cents\n\tpaidAmount: number; // in cents\n\tbalanceAmount: number; // in cents\n\tdueDate: string | null;\n\tstatus: string;\n\tcreatedAt: string;\n}): StatCard[] {\n\t// Calculate percentage paid\n\tconst percentPaid =\n\t\tmetrics.totalAmount > 0\n\t\t\t? Math.round((metrics.paidAmount / metrics.totalAmount) * 100)\n\t\t\t: 0;\n\n\tconst days = daysUntilDue(metrics.dueDate);\n\tconst isOverdue = days !== null && days < 0;\n\n\treturn [\n\t\t{\n\t\t\tlabel: \"Total Amount\",\n\t\t\tvalue: formatCurrency(metrics.totalAmount),\n\t\t},\n\t\t{\n\t\t\tlabel: \"Paid\",\n\t\t\tvalue: formatCurrency(metrics.paidAmount),\n\t\t\tchange: percentPaid,\n\t\t\tchangeLabel: `${percentPaid}% paid`,\n\t\t},\n\t\t{\n\t\t\tlabel: \"Balance Due\",\n\t\t\tvalue: formatCurrency(metrics.balanceAmount),\n\t\t\tchange: metrics.balanceAmount > 0 ? -1 : 1,\n\t\t},\n\t\t{\n\t\t\tlabel: \"Due Date\",\n\t\t\tvalue: metrics.dueDate\n\t\t\t\t? new Date(metrics.dueDate).toLocaleDateString(\"en-US\", {\n\t\t\t\t\t\tmonth: \"short\",\n\t\t\t\t\t\tday: \"numeric\",\n\t\t\t\t\t\tyear: \"numeric\",\n\t\t\t\t\t})\n\t\t\t\t: \"Not set\",\n\t\t\tchangeLabel:\n\t\t\t\tdays !== null\n\t\t\t\t\t? isOverdue\n\t\t\t\t\t\t? `${Math.abs(days)} days overdue`\n\t\t\t\t\t\t: `${days} days remaining`\n\t\t\t\t\t: undefined,\n\t\t\tchange: isOverdue ? -1 : days !== null && days <= 7 ? 0 : 1,\n\t\t},\n\t];\n}\n\n/**\n * Format valid until date for estimates\n */\nfunction formatValidUntil(\n\tdateString: string | null,\n\tdaysUntil: number | null,\n): string {\n\tif (!dateString) {\n\t\treturn \"No expiry\";\n\t}\n\tif (daysUntil === null) {\n\t\treturn \"No expiry\";\n\t}\n\tif (daysUntil < 0) {\n\t\treturn \"Expired\";\n\t}\n\tif (daysUntil === 0) {\n\t\treturn \"Expires today\";\n\t}\n\tif (daysUntil === 1) {\n\t\treturn \"Expires tomorrow\";\n\t}\n\tif (daysUntil < 7) {\n\t\treturn `${daysUntil} days left`;\n\t}\n\treturn new Date(dateString).toLocaleDateString(undefined, {\n\t\tmonth: \"short\",\n\t\tday: \"numeric\",\n\t});\n}\n\n/**\n * Generate estimate stats from metrics\n */\nexport function generateEstimateStats(metrics: {\n\ttotalAmount: number; // in cents\n\tlineItemsCount: number;\n\tstatus: string;\n\tvalidUntil: string | null;\n\tdaysUntilExpiry: number | null;\n\tisAccepted: boolean;\n}): StatCard[] {\n\tconst statusMap: Record<\n\t\tstring,\n\t\t{ change: number | undefined; label: string }\n\t> = {\n\t\tdraft: { change: undefined, label: \"not sent\" },\n\t\tsent: { change: 50, label: \"awaiting response\" },\n\t\taccepted: { change: 100, label: \"customer approved\" },\n\t\trejected: { change: 0, label: \"declined\" },\n\t};\n\tconst statusInfo = statusMap[metrics.status.toLowerCase()] || {\n\t\tchange: undefined,\n\t\tlabel: metrics.status,\n\t};\n\n\treturn [\n\t\t{\n\t\t\tlabel: \"Estimate Value\",\n\t\t\tvalue: formatCurrency(metrics.totalAmount),\n\t\t\tchange: metrics.isAccepted ? 100 : undefined,\n\t\t\tchangeLabel: metrics.isAccepted\n\t\t\t\t? \"accepted\"\n\t\t\t\t: `${metrics.lineItemsCount} item${metrics.lineItemsCount !== 1 ? \"s\" : \"\"}`,\n\t\t},\n\t\t{\n\t\t\tlabel: \"Line Items\",\n\t\t\tvalue: metrics.lineItemsCount.toString(),\n\t\t\tchange: metrics.lineItemsCount > 0 ? undefined : 0,\n\t\t\tchangeLabel:\n\t\t\t\tmetrics.totalAmount > 0\n\t\t\t\t\t? formatCurrency(metrics.totalAmount)\n\t\t\t\t\t: \"no items\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Status\",\n\t\t\tvalue: metrics.status,\n\t\t\tchange: statusInfo.change,\n\t\t\tchangeLabel: statusInfo.label,\n\t\t},\n\t\t{\n\t\t\tlabel: \"Valid Until\",\n\t\t\tvalue: formatValidUntil(metrics.validUntil, metrics.daysUntilExpiry),\n\t\t\tchange:\n\t\t\t\tmetrics.daysUntilExpiry !== null && metrics.daysUntilExpiry >= 0\n\t\t\t\t\t? metrics.daysUntilExpiry < 7\n\t\t\t\t\t\t? 0\n\t\t\t\t\t\t: undefined\n\t\t\t\t\t: undefined,\n\t\t\tchangeLabel:\n\t\t\t\tmetrics.validUntil && metrics.daysUntilExpiry !== null\n\t\t\t\t\t? metrics.daysUntilExpiry < 0\n\t\t\t\t\t\t? \"expired\"\n\t\t\t\t\t\t: metrics.daysUntilExpiry === 0\n\t\t\t\t\t\t\t? \"today\"\n\t\t\t\t\t\t\t: \"valid\"\n\t\t\t\t\t: \"no limit\",\n\t\t},\n\t];\n}\n\n/**\n * Generate appointment stats from metrics\n */\nexport function generateAppointmentStats(metrics: {\n\tduration: number; // minutes\n\ttravelTime: number; // minutes\n\tteamMemberCount: number;\n\tjobValue: number; // in cents\n}): StatCard[] {\n\treturn [\n\t\t{\n\t\t\tlabel: \"Duration\",\n\t\t\tvalue: `${Math.floor(metrics.duration / 60)}h ${metrics.duration % 60}m`,\n\t\t\tchange: undefined,\n\t\t},\n\t\t{\n\t\t\tlabel: \"Travel Time\",\n\t\t\tvalue: metrics.travelTime > 0 ? `${metrics.travelTime}m` : \"N/A\",\n\t\t\tchange: undefined,\n\t\t},\n\t\t{\n\t\t\tlabel: \"Team Members\",\n\t\t\tvalue: (metrics.teamMemberCount ?? 0).toString(),\n\t\t\tchange: undefined,\n\t\t},\n\t\t{\n\t\t\tlabel: \"Job Value\",\n\t\t\tvalue: formatCurrency(metrics.jobValue),\n\t\t\tchange: metrics.jobValue > 100_000 ? 10 : undefined,\n\t\t},\n\t];\n}\n\n/**\n * Generate material stats from metrics\n */\nexport function generateMaterialStats(metrics: {\n\tquantityOnHand: number;\n\tquantityReserved: number;\n\tquantityAvailable: number;\n\tminimumQuantity: number;\n\treorderPoint?: number | null;\n\ttotalValue: number; // in cents\n\tstatus: string;\n}): StatCard[] {\n\tconst availabilityChange =\n\t\tmetrics.minimumQuantity > 0\n\t\t\t? Math.round(\n\t\t\t\t\t((metrics.quantityAvailable - metrics.minimumQuantity) /\n\t\t\t\t\t\tmetrics.minimumQuantity) *\n\t\t\t\t\t\t100,\n\t\t\t\t)\n\t\t\t: undefined;\n\n\tconst reservedPercent =\n\t\tmetrics.quantityOnHand > 0 && metrics.quantityReserved > 0\n\t\t\t? Math.round((-metrics.quantityReserved / metrics.quantityOnHand) * 100)\n\t\t\t: undefined;\n\n\treturn [\n\t\t{\n\t\t\tlabel: \"On Hand\",\n\t\t\tvalue: metrics.quantityOnHand,\n\t\t\tchangeLabel: \"total units\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Available\",\n\t\t\tvalue: metrics.quantityAvailable,\n\t\t\tchange: availabilityChange,\n\t\t\tchangeLabel:\n\t\t\t\tmetrics.minimumQuantity > 0\n\t\t\t\t\t? `vs min ${metrics.minimumQuantity}`\n\t\t\t\t\t: \"available units\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Reserved\",\n\t\t\tvalue: metrics.quantityReserved,\n\t\t\tchange: reservedPercent,\n\t\t\tchangeLabel: \"allocated\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Inventory Value\",\n\t\t\tvalue: formatCurrency(metrics.totalValue),\n\t\t\tchangeLabel: \"at cost\",\n\t\t},\n\t];\n}\n\n/**\n * Generate purchase order stats from metrics\n */\nexport function generatePurchaseOrderStats(metrics: {\n\ttotalAmount: number; // in cents\n\tlineItemCount: number;\n\tstatus: string;\n\tdaysUntilDelivery?: number;\n}): StatCard[] {\n\treturn [\n\t\t{\n\t\t\tlabel: \"Total Amount\",\n\t\t\tvalue: formatCurrency(metrics.totalAmount),\n\t\t\tchange: undefined,\n\t\t},\n\t\t{\n\t\t\tlabel: \"Line Items\",\n\t\t\tvalue: metrics.lineItemCount.toString(),\n\t\t\tchange: undefined,\n\t\t},\n\t\t{\n\t\t\tlabel: \"Status\",\n\t\t\tvalue: metrics.status,\n\t\t\tchange: undefined,\n\t\t},\n\t\t{\n\t\t\tlabel: \"Delivery\",\n\t\t\tvalue:\n\t\t\t\tmetrics.daysUntilDelivery !== undefined\n\t\t\t\t\t? metrics.daysUntilDelivery > 0\n\t\t\t\t\t\t? `${metrics.daysUntilDelivery} days`\n\t\t\t\t\t\t: \"Today\"\n\t\t\t\t\t: \"Not set\",\n\t\t\tchange: undefined,\n\t\t},\n\t];\n}\n\n/**\n * Generate team member stats from metrics (simple version)\n */\nexport function generateTeamMemberStatsSimple(metrics: {\n\ttotalJobs: number;\n\thoursWorked: number;\n\trevenueGenerated: number; // in cents\n\tcustomerRating: number;\n\tjobsTrend?: number;\n\thoursTrend?: number;\n\trevenueTrend?: number;\n}): StatCard[] {\n\treturn [\n\t\t{\n\t\t\tlabel: \"Total Jobs\",\n\t\t\tvalue: metrics.totalJobs.toString(),\n\t\t\tchange: metrics.jobsTrend || 0,\n\t\t\tchangeLabel: \"vs last month\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Hours Worked\",\n\t\t\tvalue: formatHours(metrics.hoursWorked),\n\t\t\tchange: metrics.hoursTrend || 0,\n\t\t\tchangeLabel: \"vs last month\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Revenue Generated\",\n\t\t\tvalue: formatCurrency(metrics.revenueGenerated),\n\t\t\tchange: metrics.revenueTrend || 0,\n\t\t\tchangeLabel: \"vs last month\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Rating\",\n\t\t\tvalue:\n\t\t\t\tmetrics.customerRating > 0 ? metrics.customerRating.toFixed(1) : \"N/A\",\n\t\t\tchange: 0,\n\t\t\tchangeLabel: \"customer rating\",\n\t\t},\n\t];\n}\n\n/**\n * Generate contract stats from metrics\n */\nfunction generateContractStats(metrics: {\n\tstatus: string;\n\tsignedAt?: string | null;\n\tsentAt?: string | null;\n\tviewedAt?: string | null;\n\tvalidUntil?: string | null;\n}): StatCard[] {\n\tconst now = new Date();\n\tconst validUntil = metrics.validUntil ? new Date(metrics.validUntil) : null;\n\tconst daysUntilExpiry = validUntil\n\t\t? Math.ceil((validUntil.getTime() - now.getTime()) / (1000 * 60 * 60 * 24))\n\t\t: null;\n\n\treturn [\n\t\t{\n\t\t\tlabel: \"Status\",\n\t\t\tvalue: metrics.status.charAt(0).toUpperCase() + metrics.status.slice(1),\n\t\t\tchange: undefined,\n\t\t},\n\t\t...(metrics.signedAt\n\t\t\t? [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: \"Signed\",\n\t\t\t\t\t\tvalue: new Date(metrics.signedAt).toLocaleDateString(),\n\t\t\t\t\t\tchange: undefined,\n\t\t\t\t\t},\n\t\t\t\t]\n\t\t\t: []),\n\t\t...(metrics.sentAt && !metrics.signedAt\n\t\t\t? [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: \"Sent\",\n\t\t\t\t\t\tvalue: new Date(metrics.sentAt).toLocaleDateString(),\n\t\t\t\t\t\tchange: undefined,\n\t\t\t\t\t},\n\t\t\t\t]\n\t\t\t: []),\n\t\t...(validUntil\n\t\t\t? [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: \"Expires\",\n\t\t\t\t\t\tvalue:\n\t\t\t\t\t\t\tdaysUntilExpiry !== null\n\t\t\t\t\t\t\t\t? daysUntilExpiry > 0\n\t\t\t\t\t\t\t\t\t? `${daysUntilExpiry} days`\n\t\t\t\t\t\t\t\t\t: daysUntilExpiry === 0\n\t\t\t\t\t\t\t\t\t\t? \"Today\"\n\t\t\t\t\t\t\t\t\t\t: \"Expired\"\n\t\t\t\t\t\t\t\t: \"Not set\",\n\t\t\t\t\t\tchange:\n\t\t\t\t\t\t\tdaysUntilExpiry !== null && daysUntilExpiry < 7 ? -5 : undefined,\n\t\t\t\t\t},\n\t\t\t\t]\n\t\t\t: []),\n\t];\n}\n\n/**\n * Generate payment stats from metrics\n */\nexport function generatePaymentStats(metrics: {\n\tamount: number; // in cents\n\tstatus: string;\n\tpaymentMethod: string;\n\tpaymentType: string;\n\tcreatedAt: string;\n\tprocessedAt?: string | null;\n\trefundedAmount?: number; // in cents\n}): StatCard[] {\n\tconst _now = new Date();\n\tconst createdAt = new Date(metrics.createdAt);\n\tconst processedAt = metrics.processedAt\n\t\t? new Date(metrics.processedAt)\n\t\t: null;\n\n\t// Calculate processing time if processed\n\tconst processingTime = processedAt\n\t\t? Math.floor((processedAt.getTime() - createdAt.getTime()) / (1000 * 60)) // minutes\n\t\t: null;\n\n\tconst isRefunded = (metrics.refundedAmount || 0) > 0;\n\tconst netAmount = metrics.amount - (metrics.refundedAmount || 0);\n\n\treturn [\n\t\t{\n\t\t\tlabel: \"Payment Amount\",\n\t\t\tvalue: formatCurrency(metrics.amount),\n\t\t\tchange: isRefunded ? -1 : metrics.amount > 0 ? 100 : undefined,\n\t\t\tchangeLabel: isRefunded\n\t\t\t\t? `${formatCurrency(metrics.refundedAmount || 0)} refunded`\n\t\t\t\t: \"received\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Net Amount\",\n\t\t\tvalue: formatCurrency(netAmount),\n\t\t\tchange: isRefunded ? -1 : undefined,\n\t\t\tchangeLabel: isRefunded ? \"after refund\" : \"processed\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Status\",\n\t\t\tvalue: metrics.status,\n\t\t\tchange: metrics.status === \"completed\" ? 100 : undefined,\n\t\t\tchangeLabel: metrics.status === \"completed\" ? \"successful\" : \"pending\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Processing Time\",\n\t\t\tvalue:\n\t\t\t\tprocessingTime !== null\n\t\t\t\t\t? processingTime < 60\n\t\t\t\t\t\t? `${processingTime}m`\n\t\t\t\t\t\t: `${Math.floor(processingTime / 60)}h ${processingTime % 60}m`\n\t\t\t\t\t: \"Not processed\",\n\t\t\tchange: processingTime !== null && processingTime < 30 ? 100 : undefined,\n\t\t\tchangeLabel:\n\t\t\t\tprocessingTime !== null\n\t\t\t\t\t? `from ${createdAt.toLocaleDateString()}`\n\t\t\t\t\t: \"awaiting processing\",\n\t\t},\n\t];\n}\n\n/**\n * Generate team member stats from metrics (detailed version)\n */\nfunction generateTeamMemberStats(\n\tmetrics:\n\t\t| {\n\t\t\t\tactiveJobsCount: number;\n\t\t\t\thoursThisMonth: number;\n\t\t\t\tcompletionRate: number;\n\t\t\t\tavailableHours: number;\n\t\t\t\ttotalTasksCompleted: number;\n\t\t\t\ttotalTasks: number;\n\t\t\t\taverageHoursPerMonth: number;\n\t\t  }\n\t\t| {\n\t\t\t\ttotalJobs: number;\n\t\t\t\ttotalHours: number;\n\t\t\t\tactiveCertifications: number;\n\t\t\t\ttotalCertifications: number;\n\t\t\t\tcompletedJobs: number;\n\t\t\t\tactiveJobs: number;\n\t\t  },\n): StatCard[] {\n\t// Check which metrics format we have\n\tif (\"activeJobsCount\" in metrics) {\n\t\t// Original detailed version\n\t\tconst hoursVsAverage =\n\t\t\tmetrics.averageHoursPerMonth > 0\n\t\t\t\t? (\n\t\t\t\t\t\t((metrics.hoursThisMonth - metrics.averageHoursPerMonth) /\n\t\t\t\t\t\t\tmetrics.averageHoursPerMonth) *\n\t\t\t\t\t\t100\n\t\t\t\t\t).toFixed(0)\n\t\t\t\t: 0;\n\n\t\tconst completionRateCalc =\n\t\t\tmetrics.totalTasks > 0\n\t\t\t\t? ((metrics.totalTasksCompleted / metrics.totalTasks) * 100).toFixed(0)\n\t\t\t\t: 0;\n\n\t\tconst availabilityStatus =\n\t\t\tmetrics.availableHours > 0 ? \"available\" : \"fully booked\";\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tlabel: \"Active Jobs\",\n\t\t\t\tvalue: metrics.activeJobsCount.toString(),\n\t\t\t\tchange: metrics.activeJobsCount > 0 ? 12.5 : undefined,\n\t\t\t\tchangeLabel:\n\t\t\t\t\tmetrics.activeJobsCount > 0\n\t\t\t\t\t\t? \"currently assigned\"\n\t\t\t\t\t\t: \"no active assignments\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: \"Hours This Month\",\n\t\t\t\tvalue: formatHours(metrics.hoursThisMonth),\n\t\t\t\tchange:\n\t\t\t\t\tmetrics.averageHoursPerMonth > 0 ? Number(hoursVsAverage) : undefined,\n\t\t\t\tchangeLabel:\n\t\t\t\t\tmetrics.averageHoursPerMonth > 0\n\t\t\t\t\t\t? `vs ${formatHours(metrics.averageHoursPerMonth)} avg`\n\t\t\t\t\t\t: \"first month\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: \"Completion Rate\",\n\t\t\t\tvalue: formatPercentage(metrics.completionRate),\n\t\t\t\tchange: metrics.completionRate >= 90 ? Number(completionRateCalc) : 0,\n\t\t\t\tchangeLabel: `${metrics.totalTasksCompleted} / ${metrics.totalTasks} tasks`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: \"Availability\",\n\t\t\t\tvalue: formatHours(metrics.availableHours),\n\t\t\t\tchange: metrics.availableHours > 0 ? undefined : 0,\n\t\t\t\tchangeLabel: availabilityStatus,\n\t\t\t},\n\t\t];\n\t}\n\t// Simplified version for detail pages\n\tconst _completionRate =\n\t\tmetrics.totalJobs > 0\n\t\t\t? Math.round((metrics.completedJobs / metrics.totalJobs) * 100)\n\t\t\t: 0;\n\n\treturn [\n\t\t{\n\t\t\tlabel: \"Active Jobs\",\n\t\t\tvalue: metrics.activeJobs.toString(),\n\t\t\tchange: metrics.activeJobs > 0 ? undefined : 0,\n\t\t\tchangeLabel:\n\t\t\t\tmetrics.activeJobs > 0 ? \"currently assigned\" : \"no active assignments\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Total Jobs\",\n\t\t\tvalue: metrics.totalJobs.toString(),\n\t\t\tchange: 0,\n\t\t\tchangeLabel: \"all time\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Hours Worked\",\n\t\t\tvalue: formatHours(metrics.totalHours),\n\t\t\tchange: 0,\n\t\t\tchangeLabel: \"lifetime\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Certifications\",\n\t\t\tvalue: `${metrics.activeCertifications}/${metrics.totalCertifications}`,\n\t\t\tchange:\n\t\t\t\tmetrics.activeCertifications === metrics.totalCertifications\n\t\t\t\t\t? 100\n\t\t\t\t\t: metrics.activeCertifications > 0\n\t\t\t\t\t\t? undefined\n\t\t\t\t\t\t: 0,\n\t\t\tchangeLabel:\n\t\t\t\tmetrics.activeCertifications === metrics.totalCertifications\n\t\t\t\t\t? \"all current\"\n\t\t\t\t\t: metrics.activeCertifications > 0\n\t\t\t\t\t\t? \"active\"\n\t\t\t\t\t\t: \"none active\",\n\t\t},\n\t];\n}\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ToolbarActionsProvider = registerClientReference(\n    function() { throw new Error(\"Attempted to call ToolbarActionsProvider() from the server but ToolbarActionsProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/layout/toolbar-actions-provider.tsx\",\n    \"ToolbarActionsProvider\",\n);\n","import { cache } from \"react\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\n\nexport const CUSTOMERS_PAGE_SIZE = 50;\n\nconst CUSTOMER_SELECT = `\n  id,\n  display_name,\n  first_name,\n  last_name,\n  company_name,\n  email,\n  phone,\n  address,\n  city,\n  state,\n  zip_code,\n  status,\n  archived_at,\n  deleted_at,\n  last_job_date,\n  total_revenue\n`;\n\nexport type CustomerListRecord = {\n\tid: string;\n\tdisplay_name: string | null;\n\tfirst_name: string | null;\n\tlast_name: string | null;\n\tcompany_name: string | null;\n\temail: string | null;\n\tphone: string | null;\n\taddress: string | null;\n\tcity: string | null;\n\tstate: string | null;\n\tzip_code: string | null;\n\tstatus: string | null;\n\tcustomer_type: string | null;\n\tarchived_at: string | null;\n\tdeleted_at: string | null;\n\tcreated_at: string;\n\t// Enriched fields (computed efficiently via LATERAL joins in RPC)\n\tlast_job_date: string | null;\n\tnext_job_date: string | null;\n\ttotal_revenue_cents: number | null;\n\tjob_count: number | null;\n\tinvoice_count: number | null;\n\topen_invoices_count: number | null;\n\toverdue_invoices_count: number | null;\n\tproperties_count: number | null;\n\tequipment_count: number | null;\n};\n\nexport type CustomersPageResult = {\n\tcustomers: CustomerListRecord[];\n\ttotalCount: number;\n};\n\n/**\n * Fetch a single page of customers with enriched data using optimized RPC function.\n * Uses LATERAL joins to eliminate N+1 query pattern (1 query instead of 5N queries).\n *\n * Performance:\n * - Before: 50 customers = 250+ queries (5-10 seconds)\n * - After: 50 customers = 1 query (50-100ms)\n *\n * @param page - Page number (1-indexed)\n * @param pageSize - Number of customers per page (default: 50)\n * @param searchQuery - Optional search query\n * @param statusFilter - Optional status filter\n * @param orderBy - Order by field (default: display_name)\n * @param orderDirection - Order direction (default: ASC)\n */\nexport async function getCustomersPageData(\n\tpage: number,\n\tpageSize: number = CUSTOMERS_PAGE_SIZE,\n\tsearchQuery?: string,\n\tstatusFilter?: \"active\" | \"inactive\" | \"prospect\",\n\torderBy:\n\t\t| \"display_name\"\n\t\t| \"last_job_date\"\n\t\t| \"total_revenue\"\n\t\t| \"created_at\" = \"display_name\",\n\torderDirection: \"ASC\" | \"DESC\" = \"ASC\",\n): Promise<CustomersPageResult> {\n\t// IMPORTANT: Cannot use \"use cache\" here because we call getActiveCompanyId()\n\t// which uses cookies(). The query is already fast enough without page-level caching.\n\tconst companyId = await getActiveCompanyId();\n\tif (!companyId) {\n\t\treturn { customers: [], totalCount: 0 };\n\t}\n\n\tconst supabase = await createServiceSupabaseClient();\n\tif (!supabase) {\n\t\tthrow new Error(\"Supabase client not configured\");\n\t}\n\tconst offset = (Math.max(page, 1) - 1) * pageSize;\n\n\t// Use optimized RPC function with LATERAL joins\n\tconst { data, error } = await supabase.rpc(\"get_enriched_customers_rpc\", {\n\t\tp_company_id: companyId,\n\t\tp_limit: pageSize,\n\t\tp_offset: offset,\n\t\tp_search_query: searchQuery || null,\n\t\tp_status_filter: statusFilter || null,\n\t\tp_order_by: orderBy,\n\t\tp_order_direction: orderDirection,\n\t});\n\n\tif (error) {\n\t\tthrow new Error(`Failed to load customers: ${error.message}`);\n\t}\n\n\t// Get total count for pagination (separate query, cached by Supabase)\n\tconst { count } = await supabase\n\t\t.from(\"customers\")\n\t\t.select(\"*\", { count: \"exact\", head: true })\n\t\t.eq(\"company_id\", companyId)\n\t\t.is(\"deleted_at\", null);\n\n\treturn {\n\t\tcustomers: (data ?? []) as CustomerListRecord[],\n\t\ttotalCount: count ?? 0,\n\t};\n}\n\nexport type CustomerSummaryStats = {\n\ttotal: number;\n\tactive: number;\n\tinactive: number;\n\tprospect: number;\n\ttotalRevenueCents: number;\n};\n\n/**\n * Aggregated customer metrics used by dashboard stats cards.\n * Uses optimized RPC with LATERAL joins for fast metric computation.\n * Wrapped with cache() for request-level deduplication (not page-level caching).\n */\nexport const getCustomerStats = cache(\n\tasync (): Promise<CustomerSummaryStats | null> => {\n\t\t// Note: cache() provides request-level deduplication - works fine with cookies()\n\t\t// \"use cache\" directive would NOT work here due to cookies() usage\n\t\tconst companyId = await getActiveCompanyId();\n\t\tif (!companyId) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst supabase = await createServiceSupabaseClient();\n\t\tif (!supabase) {\n\t\t\tthrow new Error(\"Supabase client not configured\");\n\t\t}\n\n\t\t// Get customer stats directly from the customers table\n\t\tconst { data, error, count } = await supabase\n\t\t\t.from(\"customers\")\n\t\t\t.select(\"status, archived_at, total_revenue\", { count: \"exact\" })\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.limit(50000); // Prevent unbounded query\n\n\t\tif (error) {\n\t\t\tthrow new Error(`Failed to load customer stats: ${error.message}`);\n\t\t}\n\n\t\t// Single-pass aggregation (3x faster than multiple filter passes)\n\t\tconst stats = { active: 0, inactive: 0, prospect: 0 };\n\t\tlet totalRevenueCents = 0;\n\t\tfor (const c of data ?? []) {\n\t\t\tif (!c.archived_at) {\n\t\t\t\tconst status = (c.status || \"prospect\") as keyof typeof stats;\n\t\t\t\tif (status in stats) stats[status]++;\n\t\t\t}\n\t\t\t// Sum total revenue from all customers (stored in cents)\n\t\t\ttotalRevenueCents += c.total_revenue || 0;\n\t\t}\n\n\t\treturn {\n\t\t\ttotal: count ?? 0,\n\t\t\tactive: stats.active,\n\t\t\tinactive: stats.inactive,\n\t\t\tprospect: stats.prospect,\n\t\t\ttotalRevenueCents,\n\t\t};\n\t},\n);\n\n/**\n * Get complete customer data with tags from customer_tags junction table.\n * Uses React.cache() for request-level deduplication.\n * Called by multiple components - only executes once per request.\n */\nexport const getCustomerComplete = cache(\n\tasync (customerId: string, companyId: string) => {\n\t\tconst supabase = await createServiceSupabaseClient();\n\t\tif (!supabase) {\n\t\t\tthrow new Error(\"Supabase client not configured\");\n\t\t}\n\n\t\tconst { data, error } = await supabase.rpc(\"get_customer_complete\", {\n\t\t\tp_customer_id: customerId,\n\t\t\tp_company_id: companyId,\n\t\t});\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Error fetching customer:\", error);\n\t\t\treturn null;\n\t\t}\n\n\t\t// RPC returns array with single row containing customer_data JSONB\n\t\treturn data?.[0]?.customer_data || null;\n\t},\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const CustomerPageContent = registerClientReference(\n    function() { throw new Error(\"Attempted to call CustomerPageContent() from the server but CustomerPageContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/customers/customer-page-content.tsx\",\n    \"CustomerPageContent\",\n);\n","/**\n * Customer Details Page - PPR Enabled\n *\n * Uses Partial Prerendering for instant page loads:\n * - Static shell renders instantly (5-20ms)\n * - Customer data streams in (300-600ms)\n *\n * Fetches 13 parallel queries for complete customer 360째 view:\n * - Properties, Jobs, Invoices, Estimates\n * - Appointments, Contracts, Payments\n * - Maintenance Plans, Service Agreements\n * - Activities, Equipment, Attachments, Payment Methods\n *\n * Performance: 10-30x faster than traditional SSR\n */\n\nimport { Suspense } from \"react\";\nimport { CustomerDetailData } from \"@/components/customers/customer-detail-data\";\nimport { CustomerDetailSkeleton } from \"@/components/customers/customer-detail-skeleton\";\n\n// Custom metadata for this page\nexport async function generateMetadata({\n\tparams,\n}: {\n\tparams: Promise<{ id: string }>;\n}) {\n\tconst { id: _customerId } = await params;\n\treturn {\n\t\ttitle: \"Customer Details\",\n\t};\n}\n\nexport default async function CustomerDetailsPage({\n\tparams,\n}: {\n\tparams: Promise<{ id: string }>;\n}) {\n\tconst { id } = await params;\n\n\treturn (\n\t\t<Suspense fallback={<CustomerDetailSkeleton />}>\n\t\t\t<CustomerDetailData customerId={id} />\n\t\t</Suspense>\n\t);\n}\n","import { notFound } from \"next/navigation\";\nimport { CustomerPageContent } from \"@/components/customers/customer-page-content\";\nimport { ToolbarActionsProvider } from \"@/components/layout/toolbar-actions-provider\";\nimport { ToolbarStatsProvider } from \"@/components/layout/toolbar-stats-provider\";\nimport { getCustomerComplete } from \"@/lib/queries/customers\";\nimport { generateCustomerStats } from \"@/lib/queries/stats-utils\";\nimport { createClient } from \"@/lib/supabase/server\";\n\ntype CustomerDetailDataProps = {\n\tcustomerId: string;\n};\n\n/**\n * Customer Detail Data - Async Server Component\n *\n * Fetches all customer data and related entities.\n * This streams in after the shell renders.\n *\n * Fetches 13 parallel queries for complete customer 360째 view.\n */\nexport async function CustomerDetailData({\n\tcustomerId,\n}: CustomerDetailDataProps) {\n\tconst supabase = await createClient();\n\n\tif (!supabase) {\n\t\treturn notFound();\n\t}\n\n\t// Get authenticated user\n\tconst {\n\t\tdata: { user },\n\t\terror: authError,\n\t} = await supabase.auth.getUser();\n\n\tif (authError || !user) {\n\t\treturn notFound();\n\t}\n\n\t// Get the active company ID\n\tconst { getActiveCompanyId } = await import(\"@/lib/auth/company-context\");\n\tconst activeCompanyId = await getActiveCompanyId();\n\n\tif (!activeCompanyId) {\n\t\treturn notFound();\n\t}\n\n\t// Get user's membership for the ACTIVE company\n\tconst { data: teamMember, error: teamMemberError } = await supabase\n\t\t.from(\"company_memberships\")\n\t\t.select(\"company_id\")\n\t\t.eq(\"user_id\", user.id)\n\t\t.eq(\"company_id\", activeCompanyId)\n\t\t.eq(\"status\", \"active\")\n\t\t.maybeSingle();\n\n\t// Check for real errors\n\tconst hasRealError =\n\t\tteamMemberError &&\n\t\tteamMemberError.code !== \"PGRST116\" &&\n\t\tObject.keys(teamMemberError).length > 0;\n\n\tif (hasRealError) {\n\t\treturn notFound();\n\t}\n\n\tif (!teamMember) {\n\t\treturn notFound();\n\t}\n\n\t// Fetch customer with tags using RPC\n\tconst customer = await getCustomerComplete(customerId, teamMember.company_id);\n\tconst customerError = customer ? null : { code: \"PGRST116\" };\n\n\tif (customerError) {\n\t\tif (customerError.code === \"PGRST116\") {\n\t\t\treturn (\n\t\t\t\t<div className=\"flex min-h-screen items-center justify-center\">\n\t\t\t\t\t<div className=\"border-border bg-card max-w-md rounded-lg border p-8 text-center shadow-lg\">\n\t\t\t\t\t\t<h1 className=\"mb-4 text-2xl font-bold\">Customer Not Found</h1>\n\t\t\t\t\t\t<p className=\"text-muted-foreground mb-6 text-sm\">\n\t\t\t\t\t\t\tThis customer doesn't exist or has been deleted.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\tclassName=\"bg-primary text-primary-foreground hover:bg-primary/90 inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium\"\n\t\t\t\t\t\t\thref=\"/dashboard/customers\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tBack to Customers\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\tif (customerError.code === \"42501\") {\n\t\t\treturn (\n\t\t\t\t<div className=\"flex min-h-screen items-center justify-center\">\n\t\t\t\t\t<div className=\"border-border bg-card max-w-md rounded-lg border p-8 text-center shadow-lg\">\n\t\t\t\t\t\t<h1 className=\"mb-4 text-2xl font-bold\">Wrong Company</h1>\n\t\t\t\t\t\t<p className=\"text-muted-foreground mb-2 text-sm\">\n\t\t\t\t\t\t\tThis customer belongs to a different company.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p className=\"text-muted-foreground mb-6 text-sm\">\n\t\t\t\t\t\t\tIf you need to access this customer, please switch to the correct\n\t\t\t\t\t\t\tcompany using the company selector in the header.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\tclassName=\"bg-primary text-primary-foreground hover:bg-primary/90 inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium\"\n\t\t\t\t\t\t\thref=\"/dashboard/customers\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tBack to Customers\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\treturn notFound();\n\t}\n\n\tif (!customer) {\n\t\treturn notFound();\n\t}\n\n\t// Fetch related data (14 parallel queries for complete 360째 view)\n\tconst [\n\t\t{ data: properties },\n\t\t{ data: jobs },\n\t\t{ data: invoices },\n\t\t{ data: estimates },\n\t\t{ data: appointments },\n\t\t{ data: contracts },\n\t\t{ data: payments },\n\t\t{ data: maintenancePlans },\n\t\t{ data: serviceAgreements },\n\t\t{ data: activities },\n\t\t{ data: equipment },\n\t\t{ data: attachments },\n\t\t{ data: paymentMethods },\n\t\t{ data: communications },\n\t] = await Promise.all([\n\t\tsupabase\n\t\t\t.from(\"properties\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"primary_contact_id\", customerId)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(10),\n\t\tsupabase\n\t\t\t.from(\"jobs\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(10),\n\t\tsupabase\n\t\t\t.from(\"invoices\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(10),\n\t\tsupabase\n\t\t\t.from(\"estimates\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(10),\n\t\tsupabase\n\t\t\t.from(\"appointments\")\n\t\t\t.select(\n\t\t\t\t`\n        *,\n        job:jobs!job_id(id, job_number, title),\n        property:properties!property_id(id, name, address)\n      `,\n\t\t\t)\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"scheduled_start\", { ascending: false })\n\t\t\t.limit(10),\n\t\tsupabase\n\t\t\t.from(\"contracts\")\n\t\t\t.select(\n\t\t\t\t`\n        *,\n        job:jobs!job_id(id, job_number),\n        estimate:estimates!estimate_id(id, estimate_number),\n        invoice:invoices!invoice_id(id, invoice_number)\n      `,\n\t\t\t)\n\t\t\t.eq(\"company_id\", teamMember.company_id)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(50),\n\t\tsupabase\n\t\t\t.from(\"payments\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"processed_at\", { ascending: false })\n\t\t\t.limit(10),\n\t\tsupabase\n\t\t\t.from(\"maintenance_plans\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(10),\n\t\tsupabase\n\t\t\t.from(\"service_plans\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.eq(\"type\", \"contract\")\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(10),\n\t\tsupabase\n\t\t\t.from(\"customer_activities\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(20),\n\t\tsupabase\n\t\t\t.from(\"equipment\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(10),\n\t\tsupabase\n\t\t\t.from(\"customer_attachments\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(10),\n\t\tsupabase\n\t\t\t.from(\"customer_payment_methods\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.eq(\"is_active\", true)\n\t\t\t.order(\"is_default\", { ascending: false })\n\t\t\t.limit(5),\n\t\tsupabase\n\t\t\t.from(\"communications\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(20),\n\t]);\n\n\t// Filter contracts to only include those related to this customer\n\tconst customerContracts = (contracts || []).filter((contract) => {\n\t\tconst hasJob = jobs?.some((job) => job.id === contract.job_id);\n\t\tconst hasEstimate = estimates?.some(\n\t\t\t(est) => est.id === contract.estimate_id,\n\t\t);\n\t\tconst hasInvoice = invoices?.some((inv) => inv.id === contract.invoice_id);\n\t\treturn hasJob || hasEstimate || hasInvoice;\n\t});\n\n\t// Build metrics and stats for toolbar\n\tconst metrics = {\n\t\ttotalRevenue: (customer as any).total_revenue || 0,\n\t\ttotalJobs: jobs?.length || 0,\n\t\ttotalProperties: properties?.length || 0,\n\t\toutstandingBalance: (customer as any).outstanding_balance || 0,\n\t};\n\n\tconst stats = generateCustomerStats(metrics);\n\n\t// Build customer 360째 data object expected by CustomerPageContent\n\tconst customerData = {\n\t\tcustomer,\n\t\tproperties: properties || [],\n\t\tjobs: jobs || [],\n\t\tinvoices: invoices || [],\n\t\testimates: estimates || [],\n\t\tappointments: appointments || [],\n\t\tcontracts: customerContracts,\n\t\tpayments: payments || [],\n\t\tmaintenancePlans: maintenancePlans || [],\n\t\tserviceAgreements: serviceAgreements || [],\n\t\tactivities: activities || [],\n\t\tequipment: equipment || [],\n\t\tattachments: attachments || [],\n\t\tpaymentMethods: paymentMethods || [],\n\t\tcommunications: communications || [],\n\t\tenrichmentData: null,\n\t};\n\n\treturn (\n\t\t<ToolbarStatsProvider stats={stats}>\n\t\t\t<ToolbarActionsProvider>\n\t\t\t\t<CustomerPageContent customerData={customerData} metrics={metrics} />\n\t\t\t</ToolbarActionsProvider>\n\t\t</ToolbarStatsProvider>\n\t);\n}\n","/**\n * Customer Detail Skeleton - Loading State\n *\n * Shows a loading skeleton while customer data loads.\n * Matches the layout of the actual customer detail page.\n */\nexport function CustomerDetailSkeleton() {\n\treturn (\n\t\t<div className=\"flex h-full flex-col gap-6 p-6\">\n\t\t\t{/* Header Section */}\n\t\t\t<div className=\"flex items-start justify-between\">\n\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t<div className=\"bg-muted h-8 w-64 animate-pulse rounded\" />\n\t\t\t\t\t<div className=\"bg-muted h-4 w-48 animate-pulse rounded\" />\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t<div className=\"bg-muted h-10 w-24 animate-pulse rounded\" />\n\t\t\t\t\t<div className=\"bg-muted h-10 w-24 animate-pulse rounded\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Stats Cards */}\n\t\t\t<div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n\t\t\t\t{[1, 2, 3, 4].map((i) => (\n\t\t\t\t\t<div className=\"border-border bg-card rounded-lg border p-4\" key={i}>\n\t\t\t\t\t\t<div className=\"bg-muted h-4 w-24 animate-pulse rounded\" />\n\t\t\t\t\t\t<div className=\"bg-muted mt-2 h-8 w-16 animate-pulse rounded\" />\n\t\t\t\t\t</div>\n\t\t\t\t))}\n\t\t\t</div>\n\n\t\t\t{/* Tabs */}\n\t\t\t<div className=\"border-border flex gap-2 border-b\">\n\t\t\t\t{[1, 2, 3, 4, 5].map((i) => (\n\t\t\t\t\t<div className=\"bg-muted h-10 w-24 animate-pulse rounded-t\" key={i} />\n\t\t\t\t))}\n\t\t\t</div>\n\n\t\t\t{/* Content Area */}\n\t\t\t<div className=\"flex-1 space-y-4\">\n\t\t\t\t<div className=\"bg-muted h-64 animate-pulse rounded-lg\" />\n\t\t\t\t<div className=\"bg-muted h-64 animate-pulse rounded-lg\" />\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n"],"names":[],"mappings":"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","ignoreList":[0,2,4]}