{"version":3,"sources":["../../../../../../apps/web/src/components/work/job-details/job-help-footer.tsx","../../../../../../apps/web/src/components/work/job-details/job-page-content.tsx","../../../../../../apps/web/src/actions/data%3Af4a0c8%20%3Ctext/javascript%3E","../../../../../../apps/web/src/actions/data%3A14076c%20%3Ctext/javascript%3E","../../../../../../apps/web/src/actions/data%3Aa2c252%20%3Ctext/javascript%3E","../../../../../../apps/web/src/components/communication/sms-dialog.tsx","../../../../../../apps/web/src/queries/data%3Aca3345%20%3Ctext/javascript%3E","../../../../../../apps/web/src/queries/data%3A3160e8%20%3Ctext/javascript%3E","../../../../../../apps/web/src/components/work/job-details/ai-job-assistant-header.tsx","../../../../../../apps/web/src/components/work/job-details/inline-photo-uploader.tsx","../../../../../../apps/web/src/actions/data%3Af000d5%20%3Ctext/javascript%3E","../../../../../../apps/web/src/components/work/job-details/job-activity-timeline.tsx","../../../../../../apps/web/src/components/work/job-details/job-appointments-expandable.tsx","../../../../../../apps/web/src/components/ui/expandable-row.tsx","../../../../../../apps/web/src/components/work/job-details/appointment-expandable-row.tsx","../../../../../../apps/web/src/components/work/job-details/job-customer-property-manager.tsx","../../../../../../apps/web/src/components/work/job-details/job-estimates-table.tsx","../../../../../../apps/web/src/actions/data%3Ab816cd%20%3Ctext/javascript%3E","../../../../../../apps/web/src/components/work/job-details/job-invoices-table.tsx","../../../../../../apps/web/src/components/work/job-details/job-notes-table.tsx","../../../../../../apps/web/src/components/work/job-details/job-payments-table.tsx","../../../../../../apps/web/src/components/work/job-details/job-purchase-orders-table.tsx","../../../../../../apps/web/src/components/work/job-details/job-quick-actions.tsx","../../../../../../apps/web/src/components/work/job-details/job-status-selector.tsx","../../../../../../apps/web/src/lib/validations/job-status-transitions.ts","../../../../../../apps/web/src/components/work/job-details/job-tasks-table.tsx","../../../../../../apps/web/src/components/work/job-details/job-team-member-selector.tsx","../../../../../../apps/web/src/components/work/job-details/job-team-members-table.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n\tArrowRight,\n\tCalendar,\n\tCheckCircle2,\n\tClock,\n\tDollarSign,\n\tFileText,\n\tHelpCircle,\n\tPause,\n\tPlay,\n\tSend,\n\tX,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\n\ninterface StatusStep {\n\tstatus: string;\n\ticon: React.ComponentType<{ className?: string }>;\n\tsimpleTitle: string;\n\twhatItMeans: string;\n\tnextSteps: string[];\n\tneedsInfo: string[];\n\texample: string;\n}\n\n// Simplified workflow - explaining like talking to a 5th grader\nconst SIMPLE_WORKFLOW: StatusStep[] = [\n\t{\n\t\tstatus: \"quoted\",\n\t\ticon: FileText,\n\t\tsimpleTitle: \"Getting a Quote\",\n\t\twhatItMeans: \"You're telling the customer how much the job will cost.\",\n\t\tnextSteps: [\"scheduled\", \"cancelled\"],\n\t\tneedsInfo: [\"Customer's name and contact info\"],\n\t\texample:\n\t\t\t\"Like getting an estimate for fixing your bike before you decide to do it.\",\n\t},\n\t{\n\t\tstatus: \"scheduled\",\n\t\ticon: Calendar,\n\t\tsimpleTitle: \"Job is Scheduled\",\n\t\twhatItMeans:\n\t\t\t\"The customer said yes! You picked a day and time to do the work.\",\n\t\tnextSteps: [\"in_progress\", \"on_hold\", \"cancelled\"],\n\t\tneedsInfo: [\n\t\t\t\"Customer info\",\n\t\t\t\"What day you're going\",\n\t\t\t\"What time you're going\",\n\t\t],\n\t\texample:\n\t\t\t\"Like when you make a dentist appointment for next Tuesday at 3pm.\",\n\t},\n\t{\n\t\tstatus: \"in_progress\",\n\t\ticon: Play,\n\t\tsimpleTitle: \"Working on It\",\n\t\twhatItMeans: \"You're doing the work right now!\",\n\t\tnextSteps: [\"completed\", \"on_hold\", \"cancelled\"],\n\t\tneedsInfo: [\"Customer info\", \"Start date\", \"Who is doing the work\"],\n\t\texample: \"Like when you're actually fixing the bike right now.\",\n\t},\n\t{\n\t\tstatus: \"on_hold\",\n\t\ticon: Pause,\n\t\tsimpleTitle: \"Paused\",\n\t\twhatItMeans:\n\t\t\t\"You had to stop for a bit. Maybe waiting for parts or the customer to decide something.\",\n\t\tnextSteps: [\"scheduled\", \"in_progress\", \"cancelled\"],\n\t\tneedsInfo: [\"Customer info\"],\n\t\texample:\n\t\t\t\"Like pausing a video game to go eat dinner. You'll come back to it later.\",\n\t},\n\t{\n\t\tstatus: \"completed\",\n\t\ticon: CheckCircle2,\n\t\tsimpleTitle: \"Work is Done\",\n\t\twhatItMeans: \"Finished! The work is complete and the customer is happy.\",\n\t\tnextSteps: [\"invoiced\"],\n\t\tneedsInfo: [\"Customer info\", \"When you started\"],\n\t\texample: \"Like when you finish your homework and show it to your teacher.\",\n\t},\n\t{\n\t\tstatus: \"cancelled\",\n\t\ticon: X,\n\t\tsimpleTitle: \"Cancelled\",\n\t\twhatItMeans:\n\t\t\t\"Not doing this job anymore. Maybe the customer changed their mind.\",\n\t\tnextSteps: [\"quoted\", \"scheduled\"],\n\t\tneedsInfo: [\"Customer info\"],\n\t\texample: \"Like when a birthday party gets cancelled because of rain.\",\n\t},\n\t{\n\t\tstatus: \"invoiced\",\n\t\ticon: FileText,\n\t\tsimpleTitle: \"Sent the Bill\",\n\t\twhatItMeans: \"Work is done, and you sent the customer the bill to pay.\",\n\t\tnextSteps: [\"paid\"],\n\t\tneedsInfo: [\"Customer info\", \"How much they owe\"],\n\t\texample:\n\t\t\t\"Like when your mom gives you a list of chores you did to earn your allowance.\",\n\t},\n\t{\n\t\tstatus: \"paid\",\n\t\ticon: DollarSign,\n\t\tsimpleTitle: \"Got Paid\",\n\t\twhatItMeans: \"Yay! The customer paid you. This job is all done!\",\n\t\tnextSteps: [],\n\t\tneedsInfo: [\"Customer info\", \"How much they paid\"],\n\t\texample: \"Like when you finally get your allowance money in your hand.\",\n\t},\n];\n\nfunction StatusBadge({\n\tstatus,\n\tsize = \"default\",\n}: {\n\tstatus: string;\n\tsize?: \"default\" | \"lg\";\n}) {\n\tconst colors: Record<string, string> = {\n\t\tquoted:\n\t\t\t\"bg-blue-500/10 text-blue-700 dark:text-blue-400 border-blue-200 dark:border-blue-800\",\n\t\tscheduled:\n\t\t\t\"bg-purple-500/10 text-purple-700 dark:text-purple-400 border-purple-200 dark:border-purple-800\",\n\t\tin_progress:\n\t\t\t\"bg-amber-500/10 text-amber-700 dark:text-amber-400 border-amber-200 dark:border-amber-800\",\n\t\ton_hold:\n\t\t\t\"bg-orange-500/10 text-orange-700 dark:text-orange-400 border-orange-200 dark:border-orange-800\",\n\t\tcompleted:\n\t\t\t\"bg-green-500/10 text-green-700 dark:text-green-400 border-green-200 dark:border-green-800\",\n\t\tcancelled:\n\t\t\t\"bg-red-500/10 text-red-700 dark:text-red-400 border-red-200 dark:border-red-800\",\n\t\tinvoiced:\n\t\t\t\"bg-indigo-500/10 text-indigo-700 dark:text-indigo-400 border-indigo-200 dark:border-indigo-800\",\n\t\tpaid: \"bg-emerald-500/10 text-emerald-700 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800\",\n\t};\n\n\tconst sizeClasses =\n\t\tsize === \"lg\" ? \"text-base px-4 py-1.5\" : \"text-sm px-3 py-1\";\n\n\treturn (\n\t\t<Badge\n\t\t\tclassName={`${colors[status.toLowerCase()] || \"\"} ${sizeClasses} border font-medium capitalize`}\n\t\t>\n\t\t\t{status.replace(\"_\", \" \")}\n\t\t</Badge>\n\t);\n}\n\nfunction WorkflowStep({ step, isLast }: { step: StatusStep; isLast: boolean }) {\n\tconst Icon = step.icon;\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<div className=\"flex items-start gap-4\">\n\t\t\t\t<div className=\"bg-primary/10 border-primary/20 flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full border\">\n\t\t\t\t\t<Icon className=\"text-primary h-6 w-6\" />\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex-1 space-y-3\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h4 className=\"mb-1 text-lg font-semibold\">{step.simpleTitle}</h4>\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">{step.whatItMeans}</p>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div className=\"bg-muted/50 rounded-lg border p-3\">\n\t\t\t\t\t\t<div className=\"mb-2 flex items-center gap-2\">\n\t\t\t\t\t\t\t<HelpCircle className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t<span className=\"text-sm font-medium\">Real Life Example:</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm italic\">\n\t\t\t\t\t\t\t{step.example}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{step.needsInfo.length > 0 && (\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<div className=\"text-sm font-medium\">What info do you need?</div>\n\t\t\t\t\t\t\t<ul className=\"text-muted-foreground space-y-1 text-sm\">\n\t\t\t\t\t\t\t\t{step.needsInfo.map((info, idx) => (\n\t\t\t\t\t\t\t\t\t<li key={idx} className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"bg-primary/20 h-1.5 w-1.5 rounded-full\" />\n\t\t\t\t\t\t\t\t\t\t{info}\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{step.nextSteps.length > 0 && (\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<ArrowRight className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t<span className=\"text-sm font-medium\">\n\t\t\t\t\t\t\t\t\tWhat can happen next?\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\n\t\t\t\t\t\t\t\t{step.nextSteps.map((nextStatus) => (\n\t\t\t\t\t\t\t\t\t<StatusBadge key={nextStatus} status={nextStatus} />\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{step.nextSteps.length === 0 && (\n\t\t\t\t\t\t<div className=\"flex items-center gap-2 rounded-lg border border-green-200 bg-green-500/10 p-3 text-sm dark:border-green-800\">\n\t\t\t\t\t\t\t<CheckCircle2 className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n\t\t\t\t\t\t\t<span className=\"font-medium text-green-700 dark:text-green-400\">\n\t\t\t\t\t\t\t\tThis is the end! Job is complete and paid.\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{!isLast && (\n\t\t\t\t<div className=\"border-muted-foreground/20 ml-6 border-l-2 border-dashed py-4 pl-6\">\n\t\t\t\t\t<div className=\"text-muted-foreground flex items-center gap-2 text-xs\">\n\t\t\t\t\t\t<Clock className=\"h-3 w-3\" />\n\t\t\t\t\t\t<span>Time passes...</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n\nfunction SupportForm() {\n\tconst [formState, setFormState] = useState({\n\t\tname: \"\",\n\t\temail: \"\",\n\t\tsubject: \"\",\n\t\tmessage: \"\",\n\t});\n\tconst [isSubmitting, setIsSubmitting] = useState(false);\n\tconst [submitStatus, setSubmitStatus] = useState<\n\t\t\"idle\" | \"success\" | \"error\"\n\t>(\"idle\");\n\n\tconst handleSubmit = async (e: React.FormEvent) => {\n\t\te.preventDefault();\n\t\tsetIsSubmitting(true);\n\t\tsetSubmitStatus(\"idle\");\n\n\t\ttry {\n\t\t\t// TODO: Implement actual support submission\n\t\t\tawait new Promise((resolve) => setTimeout(resolve, 1500));\n\t\t\tsetSubmitStatus(\"success\");\n\t\t\tsetFormState({ name: \"\", email: \"\", subject: \"\", message: \"\" });\n\t\t} catch (error) {\n\t\t\tsetSubmitStatus(\"error\");\n\t\t} finally {\n\t\t\tsetIsSubmitting(false);\n\t\t}\n\t};\n\n\tconst handleChange =\n\t\t(field: string) =>\n\t\t(e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n\t\t\tsetFormState((prev) => ({ ...prev, [field]: e.target.value }));\n\t\t};\n\n\treturn (\n\t\t<form onSubmit={handleSubmit} className=\"space-y-4\">\n\t\t\t<div className=\"grid gap-4 sm:grid-cols-2\">\n\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t<label htmlFor=\"name\" className=\"text-sm font-medium\">\n\t\t\t\t\t\tYour Name\n\t\t\t\t\t</label>\n\t\t\t\t\t<Input\n\t\t\t\t\t\tid=\"name\"\n\t\t\t\t\t\tvalue={formState.name}\n\t\t\t\t\t\tonChange={handleChange(\"name\")}\n\t\t\t\t\t\tplaceholder=\"John Smith\"\n\t\t\t\t\t\trequired\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t<label htmlFor=\"email\" className=\"text-sm font-medium\">\n\t\t\t\t\t\tYour Email\n\t\t\t\t\t</label>\n\t\t\t\t\t<Input\n\t\t\t\t\t\tid=\"email\"\n\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\tvalue={formState.email}\n\t\t\t\t\t\tonChange={handleChange(\"email\")}\n\t\t\t\t\t\tplaceholder=\"john@example.com\"\n\t\t\t\t\t\trequired\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div className=\"space-y-2\">\n\t\t\t\t<label htmlFor=\"subject\" className=\"text-sm font-medium\">\n\t\t\t\t\tWhat do you need help with?\n\t\t\t\t</label>\n\t\t\t\t<Input\n\t\t\t\t\tid=\"subject\"\n\t\t\t\t\tvalue={formState.subject}\n\t\t\t\t\tonChange={handleChange(\"subject\")}\n\t\t\t\t\tplaceholder=\"I have a question about...\"\n\t\t\t\t\trequired\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div className=\"space-y-2\">\n\t\t\t\t<label htmlFor=\"message\" className=\"text-sm font-medium\">\n\t\t\t\t\tTell us more\n\t\t\t\t</label>\n\t\t\t\t<Textarea\n\t\t\t\t\tid=\"message\"\n\t\t\t\t\tvalue={formState.message}\n\t\t\t\t\tonChange={handleChange(\"message\")}\n\t\t\t\t\tplaceholder=\"Explain your question or problem here...\"\n\t\t\t\t\trows={4}\n\t\t\t\t\trequired\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t{submitStatus === \"success\" && (\n\t\t\t\t<div className=\"flex items-center gap-2 rounded-lg border border-green-200 bg-green-50 p-3 text-sm text-green-800 dark:border-green-800 dark:bg-green-950 dark:text-green-200\">\n\t\t\t\t\t<CheckCircle2 className=\"h-4 w-4\" />\n\t\t\t\t\tGot it! We'll email you back soon.\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{submitStatus === \"error\" && (\n\t\t\t\t<div className=\"flex items-center gap-2 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-800 dark:border-red-800 dark:bg-red-950 dark:text-red-200\">\n\t\t\t\t\t<HelpCircle className=\"h-4 w-4\" />\n\t\t\t\t\tOops! Something went wrong. Please try again.\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t<Button\n\t\t\t\ttype=\"submit\"\n\t\t\t\tdisabled={isSubmitting}\n\t\t\t\tclassName=\"w-full sm:w-auto\"\n\t\t\t>\n\t\t\t\t<Send className=\"mr-2 h-4 w-4\" />\n\t\t\t\t{isSubmitting ? \"Sending...\" : \"Send Message\"}\n\t\t\t</Button>\n\t\t</form>\n\t);\n}\n\nexport function JobHelpFooter() {\n\treturn null;\n}\n","/**\n * Job Page Content - Comprehensive Single Page View\n * All details visible with collapsible sections - like ServiceTitan/HouseCall Pro\n */\n\n\"use client\";\n\nimport {\n\tActivity,\n\tAlertCircle,\n\tBuilding2,\n\tCalendar,\n\tCamera,\n\tCheckCircle,\n\tChevronRight,\n\tDollarSign,\n\tDownload,\n\tExternalLink,\n\tFileText,\n\tGlobe,\n\tLink2,\n\tMail,\n\tMapPin,\n\tMessageSquare,\n\tPackage,\n\tPhone,\n\tPlus,\n\tReceipt,\n\tSave,\n\tShieldCheck,\n\tSparkles,\n\tStickyNote,\n\tTag,\n\tUpload,\n\tUser,\n\tUsers,\n\tWrench,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport React, {\n\ttype ReactNode,\n\tuseCallback,\n\tuseEffect,\n\tuseMemo,\n\tuseRef,\n\tuseState,\n\tuseTransition,\n} from \"react\";\nimport { updateEntityTags } from \"@/actions/entity-tags\";\nimport {\n\tarchiveJob,\n\tassignCustomerToJob,\n\tremoveCustomerFromJob,\n\tupdateJob,\n} from \"@/actions/jobs\";\nimport { findOrCreateProperty } from \"@/actions/properties\";\nimport {\n\tassignTeamMemberToJob,\n\tremoveTeamMemberFromJob,\n} from \"@/actions/team-assignments\";\nimport { SMSDialog } from \"@/components/communication/sms-dialog\";\nimport { DetailPageContentLayout } from \"@/components/layout/detail-page-content-layout\";\nimport {\n\ttype DetailPageHeaderConfig,\n\tDetailPageSurface,\n} from \"@/components/layout/detail-page-shell\";\nimport {\n\tAlertDialog,\n\tAlertDialogAction,\n\tAlertDialogCancel,\n\tAlertDialogContent,\n\tAlertDialogDescription,\n\tAlertDialogFooter,\n\tAlertDialogHeader,\n\tAlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tCollapsible,\n\tCollapsibleContent,\n\tCollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\nimport {\n\tDialog,\n\tDialogContent,\n\tDialogDescription,\n\tDialogFooter,\n\tDialogHeader,\n\tDialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n\tStandardFormField,\n\tStandardFormRow,\n} from \"@/components/ui/standard-form-field\";\nimport {\n\tTable,\n\tTableBody,\n\tTableCell,\n\tTableHead,\n\tTableHeader,\n\tTableRow,\n} from \"@/components/ui/table\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n\tUnifiedAccordionContent,\n\ttype UnifiedAccordionSection,\n} from \"@/components/ui/unified-accordion\";\nimport { EntityTags } from \"@/components/work/entity-tags\";\nimport { useSectionShortcuts } from \"@/hooks/use-section-shortcuts\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useRoleStore, useUIStore } from \"@/lib/stores\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { cn } from \"@/lib/utils\";\nimport type { JobStatus } from \"@/lib/validations/job-status-transitions\";\nimport {\n\tgetCustomerProperties,\n\tsearchCustomersForJob,\n} from \"@/queries/customers-search\";\nimport { AIJobAssistantHeader } from \"./ai-job-assistant-header\";\nimport { InlinePhotoUploader } from \"./inline-photo-uploader\";\nimport { JobActivityTimeline } from \"./job-activity-timeline\";\nimport { JobAppointmentsExpandable } from \"./job-appointments-expandable\";\nimport { JobCustomerPropertyManager } from \"./job-customer-property-manager\";\nimport { JobEstimatesTable } from \"./job-estimates-table\";\nimport { JobInvoicesTable } from \"./job-invoices-table\";\nimport { JobNotesTable } from \"./job-notes-table\";\nimport { JobPaymentsTable } from \"./job-payments-table\";\nimport { JobPurchaseOrdersTable } from \"./job-purchase-orders-table\";\nimport { JobQuickActions } from \"./job-quick-actions\";\nimport { JobStatisticsSheet } from \"./job-statistics-sheet\";\nimport { JobStatusSelector } from \"./job-status-selector\";\nimport { JobTasksTable } from \"./job-tasks-table\";\nimport { JobTeamMemberSelector } from \"./job-team-member-selector\";\nimport { JobTeamMembersTable } from \"./job-team-members-table\";\nimport { TravelTime } from \"./travel-time\";\nimport { PropertyLocationVisual } from \"./widgets/property-location-visual\";\n\ntype JobPageContentProps = {\n\tentityData?: any;\n\tjobData?: any; // Keep for backward compatibility\n\tmetrics: any;\n};\n\nexport function JobPageContent({\n\tentityData,\n\tjobData: legacyJobData,\n\tmetrics,\n}: JobPageContentProps) {\n\t// Support both entityData (from DetailPageLayout) and jobData (legacy)\n\tconst jobData = entityData || legacyJobData;\n\tconst jobRecord = jobData?.job ?? jobData ?? null;\n\tconst job = jobRecord as any;\n\n\t// Early return if no job data\n\tif (!job) {\n\t\treturn (\n\t\t\t<div className=\"flex h-full items-center justify-center\">\n\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t<h2 className=\"text-xl font-semibold\">Job Not Found</h2>\n\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\tThis job may have been deleted or you don't have access to it.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tconst router = useRouter();\n\tconst { toast } = useToast();\n\tconst userRole = useRoleStore((state) => state.role);\n\tconst [isPending, startTransition] = useTransition();\n\n\t// Guard against infinite refresh loops\n\tconst lastRefreshTimeRef = useRef<number>(0);\n\tconst REFRESH_COOLDOWN_MS = 1000; // Minimum 1 second between refreshes\n\n\tconst safeRefresh = useCallback(() => {\n\t\tconst now = Date.now();\n\t\tif (now - lastRefreshTimeRef.current < REFRESH_COOLDOWN_MS) {\n\t\t\tconsole.warn(\"⚠️ Refresh called too frequently, skipping to prevent loop\");\n\t\t\treturn;\n\t\t}\n\t\tlastRefreshTimeRef.current = now;\n\t\tstartTransition(() => {\n\t\t\trouter.refresh();\n\t\t});\n\t}, [router]);\n\n\tconst [localJob, setLocalJob] = useState(() => {\n\t\tif (!jobData?.job) {\n\t\t\treturn { priority: \"medium\" };\n\t\t}\n\t\treturn {\n\t\t\t...jobData.job,\n\t\t\tpriority: jobData.job.priority || \"medium\", // Ensure default priority\n\t\t};\n\t});\n\tconst [hasChanges, setHasChanges] = useState(false);\n\tconst [isSaving, setIsSaving] = useState(false);\n\tconst [showUploader, setShowUploader] = useState(false);\n\tconst [isDraggingOver, setIsDraggingOver] = useState(false);\n\tconst [isArchiveDialogOpen, setIsArchiveDialogOpen] = useState(false);\n\tconst [isArchiving, setIsArchiving] = useState(false);\n\tconst [isStatisticsOpen, setIsStatisticsOpen] = useState(false);\n\tconst [isTagManagerOpen, setIsTagManagerOpen] = useState(false);\n\tconst [isAddTaskDialogOpen, setIsAddTaskDialogOpen] = useState(false);\n\tconst [isAddNoteDialogOpen, setIsAddNoteDialogOpen] = useState(false);\n\tconst [isLoadTemplateDialogOpen, setIsLoadTemplateDialogOpen] =\n\t\tuseState(false);\n\tconst [newTaskTitle, setNewTaskTitle] = useState(\"\");\n\tconst [newTaskDescription, setNewTaskDescription] = useState(\"\");\n\tconst [newNoteContent, setNewNoteContent] = useState(\"\");\n\tconst [isCreatingTask, setIsCreatingTask] = useState(false);\n\tconst [isCreatingNote, setIsCreatingNote] = useState(false);\n\n\t// Link existing dialogs\n\tconst [isLinkEstimateOpen, setIsLinkEstimateOpen] = useState(false);\n\tconst [isLinkInvoiceOpen, setIsLinkInvoiceOpen] = useState(false);\n\tconst [isLinkPaymentOpen, setIsLinkPaymentOpen] = useState(false);\n\tconst [isLinkEquipmentOpen, setIsLinkEquipmentOpen] = useState(false);\n\tconst [estimateSearchQuery, setEstimateSearchQuery] = useState(\"\");\n\tconst [invoiceSearchQuery, setInvoiceSearchQuery] = useState(\"\");\n\tconst [paymentSearchQuery, setPaymentSearchQuery] = useState(\"\");\n\tconst [equipmentSearchQuery, setEquipmentSearchQuery] = useState(\"\");\n\tconst [isLinking, setIsLinking] = useState(false);\n\tconst [availableEstimates, setAvailableEstimates] = useState<\n\t\tArray<{\n\t\t\tid: string;\n\t\t\testimate_number: string;\n\t\t\ttotal_amount: number;\n\t\t\tstatus: string;\n\t\t\tcreated_at: string;\n\t\t\tcustomer?: { id: string; name: string } | null;\n\t\t}>\n\t>([]);\n\tconst [availableInvoices, setAvailableInvoices] = useState<\n\t\tArray<{\n\t\t\tid: string;\n\t\t\tinvoice_number: string;\n\t\t\ttotal_amount: number;\n\t\t\tstatus: string;\n\t\t\tcreated_at: string;\n\t\t\tcustomer?: { id: string; name: string } | null;\n\t\t}>\n\t>([]);\n\tconst [availablePayments, setAvailablePayments] = useState<\n\t\tArray<{\n\t\t\tid: string;\n\t\t\tamount: number;\n\t\t\tpayment_method: string;\n\t\t\treference_number?: string;\n\t\t\tcreated_at: string;\n\t\t\tcustomer?: { id: string; name: string } | null;\n\t\t}>\n\t>([]);\n\tconst [availableEquipment, setAvailableEquipment] = useState<\n\t\tArray<{\n\t\t\tid: string;\n\t\t\tname: string;\n\t\t\tcategory?: string;\n\t\t\tserial_number?: string;\n\t\t\tcreated_at: string;\n\t\t}>\n\t>([]);\n\n\tconst {\n\t\tcustomer: initialCustomer,\n\t\tproperty: initialProperty,\n\t\tassignedUser,\n\t\tteamAssignments = [],\n\t\tavailableTeamMembers = [],\n\t\ttimeEntries = [],\n\t\tinvoices: initialInvoices = [],\n\t\testimates: initialEstimates = [],\n\t\tpayments: initialPayments = [],\n\t\tpurchaseOrders = [],\n\t\ttasks: initialTasks = [],\n\t\tphotos = [],\n\t\tdocuments = [],\n\t\tsignatures = [],\n\t\tactivities = [],\n\t\tcommunications = [],\n\t\tequipment = [],\n\t\tjobEquipment: initialJobEquipment = [],\n\t\tjobMaterials = [],\n\t\tjobNotes: initialJobNotes = [],\n\t\tschedules = [],\n\t\tallCustomers = [],\n\t\tallProperties = [],\n\t\tcompanyPhones = [],\n\t} = jobData || {};\n\n\t// Optimistic state for data arrays\n\tconst [estimates, setEstimates] = useState(initialEstimates);\n\tconst [invoices, setInvoices] = useState(initialInvoices);\n\tconst [payments, setPayments] = useState(initialPayments);\n\tconst [jobEquipment, setJobEquipment] = useState(initialJobEquipment);\n\tconst [tasks, setTasks] = useState(initialTasks);\n\tconst [jobNotes, setJobNotes] = useState(initialJobNotes);\n\n\t// Sync state with props when data changes (e.g., after page navigation or refresh)\n\t// Use refs to track previous values and only update if actually changed\n\tconst prevEstimatesRef = useRef(initialEstimates);\n\tconst prevInvoicesRef = useRef(initialInvoices);\n\tconst prevPaymentsRef = useRef(initialPayments);\n\tconst prevJobEquipmentRef = useRef(initialJobEquipment);\n\tconst prevTasksRef = useRef(initialTasks);\n\tconst prevJobNotesRef = useRef(initialJobNotes);\n\n\tuseEffect(() => {\n\t\t// Only update if arrays actually changed (compare lengths and IDs to avoid infinite loops)\n\t\tconst estimatesChanged =\n\t\t\tinitialEstimates.length !== prevEstimatesRef.current.length ||\n\t\t\tinitialEstimates.some(\n\t\t\t\t(e, i) => e?.id !== prevEstimatesRef.current[i]?.id,\n\t\t\t);\n\t\tconst invoicesChanged =\n\t\t\tinitialInvoices.length !== prevInvoicesRef.current.length ||\n\t\t\tinitialInvoices.some(\n\t\t\t\t(inv, i) => inv?.id !== prevInvoicesRef.current[i]?.id,\n\t\t\t);\n\t\tconst paymentsChanged =\n\t\t\tinitialPayments.length !== prevPaymentsRef.current.length ||\n\t\t\tinitialPayments.some((p, i) => p?.id !== prevPaymentsRef.current[i]?.id);\n\t\tconst equipmentChanged =\n\t\t\tinitialJobEquipment.length !== prevJobEquipmentRef.current.length ||\n\t\t\tinitialJobEquipment.some(\n\t\t\t\t(eq, i) => eq?.id !== prevJobEquipmentRef.current[i]?.id,\n\t\t\t);\n\t\tconst tasksChanged =\n\t\t\tinitialTasks.length !== prevTasksRef.current.length ||\n\t\t\tinitialTasks.some((t, i) => t?.id !== prevTasksRef.current[i]?.id);\n\t\tconst notesChanged =\n\t\t\tinitialJobNotes.length !== prevJobNotesRef.current.length ||\n\t\t\tinitialJobNotes.some((n, i) => n?.id !== prevJobNotesRef.current[i]?.id);\n\n\t\tif (estimatesChanged) {\n\t\t\tsetEstimates(initialEstimates);\n\t\t\tprevEstimatesRef.current = initialEstimates;\n\t\t}\n\t\tif (invoicesChanged) {\n\t\t\tsetInvoices(initialInvoices);\n\t\t\tprevInvoicesRef.current = initialInvoices;\n\t\t}\n\t\tif (paymentsChanged) {\n\t\t\tsetPayments(initialPayments);\n\t\t\tprevPaymentsRef.current = initialPayments;\n\t\t}\n\t\tif (equipmentChanged) {\n\t\t\tsetJobEquipment(initialJobEquipment);\n\t\t\tprevJobEquipmentRef.current = initialJobEquipment;\n\t\t}\n\t\tif (tasksChanged) {\n\t\t\tsetTasks(initialTasks);\n\t\t\tprevTasksRef.current = initialTasks;\n\t\t}\n\t\tif (notesChanged) {\n\t\t\tsetJobNotes(initialJobNotes);\n\t\t\tprevJobNotesRef.current = initialJobNotes;\n\t\t}\n\t}, [\n\t\tinitialEstimates,\n\t\tinitialInvoices,\n\t\tinitialPayments,\n\t\tinitialJobEquipment,\n\t\tinitialTasks,\n\t\tinitialJobNotes,\n\t]);\n\n\t// Extract job tags from junction table (now included in RPC response)\n\t// EntityTags expects {label, color} format\n\tconst jobTags = useMemo(() => {\n\t\tif (!entityData?.job_tags) return [];\n\t\treturn entityData.job_tags.map((jt: any) => ({\n\t\t\tlabel: jt.name || jt.label,\n\t\t\tcolor: jt.color,\n\t\t}));\n\t}, [entityData?.job_tags]);\n\n\t// Fetch available estimates when link dialog opens\n\tuseEffect(() => {\n\t\tif (!isLinkEstimateOpen || !job?.company_id) return;\n\n\t\tconst fetchEstimates = async () => {\n\t\t\tconst supabase = createClient();\n\t\t\tconst { data, error } = await supabase\n\t\t\t\t.from(\"estimates\")\n\t\t\t\t.select(\n\t\t\t\t\t`\n\t\t\t\t\tid,\n\t\t\t\t\testimate_number,\n\t\t\t\t\ttotal_amount,\n\t\t\t\t\tstatus,\n\t\t\t\t\tcreated_at,\n\t\t\t\t\tcustomer:customers(id, name)\n\t\t\t\t`,\n\t\t\t\t)\n\t\t\t\t.eq(\"company_id\", job.company_id)\n\t\t\t\t.or(`job_id.is.null,job_id.neq.${job.id}`)\n\t\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t\t.limit(50);\n\n\t\t\tif (!error && data) {\n\t\t\t\tsetAvailableEstimates(data as any);\n\t\t\t}\n\t\t};\n\n\t\tfetchEstimates();\n\t}, [isLinkEstimateOpen, job?.company_id, job?.id]);\n\n\t// Fetch available invoices when link dialog opens\n\tuseEffect(() => {\n\t\tif (!isLinkInvoiceOpen || !job?.company_id) return;\n\n\t\tconst fetchInvoices = async () => {\n\t\t\tconst supabase = createClient();\n\t\t\tconst { data, error } = await supabase\n\t\t\t\t.from(\"invoices\")\n\t\t\t\t.select(\n\t\t\t\t\t`\n\t\t\t\t\tid,\n\t\t\t\t\tinvoice_number,\n\t\t\t\t\ttotal_amount,\n\t\t\t\t\tstatus,\n\t\t\t\t\tcreated_at,\n\t\t\t\t\tcustomer:customers(id, name)\n\t\t\t\t`,\n\t\t\t\t)\n\t\t\t\t.eq(\"company_id\", job.company_id)\n\t\t\t\t.or(`job_id.is.null,job_id.neq.${job.id}`)\n\t\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t\t.limit(50);\n\n\t\t\tif (!error && data) {\n\t\t\t\tsetAvailableInvoices(data as any);\n\t\t\t}\n\t\t};\n\n\t\tfetchInvoices();\n\t}, [isLinkInvoiceOpen, job?.company_id, job?.id]);\n\n\t// Fetch available payments when link dialog opens\n\tuseEffect(() => {\n\t\tif (!isLinkPaymentOpen || !job?.company_id) return;\n\n\t\tconst fetchPayments = async () => {\n\t\t\tconst supabase = createClient();\n\t\t\tconst { data, error } = await supabase\n\t\t\t\t.from(\"payments\")\n\t\t\t\t.select(\n\t\t\t\t\t`\n\t\t\t\t\tid,\n\t\t\t\t\tamount,\n\t\t\t\t\tpayment_method,\n\t\t\t\t\treference_number,\n\t\t\t\t\tcreated_at,\n\t\t\t\t\tcustomer:customers(id, name)\n\t\t\t\t`,\n\t\t\t\t)\n\t\t\t\t.eq(\"company_id\", job.company_id)\n\t\t\t\t.or(`job_id.is.null,job_id.neq.${job.id}`)\n\t\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t\t.limit(50);\n\n\t\t\tif (!error && data) {\n\t\t\t\tsetAvailablePayments(data as any);\n\t\t\t}\n\t\t};\n\n\t\tfetchPayments();\n\t}, [isLinkPaymentOpen, job?.company_id, job?.id]);\n\n\t// Fetch available equipment when link dialog opens\n\tuseEffect(() => {\n\t\tif (!isLinkEquipmentOpen || !job?.company_id) return;\n\n\t\tconst fetchEquipment = async () => {\n\t\t\tconst supabase = createClient();\n\t\t\tconst { data, error } = await supabase\n\t\t\t\t.from(\"equipment\")\n\t\t\t\t.select(\"id, name, category, serial_number, created_at\")\n\t\t\t\t.eq(\"company_id\", job.company_id)\n\t\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t\t.limit(50);\n\n\t\t\tif (!error && data) {\n\t\t\t\tsetAvailableEquipment(data as any);\n\t\t\t}\n\t\t};\n\n\t\tfetchEquipment();\n\t}, [isLinkEquipmentOpen, job?.company_id]);\n\n\t// Keyboard shortcuts: Ctrl+1 through Ctrl+9 to scroll and expand accordion sections\n\tconst sectionShortcuts = useMemo(\n\t\t() => ({\n\t\t\t\"1\": () => {\n\t\t\t\tconst element = document.querySelector('[data-section-id=\"customer\"]');\n\t\t\t\tif (element) {\n\t\t\t\t\telement.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n\t\t\t\t\tconst trigger = element.querySelector(\"[data-accordion-trigger]\");\n\t\t\t\t\tif (trigger && trigger.getAttribute(\"data-state\") === \"closed\") {\n\t\t\t\t\t\t(trigger as HTMLElement).click();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"2\": () => {\n\t\t\t\tconst element = document.querySelector('[data-section-id=\"team\"]');\n\t\t\t\tif (element) {\n\t\t\t\t\telement.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n\t\t\t\t\tconst trigger = element.querySelector(\"[data-accordion-trigger]\");\n\t\t\t\t\tif (trigger && trigger.getAttribute(\"data-state\") === \"closed\") {\n\t\t\t\t\t\t(trigger as HTMLElement).click();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"3\": () => {\n\t\t\t\tconst element = document.querySelector(\n\t\t\t\t\t'[data-section-id=\"appointments\"]',\n\t\t\t\t);\n\t\t\t\tif (element) {\n\t\t\t\t\telement.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n\t\t\t\t\tconst trigger = element.querySelector(\"[data-accordion-trigger]\");\n\t\t\t\t\tif (trigger && trigger.getAttribute(\"data-state\") === \"closed\") {\n\t\t\t\t\t\t(trigger as HTMLElement).click();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"4\": () => {\n\t\t\t\tconst element = document.querySelector('[data-section-id=\"estimates\"]');\n\t\t\t\tif (element) {\n\t\t\t\t\telement.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n\t\t\t\t\tconst trigger = element.querySelector(\"[data-accordion-trigger]\");\n\t\t\t\t\tif (trigger && trigger.getAttribute(\"data-state\") === \"closed\") {\n\t\t\t\t\t\t(trigger as HTMLElement).click();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"5\": () => {\n\t\t\t\tconst element = document.querySelector('[data-section-id=\"invoices\"]');\n\t\t\t\tif (element) {\n\t\t\t\t\telement.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n\t\t\t\t\tconst trigger = element.querySelector(\"[data-accordion-trigger]\");\n\t\t\t\t\tif (trigger && trigger.getAttribute(\"data-state\") === \"closed\") {\n\t\t\t\t\t\t(trigger as HTMLElement).click();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"6\": () => {\n\t\t\t\tconst element = document.querySelector('[data-section-id=\"payments\"]');\n\t\t\t\tif (element) {\n\t\t\t\t\telement.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n\t\t\t\t\tconst trigger = element.querySelector(\"[data-accordion-trigger]\");\n\t\t\t\t\tif (trigger && trigger.getAttribute(\"data-state\") === \"closed\") {\n\t\t\t\t\t\t(trigger as HTMLElement).click();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"7\": () => {\n\t\t\t\tconst element = document.querySelector(\n\t\t\t\t\t'[data-section-id=\"purchase-orders\"]',\n\t\t\t\t);\n\t\t\t\tif (element) {\n\t\t\t\t\telement.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n\t\t\t\t\tconst trigger = element.querySelector(\"[data-accordion-trigger]\");\n\t\t\t\t\tif (trigger && trigger.getAttribute(\"data-state\") === \"closed\") {\n\t\t\t\t\t\t(trigger as HTMLElement).click();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"8\": () => {\n\t\t\t\tconst element = document.querySelector('[data-section-id=\"tasks\"]');\n\t\t\t\tif (element) {\n\t\t\t\t\telement.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n\t\t\t\t\tconst trigger = element.querySelector(\"[data-accordion-trigger]\");\n\t\t\t\t\tif (trigger && trigger.getAttribute(\"data-state\") === \"closed\") {\n\t\t\t\t\t\t(trigger as HTMLElement).click();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"9\": () => {\n\t\t\t\tconst element = document.querySelector('[data-section-id=\"notes\"]');\n\t\t\t\tif (element) {\n\t\t\t\t\telement.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n\t\t\t\t\tconst trigger = element.querySelector(\"[data-accordion-trigger]\");\n\t\t\t\t\tif (trigger && trigger.getAttribute(\"data-state\") === \"closed\") {\n\t\t\t\t\t\t(trigger as HTMLElement).click();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t}),\n\t\t[],\n\t);\n\n\tuseSectionShortcuts(sectionShortcuts);\n\n\t// Local state for optimistic updates\n\tconst [customer, setCustomer] = useState(initialCustomer);\n\tconst [property, setProperty] = useState(initialProperty);\n\n\tconst hasMapsApiKey = Boolean(process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY);\n\tconst canShowInteractiveMap =\n\t\tBoolean(property?.lat && property?.lon) || hasMapsApiKey;\n\n\tconst [customerSearchQuery, _setCustomerSearchQuery] = useState(\"\");\n\tconst [propertySearchQuery, _setPropertySearchQuery] = useState(\"\");\n\tconst [_propertyDropdownMode, setPropertyDropdownMode] = useState<\n\t\t\"search\" | \"add\"\n\t>(\"search\");\n\tconst [_isUpdatingCustomer, _setIsUpdatingCustomer] = useState(false);\n\tconst [_isUpdatingProperty, setIsUpdatingProperty] = useState(false);\n\tconst [isCreatePropertyDialogOpen, setIsCreatePropertyDialogOpen] =\n\t\tuseState(false);\n\tconst [isCreatingProperty, setIsCreatingProperty] = useState(false);\n\tconst [newProperty, setNewProperty] = useState({\n\t\tname: \"\",\n\t\taddress: \"\",\n\t\taddress2: \"\",\n\t\tcity: \"\",\n\t\tstate: \"\",\n\t\tzipCode: \"\",\n\t});\n\n\t// Communication dialog states\n\tconst [isSMSDialogOpen, setIsSMSDialogOpen] = useState(false);\n\tconst [isRemoveCustomerDialogOpen, setIsRemoveCustomerDialogOpen] =\n\t\tuseState(false);\n\n\t// File input ref for direct upload\n\tconst fileInputRef = React.useRef<HTMLInputElement>(null);\n\n\t// Get call management from UI store\n\tconst setIncomingCall = useUIStore((state) => state.setIncomingCall);\n\n\t// Filter properties by customer for property dialog\n\tconst availableProperties = customer?.id\n\t\t? allProperties.filter((p: any) => p.customer_id === customer.id)\n\t\t: [];\n\n\t// Handle field changes\n\tconst handleFieldChange = (field: string, value: any) => {\n\t\tsetLocalJob({ ...localJob, [field]: value });\n\t\tsetHasChanges(true);\n\t};\n\n\t// Handle customer change\n\tconst _handleCustomerChange = async (newCustomerId: string | null) => {\n\t\tif (newCustomerId === customer?.id) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Store original values for rollback\n\t\tconst originalCustomer = customer;\n\t\tconst originalProperty = property;\n\n\t\t// Optimistic update - update UI immediately\n\t\tconst newCustomer = newCustomerId\n\t\t\t? allCustomers.find((c: any) => c.id === newCustomerId)\n\t\t\t: null;\n\t\tsetCustomer(newCustomer);\n\n\t\t// Check if property needs to be cleared\n\t\tlet shouldClearProperty = false;\n\t\tif (!newCustomerId) {\n\t\t\t// Customer removed - clear property\n\t\t\tshouldClearProperty = true;\n\t\t} else if (property?.id) {\n\t\t\t// Customer changed - clear property if it doesn't belong to new customer\n\t\t\tconst propertyBelongsToCustomer = allProperties.some(\n\t\t\t\t(p: any) => p.id === property.id && p.customer_id === newCustomerId,\n\t\t\t);\n\t\t\tif (!propertyBelongsToCustomer) {\n\t\t\t\tshouldClearProperty = true;\n\t\t\t}\n\t\t}\n\n\t\tif (shouldClearProperty) {\n\t\t\tsetProperty(null);\n\t\t}\n\n\t\t// Show loading toast\n\t\ttoast.loading(\"Updating customer...\", { id: \"customer-update\" });\n\n\t\ttry {\n\t\t\tconst formData = new FormData();\n\t\t\tformData.append(\"customerId\", newCustomerId || \"\");\n\n\t\t\tif (shouldClearProperty) {\n\t\t\t\tformData.append(\"propertyId\", \"\");\n\t\t\t}\n\n\t\t\tconst result = await updateJob(job.id, formData);\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Customer updated successfully\", {\n\t\t\t\t\tid: \"customer-update\",\n\t\t\t\t});\n\t\t\t\t// Server Action handles revalidation automatically\n\t\t\t} else {\n\t\t\t\t// Rollback on error\n\t\t\t\tsetCustomer(originalCustomer);\n\t\t\t\tsetProperty(originalProperty);\n\t\t\t\ttoast.error(result.error || \"Failed to update customer\", {\n\t\t\t\t\tid: \"customer-update\",\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\t// Rollback on error\n\t\t\tsetCustomer(originalCustomer);\n\t\t\tsetProperty(originalProperty);\n\t\t\ttoast.error(\"Failed to update customer\", { id: \"customer-update\" });\n\t\t}\n\t};\n\n\t// Handle property change\n\tconst _handlePropertyChange = async (newPropertyId: string | null) => {\n\t\tif (newPropertyId === property?.id) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Store original for rollback\n\t\tconst originalProperty = property;\n\n\t\t// Optimistic update - update UI immediately\n\t\tconst newProperty = newPropertyId\n\t\t\t? allProperties.find((p: any) => p.id === newPropertyId)\n\t\t\t: null;\n\t\tsetProperty(newProperty);\n\n\t\t// Show loading toast\n\t\ttoast.loading(\"Updating property...\", { id: \"property-update\" });\n\n\t\ttry {\n\t\t\tconst formData = new FormData();\n\t\t\tformData.append(\"propertyId\", newPropertyId || \"\");\n\n\t\t\tconst result = await updateJob(job.id, formData);\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Property updated successfully\", {\n\t\t\t\t\tid: \"property-update\",\n\t\t\t\t});\n\t\t\t\t// Server Action handles revalidation automatically\n\t\t\t} else {\n\t\t\t\t// Rollback on error\n\t\t\t\tsetProperty(originalProperty);\n\t\t\t\ttoast.error(result.error || \"Failed to update property\", {\n\t\t\t\t\tid: \"property-update\",\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\t// Rollback on error\n\t\t\tsetProperty(originalProperty);\n\t\t\ttoast.error(\"Failed to update property\", { id: \"property-update\" });\n\t\t}\n\t};\n\n\t// Handle remove customer\n\tconst _handleRemoveCustomer = async () => {\n\t\t// Store original for rollback\n\t\tconst originalCustomer = customer;\n\t\tconst originalProperty = property;\n\n\t\t// Optimistic update - clear immediately\n\t\tsetCustomer(null);\n\t\tsetProperty(null);\n\n\t\t// Show loading toast\n\t\ttoast.loading(\"Removing customer...\", { id: \"customer-remove\" });\n\n\t\ttry {\n\t\t\tconst formData = new FormData();\n\t\t\tformData.append(\"customerId\", \"\");\n\t\t\tformData.append(\"propertyId\", \"\"); // Also remove property since properties are linked to customers\n\n\t\t\tconst result = await updateJob(job.id, formData);\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Customer and property removed successfully\", {\n\t\t\t\t\tid: \"customer-remove\",\n\t\t\t\t});\n\t\t\t\t// Server Action handles revalidation automatically\n\t\t\t} else {\n\t\t\t\t// Rollback on error\n\t\t\t\tsetCustomer(originalCustomer);\n\t\t\t\tsetProperty(originalProperty);\n\t\t\t\ttoast.error(result.error || \"Failed to remove customer\", {\n\t\t\t\t\tid: \"customer-remove\",\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\t// Rollback on error\n\t\t\tsetCustomer(originalCustomer);\n\t\t\tsetProperty(originalProperty);\n\t\t\ttoast.error(\"Failed to remove customer\", { id: \"customer-remove\" });\n\t\t}\n\t};\n\n\t// Handle create new property from Google Places\n\tconst _handlePlaceSelect = async (place: {\n\t\taddress: string;\n\t\taddress2?: string;\n\t\tcity: string;\n\t\tstate: string;\n\t\tzipCode: string;\n\t\tcountry: string;\n\t\tlat: number;\n\t\tlon: number;\n\t\tformattedAddress: string;\n\t}) => {\n\t\tif (!customer?.id) {\n\t\t\ttoast.error(\"Please select a customer first\");\n\t\t\treturn;\n\t\t}\n\n\t\t// Store original property for rollback\n\t\tconst originalProperty = property;\n\n\t\t// Create optimistic property object\n\t\tconst optimisticProperty = {\n\t\t\tid: `temp-${Date.now()}`,\n\t\t\tcustomer_id: customer.id,\n\t\t\tcompany_id: customer.company_id,\n\t\t\tname: place.formattedAddress,\n\t\t\taddress: place.address,\n\t\t\taddress2: place.address2,\n\t\t\tcity: place.city,\n\t\t\tstate: place.state,\n\t\t\tzip_code: place.zipCode,\n\t\t\tcountry: place.country,\n\t\t\tlat: place.lat,\n\t\t\tlon: place.lon,\n\t\t};\n\n\t\t// Optimistically update UI immediately - feels instant!\n\t\tsetProperty(optimisticProperty as any);\n\t\tsetPropertyDropdownMode(\"search\");\n\t\tsetIsUpdatingProperty(false);\n\n\t\t// Show success immediately\n\t\ttoast.success(\"Property added!\", { duration: 2000 });\n\n\t\t// Create property in background (fast because no blocking geocoding)\n\t\ttry {\n\t\t\tconst formData = new FormData();\n\t\t\tformData.append(\"customerId\", customer.id);\n\t\t\tformData.append(\"name\", place.formattedAddress);\n\t\t\tformData.append(\"address\", place.address);\n\t\t\tformData.append(\"address2\", place.address2 || \"\");\n\t\t\tformData.append(\"city\", place.city);\n\t\t\tformData.append(\"state\", place.state);\n\t\t\tformData.append(\"zipCode\", place.zipCode);\n\t\t\tformData.append(\"country\", place.country);\n\t\t\t// Pass coordinates from Google Places - no need to geocode again!\n\t\t\tformData.append(\"lat\", place.lat.toString());\n\t\t\tformData.append(\"lon\", place.lon.toString());\n\n\t\t\tconst result = await findOrCreateProperty(formData);\n\t\t\tif (result.success && result.data) {\n\t\t\t\t// Update job with new property\n\t\t\t\tconst jobFormData = new FormData();\n\t\t\t\tjobFormData.append(\"propertyId\", result.data);\n\n\t\t\t\tconst updateResult = await updateJob(job.id, jobFormData);\n\t\t\t\tif (updateResult.success) {\n\t\t\t\t\t// Server Action handles revalidation automatically\n\t\t\t\t} else {\n\t\t\t\t\t// Rollback on error\n\t\t\t\t\tsetProperty(originalProperty);\n\t\t\t\t\ttoast.error(updateResult.error || \"Failed to assign property to job\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Rollback on error\n\t\t\t\tsetProperty(originalProperty);\n\t\t\t\ttoast.error(result.error ?? \"Failed to create property\");\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\t// Rollback on error\n\t\t\tsetProperty(originalProperty);\n\t\t\ttoast.error(\"Failed to create property\");\n\t\t}\n\t};\n\n\t// Handle create new property (from dialog)\n\tconst handleCreateProperty = async () => {\n\t\tif (!customer?.id) {\n\t\t\ttoast.error(\"Please select a customer first\");\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsCreatingProperty(true);\n\t\ttry {\n\t\t\tconst formData = new FormData();\n\t\t\tformData.append(\"customerId\", customer.id);\n\t\t\tformData.append(\"name\", newProperty.name);\n\t\t\tformData.append(\"address\", newProperty.address);\n\t\t\tformData.append(\"address2\", newProperty.address2);\n\t\t\tformData.append(\"city\", newProperty.city);\n\t\t\tformData.append(\"state\", newProperty.state);\n\t\t\tformData.append(\"zipCode\", newProperty.zipCode);\n\n\t\t\tconst result = await findOrCreateProperty(formData);\n\t\t\tif (result.success && result.data) {\n\t\t\t\t// Update job with new property\n\t\t\t\tconst jobFormData = new FormData();\n\t\t\t\tjobFormData.append(\"propertyId\", result.data);\n\n\t\t\t\tconst updateResult = await updateJob(job.id, jobFormData);\n\t\t\t\tif (updateResult.success) {\n\t\t\t\t\ttoast.success(\"Property created and assigned successfully\");\n\t\t\t\t\tsetIsCreatePropertyDialogOpen(false);\n\t\t\t\t\tsetNewProperty({\n\t\t\t\t\t\tname: \"\",\n\t\t\t\t\t\taddress: \"\",\n\t\t\t\t\t\taddress2: \"\",\n\t\t\t\t\t\tcity: \"\",\n\t\t\t\t\t\tstate: \"\",\n\t\t\t\t\t\tzipCode: \"\",\n\t\t\t\t\t});\n\t\t\t\t\t// Server Action handles revalidation automatically\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(updateResult.error || \"Failed to assign property to job\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error ?? \"Failed to create property\");\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\ttoast.error(\"Failed to create property\");\n\t\t} finally {\n\t\t\tsetIsCreatingProperty(false);\n\t\t}\n\t};\n\n\tconst handleAssignTeamMember = async (teamMemberId: string, role: string) => {\n\t\ttry {\n\t\t\tconst result = await assignTeamMemberToJob({\n\t\t\t\tjobId: job.id,\n\t\t\t\tteamMemberId,\n\t\t\t\trole,\n\t\t\t});\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Team member assigned\");\n\t\t\t\t// Use safe refresh to prevent infinite loops\n\t\t\t\tsafeRefresh();\n\t\t\t} else {\n\t\t\t\tconsole.error(\"Assignment failed:\", result.error, result);\n\t\t\t\ttoast.error(result.error || \"Failed to assign team member\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to assign team member:\", error);\n\t\t\tconst errorMessage =\n\t\t\t\terror instanceof Error ? error.message : \"Failed to assign team member\";\n\t\t\ttoast.error(errorMessage);\n\t\t}\n\t};\n\n\tconst handleRemoveTeamMember = async (\n\t\tteamMemberId: string,\n\t): Promise<{ success: boolean; error?: string }> => {\n\t\ttry {\n\t\t\tconst result = await removeTeamMemberFromJob({\n\t\t\t\tjobId: job.id,\n\t\t\t\tteamMemberId,\n\t\t\t});\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Team member removed\");\n\t\t\t\tsafeRefresh();\n\t\t\t\treturn { success: true };\n\t\t\t} else {\n\t\t\t\tconst errorMessage = result.error || \"Failed to remove team member\";\n\t\t\t\ttoast.error(errorMessage);\n\t\t\t\treturn { success: false, error: errorMessage };\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to remove team member:\", error);\n\t\t\tconst errorMessage =\n\t\t\t\terror instanceof Error ? error.message : \"Failed to remove team member\";\n\t\t\ttoast.error(errorMessage);\n\t\t\treturn { success: false, error: errorMessage };\n\t\t}\n\t};\n\n\t// Filter customers based on search\n\tconst _filteredCustomers = allCustomers.filter((c: any) => {\n\t\tif (!customerSearchQuery) {\n\t\t\treturn true;\n\t\t}\n\t\tconst query = customerSearchQuery.toLowerCase();\n\t\tconst fullName = `${c.first_name} ${c.last_name}`.toLowerCase();\n\t\tconst phone = c.phone?.toLowerCase() || \"\";\n\t\tconst email = c.email?.toLowerCase() || \"\";\n\t\tconst company = c.company_name?.toLowerCase() || \"\";\n\t\treturn (\n\t\t\tfullName.includes(query) ||\n\t\t\tphone.includes(query) ||\n\t\t\temail.includes(query) ||\n\t\t\tcompany.includes(query)\n\t\t);\n\t});\n\n\t// Filter properties based on search\n\tconst _filteredProperties = availableProperties.filter((p: any) => {\n\t\tif (!propertySearchQuery) {\n\t\t\treturn true;\n\t\t}\n\t\tconst query = propertySearchQuery.toLowerCase();\n\t\tconst name = p.name?.toLowerCase() || \"\";\n\t\tconst address = p.address?.toLowerCase() || \"\";\n\t\tconst city = p.city?.toLowerCase() || \"\";\n\t\treturn (\n\t\t\tname.includes(query) || address.includes(query) || city.includes(query)\n\t\t);\n\t});\n\n\t// Save changes\n\tconst handleSave = async () => {\n\t\t// Snapshot current state for rollback\n\t\tconst previousState = { ...localJob };\n\n\t\tsetIsSaving(true);\n\t\ttry {\n\t\t\tconst formData = new FormData();\n\t\t\tif (localJob.title !== jobData.job.title) {\n\t\t\t\tformData.append(\"title\", localJob.title);\n\t\t\t}\n\t\t\tif (localJob.description !== jobData.job.description) {\n\t\t\t\tformData.append(\"description\", localJob.description || \"\");\n\t\t\t}\n\t\t\tif (localJob.status !== jobData.job.status) {\n\t\t\t\tformData.append(\"status\", localJob.status);\n\t\t\t}\n\t\t\tif (localJob.priority !== jobData.job.priority) {\n\t\t\t\tformData.append(\"priority\", localJob.priority || \"medium\");\n\t\t\t}\n\t\t\tif (localJob.job_type !== jobData.job.job_type) {\n\t\t\t\tformData.append(\"jobType\", localJob.job_type || \"\");\n\t\t\t}\n\t\t\tif (localJob.notes !== jobData.job.notes) {\n\t\t\t\tformData.append(\"notes\", localJob.notes || \"\");\n\t\t\t}\n\n\t\t\tconst result = await updateJob(jobData.job.id, formData);\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Changes saved successfully\");\n\t\t\t\tsetHasChanges(false);\n\t\t\t\t// Update local state immediately with the saved values\n\t\t\t\tconst updatedJob = { ...localJob };\n\t\t\t\tif (formData.has(\"title\")) {\n\t\t\t\t\tupdatedJob.title = formData.get(\"title\") as string;\n\t\t\t\t}\n\t\t\t\tif (formData.has(\"description\")) {\n\t\t\t\t\tupdatedJob.description = formData.get(\"description\") as string;\n\t\t\t\t}\n\t\t\t\tif (formData.has(\"status\")) {\n\t\t\t\t\tupdatedJob.status = formData.get(\"status\") as string;\n\t\t\t\t}\n\t\t\t\tif (formData.has(\"priority\")) {\n\t\t\t\t\tupdatedJob.priority = formData.get(\"priority\") as string;\n\t\t\t\t}\n\t\t\t\tif (formData.has(\"jobType\")) {\n\t\t\t\t\tupdatedJob.job_type = formData.get(\"jobType\") as string;\n\t\t\t\t}\n\t\t\t\tif (formData.has(\"notes\")) {\n\t\t\t\t\tupdatedJob.notes = formData.get(\"notes\") as string;\n\t\t\t\t}\n\t\t\t\tsetLocalJob(updatedJob);\n\t\t\t\t// Force router refresh to get latest data from server\n\t\t\t\t// Server Action handles revalidation automatically\n\t\t\t} else {\n\t\t\t\t// ROLLBACK: Restore previous state on save failure\n\t\t\t\tsetLocalJob(previousState);\n\t\t\t\tsetHasChanges(false);\n\t\t\t\ttoast.error(\n\t\t\t\t\tresult.error || \"Failed to save changes - changes reverted\",\n\t\t\t\t);\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\t// ROLLBACK: Restore previous state on exception\n\t\t\tsetLocalJob(previousState);\n\t\t\tsetHasChanges(false);\n\t\t\ttoast.error(\"Failed to save changes - changes reverted\");\n\t\t} finally {\n\t\t\tsetIsSaving(false);\n\t\t}\n\t};\n\n\t// Handle job costing updates\n\tconst handleUpdateCosting = async (costingData: any) => {\n\t\tconst formData = new FormData();\n\n\t\t// Add all costing fields\n\t\tif (costingData.labor_hours_estimated !== undefined) {\n\t\t\tformData.append(\n\t\t\t\t\"labor_hours_estimated\",\n\t\t\t\tcostingData.labor_hours_estimated.toString(),\n\t\t\t);\n\t\t}\n\t\tif (costingData.labor_hours_actual !== undefined) {\n\t\t\tformData.append(\n\t\t\t\t\"labor_hours_actual\",\n\t\t\t\tcostingData.labor_hours_actual.toString(),\n\t\t\t);\n\t\t}\n\t\tif (costingData.labor_rate !== undefined) {\n\t\t\tformData.append(\"labor_rate\", costingData.labor_rate.toString());\n\t\t}\n\t\tif (costingData.labor_burden_percent !== undefined) {\n\t\t\tformData.append(\n\t\t\t\t\"labor_burden_percent\",\n\t\t\t\tcostingData.labor_burden_percent.toString(),\n\t\t\t);\n\t\t}\n\t\tif (costingData.labor_cost_total !== undefined) {\n\t\t\tformData.append(\n\t\t\t\t\"labor_cost_total\",\n\t\t\t\tcostingData.labor_cost_total.toString(),\n\t\t\t);\n\t\t}\n\t\tif (costingData.materials_cost_actual !== undefined) {\n\t\t\tformData.append(\n\t\t\t\t\"materials_cost_actual\",\n\t\t\t\tcostingData.materials_cost_actual.toString(),\n\t\t\t);\n\t\t}\n\t\tif (costingData.materials_markup_percent !== undefined) {\n\t\t\tformData.append(\n\t\t\t\t\"materials_markup_percent\",\n\t\t\t\tcostingData.materials_markup_percent.toString(),\n\t\t\t);\n\t\t}\n\t\tif (costingData.materials_revenue !== undefined) {\n\t\t\tformData.append(\n\t\t\t\t\"materials_revenue\",\n\t\t\t\tcostingData.materials_revenue.toString(),\n\t\t\t);\n\t\t}\n\t\tif (costingData.equipment_cost !== undefined) {\n\t\t\tformData.append(\"equipment_cost\", costingData.equipment_cost.toString());\n\t\t}\n\t\tif (costingData.subcontractor_cost !== undefined) {\n\t\t\tformData.append(\n\t\t\t\t\"subcontractor_cost\",\n\t\t\t\tcostingData.subcontractor_cost.toString(),\n\t\t\t);\n\t\t}\n\t\tif (costingData.overhead_allocation !== undefined) {\n\t\t\tformData.append(\n\t\t\t\t\"overhead_allocation\",\n\t\t\t\tcostingData.overhead_allocation.toString(),\n\t\t\t);\n\t\t}\n\t\tif (costingData.total_cost_actual !== undefined) {\n\t\t\tformData.append(\n\t\t\t\t\"total_cost_actual\",\n\t\t\t\tcostingData.total_cost_actual.toString(),\n\t\t\t);\n\t\t}\n\t\tif (costingData.total_revenue !== undefined) {\n\t\t\tformData.append(\"total_revenue\", costingData.total_revenue.toString());\n\t\t}\n\t\tif (costingData.profit_margin_actual !== undefined) {\n\t\t\tformData.append(\n\t\t\t\t\"profit_margin_actual\",\n\t\t\t\tcostingData.profit_margin_actual.toString(),\n\t\t\t);\n\t\t}\n\t\tif (costingData.profit_margin_target !== undefined) {\n\t\t\tformData.append(\n\t\t\t\t\"profit_margin_target\",\n\t\t\t\tcostingData.profit_margin_target.toString(),\n\t\t\t);\n\t\t}\n\n\t\tconst result = await updateJob(job.id, formData);\n\t\tif (result.success) {\n\t\t\ttoast.success(\"Job costing updated successfully\");\n\t\t} else {\n\t\t\ttoast.error(result.error || \"Failed to update job costing\");\n\t\t\tthrow new Error(result.error || \"Failed to update job costing\");\n\t\t}\n\t};\n\n\tconst formatCurrency = (cents: number) =>\n\t\tnew Intl.NumberFormat(\"en-US\", {\n\t\t\tstyle: \"currency\",\n\t\t\tcurrency: \"USD\",\n\t\t}).format(cents / 100);\n\n\tconst formatDate = (date: string | null) => {\n\t\tif (!date) {\n\t\t\treturn \"Not set\";\n\t\t}\n\t\treturn new Intl.DateTimeFormat(\"en-US\", {\n\t\t\tmonth: \"short\",\n\t\t\tday: \"numeric\",\n\t\t\tyear: \"numeric\",\n\t\t\thour: \"numeric\",\n\t\t\tminute: \"2-digit\",\n\t\t}).format(new Date(date));\n\t};\n\n\tconst _formatHours = (hours: number) => `${hours.toFixed(1)}h`;\n\n\tconst _formatTime = (date: string | null) => {\n\t\tif (!date) {\n\t\t\treturn \"Not set\";\n\t\t}\n\t\treturn new Intl.DateTimeFormat(\"en-US\", {\n\t\t\thour: \"numeric\",\n\t\t\tminute: \"2-digit\",\n\t\t}).format(new Date(date));\n\t};\n\n\tconst _formatDuration = (minutes: number | null) => {\n\t\tif (!minutes) {\n\t\t\treturn \"-\";\n\t\t}\n\t\tconst hours = Math.floor(minutes / 60);\n\t\tconst mins = minutes % 60;\n\t\tif (hours > 0 && mins > 0) {\n\t\t\treturn `${hours}h ${mins}m`;\n\t\t}\n\t\tif (hours > 0) {\n\t\t\treturn `${hours}h`;\n\t\t}\n\t\treturn `${mins}m`;\n\t};\n\n\tconst formatRelativeTime = (date: string | Date | null) => {\n\t\tif (!date) {\n\t\t\treturn \"—\";\n\t\t}\n\t\tconst value =\n\t\t\ttypeof date === \"string\" || typeof date === \"number\"\n\t\t\t\t? new Date(date)\n\t\t\t\t: date;\n\n\t\tif (!value || Number.isNaN(value.getTime())) {\n\t\t\treturn \"—\";\n\t\t}\n\n\t\tconst diffMs = value.getTime() - Date.now();\n\t\tconst diffMinutes = Math.round(diffMs / (1000 * 60));\n\t\tconst rtf = new Intl.RelativeTimeFormat(\"en\", { numeric: \"auto\" });\n\n\t\tif (Math.abs(diffMinutes) < 60) {\n\t\t\treturn rtf.format(diffMinutes, \"minute\");\n\t\t}\n\n\t\tconst diffHours = Math.round(diffMinutes / 60);\n\t\tif (Math.abs(diffHours) < 24) {\n\t\t\treturn rtf.format(diffHours, \"hour\");\n\t\t}\n\n\t\tconst diffDays = Math.round(diffHours / 24);\n\t\tif (Math.abs(diffDays) < 30) {\n\t\t\treturn rtf.format(diffDays, \"day\");\n\t\t}\n\n\t\tconst diffMonths = Math.round(diffDays / 30);\n\t\tif (Math.abs(diffMonths) < 12) {\n\t\t\treturn rtf.format(diffMonths, \"month\");\n\t\t}\n\n\t\tconst diffYears = Math.round(diffMonths / 12);\n\t\treturn rtf.format(diffYears, \"year\");\n\t};\n\n\tconst customerDetailPath = customer\n\t\t? `/dashboard/customers/${customer.id}`\n\t\t: null;\n\n\tconst parseMaybeJson = (value: unknown) => {\n\t\tif (!value) {\n\t\t\treturn null;\n\t\t}\n\t\tif (typeof value === \"string\") {\n\t\t\ttry {\n\t\t\t\treturn JSON.parse(value);\n\t\t\t} catch {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\tif (typeof value === \"object\") {\n\t\t\treturn value as Record<string, unknown>;\n\t\t}\n\t\treturn null;\n\t};\n\n\tconst customerTags = useMemo<string[]>(() => {\n\t\tconst normalizeTagArray = (tags: unknown[]): string[] =>\n\t\t\ttags\n\t\t\t\t.filter(\n\t\t\t\t\t(tag): tag is string =>\n\t\t\t\t\t\ttypeof tag === \"string\" && tag.trim().length > 0,\n\t\t\t\t)\n\t\t\t\t.map((tag) => tag.trim());\n\n\t\tif (!customer?.tags) {\n\t\t\treturn [];\n\t\t}\n\n\t\tif (Array.isArray(customer.tags)) {\n\t\t\treturn normalizeTagArray(customer.tags);\n\t\t}\n\n\t\tif (typeof customer.tags === \"string\") {\n\t\t\ttry {\n\t\t\t\tconst parsed = JSON.parse(customer.tags);\n\t\t\t\tif (Array.isArray(parsed)) {\n\t\t\t\t\treturn normalizeTagArray(parsed);\n\t\t\t\t}\n\t\t\t\tif (typeof parsed === \"string\") {\n\t\t\t\t\treturn parsed\n\t\t\t\t\t\t.split(\",\")\n\t\t\t\t\t\t.map((tag) => tag.trim())\n\t\t\t\t\t\t.filter(Boolean);\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\treturn customer.tags\n\t\t\t\t\t.split(\",\")\n\t\t\t\t\t.map((tag: string) => tag.trim())\n\t\t\t\t\t.filter(Boolean);\n\t\t\t}\n\t\t}\n\n\t\treturn [];\n\t}, [customer?.tags]);\n\n\tconst customerMetadata = useMemo<Record<string, any>>(() => {\n\t\tconst parsed = parseMaybeJson(customer?.metadata);\n\t\treturn parsed && typeof parsed === \"object\"\n\t\t\t? (parsed as Record<string, any>)\n\t\t\t: {};\n\t}, [customer?.metadata, parseMaybeJson]);\n\n\tconst communicationPreferences = useMemo<Record<\n\t\tstring,\n\t\tboolean\n\t> | null>(() => {\n\t\tconst parsed = parseMaybeJson(customer?.communication_preferences);\n\t\tif (parsed && typeof parsed === \"object\") {\n\t\t\treturn parsed as Record<string, boolean>;\n\t\t}\n\t\treturn null;\n\t}, [customer?.communication_preferences, parseMaybeJson]);\n\n\tconst membershipLabel = useMemo(() => {\n\t\tconst fromMetadata =\n\t\t\tcustomerMetadata.membershipTier ||\n\t\t\tcustomerMetadata.membership_level ||\n\t\t\tcustomerMetadata.membership ||\n\t\t\tcustomerMetadata.plan;\n\n\t\tif (fromMetadata) {\n\t\t\treturn fromMetadata;\n\t\t}\n\n\t\tconst vipTag = customerTags.find((tag) => {\n\t\t\tif (typeof tag !== \"string\") {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst lowerTag = tag.toLowerCase();\n\t\t\treturn [\"vip\", \"member\", \"plan\", \"tier\", \"priority\"].some((keyword) =>\n\t\t\t\tlowerTag.includes(keyword),\n\t\t\t);\n\t\t});\n\n\t\treturn vipTag ?? null;\n\t}, [customerMetadata, customerTags]);\n\n\tconst outstandingBalance =\n\t\tcustomer?.outstanding_balance ?? customer?.outstandingBalance ?? 0;\n\n\tconst accountHealth = useMemo(() => {\n\t\tif (!customer) {\n\t\t\treturn {\n\t\t\t\ttone: \"neutral\",\n\t\t\t\tlabel: \"No customer\",\n\t\t\t\tdescription: \"\",\n\t\t\t};\n\t\t}\n\n\t\tif ((customer.status || \"\").toLowerCase() === \"blocked\") {\n\t\t\treturn {\n\t\t\t\ttone: \"destructive\",\n\t\t\t\tlabel: \"Credit Hold\",\n\t\t\t\tdescription: \"Account is blocked until balance issues are resolved.\",\n\t\t\t};\n\t\t}\n\n\t\tif (outstandingBalance > 0) {\n\t\t\treturn {\n\t\t\t\ttone: \"warning\",\n\t\t\t\tlabel: \"Balance Due\",\n\t\t\t\tdescription: `${formatCurrency(outstandingBalance)} outstanding`,\n\t\t\t};\n\t\t}\n\n\t\tif ((customer.status || \"\").toLowerCase() === \"inactive\") {\n\t\t\treturn {\n\t\t\t\ttone: \"warning\",\n\t\t\t\tlabel: \"Inactive\",\n\t\t\t\tdescription: \"Customer marked inactive. Reactivate to schedule work.\",\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\ttone: \"positive\",\n\t\t\tlabel: \"In Good Standing\",\n\t\t\tdescription: \"No outstanding balances or restrictions.\",\n\t\t};\n\t}, [customer, outstandingBalance, formatCurrency]);\n\n\tconst toneClasses = {\n\t\tpositive:\n\t\t\t\"border-emerald-100 bg-emerald-50 text-emerald-700 dark:border-emerald-400/20 dark:bg-emerald-400/10 dark:text-emerald-200\",\n\t\twarning:\n\t\t\t\"border-warning bg-warning text-warning dark:border-warning/20 dark:bg-warning/10 dark:text-warning\",\n\t\tdestructive:\n\t\t\t\"border-rose-100 bg-rose-50 text-rose-700 dark:border-rose-400/20 dark:bg-rose-400/10 dark:text-rose-200\",\n\t\tneutral:\n\t\t\t\"border-muted bg-muted/40 text-muted-foreground dark:border-muted/30 dark:bg-muted/20 dark:text-muted-foreground\",\n\t} as const;\n\n\tconst accountToneClass =\n\t\ttoneClasses[accountHealth.tone as keyof typeof toneClasses] ??\n\t\ttoneClasses.neutral;\n\n\tconst paymentTermsRaw =\n\t\tcustomer?.payment_terms ?? customer?.paymentTerms ?? \"due_on_receipt\";\n\n\tconst normalizedPaymentTerms = paymentTermsRaw\n\t\t.replace(/_/g, \" \")\n\t\t.replace(/\\b\\w/g, (char: string) => char.toUpperCase());\n\n\tconst creditLimit = customer?.credit_limit ?? customer?.creditLimit ?? 0;\n\n\tconst openInvoices = useMemo(() => {\n\t\tconst list = Array.isArray(invoices) ? invoices : [];\n\t\treturn list.filter((invoice: any) => {\n\t\t\tconst status = (invoice?.status || \"\").toLowerCase();\n\t\t\treturn [\"sent\", \"viewed\", \"partial\", \"overdue\"].includes(status);\n\t\t});\n\t}, [invoices]);\n\n\tconst overdueInvoices = useMemo(() => {\n\t\tconst now = Date.now();\n\t\treturn openInvoices.filter((invoice: any) => {\n\t\t\tconst status = (invoice?.status || \"\").toLowerCase();\n\t\t\tif (status === \"overdue\") {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tconst due =\n\t\t\t\tinvoice?.due_date ??\n\t\t\t\tinvoice?.dueDate ??\n\t\t\t\tinvoice?.due_on ??\n\t\t\t\tinvoice?.dueOn;\n\t\t\tif (!due) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst dueDate = new Date(due);\n\t\t\treturn !Number.isNaN(dueDate.getTime()) && dueDate.getTime() < now;\n\t\t});\n\t}, [openInvoices]);\n\n\tconst _totalOutstanding = useMemo(\n\t\t() =>\n\t\t\topenInvoices.reduce((sum: number, invoice: any) => {\n\t\t\t\tconst balance = invoice?.balance_amount ?? invoice?.balanceAmount ?? 0;\n\t\t\t\treturn sum + (balance || 0);\n\t\t\t}, 0),\n\t\t[openInvoices],\n\t);\n\n\tconst nextDueInvoice = useMemo(() => {\n\t\tconst withDates = openInvoices\n\t\t\t.map((invoice: any) => {\n\t\t\t\tconst due =\n\t\t\t\t\tinvoice?.due_date ??\n\t\t\t\t\tinvoice?.dueDate ??\n\t\t\t\t\tinvoice?.due_on ??\n\t\t\t\t\tinvoice?.dueOn;\n\t\t\t\tconst dueDate = due ? new Date(due) : null;\n\t\t\t\treturn {\n\t\t\t\t\tinvoice,\n\t\t\t\t\tdueDate,\n\t\t\t\t};\n\t\t\t})\n\t\t\t.filter((item) => item.dueDate && !Number.isNaN(item.dueDate.getTime()))\n\t\t\t.sort((a, b) => a.dueDate?.getTime() - b.dueDate?.getTime());\n\n\t\treturn withDates[0]?.invoice ?? null;\n\t}, [openInvoices]);\n\n\tconst upcomingVisits = useMemo(() => {\n\t\tconst list = Array.isArray(schedules) ? schedules : [];\n\t\tconst now = Date.now();\n\n\t\treturn list\n\t\t\t.map((schedule: any) => {\n\t\t\t\tconst start =\n\t\t\t\t\tschedule?.start_time ??\n\t\t\t\t\tschedule?.startTime ??\n\t\t\t\t\tschedule?.start_at ??\n\t\t\t\t\tschedule?.startAt;\n\t\t\t\tconst startDate = start ? new Date(start) : null;\n\t\t\t\treturn {\n\t\t\t\t\tschedule,\n\t\t\t\t\tstartDate,\n\t\t\t\t};\n\t\t\t})\n\t\t\t.filter(\n\t\t\t\t({ startDate }) =>\n\t\t\t\t\tstartDate &&\n\t\t\t\t\t!Number.isNaN(startDate.getTime()) &&\n\t\t\t\t\tstartDate.getTime() > now,\n\t\t\t)\n\t\t\t.sort((a, b) => a.startDate?.getTime() - b.startDate?.getTime())\n\t\t\t.map(({ schedule }) => schedule);\n\t}, [schedules]);\n\n\tconst nextVisit = upcomingVisits[0] ?? null;\n\n\tconst lastCommunication = communications?.[0] ?? null;\n\n\tconst communicationChannels = useMemo(() => {\n\t\tif (!communicationPreferences) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst channels: Array<{ key: string; label: string; enabled: boolean }> = [\n\t\t\t{\n\t\t\t\tkey: \"email\",\n\t\t\t\tlabel: \"Email\",\n\t\t\t\tenabled:\n\t\t\t\t\tcommunicationPreferences.email ??\n\t\t\t\t\tcommunicationPreferences.Email ??\n\t\t\t\t\ttrue,\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"sms\",\n\t\t\t\tlabel: \"SMS\",\n\t\t\t\tenabled:\n\t\t\t\t\tcommunicationPreferences.sms ?? communicationPreferences.SMS ?? false,\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"phone\",\n\t\t\t\tlabel: \"Phone\",\n\t\t\t\tenabled:\n\t\t\t\t\tcommunicationPreferences.phone ??\n\t\t\t\t\tcommunicationPreferences.Phone ??\n\t\t\t\t\tfalse,\n\t\t\t},\n\t\t];\n\n\t\treturn channels;\n\t}, [communicationPreferences]);\n\n\tconst preferredContact =\n\t\tcustomer?.preferred_contact_method ??\n\t\tcustomer?.preferredContactMethod ??\n\t\t(typeof communicationPreferences?.preferred === \"string\"\n\t\t\t? communicationPreferences?.preferred\n\t\t\t: null) ??\n\t\t\"email\";\n\n\tconst normalizedPreferredContact = preferredContact\n\t\t? preferredContact.replace(/_/g, \" \")\n\t\t: \"Not set\";\n\n\tconst customerSource =\n\t\tcustomer?.source ??\n\t\tcustomerMetadata?.source ??\n\t\tcustomerMetadata?.acquiredVia ??\n\t\t\"—\";\n\n\tconst portalEnabled =\n\t\tcustomer?.portal_enabled ?? customer?.portalEnabled ?? false;\n\n\tconst lastPortalLogin =\n\t\tcustomer?.portal_last_login_at ?? customer?.portalLastLoginAt ?? null;\n\n\tconst customerSince = customer?.created_at ?? customer?.createdAt ?? null;\n\n\tconst _lastInvoiceDate =\n\t\tcustomer?.last_invoice_date ?? customer?.lastInvoiceDate ?? null;\n\n\tconst _lastPaymentDate =\n\t\tcustomer?.last_payment_date ?? customer?.lastPaymentDate ?? null;\n\n\tconst lastJobDate = customer?.last_job_date ?? customer?.lastJobDate ?? null;\n\n\tconst averageJobValue =\n\t\tcustomer?.average_job_value ?? customer?.averageJobValue ?? 0;\n\n\tconst totalRevenue = customer?.total_revenue ?? customer?.totalRevenue ?? 0;\n\n\tconst totalJobs = customer?.total_jobs ?? customer?.totalJobs ?? 0;\n\n\tconst _outstandingInvoicesCount = openInvoices.length;\n\tconst overdueInvoicesCount = overdueInvoices.length;\n\n\tconst _internalNotes =\n\t\tcustomer?.internal_notes ?? customer?.internalNotes ?? \"\";\n\n\tconst assignedTeamMembers = useMemo(() => {\n\t\tif (!Array.isArray(teamAssignments) || teamAssignments.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst seen = new Set<string>();\n\n\t\treturn teamAssignments\n\t\t\t.map((assignment: any) => {\n\t\t\t\tconst teamMember = assignment?.team_member || assignment?.teamMember;\n\t\t\t\tif (!teamMember) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst user =\n\t\t\t\t\tteamMember.users ||\n\t\t\t\t\tteamMember.user ||\n\t\t\t\t\tassignment?.user ||\n\t\t\t\t\tassignment?.assigned_user;\n\n\t\t\t\tconst memberId = teamMember.id ?? assignment.id;\n\n\t\t\t\tif (!memberId || seen.has(memberId)) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tseen.add(memberId);\n\n\t\t\t\treturn {\n\t\t\t\t\tid: memberId,\n\t\t\t\t\tuserId: user?.id ?? teamMember.user_id ?? assignment.user_id ?? null,\n\t\t\t\t\tname:\n\t\t\t\t\t\tuser?.name ??\n\t\t\t\t\t\tteamMember.name ??\n\t\t\t\t\t\tteamMember.display_name ??\n\t\t\t\t\t\t\"Team member\",\n\t\t\t\t\ttitle:\n\t\t\t\t\t\tteamMember.job_title ??\n\t\t\t\t\t\tassignment.job_title ??\n\t\t\t\t\t\tassignment.role ??\n\t\t\t\t\t\tuser?.job_title ??\n\t\t\t\t\t\tnull,\n\t\t\t\t\tavatar:\n\t\t\t\t\t\tuser?.avatar ??\n\t\t\t\t\t\tuser?.avatar_url ??\n\t\t\t\t\t\tuser?.profile_image_url ??\n\t\t\t\t\t\tteamMember.avatar ??\n\t\t\t\t\t\tnull,\n\t\t\t\t\temail: user?.email ?? teamMember.email ?? null,\n\t\t\t\t};\n\t\t\t})\n\t\t\t.filter(Boolean);\n\t}, [teamAssignments]);\n\n\tconst currentTeamMemberIds = useMemo(() => {\n\t\tif (!Array.isArray(teamAssignments) || teamAssignments.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst ids = teamAssignments\n\t\t\t.map((assignment: any) => {\n\t\t\t\treturn (\n\t\t\t\t\tassignment.team_member_id ||\n\t\t\t\t\tassignment.teamMemberId ||\n\t\t\t\t\tassignment.team_member?.id ||\n\t\t\t\t\tassignment.id ||\n\t\t\t\t\tnull\n\t\t\t\t);\n\t\t\t})\n\t\t\t.filter((id): id is string => Boolean(id));\n\n\t\treturn Array.from(new Set(ids));\n\t}, [teamAssignments]);\n\n\tconst _primaryAddressLine = [\n\t\tcustomer?.address,\n\t\tcustomer?.city,\n\t\tcustomer?.state,\n\t\tcustomer?.zip_code ?? customer?.zipCode,\n\t]\n\t\t.filter(Boolean)\n\t\t.join(\", \");\n\n\tconst secondaryPhone =\n\t\tcustomer?.secondary_phone ?? customer?.secondaryPhone ?? null;\n\n\tconst billingEmail =\n\t\tcustomer?.billing_email ??\n\t\tcustomer?.billingEmail ??\n\t\tcustomer?.email ??\n\t\tnull;\n\n\tconst _lastCommunicationAt =\n\t\tlastCommunication?.created_at ?? lastCommunication?.createdAt ?? null;\n\n\tconst _lastCommunicationChannel =\n\t\tlastCommunication?.channel ??\n\t\tlastCommunication?.type ??\n\t\tlastCommunication?.medium ??\n\t\tnull;\n\n\tconst _nextInvoiceDueDate =\n\t\tnextDueInvoice?.due_date ??\n\t\tnextDueInvoice?.dueDate ??\n\t\tnextDueInvoice?.due_on ??\n\t\tnextDueInvoice?.dueOn ??\n\t\tnull;\n\n\tconst _nextInvoiceBalance =\n\t\tnextDueInvoice?.balance_amount ?? nextDueInvoice?.balanceAmount ?? 0;\n\n\tconst customerStatusLabel = (customer?.status || \"active\").replace(/_/g, \" \");\n\n\tconst getStatusColor = (status: string) => {\n\t\tswitch (status?.toLowerCase()) {\n\t\t\tcase \"paid\":\n\t\t\tcase \"approved\":\n\t\t\tcase \"completed\":\n\t\t\t\treturn \"default\";\n\t\t\tcase \"sent\":\n\t\t\tcase \"scheduled\":\n\t\t\tcase \"confirmed\":\n\t\t\t\treturn \"secondary\";\n\t\t\tcase \"in_progress\":\n\t\t\t\treturn \"default\";\n\t\t\tcase \"overdue\":\n\t\t\tcase \"cancelled\":\n\t\t\tcase \"no_show\":\n\t\t\t\treturn \"destructive\";\n\t\t\tcase \"rescheduled\":\n\t\t\t\treturn \"outline\";\n\t\t\tcase \"draft\":\n\t\t\tcase \"pending\":\n\t\t\t\treturn \"outline\";\n\t\t\tdefault:\n\t\t\t\treturn \"secondary\";\n\t\t}\n\t};\n\n\tconst headerBadges = (\n\t\tjob\n\t\t\t? [\n\t\t\t\t\t<Badge\n\t\t\t\t\t\tclassName=\"font-mono text-xs\"\n\t\t\t\t\t\tkey=\"job-number\"\n\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t>\n\t\t\t\t\t\t#{job.job_number}\n\t\t\t\t\t</Badge>,\n\t\t\t\t\tlocalJob.status ? (\n\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\tclassName=\"font-medium capitalize\"\n\t\t\t\t\t\t\tkey=\"job-status\"\n\t\t\t\t\t\t\tvariant={getStatusColor(localJob.status) as any}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{localJob.status.replace(/_/g, \" \")}\n\t\t\t\t\t\t</Badge>\n\t\t\t\t\t) : null,\n\t\t\t\t\tlocalJob.priority ? (\n\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\tclassName=\"font-medium capitalize\"\n\t\t\t\t\t\t\tkey=\"job-priority\"\n\t\t\t\t\t\t\tvariant={\n\t\t\t\t\t\t\t\tlocalJob.priority === \"high\" || localJob.priority === \"urgent\"\n\t\t\t\t\t\t\t\t\t? \"destructive\"\n\t\t\t\t\t\t\t\t\t: \"outline\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{localJob.priority}\n\t\t\t\t\t\t</Badge>\n\t\t\t\t\t) : null,\n\t\t\t\t]\n\t\t\t: []\n\t).filter(Boolean);\n\n\tconst handleArchiveJob = async () => {\n\t\tsetIsArchiving(true);\n\t\ttry {\n\t\t\tconst result = await archiveJob(job.id);\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Job archived successfully\");\n\t\t\t\tsetIsArchiveDialogOpen(false);\n\t\t\t\trouter.push(\"/dashboard/work\");\n\t\t\t\t// Server Action handles revalidation automatically\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to archive job\");\n\t\t\t}\n\t\t} catch {\n\t\t\ttoast.error(\"Failed to archive job\");\n\t\t} finally {\n\t\t\tsetIsArchiving(false);\n\t\t}\n\t};\n\n\t// Build subtitle with customer and property links\n\tconst subtitleContent = (\n\t\t<div className=\"flex flex-wrap items-center gap-3 text-sm\">\n\t\t\t{customer && (\n\t\t\t\t<Link\n\t\t\t\t\tclassName=\"text-muted-foreground hover:text-foreground inline-flex items-center gap-1.5 transition-colors\"\n\t\t\t\t\thref={`/dashboard/customers/${customer.id}`}\n\t\t\t\t>\n\t\t\t\t\t<User className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t{customer.first_name} {customer.last_name}\n\t\t\t\t\t</span>\n\t\t\t\t</Link>\n\t\t\t)}\n\t\t\t{customer && property && (\n\t\t\t\t<span aria-hidden=\"true\" className=\"text-muted-foreground/40\">\n\t\t\t\t\t•\n\t\t\t\t</span>\n\t\t\t)}\n\t\t\t{property && (\n\t\t\t\t<>\n\t\t\t\t\t<Link\n\t\t\t\t\t\tclassName=\"text-muted-foreground hover:text-foreground inline-flex items-center gap-1.5 transition-colors\"\n\t\t\t\t\t\thref={`/dashboard/work/properties/${property.id}`}\n\t\t\t\t\t>\n\t\t\t\t\t\t<MapPin className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t\t{property.city}, {property.state}{\" \"}\n\t\t\t\t\t\t\t{property.zip_code || property.zipCode || \"\"}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</Link>\n\t\t\t\t\t{/* TEMPORARILY DISABLED FOR DEBUGGING */}\n\t\t\t\t\t{/* <TravelTime property={property} /> */}\n\t\t\t\t</>\n\t\t\t)}\n\t\t</div>\n\t);\n\n\t// Build action buttons (only save/cancel when editing)\n\t// Note: Statistics, Invoice, Estimate, Clone, Archive are in the toolbar\n\tconst primaryActions: ReactNode[] = [];\n\tconst secondaryActions: ReactNode[] = [];\n\n\t// Add save/cancel buttons if there are changes\n\tif (hasChanges) {\n\t\tsecondaryActions.unshift(\n\t\t\t<Button\n\t\t\t\tkey=\"cancel\"\n\t\t\t\tonClick={() => {\n\t\t\t\t\tsetLocalJob({\n\t\t\t\t\t\t...job,\n\t\t\t\t\t\tpriority: job.priority || \"medium\",\n\t\t\t\t\t});\n\t\t\t\t\tsetHasChanges(false);\n\t\t\t\t}}\n\t\t\t\tsize=\"sm\"\n\t\t\t\tvariant=\"outline\"\n\t\t\t>\n\t\t\t\tCancel\n\t\t\t</Button>,\n\t\t\t<Button disabled={isSaving} key=\"save\" onClick={handleSave} size=\"sm\">\n\t\t\t\t<Save className=\"mr-2 h-4 w-4\" />\n\t\t\t\t{isSaving ? \"Saving...\" : \"Save Changes\"}\n\t\t\t</Button>,\n\t\t);\n\t}\n\n\t// Metadata items removed - stats are already shown in the top toolbar\n\t// const metadataItems: DetailPageHeaderConfig[\"metadata\"] = [\n\t//   {\n\t//     label: \"Total Amount\",\n\t//     icon: <DollarSign className=\"h-3.5 w-3.5\" />,\n\t//     value: formatCurrency(metrics.totalAmount),\n\t//   },\n\t//   {\n\t//     label: \"Paid Amount\",\n\t//     icon: <CreditCard className=\"h-3.5 w-3.5\" />,\n\t//     value: formatCurrency(metrics.paidAmount),\n\t//     helperText: `${formatCurrency(metrics.totalAmount - metrics.paidAmount)} remaining`,\n\t//   },\n\t//   {\n\t//     label: \"Labor Hours\",\n\t//     icon: <Clock className=\"h-3.5 w-3.5\" />,\n\t//     value: formatHours(metrics.totalLaborHours),\n\t//     helperText: metrics.estimatedLaborHours\n\t//       ? `${formatHours(metrics.estimatedLaborHours)} estimated`\n\t//       : undefined,\n\t//   },\n\t//   {\n\t//     label: \"Profit Margin\",\n\t//     icon: <TrendingUp className=\"h-3.5 w-3.5\" />,\n\t//     value: `${metrics.profitMargin.toFixed(1)}%`,\n\t//   },\n\t// ];\n\n\t// Build header config - Now using AI Job Assistant Header\n\tconst headerConfig: DetailPageHeaderConfig = {\n\t\ttitle: (\n\t\t\t<AIJobAssistantHeader\n\t\t\t\tjob={localJob}\n\t\t\t\tcustomer={customer}\n\t\t\t\tproperty={property}\n\t\t\t\tmetrics={metrics}\n\t\t\t\tteamAssignments={teamAssignments}\n\t\t\t\ttimeEntries={timeEntries}\n\t\t\t\tinvoices={invoices}\n\t\t\t\tpayments={payments}\n\t\t\t\testimates={estimates}\n\t\t\t\tuserRole={userRole}\n\t\t\t\tonTitleChange={(value) => handleFieldChange(\"title\", value)}\n\t\t\t\tonSave={handleSave}\n\t\t\t\tonCancel={() => {\n\t\t\t\t\tsetLocalJob({\n\t\t\t\t\t\t...job,\n\t\t\t\t\t\tpriority: job.priority || \"medium\",\n\t\t\t\t\t});\n\t\t\t\t\tsetHasChanges(false);\n\t\t\t\t}}\n\t\t\t\tisSaving={isSaving}\n\t\t\t\thasChanges={hasChanges}\n\t\t\t/>\n\t\t),\n\t\t// subtitle, badges, actions all handled by AIJobAssistantHeader now\n\t};\n\n\t// Memoize property object to prevent unnecessary re-renders in child components\n\tconst enrichmentProperty = useMemo(\n\t\t() =>\n\t\t\tproperty\n\t\t\t\t? {\n\t\t\t\t\t\taddress: property.address,\n\t\t\t\t\t\tcity: property.city,\n\t\t\t\t\t\tstate: property.state,\n\t\t\t\t\t\tzip_code: property.zip_code,\n\t\t\t\t\t\tlat: property.lat,\n\t\t\t\t\t\tlon: property.lon,\n\t\t\t\t\t}\n\t\t\t\t: undefined,\n\t\t[\n\t\t\tproperty?.address,\n\t\t\tproperty?.city,\n\t\t\tproperty?.state,\n\t\t\tproperty?.zip_code,\n\t\t\tproperty?.lat,\n\t\t\tproperty?.lon,\n\t\t],\n\t);\n\n\t// Content to show before sections (editable fields, enrichment, travel time)\n\tconst beforeContent = (\n\t\t<div className=\"space-y-3\">\n\t\t\t{/* Alerts & Warnings - TEMPORARILY DISABLED FOR DEBUGGING */}\n\t\t\t{/* <JobEnrichmentInline\n\t\t\t\tenrichmentData={jobData.enrichmentData}\n\t\t\t\tjobId={jobData.job.id}\n\t\t\t\tproperty={enrichmentProperty}\n\t\t\t/> */}\n\n\t\t\t{/* Ultra-Compact Job Overview */}\n\t\t\t<DetailPageSurface padding=\"sm\" variant=\"default\" className=\"rounded-xl\">\n\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t{/* Top Row: Status, Priority, Travel Time - Inline */}\n\t\t\t\t\t<div className=\"flex items-center gap-3 flex-wrap\">\n\t\t\t\t\t\t<StandardFormField label=\"Status\" className=\"mb-0 min-w-[140px]\">\n\t\t\t\t\t\t\t<JobStatusSelector\n\t\t\t\t\t\t\t\tcurrentStatus={(localJob.status || \"quoted\") as JobStatus}\n\t\t\t\t\t\t\t\tonStatusChange={(newStatus) =>\n\t\t\t\t\t\t\t\t\thandleFieldChange(\"status\", newStatus)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tjob={{\n\t\t\t\t\t\t\t\t\tid: jobData.job.id,\n\t\t\t\t\t\t\t\t\tscheduled_start:\n\t\t\t\t\t\t\t\t\t\tlocalJob.scheduled_start || jobData.job.scheduled_start,\n\t\t\t\t\t\t\t\t\tscheduled_end:\n\t\t\t\t\t\t\t\t\t\tlocalJob.scheduled_end || jobData.job.scheduled_end,\n\t\t\t\t\t\t\t\t\tassigned_to: localJob.assigned_to || jobData.job.assigned_to,\n\t\t\t\t\t\t\t\t\tcustomer_id: localJob.customer_id || jobData.job.customer_id,\n\t\t\t\t\t\t\t\t\tproperty_id: localJob.property_id || jobData.property?.id,\n\t\t\t\t\t\t\t\t\ttotal_amount:\n\t\t\t\t\t\t\t\t\t\tlocalJob.total_amount || jobData.job.total_amount,\n\t\t\t\t\t\t\t\t\tinvoices: jobData.invoices,\n\t\t\t\t\t\t\t\t\testimates: jobData.estimates,\n\t\t\t\t\t\t\t\t\tteamAssignments: jobData.teamAssignments,\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</StandardFormField>\n\n\t\t\t\t\t\t<StandardFormField label=\"Priority\" className=\"mb-0 min-w-[120px]\">\n\t\t\t\t\t\t\t<Select\n\t\t\t\t\t\t\t\tonValueChange={(value) => handleFieldChange(\"priority\", value)}\n\t\t\t\t\t\t\t\tvalue={localJob.priority || undefined}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<SelectTrigger className=\"h-8\">\n\t\t\t\t\t\t\t\t\t<SelectValue placeholder=\"Set priority\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t\t<AlertCircle className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"capitalize text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t{localJob.priority || \"Set priority\"}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</SelectValue>\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"low\">Low</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"medium\">Medium</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"high\">High</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"urgent\">Urgent</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</StandardFormField>\n\n\t\t\t\t\t\t{property && (\n\t\t\t\t\t\t\t<StandardFormField label=\"Travel\" className=\"mb-0\">\n\t\t\t\t\t\t\t\t<TravelTime property={property} />\n\t\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Compact Data Grid - All in one row with popovers for details */}\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-2 sm:grid-cols-4 lg:grid-cols-6\">\n\t\t\t\t\t\t{/* Customer - Compact with Popover */}\n\t\t\t\t\t\t{customer && (\n\t\t\t\t\t\t\t<Popover>\n\t\t\t\t\t\t\t\t<PopoverTrigger asChild>\n\t\t\t\t\t\t\t\t\t<button className=\"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t<User className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\tCustomer\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs font-medium truncate\">\n\t\t\t\t\t\t\t\t\t\t\t{customer.display_name ||\n\t\t\t\t\t\t\t\t\t\t\t\t`${customer.first_name} ${customer.last_name}`}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-[10px] text-muted-foreground truncate\">\n\t\t\t\t\t\t\t\t\t\t\t{customer.phone || customer.email || customer.type || \"\"}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</PopoverTrigger>\n\t\t\t\t\t\t\t\t<PopoverContent className=\"w-64\" align=\"start\">\n\t\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\tName\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\thref={`/dashboard/customers/${customer.id}`}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-sm font-medium text-primary hover:underline\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{customer.display_name ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t`${customer.first_name} ${customer.last_name}`}\n\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{customer.phone && (\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tPhone\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\t\t\thref={`tel:${customer.phone}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-sm text-primary hover:underline\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{customer.phone}\n\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t{customer.email && (\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tEmail\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\t\t\thref={`mailto:${customer.email}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-sm text-primary hover:underline\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{customer.email}\n\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\tType\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"outline\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t{customer.type || \"residential\"}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</PopoverContent>\n\t\t\t\t\t\t\t</Popover>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{/* Property - Compact with Popover */}\n\t\t\t\t\t\t{property && (\n\t\t\t\t\t\t\t<Popover>\n\t\t\t\t\t\t\t\t<PopoverTrigger asChild>\n\t\t\t\t\t\t\t\t\t<button className=\"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t<MapPin className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\tLocation\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs font-medium truncate\">\n\t\t\t\t\t\t\t\t\t\t\t{property.address}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-[10px] text-muted-foreground truncate\">\n\t\t\t\t\t\t\t\t\t\t\t{property.city}, {property.state}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</PopoverTrigger>\n\t\t\t\t\t\t\t\t<PopoverContent className=\"w-64\" align=\"start\">\n\t\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\tAddress\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t{property.address}\n\t\t\t\t\t\t\t\t\t\t\t\t{property.address_line2 &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t`, ${property.address_line2}`}\n\t\t\t\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t\t\t\t{property.city}, {property.state} {property.zip}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{property.lat && property.lon && (\n\t\t\t\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\t\t\thref={`https://www.google.com/maps?q=${property.lat},${property.lon}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-xs text-primary hover:underline mt-1 inline-flex items-center gap-1\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<ExternalLink className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tOpen in Maps\n\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tType\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"outline\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{property.property_type || \"Unknown\"}\n\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tAccess\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t{property.access_code ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<code className=\"text-xs bg-muted px-1.5 py-0.5 rounded\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{property.access_code}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</code>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tNone\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</PopoverContent>\n\t\t\t\t\t\t\t</Popover>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{/* Schedule - Compact with Popover */}\n\t\t\t\t\t\t<Popover>\n\t\t\t\t\t\t\t<PopoverTrigger asChild>\n\t\t\t\t\t\t\t\t<button className=\"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50\">\n\t\t\t\t\t\t\t\t\t<div className=\"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t<Calendar className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\tSchedule\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{localJob.scheduled_start ? (\n\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t{new Date(localJob.scheduled_start).toLocaleTimeString(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"en-US\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thour: \"numeric\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tminute: \"2-digit\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thour12: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-[10px] text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t{teamAssignments?.length || 0} tech\n\t\t\t\t\t\t\t\t\t\t\t\t{teamAssignments?.length !== 1 ? \"s\" : \"\"}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\tNot scheduled\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</PopoverTrigger>\n\t\t\t\t\t\t\t<PopoverContent className=\"w-64\" align=\"start\">\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-2\">\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\tStart\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t{localJob.scheduled_start\n\t\t\t\t\t\t\t\t\t\t\t\t\t? formatDate(localJob.scheduled_start)\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Not set\"}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\tEnd\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t{localJob.scheduled_end\n\t\t\t\t\t\t\t\t\t\t\t\t\t? formatDate(localJob.scheduled_end)\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Not set\"}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{teamAssignments && teamAssignments.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\tTeam ({teamAssignments.length})\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t{teamAssignments.map((assignment: any) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={assignment.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{assignment.user?.name || \"Unknown\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</PopoverContent>\n\t\t\t\t\t\t</Popover>\n\n\t\t\t\t\t\t{/* Financial - Compact with Popover */}\n\t\t\t\t\t\t<Popover>\n\t\t\t\t\t\t\t<PopoverTrigger asChild>\n\t\t\t\t\t\t\t\t<button className=\"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50\">\n\t\t\t\t\t\t\t\t\t<div className=\"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t<DollarSign className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\tFinancial\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"text-xs font-semibold\">\n\t\t\t\t\t\t\t\t\t\t{formatCurrency(localJob.total_amount || 0)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"text-[10px] text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t{payments && payments.length > 0\n\t\t\t\t\t\t\t\t\t\t\t? `${formatCurrency(\n\t\t\t\t\t\t\t\t\t\t\t\t\tpayments.reduce(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(sum: number, p: any) => sum + (p.amount || 0),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t\t)} paid`\n\t\t\t\t\t\t\t\t\t\t\t: \"$0 paid\"}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</PopoverTrigger>\n\t\t\t\t\t\t\t<PopoverContent className=\"w-64\" align=\"start\">\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\tJob Value\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(localJob.total_amount || 0)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-2\">\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\tPayments\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-semibold text-green-600 dark:text-green-400\">\n\t\t\t\t\t\t\t\t\t\t\t\t{payments && payments.length > 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t? formatCurrency(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpayments.reduce(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(sum: number, p: any) => sum + (p.amount || 0),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"$0\"}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-[10px] text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t{payments?.length || 0} payment\n\t\t\t\t\t\t\t\t\t\t\t\t{payments?.length !== 1 ? \"s\" : \"\"}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\tEstimates\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">{estimates?.length || 0}</div>\n\t\t\t\t\t\t\t\t\t\t\t{estimates && estimates.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\testimates.some((e: any) => e.status === \"accepted\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"default\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"secondary\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-[10px] mt-0.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{estimates.find((e: any) => e.status === \"accepted\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"Accepted\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Pending\"}\n\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\tInvoices\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">{invoices?.length || 0}</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</PopoverContent>\n\t\t\t\t\t\t</Popover>\n\n\t\t\t\t\t\t{/* Activity - Compact with Popover */}\n\t\t\t\t\t\t<Popover>\n\t\t\t\t\t\t\t<PopoverTrigger asChild>\n\t\t\t\t\t\t\t\t<button className=\"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50\">\n\t\t\t\t\t\t\t\t\t<div className=\"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t<MessageSquare className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\tActivity\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"text-xs font-medium\">\n\t\t\t\t\t\t\t\t\t\t{(communications?.length || 0) +\n\t\t\t\t\t\t\t\t\t\t\t(jobNotes?.length || 0) +\n\t\t\t\t\t\t\t\t\t\t\t(photos?.length || 0) +\n\t\t\t\t\t\t\t\t\t\t\t(documents?.length || 0)}{\" \"}\n\t\t\t\t\t\t\t\t\t\titems\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"text-[10px] text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t{communications?.length || 0} msg • {jobNotes?.length || 0}{\" \"}\n\t\t\t\t\t\t\t\t\t\tnotes\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</PopoverTrigger>\n\t\t\t\t\t\t\t<PopoverContent className=\"w-64\" align=\"start\">\n\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-2\">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\tMessages\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t{communications?.length || 0}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\tNotes\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t{jobNotes?.length || 0}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\tPhotos\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t{photos?.length || 0}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\tDocuments\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t{documents?.length || 0}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</PopoverContent>\n\t\t\t\t\t\t</Popover>\n\n\t\t\t\t\t\t{/* Service - Compact with Collapsible */}\n\t\t\t\t\t\t<Collapsible>\n\t\t\t\t\t\t\t<CollapsibleTrigger asChild>\n\t\t\t\t\t\t\t\t<button className=\"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50 w-full\">\n\t\t\t\t\t\t\t\t\t<div className=\"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t<Wrench className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\tService\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"text-xs font-medium truncate\">\n\t\t\t\t\t\t\t\t\t\t{localJob.service_type || localJob.job_type || \"Not set\"}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"text-[10px] text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t{jobEquipment?.length || 0} equipment\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</CollapsibleTrigger>\n\t\t\t\t\t\t\t<CollapsibleContent className=\"mt-2\">\n\t\t\t\t\t\t\t\t<div className=\"space-y-2 p-2 bg-muted/30 rounded-md\">\n\t\t\t\t\t\t\t\t\t<StandardFormField\n\t\t\t\t\t\t\t\t\t\tlabel=\"Service Type\"\n\t\t\t\t\t\t\t\t\t\thtmlFor=\"service-type\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"mb-0\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\tid=\"service-type\"\n\t\t\t\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\thandleFieldChange(\"service_type\", e.target.value)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"e.g. HVAC Maintenance\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={localJob.service_type || localJob.job_type || \"\"}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 text-sm\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t\t\t\t\t{jobEquipment && jobEquipment.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\tEquipment\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t{jobEquipment.map((eq: any) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={eq.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{eq.equipment?.name || eq.equipment_id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t<StandardFormField\n\t\t\t\t\t\t\t\t\t\tlabel=\"Description\"\n\t\t\t\t\t\t\t\t\t\thtmlFor=\"job-description\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"mb-0\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\t\t\tid=\"job-description\"\n\t\t\t\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\thandleFieldChange(\"description\", e.target.value)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Add context, expectations, or key notes for the crew.\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={localJob.description || \"\"}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"min-h-[60px] text-sm\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</CollapsibleContent>\n\t\t\t\t\t\t</Collapsible>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Quick Actions Footer */}\n\t\t\t\t\t<div className=\"flex justify-end pt-2 border-t border-border/40\">\n\t\t\t\t\t\t<JobQuickActions currentStatus={job.status} jobId={job.id} />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</DetailPageSurface>\n\t\t</div>\n\t);\n\n\tconst sections: UnifiedAccordionSection[] = [];\n\n\tsections.push({\n\t\tid: \"customer\",\n\t\ttitle: \"Customer & Property\",\n\t\ticon: <User className=\"size-4\" />,\n\t\tcount: customer ? 1 : 0,\n\t\tactions: (\n\t\t\t<JobCustomerPropertyManager\n\t\t\t\tcurrentCustomer={\n\t\t\t\t\tcustomer\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tid: customer.id,\n\t\t\t\t\t\t\t\tfirst_name: customer.first_name || \"\",\n\t\t\t\t\t\t\t\tlast_name: customer.last_name || \"\",\n\t\t\t\t\t\t\t\tdisplay_name: customer.display_name || \"\",\n\t\t\t\t\t\t\t\temail: customer.email || \"\",\n\t\t\t\t\t\t\t\tphone: customer.phone || \"\",\n\t\t\t\t\t\t\t\tcompany_name: customer.company_name,\n\t\t\t\t\t\t\t\ttype: customer.type || \"residential\",\n\t\t\t\t\t\t\t\taddress: customer.address,\n\t\t\t\t\t\t\t\tcity: customer.city,\n\t\t\t\t\t\t\t\tstate: customer.state,\n\t\t\t\t\t\t\t\tzip: customer.zip,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: null\n\t\t\t\t}\n\t\t\t\tcurrentProperty={\n\t\t\t\t\tproperty\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tid: property.id,\n\t\t\t\t\t\t\t\tcustomer_id: property.customer_id,\n\t\t\t\t\t\t\t\taddress: property.address || \"\",\n\t\t\t\t\t\t\t\taddress_line2: property.address_line2,\n\t\t\t\t\t\t\t\tcity: property.city || \"\",\n\t\t\t\t\t\t\t\tstate: property.state || \"\",\n\t\t\t\t\t\t\t\tzip: property.zip || \"\",\n\t\t\t\t\t\t\t\tproperty_type: property.property_type,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: null\n\t\t\t\t}\n\t\t\t\tgetCustomerProperties={getCustomerProperties}\n\t\t\t\tonAssignCustomer={async (selectedCustomer, selectedProperty) => {\n\t\t\t\t\tconst result = await assignCustomerToJob(\n\t\t\t\t\t\tjob.id,\n\t\t\t\t\t\tselectedCustomer.id,\n\t\t\t\t\t\tselectedProperty?.id || null,\n\t\t\t\t\t);\n\n\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\t// Update local state immediately so UI reflects the change without waiting for router refresh\n\t\t\t\t\t\tsetCustomer(selectedCustomer);\n\t\t\t\t\t\tsetProperty(selectedProperty ?? null);\n\t\t\t\t\t\ttoast.success(\"Customer and property assigned successfully\");\n\t\t\t\t\t\tsafeRefresh();\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoast.error(result.error || \"Failed to assign customer\");\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tonRemoveCustomer={async () => {\n\t\t\t\t\tconst result = await removeCustomerFromJob(job.id);\n\n\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\tsetCustomer(null);\n\t\t\t\t\t\tsetProperty(null);\n\t\t\t\t\t\ttoast.success(\"Customer and property removed successfully\");\n\t\t\t\t\t\tsafeRefresh();\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoast.error(result.error || \"Failed to remove customer\");\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tonRemoveProperty={async () => {\n\t\t\t\t\tif (!customer) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst result = await assignCustomerToJob(job.id, customer.id, null);\n\n\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\tsetProperty(null);\n\t\t\t\t\t\ttoast.success(\"Property removed from job\");\n\t\t\t\t\t\tsafeRefresh();\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoast.error(result.error || \"Failed to remove property\");\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tsearchCustomers={searchCustomersForJob}\n\t\t\t/>\n\t\t),\n\t\tcontent: (\n\t\t\t<UnifiedAccordionContent className=\"space-y-6\">\n\t\t\t\t<div className=\"flex flex-col gap-6 lg:flex-row\">\n\t\t\t\t\t{customer ? (\n\t\t\t\t\t\t<div className=\"flex min-w-0 flex-1 flex-col gap-6\">\n\t\t\t\t\t\t\t<div className=\"border-border/60 bg-card/80 rounded-xl border p-6 shadow-sm\">\n\t\t\t\t\t\t\t\t<div className=\"flex items-start justify-between gap-6\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex min-w-0 items-start gap-4\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"bg-primary/10 text-primary flex size-14 flex-shrink-0 items-center justify-center rounded-full text-xl font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t{customer.first_name?.[0]}\n\t\t\t\t\t\t\t\t\t\t\t{customer.last_name?.[0]}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 space-y-1.5\">\n\t\t\t\t\t\t\t\t\t\t\t{customerDetailPath ? (\n\t\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-foreground hover:text-primary block text-lg font-semibold transition-colors\"\n\t\t\t\t\t\t\t\t\t\t\t\t\thref={customerDetailPath}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{customer.first_name} {customer.last_name}\n\t\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-foreground block text-lg font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{customer.first_name} {customer.last_name}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-6 rounded-full px-2.5 text-[11px] font-medium capitalize\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{customerStatusLabel}\n\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"inline-flex items-center gap-1 rounded-full border px-2.5 py-0.5 text-[11px] font-medium\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taccountToneClass,\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle={accountHealth.description}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<ShieldCheck className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t{accountHealth.label}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t{membershipLabel && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"bg-primary/10 text-primary inline-flex items-center gap-1 rounded-full px-2.5 py-0.5 text-[11px] font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Sparkles className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{membershipLabel}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{customerDetailPath && (\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tasChild\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex-shrink-0\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center gap-1.5\"\n\t\t\t\t\t\t\t\t\t\t\t\thref={customerDetailPath}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\tView Profile\n\t\t\t\t\t\t\t\t\t\t\t\t<ChevronRight className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div className=\"border-border/60 bg-card/80 rounded-xl border shadow-sm\">\n\t\t\t\t\t\t\t\t<div className=\"divide-border/40 bg-muted/20 grid grid-cols-2 divide-x divide-y sm:divide-y-0 md:grid-cols-4 px-4 py-4 sm:px-6\">\n\t\t\t\t\t\t\t\t\t<div className=\"px-3 py-3 first:pl-0 last:pr-0 sm:py-0\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase\">\n\t\t\t\t\t\t\t\t\t\t\tLifetime Value\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-foreground mt-1 text-lg font-bold\">\n\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(totalRevenue)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground mt-0.5 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{totalJobs} job{totalJobs === 1 ? \"\" : \"s\"} ·{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(averageJobValue)} avg\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"px-3 py-3 first:pl-0 last:pr-0 sm:py-0\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase\">\n\t\t\t\t\t\t\t\t\t\t\tBalance Due\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\"mt-1 text-lg font-bold\",\n\t\t\t\t\t\t\t\t\t\t\t\toutstandingBalance > 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"text-warning\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(outstandingBalance)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground mt-0.5 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{overdueInvoicesCount > 0\n\t\t\t\t\t\t\t\t\t\t\t\t? `${overdueInvoicesCount} overdue`\n\t\t\t\t\t\t\t\t\t\t\t\t: normalizedPaymentTerms}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"px-3 py-3 first:pl-0 last:pr-0 sm:py-0\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase\">\n\t\t\t\t\t\t\t\t\t\t\tCredit Limit\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-foreground mt-1 text-lg font-bold\">\n\t\t\t\t\t\t\t\t\t\t\t{creditLimit > 0 ? formatCurrency(creditLimit) : \"None\"}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground mt-0.5 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{creditLimit > 0 && outstandingBalance > 0\n\t\t\t\t\t\t\t\t\t\t\t\t? `${Math.round((outstandingBalance / creditLimit) * 100)}% used`\n\t\t\t\t\t\t\t\t\t\t\t\t: creditLimit > 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"Available\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Cash only\"}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"px-3 py-3 first:pl-0 last:pr-0 sm:py-0\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase\">\n\t\t\t\t\t\t\t\t\t\t\tCustomer Since\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-foreground mt-1 text-lg font-bold\">\n\t\t\t\t\t\t\t\t\t\t\t{customerSince ? formatRelativeTime(customerSince) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground mt-0.5 text-xs capitalize\">\n\t\t\t\t\t\t\t\t\t\t\tvia {customerSource}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div className=\"border-border/60 bg-card/80 rounded-xl border p-6 shadow-sm\">\n\t\t\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase\">\n\t\t\t\t\t\t\t\t\t\t\tContact\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t\t{customer.email && (\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-7 w-7 p-0\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst params = new URLSearchParams();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tparams.set(\"compose\", \"true\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tparams.set(\"to\", customer.email);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tparams.set(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"name\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t`${customer.first_name} ${customer.last_name}`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tparams.set(\"customerId\", customer.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trouter.push(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t`/dashboard/communication/email?${params.toString()}`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Send Email\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Mail className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t{customer.phone && (\n\t\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-7 w-7 p-0\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetIncomingCall({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnumber: customer.phone,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname: `${customer.first_name} ${customer.last_name}`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tavatar: customer.avatar_url,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Call\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Phone className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-7 w-7 p-0\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setIsSMSDialogOpen(true)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Send Text Message\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<MessageSquare className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<dl className=\"grid gap-3\">\n\t\t\t\t\t\t\t\t\t\t{customer.email && (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"bg-muted flex size-8 flex-shrink-0 items-center justify-center rounded-lg\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Mail className=\"text-muted-foreground h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<dt className=\"text-muted-foreground text-[10px] font-medium tracking-wide uppercase\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tEmail\n\t\t\t\t\t\t\t\t\t\t\t\t\t</dt>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<dd className=\"text-foreground truncate text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{customer.email}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t{customer.phone && (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"bg-muted flex size-8 flex-shrink-0 items-center justify-center rounded-lg\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Phone className=\"text-muted-foreground h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<dt className=\"text-muted-foreground text-[10px] font-medium tracking-wide uppercase\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tPhone\n\t\t\t\t\t\t\t\t\t\t\t\t\t</dt>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<dd className=\"text-foreground text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{customer.phone}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t{secondaryPhone && (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"bg-muted flex size-8 flex-shrink-0 items-center justify-center rounded-lg\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Phone className=\"text-muted-foreground h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<dt className=\"text-muted-foreground text-[10px] font-medium tracking-wide uppercase\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tAlt Phone\n\t\t\t\t\t\t\t\t\t\t\t\t\t</dt>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<dd className=\"text-foreground text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{secondaryPhone}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t{billingEmail && billingEmail !== customer.email && (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"bg-muted flex size-8 flex-shrink-0 items-center justify-center rounded-lg\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Receipt className=\"text-muted-foreground h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<dt className=\"text-muted-foreground text-[10px] font-medium tracking-wide uppercase\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tBilling Email\n\t\t\t\t\t\t\t\t\t\t\t\t\t</dt>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<dd className=\"text-foreground truncate text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{billingEmail}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</dl>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div className=\"border-border/60 bg-card/80 rounded-xl border p-6 shadow-sm\">\n\t\t\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase\">\n\t\t\t\t\t\t\t\t\t\tAccount Details\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<dl className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<dt className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\tPortal Access\n\t\t\t\t\t\t\t\t\t\t\t</dt>\n\t\t\t\t\t\t\t\t\t\t\t<dd className=\"text-foreground mt-1 text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t{portalEnabled ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"inline-flex items-center gap-1.5 text-emerald-700 dark:text-emerald-200\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Globe className=\"h-3.5 w-3.5\" /> Enabled\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tDisabled\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t\t\t\t\t\t{portalEnabled && lastPortalLogin && (\n\t\t\t\t\t\t\t\t\t\t\t\t<dd className=\"text-muted-foreground mt-0.5 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tLast login {formatRelativeTime(lastPortalLogin)}\n\t\t\t\t\t\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<dt className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\tPreferred Contact\n\t\t\t\t\t\t\t\t\t\t\t</dt>\n\t\t\t\t\t\t\t\t\t\t\t<dd className=\"text-foreground mt-1 text-sm font-medium capitalize\">\n\t\t\t\t\t\t\t\t\t\t\t\t{normalizedPreferredContact}\n\t\t\t\t\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t\t\t\t\t\t{communicationChannels && (\n\t\t\t\t\t\t\t\t\t\t\t\t<dd className=\"mt-1.5 flex flex-wrap gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{communicationChannels.map(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(channel) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tchannel.enabled && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-700 dark:bg-emerald-400/10 dark:text-emerald-200\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={channel.key}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{channel.label}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<dt className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\tLast Activity\n\t\t\t\t\t\t\t\t\t\t\t</dt>\n\t\t\t\t\t\t\t\t\t\t\t<dd className=\"text-foreground mt-1 text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t{lastJobDate\n\t\t\t\t\t\t\t\t\t\t\t\t\t? formatRelativeTime(lastJobDate)\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"No activity\"}\n\t\t\t\t\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t\t\t\t\t\t{nextVisit && (\n\t\t\t\t\t\t\t\t\t\t\t\t<dd className=\"text-muted-foreground mt-0.5 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tNext:{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{formatRelativeTime(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnextVisit.start_time ??\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnextVisit.startTime ??\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnextVisit.start_at ??\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnextVisit.startAt,\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</dl>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Job Tags Section */}\n\t\t\t\t\t\t\t<div className=\"border-border/60 bg-card/80 rounded-xl border p-6 shadow-sm\">\n\t\t\t\t\t\t\t\t<div className=\"space-y-3\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t<Tag className=\"text-muted-foreground size-4\" />\n\t\t\t\t\t\t\t\t\t\t<h4 className=\"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase\">\n\t\t\t\t\t\t\t\t\t\t\tJob Tags\n\t\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<EntityTags\n\t\t\t\t\t\t\t\t\t\tentityId={job.id}\n\t\t\t\t\t\t\t\t\t\tentityType=\"job\"\n\t\t\t\t\t\t\t\t\t\ttags={jobTags}\n\t\t\t\t\t\t\t\t\t\tonUpdateTags={async (id, tags) => {\n\t\t\t\t\t\t\t\t\t\t\tconst result = await updateEntityTags(\"job\", id, tags);\n\t\t\t\t\t\t\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\t\t\t\t\t\t\tsafeRefresh();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{(assignedTeamMembers.length > 0 || customerTags.length > 0) && (\n\t\t\t\t\t\t\t\t<div className=\"border-border/60 bg-card/80 rounded-xl border p-6 shadow-sm\">\n\t\t\t\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t\t\t\t{assignedTeamMembers.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tAssigned Team\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{assignedTeamMembers.filter(Boolean).map((member) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"group border-border/60 bg-background text-foreground hover:border-primary/50 hover:bg-primary/5 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-medium transition-colors\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thref={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmember?.id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? `/dashboard/settings/team/${member.id}`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"/dashboard/settings/team\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={member?.id || \"unknown\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Avatar className=\"bg-muted h-6 w-6 border border-white/10\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{member?.avatar ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarImage\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talt={member?.name || \"Team Member\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={member.avatar}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarFallback className=\"text-[10px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{member?.name\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?.split(\" \")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.map((part: string) => part[0])\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.join(\"\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.slice(0, 2)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.toUpperCase() || \"TM\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>{member?.name || \"Unknown\"}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t{customerTags.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tTags\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{customerTags.map((tag) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"bg-primary/10 text-primary inline-flex items-center gap-1 rounded-full px-2.5 py-0.5 text-xs font-medium\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={tag}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tag}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"border-border/60 bg-background flex flex-1 flex-col items-center justify-center rounded-xl border border-dashed p-6 text-center\">\n\t\t\t\t\t\t\t<div className=\"bg-muted mb-3 flex size-12 items-center justify-center rounded-full\">\n\t\t\t\t\t\t\t\t<User className=\"text-muted-foreground size-6\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\t\t\tNo customer assigned\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-xs\">\n\t\t\t\t\t\t\t\tAssign a customer to unlock profile insights.\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t<aside className=\"mt-6 space-y-6 lg:mt-0 lg:w-[360px]\">\n\t\t\t\t\t\t{property ? (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<div className=\"border-border/60 bg-card/80 rounded-xl border p-0 shadow-sm\">\n\t\t\t\t\t\t\t\t\t{canShowInteractiveMap ? (\n\t\t\t\t\t\t\t\t\t\t<PropertyLocationVisual property={property} />\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<div className=\"space-y-4 p-6\">\n\t\t\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-40 w-full rounded-lg\" />\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground space-y-1 text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t\t\t\tConnect a Google Maps API key or add coordinates to\n\t\t\t\t\t\t\t\t\t\t\t\t\tvisualize this location.\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tUpdate property details to include latitude and\n\t\t\t\t\t\t\t\t\t\t\t\t\tlongitude for enhanced routing.\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div className=\"border-border/60 bg-card/80 space-y-3 rounded-xl border p-6 shadow-sm\">\n\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase\">\n\t\t\t\t\t\t\t\t\t\tProperty Details\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<dl className=\"space-y-2 text-sm\">\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<dt className=\"text-muted-foreground text-xs\">Address</dt>\n\t\t\t\t\t\t\t\t\t\t\t<dd className=\"text-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t{property.address}\n\t\t\t\t\t\t\t\t\t\t\t\t{property.address2 ? `, ${property.address2}` : \"\"}\n\t\t\t\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t\t\t\t{property.city}, {property.state} {property.zip_code}\n\t\t\t\t\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{property.square_footage && (\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t<dt className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tSquare Footage\n\t\t\t\t\t\t\t\t\t\t\t\t</dt>\n\t\t\t\t\t\t\t\t\t\t\t\t<dd className=\"text-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{property.square_footage}\n\t\t\t\t\t\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t{property.year_built && (\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t<dt className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tYear Built\n\t\t\t\t\t\t\t\t\t\t\t\t</dt>\n\t\t\t\t\t\t\t\t\t\t\t\t<dd className=\"text-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{property.year_built}\n\t\t\t\t\t\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</dl>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<div className=\"border-border/60 bg-background text-muted-foreground flex flex-col items-center justify-center rounded-xl border border-dashed p-6 text-center text-sm\">\n\t\t\t\t\t\t\t\tNo property assigned\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</aside>\n\t\t\t\t</div>\n\t\t\t</UnifiedAccordionContent>\n\t\t),\n\t});\n\n\t// Transform teamAssignments to match JobTeamMembersTable expected format\n\tconst transformedTeamMembers = useMemo(() => {\n\t\tif (!Array.isArray(teamAssignments) || teamAssignments.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn teamAssignments\n\t\t\t.map((assignment: any) => {\n\t\t\t\tconst teamMember = assignment?.team_member || assignment?.teamMember;\n\t\t\t\tif (!teamMember) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\t// Handle both user (single) and users (array) formats\n\t\t\t\tconst user =\n\t\t\t\t\tteamMember.user ||\n\t\t\t\t\tteamMember.users?.[0] ||\n\t\t\t\t\tassignment?.user ||\n\t\t\t\t\tassignment?.assigned_user;\n\n\t\t\t\t// Get user ID from various possible locations\n\t\t\t\tconst userId = user?.id || teamMember.user_id || assignment.user_id;\n\t\t\t\tif (!userId) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\t// Build user name from various possible formats\n\t\t\t\tlet userName: string | null = null;\n\t\t\t\tif (user?.name) {\n\t\t\t\t\tuserName = user.name;\n\t\t\t\t} else if (user?.first_name || user?.last_name) {\n\t\t\t\t\tuserName = [user.first_name, user.last_name]\n\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t.join(\" \");\n\t\t\t\t} else if (teamMember.user?.name) {\n\t\t\t\t\tuserName = teamMember.user.name;\n\t\t\t\t} else if (user?.email) {\n\t\t\t\t\tuserName = user.email;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tid: assignment.id || assignment.team_member_id || teamMember.id,\n\t\t\t\t\tuser_id: userId,\n\t\t\t\t\tteam_member: {\n\t\t\t\t\t\tjob_title:\n\t\t\t\t\t\t\tteamMember.job_title || assignment.job_title || undefined,\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tname: userName || undefined,\n\t\t\t\t\t\t\temail: user?.email || teamMember.email || undefined,\n\t\t\t\t\t\t\tavatar_url:\n\t\t\t\t\t\t\t\tuser?.avatar_url ||\n\t\t\t\t\t\t\t\tuser?.avatar ||\n\t\t\t\t\t\t\t\tteamMember.avatar ||\n\t\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tfirst_name:\n\t\t\t\t\t\t\t\tuser?.first_name ||\n\t\t\t\t\t\t\t\t(userName ? userName.split(\" \")[0] : undefined),\n\t\t\t\t\t\t\tlast_name:\n\t\t\t\t\t\t\t\tuser?.last_name ||\n\t\t\t\t\t\t\t\t(userName && userName.includes(\" \")\n\t\t\t\t\t\t\t\t\t? userName.split(\" \").slice(1).join(\" \")\n\t\t\t\t\t\t\t\t\t: undefined),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tassigned_at:\n\t\t\t\t\t\tassignment.assigned_at ||\n\t\t\t\t\t\tassignment.assignedAt ||\n\t\t\t\t\t\tnew Date().toISOString(),\n\t\t\t\t\trole: assignment.role || \"crew\",\n\t\t\t\t};\n\t\t\t})\n\t\t\t.filter((member) => member !== null) as Array<{\n\t\t\tid: string;\n\t\t\tuser_id: string;\n\t\t\tteam_member: {\n\t\t\t\tjob_title?: string;\n\t\t\t\tuser: {\n\t\t\t\t\tname?: string;\n\t\t\t\t\temail?: string;\n\t\t\t\t\tavatar_url?: string;\n\t\t\t\t\tfirst_name?: string;\n\t\t\t\t\tlast_name?: string;\n\t\t\t\t};\n\t\t\t};\n\t\t\tassigned_at: string;\n\t\t\trole?: string;\n\t\t}>;\n\t}, [teamAssignments]);\n\n\tsections.push({\n\t\tid: \"team\",\n\t\ttitle: \"Team Members\",\n\t\ticon: <Users className=\"size-4\" />,\n\t\tcount: transformedTeamMembers.length,\n\t\tactions: (\n\t\t\t<JobTeamMemberSelector\n\t\t\t\tavailableMembers={availableTeamMembers}\n\t\t\t\tcurrentMemberIds={currentTeamMemberIds}\n\t\t\t\tonAssign={handleAssignTeamMember}\n\t\t\t/>\n\t\t),\n\t\tcontent: (\n\t\t\t<UnifiedAccordionContent className=\"overflow-x-auto p-0 sm:p-0\">\n\t\t\t\t<JobTeamMembersTable\n\t\t\t\t\tteamMembers={transformedTeamMembers}\n\t\t\t\t\tonRemoveMember={handleRemoveTeamMember}\n\t\t\t\t/>\n\t\t\t</UnifiedAccordionContent>\n\t\t),\n\t});\n\n\tsections.push({\n\t\tid: \"appointments\",\n\t\ttitle: \"Appointments\",\n\t\ticon: <Calendar className=\"size-4\" />,\n\t\tcount: schedules.length,\n\t\tactions: (\n\t\t\t<Button\n\t\t\t\tonClick={() => router.push(`/dashboard/schedule/new?jobId=${job.id}`)}\n\t\t\t\tsize=\"sm\"\n\t\t\t\tvariant=\"outline\"\n\t\t\t>\n\t\t\t\t<Plus className=\"mr-2 h-4 w-4\" /> Add Appointment\n\t\t\t</Button>\n\t\t),\n\t\tcontent: (\n\t\t\t<UnifiedAccordionContent className=\"p-0 sm:p-0\">\n\t\t\t\t<JobAppointmentsExpandable appointments={schedules} />\n\t\t\t</UnifiedAccordionContent>\n\t\t),\n\t});\n\n\tsections.push({\n\t\tid: \"equipment-serviced\",\n\t\ttitle: \"Equipment Serviced\",\n\t\ticon: <Wrench className=\"size-4\" />,\n\t\tcount: jobEquipment.length,\n\t\tactions: (\n\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() => setIsLinkEquipmentOpen(true)}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t>\n\t\t\t\t\t<Link2 className=\"mr-2 h-4 w-4\" /> Link Existing\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\trouter.push(`/dashboard/work/equipment/new?jobId=${job.id}`)\n\t\t\t\t\t}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t>\n\t\t\t\t\t<Plus className=\"mr-2 h-4 w-4\" /> Add Equipment\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t),\n\t\tcontent: (\n\t\t\t<UnifiedAccordionContent>\n\t\t\t\t{jobEquipment.length === 0 ? (\n\t\t\t\t\t<div className=\"flex flex-col items-center justify-center py-8 text-center\">\n\t\t\t\t\t\t<div className=\"bg-muted mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full\">\n\t\t\t\t\t\t\t<Wrench className=\"text-muted-foreground h-8 w-8\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<h3 className=\"mb-2 text-lg font-semibold\">\n\t\t\t\t\t\t\tNo equipment has been added to this job yet\n\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t<p className=\"text-muted-foreground mb-4 text-sm\">\n\t\t\t\t\t\t\tEquipment serviced on this job will appear here\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<Button onClick={() => {}} size=\"sm\" variant=\"secondary\">\n\t\t\t\t\t\t\t<Plus className=\"mr-2 h-4 w-4\" /> Add Equipment\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t{jobEquipment.map((je: any) => (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName=\"hover:bg-accent/50 space-y-3 rounded-lg border p-4 transition-colors\"\n\t\t\t\t\t\t\t\tkey={je.id}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"flex items-start justify-between\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"mb-2 flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<h4 className=\"font-semibold\">{je.equipment?.name}</h4>\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{je.service_type}</Badge>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground space-y-1 text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t\t\t{je.equipment?.manufacturer} {je.equipment?.model}\n\t\t\t\t\t\t\t\t\t\t\t\t{je.equipment?.serial_number &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t` • SN: ${je.equipment.serial_number}`}\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{je.work_performed && (\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">Work Performed:</span>\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1\">\n\t\t\t\t\t\t\t\t\t\t\t{je.work_performed}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap items-center gap-4 text-sm\">\n\t\t\t\t\t\t\t\t\t{je.condition_before && (\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground mr-2\">\n\t\t\t\t\t\t\t\t\t\t\t\tBefore:\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"outline\">{je.condition_before}</Badge>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t{je.condition_after && (\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground mr-2\">After:</span>\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"default\">{je.condition_after}</Badge>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</UnifiedAccordionContent>\n\t\t),\n\t});\n\n\tif (equipment.length > 0) {\n\t\tsections.push({\n\t\t\tid: \"equipment\",\n\t\t\ttitle: \"Customer Equipment at Property\",\n\t\t\ticon: <Building2 className=\"size-4\" />,\n\t\t\tcount: equipment.length,\n\t\t\tcontent: (\n\t\t\t\t<UnifiedAccordionContent className=\"p-0\">\n\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t<TableHead>Equipment</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>Type</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>Manufacturer</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>Model</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>Serial #</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>Last Service</TableHead>\n\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t{equipment.map((item: any) => (\n\t\t\t\t\t\t\t\t\t<TableRow key={item.id}>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{item.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{item.type}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{item.manufacturer || \"N/A\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{item.model || \"N/A\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-mono text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t{item.serial_number || \"N/A\"}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t{item.last_service_date\n\t\t\t\t\t\t\t\t\t\t\t\t? formatDate(item.last_service_date)\n\t\t\t\t\t\t\t\t\t\t\t\t: \"Never\"}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t</Table>\n\t\t\t\t\t</div>\n\t\t\t\t</UnifiedAccordionContent>\n\t\t\t),\n\t\t});\n\t}\n\n\tsections.push({\n\t\tid: \"estimates\",\n\t\ttitle: \"Estimates\",\n\t\ticon: <Receipt className=\"size-4\" />,\n\t\tcount: estimates.length,\n\t\tactions: (\n\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() => setIsLinkEstimateOpen(true)}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t>\n\t\t\t\t\t<Link2 className=\"mr-2 h-4 w-4\" /> Link Existing\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\trouter.push(`/dashboard/work/estimates/new?jobId=${job.id}`)\n\t\t\t\t\t}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t>\n\t\t\t\t\t<Plus className=\"mr-2 h-4 w-4\" /> Create Estimate\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t),\n\t\tcontent: (\n\t\t\t<UnifiedAccordionContent className=\"overflow-x-auto p-0 sm:p-0\">\n\t\t\t\t<JobEstimatesTable estimates={estimates} />\n\t\t\t</UnifiedAccordionContent>\n\t\t),\n\t});\n\n\tsections.push({\n\t\tid: \"invoices\",\n\t\ttitle: \"Invoices\",\n\t\ticon: <FileText className=\"size-4\" />,\n\t\tcount: invoices.length,\n\t\tactions: (\n\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() => setIsLinkInvoiceOpen(true)}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t>\n\t\t\t\t\t<Link2 className=\"mr-2 h-4 w-4\" /> Link Existing\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\trouter.push(`/dashboard/work/invoices/new?jobId=${job.id}`)\n\t\t\t\t\t}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t>\n\t\t\t\t\t<Plus className=\"mr-2 h-4 w-4\" /> Create Invoice\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t),\n\t\tcontent: (\n\t\t\t<UnifiedAccordionContent className=\"overflow-x-auto p-0 sm:p-0\">\n\t\t\t\t<JobInvoicesTable invoices={invoices} />\n\t\t\t</UnifiedAccordionContent>\n\t\t),\n\t});\n\n\tsections.push({\n\t\tid: \"payments\",\n\t\ttitle: \"Payments\",\n\t\ticon: <DollarSign className=\"size-4\" />,\n\t\tcount: payments.length,\n\t\tactions: (\n\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() => setIsLinkPaymentOpen(true)}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t>\n\t\t\t\t\t<Link2 className=\"mr-2 h-4 w-4\" /> Link Existing\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\trouter.push(`/dashboard/work/payments/new?jobId=${job.id}`)\n\t\t\t\t\t}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t>\n\t\t\t\t\t<Plus className=\"mr-2 h-4 w-4\" /> Record Payment\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t),\n\t\tcontent: (\n\t\t\t<UnifiedAccordionContent className=\"overflow-x-auto p-0 sm:p-0\">\n\t\t\t\t<JobPaymentsTable payments={payments} />\n\t\t\t</UnifiedAccordionContent>\n\t\t),\n\t});\n\n\tsections.push({\n\t\tid: \"purchase-orders\",\n\t\ttitle: \"Purchase Orders\",\n\t\ticon: <Package className=\"size-4\" />,\n\t\tcount: purchaseOrders.length,\n\t\tactions: (\n\t\t\t<Button\n\t\t\t\tonClick={() =>\n\t\t\t\t\trouter.push(`/dashboard/work/purchase-orders/new?jobId=${job.id}`)\n\t\t\t\t}\n\t\t\t\tsize=\"sm\"\n\t\t\t\tvariant=\"outline\"\n\t\t\t>\n\t\t\t\t<Plus className=\"mr-2 h-4 w-4\" /> Create PO\n\t\t\t</Button>\n\t\t),\n\t\tcontent: (\n\t\t\t<UnifiedAccordionContent className=\"overflow-x-auto p-0 sm:p-0\">\n\t\t\t\t<JobPurchaseOrdersTable purchaseOrders={purchaseOrders} />\n\t\t\t</UnifiedAccordionContent>\n\t\t),\n\t});\n\n\tsections.push({\n\t\tid: \"photos\",\n\t\ttitle: \"Photos & Documents\",\n\t\ticon: <Camera className=\"size-4\" />,\n\t\tcount: photos.length + documents.length,\n\t\tactions: (\n\t\t\t<>\n\t\t\t\t<input\n\t\t\t\t\taccept=\"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt,.csv\"\n\t\t\t\t\tclassName=\"hidden\"\n\t\t\t\t\tmultiple\n\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\tif (e.target.files && e.target.files.length > 0) {\n\t\t\t\t\t\t\tsetShowUploader(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tref={fileInputRef}\n\t\t\t\t\ttype=\"file\"\n\t\t\t\t/>\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() => fileInputRef.current?.click()}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t>\n\t\t\t\t\t<Plus className=\"mr-2 h-4 w-4\" /> Upload\n\t\t\t\t</Button>\n\t\t\t</>\n\t\t),\n\t\tcontent: (\n\t\t\t<UnifiedAccordionContent className=\"p-0\">\n\t\t\t\t<div\n\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\"relative transition-colors\",\n\t\t\t\t\t\tisDraggingOver && \"bg-primary/5 ring-primary ring-2 ring-inset\",\n\t\t\t\t\t)}\n\t\t\t\t\tonDragEnter={(e) => {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tsetIsDraggingOver(true);\n\t\t\t\t\t}}\n\t\t\t\t\tonDragLeave={(e) => {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tif (e.currentTarget === e.target) {\n\t\t\t\t\t\t\t// Only set to false if leaving the container entirely\n\t\t\t\t\t\t\tsetIsDraggingOver(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tonDragOver={(e) => {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t}}\n\t\t\t\t\tonDrop={(e) => {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tsetIsDraggingOver(false);\n\t\t\t\t\t\tsetShowUploader(true);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t{isDraggingOver && (\n\t\t\t\t\t\t<div className=\"bg-primary/5 pointer-events-none absolute inset-0 z-10 flex items-center justify-center backdrop-blur-sm\">\n\t\t\t\t\t\t\t<div className=\"border-primary bg-background rounded-lg border-2 border-dashed p-8 text-center\">\n\t\t\t\t\t\t\t\t<Upload className=\"text-primary mx-auto mb-2 h-12 w-12\" />\n\t\t\t\t\t\t\t\t<p className=\"text-primary font-semibold\">\n\t\t\t\t\t\t\t\t\tDrop files to upload\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\t\t\t\tPhotos, documents, and more\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<div className=\"bg-muted/30 border-b px-6 py-3\">\n\t\t\t\t\t\t<div className=\"text-muted-foreground flex items-center gap-2 text-sm\">\n\t\t\t\t\t\t\t<Upload className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\tDrag and drop files anywhere in this section to upload\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"space-y-6 px-6 py-6\">\n\t\t\t\t\t\t{showUploader && (\n\t\t\t\t\t\t\t<InlinePhotoUploader\n\t\t\t\t\t\t\t\tcompanyId={job.company_id}\n\t\t\t\t\t\t\t\tjobId={job.id}\n\t\t\t\t\t\t\t\tonCancel={() => setShowUploader(false)}\n\t\t\t\t\t\t\t\tonUploadComplete={() => {\n\t\t\t\t\t\t\t\t\tsetShowUploader(false);\n\t\t\t\t\t\t\t\t\t// Server Action handles revalidation automatically\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div className=\"mb-3 flex items-center justify-between\">\n\t\t\t\t\t\t\t\t<h4 className=\"font-semibold\">\n\t\t\t\t\t\t\t\t\tPhotos by Category ({photos.length})\n\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{photos.length > 0 ? (\n\t\t\t\t\t\t\t\t<div className=\"grid gap-3 md:grid-cols-4\">\n\t\t\t\t\t\t\t\t\t{[\n\t\t\t\t\t\t\t\t\t\t\"before\",\n\t\t\t\t\t\t\t\t\t\t\"during\",\n\t\t\t\t\t\t\t\t\t\t\"after\",\n\t\t\t\t\t\t\t\t\t\t\"issue\",\n\t\t\t\t\t\t\t\t\t\t\"equipment\",\n\t\t\t\t\t\t\t\t\t\t\"completion\",\n\t\t\t\t\t\t\t\t\t\t\"other\",\n\t\t\t\t\t\t\t\t\t].map((category) => {\n\t\t\t\t\t\t\t\t\t\tconst count = photos.filter(\n\t\t\t\t\t\t\t\t\t\t\t(p: any) => p.category === category,\n\t\t\t\t\t\t\t\t\t\t).length;\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"rounded-lg border p-4 text-center\"\n\t\t\t\t\t\t\t\t\t\t\t\tkey={category}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs font-medium uppercase\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{category}\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-3xl font-bold\">{count}</p>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<div className=\"flex flex-col items-center justify-center py-8 text-center\">\n\t\t\t\t\t\t\t\t\t<div className=\"bg-muted mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full\">\n\t\t\t\t\t\t\t\t\t\t<Camera className=\"text-muted-foreground h-8 w-8\" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<h3 className=\"mb-2 text-lg font-semibold\">\n\t\t\t\t\t\t\t\t\t\tNo photos uploaded yet\n\t\t\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mb-4 text-sm\">\n\t\t\t\t\t\t\t\t\t\tUpload photos to document the job progress\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={() => setShowUploader(true)}\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Plus className=\"mr-2 h-4 w-4\" /> Upload Photos\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<Separator />\n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<h4 className=\"mb-3 font-semibold\">\n\t\t\t\t\t\t\t\tDocuments ({documents.length})\n\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t{documents.length > 0 ? (\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t{documents.map((doc: any) => (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center justify-between rounded-lg border p-3\"\n\t\t\t\t\t\t\t\t\t\t\tkey={doc.id}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<FileText className=\"text-muted-foreground h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm\">{doc.file_name}</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 px-2\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Download className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<div className=\"flex flex-col items-center justify-center py-8 text-center\">\n\t\t\t\t\t\t\t\t\t<div className=\"bg-muted mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full\">\n\t\t\t\t\t\t\t\t\t\t<FileText className=\"text-muted-foreground h-8 w-8\" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<h3 className=\"mb-2 text-lg font-semibold\">\n\t\t\t\t\t\t\t\t\t\tNo documents uploaded yet\n\t\t\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mb-4 text-sm\">\n\t\t\t\t\t\t\t\t\t\tUpload documents, receipts, or other files related to this\n\t\t\t\t\t\t\t\t\t\tjob\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={() => setShowUploader(true)}\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Plus className=\"mr-2 h-4 w-4\" /> Upload Document\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<Separator />\n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<h4 className=\"mb-3 font-semibold\">Signatures</h4>\n\t\t\t\t\t\t\t<div className=\"grid gap-3 md:grid-cols-2\">\n\t\t\t\t\t\t\t\t<div className=\"rounded-lg border p-4\">\n\t\t\t\t\t\t\t\t\t<div className=\"mb-2 flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-medium\">Customer Signature</p>\n\t\t\t\t\t\t\t\t\t\t{signatures.find(\n\t\t\t\t\t\t\t\t\t\t\t(s: any) => s.signature_type === \"customer\",\n\t\t\t\t\t\t\t\t\t\t) ? (\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"default\">\n\t\t\t\t\t\t\t\t\t\t\t\t<CheckCircle className=\"mr-1 h-3 w-3\" /> Signed\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">Pending</Badge>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{signatures.find(\n\t\t\t\t\t\t\t\t\t\t(s: any) => s.signature_type === \"customer\",\n\t\t\t\t\t\t\t\t\t) && (\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\tSigned{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t{formatDate(\n\t\t\t\t\t\t\t\t\t\t\t\tsignatures.find(\n\t\t\t\t\t\t\t\t\t\t\t\t\t(s: any) => s.signature_type === \"customer\",\n\t\t\t\t\t\t\t\t\t\t\t\t).signed_at,\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div className=\"rounded-lg border p-4\">\n\t\t\t\t\t\t\t\t\t<div className=\"mb-2 flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-medium\">Technician Signature</p>\n\t\t\t\t\t\t\t\t\t\t{signatures.find(\n\t\t\t\t\t\t\t\t\t\t\t(s: any) => s.signature_type === \"technician\",\n\t\t\t\t\t\t\t\t\t\t) ? (\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"default\">\n\t\t\t\t\t\t\t\t\t\t\t\t<CheckCircle className=\"mr-1 h-3 w-3\" /> Signed\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">Pending</Badge>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{signatures.find(\n\t\t\t\t\t\t\t\t\t\t(s: any) => s.signature_type === \"technician\",\n\t\t\t\t\t\t\t\t\t) && (\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\tSigned{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t{formatDate(\n\t\t\t\t\t\t\t\t\t\t\t\tsignatures.find(\n\t\t\t\t\t\t\t\t\t\t\t\t\t(s: any) => s.signature_type === \"technician\",\n\t\t\t\t\t\t\t\t\t\t\t\t).signed_at,\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</UnifiedAccordionContent>\n\t\t),\n\t});\n\n\tsections.push({\n\t\tid: \"tasks\",\n\t\ttitle: \"Job Tasks & Checklist\",\n\t\ticon: <CheckCircle className=\"size-4\" />,\n\t\tcount: tasks.length,\n\t\tactions: (\n\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() => setIsAddTaskDialogOpen(true)}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t>\n\t\t\t\t\t<Plus className=\"mr-2 h-4 w-4\" /> Add Task\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() => setIsLoadTemplateDialogOpen(true)}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t>\n\t\t\t\t\tLoad Template\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t),\n\t\tcontent: (\n\t\t\t<UnifiedAccordionContent className=\"overflow-x-auto p-0 sm:p-0\">\n\t\t\t\t<JobTasksTable tasks={tasks} />\n\t\t\t</UnifiedAccordionContent>\n\t\t),\n\t});\n\n\tsections.push({\n\t\tid: \"notes\",\n\t\ttitle: \"Notes\",\n\t\ticon: <StickyNote className=\"size-4\" />,\n\t\tcount: jobNotes.length,\n\t\tactions: (\n\t\t\t<Button\n\t\t\t\tonClick={() => setIsAddNoteDialogOpen(true)}\n\t\t\t\tsize=\"sm\"\n\t\t\t\tvariant=\"outline\"\n\t\t\t>\n\t\t\t\t<Plus className=\"mr-2 h-4 w-4\" /> Add Note\n\t\t\t</Button>\n\t\t),\n\t\tcontent: (\n\t\t\t<UnifiedAccordionContent className=\"overflow-x-auto p-0 sm:p-0\">\n\t\t\t\t<JobNotesTable notes={jobNotes} />\n\t\t\t</UnifiedAccordionContent>\n\t\t),\n\t});\n\n\tsections.push({\n\t\tid: \"activity\",\n\t\ttitle: \"Activity & Communications\",\n\t\ticon: <Activity className=\"size-4\" />,\n\t\tcount: activities.length + communications.length,\n\t\tactions: (\n\t\t\t<Button\n\t\t\t\tonClick={() => {\n\t\t\t\t\t// Navigate to messages page - if customer is attached, their communications will auto-load\n\t\t\t\t\tconst baseUrl = \"/dashboard/communication/messages\";\n\t\t\t\t\tconst url = customer?.id\n\t\t\t\t\t\t? `${baseUrl}?customerId=${customer.id}`\n\t\t\t\t\t\t: baseUrl;\n\t\t\t\t\trouter.push(url);\n\t\t\t\t}}\n\t\t\t\tsize=\"sm\"\n\t\t\t\tvariant=\"outline\"\n\t\t\t>\n\t\t\t\t<Plus className=\"mr-2 h-4 w-4\" /> Add Communication\n\t\t\t</Button>\n\t\t),\n\t\tcontent: (\n\t\t\t<UnifiedAccordionContent className=\"p-0\">\n\t\t\t\t<JobActivityTimeline activities={[...activities, ...communications]} />\n\t\t\t</UnifiedAccordionContent>\n\t\t),\n\t});\n\n\tconst relatedItems = [] as Array<{\n\t\tid: string;\n\t\ttype: string;\n\t\ttitle: string;\n\t\tsubtitle?: string;\n\t\thref: string;\n\t\tbadge?: {\n\t\t\tlabel: string;\n\t\t\tvariant?: \"default\" | \"secondary\" | \"destructive\" | \"outline\";\n\t\t};\n\t}>;\n\n\tif (customer) {\n\t\trelatedItems.push({\n\t\t\tid: `customer-${customer.id}`,\n\t\t\ttype: \"customer\",\n\t\t\ttitle: `${customer.first_name} ${customer.last_name}`,\n\t\t\tsubtitle: customer.email || customer.phone || undefined,\n\t\t\thref: `/dashboard/customers/${customer.id}`,\n\t\t});\n\t}\n\n\tif (property) {\n\t\trelatedItems.push({\n\t\t\tid: `property-${property.id}`,\n\t\t\ttype: \"property\",\n\t\t\ttitle: property.name || property.address,\n\t\t\tsubtitle: `${property.city || \"\"}, ${property.state || \"\"}`,\n\t\t\thref: `/dashboard/work/properties/${property.id}`,\n\t\t});\n\t}\n\n\tif (assignedUser) {\n\t\trelatedItems.push({\n\t\t\tid: `technician-${assignedUser.id}`,\n\t\t\ttype: \"team\",\n\t\t\ttitle: assignedUser.name,\n\t\t\tsubtitle: assignedUser.email || assignedUser.phone || undefined,\n\t\t\thref: assignedUser.id\n\t\t\t\t? `/dashboard/settings/team/${assignedUser.id}`\n\t\t\t\t: \"/dashboard/settings/team\",\n\t\t});\n\t}\n\n\treturn jobRecord ? (\n\t\t<>\n\t\t\t<DetailPageContentLayout\n\t\t\t\tactivities={activities}\n\t\t\t\tbeforeContent={beforeContent}\n\t\t\t\tcustomSections={sections}\n\t\t\t\tenableReordering={true}\n\t\t\t\theader={headerConfig}\n\t\t\t\tnotes={jobNotes}\n\t\t\t\trelatedItems={relatedItems}\n\t\t\t\tshowStandardSections={{\n\t\t\t\t\tactivities: false,\n\t\t\t\t\tnotes: false,\n\t\t\t\t\tattachments: false,\n\t\t\t\t}}\n\t\t\t\tstorageKey=\"job-details\"\n\t\t\t/>\n\n\t\t\t<Dialog\n\t\t\t\tonOpenChange={setIsCreatePropertyDialogOpen}\n\t\t\t\topen={isCreatePropertyDialogOpen}\n\t\t\t>\n\t\t\t\t<DialogContent className=\"sm:max-w-[500px]\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>Create New Property</DialogTitle>\n\t\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t\tAdd a new property for {customer?.first_name}{\" \"}\n\t\t\t\t\t\t\t{customer?.last_name}\n\t\t\t\t\t\t</DialogDescription>\n\t\t\t\t\t</DialogHeader>\n\n\t\t\t\t\t<div className=\"space-y-4 py-4\">\n\t\t\t\t\t\t<StandardFormField label=\"Property Name\" htmlFor=\"property-name\">\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tid=\"property-name\"\n\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\tsetNewProperty({ ...newProperty, name: e.target.value })\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tplaceholder=\"Main Residence\"\n\t\t\t\t\t\t\t\tvalue={newProperty.name}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</StandardFormField>\n\n\t\t\t\t\t\t<StandardFormField\n\t\t\t\t\t\t\tlabel=\"Address\"\n\t\t\t\t\t\t\thtmlFor=\"property-address\"\n\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tid=\"property-address\"\n\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\tsetNewProperty({ ...newProperty, address: e.target.value })\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tplaceholder=\"123 Main St\"\n\t\t\t\t\t\t\t\tvalue={newProperty.address}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</StandardFormField>\n\n\t\t\t\t\t\t<StandardFormField\n\t\t\t\t\t\t\tlabel=\"Address Line 2\"\n\t\t\t\t\t\t\thtmlFor=\"property-address2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tid=\"property-address2\"\n\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\tsetNewProperty({ ...newProperty, address2: e.target.value })\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tplaceholder=\"Apt 4B\"\n\t\t\t\t\t\t\t\tvalue={newProperty.address2}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</StandardFormField>\n\n\t\t\t\t\t\t<StandardFormRow cols={2}>\n\t\t\t\t\t\t\t<StandardFormField label=\"City\" htmlFor=\"property-city\" required>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tid=\"property-city\"\n\t\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\t\tsetNewProperty({ ...newProperty, city: e.target.value })\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tplaceholder=\"New York\"\n\t\t\t\t\t\t\t\t\tvalue={newProperty.city}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</StandardFormField>\n\n\t\t\t\t\t\t\t<StandardFormField\n\t\t\t\t\t\t\t\tlabel=\"State\"\n\t\t\t\t\t\t\t\thtmlFor=\"property-state\"\n\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tid=\"property-state\"\n\t\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\t\tsetNewProperty({ ...newProperty, state: e.target.value })\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tplaceholder=\"NY\"\n\t\t\t\t\t\t\t\t\tvalue={newProperty.state}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t\t</StandardFormRow>\n\n\t\t\t\t\t\t<StandardFormField label=\"ZIP Code\" htmlFor=\"property-zip\" required>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tid=\"property-zip\"\n\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\tsetNewProperty({ ...newProperty, zipCode: e.target.value })\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tplaceholder=\"10001\"\n\t\t\t\t\t\t\t\tvalue={newProperty.zipCode}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isCreatingProperty}\n\t\t\t\t\t\t\tonClick={() => setIsCreatePropertyDialogOpen(false)}\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\t\tisCreatingProperty ||\n\t\t\t\t\t\t\t\t!newProperty.address ||\n\t\t\t\t\t\t\t\t!newProperty.city ||\n\t\t\t\t\t\t\t\t!newProperty.state ||\n\t\t\t\t\t\t\t\t!newProperty.zipCode\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonClick={handleCreateProperty}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{isCreatingProperty ? \"Creating...\" : \"Create Property\"}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t{customer?.phone && (\n\t\t\t\t<SMSDialog\n\t\t\t\t\tcompanyId={job.company_id}\n\t\t\t\t\tcompanyPhones={companyPhones}\n\t\t\t\t\tcustomerId={customer.id}\n\t\t\t\t\tcustomerName={`${customer.first_name} ${customer.last_name}`}\n\t\t\t\t\tcustomerPhone={customer.phone}\n\t\t\t\t\tjobId={job.id}\n\t\t\t\t\tonOpenChange={setIsSMSDialogOpen}\n\t\t\t\t\topen={isSMSDialogOpen}\n\t\t\t\t\tpropertyId={property?.id}\n\t\t\t\t/>\n\t\t\t)}\n\n\t\t\t<Dialog onOpenChange={setIsArchiveDialogOpen} open={isArchiveDialogOpen}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>Archive Job</DialogTitle>\n\t\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t\tArchiving removes this job from active workflows. You can restore\n\t\t\t\t\t\t\tit from the archive within 90 days.\n\t\t\t\t\t\t</DialogDescription>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isArchiving}\n\t\t\t\t\t\t\tonClick={() => setIsArchiveDialogOpen(false)}\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isArchiving}\n\t\t\t\t\t\t\tonClick={handleArchiveJob}\n\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{isArchiving ? \"Archiving...\" : \"Archive Job\"}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<AlertDialog\n\t\t\t\tonOpenChange={setIsRemoveCustomerDialogOpen}\n\t\t\t\topen={isRemoveCustomerDialogOpen}\n\t\t\t>\n\t\t\t\t<AlertDialogContent>\n\t\t\t\t\t<AlertDialogHeader>\n\t\t\t\t\t\t<AlertDialogTitle>Remove Customer and Property?</AlertDialogTitle>\n\t\t\t\t\t\t<AlertDialogDescription>\n\t\t\t\t\t\t\tThis will clear the customer and property fields from this job.\n\t\t\t\t\t\t\tThis action can be undone by reassigning a customer and property.\n\t\t\t\t\t\t</AlertDialogDescription>\n\t\t\t\t\t</AlertDialogHeader>\n\t\t\t\t\t<AlertDialogFooter>\n\t\t\t\t\t\t<AlertDialogCancel>Cancel</AlertDialogCancel>\n\t\t\t\t\t\t<AlertDialogAction\n\t\t\t\t\t\t\tonClick={async () => {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tconst formData = new FormData();\n\t\t\t\t\t\t\t\t\tformData.append(\"customer_id\", \"\");\n\t\t\t\t\t\t\t\t\tformData.append(\"property_id\", \"\");\n\n\t\t\t\t\t\t\t\t\tconst result = await updateJob(job.id, formData);\n\t\t\t\t\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\t\t\t\t\ttoast.success(\"Customer and property removed\");\n\t\t\t\t\t\t\t\t\t\t// Server Action handles revalidation automatically\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\tresult.error || \"Failed to remove customer and property\",\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\ttoast.error(\"Failed to remove customer and property\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tRemove\n\t\t\t\t\t\t</AlertDialogAction>\n\t\t\t\t\t</AlertDialogFooter>\n\t\t\t\t</AlertDialogContent>\n\t\t\t</AlertDialog>\n\n\t\t\t{metrics && (\n\t\t\t\t<JobStatisticsSheet\n\t\t\t\t\tinvoices={invoices}\n\t\t\t\t\tjob={job}\n\t\t\t\t\tjobMaterials={jobMaterials}\n\t\t\t\t\tmetrics={metrics}\n\t\t\t\t\tonOpenChange={setIsStatisticsOpen}\n\t\t\t\t\topen={isStatisticsOpen}\n\t\t\t\t\tpayments={payments}\n\t\t\t\t\tteamAssignments={teamAssignments}\n\t\t\t\t\ttimeEntries={timeEntries}\n\t\t\t\t\tonUpdateCosting={handleUpdateCosting}\n\t\t\t\t/>\n\t\t\t)}\n\n\t\t\t{/* Add Task Dialog */}\n\t\t\t<Dialog onOpenChange={setIsAddTaskDialogOpen} open={isAddTaskDialogOpen}>\n\t\t\t\t<DialogContent className=\"sm:max-w-[500px]\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>Add Task</DialogTitle>\n\t\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t\tCreate a new task or checklist item for this job.\n\t\t\t\t\t\t</DialogDescription>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4 py-4\">\n\t\t\t\t\t\t<StandardFormField label=\"Title\" htmlFor=\"task-title\" required>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tid=\"task-title\"\n\t\t\t\t\t\t\t\tonChange={(e) => setNewTaskTitle(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"Enter task title...\"\n\t\t\t\t\t\t\t\tvalue={newTaskTitle}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</StandardFormField>\n\n\t\t\t\t\t\t<StandardFormField\n\t\t\t\t\t\t\tlabel=\"Description\"\n\t\t\t\t\t\t\thtmlFor=\"task-description\"\n\t\t\t\t\t\t\tdescription=\"Optional\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tid=\"task-description\"\n\t\t\t\t\t\t\t\tonChange={(e) => setNewTaskDescription(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"Enter task description...\"\n\t\t\t\t\t\t\t\tvalue={newTaskDescription}\n\t\t\t\t\t\t\t\tclassName=\"min-h-[80px]\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isCreatingTask}\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\tsetNewTaskTitle(\"\");\n\t\t\t\t\t\t\t\tsetNewTaskDescription(\"\");\n\t\t\t\t\t\t\t\tsetIsAddTaskDialogOpen(false);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isCreatingTask || !newTaskTitle.trim()}\n\t\t\t\t\t\t\tonClick={async () => {\n\t\t\t\t\t\t\t\tif (!newTaskTitle.trim()) return;\n\n\t\t\t\t\t\t\t\tsetIsCreatingTask(true);\n\n\t\t\t\t\t\t\t\t// Optimistic update - add task to UI immediately\n\t\t\t\t\t\t\t\tconst newTask = {\n\t\t\t\t\t\t\t\t\tid: `temp-${Date.now()}`,\n\t\t\t\t\t\t\t\t\tjob_id: job.id,\n\t\t\t\t\t\t\t\t\ttitle: newTaskTitle.trim(),\n\t\t\t\t\t\t\t\t\tdescription: newTaskDescription.trim() || null,\n\t\t\t\t\t\t\t\t\tis_completed: false,\n\t\t\t\t\t\t\t\t\tis_required: false,\n\t\t\t\t\t\t\t\t\tcreated_at: new Date().toISOString(),\n\t\t\t\t\t\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tsetTasks([...tasks, newTask]);\n\t\t\t\t\t\t\t\tsetNewTaskTitle(\"\");\n\t\t\t\t\t\t\t\tsetNewTaskDescription(\"\");\n\t\t\t\t\t\t\t\tsetIsAddTaskDialogOpen(false);\n\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tconst supabase = createClient();\n\t\t\t\t\t\t\t\t\tconst { data, error } = await supabase\n\t\t\t\t\t\t\t\t\t\t.from(\"job_tasks\")\n\t\t\t\t\t\t\t\t\t\t.insert({\n\t\t\t\t\t\t\t\t\t\t\tjob_id: job.id,\n\t\t\t\t\t\t\t\t\t\t\ttitle: newTask.title,\n\t\t\t\t\t\t\t\t\t\t\tdescription: newTask.description,\n\t\t\t\t\t\t\t\t\t\t\tis_completed: false,\n\t\t\t\t\t\t\t\t\t\t\tis_required: false,\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.select()\n\t\t\t\t\t\t\t\t\t\t.single();\n\n\t\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\t\t// Rollback optimistic update\n\t\t\t\t\t\t\t\t\t\tsetTasks(tasks);\n\t\t\t\t\t\t\t\t\t\ttoast.error(\"Failed to create task\");\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t// Replace temp item with real data\n\t\t\t\t\t\t\t\t\t\tsetTasks((prev) =>\n\t\t\t\t\t\t\t\t\t\t\tprev.map((t) => (t.id === newTask.id ? data : t)),\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\ttoast.success(\"Task created successfully\");\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t// Rollback optimistic update\n\t\t\t\t\t\t\t\t\tsetTasks(tasks);\n\t\t\t\t\t\t\t\t\ttoast.error(\"Failed to create task\");\n\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\tsetIsCreatingTask(false);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{isCreatingTask ? \"Creating...\" : \"Create Task\"}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t{/* Add Note Dialog */}\n\t\t\t<Dialog onOpenChange={setIsAddNoteDialogOpen} open={isAddNoteDialogOpen}>\n\t\t\t\t<DialogContent className=\"sm:max-w-[500px]\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>Add Note</DialogTitle>\n\t\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t\tAdd a note or comment for this job.\n\t\t\t\t\t\t</DialogDescription>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4 py-4\">\n\t\t\t\t\t\t<StandardFormField\n\t\t\t\t\t\t\tlabel=\"Note Content\"\n\t\t\t\t\t\t\thtmlFor=\"note-content\"\n\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tid=\"note-content\"\n\t\t\t\t\t\t\t\tonChange={(e) => setNewNoteContent(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"Enter note content...\"\n\t\t\t\t\t\t\t\tvalue={newNoteContent}\n\t\t\t\t\t\t\t\tclassName=\"min-h-[120px]\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isCreatingNote}\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\tsetNewNoteContent(\"\");\n\t\t\t\t\t\t\t\tsetIsAddNoteDialogOpen(false);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isCreatingNote || !newNoteContent.trim()}\n\t\t\t\t\t\t\tonClick={async () => {\n\t\t\t\t\t\t\t\tif (!newNoteContent.trim()) return;\n\n\t\t\t\t\t\t\t\tsetIsCreatingNote(true);\n\n\t\t\t\t\t\t\t\t// Get user first for optimistic update\n\t\t\t\t\t\t\t\tconst supabase = createClient();\n\t\t\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\t\t\tdata: { user },\n\t\t\t\t\t\t\t\t} = await supabase.auth.getUser();\n\n\t\t\t\t\t\t\t\t// Optimistic update - add note to UI immediately\n\t\t\t\t\t\t\t\tconst newNote = {\n\t\t\t\t\t\t\t\t\tid: `temp-${Date.now()}`,\n\t\t\t\t\t\t\t\t\tjob_id: job.id,\n\t\t\t\t\t\t\t\t\tcontent: newNoteContent.trim(),\n\t\t\t\t\t\t\t\t\tnote_type: \"general\",\n\t\t\t\t\t\t\t\t\tis_important: false,\n\t\t\t\t\t\t\t\t\tcreated_by: user?.id || null,\n\t\t\t\t\t\t\t\t\tcreated_by_name: user?.email || \"Unknown\",\n\t\t\t\t\t\t\t\t\tcreated_at: new Date().toISOString(),\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tsetJobNotes([...jobNotes, newNote]);\n\t\t\t\t\t\t\t\tsetNewNoteContent(\"\");\n\t\t\t\t\t\t\t\tsetIsAddNoteDialogOpen(false);\n\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tconst { data, error } = await supabase\n\t\t\t\t\t\t\t\t\t\t.from(\"job_notes\")\n\t\t\t\t\t\t\t\t\t\t.insert({\n\t\t\t\t\t\t\t\t\t\t\tjob_id: job.id,\n\t\t\t\t\t\t\t\t\t\t\tcontent: newNote.content,\n\t\t\t\t\t\t\t\t\t\t\tnote_type: \"general\",\n\t\t\t\t\t\t\t\t\t\t\tis_important: false,\n\t\t\t\t\t\t\t\t\t\t\tcreated_by: user?.id || null,\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.select()\n\t\t\t\t\t\t\t\t\t\t.single();\n\n\t\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\t\t// Rollback optimistic update\n\t\t\t\t\t\t\t\t\t\tsetJobNotes(jobNotes);\n\t\t\t\t\t\t\t\t\t\ttoast.error(\"Failed to create note\");\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t// Replace temp item with real data\n\t\t\t\t\t\t\t\t\t\tsetJobNotes((prev) =>\n\t\t\t\t\t\t\t\t\t\t\tprev.map((n) => (n.id === newNote.id ? data : n)),\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\ttoast.success(\"Note created successfully\");\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t// Rollback optimistic update\n\t\t\t\t\t\t\t\t\tsetJobNotes(jobNotes);\n\t\t\t\t\t\t\t\t\ttoast.error(\"Failed to create note\");\n\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\tsetIsCreatingNote(false);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{isCreatingNote ? \"Creating...\" : \"Create Note\"}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t{/* Load Template Dialog */}\n\t\t\t<Dialog\n\t\t\t\tonOpenChange={setIsLoadTemplateDialogOpen}\n\t\t\t\topen={isLoadTemplateDialogOpen}\n\t\t\t>\n\t\t\t\t<DialogContent className=\"sm:max-w-[500px]\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>Load Task Template</DialogTitle>\n\t\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t\tSelect a task template to apply to this job. This feature will be\n\t\t\t\t\t\t\tavailable soon.\n\t\t\t\t\t\t</DialogDescription>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4 py-4\">\n\t\t\t\t\t\t<div className=\"text-muted-foreground rounded-lg border border-dashed p-6 text-center text-sm\">\n\t\t\t\t\t\t\tTask templates feature is coming soon. You'll be able to save and\n\t\t\t\t\t\t\tload predefined task checklists for different job types.\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tonClick={() => setIsLoadTemplateDialogOpen(false)}\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tClose\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t{/* Link Existing Estimate Dialog */}\n\t\t\t<Dialog onOpenChange={setIsLinkEstimateOpen} open={isLinkEstimateOpen}>\n\t\t\t\t<DialogContent className=\"sm:max-w-[700px]\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>Link Existing Estimate</DialogTitle>\n\t\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t\tSearch and select an estimate to link to this job. Only unlinked\n\t\t\t\t\t\t\testimates are shown.\n\t\t\t\t\t\t</DialogDescription>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tplaceholder=\"Search by estimate number, customer, or status...\"\n\t\t\t\t\t\t\t\tvalue={estimateSearchQuery}\n\t\t\t\t\t\t\t\tonChange={(e) => setEstimateSearchQuery(e.target.value)}\n\t\t\t\t\t\t\t\tclassName=\"pl-10\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<FileText className=\"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"border rounded-lg max-h-[400px] overflow-y-auto\">\n\t\t\t\t\t\t\t{availableEstimates.filter((estimate) => {\n\t\t\t\t\t\t\t\tif (!estimateSearchQuery) return true;\n\t\t\t\t\t\t\t\tconst query = estimateSearchQuery.toLowerCase();\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\testimate.estimate_number.toLowerCase().includes(query) ||\n\t\t\t\t\t\t\t\t\testimate.status.toLowerCase().includes(query) ||\n\t\t\t\t\t\t\t\t\testimate.customer?.name?.toLowerCase().includes(query)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}).length === 0 ? (\n\t\t\t\t\t\t\t\t<div className=\"flex flex-col items-center justify-center py-12 text-center\">\n\t\t\t\t\t\t\t\t\t<FileText className=\"h-12 w-12 text-muted-foreground/50 mb-3\" />\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tNo estimates found\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tTry adjusting your search\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<div className=\"divide-y\">\n\t\t\t\t\t\t\t\t\t{availableEstimates\n\t\t\t\t\t\t\t\t\t\t.filter((estimate) => {\n\t\t\t\t\t\t\t\t\t\t\tif (!estimateSearchQuery) return true;\n\t\t\t\t\t\t\t\t\t\t\tconst query = estimateSearchQuery.toLowerCase();\n\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\testimate.estimate_number\n\t\t\t\t\t\t\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t\t\t\t\t\t\t.includes(query) ||\n\t\t\t\t\t\t\t\t\t\t\t\testimate.status.toLowerCase().includes(query) ||\n\t\t\t\t\t\t\t\t\t\t\t\testimate.customer?.name?.toLowerCase().includes(query)\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.map((estimate) => (\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tkey={estimate.id}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsLinking(true);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Optimistic update - add estimate to UI immediately\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst linkedEstimate = {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t...estimate,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tjob_id: job.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetEstimates([...estimates, linkedEstimate]);\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsLinkEstimateOpen(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetEstimateSearchQuery(\"\");\n\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst supabase = createClient();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst { error } = await supabase\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.from(\"estimates\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.update({ job_id: job.id })\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.eq(\"id\", estimate.id);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Rollback optimistic update\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetEstimates(estimates);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\"Failed to link estimate\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.success(\"Estimate linked successfully\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Rollback optimistic update\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetEstimates(estimates);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\"Failed to link estimate\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsLinking(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={isLinking}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full px-4 py-3 hover:bg-accent transition-colors text-left disabled:opacity-50 disabled:cursor-not-allowed\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{estimate.estimate_number}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"outline\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{estimate.status}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<User className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{estimate.customer?.name || \"No customer\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-right\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${(estimate.total_amount / 100).toFixed(2)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{new Date(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\testimate.created_at,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t).toLocaleDateString()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\tsetIsLinkEstimateOpen(false);\n\t\t\t\t\t\t\t\tsetEstimateSearchQuery(\"\");\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\tdisabled={isLinking}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t{/* Link Existing Invoice Dialog */}\n\t\t\t<Dialog onOpenChange={setIsLinkInvoiceOpen} open={isLinkInvoiceOpen}>\n\t\t\t\t<DialogContent className=\"sm:max-w-[700px]\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>Link Existing Invoice</DialogTitle>\n\t\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t\tSearch and select an invoice to link to this job. Only unlinked\n\t\t\t\t\t\t\tinvoices are shown.\n\t\t\t\t\t\t</DialogDescription>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tplaceholder=\"Search by invoice number, customer, or status...\"\n\t\t\t\t\t\t\t\tvalue={invoiceSearchQuery}\n\t\t\t\t\t\t\t\tonChange={(e) => setInvoiceSearchQuery(e.target.value)}\n\t\t\t\t\t\t\t\tclassName=\"pl-10\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<FileText className=\"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"border rounded-lg max-h-[400px] overflow-y-auto\">\n\t\t\t\t\t\t\t{availableInvoices.filter((invoice) => {\n\t\t\t\t\t\t\t\tif (!invoiceSearchQuery) return true;\n\t\t\t\t\t\t\t\tconst query = invoiceSearchQuery.toLowerCase();\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\tinvoice.invoice_number.toLowerCase().includes(query) ||\n\t\t\t\t\t\t\t\t\tinvoice.status.toLowerCase().includes(query) ||\n\t\t\t\t\t\t\t\t\tinvoice.customer?.name?.toLowerCase().includes(query)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}).length === 0 ? (\n\t\t\t\t\t\t\t\t<div className=\"flex flex-col items-center justify-center py-12 text-center\">\n\t\t\t\t\t\t\t\t\t<FileText className=\"h-12 w-12 text-muted-foreground/50 mb-3\" />\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tNo invoices found\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tTry adjusting your search\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<div className=\"divide-y\">\n\t\t\t\t\t\t\t\t\t{availableInvoices\n\t\t\t\t\t\t\t\t\t\t.filter((invoice) => {\n\t\t\t\t\t\t\t\t\t\t\tif (!invoiceSearchQuery) return true;\n\t\t\t\t\t\t\t\t\t\t\tconst query = invoiceSearchQuery.toLowerCase();\n\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\tinvoice.invoice_number.toLowerCase().includes(query) ||\n\t\t\t\t\t\t\t\t\t\t\t\tinvoice.status.toLowerCase().includes(query) ||\n\t\t\t\t\t\t\t\t\t\t\t\tinvoice.customer?.name?.toLowerCase().includes(query)\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.map((invoice) => (\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tkey={invoice.id}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsLinking(true);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Optimistic update - add invoice to UI immediately\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst linkedInvoice = { ...invoice, job_id: job.id };\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetInvoices([...invoices, linkedInvoice]);\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsLinkInvoiceOpen(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetInvoiceSearchQuery(\"\");\n\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst supabase = createClient();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst { error } = await supabase\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.from(\"invoices\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.update({ job_id: job.id })\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.eq(\"id\", invoice.id);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Rollback optimistic update\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetInvoices(invoices);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\"Failed to link invoice\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.success(\"Invoice linked successfully\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Rollback optimistic update\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetInvoices(invoices);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\"Failed to link invoice\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsLinking(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={isLinking}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full px-4 py-3 hover:bg-accent transition-colors text-left disabled:opacity-50 disabled:cursor-not-allowed\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{invoice.invoice_number}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"outline\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{invoice.status}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<User className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{invoice.customer?.name || \"No customer\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-right\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${(invoice.total_amount / 100).toFixed(2)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{new Date(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinvoice.created_at,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t).toLocaleDateString()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\tsetIsLinkInvoiceOpen(false);\n\t\t\t\t\t\t\t\tsetInvoiceSearchQuery(\"\");\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\tdisabled={isLinking}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t{/* Link Existing Payment Dialog */}\n\t\t\t<Dialog onOpenChange={setIsLinkPaymentOpen} open={isLinkPaymentOpen}>\n\t\t\t\t<DialogContent className=\"sm:max-w-[700px]\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>Link Existing Payment</DialogTitle>\n\t\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t\tSearch and select a payment to link to this job. Only unlinked\n\t\t\t\t\t\t\tpayments are shown.\n\t\t\t\t\t\t</DialogDescription>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tplaceholder=\"Search by reference, payment method, or customer...\"\n\t\t\t\t\t\t\t\tvalue={paymentSearchQuery}\n\t\t\t\t\t\t\t\tonChange={(e) => setPaymentSearchQuery(e.target.value)}\n\t\t\t\t\t\t\t\tclassName=\"pl-10\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<DollarSign className=\"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"border rounded-lg max-h-[400px] overflow-y-auto\">\n\t\t\t\t\t\t\t{availablePayments.filter((payment) => {\n\t\t\t\t\t\t\t\tif (!paymentSearchQuery) return true;\n\t\t\t\t\t\t\t\tconst query = paymentSearchQuery.toLowerCase();\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\tpayment.payment_method.toLowerCase().includes(query) ||\n\t\t\t\t\t\t\t\t\tpayment.reference_number?.toLowerCase().includes(query) ||\n\t\t\t\t\t\t\t\t\tpayment.customer?.name?.toLowerCase().includes(query)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}).length === 0 ? (\n\t\t\t\t\t\t\t\t<div className=\"flex flex-col items-center justify-center py-12 text-center\">\n\t\t\t\t\t\t\t\t\t<DollarSign className=\"h-12 w-12 text-muted-foreground/50 mb-3\" />\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tNo payments found\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tTry adjusting your search\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<div className=\"divide-y\">\n\t\t\t\t\t\t\t\t\t{availablePayments\n\t\t\t\t\t\t\t\t\t\t.filter((payment) => {\n\t\t\t\t\t\t\t\t\t\t\tif (!paymentSearchQuery) return true;\n\t\t\t\t\t\t\t\t\t\t\tconst query = paymentSearchQuery.toLowerCase();\n\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\tpayment.payment_method.toLowerCase().includes(query) ||\n\t\t\t\t\t\t\t\t\t\t\t\tpayment.reference_number\n\t\t\t\t\t\t\t\t\t\t\t\t\t?.toLowerCase()\n\t\t\t\t\t\t\t\t\t\t\t\t\t.includes(query) ||\n\t\t\t\t\t\t\t\t\t\t\t\tpayment.customer?.name?.toLowerCase().includes(query)\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.map((payment) => (\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tkey={payment.id}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsLinking(true);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Optimistic update - add payment to UI immediately\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst linkedPayment = { ...payment, job_id: job.id };\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetPayments([...payments, linkedPayment]);\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsLinkPaymentOpen(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetPaymentSearchQuery(\"\");\n\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst supabase = createClient();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst { error } = await supabase\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.from(\"payments\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.update({ job_id: job.id })\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.eq(\"id\", payment.id);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Rollback optimistic update\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetPayments(payments);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\"Failed to link payment\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.success(\"Payment linked successfully\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Rollback optimistic update\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetPayments(payments);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\"Failed to link payment\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsLinking(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={isLinking}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full px-4 py-3 hover:bg-accent transition-colors text-left disabled:opacity-50 disabled:cursor-not-allowed\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{payment.reference_number || \"No reference\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"outline\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{payment.payment_method}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<User className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{payment.customer?.name || \"No customer\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-right\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${(payment.amount / 100).toFixed(2)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{new Date(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpayment.created_at,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t).toLocaleDateString()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\tsetIsLinkPaymentOpen(false);\n\t\t\t\t\t\t\t\tsetPaymentSearchQuery(\"\");\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\tdisabled={isLinking}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t{/* Link Existing Equipment Dialog */}\n\t\t\t<Dialog onOpenChange={setIsLinkEquipmentOpen} open={isLinkEquipmentOpen}>\n\t\t\t\t<DialogContent className=\"sm:max-w-[700px]\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>Link Existing Equipment</DialogTitle>\n\t\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t\tSearch and link existing equipment to this job. Select equipment\n\t\t\t\t\t\t\tfrom the list below.\n\t\t\t\t\t\t</DialogDescription>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tplaceholder=\"Search by equipment name, category, or serial number...\"\n\t\t\t\t\t\t\t\tvalue={equipmentSearchQuery}\n\t\t\t\t\t\t\t\tonChange={(e) => setEquipmentSearchQuery(e.target.value)}\n\t\t\t\t\t\t\t\tclassName=\"pl-10\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Wrench className=\"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"border rounded-lg max-h-[400px] overflow-y-auto\">\n\t\t\t\t\t\t\t{availableEquipment.filter((equipment) => {\n\t\t\t\t\t\t\t\tif (!equipmentSearchQuery) return true;\n\t\t\t\t\t\t\t\tconst query = equipmentSearchQuery.toLowerCase();\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\tequipment.name.toLowerCase().includes(query) ||\n\t\t\t\t\t\t\t\t\tequipment.category?.toLowerCase().includes(query) ||\n\t\t\t\t\t\t\t\t\tequipment.serial_number?.toLowerCase().includes(query)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}).length === 0 ? (\n\t\t\t\t\t\t\t\t<div className=\"flex flex-col items-center justify-center py-12 text-center\">\n\t\t\t\t\t\t\t\t\t<Wrench className=\"h-12 w-12 text-muted-foreground/50 mb-4\" />\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground mb-2\">\n\t\t\t\t\t\t\t\t\t\tNo equipment found\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tTry adjusting your search terms or create new equipment from\n\t\t\t\t\t\t\t\t\t\tthe inventory section.\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\tavailableEquipment\n\t\t\t\t\t\t\t\t\t.filter((equipment) => {\n\t\t\t\t\t\t\t\t\t\tif (!equipmentSearchQuery) return true;\n\t\t\t\t\t\t\t\t\t\tconst query = equipmentSearchQuery.toLowerCase();\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\tequipment.name.toLowerCase().includes(query) ||\n\t\t\t\t\t\t\t\t\t\t\tequipment.category?.toLowerCase().includes(query) ||\n\t\t\t\t\t\t\t\t\t\t\tequipment.serial_number?.toLowerCase().includes(query)\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.map((equipment, index, filteredArray) => (\n\t\t\t\t\t\t\t\t\t\t<div key={equipment.id}>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsLinking(true);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Optimistic update - add equipment to UI immediately\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst newJobEquipment = {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: `temp-${Date.now()}`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompany_id: job.company_id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tjob_id: job.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tequipment_id: equipment.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tequipment: equipment,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tservice_type: null,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tservice_description: null,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thours_spent: null,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tparts_cost: null,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabor_cost: null,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcreated_at: new Date().toISOString(),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetJobEquipment([...jobEquipment, newJobEquipment]);\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsLinkEquipmentOpen(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetEquipmentSearchQuery(\"\");\n\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst supabase = createClient();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Check if equipment is already linked\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst { data: existing } = await supabase\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.from(\"job_equipment\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.select(\"id\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.eq(\"job_id\", job.id)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.eq(\"equipment_id\", equipment.id)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.single();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (existing) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Rollback optimistic update\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetJobEquipment(jobEquipment);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Equipment is already linked to this job\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsLinking(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Create junction table entry\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst { data, error } = await supabase\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.from(\"job_equipment\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.insert({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompany_id: job.company_id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjob_id: job.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tequipment_id: equipment.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.select(\"*, equipment:equipment_id(*)\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.single();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Rollback optimistic update\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetJobEquipment(jobEquipment);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\"Failed to link equipment\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Replace temp item with real data\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetJobEquipment((prev) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprev.map((je) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tje.id === newJobEquipment.id ? data : je,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.success(\"Equipment linked successfully\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Rollback optimistic update\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetJobEquipment(jobEquipment);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\"Failed to link equipment\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsLinking(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={isLinking}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full px-4 py-3 hover:bg-accent transition-colors text-left disabled:opacity-50 disabled:cursor-not-allowed\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold text-sm truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{equipment.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{equipment.category && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-xs shrink-0\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{equipment.category}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{equipment.serial_number && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Wrench className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSN: {equipment.serial_number}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-right shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{new Date(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tequipment.created_at,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t).toLocaleDateString()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t{index < filteredArray.length - 1 && (\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"border-b\" />\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t))\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</>\n\t) : (\n\t\t<div className=\"flex h-full w-full items-center justify-center\">\n\t\t\t<div className=\"text-center\">\n\t\t\t\t<p className=\"text-muted-foreground\">Job not found</p>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"40eb57a1f9934fba2c22b3de29e4218cdecdb2c7fe\":\"findOrCreateProperty\"},\"apps/web/src/actions/properties.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var findOrCreateProperty=/*#__PURE__*/createServerReference(\"40eb57a1f9934fba2c22b3de29e4218cdecdb2c7fe\",callServer,void 0,findSourceMapURL,\"findOrCreateProperty\");","/* __next_internal_action_entry_do_not_use__ [{\"40a1e566819b4396da142252edaf50170288a14a6c\":\"assignTeamMemberToJob\"},\"apps/web/src/actions/team-assignments.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var assignTeamMemberToJob=/*#__PURE__*/createServerReference(\"40a1e566819b4396da142252edaf50170288a14a6c\",callServer,void 0,findSourceMapURL,\"assignTeamMemberToJob\");","/* __next_internal_action_entry_do_not_use__ [{\"405f969e9bbc535ea0c4e0ca4ec86ab0b3985e2e0e\":\"removeTeamMemberFromJob\"},\"apps/web/src/actions/team-assignments.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var removeTeamMemberFromJob=/*#__PURE__*/createServerReference(\"405f969e9bbc535ea0c4e0ca4ec86ab0b3985e2e0e\",callServer,void 0,findSourceMapURL,\"removeTeamMemberFromJob\");","/**\n * SMS Dialog - Internal SMS composer using Twilio\n *\n * Features:\n * - Send SMS messages via Twilio\n * - Character counter\n * - Creates communication records\n * - Shows send status\n */\n\n\"use client\";\n\nimport { MessageSquare, Send } from \"lucide-react\";\nimport { useState, useTransition } from \"react\";\nimport { sendTextMessage } from \"@/actions/twilio\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDialog,\n\tDialogContent,\n\tDialogDescription,\n\tDialogHeader,\n\tDialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\nimport { StandardFormField } from \"@/components/ui/standard-form-field\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { CommunicationRecord, CompanyPhone } from \"@/types/communication\";\n\ntype SMSDialogProps = {\n\topen: boolean;\n\tonOpenChange: (open: boolean) => void;\n\tcustomerName: string;\n\tcustomerPhone: string;\n\tcompanyId: string;\n\tcustomerId?: string;\n\tcompanyPhones?: CompanyPhone[];\n\tjobId?: string;\n\tpropertyId?: string;\n\tinvoiceId?: string;\n\testimateId?: string;\n\tonCommunicationCreated?: (record: CommunicationRecord) => void;\n};\n\nexport function SMSDialog({\n\topen,\n\tonOpenChange,\n\tcustomerName,\n\tcustomerPhone,\n\tcustomerId,\n\tcompanyId,\n\tcompanyPhones = [],\n\tjobId,\n\tpropertyId,\n\tinvoiceId,\n\testimateId,\n\tonCommunicationCreated,\n}: SMSDialogProps) {\n\tconst { toast } = useToast();\n\tconst [isPending, startTransition] = useTransition();\n\tconst [message, setMessage] = useState(\"\");\n\tconst [selectedPhone, setSelectedPhone] = useState(\n\t\tcompanyPhones[0]?.number || \"\",\n\t);\n\n\t// SMS segment calculation - no max limit, just show segment count for cost awareness\n\tconst charCount = message.length;\n\tconst SMS_SEGMENT_LENGTH = 160;\n\tconst SMS_CONCAT_LENGTH = 153; // Concatenated messages use 153 chars per segment\n\tconst segmentCount =\n\t\tcharCount <= SMS_SEGMENT_LENGTH\n\t\t\t? charCount > 0\n\t\t\t\t? 1\n\t\t\t\t: 0\n\t\t\t: Math.ceil(charCount / SMS_CONCAT_LENGTH);\n\n\tconst handleSend = () => {\n\t\tif (!message.trim()) {\n\t\t\ttoast.error(\"Please enter a message to send\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (!selectedPhone) {\n\t\t\ttoast.error(\"Please select a company phone number to send from\");\n\t\t\treturn;\n\t\t}\n\n\t\tstartTransition(async () => {\n\t\t\tconst result = await sendTextMessage({\n\t\t\t\tto: customerPhone,\n\t\t\t\tfrom: selectedPhone,\n\t\t\t\ttext: message,\n\t\t\t\tcompanyId,\n\t\t\t\tcustomerId,\n\t\t\t\tjobId,\n\t\t\t\tpropertyId,\n\t\t\t\tinvoiceId,\n\t\t\t\testimateId,\n\t\t\t});\n\n\t\t\tif (result.success && \"data\" in result && result.data) {\n\t\t\t\ttoast.success(`Text message sent to ${customerName}`);\n\t\t\t\tonCommunicationCreated?.(result.data as CommunicationRecord);\n\t\t\t\tsetMessage(\"\");\n\t\t\t\tonOpenChange(false);\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to send text message\");\n\t\t\t}\n\t\t});\n\t};\n\n\treturn (\n\t\t<Dialog onOpenChange={onOpenChange} open={open}>\n\t\t\t<DialogContent className=\"sm:max-w-lg\">\n\t\t\t\t<DialogHeader>\n\t\t\t\t\t<DialogTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<MessageSquare className=\"size-5\" />\n\t\t\t\t\t\tSend Text Message\n\t\t\t\t\t</DialogTitle>\n\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\tSend an SMS message to {customerName}\n\t\t\t\t\t</DialogDescription>\n\t\t\t\t</DialogHeader>\n\n\t\t\t\t<div className=\"space-y-4 py-4\">\n\t\t\t\t\t{/* Recipient Info */}\n\t\t\t\t\t<div className=\"bg-muted/50 rounded-lg border p-3\">\n\t\t\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t\t\t<div className=\"bg-primary/10 text-primary flex size-10 items-center justify-center rounded-full text-sm font-semibold\">\n\t\t\t\t\t\t\t\t{customerName\n\t\t\t\t\t\t\t\t\t.split(\" \")\n\t\t\t\t\t\t\t\t\t.map((n) => n[0])\n\t\t\t\t\t\t\t\t\t.join(\"\")\n\t\t\t\t\t\t\t\t\t.toUpperCase()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t<div className=\"text-sm font-medium\">{customerName}</div>\n\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t{customerPhone}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* From Phone Selection */}\n\t\t\t\t\t{companyPhones.length > 0 ? (\n\t\t\t\t\t\t<StandardFormField label=\"Send From\" htmlFor=\"sms-from\">\n\t\t\t\t\t\t\t<Select onValueChange={setSelectedPhone} value={selectedPhone}>\n\t\t\t\t\t\t\t\t<SelectTrigger id=\"sms-from\">\n\t\t\t\t\t\t\t\t\t<SelectValue placeholder=\"Select a phone number\" />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{companyPhones.map((phone) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={phone.id} value={phone.number}>\n\t\t\t\t\t\t\t\t\t\t\t{phone.label || phone.number}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"border-warning bg-warning dark:border-warning dark:bg-warning rounded-lg border p-4 text-center\">\n\t\t\t\t\t\t\t<p className=\"text-warning dark:text-warning text-sm\">\n\t\t\t\t\t\t\t\tNo company phone numbers configured.\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<p className=\"text-warning dark:text-warning mt-1 text-xs\">\n\t\t\t\t\t\t\t\tPurchase or port a phone number from Settings → Phone Numbers\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Message Input */}\n\t\t\t\t\t<StandardFormField label=\"Message\" htmlFor=\"sms-message\">\n\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\tid=\"sms-message\"\n\t\t\t\t\t\t\tclassName=\"min-h-[120px] resize-y\"\n\t\t\t\t\t\t\tonChange={(e) => setMessage(e.target.value)}\n\t\t\t\t\t\t\tplaceholder=\"Type your message here...\"\n\t\t\t\t\t\t\tvalue={message}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div className=\"text-muted-foreground flex items-center justify-between text-xs\">\n\t\t\t\t\t\t\t<span>{charCount} characters</span>\n\t\t\t\t\t\t\t<span className={segmentCount > 1 ? \"text-amber-500\" : \"\"}>\n\t\t\t\t\t\t\t\t{segmentCount} SMS segment{segmentCount !== 1 ? \"s\" : \"\"}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</StandardFormField>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Actions */}\n\t\t\t\t<div className=\"flex items-center justify-end gap-2\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tdisabled={isPending}\n\t\t\t\t\t\tonClick={() => onOpenChange(false)}\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t>\n\t\t\t\t\t\tCancel\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\tisPending ||\n\t\t\t\t\t\t\t!message.trim() ||\n\t\t\t\t\t\t\t!selectedPhone ||\n\t\t\t\t\t\t\tcompanyPhones.length === 0\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonClick={handleSend}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Send className=\"mr-2 size-4\" />\n\t\t\t\t\t\t{companyPhones.length === 0 ? \"No Phone Numbers\" : \"Send Message\"}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"40a35fabcf9fab7f37542e9d8229f90df15a009759\":\"getCustomerProperties\"},\"apps/web/src/queries/customers-search.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var getCustomerProperties=/*#__PURE__*/createServerReference(\"40a35fabcf9fab7f37542e9d8229f90df15a009759\",callServer,void 0,findSourceMapURL,\"getCustomerProperties\");","/* __next_internal_action_entry_do_not_use__ [{\"40e06ac20288f5e0be3e696023f5b4ae097546a4d0\":\"searchCustomersForJob\"},\"apps/web/src/queries/customers-search.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var searchCustomersForJob=/*#__PURE__*/createServerReference(\"40e06ac20288f5e0be3e696023f5b4ae097546a4d0\",callServer,void 0,findSourceMapURL,\"searchCustomersForJob\");","\"use client\";\n\n/**\n * AI Job Assistant Header\n *\n * Seamlessly integrated intelligent insights without AI branding.\n * Clean, minimal design matching existing UI patterns.\n */\n\nimport {\n\tAlertCircle,\n\tArrowRight,\n\tCheckCircle,\n\tClock,\n\tDollarSign,\n\tLightbulb,\n\tTrendingUp,\n\tZap,\n} from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { formatCurrency } from \"@/lib/formatters\";\n\ninterface AIJobAssistantHeaderProps {\n\tjob: any;\n\tcustomer: any | null;\n\tproperty: any | null;\n\tmetrics: any;\n\tteamAssignments: any[];\n\ttimeEntries: any[];\n\tinvoices: any[];\n\tpayments: any[];\n\testimates: any[];\n\tuserRole?: string;\n\tonTitleChange: (value: string) => void;\n\tonSave?: () => void;\n\tonCancel?: () => void;\n\tisSaving?: boolean;\n\thasChanges?: boolean;\n}\n\ninterface AIInsight {\n\ttype: \"critical\" | \"warning\" | \"info\" | \"success\";\n\ticon: React.ReactNode;\n\ttitle: string;\n\tmessage: string;\n\taction?: {\n\t\tlabel: string;\n\t\thref?: string;\n\t\tonClick?: () => void;\n\t};\n}\n\nexport function AIJobAssistantHeader({\n\tjob,\n\tcustomer,\n\tproperty,\n\tmetrics,\n\tteamAssignments,\n\ttimeEntries,\n\tinvoices,\n\tpayments,\n\testimates,\n\tuserRole = \"owner\",\n\tonTitleChange,\n\tonSave,\n\tonCancel,\n\tisSaving = false,\n\thasChanges = false,\n}: AIJobAssistantHeaderProps) {\n\tconst [insights, setInsights] = useState<AIInsight[]>([]);\n\n\tuseEffect(() => {\n\t\tconst generatedInsights = generateInsights({\n\t\t\tjob,\n\t\t\tcustomer,\n\t\t\tproperty,\n\t\t\tmetrics,\n\t\t\tteamAssignments,\n\t\t\ttimeEntries,\n\t\t\tinvoices,\n\t\t\tpayments,\n\t\t\testimates,\n\t\t\tuserRole,\n\t\t});\n\n\t\tsetInsights(generatedInsights);\n\t}, [\n\t\tjob.id,\n\t\tjob.status,\n\t\tjob.priority,\n\t\tcustomer?.id,\n\t\tmetrics.totalAmount,\n\t\tmetrics.paidAmount,\n\t\tteamAssignments.length,\n\t\tinvoices.length,\n\t\tuserRole,\n\t]);\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t{/* Title Row */}\n\t\t\t<div className=\"flex items-start gap-4\">\n\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t<Input\n\t\t\t\t\t\tclassName=\"h-auto border-0 bg-transparent p-0 text-2xl font-bold tracking-tight shadow-none focus-visible:ring-0 md:text-3xl\"\n\t\t\t\t\t\tonChange={(e) => onTitleChange(e.target.value)}\n\t\t\t\t\t\tplaceholder=\"Enter job title...\"\n\t\t\t\t\t\tvalue={job.title}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"mt-2 flex flex-wrap items-center gap-2\">\n\t\t\t\t\t\t<Badge variant=\"secondary\" className=\"font-mono text-xs\">\n\t\t\t\t\t\t\t#{job.job_number}\n\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\tvariant={getStatusVariant(job.status)}\n\t\t\t\t\t\t\tclassName=\"capitalize\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{job.status?.replace(/_/g, \" \")}\n\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t{job.priority && job.priority !== \"low\" && (\n\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\tvariant={getPriorityVariant(job.priority)}\n\t\t\t\t\t\t\t\tclassName=\"capitalize\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{job.priority}\n\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Save/Cancel Buttons */}\n\t\t\t\t{hasChanges && (\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Button variant=\"outline\" size=\"sm\" onClick={onCancel}>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button size=\"sm\" onClick={onSave} disabled={isSaving}>\n\t\t\t\t\t\t\t{isSaving ? \"Saving...\" : \"Save Changes\"}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\n\t\t\t{/* Insights - Only show if there are any */}\n\t\t\t{insights.length > 0 && (\n\t\t\t\t<>\n\t\t\t\t\t<Separator />\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t{insights.map((insight, index) => (\n\t\t\t\t\t\t\t<InsightAlert key={index} insight={insight} />\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n\nfunction InsightAlert({ insight }: { insight: AIInsight }) {\n\tconst getVariant = (type: AIInsight[\"type\"]) => {\n\t\tswitch (type) {\n\t\t\tcase \"critical\":\n\t\t\t\treturn \"destructive\";\n\t\t\tcase \"warning\":\n\t\t\t\treturn \"default\";\n\t\t\tdefault:\n\t\t\t\treturn \"default\";\n\t\t}\n\t};\n\n\tconst getIconColor = (type: AIInsight[\"type\"]) => {\n\t\tswitch (type) {\n\t\t\tcase \"critical\":\n\t\t\t\treturn \"text-destructive\";\n\t\t\tcase \"warning\":\n\t\t\t\treturn \"text-yellow-600 dark:text-yellow-400\";\n\t\t\tcase \"success\":\n\t\t\t\treturn \"text-green-600 dark:text-green-400\";\n\t\t\tdefault:\n\t\t\t\treturn \"text-blue-600 dark:text-blue-400\";\n\t\t}\n\t};\n\n\treturn (\n\t\t<Alert variant={getVariant(insight.type)} className=\"relative\">\n\t\t\t<div className=\"flex items-start gap-3\">\n\t\t\t\t<div className={`mt-0.5 shrink-0 ${getIconColor(insight.type)}`}>\n\t\t\t\t\t{insight.icon}\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex-1 min-w-0 space-y-1\">\n\t\t\t\t\t<div className=\"font-semibold text-sm leading-tight\">\n\t\t\t\t\t\t{insight.title}\n\t\t\t\t\t</div>\n\t\t\t\t\t<AlertDescription className=\"text-xs leading-relaxed\">\n\t\t\t\t\t\t{insight.message}\n\t\t\t\t\t</AlertDescription>\n\t\t\t\t\t{insight.action && (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"link\"\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tclassName=\"h-auto p-0 text-xs gap-1\"\n\t\t\t\t\t\t\tonClick={insight.action.onClick}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{insight.action.label}\n\t\t\t\t\t\t\t<ArrowRight className=\"h-3 w-3\" />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Alert>\n\t);\n}\n\n/**\n * Generate insights based on job context\n */\nfunction generateInsights(context: {\n\tjob: any;\n\tcustomer: any;\n\tproperty: any;\n\tmetrics: any;\n\tteamAssignments: any[];\n\ttimeEntries: any[];\n\tinvoices: any[];\n\tpayments: any[];\n\testimates: any[];\n\tuserRole: string;\n}): AIInsight[] {\n\tconst {\n\t\tjob,\n\t\tcustomer,\n\t\tmetrics,\n\t\tteamAssignments,\n\t\ttimeEntries,\n\t\tinvoices,\n\t\tpayments,\n\t\testimates,\n\t\tuserRole,\n\t} = context;\n\n\tconst insights: AIInsight[] = [];\n\tconst now = new Date();\n\n\t// Safely calculate total due (metrics are in cents)\n\tconst totalDue = (metrics.totalAmount || 0) - (metrics.paidAmount || 0);\n\n\t// Calculate key metrics\n\tconst scheduledStart = job.scheduled_start\n\t\t? new Date(job.scheduled_start)\n\t\t: null;\n\tconst isOverdue =\n\t\tscheduledStart && scheduledStart < now && job.status !== \"completed\";\n\n\tconst overdueInvoices = invoices.filter((inv: any) => {\n\t\tconst dueDate = inv.due_date ? new Date(inv.due_date) : null;\n\t\treturn dueDate && dueDate < now && inv.status !== \"paid\";\n\t});\n\n\t// Critical: Overdue Job\n\tif (isOverdue && teamAssignments.length === 0) {\n\t\tconst hoursOverdue = Math.floor(\n\t\t\t(now.getTime() - scheduledStart!.getTime()) / (1000 * 60 * 60),\n\t\t);\n\n\t\tinsights.push({\n\t\t\ttype: \"critical\",\n\t\t\ticon: <AlertCircle className=\"h-4 w-4\" />,\n\t\t\ttitle: `Job Overdue by ${hoursOverdue} hours`,\n\t\t\tmessage:\n\t\t\t\tuserRole === \"dispatcher\"\n\t\t\t\t\t? `This job was scheduled ${hoursOverdue}h ago but no technician is assigned. Dispatch protocol requires immediate assignment for jobs overdue by more than 2 hours.`\n\t\t\t\t\t: `This job is ${hoursOverdue} hours overdue. Company policy requires immediate action for jobs past their scheduled time. Contact dispatch or reassign technicians.`,\n\t\t\taction: {\n\t\t\t\tlabel: \"Assign Technician\",\n\t\t\t\tonClick: () => {\n\t\t\t\t\t// Scroll to team assignment section\n\t\t\t\t\tconst element = document.querySelector(\n\t\t\t\t\t\t'[data-section=\"team-assignments\"]',\n\t\t\t\t\t);\n\t\t\t\t\telement?.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t// Critical: Overdue Payment (30+ days)\n\tif (overdueInvoices.length > 0 && totalDue > 0) {\n\t\tconst oldestInvoice = overdueInvoices.reduce((oldest: any, inv: any) => {\n\t\t\tconst invDue = new Date(inv.due_date);\n\t\t\tconst oldestDue = new Date(oldest.due_date);\n\t\t\treturn invDue < oldestDue ? inv : oldest;\n\t\t});\n\n\t\tconst daysOverdue = Math.floor(\n\t\t\t(now.getTime() - new Date(oldestInvoice.due_date).getTime()) /\n\t\t\t\t(1000 * 60 * 60 * 24),\n\t\t);\n\n\t\tif (daysOverdue >= 30) {\n\t\t\tinsights.push({\n\t\t\t\ttype: \"critical\",\n\t\t\t\ticon: <DollarSign className=\"h-4 w-4\" />,\n\t\t\t\ttitle: `Outstanding Balance: ${formatCurrency(totalDue)} (${daysOverdue} days overdue)`,\n\t\t\t\tmessage:\n\t\t\t\t\tuserRole === \"owner\" || userRole === \"manager\"\n\t\t\t\t\t\t? `Company policy requires escalation for accounts 30+ days past due. The balance of ${formatCurrency(totalDue)} has been outstanding since ${new Date(oldestInvoice.due_date).toLocaleDateString()}. Consider collection agency referral or payment plan negotiation.`\n\t\t\t\t\t\t: `This account is ${daysOverdue} days past due. Per company policy, accounts over 30 days require manager approval before scheduling additional work. Contact management before proceeding.`,\n\t\t\t\taction: {\n\t\t\t\t\tlabel: \"View Invoices\",\n\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\tconst element = document.querySelector('[data-section=\"invoices\"]');\n\t\t\t\t\t\telement?.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t} else if (daysOverdue >= 15) {\n\t\t\tinsights.push({\n\t\t\t\ttype: \"warning\",\n\t\t\t\ticon: <Clock className=\"h-4 w-4\" />,\n\t\t\t\ttitle: `Payment Overdue: ${formatCurrency(totalDue)} (${daysOverdue} days)`,\n\t\t\t\tmessage: `Customer has an outstanding balance ${daysOverdue} days past due. Company policy recommends friendly follow-up call at 15 days. Consider offering payment plan or checking if there are service quality concerns.`,\n\t\t\t\taction: {\n\t\t\t\t\tlabel: \"Send Payment Reminder\",\n\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t// Open payment reminder dialog\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\t// Warning: High-Value Job Without Estimate\n\tconst estimatedValue = metrics.totalAmount || 0;\n\tif (estimatedValue > 500000 && estimates.length === 0) {\n\t\t// $5000 in cents\n\t\tinsights.push({\n\t\t\ttype: \"warning\",\n\t\t\ticon: <Lightbulb className=\"h-4 w-4\" />,\n\t\t\ttitle: \"High-Value Job Without Approved Estimate\",\n\t\t\tmessage:\n\t\t\t\tuserRole === \"technician\"\n\t\t\t\t\t? \"Company policy requires written estimates for jobs over $5,000 before work begins. Ensure you have customer approval documented before proceeding with any repairs or installations.\"\n\t\t\t\t\t: `This is a high-value job (potential revenue ${formatCurrency(estimatedValue)}) with no estimate on file. Best practice is to provide detailed written estimates for all jobs exceeding $5,000 to protect both the company and customer.`,\n\t\t\taction: {\n\t\t\t\tlabel: \"Create Estimate\",\n\t\t\t\tonClick: () => {\n\t\t\t\t\t// Navigate to estimate creation\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t// Info: VIP Customer\n\tconst customerLifetimeValue = (customer?.total_revenue || 0) * 100; // Convert to cents\n\tif (customerLifetimeValue > 1000000) {\n\t\t// $10,000 in cents\n\t\tinsights.push({\n\t\t\ttype: \"success\",\n\t\t\ticon: <TrendingUp className=\"h-4 w-4\" />,\n\t\t\ttitle: `VIP Customer: ${formatCurrency(customerLifetimeValue)} Lifetime Value`,\n\t\t\tmessage: `${customer?.display_name || customer?.first_name + \" \" + customer?.last_name} is a high-value customer with ${formatCurrency(customerLifetimeValue)} in total revenue. Prioritize excellent service and consider offering loyalty perks or discounts on future work.`,\n\t\t\taction: {\n\t\t\t\tlabel: \"View Customer History\",\n\t\t\t\tonClick: () => {\n\t\t\t\t\twindow.location.href = `/dashboard/customers/${customer?.id}`;\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t// Info: Active Time Entry\n\tconst activeEntry = timeEntries.find(\n\t\t(entry: any) => entry.clock_in_time && !entry.clock_out_time,\n\t);\n\tif (activeEntry) {\n\t\tconst clockInTime = new Date(activeEntry.clock_in_time);\n\t\tconst hoursWorked =\n\t\t\t(now.getTime() - clockInTime.getTime()) / (1000 * 60 * 60);\n\n\t\tinsights.push({\n\t\t\ttype: \"info\",\n\t\t\ticon: <Zap className=\"h-4 w-4\" />,\n\t\t\ttitle: \"Job In Progress\",\n\t\t\tmessage:\n\t\t\t\tuserRole === \"technician\"\n\t\t\t\t\t? `You've been clocked in for ${hoursWorked.toFixed(1)} hours. Remember to clock out when complete and document all parts used and work performed.`\n\t\t\t\t\t: `Technician currently on-site and clocked in for ${hoursWorked.toFixed(1)} hours. Real-time updates available in team tracking.`,\n\t\t\taction: {\n\t\t\t\tlabel: \"View Time Entries\",\n\t\t\t\tonClick: () => {\n\t\t\t\t\tconst element = document.querySelector(\n\t\t\t\t\t\t'[data-section=\"time-entries\"]',\n\t\t\t\t\t);\n\t\t\t\t\telement?.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t// Success: Recent Payment\n\tif (payments.length > 0) {\n\t\tconst recentPayment = payments[0]; // Assuming sorted by date\n\t\tconst paymentDate = new Date(\n\t\t\trecentPayment.payment_date || recentPayment.created_at,\n\t\t);\n\t\tconst daysAgo = Math.floor(\n\t\t\t(now.getTime() - paymentDate.getTime()) / (1000 * 60 * 60 * 24),\n\t\t);\n\n\t\tif (daysAgo <= 7) {\n\t\t\tinsights.push({\n\t\t\t\ttype: \"success\",\n\t\t\t\ticon: <CheckCircle className=\"h-4 w-4\" />,\n\t\t\t\ttitle: \"Recent Payment Received\",\n\t\t\t\tmessage: `Customer paid ${formatCurrency(recentPayment.amount)} ${daysAgo === 0 ? \"today\" : daysAgo + \" days ago\"}. Account is in good standing. Consider following up to ensure satisfaction and request a review.`,\n\t\t\t\taction: {\n\t\t\t\t\tlabel: \"Send Review Request\",\n\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t// Open review request dialog\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\t// Role-Specific Insights\n\tif (\n\t\tuserRole === \"dispatcher\" &&\n\t\tteamAssignments.length === 0 &&\n\t\tjob.status === \"scheduled\"\n\t) {\n\t\tinsights.push({\n\t\t\ttype: \"warning\",\n\t\t\ticon: <Clock className=\"h-4 w-4\" />,\n\t\t\ttitle: \"Technician Assignment Required\",\n\t\t\tmessage:\n\t\t\t\t\"This job is scheduled but has no technician assigned. Dispatch protocol requires all scheduled jobs to have team assignments at least 24 hours in advance for route optimization.\",\n\t\t\taction: {\n\t\t\t\tlabel: \"Assign Team\",\n\t\t\t\tonClick: () => {\n\t\t\t\t\tconst element = document.querySelector(\n\t\t\t\t\t\t'[data-section=\"team-assignments\"]',\n\t\t\t\t\t);\n\t\t\t\t\telement?.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tif (\n\t\tuserRole === \"technician\" &&\n\t\tjob.status === \"in_progress\" &&\n\t\t!activeEntry\n\t) {\n\t\tinsights.push({\n\t\t\ttype: \"warning\",\n\t\t\ticon: <Clock className=\"h-4 w-4\" />,\n\t\t\ttitle: \"Clock-In Reminder\",\n\t\t\tmessage:\n\t\t\t\t\"This job is marked as 'In Progress' but you haven't clocked in yet. Company policy requires accurate time tracking for all billable hours. Please clock in before starting work.\",\n\t\t\taction: {\n\t\t\t\tlabel: \"Clock In Now\",\n\t\t\t\tonClick: () => {\n\t\t\t\t\t// Open clock in dialog\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\treturn insights;\n}\n\n// Helper functions\nfunction getStatusVariant(\n\tstatus: string,\n): \"default\" | \"secondary\" | \"destructive\" | \"outline\" {\n\tswitch (status?.toLowerCase()) {\n\t\tcase \"completed\":\n\t\tcase \"paid\":\n\t\t\treturn \"default\";\n\t\tcase \"in_progress\":\n\t\tcase \"scheduled\":\n\t\t\treturn \"secondary\";\n\t\tcase \"overdue\":\n\t\tcase \"cancelled\":\n\t\tcase \"urgent\":\n\t\t\treturn \"destructive\";\n\t\tdefault:\n\t\t\treturn \"outline\";\n\t}\n}\n\nfunction getPriorityVariant(\n\tpriority: string,\n): \"default\" | \"destructive\" | \"outline\" {\n\tif (priority === \"urgent\" || priority === \"high\") return \"destructive\";\n\treturn \"outline\";\n}\n","\"use client\";\n\nimport { Camera, Check, FileText, Upload, X } from \"lucide-react\";\nimport Image from \"next/image\";\nimport { useCallback, useState } from \"react\";\nimport { uploadDocument } from \"@/actions/documents\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { PhotoCategory } from \"./photo-types\";\n\ntype PhotoFile = {\n\tid: string;\n\tfile: File;\n\tpreview: string;\n\tcategory: PhotoCategory;\n\tcaption: string;\n\tisDocument: boolean;\n};\n\ntype InlinePhotoUploaderProps = {\n\tjobId: string;\n\tcompanyId: string;\n\tonUploadComplete?: () => void;\n\tonCancel?: () => void;\n};\n\nconst ACCEPTED_FILE_TYPES = {\n\t\"image/jpeg\": [\".jpg\", \".jpeg\"],\n\t\"image/png\": [\".png\"],\n\t\"image/heic\": [\".heic\"],\n\t\"image/heif\": [\".heif\"],\n\t\"image/webp\": [\".webp\"],\n\t\"image/gif\": [\".gif\"],\n\t\"image/bmp\": [\".bmp\"],\n\t\"image/tiff\": [\".tiff\", \".tif\"],\n\t\"application/pdf\": [\".pdf\"],\n\t\"application/msword\": [\".doc\"],\n\t\"application/vnd.openxmlformats-officedocument.wordprocessingml.document\": [\n\t\t\".docx\",\n\t],\n\t\"application/vnd.ms-excel\": [\".xls\"],\n\t\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\": [\n\t\t\".xlsx\",\n\t],\n\t\"text/plain\": [\".txt\"],\n\t\"text/csv\": [\".csv\"],\n};\n\nconst MAX_FILE_SIZE = 100 * 1024 * 1024;\n\nexport function InlinePhotoUploader({\n\tjobId,\n\tcompanyId,\n\tonUploadComplete,\n\tonCancel,\n}: InlinePhotoUploaderProps) {\n\tconst { toast } = useToast();\n\tconst [files, setFiles] = useState<PhotoFile[]>([]);\n\tconst [isUploading, setIsUploading] = useState(false);\n\tconst [uploadProgress, setUploadProgress] = useState(0);\n\n\tconst generateId = () => Math.random().toString(36).substring(2, 15);\n\tconst isImageFile = (mimeType: string): boolean =>\n\t\tmimeType.startsWith(\"image/\");\n\n\tconst validateFile = (file: File): string | null => {\n\t\tconst fileType = file.type;\n\t\tconst acceptedTypes = Object.keys(ACCEPTED_FILE_TYPES);\n\t\tif (!acceptedTypes.includes(fileType)) {\n\t\t\treturn `${file.name}: Unsupported file type`;\n\t\t}\n\t\tif (file.size > MAX_FILE_SIZE) {\n\t\t\treturn `${file.name}: Too large (max 100MB)`;\n\t\t}\n\t\treturn null;\n\t};\n\n\tconst processFiles = useCallback(\n\t\t(fileList: FileList | null) => {\n\t\t\tif (!fileList) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst newFiles: PhotoFile[] = [];\n\t\t\tconst errors: string[] = [];\n\n\t\t\tArray.from(fileList).forEach((file) => {\n\t\t\t\tconst error = validateFile(file);\n\t\t\t\tif (error) {\n\t\t\t\t\terrors.push(error);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst preview = URL.createObjectURL(file);\n\t\t\t\tconst isDoc = !isImageFile(file.type);\n\n\t\t\t\tnewFiles.push({\n\t\t\t\t\tid: generateId(),\n\t\t\t\t\tfile,\n\t\t\t\t\tpreview,\n\t\t\t\t\tcategory: \"other\",\n\t\t\t\t\tcaption: \"\",\n\t\t\t\t\tisDocument: isDoc,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif (errors.length > 0) {\n\t\t\t\ttoast.error(`Some files couldn't be added: ${errors.join(\", \")}`);\n\t\t\t}\n\n\t\t\tsetFiles((prev) => [...prev, ...newFiles]);\n\t\t},\n\t\t[toast, generateId, isImageFile, validateFile],\n\t);\n\n\tconst handleFileInput = (e: React.ChangeEvent<HTMLInputElement>) => {\n\t\tprocessFiles(e.target.files);\n\t\te.target.value = \"\";\n\t};\n\n\tconst removeFile = (id: string) => {\n\t\tsetFiles((prev) => {\n\t\t\tconst file = prev.find((f) => f.id === id);\n\t\t\tif (file) {\n\t\t\t\tURL.revokeObjectURL(file.preview);\n\t\t\t}\n\t\t\treturn prev.filter((f) => f.id !== id);\n\t\t});\n\t};\n\n\tconst updateFileCategory = (id: string, category: PhotoCategory) => {\n\t\tsetFiles((prev) => prev.map((f) => (f.id === id ? { ...f, category } : f)));\n\t};\n\n\tconst updateFileCaption = (id: string, caption: string) => {\n\t\tsetFiles((prev) => prev.map((f) => (f.id === id ? { ...f, caption } : f)));\n\t};\n\n\tconst handleUpload = async () => {\n\t\tif (files.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsUploading(true);\n\t\tsetUploadProgress(0);\n\n\t\ttry {\n\t\t\tlet successCount = 0;\n\t\t\tlet errorCount = 0;\n\n\t\t\tfor (let i = 0; i < files.length; i++) {\n\t\t\t\tconst photoFile = files[i];\n\n\t\t\t\ttry {\n\t\t\t\t\tconst formData = new FormData();\n\t\t\t\t\tformData.append(\"file\", photoFile.file);\n\t\t\t\t\tformData.append(\"companyId\", companyId);\n\t\t\t\t\tformData.append(\"contextType\", \"job\");\n\t\t\t\t\tformData.append(\"contextId\", jobId);\n\n\t\t\t\t\t// Add folder based on file type\n\t\t\t\t\tif (photoFile.isDocument) {\n\t\t\t\t\t\tformData.append(\"folder\", \"documents\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tformData.append(\"folder\", \"photos\");\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add description if provided\n\t\t\t\t\tif (photoFile.caption) {\n\t\t\t\t\t\tformData.append(\"description\", photoFile.caption);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add category as a tag\n\t\t\t\t\tif (photoFile.category) {\n\t\t\t\t\t\tformData.append(\"tags\", JSON.stringify([photoFile.category]));\n\t\t\t\t\t}\n\n\t\t\t\t\tconst result = await uploadDocument(formData);\n\n\t\t\t\t\tif (result?.success) {\n\t\t\t\t\t\tsuccessCount++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\terrorCount++;\n\t\t\t\t\t\tconst errorMessage = result?.error || \"Unknown error\";\n\n\t\t\t\t\t\t// Show specific error messages\n\t\t\t\t\t\tif (errorMessage.includes(\"Access denied\")) {\n\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t`Access denied for ${photoFile.file.name}. Please verify you have permission to upload files to this job.`,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else if (errorMessage.includes(\"Storage upload failed\")) {\n\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t`Storage error for ${photoFile.file.name}. The file may be too large or the storage service is unavailable.`,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t`Failed to upload ${photoFile.file.name}: ${errorMessage}`,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\terrorCount++;\n\t\t\t\t\tconst errorMessage =\n\t\t\t\t\t\terror instanceof Error ? error.message : String(error);\n\n\t\t\t\t\t// Handle different error types\n\t\t\t\t\tif (errorMessage.includes(\"unexpected response\")) {\n\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t`Server error uploading ${photoFile.file.name}. Please try again or contact support if the problem persists.`,\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t`Error uploading ${photoFile.file.name}: ${errorMessage}`,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsetUploadProgress(Math.round(((i + 1) / files.length) * 100));\n\t\t\t}\n\n\t\t\tif (successCount > 0) {\n\t\t\t\ttoast.success(\n\t\t\t\t\t`Successfully uploaded ${successCount} ${successCount === 1 ? \"file\" : \"files\"}${errorCount > 0 ? ` (${errorCount} failed)` : \"\"}`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (errorCount > 0 && successCount === 0) {\n\t\t\t\ttoast.error(\n\t\t\t\t\t\"All uploads failed. Please check your permissions and try again.\",\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Clean up object URLs\n\t\t\tfiles.forEach((file) => URL.revokeObjectURL(file.preview));\n\n\t\t\t// Reset state\n\t\t\tsetFiles([]);\n\n\t\t\t// Call completion callback\n\t\t\tif (onUploadComplete) {\n\t\t\t\tonUploadComplete();\n\t\t\t}\n\n\t\t\t// Close uploader\n\t\t\tif (onCancel) {\n\t\t\t\tsetTimeout(() => onCancel(), 100);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconst errorMessage =\n\t\t\t\terror instanceof Error ? error.message : \"Failed to upload files\";\n\t\t\ttoast.error(errorMessage);\n\t\t} finally {\n\t\t\tsetIsUploading(false);\n\t\t\tsetUploadProgress(0);\n\t\t}\n\t};\n\n\tconst formatFileSize = (bytes: number): string => {\n\t\tif (bytes < 1024) {\n\t\t\treturn `${bytes} B`;\n\t\t}\n\t\tif (bytes < 1024 * 1024) {\n\t\t\treturn `${(bytes / 1024).toFixed(1)} KB`;\n\t\t}\n\t\treturn `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n\t};\n\n\treturn (\n\t\t<div className=\"bg-muted/30 space-y-3 rounded-lg border p-4\">\n\t\t\t{/* Quick Upload Zone */}\n\t\t\t<div className=\"relative\">\n\t\t\t\t<input\n\t\t\t\t\taccept={Object.values(ACCEPTED_FILE_TYPES).flat().join(\",\")}\n\t\t\t\t\tclassName=\"absolute inset-0 cursor-pointer opacity-0\"\n\t\t\t\t\tid=\"inline-file-upload\"\n\t\t\t\t\tmultiple\n\t\t\t\t\tonChange={handleFileInput}\n\t\t\t\t\ttype=\"file\"\n\t\t\t\t/>\n\t\t\t\t<div className=\"border-muted-foreground/25 bg-background hover:border-muted-foreground/50 flex items-center gap-3 rounded-md border-2 border-dashed p-3\">\n\t\t\t\t\t<div className=\"flex gap-1\">\n\t\t\t\t\t\t<div className=\"bg-primary/10 flex size-8 items-center justify-center rounded\">\n\t\t\t\t\t\t\t<Camera className=\"text-primary size-4\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"bg-primary/10 flex size-8 items-center justify-center rounded\">\n\t\t\t\t\t\t\t<FileText className=\"text-primary size-4\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t<p className=\"text-sm font-medium\">Click or drag files here</p>\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\tImages & documents up to 100MB\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<Upload className=\"text-muted-foreground size-5\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Selected Files */}\n\t\t\t{files.length > 0 && (\n\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t<span className=\"text-sm font-medium\">\n\t\t\t\t\t\t\t{files.length} file{files.length !== 1 ? \"s\" : \"\"} selected\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tonClick={() => files.forEach((f) => removeFile(f.id))}\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tClear all\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div className=\"grid gap-2\">\n\t\t\t\t\t\t{files.map((photoFile) => (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName=\"bg-background flex items-center gap-3 rounded-md border p-2\"\n\t\t\t\t\t\t\t\tkey={photoFile.id}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{/* Thumbnail */}\n\t\t\t\t\t\t\t\t<div className=\"bg-muted relative size-12 shrink-0 overflow-hidden rounded\">\n\t\t\t\t\t\t\t\t\t{photoFile.isDocument ? (\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex size-full items-center justify-center\">\n\t\t\t\t\t\t\t\t\t\t\t<FileText className=\"text-muted-foreground size-6\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\t\talt={photoFile.file.name}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"object-cover\"\n\t\t\t\t\t\t\t\t\t\t\tfill\n\t\t\t\t\t\t\t\t\t\t\tsrc={photoFile.preview}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{/* Details */}\n\t\t\t\t\t\t\t\t<div className=\"flex min-w-0 flex-1 items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t<p className=\"truncate text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t{photoFile.file.name}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{formatFileSize(photoFile.file.size)}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{/* Category */}\n\t\t\t\t\t\t\t\t\t<Select\n\t\t\t\t\t\t\t\t\t\tonValueChange={(value) =>\n\t\t\t\t\t\t\t\t\t\t\tupdateFileCategory(photoFile.id, value as PhotoCategory)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tvalue={photoFile.category}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<SelectTrigger className=\"h-7 w-24 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t\t\t<SelectItem value=\"before\">Before</SelectItem>\n\t\t\t\t\t\t\t\t\t\t\t<SelectItem value=\"during\">During</SelectItem>\n\t\t\t\t\t\t\t\t\t\t\t<SelectItem value=\"after\">After</SelectItem>\n\t\t\t\t\t\t\t\t\t\t\t<SelectItem value=\"other\">Other</SelectItem>\n\t\t\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t\t\t</Select>\n\n\t\t\t\t\t\t\t\t\t{/* Caption */}\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-7 w-32 text-xs\"\n\t\t\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\t\t\tupdateFileCaption(photoFile.id, e.target.value)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Caption\"\n\t\t\t\t\t\t\t\t\t\tvalue={photoFile.caption}\n\t\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t\t{/* Remove */}\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tclassName=\"size-7 p-0\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => removeFile(photoFile.id)}\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<X className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Upload Progress */}\n\t\t\t\t\t{isUploading && (\n\t\t\t\t\t\t<div className=\"space-y-1\">\n\t\t\t\t\t\t\t<div className=\"flex items-center justify-between text-xs\">\n\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">Uploading...</span>\n\t\t\t\t\t\t\t\t<span className=\"font-medium\">{uploadProgress}%</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"bg-muted h-1.5 overflow-hidden rounded-full\">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclassName=\"bg-primary h-full transition-all duration-300\"\n\t\t\t\t\t\t\t\t\tstyle={{ width: `${uploadProgress}%` }}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Actions */}\n\t\t\t\t\t<div className=\"flex justify-end gap-2\">\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isUploading}\n\t\t\t\t\t\t\tonClick={onCancel}\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={files.length === 0 || isUploading}\n\t\t\t\t\t\t\tonClick={handleUpload}\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{isUploading ? (\n\t\t\t\t\t\t\t\t<>Uploading...</>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<Check className=\"mr-1 size-4\" />\n\t\t\t\t\t\t\t\t\tUpload {files.length} {files.length === 1 ? \"File\" : \"Files\"}\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"40854f75e9b50a343151f59f130a2b38d041769af5\":\"uploadDocument\"},\"apps/web/src/actions/documents.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var uploadDocument=/*#__PURE__*/createServerReference(\"40854f75e9b50a343151f59f130a2b38d041769af5\",callServer,void 0,findSourceMapURL,\"uploadDocument\");","\"use client\";\n\nimport {\n\tActivity,\n\tChevronRight,\n\tEye,\n\tMail,\n\tMessageSquare,\n\tReceipt,\n\tSearch,\n\tSparkles,\n\tUser,\n} from \"lucide-react\";\nimport { type ReactNode, useMemo, useState } from \"react\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { cn } from \"@/lib/utils\";\n\ntype ActivityItem = {\n\tid: string;\n\tactivity_type: string;\n\tentity_type?: string;\n\tdescription: string;\n\tmetadata?: Record<string, any>;\n\tcreated_at: string;\n\tuser_id?: string;\n\tuser?:\n\t\t| {\n\t\t\t\tname?: string;\n\t\t\t\temail?: string;\n\t\t\t\tavatar?: string;\n\t\t  }\n\t\t| Array<{\n\t\t\t\tname?: string;\n\t\t\t\temail?: string;\n\t\t\t\tavatar?: string;\n\t\t  }>;\n};\n\ntype JobActivityTimelineProps = {\n\tactivities: ActivityItem[];\n};\n\nconst ITEMS_PER_PAGE = 10;\n\nexport function JobActivityTimeline({ activities }: JobActivityTimelineProps) {\n\tconst [searchQuery, setSearchQuery] = useState(\"\");\n\tconst [currentPage, setCurrentPage] = useState(1);\n\n\t// Activity type styling configuration\n\tconst getActivityConfig = (type: string) => {\n\t\tconst configs: Record<\n\t\t\tstring,\n\t\t\t{\n\t\t\t\ticon: ReactNode;\n\t\t\t\ticonColor: string;\n\t\t\t\tborderColor: string;\n\t\t\t\tlabel: string;\n\t\t\t}\n\t\t> = {\n\t\t\tcreated: {\n\t\t\t\ticon: <Sparkles className=\"size-3\" />,\n\t\t\t\ticonColor: \"text-emerald-600 dark:text-emerald-400\",\n\t\t\t\tborderColor: \"border-l-emerald-500\",\n\t\t\t\tlabel: \"Created\",\n\t\t\t},\n\t\t\tsent: {\n\t\t\t\ticon: <Mail className=\"size-3\" />,\n\t\t\t\ticonColor: \"text-blue-600 dark:text-blue-400\",\n\t\t\t\tborderColor: \"border-l-blue-500\",\n\t\t\t\tlabel: \"Sent\",\n\t\t\t},\n\t\t\tviewed: {\n\t\t\t\ticon: <Eye className=\"size-3\" />,\n\t\t\t\ticonColor: \"text-purple-600 dark:text-purple-400\",\n\t\t\t\tborderColor: \"border-l-purple-500\",\n\t\t\t\tlabel: \"Viewed\",\n\t\t\t},\n\t\t\tstatus_changed: {\n\t\t\t\ticon: <Activity className=\"size-3\" />,\n\t\t\t\ticonColor: \"text-orange-600 dark:text-orange-400\",\n\t\t\t\tborderColor: \"border-l-orange-500\",\n\t\t\t\tlabel: \"Status Changed\",\n\t\t\t},\n\t\t\tnote_added: {\n\t\t\t\ticon: <MessageSquare className=\"size-3\" />,\n\t\t\t\ticonColor: \"text-cyan-600 dark:text-cyan-400\",\n\t\t\t\tborderColor: \"border-l-cyan-500\",\n\t\t\t\tlabel: \"Note Added\",\n\t\t\t},\n\t\t\tassigned: {\n\t\t\t\ticon: <User className=\"size-3\" />,\n\t\t\t\ticonColor: \"text-indigo-600 dark:text-indigo-400\",\n\t\t\t\tborderColor: \"border-l-indigo-500\",\n\t\t\t\tlabel: \"Assigned\",\n\t\t\t},\n\t\t};\n\n\t\treturn (\n\t\t\tconfigs[type] || {\n\t\t\t\ticon: <Activity className=\"size-3\" />,\n\t\t\t\ticonColor: \"text-gray-600 dark:text-gray-400\",\n\t\t\t\tborderColor: \"border-l-gray-500\",\n\t\t\t\tlabel: type.replace(/_/g, \" \"),\n\t\t\t}\n\t\t);\n\t};\n\n\t// Filter and sort activities\n\tconst filteredActivities = useMemo(() => {\n\t\tlet filtered = [...activities];\n\n\t\t// Apply search filter\n\t\tif (searchQuery.trim()) {\n\t\t\tconst query = searchQuery.toLowerCase();\n\t\t\tfiltered = filtered.filter(\n\t\t\t\t(item) =>\n\t\t\t\t\titem.description?.toLowerCase().includes(query) ||\n\t\t\t\t\titem.activity_type?.toLowerCase().includes(query) ||\n\t\t\t\t\titem.entity_type?.toLowerCase().includes(query) ||\n\t\t\t\t\titem.metadata?.estimate_number?.toLowerCase().includes(query) ||\n\t\t\t\t\titem.metadata?.invoice_number?.toLowerCase().includes(query),\n\t\t\t);\n\t\t}\n\n\t\t// Sort by created_at descending\n\t\tfiltered.sort(\n\t\t\t(a, b) =>\n\t\t\t\tnew Date(b.created_at).getTime() - new Date(a.created_at).getTime(),\n\t\t);\n\n\t\treturn filtered;\n\t}, [activities, searchQuery]);\n\n\t// Paginate activities\n\tconst paginatedActivities = useMemo(() => {\n\t\tconst startIndex = (currentPage - 1) * ITEMS_PER_PAGE;\n\t\tconst endIndex = startIndex + ITEMS_PER_PAGE;\n\t\treturn filteredActivities.slice(startIndex, endIndex);\n\t}, [filteredActivities, currentPage]);\n\n\tconst totalPages = Math.ceil(filteredActivities.length / ITEMS_PER_PAGE);\n\n\treturn (\n\t\t<div>\n\t\t\t{/* Search Bar */}\n\t\t\t{activities.length > 5 && (\n\t\t\t\t<div className=\"border-b p-3\">\n\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t<Search className=\"text-muted-foreground absolute top-1/2 left-3 size-4 -translate-y-1/2\" />\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\tclassName=\"pl-9\"\n\t\t\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\t\t\tsetSearchQuery(e.target.value);\n\t\t\t\t\t\t\t\tsetCurrentPage(1); // Reset to first page on search\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tplaceholder=\"Search activities...\"\n\t\t\t\t\t\t\tvalue={searchQuery}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{/* Activity Items */}\n\t\t\t<div className=\"divide-y\">\n\t\t\t\t{paginatedActivities.length > 0 ? (\n\t\t\t\t\tpaginatedActivities.map((item) => {\n\t\t\t\t\t\tconst rawUser = Array.isArray(item.user) ? item.user[0] : item.user;\n\n\t\t\t\t\t\t// Extract user info from auth.users structure\n\t\t\t\t\t\tconst activityUser = rawUser\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tname:\n\t\t\t\t\t\t\t\t\t\trawUser.raw_user_meta_data?.name ||\n\t\t\t\t\t\t\t\t\t\trawUser.name ||\n\t\t\t\t\t\t\t\t\t\t\"Unknown User\",\n\t\t\t\t\t\t\t\t\temail: rawUser.raw_user_meta_data?.email || rawUser.email,\n\t\t\t\t\t\t\t\t\tavatar:\n\t\t\t\t\t\t\t\t\t\trawUser.raw_user_meta_data?.avatar_url || rawUser.avatar,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: null;\n\n\t\t\t\t\t\tconst activityType = item.activity_type || \"general\";\n\t\t\t\t\t\tconst entityType = item.entity_type;\n\t\t\t\t\t\tconst metadata = item.metadata || {};\n\t\t\t\t\t\tconst config = getActivityConfig(activityType);\n\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\"hover:bg-muted/30 flex gap-3 border-l-2 px-4 py-2.5 transition-colors\",\n\t\t\t\t\t\t\t\t\tconfig.borderColor,\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\tkey={item.id}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{/* Icon */}\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"bg-muted flex size-7 shrink-0 items-center justify-center rounded-full\",\n\t\t\t\t\t\t\t\t\t\tconfig.iconColor,\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{config.icon}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{/* Content */}\n\t\t\t\t\t\t\t\t<div className=\"flex min-w-0 flex-1 flex-col gap-1\">\n\t\t\t\t\t\t\t\t\t{/* Header with badges, user, and time */}\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap items-center gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"text-xs\" variant=\"outline\">\n\t\t\t\t\t\t\t\t\t\t\t\t{config.label}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t{entityType && (\n\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"text-xs\" variant=\"secondary\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{entityType}\n\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t{metadata.estimate_number && (\n\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"font-mono text-xs\" variant=\"outline\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{metadata.estimate_number}\n\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t{metadata.invoice_number && (\n\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"font-mono text-xs\" variant=\"outline\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{metadata.invoice_number}\n\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t{activityUser?.name && (\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground flex items-center gap-1 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Avatar className=\"size-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarImage src={activityUser.avatar} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarFallback className=\"text-[8px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{activityUser.name.substring(0, 2).toUpperCase()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span>{activityUser.name}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<time className=\"text-muted-foreground shrink-0 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{new Date(item.created_at).toLocaleString(\"en-US\", {\n\t\t\t\t\t\t\t\t\t\t\t\tmonth: \"short\",\n\t\t\t\t\t\t\t\t\t\t\t\tday: \"numeric\",\n\t\t\t\t\t\t\t\t\t\t\t\thour: \"numeric\",\n\t\t\t\t\t\t\t\t\t\t\t\tminute: \"2-digit\",\n\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t</time>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{/* Description */}\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm leading-snug\">\n\t\t\t\t\t\t\t\t\t\t{item.description || \"Activity logged\"}\n\t\t\t\t\t\t\t\t\t</p>\n\n\t\t\t\t\t\t\t\t\t{/* Metadata footer */}\n\t\t\t\t\t\t\t\t\t{(metadata.amount ||\n\t\t\t\t\t\t\t\t\t\tmetadata.old_status ||\n\t\t\t\t\t\t\t\t\t\tmetadata.email ||\n\t\t\t\t\t\t\t\t\t\tmetadata.method) && (\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground flex flex-wrap gap-3 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{metadata.amount && (\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Receipt className=\"size-3\" />$\n\t\t\t\t\t\t\t\t\t\t\t\t\t{(metadata.amount / 100).toFixed(2)}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t{metadata.old_status && metadata.new_status && (\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<ChevronRight className=\"size-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t{metadata.old_status} → {metadata.new_status}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t{metadata.email && (\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Mail className=\"size-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t{metadata.email}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t{metadata.method && (\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tvia {metadata.method}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n\t\t\t\t\t})\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"flex flex-col items-center justify-center py-12 text-center\">\n\t\t\t\t\t\t<div className=\"bg-muted mx-auto mb-4 flex size-12 items-center justify-center rounded-full\">\n\t\t\t\t\t\t\t<Activity className=\"text-muted-foreground size-6\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\t\t{searchQuery\n\t\t\t\t\t\t\t\t? \"No activities match your search\"\n\t\t\t\t\t\t\t\t: \"No activity yet\"}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\n\t\t\t{/* Pagination */}\n\t\t\t{totalPages > 1 && (\n\t\t\t\t<div className=\"flex items-center justify-between border-t px-4 py-3\">\n\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\tShowing {(currentPage - 1) * ITEMS_PER_PAGE + 1}-\n\t\t\t\t\t\t{Math.min(currentPage * ITEMS_PER_PAGE, filteredActivities.length)}{\" \"}\n\t\t\t\t\t\tof {filteredActivities.length} activities\n\t\t\t\t\t</p>\n\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={currentPage === 1}\n\t\t\t\t\t\t\tonClick={() => setCurrentPage((p) => Math.max(1, p - 1))}\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tPrevious\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={currentPage === totalPages}\n\t\t\t\t\t\t\tonClick={() => setCurrentPage((p) => Math.min(totalPages, p + 1))}\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tNext\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","\"use client\";\n\nimport { Calendar, Filter, Search } from \"lucide-react\";\nimport { useMemo, useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\nimport { AppointmentExpandableRow } from \"./appointment-expandable-row\";\n\n/**\n * Job Appointments - Expandable List View\n *\n * Alternative to datatable that shows expandable rows for nested data.\n * Each appointment can be expanded to show:\n * - Team members assigned\n * - Equipment used\n * - Time tracking\n * - Notes and instructions\n *\n * Features:\n * - Search by title, type, assignee\n * - Filter by status\n * - Sort by date\n * - Clean expandable rows\n */\n\ntype TeamMember = {\n\tid: string;\n\tname: string;\n\temail?: string;\n\tavatar?: string;\n\trole?: string;\n};\n\ntype Equipment = {\n\tid: string;\n\tname: string;\n\tserial_number?: string;\n\ttype?: string;\n};\n\ntype Appointment = {\n\tid: string;\n\ttitle?: string;\n\tdescription?: string;\n\tstart_time: string;\n\tend_time: string;\n\tduration?: number | null;\n\tactual_duration?: number | null;\n\tactual_start_time?: string | null;\n\tactual_end_time?: string | null;\n\tstatus?: string | null;\n\ttype?: string | null;\n\tnotes?: string | null;\n\taccess_instructions?: string | null;\n\tteam_members?: TeamMember[];\n\tequipment?: Equipment[];\n\tassigned_user?:\n\t\t| {\n\t\t\t\tid: string;\n\t\t\t\tname: string;\n\t\t\t\temail?: string;\n\t\t\t\tavatar?: string;\n\t\t  }\n\t\t| null\n\t\t| Array<{\n\t\t\t\tid: string;\n\t\t\t\tname: string;\n\t\t\t\temail?: string;\n\t\t\t\tavatar?: string;\n\t\t  }>;\n};\n\ntype JobAppointmentsExpandableProps = {\n\tappointments: Appointment[];\n};\n\nexport function JobAppointmentsExpandable({\n\tappointments,\n}: JobAppointmentsExpandableProps) {\n\tconst [searchQuery, setSearchQuery] = useState(\"\");\n\tconst [statusFilter, setStatusFilter] = useState<string>(\"all\");\n\n\t// Get unique statuses\n\tconst statuses = useMemo(() => {\n\t\tconst uniqueStatuses = new Set(\n\t\t\tappointments.map((a) => a.status).filter(Boolean),\n\t\t);\n\t\treturn Array.from(uniqueStatuses);\n\t}, [appointments]);\n\n\t// Filter and search appointments\n\tconst filteredAppointments = useMemo(() => {\n\t\tlet filtered = appointments;\n\n\t\t// Apply search\n\t\tif (searchQuery.trim()) {\n\t\t\tconst query = searchQuery.toLowerCase();\n\t\t\tfiltered = filtered.filter((appointment) => {\n\t\t\t\tconst assignedUser = Array.isArray(appointment.assigned_user)\n\t\t\t\t\t? appointment.assigned_user[0]\n\t\t\t\t\t: appointment.assigned_user;\n\n\t\t\t\treturn (\n\t\t\t\t\tappointment.title?.toLowerCase().includes(query) ||\n\t\t\t\t\tappointment.type?.toLowerCase().includes(query) ||\n\t\t\t\t\tappointment.description?.toLowerCase().includes(query) ||\n\t\t\t\t\tassignedUser?.name.toLowerCase().includes(query)\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\t// Apply status filter\n\t\tif (statusFilter !== \"all\") {\n\t\t\tfiltered = filtered.filter(\n\t\t\t\t(appointment) => appointment.status === statusFilter,\n\t\t\t);\n\t\t}\n\n\t\t// Sort by start time (newest first)\n\t\tfiltered.sort(\n\t\t\t(a, b) =>\n\t\t\t\tnew Date(b.start_time).getTime() - new Date(a.start_time).getTime(),\n\t\t);\n\n\t\treturn filtered;\n\t}, [appointments, searchQuery, statusFilter]);\n\n\treturn (\n\t\t<div className=\"flex flex-col\">\n\t\t\t{/* Toolbar */}\n\t\t\t<div className=\"bg-background sticky top-0 z-10 flex flex-wrap items-center gap-2 border-b p-3\">\n\t\t\t\t{/* Search */}\n\t\t\t\t<div className=\"relative flex-1\">\n\t\t\t\t\t<Search className=\"text-muted-foreground absolute top-1/2 left-3 size-4 -translate-y-1/2\" />\n\t\t\t\t\t<Input\n\t\t\t\t\t\tclassName=\"h-9 pl-9\"\n\t\t\t\t\t\tonChange={(e) => setSearchQuery(e.target.value)}\n\t\t\t\t\t\tplaceholder=\"Search appointments...\"\n\t\t\t\t\t\tvalue={searchQuery}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Status Filter */}\n\t\t\t\t<Select onValueChange={setStatusFilter} value={statusFilter}>\n\t\t\t\t\t<SelectTrigger className=\"h-9 w-[160px]\">\n\t\t\t\t\t\t<Filter className=\"mr-2 size-4\" />\n\t\t\t\t\t\t<SelectValue placeholder=\"All Statuses\" />\n\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t<SelectItem value=\"all\">All Statuses</SelectItem>\n\t\t\t\t\t\t{statuses.map((status) => (\n\t\t\t\t\t\t\t<SelectItem key={status} value={status || \"\"}>\n\t\t\t\t\t\t\t\t{status?.replace(/_/g, \" \")}\n\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</SelectContent>\n\t\t\t\t</Select>\n\n\t\t\t\t{/* Count */}\n\t\t\t\t<Badge className=\"h-9 px-3\" variant=\"outline\">\n\t\t\t\t\t{filteredAppointments.length} of {appointments.length}\n\t\t\t\t</Badge>\n\t\t\t</div>\n\n\t\t\t{/* Appointments List */}\n\t\t\t<div className=\"divide-y\">\n\t\t\t\t{filteredAppointments.length > 0 ? (\n\t\t\t\t\tfilteredAppointments.map((appointment) => (\n\t\t\t\t\t\t<AppointmentExpandableRow\n\t\t\t\t\t\t\tappointment={appointment}\n\t\t\t\t\t\t\tkey={appointment.id}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"flex flex-col items-center justify-center py-12 text-center\">\n\t\t\t\t\t\t<Calendar className=\"text-muted-foreground mb-3 size-12\" />\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\t\t{searchQuery || statusFilter !== \"all\"\n\t\t\t\t\t\t\t\t? \"No appointments match your filters\"\n\t\t\t\t\t\t\t\t: \"No appointments scheduled\"}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t{(searchQuery || statusFilter !== \"all\") && (\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tclassName=\"mt-3\"\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tsetSearchQuery(\"\");\n\t\t\t\t\t\t\t\t\tsetStatusFilter(\"all\");\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tClear Filters\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","// Re-export from @stratos/ui package\nexport * from \"@stratos/ui\";\n","\"use client\";\n\nimport {\n\tCalendar,\n\tCheckCircle2,\n\tClock,\n\tFileText,\n\tMapPin,\n\tUser,\n\tUsers,\n\tWrench,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n\tExpandableRow,\n\tExpandableRowSection,\n} from \"@/components/ui/expandable-row\";\nimport { cn } from \"@/lib/utils\";\n\n/**\n * Appointment Expandable Row\n *\n * Shows appointment summary in collapsed state.\n * Expands to show:\n * - Team members assigned\n * - Equipment used\n * - Time tracking details\n * - Notes and instructions\n */\n\ntype TeamMember = {\n\tid: string;\n\tname: string;\n\temail?: string;\n\tavatar?: string;\n\trole?: string;\n};\n\ntype Equipment = {\n\tid: string;\n\tname: string;\n\tserial_number?: string;\n\ttype?: string;\n};\n\ntype AppointmentData = {\n\tid: string;\n\ttitle?: string;\n\tdescription?: string;\n\tstart_time: string;\n\tend_time: string;\n\tduration?: number | null;\n\tactual_duration?: number | null;\n\tactual_start_time?: string | null;\n\tactual_end_time?: string | null;\n\tstatus?: string | null;\n\ttype?: string | null;\n\tnotes?: string | null;\n\taccess_instructions?: string | null;\n\t// Nested associations\n\tteam_members?: TeamMember[];\n\tequipment?: Equipment[];\n\tassigned_user?:\n\t\t| {\n\t\t\t\tid: string;\n\t\t\t\tname: string;\n\t\t\t\temail?: string;\n\t\t\t\tavatar?: string;\n\t\t  }\n\t\t| null\n\t\t| Array<{\n\t\t\t\tid: string;\n\t\t\t\tname: string;\n\t\t\t\temail?: string;\n\t\t\t\tavatar?: string;\n\t\t  }>;\n};\n\ntype AppointmentExpandableRowProps = {\n\tappointment: AppointmentData;\n\tshowExpanded?: boolean;\n};\n\nexport function AppointmentExpandableRow({\n\tappointment,\n\tshowExpanded = false,\n}: AppointmentExpandableRowProps) {\n\tconst startDate = new Date(appointment.start_time);\n\tconst endDate = new Date(appointment.end_time);\n\n\t// Format time\n\tconst formatTime = (date: Date) => {\n\t\treturn date.toLocaleTimeString(\"en-US\", {\n\t\t\thour: \"numeric\",\n\t\t\tminute: \"2-digit\",\n\t\t});\n\t};\n\n\t// Format date\n\tconst formatDate = (date: Date) => {\n\t\treturn date.toLocaleDateString(\"en-US\", {\n\t\t\tmonth: \"short\",\n\t\t\tday: \"numeric\",\n\t\t\tyear: \"numeric\",\n\t\t});\n\t};\n\n\t// Get status color\n\tconst getStatusColor = (status?: string | null) => {\n\t\tswitch (status?.toLowerCase()) {\n\t\t\tcase \"completed\":\n\t\t\t\treturn \"bg-green-500/10 text-green-700 dark:text-green-400\";\n\t\t\tcase \"in_progress\":\n\t\t\t\treturn \"bg-blue-500/10 text-blue-700 dark:text-blue-400\";\n\t\t\tcase \"scheduled\":\n\t\t\t\treturn \"bg-purple-500/10 text-purple-700 dark:text-purple-400\";\n\t\t\tcase \"cancelled\":\n\t\t\t\treturn \"bg-red-500/10 text-red-700 dark:text-red-400\";\n\t\t\tdefault:\n\t\t\t\treturn \"bg-gray-500/10 text-gray-700 dark:text-gray-400\";\n\t\t}\n\t};\n\n\t// Extract assigned user\n\tconst assignedUser = Array.isArray(appointment.assigned_user)\n\t\t? appointment.assigned_user[0]\n\t\t: appointment.assigned_user;\n\n\t// Check if there are nested associations to show\n\tconst hasTeamMembers =\n\t\tappointment.team_members && appointment.team_members.length > 0;\n\tconst hasEquipment =\n\t\tappointment.equipment && appointment.equipment.length > 0;\n\tconst hasNotes = appointment.notes || appointment.access_instructions;\n\tconst hasTimeTracking =\n\t\tappointment.actual_start_time || appointment.actual_end_time;\n\n\tconst hasNestedData =\n\t\thasTeamMembers || hasEquipment || hasNotes || hasTimeTracking;\n\n\treturn (\n\t\t<ExpandableRow\n\t\t\tdefaultExpanded={showExpanded}\n\t\t\tdetails={\n\t\t\t\thasNestedData ? (\n\t\t\t\t\t<div className=\"divide-y\">\n\t\t\t\t\t\t{/* Team Members */}\n\t\t\t\t\t\t{hasTeamMembers && (\n\t\t\t\t\t\t\t<ExpandableRowSection\n\t\t\t\t\t\t\t\ticon={<Users className=\"size-4\" />}\n\t\t\t\t\t\t\t\ttitle=\"Team Members\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t{appointment.team_members?.map((member) => (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center gap-3 rounded-md border p-2\"\n\t\t\t\t\t\t\t\t\t\t\tkey={member.id}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Avatar className=\"size-8\">\n\t\t\t\t\t\t\t\t\t\t\t\t<AvatarImage src={member.avatar} />\n\t\t\t\t\t\t\t\t\t\t\t\t<AvatarFallback className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{member.name.substring(0, 2).toUpperCase()}\n\t\t\t\t\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-foreground text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{member.name}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t{member.role && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{member.role}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{member.email && (\n\t\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-primary text-xs hover:underline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\thref={`mailto:${member.email}`}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{member.email}\n\t\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</ExpandableRowSection>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{/* Equipment */}\n\t\t\t\t\t\t{hasEquipment && (\n\t\t\t\t\t\t\t<ExpandableRowSection\n\t\t\t\t\t\t\t\ticon={<Wrench className=\"size-4\" />}\n\t\t\t\t\t\t\t\ttitle=\"Equipment\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t{appointment.equipment?.map((equip) => (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center justify-between rounded-md border p-2\"\n\t\t\t\t\t\t\t\t\t\t\tkey={equip.id}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Wrench className=\"text-muted-foreground size-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-foreground text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{equip.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{equip.serial_number && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground font-mono text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSN: {equip.serial_number}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{equip.type && (\n\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"outline\">{equip.type}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</ExpandableRowSection>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{/* Time Tracking */}\n\t\t\t\t\t\t{hasTimeTracking && (\n\t\t\t\t\t\t\t<ExpandableRowSection\n\t\t\t\t\t\t\t\ticon={<Clock className=\"size-4\" />}\n\t\t\t\t\t\t\t\ttitle=\"Time Tracking\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"grid gap-2 text-sm sm:grid-cols-2\">\n\t\t\t\t\t\t\t\t\t{appointment.actual_start_time && (\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\tActual Start:\n\t\t\t\t\t\t\t\t\t\t\t</span>{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t{new Date(\n\t\t\t\t\t\t\t\t\t\t\t\t\tappointment.actual_start_time,\n\t\t\t\t\t\t\t\t\t\t\t\t).toLocaleString()}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t{appointment.actual_end_time && (\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">Actual End:</span>{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t{new Date(appointment.actual_end_time).toLocaleString()}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t{appointment.actual_duration && (\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\tActual Duration:\n\t\t\t\t\t\t\t\t\t\t\t</span>{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t{appointment.actual_duration} min\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t{appointment.duration && (\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\tEstimated Duration:\n\t\t\t\t\t\t\t\t\t\t\t</span>{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t{appointment.duration} min\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</ExpandableRowSection>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{/* Notes & Instructions */}\n\t\t\t\t\t\t{hasNotes && (\n\t\t\t\t\t\t\t<ExpandableRowSection\n\t\t\t\t\t\t\t\ticon={<FileText className=\"size-4\" />}\n\t\t\t\t\t\t\t\ttitle=\"Notes & Instructions\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{appointment.access_instructions && (\n\t\t\t\t\t\t\t\t\t<div className=\"mb-3\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"mb-1 flex items-center gap-2 text-xs font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t<MapPin className=\"size-3\" />\n\t\t\t\t\t\t\t\t\t\t\tAccess Instructions\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<p className=\"bg-muted/50 rounded-md border p-2 text-xs whitespace-pre-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t{appointment.access_instructions}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{appointment.notes && (\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"mb-1 text-xs font-medium\">\n\t\t\t\t\t\t\t\t\t\t\tInternal Notes\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<p className=\"bg-muted/50 rounded-md border p-2 text-xs whitespace-pre-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t{appointment.notes}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</ExpandableRowSection>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"flex flex-col items-center justify-center py-8 text-center\">\n\t\t\t\t\t\t<FileText className=\"text-muted-foreground mb-2 size-8\" />\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\t\tNo additional details available\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t)\n\t\t\t}\n\t\t\tdisabled={!hasNestedData}\n\t\t\tshowIndicator={hasNestedData}\n\t\t\tsummary={\n\t\t\t\t<div className=\"flex flex-1 items-center gap-4 py-3 pr-4\">\n\t\t\t\t\t{/* Date/Time */}\n\t\t\t\t\t<div className=\"flex w-32 shrink-0 flex-col\">\n\t\t\t\t\t\t<div className=\"text-sm font-medium\">{formatDate(startDate)}</div>\n\t\t\t\t\t\t<div className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t{formatTime(startDate)} - {formatTime(endDate)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Title & Type */}\n\t\t\t\t\t<div className=\"flex min-w-0 flex-1 flex-col\">\n\t\t\t\t\t\t<div className=\"truncate text-sm font-medium\">\n\t\t\t\t\t\t\t{appointment.title || \"Untitled Appointment\"}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{appointment.type && (\n\t\t\t\t\t\t\t<div className=\"text-muted-foreground truncate text-xs\">\n\t\t\t\t\t\t\t\t{appointment.type}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Assigned User */}\n\t\t\t\t\t{assignedUser && (\n\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Avatar className=\"size-6\">\n\t\t\t\t\t\t\t\t<AvatarImage src={assignedUser.avatar} />\n\t\t\t\t\t\t\t\t<AvatarFallback className=\"text-[10px]\">\n\t\t\t\t\t\t\t\t\t{assignedUser.name.substring(0, 2).toUpperCase()}\n\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t<span className=\"text-muted-foreground hidden text-xs sm:inline\">\n\t\t\t\t\t\t\t\t{assignedUser.name}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Status */}\n\t\t\t\t\t{appointment.status && (\n\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\"h-6 shrink-0 rounded-full px-3 text-xs capitalize\",\n\t\t\t\t\t\t\t\tgetStatusColor(appointment.status),\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{appointment.status.replace(/_/g, \" \")}\n\t\t\t\t\t\t</Badge>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Nested data indicator */}\n\t\t\t\t\t{hasNestedData && (\n\t\t\t\t\t\t<div className=\"text-muted-foreground flex shrink-0 items-center gap-1 text-xs\">\n\t\t\t\t\t\t\t{hasTeamMembers && (\n\t\t\t\t\t\t\t\t<Badge className=\"h-5 px-1.5\" variant=\"outline\">\n\t\t\t\t\t\t\t\t\t<Users className=\"mr-1 size-3\" />\n\t\t\t\t\t\t\t\t\t{appointment.team_members?.length}\n\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{hasEquipment && (\n\t\t\t\t\t\t\t\t<Badge className=\"h-5 px-1.5\" variant=\"outline\">\n\t\t\t\t\t\t\t\t\t<Wrench className=\"mr-1 size-3\" />\n\t\t\t\t\t\t\t\t\t{appointment.equipment?.length}\n\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t}\n\t\t/>\n\t);\n}\n","\"use client\";\n\nimport {\n\tBuilding2,\n\tCheck,\n\tChevronRight,\n\tChevronsUpDown,\n\tEye,\n\tLinkIcon,\n\tMail,\n\tMapPin,\n\tPhone,\n\tSearch,\n\tUnlink,\n\tUser,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useEffect, useState } from \"react\";\nimport {\n\tAlertDialog,\n\tAlertDialogAction,\n\tAlertDialogCancel,\n\tAlertDialogContent,\n\tAlertDialogDescription,\n\tAlertDialogFooter,\n\tAlertDialogHeader,\n\tAlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tCommand,\n\tCommandEmpty,\n\tCommandGroup,\n\tCommandInput,\n\tCommandItem,\n\tCommandList,\n\tCommandSeparator,\n} from \"@/components/ui/command\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuLabel,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { cn } from \"@/lib/utils\";\n\n/**\n * Job Customer & Property Manager\n *\n * Advanced search and assignment component for managing customer and property relationships on jobs.\n *\n * Features:\n * - Full-text search across customers (name, email, phone, company, address)\n * - Automatic property loading when customer is selected\n * - Property search within selected customer\n * - Warning dialogs for removing customer/property\n * - Real-time validation (only 1 customer + properties per job)\n * - Server-side search with ranking\n */\n\ntype Customer = {\n\tid: string;\n\tfirst_name: string;\n\tlast_name: string;\n\tdisplay_name: string;\n\temail: string;\n\tphone: string;\n\tcompany_name?: string;\n\ttype: \"residential\" | \"commercial\" | \"industrial\";\n\taddress?: string;\n\tcity?: string;\n\tstate?: string;\n\tzip?: string;\n};\n\ntype Property = {\n\tid: string;\n\tcustomer_id: string;\n\taddress: string;\n\taddress_line2?: string;\n\tcity: string;\n\tstate: string;\n\tzip: string;\n\tproperty_type?: string;\n};\n\ntype JobCustomerPropertyManagerProps = {\n\tcurrentCustomer: Customer | null;\n\tcurrentProperty: Property | null;\n\tonAssignCustomer: (\n\t\tcustomer: Customer,\n\t\tproperty: Property | null,\n\t) => Promise<void>;\n\tonRemoveCustomer: () => Promise<void>;\n\tonRemoveProperty: () => Promise<void>;\n\tsearchCustomers: (query: string) => Promise<Customer[]>;\n\tgetCustomerProperties: (customerId: string) => Promise<Property[]>;\n};\n\nexport function JobCustomerPropertyManager({\n\tcurrentCustomer,\n\tcurrentProperty,\n\tonAssignCustomer,\n\tonRemoveCustomer,\n\tonRemoveProperty,\n\tsearchCustomers,\n\tgetCustomerProperties,\n}: JobCustomerPropertyManagerProps) {\n\tconst [open, setOpen] = useState(false);\n\tconst [searchQuery, setSearchQuery] = useState(\"\");\n\tconst [searching, setSearching] = useState(false);\n\tconst [searchResults, setSearchResults] = useState<Customer[]>([]);\n\tconst [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(\n\t\tnull,\n\t);\n\tconst [customerProperties, setCustomerProperties] = useState<Property[]>([]);\n\tconst [selectedProperty, setSelectedProperty] = useState<Property | null>(\n\t\tnull,\n\t);\n\tconst [loadingProperties, setLoadingProperties] = useState(false);\n\tconst [showRemoveCustomerDialog, setShowRemoveCustomerDialog] =\n\t\tuseState(false);\n\tconst [showRemovePropertyDialog, setShowRemovePropertyDialog] =\n\t\tuseState(false);\n\tconst [isAssigning, setIsAssigning] = useState(false);\n\n\t// Search customers with debounce\n\tuseEffect(() => {\n\t\tif (!searchQuery || searchQuery.length < 2) {\n\t\t\tsetSearchResults([]);\n\t\t\treturn;\n\t\t}\n\n\t\tconst timer = setTimeout(async () => {\n\t\t\tsetSearching(true);\n\t\t\ttry {\n\t\t\t\tconst results = await searchCustomers(searchQuery);\n\t\t\t\tsetSearchResults(results);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Error searching customers:\", error);\n\t\t\t\tsetSearchResults([]);\n\t\t\t} finally {\n\t\t\t\tsetSearching(false);\n\t\t\t}\n\t\t}, 300);\n\n\t\treturn () => clearTimeout(timer);\n\t}, [searchQuery, searchCustomers]);\n\n\t// Load properties when customer is selected\n\tuseEffect(() => {\n\t\tif (!selectedCustomer) {\n\t\t\tsetCustomerProperties([]);\n\t\t\tsetSelectedProperty(null);\n\t\t\treturn;\n\t\t}\n\n\t\tasync function loadProperties() {\n\t\t\tsetLoadingProperties(true);\n\t\t\ttry {\n\t\t\t\tconst properties = await getCustomerProperties(selectedCustomer.id);\n\t\t\t\tsetCustomerProperties(properties);\n\n\t\t\t\t// Auto-select if only one property\n\t\t\t\tif (properties.length === 1) {\n\t\t\t\t\tsetSelectedProperty(properties[0]);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Error loading properties:\", error);\n\t\t\t\tsetCustomerProperties([]);\n\t\t\t} finally {\n\t\t\t\tsetLoadingProperties(false);\n\t\t\t}\n\t\t}\n\n\t\tloadProperties();\n\t}, [selectedCustomer, getCustomerProperties]);\n\n\t// Format customer display\n\tconst formatCustomerDisplay = (customer: Customer) => {\n\t\tif (customer.company_name) {\n\t\t\treturn `${customer.display_name} (${customer.company_name})`;\n\t\t}\n\t\treturn customer.display_name;\n\t};\n\n\t// Format property display\n\tconst formatPropertyDisplay = (property: Property) => {\n\t\treturn `${property.address}${property.address_line2 ? ` ${property.address_line2}` : \"\"}, ${property.city}, ${property.state} ${property.zip}`;\n\t};\n\n\t// Handle customer selection\n\tconst handleSelectCustomer = (customer: Customer) => {\n\t\tsetSelectedCustomer(customer);\n\t\tsetSearchQuery(\"\");\n\t};\n\n\t// Handle assign button\n\tconst handleAssign = async () => {\n\t\tif (!selectedCustomer) return;\n\n\t\tsetIsAssigning(true);\n\t\ttry {\n\t\t\tawait onAssignCustomer(selectedCustomer, selectedProperty);\n\t\t\tsetOpen(false);\n\t\t\tsetSelectedCustomer(null);\n\t\t\tsetSelectedProperty(null);\n\t\t\tsetSearchQuery(\"\");\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error assigning customer:\", error);\n\t\t} finally {\n\t\t\tsetIsAssigning(false);\n\t\t}\n\t};\n\n\t// Handle removal flows\n\tconst handleRemoveCustomer = async () => {\n\t\ttry {\n\t\t\tawait onRemoveCustomer();\n\t\t\tsetShowRemoveCustomerDialog(false);\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error removing customer:\", error);\n\t\t}\n\t};\n\n\tconst handleRemoveProperty = async () => {\n\t\ttry {\n\t\t\tawait onRemoveProperty();\n\t\t\tsetShowRemovePropertyDialog(false);\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error removing property:\", error);\n\t\t}\n\t};\n\n\tconst assignmentButton = (\n\t\t<Popover onOpenChange={setOpen} open={open}>\n\t\t\t<PopoverTrigger asChild>\n\t\t\t\t<Button\n\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\"justify-start transition-all\",\n\t\t\t\t\t\tcurrentCustomer ? \"px-3\" : \"w-full\",\n\t\t\t\t\t)}\n\t\t\t\t\tsize={currentCustomer ? \"sm\" : \"default\"}\n\t\t\t\t\tvariant={currentCustomer ? \"ghost\" : \"outline\"}\n\t\t\t\t>\n\t\t\t\t\t{currentCustomer ? (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<User className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t<span>Change</span>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<User className=\"text-muted-foreground mr-2 size-4\" />\n\t\t\t\t\t\t\t<span>Assign Customer & Property</span>\n\t\t\t\t\t\t\t<ChevronsUpDown className=\"ml-auto size-4 opacity-50\" />\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</Button>\n\t\t\t</PopoverTrigger>\n\t\t\t<PopoverContent align=\"start\" className=\"w-[650px] p-0 shadow-xl\">\n\t\t\t\t<div className=\"flex h-[550px] flex-col\">\n\t\t\t\t\t{/* Header */}\n\t\t\t\t\t<div className=\"bg-muted/30 border-b p-4\">\n\t\t\t\t\t\t<h3 className=\"mb-3 text-base font-semibold\">\n\t\t\t\t\t\t\tAssign Customer & Property\n\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<div className=\"text-muted-foreground flex items-center gap-2 text-xs\">\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1.5\">\n\t\t\t\t\t\t\t\t\t<div className=\"bg-primary/20 text-primary flex size-5 items-center justify-center rounded-full text-[10px] font-bold\">\n\t\t\t\t\t\t\t\t\t\t1\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\tselectedCustomer ? \"text-primary font-medium\" : \"\",\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tSelect Customer\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<ChevronRight className=\"size-3\" />\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1.5\">\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"flex size-5 items-center justify-center rounded-full text-[10px] font-bold\",\n\t\t\t\t\t\t\t\t\t\t\tselectedCustomer\n\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-primary/20 text-primary\"\n\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-muted text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t2\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\tselectedCustomer\n\t\t\t\t\t\t\t\t\t\t\t\t? \"text-primary font-medium\"\n\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tChoose Property\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Step 1: Customer Search */}\n\t\t\t\t\t<div className=\"bg-background border-b p-4\">\n\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t<Search className=\"text-muted-foreground absolute top-1/2 left-3 size-4 -translate-y-1/2\" />\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tclassName=\"border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-11 w-full rounded-lg border px-10 py-2 text-sm transition-shadow file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50\"\n\t\t\t\t\t\t\t\tonChange={(e) => setSearchQuery(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"Search by name, email, phone, company, or address...\"\n\t\t\t\t\t\t\t\tvalue={searchQuery}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{searching && (\n\t\t\t\t\t\t\t\t<div className=\"absolute top-1/2 right-3 -translate-y-1/2\">\n\t\t\t\t\t\t\t\t\t<div className=\"border-primary/30 border-t-primary size-4 animate-spin rounded-full border-2\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Search Results */}\n\t\t\t\t\t<div className=\"flex-1 overflow-y-auto\">\n\t\t\t\t\t\t{selectedCustomer ? (\n\t\t\t\t\t\t\t<div className=\"bg-primary/5 border-b p-4\">\n\t\t\t\t\t\t\t\t<div className=\"flex items-start gap-3\">\n\t\t\t\t\t\t\t\t\t<div className=\"bg-primary/20 text-primary flex size-10 flex-shrink-0 items-center justify-center rounded-full text-sm font-bold\">\n\t\t\t\t\t\t\t\t\t\t{selectedCustomer.first_name?.[0]}\n\t\t\t\t\t\t\t\t\t\t{selectedCustomer.last_name?.[0]}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"mb-1 flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t\t{formatCustomerDisplay(selectedCustomer)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<Check className=\"text-primary size-4 flex-shrink-0\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground space-y-0.5 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{selectedCustomer.email && (\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"truncate\">{selectedCustomer.email}</div>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t{selectedCustomer.phone && (\n\t\t\t\t\t\t\t\t\t\t\t\t<div>{selectedCustomer.phone}</div>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={() => setSelectedCustomer(null)}\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tChange\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) : searchQuery.length < 2 ? (\n\t\t\t\t\t\t\t<div className=\"flex h-full flex-col items-center justify-center p-8 text-center\">\n\t\t\t\t\t\t\t\t<Search className=\"text-muted-foreground mb-3 size-10\" />\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\t\t\t\tType at least 2 characters to search\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) : searchResults.length === 0 && !searching ? (\n\t\t\t\t\t\t\t<div className=\"flex h-full flex-col items-center justify-center p-8 text-center\">\n\t\t\t\t\t\t\t\t<User className=\"text-muted-foreground mb-3 size-10\" />\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\t\t\t\tNo customers found\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<div className=\"divide-y\">\n\t\t\t\t\t\t\t\t{searchResults.map((customer) => (\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclassName=\"hover:bg-muted/50 flex w-full items-start gap-3 p-4 text-left transition-all hover:shadow-sm\"\n\t\t\t\t\t\t\t\t\t\tkey={customer.id}\n\t\t\t\t\t\t\t\t\t\tonClick={() => handleSelectCustomer(customer)}\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div className=\"bg-muted/80 flex size-10 flex-shrink-0 items-center justify-center rounded-full text-sm font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t{customer.first_name?.[0]}\n\t\t\t\t\t\t\t\t\t\t\t{customer.last_name?.[0]}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"mb-1 flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"truncate text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{formatCustomerDisplay(customer)}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex-shrink-0 capitalize\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{customer.type}\n\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground space-y-0.5 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t{customer.email && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"truncate\">{customer.email}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t{customer.phone && <div>{customer.phone}</div>}\n\t\t\t\t\t\t\t\t\t\t\t\t{customer.address && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"truncate text-[11px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{customer.address}, {customer.city},{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{customer.state}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<ChevronRight className=\"text-muted-foreground mt-2 size-4 flex-shrink-0\" />\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Step 2: Property Selection */}\n\t\t\t\t\t{selectedCustomer && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<div className=\"bg-muted/30 border-t p-4\">\n\t\t\t\t\t\t\t\t<div className=\"space-y-3\">\n\t\t\t\t\t\t\t\t\t{loadingProperties ? (\n\t\t\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-16 w-full\" />\n\t\t\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-16 w-full\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t) : customerProperties.length === 0 ? (\n\t\t\t\t\t\t\t\t\t\t<div className=\"bg-background rounded-lg border border-dashed p-6 text-center\">\n\t\t\t\t\t\t\t\t\t\t\t<MapPin className=\"text-muted-foreground mx-auto mb-2 size-10\" />\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mb-1 text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\tNo properties found\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\tYou can still assign this customer without a property\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<div className=\"max-h-[180px] space-y-2 overflow-y-auto pr-1\">\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mb-2 text-xs font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\tSelect a property (optional)\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t{customerProperties.map((property) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"hover:bg-muted/80 flex w-full items-start gap-3 rounded-lg border p-3 text-left transition-all\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedProperty?.id === property.id &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"border-primary bg-primary/10 shadow-sm\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={property.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setSelectedProperty(property)}\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<MapPin\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"mt-0.5 size-4 flex-shrink-0\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedProperty?.id === property.id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"text-primary\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1 text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"truncate font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{property.address}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{property.address_line2 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground truncate text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{property.address_line2}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground truncate text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{property.city}, {property.state} {property.zip}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedProperty?.id === property.id && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Check className=\"text-primary size-4 flex-shrink-0\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Assign Button */}\n\t\t\t\t\t\t\t<div className=\"bg-background border-t p-4\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName=\"h-11 w-full text-base font-medium shadow-sm\"\n\t\t\t\t\t\t\t\t\tdisabled={isAssigning}\n\t\t\t\t\t\t\t\t\tonClick={handleAssign}\n\t\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{isAssigning ? (\n\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"mr-2 size-4 animate-spin rounded-full border-2 border-white border-t-transparent\" />\n\t\t\t\t\t\t\t\t\t\t\tAssigning...\n\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t<Check className=\"mr-2 size-5\" />\n\t\t\t\t\t\t\t\t\t\t\tAssign to Job\n\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</PopoverContent>\n\t\t</Popover>\n\t);\n\n\treturn (\n\t\t<div className=\"flex w-full gap-2\">\n\t\t\t{currentCustomer ? (\n\t\t\t\t<div className=\"flex flex-1 gap-0\">\n\t\t\t\t\t{/* Customer Info Dropdown */}\n\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tclassName=\"flex-1 justify-start rounded-r-none border-r-0\"\n\t\t\t\t\t\t\t\tsize=\"default\"\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<User className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t<span className=\"truncate font-medium\">\n\t\t\t\t\t\t\t\t\t{formatCustomerDisplay(currentCustomer)}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<ChevronRight className=\"ml-auto size-4 opacity-50\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t<DropdownMenuContent align=\"start\" className=\"w-64\">\n\t\t\t\t\t\t\t<DropdownMenuLabel className=\"font-normal\">\n\t\t\t\t\t\t\t\t<div className=\"flex flex-col space-y-1\">\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-medium leading-none\">\n\t\t\t\t\t\t\t\t\t\t{formatCustomerDisplay(currentCustomer)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t{currentCustomer.type && (\n\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"mt-1 w-fit capitalize\"\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{currentCustomer.type}\n\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t{currentCustomer.email && (\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{currentCustomer.email}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t{currentCustomer.phone && (\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{currentCustomer.phone}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</DropdownMenuLabel>\n\t\t\t\t\t\t\t{currentProperty && (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t\t<DropdownMenuLabel className=\"font-normal\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-col space-y-1\">\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs font-medium text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\tProperty\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-medium leading-none\">\n\t\t\t\t\t\t\t\t\t\t\t\t{currentProperty.address}\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t{currentProperty.city}, {currentProperty.state}{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t\t{currentProperty.zip}\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</DropdownMenuLabel>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t<DropdownMenuItem asChild>\n\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\thref={`/dashboard/customers/${currentCustomer.id}`}\n\t\t\t\t\t\t\t\t\tclassName=\"cursor-pointer\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Eye className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tView Customer Profile\n\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t{currentProperty && (\n\t\t\t\t\t\t\t\t<DropdownMenuItem asChild>\n\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\thref={`/dashboard/work/properties/${currentProperty.id}`}\n\t\t\t\t\t\t\t\t\t\tclassName=\"cursor-pointer\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<MapPin className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\t\tView Property Details\n\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\tonSelect={(event) => {\n\t\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\t\tsetOpen(true);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<ChevronsUpDown className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\tChange Customer/Property\n\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t{currentProperty && (\n\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\tonSelect={(event) => {\n\t\t\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\t\t\tsetShowRemovePropertyDialog(true);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Unlink className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tUnlink Property\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\tclassName=\"text-destructive focus:text-destructive\"\n\t\t\t\t\t\t\t\tonSelect={(event) => {\n\t\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\t\tsetShowRemoveCustomerDialog(true);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Unlink className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\tUnlink Customer\n\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t</DropdownMenu>\n\n\t\t\t\t\t{/* Unlink Button */}\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclassName=\"rounded-l-none px-3\"\n\t\t\t\t\t\tsize=\"default\"\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\tonClick={() => setShowRemoveCustomerDialog(true)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Unlink className=\"size-4 text-destructive\" />\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t) : (\n\t\t\t\tassignmentButton\n\t\t\t)}\n\n\t\t\t{/* Unlink dialogs */}\n\t\t\t<AlertDialog\n\t\t\t\tonOpenChange={setShowRemoveCustomerDialog}\n\t\t\t\topen={showRemoveCustomerDialog}\n\t\t\t>\n\t\t\t\t<AlertDialogContent>\n\t\t\t\t\t<AlertDialogHeader>\n\t\t\t\t\t\t<AlertDialogTitle>Unlink Customer?</AlertDialogTitle>\n\t\t\t\t\t\t<AlertDialogDescription>\n\t\t\t\t\t\t\tAre you sure you want to unlink{\" \"}\n\t\t\t\t\t\t\t<strong>{currentCustomer?.display_name}</strong> from this job?\n\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\tThis will also unlink any associated property. The customer and\n\t\t\t\t\t\t\tproperty records will remain in your system, but this job will no\n\t\t\t\t\t\t\tlonger be associated with them.\n\t\t\t\t\t\t</AlertDialogDescription>\n\t\t\t\t\t</AlertDialogHeader>\n\t\t\t\t\t<AlertDialogFooter>\n\t\t\t\t\t\t<AlertDialogCancel>Cancel</AlertDialogCancel>\n\t\t\t\t\t\t<AlertDialogAction onClick={handleRemoveCustomer}>\n\t\t\t\t\t\t\t<Unlink className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\tUnlink Customer\n\t\t\t\t\t\t</AlertDialogAction>\n\t\t\t\t\t</AlertDialogFooter>\n\t\t\t\t</AlertDialogContent>\n\t\t\t</AlertDialog>\n\n\t\t\t<AlertDialog\n\t\t\t\tonOpenChange={setShowRemovePropertyDialog}\n\t\t\t\topen={showRemovePropertyDialog}\n\t\t\t>\n\t\t\t\t<AlertDialogContent>\n\t\t\t\t\t<AlertDialogHeader>\n\t\t\t\t\t\t<AlertDialogTitle>Unlink Property?</AlertDialogTitle>\n\t\t\t\t\t\t<AlertDialogDescription>\n\t\t\t\t\t\t\tThis will unlink <strong>{currentProperty?.address}</strong> from\n\t\t\t\t\t\t\tthis job. The customer will remain assigned. The property record\n\t\t\t\t\t\t\twill remain in your system.\n\t\t\t\t\t\t</AlertDialogDescription>\n\t\t\t\t\t</AlertDialogHeader>\n\t\t\t\t\t<AlertDialogFooter>\n\t\t\t\t\t\t<AlertDialogCancel>Cancel</AlertDialogCancel>\n\t\t\t\t\t\t<AlertDialogAction onClick={handleRemoveProperty}>\n\t\t\t\t\t\t\t<Unlink className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\tUnlink Property\n\t\t\t\t\t\t</AlertDialogAction>\n\t\t\t\t\t</AlertDialogFooter>\n\t\t\t\t</AlertDialogContent>\n\t\t\t</AlertDialog>\n\t\t</div>\n\t);\n}\n","\"use client\";\n\nimport {\n\tArchive,\n\tCheckCircle,\n\tDownload,\n\tEye,\n\tLink2Off,\n\tMoreHorizontal,\n\tReceipt,\n\tSend,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { useCallback, useMemo, useState } from \"react\";\nimport { toast } from \"sonner\";\nimport { bulkArchive } from \"@/actions/archive\";\nimport { unlinkEstimateFromJob } from \"@/actions/estimates\";\nimport { ArchiveConfirmDialog } from \"@/components/ui/archive-confirm-dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDialog,\n\tDialogContent,\n\tDialogDescription,\n\tDialogFooter,\n\tDialogHeader,\n\tDialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n\ttype BulkAction,\n\ttype ColumnDef,\n\tFullWidthDataTable,\n} from \"@/components/ui/full-width-datatable\";\nimport { EstimateStatusBadge } from \"@/components/ui/status-badge\";\nimport { TablePresets } from \"@/lib/datatable/table-presets\";\nimport { formatCurrency, formatDate } from \"@/lib/formatters\";\n\ntype Estimate = {\n\tid: string;\n\testimate_number: string;\n\ttitle?: string;\n\ttotal_amount: number;\n\tstatus: string;\n\tcreated_at: string;\n\tvalid_until?: string | null;\n};\n\ntype JobEstimatesTableProps = {\n\testimates: Estimate[];\n};\n\nexport function JobEstimatesTable({ estimates }: JobEstimatesTableProps) {\n\tconst router = useRouter();\n\tconst [showArchiveDialog, setShowArchiveDialog] = useState(false);\n\tconst [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());\n\tconst [isArchiving, setIsArchiving] = useState(false);\n\tconst [unlinkEstimateId, setUnlinkEstimateId] = useState<string | null>(null);\n\tconst [isUnlinking, setIsUnlinking] = useState(false);\n\n\tconst formatCurrencyCents = useCallback(\n\t\t(cents: number) =>\n\t\t\tformatCurrency(cents, {\n\t\t\t\tminimumFractionDigits: 0,\n\t\t\t\tmaximumFractionDigits: 0,\n\t\t\t}),\n\t\t[],\n\t);\n\n\tconst handleArchive = useCallback(async () => {\n\t\tif (selectedIds.size === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsArchiving(true);\n\t\ttry {\n\t\t\tconst result = await bulkArchive(Array.from(selectedIds), \"estimate\");\n\n\t\t\tif (result.success && result.data) {\n\t\t\t\ttoast.success(\n\t\t\t\t\t`Successfully archived ${result.data.archived} estimate${result.data.archived === 1 ? \"\" : \"s\"}`,\n\t\t\t\t);\n\t\t\t\tsetShowArchiveDialog(false);\n\t\t\t\tsetSelectedIds(new Set());\n\t\t\t\t// Soft navigation - Server Component refetches with revalidatePath()\n\t\t\t\trouter.refresh();\n\t\t\t} else {\n\t\t\t\ttoast.error(\"Failed to archive estimates\");\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\ttoast.error(\"Failed to archive estimates\");\n\t\t} finally {\n\t\t\tsetIsArchiving(false);\n\t\t}\n\t}, [selectedIds]);\n\n\tconst handleUnlinkEstimate = useCallback(async () => {\n\t\tif (!unlinkEstimateId) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsUnlinking(true);\n\t\ttry {\n\t\t\tconst result = await unlinkEstimateFromJob(unlinkEstimateId);\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Estimate unlinked from job\");\n\t\t\t\tsetUnlinkEstimateId(null);\n\t\t\t\t// Soft navigation - Server Component refetches with revalidatePath()\n\t\t\t\trouter.refresh();\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to unlink estimate\");\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\ttoast.error(\"Failed to unlink estimate\");\n\t\t} finally {\n\t\t\tsetIsUnlinking(false);\n\t\t}\n\t}, [unlinkEstimateId]);\n\n\tconst columns: ColumnDef<Estimate>[] = useMemo(\n\t\t() => [\n\t\t\t{\n\t\t\t\tkey: \"estimate_number\",\n\t\t\t\theader: \"Estimate #\",\n\t\t\t\twidth: \"w-40\",\n\t\t\t\tshrink: true,\n\t\t\t\trender: (estimate) => (\n\t\t\t\t\t<Link\n\t\t\t\t\t\tclassName=\"text-foreground hover:text-primary truncate text-xs font-medium transition-colors hover:underline\"\n\t\t\t\t\t\thref={`/dashboard/work/estimates/${estimate.id}`}\n\t\t\t\t\t\ttitle={estimate.estimate_number}\n\t\t\t\t\t>\n\t\t\t\t\t\t{estimate.estimate_number}\n\t\t\t\t\t</Link>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"title\",\n\t\t\t\theader: \"Title\",\n\t\t\t\twidth: \"flex-1\",\n\t\t\t\trender: (estimate) => (\n\t\t\t\t\t<Link\n\t\t\t\t\t\tclassName=\"block min-w-0\"\n\t\t\t\t\t\thref={`/dashboard/work/estimates/${estimate.id}`}\n\t\t\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t\t\t\ttitle={estimate.title || undefined}\n\t\t\t\t\t>\n\t\t\t\t\t\t<span className=\"text-foreground truncate text-xs leading-tight font-medium hover:underline\">\n\t\t\t\t\t\t\t{estimate.title || \"—\"}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</Link>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"status\",\n\t\t\t\theader: \"Status\",\n\t\t\t\twidth: \"w-32\",\n\t\t\t\tshrink: true,\n\t\t\t\trender: (estimate) => <EstimateStatusBadge status={estimate.status} />,\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"total_amount\",\n\t\t\t\theader: \"Amount\",\n\t\t\t\twidth: \"w-36\",\n\t\t\t\tshrink: true,\n\t\t\t\talign: \"right\",\n\t\t\t\trender: (estimate) => (\n\t\t\t\t\t<span className=\"text-xs font-semibold tabular-nums\">\n\t\t\t\t\t\t{formatCurrencyCents(estimate.total_amount)}\n\t\t\t\t\t</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"valid_until\",\n\t\t\t\theader: \"Valid Until\",\n\t\t\t\twidth: \"w-36\",\n\t\t\t\tshrink: true,\n\t\t\t\thideOnMobile: true,\n\t\t\t\trender: (estimate) => (\n\t\t\t\t\t<span className=\"text-muted-foreground text-xs tabular-nums\">\n\t\t\t\t\t\t{estimate.valid_until\n\t\t\t\t\t\t\t? formatDate(estimate.valid_until, \"short\")\n\t\t\t\t\t\t\t: \"—\"}\n\t\t\t\t\t</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"actions\",\n\t\t\t\theader: \"\",\n\t\t\t\twidth: \"w-12\",\n\t\t\t\tshrink: true,\n\t\t\t\talign: \"right\",\n\t\t\t\trender: (estimate) => (\n\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t<Button className=\"size-8 p-0\" size=\"sm\" variant=\"ghost\">\n\t\t\t\t\t\t\t\t<MoreHorizontal className=\"size-4\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t<DropdownMenuContent align=\"end\" className=\"w-48\">\n\t\t\t\t\t\t\t<DropdownMenuItem asChild className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t<Link href={`/dashboard/work/estimates/${estimate.id}`}>\n\t\t\t\t\t\t\t\t\t<Eye className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tView Details\n\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t<DropdownMenuItem className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t<Download className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\tDownload PDF\n\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t<DropdownMenuItem className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t<Send className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\tSend to Customer\n\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t<DropdownMenuItem className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t<CheckCircle className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\tConvert to Invoice\n\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\tclassName=\"text-destructive focus:text-destructive cursor-pointer\"\n\t\t\t\t\t\t\t\tonClick={() => setUnlinkEstimateId(estimate.id)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Link2Off className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\tUnlink from Job\n\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t</DropdownMenu>\n\t\t\t\t),\n\t\t\t},\n\t\t],\n\t\t[formatCurrencyCents],\n\t);\n\n\tconst bulkActions: BulkAction[] = useMemo(\n\t\t() => [\n\t\t\t{\n\t\t\t\tlabel: \"Archive Selected\",\n\t\t\t\ticon: <Archive className=\"h-4 w-4\" />,\n\t\t\t\tvariant: \"destructive\",\n\t\t\t\tonClick: (selectedIds: Set<string>) => {\n\t\t\t\t\tsetSelectedIds(selectedIds);\n\t\t\t\t\tsetShowArchiveDialog(true);\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t\t[],\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t<FullWidthDataTable\n\t\t\t\t{...TablePresets.compact()}\n\t\t\t\tbulkActions={bulkActions}\n\t\t\t\tcolumns={columns}\n\t\t\t\tdata={estimates}\n\t\t\t\temptyIcon={<Receipt className=\"text-muted-foreground/50 size-12\" />}\n\t\t\t\temptyMessage=\"No estimates found for this job\"\n\t\t\t\tgetItemId={(estimate) => estimate.id}\n\t\t\t\tnoPadding={true}\n\t\t\t\tsearchFilter={(estimate, query) => {\n\t\t\t\t\tconst searchLower = query.toLowerCase();\n\t\t\t\t\treturn (\n\t\t\t\t\t\testimate.estimate_number?.toLowerCase().includes(searchLower) ||\n\t\t\t\t\t\testimate.title?.toLowerCase().includes(searchLower) ||\n\t\t\t\t\t\testimate.status?.toLowerCase().includes(searchLower)\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t\tsearchPlaceholder=\"Search estimates...\"\n\t\t\t/>\n\n\t\t\t<ArchiveConfirmDialog\n\t\t\t\tentityType=\"estimate\"\n\t\t\t\tisLoading={isArchiving}\n\t\t\t\titemCount={selectedIds.size}\n\t\t\t\tonConfirm={handleArchive}\n\t\t\t\tonOpenChange={setShowArchiveDialog}\n\t\t\t\topen={showArchiveDialog}\n\t\t\t/>\n\n\t\t\t{/* Unlink Confirmation Dialog */}\n\t\t\t<Dialog\n\t\t\t\tonOpenChange={(open) => !open && setUnlinkEstimateId(null)}\n\t\t\t\topen={unlinkEstimateId !== null}\n\t\t\t>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>Unlink Estimate from Job?</DialogTitle>\n\t\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t\tThis will remove the job association from this estimate. The\n\t\t\t\t\t\t\testimate will remain in the system but will no longer appear on\n\t\t\t\t\t\t\tthis job's page.\n\t\t\t\t\t\t</DialogDescription>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isUnlinking}\n\t\t\t\t\t\t\tonClick={() => setUnlinkEstimateId(null)}\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isUnlinking}\n\t\t\t\t\t\t\tonClick={handleUnlinkEstimate}\n\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{isUnlinking ? \"Unlinking...\" : \"Unlink Estimate\"}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</>\n\t);\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"6042209acd3f101dadbb58ed2712921d9bfb412cdf\":\"bulkArchive\"},\"apps/web/src/actions/archive.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var bulkArchive=/*#__PURE__*/createServerReference(\"6042209acd3f101dadbb58ed2712921d9bfb412cdf\",callServer,void 0,findSourceMapURL,\"bulkArchive\");","\"use client\";\n\nimport {\n\tCreditCard,\n\tDownload,\n\tEye,\n\tFileText,\n\tLink2Off,\n\tMoreHorizontal,\n\tSend,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { useCallback, useMemo, useState } from \"react\";\nimport { toast } from \"sonner\";\nimport { unlinkInvoiceFromJob } from \"@/actions/invoices\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDialog,\n\tDialogContent,\n\tDialogDescription,\n\tDialogFooter,\n\tDialogHeader,\n\tDialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n\ttype ColumnDef,\n\tFullWidthDataTable,\n} from \"@/components/ui/full-width-datatable\";\nimport { InvoiceStatusBadge } from \"@/components/ui/status-badge\";\nimport { TablePresets } from \"@/lib/datatable/table-presets\";\nimport { formatCurrency, formatDate } from \"@/lib/formatters\";\n\ntype Invoice = {\n\tid: string;\n\tinvoice_number: string;\n\ttitle?: string;\n\ttotal_amount: number;\n\tpaid_amount: number;\n\tbalance_amount?: number;\n\tstatus: string;\n\tcreated_at: string;\n\tdue_date?: string;\n};\n\ntype JobInvoicesTableProps = {\n\tinvoices: Invoice[];\n};\n\nexport function JobInvoicesTable({ invoices }: JobInvoicesTableProps) {\n\tconst router = useRouter();\n\tconst [unlinkInvoiceId, setUnlinkInvoiceId] = useState<string | null>(null);\n\tconst [isUnlinking, setIsUnlinking] = useState(false);\n\n\tconst formatCurrencyCents = useCallback(\n\t\t(cents: number) =>\n\t\t\tformatCurrency(cents, {\n\t\t\t\tminimumFractionDigits: 0,\n\t\t\t\tmaximumFractionDigits: 0,\n\t\t\t}),\n\t\t[],\n\t);\n\n\tconst handleUnlinkInvoice = useCallback(async () => {\n\t\tif (!unlinkInvoiceId) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsUnlinking(true);\n\t\ttry {\n\t\t\tconst result = await unlinkInvoiceFromJob(unlinkInvoiceId);\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Invoice unlinked from job\");\n\t\t\t\tsetUnlinkInvoiceId(null);\n\t\t\t\t// Soft navigation - Server Component refetches with revalidatePath()\n\t\t\t\trouter.refresh();\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to unlink invoice\");\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\ttoast.error(\"Failed to unlink invoice\");\n\t\t} finally {\n\t\t\tsetIsUnlinking(false);\n\t\t}\n\t}, [unlinkInvoiceId, router]);\n\n\tconst columns: ColumnDef<Invoice>[] = useMemo(\n\t\t() => [\n\t\t\t{\n\t\t\t\tkey: \"invoice_number\",\n\t\t\t\theader: \"Invoice #\",\n\t\t\t\twidth: \"w-32\",\n\t\t\t\tshrink: true,\n\t\t\t\trender: (invoice) => (\n\t\t\t\t\t<Link\n\t\t\t\t\t\tclassName=\"text-foreground text-xs leading-tight font-medium hover:underline\"\n\t\t\t\t\t\thref={`/dashboard/work/invoices/${invoice.id}`}\n\t\t\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t\t\t>\n\t\t\t\t\t\t{invoice.invoice_number}\n\t\t\t\t\t</Link>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"title\",\n\t\t\t\theader: \"Title\",\n\t\t\t\trender: (invoice) => (\n\t\t\t\t\t<Link\n\t\t\t\t\t\tclassName=\"text-foreground text-xs leading-tight font-medium hover:underline\"\n\t\t\t\t\t\thref={`/dashboard/work/invoices/${invoice.id}`}\n\t\t\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t\t\t>\n\t\t\t\t\t\t{invoice.title || \"—\"}\n\t\t\t\t\t</Link>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"status\",\n\t\t\t\theader: \"Status\",\n\t\t\t\twidth: \"w-24\",\n\t\t\t\tshrink: true,\n\t\t\t\trender: (invoice) => <InvoiceStatusBadge status={invoice.status} />,\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"total_amount\",\n\t\t\t\theader: \"Amount\",\n\t\t\t\twidth: \"w-32\",\n\t\t\t\tshrink: true,\n\t\t\t\talign: \"right\",\n\t\t\t\trender: (invoice) => (\n\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t{formatCurrencyCents(invoice.total_amount)}\n\t\t\t\t\t</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"balance_amount\",\n\t\t\t\theader: \"Balance\",\n\t\t\t\twidth: \"w-32\",\n\t\t\t\tshrink: true,\n\t\t\t\talign: \"right\",\n\t\t\t\trender: (invoice) => {\n\t\t\t\t\tconst balance =\n\t\t\t\t\t\tinvoice.balance_amount ??\n\t\t\t\t\t\tinvoice.total_amount - invoice.paid_amount;\n\t\t\t\t\treturn balance > 0 ? (\n\t\t\t\t\t\t<span className=\"text-destructive font-medium\">\n\t\t\t\t\t\t\t{formatCurrencyCents(balance)}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs\">Paid</span>\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"due_date\",\n\t\t\t\theader: \"Due Date\",\n\t\t\t\twidth: \"w-28\",\n\t\t\t\tshrink: true,\n\t\t\t\thideOnMobile: true,\n\t\t\t\trender: (invoice) => (\n\t\t\t\t\t<span className=\"text-xs\">\n\t\t\t\t\t\t{formatDate(invoice.due_date, \"short\")}\n\t\t\t\t\t</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"actions\",\n\t\t\t\theader: \"\",\n\t\t\t\twidth: \"w-12\",\n\t\t\t\tshrink: true,\n\t\t\t\talign: \"right\",\n\t\t\t\trender: (invoice) => {\n\t\t\t\t\tconst balance =\n\t\t\t\t\t\tinvoice.balance_amount ??\n\t\t\t\t\t\tinvoice.total_amount - invoice.paid_amount;\n\t\t\t\t\tconst canPay = invoice.status !== \"paid\" && balance > 0;\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t\t<Button className=\"size-8 p-0\" size=\"sm\" variant=\"ghost\">\n\t\t\t\t\t\t\t\t\t<MoreHorizontal className=\"size-4\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t\t<DropdownMenuContent align=\"end\" className=\"w-48\">\n\t\t\t\t\t\t\t\t<DropdownMenuItem className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t\t<Eye className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tView Details\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuItem className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t\t<Download className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tDownload PDF\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t<DropdownMenuItem className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t\t<Send className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tSend to Customer\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t{canPay && (\n\t\t\t\t\t\t\t\t\t<DropdownMenuItem className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t\t\t<CreditCard className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\t\tRecord Payment\n\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\tclassName=\"text-destructive focus:text-destructive cursor-pointer\"\n\t\t\t\t\t\t\t\t\tonClick={() => setUnlinkInvoiceId(invoice.id)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Link2Off className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tUnlink from Job\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t\t</DropdownMenu>\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t\t[formatCurrencyCents],\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t<FullWidthDataTable\n\t\t\t\t{...TablePresets.compact()}\n\t\t\t\tcolumns={columns}\n\t\t\t\tdata={invoices}\n\t\t\t\temptyIcon={<FileText className=\"text-muted-foreground/50 size-12\" />}\n\t\t\t\temptyMessage=\"No invoices found for this job\"\n\t\t\t\tgetItemId={(invoice) => invoice.id}\n\t\t\t\tnoPadding={true}\n\t\t\t\tsearchFilter={(invoice, query) => {\n\t\t\t\t\tconst searchLower = query.toLowerCase();\n\t\t\t\t\treturn (\n\t\t\t\t\t\tinvoice.invoice_number?.toLowerCase().includes(searchLower) ||\n\t\t\t\t\t\tinvoice.title?.toLowerCase().includes(searchLower) ||\n\t\t\t\t\t\tinvoice.status?.toLowerCase().includes(searchLower)\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t\tsearchPlaceholder=\"Search invoices...\"\n\t\t\t/>\n\n\t\t\t{/* Unlink Confirmation Dialog */}\n\t\t\t<Dialog\n\t\t\t\tonOpenChange={(open) => !open && setUnlinkInvoiceId(null)}\n\t\t\t\topen={unlinkInvoiceId !== null}\n\t\t\t>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>Unlink Invoice from Job?</DialogTitle>\n\t\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t\tThis will remove the job association from this invoice. The\n\t\t\t\t\t\t\tinvoice will remain in the system but will no longer appear on\n\t\t\t\t\t\t\tthis job's page.\n\t\t\t\t\t\t</DialogDescription>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isUnlinking}\n\t\t\t\t\t\t\tonClick={() => setUnlinkInvoiceId(null)}\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isUnlinking}\n\t\t\t\t\t\t\tonClick={handleUnlinkInvoice}\n\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{isUnlinking ? \"Unlinking...\" : \"Unlink Invoice\"}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</>\n\t);\n}\n","\"use client\";\n\nimport {\n\tAlertCircle,\n\tArchive,\n\tEdit,\n\tEye,\n\tFileText,\n\tFlag,\n\tMoreHorizontal,\n\tTrash2,\n} from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\nimport { useCallback, useMemo, useState } from \"react\";\nimport { toast } from \"sonner\";\nimport { bulkArchive } from \"@/actions/archive\";\nimport { ArchiveConfirmDialog } from \"@/components/ui/archive-confirm-dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDialog,\n\tDialogContent,\n\tDialogDescription,\n\tDialogFooter,\n\tDialogHeader,\n\tDialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n\ttype BulkAction,\n\ttype ColumnDef,\n\tFullWidthDataTable,\n} from \"@/components/ui/full-width-datatable\";\nimport { TablePresets } from \"@/lib/datatable/table-presets\";\nimport { formatDate } from \"@/lib/formatters\";\n\ntype JobNote = {\n\tid: string;\n\tcontent: string;\n\tnote_type?: string;\n\tis_important?: boolean;\n\tcreated_by_name?: string;\n\tcreated_at: string;\n};\n\ntype JobNotesTableProps = {\n\tnotes: JobNote[];\n\tonDeleteNote?: (\n\t\tnoteId: string,\n\t) => Promise<{ success: boolean; error?: string }>;\n};\n\nexport function JobNotesTable({ notes, onDeleteNote }: JobNotesTableProps) {\n\tconst router = useRouter();\n\tconst [deleteNoteId, setDeleteNoteId] = useState<string | null>(null);\n\tconst [viewNoteId, setViewNoteId] = useState<string | null>(null);\n\tconst [isDeleting, setIsDeleting] = useState(false);\n\tconst [showArchiveDialog, setShowArchiveDialog] = useState(false);\n\tconst [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());\n\tconst [isArchiving, setIsArchiving] = useState(false);\n\n\tconst handleDeleteNote = useCallback(async () => {\n\t\tif (!deleteNoteId || !onDeleteNote) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsDeleting(true);\n\t\ttry {\n\t\t\tconst result = await onDeleteNote(deleteNoteId);\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Note deleted\");\n\t\t\t\tsetDeleteNoteId(null);\n\t\t\t\t// Refresh to show updated list\n\t\t\t\trouter.refresh();\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to delete note\");\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\ttoast.error(\"Failed to delete note\");\n\t\t} finally {\n\t\t\tsetIsDeleting(false);\n\t\t}\n\t}, [deleteNoteId, onDeleteNote, router]);\n\n\tconst handleArchive = useCallback(async () => {\n\t\tif (selectedIds.size === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsArchiving(true);\n\t\ttry {\n\t\t\tconst result = await bulkArchive(Array.from(selectedIds), \"job_note\");\n\n\t\t\tif (result.success && result.data) {\n\t\t\t\ttoast.success(\n\t\t\t\t\t`Successfully archived ${result.data.archived} note${result.data.archived === 1 ? \"\" : \"s\"}`,\n\t\t\t\t);\n\t\t\t\tsetShowArchiveDialog(false);\n\t\t\t\tsetSelectedIds(new Set());\n\t\t\t\trouter.refresh();\n\t\t\t} else {\n\t\t\t\ttoast.error(\"Failed to archive notes\");\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\ttoast.error(\"Failed to archive notes\");\n\t\t} finally {\n\t\t\tsetIsArchiving(false);\n\t\t}\n\t}, [selectedIds, router]);\n\n\tconst getNoteTypeDisplay = useCallback((type?: string) => {\n\t\tif (!type) return \"General\";\n\t\t// Convert snake_case or kebab-case to Title Case\n\t\treturn type\n\t\t\t.split(/[-_]/)\n\t\t\t.map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n\t\t\t.join(\" \");\n\t}, []);\n\n\tconst truncateContent = useCallback((content: string, maxLength = 100) => {\n\t\tif (content.length <= maxLength) return content;\n\t\treturn `${content.substring(0, maxLength)}...`;\n\t}, []);\n\n\tconst viewedNote = useMemo(\n\t\t() => notes.find((note) => note.id === viewNoteId),\n\t\t[notes, viewNoteId],\n\t);\n\n\tconst bulkActions: BulkAction[] = useMemo(\n\t\t() => [\n\t\t\t{\n\t\t\t\tlabel: \"Archive Selected\",\n\t\t\t\ticon: <Archive className=\"h-4 w-4\" />,\n\t\t\t\tvariant: \"destructive\",\n\t\t\t\tonClick: (selectedIds: Set<string>) => {\n\t\t\t\t\tsetSelectedIds(selectedIds);\n\t\t\t\t\tsetShowArchiveDialog(true);\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t\t[],\n\t);\n\n\tconst columns: ColumnDef<JobNote>[] = useMemo(\n\t\t() => [\n\t\t\t{\n\t\t\t\tkey: \"content\",\n\t\t\t\theader: \"Note\",\n\t\t\t\trender: (note) => (\n\t\t\t\t\t<div className=\"flex items-start gap-2\">\n\t\t\t\t\t\t{note.is_important && (\n\t\t\t\t\t\t\t<Flag className=\"text-destructive mt-0.5 size-4 shrink-0 fill-current\" />\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t<div className=\"flex flex-col gap-1\">\n\t\t\t\t\t\t\t<span className=\"text-xs leading-tight\">\n\t\t\t\t\t\t\t\t{truncateContent(note.content)}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t{note.content.length > 100 && (\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclassName=\"text-primary text-xs font-medium hover:underline\"\n\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\tsetViewNoteId(note.id);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tRead more\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"note_type\",\n\t\t\t\theader: \"Type\",\n\t\t\t\twidth: \"w-28\",\n\t\t\t\tshrink: true,\n\t\t\t\thideOnMobile: true,\n\t\t\t\trender: (note) => (\n\t\t\t\t\t<Badge variant=\"outline\" className=\"font-normal\">\n\t\t\t\t\t\t{getNoteTypeDisplay(note.note_type)}\n\t\t\t\t\t</Badge>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"is_important\",\n\t\t\t\theader: \"Important\",\n\t\t\t\twidth: \"w-24\",\n\t\t\t\tshrink: true,\n\t\t\t\thideOnMobile: true,\n\t\t\t\talign: \"center\",\n\t\t\t\trender: (note) =>\n\t\t\t\t\tnote.is_important ? (\n\t\t\t\t\t\t<Flag className=\"text-destructive size-4 fill-current\" />\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs\">—</span>\n\t\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"created_by_name\",\n\t\t\t\theader: \"Author\",\n\t\t\t\twidth: \"w-36\",\n\t\t\t\tshrink: true,\n\t\t\t\thideOnMobile: true,\n\t\t\t\trender: (note) => (\n\t\t\t\t\t<span className=\"text-xs\">{note.created_by_name || \"Unknown\"}</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"created_at\",\n\t\t\t\theader: \"Date\",\n\t\t\t\twidth: \"w-32\",\n\t\t\t\tshrink: true,\n\t\t\t\trender: (note) => (\n\t\t\t\t\t<span className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t{formatDate(note.created_at, \"short\")}\n\t\t\t\t\t</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"actions\",\n\t\t\t\theader: \"\",\n\t\t\t\twidth: \"w-12\",\n\t\t\t\tshrink: true,\n\t\t\t\talign: \"right\",\n\t\t\t\trender: (note) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t\t<Button className=\"size-8 p-0\" size=\"sm\" variant=\"ghost\">\n\t\t\t\t\t\t\t\t\t<MoreHorizontal className=\"size-4\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t\t<DropdownMenuContent align=\"end\" className=\"w-48\">\n\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\tclassName=\"cursor-pointer\"\n\t\t\t\t\t\t\t\t\tonClick={() => setViewNoteId(note.id)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Eye className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tView Full Note\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t<DropdownMenuItem className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t\t<Edit className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tEdit Note\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\tclassName=\"text-destructive focus:text-destructive cursor-pointer\"\n\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\tsetSelectedIds(new Set([note.id]));\n\t\t\t\t\t\t\t\t\t\tsetShowArchiveDialog(true);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Archive className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tArchive Note\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t{onDeleteNote && (\n\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-destructive focus:text-destructive cursor-pointer\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteNoteId(note.id)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\t\t\tDelete Note\n\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t\t</DropdownMenu>\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t\t[truncateContent, getNoteTypeDisplay, onDeleteNote],\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t<FullWidthDataTable\n\t\t\t\t{...TablePresets.compact()}\n\t\t\t\tbulkActions={bulkActions}\n\t\t\t\tcolumns={columns}\n\t\t\t\tdata={notes}\n\t\t\t\temptyIcon={<FileText className=\"text-muted-foreground/50 size-12\" />}\n\t\t\t\temptyMessage=\"No notes found for this job\"\n\t\t\t\tgetItemId={(note) => note.id}\n\t\t\t\tnoPadding={true}\n\t\t\t\tsearchFilter={(note, query) => {\n\t\t\t\t\tconst searchLower = query.toLowerCase();\n\t\t\t\t\treturn (\n\t\t\t\t\t\tnote.content.toLowerCase().includes(searchLower) ||\n\t\t\t\t\t\tnote.note_type?.toLowerCase().includes(searchLower) ||\n\t\t\t\t\t\tnote.created_by_name?.toLowerCase().includes(searchLower)\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t\tsearchPlaceholder=\"Search notes...\"\n\t\t\t\tgetRowClassName={(note) =>\n\t\t\t\t\tnote.is_important ? \"border-l-2 border-l-destructive\" : \"\"\n\t\t\t\t}\n\t\t\t/>\n\n\t\t\t<ArchiveConfirmDialog\n\t\t\t\tentityType=\"note\"\n\t\t\t\tisLoading={isArchiving}\n\t\t\t\titemCount={selectedIds.size}\n\t\t\t\tonConfirm={handleArchive}\n\t\t\t\tonOpenChange={setShowArchiveDialog}\n\t\t\t\topen={showArchiveDialog}\n\t\t\t/>\n\n\t\t\t{/* View Note Dialog */}\n\t\t\t<Dialog\n\t\t\t\tonOpenChange={(open) => !open && setViewNoteId(null)}\n\t\t\t\topen={viewNoteId !== null}\n\t\t\t>\n\t\t\t\t<DialogContent className=\"max-w-2xl\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t{viewedNote?.is_important && (\n\t\t\t\t\t\t\t\t<Flag className=\"text-destructive size-5 fill-current\" />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\tNote Details\n\t\t\t\t\t\t</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t{viewedNote && (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground mb-1 text-xs font-medium tracking-wide uppercase\">\n\t\t\t\t\t\t\t\t\tType\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<Badge variant=\"outline\">\n\t\t\t\t\t\t\t\t\t{getNoteTypeDisplay(viewedNote.note_type)}\n\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground mb-1 text-xs font-medium tracking-wide uppercase\">\n\t\t\t\t\t\t\t\t\tContent\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<p className=\"text-foreground text-xs leading-relaxed whitespace-pre-wrap\">\n\t\t\t\t\t\t\t\t\t{viewedNote.content}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"border-border/40 flex items-center justify-between border-t pt-3\">\n\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\tCreated by{\" \"}\n\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t\t{viewedNote.created_by_name || \"Unknown\"}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t{formatDate(viewedNote.created_at, \"datetime\")}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button onClick={() => setViewNoteId(null)} variant=\"outline\">\n\t\t\t\t\t\t\tClose\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t{/* Delete Confirmation Dialog */}\n\t\t\t<Dialog\n\t\t\t\tonOpenChange={(open) => !open && setDeleteNoteId(null)}\n\t\t\t\topen={deleteNoteId !== null}\n\t\t\t>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>Delete Note?</DialogTitle>\n\t\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t\tThis will permanently delete this note. This action cannot be\n\t\t\t\t\t\t\tundone. Are you sure you want to continue?\n\t\t\t\t\t\t</DialogDescription>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isDeleting}\n\t\t\t\t\t\t\tonClick={() => setDeleteNoteId(null)}\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isDeleting}\n\t\t\t\t\t\t\tonClick={handleDeleteNote}\n\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{isDeleting ? \"Deleting...\" : \"Delete Note\"}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</>\n\t);\n}\n","\"use client\";\n\nimport {\n\tArchive,\n\tCreditCard,\n\tDownload,\n\tEdit,\n\tEye,\n\tLink2Off,\n\tMoreHorizontal,\n\tTrash2,\n} from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\nimport { useCallback, useMemo, useState } from \"react\";\nimport { toast } from \"sonner\";\nimport { bulkArchive } from \"@/actions/archive\";\nimport { unlinkPaymentFromJob } from \"@/actions/payments\";\nimport { ArchiveConfirmDialog } from \"@/components/ui/archive-confirm-dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDialog,\n\tDialogContent,\n\tDialogDescription,\n\tDialogFooter,\n\tDialogHeader,\n\tDialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n\ttype BulkAction,\n\ttype ColumnDef,\n\tFullWidthDataTable,\n} from \"@/components/ui/full-width-datatable\";\nimport { TablePresets } from \"@/lib/datatable/table-presets\";\nimport { formatCurrency, formatDate } from \"@/lib/formatters\";\n\ntype Payment = {\n\tid: string;\n\tamount: number; // in cents\n\tpayment_method?: string;\n\treference_number?: string;\n\tnotes?: string;\n\tcreated_at: string;\n\tpayment_date?: string;\n};\n\ntype JobPaymentsTableProps = {\n\tpayments: Payment[];\n\tonDeletePayment?: (\n\t\tpaymentId: string,\n\t) => Promise<{ success: boolean; error?: string }>;\n};\n\nexport function JobPaymentsTable({\n\tpayments,\n\tonDeletePayment,\n}: JobPaymentsTableProps) {\n\tconst router = useRouter();\n\tconst [deletePaymentId, setDeletePaymentId] = useState<string | null>(null);\n\tconst [isDeleting, setIsDeleting] = useState(false);\n\tconst [showArchiveDialog, setShowArchiveDialog] = useState(false);\n\tconst [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());\n\tconst [isArchiving, setIsArchiving] = useState(false);\n\tconst [unlinkPaymentId, setUnlinkPaymentId] = useState<string | null>(null);\n\tconst [isUnlinking, setIsUnlinking] = useState(false);\n\n\tconst formatCurrencyCents = useCallback(\n\t\t(cents: number) =>\n\t\t\tformatCurrency(cents, {\n\t\t\t\tminimumFractionDigits: 2,\n\t\t\t\tmaximumFractionDigits: 2,\n\t\t\t}),\n\t\t[],\n\t);\n\n\tconst handleArchive = useCallback(async () => {\n\t\tif (selectedIds.size === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsArchiving(true);\n\t\ttry {\n\t\t\tconst result = await bulkArchive(Array.from(selectedIds), \"payment\");\n\n\t\t\tif (result.success && result.data) {\n\t\t\t\ttoast.success(\n\t\t\t\t\t`Successfully archived ${result.data.archived} payment${result.data.archived === 1 ? \"\" : \"s\"}`,\n\t\t\t\t);\n\t\t\t\tsetShowArchiveDialog(false);\n\t\t\t\tsetSelectedIds(new Set());\n\t\t\t\trouter.refresh();\n\t\t\t} else {\n\t\t\t\ttoast.error(\"Failed to archive payments\");\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\ttoast.error(\"Failed to archive payments\");\n\t\t} finally {\n\t\t\tsetIsArchiving(false);\n\t\t}\n\t}, [selectedIds, router]);\n\n\tconst handleUnlinkPayment = useCallback(async () => {\n\t\tif (!unlinkPaymentId) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsUnlinking(true);\n\t\ttry {\n\t\t\tconst result = await unlinkPaymentFromJob(unlinkPaymentId);\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Payment unlinked from job\");\n\t\t\t\tsetUnlinkPaymentId(null);\n\t\t\t\trouter.refresh();\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to unlink payment\");\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\ttoast.error(\"Failed to unlink payment\");\n\t\t} finally {\n\t\t\tsetIsUnlinking(false);\n\t\t}\n\t}, [unlinkPaymentId, router]);\n\n\tconst handleDeletePayment = useCallback(async () => {\n\t\tif (!deletePaymentId || !onDeletePayment) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsDeleting(true);\n\t\ttry {\n\t\t\tconst result = await onDeletePayment(deletePaymentId);\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Payment deleted\");\n\t\t\t\tsetDeletePaymentId(null);\n\t\t\t\t// Refresh to show updated list\n\t\t\t\trouter.refresh();\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to delete payment\");\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\ttoast.error(\"Failed to delete payment\");\n\t\t} finally {\n\t\t\tsetIsDeleting(false);\n\t\t}\n\t}, [deletePaymentId, onDeletePayment, router]);\n\n\tconst getPaymentMethodDisplay = useCallback((method?: string) => {\n\t\tif (!method) return \"—\";\n\t\t// Convert snake_case or kebab-case to Title Case\n\t\treturn method\n\t\t\t.split(/[-_]/)\n\t\t\t.map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n\t\t\t.join(\" \");\n\t}, []);\n\n\tconst bulkActions: BulkAction[] = useMemo(\n\t\t() => [\n\t\t\t{\n\t\t\t\tlabel: \"Archive Selected\",\n\t\t\t\ticon: <Archive className=\"h-4 w-4\" />,\n\t\t\t\tvariant: \"destructive\",\n\t\t\t\tonClick: (selectedIds: Set<string>) => {\n\t\t\t\t\tsetSelectedIds(selectedIds);\n\t\t\t\t\tsetShowArchiveDialog(true);\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t\t[],\n\t);\n\n\tconst columns: ColumnDef<Payment>[] = useMemo(\n\t\t() => [\n\t\t\t{\n\t\t\t\tkey: \"payment_date\",\n\t\t\t\theader: \"Date\",\n\t\t\t\twidth: \"w-32\",\n\t\t\t\tshrink: true,\n\t\t\t\trender: (payment) => (\n\t\t\t\t\t<span className=\"text-xs font-medium\">\n\t\t\t\t\t\t{formatDate(payment.payment_date || payment.created_at, \"short\")}\n\t\t\t\t\t</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"amount\",\n\t\t\t\theader: \"Amount\",\n\t\t\t\twidth: \"w-32\",\n\t\t\t\tshrink: true,\n\t\t\t\talign: \"right\",\n\t\t\t\trender: (payment) => (\n\t\t\t\t\t<span className=\"font-semibold\">\n\t\t\t\t\t\t{formatCurrencyCents(payment.amount)}\n\t\t\t\t\t</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"payment_method\",\n\t\t\t\theader: \"Method\",\n\t\t\t\twidth: \"w-32\",\n\t\t\t\tshrink: true,\n\t\t\t\thideOnMobile: true,\n\t\t\t\trender: (payment) => (\n\t\t\t\t\t<span className=\"text-xs\">\n\t\t\t\t\t\t{getPaymentMethodDisplay(payment.payment_method)}\n\t\t\t\t\t</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"reference_number\",\n\t\t\t\theader: \"Reference\",\n\t\t\t\twidth: \"w-36\",\n\t\t\t\tshrink: true,\n\t\t\t\thideOnMobile: true,\n\t\t\t\trender: (payment) => (\n\t\t\t\t\t<span className=\"text-muted-foreground font-mono text-xs\">\n\t\t\t\t\t\t{payment.reference_number || \"—\"}\n\t\t\t\t\t</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"notes\",\n\t\t\t\theader: \"Notes\",\n\t\t\t\trender: (payment) => (\n\t\t\t\t\t<span className=\"text-muted-foreground line-clamp-1 text-xs\">\n\t\t\t\t\t\t{payment.notes || \"—\"}\n\t\t\t\t\t</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"actions\",\n\t\t\t\theader: \"\",\n\t\t\t\twidth: \"w-12\",\n\t\t\t\tshrink: true,\n\t\t\t\talign: \"right\",\n\t\t\t\trender: (payment) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t\t<Button className=\"size-8 p-0\" size=\"sm\" variant=\"ghost\">\n\t\t\t\t\t\t\t\t\t<MoreHorizontal className=\"size-4\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t\t<DropdownMenuContent align=\"end\" className=\"w-48\">\n\t\t\t\t\t\t\t\t<DropdownMenuItem className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t\t<Eye className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tView Details\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuItem className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t\t<Download className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tDownload Receipt\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t<DropdownMenuItem className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t\t<Edit className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tEdit Payment\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\tclassName=\"text-destructive focus:text-destructive cursor-pointer\"\n\t\t\t\t\t\t\t\t\tonClick={() => setUnlinkPaymentId(payment.id)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Link2Off className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tUnlink from Job\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t{onDeletePayment && (\n\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-destructive focus:text-destructive cursor-pointer\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeletePaymentId(payment.id)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\t\t\tDelete Payment\n\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t\t</DropdownMenu>\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t\t[formatCurrencyCents, getPaymentMethodDisplay, onDeletePayment],\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t<FullWidthDataTable\n\t\t\t\t{...TablePresets.compact()}\n\t\t\t\tbulkActions={bulkActions}\n\t\t\t\tcolumns={columns}\n\t\t\t\tdata={payments}\n\t\t\t\temptyIcon={<CreditCard className=\"text-muted-foreground/50 size-12\" />}\n\t\t\t\temptyMessage=\"No payments found for this job\"\n\t\t\t\tgetItemId={(payment) => payment.id}\n\t\t\t\tnoPadding={true}\n\t\t\t\tsearchFilter={(payment, query) => {\n\t\t\t\t\tconst searchLower = query.toLowerCase();\n\t\t\t\t\treturn (\n\t\t\t\t\t\tpayment.reference_number?.toLowerCase().includes(searchLower) ||\n\t\t\t\t\t\tpayment.payment_method?.toLowerCase().includes(searchLower) ||\n\t\t\t\t\t\tpayment.notes?.toLowerCase().includes(searchLower) ||\n\t\t\t\t\t\tformatCurrencyCents(payment.amount)\n\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t.includes(searchLower)\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t\tsearchPlaceholder=\"Search payments...\"\n\t\t\t/>\n\n\t\t\t<ArchiveConfirmDialog\n\t\t\t\tentityType=\"payment\"\n\t\t\t\tisLoading={isArchiving}\n\t\t\t\titemCount={selectedIds.size}\n\t\t\t\tonConfirm={handleArchive}\n\t\t\t\tonOpenChange={setShowArchiveDialog}\n\t\t\t\topen={showArchiveDialog}\n\t\t\t/>\n\n\t\t\t{/* Unlink Confirmation Dialog */}\n\t\t\t<Dialog\n\t\t\t\tonOpenChange={(open) => !open && setUnlinkPaymentId(null)}\n\t\t\t\topen={unlinkPaymentId !== null}\n\t\t\t>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>Unlink Payment from Job?</DialogTitle>\n\t\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t\tThis will remove the job association from this payment. The\n\t\t\t\t\t\t\tpayment will remain in the system but will no longer appear on\n\t\t\t\t\t\t\tthis job's page.\n\t\t\t\t\t\t</DialogDescription>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isUnlinking}\n\t\t\t\t\t\t\tonClick={() => setUnlinkPaymentId(null)}\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isUnlinking}\n\t\t\t\t\t\t\tonClick={handleUnlinkPayment}\n\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{isUnlinking ? \"Unlinking...\" : \"Unlink Payment\"}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t{/* Delete Confirmation Dialog */}\n\t\t\t{onDeletePayment && (\n\t\t\t\t<Dialog\n\t\t\t\t\tonOpenChange={(open) => !open && setDeletePaymentId(null)}\n\t\t\t\t\topen={deletePaymentId !== null}\n\t\t\t\t>\n\t\t\t\t\t<DialogContent>\n\t\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t\t<DialogTitle>Delete Payment?</DialogTitle>\n\t\t\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t\t\tThis will permanently delete this payment record. This action\n\t\t\t\t\t\t\t\tcannot be undone. Are you sure you want to continue?\n\t\t\t\t\t\t\t</DialogDescription>\n\t\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tdisabled={isDeleting}\n\t\t\t\t\t\t\t\tonClick={() => setDeletePaymentId(null)}\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tdisabled={isDeleting}\n\t\t\t\t\t\t\t\tonClick={handleDeletePayment}\n\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{isDeleting ? \"Deleting...\" : \"Delete Payment\"}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</DialogFooter>\n\t\t\t\t\t</DialogContent>\n\t\t\t\t</Dialog>\n\t\t\t)}\n\t\t</>\n\t);\n}\n","\"use client\";\n\nimport {\n\tArchive,\n\tDownload,\n\tEye,\n\tMoreHorizontal,\n\tPackage,\n\tSend,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { useCallback, useMemo, useState } from \"react\";\nimport { toast } from \"sonner\";\nimport { bulkArchive } from \"@/actions/archive\";\nimport { ArchiveConfirmDialog } from \"@/components/ui/archive-confirm-dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n\ttype BulkAction,\n\ttype ColumnDef,\n\tFullWidthDataTable,\n} from \"@/components/ui/full-width-datatable\";\nimport { StatusBadge } from \"@/components/ui/status-badge\";\nimport { TablePresets } from \"@/lib/datatable/table-presets\";\nimport { formatCurrency, formatDate } from \"@/lib/formatters\";\n\ntype PurchaseOrder = {\n\tid: string;\n\tpo_number: string;\n\ttitle?: string;\n\tvendor: string;\n\tvendor_email?: string;\n\ttotal_amount: number;\n\tstatus: string;\n\tcreated_at: string;\n\texpected_delivery?: string | null;\n\tauto_generated?: boolean;\n};\n\ntype JobPurchaseOrdersTableProps = {\n\tpurchaseOrders: PurchaseOrder[];\n};\n\nexport function JobPurchaseOrdersTable({\n\tpurchaseOrders,\n}: JobPurchaseOrdersTableProps) {\n\tconst router = useRouter();\n\tconst [showArchiveDialog, setShowArchiveDialog] = useState(false);\n\tconst [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());\n\tconst [isArchiving, setIsArchiving] = useState(false);\n\n\tconst formatCurrencyCents = useCallback(\n\t\t(cents: number) =>\n\t\t\tformatCurrency(cents, {\n\t\t\t\tminimumFractionDigits: 0,\n\t\t\t\tmaximumFractionDigits: 0,\n\t\t\t}),\n\t\t[],\n\t);\n\n\tconst handleArchive = useCallback(async () => {\n\t\tif (selectedIds.size === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsArchiving(true);\n\t\ttry {\n\t\t\tconst result = await bulkArchive(\n\t\t\t\tArray.from(selectedIds),\n\t\t\t\t\"purchase_order\",\n\t\t\t);\n\n\t\t\tif (result.success && result.data) {\n\t\t\t\ttoast.success(\n\t\t\t\t\t`Successfully archived ${result.data.archived} purchase order${result.data.archived === 1 ? \"\" : \"s\"}`,\n\t\t\t\t);\n\t\t\t\tsetShowArchiveDialog(false);\n\t\t\t\tsetSelectedIds(new Set());\n\t\t\t\t// Soft navigation - Server Component refetches with revalidatePath()\n\t\t\t\trouter.refresh();\n\t\t\t} else {\n\t\t\t\ttoast.error(\"Failed to archive purchase orders\");\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\ttoast.error(\"Failed to archive purchase orders\");\n\t\t} finally {\n\t\t\tsetIsArchiving(false);\n\t\t}\n\t}, [selectedIds]);\n\n\tconst columns: ColumnDef<PurchaseOrder>[] = useMemo(\n\t\t() => [\n\t\t\t{\n\t\t\t\tkey: \"po_number\",\n\t\t\t\theader: \"PO #\",\n\t\t\t\twidth: \"w-40\",\n\t\t\t\tshrink: true,\n\t\t\t\trender: (po) => (\n\t\t\t\t\t<div className=\"flex min-w-0 items-center gap-2\">\n\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\tclassName=\"text-foreground hover:text-primary truncate text-xs font-medium transition-colors hover:underline\"\n\t\t\t\t\t\t\thref={`/dashboard/work/purchase-orders/${po.id}`}\n\t\t\t\t\t\t\ttitle={po.po_number}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{po.po_number}\n\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t{po.auto_generated && (\n\t\t\t\t\t\t\t<Badge className=\"shrink-0 text-xs\" variant=\"outline\">\n\t\t\t\t\t\t\t\tAuto\n\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"title\",\n\t\t\t\theader: \"Title\",\n\t\t\t\twidth: \"flex-1\",\n\t\t\t\trender: (po) => (\n\t\t\t\t\t<Link\n\t\t\t\t\t\tclassName=\"block min-w-0\"\n\t\t\t\t\t\thref={`/dashboard/work/purchase-orders/${po.id}`}\n\t\t\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t\t\t\ttitle={po.title || undefined}\n\t\t\t\t\t>\n\t\t\t\t\t\t<span className=\"text-foreground truncate text-xs leading-tight font-medium hover:underline\">\n\t\t\t\t\t\t\t{po.title || \"—\"}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</Link>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"vendor\",\n\t\t\t\theader: \"Vendor\",\n\t\t\t\twidth: \"w-48\",\n\t\t\t\tshrink: true,\n\t\t\t\trender: (po) => (\n\t\t\t\t\t<span\n\t\t\t\t\t\tclassName=\"text-foreground block truncate text-xs\"\n\t\t\t\t\t\ttitle={po.vendor}\n\t\t\t\t\t>\n\t\t\t\t\t\t{po.vendor}\n\t\t\t\t\t</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"status\",\n\t\t\t\theader: \"Status\",\n\t\t\t\twidth: \"w-32\",\n\t\t\t\tshrink: true,\n\t\t\t\trender: (po) => (\n\t\t\t\t\t<StatusBadge status={po.status} type=\"purchase_order\" />\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"total_amount\",\n\t\t\t\theader: \"Amount\",\n\t\t\t\twidth: \"w-36\",\n\t\t\t\tshrink: true,\n\t\t\t\talign: \"right\",\n\t\t\t\trender: (po) => (\n\t\t\t\t\t<span className=\"text-xs font-semibold tabular-nums\">\n\t\t\t\t\t\t{formatCurrencyCents(po.total_amount)}\n\t\t\t\t\t</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"expected_delivery\",\n\t\t\t\theader: \"Expected Delivery\",\n\t\t\t\twidth: \"w-40\",\n\t\t\t\tshrink: true,\n\t\t\t\thideOnMobile: true,\n\t\t\t\trender: (po) => (\n\t\t\t\t\t<span className=\"text-muted-foreground text-xs tabular-nums\">\n\t\t\t\t\t\t{po.expected_delivery\n\t\t\t\t\t\t\t? formatDate(po.expected_delivery, \"short\")\n\t\t\t\t\t\t\t: \"—\"}\n\t\t\t\t\t</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"actions\",\n\t\t\t\theader: \"\",\n\t\t\t\twidth: \"w-12\",\n\t\t\t\tshrink: true,\n\t\t\t\talign: \"right\",\n\t\t\t\trender: (_po) => (\n\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t<Button className=\"size-8 p-0\" size=\"sm\" variant=\"ghost\">\n\t\t\t\t\t\t\t\t<MoreHorizontal className=\"size-4\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t<DropdownMenuContent align=\"end\" className=\"w-48\">\n\t\t\t\t\t\t\t<DropdownMenuItem className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t<Eye className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\tView Details\n\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t<DropdownMenuItem className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t<Download className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\tDownload PDF\n\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t<DropdownMenuItem className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t<Send className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\tSend to Vendor\n\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t</DropdownMenu>\n\t\t\t\t),\n\t\t\t},\n\t\t],\n\t\t[formatCurrencyCents],\n\t);\n\n\tconst bulkActions: BulkAction[] = useMemo(\n\t\t() => [\n\t\t\t{\n\t\t\t\tlabel: \"Archive Selected\",\n\t\t\t\ticon: <Archive className=\"h-4 w-4\" />,\n\t\t\t\tvariant: \"destructive\",\n\t\t\t\tonClick: (selectedIds: Set<string>) => {\n\t\t\t\t\tsetSelectedIds(selectedIds);\n\t\t\t\t\tsetShowArchiveDialog(true);\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t\t[],\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t<FullWidthDataTable\n\t\t\t\t{...TablePresets.compact()}\n\t\t\t\tbulkActions={bulkActions}\n\t\t\t\tcolumns={columns}\n\t\t\t\tdata={purchaseOrders}\n\t\t\t\temptyIcon={<Package className=\"text-muted-foreground/50 size-12\" />}\n\t\t\t\temptyMessage=\"No purchase orders found for this job\"\n\t\t\t\tgetItemId={(po) => po.id}\n\t\t\t\tnoPadding={true}\n\t\t\t\tsearchFilter={(po, query) => {\n\t\t\t\t\tconst searchLower = query.toLowerCase();\n\t\t\t\t\treturn (\n\t\t\t\t\t\tpo.po_number?.toLowerCase().includes(searchLower) ||\n\t\t\t\t\t\tpo.title?.toLowerCase().includes(searchLower) ||\n\t\t\t\t\t\tpo.vendor?.toLowerCase().includes(searchLower) ||\n\t\t\t\t\t\tpo.status?.toLowerCase().includes(searchLower)\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t\tsearchPlaceholder=\"Search purchase orders...\"\n\t\t\t/>\n\n\t\t\t<ArchiveConfirmDialog\n\t\t\t\tentityType=\"purchase order\"\n\t\t\t\tisLoading={isArchiving}\n\t\t\t\titemCount={selectedIds.size}\n\t\t\t\tonConfirm={handleArchive}\n\t\t\t\tonOpenChange={setShowArchiveDialog}\n\t\t\t\topen={showArchiveDialog}\n\t\t\t/>\n\t\t</>\n\t);\n}\n","/**\n * Job Core Actions - Arrive, Close\n * Primary workflow actions for job management\n */\n\n\"use client\";\n\nimport { CheckCircle } from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\nimport { useState } from \"react\";\nimport { completeJob, startJob } from \"@/actions/jobs\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype JobQuickActionsProps = {\n\tjobId: string;\n\tcurrentStatus: string;\n};\n\nexport function JobQuickActions({\n\tjobId,\n\tcurrentStatus,\n}: JobQuickActionsProps) {\n\tconst router = useRouter();\n\tconst { toast } = useToast();\n\tconst [isLoading, setIsLoading] = useState<string | null>(null);\n\n\t// Arrive: Technician arrives at job site (starts job)\n\tconst handleArrive = async () => {\n\t\tsetIsLoading(\"arrive\");\n\t\ttry {\n\t\t\tconst result = await startJob(jobId);\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Job started - technician arrived\");\n\t\t\t\t// Server Action handles revalidation automatically\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to mark job as arrived\");\n\t\t\t}\n\t\t} catch {\n\t\t\ttoast.error(\"Failed to mark job as arrived\");\n\t\t} finally {\n\t\t\tsetIsLoading(null);\n\t\t}\n\t};\n\n\t// Close: Complete the job\n\tconst handleClose = async () => {\n\t\tsetIsLoading(\"close\");\n\t\ttry {\n\t\t\tconst result = await completeJob(jobId);\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Job closed successfully\");\n\t\t\t\t// Server Action handles revalidation automatically\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to close job\");\n\t\t\t}\n\t\t} catch {\n\t\t\ttoast.error(\"Failed to close job\");\n\t\t} finally {\n\t\t\tsetIsLoading(null);\n\t\t}\n\t};\n\n\t// Determine which actions are available based on status\n\tconst canArrive = currentStatus === \"scheduled\";\n\tconst canClose = currentStatus === \"in_progress\";\n\tconst isCompleted = currentStatus === \"completed\";\n\tconst isCancelled = currentStatus === \"cancelled\";\n\n\treturn (\n\t\t<div className=\"space-y-3\">\n\t\t\t{/* Primary Action Button */}\n\t\t\t{!(isCompleted || isCancelled) && (canArrive || canClose) && (\n\t\t\t\t<div className=\"flex justify-end\">\n\t\t\t\t\t{canArrive && (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tclassName=\"bg-success hover:bg-success\"\n\t\t\t\t\t\t\tdisabled={isLoading === \"arrive\"}\n\t\t\t\t\t\t\tonClick={handleArrive}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<CheckCircle className=\"mr-2 h-4 w-4\" />\n\t\t\t\t\t\t\t{isLoading === \"arrive\" ? \"Arriving...\" : \"Arrive at Site\"}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t\t{canClose && (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tclassName=\"bg-accent hover:bg-accent\"\n\t\t\t\t\t\t\tdisabled={isLoading === \"close\"}\n\t\t\t\t\t\t\tonClick={handleClose}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<CheckCircle className=\"mr-2 h-4 w-4\" />\n\t\t\t\t\t\t\t{isLoading === \"close\" ? \"Closing...\" : \"Complete Job\"}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","/**\n * Job Status Selector with Transition Validation\n *\n * Smart status selector that:\n * - Shows only valid next statuses based on current status\n * - Displays warnings for transitions with missing requirements\n * - Provides clear feedback on blocked transitions\n * - Integrates with job editor state\n */\n\n\"use client\";\n\nimport {\n\tAlertCircle,\n\tArrowRight,\n\tCheckCircle2,\n\tHelpCircle,\n\tInfo,\n} from \"lucide-react\";\nimport { useCallback, useMemo } from \"react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\nimport {\n\tgetAllowedNextStatuses,\n\tgetRecommendedNextStatus,\n\tgetStatusLabel,\n\tgetStatusVariant,\n\ttype JobStatus,\n\ttype JobStatusTransitionContext,\n\tvalidateStatusTransition,\n} from \"@/lib/validations/job-status-transitions\";\n\ninterface JobStatusSelectorProps {\n\tcurrentStatus: JobStatus;\n\tonStatusChange: (newStatus: JobStatus) => void;\n\tjob: {\n\t\tid: string;\n\t\tscheduled_start?: string | null;\n\t\tscheduled_end?: string | null;\n\t\tassigned_to?: string | null;\n\t\tcustomer_id?: string | null;\n\t\tproperty_id?: string | null;\n\t\ttotal_amount?: number | null;\n\t\tinvoices?: Array<{ status: string; total_amount: number }>;\n\t\testimates?: Array<{ status: string }>;\n\t\tteamAssignments?: Array<{ team_member_id: string }>;\n\t};\n\tdisabled?: boolean;\n\tshowAllStatuses?: boolean;\n}\n\nexport function JobStatusSelector({\n\tcurrentStatus,\n\tonStatusChange,\n\tjob,\n\tdisabled = false,\n\tshowAllStatuses = false,\n}: JobStatusSelectorProps) {\n\t// Get allowed next statuses\n\tconst allowedStatuses = useMemo(() => {\n\t\tconst allowed = getAllowedNextStatuses(currentStatus);\n\t\treturn [currentStatus, ...allowed]; // Include current status\n\t}, [currentStatus]);\n\n\t// Get recommended next status\n\tconst recommendedStatus = useMemo(\n\t\t() => getRecommendedNextStatus(currentStatus),\n\t\t[currentStatus],\n\t);\n\n\t// All possible statuses (for admin mode)\n\tconst allStatuses: JobStatus[] = [\n\t\t\"quoted\",\n\t\t\"scheduled\",\n\t\t\"in_progress\",\n\t\t\"on_hold\",\n\t\t\"completed\",\n\t\t\"cancelled\",\n\t\t\"invoiced\",\n\t\t\"paid\",\n\t];\n\n\tconst statusesToShow = showAllStatuses ? allStatuses : allowedStatuses;\n\n\t// Validate a specific status transition\n\tconst getTransitionValidation = useCallback(\n\t\t(newStatus: JobStatus) => {\n\t\t\tif (newStatus === currentStatus) {\n\t\t\t\treturn { allowed: true };\n\t\t\t}\n\n\t\t\tconst context: JobStatusTransitionContext = {\n\t\t\t\tcurrentStatus,\n\t\t\t\tnewStatus,\n\t\t\t\tjob,\n\t\t\t};\n\n\t\t\treturn validateStatusTransition(context);\n\t\t},\n\t\t[currentStatus, job],\n\t);\n\n\t// Handle status change\n\tconst handleStatusChange = useCallback(\n\t\t(value: string) => {\n\t\t\tconst newStatus = value as JobStatus;\n\t\t\tconst validation = getTransitionValidation(newStatus);\n\n\t\t\tif (validation.allowed) {\n\t\t\t\tonStatusChange(newStatus);\n\t\t\t}\n\t\t},\n\t\t[getTransitionValidation, onStatusChange],\n\t);\n\n\t// Get validation info for current selected status (if different from current)\n\tconst selectedValidation = useMemo(() => {\n\t\treturn getTransitionValidation(currentStatus);\n\t}, [currentStatus, getTransitionValidation]);\n\n\t// Get workflow info for current status\n\tconst workflowInfo = useMemo(() => {\n\t\tconst nextSteps = allowedStatuses.filter((s) => s !== currentStatus);\n\t\treturn {\n\t\t\tcurrent: getStatusLabel(currentStatus),\n\t\t\tnextSteps: nextSteps.map((s) => getStatusLabel(s)),\n\t\t\trecommended: recommendedStatus ? getStatusLabel(recommendedStatus) : null,\n\t\t};\n\t}, [currentStatus, allowedStatuses, recommendedStatus]);\n\n\treturn (\n\t\t<div className=\"space-y-2\">\n\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t<Select\n\t\t\t\t\t\tvalue={currentStatus}\n\t\t\t\t\t\tonValueChange={handleStatusChange}\n\t\t\t\t\t\tdisabled={disabled}\n\t\t\t\t\t>\n\t\t\t\t\t\t<SelectTrigger className=\"w-full\">\n\t\t\t\t\t\t\t<SelectValue>\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<Badge variant={getStatusVariant(currentStatus)}>\n\t\t\t\t\t\t\t\t\t\t{getStatusLabel(currentStatus)}\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t{recommendedStatus && currentStatus !== recommendedStatus && (\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t→ Next: {getStatusLabel(recommendedStatus)}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</SelectValue>\n\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t{statusesToShow.map((status) => {\n\t\t\t\t\t\t\t\tconst validation = getTransitionValidation(status);\n\t\t\t\t\t\t\t\tconst isBlocked = !validation.allowed;\n\t\t\t\t\t\t\t\tconst isCurrent = status === currentStatus;\n\t\t\t\t\t\t\t\tconst isRecommended = status === recommendedStatus;\n\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<SelectItem\n\t\t\t\t\t\t\t\t\t\tkey={status}\n\t\t\t\t\t\t\t\t\t\tvalue={status}\n\t\t\t\t\t\t\t\t\t\tdisabled={isBlocked && !isCurrent}\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center gap-2\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\tvariant={getStatusVariant(status)}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{getStatusLabel(status)}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\n\t\t\t\t\t\t\t\t\t\t\t{isCurrent && (\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t(current)\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t\t{isRecommended && !isCurrent && (\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-primary text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t(recommended)\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t\t{isBlocked && !isCurrent && (\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-destructive text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertCircle className=\"inline h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t\t{validation.warnings &&\n\t\t\t\t\t\t\t\t\t\t\t\tvalidation.warnings.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-yellow-600 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Info className=\"inline h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t{/* Show reason for blocked transitions */}\n\t\t\t\t\t\t\t\t\t\t{isBlocked && !isCurrent && validation.reason && (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-destructive mt-1 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t{validation.reason}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t{/* Show required fields */}\n\t\t\t\t\t\t\t\t\t\t{isBlocked &&\n\t\t\t\t\t\t\t\t\t\t\t!isCurrent &&\n\t\t\t\t\t\t\t\t\t\t\tvalidation.requiredFields &&\n\t\t\t\t\t\t\t\t\t\t\tvalidation.requiredFields.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-destructive mt-1 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tMissing: {validation.requiredFields.join(\", \")}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t</Select>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Subtle workflow info popover */}\n\t\t\t\t<Popover>\n\t\t\t\t\t<PopoverTrigger asChild>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tclassName=\"text-muted-foreground hover:text-foreground h-8 w-8 p-0\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<HelpCircle className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t<span className=\"sr-only\">View workflow information</span>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</PopoverTrigger>\n\t\t\t\t\t<PopoverContent className=\"w-80\" align=\"start\">\n\t\t\t\t\t\t<div className=\"space-y-3\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<h4 className=\"mb-2 font-semibold text-sm\">\n\t\t\t\t\t\t\t\t\tCurrent Status: {workflowInfo.current}\n\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\tThis job is currently in the{\" \"}\n\t\t\t\t\t\t\t\t\t{workflowInfo.current.toLowerCase()} stage.\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{workflowInfo.nextSteps.length > 0 && (\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<h4 className=\"mb-2 flex items-center gap-1 font-semibold text-sm\">\n\t\t\t\t\t\t\t\t\t\t<ArrowRight className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\tAvailable Next Steps\n\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t\t<ul className=\"space-y-1\">\n\t\t\t\t\t\t\t\t\t\t{workflowInfo.nextSteps.map((step, idx) => (\n\t\t\t\t\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\t\t\t\t\tkey={idx}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`flex items-center gap-2 text-xs ${step === workflowInfo.recommended ? \"text-primary font-medium\" : \"text-muted-foreground\"}`}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<CheckCircle2 className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t{step}\n\t\t\t\t\t\t\t\t\t\t\t\t{step === workflowInfo.recommended && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"default\" className=\"ml-auto text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tRecommended\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t{workflowInfo.nextSteps.length === 0 &&\n\t\t\t\t\t\t\t\tcurrentStatus !== \"paid\" && (\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\tThis status cannot be changed further. Job is complete.\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t{currentStatus === \"paid\" && (\n\t\t\t\t\t\t\t\t<div className=\"rounded-md border-green-600 bg-green-50 p-2 dark:bg-green-950\">\n\t\t\t\t\t\t\t\t\t<p className=\"text-green-900 text-xs dark:text-green-100\">\n\t\t\t\t\t\t\t\t\t\t✓ Job is fully paid. No further status changes allowed.\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t<div className=\"border-t pt-2\">\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs italic\">\n\t\t\t\t\t\t\t\t\tStatus changes follow your workflow rules. Some transitions\n\t\t\t\t\t\t\t\t\tmay require additional information like dates, assignments, or\n\t\t\t\t\t\t\t\t\tinvoices.\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</PopoverContent>\n\t\t\t\t</Popover>\n\t\t\t</div>\n\n\t\t\t{/* Show warnings for current status */}\n\t\t\t{selectedValidation.warnings &&\n\t\t\t\tselectedValidation.warnings.length > 0 && (\n\t\t\t\t\t<Alert variant=\"default\" className=\"border-yellow-600\">\n\t\t\t\t\t\t<Info className=\"h-4 w-4 text-yellow-600\" />\n\t\t\t\t\t\t<AlertDescription>\n\t\t\t\t\t\t\t<ul className=\"list-disc space-y-1 pl-4\">\n\t\t\t\t\t\t\t\t{selectedValidation.warnings.map((warning, idx) => (\n\t\t\t\t\t\t\t\t\t<li key={idx} className=\"text-sm\">\n\t\t\t\t\t\t\t\t\t\t{warning}\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t</AlertDescription>\n\t\t\t\t\t</Alert>\n\t\t\t\t)}\n\n\t\t\t{/* Show success message if status is paid */}\n\t\t\t{currentStatus === \"paid\" && (\n\t\t\t\t<Alert variant=\"default\" className=\"border-green-600\">\n\t\t\t\t\t<CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n\t\t\t\t\t<AlertDescription>\n\t\t\t\t\t\tThis job is marked as paid. No further status changes are allowed.\n\t\t\t\t\t</AlertDescription>\n\t\t\t\t</Alert>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","/**\n * Job Status Transition Validation\n *\n * Enforces business rules for job status changes:\n * - Valid transition paths (workflow validation)\n * - Required fields per status\n * - Blocking conditions\n *\n * Used by: updateJobStatus, updateJobData actions\n */\n\nexport type JobStatus =\n\t| \"quoted\"\n\t| \"scheduled\"\n\t| \"in_progress\"\n\t| \"on_hold\"\n\t| \"completed\"\n\t| \"cancelled\"\n\t| \"invoiced\"\n\t| \"paid\";\n\nexport type JobPriority = \"low\" | \"medium\" | \"high\" | \"urgent\";\n\nexport interface JobStatusTransitionContext {\n\tcurrentStatus: JobStatus;\n\tnewStatus: JobStatus;\n\tjob: {\n\t\tid: string;\n\t\tscheduled_start?: string | null;\n\t\tscheduled_end?: string | null;\n\t\tassigned_to?: string | null;\n\t\tcustomer_id?: string | null;\n\t\tproperty_id?: string | null;\n\t\ttotal_amount?: number | null;\n\t\tinvoices?: Array<{ status: string; total_amount: number }>;\n\t\testimates?: Array<{ status: string }>;\n\t\tteamAssignments?: Array<{ team_member_id: string }>;\n\t};\n}\n\nexport interface StatusTransitionResult {\n\tallowed: boolean;\n\treason?: string;\n\trequiredFields?: string[];\n\twarnings?: string[];\n}\n\n/**\n * Valid status transition paths\n * Key = current status, Value = allowed next statuses\n */\nconst VALID_TRANSITIONS: Record<JobStatus, JobStatus[]> = {\n\tquoted: [\"scheduled\", \"cancelled\"],\n\tscheduled: [\"in_progress\", \"on_hold\", \"cancelled\"],\n\tin_progress: [\"on_hold\", \"completed\", \"cancelled\"],\n\ton_hold: [\"scheduled\", \"in_progress\", \"cancelled\"],\n\tcompleted: [\"invoiced\"],\n\tcancelled: [\"quoted\", \"scheduled\"], // Allow re-opening cancelled jobs\n\tinvoiced: [\"paid\"],\n\tpaid: [], // Terminal state - no further transitions\n};\n\n/**\n * Required fields for each status\n */\nconst REQUIRED_FIELDS: Record<JobStatus, string[]> = {\n\tquoted: [\"customer_id\"], // At minimum need a customer\n\tscheduled: [\"customer_id\", \"scheduled_start\", \"scheduled_end\"],\n\tin_progress: [\"customer_id\", \"scheduled_start\", \"assigned_to\"],\n\ton_hold: [\"customer_id\"],\n\tcompleted: [\"customer_id\", \"scheduled_start\"],\n\tcancelled: [], // No required fields\n\tinvoiced: [\"customer_id\", \"total_amount\"],\n\tpaid: [\"customer_id\", \"total_amount\"],\n};\n\n/**\n * Field labels for user-friendly error messages\n */\nconst FIELD_LABELS: Record<string, string> = {\n\tcustomer_id: \"Customer\",\n\tscheduled_start: \"Start Date\",\n\tscheduled_end: \"End Date\",\n\tassigned_to: \"Assigned Team Member\",\n\tproperty_id: \"Property\",\n\ttotal_amount: \"Total Amount\",\n};\n\n/**\n * Validate if a status transition is allowed\n */\nexport function validateStatusTransition(\n\tcontext: JobStatusTransitionContext,\n): StatusTransitionResult {\n\tconst { currentStatus, newStatus, job } = context;\n\n\t// Same status - always allowed (no-op)\n\tif (currentStatus === newStatus) {\n\t\treturn { allowed: true };\n\t}\n\n\t// Check if transition is in allowed paths\n\tconst allowedNextStatuses = VALID_TRANSITIONS[currentStatus];\n\tif (!allowedNextStatuses.includes(newStatus)) {\n\t\treturn {\n\t\t\tallowed: false,\n\t\t\treason: `Cannot transition from \"${currentStatus}\" to \"${newStatus}\". Valid next statuses: ${allowedNextStatuses.join(\", \")}`,\n\t\t};\n\t}\n\n\t// Check required fields for target status\n\tconst requiredFields = REQUIRED_FIELDS[newStatus];\n\tconst missingFields: string[] = [];\n\n\tfor (const field of requiredFields) {\n\t\tconst value = job[field as keyof typeof job];\n\t\tif (value === null || value === undefined || value === \"\") {\n\t\t\tmissingFields.push(FIELD_LABELS[field] || field);\n\t\t}\n\t}\n\n\tif (missingFields.length > 0) {\n\t\treturn {\n\t\t\tallowed: false,\n\t\t\treason: `Cannot transition to \"${newStatus}\" - missing required fields`,\n\t\t\trequiredFields: missingFields,\n\t\t};\n\t}\n\n\t// Business rule validations\n\tconst warnings: string[] = [];\n\n\t// Scheduled → In Progress: Should have team assignment\n\tif (currentStatus === \"scheduled\" && newStatus === \"in_progress\") {\n\t\tif (!job.teamAssignments || job.teamAssignments.length === 0) {\n\t\t\twarnings.push(\"No team members assigned to this job\");\n\t\t}\n\t}\n\n\t// Completed → Invoiced: Should have estimates or total amount\n\tif (currentStatus === \"completed\" && newStatus === \"invoiced\") {\n\t\tconst hasEstimates = job.estimates && job.estimates.length > 0;\n\t\tconst hasTotalAmount = job.total_amount && job.total_amount > 0;\n\n\t\tif (!hasEstimates && !hasTotalAmount) {\n\t\t\treturn {\n\t\t\t\tallowed: false,\n\t\t\t\treason: \"Cannot create invoice - no estimates or total amount defined\",\n\t\t\t};\n\t\t}\n\t}\n\n\t// Invoiced → Paid: Should have invoices\n\tif (currentStatus === \"invoiced\" && newStatus === \"paid\") {\n\t\tif (!job.invoices || job.invoices.length === 0) {\n\t\t\treturn {\n\t\t\t\tallowed: false,\n\t\t\t\treason: \"Cannot mark as paid - no invoices found\",\n\t\t\t};\n\t\t}\n\n\t\t// Check if all invoices are paid\n\t\tconst unpaidInvoices = job.invoices.filter(\n\t\t\t(inv) => inv.status !== \"paid\" && inv.status !== \"cancelled\",\n\t\t);\n\n\t\tif (unpaidInvoices.length > 0) {\n\t\t\treturn {\n\t\t\t\tallowed: false,\n\t\t\t\treason: `Cannot mark as paid - ${unpaidInvoices.length} invoice(s) still unpaid`,\n\t\t\t};\n\t\t}\n\t}\n\n\t// Paid → any: Should not be allowed (terminal state)\n\tif (currentStatus === \"paid\") {\n\t\treturn {\n\t\t\tallowed: false,\n\t\t\treason: \"Cannot change status of paid jobs. Create a new job if needed.\",\n\t\t};\n\t}\n\n\treturn {\n\t\tallowed: true,\n\t\twarnings: warnings.length > 0 ? warnings : undefined,\n\t};\n}\n\n/**\n * Get all allowed next statuses for current status\n */\nexport function getAllowedNextStatuses(currentStatus: JobStatus): JobStatus[] {\n\treturn VALID_TRANSITIONS[currentStatus] || [];\n}\n\n/**\n * Get required fields for a status\n */\nfunction getRequiredFieldsForStatus(status: JobStatus): string[] {\n\treturn REQUIRED_FIELDS[status] || [];\n}\n\n/**\n * Check if a specific transition is valid (simple check without context)\n */\nfunction isTransitionAllowed(from: JobStatus, to: JobStatus): boolean {\n\tif (from === to) return true;\n\treturn VALID_TRANSITIONS[from]?.includes(to) || false;\n}\n\n/**\n * Get user-friendly status name\n */\nexport function getStatusLabel(status: JobStatus): string {\n\tconst labels: Record<JobStatus, string> = {\n\t\tquoted: \"Quoted\",\n\t\tscheduled: \"Scheduled\",\n\t\tin_progress: \"In Progress\",\n\t\ton_hold: \"On Hold\",\n\t\tcompleted: \"Completed\",\n\t\tcancelled: \"Cancelled\",\n\t\tinvoiced: \"Invoiced\",\n\t\tpaid: \"Paid\",\n\t};\n\treturn labels[status] || status;\n}\n\n/**\n * Get status color/variant for UI\n */\nexport function getStatusVariant(\n\tstatus: JobStatus,\n): \"default\" | \"secondary\" | \"destructive\" | \"outline\" {\n\tconst variants: Record<\n\t\tJobStatus,\n\t\t\"default\" | \"secondary\" | \"destructive\" | \"outline\"\n\t> = {\n\t\tquoted: \"outline\",\n\t\tscheduled: \"secondary\",\n\t\tin_progress: \"default\",\n\t\ton_hold: \"secondary\",\n\t\tcompleted: \"default\",\n\t\tcancelled: \"destructive\",\n\t\tinvoiced: \"secondary\",\n\t\tpaid: \"default\",\n\t};\n\treturn variants[status] || \"default\";\n}\n\n/**\n * Get recommended next status based on current status\n */\nexport function getRecommendedNextStatus(\n\tcurrentStatus: JobStatus,\n): JobStatus | null {\n\tconst recommendations: Record<JobStatus, JobStatus | null> = {\n\t\tquoted: \"scheduled\",\n\t\tscheduled: \"in_progress\",\n\t\tin_progress: \"completed\",\n\t\ton_hold: \"in_progress\",\n\t\tcompleted: \"invoiced\",\n\t\tcancelled: null,\n\t\tinvoiced: \"paid\",\n\t\tpaid: null,\n\t};\n\treturn recommendations[currentStatus] || null;\n}\n","\"use client\";\n\nimport {\n\tArchive,\n\tCheckCircle,\n\tClock,\n\tEdit,\n\tMoreHorizontal,\n\tTrash2,\n\tUser,\n} from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\nimport { useCallback, useMemo, useState } from \"react\";\nimport { toast } from \"sonner\";\nimport { bulkArchive } from \"@/actions/archive\";\nimport { ArchiveConfirmDialog } from \"@/components/ui/archive-confirm-dialog\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDialog,\n\tDialogContent,\n\tDialogDescription,\n\tDialogFooter,\n\tDialogHeader,\n\tDialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n\ttype BulkAction,\n\ttype ColumnDef,\n\tFullWidthDataTable,\n} from \"@/components/ui/full-width-datatable\";\nimport { TablePresets } from \"@/lib/datatable/table-presets\";\nimport { formatDate } from \"@/lib/formatters\";\nimport { cn } from \"@/lib/utils\";\n\ntype JobTask = {\n\tid: string;\n\ttitle: string;\n\tdescription?: string;\n\tcategory?: string;\n\tis_completed: boolean;\n\tis_required?: boolean;\n\tcompleted_at?: string;\n\tdue_date?: string;\n\tassigned_user?:\n\t\t| {\n\t\t\t\tid: string;\n\t\t\t\tname: string;\n\t\t\t\temail?: string;\n\t\t\t\tphone?: string;\n\t\t\t\tavatar?: string;\n\t\t  }\n\t\t| Array<{\n\t\t\t\tid: string;\n\t\t\t\tname: string;\n\t\t\t\temail?: string;\n\t\t\t\tphone?: string;\n\t\t\t\tavatar?: string;\n\t\t  }>;\n};\n\ntype JobTasksTableProps = {\n\ttasks: JobTask[];\n\tonToggleComplete?: (\n\t\ttaskId: string,\n\t\tcompleted: boolean,\n\t) => Promise<{ success: boolean; error?: string }>;\n\tonDeleteTask?: (\n\t\ttaskId: string,\n\t) => Promise<{ success: boolean; error?: string }>;\n};\n\nexport function JobTasksTable({\n\ttasks,\n\tonToggleComplete,\n\tonDeleteTask,\n}: JobTasksTableProps) {\n\tconst router = useRouter();\n\tconst [deleteTaskId, setDeleteTaskId] = useState<string | null>(null);\n\tconst [isDeleting, setIsDeleting] = useState(false);\n\tconst [showArchiveDialog, setShowArchiveDialog] = useState(false);\n\tconst [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());\n\tconst [isArchiving, setIsArchiving] = useState(false);\n\n\tconst handleDeleteTask = useCallback(async () => {\n\t\tif (!deleteTaskId || !onDeleteTask) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsDeleting(true);\n\t\ttry {\n\t\t\tconst result = await onDeleteTask(deleteTaskId);\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Task deleted\");\n\t\t\t\tsetDeleteTaskId(null);\n\t\t\t\trouter.refresh();\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to delete task\");\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\ttoast.error(\"Failed to delete task\");\n\t\t} finally {\n\t\t\tsetIsDeleting(false);\n\t\t}\n\t}, [deleteTaskId, onDeleteTask, router]);\n\n\tconst handleArchive = useCallback(async () => {\n\t\tif (selectedIds.size === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsArchiving(true);\n\t\ttry {\n\t\t\tconst result = await bulkArchive(Array.from(selectedIds), \"job_task\");\n\n\t\t\tif (result.success && result.data) {\n\t\t\t\ttoast.success(\n\t\t\t\t\t`Successfully archived ${result.data.archived} task${result.data.archived === 1 ? \"\" : \"s\"}`,\n\t\t\t\t);\n\t\t\t\tsetShowArchiveDialog(false);\n\t\t\t\tsetSelectedIds(new Set());\n\t\t\t\trouter.refresh();\n\t\t\t} else {\n\t\t\t\ttoast.error(\"Failed to archive tasks\");\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\ttoast.error(\"Failed to archive tasks\");\n\t\t} finally {\n\t\t\tsetIsArchiving(false);\n\t\t}\n\t}, [selectedIds, router]);\n\n\tconst handleToggleComplete = useCallback(\n\t\tasync (taskId: string, currentStatus: boolean) => {\n\t\t\tif (!onToggleComplete) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst result = await onToggleComplete(taskId, !currentStatus);\n\n\t\t\t\tif (result.success) {\n\t\t\t\t\ttoast.success(\n\t\t\t\t\t\tcurrentStatus ? \"Task marked incomplete\" : \"Task completed\",\n\t\t\t\t\t);\n\t\t\t\t\trouter.refresh();\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(result.error || \"Failed to update task\");\n\t\t\t\t}\n\t\t\t} catch (_error) {\n\t\t\t\ttoast.error(\"Failed to update task\");\n\t\t\t}\n\t\t},\n\t\t[onToggleComplete, router],\n\t);\n\n\tconst getCategoryDisplay = useCallback((category?: string) => {\n\t\tif (!category) return \"Other\";\n\t\treturn category;\n\t}, []);\n\n\tconst getCategoryVariant = useCallback(\n\t\t(category?: string): \"default\" | \"secondary\" | \"outline\" => {\n\t\t\tswitch (category) {\n\t\t\t\tcase \"Pre-Job\":\n\t\t\t\t\treturn \"default\";\n\t\t\t\tcase \"On-Site\":\n\t\t\t\t\treturn \"secondary\";\n\t\t\t\tcase \"Post-Job\":\n\t\t\t\t\treturn \"outline\";\n\t\t\t\tcase \"Safety\":\n\t\t\t\t\treturn \"default\";\n\t\t\t\tcase \"Quality\":\n\t\t\t\t\treturn \"secondary\";\n\t\t\t\tdefault:\n\t\t\t\t\treturn \"outline\";\n\t\t\t}\n\t\t},\n\t\t[],\n\t);\n\n\tconst completedTasks = tasks.filter((t) => t.is_completed).length;\n\tconst totalTasks = tasks.length;\n\tconst progressPercentage =\n\t\ttotalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;\n\n\tconst bulkActions: BulkAction[] = useMemo(\n\t\t() => [\n\t\t\t{\n\t\t\t\tlabel: \"Archive Selected\",\n\t\t\t\ticon: <Archive className=\"h-4 w-4\" />,\n\t\t\t\tvariant: \"destructive\",\n\t\t\t\tonClick: (selectedIds: Set<string>) => {\n\t\t\t\t\tsetSelectedIds(selectedIds);\n\t\t\t\t\tsetShowArchiveDialog(true);\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t\t[],\n\t);\n\n\tconst columns: ColumnDef<JobTask>[] = useMemo(\n\t\t() => [\n\t\t\t{\n\t\t\t\tkey: \"status\",\n\t\t\t\theader: \"\",\n\t\t\t\twidth: \"w-12\",\n\t\t\t\tshrink: true,\n\t\t\t\talign: \"center\",\n\t\t\t\trender: (task) => (\n\t\t\t\t\t<button\n\t\t\t\t\t\tclassName=\"flex items-center justify-center\"\n\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\thandleToggleComplete(task.id, task.is_completed);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\tdisabled={!onToggleComplete}\n\t\t\t\t\t>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tchecked={task.is_completed}\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\"border-border h-5 w-5 cursor-pointer rounded focus:ring-2\",\n\t\t\t\t\t\t\t\ttask.is_completed\n\t\t\t\t\t\t\t\t\t? \"text-success focus:ring-green-500\"\n\t\t\t\t\t\t\t\t\t: \"focus:ring-primary\",\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\tonChange={() => {}}\n\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\tdisabled={!onToggleComplete}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</button>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"title\",\n\t\t\t\theader: \"Task\",\n\t\t\t\trender: (task) => (\n\t\t\t\t\t<div className=\"flex flex-col gap-1\">\n\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\"text-xs font-medium\",\n\t\t\t\t\t\t\t\t\ttask.is_completed && \"text-muted-foreground line-through\",\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{task.title}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t{task.is_required && (\n\t\t\t\t\t\t\t\t<Badge variant=\"destructive\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\tRequired\n\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{task.description && (\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground line-clamp-2 text-xs\">\n\t\t\t\t\t\t\t\t{task.description}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"category\",\n\t\t\t\theader: \"Category\",\n\t\t\t\twidth: \"w-28\",\n\t\t\t\tshrink: true,\n\t\t\t\thideOnMobile: true,\n\t\t\t\trender: (task) => (\n\t\t\t\t\t<Badge\n\t\t\t\t\t\tvariant={getCategoryVariant(task.category)}\n\t\t\t\t\t\tclassName=\"font-normal\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{getCategoryDisplay(task.category)}\n\t\t\t\t\t</Badge>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"assigned_user\",\n\t\t\t\theader: \"Assigned To\",\n\t\t\t\twidth: \"w-36\",\n\t\t\t\tshrink: true,\n\t\t\t\thideOnMobile: true,\n\t\t\t\trender: (task) => {\n\t\t\t\t\tconst assignedUser = Array.isArray(task.assigned_user)\n\t\t\t\t\t\t? task.assigned_user[0]\n\t\t\t\t\t\t: task.assigned_user;\n\n\t\t\t\t\tif (!assignedUser) {\n\t\t\t\t\t\treturn <span className=\"text-muted-foreground text-xs\">—</span>;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Avatar className=\"h-6 w-6\">\n\t\t\t\t\t\t\t\t<AvatarImage src={assignedUser.avatar} />\n\t\t\t\t\t\t\t\t<AvatarFallback className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t{assignedUser.name?.substring(0, 2).toUpperCase() || \"TM\"}\n\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t<span className=\"max-w-24 truncate text-xs\">\n\t\t\t\t\t\t\t\t{assignedUser.name}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"due_date\",\n\t\t\t\theader: \"Due Date\",\n\t\t\t\twidth: \"w-32\",\n\t\t\t\tshrink: true,\n\t\t\t\thideOnMobile: true,\n\t\t\t\trender: (task) => {\n\t\t\t\t\tif (task.is_completed && task.completed_at) {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div className=\"text-success flex items-center gap-1 text-xs\">\n\t\t\t\t\t\t\t\t<CheckCircle className=\"size-3\" />\n\t\t\t\t\t\t\t\t{formatDate(task.completed_at, \"short\")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (task.due_date) {\n\t\t\t\t\t\tconst isOverdue =\n\t\t\t\t\t\t\tnew Date(task.due_date) < new Date() && !task.is_completed;\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\"flex items-center gap-1 text-xs\",\n\t\t\t\t\t\t\t\t\tisOverdue ? \"text-destructive\" : \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Clock className=\"size-3\" />\n\t\t\t\t\t\t\t\t{formatDate(task.due_date, \"short\")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn <span className=\"text-muted-foreground text-xs\">—</span>;\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"actions\",\n\t\t\t\theader: \"\",\n\t\t\t\twidth: \"w-12\",\n\t\t\t\tshrink: true,\n\t\t\t\talign: \"right\",\n\t\t\t\trender: (task) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t\t<Button className=\"size-8 p-0\" size=\"sm\" variant=\"ghost\">\n\t\t\t\t\t\t\t\t\t<MoreHorizontal className=\"size-4\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t\t<DropdownMenuContent align=\"end\" className=\"w-48\">\n\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\tclassName=\"cursor-pointer\"\n\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\thandleToggleComplete(task.id, task.is_completed)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tdisabled={!onToggleComplete}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<CheckCircle className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\t{task.is_completed ? \"Mark Incomplete\" : \"Mark Complete\"}\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t<DropdownMenuItem className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t\t<Edit className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tEdit Task\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\tclassName=\"text-destructive focus:text-destructive cursor-pointer\"\n\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\tsetSelectedIds(new Set([task.id]));\n\t\t\t\t\t\t\t\t\t\tsetShowArchiveDialog(true);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Archive className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tArchive Task\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t{onDeleteTask && (\n\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-destructive focus:text-destructive cursor-pointer\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteTaskId(task.id)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\t\t\tDelete Task\n\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t\t</DropdownMenu>\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t\t[\n\t\t\thandleToggleComplete,\n\t\t\tgetCategoryDisplay,\n\t\t\tgetCategoryVariant,\n\t\t\tonToggleComplete,\n\t\t\tonDeleteTask,\n\t\t],\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t{totalTasks > 0 && (\n\t\t\t\t<div className=\"bg-muted/30 border-border mb-4 rounded-lg border p-4\">\n\t\t\t\t\t<div className=\"mb-2 flex items-center justify-between text-xs\">\n\t\t\t\t\t\t<span className=\"font-medium\">Overall Progress</span>\n\t\t\t\t\t\t<span className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t{completedTasks} of {totalTasks} completed ({progressPercentage}%)\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"bg-muted h-2 w-full overflow-hidden rounded-full\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"bg-success h-full transition-all\"\n\t\t\t\t\t\t\tstyle={{ width: `${progressPercentage}%` }}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t<FullWidthDataTable\n\t\t\t\t{...TablePresets.compact()}\n\t\t\t\tbulkActions={bulkActions}\n\t\t\t\tcolumns={columns}\n\t\t\t\tdata={tasks}\n\t\t\t\temptyIcon={<CheckCircle className=\"text-muted-foreground/50 size-12\" />}\n\t\t\t\temptyMessage=\"No tasks added yet. Create a step-by-step checklist for the field crew.\"\n\t\t\t\tgetItemId={(task) => task.id}\n\t\t\t\tnoPadding={true}\n\t\t\t\tsearchFilter={(task, query) => {\n\t\t\t\t\tconst searchLower = query.toLowerCase();\n\t\t\t\t\treturn (\n\t\t\t\t\t\ttask.title.toLowerCase().includes(searchLower) ||\n\t\t\t\t\t\ttask.description?.toLowerCase().includes(searchLower) ||\n\t\t\t\t\t\ttask.category?.toLowerCase().includes(searchLower)\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t\tsearchPlaceholder=\"Search tasks...\"\n\t\t\t\tgetRowClassName={(task) =>\n\t\t\t\t\tcn(\n\t\t\t\t\t\ttask.is_completed && \"bg-secondary/30 opacity-75\",\n\t\t\t\t\t\ttask.is_required &&\n\t\t\t\t\t\t\t!task.is_completed &&\n\t\t\t\t\t\t\t\"border-l-2 border-l-destructive\",\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t/>\n\n\t\t\t<ArchiveConfirmDialog\n\t\t\t\tentityType=\"task\"\n\t\t\t\tisLoading={isArchiving}\n\t\t\t\titemCount={selectedIds.size}\n\t\t\t\tonConfirm={handleArchive}\n\t\t\t\tonOpenChange={setShowArchiveDialog}\n\t\t\t\topen={showArchiveDialog}\n\t\t\t/>\n\n\t\t\t{/* Delete Confirmation Dialog */}\n\t\t\t<Dialog\n\t\t\t\tonOpenChange={(open) => !open && setDeleteTaskId(null)}\n\t\t\t\topen={deleteTaskId !== null}\n\t\t\t>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>Delete Task?</DialogTitle>\n\t\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t\tThis will permanently delete this task. This action cannot be\n\t\t\t\t\t\t\tundone. Are you sure you want to continue?\n\t\t\t\t\t\t</DialogDescription>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isDeleting}\n\t\t\t\t\t\t\tonClick={() => setDeleteTaskId(null)}\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isDeleting}\n\t\t\t\t\t\t\tonClick={handleDeleteTask}\n\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{isDeleting ? \"Deleting...\" : \"Delete Task\"}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</>\n\t);\n}\n","\"use client\";\n\nimport { Check, ChevronsUpDown, Search, User, Users } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tCommand,\n\tCommandEmpty,\n\tCommandGroup,\n\tCommandInput,\n\tCommandItem,\n\tCommandList,\n} from \"@/components/ui/command\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { cn } from \"@/lib/utils\";\n\n/**\n * Job Team Member Selector\n *\n * Popover-based selector for adding team members to a job.\n *\n * Features:\n * - Search across available team members\n * - Role selection (primary, supervisor, assistant, crew)\n * - Shows job title and email\n * - Prevents duplicate assignments\n */\n\ntype TeamMember = {\n\tid: string;\n\tuserId: string;\n\tjobTitle: string | null;\n\tuser: {\n\t\tid: string;\n\t\temail: string;\n\t\tfirstName: string | null;\n\t\tlastName: string | null;\n\t\tavatarUrl: string | null;\n\t\tphone: string | null;\n\t};\n};\n\ntype JobTeamMemberSelectorProps = {\n\tavailableMembers: TeamMember[];\n\tcurrentMemberIds: string[];\n\tonAssign: (memberId: string, role: string) => Promise<void>;\n\ttrigger?: React.ReactNode;\n};\n\nexport function JobTeamMemberSelector({\n\tavailableMembers,\n\tcurrentMemberIds,\n\tonAssign,\n\ttrigger,\n}: JobTeamMemberSelectorProps) {\n\tconst [open, setOpen] = useState(false);\n\tconst [searchQuery, setSearchQuery] = useState(\"\");\n\tconst [selectedMember, setSelectedMember] = useState<TeamMember | null>(null);\n\tconst [selectedRole, setSelectedRole] = useState<string>(\"crew\");\n\tconst [isAssigning, setIsAssigning] = useState(false);\n\n\t// Filter available members (exclude already assigned)\n\tconst filteredMembers = availableMembers.filter(\n\t\t(member) => !currentMemberIds.includes(member.id),\n\t);\n\n\t// Search members\n\tconst searchResults = searchQuery.trim()\n\t\t? filteredMembers.filter((member) => {\n\t\t\t\tconst query = searchQuery.toLowerCase();\n\t\t\t\tconst name = [member.user.firstName, member.user.lastName]\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.join(\" \")\n\t\t\t\t\t.toLowerCase();\n\t\t\t\treturn (\n\t\t\t\t\tname.includes(query) ||\n\t\t\t\t\tmember.user.email?.toLowerCase().includes(query) ||\n\t\t\t\t\tmember.jobTitle?.toLowerCase().includes(query)\n\t\t\t\t);\n\t\t\t})\n\t\t: filteredMembers;\n\n\tconst handleAssign = async () => {\n\t\tif (!selectedMember) return;\n\n\t\tsetIsAssigning(true);\n\t\ttry {\n\t\t\tawait onAssign(selectedMember.id, selectedRole);\n\t\t\tsetOpen(false);\n\t\t\tsetSelectedMember(null);\n\t\t\tsetSelectedRole(\"crew\");\n\t\t\tsetSearchQuery(\"\");\n\t\t} finally {\n\t\t\tsetIsAssigning(false);\n\t\t}\n\t};\n\n\tconst getMemberName = (member: TeamMember) => {\n\t\treturn (\n\t\t\t[member.user.firstName, member.user.lastName].filter(Boolean).join(\" \") ||\n\t\t\tmember.user.email\n\t\t);\n\t};\n\n\treturn (\n\t\t<Popover\n\t\t\topen={open}\n\t\t\tonOpenChange={(newOpen) => {\n\t\t\t\tsetOpen(newOpen);\n\t\t\t\t// Reset selection when closing\n\t\t\t\tif (!newOpen) {\n\t\t\t\t\tsetSelectedMember(null);\n\t\t\t\t\tsetSelectedRole(\"crew\");\n\t\t\t\t\tsetSearchQuery(\"\");\n\t\t\t\t}\n\t\t\t}}\n\t\t>\n\t\t\t<PopoverTrigger asChild>\n\t\t\t\t{trigger || (\n\t\t\t\t\t<Button variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t<Users className=\"mr-2 h-4 w-4\" />\n\t\t\t\t\t\tAdd Team Member\n\t\t\t\t\t</Button>\n\t\t\t\t)}\n\t\t\t</PopoverTrigger>\n\t\t\t<PopoverContent className=\"w-[400px] p-0\" align=\"start\">\n\t\t\t\t<Command shouldFilter={false}>\n\t\t\t\t\t<CommandInput\n\t\t\t\t\t\tplaceholder=\"Search team members...\"\n\t\t\t\t\t\tvalue={searchQuery}\n\t\t\t\t\t\tonValueChange={setSearchQuery}\n\t\t\t\t\t/>\n\t\t\t\t\t<CommandList>\n\t\t\t\t\t\t{searchResults.length === 0 && (\n\t\t\t\t\t\t\t<CommandEmpty>\n\t\t\t\t\t\t\t\t{searchQuery.trim()\n\t\t\t\t\t\t\t\t\t? \"No team members found\"\n\t\t\t\t\t\t\t\t\t: \"No available team members\"}\n\t\t\t\t\t\t\t</CommandEmpty>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{searchResults.length > 0 && (\n\t\t\t\t\t\t\t<CommandGroup heading=\"Available Team Members\">\n\t\t\t\t\t\t\t\t{searchResults.map((member) => (\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tkey={member.id}\n\t\t\t\t\t\t\t\t\t\tonClick={() => setSelectedMember(member)}\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"relative flex cursor-pointer select-none items-center justify-between gap-2 rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground\",\n\t\t\t\t\t\t\t\t\t\t\tselectedMember?.id === member.id && \"bg-accent\",\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"bg-primary/10 text-primary flex h-8 w-8 items-center justify-center rounded-full\">\n\t\t\t\t\t\t\t\t\t\t\t\t<User className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-col\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{getMemberName(member)}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t{member.jobTitle && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{member.jobTitle}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{selectedMember?.id === member.id && (\n\t\t\t\t\t\t\t\t\t\t\t<Check className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</CommandGroup>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</CommandList>\n\t\t\t\t</Command>\n\n\t\t\t\t{selectedMember && (\n\t\t\t\t\t<div className=\"space-y-3 border-t p-3\">\n\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-sm\">\n\t\t\t\t\t\t\t<User className=\"text-muted-foreground h-4 w-4\" />\n\t\t\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t\t\t{getMemberName(selectedMember)}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t{selectedMember.jobTitle && (\n\t\t\t\t\t\t\t\t<Badge variant=\"secondary\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t{selectedMember.jobTitle}\n\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<label className=\"text-xs font-medium\">Role</label>\n\t\t\t\t\t\t\t<Select value={selectedRole} onValueChange={setSelectedRole}>\n\t\t\t\t\t\t\t\t<SelectTrigger className=\"h-9\">\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"primary\">Primary</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"supervisor\">Supervisor</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"assistant\">Assistant</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"crew\">Crew</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tonClick={handleAssign}\n\t\t\t\t\t\t\tdisabled={isAssigning}\n\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{isAssigning ? \"Assigning...\" : \"Assign to Job\"}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</PopoverContent>\n\t\t</Popover>\n\t);\n}\n","\"use client\";\n\nimport {\n\tAlertCircle,\n\tEye,\n\tMoreHorizontal,\n\tUserMinus,\n\tUserX,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { useCallback, useMemo, useRef, useState } from \"react\";\nimport { toast } from \"sonner\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDialog,\n\tDialogContent,\n\tDialogDescription,\n\tDialogFooter,\n\tDialogHeader,\n\tDialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n\ttype ColumnDef,\n\tFullWidthDataTable,\n} from \"@/components/ui/full-width-datatable\";\nimport { TablePresets } from \"@/lib/datatable/table-presets\";\n\nimport { formatDate } from \"@/lib/formatters\";\n\ntype TeamMember = {\n\tid: string;\n\tuser_id: string;\n\tteam_member: {\n\t\tjob_title?: string;\n\t\tuser: {\n\t\t\tname?: string;\n\t\t\temail?: string;\n\t\t\tavatar_url?: string;\n\t\t\tfirst_name?: string;\n\t\t\tlast_name?: string;\n\t\t};\n\t};\n\tassigned_at: string;\n\trole?: string;\n};\n\ntype JobTeamMembersTableProps = {\n\tteamMembers: TeamMember[];\n\tonRemoveMember?: (\n\t\tmemberId: string,\n\t) => Promise<{ success: boolean; error?: string }>;\n};\n\nexport function JobTeamMembersTable({\n\tteamMembers,\n\tonRemoveMember,\n}: JobTeamMembersTableProps) {\n\tconst router = useRouter();\n\tconst [removeMemberId, setRemoveMemberId] = useState<string | null>(null);\n\tconst [isRemoving, setIsRemoving] = useState(false);\n\n\t// Guard against infinite refresh loops\n\tconst lastRefreshTimeRef = useRef<number>(0);\n\tconst REFRESH_COOLDOWN_MS = 1000; // Minimum 1 second between refreshes\n\n\tconst safeRefresh = useCallback(() => {\n\t\tconst now = Date.now();\n\t\tif (now - lastRefreshTimeRef.current < REFRESH_COOLDOWN_MS) {\n\t\t\tconsole.warn(\"⚠️ Refresh called too frequently, skipping to prevent loop\");\n\t\t\treturn;\n\t\t}\n\t\tlastRefreshTimeRef.current = now;\n\t\trouter.refresh();\n\t}, [router]);\n\n\tconst handleRemoveMember = useCallback(async () => {\n\t\tif (!removeMemberId || !onRemoveMember) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsRemoving(true);\n\t\ttry {\n\t\t\tconst result = await onRemoveMember(removeMemberId);\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Team member removed from job\");\n\t\t\t\tsetRemoveMemberId(null);\n\t\t\t\t// Use safe refresh to prevent infinite loops\n\t\t\t\tsafeRefresh();\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to remove team member\");\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\ttoast.error(\"Failed to remove team member\");\n\t\t} finally {\n\t\t\tsetIsRemoving(false);\n\t\t}\n\t}, [removeMemberId, onRemoveMember, safeRefresh]);\n\n\tconst getFullName = useCallback((member: TeamMember) => {\n\t\tconst user = member.team_member.user;\n\t\tif (user.name) return user.name;\n\t\tif (user.first_name || user.last_name) {\n\t\t\treturn [user.first_name, user.last_name].filter(Boolean).join(\" \");\n\t\t}\n\t\treturn user.email || \"Unknown User\";\n\t}, []);\n\n\tconst getInitials = useCallback((member: TeamMember) => {\n\t\tconst user = member.team_member.user;\n\t\tif (user.first_name && user.last_name) {\n\t\t\treturn `${user.first_name[0]}${user.last_name[0]}`.toUpperCase();\n\t\t}\n\t\tconst name = user.name || user.email || \"?\";\n\t\tconst parts = name.split(\" \");\n\t\tif (parts.length >= 2) {\n\t\t\treturn `${parts[0][0]}${parts[1][0]}`.toUpperCase();\n\t\t}\n\t\treturn name.substring(0, 2).toUpperCase();\n\t}, []);\n\n\tconst columns: ColumnDef<TeamMember>[] = useMemo(\n\t\t() => [\n\t\t\t{\n\t\t\t\tkey: \"name\",\n\t\t\t\theader: \"Name\",\n\t\t\t\trender: (member) => {\n\t\t\t\t\tconst fullName = getFullName(member);\n\t\t\t\t\tconst initials = getInitials(member);\n\t\t\t\t\tconst avatarUrl = member.team_member.user.avatar_url;\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\tclassName=\"flex items-center gap-2.5 text-xs leading-tight hover:underline\"\n\t\t\t\t\t\t\thref={`/dashboard/team/${member.user_id}`}\n\t\t\t\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Avatar className=\"size-8\">\n\t\t\t\t\t\t\t\t{avatarUrl && <AvatarImage alt={fullName} src={avatarUrl} />}\n\t\t\t\t\t\t\t\t<AvatarFallback className=\"bg-primary/10 text-primary text-xs font-semibold\">\n\t\t\t\t\t\t\t\t\t{initials}\n\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t<div className=\"flex flex-col\">\n\t\t\t\t\t\t\t\t<span className=\"text-foreground font-medium\">{fullName}</span>\n\t\t\t\t\t\t\t\t{member.team_member.user.email && (\n\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t{member.team_member.user.email}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Link>\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"job_title\",\n\t\t\t\theader: \"Job Title\",\n\t\t\t\twidth: \"w-40\",\n\t\t\t\tshrink: true,\n\t\t\t\thideOnMobile: true,\n\t\t\t\trender: (member) => (\n\t\t\t\t\t<span className=\"text-xs\">{member.team_member.job_title || \"—\"}</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"role\",\n\t\t\t\theader: \"Role\",\n\t\t\t\twidth: \"w-32\",\n\t\t\t\tshrink: true,\n\t\t\t\trender: (member) => (\n\t\t\t\t\t<span className=\"text-xs\">{member.role || \"Team Member\"}</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"assigned_at\",\n\t\t\t\theader: \"Assigned Date\",\n\t\t\t\twidth: \"w-32\",\n\t\t\t\tshrink: true,\n\t\t\t\thideOnMobile: true,\n\t\t\t\trender: (member) => (\n\t\t\t\t\t<span className=\"text-xs\">\n\t\t\t\t\t\t{formatDate(member.assigned_at, \"short\")}\n\t\t\t\t\t</span>\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: \"actions\",\n\t\t\t\theader: \"\",\n\t\t\t\twidth: \"w-12\",\n\t\t\t\tshrink: true,\n\t\t\t\talign: \"right\",\n\t\t\t\trender: (member) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t\t<Button className=\"size-8 p-0\" size=\"sm\" variant=\"ghost\">\n\t\t\t\t\t\t\t\t\t<MoreHorizontal className=\"size-4\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t\t<DropdownMenuContent align=\"end\" className=\"w-48\">\n\t\t\t\t\t\t\t\t<DropdownMenuItem className=\"cursor-pointer\" asChild>\n\t\t\t\t\t\t\t\t\t<Link href={`/dashboard/team/${member.user_id}`}>\n\t\t\t\t\t\t\t\t\t\t<Eye className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\t\tView Profile\n\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\tclassName=\"text-destructive focus:text-destructive cursor-pointer\"\n\t\t\t\t\t\t\t\t\tonClick={() => setRemoveMemberId(member.id)}\n\t\t\t\t\t\t\t\t\tdisabled={!onRemoveMember}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<UserMinus className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\tRemove from Job\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t\t</DropdownMenu>\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t\t[getFullName, getInitials, onRemoveMember],\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t<FullWidthDataTable\n\t\t\t\t{...TablePresets.compact()}\n\t\t\t\tcolumns={columns}\n\t\t\t\tdata={teamMembers}\n\t\t\t\temptyIcon={<UserX className=\"text-muted-foreground/50 size-12\" />}\n\t\t\t\temptyMessage=\"No team members assigned to this job\"\n\t\t\t\tgetItemId={(member) => member.id}\n\t\t\t\tnoPadding={true}\n\t\t\t\tsearchFilter={(member, query) => {\n\t\t\t\t\tconst searchLower = query.toLowerCase();\n\t\t\t\t\tconst fullName = getFullName(member);\n\t\t\t\t\treturn (\n\t\t\t\t\t\tfullName.toLowerCase().includes(searchLower) ||\n\t\t\t\t\t\tmember.team_member.user.email\n\t\t\t\t\t\t\t?.toLowerCase()\n\t\t\t\t\t\t\t.includes(searchLower) ||\n\t\t\t\t\t\tmember.team_member.job_title?.toLowerCase().includes(searchLower) ||\n\t\t\t\t\t\tmember.role?.toLowerCase().includes(searchLower)\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t\tsearchPlaceholder=\"Search team members...\"\n\t\t\t/>\n\n\t\t\t{/* Remove Confirmation Dialog */}\n\t\t\t<Dialog\n\t\t\t\tonOpenChange={(open) => !open && setRemoveMemberId(null)}\n\t\t\t\topen={removeMemberId !== null}\n\t\t\t>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>Remove Team Member from Job?</DialogTitle>\n\t\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t\tThis will remove this team member's assignment to this job. The\n\t\t\t\t\t\t\tteam member will remain in the system but will no longer be\n\t\t\t\t\t\t\tassociated with this job.\n\t\t\t\t\t\t</DialogDescription>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isRemoving}\n\t\t\t\t\t\t\tonClick={() => setRemoveMemberId(null)}\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={isRemoving}\n\t\t\t\t\t\t\tonClick={handleRemoveMember}\n\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{isRemoving ? \"Removing...\" : \"Remove Member\"}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</>\n\t);\n}\n"],"names":[],"mappings":"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"}