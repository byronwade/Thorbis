{"version":3,"sources":["../../../../../../apps/web/src/components/communication/unified-inbox-page-client.tsx","../../../../../../apps/web/src/components/communication/auto-link-suggestions.tsx","../../../../../../apps/web/src/actions/data%3Ad535cc%20%3Ctext/javascript%3E"],"sourcesContent":["/**\n * Unified Inbox Page Client Component\n *\n * Exact layout match to email/SMS pages - combines all communication types\n * Features: emails, SMS, calls, voicemails in single timeline\n */\n\n\"use client\";\n\nimport { useState, useCallback, useEffect, useRef, useTransition } from \"react\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { Sheet, SheetContent, SheetDescription, SheetHeader, SheetTitle, SheetTrigger } from \"@/components/ui/sheet\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { cn } from \"@/lib/utils\";\nimport { formatDistanceToNow, format } from \"date-fns\";\nimport {\n\tMail,\n\tMessageSquare,\n\tPhone,\n\tVoicemail,\n\tUser,\n\tBriefcase,\n\tMapPin,\n\tReply,\n\tForward,\n\tArchive,\n\tTrash2,\n\tStar,\n\tMoreHorizontal,\n\tStickyNote,\n\tLink as LinkIcon,\n\tAlertCircle,\n\tCheckCircle,\n\tClock,\n\tArrowLeft,\n\tX,\n\tRefreshCw,\n\tPanelLeft,\n\tFilter,\n\tSend,\n\tAlertTriangle,\n\tFlag,\n\tPrinter,\n\tDownload,\n} from \"lucide-react\";\nimport type { Communication } from \"@/lib/queries/communications\";\nimport { CustomerInfoPill } from \"@/components/communication/customer-info-pill\";\nimport { EmailContent } from \"@/components/communication/email-content\";\nimport { AutoLinkSuggestions } from \"@/components/communication/auto-link-suggestions\";\nimport { toast } from \"sonner\";\nimport { markEmailAsReadAction, archiveEmailAction, toggleStarEmailAction, bulkDeleteEmailsAction } from \"@/actions/email-actions\";\nimport { useSidebar } from \"@/components/ui/sidebar\";\nimport Link from \"next/link\";\nimport { getCustomerDisplayName } from \"@/lib/utils/customer-display\";\n\ntype CommunicationType = \"all\" | \"email\" | \"sms\" | \"call\" | \"voicemail\";\n\ninterface UnifiedInboxPageClientProps {\n\tinitialCommunications: Communication[];\n\tcompanyId: string;\n\tteamMemberId: string;\n\tselectedId?: string | null;\n}\n\nexport function UnifiedInboxPageClient({\n\tinitialCommunications,\n\tcompanyId,\n\tteamMemberId,\n\tselectedId: initialSelectedId,\n}: UnifiedInboxPageClientProps) {\n\tconst router = useRouter();\n\tconst searchParams = useSearchParams();\n\tconst { toggleSidebar } = useSidebar();\n\tconst [isPending, startTransition] = useTransition();\n\n\tconst communicationIdFromQuery = searchParams?.get(\"id\");\n\tconst communicationId = communicationIdFromQuery || initialSelectedId;\n\n\tconst [communications, setCommunications] = useState<Communication[]>(initialCommunications);\n\tconst [refreshing, setRefreshing] = useState(false);\n\tconst [error, setError] = useState<string | null>(null);\n\tconst [selectedCommunication, setSelectedCommunication] = useState<Communication | null>(() => {\n\t\tif (initialSelectedId && initialCommunications) {\n\t\t\treturn initialCommunications.find((c) => c.id === initialSelectedId) || null;\n\t\t}\n\t\treturn null;\n\t});\n\n\tconst [searchQuery, setSearchQuery] = useState(\"\");\n\tconst [searchInput, setSearchInput] = useState(\"\");\n\tconst [typeFilter, setTypeFilter] = useState<CommunicationType>(\"all\");\n\tconst [notesOpen, setNotesOpen] = useState(false);\n\tconst [internalNotes, setInternalNotes] = useState(\"\");\n\tconst [savingNotes, setSavingNotes] = useState(false);\n\n\tconst searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\tconst selectedCommunicationRef = useRef<Communication | null>(selectedCommunication);\n\tconst refreshingRef = useRef(refreshing);\n\trefreshingRef.current = refreshing;\n\n\t// Update selected communication when URL changes\n\tuseEffect(() => {\n\t\tif (communicationId && communications) {\n\t\t\tconst comm = communications.find((c) => c.id === communicationId);\n\t\t\tif (comm) {\n\t\t\t\tsetSelectedCommunication(comm);\n\t\t\t\tsetInternalNotes(comm.internalNotes || \"\");\n\t\t\t\tselectedCommunicationRef.current = comm;\n\t\t\t}\n\t\t} else {\n\t\t\tsetSelectedCommunication(null);\n\t\t\tselectedCommunicationRef.current = null;\n\t\t}\n\t}, [communicationId, communications]);\n\n\t// Debounced search\n\tuseEffect(() => {\n\t\tif (searchTimeoutRef.current) {\n\t\t\tclearTimeout(searchTimeoutRef.current);\n\t\t}\n\n\t\tsearchTimeoutRef.current = setTimeout(() => {\n\t\t\tsetSearchQuery(searchInput);\n\t\t}, 300);\n\n\t\treturn () => {\n\t\t\tif (searchTimeoutRef.current) {\n\t\t\t\tclearTimeout(searchTimeoutRef.current);\n\t\t\t}\n\t\t};\n\t}, [searchInput]);\n\n\t// Fetch communications function\n\tconst fetchCommunications = useCallback(\n\t\tasync (showRefreshing = false) => {\n\t\t\tsetRefreshing(true);\n\t\t\tsetError(null);\n\n\t\t\tstartTransition(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst { getCommunicationsAction } = await import(\"@/actions/communications\");\n\t\t\t\t\tconst result = await getCommunicationsAction({\n\t\t\t\t\t\tteamMemberId,\n\t\t\t\t\t\tcompanyId,\n\t\t\t\t\t\ttype: typeFilter !== \"all\" ? typeFilter : undefined,\n\t\t\t\t\t\tlimit: 100,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (result.success && result.data) {\n\t\t\t\t\t\tsetCommunications(result.data as Communication[]);\n\n\t\t\t\t\t\t// Update selected communication if it's still in the list\n\t\t\t\t\t\tconst currentSelected = selectedCommunicationRef.current;\n\t\t\t\t\t\tif (currentSelected) {\n\t\t\t\t\t\t\tconst updatedComm = (result.data as Communication[]).find((c) => c.id === currentSelected.id);\n\t\t\t\t\t\t\tif (updatedComm) {\n\t\t\t\t\t\t\t\tsetSelectedCommunication(updatedComm);\n\t\t\t\t\t\t\t\tselectedCommunicationRef.current = updatedComm;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.error(\"Failed to fetch communications:\", err);\n\t\t\t\t\tconst errorMessage = err instanceof Error ? err.message : \"Failed to load communications\";\n\t\t\t\t\tsetError(errorMessage);\n\t\t\t\t\ttoast.error(\"Failed to load communications\", { description: errorMessage });\n\t\t\t\t} finally {\n\t\t\t\t\tsetRefreshing(false);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t[teamMemberId, companyId, typeFilter]\n\t);\n\n\t// Refetch when type filter changes\n\tuseEffect(() => {\n\t\tfetchCommunications();\n\t}, [typeFilter]);\n\n\t// Refetch when search changes\n\tuseEffect(() => {\n\t\tif (searchQuery) {\n\t\t\tfetchCommunications();\n\t\t}\n\t}, [searchQuery]);\n\n\t// Auto-refresh every 30 seconds\n\tuseEffect(() => {\n\t\tconst interval = setInterval(() => {\n\t\t\tif (!refreshingRef.current) {\n\t\t\t\tfetchCommunications();\n\t\t\t}\n\t\t}, 30000);\n\n\t\treturn () => clearInterval(interval);\n\t}, [fetchCommunications]);\n\n\t// Handle communication selection\n\tconst handleCommunicationSelect = useCallback(\n\t\t(communication: Communication) => {\n\t\t\tsetSelectedCommunication(communication);\n\t\t\tsetInternalNotes(communication.internalNotes || \"\");\n\t\t\tselectedCommunicationRef.current = communication;\n\n\t\t\tconst params = new URLSearchParams(searchParams?.toString() || \"\");\n\t\t\tparams.set(\"id\", communication.id);\n\t\t\trouter.push(`/dashboard/communication?${params.toString()}`, { scroll: false });\n\n\t\t\t// Mark as read if unread\n\t\t\tif (communication.status === \"unread\" || communication.status === \"new\") {\n\t\t\t\tmarkEmailAsReadAction(communication.id).catch((err) => {\n\t\t\t\t\tconsole.error(\"Failed to mark as read:\", err);\n\t\t\t\t});\n\t\t\t\t// Optimistically update local state\n\t\t\t\tsetCommunications((prev) =>\n\t\t\t\t\tprev.map((c) =>\n\t\t\t\t\t\tc.id === communication.id ? { ...c, status: \"read\" } : c\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\t[router, searchParams]\n\t);\n\n\t// Save internal notes\n\tconst handleSaveNotes = useCallback(async () => {\n\t\tif (!selectedCommunication) return;\n\n\t\tsetSavingNotes(true);\n\t\ttry {\n\t\t\tconst { saveInternalNotesAction } = await import(\"@/actions/communications\");\n\t\t\tconst result = await saveInternalNotesAction({\n\t\t\t\tcommunicationId: selectedCommunication.id,\n\t\t\t\tnotes: internalNotes,\n\t\t\t});\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Notes saved\");\n\t\t\t\tsetCommunications((prev) =>\n\t\t\t\t\tprev.map((c) =>\n\t\t\t\t\t\tc.id === selectedCommunication.id\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t...c,\n\t\t\t\t\t\t\t\t\tinternalNotes,\n\t\t\t\t\t\t\t\t\tinternalNotesUpdatedAt: new Date().toISOString(),\n\t\t\t\t\t\t\t\t\tinternalNotesUpdatedBy: teamMemberId,\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: c\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\tsetNotesOpen(false);\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to save notes\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to save notes:\", error);\n\t\t\ttoast.error(\"Failed to save notes\");\n\t\t} finally {\n\t\t\tsetSavingNotes(false);\n\t\t}\n\t}, [selectedCommunication, internalNotes, teamMemberId]);\n\n\t// Handle star/archive/delete actions\n\tconst handleArchive = useCallback(async (communicationId: string) => {\n\t\ttry {\n\t\t\tconst result = await archiveEmailAction(communicationId);\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Archived\");\n\t\t\t\t// Remove from local state\n\t\t\t\tsetCommunications((prev) => prev.filter((c) => c.id !== communicationId));\n\t\t\t\tif (selectedCommunication?.id === communicationId) {\n\t\t\t\t\tsetSelectedCommunication(null);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to archive\");\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.error(\"Failed to archive:\", err);\n\t\t\ttoast.error(\"Failed to archive\");\n\t\t}\n\t}, [selectedCommunication]);\n\n\tconst handleStar = useCallback(async (communicationId: string) => {\n\t\ttry {\n\t\t\tconst result = await toggleStarEmailAction(communicationId);\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Updated\");\n\t\t\t\t// Update local state\n\t\t\t\tsetCommunications((prev) =>\n\t\t\t\t\tprev.map((c) =>\n\t\t\t\t\t\tc.id === communicationId ? { ...c, isStarred: !c.isStarred } : c\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to update\");\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.error(\"Failed to star:\", err);\n\t\t\ttoast.error(\"Failed to update\");\n\t\t}\n\t}, []);\n\n\tconst handleDelete = useCallback(async (communicationId: string) => {\n\t\ttry {\n\t\t\tconst result = await bulkDeleteEmailsAction([communicationId]);\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Deleted\");\n\t\t\t\t// Remove from local state\n\t\t\t\tsetCommunications((prev) => prev.filter((c) => c.id !== communicationId));\n\t\t\t\tif (selectedCommunication?.id === communicationId) {\n\t\t\t\t\tsetSelectedCommunication(null);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to delete\");\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.error(\"Failed to delete:\", err);\n\t\t\ttoast.error(\"Failed to delete\");\n\t\t}\n\t}, [selectedCommunication]);\n\n\t// Filter communications by search\n\tconst filteredCommunications = communications.filter((comm) => {\n\t\tif (searchQuery) {\n\t\t\tconst query = searchQuery.toLowerCase();\n\t\t\tconst matchesSubject = comm.subject?.toLowerCase().includes(query);\n\t\t\tconst matchesBody = comm.body?.toLowerCase().includes(query);\n\t\t\tconst matchesFrom = comm.fromAddress?.toLowerCase().includes(query);\n\t\t\tconst matchesTo = comm.toAddress?.toLowerCase().includes(query);\n\t\t\treturn matchesSubject || matchesBody || matchesFrom || matchesTo;\n\t\t}\n\t\treturn true;\n\t});\n\n\t// Mobile: show list when no communication selected, show detail when communication selected\n\tconst showListOnMobile = !selectedCommunication;\n\tconst showDetailOnMobile = selectedCommunication;\n\n\t// Get type icon and colors\n\tconst getTypeConfig = (type: string) => {\n\t\tswitch (type) {\n\t\t\tcase \"email\":\n\t\t\t\treturn { icon: Mail, color: \"text-blue-500\", bg: \"bg-blue-500/10\" };\n\t\t\tcase \"sms\":\n\t\t\t\treturn { icon: MessageSquare, color: \"text-green-500\", bg: \"bg-green-500/10\" };\n\t\t\tcase \"call\":\n\t\t\t\treturn { icon: Phone, color: \"text-purple-500\", bg: \"bg-purple-500/10\" };\n\t\t\tcase \"voicemail\":\n\t\t\t\treturn { icon: Voicemail, color: \"text-orange-500\", bg: \"bg-orange-500/10\" };\n\t\t\tdefault:\n\t\t\t\treturn { icon: Mail, color: \"text-gray-500\", bg: \"bg-gray-500/10\" };\n\t\t}\n\t};\n\n\t// Type filter buttons\n\tconst typeFilters: { type: CommunicationType; label: string; count: number }[] = [\n\t\t{\n\t\t\ttype: \"all\",\n\t\t\tlabel: \"All\",\n\t\t\tcount: communications.length,\n\t\t},\n\t\t{\n\t\t\ttype: \"email\",\n\t\t\tlabel: \"Email\",\n\t\t\tcount: communications.filter((c) => c.type === \"email\").length,\n\t\t},\n\t\t{\n\t\t\ttype: \"sms\",\n\t\t\tlabel: \"SMS\",\n\t\t\tcount: communications.filter((c) => c.type === \"sms\").length,\n\t\t},\n\t\t{\n\t\t\ttype: \"call\",\n\t\t\tlabel: \"Calls\",\n\t\t\tcount: communications.filter((c) => c.type === \"call\").length,\n\t\t},\n\t\t{\n\t\t\ttype: \"voicemail\",\n\t\t\tlabel: \"Voicemail\",\n\t\t\tcount: communications.filter((c) => c.type === \"voicemail\").length,\n\t\t},\n\t];\n\n\treturn (\n\t\t<div className=\"flex h-full w-full flex-col overflow-hidden bg-sidebar\">\n\t\t\t<div className=\"flex flex-1 overflow-hidden min-h-0 md:gap-2\">\n\t\t\t\t{/* Left Panel - Communications List */}\n\t\t\t\t<div\n\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\"bg-card mb-1 shadow-sm flex flex-col overflow-hidden\",\n\t\t\t\t\t\t\"w-full h-full\", // Mobile: full width/height\n\t\t\t\t\t\t\"md:w-[400px] lg:w-[480px] md:rounded-tr-2xl\", // Desktop: fixed width with rounded corner\n\t\t\t\t\t\t// Mobile visibility logic\n\t\t\t\t\t\tshowListOnMobile ? \"flex\" : \"hidden md:flex\"\n\t\t\t\t\t)}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"w-full h-full flex flex-col\">\n\t\t\t\t\t\t{/* Header with search and filters */}\n\t\t\t\t\t\t<div className=\"sticky top-0 z-15 flex flex-col gap-2 p-2 pb-0 transition-colors bg-card\">\n\t\t\t\t\t\t\t<div className=\"grid grid-cols-12 gap-2 mt-1\">\n\t\t\t\t\t\t\t\t<div className=\"col-span-12 flex gap-2\">\n\t\t\t\t\t\t\t\t\t{/* Sidebar toggle */}\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tonClick={toggleSidebar}\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8 shrink-0\"\n\t\t\t\t\t\t\t\t\t\ttitle=\"Toggle sidebar\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<PanelLeft className=\"h-5 w-5 md:h-4 md:w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t</Button>\n\n\t\t\t\t\t\t\t\t\t{/* Search input */}\n\t\t\t\t\t\t\t\t\t<div className=\"relative flex-1\">\n\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\ttype=\"search\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Search communications...\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={searchInput}\n\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => setSearchInput(e.target.value)}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 md:h-8 pl-9 pr-20 text-base md:text-sm border-input bg-white dark:bg-[#141414] dark:border-none\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\twidth=\"10\"\n\t\t\t\t\t\t\t\t\t\t\theight=\"10\"\n\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 10 10\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"absolute left-3 top-1/2 -translate-y-1/2 fill-[#71717A] dark:fill-[#6F6F6F]\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\td=\"M6.81038 7.0756C6.18079 7.54011 5.40248 7.81466 4.56004 7.81466C2.46451 7.81466 0.765747 6.11589 0.765747 4.02037C0.765747 1.92484 2.46451 0.226074 4.56004 0.226074C6.65557 0.226074 8.35433 1.92484 8.35433 4.02037C8.35433 4.8628 8.07978 5.64112 7.61527 6.27071L9.70535 8.36078C9.92761 8.58305 9.92761 8.94341 9.70535 9.16568C9.48308 9.38794 9.12272 9.38794 8.90046 9.16568L6.81038 7.0756ZM7.21604 4.02037C7.21604 5.48724 6.02691 6.67637 4.56004 6.67637C3.09317 6.67637 1.90403 5.48724 1.90403 4.02037C1.90403 2.5535 3.09317 1.36436 4.56004 1.36436C6.02691 1.36436 7.21604 2.5535 7.21604 4.02037Z\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t{searchInput && (\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setSearchInput(\"\")}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<X className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{/* Refresh button */}\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => fetchCommunications(true)}\n\t\t\t\t\t\t\t\t\t\tdisabled={refreshing}\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8\"\n\t\t\t\t\t\t\t\t\t\ttitle=\"Refresh\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<RefreshCw\n\t\t\t\t\t\t\t\t\t\t\tclassName={`h-5 w-5 md:h-4 md:w-4 text-muted-foreground ${refreshing ? \"animate-spin\" : \"\"}`}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Type filter buttons */}\n\t\t\t\t\t\t\t<div className=\"flex gap-1 overflow-x-auto pb-2 scrollbar-none\">\n\t\t\t\t\t\t\t\t{typeFilters.map(({ type, label, count }) => (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tkey={type}\n\t\t\t\t\t\t\t\t\t\tvariant={typeFilter === type ? \"default\" : \"ghost\"}\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => setTypeFilter(type)}\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-7 gap-1 whitespace-nowrap text-xs shrink-0\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{label}\n\t\t\t\t\t\t\t\t\t\t{count > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant={typeFilter === type ? \"secondary\" : \"outline\"} className=\"ml-0.5 h-4 px-1 text-[10px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t{count}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* Progress bar */}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\"bg-[#006FFE] relative z-5 h-0.5 w-full transition-opacity\",\n\t\t\t\t\t\t\t\trefreshing ? \"opacity-100 animate-pulse\" : \"opacity-0\"\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t{/* Communications List */}\n\t\t\t\t\t\t<div className=\"relative z-1 flex-1 overflow-hidden pt-0 min-h-0\">\n\t\t\t\t\t\t\t<div className=\"hide-link-indicator flex h-full w-full\">\n\t\t\t\t\t\t\t\t<div className=\"flex flex-1 flex-col\">\n\t\t\t\t\t\t\t\t\t<ScrollArea className=\"scrollbar-none flex-1 overflow-x-hidden h-full\">\n\t\t\t\t\t\t\t\t\t\t{error && (!communications || communications.length === 0) ? (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center p-8\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-8 w-8 text-destructive mx-auto mb-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-destructive mb-2 font-medium\">Failed to load communications</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground mb-4\">{error}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button variant=\"outline\" size=\"sm\" onClick={() => fetchCommunications()}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tTry Again\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t) : filteredCommunications.length ? (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-h-[200px] px-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t{filteredCommunications.map((communication) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst isSelected = selectedCommunication?.id === communication.id;\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst isUnread = communication.status === \"unread\" || communication.status === \"new\";\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst typeConfig = getTypeConfig(communication.type);\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst TypeIcon = typeConfig.icon;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div key={communication.id} className=\"select-none md:my-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"hover:bg-accent group flex cursor-pointer flex-col items-start rounded-lg py-2 text-left text-sm transition-all hover:opacity-100 relative\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisSelected ? \"bg-accent opacity-100\" : \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisUnread ? \"opacity-100\" : \"opacity-60\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleCommunicationSelect(communication)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Hover Action Toolbar */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"dark:bg-panelDark absolute right-2 z-25 flex -translate-y-1/2 items-center gap-1 rounded-xl border bg-white p-1 opacity-0 shadow-sm group-hover:opacity-100 top-[-1] transition-opacity duration-200\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-6 w-6 overflow-visible p-0 hover:bg-accent group/star\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleStar(communication.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Star\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Star className=\"h-4 w-4 text-muted-foreground transition-colors group-hover/star:text-yellow-500\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-6 w-6 p-0 hover:bg-accent group/archive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleArchive(communication.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Archive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Archive className=\"h-4 w-4 text-muted-foreground transition-colors group-hover/archive:text-blue-500\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Communication Card Content */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"relative flex w-full items-center justify-between gap-4 px-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Avatar with type badge */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Avatar className=\"h-8 w-8 shrink-0 rounded-full border\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarFallback className=\"bg-white dark:bg-[#373737] text-[#9F9F9D] font-bold text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{(communication.direction === \"inbound\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? communication.fromAddress?.[0]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: communication.toAddress?.[0]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)?.toUpperCase() || \"?\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className={cn(\"absolute -bottom-1 -right-1 rounded-full p-0.5 border border-white dark:border-[#1C1C1C]\", typeConfig.bg)}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TypeIcon className={cn(\"h-2.5 w-2.5\", typeConfig.color)} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex w-full justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-full\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex w-full flex-row items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-row items-center gap-[4px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-bold text-md flex items-baseline gap-1 group-hover:opacity-100\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"line-clamp-1 overflow-hidden text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{communication.direction === \"outbound\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? communication.toAddress || \"Unknown recipient\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: communication.fromAddress || \"Unknown sender\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{isUnread && <span className=\"ml-0.5 size-2 rounded-full bg-[#006FFE]\"></span>}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-nowrap text-xs font-normal opacity-70 transition-opacity group-hover:opacity-100 dark:text-[#8C8C8C]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{communication.createdAt\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? new Date(communication.createdAt).toLocaleTimeString([], {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thour: \"2-digit\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tminute: \"2-digit\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"mt-1 line-clamp-1 min-w-0 overflow-hidden text-sm text-[#8C8C8C] flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{communication.subject || communication.body || \"No content\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Status badges */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1 shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Customer link badge */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{communication.customerId && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thref={`/dashboard/customers/${communication.customerId}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"px-1.5 py-0.5 rounded text-[10px] bg-primary/10 text-primary hover:bg-primary/20 transition-colors flex items-center gap-0.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"View customer profile\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<User className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Job link badge */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{communication.jobId && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-1.5 py-0.5 rounded text-[10px] bg-purple-500/10 text-purple-600 flex items-center gap-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Briefcase className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Auto-link badge */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{communication.autoLinked && communication.linkConfidence !== undefined && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"px-1.5 py-0.5 rounded text-[10px] flex items-center gap-0.5\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcommunication.linkConfidence >= 0.8\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-green-500/10 text-green-600\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-yellow-500/10 text-yellow-600\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle={`Auto-linked: ${Math.round(communication.linkConfidence * 100)}%`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<LinkIcon className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Internal notes badge */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{communication.internalNotes && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-1.5 py-0.5 rounded text-[10px] bg-muted text-muted-foreground flex items-center gap-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<StickyNote className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Failed status */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{communication.status === \"failed\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-1.5 py-0.5 rounded text-[10px] bg-destructive/10 text-destructive flex items-center gap-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center p-8\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">No communications found</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{searchQuery && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground mt-1\">Try adjusting your search</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</ScrollArea>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Right Panel - Communication Detail */}\n\t\t\t\t{selectedCommunication ? (\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"bg-card mb-1 shadow-sm flex flex-col min-w-0 overflow-hidden\",\n\t\t\t\t\t\t\t\"w-full h-full\", // Mobile: full width/height\n\t\t\t\t\t\t\t\"md:rounded-tl-2xl md:flex-1\", // Desktop: rounded corner and flex\n\t\t\t\t\t\t\tshowDetailOnMobile ? \"flex\" : \"hidden md:flex\"\n\t\t\t\t\t\t)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div className=\"relative flex-1 min-h-0 flex flex-col\">\n\t\t\t\t\t\t\t<div className=\"bg-card relative flex flex-col overflow-hidden transition-all duration-300 h-full flex-1 min-h-0\">\n\t\t\t\t\t\t\t\t{/* Communication Header Toolbar */}\n\t\t\t\t\t\t\t\t<div className=\"sticky top-0 z-15 flex shrink-0 items-center justify-between gap-1.5 p-2 pb-0 transition-colors bg-card\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex flex-1 items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t{/* Back button (mobile) / Close button (desktop) */}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tsetSelectedCommunication(null);\n\t\t\t\t\t\t\t\t\t\t\t\tselectedCommunicationRef.current = null;\n\t\t\t\t\t\t\t\t\t\t\t\tconst params = new URLSearchParams();\n\t\t\t\t\t\t\t\t\t\t\t\trouter.push(`/dashboard/communication?${params.toString()}`, { scroll: false });\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8\"\n\t\t\t\t\t\t\t\t\t\t\ttitle=\"Back to list\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<ArrowLeft className=\"h-5 w-5 md:hidden text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t<X className=\"h-4 w-4 hidden md:block text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t<Separator orientation=\"vertical\" className=\"h-4 bg-border/60 hidden md:block\" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t{/* Reply button (for emails/SMS) */}\n\t\t\t\t\t\t\t\t\t\t{(selectedCommunication.type === \"email\" || selectedCommunication.type === \"sms\") && (\n\t\t\t\t\t\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" className=\"h-10 w-10 p-0 md:h-8 md:w-auto md:px-2\" title=\"Reply\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Reply className=\"h-5 w-5 md:h-4 md:w-4 md:mr-1.5 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm leading-none font-medium hidden md:inline\">Reply</span>\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t{/* Notes */}\n\t\t\t\t\t\t\t\t\t\t<Sheet open={notesOpen} onOpenChange={setNotesOpen}>\n\t\t\t\t\t\t\t\t\t\t\t<SheetTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8 hidden md:flex\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Internal notes\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<StickyNote className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</SheetTrigger>\n\t\t\t\t\t\t\t\t\t\t\t<SheetContent>\n\t\t\t\t\t\t\t\t\t\t\t\t<SheetHeader>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<SheetTitle>Internal Notes</SheetTitle>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<SheetDescription>Private team notes - not visible to customer</SheetDescription>\n\t\t\t\t\t\t\t\t\t\t\t\t</SheetHeader>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"py-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Add your notes here...\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={internalNotes}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => setInternalNotes(e.target.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"min-h-[200px] resize-none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.internalNotesUpdatedAt && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground mt-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tLast updated{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatDistanceToNow(new Date(selectedCommunication.internalNotesUpdatedAt), {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taddSuffix: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"mt-4 flex justify-end gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button variant=\"outline\" size=\"sm\" onClick={() => setNotesOpen(false)}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button size=\"sm\" onClick={handleSaveNotes} disabled={savingNotes}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{savingNotes ? \"Saving...\" : \"Save Notes\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</SheetContent>\n\t\t\t\t\t\t\t\t\t\t</Sheet>\n\t\t\t\t\t\t\t\t\t\t{/* Star */}\n\t\t\t\t\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" className=\"h-10 w-10 p-0 md:h-8 md:w-8 group/star\" title=\"Star\">\n\t\t\t\t\t\t\t\t\t\t\t<Star className=\"h-5 w-5 md:h-4 md:w-4 text-muted-foreground transition-colors group-hover/star:text-yellow-500\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/* Archive */}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8\"\n\t\t\t\t\t\t\t\t\t\t\ttitle=\"Archive\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => selectedCommunication && handleArchive(selectedCommunication.id)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Archive className=\"h-5 w-5 md:h-4 md:w-4\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/* More menu */}\n\t\t\t\t\t\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" className=\"h-10 w-10 p-0 md:h-8 md:w-8\" title=\"More\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<MoreHorizontal className=\"h-5 w-5 md:h-4 md:w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuContent align=\"end\" className=\"w-48\">\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem onClick={() => setNotesOpen(true)} className=\"md:hidden\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<StickyNote className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tNotes\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuSeparator className=\"md:hidden\" />\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem onClick={() => handleDelete(selectedCommunication.id)} className=\"text-destructive focus:text-destructive\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tDelete\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t\t\t\t\t\t</DropdownMenu>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{/* Communication Content */}\n\t\t\t\t\t\t\t\t<div className=\"flex min-h-0 flex-1 flex-col overflow-hidden\">\n\t\t\t\t\t\t\t\t\t<div className=\"relative overflow-hidden flex-1 h-full min-h-0 flex flex-col\">\n\t\t\t\t\t\t\t\t\t\t<TooltipProvider delayDuration={100}>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"border-b border-border/50 px-2 py-4 space-y-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t<h1 className=\"text-base font-semibold text-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.subject || (selectedCommunication.type === \"sms\" ? \"Text Message\" : \"No Subject\")}\n\t\t\t\t\t\t\t\t\t\t\t\t</h1>\n\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Avatar className=\"h-9 w-9 shrink-0 rounded-md cursor-pointer\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarFallback className=\"bg-muted text-muted-foreground font-semibold text-sm rounded-md\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{(selectedCommunication.direction === \"inbound\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? selectedCommunication.fromAddress?.[0]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: selectedCommunication.toAddress?.[0]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)?.toUpperCase() || \"?\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold text-sm text-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.direction === \"inbound\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? selectedCommunication.fromAddress || \"Unknown\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: selectedCommunication.toAddress || \"Unknown\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{(selectedCommunication.status === \"unread\" || selectedCommunication.status === \"new\") && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"h-2 w-2 rounded-full bg-primary\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.direction === \"inbound\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? `from ${selectedCommunication.fromAddress?.split(\"@\")[0] || \"unknown\"}`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: `to ${selectedCommunication.toAddress?.split(\"@\")[0] || \"unknown\"}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.customerId && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"outline\" className=\"gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<User className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCustomer\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{new Date(selectedCommunication.createdAt).toLocaleTimeString(\"en-US\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thour: \"numeric\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tminute: \"2-digit\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t{/* Status and link indicators */}\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 flex-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.autoLinked && selectedCommunication.linkConfidence !== undefined && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant={selectedCommunication.linkConfidence >= 0.8 ? \"default\" : \"secondary\"} className=\"gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<LinkIcon className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAuto-linked ({Math.round(selectedCommunication.linkConfidence * 100)}%)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.status && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"outline\" className=\"gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.status}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.type && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"outline\" className=\"gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.type}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t{/* Auto-Link Suggestions */}\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"px-2 py-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<AutoLinkSuggestions\n\t\t\t\t\t\t\t\t\t\t\t\t\tcommunication={selectedCommunication}\n\t\t\t\t\t\t\t\t\t\t\t\t\tcompanyId={companyId}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonLinked={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Refresh communications to get updated link data\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfetchCommunications();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t{/* Message Content */}\n\t\t\t\t\t\t\t\t\t\t\t<ScrollArea className=\"flex-1 px-2 py-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.type === \"email\" ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<EmailContent\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={selectedCommunication.body || \"\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontentType={(selectedCommunication.contentType as \"html\" | \"text\") || \"text\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"prose prose-sm max-w-none\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"whitespace-pre-wrap\">{selectedCommunication.body || \"No content\"}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</ScrollArea>\n\t\t\t\t\t\t\t\t\t\t</TooltipProvider>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t) : (\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"bg-card mb-1 shadow-sm hidden md:flex md:flex-col md:items-center md:justify-center md:rounded-tl-2xl md:flex-1\"\n\t\t\t\t\t\t)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Mail className=\"h-16 w-16 text-muted-foreground mb-4\" />\n\t\t\t\t\t\t<h3 className=\"text-lg font-semibold\">No communication selected</h3>\n\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">Select a communication from the list to view details</p>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","/**\n * Auto-Link Suggestions Component\n *\n * Displays suggested customer/job/property matches for unlinked communications\n * Shows confidence scores and allows CSRs to accept or reject suggestions\n *\n * Features:\n * - Match suggestions based on email/phone\n * - Confidence score indicators\n * - One-click linking with optimistic updates\n * - Dismissible suggestions\n */\n\n\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { autoLinkCommunicationAction, getAutoLinkSuggestionsAction, type MatchSuggestion } from \"@/actions/communications\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { cn } from \"@/lib/utils\";\nimport { User, Briefcase, MapPin, Check, X, AlertCircle, Link2 } from \"lucide-react\";\nimport type { Communication } from \"@/lib/queries/communications\";\n\ninterface AutoLinkSuggestionsProps {\n\tcommunication: Communication;\n\tcompanyId?: string;\n\tonLinked?: () => void;\n}\n\nexport function AutoLinkSuggestions({ communication, companyId, onLinked }: AutoLinkSuggestionsProps) {\n\tconst [suggestions, setSuggestions] = useState<MatchSuggestion[]>([]);\n\tconst [loading, setLoading] = useState(true);\n\tconst [linking, setLinking] = useState<string | null>(null);\n\tconst [dismissed, setDismissed] = useState<Set<string>>(new Set());\n\n\t// Fetch suggestions on mount\n\tuseEffect(() => {\n\t\tasync function fetchSuggestions() {\n\t\t\tif (!companyId) return;\n\n\t\t\tsetLoading(true);\n\t\t\ttry {\n\t\t\t\tconst result = await getAutoLinkSuggestionsAction({\n\t\t\t\t\tcommunicationId: communication.id,\n\t\t\t\t\tcompanyId,\n\t\t\t\t});\n\n\t\t\t\tif (result.success && result.suggestions) {\n\t\t\t\t\tsetSuggestions(result.suggestions);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Failed to fetch suggestions:\", error);\n\t\t\t} finally {\n\t\t\t\tsetLoading(false);\n\t\t\t}\n\t\t}\n\n\t\tfetchSuggestions();\n\t}, [communication.id, companyId]);\n\n\t// Don't show if already linked\n\tif (communication.customerId || communication.jobId || communication.propertyId) {\n\t\treturn null;\n\t}\n\n\t// Filter out dismissed suggestions\n\tconst activeSuggestions = suggestions.filter((s) => !dismissed.has(s.id));\n\n\t// Show loading state\n\tif (loading) {\n\t\treturn (\n\t\t\t<Card className=\"border-blue-200 bg-blue-50/50 dark:border-blue-900 dark:bg-blue-950/20\">\n\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Link2 className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-semibold\">Looking for matches...</CardTitle>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t</Card>\n\t\t);\n\t}\n\n\tif (activeSuggestions.length === 0) {\n\t\treturn null;\n\t}\n\n\tconst handleAccept = async (suggestion: MatchSuggestion) => {\n\t\tsetLinking(suggestion.id);\n\n\t\ttry {\n\t\t\tconst result = await autoLinkCommunicationAction({\n\t\t\t\tcommunicationId: communication.id,\n\t\t\t\tcustomerId: suggestion.type === \"customer\" ? suggestion.id : undefined,\n\t\t\t\tjobId: suggestion.type === \"job\" ? suggestion.id : undefined,\n\t\t\t\tpropertyId: suggestion.type === \"property\" ? suggestion.id : undefined,\n\t\t\t\tlinkConfidence: suggestion.confidence,\n\t\t\t\tlinkMethod: suggestion.matchMethod,\n\t\t\t});\n\n\t\t\tif (result.success) {\n\t\t\t\t// Remove accepted suggestion and related ones\n\t\t\t\tsetSuggestions((prev) => prev.filter((s) => s.id !== suggestion.id));\n\t\t\t\tonLinked?.();\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to link communication:\", error);\n\t\t} finally {\n\t\t\tsetLinking(null);\n\t\t}\n\t};\n\n\tconst handleDismiss = (suggestionId: string) => {\n\t\tsetDismissed((prev) => new Set([...prev, suggestionId]));\n\t};\n\n\tconst getTypeConfig = (type: MatchSuggestion[\"type\"]) => {\n\t\tswitch (type) {\n\t\t\tcase \"customer\":\n\t\t\t\treturn {\n\t\t\t\t\ticon: User,\n\t\t\t\t\tcolor: \"text-blue-500\",\n\t\t\t\t\tbg: \"bg-blue-500/10\",\n\t\t\t\t\tlabel: \"Customer\",\n\t\t\t\t};\n\t\t\tcase \"job\":\n\t\t\t\treturn {\n\t\t\t\t\ticon: Briefcase,\n\t\t\t\t\tcolor: \"text-purple-500\",\n\t\t\t\t\tbg: \"bg-purple-500/10\",\n\t\t\t\t\tlabel: \"Job\",\n\t\t\t\t};\n\t\t\tcase \"property\":\n\t\t\t\treturn {\n\t\t\t\t\ticon: MapPin,\n\t\t\t\t\tcolor: \"text-green-500\",\n\t\t\t\t\tbg: \"bg-green-500/10\",\n\t\t\t\t\tlabel: \"Property\",\n\t\t\t\t};\n\t\t}\n\t};\n\n\tconst getConfidenceBadge = (confidence: number) => {\n\t\tif (confidence >= 0.9) {\n\t\t\treturn (\n\t\t\t\t<Badge variant=\"default\" className=\"gap-1\">\n\t\t\t\t\t<Check className=\"h-3 w-3\" />\n\t\t\t\t\t{Math.round(confidence * 100)}% match\n\t\t\t\t</Badge>\n\t\t\t);\n\t\t}\n\t\tif (confidence >= 0.7) {\n\t\t\treturn (\n\t\t\t\t<Badge variant=\"secondary\" className=\"gap-1\">\n\t\t\t\t\t{Math.round(confidence * 100)}% match\n\t\t\t\t</Badge>\n\t\t\t);\n\t\t}\n\t\treturn (\n\t\t\t<Badge variant=\"outline\" className=\"gap-1\">\n\t\t\t\t<AlertCircle className=\"h-3 w-3\" />\n\t\t\t\t{Math.round(confidence * 100)}% match\n\t\t\t</Badge>\n\t\t);\n\t};\n\n\treturn (\n\t\t<Card className=\"border-blue-200 bg-blue-50/50 dark:border-blue-900 dark:bg-blue-950/20\">\n\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<Link2 className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n\t\t\t\t\t<CardTitle className=\"text-sm font-semibold\">Suggested Matches</CardTitle>\n\t\t\t\t</div>\n\t\t\t\t<CardDescription className=\"text-xs\">\n\t\t\t\t\tWe found {activeSuggestions.length} potential {activeSuggestions.length === 1 ? \"match\" : \"matches\"} for this communication\n\t\t\t\t</CardDescription>\n\t\t\t</CardHeader>\n\t\t\t<CardContent className=\"space-y-2 pt-0\">\n\t\t\t\t{activeSuggestions.map((suggestion, index) => {\n\t\t\t\t\tconst typeConfig = getTypeConfig(suggestion.type);\n\t\t\t\t\tconst TypeIcon = typeConfig.icon;\n\t\t\t\t\tconst isLinking = linking === suggestion.id;\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<div key={suggestion.id}>\n\t\t\t\t\t\t\t{index > 0 && <Separator className=\"my-2\" />}\n\t\t\t\t\t\t\t<div className=\"flex items-start gap-3\">\n\t\t\t\t\t\t\t\t{/* Type Icon */}\n\t\t\t\t\t\t\t\t<div className={cn(\"rounded-full p-2\", typeConfig.bg)}>\n\t\t\t\t\t\t\t\t\t<TypeIcon className={cn(\"h-4 w-4\", typeConfig.color)} />\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{/* Content */}\n\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0 space-y-1\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t<p className=\"font-medium text-sm truncate\">{suggestion.name}</p>\n\t\t\t\t\t\t\t\t\t\t<Badge variant=\"outline\" className=\"text-xs shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t{typeConfig.label}\n\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{suggestion.subtitle && <p className=\"text-xs text-muted-foreground truncate\">{suggestion.subtitle}</p>}\n\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 flex-wrap\">\n\t\t\t\t\t\t\t\t\t\t{getConfidenceBadge(suggestion.confidence)}\n\t\t\t\t\t\t\t\t\t\t{suggestion.matchDetails && (\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t{suggestion.matchDetails}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{/* Actions */}\n\t\t\t\t\t\t\t\t<div className=\"flex gap-1 shrink-0\">\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"default\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => handleAccept(suggestion)}\n\t\t\t\t\t\t\t\t\t\tdisabled={isLinking}\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 gap-1\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Check className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\tLink\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => handleDismiss(suggestion.id)}\n\t\t\t\t\t\t\t\t\t\tdisabled={isLinking}\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 w-8 p-0\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<X className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t);\n\t\t\t\t})}\n\t\t\t</CardContent>\n\t\t</Card>\n\t);\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"4058cd3d49d375b37cef03bec92ad4d75901c4c01b\":\"bulkDeleteEmailsAction\"},\"apps/web/src/actions/email-actions.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var bulkDeleteEmailsAction=/*#__PURE__*/createServerReference(\"4058cd3d49d375b37cef03bec92ad4d75901c4c01b\",callServer,void 0,findSourceMapURL,\"bulkDeleteEmailsAction\");"],"names":[],"mappings":"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"}