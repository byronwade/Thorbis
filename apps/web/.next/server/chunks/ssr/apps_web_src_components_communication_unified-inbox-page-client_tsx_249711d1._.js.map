{"version":3,"sources":["../../../../../../apps/web/src/components/communication/unified-inbox-page-client.tsx","../../../../../../apps/web/src/components/communication/auto-link-suggestions.tsx","../../../../../../apps/web/src/components/communication/call-detail-view.tsx","../../../../../../apps/web/src/components/ui/audio-player.tsx","../../../../../../apps/web/src/components/communication/transfer-dialog.tsx","../../../../../../apps/web/src/components/communication/voicemail-detail-view.tsx"],"sourcesContent":["/**\n * Unified Inbox Page Client Component\n *\n * Complete unified communication hub combining email and SMS features\n * Features: full email composer, reply/forward, SMS conversation threads,\n * message sending, attachments, templates, AI suggestions\n */\n\n\"use client\";\n\nimport { format, formatDistanceToNow } from \"date-fns\";\nimport {\n\tAlertCircle,\n\tAlertTriangle,\n\tArchive,\n\tArrowLeft,\n\tBriefcase,\n\tCheckCheck,\n\tChevronRight,\n\tClock,\n\tDownload,\n\tEye,\n\tFilter,\n\tFlag,\n\tForward,\n\tLink as LinkIcon,\n\tLoader2,\n\tMail,\n\tMapPin,\n\tMessageSquare,\n\tMoreHorizontal,\n\tMousePointerClick,\n\tPanelLeft,\n\tPaperclip,\n\tPhone,\n\tPlus,\n\tPrinter,\n\tRefreshCw,\n\tReply,\n\tReplyAll,\n\tSend,\n\tStar,\n\tStickyNote,\n\tTrash2,\n\tUser,\n\tUserPlus,\n\tVoicemail,\n\tX,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\nimport { useCallback, useEffect, useRef, useState, useTransition } from \"react\";\nimport { toast } from \"sonner\";\nimport {\n\tarchiveEmailAction,\n\tbulkDeleteEmailsAction,\n\tfetchEmailContentAction,\n\tmarkEmailAsReadAction,\n\tretryFailedEmailAction,\n\ttoggleSpamEmailAction,\n} from \"@/actions/email-actions\";\nimport { toggleStarCommunicationAction } from \"@/actions/communications\";\nimport type {\n\tCompanySms,\n\tSmsTemplateContext,\n} from \"@/actions/sms-actions\";\n\n// Type for message attachments stored in provider_metadata\ntype MessageAttachment = {\n\ttype?: string;\n\turl?: string;\n\tfilename?: string;\n};\n\nimport {\n\tgetCompanyContextAction,\n\tgetSmsConversationAction,\n\tmarkSmsAsReadAction,\n\tmarkSmsConversationAsReadAction,\n} from \"@/actions/sms-actions\";\nimport { sendTextMessage } from \"@/actions/twilio\";\nimport { AutoLinkSuggestions } from \"@/components/communication/auto-link-suggestions\";\nimport { CallDetailView } from \"@/components/communication/call-detail-view\";\nimport { CustomerInfoPill } from \"@/components/communication/customer-info-pill\";\nimport { EmailContent } from \"@/components/communication/email-content\";\nimport { EmailFullComposer } from \"@/components/communication/email-full-composer\";\nimport {\n\tEmailReplyComposer,\n\ttype EmailReplyMode,\n} from \"@/components/communication/email-reply-composer\";\nimport { SmsMessageInput } from \"@/components/communication/sms-message-input\";\nimport { TransferDialog } from \"@/components/communication/transfer-dialog\";\nimport { VoicemailDetailView } from \"@/components/communication/voicemail-detail-view\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n\tSheet,\n\tSheetContent,\n\tSheetDescription,\n\tSheetHeader,\n\tSheetTitle,\n\tSheetTrigger,\n} from \"@/components/ui/sheet\";\nimport { useSidebar } from \"@/components/ui/sidebar\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport type { Communication, CommunicationCounts } from \"@/lib/queries/communications\";\nimport { cn } from \"@/lib/utils\";\nimport { getCustomerDisplayName } from \"@/lib/utils/customer-display\";\n\ntype CommunicationType = \"all\" | \"email\" | \"sms\" | \"call\" | \"voicemail\";\n\n/**\n * Get contact display name for a communication\n * Priority:\n * 1. Customer name (if linked)\n * 2. fromName/toName from communication\n * 3. fromAddress/toAddress as fallback\n */\nfunction getContactDisplayName(\n\tcommunication: Communication,\n\tdirection?: \"from\" | \"to\"\n): string {\n\tconst effectiveDirection = direction || (communication.direction === \"inbound\" ? \"from\" : \"to\");\n\n\t// Priority 1: Linked customer name\n\tif (communication.customer) {\n\t\tconst customerName = communication.customer.firstName\n\t\t\t? `${communication.customer.firstName} ${communication.customer.lastName || \"\"}`.trim()\n\t\t\t: null;\n\t\tif (customerName) return customerName;\n\t}\n\n\t// Priority 2: fromName/toName from communication\n\tif (effectiveDirection === \"from\" && communication.fromName) {\n\t\treturn communication.fromName;\n\t}\n\tif (effectiveDirection === \"to\" && communication.toName) {\n\t\treturn communication.toName;\n\t}\n\n\t// Priority 3: Address as fallback\n\tconst address = effectiveDirection === \"from\"\n\t\t? communication.fromAddress\n\t\t: communication.toAddress;\n\n\treturn address || (effectiveDirection === \"from\" ? \"Unknown sender\" : \"Unknown recipient\");\n}\n\ninterface UnifiedInboxPageClientProps {\n\tinitialCommunications: Communication[];\n\tinitialCounts?: CommunicationCounts;\n\tcompanyId: string;\n\tteamMemberId: string;\n\tselectedId?: string | null;\n\tactiveType?: string | null;\n\tactiveFolder?: string | null;\n\tactiveCategory?: string | null;\n}\n\nexport function UnifiedInboxPageClient({\n\tinitialCommunications,\n\tinitialCounts,\n\tcompanyId,\n\tteamMemberId,\n\tselectedId: initialSelectedId,\n\tactiveType: initialActiveType,\n\tactiveFolder: initialActiveFolder,\n\tactiveCategory: initialActiveCategory,\n}: UnifiedInboxPageClientProps) {\n\tconst router = useRouter();\n\tconst searchParams = useSearchParams();\n\tconst { toggleSidebar } = useSidebar();\n\tconst [isPending, startTransition] = useTransition();\n\n\tconst communicationIdFromQuery = searchParams?.get(\"id\");\n\tconst communicationId = communicationIdFromQuery || initialSelectedId;\n\n\t// Core communication state\n\tconst [communications, setCommunications] = useState<Communication[]>(\n\t\tinitialCommunications,\n\t);\n\tconst [refreshing, setRefreshing] = useState(false);\n\tconst [error, setError] = useState<string | null>(null);\n\tconst [selectedCommunication, setSelectedCommunication] =\n\t\tuseState<Communication | null>(() => {\n\t\t\tif (initialSelectedId && initialCommunications) {\n\t\t\t\treturn (\n\t\t\t\t\tinitialCommunications.find((c) => c.id === initialSelectedId) || null\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn null;\n\t\t});\n\n\t// Search and filter state\n\tconst [searchQuery, setSearchQuery] = useState(\"\");\n\tconst [searchInput, setSearchInput] = useState(\"\");\n\tconst [typeFilter, setTypeFilter] = useState<CommunicationType>(\n\t\t(initialActiveType as CommunicationType) || \"all\",\n\t);\n\n\t// Notes state\n\tconst [notesOpen, setNotesOpen] = useState(false);\n\tconst [internalNotes, setInternalNotes] = useState(\"\");\n\tconst [savingNotes, setSavingNotes] = useState(false);\n\n\t// Email compose/reply state\n\tconst [composeMode, setComposeMode] = useState(false);\n\tconst [replyMode, setReplyMode] = useState<EmailReplyMode | null>(null);\n\tconst [emailContent, setEmailContent] = useState<{\n\t\thtml?: string | null;\n\t\ttext?: string | null;\n\t} | null>(null);\n\tconst [loadingContent, setLoadingContent] = useState(false);\n\tconst [retrying, setRetrying] = useState(false);\n\n\t// SMS state\n\tconst [conversationMessages, setConversationMessages] = useState<CompanySms[]>([]);\n\tconst [loadingConversation, setLoadingConversation] = useState(false);\n\tconst [messageInput, setMessageInput] = useState(\"\");\n\tconst [sendingMessage, setSendingMessage] = useState(false);\n\tconst [attachments, setAttachments] = useState<File[]>([]);\n\tconst [companyContext, setCompanyContext] = useState<SmsTemplateContext | null>(null);\n\tconst [starredIds, setStarredIds] = useState<Set<string>>(new Set());\n\n\t// Transfer dialog state\n\tconst [transferDialogOpen, setTransferDialogOpen] = useState(false);\n\n\t// Refs\n\tconst searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\tconst selectedCommunicationRef = useRef<Communication | null>(selectedCommunication);\n\tconst refreshingRef = useRef(refreshing);\n\trefreshingRef.current = refreshing;\n\tconst conversationScrollRef = useRef<HTMLDivElement>(null);\n\n\t// Handle compose=true query param from navigation\n\tuseEffect(() => {\n\t\tconst shouldCompose = searchParams?.get(\"compose\") === \"true\";\n\t\tif (shouldCompose && !composeMode) {\n\t\t\tsetComposeMode(true);\n\t\t\tsetSelectedCommunication(null);\n\t\t\tsetEmailContent(null);\n\t\t\tselectedCommunicationRef.current = null;\n\t\t\t// Clean up URL\n\t\t\tconst newParams = new URLSearchParams(searchParams?.toString() || \"\");\n\t\t\tnewParams.delete(\"compose\");\n\t\t\tconst newUrl = newParams.toString()\n\t\t\t\t? `/dashboard/communication?${newParams.toString()}`\n\t\t\t\t: \"/dashboard/communication\";\n\t\t\trouter.replace(newUrl);\n\t\t}\n\t}, [searchParams, router, composeMode]);\n\n\t// Keyboard shortcut: 'C' to open compose mode\n\tuseEffect(() => {\n\t\tconst handleKeyDown = (e: KeyboardEvent) => {\n\t\t\tconst target = e.target as HTMLElement;\n\t\t\tif (\n\t\t\t\ttarget.tagName === \"INPUT\" ||\n\t\t\t\ttarget.tagName === \"TEXTAREA\" ||\n\t\t\t\ttarget.isContentEditable\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\te.key === \"c\" &&\n\t\t\t\t!e.metaKey &&\n\t\t\t\t!e.ctrlKey &&\n\t\t\t\t!e.altKey &&\n\t\t\t\t!composeMode\n\t\t\t) {\n\t\t\t\te.preventDefault();\n\t\t\t\t// Open compose type selector\n\t\t\t\twindow.dispatchEvent(new CustomEvent(\"open-unified-compose\"));\n\t\t\t}\n\t\t};\n\n\t\twindow.addEventListener(\"keydown\", handleKeyDown);\n\t\treturn () => window.removeEventListener(\"keydown\", handleKeyDown);\n\t}, [composeMode]);\n\n\t// Fetch company context for SMS templates\n\tuseEffect(() => {\n\t\tgetCompanyContextAction().then((result) => {\n\t\t\tif (result.success && result.context) {\n\t\t\t\tsetCompanyContext(result.context);\n\t\t\t}\n\t\t});\n\t}, []);\n\n\t// Update selected communication when URL changes\n\tuseEffect(() => {\n\t\tif (communicationId && communications) {\n\t\t\tconst comm = communications.find((c) => c.id === communicationId);\n\t\t\tif (comm) {\n\t\t\t\tsetSelectedCommunication(comm);\n\t\t\t\tsetInternalNotes(comm.internalNotes || \"\");\n\t\t\t\tselectedCommunicationRef.current = comm;\n\n\t\t\t\t// Load email content if needed\n\t\t\t\tif (comm.type === \"email\") {\n\t\t\t\t\tconst hasContent = comm.body;\n\t\t\t\t\tif (hasContent) {\n\t\t\t\t\t\tsetEmailContent({\n\t\t\t\t\t\t\thtml: null,\n\t\t\t\t\t\t\ttext: comm.body || null,\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetLoadingContent(true);\n\t\t\t\t\t\tfetchEmailContentAction(comm.id)\n\t\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\t\t\t\tsetEmailContent({\n\t\t\t\t\t\t\t\t\t\thtml: result.html || null,\n\t\t\t\t\t\t\t\t\t\ttext: result.text || null,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.finally(() => setLoadingContent(false));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Load SMS conversation if needed\n\t\t\t\tif (comm.type === \"sms\") {\n\t\t\t\t\tconst phoneNumber = comm.direction === \"inbound\"\n\t\t\t\t\t\t? comm.fromAddress\n\t\t\t\t\t\t: comm.toAddress;\n\t\t\t\t\tif (phoneNumber) {\n\t\t\t\t\t\tfetchConversation(phoneNumber);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tsetSelectedCommunication(null);\n\t\t\tselectedCommunicationRef.current = null;\n\t\t\tsetEmailContent(null);\n\t\t\tsetConversationMessages([]);\n\t\t}\n\t}, [communicationId, communications]);\n\n\t// Debounced search\n\tuseEffect(() => {\n\t\tif (searchTimeoutRef.current) {\n\t\t\tclearTimeout(searchTimeoutRef.current);\n\t\t}\n\n\t\tsearchTimeoutRef.current = setTimeout(() => {\n\t\t\tsetSearchQuery(searchInput);\n\t\t}, 300);\n\n\t\treturn () => {\n\t\t\tif (searchTimeoutRef.current) {\n\t\t\t\tclearTimeout(searchTimeoutRef.current);\n\t\t\t}\n\t\t};\n\t}, [searchInput]);\n\n\t// Fetch communications function\n\tconst fetchCommunications = useCallback(\n\t\tasync (showRefreshing = false) => {\n\t\t\tsetRefreshing(true);\n\t\t\tsetError(null);\n\n\t\t\tstartTransition(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst { getCommunicationsAction } = await import(\n\t\t\t\t\t\t\"@/actions/communications\"\n\t\t\t\t\t);\n\t\t\t\t\tconst result = await getCommunicationsAction({\n\t\t\t\t\t\tteamMemberId,\n\t\t\t\t\t\tcompanyId,\n\t\t\t\t\t\ttype: typeFilter !== \"all\" ? typeFilter : undefined,\n\t\t\t\t\t\tlimit: 100,\n\t\t\t\t\t\toffset: 0,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (result.success && result.data) {\n\t\t\t\t\t\tsetCommunications(result.data as Communication[]);\n\n\t\t\t\t\t\t// Update selected communication if it's still in the list\n\t\t\t\t\t\tconst currentSelected = selectedCommunicationRef.current;\n\t\t\t\t\t\tif (currentSelected) {\n\t\t\t\t\t\t\tconst updatedComm = (result.data as Communication[]).find(\n\t\t\t\t\t\t\t\t(c) => c.id === currentSelected.id,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (updatedComm) {\n\t\t\t\t\t\t\t\tsetSelectedCommunication(updatedComm);\n\t\t\t\t\t\t\t\tselectedCommunicationRef.current = updatedComm;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.error(\"Failed to fetch communications:\", err);\n\t\t\t\t\tconst errorMessage =\n\t\t\t\t\t\terr instanceof Error\n\t\t\t\t\t\t\t? err.message\n\t\t\t\t\t\t\t: \"Failed to load communications\";\n\t\t\t\t\tsetError(errorMessage);\n\t\t\t\t\ttoast.error(\"Failed to load communications\", {\n\t\t\t\t\t\tdescription: errorMessage,\n\t\t\t\t\t});\n\t\t\t\t} finally {\n\t\t\t\t\tsetRefreshing(false);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t[teamMemberId, companyId, typeFilter],\n\t);\n\n\t// Fetch SMS conversation\n\tconst fetchConversation = useCallback(async (phoneNumber: string) => {\n\t\tif (!phoneNumber) return;\n\n\t\tsetLoadingConversation(true);\n\t\ttry {\n\t\t\tconst result = await getSmsConversationAction(phoneNumber);\n\t\t\tif (result.success && result.messages) {\n\t\t\t\tsetConversationMessages(result.messages);\n\n\t\t\t\t// Mark all unread messages as read\n\t\t\t\tconst unreadMessages = result.messages.filter(\n\t\t\t\t\t(msg) => !msg.read_at && msg.direction === \"inbound\",\n\t\t\t\t);\n\t\t\t\tif (unreadMessages.length > 0) {\n\t\t\t\t\tsetConversationMessages((prev) =>\n\t\t\t\t\t\tprev.map((msg) =>\n\t\t\t\t\t\t\t!msg.read_at && msg.direction === \"inbound\"\n\t\t\t\t\t\t\t\t? { ...msg, read_at: new Date().toISOString() }\n\t\t\t\t\t\t\t\t: msg,\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\n\t\t\t\t\tmarkSmsConversationAsReadAction(phoneNumber)\n\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\t\t\twindow.dispatchEvent(new CustomEvent(\"sms-read\"));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(() => {});\n\t\t\t\t}\n\n\t\t\t\t// Scroll to bottom\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif (conversationScrollRef.current) {\n\t\t\t\t\t\tconversationScrollRef.current.scrollTop =\n\t\t\t\t\t\t\tconversationScrollRef.current.scrollHeight;\n\t\t\t\t\t}\n\t\t\t\t}, 100);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\ttoast.error(\"Failed to load conversation\");\n\t\t} finally {\n\t\t\tsetLoadingConversation(false);\n\t\t}\n\t}, []);\n\n\t// Sync type filter with prop from URL params (sidebar navigation)\n\tuseEffect(() => {\n\t\tconst newType = (initialActiveType as CommunicationType) || \"all\";\n\t\tif (newType !== typeFilter) {\n\t\t\tsetTypeFilter(newType);\n\t\t}\n\t}, [initialActiveType]);\n\n\t// Refetch when type filter changes\n\tuseEffect(() => {\n\t\tfetchCommunications();\n\t}, [typeFilter]);\n\n\t// Refetch when search changes\n\tuseEffect(() => {\n\t\tif (searchQuery) {\n\t\t\tfetchCommunications();\n\t\t}\n\t}, [searchQuery]);\n\n\t// Auto-refresh every 30 seconds\n\tuseEffect(() => {\n\t\tconst interval = setInterval(() => {\n\t\t\tif (!refreshingRef.current && !composeMode) {\n\t\t\t\tfetchCommunications();\n\t\t\t}\n\t\t}, 30000);\n\n\t\t// Listen for custom events\n\t\tconst handleRefresh = () => {\n\t\t\tsetTimeout(() => fetchCommunications(), 1000);\n\t\t};\n\t\twindow.addEventListener(\"email-received\", handleRefresh);\n\t\twindow.addEventListener(\"email-sent\", handleRefresh);\n\t\twindow.addEventListener(\"sms-read\", handleRefresh);\n\t\twindow.addEventListener(\"communication-updated\", handleRefresh);\n\n\t\treturn () => {\n\t\t\tclearInterval(interval);\n\t\t\twindow.removeEventListener(\"email-received\", handleRefresh);\n\t\t\twindow.removeEventListener(\"email-sent\", handleRefresh);\n\t\t\twindow.removeEventListener(\"sms-read\", handleRefresh);\n\t\t\twindow.removeEventListener(\"communication-updated\", handleRefresh);\n\t\t};\n\t}, [fetchCommunications, composeMode]);\n\n\t// Handle communication selection\n\tconst handleCommunicationSelect = useCallback(\n\t\t(communication: Communication) => {\n\t\t\tsetSelectedCommunication(communication);\n\t\t\tsetInternalNotes(communication.internalNotes || \"\");\n\t\t\tselectedCommunicationRef.current = communication;\n\t\t\tsetReplyMode(null);\n\t\t\tsetConversationMessages([]);\n\n\t\t\tconst params = new URLSearchParams(searchParams?.toString() || \"\");\n\t\t\tparams.set(\"id\", communication.id);\n\t\t\trouter.push(`/dashboard/communication?${params.toString()}`, {\n\t\t\t\tscroll: false,\n\t\t\t});\n\n\t\t\t// Mark as read if unread\n\t\t\tif (communication.status === \"unread\" || communication.status === \"new\") {\n\t\t\t\tif (communication.type === \"email\") {\n\t\t\t\t\tmarkEmailAsReadAction({ emailId: communication.id }).catch((err) => {\n\t\t\t\t\t\tconsole.error(\"Failed to mark as read:\", err);\n\t\t\t\t\t});\n\t\t\t\t} else if (communication.type === \"sms\") {\n\t\t\t\t\tmarkSmsAsReadAction({ smsId: communication.id }).catch((err) => {\n\t\t\t\t\t\tconsole.error(\"Failed to mark as read:\", err);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// Optimistically update local state\n\t\t\t\tsetCommunications((prev) =>\n\t\t\t\t\tprev.map((c) =>\n\t\t\t\t\t\tc.id === communication.id ? { ...c, status: \"read\" } : c,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t\twindow.dispatchEvent(new CustomEvent(\"communication-updated\"));\n\t\t\t}\n\n\t\t\t// Load email content\n\t\t\tif (communication.type === \"email\") {\n\t\t\t\tconst hasContent = communication.body;\n\t\t\t\tif (hasContent) {\n\t\t\t\t\tsetEmailContent({\n\t\t\t\t\t\thtml: null,\n\t\t\t\t\t\ttext: communication.body || null,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tsetLoadingContent(true);\n\t\t\t\t\tfetchEmailContentAction(communication.id)\n\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\t\t\tsetEmailContent({\n\t\t\t\t\t\t\t\t\thtml: result.html || null,\n\t\t\t\t\t\t\t\t\ttext: result.text || null,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.finally(() => setLoadingContent(false));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Load SMS conversation\n\t\t\tif (communication.type === \"sms\") {\n\t\t\t\tconst phoneNumber = communication.direction === \"inbound\"\n\t\t\t\t\t? communication.fromAddress\n\t\t\t\t\t: communication.toAddress;\n\t\t\t\tif (phoneNumber) {\n\t\t\t\t\tfetchConversation(phoneNumber);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t[router, searchParams, fetchConversation],\n\t);\n\n\t// Save internal notes\n\tconst handleSaveNotes = useCallback(async () => {\n\t\tif (!selectedCommunication) return;\n\n\t\tsetSavingNotes(true);\n\t\ttry {\n\t\t\tconst { saveInternalNotesAction } = await import(\n\t\t\t\t\"@/actions/communications\"\n\t\t\t);\n\t\t\tconst result = await saveInternalNotesAction({\n\t\t\t\tcommunicationId: selectedCommunication.id,\n\t\t\t\tnotes: internalNotes,\n\t\t\t});\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Notes saved\");\n\t\t\t\tsetCommunications((prev) =>\n\t\t\t\t\tprev.map((c) =>\n\t\t\t\t\t\tc.id === selectedCommunication.id\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t...c,\n\t\t\t\t\t\t\t\t\tinternalNotes,\n\t\t\t\t\t\t\t\t\tinternalNotesUpdatedAt: new Date().toISOString(),\n\t\t\t\t\t\t\t\t\tinternalNotesUpdatedBy: teamMemberId,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: c,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t\tsetNotesOpen(false);\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to save notes\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to save notes:\", error);\n\t\t\ttoast.error(\"Failed to save notes\");\n\t\t} finally {\n\t\t\tsetSavingNotes(false);\n\t\t}\n\t}, [selectedCommunication, internalNotes, teamMemberId]);\n\n\t// Email actions\n\tconst handleArchive = useCallback(\n\t\tasync (communicationId: string) => {\n\t\t\ttry {\n\t\t\t\tconst result = await archiveEmailAction(communicationId);\n\t\t\t\tif (result.success) {\n\t\t\t\t\ttoast.success(\"Archived\");\n\t\t\t\t\tsetCommunications((prev) =>\n\t\t\t\t\t\tprev.filter((c) => c.id !== communicationId),\n\t\t\t\t\t);\n\t\t\t\t\tif (selectedCommunication?.id === communicationId) {\n\t\t\t\t\t\tsetSelectedCommunication(null);\n\t\t\t\t\t\tsetEmailContent(null);\n\t\t\t\t\t}\n\t\t\t\t\twindow.dispatchEvent(new CustomEvent(\"email-archived\"));\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(result.error || \"Failed to archive\");\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"Failed to archive:\", err);\n\t\t\t\ttoast.error(\"Failed to archive\");\n\t\t\t}\n\t\t},\n\t\t[selectedCommunication],\n\t);\n\n\tconst handleStar = useCallback(async (communicationId: string) => {\n\t\ttry {\n\t\t\tconst result = await toggleStarCommunicationAction(communicationId);\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Updated\");\n\t\t\t\tsetStarredIds((prev) => {\n\t\t\t\t\tconst newSet = new Set(prev);\n\t\t\t\t\tif (result.isStarred) {\n\t\t\t\t\t\tnewSet.add(communicationId);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewSet.delete(communicationId);\n\t\t\t\t\t}\n\t\t\t\t\treturn newSet;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\ttoast.error(result.error || \"Failed to update\");\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.error(\"Failed to star:\", err);\n\t\t\ttoast.error(\"Failed to update\");\n\t\t}\n\t}, []);\n\n\tconst handleToggleSpam = useCallback(\n\t\tasync (communicationId: string) => {\n\t\t\ttry {\n\t\t\t\tconst result = await toggleSpamEmailAction(communicationId);\n\t\t\t\tif (result.success) {\n\t\t\t\t\ttoast.success(\"Updated spam status\");\n\t\t\t\t\twindow.dispatchEvent(new CustomEvent(\"email-spam-toggled\"));\n\t\t\t\t\tfetchCommunications();\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(\"Failed to update spam status\");\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\ttoast.error(\"Failed to update spam status\");\n\t\t\t}\n\t\t},\n\t\t[fetchCommunications],\n\t);\n\n\tconst handleDelete = useCallback(\n\t\tasync (communicationId: string) => {\n\t\t\ttry {\n\t\t\t\tconst result = await bulkDeleteEmailsAction([communicationId]);\n\t\t\t\tif (result.success) {\n\t\t\t\t\ttoast.success(\"Deleted\");\n\t\t\t\t\tsetCommunications((prev) =>\n\t\t\t\t\t\tprev.filter((c) => c.id !== communicationId),\n\t\t\t\t\t);\n\t\t\t\t\tif (selectedCommunication?.id === communicationId) {\n\t\t\t\t\t\tsetSelectedCommunication(null);\n\t\t\t\t\t\tsetEmailContent(null);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(result.error || \"Failed to delete\");\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"Failed to delete:\", err);\n\t\t\t\ttoast.error(\"Failed to delete\");\n\t\t\t}\n\t\t},\n\t\t[selectedCommunication],\n\t);\n\n\tconst handleRetry = useCallback(\n\t\tasync (emailId: string) => {\n\t\t\tif (!emailId) return;\n\n\t\t\tsetRetrying(true);\n\t\t\ttry {\n\t\t\t\tconst result = await retryFailedEmailAction(emailId);\n\n\t\t\t\tif (result.success) {\n\t\t\t\t\ttoast.success(\"Email sent successfully!\");\n\t\t\t\t\tfetchCommunications();\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(\"Failed to send email\", {\n\t\t\t\t\t\tdescription: result.error || \"Please try again later\",\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"Failed to retry email:\", err);\n\t\t\t\ttoast.error(\"Failed to send email\");\n\t\t\t} finally {\n\t\t\t\tsetRetrying(false);\n\t\t\t}\n\t\t},\n\t\t[fetchCommunications],\n\t);\n\n\tconst handlePrintEmail = useCallback(() => {\n\t\tif (!selectedCommunication) return;\n\n\t\tconst printContent = `\n\t\t\t<!DOCTYPE html>\n\t\t\t<html>\n\t\t\t<head>\n\t\t\t\t<title>${selectedCommunication.subject || \"Email\"}</title>\n\t\t\t\t<style>\n\t\t\t\t\tbody { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }\n\t\t\t\t\t.header { border-bottom: 1px solid #e5e7eb; padding-bottom: 20px; margin-bottom: 20px; }\n\t\t\t\t\t.subject { font-size: 24px; font-weight: 600; margin-bottom: 12px; }\n\t\t\t\t\t.meta { color: #6b7280; font-size: 14px; }\n\t\t\t\t\t.meta-row { margin-bottom: 4px; }\n\t\t\t\t\t.body { line-height: 1.6; }\n\t\t\t\t</style>\n\t\t\t</head>\n\t\t\t<body>\n\t\t\t\t<div class=\"header\">\n\t\t\t\t\t<div class=\"subject\">${selectedCommunication.subject || \"No Subject\"}</div>\n\t\t\t\t\t<div class=\"meta\">\n\t\t\t\t\t\t<div class=\"meta-row\"><strong>From:</strong> ${selectedCommunication.fromAddress || \"Unknown\"}</div>\n\t\t\t\t\t\t<div class=\"meta-row\"><strong>To:</strong> ${selectedCommunication.toAddress || \"Unknown\"}</div>\n\t\t\t\t\t\t<div class=\"meta-row\"><strong>Date:</strong> ${new Date(selectedCommunication.createdAt).toLocaleString()}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"body\">\n\t\t\t\t\t${emailContent?.html || emailContent?.text || selectedCommunication.body || \"No content\"}\n\t\t\t\t</div>\n\t\t\t</body>\n\t\t\t</html>\n\t\t`;\n\n\t\tconst printWindow = window.open(\"\", \"_blank\");\n\t\tif (printWindow) {\n\t\t\tprintWindow.document.write(printContent);\n\t\t\tprintWindow.document.close();\n\t\t\tprintWindow.focus();\n\t\t\tsetTimeout(() => printWindow.print(), 250);\n\t\t}\n\t}, [selectedCommunication, emailContent]);\n\n\tconst handleDownloadEml = useCallback(() => {\n\t\tif (!selectedCommunication) return;\n\n\t\tconst boundary = `----=_Part_${Date.now()}_${Math.random().toString(36).slice(2)}`;\n\t\tconst date = new Date(selectedCommunication.createdAt).toUTCString();\n\n\t\tconst emlContent = `MIME-Version: 1.0\nDate: ${date}\nSubject: ${selectedCommunication.subject || \"No Subject\"}\nFrom: ${selectedCommunication.fromAddress || \"Unknown\"}\nTo: ${selectedCommunication.toAddress || \"Unknown\"}\nContent-Type: multipart/alternative; boundary=\"${boundary}\"\n\n--${boundary}\nContent-Type: text/plain; charset=\"UTF-8\"\nContent-Transfer-Encoding: 7bit\n\n${emailContent?.text || selectedCommunication.body || \"No content\"}\n\n--${boundary}\nContent-Type: text/html; charset=\"UTF-8\"\nContent-Transfer-Encoding: 7bit\n\n${emailContent?.html || `<p>${selectedCommunication.body || \"No content\"}</p>`}\n\n--${boundary}--\n`;\n\n\t\tconst blob = new Blob([emlContent], { type: \"message/rfc822\" });\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst link = document.createElement(\"a\");\n\t\tlink.href = url;\n\t\tconst safeSubject =\n\t\t\t(selectedCommunication.subject || \"email\")\n\t\t\t\t.replace(/[^a-z0-9\\s-]/gi, \"_\")\n\t\t\t\t.replace(/\\s+/g, \"_\")\n\t\t\t\t.slice(0, 50) || \"email\";\n\t\tlink.download = `${safeSubject}.eml`;\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t\tURL.revokeObjectURL(url);\n\n\t\ttoast.success(\"Email downloaded\");\n\t}, [selectedCommunication, emailContent]);\n\n\t// SMS actions\n\tconst handleAttachFiles = useCallback((files: File[]) => {\n\t\tsetAttachments((prev) => [...prev, ...files]);\n\t}, []);\n\n\tconst handleSendMessage = useCallback(async () => {\n\t\tif (\n\t\t\t(!messageInput.trim() && attachments.length === 0) ||\n\t\t\t!selectedCommunication ||\n\t\t\tsendingMessage\n\t\t)\n\t\t\treturn;\n\n\t\tconst phoneNumber =\n\t\t\tselectedCommunication.direction === \"inbound\"\n\t\t\t\t? selectedCommunication.fromAddress\n\t\t\t\t: selectedCommunication.toAddress;\n\t\tif (!phoneNumber) {\n\t\t\ttoast.error(\"Cannot determine recipient phone number\");\n\t\t\treturn;\n\t\t}\n\n\t\tsetSendingMessage(true);\n\t\ttry {\n\t\t\tif (attachments.length > 0) {\n\t\t\t\tconst { uploadSmsAttachments } = await import(\"@/actions/sms-actions\");\n\t\t\t\tconst uploadResult = await uploadSmsAttachments(attachments);\n\n\t\t\t\tif (!uploadResult.success || !uploadResult.urls) {\n\t\t\t\t\ttoast.error(uploadResult.error || \"Failed to upload attachments\");\n\t\t\t\t\tsetSendingMessage(false);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst { sendMMSMessage } = await import(\"@/actions/twilio\");\n\t\t\t\tconst result = await sendMMSMessage({\n\t\t\t\t\tto: phoneNumber,\n\t\t\t\t\tfrom: \"\",\n\t\t\t\t\ttext: messageInput.trim() || undefined,\n\t\t\t\t\tmediaUrls: uploadResult.urls,\n\t\t\t\t\tcustomerId: selectedCommunication.customerId || undefined,\n\t\t\t\t});\n\n\t\t\t\tif (result.success) {\n\t\t\t\t\tsetMessageInput(\"\");\n\t\t\t\t\tsetAttachments([]);\n\t\t\t\t\ttoast.success(\"Message with attachments sent\");\n\t\t\t\t\tfetchConversation(phoneNumber);\n\t\t\t\t\tfetchCommunications();\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error((result as { error?: string }).error || \"Failed to send message\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst result = await sendTextMessage({\n\t\t\t\t\tto: phoneNumber,\n\t\t\t\t\tfrom: \"\",\n\t\t\t\t\ttext: messageInput.trim(),\n\t\t\t\t\tcustomerId: selectedCommunication.customerId || undefined,\n\t\t\t\t});\n\n\t\t\t\tif (result.success) {\n\t\t\t\t\tsetMessageInput(\"\");\n\t\t\t\t\ttoast.success(\"Message sent\");\n\t\t\t\t\tfetchConversation(phoneNumber);\n\t\t\t\t\tfetchCommunications();\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error((result as { error?: string }).error || \"Failed to send message\");\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err) {\n\t\t\ttoast.error(\"Failed to send message\", {\n\t\t\t\tdescription: err instanceof Error ? err.message : \"Unknown error\",\n\t\t\t});\n\t\t} finally {\n\t\t\tsetSendingMessage(false);\n\t\t}\n\t}, [\n\t\tmessageInput,\n\t\tattachments,\n\t\tselectedCommunication,\n\t\tsendingMessage,\n\t\tfetchConversation,\n\t\tfetchCommunications,\n\t]);\n\n\t// Format timestamp for SMS messages\n\tconst formatMessageTime = (date: string) => {\n\t\tconst messageDate = new Date(date);\n\t\tconst now = new Date();\n\t\tconst isToday = messageDate.toDateString() === now.toDateString();\n\n\t\tif (isToday) {\n\t\t\treturn messageDate.toLocaleTimeString(\"en-US\", {\n\t\t\t\thour: \"numeric\",\n\t\t\t\tminute: \"2-digit\",\n\t\t\t});\n\t\t}\n\n\t\treturn messageDate.toLocaleDateString(\"en-US\", {\n\t\t\tmonth: \"short\",\n\t\t\tday: \"numeric\",\n\t\t\thour: \"numeric\",\n\t\t\tminute: \"2-digit\",\n\t\t});\n\t};\n\n\t// Filter communications by type and search\n\tconst filteredCommunications = communications.filter((comm) => {\n\t\t// Apply type filter first\n\t\tif (typeFilter !== \"all\" && comm.type !== typeFilter) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Then apply search filter\n\t\tif (searchQuery) {\n\t\t\tconst query = searchQuery.toLowerCase();\n\t\t\tconst matchesSubject = comm.subject?.toLowerCase().includes(query);\n\t\t\tconst matchesBody = comm.body?.toLowerCase().includes(query);\n\t\t\tconst matchesFrom = comm.fromAddress?.toLowerCase().includes(query);\n\t\t\tconst matchesTo = comm.toAddress?.toLowerCase().includes(query);\n\t\t\tconst matchesCustomer = comm.customer?.firstName?.toLowerCase().includes(query) ||\n\t\t\t\tcomm.customer?.lastName?.toLowerCase().includes(query);\n\t\t\treturn matchesSubject || matchesBody || matchesFrom || matchesTo || matchesCustomer;\n\t\t}\n\t\treturn true;\n\t});\n\n\t// Mobile: show list when no communication selected, show detail when communication selected\n\tconst showListOnMobile = !selectedCommunication && !composeMode;\n\tconst showDetailOnMobile = selectedCommunication || composeMode;\n\n\t// Get type icon and colors\n\tconst getTypeConfig = (type: string) => {\n\t\tswitch (type) {\n\t\t\tcase \"email\":\n\t\t\t\treturn { icon: Mail, color: \"text-blue-500\", bg: \"bg-blue-500/10\" };\n\t\t\tcase \"sms\":\n\t\t\t\treturn {\n\t\t\t\t\ticon: MessageSquare,\n\t\t\t\t\tcolor: \"text-green-500\",\n\t\t\t\t\tbg: \"bg-green-500/10\",\n\t\t\t\t};\n\t\t\tcase \"call\":\n\t\t\t\treturn {\n\t\t\t\t\ticon: Phone,\n\t\t\t\t\tcolor: \"text-purple-500\",\n\t\t\t\t\tbg: \"bg-purple-500/10\",\n\t\t\t\t};\n\t\t\tcase \"voicemail\":\n\t\t\t\treturn {\n\t\t\t\t\ticon: Voicemail,\n\t\t\t\t\tcolor: \"text-orange-500\",\n\t\t\t\t\tbg: \"bg-orange-500/10\",\n\t\t\t\t};\n\t\t\tdefault:\n\t\t\t\treturn { icon: Mail, color: \"text-gray-500\", bg: \"bg-gray-500/10\" };\n\t\t}\n\t};\n\n\treturn (\n\t\t<div className=\"flex h-full w-full flex-col overflow-hidden bg-sidebar\">\n\t\t\t<div className=\"flex flex-1 overflow-hidden min-h-0 md:gap-2\">\n\t\t\t\t{/* Left Panel - Communications List */}\n\t\t\t\t<div\n\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\"bg-card mb-1 shadow-sm flex flex-col overflow-hidden\",\n\t\t\t\t\t\t\"w-full h-full\",\n\t\t\t\t\t\t\"md:w-[400px] lg:w-[480px] md:rounded-tr-2xl\",\n\t\t\t\t\t\tshowListOnMobile ? \"flex\" : \"hidden md:flex\",\n\t\t\t\t\t)}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"w-full h-full flex flex-col\">\n\t\t\t\t\t\t{/* Header with search and filters */}\n\t\t\t\t\t\t<div className=\"sticky top-0 z-15 flex flex-col gap-2 p-2 pb-0 transition-colors bg-card\">\n\t\t\t\t\t\t\t<div className=\"grid grid-cols-12 gap-2 mt-1\">\n\t\t\t\t\t\t\t\t<div className=\"col-span-12 flex gap-2\">\n\t\t\t\t\t\t\t\t\t{/* Sidebar toggle */}\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tonClick={toggleSidebar}\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8 shrink-0\"\n\t\t\t\t\t\t\t\t\t\ttitle=\"Toggle sidebar\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<PanelLeft className=\"h-5 w-5 md:h-4 md:w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t</Button>\n\n\t\t\t\t\t\t\t\t\t{/* Search input */}\n\t\t\t\t\t\t\t\t\t<div className=\"relative flex-1\">\n\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\ttype=\"search\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Search communications...\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={searchInput}\n\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => setSearchInput(e.target.value)}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 md:h-8 pl-9 pr-20 text-base md:text-sm border-input bg-white dark:bg-[#141414] dark:border-none\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\twidth=\"10\"\n\t\t\t\t\t\t\t\t\t\t\theight=\"10\"\n\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 10 10\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"absolute left-3 top-1/2 -translate-y-1/2 fill-[#71717A] dark:fill-[#6F6F6F]\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\td=\"M6.81038 7.0756C6.18079 7.54011 5.40248 7.81466 4.56004 7.81466C2.46451 7.81466 0.765747 6.11589 0.765747 4.02037C0.765747 1.92484 2.46451 0.226074 4.56004 0.226074C6.65557 0.226074 8.35433 1.92484 8.35433 4.02037C8.35433 4.8628 8.07978 5.64112 7.61527 6.27071L9.70535 8.36078C9.92761 8.58305 9.92761 8.94341 9.70535 9.16568C9.48308 9.38794 9.12272 9.38794 8.90046 9.16568L6.81038 7.0756ZM7.21604 4.02037C7.21604 5.48724 6.02691 6.67637 4.56004 6.67637C3.09317 6.67637 1.90403 5.48724 1.90403 4.02037C1.90403 2.5535 3.09317 1.36436 4.56004 1.36436C6.02691 1.36436 7.21604 2.5535 7.21604 4.02037Z\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t{searchInput && (\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setSearchInput(\"\")}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<X className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{/* Refresh button */}\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => fetchCommunications(true)}\n\t\t\t\t\t\t\t\t\t\tdisabled={refreshing}\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8\"\n\t\t\t\t\t\t\t\t\t\ttitle=\"Refresh\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<RefreshCw\n\t\t\t\t\t\t\t\t\t\t\tclassName={`h-5 w-5 md:h-4 md:w-4 text-muted-foreground ${refreshing ? \"animate-spin\" : \"\"}`}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* Progress bar */}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\"bg-[#006FFE] relative z-5 h-0.5 w-full transition-opacity\",\n\t\t\t\t\t\t\t\trefreshing ? \"opacity-100 animate-pulse\" : \"opacity-0\",\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t{/* Communications List */}\n\t\t\t\t\t\t<div className=\"relative z-1 flex-1 overflow-hidden pt-0 min-h-0\">\n\t\t\t\t\t\t\t<div className=\"hide-link-indicator flex h-full w-full\">\n\t\t\t\t\t\t\t\t<div className=\"flex flex-1 flex-col\">\n\t\t\t\t\t\t\t\t\t<ScrollArea className=\"scrollbar-none flex-1 overflow-x-hidden h-full\">\n\t\t\t\t\t\t\t\t\t\t{error &&\n\t\t\t\t\t\t\t\t\t\t(!communications || communications.length === 0) ? (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center p-8\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-8 w-8 text-destructive mx-auto mb-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-destructive mb-2 font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tFailed to load communications\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground mb-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{error}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => fetchCommunications()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tTry Again\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t) : filteredCommunications.length ? (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-h-[200px] px-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t{filteredCommunications.map((communication) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst isSelected =\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedCommunication?.id === communication.id;\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst isUnread =\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcommunication.status === \"unread\" ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcommunication.status === \"new\";\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst typeConfig = getTypeConfig(communication.type);\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst TypeIcon = typeConfig.icon;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={communication.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"select-none md:my-1\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"hover:bg-accent group flex cursor-pointer flex-col items-start rounded-lg py-2 text-left text-sm transition-all hover:opacity-100 relative\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisSelected ? \"bg-accent opacity-100\" : \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisUnread ? \"opacity-100\" : \"opacity-60\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleCommunicationSelect(communication)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Hover Action Toolbar */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"dark:bg-panelDark absolute right-2 z-25 flex -translate-y-1/2 items-center gap-1 rounded-xl border bg-white p-1 opacity-0 shadow-sm group-hover:opacity-100 top-[-1] transition-opacity duration-200\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-6 w-6 overflow-visible p-0 hover:bg-accent group/star\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleStar(communication.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Star\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Star\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"h-4 w-4 transition-colors group-hover/star:text-yellow-500\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstarredIds.has(communication.id)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"fill-yellow-500 text-yellow-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-6 w-6 p-0 hover:bg-accent group/archive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleArchive(communication.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Archive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Archive className=\"h-4 w-4 text-muted-foreground transition-colors group-hover/archive:text-blue-500\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Communication Card Content */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"relative flex w-full items-center justify-between gap-4 px-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Avatar with type badge */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Avatar className=\"h-8 w-8 shrink-0 rounded-full border\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarFallback className=\"bg-white dark:bg-[#373737] text-[#9F9F9D] font-bold text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{getContactDisplayName(communication)[0]?.toUpperCase() || \"?\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"absolute -bottom-1 -right-1 rounded-full p-0.5 border border-white dark:border-[#1C1C1C]\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttypeConfig.bg,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TypeIcon\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"h-2.5 w-2.5\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttypeConfig.color,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex w-full justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-full\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex w-full flex-row items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-row items-center gap-[4px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-bold text-md flex items-baseline gap-1 group-hover:opacity-100\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"line-clamp-1 overflow-hidden text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{getContactDisplayName(communication)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{isUnread && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"ml-0.5 size-2 rounded-full bg-[#006FFE]\"></span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-nowrap text-xs font-normal opacity-70 transition-opacity group-hover:opacity-100 dark:text-[#8C8C8C]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{communication.createdAt\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? new Date(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcommunication.createdAt,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t).toLocaleTimeString([], {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thour: \"2-digit\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tminute: \"2-digit\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"mt-1 line-clamp-1 min-w-0 overflow-hidden text-sm text-[#8C8C8C] flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{communication.subject ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcommunication.body ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"No content\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Status badges */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1 shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{communication.customerId && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thref={`/dashboard/customers/${communication.customerId}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation()\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"px-1.5 py-0.5 rounded text-[10px] bg-primary/10 text-primary hover:bg-primary/20 transition-colors flex items-center gap-0.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"View customer profile\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<User className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{communication.jobId && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-1.5 py-0.5 rounded text-[10px] bg-purple-500/10 text-purple-600 flex items-center gap-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Briefcase className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{communication.internalNotes && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-1.5 py-0.5 rounded text-[10px] bg-muted text-muted-foreground flex items-center gap-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<StickyNote className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{communication.status ===\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"failed\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-1.5 py-0.5 rounded text-[10px] bg-destructive/10 text-destructive flex items-center gap-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center p-8\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tNo communications found\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{searchQuery && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground mt-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tTry adjusting your search\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</ScrollArea>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Right Panel - Communication Detail or Compose */}\n\t\t\t\t{composeMode ? (\n\t\t\t\t\t/* Email Composer */\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"bg-card mb-1 shadow-sm flex flex-col min-w-0 overflow-hidden\",\n\t\t\t\t\t\t\t\"w-full h-full\",\n\t\t\t\t\t\t\t\"md:rounded-tl-2xl md:flex-1\",\n\t\t\t\t\t\t\tshowDetailOnMobile ? \"flex\" : \"hidden md:flex\",\n\t\t\t\t\t\t)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<EmailFullComposer\n\t\t\t\t\t\t\tcompanyId={companyId}\n\t\t\t\t\t\t\tonClose={() => setComposeMode(false)}\n\t\t\t\t\t\t\tonSent={() => {\n\t\t\t\t\t\t\t\tsetComposeMode(false);\n\t\t\t\t\t\t\t\tfetchCommunications();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tclassName=\"h-full\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t) : selectedCommunication ? (\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"bg-card mb-1 shadow-sm flex flex-col min-w-0 overflow-hidden\",\n\t\t\t\t\t\t\t\"w-full h-full\",\n\t\t\t\t\t\t\t\"md:rounded-tl-2xl md:flex-1\",\n\t\t\t\t\t\t\tshowDetailOnMobile ? \"flex\" : \"hidden md:flex\",\n\t\t\t\t\t\t)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div className=\"relative flex-1 min-h-0 flex flex-col\">\n\t\t\t\t\t\t\t<div className=\"bg-card relative flex flex-col overflow-hidden transition-all duration-300 h-full flex-1 min-h-0\">\n\t\t\t\t\t\t\t\t{/* Communication Header Toolbar */}\n\t\t\t\t\t\t\t\t<div className=\"sticky top-0 z-15 flex shrink-0 items-center justify-between gap-1.5 p-2 pb-0 transition-colors bg-card\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex flex-1 items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tsetSelectedCommunication(null);\n\t\t\t\t\t\t\t\t\t\t\t\tselectedCommunicationRef.current = null;\n\t\t\t\t\t\t\t\t\t\t\t\tsetEmailContent(null);\n\t\t\t\t\t\t\t\t\t\t\t\tsetConversationMessages([]);\n\t\t\t\t\t\t\t\t\t\t\t\tsetReplyMode(null);\n\t\t\t\t\t\t\t\t\t\t\t\trouter.push(\"/dashboard/communication\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tscroll: false,\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8\"\n\t\t\t\t\t\t\t\t\t\t\ttitle=\"Back to list\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<ArrowLeft className=\"h-5 w-5 md:hidden text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t<X className=\"h-4 w-4 hidden md:block text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t<Separator\n\t\t\t\t\t\t\t\t\t\t\torientation=\"vertical\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-4 bg-border/60 hidden md:block\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t{/* Reply buttons for email */}\n\t\t\t\t\t\t\t\t\t\t{selectedCommunication.type === \"email\" && (\n\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-auto md:px-2\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setReplyMode(\"reply-all\")}\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Reply all\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<ReplyAll className=\"h-5 w-5 md:h-4 md:w-4 md:mr-1.5 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm leading-none font-medium hidden md:inline\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tReply all\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t{/* Notes */}\n\t\t\t\t\t\t\t\t\t\t<Sheet open={notesOpen} onOpenChange={setNotesOpen}>\n\t\t\t\t\t\t\t\t\t\t\t<SheetTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8 hidden md:flex\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Internal notes\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<StickyNote className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</SheetTrigger>\n\t\t\t\t\t\t\t\t\t\t\t<SheetContent>\n\t\t\t\t\t\t\t\t\t\t\t\t<SheetHeader>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<SheetTitle>Internal Notes</SheetTitle>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<SheetDescription>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tPrivate team notes - not visible to customer\n\t\t\t\t\t\t\t\t\t\t\t\t\t</SheetDescription>\n\t\t\t\t\t\t\t\t\t\t\t\t</SheetHeader>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"py-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Add your notes here...\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={internalNotes}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => setInternalNotes(e.target.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"min-h-[200px] resize-none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.internalNotesUpdatedAt && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground mt-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tLast updated{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatDistanceToNow(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnew Date(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedCommunication.internalNotesUpdatedAt,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taddSuffix: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"mt-4 flex justify-end gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setNotesOpen(false)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={handleSaveNotes}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={savingNotes}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{savingNotes ? \"Saving...\" : \"Save Notes\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</SheetContent>\n\t\t\t\t\t\t\t\t\t\t</Sheet>\n\t\t\t\t\t\t\t\t\t\t{/* Star */}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8 group/star\"\n\t\t\t\t\t\t\t\t\t\t\ttitle=\"Star\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleStar(selectedCommunication.id)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Star\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"h-5 w-5 md:h-4 md:w-4 transition-colors group-hover/star:text-yellow-500\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tstarredIds.has(selectedCommunication.id)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"fill-yellow-500 text-yellow-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/* Spam toggle for email */}\n\t\t\t\t\t\t\t\t\t\t{selectedCommunication.type === \"email\" && (\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8 hidden md:flex group/spam\"\n\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Toggle spam\"\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\thandleToggleSpam(selectedCommunication.id)\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Flag className=\"h-4 w-4 text-muted-foreground transition-colors group-hover/spam:text-orange-500\" />\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t{/* Archive */}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8\"\n\t\t\t\t\t\t\t\t\t\t\ttitle=\"Archive\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\thandleArchive(selectedCommunication.id)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Archive className=\"h-5 w-5 md:h-4 md:w-4\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/* More menu */}\n\t\t\t\t\t\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"More\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<MoreHorizontal className=\"h-5 w-5 md:h-4 md:w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuContent align=\"end\" className=\"w-48\">\n\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.type === \"email\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleToggleSpam(selectedCommunication.id)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"md:hidden\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Flag className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tToggle spam\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem onClick={handlePrintEmail}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Printer className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tPrint\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem onClick={handleDownloadEml}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Download className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tDownload as .eml\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setNotesOpen(true)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"md:hidden\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<StickyNote className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tNotes\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setTransferDialogOpen(true)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<UserPlus className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tAssign to Team Member\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDelete(selectedCommunication.id)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-destructive focus:text-destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tDelete\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t\t\t\t\t\t</DropdownMenu>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{/* Communication Content */}\n\t\t\t\t\t\t\t\t<div className=\"flex min-h-0 flex-1 flex-col overflow-hidden\">\n\t\t\t\t\t\t\t\t\t<div className=\"relative overflow-hidden flex-1 h-full min-h-0 flex flex-col\">\n\t\t\t\t\t\t\t\t\t\t<TooltipProvider delayDuration={100}>\n\t\t\t\t\t\t\t\t\t\t\t{/* Header section with subject and sender info */}\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"border-b border-border/50 px-2 py-4 space-y-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t<h1 className=\"text-base font-semibold text-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.subject ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(selectedCommunication.type === \"sms\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"Text Message\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"No Subject\")}\n\t\t\t\t\t\t\t\t\t\t\t\t</h1>\n\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Avatar className=\"h-9 w-9 shrink-0 rounded-md cursor-pointer\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarFallback className=\"bg-muted text-muted-foreground font-semibold text-sm rounded-md\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{getContactDisplayName(selectedCommunication)[0]?.toUpperCase() || \"?\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold text-sm text-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{getContactDisplayName(selectedCommunication)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{(selectedCommunication.status === \"unread\" ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedCommunication.status === \"new\") && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"h-2 w-2 rounded-full bg-primary\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.direction === \"inbound\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? selectedCommunication.fromAddress || \"unknown\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: selectedCommunication.toAddress || \"unknown\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.customerId && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"outline\" className=\"gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<User className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCustomer\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.assignedTo && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"gap-1 cursor-pointer hover:bg-accent\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setTransferDialogOpen(true)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<UserPlus className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.assignedTeamMember\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? `${selectedCommunication.assignedTeamMember.firstName} ${selectedCommunication.assignedTeamMember.lastName}`.trim()\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Assigned\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{new Date(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedCommunication.createdAt,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t).toLocaleTimeString(\"en-US\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thour: \"numeric\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tminute: \"2-digit\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t{/* Email status for outbound emails */}\n\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.type === \"email\" &&\n\t\t\t\t\t\t\t\t\t\t\t\t\tselectedCommunication.direction === \"outbound\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-col gap-2 pt-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1 flex-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedCommunication.status === \"sent\" || selectedCommunication.status === \"delivered\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-green-500/10 text-green-600\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: selectedCommunication.status === \"failed\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-red-500/10 text-red-600\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-muted text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.status === \"sent\" || selectedCommunication.status === \"delivered\" ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<CheckCheck className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : selectedCommunication.status === \"failed\" ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertCircle className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Clock className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"capitalize\">{selectedCommunication.status}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t{/* Auto-Link Suggestions */}\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"px-2 py-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<AutoLinkSuggestions\n\t\t\t\t\t\t\t\t\t\t\t\t\tcommunication={selectedCommunication}\n\t\t\t\t\t\t\t\t\t\t\t\t\tcompanyId={companyId}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonLinked={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfetchCommunications();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t{/* Content area - different for email vs SMS */}\n\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.type === \"email\" ? (\n\t\t\t\t\t\t\t\t\t\t\t\t/* Email Content */\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 overflow-hidden flex flex-col min-h-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 overflow-y-auto px-2 py-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{loadingContent ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center py-12\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground mx-auto mb-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tLoading email content...\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<EmailContent\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thtml={emailContent?.html || null}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temailContent?.text ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedCommunication.body ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnull\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tattachments={null}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Reply Composer or Action Bar */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"px-2 py-4 pb-safe\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{replyMode ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<EmailReplyComposer\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmode={replyMode}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail={{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: selectedCommunication.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom_address: selectedCommunication.fromAddress || \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom_name: null,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tto_address: selectedCommunication.toAddress || \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsubject: selectedCommunication.subject || \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbody: emailContent?.text || selectedCommunication.body || \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbody_html: emailContent?.html || null,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} as any}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompanyId={companyId}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClose={() => setReplyMode(null)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonSent={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetReplyMode(null);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfetchCommunications();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : selectedCommunication.status === \"failed\" ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 flex-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-11 px-4 flex-1 md:flex-none md:h-9\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleRetry(selectedCommunication.id)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={retrying}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{retrying ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-5 w-5 md:h-4 md:w-4 mr-2 animate-spin\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSending...\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<RefreshCw className=\"h-5 w-5 md:h-4 md:w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tRetry Send\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 flex-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-11 px-4 flex-1 md:flex-none md:h-9\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setReplyMode(\"reply\")}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Reply className=\"h-5 w-5 md:h-4 md:w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tReply\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-11 px-3 flex-1 md:flex-none md:h-9 md:px-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setReplyMode(\"reply-all\")}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ReplyAll className=\"h-5 w-5 md:h-4 md:w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"hidden xs:inline\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tReply All\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"xs:hidden\">All</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-11 px-3 flex-1 md:flex-none md:h-9 md:px-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setReplyMode(\"forward\")}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Forward className=\"h-5 w-5 md:h-4 md:w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tForward\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t) : selectedCommunication.type === \"sms\" ? (\n\t\t\t\t\t\t\t\t\t\t\t\t/* SMS Conversation View */\n\t\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tref={conversationScrollRef}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex-1 overflow-y-auto bg-card px-4 py-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{loadingConversation ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center h-full\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : conversationMessages.length === 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center h-full\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<MessageSquare className=\"h-12 w-12 text-muted-foreground opacity-50 mx-auto mb-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tNo messages yet\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{conversationMessages.map((msg, index) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst isOutbound =\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmsg.direction === \"outbound\";\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst showTime =\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tindex === 0 ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnew Date(msg.created_at).getTime() -\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnew Date(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconversationMessages[index - 1]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.created_at,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t).getTime() >\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t5 * 60 * 1000;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div key={msg.id} className=\"flex flex-col\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{showTime && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex justify-center my-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground bg-muted/50 px-2 py-1 rounded-full\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatMessageTime(msg.created_at)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex flex-col\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisOutbound\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"items-end\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"items-start\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"max-w-[75%] rounded-2xl px-4 py-2 shadow-sm\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisOutbound\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-primary text-primary-foreground rounded-tr-sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-muted text-foreground rounded-tl-sm\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Show attachments if present */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{msg.provider_metadata &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttypeof msg.provider_metadata ===\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"object\" &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"attachments\" in\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmsg.provider_metadata &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tArray.isArray(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmsg.provider_metadata.attachments,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmsg.provider_metadata.attachments\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"mb-2 space-y-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{(msg.provider_metadata.attachments as MessageAttachment[]).map(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(att, attIdx) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst isImage =\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tatt.type === \"image\" ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(att.url &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/\\.(jpg|jpeg|png|gif|webp)$/i.test(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tatt.url,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={attIdx}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"rounded-lg overflow-hidden\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{isImage ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={att.url}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talt={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tatt.filename ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Image\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"max-w-full max-h-64 object-contain rounded-lg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tloading=\"lazy\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thref={att.url}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex items-center gap-2 p-2 rounded-lg hover:opacity-80 transition-opacity\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisOutbound\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-primary-foreground/20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-background/20\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Paperclip className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-xs truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{att.filename ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Attachment\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{msg.body && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm whitespace-pre-wrap break-words\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{msg.body}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{!msg.body &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(!msg.provider_metadata ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttypeof msg.provider_metadata !==\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"object\" ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t!(\"attachments\" in\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmsg.provider_metadata) ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t!Array.isArray(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmsg.provider_metadata.attachments,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmsg.provider_metadata.attachments\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.length === 0) && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm opacity-70 italic\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tNo message content\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"text-xs text-muted-foreground mt-0.5\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisOutbound\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"text-right\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-left\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{new Date(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmsg.created_at,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t).toLocaleTimeString([], {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thour: \"2-digit\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tminute: \"2-digit\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/* SMS Message Input */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<SmsMessageInput\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={messageInput}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={setMessageInput}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonSend={handleSendMessage}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonAttach={handleAttachFiles}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsending={sendingMessage}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={!selectedCommunication}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Text Message\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcustomerId={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedCommunication?.customerId || undefined\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcustomerName={undefined}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcustomerFirstName={undefined}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompanyName={companyContext?.companyName}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompanyPhone={companyContext?.companyPhone}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tenableAiSuggestions={Boolean(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedCommunication?.customerId,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t\t) : selectedCommunication.type === \"call\" ? (\n\t\t\t\t\t\t\t\t\t\t\t\t/* Call Detail View */\n\t\t\t\t\t\t\t\t\t\t\t\t<CallDetailView\n\t\t\t\t\t\t\t\t\t\t\t\t\tcommunication={selectedCommunication}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonSendText={(phone) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Navigate to SMS view for this phone\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst existingSmsComm = communications.find(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(c) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tc.type === \"sms\" &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(c.fromAddress === phone || c.toAddress === phone)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (existingSmsComm) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleCommunicationSelect(existingSmsComm);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.info(`Start new conversation with ${phone}`);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonCallBack={(phone) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// For now, show phone number - real implementation would use Twilio to initiate call\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twindow.open(`tel:${phone}`, \"_self\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonTransfer={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetTransferDialogOpen(true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t) : selectedCommunication.type === \"voicemail\" ? (\n\t\t\t\t\t\t\t\t\t\t\t\t/* Voicemail Detail View */\n\t\t\t\t\t\t\t\t\t\t\t\t<VoicemailDetailView\n\t\t\t\t\t\t\t\t\t\t\t\t\tcommunication={selectedCommunication}\n\t\t\t\t\t\t\t\t\t\t\t\t\tisRead={selectedCommunication.status === \"read\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonMarkAsRead={(id, read) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Mark voicemail as read/unread\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetCommunications((prev) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprev.map((c) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tc.id === id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? { ...c, status: read ? \"read\" : \"unread\" }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: c,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonSendText={(phone) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Navigate to SMS view for this phone\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst existingSmsComm = communications.find(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(c) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tc.type === \"sms\" &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(c.fromAddress === phone || c.toAddress === phone)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (existingSmsComm) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleCommunicationSelect(existingSmsComm);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.info(`Start new conversation with ${phone}`);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonCallBack={(phone) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twindow.open(`tel:${phone}`, \"_self\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonTransfer={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetTransferDialogOpen(true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t/* Fallback for other types */\n\t\t\t\t\t\t\t\t\t\t\t\t<ScrollArea className=\"flex-1 px-2 py-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"prose prose-sm max-w-none\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"whitespace-pre-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCommunication.body || \"No content\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</ScrollArea>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</TooltipProvider>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t) : (\n\t\t\t\t\t/* Empty State */\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"bg-card mb-1 shadow-sm hidden md:flex md:flex-col md:items-center md:justify-center md:rounded-tl-2xl md:flex-1\",\n\t\t\t\t\t\t)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Mail className=\"h-16 w-16 text-muted-foreground mb-4\" />\n\t\t\t\t\t\t<h3 className=\"text-lg font-semibold\">No communication selected</h3>\n\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground mb-4\">\n\t\t\t\t\t\t\tSelect a communication from the list to view details\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\twindow.dispatchEvent(new CustomEvent(\"open-unified-compose\"));\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tclassName=\"h-11 px-5\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Plus className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\tNew Message\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\n\t\t\t{/* Transfer Dialog - Available for all communication types */}\n\t\t\t{selectedCommunication && (\n\t\t\t\t<TransferDialog\n\t\t\t\t\topen={transferDialogOpen}\n\t\t\t\t\tonOpenChange={setTransferDialogOpen}\n\t\t\t\t\tcommunication={selectedCommunication}\n\t\t\t\t\tcompanyId={companyId}\n\t\t\t\t\tcurrentTeamMemberId={teamMemberId}\n\t\t\t\t\tonTransferComplete={() => {\n\t\t\t\t\t\tfetchCommunications();\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","/**\n * Auto-Link Suggestions Component\n *\n * Displays suggested customer/job/property matches for unlinked communications\n * Shows confidence scores and allows CSRs to accept or reject suggestions\n *\n * Features:\n * - Match suggestions based on email/phone\n * - Confidence score indicators\n * - One-click linking with optimistic updates\n * - Dismissible suggestions\n */\n\n\"use client\";\n\nimport {\n\tAlertCircle,\n\tBriefcase,\n\tCheck,\n\tLink2,\n\tMapPin,\n\tUser,\n\tX,\n} from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\nimport {\n\tautoLinkCommunicationAction,\n\tgetAutoLinkSuggestionsAction,\n\ttype MatchSuggestion,\n} from \"@/actions/communications\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tCard,\n\tCardContent,\n\tCardDescription,\n\tCardHeader,\n\tCardTitle,\n} from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport type { Communication } from \"@/lib/queries/communications\";\nimport { cn } from \"@/lib/utils\";\n\ninterface AutoLinkSuggestionsProps {\n\tcommunication: Communication;\n\tcompanyId?: string;\n\tonLinked?: () => void;\n}\n\nexport function AutoLinkSuggestions({\n\tcommunication,\n\tcompanyId,\n\tonLinked,\n}: AutoLinkSuggestionsProps) {\n\tconst [suggestions, setSuggestions] = useState<MatchSuggestion[]>([]);\n\tconst [loading, setLoading] = useState(true);\n\tconst [linking, setLinking] = useState<string | null>(null);\n\tconst [dismissed, setDismissed] = useState<Set<string>>(new Set());\n\n\t// Fetch suggestions on mount\n\tuseEffect(() => {\n\t\tasync function fetchSuggestions() {\n\t\t\tif (!companyId) return;\n\n\t\t\tsetLoading(true);\n\t\t\ttry {\n\t\t\t\tconst result = await getAutoLinkSuggestionsAction({\n\t\t\t\t\tcommunicationId: communication.id,\n\t\t\t\t\tcompanyId,\n\t\t\t\t});\n\n\t\t\t\tif (result.success && result.suggestions) {\n\t\t\t\t\tsetSuggestions(result.suggestions);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Failed to fetch suggestions:\", error);\n\t\t\t} finally {\n\t\t\t\tsetLoading(false);\n\t\t\t}\n\t\t}\n\n\t\tfetchSuggestions();\n\t}, [communication.id, companyId]);\n\n\t// Don't show if already linked\n\tif (\n\t\tcommunication.customerId ||\n\t\tcommunication.jobId ||\n\t\tcommunication.propertyId\n\t) {\n\t\treturn null;\n\t}\n\n\t// Filter out dismissed suggestions\n\tconst activeSuggestions = suggestions.filter((s) => !dismissed.has(s.id));\n\n\t// Show loading state\n\tif (loading) {\n\t\treturn (\n\t\t\t<Card className=\"border-blue-200 bg-blue-50/50 dark:border-blue-900 dark:bg-blue-950/20\">\n\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Link2 className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-semibold\">\n\t\t\t\t\t\t\tLooking for matches...\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t</Card>\n\t\t);\n\t}\n\n\tif (activeSuggestions.length === 0) {\n\t\treturn null;\n\t}\n\n\tconst handleAccept = async (suggestion: MatchSuggestion) => {\n\t\tsetLinking(suggestion.id);\n\n\t\ttry {\n\t\t\tconst result = await autoLinkCommunicationAction({\n\t\t\t\tcommunicationId: communication.id,\n\t\t\t\tcustomerId: suggestion.type === \"customer\" ? suggestion.id : undefined,\n\t\t\t\tjobId: suggestion.type === \"job\" ? suggestion.id : undefined,\n\t\t\t\tpropertyId: suggestion.type === \"property\" ? suggestion.id : undefined,\n\t\t\t\tlinkConfidence: suggestion.confidence,\n\t\t\t\tlinkMethod: suggestion.matchMethod,\n\t\t\t});\n\n\t\t\tif (result.success) {\n\t\t\t\t// Remove accepted suggestion and related ones\n\t\t\t\tsetSuggestions((prev) => prev.filter((s) => s.id !== suggestion.id));\n\t\t\t\tonLinked?.();\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to link communication:\", error);\n\t\t} finally {\n\t\t\tsetLinking(null);\n\t\t}\n\t};\n\n\tconst handleDismiss = (suggestionId: string) => {\n\t\tsetDismissed((prev) => new Set([...prev, suggestionId]));\n\t};\n\n\tconst getTypeConfig = (type: MatchSuggestion[\"type\"]) => {\n\t\tswitch (type) {\n\t\t\tcase \"customer\":\n\t\t\t\treturn {\n\t\t\t\t\ticon: User,\n\t\t\t\t\tcolor: \"text-blue-500\",\n\t\t\t\t\tbg: \"bg-blue-500/10\",\n\t\t\t\t\tlabel: \"Customer\",\n\t\t\t\t};\n\t\t\tcase \"job\":\n\t\t\t\treturn {\n\t\t\t\t\ticon: Briefcase,\n\t\t\t\t\tcolor: \"text-purple-500\",\n\t\t\t\t\tbg: \"bg-purple-500/10\",\n\t\t\t\t\tlabel: \"Job\",\n\t\t\t\t};\n\t\t\tcase \"property\":\n\t\t\t\treturn {\n\t\t\t\t\ticon: MapPin,\n\t\t\t\t\tcolor: \"text-green-500\",\n\t\t\t\t\tbg: \"bg-green-500/10\",\n\t\t\t\t\tlabel: \"Property\",\n\t\t\t\t};\n\t\t}\n\t};\n\n\tconst getConfidenceBadge = (confidence: number) => {\n\t\tif (confidence >= 0.9) {\n\t\t\treturn (\n\t\t\t\t<Badge variant=\"default\" className=\"gap-1\">\n\t\t\t\t\t<Check className=\"h-3 w-3\" />\n\t\t\t\t\t{Math.round(confidence * 100)}% match\n\t\t\t\t</Badge>\n\t\t\t);\n\t\t}\n\t\tif (confidence >= 0.7) {\n\t\t\treturn (\n\t\t\t\t<Badge variant=\"secondary\" className=\"gap-1\">\n\t\t\t\t\t{Math.round(confidence * 100)}% match\n\t\t\t\t</Badge>\n\t\t\t);\n\t\t}\n\t\treturn (\n\t\t\t<Badge variant=\"outline\" className=\"gap-1\">\n\t\t\t\t<AlertCircle className=\"h-3 w-3\" />\n\t\t\t\t{Math.round(confidence * 100)}% match\n\t\t\t</Badge>\n\t\t);\n\t};\n\n\treturn (\n\t\t<Card className=\"border-blue-200 bg-blue-50/50 dark:border-blue-900 dark:bg-blue-950/20\">\n\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<Link2 className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n\t\t\t\t\t<CardTitle className=\"text-sm font-semibold\">\n\t\t\t\t\t\tSuggested Matches\n\t\t\t\t\t</CardTitle>\n\t\t\t\t</div>\n\t\t\t\t<CardDescription className=\"text-xs\">\n\t\t\t\t\tWe found {activeSuggestions.length} potential{\" \"}\n\t\t\t\t\t{activeSuggestions.length === 1 ? \"match\" : \"matches\"} for this\n\t\t\t\t\tcommunication\n\t\t\t\t</CardDescription>\n\t\t\t</CardHeader>\n\t\t\t<CardContent className=\"space-y-2 pt-0\">\n\t\t\t\t{activeSuggestions.map((suggestion, index) => {\n\t\t\t\t\tconst typeConfig = getTypeConfig(suggestion.type);\n\t\t\t\t\tconst TypeIcon = typeConfig.icon;\n\t\t\t\t\tconst isLinking = linking === suggestion.id;\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<div key={suggestion.id}>\n\t\t\t\t\t\t\t{index > 0 && <Separator className=\"my-2\" />}\n\t\t\t\t\t\t\t<div className=\"flex items-start gap-3\">\n\t\t\t\t\t\t\t\t{/* Type Icon */}\n\t\t\t\t\t\t\t\t<div className={cn(\"rounded-full p-2\", typeConfig.bg)}>\n\t\t\t\t\t\t\t\t\t<TypeIcon className={cn(\"h-4 w-4\", typeConfig.color)} />\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{/* Content */}\n\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0 space-y-1\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t<p className=\"font-medium text-sm truncate\">\n\t\t\t\t\t\t\t\t\t\t\t{suggestion.name}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t<Badge variant=\"outline\" className=\"text-xs shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t{typeConfig.label}\n\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{suggestion.subtitle && (\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground truncate\">\n\t\t\t\t\t\t\t\t\t\t\t{suggestion.subtitle}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 flex-wrap\">\n\t\t\t\t\t\t\t\t\t\t{getConfidenceBadge(suggestion.confidence)}\n\t\t\t\t\t\t\t\t\t\t{suggestion.matchDetails && (\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t{suggestion.matchDetails}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{/* Actions */}\n\t\t\t\t\t\t\t\t<div className=\"flex gap-1 shrink-0\">\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"default\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => handleAccept(suggestion)}\n\t\t\t\t\t\t\t\t\t\tdisabled={isLinking}\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 gap-1\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Check className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\tLink\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => handleDismiss(suggestion.id)}\n\t\t\t\t\t\t\t\t\t\tdisabled={isLinking}\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 w-8 p-0\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<X className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t);\n\t\t\t\t})}\n\t\t\t</CardContent>\n\t\t</Card>\n\t);\n}\n","\"use client\";\n\n/**\n * Call Detail View Component\n *\n * Displays detailed information about a phone call in the unified inbox.\n * Features:\n * - Call metadata (duration, direction, timestamp)\n * - Audio player for recordings\n * - Transcription display with sentiment\n * - Customer context and quick actions\n * - Transfer/assign to team member\n */\n\nimport {\n\tArrowDownLeft,\n\tArrowUpRight,\n\tCalendar,\n\tChevronDown,\n\tChevronUp,\n\tClock,\n\tExternalLink,\n\tMessageSquare,\n\tPhone,\n\tPhoneForwarded,\n\tPhoneOff,\n\tUser,\n\tVolume2,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useState } from \"react\";\nimport { AudioPlayer } from \"@/components/ui/audio-player\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tCollapsible,\n\tCollapsibleContent,\n\tCollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport type { Communication } from \"@/lib/queries/communications\";\nimport { cn } from \"@/lib/utils\";\n\ninterface CallDetailViewProps {\n\tcommunication: Communication;\n\tonSendText?: (phone: string) => void;\n\tonCallBack?: (phone: string) => void;\n\tonTransfer?: (communicationId: string) => void;\n}\n\nfunction formatDuration(seconds: number | null | undefined): string {\n\tif (!seconds) return \"0:00\";\n\tconst mins = Math.floor(seconds / 60);\n\tconst secs = seconds % 60;\n\treturn `${mins}:${secs.toString().padStart(2, \"0\")}`;\n}\n\nfunction formatDateTime(dateString: string): string {\n\tconst date = new Date(dateString);\n\treturn date.toLocaleString(\"en-US\", {\n\t\tweekday: \"short\",\n\t\tmonth: \"short\",\n\t\tday: \"numeric\",\n\t\thour: \"numeric\",\n\t\tminute: \"2-digit\",\n\t\thour12: true,\n\t});\n}\n\nfunction getSentimentBadge(sentiment: string | null | undefined) {\n\tif (!sentiment) return null;\n\n\tconst sentimentLower = sentiment.toLowerCase();\n\tlet variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\" = \"secondary\";\n\tlet label = sentiment;\n\n\tif (sentimentLower.includes(\"positive\") || sentimentLower.includes(\"happy\")) {\n\t\tvariant = \"default\";\n\t\tlabel = \"Positive\";\n\t} else if (sentimentLower.includes(\"negative\") || sentimentLower.includes(\"angry\") || sentimentLower.includes(\"frustrated\")) {\n\t\tvariant = \"destructive\";\n\t\tlabel = \"Negative\";\n\t} else if (sentimentLower.includes(\"neutral\")) {\n\t\tvariant = \"secondary\";\n\t\tlabel = \"Neutral\";\n\t}\n\n\treturn <Badge variant={variant}>{label}</Badge>;\n}\n\nfunction getCallStatusInfo(communication: Communication) {\n\tconst { status, hangupCause, hangupSource, callDuration, answeringMachineDetected } = communication;\n\n\t// Determine call outcome\n\tif (answeringMachineDetected) {\n\t\treturn {\n\t\t\tlabel: \"Voicemail\",\n\t\t\ticon: Volume2,\n\t\t\tcolor: \"text-orange-500\",\n\t\t\tdescription: \"Call went to voicemail\",\n\t\t};\n\t}\n\n\tif (hangupCause === \"no_answer\" || status === \"missed\") {\n\t\treturn {\n\t\t\tlabel: \"Missed\",\n\t\t\ticon: PhoneOff,\n\t\t\tcolor: \"text-red-500\",\n\t\t\tdescription: \"Call was not answered\",\n\t\t};\n\t}\n\n\tif (callDuration && callDuration > 0) {\n\t\treturn {\n\t\t\tlabel: \"Completed\",\n\t\t\ticon: Phone,\n\t\t\tcolor: \"text-green-500\",\n\t\t\tdescription: `Call lasted ${formatDuration(callDuration)}`,\n\t\t};\n\t}\n\n\tif (status === \"in_progress\") {\n\t\treturn {\n\t\t\tlabel: \"In Progress\",\n\t\t\ticon: Phone,\n\t\t\tcolor: \"text-blue-500\",\n\t\t\tdescription: \"Call is currently active\",\n\t\t};\n\t}\n\n\treturn {\n\t\tlabel: \"Call\",\n\t\ticon: Phone,\n\t\tcolor: \"text-muted-foreground\",\n\t\tdescription: status || \"Unknown status\",\n\t};\n}\n\nexport function CallDetailView({\n\tcommunication,\n\tonSendText,\n\tonCallBack,\n\tonTransfer,\n}: CallDetailViewProps) {\n\tconst [transcriptExpanded, setTranscriptExpanded] = useState(true);\n\n\tconst isInbound = communication.direction === \"inbound\";\n\tconst phoneNumber = isInbound\n\t\t? communication.fromAddress\n\t\t: communication.toAddress;\n\tconst contactName =\n\t\tcommunication.fromName ||\n\t\tcommunication.customer?.firstName\n\t\t\t? `${communication.customer?.firstName || \"\"} ${communication.customer?.lastName || \"\"}`.trim()\n\t\t\t: null;\n\n\tconst statusInfo = getCallStatusInfo(communication);\n\tconst StatusIcon = statusInfo.icon;\n\n\treturn (\n\t\t<ScrollArea className=\"h-full\">\n\t\t\t<div className=\"p-6 space-y-6\">\n\t\t\t\t{/* Header */}\n\t\t\t\t<div className=\"flex items-start justify-between\">\n\t\t\t\t\t<div className=\"flex items-start gap-4\">\n\t\t\t\t\t\t{/* Direction indicator */}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\"flex h-12 w-12 items-center justify-center rounded-full\",\n\t\t\t\t\t\t\t\tisInbound ? \"bg-blue-500/10\" : \"bg-green-500/10\"\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{isInbound ? (\n\t\t\t\t\t\t\t\t<ArrowDownLeft className=\"h-6 w-6 text-blue-500\" />\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<ArrowUpRight className=\"h-6 w-6 text-green-500\" />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<h2 className=\"text-lg font-semibold\">\n\t\t\t\t\t\t\t\t{isInbound ? \"Incoming Call\" : \"Outgoing Call\"}\n\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 mt-1 text-muted-foreground\">\n\t\t\t\t\t\t\t\t<StatusIcon className={cn(\"h-4 w-4\", statusInfo.color)} />\n\t\t\t\t\t\t\t\t<span className=\"text-sm\">{statusInfo.description}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<Badge variant=\"outline\" className={statusInfo.color}>\n\t\t\t\t\t\t{statusInfo.label}\n\t\t\t\t\t</Badge>\n\t\t\t\t</div>\n\n\t\t\t\t<Separator />\n\n\t\t\t\t{/* Contact Info */}\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t<h3 className=\"text-sm font-medium text-muted-foreground uppercase tracking-wide\">\n\t\t\t\t\t\tContact\n\t\t\t\t\t</h3>\n\n\t\t\t\t\t<div className=\"flex items-center gap-4\">\n\t\t\t\t\t\t<div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-muted\">\n\t\t\t\t\t\t\t<User className=\"h-5 w-5 text-muted-foreground\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t{contactName ? (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<div className=\"font-medium\">{contactName}</div>\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t{phoneNumber}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<div className=\"font-medium\">{phoneNumber || \"Unknown\"}</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{communication.customerId && (\n\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\thref={`/dashboard/customers/${communication.customerId}`}\n\t\t\t\t\t\t\t\tclassName=\"text-sm text-primary hover:underline flex items-center gap-1\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tView Profile\n\t\t\t\t\t\t\t\t<ExternalLink className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Call Details */}\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t<h3 className=\"text-sm font-medium text-muted-foreground uppercase tracking-wide\">\n\t\t\t\t\t\tCall Details\n\t\t\t\t\t</h3>\n\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Clock className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div className=\"text-sm text-muted-foreground\">Duration</div>\n\t\t\t\t\t\t\t\t<div className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t{formatDuration(communication.callDuration)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Calendar className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div className=\"text-sm text-muted-foreground\">Date & Time</div>\n\t\t\t\t\t\t\t\t<div className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t{formatDateTime(communication.createdAt)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{communication.callSentiment && (\n\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<span className=\"text-sm text-muted-foreground\">Sentiment:</span>\n\t\t\t\t\t\t\t{getSentimentBadge(communication.callSentiment)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{/* Recording */}\n\t\t\t\t{communication.callRecordingUrl && (\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<h3 className=\"text-sm font-medium text-muted-foreground uppercase tracking-wide\">\n\t\t\t\t\t\t\tRecording\n\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t<AudioPlayer\n\t\t\t\t\t\t\tsrc={communication.callRecordingUrl}\n\t\t\t\t\t\t\ttitle=\"Call Recording\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\n\t\t\t\t{/* Transcription */}\n\t\t\t\t{communication.callTranscript && (\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<Collapsible\n\t\t\t\t\t\t\topen={transcriptExpanded}\n\t\t\t\t\t\t\tonOpenChange={setTranscriptExpanded}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<CollapsibleTrigger asChild>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tclassName=\"flex items-center justify-between w-full group\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<h3 className=\"text-sm font-medium text-muted-foreground uppercase tracking-wide\">\n\t\t\t\t\t\t\t\t\t\tTranscription\n\t\t\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t\t\t{transcriptExpanded ? (\n\t\t\t\t\t\t\t\t\t\t<ChevronUp className=\"h-4 w-4 text-muted-foreground group-hover:text-foreground transition-colors\" />\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<ChevronDown className=\"h-4 w-4 text-muted-foreground group-hover:text-foreground transition-colors\" />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</CollapsibleTrigger>\n\t\t\t\t\t\t\t<CollapsibleContent>\n\t\t\t\t\t\t\t\t<div className=\"mt-4 rounded-lg border bg-muted/50 p-4\">\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm whitespace-pre-wrap leading-relaxed\">\n\t\t\t\t\t\t\t\t\t\t{communication.callTranscript}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</CollapsibleContent>\n\t\t\t\t\t\t</Collapsible>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\n\t\t\t\t{/* Quick Actions */}\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t<h3 className=\"text-sm font-medium text-muted-foreground uppercase tracking-wide\">\n\t\t\t\t\t\tActions\n\t\t\t\t\t</h3>\n\n\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\n\t\t\t\t\t\t{phoneNumber && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\tonClick={() => onCallBack?.(phoneNumber)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Phone className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\tCall Back\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\tonClick={() => onSendText?.(phoneNumber)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<MessageSquare className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\tSend Text\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tonClick={() => onTransfer?.(communication.id)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<PhoneForwarded className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\tTransfer\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Technical Details (collapsed by default) */}\n\t\t\t\t{(communication.hangupCause || communication.twilioCallSid) && (\n\t\t\t\t\t<Collapsible>\n\t\t\t\t\t\t<CollapsibleTrigger asChild>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclassName=\"flex items-center gap-2 text-xs text-muted-foreground hover:text-foreground transition-colors\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<ChevronDown className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\tTechnical Details\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</CollapsibleTrigger>\n\t\t\t\t\t\t<CollapsibleContent>\n\t\t\t\t\t\t\t<div className=\"mt-2 rounded-lg border bg-muted/50 p-3 text-xs space-y-1\">\n\t\t\t\t\t\t\t\t{communication.hangupCause && (\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">Hangup Cause:</span>{\" \"}\n\t\t\t\t\t\t\t\t\t\t{communication.hangupCause}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{communication.hangupSource && (\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">Hangup Source:</span>{\" \"}\n\t\t\t\t\t\t\t\t\t\t{communication.hangupSource}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{communication.twilioCallSid && (\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">Call SID:</span>{\" \"}\n\t\t\t\t\t\t\t\t\t\t<code className=\"text-[10px]\">{communication.twilioCallSid}</code>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</CollapsibleContent>\n\t\t\t\t\t</Collapsible>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</ScrollArea>\n\t);\n}\n","\"use client\";\n\n/**\n * Audio Player Component\n *\n * A reusable audio player for call recordings and voicemails.\n * Features:\n * - Play/pause controls\n * - Progress bar with seek\n * - Duration display\n * - Playback speed control (0.5x, 1x, 1.5x, 2x)\n * - Volume control\n * - Download button\n */\n\nimport {\n\tDownload,\n\tLoader2,\n\tPause,\n\tPlay,\n\tVolume2,\n\tVolumeX,\n} from \"lucide-react\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { cn } from \"@/lib/utils\";\n\ninterface AudioPlayerProps {\n\tsrc: string;\n\ttitle?: string;\n\tclassName?: string;\n\tcompact?: boolean;\n\tonPlay?: () => void;\n\tonPause?: () => void;\n\tonEnded?: () => void;\n}\n\nfunction formatTime(seconds: number): string {\n\tif (!isFinite(seconds) || isNaN(seconds)) return \"0:00\";\n\tconst mins = Math.floor(seconds / 60);\n\tconst secs = Math.floor(seconds % 60);\n\treturn `${mins}:${secs.toString().padStart(2, \"0\")}`;\n}\n\nexport function AudioPlayer({\n\tsrc,\n\ttitle,\n\tclassName,\n\tcompact = false,\n\tonPlay,\n\tonPause,\n\tonEnded,\n}: AudioPlayerProps) {\n\tconst audioRef = useRef<HTMLAudioElement>(null);\n\tconst [isPlaying, setIsPlaying] = useState(false);\n\tconst [isLoading, setIsLoading] = useState(true);\n\tconst [currentTime, setCurrentTime] = useState(0);\n\tconst [duration, setDuration] = useState(0);\n\tconst [playbackRate, setPlaybackRate] = useState(1);\n\tconst [volume, setVolume] = useState(1);\n\tconst [isMuted, setIsMuted] = useState(false);\n\tconst [error, setError] = useState<string | null>(null);\n\n\t// Handle audio events\n\tuseEffect(() => {\n\t\tconst audio = audioRef.current;\n\t\tif (!audio) return;\n\n\t\tconst handleLoadedMetadata = () => {\n\t\t\tsetDuration(audio.duration);\n\t\t\tsetIsLoading(false);\n\t\t};\n\n\t\tconst handleTimeUpdate = () => {\n\t\t\tsetCurrentTime(audio.currentTime);\n\t\t};\n\n\t\tconst handleEnded = () => {\n\t\t\tsetIsPlaying(false);\n\t\t\tsetCurrentTime(0);\n\t\t\tonEnded?.();\n\t\t};\n\n\t\tconst handlePlay = () => {\n\t\t\tsetIsPlaying(true);\n\t\t\tonPlay?.();\n\t\t};\n\n\t\tconst handlePause = () => {\n\t\t\tsetIsPlaying(false);\n\t\t\tonPause?.();\n\t\t};\n\n\t\tconst handleError = () => {\n\t\t\tsetError(\"Failed to load audio\");\n\t\t\tsetIsLoading(false);\n\t\t};\n\n\t\tconst handleWaiting = () => {\n\t\t\tsetIsLoading(true);\n\t\t};\n\n\t\tconst handleCanPlay = () => {\n\t\t\tsetIsLoading(false);\n\t\t};\n\n\t\taudio.addEventListener(\"loadedmetadata\", handleLoadedMetadata);\n\t\taudio.addEventListener(\"timeupdate\", handleTimeUpdate);\n\t\taudio.addEventListener(\"ended\", handleEnded);\n\t\taudio.addEventListener(\"play\", handlePlay);\n\t\taudio.addEventListener(\"pause\", handlePause);\n\t\taudio.addEventListener(\"error\", handleError);\n\t\taudio.addEventListener(\"waiting\", handleWaiting);\n\t\taudio.addEventListener(\"canplay\", handleCanPlay);\n\n\t\treturn () => {\n\t\t\taudio.removeEventListener(\"loadedmetadata\", handleLoadedMetadata);\n\t\t\taudio.removeEventListener(\"timeupdate\", handleTimeUpdate);\n\t\t\taudio.removeEventListener(\"ended\", handleEnded);\n\t\t\taudio.removeEventListener(\"play\", handlePlay);\n\t\t\taudio.removeEventListener(\"pause\", handlePause);\n\t\t\taudio.removeEventListener(\"error\", handleError);\n\t\t\taudio.removeEventListener(\"waiting\", handleWaiting);\n\t\t\taudio.removeEventListener(\"canplay\", handleCanPlay);\n\t\t};\n\t}, [onPlay, onPause, onEnded]);\n\n\t// Update playback rate when changed\n\tuseEffect(() => {\n\t\tif (audioRef.current) {\n\t\t\taudioRef.current.playbackRate = playbackRate;\n\t\t}\n\t}, [playbackRate]);\n\n\t// Update volume when changed\n\tuseEffect(() => {\n\t\tif (audioRef.current) {\n\t\t\taudioRef.current.volume = isMuted ? 0 : volume;\n\t\t}\n\t}, [volume, isMuted]);\n\n\tconst togglePlay = useCallback(() => {\n\t\tconst audio = audioRef.current;\n\t\tif (!audio) return;\n\n\t\tif (isPlaying) {\n\t\t\taudio.pause();\n\t\t} else {\n\t\t\taudio.play().catch(() => {\n\t\t\t\tsetError(\"Failed to play audio\");\n\t\t\t});\n\t\t}\n\t}, [isPlaying]);\n\n\tconst handleSeek = useCallback((value: number[]) => {\n\t\tconst audio = audioRef.current;\n\t\tif (!audio || !value[0]) return;\n\t\taudio.currentTime = value[0];\n\t\tsetCurrentTime(value[0]);\n\t}, []);\n\n\tconst handleVolumeChange = useCallback((value: number[]) => {\n\t\tif (!value[0] && value[0] !== 0) return;\n\t\tsetVolume(value[0]);\n\t\tsetIsMuted(value[0] === 0);\n\t}, []);\n\n\tconst toggleMute = useCallback(() => {\n\t\tsetIsMuted((prev) => !prev);\n\t}, []);\n\n\tconst handleDownload = useCallback(() => {\n\t\tconst link = document.createElement(\"a\");\n\t\tlink.href = src;\n\t\tlink.download = title || \"recording.mp3\";\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t}, [src, title]);\n\n\tconst playbackSpeeds = [0.5, 0.75, 1, 1.25, 1.5, 2];\n\n\tif (error) {\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName={cn(\n\t\t\t\t\t\"flex items-center gap-2 rounded-lg border border-destructive/50 bg-destructive/10 p-3 text-sm text-destructive\",\n\t\t\t\t\tclassName\n\t\t\t\t)}\n\t\t\t>\n\t\t\t\t<span>{error}</span>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tif (compact) {\n\t\treturn (\n\t\t\t<div className={cn(\"flex items-center gap-2\", className)}>\n\t\t\t\t<audio ref={audioRef} src={src} preload=\"metadata\" />\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\tclassName=\"h-8 w-8\"\n\t\t\t\t\tonClick={togglePlay}\n\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t>\n\t\t\t\t\t{isLoading ? (\n\t\t\t\t\t\t<Loader2 className=\"h-4 w-4 animate-spin\" />\n\t\t\t\t\t) : isPlaying ? (\n\t\t\t\t\t\t<Pause className=\"h-4 w-4\" />\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<Play className=\"h-4 w-4\" />\n\t\t\t\t\t)}\n\t\t\t\t</Button>\n\t\t\t\t<span className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t{formatTime(currentTime)} / {formatTime(duration)}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\n\t\t\t\t\"rounded-lg border bg-card p-4 shadow-sm\",\n\t\t\t\tclassName\n\t\t\t)}\n\t\t>\n\t\t\t<audio ref={audioRef} src={src} preload=\"metadata\" />\n\n\t\t\t{title && (\n\t\t\t\t<div className=\"mb-3 text-sm font-medium text-foreground\">\n\t\t\t\t\t{title}\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{/* Progress bar */}\n\t\t\t<div className=\"mb-3\">\n\t\t\t\t<Slider\n\t\t\t\t\tvalue={[currentTime]}\n\t\t\t\t\tmin={0}\n\t\t\t\t\tmax={duration || 100}\n\t\t\t\t\tstep={0.1}\n\t\t\t\t\tonValueChange={handleSeek}\n\t\t\t\t\tclassName=\"cursor-pointer\"\n\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t/>\n\t\t\t\t<div className=\"mt-1 flex justify-between text-xs text-muted-foreground\">\n\t\t\t\t\t<span>{formatTime(currentTime)}</span>\n\t\t\t\t\t<span>{formatTime(duration)}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Controls */}\n\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t{/* Play/Pause */}\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"default\"\n\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\tclassName=\"h-10 w-10\"\n\t\t\t\t\t\tonClick={togglePlay}\n\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t>\n\t\t\t\t\t\t{isLoading ? (\n\t\t\t\t\t\t\t<Loader2 className=\"h-5 w-5 animate-spin\" />\n\t\t\t\t\t\t) : isPlaying ? (\n\t\t\t\t\t\t\t<Pause className=\"h-5 w-5\" />\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<Play className=\"h-5 w-5 ml-0.5\" />\n\t\t\t\t\t\t)}\n\t\t\t\t\t</Button>\n\n\t\t\t\t\t{/* Playback speed */}\n\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t<Button variant=\"outline\" size=\"sm\" className=\"w-14\">\n\t\t\t\t\t\t\t\t{playbackRate}x\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t<DropdownMenuContent align=\"start\">\n\t\t\t\t\t\t\t{playbackSpeeds.map((speed) => (\n\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\tkey={speed}\n\t\t\t\t\t\t\t\t\tonClick={() => setPlaybackRate(speed)}\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\tplaybackRate === speed && \"bg-accent\"\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{speed}x\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t</DropdownMenu>\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t{/* Volume */}\n\t\t\t\t\t<div className=\"hidden items-center gap-2 sm:flex\">\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\tclassName=\"h-8 w-8\"\n\t\t\t\t\t\t\tonClick={toggleMute}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{isMuted || volume === 0 ? (\n\t\t\t\t\t\t\t\t<VolumeX className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<Volume2 className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Slider\n\t\t\t\t\t\t\tvalue={[isMuted ? 0 : volume]}\n\t\t\t\t\t\t\tmin={0}\n\t\t\t\t\t\t\tmax={1}\n\t\t\t\t\t\t\tstep={0.1}\n\t\t\t\t\t\t\tonValueChange={handleVolumeChange}\n\t\t\t\t\t\t\tclassName=\"w-20\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Download */}\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\tclassName=\"h-8 w-8\"\n\t\t\t\t\t\tonClick={handleDownload}\n\t\t\t\t\t\ttitle=\"Download recording\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Download className=\"h-4 w-4\" />\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","\"use client\";\n\n/**\n * Transfer Dialog Component\n *\n * Dialog for transferring calls, voicemails, and communications to team members.\n * Features:\n * - Search and filter team members\n * - Role/department filtering\n * - Add transfer notes\n * - Priority selection\n */\n\nimport {\n\tArrowRight,\n\tLoader2,\n\tMail,\n\tMessageSquare,\n\tPhone,\n\tSearch,\n\tUser,\n\tUsers,\n\tVoicemail,\n} from \"lucide-react\";\nimport { useCallback, useEffect, useState, useTransition } from \"react\";\nimport { toast } from \"sonner\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDialog,\n\tDialogContent,\n\tDialogDescription,\n\tDialogFooter,\n\tDialogHeader,\n\tDialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport type { Communication } from \"@/lib/queries/communications\";\nimport { cn } from \"@/lib/utils\";\n\ninterface TeamMember {\n\tid: string;\n\tuser_id: string | null;\n\trole: string | null;\n\tjob_title: string | null;\n\tstatus: string | null;\n\tuser?: {\n\t\tid: string;\n\t\temail: string | null;\n\t\tfull_name?: string | null;\n\t\tavatar_url?: string | null;\n\t\tphone?: string | null;\n\t} | null;\n}\n\ninterface TransferDialogProps {\n\topen: boolean;\n\tonOpenChange: (open: boolean) => void;\n\tcommunication: Communication;\n\tcompanyId: string;\n\tcurrentTeamMemberId: string;\n\tonTransferComplete?: (transferredTo: TeamMember) => void;\n}\n\ntype TransferPriority = \"normal\" | \"high\" | \"urgent\";\n\nexport function TransferDialog({\n\topen,\n\tonOpenChange,\n\tcommunication,\n\tcompanyId,\n\tcurrentTeamMemberId,\n\tonTransferComplete,\n}: TransferDialogProps) {\n\tconst [isPending, startTransition] = useTransition();\n\tconst [teamMembers, setTeamMembers] = useState<TeamMember[]>([]);\n\tconst [loading, setLoading] = useState(false);\n\tconst [searchQuery, setSearchQuery] = useState(\"\");\n\tconst [selectedMemberId, setSelectedMemberId] = useState<string | null>(null);\n\tconst [transferNotes, setTransferNotes] = useState(\"\");\n\tconst [priority, setPriority] = useState<TransferPriority>(\"normal\");\n\tconst [roleFilter, setRoleFilter] = useState<string>(\"all\");\n\n\t// Fetch team members when dialog opens\n\tuseEffect(() => {\n\t\tif (open) {\n\t\t\tfetchTeamMembers();\n\t\t}\n\t}, [open]);\n\n\tconst fetchTeamMembers = useCallback(async () => {\n\t\tsetLoading(true);\n\t\ttry {\n\t\t\tconst { getTeamMembersPageData } = await import(\n\t\t\t\t\"@/lib/queries/team-members\"\n\t\t\t);\n\t\t\tconst result = await getTeamMembersPageData(1, 100, \"\", companyId, \"active\");\n\t\t\t// Filter out current user\n\t\t\tconst filtered = result.teamMembers.filter(\n\t\t\t\t(m) => m.id !== currentTeamMemberId\n\t\t\t);\n\t\t\tsetTeamMembers(filtered);\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to fetch team members:\", error);\n\t\t\ttoast.error(\"Failed to load team members\");\n\t\t} finally {\n\t\t\tsetLoading(false);\n\t\t}\n\t}, [companyId, currentTeamMemberId]);\n\n\t// Filter team members by search and role\n\tconst filteredMembers = teamMembers.filter((member) => {\n\t\tconst name = member.user?.full_name || member.user?.email || \"\";\n\t\tconst matchesSearch =\n\t\t\tsearchQuery === \"\" ||\n\t\t\tname.toLowerCase().includes(searchQuery.toLowerCase()) ||\n\t\t\t(member.job_title?.toLowerCase().includes(searchQuery.toLowerCase()) ?? false);\n\n\t\tconst matchesRole =\n\t\t\troleFilter === \"all\" ||\n\t\t\tmember.role === roleFilter;\n\n\t\treturn matchesSearch && matchesRole;\n\t});\n\n\t// Get unique roles for filter\n\tconst uniqueRoles = Array.from(\n\t\tnew Set(teamMembers.map((m) => m.role).filter(Boolean))\n\t);\n\n\tconst handleTransfer = useCallback(async () => {\n\t\tif (!selectedMemberId) {\n\t\t\ttoast.error(\"Please select a team member\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst selectedMember = teamMembers.find((m) => m.id === selectedMemberId);\n\t\tif (!selectedMember) return;\n\n\t\tstartTransition(async () => {\n\t\t\ttry {\n\t\t\t\t// TODO: Implement actual transfer action\n\t\t\t\t// For now, we'll just show a success message\n\t\t\t\t// In a real implementation, this would:\n\t\t\t\t// 1. Update the communication's assigned_to field\n\t\t\t\t// 2. Create a transfer activity log\n\t\t\t\t// 3. Optionally notify the receiving team member\n\n\t\t\t\tconst { transferCommunicationAction } = await import(\n\t\t\t\t\t\"@/actions/communications\"\n\t\t\t\t).catch(() => ({ transferCommunicationAction: null }));\n\n\t\t\t\tif (transferCommunicationAction) {\n\t\t\t\t\tconst result = await transferCommunicationAction({\n\t\t\t\t\t\tcommunicationId: communication.id,\n\t\t\t\t\t\ttoTeamMemberId: selectedMemberId,\n\t\t\t\t\t\tnotes: transferNotes,\n\t\t\t\t\t\tpriority,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\ttoast.success(\n\t\t\t\t\t\t\t`Transferred to ${selectedMember.user?.full_name || selectedMember.user?.email || \"team member\"}`\n\t\t\t\t\t\t);\n\t\t\t\t\t\tonTransferComplete?.(selectedMember);\n\t\t\t\t\t\tonOpenChange(false);\n\t\t\t\t\t\tresetForm();\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoast.error(result.error || \"Failed to transfer\");\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Fallback: just show success for now\n\t\t\t\t\ttoast.success(\n\t\t\t\t\t\t`Transferred to ${selectedMember.user?.full_name || selectedMember.user?.email || \"team member\"}`\n\t\t\t\t\t);\n\t\t\t\t\tonTransferComplete?.(selectedMember);\n\t\t\t\t\tonOpenChange(false);\n\t\t\t\t\tresetForm();\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Failed to transfer:\", error);\n\t\t\t\ttoast.error(\"Failed to transfer communication\");\n\t\t\t}\n\t\t});\n\t}, [\n\t\tselectedMemberId,\n\t\tteamMembers,\n\t\tcommunication.id,\n\t\ttransferNotes,\n\t\tpriority,\n\t\tonTransferComplete,\n\t\tonOpenChange,\n\t]);\n\n\tconst resetForm = () => {\n\t\tsetSelectedMemberId(null);\n\t\tsetTransferNotes(\"\");\n\t\tsetPriority(\"normal\");\n\t\tsetSearchQuery(\"\");\n\t\tsetRoleFilter(\"all\");\n\t};\n\n\tconst getTypeIcon = () => {\n\t\tswitch (communication.type) {\n\t\t\tcase \"email\":\n\t\t\t\treturn <Mail className=\"h-4 w-4\" />;\n\t\t\tcase \"sms\":\n\t\t\t\treturn <MessageSquare className=\"h-4 w-4\" />;\n\t\t\tcase \"call\":\n\t\t\t\treturn <Phone className=\"h-4 w-4\" />;\n\t\t\tcase \"voicemail\":\n\t\t\t\treturn <Voicemail className=\"h-4 w-4\" />;\n\t\t\tdefault:\n\t\t\t\treturn <Mail className=\"h-4 w-4\" />;\n\t\t}\n\t};\n\n\tconst getTypeLabel = () => {\n\t\tswitch (communication.type) {\n\t\t\tcase \"email\":\n\t\t\t\treturn \"Email\";\n\t\t\tcase \"sms\":\n\t\t\t\treturn \"SMS Message\";\n\t\t\tcase \"call\":\n\t\t\t\treturn \"Phone Call\";\n\t\t\tcase \"voicemail\":\n\t\t\t\treturn \"Voicemail\";\n\t\t\tdefault:\n\t\t\t\treturn \"Communication\";\n\t\t}\n\t};\n\n\tconst getTypeColor = () => {\n\t\tswitch (communication.type) {\n\t\t\tcase \"email\":\n\t\t\t\treturn \"bg-blue-500/10\";\n\t\t\tcase \"sms\":\n\t\t\t\treturn \"bg-green-500/10\";\n\t\t\tcase \"call\":\n\t\t\t\treturn \"bg-purple-500/10\";\n\t\t\tcase \"voicemail\":\n\t\t\t\treturn \"bg-orange-500/10\";\n\t\t\tdefault:\n\t\t\t\treturn \"bg-muted\";\n\t\t}\n\t};\n\n\tconst getRoleColor = (role: string | null) => {\n\t\tswitch (role) {\n\t\t\tcase \"owner\":\n\t\t\tcase \"admin\":\n\t\t\t\treturn \"bg-purple-500/10 text-purple-600\";\n\t\t\tcase \"manager\":\n\t\t\t\treturn \"bg-blue-500/10 text-blue-600\";\n\t\t\tcase \"technician\":\n\t\t\t\treturn \"bg-green-500/10 text-green-600\";\n\t\t\tcase \"dispatcher\":\n\t\t\t\treturn \"bg-orange-500/10 text-orange-600\";\n\t\t\tcase \"csr\":\n\t\t\t\treturn \"bg-cyan-500/10 text-cyan-600\";\n\t\t\tdefault:\n\t\t\t\treturn \"bg-muted text-muted-foreground\";\n\t\t}\n\t};\n\n\treturn (\n\t\t<Dialog open={open} onOpenChange={onOpenChange}>\n\t\t\t<DialogContent className=\"sm:max-w-[500px]\">\n\t\t\t\t<DialogHeader>\n\t\t\t\t\t<DialogTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Users className=\"h-5 w-5\" />\n\t\t\t\t\t\tTransfer Communication\n\t\t\t\t\t</DialogTitle>\n\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\tTransfer this {communication.type} to another team member for follow-up.\n\t\t\t\t\t</DialogDescription>\n\t\t\t\t</DialogHeader>\n\n\t\t\t\t{/* Current communication info */}\n\t\t\t\t<div className=\"rounded-lg border bg-muted/50 p-3\">\n\t\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\"flex h-10 w-10 items-center justify-center rounded-full\",\n\t\t\t\t\t\t\t\tgetTypeColor()\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{getTypeIcon()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t<p className=\"text-sm font-medium truncate\">\n\t\t\t\t\t\t\t\t{communication.subject || communication.fromAddress || communication.toAddress || \"Unknown\"}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t{getTypeLabel()}\n\t\t\t\t\t\t\t\t{communication.callDuration && (\n\t\t\t\t\t\t\t\t\t<> &middot; {Math.floor(communication.callDuration / 60)}:{(communication.callDuration % 60).toString().padStart(2, \"0\")}</>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{communication.type === \"email\" && communication.fromAddress && (\n\t\t\t\t\t\t\t\t\t<> &middot; From: {communication.fromAddress}</>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<ArrowRight className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<Separator />\n\n\t\t\t\t{/* Search and filter */}\n\t\t\t\t<div className=\"space-y-3\">\n\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t<div className=\"relative flex-1\">\n\t\t\t\t\t\t\t<Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tplaceholder=\"Search team members...\"\n\t\t\t\t\t\t\t\tvalue={searchQuery}\n\t\t\t\t\t\t\t\tonChange={(e) => setSearchQuery(e.target.value)}\n\t\t\t\t\t\t\t\tclassName=\"pl-9\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Select value={roleFilter} onValueChange={setRoleFilter}>\n\t\t\t\t\t\t\t<SelectTrigger className=\"w-[130px]\">\n\t\t\t\t\t\t\t\t<SelectValue placeholder=\"All roles\" />\n\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t<SelectItem value=\"all\">All roles</SelectItem>\n\t\t\t\t\t\t\t\t{uniqueRoles.map((role) => (\n\t\t\t\t\t\t\t\t\t<SelectItem key={role} value={role!}>\n\t\t\t\t\t\t\t\t\t\t{role}\n\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t</Select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Team members list */}\n\t\t\t\t\t<ScrollArea className=\"h-[200px] rounded-lg border\">\n\t\t\t\t\t\t{loading ? (\n\t\t\t\t\t\t\t<div className=\"flex items-center justify-center h-full\">\n\t\t\t\t\t\t\t\t<Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) : filteredMembers.length === 0 ? (\n\t\t\t\t\t\t\t<div className=\"flex items-center justify-center h-full text-center p-4\">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<User className=\"h-8 w-8 text-muted-foreground mx-auto mb-2\" />\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t{searchQuery || roleFilter !== \"all\"\n\t\t\t\t\t\t\t\t\t\t\t? \"No team members found\"\n\t\t\t\t\t\t\t\t\t\t\t: \"No other team members available\"}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<RadioGroup\n\t\t\t\t\t\t\t\tvalue={selectedMemberId || \"\"}\n\t\t\t\t\t\t\t\tonValueChange={setSelectedMemberId}\n\t\t\t\t\t\t\t\tclassName=\"p-2 space-y-1\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{filteredMembers.map((member) => {\n\t\t\t\t\t\t\t\t\tconst displayName =\n\t\t\t\t\t\t\t\t\t\tmember.user?.full_name ||\n\t\t\t\t\t\t\t\t\t\tmember.user?.email ||\n\t\t\t\t\t\t\t\t\t\t\"Unknown Member\";\n\t\t\t\t\t\t\t\t\tconst initials = displayName\n\t\t\t\t\t\t\t\t\t\t.split(\" \")\n\t\t\t\t\t\t\t\t\t\t.map((n) => n[0])\n\t\t\t\t\t\t\t\t\t\t.join(\"\")\n\t\t\t\t\t\t\t\t\t\t.toUpperCase()\n\t\t\t\t\t\t\t\t\t\t.slice(0, 2);\n\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<label\n\t\t\t\t\t\t\t\t\t\t\tkey={member.id}\n\t\t\t\t\t\t\t\t\t\t\thtmlFor={member.id}\n\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\"flex items-center gap-3 rounded-lg p-2 cursor-pointer transition-colors\",\n\t\t\t\t\t\t\t\t\t\t\t\tselectedMemberId === member.id\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-primary/10 border border-primary\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"hover:bg-accent border border-transparent\"\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<RadioGroupItem\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={member.id}\n\t\t\t\t\t\t\t\t\t\t\t\tid={member.id}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"sr-only\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t<Avatar className=\"h-8 w-8\">\n\t\t\t\t\t\t\t\t\t\t\t\t<AvatarFallback className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{initials}\n\t\t\t\t\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-medium truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{displayName}\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t{member.job_title && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{member.job_title}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{member.role && (\n\t\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\"text-xs\", getRoleColor(member.role))}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{member.role}\n\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t</RadioGroup>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</ScrollArea>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Transfer options */}\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t{/* Priority */}\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<Label>Priority</Label>\n\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t{([\"normal\", \"high\", \"urgent\"] as TransferPriority[]).map(\n\t\t\t\t\t\t\t\t(p) => (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tkey={p}\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\tvariant={priority === p ? \"default\" : \"outline\"}\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => setPriority(p)}\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"flex-1 capitalize\",\n\t\t\t\t\t\t\t\t\t\t\tpriority === p &&\n\t\t\t\t\t\t\t\t\t\t\t\tp === \"urgent\" &&\n\t\t\t\t\t\t\t\t\t\t\t\t\"bg-red-600 hover:bg-red-700\",\n\t\t\t\t\t\t\t\t\t\t\tpriority === p &&\n\t\t\t\t\t\t\t\t\t\t\t\tp === \"high\" &&\n\t\t\t\t\t\t\t\t\t\t\t\t\"bg-orange-500 hover:bg-orange-600\"\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{p}\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Notes */}\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<Label htmlFor=\"transfer-notes\">\n\t\t\t\t\t\t\tNotes for recipient{\" \"}\n\t\t\t\t\t\t\t<span className=\"text-muted-foreground font-normal\">\n\t\t\t\t\t\t\t\t(optional)\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\tid=\"transfer-notes\"\n\t\t\t\t\t\t\tplaceholder=\"Add context about this transfer...\"\n\t\t\t\t\t\t\tvalue={transferNotes}\n\t\t\t\t\t\t\tonChange={(e) => setTransferNotes(e.target.value)}\n\t\t\t\t\t\t\tclassName=\"resize-none\"\n\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<DialogFooter>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tonOpenChange(false);\n\t\t\t\t\t\t\tresetForm();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\tCancel\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tonClick={handleTransfer}\n\t\t\t\t\t\tdisabled={!selectedMemberId || isPending}\n\t\t\t\t\t>\n\t\t\t\t\t\t{isPending ? (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n\t\t\t\t\t\t\t\tTransferring...\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<ArrowRight className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\tTransfer\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</Button>\n\t\t\t\t</DialogFooter>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n","\"use client\";\n\n/**\n * Voicemail Detail View Component\n *\n * Displays detailed information about a voicemail in the unified inbox.\n * Features:\n * - Prominent audio player\n * - Transcription display with confidence\n * - Duration and timestamp\n * - Mark as read/unread\n * - Quick actions (call back, send text, transfer)\n */\n\nimport {\n\tAlertCircle,\n\tCalendar,\n\tCheck,\n\tClock,\n\tExternalLink,\n\tMail,\n\tMailOpen,\n\tMessageSquare,\n\tPhone,\n\tPhoneForwarded,\n\tUser,\n\tVoicemail,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useState } from \"react\";\nimport { AudioPlayer } from \"@/components/ui/audio-player\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport type { Communication } from \"@/lib/queries/communications\";\nimport { cn } from \"@/lib/utils\";\n\ninterface VoicemailDetailViewProps {\n\tcommunication: Communication;\n\tisRead?: boolean;\n\ttranscriptionConfidence?: number;\n\tisUrgent?: boolean;\n\tonMarkAsRead?: (id: string, read: boolean) => void;\n\tonSendText?: (phone: string) => void;\n\tonCallBack?: (phone: string) => void;\n\tonTransfer?: (communicationId: string) => void;\n\tonDelete?: (id: string) => void;\n}\n\nfunction formatDuration(seconds: number | null | undefined): string {\n\tif (!seconds) return \"0:00\";\n\tconst mins = Math.floor(seconds / 60);\n\tconst secs = seconds % 60;\n\treturn `${mins}:${secs.toString().padStart(2, \"0\")}`;\n}\n\nfunction formatDateTime(dateString: string): string {\n\tconst date = new Date(dateString);\n\treturn date.toLocaleString(\"en-US\", {\n\t\tweekday: \"short\",\n\t\tmonth: \"short\",\n\t\tday: \"numeric\",\n\t\thour: \"numeric\",\n\t\tminute: \"2-digit\",\n\t\thour12: true,\n\t});\n}\n\nfunction formatRelativeTime(dateString: string): string {\n\tconst date = new Date(dateString);\n\tconst now = new Date();\n\tconst diffMs = now.getTime() - date.getTime();\n\tconst diffMins = Math.floor(diffMs / 60000);\n\tconst diffHours = Math.floor(diffMs / 3600000);\n\tconst diffDays = Math.floor(diffMs / 86400000);\n\n\tif (diffMins < 1) return \"Just now\";\n\tif (diffMins < 60) return `${diffMins}m ago`;\n\tif (diffHours < 24) return `${diffHours}h ago`;\n\tif (diffDays < 7) return `${diffDays}d ago`;\n\treturn formatDateTime(dateString);\n}\n\nexport function VoicemailDetailView({\n\tcommunication,\n\tisRead = false,\n\ttranscriptionConfidence,\n\tisUrgent = false,\n\tonMarkAsRead,\n\tonSendText,\n\tonCallBack,\n\tonTransfer,\n\tonDelete,\n}: VoicemailDetailViewProps) {\n\tconst [localIsRead, setLocalIsRead] = useState(isRead);\n\n\tconst phoneNumber = communication.fromAddress;\n\tconst contactName =\n\t\tcommunication.fromName ||\n\t\t(communication.customer?.firstName\n\t\t\t? `${communication.customer.firstName} ${communication.customer.lastName || \"\"}`.trim()\n\t\t\t: null);\n\n\tconst handleToggleRead = () => {\n\t\tconst newReadState = !localIsRead;\n\t\tsetLocalIsRead(newReadState);\n\t\tonMarkAsRead?.(communication.id, newReadState);\n\t};\n\n\treturn (\n\t\t<ScrollArea className=\"h-full\">\n\t\t\t<div className=\"p-6 space-y-6\">\n\t\t\t\t{/* Header */}\n\t\t\t\t<div className=\"flex items-start justify-between\">\n\t\t\t\t\t<div className=\"flex items-start gap-4\">\n\t\t\t\t\t\t<div className=\"flex h-12 w-12 items-center justify-center rounded-full bg-orange-500/10\">\n\t\t\t\t\t\t\t<Voicemail className=\"h-6 w-6 text-orange-500\" />\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<h2 className=\"text-lg font-semibold\">Voicemail</h2>\n\t\t\t\t\t\t\t\t{isUrgent && (\n\t\t\t\t\t\t\t\t\t<Badge variant=\"destructive\" className=\"gap-1\">\n\t\t\t\t\t\t\t\t\t\t<AlertCircle className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\tUrgent\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 mt-1 text-muted-foreground\">\n\t\t\t\t\t\t\t\t<Clock className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t<span className=\"text-sm\">\n\t\t\t\t\t\t\t\t\t{formatRelativeTime(communication.createdAt)}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\tonClick={handleToggleRead}\n\t\t\t\t\t\tclassName=\"gap-2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{localIsRead ? (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<MailOpen className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\tMark Unread\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<Mail className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\tMark Read\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\n\t\t\t\t<Separator />\n\n\t\t\t\t{/* Contact Info */}\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t<h3 className=\"text-sm font-medium text-muted-foreground uppercase tracking-wide\">\n\t\t\t\t\t\tFrom\n\t\t\t\t\t</h3>\n\n\t\t\t\t\t<div className=\"flex items-center gap-4\">\n\t\t\t\t\t\t<div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-muted\">\n\t\t\t\t\t\t\t<User className=\"h-5 w-5 text-muted-foreground\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t{contactName ? (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<div className=\"font-medium\">{contactName}</div>\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t{phoneNumber}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<div className=\"font-medium\">{phoneNumber || \"Unknown Caller\"}</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{communication.customerId && (\n\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\thref={`/dashboard/customers/${communication.customerId}`}\n\t\t\t\t\t\t\t\tclassName=\"text-sm text-primary hover:underline flex items-center gap-1\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tView Profile\n\t\t\t\t\t\t\t\t<ExternalLink className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Audio Player - Prominent */}\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t<h3 className=\"text-sm font-medium text-muted-foreground uppercase tracking-wide\">\n\t\t\t\t\t\tMessage ({formatDuration(communication.callDuration)})\n\t\t\t\t\t</h3>\n\n\t\t\t\t\t{communication.callRecordingUrl ? (\n\t\t\t\t\t\t<AudioPlayer\n\t\t\t\t\t\t\tsrc={communication.callRecordingUrl}\n\t\t\t\t\t\t\ttitle=\"Voicemail Message\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"rounded-lg border border-dashed bg-muted/50 p-6 text-center\">\n\t\t\t\t\t\t\t<Voicemail className=\"h-8 w-8 text-muted-foreground mx-auto mb-2\" />\n\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\tNo audio available\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{/* Transcription */}\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t<h3 className=\"text-sm font-medium text-muted-foreground uppercase tracking-wide\">\n\t\t\t\t\t\t\tTranscription\n\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t{transcriptionConfidence !== undefined && (\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\tConfidence: {Math.round(transcriptionConfidence * 100)}%\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<Progress\n\t\t\t\t\t\t\t\t\tvalue={transcriptionConfidence * 100}\n\t\t\t\t\t\t\t\t\tclassName=\"w-16 h-1.5\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{communication.callTranscript ? (\n\t\t\t\t\t\t<div className=\"rounded-lg border bg-card p-4\">\n\t\t\t\t\t\t\t<p className=\"text-sm whitespace-pre-wrap leading-relaxed\">\n\t\t\t\t\t\t\t\t{communication.callTranscript}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"rounded-lg border border-dashed bg-muted/50 p-4 text-center\">\n\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\tTranscription not available\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t{communication.callRecordingUrl && (\n\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground mt-1\">\n\t\t\t\t\t\t\t\t\tTranscription may still be processing...\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{/* Call Details */}\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t<h3 className=\"text-sm font-medium text-muted-foreground uppercase tracking-wide\">\n\t\t\t\t\t\tDetails\n\t\t\t\t\t</h3>\n\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Clock className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div className=\"text-sm text-muted-foreground\">Duration</div>\n\t\t\t\t\t\t\t\t<div className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t{formatDuration(communication.callDuration)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Calendar className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div className=\"text-sm text-muted-foreground\">Received</div>\n\t\t\t\t\t\t\t\t<div className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t{formatDateTime(communication.createdAt)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Quick Actions */}\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t<h3 className=\"text-sm font-medium text-muted-foreground uppercase tracking-wide\">\n\t\t\t\t\t\tActions\n\t\t\t\t\t</h3>\n\n\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\n\t\t\t\t\t\t{phoneNumber && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"default\"\n\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\tonClick={() => onCallBack?.(phoneNumber)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Phone className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\tCall Back\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\tonClick={() => onSendText?.(phoneNumber)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<MessageSquare className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\tSend Text\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tonClick={() => onTransfer?.(communication.id)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<PhoneForwarded className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\tTransfer\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Status indicator */}\n\t\t\t\t<div className=\"pt-2\">\n\t\t\t\t\t<div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n\t\t\t\t\t\t{localIsRead ? (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<Check className=\"h-3 w-3 text-green-500\" />\n\t\t\t\t\t\t\t\tMarked as read\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<div className=\"h-2 w-2 rounded-full bg-blue-500\" />\n\t\t\t\t\t\t\t\tUnread\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</ScrollArea>\n\t);\n}\n"],"names":[],"mappings":"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"}