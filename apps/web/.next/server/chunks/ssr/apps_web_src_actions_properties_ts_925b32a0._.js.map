{"version":3,"sources":["../../../../../../apps/web/src/actions/properties.ts"],"sourcesContent":["/**\n * Property Management Server Actions\n *\n * Property/location management for customers with:\n * - Property CRUD operations\n * - Multiple properties per customer\n * - Property type classification\n * - Equipment tracking per property\n * - Job history per property\n */\n\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { z } from \"zod\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport {\n\tActionError,\n\tERROR_CODES,\n\tERROR_MESSAGES,\n} from \"@/lib/errors/action-error\";\nimport {\n\ttype ActionResult,\n\tassertAuthenticated,\n\tassertExists,\n\twithErrorHandling,\n} from \"@/lib/errors/with-error-handling\";\nimport { geocodeAddressSilent } from \"@/lib/services/geocoding\";\nimport { createClient } from \"@/lib/supabase/server\";\n\n// ============================================================================\n// VALIDATION SCHEMAS\n// ============================================================================\n\nconst propertySchema = z.object({\n\tcustomerId: z.string().uuid(\"Customer is required\"),\n\tname: z.string().min(1, \"Property name is required\").max(200),\n\taddress: z.string().min(1, \"Address is required\").max(200),\n\taddress2: z.string().max(100).optional(),\n\tcity: z.string().min(1, \"City is required\").max(100),\n\tstate: z.string().min(1, \"State is required\").max(50),\n\tzipCode: z.string().min(1, \"ZIP code is required\").max(20),\n\tcountry: z.string().max(50).default(\"USA\"),\n\tpropertyType: z.enum([\"residential\", \"commercial\", \"industrial\"]).optional(),\n\tsquareFootage: z.number().int().min(0).optional(),\n\tyearBuilt: z\n\t\t.number()\n\t\t.int()\n\t\t.min(1800)\n\t\t.max(new Date().getFullYear() + 5)\n\t\t.optional(),\n\tnotes: z.string().optional(),\n\tlat: z.number().optional(), // Coordinates from Google Places (if available)\n\tlon: z.number().optional(),\n});\n\n// ============================================================================\n// PROPERTY CRUD OPERATIONS\n// ============================================================================\n\n/**\n * Find existing property or create new one for customer\n * Prevents duplicate properties for the same address\n */\nexport async function findOrCreateProperty(\n\tformData: FormData,\n): Promise<ActionResult<string>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\t// Get active company ID\n\t\tconst activeCompanyId = await getActiveCompanyId();\n\t\tif (!activeCompanyId) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"You must be part of a company\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Validate input\n\t\tconst data = propertySchema.parse({\n\t\t\tcustomerId: formData.get(\"customerId\"),\n\t\t\tname: formData.get(\"name\"),\n\t\t\taddress: formData.get(\"address\"),\n\t\t\taddress2: formData.get(\"address2\") || undefined,\n\t\t\tcity: formData.get(\"city\"),\n\t\t\tstate: formData.get(\"state\"),\n\t\t\tzipCode: formData.get(\"zipCode\"),\n\t\t\tcountry: formData.get(\"country\") || \"USA\",\n\t\t\tpropertyType: formData.get(\"propertyType\") || undefined,\n\t\t\tsquareFootage: formData.get(\"squareFootage\")\n\t\t\t\t? Number(formData.get(\"squareFootage\"))\n\t\t\t\t: undefined,\n\t\t\tyearBuilt: formData.get(\"yearBuilt\")\n\t\t\t\t? Number(formData.get(\"yearBuilt\"))\n\t\t\t\t: undefined,\n\t\t\tnotes: formData.get(\"notes\") || undefined,\n\t\t\tlat: formData.get(\"lat\") ? Number(formData.get(\"lat\")) : undefined,\n\t\t\tlon: formData.get(\"lon\") ? Number(formData.get(\"lon\")) : undefined,\n\t\t});\n\n\t\t// Verify customer exists and belongs to company\n\t\tconst { data: customer } = await supabase\n\t\t\t.from(\"customers\")\n\t\t\t.select(\"id, company_id\")\n\t\t\t.eq(\"id\", data.customerId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.single();\n\n\t\tassertExists(customer, \"Customer\");\n\n\t\tif (customer.company_id !== activeCompanyId) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Customer not found\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Check if property already exists for this customer with the same address\n\t\tconst { data: existingProperty } = await supabase\n\t\t\t.from(\"properties\")\n\t\t\t.select(\"id\")\n\t\t\t.eq(\"customer_id\", data.customerId)\n\t\t\t.eq(\"address\", data.address)\n\t\t\t.eq(\"city\", data.city)\n\t\t\t.eq(\"state\", data.state)\n\t\t\t.eq(\"zip_code\", data.zipCode)\n\t\t\t.eq(\"company_id\", activeCompanyId)\n\t\t\t.maybeSingle();\n\n\t\t// If property exists, return its ID\n\t\tif (existingProperty) {\n\t\t\treturn existingProperty.id;\n\t\t}\n\n\t\t// Use coordinates from Google Places if provided, otherwise geocode in background\n\t\tconst _fullAddress = `${data.address}, ${data.city}, ${data.state} ${data.zipCode}`;\n\n\t\t// Create property immediately\n\t\tconst insertData: Record<string, any> = {\n\t\t\tcompany_id: activeCompanyId,\n\t\t\tcustomer_id: data.customerId,\n\t\t\tname: data.name,\n\t\t\taddress: data.address,\n\t\t\tcity: data.city,\n\t\t\tstate: data.state,\n\t\t\tzip_code: data.zipCode,\n\t\t\tcountry: data.country,\n\t\t\tnotes: data.notes,\n\t\t};\n\n\t\t// Only include optional fields if they have values\n\t\tif (data.address2) {\n\t\t\tinsertData.address2 = data.address2;\n\t\t}\n\t\tif (data.squareFootage) {\n\t\t\tinsertData.square_footage = data.squareFootage;\n\t\t}\n\t\tif (data.yearBuilt) {\n\t\t\tinsertData.year_built = data.yearBuilt;\n\t\t}\n\n\t\t// If coordinates provided from Google Places, save them immediately\n\t\tif (data.lat && data.lon) {\n\t\t\tinsertData.lat = data.lat;\n\t\t\tinsertData.lon = data.lon;\n\t\t}\n\n\t\tconst { data: property, error: createError } = await supabase\n\t\t\t.from(\"properties\")\n\t\t\t.insert(insertData)\n\t\t\t.select(\"id\")\n\t\t\t.single();\n\n\t\t// Only geocode in background if coordinates weren't provided\n\t\tif (property?.id && !data.lat && !data.lon) {\n\t\t\t// Fire and forget - don't wait for this\n\t\t\tgeocodeAddressSilent(\n\t\t\t\tdata.address,\n\t\t\t\tdata.city,\n\t\t\t\tdata.state,\n\t\t\t\tdata.zipCode,\n\t\t\t\tdata.country,\n\t\t\t)\n\t\t\t\t.then((geocoded) => {\n\t\t\t\t\tif (geocoded) {\n\t\t\t\t\t\t// Update property with coordinates\n\t\t\t\t\t\tsupabase\n\t\t\t\t\t\t\t.from(\"properties\")\n\t\t\t\t\t\t\t.update({\n\t\t\t\t\t\t\t\tlat: geocoded.lat,\n\t\t\t\t\t\t\t\tlon: geocoded.lon,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.eq(\"id\", property.id);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t// Intentionally ignoring geocoding errors - best effort operation\n\t\t\t\t.catch((_error) => {\n\t\t\t\t\t// Geocoding is optional\n\t\t\t\t});\n\t\t}\n\n\t\tif (createError) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"create property\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tassertExists(property, \"Property\");\n\n\t\trevalidatePath(\"/dashboard/customers\");\n\t\trevalidatePath(`/dashboard/customers/${data.customerId}`);\n\n\t\treturn property.id;\n\t});\n}\n\n/**\n * Create a new property for a customer\n */\nasync function createProperty(\n\tformData: FormData,\n): Promise<ActionResult<string>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst { data: teamMember } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\"company_id\")\n\t\t\t.eq(\"user_id\", user.id)\n\t\t\t.single();\n\n\t\tif (!teamMember?.company_id) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"You must be part of a company\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Validate input\n\t\tconst data = propertySchema.parse({\n\t\t\tcustomerId: formData.get(\"customerId\"),\n\t\t\tname: formData.get(\"name\"),\n\t\t\taddress: formData.get(\"address\"),\n\t\t\taddress2: formData.get(\"address2\") || undefined,\n\t\t\tcity: formData.get(\"city\"),\n\t\t\tstate: formData.get(\"state\"),\n\t\t\tzipCode: formData.get(\"zipCode\"),\n\t\t\tcountry: formData.get(\"country\") || \"USA\",\n\t\t\tpropertyType: formData.get(\"propertyType\") || undefined,\n\t\t\tsquareFootage: formData.get(\"squareFootage\")\n\t\t\t\t? Number(formData.get(\"squareFootage\"))\n\t\t\t\t: undefined,\n\t\t\tyearBuilt: formData.get(\"yearBuilt\")\n\t\t\t\t? Number(formData.get(\"yearBuilt\"))\n\t\t\t\t: undefined,\n\t\t\tnotes: formData.get(\"notes\") || undefined,\n\t\t});\n\n\t\t// Verify customer exists and belongs to company\n\t\tconst { data: customer } = await supabase\n\t\t\t.from(\"customers\")\n\t\t\t.select(\"id, company_id\")\n\t\t\t.eq(\"id\", data.customerId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.single();\n\n\t\tassertExists(customer, \"Customer\");\n\n\t\tif (customer.company_id !== teamMember.company_id) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Customer not found\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Geocode property address\n\t\tlet propertyLat: number | null = null;\n\t\tlet propertyLon: number | null = null;\n\n\t\tconst geocodeResult = await geocodeAddressSilent(\n\t\t\tdata.address,\n\t\t\tdata.city,\n\t\t\tdata.state,\n\t\t\tdata.zipCode,\n\t\t\tdata.country,\n\t\t);\n\n\t\tif (geocodeResult) {\n\t\t\tpropertyLat = geocodeResult.lat;\n\t\t\tpropertyLon = geocodeResult.lon;\n\t\t}\n\n\t\t// Create property\n\t\tconst { data: property, error: createError } = await supabase\n\t\t\t.from(\"properties\")\n\t\t\t.insert({\n\t\t\t\tcompany_id: teamMember.company_id,\n\t\t\t\tcustomer_id: data.customerId,\n\t\t\t\tname: data.name,\n\t\t\t\taddress: data.address,\n\t\t\t\taddress2: data.address2,\n\t\t\t\tcity: data.city,\n\t\t\t\tstate: data.state,\n\t\t\t\tzip_code: data.zipCode,\n\t\t\t\tcountry: data.country,\n\t\t\t\tproperty_type: data.propertyType,\n\t\t\t\tsquare_footage: data.squareFootage,\n\t\t\t\tyear_built: data.yearBuilt,\n\t\t\t\tnotes: data.notes,\n\t\t\t\tlat: propertyLat,\n\t\t\t\tlon: propertyLon,\n\t\t\t})\n\t\t\t.select(\"id\")\n\t\t\t.single();\n\n\t\tif (createError) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"create property\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t\t400,\n\t\t\t\t{\n\t\t\t\t\tdbError: createError.message,\n\t\t\t\t\tcode: createError.code,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/customers\");\n\t\trevalidatePath(`/dashboard/customers/${data.customerId}`);\n\t\treturn property.id;\n\t});\n}\n\n/**\n * Update existing property\n */\nexport async function _updateProperty(\n\tpropertyId: string,\n\tformData: FormData,\n): Promise<ActionResult<void>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst { data: teamMember } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\"company_id\")\n\t\t\t.eq(\"user_id\", user.id)\n\t\t\t.single();\n\n\t\tif (!teamMember?.company_id) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"You must be part of a company\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Verify property exists and belongs to company\n\t\tconst { data: property } = await supabase\n\t\t\t.from(\"properties\")\n\t\t\t.select(\"id, company_id, customer_id\")\n\t\t\t.eq(\"id\", propertyId)\n\t\t\t.single();\n\n\t\tassertExists(property, \"Property\");\n\n\t\tif (property.company_id !== teamMember.company_id) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Property not found\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Validate input\n\t\tconst data = propertySchema.parse({\n\t\t\tcustomerId: property.customer_id, // Keep existing customer\n\t\t\tname: formData.get(\"name\"),\n\t\t\taddress: formData.get(\"address\"),\n\t\t\taddress2: formData.get(\"address2\") || undefined,\n\t\t\tcity: formData.get(\"city\"),\n\t\t\tstate: formData.get(\"state\"),\n\t\t\tzipCode: formData.get(\"zipCode\"),\n\t\t\tcountry: formData.get(\"country\") || \"USA\",\n\t\t\tpropertyType: formData.get(\"propertyType\") || undefined,\n\t\t\tsquareFootage: formData.get(\"squareFootage\")\n\t\t\t\t? Number(formData.get(\"squareFootage\"))\n\t\t\t\t: undefined,\n\t\t\tyearBuilt: formData.get(\"yearBuilt\")\n\t\t\t\t? Number(formData.get(\"yearBuilt\"))\n\t\t\t\t: undefined,\n\t\t\tnotes: formData.get(\"notes\") || undefined,\n\t\t});\n\n\t\t// Update property\n\t\tconst { error: updateError } = await supabase\n\t\t\t.from(\"properties\")\n\t\t\t.update({\n\t\t\t\tname: data.name,\n\t\t\t\taddress: data.address,\n\t\t\t\taddress2: data.address2,\n\t\t\t\tcity: data.city,\n\t\t\t\tstate: data.state,\n\t\t\t\tzip_code: data.zipCode,\n\t\t\t\tcountry: data.country,\n\t\t\t\tproperty_type: data.propertyType,\n\t\t\t\tsquare_footage: data.squareFootage,\n\t\t\t\tyear_built: data.yearBuilt,\n\t\t\t\tnotes: data.notes,\n\t\t\t})\n\t\t\t.eq(\"id\", propertyId);\n\n\t\tif (updateError) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"update property\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/customers\");\n\t\trevalidatePath(`/dashboard/customers/${property.customer_id}`);\n\t});\n}\n\n/**\n * Archive property (soft delete)\n * Only allowed if no equipment or jobs are associated\n *\n * Archives instead of permanently deleting. Can be restored within 90 days.\n */\nexport async function archiveProperty(\n\tpropertyId: string,\n): Promise<ActionResult<void>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst { data: teamMember } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\"company_id\")\n\t\t\t.eq(\"user_id\", user.id)\n\t\t\t.single();\n\n\t\tif (!teamMember?.company_id) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"You must be part of a company\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Verify property exists and belongs to company\n\t\tconst { data: property } = await supabase\n\t\t\t.from(\"properties\")\n\t\t\t.select(\"id, company_id, customer_id\")\n\t\t\t.eq(\"id\", propertyId)\n\t\t\t.single();\n\n\t\tassertExists(property, \"Property\");\n\n\t\tif (property.company_id !== teamMember.company_id) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Property not found\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Check if property has equipment\n\t\tconst { data: equipment } = await supabase\n\t\t\t.from(\"equipment\")\n\t\t\t.select(\"id\")\n\t\t\t.eq(\"property_id\", propertyId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.limit(1);\n\n\t\tif (equipment && equipment.length > 0) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Cannot archive property with equipment. Remove or reassign equipment first.\",\n\t\t\t\tERROR_CODES.BUSINESS_RULE_VIOLATION,\n\t\t\t);\n\t\t}\n\n\t\t// Check if property has jobs\n\t\tconst { data: jobs } = await supabase\n\t\t\t.from(\"jobs\")\n\t\t\t.select(\"id\")\n\t\t\t.eq(\"property_id\", propertyId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.limit(1);\n\n\t\tif (jobs && jobs.length > 0) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Cannot archive property with job history.\",\n\t\t\t\tERROR_CODES.BUSINESS_RULE_VIOLATION,\n\t\t\t);\n\t\t}\n\n\t\t// Archive property (soft delete)\n\t\tconst now = new Date().toISOString();\n\t\tconst scheduledDeletion = new Date(\n\t\t\tDate.now() + 90 * 24 * 60 * 60 * 1000,\n\t\t).toISOString();\n\n\t\tconst { error: archiveError } = await supabase\n\t\t\t.from(\"properties\")\n\t\t\t.update({\n\t\t\t\tdeleted_at: now,\n\t\t\t\tdeleted_by: user.id,\n\t\t\t\tarchived_at: now,\n\t\t\t\tpermanent_delete_scheduled_at: scheduledDeletion,\n\t\t\t})\n\t\t\t.eq(\"id\", propertyId);\n\n\t\tif (archiveError) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"archive property\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/customers\");\n\t\trevalidatePath(`/dashboard/customers/${property.customer_id}`);\n\t\trevalidatePath(\"/dashboard/settings/archive\");\n\t});\n}\n\n/**\n * Restore archived property\n */\nasync function _restoreProperty(\n\tpropertyId: string,\n): Promise<ActionResult<void>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst { data: teamMember } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\"company_id\")\n\t\t\t.eq(\"user_id\", user.id)\n\t\t\t.single();\n\n\t\tif (!teamMember?.company_id) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"You must be part of a company\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Verify property belongs to company and is archived\n\t\tconst { data: property } = await supabase\n\t\t\t.from(\"properties\")\n\t\t\t.select(\"id, company_id, customer_id, deleted_at\")\n\t\t\t.eq(\"id\", propertyId)\n\t\t\t.single();\n\n\t\tassertExists(property, \"Property\");\n\n\t\tif (property.company_id !== teamMember.company_id) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Property not found\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\tif (!property.deleted_at) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Property is not archived\",\n\t\t\t\tERROR_CODES.OPERATION_NOT_ALLOWED,\n\t\t\t);\n\t\t}\n\n\t\t// Restore property\n\t\tconst { error: restoreError } = await supabase\n\t\t\t.from(\"properties\")\n\t\t\t.update({\n\t\t\t\tdeleted_at: null,\n\t\t\t\tdeleted_by: null,\n\t\t\t\tarchived_at: null,\n\t\t\t\tpermanent_delete_scheduled_at: null,\n\t\t\t})\n\t\t\t.eq(\"id\", propertyId);\n\n\t\tif (restoreError) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"restore property\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/customers\");\n\t\trevalidatePath(`/dashboard/customers/${property.customer_id}`);\n\t\trevalidatePath(\"/dashboard/settings/archive\");\n\t});\n}\n\n/**\n * Delete property (legacy - deprecated)\n * @deprecated Use archiveProperty() instead\n */\nasync function _deleteProperty(\n\tpropertyId: string,\n): Promise<ActionResult<void>> {\n\treturn archiveProperty(propertyId);\n}\n\n// ============================================================================\n// PROPERTY QUERIES\n// ============================================================================\n\n/**\n * Get all properties for a customer\n */\nasync function _getCustomerProperties(\n\tcustomerId: string,\n): Promise<ActionResult<any[]>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst { data: teamMember } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\"company_id\")\n\t\t\t.eq(\"user_id\", user.id)\n\t\t\t.single();\n\n\t\tif (!teamMember?.company_id) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"You must be part of a company\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Verify customer exists and belongs to company\n\t\tconst { data: customer } = await supabase\n\t\t\t.from(\"customers\")\n\t\t\t.select(\"id, company_id\")\n\t\t\t.eq(\"id\", customerId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.single();\n\n\t\tassertExists(customer, \"Customer\");\n\n\t\tif (customer.company_id !== teamMember.company_id) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Customer not found\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Get all properties for customer\n\t\tconst { data: properties, error } = await supabase\n\t\t\t.from(\"properties\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.order(\"created_at\", { ascending: false });\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"fetch properties\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\treturn properties || [];\n\t});\n}\n\n/**\n * Get property with equipment count\n */\nasync function _getPropertyWithDetails(\n\tpropertyId: string,\n): Promise<ActionResult<any>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst { data: teamMember } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\"company_id\")\n\t\t\t.eq(\"user_id\", user.id)\n\t\t\t.single();\n\n\t\tif (!teamMember?.company_id) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"You must be part of a company\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Get property\n\t\tconst { data: property, error: propertyError } = await supabase\n\t\t\t.from(\"properties\")\n\t\t\t.select(\n\t\t\t\t`\n        *,\n        customer:customers(id, display_name, email, phone)\n      `,\n\t\t\t)\n\t\t\t.eq(\"id\", propertyId)\n\t\t\t.single();\n\n\t\tif (propertyError) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"fetch property\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tassertExists(property, \"Property\");\n\n\t\tif (property.company_id !== teamMember.company_id) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Property not found\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Get equipment count (head: true prevents data transfer)\n\t\tconst { count: equipmentCount } = await supabase\n\t\t\t.from(\"equipment\")\n\t\t\t.select(\"id\", { count: \"exact\", head: true })\n\t\t\t.eq(\"property_id\", propertyId)\n\t\t\t.is(\"deleted_at\", null);\n\n\t\t// Get job count (head: true prevents data transfer)\n\t\tconst { count: jobCount } = await supabase\n\t\t\t.from(\"jobs\")\n\t\t\t.select(\"id\", { count: \"exact\", head: true })\n\t\t\t.eq(\"property_id\", propertyId);\n\n\t\treturn {\n\t\t\t...property,\n\t\t\tequipmentCount: equipmentCount || 0,\n\t\t\tjobCount: jobCount || 0,\n\t\t};\n\t});\n}\n\n/**\n * Set property as primary for customer\n * This is useful when a customer has multiple properties\n */\nasync function _setPrimaryProperty(\n\tcustomerId: string,\n\tpropertyId: string,\n): Promise<ActionResult<void>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst { data: teamMember } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\"company_id\")\n\t\t\t.eq(\"user_id\", user.id)\n\t\t\t.single();\n\n\t\tif (!teamMember?.company_id) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"You must be part of a company\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Verify customer exists and belongs to company\n\t\tconst { data: customer } = await supabase\n\t\t\t.from(\"customers\")\n\t\t\t.select(\"id, company_id, address, city, state, zip_code\")\n\t\t\t.eq(\"id\", customerId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.single();\n\n\t\tassertExists(customer, \"Customer\");\n\n\t\tif (customer.company_id !== teamMember.company_id) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Customer not found\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\t403,\n\t\t\t);\n\t\t}\n\n\t\t// Verify property exists and belongs to customer\n\t\tconst { data: property } = await supabase\n\t\t\t.from(\"properties\")\n\t\t\t.select(\"id, customer_id, address, city, state, zip_code\")\n\t\t\t.eq(\"id\", propertyId)\n\t\t\t.single();\n\n\t\tassertExists(property, \"Property\");\n\n\t\tif (property.customer_id !== customerId) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Property does not belong to this customer\",\n\t\t\t\tERROR_CODES.BUSINESS_RULE_VIOLATION,\n\t\t\t);\n\t\t}\n\n\t\t// Update customer's primary address to match this property\n\t\tconst { error: updateError } = await supabase\n\t\t\t.from(\"customers\")\n\t\t\t.update({\n\t\t\t\taddress: property.address,\n\t\t\t\tcity: property.city,\n\t\t\t\tstate: property.state,\n\t\t\t\tzip_code: property.zip_code,\n\t\t\t})\n\t\t\t.eq(\"id\", customerId);\n\n\t\tif (updateError) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"set primary property\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(`/dashboard/customers/${customerId}`);\n\t});\n}\n// Alias for backward compatibility\n"],"names":[],"mappings":"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"}