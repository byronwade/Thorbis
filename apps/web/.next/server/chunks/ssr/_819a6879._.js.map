{"version":3,"sources":["../../../../../../apps/web/src/lib/communication/sms-service.ts","../../../../../../apps/web/src/actions/sms-actions.ts","../../../../../../apps/web/src/lib/payments/payment-tokens.ts","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/constants.js","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/constructFrom.js","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/toDate.js","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/locale/en-US/_lib/formatDistance.js","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/locale/_lib/buildFormatLongFn.js","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/locale/en-US/_lib/formatLong.js","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/locale/en-US/_lib/formatRelative.js","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/locale/_lib/buildLocalizeFn.js","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/locale/en-US/_lib/localize.js","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/locale/_lib/buildMatchFn.js","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/locale/_lib/buildMatchPatternFn.js","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/locale/en-US/_lib/match.js","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/locale/en-US.js","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/_lib/defaultOptions.js","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/_lib/getTimezoneOffsetInMilliseconds.js","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/_lib/normalizeDates.js","../../../../../../apps/web/src/actions/settings/invoice-email-template.ts","../../../../../../apps/web/src/lib/email/bulk-email-sender.ts","../../../../../../apps/web/src/actions/bulk-communications.ts","../../../../../../apps/web/src/actions/bulk-archive.ts","../../../../../../apps/web/.next-internal/server/app/%28dashboard%29/dashboard/work/invoices/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["/**\n * SMS Service\n * \n * Handles fetching and managing SMS messages from the communications table\n * Similar structure to email-service.ts but for SMS type communications\n */\n\nimport { createClient } from \"@/lib/supabase/server\";\nimport type { TypedSupabaseClient } from \"@/types/supabase\";\n\nexport type CompanySms = {\n\tid: string;\n\tfrom_address: string | null;\n\tfrom_name: string | null;\n\tto_address: string | null;\n\tbody: string;\n\tbody_html: string | null;\n\tcreated_at: string;\n\tread_at: string | null;\n\tdirection: \"inbound\" | \"outbound\";\n\tcustomer_id: string | null;\n\tcustomer?: {\n\t\tid: string;\n\t\tfirst_name: string | null;\n\t\tlast_name: string | null;\n\t\tdisplay_name: string | null;\n\t\temail: string | null;\n\t\tphone: string | null;\n\t\tcompany_name: string | null;\n\t} | null;\n\tsent_at: string | null;\n\tdelivered_at: string | null;\n\tstatus: string;\n\tchannel: string | null;\n\tprovider_metadata: Record<string, unknown> | null;\n\tis_archived: boolean;\n\tsnoozed_until: string | null;\n\tcategory: string | null;\n\ttags: string[] | null;\n\ttelnyx_message_id: string | null;\n};\n\nexport type GetCompanySmsInput = {\n\tlimit?: number;\n\toffset?: number;\n\ttype?: \"sent\" | \"received\" | \"all\";\n\tfolder?: \"inbox\" | \"sent\" | \"archive\" | \"trash\" | \"bin\";\n\tlabel?: string;\n\tsearch?: string | null;\n\tsortBy?: \"created_at\" | \"sent_at\";\n\tsortOrder?: \"asc\" | \"desc\";\n};\n\nexport type GetCompanySmsResult = {\n\tsms: CompanySms[];\n\ttotal: number;\n\thasMore: boolean;\n};\n\nexport async function getCompanySms(\n\tcompanyId: string,\n\tinput: GetCompanySmsInput = {},\n): Promise<GetCompanySmsResult> {\n\tconst supabase = await createClient();\n\n\tif (!supabase) {\n\t\treturn { sms: [], total: 0, hasMore: false };\n\t}\n\n\tconst {\n\t\tlimit = 50,\n\t\toffset = 0,\n\t\ttype = \"all\",\n\t\tfolder,\n\t\tlabel,\n\t\tsearch,\n\t\tsortBy = \"created_at\",\n\t\tsortOrder = \"desc\",\n\t} = input;\n\n\t// Build the query - get all SMS messages\n\tlet query = supabase\n\t\t.from(\"communications\")\n\t\t.select(\n\t\t\t`\n\t\t\tid,\n\t\t\tfrom_address,\n\t\t\tfrom_name,\n\t\t\tto_address,\n\t\t\tbody,\n\t\t\tbody_html,\n\t\t\tcreated_at,\n\t\t\tread_at,\n\t\t\tdirection,\n\t\t\tcustomer_id,\n\t\t\tcustomer:customers!left(id, first_name, last_name, display_name, email, phone, company_name),\n\t\t\tsent_at,\n\t\t\tdelivered_at,\n\t\t\tstatus,\n\t\t\tchannel,\n\t\t\tprovider_metadata,\n\t\t\tis_archived,\n\t\t\tsnoozed_until,\n\t\t\tcategory,\n\t\t\ttags,\n\t\t\ttelnyx_message_id\n\t\t`,\n\t\t\t{ count: \"exact\" },\n\t\t)\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"type\", \"sms\");\n\n\t// Apply folder filtering\n\tif (folder) {\n\t\tswitch (folder) {\n\t\t\tcase \"inbox\":\n\t\t\t\t// Inbox: inbound, not archived, not deleted, not snoozed (or snooze expired)\n\t\t\t\tquery = query\n\t\t\t\t\t.eq(\"direction\", \"inbound\")\n\t\t\t\t\t.eq(\"is_archived\", false)\n\t\t\t\t\t.is(\"deleted_at\", null)\n\t\t\t\t\t.or(\"snoozed_until.is.null,snoozed_until.lt.now()\");\n\t\t\t\tbreak;\n\t\t\tcase \"sent\":\n\t\t\t\t// Sent: outbound, not archived, not deleted\n\t\t\t\tquery = query\n\t\t\t\t\t.eq(\"direction\", \"outbound\")\n\t\t\t\t\t.eq(\"is_archived\", false)\n\t\t\t\t\t.is(\"deleted_at\", null);\n\t\t\t\tbreak;\n\t\t\tcase \"archive\":\n\t\t\t\t// Archive: is_archived = true, not deleted\n\t\t\t\tquery = query.eq(\"is_archived\", true).is(\"deleted_at\", null);\n\t\t\t\tbreak;\n\t\t\tcase \"trash\":\n\t\t\tcase \"bin\":\n\t\t\t\t// Trash: deleted_at is not null\n\t\t\t\tquery = query.not(\"deleted_at\", \"is\", null);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\t// Custom folder or label filtering - done in memory after fetch\n\t\t\t\t// (JSONB array containment not supported by PostgREST cs operator)\n\t\t\t\tquery = query.is(\"deleted_at\", null);\n\t\t\t\tbreak;\n\t\t}\n\t} else {\n\t\t// Default: exclude deleted SMS\n\t\tquery = query.is(\"deleted_at\", null);\n\t}\n\n\t// Apply direction filter\n\tif (type === \"sent\") {\n\t\tquery = query.eq(\"direction\", \"outbound\");\n\t} else if (type === \"received\") {\n\t\tquery = query.eq(\"direction\", \"inbound\");\n\t}\n\n\t// Apply search filter\n\tif (search) {\n\t\tconst searchLower = search.toLowerCase();\n\t\tquery = query.or(\n\t\t\t`from_address.ilike.%${searchLower}%,to_address.ilike.%${searchLower}%,body.ilike.%${searchLower}%`,\n\t\t);\n\t}\n\n\t// Apply sorting\n\tconst ascending = sortOrder === \"asc\";\n\tif (sortBy === \"sent_at\") {\n\t\tquery = query.order(\"sent_at\", { ascending, nullsFirst: false });\n\t} else {\n\t\tquery = query.order(\"created_at\", { ascending });\n\t}\n\n\t// Apply pagination\n\tquery = query.range(offset, offset + limit - 1);\n\n\tconst { data, error, count } = await query;\n\n\tif (error) {\n\t\tconsole.error(\"Error fetching SMS messages:\", error);\n\t\treturn { sms: [], total: 0, hasMore: false };\n\t}\n\n\tlet sms = (data || []).map((msg) => ({\n\t\t...msg,\n\t\ttags: (msg.tags as string[]) || null,\n\t\tprovider_metadata: (msg.provider_metadata as Record<string, unknown>) || null,\n\t})) as CompanySms[];\n\n\t// Post-process custom folder/label filtering (JSONB array containment not supported by PostgREST)\n\tconst standardFolders = [\"inbox\", \"sent\", \"archive\", \"trash\", \"bin\"];\n\tconst folderName = label || folder;\n\tif (folderName && !standardFolders.includes(folderName)) {\n\t\tsms = sms.filter((msg) => {\n\t\t\tconst msgTags = msg.tags || [];\n\t\t\treturn Array.isArray(msgTags) && msgTags.includes(folderName);\n\t\t});\n\t\treturn {\n\t\t\tsms,\n\t\t\ttotal: sms.length,\n\t\t\thasMore: false,\n\t\t};\n\t}\n\n\tconst total = count || 0;\n\tconst hasMore = offset + sms.length < total;\n\n\treturn {\n\t\tsms,\n\t\ttotal,\n\t\thasMore,\n\t};\n}\n\nexport async function getSmsById(\n\tcompanyId: string,\n\tsmsId: string,\n): Promise<CompanySms | null> {\n\tconst supabase = await createClient();\n\n\tif (!supabase) {\n\t\treturn null;\n\t}\n\n\tconst { data, error } = await supabase\n\t\t.from(\"communications\")\n\t\t.select(\n\t\t\t`\n\t\t\tid,\n\t\t\tfrom_address,\n\t\t\tfrom_name,\n\t\t\tto_address,\n\t\t\tbody,\n\t\t\tbody_html,\n\t\t\tcreated_at,\n\t\t\tread_at,\n\t\t\tdirection,\n\t\t\tcustomer_id,\n\t\t\tcustomer:customers!left(id, first_name, last_name, display_name, email, phone, company_name),\n\t\t\tsent_at,\n\t\t\tdelivered_at,\n\t\t\tstatus,\n\t\t\tchannel,\n\t\t\tprovider_metadata,\n\t\t\tis_archived,\n\t\t\tsnoozed_until,\n\t\t\tcategory,\n\t\t\ttags,\n\t\t\ttelnyx_message_id\n\t\t`,\n\t\t)\n\t\t.eq(\"id\", smsId)\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"type\", \"sms\")\n\t\t.single();\n\n\tif (error || !data) {\n\t\treturn null;\n\t}\n\n\treturn {\n\t\t...data,\n\t\ttags: (data.tags as string[]) || null,\n\t\tprovider_metadata: (data.provider_metadata as Record<string, unknown>) || null,\n\t} as CompanySms;\n}\n\nexport async function markSmsAsRead(\n\tcompanyId: string,\n\tsmsId: string,\n): Promise<boolean> {\n\tconst supabase = await createClient();\n\n\tif (!supabase) {\n\t\tconsole.error(\"❌ markSmsAsRead: Missing supabase\");\n\t\treturn false;\n\t}\n\n\tconst readAt = new Date().toISOString();\n\tconst { data, error } = await supabase\n\t\t.from(\"communications\")\n\t\t.update({ read_at: readAt })\n\t\t.eq(\"id\", smsId)\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"type\", \"sms\")\n\t\t.select(\"id, read_at\")\n\t\t.single();\n\n\tif (error) {\n\t\tconsole.error(\"❌ markSmsAsRead error:\", error);\n\t\treturn false;\n\t}\n\n\tif (!data) {\n\t\tconsole.error(\"❌ markSmsAsRead: No data returned\");\n\t\treturn false;\n\t}\n\n\tconsole.log(\"✅ markSmsAsRead success:\", { smsId, read_at: data.read_at });\n\treturn true;\n}\n\n/**\n * Get all SMS messages for a conversation thread (by phone number)\n */\nexport async function getSmsConversation(\n\tcompanyId: string,\n\tphoneNumber: string,\n): Promise<CompanySms[]> {\n\tconst supabase = await createClient();\n\n\tif (!supabase) {\n\t\treturn [];\n\t}\n\n\t// Normalize phone number for matching\n\tconst normalizePhone = (phone: string) => {\n\t\tconst digits = phone.replace(/[^0-9]/g, \"\");\n\t\tif (digits.length === 11 && digits.startsWith(\"1\")) {\n\t\t\treturn `+${digits}`;\n\t\t}\n\t\tif (digits.length === 10) {\n\t\t\treturn `+1${digits}`;\n\t\t}\n\t\treturn phone.startsWith(\"+\") ? phone : `+${phone}`;\n\t};\n\n\tconst normalizedPhone = normalizePhone(phoneNumber);\n\n\t// Fetch all messages where this phone number is either from or to\n\tconst { data, error } = await supabase\n\t\t.from(\"communications\")\n\t\t.select(\n\t\t\t`\n\t\t\tid,\n\t\t\tfrom_address,\n\t\t\tfrom_name,\n\t\t\tto_address,\n\t\t\tbody,\n\t\t\tbody_html,\n\t\t\tcreated_at,\n\t\t\tread_at,\n\t\t\tdirection,\n\t\t\tcustomer_id,\n\t\t\tcustomer:customers!left(id, first_name, last_name, display_name, email, phone, company_name),\n\t\t\tsent_at,\n\t\t\tdelivered_at,\n\t\t\tstatus,\n\t\t\tchannel,\n\t\t\tprovider_metadata,\n\t\t\tis_archived,\n\t\t\tsnoozed_until,\n\t\t\tcategory,\n\t\t\ttags,\n\t\t\ttelnyx_message_id\n\t\t`,\n\t\t)\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"type\", \"sms\")\n\t\t.is(\"deleted_at\", null)\n\t\t.or(`from_address.eq.${normalizedPhone},to_address.eq.${normalizedPhone}`)\n\t\t.order(\"created_at\", { ascending: true });\n\n\tif (error) {\n\t\tconsole.error(\"Error fetching SMS conversation:\", error);\n\t\treturn [];\n\t}\n\n\treturn (data || []).map((msg) => ({\n\t\t...msg,\n\t\ttags: (msg.tags as string[]) || null,\n\t\tprovider_metadata: (msg.provider_metadata as Record<string, unknown>) || null,\n\t})) as CompanySms[];\n}\n\n/**\n * Mark all unread messages in an SMS conversation as read\n */\nexport async function markSmsConversationAsRead(\n\tcompanyId: string,\n\tphoneNumber: string,\n): Promise<boolean> {\n\tconst supabase = await createClient();\n\n\tif (!supabase) {\n\t\treturn false;\n\t}\n\n\t// Normalize phone number for matching\n\tconst normalizePhone = (phone: string) => {\n\t\tconst digits = phone.replace(/[^0-9]/g, \"\");\n\t\tif (digits.length === 11 && digits.startsWith(\"1\")) {\n\t\t\treturn `+${digits}`;\n\t\t}\n\t\tif (digits.length === 10) {\n\t\t\treturn `+1${digits}`;\n\t\t}\n\t\treturn phone.startsWith(\"+\") ? phone : `+${phone}`;\n\t};\n\n\tconst normalizedPhone = normalizePhone(phoneNumber);\n\n\t// Mark all unread inbound messages in this conversation as read\n\tconst readAt = new Date().toISOString();\n\tconst { data, error } = await supabase\n\t\t.from(\"communications\")\n\t\t.update({ read_at: readAt })\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"type\", \"sms\")\n\t\t.eq(\"direction\", \"inbound\")\n\t\t.is(\"read_at\", null)\n\t\t.is(\"deleted_at\", null)\n\t\t.or(`from_address.eq.${normalizedPhone},to_address.eq.${normalizedPhone}`)\n\t\t.select(\"id, read_at\");\n\n\tif (error) {\n\t\tconsole.error(\"❌ markSmsConversationAsRead error:\", error);\n\t\treturn false;\n\t}\n\n\tconsole.log(`✅ markSmsConversationAsRead success: Marked ${data?.length || 0} messages as read`);\n\treturn true;\n}\n\n","\"use server\";\n\nimport {\n    getCompanySms,\n    getSmsById,\n    markSmsAsRead,\n    markSmsConversationAsRead,\n    type CompanySms,\n} from \"@/lib/communication/sms-service\";\nimport { z } from \"zod\";\n\nconst getSmsSchema = z.object({\n  limit: z.coerce.number().min(1).max(500).optional().default(50),\n  offset: z.coerce.number().min(0).optional().default(0),\n  type: z.enum([\"sent\", \"received\", \"all\"]).optional().default(\"all\"),\n  folder: z.enum([\"inbox\", \"sent\", \"archive\", \"trash\", \"bin\"]).optional(),\n  label: z.string().optional(),\n  search: z.string().optional().nullable(),\n  sortBy: z.enum([\"created_at\", \"sent_at\"]).optional().default(\"created_at\"),\n  sortOrder: z.enum([\"asc\", \"desc\"]).optional().default(\"desc\"),\n}).passthrough();\n\nconst markSmsReadSchema = z.object({\n  smsId: z.string().min(1),\n});\n\nexport type GetSmsInput = z.infer<typeof getSmsSchema>;\nexport type MarkSmsReadInput = z.infer<typeof markSmsReadSchema>;\n\n// Re-export SMS types from sms-service\nexport type { CompanySms };\n\nexport type GetSmsResult = Awaited<ReturnType<typeof getCompanySms>>;\n\n/**\n * Get SMS messages for the active company\n */\nexport async function getSmsAction(\n  input: GetSmsInput\n): Promise<GetSmsResult> {\n  try {\n    const parseResult = getSmsSchema.safeParse(input);\n    \n    if (!parseResult.success) {\n      throw new Error(`Invalid input parameters: ${parseResult.error.errors.map(e => `${e.path.join('.')}: ${e.message}`).join(', ')}`);\n    }\n    \n    const validatedInput = parseResult.data;\n    const { getActiveCompanyId } = await import(\"@/lib/auth/company-context\");\n    const companyId = await getActiveCompanyId();\n\n    if (!companyId) {\n      throw new Error(\"No active company found\");\n    }\n\n    return await getCompanySms(companyId, validatedInput);\n  } catch (error) {\n    console.error(\"❌ getSmsAction error:\", error);\n    throw error;\n  }\n}\n\n/**\n * Get a specific SMS by ID\n */\nexport async function getSmsByIdAction(smsId: string): Promise<{\n  success: boolean;\n  sms?: CompanySms;\n  error?: string;\n}> {\n  try {\n    const { getActiveCompanyId } = await import(\"@/lib/auth/company-context\");\n    const companyId = await getActiveCompanyId();\n\n    if (!companyId) {\n      return { success: false, error: \"No active company found\" };\n    }\n\n    const sms = await getSmsById(companyId, smsId);\n    \n    if (!sms) {\n      return { success: false, error: \"SMS not found\" };\n    }\n\n    return { success: true, sms };\n  } catch (error) {\n    console.error(\"Error getting SMS by ID:\", error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    };\n  }\n}\n\n/**\n * Mark an SMS as read\n */\nexport async function markSmsAsReadAction(\n  input: MarkSmsReadInput\n): Promise<boolean> {\n  try {\n    const validatedInput = markSmsReadSchema.parse(input);\n    const { getActiveCompanyId } = await import(\"@/lib/auth/company-context\");\n    const companyId = await getActiveCompanyId();\n\n    if (!companyId) {\n      throw new Error(\"Invalid input parameters\");\n    }\n\n    return await markSmsAsRead(companyId, validatedInput.smsId);\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      throw new Error(\"Invalid input parameters\");\n    }\n    throw error;\n  }\n}\n\n/**\n * Mark all unread messages in an SMS conversation as read\n */\nexport async function markSmsConversationAsReadAction(phoneNumber: string): Promise<{\n  success: boolean;\n  error?: string;\n}> {\n  \"use server\";\n  \n  try {\n    const { getActiveCompanyId } = await import(\"@/lib/auth/company-context\");\n    const companyId = await getActiveCompanyId();\n    \n    if (!companyId) {\n      return { success: false, error: \"No active company found\" };\n    }\n    \n    const success = await markSmsConversationAsRead(companyId, phoneNumber);\n    return { success };\n  } catch (error) {\n    console.error(\"Error marking SMS conversation as read:\", error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    };\n  }\n}\n\n/**\n * Get SMS conversation thread by phone number\n */\nexport async function getSmsConversationAction(phoneNumber: string): Promise<{\n  success: boolean;\n  messages?: CompanySms[];\n  error?: string;\n}> {\n  \"use server\";\n  \n  try {\n    const { getSmsConversation } = await import(\"@/lib/sms/sms-service\");\n    const { getActiveCompanyId } = await import(\"@/lib/auth/company-context\");\n    \n    const companyId = await getActiveCompanyId();\n    if (!companyId) {\n      return { success: false, error: \"No active company found\" };\n    }\n\n    const messages = await getSmsConversation(companyId, phoneNumber);\n    return { success: true, messages };\n  } catch (error) {\n    console.error(\"Error fetching SMS conversation:\", error);\n    // Handle cookies() error gracefully\n    if (error instanceof Error && error.message.includes(\"cookies\")) {\n      return {\n        success: false,\n        error: \"Request context not available. Please refresh the page.\",\n      };\n    }\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    };\n  }\n}\n\n/**\n * Get SMS folder counts\n */\nexport async function getSmsFolderCountsAction(): Promise<{\n  success: boolean;\n  counts?: {\n    inbox: number;\n    sent: number;\n    archive: number;\n    trash: number;\n    [label: string]: number;\n  };\n  error?: string;\n}> {\n  \"use server\";\n  \n  try {\n    const { createClient } = await import(\"@/lib/supabase/server\");\n    const { getActiveCompanyId } = await import(\"@/lib/auth/company-context\");\n    \n    const companyId = await getActiveCompanyId();\n    if (!companyId) {\n      return { success: false, error: \"No active company found\" };\n    }\n    \n    const supabase = await createClient();\n    if (!supabase) {\n      return { success: false, error: \"Database connection failed\" };\n    }\n    \n    const baseQuery = supabase\n      .from(\"communications\")\n      .select(\"*\", { count: \"exact\", head: true })\n      .eq(\"company_id\", companyId)\n      .eq(\"type\", \"sms\");\n    \n    // Get counts for each folder\n    const [inboxResult, sentResult, archiveResult, trashResult] = await Promise.all([\n      // Inbox\n      baseQuery\n        .eq(\"direction\", \"inbound\")\n        .eq(\"is_archived\", false)\n        .is(\"deleted_at\", null)\n        .or(\"snoozed_until.is.null,snoozed_until.lt.now()\"),\n      // Sent\n      baseQuery\n        .eq(\"direction\", \"outbound\")\n        .eq(\"is_archived\", false)\n        .is(\"deleted_at\", null),\n      // Archive\n      baseQuery.eq(\"is_archived\", true).is(\"deleted_at\", null),\n      // Trash\n      baseQuery.not(\"deleted_at\", \"is\", null),\n    ]);\n    \n    const counts = {\n      inbox: inboxResult.count || 0,\n      sent: sentResult.count || 0,\n      archive: archiveResult.count || 0,\n      trash: trashResult.count || 0,\n    };\n    \n    return { success: true, counts };\n  } catch (error) {\n    return { success: false, error: error instanceof Error ? error.message : \"Unknown error\" };\n  }\n}\n\n/**\n * Upload SMS attachments to storage\n */\nexport async function uploadSmsAttachments(\n  files: File[]\n): Promise<{\n  success: boolean;\n  urls?: string[];\n  error?: string;\n}> {\n  \"use server\";\n  \n  try {\n    const { getActiveCompanyId } = await import(\"@/lib/auth/company-context\");\n    const companyId = await getActiveCompanyId();\n    \n    if (!companyId) {\n      return { success: false, error: \"No active company found\" };\n    }\n    \n    const { createClient } = await import(\"@/lib/supabase/server\");\n    const supabase = await createClient();\n    \n    if (!supabase) {\n      return { success: false, error: \"Database connection failed\" };\n    }\n\n    const urls: string[] = [];\n    \n      // Upload each file to Supabase Storage\n      // Use company-files bucket which has proper RLS policies for company members\n      for (const file of files) {\n        const fileExt = file.name.split('.').pop();\n        const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\n        // Path structure: companyId must be at index [0] for RLS policy (matches document-manager pattern)\n        // Format: companyId/folder/filename (storage.foldername(name))[0] = companyId\n        const filePath = `${companyId}/sms-attachments/${fileName}`;\n        \n        // Convert file to array buffer\n        const arrayBuffer = await file.arrayBuffer();\n        const { data, error: uploadError } = await supabase.storage\n          .from('company-files') // Use company-files bucket with proper RLS\n          .upload(filePath, arrayBuffer, {\n            contentType: file.type,\n            upsert: false,\n          });\n        \n        if (uploadError) {\n          console.error(\"Upload error:\", uploadError);\n          return { success: false, error: `Failed to upload ${file.name}: ${uploadError.message}` };\n        }\n        \n        // Get public URL (or signed URL for private bucket)\n        const { data: { publicUrl } } = supabase.storage\n          .from('company-files')\n          .getPublicUrl(filePath);\n        \n        urls.push(publicUrl);\n      }\n    \n    return { success: true, urls };\n  } catch (error) {\n    console.error(\"Error uploading SMS attachments:\", error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    };\n  }\n}\n\n/**\n * SMS Template Context Type\n * Data available for auto-filling SMS templates\n */\nexport type SmsTemplateContext = {\n  companyName?: string;\n  companyPhone?: string;\n  companyEmail?: string;\n};\n\n/**\n * Get company context for SMS templates\n * Returns company info for auto-filling template messages\n */\nexport async function getCompanyContextAction(): Promise<{\n  success: boolean;\n  context?: SmsTemplateContext;\n  error?: string;\n}> {\n  \"use server\";\n\n  try {\n    const { getActiveCompany } = await import(\"@/lib/auth/company-context\");\n\n    const company = await getActiveCompany();\n    if (!company) {\n      return { success: false, error: \"No active company found\" };\n    }\n\n    return {\n      success: true,\n      context: {\n        companyName: company.name,\n        companyPhone: company.phone || undefined,\n        companyEmail: company.email || undefined,\n      },\n    };\n  } catch (error) {\n    console.error(\"Error getting company context:\", error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    };\n  }\n}\n\n","/**\n * Payment Token Utilities\n *\n * Secure token generation and validation for invoice payment links\n *\n * Features:\n * - Generate secure payment tokens with expiration\n * - Validate tokens before allowing payment\n * - Track token usage and prevent reuse\n * - IP address tracking for security\n */\n\n\"use server\";\n\nimport { emailConfig } from \"@/lib/email/resend-client\";\nimport { createClient } from \"@/lib/supabase/server\";\n\nexport type PaymentToken = {\n\ttoken: string;\n\texpiresAt: string;\n\tpaymentLink: string;\n};\n\nexport type TokenValidation = {\n\tisValid: boolean;\n\tinvoiceId: string | null;\n\tmessage: string;\n};\n\n/**\n * Generate a secure payment token for an invoice\n *\n * @param invoiceId - UUID of the invoice\n * @param expiryHours - How many hours until token expires (default 72 hours / 3 days)\n * @param maxUses - Maximum number of times token can be used (default 1)\n * @returns Payment token details including the full payment link\n */\nexport async function generatePaymentToken(\n\tinvoiceId: string,\n\texpiryHours = 72,\n\tmaxUses = 1,\n): Promise<PaymentToken | null> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tif (!supabase) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Call database function to generate token\n\t\tconst { data, error } = await supabase.rpc(\n\t\t\t\"generate_invoice_payment_token\",\n\t\t\t{\n\t\t\t\tp_invoice_id: invoiceId,\n\t\t\t\tp_expiry_hours: expiryHours,\n\t\t\t\tp_max_uses: maxUses,\n\t\t\t},\n\t\t);\n\n\t\tif (error || !data || data.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst tokenData = data[0];\n\t\tconst paymentLink = `${emailConfig.appUrl}/pay/${invoiceId}?token=${tokenData.token}`;\n\n\t\treturn {\n\t\t\ttoken: tokenData.token,\n\t\t\texpiresAt: tokenData.expires_at,\n\t\t\tpaymentLink,\n\t\t};\n\t} catch (_error) {\n\t\treturn null;\n\t}\n}\n\n/**\n * Check a payment token (does NOT increment use count)\n * Use this for viewing the payment page\n *\n * @param token - The payment token to check\n * @returns Validation result with invoice ID if valid\n */\nexport async function validatePaymentToken(\n\ttoken: string,\n\t_ipAddress?: string,\n): Promise<TokenValidation> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tif (!supabase) {\n\t\t\treturn {\n\t\t\t\tisValid: false,\n\t\t\t\tinvoiceId: null,\n\t\t\t\tmessage: \"Unable to connect to database\",\n\t\t\t};\n\t\t}\n\n\t\tconst { data, error } = await supabase.rpc(\"check_payment_token\", {\n\t\t\tp_token: token,\n\t\t});\n\n\t\tif (error || !data || data.length === 0) {\n\t\t\treturn {\n\t\t\t\tisValid: false,\n\t\t\t\tinvoiceId: null,\n\t\t\t\tmessage: \"Invalid payment token\",\n\t\t\t};\n\t\t}\n\n\t\tconst validation = data[0];\n\n\t\treturn {\n\t\t\tisValid: validation.is_valid,\n\t\t\tinvoiceId: validation.invoice_id,\n\t\t\tmessage: validation.message,\n\t\t};\n\t} catch (_error) {\n\t\treturn {\n\t\t\tisValid: false,\n\t\t\tinvoiceId: null,\n\t\t\tmessage: \"Error validating payment token\",\n\t\t};\n\t}\n}\n\n/**\n * Mark a payment token as used (called after successful payment)\n * This deactivates the token so it cannot be used again\n *\n * @param token - The payment token to mark as used\n * @param ipAddress - Optional IP address for security tracking\n */\nexport async function markTokenAsUsed(\n\ttoken: string,\n\tipAddress?: string,\n): Promise<boolean> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tif (!supabase) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { data: existingTokens, error: fetchError } = await supabase\n\t\t\t.from(\"invoice_payment_tokens\")\n\t\t\t.select(\"use_count\")\n\t\t\t.eq(\"token\", token)\n\t\t\t.limit(1);\n\n\t\tif (fetchError || !existingTokens || existingTokens.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst currentUseCount = existingTokens[0]?.use_count ?? 0;\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"invoice_payment_tokens\")\n\t\t\t.update({\n\t\t\t\tis_active: false,\n\t\t\t\tused_at: new Date().toISOString(),\n\t\t\t\tused_by_ip: ipAddress || null,\n\t\t\t\tuse_count: currentUseCount + 1,\n\t\t\t})\n\t\t\t.eq(\"token\", token);\n\n\t\tif (error) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (_error) {\n\t\treturn false;\n\t}\n}\n\n/**\n * Get all active payment tokens for an invoice\n *\n * Useful for admin purposes or showing existing payment links\n *\n * @param invoiceId - UUID of the invoice\n * @returns Array of active payment tokens\n */\nasync function getInvoicePaymentTokens(\n\tinvoiceId: string,\n): Promise<PaymentToken[]> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tif (!supabase) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"invoice_payment_tokens\")\n\t\t\t.select(\"token, expires_at\")\n\t\t\t.eq(\"invoice_id\", invoiceId)\n\t\t\t.eq(\"is_active\", true)\n\t\t\t.gt(\"expires_at\", new Date().toISOString())\n\t\t\t.order(\"created_at\", { ascending: false });\n\n\t\tif (error || !data) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn data.map((row) => ({\n\t\t\ttoken: row.token,\n\t\t\texpiresAt: row.expires_at,\n\t\t\tpaymentLink: `${emailConfig.appUrl}/pay/${invoiceId}?token=${row.token}`,\n\t\t}));\n\t} catch (_error) {\n\t\treturn [];\n\t}\n}\n\n/**\n * PERFORMANCE OPTIMIZED: Batch generate payment tokens for multiple invoices\n *\n * Replaces N+1 pattern where each invoice generates a token separately.\n * Uses Promise.all to parallelize RPC calls (still better than sequential).\n *\n * @param invoiceIds - Array of invoice UUIDs\n * @param expiryHours - How many hours until tokens expire (default 72 hours / 3 days)\n * @param maxUses - Maximum number of times tokens can be used (default 1)\n * @returns Map of invoiceId -> PaymentToken\n */\nexport async function generatePaymentTokensBatch(\n\tinvoiceIds: string[],\n\texpiryHours = 72,\n\tmaxUses = 1,\n): Promise<Record<string, PaymentToken>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tif (!supabase) {\n\t\t\treturn {};\n\t\t}\n\n\t\t// Generate all tokens in parallel (much faster than sequential)\n\t\tconst tokenPromises = invoiceIds.map(async (invoiceId) => {\n\t\t\tconst { data, error } = await supabase.rpc(\n\t\t\t\t\"generate_invoice_payment_token\",\n\t\t\t\t{\n\t\t\t\t\tp_invoice_id: invoiceId,\n\t\t\t\t\tp_expiry_hours: expiryHours,\n\t\t\t\t\tp_max_uses: maxUses,\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tif (error || !data || data.length === 0) {\n\t\t\t\treturn { invoiceId, token: null };\n\t\t\t}\n\n\t\t\tconst tokenData = data[0];\n\t\t\tconst paymentLink = `${emailConfig.appUrl}/pay/${invoiceId}?token=${tokenData.token}`;\n\n\t\t\treturn {\n\t\t\t\tinvoiceId,\n\t\t\t\ttoken: {\n\t\t\t\t\ttoken: tokenData.token,\n\t\t\t\t\texpiresAt: tokenData.expires_at,\n\t\t\t\t\tpaymentLink,\n\t\t\t\t},\n\t\t\t};\n\t\t});\n\n\t\tconst results = await Promise.all(tokenPromises);\n\n\t\t// Convert array to map\n\t\treturn results.reduce(\n\t\t\t(acc, { invoiceId, token }) => {\n\t\t\t\tif (token) {\n\t\t\t\t\tacc[invoiceId] = token;\n\t\t\t\t}\n\t\t\t\treturn acc;\n\t\t\t},\n\t\t\t{} as Record<string, PaymentToken>,\n\t\t);\n\t} catch (_error) {\n\t\treturn {};\n\t}\n}\n","/**\n * @module constants\n * @summary Useful constants\n * @description\n * Collection of useful date constants.\n *\n * The constants could be imported from `date-fns/constants`:\n *\n * ```ts\n * import { maxTime, minTime } from \"./constants/date-fns/constants\";\n *\n * function isAllowedTime(time) {\n *   return time <= maxTime && time >= minTime;\n * }\n * ```\n */\n\n/**\n * @constant\n * @name daysInWeek\n * @summary Days in 1 week.\n */\nexport const daysInWeek = 7;\n\n/**\n * @constant\n * @name daysInYear\n * @summary Days in 1 year.\n *\n * @description\n * How many days in a year.\n *\n * One years equals 365.2425 days according to the formula:\n *\n * > Leap year occurs every 4 years, except for years that are divisible by 100 and not divisible by 400.\n * > 1 mean year = (365+1/4-1/100+1/400) days = 365.2425 days\n */\nexport const daysInYear = 365.2425;\n\n/**\n * @constant\n * @name maxTime\n * @summary Maximum allowed time.\n *\n * @example\n * import { maxTime } from \"./constants/date-fns/constants\";\n *\n * const isValid = 8640000000000001 <= maxTime;\n * //=> false\n *\n * new Date(8640000000000001);\n * //=> Invalid Date\n */\nexport const maxTime = Math.pow(10, 8) * 24 * 60 * 60 * 1000;\n\n/**\n * @constant\n * @name minTime\n * @summary Minimum allowed time.\n *\n * @example\n * import { minTime } from \"./constants/date-fns/constants\";\n *\n * const isValid = -8640000000000001 >= minTime;\n * //=> false\n *\n * new Date(-8640000000000001)\n * //=> Invalid Date\n */\nexport const minTime = -maxTime;\n\n/**\n * @constant\n * @name millisecondsInWeek\n * @summary Milliseconds in 1 week.\n */\nexport const millisecondsInWeek = 604800000;\n\n/**\n * @constant\n * @name millisecondsInDay\n * @summary Milliseconds in 1 day.\n */\nexport const millisecondsInDay = 86400000;\n\n/**\n * @constant\n * @name millisecondsInMinute\n * @summary Milliseconds in 1 minute\n */\nexport const millisecondsInMinute = 60000;\n\n/**\n * @constant\n * @name millisecondsInHour\n * @summary Milliseconds in 1 hour\n */\nexport const millisecondsInHour = 3600000;\n\n/**\n * @constant\n * @name millisecondsInSecond\n * @summary Milliseconds in 1 second\n */\nexport const millisecondsInSecond = 1000;\n\n/**\n * @constant\n * @name minutesInYear\n * @summary Minutes in 1 year.\n */\nexport const minutesInYear = 525600;\n\n/**\n * @constant\n * @name minutesInMonth\n * @summary Minutes in 1 month.\n */\nexport const minutesInMonth = 43200;\n\n/**\n * @constant\n * @name minutesInDay\n * @summary Minutes in 1 day.\n */\nexport const minutesInDay = 1440;\n\n/**\n * @constant\n * @name minutesInHour\n * @summary Minutes in 1 hour.\n */\nexport const minutesInHour = 60;\n\n/**\n * @constant\n * @name monthsInQuarter\n * @summary Months in 1 quarter.\n */\nexport const monthsInQuarter = 3;\n\n/**\n * @constant\n * @name monthsInYear\n * @summary Months in 1 year.\n */\nexport const monthsInYear = 12;\n\n/**\n * @constant\n * @name quartersInYear\n * @summary Quarters in 1 year\n */\nexport const quartersInYear = 4;\n\n/**\n * @constant\n * @name secondsInHour\n * @summary Seconds in 1 hour.\n */\nexport const secondsInHour = 3600;\n\n/**\n * @constant\n * @name secondsInMinute\n * @summary Seconds in 1 minute.\n */\nexport const secondsInMinute = 60;\n\n/**\n * @constant\n * @name secondsInDay\n * @summary Seconds in 1 day.\n */\nexport const secondsInDay = secondsInHour * 24;\n\n/**\n * @constant\n * @name secondsInWeek\n * @summary Seconds in 1 week.\n */\nexport const secondsInWeek = secondsInDay * 7;\n\n/**\n * @constant\n * @name secondsInYear\n * @summary Seconds in 1 year.\n */\nexport const secondsInYear = secondsInDay * daysInYear;\n\n/**\n * @constant\n * @name secondsInMonth\n * @summary Seconds in 1 month\n */\nexport const secondsInMonth = secondsInYear / 12;\n\n/**\n * @constant\n * @name secondsInQuarter\n * @summary Seconds in 1 quarter.\n */\nexport const secondsInQuarter = secondsInMonth * 3;\n\n/**\n * @constant\n * @name constructFromSymbol\n * @summary Symbol enabling Date extensions to inherit properties from the reference date.\n *\n * The symbol is used to enable the `constructFrom` function to construct a date\n * using a reference date and a value. It allows to transfer extra properties\n * from the reference date to the new date. It's useful for extensions like\n * [`TZDate`](https://github.com/date-fns/tz) that accept a time zone as\n * a constructor argument.\n */\nexport const constructFromSymbol = Symbol.for(\"constructDateFrom\");\n","import { constructFromSymbol } from \"./constants.js\";\n\n/**\n * @name constructFrom\n * @category Generic Helpers\n * @summary Constructs a date using the reference date and the value\n *\n * @description\n * The function constructs a new date using the constructor from the reference\n * date and the given value. It helps to build generic functions that accept\n * date extensions.\n *\n * It defaults to `Date` if the passed reference date is a number or a string.\n *\n * Starting from v3.7.0, it allows to construct a date using `[Symbol.for(\"constructDateFrom\")]`\n * enabling to transfer extra properties from the reference date to the new date.\n * It's useful for extensions like [`TZDate`](https://github.com/date-fns/tz)\n * that accept a time zone as a constructor argument.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n *\n * @param date - The reference date to take constructor from\n * @param value - The value to create the date\n *\n * @returns Date initialized using the given date and value\n *\n * @example\n * import { constructFrom } from \"./constructFrom/date-fns\";\n *\n * // A function that clones a date preserving the original type\n * function cloneDate<DateType extends Date>(date: DateType): DateType {\n *   return constructFrom(\n *     date, // Use constructor from the given date\n *     date.getTime() // Use the date value to create a new date\n *   );\n * }\n */\nexport function constructFrom(date, value) {\n  if (typeof date === \"function\") return date(value);\n\n  if (date && typeof date === \"object\" && constructFromSymbol in date)\n    return date[constructFromSymbol](value);\n\n  if (date instanceof Date) return new date.constructor(value);\n\n  return new Date(value);\n}\n\n// Fallback for modularized imports:\nexport default constructFrom;\n","import { constructFrom } from \"./constructFrom.js\";\n\n/**\n * @name toDate\n * @category Common Helpers\n * @summary Convert the given argument to an instance of Date.\n *\n * @description\n * Convert the given argument to an instance of Date.\n *\n * If the argument is an instance of Date, the function returns its clone.\n *\n * If the argument is a number, it is treated as a timestamp.\n *\n * If the argument is none of the above, the function returns Invalid Date.\n *\n * Starting from v3.7.0, it clones a date using `[Symbol.for(\"constructDateFrom\")]`\n * enabling to transfer extra properties from the reference date to the new date.\n * It's useful for extensions like [`TZDate`](https://github.com/date-fns/tz)\n * that accept a time zone as a constructor argument.\n *\n * **Note**: *all* Date arguments passed to any *date-fns* function is processed by `toDate`.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param argument - The value to convert\n *\n * @returns The parsed date in the local time zone\n *\n * @example\n * // Clone the date:\n * const result = toDate(new Date(2014, 1, 11, 11, 30, 30))\n * //=> Tue Feb 11 2014 11:30:30\n *\n * @example\n * // Convert the timestamp to date:\n * const result = toDate(1392098430000)\n * //=> Tue Feb 11 2014 11:30:30\n */\nexport function toDate(argument, context) {\n  // [TODO] Get rid of `toDate` or `constructFrom`?\n  return constructFrom(context || argument, argument);\n}\n\n// Fallback for modularized imports:\nexport default toDate;\n","const formatDistanceLocale = {\n  lessThanXSeconds: {\n    one: \"less than a second\",\n    other: \"less than {{count}} seconds\",\n  },\n\n  xSeconds: {\n    one: \"1 second\",\n    other: \"{{count}} seconds\",\n  },\n\n  halfAMinute: \"half a minute\",\n\n  lessThanXMinutes: {\n    one: \"less than a minute\",\n    other: \"less than {{count}} minutes\",\n  },\n\n  xMinutes: {\n    one: \"1 minute\",\n    other: \"{{count}} minutes\",\n  },\n\n  aboutXHours: {\n    one: \"about 1 hour\",\n    other: \"about {{count}} hours\",\n  },\n\n  xHours: {\n    one: \"1 hour\",\n    other: \"{{count}} hours\",\n  },\n\n  xDays: {\n    one: \"1 day\",\n    other: \"{{count}} days\",\n  },\n\n  aboutXWeeks: {\n    one: \"about 1 week\",\n    other: \"about {{count}} weeks\",\n  },\n\n  xWeeks: {\n    one: \"1 week\",\n    other: \"{{count}} weeks\",\n  },\n\n  aboutXMonths: {\n    one: \"about 1 month\",\n    other: \"about {{count}} months\",\n  },\n\n  xMonths: {\n    one: \"1 month\",\n    other: \"{{count}} months\",\n  },\n\n  aboutXYears: {\n    one: \"about 1 year\",\n    other: \"about {{count}} years\",\n  },\n\n  xYears: {\n    one: \"1 year\",\n    other: \"{{count}} years\",\n  },\n\n  overXYears: {\n    one: \"over 1 year\",\n    other: \"over {{count}} years\",\n  },\n\n  almostXYears: {\n    one: \"almost 1 year\",\n    other: \"almost {{count}} years\",\n  },\n};\n\nexport const formatDistance = (token, count, options) => {\n  let result;\n\n  const tokenValue = formatDistanceLocale[token];\n  if (typeof tokenValue === \"string\") {\n    result = tokenValue;\n  } else if (count === 1) {\n    result = tokenValue.one;\n  } else {\n    result = tokenValue.other.replace(\"{{count}}\", count.toString());\n  }\n\n  if (options?.addSuffix) {\n    if (options.comparison && options.comparison > 0) {\n      return \"in \" + result;\n    } else {\n      return result + \" ago\";\n    }\n  }\n\n  return result;\n};\n","export function buildFormatLongFn(args) {\n  return (options = {}) => {\n    // TODO: Remove String()\n    const width = options.width ? String(options.width) : args.defaultWidth;\n    const format = args.formats[width] || args.formats[args.defaultWidth];\n    return format;\n  };\n}\n","import { buildFormatLongFn } from \"../../_lib/buildFormatLongFn.js\";\n\nconst dateFormats = {\n  full: \"EEEE, MMMM do, y\",\n  long: \"MMMM do, y\",\n  medium: \"MMM d, y\",\n  short: \"MM/dd/yyyy\",\n};\n\nconst timeFormats = {\n  full: \"h:mm:ss a zzzz\",\n  long: \"h:mm:ss a z\",\n  medium: \"h:mm:ss a\",\n  short: \"h:mm a\",\n};\n\nconst dateTimeFormats = {\n  full: \"{{date}} 'at' {{time}}\",\n  long: \"{{date}} 'at' {{time}}\",\n  medium: \"{{date}}, {{time}}\",\n  short: \"{{date}}, {{time}}\",\n};\n\nexport const formatLong = {\n  date: buildFormatLongFn({\n    formats: dateFormats,\n    defaultWidth: \"full\",\n  }),\n\n  time: buildFormatLongFn({\n    formats: timeFormats,\n    defaultWidth: \"full\",\n  }),\n\n  dateTime: buildFormatLongFn({\n    formats: dateTimeFormats,\n    defaultWidth: \"full\",\n  }),\n};\n","const formatRelativeLocale = {\n  lastWeek: \"'last' eeee 'at' p\",\n  yesterday: \"'yesterday at' p\",\n  today: \"'today at' p\",\n  tomorrow: \"'tomorrow at' p\",\n  nextWeek: \"eeee 'at' p\",\n  other: \"P\",\n};\n\nexport const formatRelative = (token, _date, _baseDate, _options) =>\n  formatRelativeLocale[token];\n","/**\n * The localize function argument callback which allows to convert raw value to\n * the actual type.\n *\n * @param value - The value to convert\n *\n * @returns The converted value\n */\n\n/**\n * The map of localized values for each width.\n */\n\n/**\n * The index type of the locale unit value. It types conversion of units of\n * values that don't start at 0 (i.e. quarters).\n */\n\n/**\n * Converts the unit value to the tuple of values.\n */\n\n/**\n * The tuple of localized era values. The first element represents BC,\n * the second element represents AD.\n */\n\n/**\n * The tuple of localized quarter values. The first element represents Q1.\n */\n\n/**\n * The tuple of localized day values. The first element represents Sunday.\n */\n\n/**\n * The tuple of localized month values. The first element represents January.\n */\n\nexport function buildLocalizeFn(args) {\n  return (value, options) => {\n    const context = options?.context ? String(options.context) : \"standalone\";\n\n    let valuesArray;\n    if (context === \"formatting\" && args.formattingValues) {\n      const defaultWidth = args.defaultFormattingWidth || args.defaultWidth;\n      const width = options?.width ? String(options.width) : defaultWidth;\n\n      valuesArray =\n        args.formattingValues[width] || args.formattingValues[defaultWidth];\n    } else {\n      const defaultWidth = args.defaultWidth;\n      const width = options?.width ? String(options.width) : args.defaultWidth;\n\n      valuesArray = args.values[width] || args.values[defaultWidth];\n    }\n    const index = args.argumentCallback ? args.argumentCallback(value) : value;\n\n    // @ts-expect-error - For some reason TypeScript just don't want to match it, no matter how hard we try. I challenge you to try to remove it!\n    return valuesArray[index];\n  };\n}\n","import { buildLocalizeFn } from \"../../_lib/buildLocalizeFn.js\";\n\nconst eraValues = {\n  narrow: [\"B\", \"A\"],\n  abbreviated: [\"BC\", \"AD\"],\n  wide: [\"Before Christ\", \"Anno Domini\"],\n};\n\nconst quarterValues = {\n  narrow: [\"1\", \"2\", \"3\", \"4\"],\n  abbreviated: [\"Q1\", \"Q2\", \"Q3\", \"Q4\"],\n  wide: [\"1st quarter\", \"2nd quarter\", \"3rd quarter\", \"4th quarter\"],\n};\n\n// Note: in English, the names of days of the week and months are capitalized.\n// If you are making a new locale based on this one, check if the same is true for the language you're working on.\n// Generally, formatted dates should look like they are in the middle of a sentence,\n// e.g. in Spanish language the weekdays and months should be in the lowercase.\nconst monthValues = {\n  narrow: [\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\"],\n  abbreviated: [\n    \"Jan\",\n    \"Feb\",\n    \"Mar\",\n    \"Apr\",\n    \"May\",\n    \"Jun\",\n    \"Jul\",\n    \"Aug\",\n    \"Sep\",\n    \"Oct\",\n    \"Nov\",\n    \"Dec\",\n  ],\n\n  wide: [\n    \"January\",\n    \"February\",\n    \"March\",\n    \"April\",\n    \"May\",\n    \"June\",\n    \"July\",\n    \"August\",\n    \"September\",\n    \"October\",\n    \"November\",\n    \"December\",\n  ],\n};\n\nconst dayValues = {\n  narrow: [\"S\", \"M\", \"T\", \"W\", \"T\", \"F\", \"S\"],\n  short: [\"Su\", \"Mo\", \"Tu\", \"We\", \"Th\", \"Fr\", \"Sa\"],\n  abbreviated: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"],\n  wide: [\n    \"Sunday\",\n    \"Monday\",\n    \"Tuesday\",\n    \"Wednesday\",\n    \"Thursday\",\n    \"Friday\",\n    \"Saturday\",\n  ],\n};\n\nconst dayPeriodValues = {\n  narrow: {\n    am: \"a\",\n    pm: \"p\",\n    midnight: \"mi\",\n    noon: \"n\",\n    morning: \"morning\",\n    afternoon: \"afternoon\",\n    evening: \"evening\",\n    night: \"night\",\n  },\n  abbreviated: {\n    am: \"AM\",\n    pm: \"PM\",\n    midnight: \"midnight\",\n    noon: \"noon\",\n    morning: \"morning\",\n    afternoon: \"afternoon\",\n    evening: \"evening\",\n    night: \"night\",\n  },\n  wide: {\n    am: \"a.m.\",\n    pm: \"p.m.\",\n    midnight: \"midnight\",\n    noon: \"noon\",\n    morning: \"morning\",\n    afternoon: \"afternoon\",\n    evening: \"evening\",\n    night: \"night\",\n  },\n};\n\nconst formattingDayPeriodValues = {\n  narrow: {\n    am: \"a\",\n    pm: \"p\",\n    midnight: \"mi\",\n    noon: \"n\",\n    morning: \"in the morning\",\n    afternoon: \"in the afternoon\",\n    evening: \"in the evening\",\n    night: \"at night\",\n  },\n  abbreviated: {\n    am: \"AM\",\n    pm: \"PM\",\n    midnight: \"midnight\",\n    noon: \"noon\",\n    morning: \"in the morning\",\n    afternoon: \"in the afternoon\",\n    evening: \"in the evening\",\n    night: \"at night\",\n  },\n  wide: {\n    am: \"a.m.\",\n    pm: \"p.m.\",\n    midnight: \"midnight\",\n    noon: \"noon\",\n    morning: \"in the morning\",\n    afternoon: \"in the afternoon\",\n    evening: \"in the evening\",\n    night: \"at night\",\n  },\n};\n\nconst ordinalNumber = (dirtyNumber, _options) => {\n  const number = Number(dirtyNumber);\n\n  // If ordinal numbers depend on context, for example,\n  // if they are different for different grammatical genders,\n  // use `options.unit`.\n  //\n  // `unit` can be 'year', 'quarter', 'month', 'week', 'date', 'dayOfYear',\n  // 'day', 'hour', 'minute', 'second'.\n\n  const rem100 = number % 100;\n  if (rem100 > 20 || rem100 < 10) {\n    switch (rem100 % 10) {\n      case 1:\n        return number + \"st\";\n      case 2:\n        return number + \"nd\";\n      case 3:\n        return number + \"rd\";\n    }\n  }\n  return number + \"th\";\n};\n\nexport const localize = {\n  ordinalNumber,\n\n  era: buildLocalizeFn({\n    values: eraValues,\n    defaultWidth: \"wide\",\n  }),\n\n  quarter: buildLocalizeFn({\n    values: quarterValues,\n    defaultWidth: \"wide\",\n    argumentCallback: (quarter) => quarter - 1,\n  }),\n\n  month: buildLocalizeFn({\n    values: monthValues,\n    defaultWidth: \"wide\",\n  }),\n\n  day: buildLocalizeFn({\n    values: dayValues,\n    defaultWidth: \"wide\",\n  }),\n\n  dayPeriod: buildLocalizeFn({\n    values: dayPeriodValues,\n    defaultWidth: \"wide\",\n    formattingValues: formattingDayPeriodValues,\n    defaultFormattingWidth: \"wide\",\n  }),\n};\n","export function buildMatchFn(args) {\n  return (string, options = {}) => {\n    const width = options.width;\n\n    const matchPattern =\n      (width && args.matchPatterns[width]) ||\n      args.matchPatterns[args.defaultMatchWidth];\n    const matchResult = string.match(matchPattern);\n\n    if (!matchResult) {\n      return null;\n    }\n    const matchedString = matchResult[0];\n\n    const parsePatterns =\n      (width && args.parsePatterns[width]) ||\n      args.parsePatterns[args.defaultParseWidth];\n\n    const key = Array.isArray(parsePatterns)\n      ? findIndex(parsePatterns, (pattern) => pattern.test(matchedString))\n      : // [TODO] -- I challenge you to fix the type\n        findKey(parsePatterns, (pattern) => pattern.test(matchedString));\n\n    let value;\n\n    value = args.valueCallback ? args.valueCallback(key) : key;\n    value = options.valueCallback\n      ? // [TODO] -- I challenge you to fix the type\n        options.valueCallback(value)\n      : value;\n\n    const rest = string.slice(matchedString.length);\n\n    return { value, rest };\n  };\n}\n\nfunction findKey(object, predicate) {\n  for (const key in object) {\n    if (\n      Object.prototype.hasOwnProperty.call(object, key) &&\n      predicate(object[key])\n    ) {\n      return key;\n    }\n  }\n  return undefined;\n}\n\nfunction findIndex(array, predicate) {\n  for (let key = 0; key < array.length; key++) {\n    if (predicate(array[key])) {\n      return key;\n    }\n  }\n  return undefined;\n}\n","export function buildMatchPatternFn(args) {\n  return (string, options = {}) => {\n    const matchResult = string.match(args.matchPattern);\n    if (!matchResult) return null;\n    const matchedString = matchResult[0];\n\n    const parseResult = string.match(args.parsePattern);\n    if (!parseResult) return null;\n    let value = args.valueCallback\n      ? args.valueCallback(parseResult[0])\n      : parseResult[0];\n\n    // [TODO] I challenge you to fix the type\n    value = options.valueCallback ? options.valueCallback(value) : value;\n\n    const rest = string.slice(matchedString.length);\n\n    return { value, rest };\n  };\n}\n","import { buildMatchFn } from \"../../_lib/buildMatchFn.js\";\nimport { buildMatchPatternFn } from \"../../_lib/buildMatchPatternFn.js\";\n\nconst matchOrdinalNumberPattern = /^(\\d+)(th|st|nd|rd)?/i;\nconst parseOrdinalNumberPattern = /\\d+/i;\n\nconst matchEraPatterns = {\n  narrow: /^(b|a)/i,\n  abbreviated: /^(b\\.?\\s?c\\.?|b\\.?\\s?c\\.?\\s?e\\.?|a\\.?\\s?d\\.?|c\\.?\\s?e\\.?)/i,\n  wide: /^(before christ|before common era|anno domini|common era)/i,\n};\nconst parseEraPatterns = {\n  any: [/^b/i, /^(a|c)/i],\n};\n\nconst matchQuarterPatterns = {\n  narrow: /^[1234]/i,\n  abbreviated: /^q[1234]/i,\n  wide: /^[1234](th|st|nd|rd)? quarter/i,\n};\nconst parseQuarterPatterns = {\n  any: [/1/i, /2/i, /3/i, /4/i],\n};\n\nconst matchMonthPatterns = {\n  narrow: /^[jfmasond]/i,\n  abbreviated: /^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,\n  wide: /^(january|february|march|april|may|june|july|august|september|october|november|december)/i,\n};\nconst parseMonthPatterns = {\n  narrow: [\n    /^j/i,\n    /^f/i,\n    /^m/i,\n    /^a/i,\n    /^m/i,\n    /^j/i,\n    /^j/i,\n    /^a/i,\n    /^s/i,\n    /^o/i,\n    /^n/i,\n    /^d/i,\n  ],\n\n  any: [\n    /^ja/i,\n    /^f/i,\n    /^mar/i,\n    /^ap/i,\n    /^may/i,\n    /^jun/i,\n    /^jul/i,\n    /^au/i,\n    /^s/i,\n    /^o/i,\n    /^n/i,\n    /^d/i,\n  ],\n};\n\nconst matchDayPatterns = {\n  narrow: /^[smtwf]/i,\n  short: /^(su|mo|tu|we|th|fr|sa)/i,\n  abbreviated: /^(sun|mon|tue|wed|thu|fri|sat)/i,\n  wide: /^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i,\n};\nconst parseDayPatterns = {\n  narrow: [/^s/i, /^m/i, /^t/i, /^w/i, /^t/i, /^f/i, /^s/i],\n  any: [/^su/i, /^m/i, /^tu/i, /^w/i, /^th/i, /^f/i, /^sa/i],\n};\n\nconst matchDayPeriodPatterns = {\n  narrow: /^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,\n  any: /^([ap]\\.?\\s?m\\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i,\n};\nconst parseDayPeriodPatterns = {\n  any: {\n    am: /^a/i,\n    pm: /^p/i,\n    midnight: /^mi/i,\n    noon: /^no/i,\n    morning: /morning/i,\n    afternoon: /afternoon/i,\n    evening: /evening/i,\n    night: /night/i,\n  },\n};\n\nexport const match = {\n  ordinalNumber: buildMatchPatternFn({\n    matchPattern: matchOrdinalNumberPattern,\n    parsePattern: parseOrdinalNumberPattern,\n    valueCallback: (value) => parseInt(value, 10),\n  }),\n\n  era: buildMatchFn({\n    matchPatterns: matchEraPatterns,\n    defaultMatchWidth: \"wide\",\n    parsePatterns: parseEraPatterns,\n    defaultParseWidth: \"any\",\n  }),\n\n  quarter: buildMatchFn({\n    matchPatterns: matchQuarterPatterns,\n    defaultMatchWidth: \"wide\",\n    parsePatterns: parseQuarterPatterns,\n    defaultParseWidth: \"any\",\n    valueCallback: (index) => index + 1,\n  }),\n\n  month: buildMatchFn({\n    matchPatterns: matchMonthPatterns,\n    defaultMatchWidth: \"wide\",\n    parsePatterns: parseMonthPatterns,\n    defaultParseWidth: \"any\",\n  }),\n\n  day: buildMatchFn({\n    matchPatterns: matchDayPatterns,\n    defaultMatchWidth: \"wide\",\n    parsePatterns: parseDayPatterns,\n    defaultParseWidth: \"any\",\n  }),\n\n  dayPeriod: buildMatchFn({\n    matchPatterns: matchDayPeriodPatterns,\n    defaultMatchWidth: \"any\",\n    parsePatterns: parseDayPeriodPatterns,\n    defaultParseWidth: \"any\",\n  }),\n};\n","import { formatDistance } from \"./en-US/_lib/formatDistance.js\";\nimport { formatLong } from \"./en-US/_lib/formatLong.js\";\nimport { formatRelative } from \"./en-US/_lib/formatRelative.js\";\nimport { localize } from \"./en-US/_lib/localize.js\";\nimport { match } from \"./en-US/_lib/match.js\";\n\n/**\n * @category Locales\n * @summary English locale (United States).\n * @language English\n * @iso-639-2 eng\n * @author Sasha Koss [@kossnocorp](https://github.com/kossnocorp)\n * @author Lesha Koss [@leshakoss](https://github.com/leshakoss)\n */\nexport const enUS = {\n  code: \"en-US\",\n  formatDistance: formatDistance,\n  formatLong: formatLong,\n  formatRelative: formatRelative,\n  localize: localize,\n  match: match,\n  options: {\n    weekStartsOn: 0 /* Sunday */,\n    firstWeekContainsDate: 1,\n  },\n};\n\n// Fallback for modularized imports:\nexport default enUS;\n","let defaultOptions = {};\n\nexport function getDefaultOptions() {\n  return defaultOptions;\n}\n\nexport function setDefaultOptions(newOptions) {\n  defaultOptions = newOptions;\n}\n","import { toDate } from \"../toDate.js\";\n\n/**\n * Google Chrome as of 67.0.3396.87 introduced timezones with offset that includes seconds.\n * They usually appear for dates that denote time before the timezones were introduced\n * (e.g. for 'Europe/Prague' timezone the offset is GMT+00:57:44 before 1 October 1891\n * and GMT+01:00:00 after that date)\n *\n * Date#getTimezoneOffset returns the offset in minutes and would return 57 for the example above,\n * which would lead to incorrect calculations.\n *\n * This function returns the timezone offset in milliseconds that takes seconds in account.\n */\nexport function getTimezoneOffsetInMilliseconds(date) {\n  const _date = toDate(date);\n  const utcDate = new Date(\n    Date.UTC(\n      _date.getFullYear(),\n      _date.getMonth(),\n      _date.getDate(),\n      _date.getHours(),\n      _date.getMinutes(),\n      _date.getSeconds(),\n      _date.getMilliseconds(),\n    ),\n  );\n  utcDate.setUTCFullYear(_date.getFullYear());\n  return +date - +utcDate;\n}\n","import { constructFrom } from \"../constructFrom.js\";\n\nexport function normalizeDates(context, ...dates) {\n  const normalize = constructFrom.bind(\n    null,\n    context || dates.find((date) => typeof date === \"object\"),\n  );\n  return dates.map(normalize);\n}\n","/**\n * Invoice Email Template Settings Actions\n *\n * Server actions for managing invoice email templates\n */\n\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { createClient } from \"@/lib/supabase/server\";\n\nexport type InvoiceEmailTemplate = {\n\tsubject: string;\n\tbody: string;\n\tfooter: string;\n};\n\ntype ActionResult<T> = {\n\tsuccess: boolean;\n\tdata?: T;\n\terror?: string;\n};\n\n/**\n * Load the invoice email template for the current company\n */\nexport async function loadInvoiceEmailTemplate(): Promise<\n\tActionResult<InvoiceEmailTemplate>\n> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tif (!supabase) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Unable to connect to database\",\n\t\t\t};\n\t\t}\n\n\t\t// Get authenticated user\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\n\t\tif (!user) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Not authenticated\",\n\t\t\t};\n\t\t}\n\n\t\t// Get company ID\n\t\tconst { data: teamMember } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\"company_id\")\n\t\t\t.eq(\"user_id\", user.id)\n\t\t\t.eq(\"status\", \"active\")\n\t\t\t.limit(1)\n\t\t\t.single();\n\n\t\tif (!teamMember) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"No active company membership found\",\n\t\t\t};\n\t\t}\n\n\t\t// Load template from communication_templates table\n\t\tconst { data: template } = await supabase\n\t\t\t.from(\"communication_templates\")\n\t\t\t.select(\"subject, body, metadata\")\n\t\t\t.eq(\"company_id\", teamMember.company_id)\n\t\t\t.eq(\"type\", \"email\")\n\t\t\t.eq(\"category\", \"invoice\")\n\t\t\t.eq(\"is_active\", true)\n\t\t\t.maybeSingle();\n\n\t\tif (template) {\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tdata: {\n\t\t\t\t\tsubject: template.subject || \"\",\n\t\t\t\t\tbody: template.body || \"\",\n\t\t\t\t\tfooter: template.metadata?.footer || \"\",\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\t// Return default template if none exists\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: {\n\t\t\t\tsubject: \"Invoice {{invoice_number}} from {{company_name}}\",\n\t\t\t\tbody: `Hi {{customer_name}},\n\nPlease find attached your invoice {{invoice_number}} for {{invoice_amount}}.\n\nPayment is due by {{due_date}}.\n\nYou can securely pay your invoice online by clicking the link below:\n{{payment_link}}\n\nIf you have any questions about this invoice, please contact us at {{company_email}} or {{company_phone}}.\n\nThank you for your business!\n\nBest regards,\n{{company_name}}`,\n\t\t\t\tfooter:\n\t\t\t\t\t\"This is an automated message. Please do not reply to this email.\",\n\t\t\t},\n\t\t};\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Failed to load template\",\n\t\t};\n\t}\n}\n\n/**\n * Save the invoice email template for the current company\n */\nasync function saveInvoiceEmailTemplate(\n\ttemplate: InvoiceEmailTemplate,\n): Promise<ActionResult<void>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tif (!supabase) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Unable to connect to database\",\n\t\t\t};\n\t\t}\n\n\t\t// Get authenticated user\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\n\t\tif (!user) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Not authenticated\",\n\t\t\t};\n\t\t}\n\n\t\t// Get company ID\n\t\tconst { data: teamMember } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\"company_id\")\n\t\t\t.eq(\"user_id\", user.id)\n\t\t\t.eq(\"status\", \"active\")\n\t\t\t.limit(1)\n\t\t\t.single();\n\n\t\tif (!teamMember) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"No active company membership found\",\n\t\t\t};\n\t\t}\n\n\t\t// Check if template already exists\n\t\tconst { data: existing } = await supabase\n\t\t\t.from(\"communication_templates\")\n\t\t\t.select(\"id\")\n\t\t\t.eq(\"company_id\", teamMember.company_id)\n\t\t\t.eq(\"type\", \"email\")\n\t\t\t.eq(\"category\", \"invoice\")\n\t\t\t.maybeSingle();\n\n\t\tconst templateData = {\n\t\t\tcompany_id: teamMember.company_id,\n\t\t\tname: \"Invoice Email\",\n\t\t\ttype: \"email\",\n\t\t\tcategory: \"invoice\",\n\t\t\tsubject: template.subject,\n\t\t\tbody: template.body,\n\t\t\tmetadata: {\n\t\t\t\tfooter: template.footer,\n\t\t\t},\n\t\t\tis_active: true,\n\t\t\tis_default: true,\n\t\t};\n\n\t\tif (existing) {\n\t\t\t// Update existing template\n\t\t\tconst { error } = await supabase\n\t\t\t\t.from(\"communication_templates\")\n\t\t\t\t.update({\n\t\t\t\t\tsubject: template.subject,\n\t\t\t\t\tbody: template.body,\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\tfooter: template.footer,\n\t\t\t\t\t},\n\t\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t\t})\n\t\t\t\t.eq(\"id\", existing.id);\n\n\t\t\tif (error) {\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror: \"Failed to update template\",\n\t\t\t\t};\n\t\t\t}\n\t\t} else {\n\t\t\t// Insert new template\n\t\t\tconst { error } = await supabase\n\t\t\t\t.from(\"communication_templates\")\n\t\t\t\t.insert(templateData);\n\n\t\t\tif (error) {\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror: \"Failed to save template\",\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// Revalidate settings page\n\t\trevalidatePath(\"/dashboard/settings/communications/invoice-email-template\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t};\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Failed to save template\",\n\t\t};\n\t}\n}\n","/**\n * Bulk Email Sender - Safe bulk email sending with rate limiting\n *\n * Features:\n * - Rate limiting to respect Resend API limits\n * - Batch processing to avoid overwhelming the API\n * - Progress tracking for UI feedback\n * - Individual error handling per email\n * - Automatic retry for failed emails\n * - Configurable delay between batches\n */\n\nimport type { ReactElement } from \"react\";\nimport { sendEmail } from \"./email-sender\";\nimport type { EmailTemplate } from \"./email-types\";\n\n// Resend API rate limits:\n// - Free tier: 100 emails/day, 1 email/second\n// - Paid tier: Varies by plan, typically 10-50 emails/second\n// We'll use conservative defaults to avoid rate limiting\n\nexport type BulkEmailConfig = {\n\t/** Maximum emails to send in a single batch (default: 10) */\n\tbatchSize?: number;\n\t/** Delay between batches in milliseconds (default: 1000ms = 1 second) */\n\tbatchDelay?: number;\n\t/** Maximum number of retry attempts for failed emails (default: 2) */\n\tmaxRetries?: number;\n\t/** Delay between retries in milliseconds (default: 5000ms = 5 seconds) */\n\tretryDelay?: number;\n};\n\nexport type BulkEmailItem = {\n\tto: string;\n\tsubject: string;\n\ttemplate: ReactElement;\n\ttemplateType: EmailTemplate;\n\treplyTo?: string;\n\ttags?: { name: string; value: string }[];\n\t/** Optional identifier for tracking (e.g., invoice ID) */\n\titemId?: string;\n};\n\nexport type BulkEmailResult = {\n\t/** Total number of emails attempted */\n\ttotal: number;\n\t/** Number of emails sent successfully */\n\tsuccessful: number;\n\t/** Number of emails that failed */\n\tfailed: number;\n\t/** Details for each email */\n\tresults: Array<{\n\t\tto: string;\n\t\titemId?: string;\n\t\tsuccess: boolean;\n\t\terror?: string;\n\t\temailId?: string;\n\t}>;\n\t/** Overall success (true if all emails sent) */\n\tallSuccessful: boolean;\n};\n\n/**\n * Delay execution for specified milliseconds\n */\nfunction delay(ms: number): Promise<void> {\n\treturn new Promise((resolve) => setTimeout(resolve, ms));\n}\n\n/**\n * Send emails in bulk with rate limiting and error handling\n *\n * This function safely sends multiple emails while respecting Resend's rate limits:\n * 1. Splits emails into small batches\n * 2. Sends each batch sequentially with delays\n * 3. Tracks success/failure for each email\n * 4. Retries failed emails automatically\n * 5. Returns detailed results for each email\n *\n * @param emails - Array of emails to send\n * @param config - Configuration for batch processing\n * @returns Promise with detailed results for all emails\n *\n * @example\n * const results = await sendBulkEmails([\n *   {\n *     to: \"customer1@example.com\",\n *     subject: \"Invoice #001\",\n *     template: <InvoiceEmail />,\n *     templateType: \"invoice\",\n *     itemId: \"inv_001\"\n *   },\n *   // ... more emails\n * ], {\n *   batchSize: 5,\n *   batchDelay: 1000\n * });\n *\n * console.log(`Sent ${results.successful}/${results.total} emails`);\n */\nexport async function sendBulkEmails(\n\temails: BulkEmailItem[],\n\tconfig: BulkEmailConfig = {},\n): Promise<BulkEmailResult> {\n\tconst {\n\t\tbatchSize = 10, // Conservative batch size\n\t\tbatchDelay = 1000, // 1 second between batches\n\t\tmaxRetries = 2,\n\t\tretryDelay = 5000, // 5 seconds between retries\n\t} = config;\n\n\tconst results: BulkEmailResult = {\n\t\ttotal: emails.length,\n\t\tsuccessful: 0,\n\t\tfailed: 0,\n\t\tresults: [],\n\t\tallSuccessful: false,\n\t};\n\n\t// Process emails in batches\n\tfor (let i = 0; i < emails.length; i += batchSize) {\n\t\tconst batch = emails.slice(i, i + batchSize);\n\n\t\t// Send all emails in current batch concurrently\n\t\tconst batchPromises = batch.map(async (email) => {\n\t\t\tlet lastError: string | undefined;\n\t\t\tlet attempts = 0;\n\n\t\t\t// Try sending with retries\n\t\t\twhile (attempts <= maxRetries) {\n\t\t\t\ttry {\n\t\t\t\t\tconst result = await sendEmail({\n\t\t\t\t\t\tto: email.to,\n\t\t\t\t\t\tsubject: email.subject,\n\t\t\t\t\t\ttemplate: email.template,\n\t\t\t\t\t\ttemplateType: email.templateType,\n\t\t\t\t\t\treplyTo: email.replyTo,\n\t\t\t\t\t\ttags: [\n\t\t\t\t\t\t\t...(email.tags || []),\n\t\t\t\t\t\t\t{ name: \"bulk_send\", value: \"true\" },\n\t\t\t\t\t\t\t{ name: \"attempt\", value: String(attempts + 1) },\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\n\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tto: email.to,\n\t\t\t\t\t\t\titemId: email.itemId,\n\t\t\t\t\t\t\tsuccess: true,\n\t\t\t\t\t\t\temailId: result.data?.id,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\t// If not successful, record error and potentially retry\n\t\t\t\t\tlastError = result.error;\n\n\t\t\t\t\tif (attempts < maxRetries) {\n\t\t\t\t\t\tawait delay(retryDelay);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlastError = error instanceof Error ? error.message : \"Unknown error\";\n\n\t\t\t\t\tif (attempts < maxRetries) {\n\t\t\t\t\t\tawait delay(retryDelay);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tattempts++;\n\t\t\t}\n\n\t\t\t// All retries failed\n\t\t\treturn {\n\t\t\t\tto: email.to,\n\t\t\t\titemId: email.itemId,\n\t\t\t\tsuccess: false,\n\t\t\t\terror: lastError || \"Failed to send after retries\",\n\t\t\t};\n\t\t});\n\n\t\t// Wait for all emails in batch to complete\n\t\tconst batchResults = await Promise.all(batchPromises);\n\t\tresults.results.push(...batchResults);\n\n\t\t// Update counters\n\t\tfor (const result of batchResults) {\n\t\t\tif (result.success) {\n\t\t\t\tresults.successful++;\n\t\t\t} else {\n\t\t\t\tresults.failed++;\n\t\t\t}\n\t\t}\n\n\t\t// Delay before next batch (except for last batch)\n\t\tif (i + batchSize < emails.length) {\n\t\t\tawait delay(batchDelay);\n\t\t}\n\t}\n\n\tresults.allSuccessful = results.failed === 0;\n\n\treturn results;\n}\n\n/**\n * Estimate time to send bulk emails in milliseconds\n *\n * Useful for showing estimated completion time to users\n *\n * @param emailCount - Number of emails to send\n * @param config - Batch configuration\n * @returns Estimated time in milliseconds\n */\nfunction estimateBulkSendTime(\n\temailCount: number,\n\tconfig: BulkEmailConfig = {},\n): number {\n\tconst { batchSize = 10, batchDelay = 1000 } = config;\n\n\tconst batchCount = Math.ceil(emailCount / batchSize);\n\tconst totalDelay = (batchCount - 1) * batchDelay;\n\n\t// Estimate ~500ms per email for processing + delays\n\tconst estimatedProcessingTime = emailCount * 500;\n\n\treturn estimatedProcessingTime + totalDelay;\n}\n\n/**\n * Format estimated time for display\n *\n * @param milliseconds - Time in milliseconds\n * @returns Human-readable time string\n */\nfunction formatEstimatedTime(milliseconds: number): string {\n\tconst seconds = Math.ceil(milliseconds / 1000);\n\n\tif (seconds < 60) {\n\t\treturn `${seconds} second${seconds !== 1 ? \"s\" : \"\"}`;\n\t}\n\n\tconst minutes = Math.ceil(seconds / 60);\n\treturn `${minutes} minute${minutes !== 1 ? \"s\" : \"\"}`;\n}\n","/**\n * Bulk Communications Actions\n *\n * Server actions for sending bulk emails for invoices and estimates\n * with progress tracking and error handling\n */\n\n\"use server\";\n\nimport { format } from \"date-fns\";\nimport { revalidatePath } from \"next/cache\";\nimport { loadInvoiceEmailTemplate } from \"@/actions/settings/invoice-email-template\";\nimport type {\n\tBulkEmailConfig,\n\tBulkEmailResult,\n} from \"@/lib/email/bulk-email-sender\";\nimport { sendBulkEmails } from \"@/lib/email/bulk-email-sender\";\nimport { EmailTemplate } from \"@/lib/email/email-types\";\nimport { generatePaymentToken } from \"@/lib/payments/payment-tokens\";\nimport { createClient } from \"@/lib/supabase/server\";\n\ntype SupabaseServerClient = Exclude<\n\tAwaited<ReturnType<typeof createClient>>,\n\tnull\n>;\n\nconst PAYMENT_TOKEN_TTL_SECONDS = 87_600;\nconst PAYMENT_TOKEN_MAX_REDEMPTIONS = 999_999;\nconst CENTS_IN_DOLLAR = 100;\nconst DEFAULT_CURRENCY = \"USD\";\nconst APP_URL = process.env.NEXT_PUBLIC_APP_URL ?? \"\";\nconst SITE_URL = process.env.NEXT_PUBLIC_SITE_URL ?? APP_URL;\nconst VALUED_CUSTOMER_LABEL = \"Valued Customer\";\nconst FALLBACK_COMPANY_NAME = \"Company\";\nconst TRAILING_SLASH_REGEX = /\\/$/;\n\ntype InvoiceTemplateConfig = {\n\tsubject: string;\n\tbody: string;\n\tfooter: string;\n};\n\nconst DEFAULT_INVOICE_TEMPLATE: InvoiceTemplateConfig = {\n\tsubject: \"Invoice {{invoice_number}} from {{company_name}}\",\n\tbody: \"Hi {{customer_name}},\\n\\nPlease find attached your invoice {{invoice_number}} for {{invoice_amount}}.\\n\\nPayment is due by {{due_date}}.\\n\\nYou can securely pay your invoice online:\\n{{payment_link}}\\n\\nThank you!\",\n\tfooter: \"\",\n};\n\nclass BulkSendError extends Error {\n\treadonly userMessage: string;\n\treadonly details?: string;\n\n\tconstructor(userMessage: string, details?: string) {\n\t\tsuper(userMessage);\n\t\tthis.name = \"BulkSendError\";\n\t\tthis.userMessage = userMessage;\n\t\tthis.details = details;\n\t}\n}\n\ntype CustomerRecord = {\n\tid: string;\n\tfirst_name: string | null;\n\tlast_name: string | null;\n\temail: string | null;\n\tcompany_name: string | null;\n};\n\ntype InvoiceRow = {\n\tid: string;\n\tinvoice_number: string;\n\ttotal_amount: number | null;\n\tstatus: string | null;\n\tcompany_id: string;\n\tcustomer_id: string | null;\n\tjob_id: string | null;\n\tcreated_at: string | null;\n\tdue_date: string | null;\n\tnotes: string | null;\n\tcustomer: CustomerRecord | CustomerRecord[] | null;\n};\n\ntype NormalizedInvoice = Omit<InvoiceRow, \"customer\"> & {\n\tcustomer: CustomerRecord | null;\n};\n\ntype InvoiceWithEmail = NormalizedInvoice & {\n\tcustomer: CustomerRecord & { email: string };\n};\n\ntype CompanyProfile = {\n\tname: string | null;\n\temail: string | null;\n\tphone: string | null;\n};\n\ntype BulkSendInvoicesResult = {\n\tsuccess: boolean;\n\tmessage: string;\n\tresults?: BulkEmailResult;\n\terror?: string;\n};\n\n/**\n * Send multiple invoices via email\n *\n * @param invoiceIds - Array of invoice IDs to send\n * @param config - Optional configuration for batch processing\n * @returns Result with success/failure counts\n */\nexport async function bulkSendInvoices(\n\tinvoiceIds: string[],\n\tconfig?: BulkEmailConfig,\n): Promise<BulkSendInvoicesResult> {\n\ttry {\n\t\tconst supabase = await ensureSupabaseClient();\n\t\tconst user = await requireUser(supabase);\n\t\tconst companyId = await requireCompanyId(supabase, user.id);\n\t\tconst invoices = await fetchInvoicesWithCustomers(\n\t\t\tsupabase,\n\t\t\tinvoiceIds,\n\t\t\tcompanyId,\n\t\t);\n\t\tconst normalizedInvoices = normalizeInvoices(invoices);\n\t\tconst validInvoices = normalizedInvoices.filter(hasCustomerEmail);\n\n\t\tif (validInvoices.length === 0) {\n\t\t\tthrow new BulkSendError(\n\t\t\t\t\"No valid invoices to send\",\n\t\t\t\t\"None of the selected invoices have customer email addresses\",\n\t\t\t);\n\t\t}\n\n\t\tconst [emailTemplate, company] = await Promise.all([\n\t\t\tloadInvoiceTemplateConfig(),\n\t\t\tfetchCompanyProfile(supabase, companyId),\n\t\t]);\n\n\t\tconst emails = await buildInvoiceEmails({\n\t\t\tinvoices: validInvoices,\n\t\t\temailTemplate,\n\t\t\tcompany,\n\t\t});\n\n\t\tconst results = await sendBulkEmails(emails, config);\n\t\tconst successfulInvoiceIds = getSuccessfulItemIds(results);\n\n\t\tif (successfulInvoiceIds.length > 0) {\n\t\t\tawait markInvoicesSent(supabase, successfulInvoiceIds);\n\t\t}\n\n\t\trevalidateInvoices(successfulInvoiceIds);\n\n\t\treturn {\n\t\t\tsuccess: results.allSuccessful,\n\t\t\tmessage: buildInvoiceResultMessage({\n\t\t\t\tresults,\n\t\t\t\ttotal: invoices.length,\n\t\t\t\tvalid: validInvoices.length,\n\t\t\t}),\n\t\t\tresults,\n\t\t};\n\t} catch (error) {\n\t\treturn buildBulkSendFailure(\"Failed to send invoices\", error);\n\t}\n}\n\ntype BuildInvoiceEmailsParams = {\n\tinvoices: InvoiceWithEmail[];\n\temailTemplate: InvoiceTemplateConfig;\n\tcompany?: CompanyProfile | null;\n};\n\ntype EmailPayload = Parameters<typeof sendBulkEmails>[0][number];\n\nconst ensureSupabaseClient = async (): Promise<SupabaseServerClient> => {\n\tconst supabase = await createClient();\n\tif (!supabase) {\n\t\tthrow new BulkSendError(\n\t\t\t\"Database connection failed\",\n\t\t\t\"Unable to connect to database\",\n\t\t);\n\t}\n\treturn supabase as SupabaseServerClient;\n};\n\nconst requireUser = async (supabase: SupabaseServerClient) => {\n\tconst {\n\t\tdata: { user },\n\t} = await supabase.auth.getUser();\n\tif (!user) {\n\t\tthrow new BulkSendError(\n\t\t\t\"Authentication required\",\n\t\t\t\"You must be logged in to send invoices\",\n\t\t);\n\t}\n\treturn user;\n};\n\nconst requireCompanyId = async (\n\tsupabase: SupabaseServerClient,\n\tuserId: string,\n): Promise<string> => {\n\tconst { data, error } = await supabase\n\t\t.from(\"company_memberships\")\n\t\t.select(\"company_id\")\n\t\t.eq(\"user_id\", userId)\n\t\t.eq(\"status\", \"active\")\n\t\t.limit(1)\n\t\t.single();\n\n\tif (error) {\n\t\tthrow new BulkSendError(\n\t\t\t\"Failed to verify company membership\",\n\t\t\terror.message,\n\t\t);\n\t}\n\n\tif (!data?.company_id) {\n\t\tthrow new BulkSendError(\n\t\t\t\"Company association required\",\n\t\t\t\"You must be part of a company to send invoices\",\n\t\t);\n\t}\n\n\treturn data.company_id;\n};\n\nconst fetchInvoicesWithCustomers = async (\n\tsupabase: SupabaseServerClient,\n\tinvoiceIds: string[],\n\tcompanyId: string,\n): Promise<InvoiceRow[]> => {\n\tconst { data, error } = await supabase\n\t\t.from(\"invoices\")\n\t\t.select(\n\t\t\t`\n        id,\n        invoice_number,\n        total_amount,\n        status,\n        company_id,\n        customer_id,\n        job_id,\n        created_at,\n        due_date,\n        notes,\n        customer:customers!customer_id(\n          id,\n          first_name,\n          last_name,\n          email,\n          company_name\n        )\n      `,\n\t\t)\n\t\t.in(\"id\", invoiceIds)\n\t\t.eq(\"company_id\", companyId);\n\n\tif (error || !data) {\n\t\tthrow new BulkSendError(\n\t\t\t\"Failed to fetch invoices\",\n\t\t\terror?.message || \"Unable to retrieve invoices\",\n\t\t);\n\t}\n\n\treturn data as InvoiceRow[];\n};\n\nconst normalizeInvoices = (invoices: InvoiceRow[]): NormalizedInvoice[] =>\n\tinvoices.map((invoice) => {\n\t\tconst rawCustomer = invoice.customer;\n\t\tconst customer = Array.isArray(rawCustomer)\n\t\t\t? (rawCustomer[0] ?? null)\n\t\t\t: rawCustomer;\n\t\treturn { ...invoice, customer };\n\t});\n\nconst hasCustomerEmail = (\n\tinvoice: NormalizedInvoice,\n): invoice is InvoiceWithEmail => Boolean(invoice.customer?.email);\n\nconst loadInvoiceTemplateConfig = async (): Promise<InvoiceTemplateConfig> => {\n\tconst templateResult = await loadInvoiceEmailTemplate();\n\tif (templateResult.success && templateResult.data) {\n\t\treturn templateResult.data;\n\t}\n\treturn DEFAULT_INVOICE_TEMPLATE;\n};\n\nconst fetchCompanyProfile = async (\n\tsupabase: SupabaseServerClient,\n\tcompanyId: string,\n): Promise<CompanyProfile | null> => {\n\tconst { data, error } = await supabase\n\t\t.from(\"companies\")\n\t\t.select(\"name, email, phone\")\n\t\t.eq(\"id\", companyId)\n\t\t.single();\n\n\tif (error) {\n\t\tthrow new BulkSendError(\"Failed to load company profile\", error.message);\n\t}\n\n\treturn data ?? null;\n};\n\nconst buildInvoiceEmails = async ({\n\tinvoices,\n\temailTemplate,\n\tcompany,\n}: BuildInvoiceEmailsParams): Promise<EmailPayload[]> => {\n\tconst { InvoiceEmail } = await import(\"@/lib/email/templates\");\n\n\t// PERFORMANCE OPTIMIZED: Pattern #3 Fix - Batch token generation\n\t// BEFORE: 20 sequential token generation queries (1 per invoice)\n\t// AFTER: 20 parallel token generation queries (via Promise.all in batch function)\n\t// Performance gain: ~5 seconds saved (75% reduction from sequential to parallel)\n\tconst { generatePaymentTokensBatch } = await import(\n\t\t\"@/lib/payments/payment-tokens\"\n\t);\n\tconst PAYMENT_TOKEN_TTL_SECONDS = 72 * 3600; // 72 hours in seconds\n\tconst PAYMENT_TOKEN_MAX_REDEMPTIONS = 1;\n\n\tconst paymentTokens = await generatePaymentTokensBatch(\n\t\tinvoices.map((inv) => inv.id),\n\t\tPAYMENT_TOKEN_TTL_SECONDS / 3600, // Convert seconds to hours\n\t\tPAYMENT_TOKEN_MAX_REDEMPTIONS,\n\t);\n\n\treturn invoices.map((invoice) => {\n\t\tconst paymentLink =\n\t\t\tpaymentTokens[invoice.id]?.paymentLink ||\n\t\t\t`${APP_URL}/pay/${encodeURIComponent(invoice.id)}`;\n\t\tconst customerName = resolveCustomerName(invoice.customer);\n\t\tconst replacements = {\n\t\t\t\"{{customer_name}}\": customerName,\n\t\t\t\"{{invoice_number}}\": invoice.invoice_number,\n\t\t\t\"{{invoice_amount}}\": formatInvoiceAmount(invoice.total_amount),\n\t\t\t\"{{due_date}}\": formatInvoiceDueDate(invoice.due_date),\n\t\t\t\"{{payment_link}}\": paymentLink,\n\t\t\t\"{{company_name}}\": company?.name || FALLBACK_COMPANY_NAME,\n\t\t\t\"{{company_email}}\": company?.email || \"\",\n\t\t\t\"{{company_phone}}\": company?.phone || \"\",\n\t\t};\n\n\t\tlet subject = emailTemplate.subject;\n\t\tlet body = emailTemplate.body;\n\t\tlet footer = emailTemplate.footer;\n\n\t\tfor (const [key, value] of Object.entries(replacements)) {\n\t\t\tconst pattern = new RegExp(key, \"g\");\n\t\t\tsubject = subject.replace(pattern, value);\n\t\t\tbody = body.replace(pattern, value);\n\t\t\tfooter = footer.replace(pattern, value);\n\t\t}\n\n\t\treturn {\n\t\t\tto: invoice.customer.email,\n\t\t\tsubject,\n\t\t\ttemplate: InvoiceEmail({\n\t\t\t\tinvoiceNumber: invoice.invoice_number,\n\t\t\t\tcustomerName,\n\t\t\t\tinvoiceDate: invoice.created_at ?? new Date().toISOString(),\n\t\t\t\tdueDate: invoice.due_date ?? undefined,\n\t\t\t\ttotalAmount: invoice.total_amount ?? 0,\n\t\t\t\tnotes: invoice.notes ?? undefined,\n\t\t\t\tinvoiceUrl: `${APP_URL}/dashboard/work/invoices/${invoice.id}`,\n\t\t\t\tpaymentLink,\n\t\t\t\tcustomBody: body,\n\t\t\t\tcustomFooter: footer,\n\t\t\t}),\n\t\t\ttemplateType: EmailTemplate.INVOICE,\n\t\t\titemId: invoice.id,\n\t\t\ttags: [\n\t\t\t\t{ name: \"invoice_id\", value: invoice.id },\n\t\t\t\t{ name: \"invoice_number\", value: invoice.invoice_number },\n\t\t\t\t{ name: \"has_payment_link\", value: \"true\" },\n\t\t\t],\n\t\t};\n\t});\n};\n\nconst resolvePaymentLink = async (invoiceId: string): Promise<string> => {\n\tconst paymentToken = await generatePaymentToken(\n\t\tinvoiceId,\n\t\tPAYMENT_TOKEN_TTL_SECONDS,\n\t\tPAYMENT_TOKEN_MAX_REDEMPTIONS,\n\t);\n\tconst baseUrl = APP_URL ? APP_URL.replace(TRAILING_SLASH_REGEX, \"\") : \"\";\n\treturn (\n\t\tpaymentToken?.paymentLink ||\n\t\t`${baseUrl}/pay/${encodeURIComponent(invoiceId)}`\n\t);\n};\n\nconst resolveCustomerName = (\n\tcustomer: CustomerRecord & { email: string },\n): string =>\n\tcustomer?.company_name ||\n\t`${customer?.first_name ?? \"\"} ${customer?.last_name ?? \"\"}`.trim() ||\n\tVALUED_CUSTOMER_LABEL;\n\nconst formatInvoiceAmount = (amount: number | null | undefined): string =>\n\tnew Intl.NumberFormat(\"en-US\", {\n\t\tstyle: \"currency\",\n\t\tcurrency: DEFAULT_CURRENCY,\n\t}).format(((amount ?? 0) as number) / CENTS_IN_DOLLAR);\n\nconst formatInvoiceDueDate = (date: string | null): string =>\n\tdate ? format(new Date(date), \"MMMM dd, yyyy\") : \"Upon receipt\";\n\nconst getSuccessfulItemIds = (results: BulkEmailResult): string[] => {\n\tconst items = results.results ?? [];\n\treturn items\n\t\t.filter(\n\t\t\t(item): item is typeof item & { itemId: string } =>\n\t\t\t\tBoolean(item.itemId) && item.success,\n\t\t)\n\t\t.map((item) => item.itemId as string);\n};\n\nconst markInvoicesSent = async (\n\tsupabase: SupabaseServerClient,\n\tinvoiceIds: string[],\n) => {\n\tconst { error } = await supabase\n\t\t.from(\"invoices\")\n\t\t.update({\n\t\t\tsent_at: new Date().toISOString(),\n\t\t\tstatus: \"sent\",\n\t\t})\n\t\t.in(\"id\", invoiceIds);\n\n\tif (error) {\n\t\tthrow new BulkSendError(\"Failed to update invoice statuses\", error.message);\n\t}\n};\n\nconst revalidateInvoices = (invoiceIds: string[]): void => {\n\trevalidatePath(\"/dashboard/work/invoices\");\n\tfor (const id of invoiceIds) {\n\t\trevalidatePath(`/dashboard/work/invoices/${id}`);\n\t}\n};\n\nconst buildInvoiceResultMessage = ({\n\tresults,\n\ttotal,\n\tvalid,\n}: {\n\tresults: BulkEmailResult;\n\ttotal: number;\n\tvalid: number;\n}): string => {\n\tconst skippedCount = total - valid;\n\tconst parts = [\n\t\t`Successfully sent ${results.successful} invoice${results.successful !== 1 ? \"s\" : \"\"}`,\n\t];\n\n\tif (results.failed > 0) {\n\t\tparts.push(`${results.failed} failed`);\n\t}\n\n\tif (skippedCount > 0) {\n\t\tparts.push(`${skippedCount} skipped (no email)`);\n\t}\n\n\treturn parts.join(\", \");\n};\n\nconst buildEstimateEmails = async (\n\testimates: InvoiceWithEmail[],\n): Promise<EmailPayload[]> => {\n\tconst { EstimateEmail } = await import(\"@/lib/email/templates\");\n\treturn estimates.map((estimate) => ({\n\t\tto: estimate.customer.email,\n\t\tsubject: `Estimate ${estimate.invoice_number}`,\n\t\ttemplate: EstimateEmail({\n\t\t\testimateNumber: estimate.invoice_number,\n\t\t\tcustomerName: resolveCustomerName(estimate.customer),\n\t\t\testimateDate: estimate.created_at ?? new Date().toISOString(),\n\t\t\tvalidUntil: estimate.due_date ?? undefined,\n\t\t\ttotalAmount: estimate.total_amount ?? 0,\n\t\t\tnotes: estimate.notes ?? undefined,\n\t\t\testimateUrl: `${SITE_URL}/dashboard/work/estimates/${estimate.id}`,\n\t\t}),\n\t\ttemplateType: EmailTemplate.ESTIMATE,\n\t\titemId: estimate.id,\n\t\ttags: [\n\t\t\t{ name: \"estimate_id\", value: estimate.id },\n\t\t\t{ name: \"estimate_number\", value: estimate.invoice_number },\n\t\t],\n\t}));\n};\n\nconst revalidateEstimates = (estimateIds: string[]): void => {\n\trevalidatePath(\"/dashboard/work/estimates\");\n\tfor (const id of estimateIds) {\n\t\trevalidatePath(`/dashboard/work/estimates/${id}`);\n\t}\n};\n\nconst buildEstimateResultMessage = ({\n\tresults,\n\ttotal,\n\tvalid,\n}: {\n\tresults: BulkEmailResult;\n\ttotal: number;\n\tvalid: number;\n}): string => {\n\tconst skippedCount = total - valid;\n\tconst parts = [\n\t\t`Successfully sent ${results.successful} estimate${results.successful !== 1 ? \"s\" : \"\"}`,\n\t];\n\n\tif (results.failed > 0) {\n\t\tparts.push(`${results.failed} failed`);\n\t}\n\n\tif (skippedCount > 0) {\n\t\tparts.push(`${skippedCount} skipped (no email)`);\n\t}\n\n\treturn parts.join(\", \");\n};\n\nconst buildBulkSendFailure = (\n\tfallbackMessage: string,\n\terror: unknown,\n): BulkSendInvoicesResult => {\n\tif (error instanceof BulkSendError) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\tmessage: error.userMessage,\n\t\t\terror: error.details ?? error.userMessage,\n\t\t};\n\t}\n\n\treturn {\n\t\tsuccess: false,\n\t\tmessage: fallbackMessage,\n\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t};\n};\n\n/**\n * Send multiple estimates via email\n *\n * @param estimateIds - Array of estimate IDs to send\n * @param config - Optional configuration for batch processing\n * @returns Result with success/failure counts\n */\nexport async function bulkSendEstimates(\n\testimateIds: string[],\n\tconfig?: BulkEmailConfig,\n): Promise<BulkSendInvoicesResult> {\n\ttry {\n\t\tconst supabase = await ensureSupabaseClient();\n\t\tconst user = await requireUser(supabase);\n\t\tconst companyId = await requireCompanyId(supabase, user.id);\n\t\tconst estimates = await fetchInvoicesWithCustomers(\n\t\t\tsupabase,\n\t\t\testimateIds,\n\t\t\tcompanyId,\n\t\t);\n\t\tconst normalizedEstimates = normalizeInvoices(estimates);\n\t\tconst validEstimates = normalizedEstimates.filter(hasCustomerEmail);\n\n\t\tif (validEstimates.length === 0) {\n\t\t\tthrow new BulkSendError(\n\t\t\t\t\"No valid estimates to send\",\n\t\t\t\t\"None of the selected estimates have customer email addresses\",\n\t\t\t);\n\t\t}\n\n\t\tconst emails = await buildEstimateEmails(validEstimates);\n\t\tconst results = await sendBulkEmails(emails, config);\n\t\tconst successfulEstimateIds = getSuccessfulItemIds(results);\n\n\t\tif (successfulEstimateIds.length > 0) {\n\t\t\tawait markInvoicesSent(supabase, successfulEstimateIds);\n\t\t}\n\n\t\trevalidateEstimates(successfulEstimateIds);\n\n\t\treturn {\n\t\t\tsuccess: results.allSuccessful,\n\t\t\tmessage: buildEstimateResultMessage({\n\t\t\t\tresults,\n\t\t\t\ttotal: estimates.length,\n\t\t\t\tvalid: validEstimates.length,\n\t\t\t}),\n\t\t\tresults,\n\t\t};\n\t} catch (error) {\n\t\treturn buildBulkSendFailure(\"Failed to send estimates\", error);\n\t}\n}\n","\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport {\n\tActionError,\n\tassertAuthenticated,\n\tassertSupabase,\n\tERROR_CODES,\n\twithErrorHandling,\n} from \"@/lib/errors/with-error-handling\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport type { ActionResult } from \"@/types/action-result\";\n\nconst HTTP_STATUS = {\n\tforbidden: 403,\n} as const;\n\nconst PERMANENT_DELETE_BUFFER_DAYS = 90;\nconst MILLISECONDS_IN_DAY = 86_400_000;\n\ntype BulkArchiveResult = {\n\tsuccessful: number;\n\tfailed: number;\n\tskipped: number;\n\terrors: Array<{ id: string; error: string }>;\n};\n\ntype InvoiceRecord = {\n\tid: string;\n\tstatus: string;\n\tcompany_id: string;\n};\n\ntype InvoiceAudit = {\n\tarchivableIds: string[];\n\tfailed: number;\n\tskipped: number;\n\terrors: BulkArchiveResult[\"errors\"];\n};\n\n/**\n * Bulk archive multiple invoices at once\n * - Filters out paid invoices automatically\n * - Uses a single database transaction for performance\n * - Returns detailed results\n */\nexport async function bulkArchiveInvoices(\n\tinvoiceIds: string[],\n): Promise<ActionResult<BulkArchiveResult>> {\n\tconst actionResult = await withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tassertSupabase(supabase);\n\n\t\t// Authenticate user\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\t// Get active company ID\n\t\tconst companyId = await getActiveCompanyId();\n\t\tif (!companyId) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"You must be part of a company\",\n\t\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t\tHTTP_STATUS.forbidden,\n\t\t\t);\n\t\t}\n\n\t\t// Fetch all invoices to verify ownership and status\n\t\tconst { data: invoices, error: fetchError } = await supabase\n\t\t\t.from(\"invoices\")\n\t\t\t.select(\"id, status, company_id\")\n\t\t\t.in(\"id\", invoiceIds)\n\t\t\t.returns<InvoiceRecord[]>();\n\n\t\tif (fetchError) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Failed to fetch invoices\",\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst { archivableIds, failed, skipped, errors } = evaluateInvoices(\n\t\t\tinvoices ?? [],\n\t\t\tcompanyId,\n\t\t);\n\n\t\t// Bulk archive in single query\n\t\tlet successful = 0;\n\t\tif (archivableIds.length > 0) {\n\t\t\tconst now = new Date().toISOString();\n\t\t\tconst scheduledDeletion = new Date(\n\t\t\t\tDate.now() + PERMANENT_DELETE_BUFFER_DAYS * MILLISECONDS_IN_DAY,\n\t\t\t).toISOString();\n\n\t\t\tconst { error: archiveError } = await supabase\n\t\t\t\t.from(\"invoices\")\n\t\t\t\t.update({\n\t\t\t\t\tdeleted_at: now,\n\t\t\t\t\tdeleted_by: user.id,\n\t\t\t\t\tarchived_at: now,\n\t\t\t\t\tpermanent_delete_scheduled_at: scheduledDeletion,\n\t\t\t\t})\n\t\t\t\t.in(\"id\", archivableIds);\n\n\t\t\tif (archiveError) {\n\t\t\t\tthrow new ActionError(\n\t\t\t\t\t\"Failed to archive invoices\",\n\t\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tsuccessful = archivableIds.length;\n\t\t}\n\n\t\t// Revalidate the page\n\t\trevalidatePath(\"/dashboard/work/invoices\");\n\n\t\treturn {\n\t\t\tsuccessful,\n\t\t\tfailed,\n\t\t\tskipped,\n\t\t\terrors,\n\t\t};\n\t});\n\n\tif (actionResult.success) {\n\t\treturn {\n\t\t\t...actionResult,\n\t\t\tmessage: generateSummaryMessage(actionResult.data),\n\t\t};\n\t}\n\n\treturn actionResult;\n}\n\n/**\n * Generate a user-friendly summary message\n */\nfunction generateSummaryMessage(result: BulkArchiveResult): string {\n\tconst parts: string[] = [];\n\n\tif (result.successful > 0) {\n\t\tparts.push(\n\t\t\t`${result.successful} invoice${result.successful !== 1 ? \"s\" : \"\"} archived`,\n\t\t);\n\t}\n\n\tif (result.skipped > 0) {\n\t\tparts.push(\n\t\t\t`${result.skipped} paid invoice${result.skipped !== 1 ? \"s\" : \"\"} skipped`,\n\t\t);\n\t}\n\n\tif (result.failed > 0) {\n\t\tparts.push(\n\t\t\t`${result.failed} invoice${result.failed !== 1 ? \"s\" : \"\"} failed`,\n\t\t);\n\t}\n\n\treturn parts.join(\", \");\n}\n\nfunction evaluateInvoices(\n\tinvoices: InvoiceRecord[],\n\tcompanyId: string,\n): InvoiceAudit {\n\treturn invoices.reduce<InvoiceAudit>(\n\t\t(audit, invoice) => {\n\t\t\tif (invoice.company_id !== companyId) {\n\t\t\t\taudit.failed++;\n\t\t\t\taudit.errors.push({ id: invoice.id, error: \"Access denied\" });\n\t\t\t\treturn audit;\n\t\t\t}\n\n\t\t\tif (invoice.status === \"paid\") {\n\t\t\t\taudit.skipped++;\n\t\t\t\treturn audit;\n\t\t\t}\n\n\t\t\taudit.archivableIds.push(invoice.id);\n\t\t\treturn audit;\n\t\t},\n\t\t{\n\t\t\tarchivableIds: [],\n\t\t\tfailed: 0,\n\t\t\tskipped: 0,\n\t\t\terrors: [],\n\t\t},\n\t);\n}\n","export {getCurrentUserRole as '001f005176797ef23488068124fb9a744915a477de'} from 'ACTIONS_MODULE0'\nexport {canDeleteTeamMember as '406f6624261c6dd1a908026fa1408a3f6d507b6e7d'} from 'ACTIONS_MODULE0'\nexport {getPayrixMerchantAccount as '40704f0e856ad801ef93b43436f219a36f7c0efd2c'} from 'ACTIONS_MODULE1'\nexport {getWebRTCCredentials as '000478fbf5363dae5000d525663da13e29908cb952'} from 'ACTIONS_MODULE2'\nexport {transcribeCallRecording as '4002f454c46f4c21ca6e9e26362583ccff69c9f914'} from 'ACTIONS_MODULE2'\nexport {getCompanyPhoneNumbers as '4019cf9f81eb3c06f82b5c2f8eb042f3d95d91e933'} from 'ACTIONS_MODULE2'\nexport {getCallRoutingRules as '40247c617842c31b242455a0961cbd2c3297606a16'} from 'ACTIONS_MODULE2'\nexport {updateCallRoutingRule as '40413bfa888916480edbc33ebb812158fddf960f89'} from 'ACTIONS_MODULE2'\nexport {startCallRecording as '404e47931374ad2a1b54bc11f357703790f6104530'} from 'ACTIONS_MODULE2'\nexport {transferActiveCall as '405a16958f97c37bd4b5711bd8761510bdab55839f'} from 'ACTIONS_MODULE2'\nexport {searchPhoneNumbers as '406864ae05b8b51c66cc2c335999e5011a41cb521f'} from 'ACTIONS_MODULE2'\nexport {makeCall as '40b2df540ec465c5dc19545c96486485bb50b5633b'} from 'ACTIONS_MODULE2'\nexport {sendTextMessage as '40d050abdabe2ee7293436c505c5f27b4408a2f27c'} from 'ACTIONS_MODULE2'\nexport {stopCallRecording as '40d5cc291162e2fd61245bdb851d5e8ed609e4ed19'} from 'ACTIONS_MODULE2'\nexport {sendMMSMessage as '40edd91786b2a482e617fb16f2474d26ec295435e7'} from 'ACTIONS_MODULE2'\nexport {purchasePhoneNumber as '40fd6a80b32792fab749933f98f07503d8e94c0305'} from 'ACTIONS_MODULE2'\nexport {deleteCallRoutingRule as '607d0f958daf66b2a0d5277cdda17600dace5156bb'} from 'ACTIONS_MODULE2'\nexport {toggleCallRoutingRule as '60853f1e409364f7e171e27229217994ff224414e6'} from 'ACTIONS_MODULE2'\nexport {createServiceSupabaseClient as '00a13dbd00149949fc1367d3e76ae7d789e07f5321'} from 'ACTIONS_MODULE3'\nexport {ensureMessagingBranding as '606753f8910b46d5792f4bdeb457cdf29d1a8bbadc'} from 'ACTIONS_MODULE4'\nexport {ensureMessagingCampaign as '70a648f43fa62ae3dcf2070eb90413e96e81591e77'} from 'ACTIONS_MODULE4'\nexport {checkTelnyxVerificationStatus as '007505a78985e53e083a498c97761ed8a463d3d379'} from 'ACTIONS_MODULE5'\nexport {submitAutomatedVerification as '4087f0badccd6aaf6a28b640ab4bbc513f0832d105'} from 'ACTIONS_MODULE5'\nexport {registerCompanyFor10DLC as '40ae25402a089e45aa071d979e8cc6ad136205cc98'} from 'ACTIONS_MODULE5'\nexport {sendVerificationSubmittedEmail as '70f58c5ba46ef02b620d7dc87bae8fc83f6d480755'} from 'ACTIONS_MODULE6'\nexport {sendEmail as '40f8c061cf84f884e77af3425bc24b8a8d72f598fb'} from 'ACTIONS_MODULE7'\nexport {handleComplaintWebhook as '6045f8436f9cdfdadb7bfe3955677adfc5f4102de0'} from 'ACTIONS_MODULE7'\nexport {handleBounceWebhook as '78a8ea4f1cfa571a366adccf36ac04b1c85d61ae2b'} from 'ACTIONS_MODULE7'\nexport {runHealthCheckForAllDomains as '00c53a1f02416c3261983f8096f19a3450bfd51775'} from 'ACTIONS_MODULE8'\nexport {getDomainHealth as '400b8fb96146bfd004a3166563a5ab5536bb610c70'} from 'ACTIONS_MODULE8'\nexport {recordDeliveryEvent as '404d6f2891af89c71d5bde33d110a216bdd3ee4729'} from 'ACTIONS_MODULE8'\nexport {getCompanyDomainsHealth as '405c57a8fed352b8679525b56014eb8c49105c850c'} from 'ACTIONS_MODULE8'\nexport {processResendWebhookEvent as '40ad037af6f6ab1a3004746d3a1b65afa65527002d'} from 'ACTIONS_MODULE8'\nexport {generateDeliverabilityReport as '40ecf2c792e84ef4b898fda98ec27277b4a9dddef2'} from 'ACTIONS_MODULE8'\nexport {resetHourlyCounters as '004cdde5e6ae8991bab4ba61ae40647c2b823200ba'} from 'ACTIONS_MODULE9'\nexport {resetDailyCounters as '006acf41615a2f7795c47b6d7a3016e18300f2ad17'} from 'ACTIONS_MODULE9'\nexport {incrementEmailCounter as '4029b163c1c0acfd806352a72fe8030c8ae4f7f8ac'} from 'ACTIONS_MODULE9'\nexport {getCompanyActiveDomain as '407a5a7d0a7dd7989a963eb2485a3527c1dcb20a70'} from 'ACTIONS_MODULE9'\nexport {checkRateLimit as '40af86a915f04df8d7cc189fe26e45e0cc24663080'} from 'ACTIONS_MODULE9'\nexport {isGmailIntegrationEnabled as '00fe74bdf14126b5ad89e9480e82978d6357f356b3'} from 'ACTIONS_MODULE10'\nexport {getUserGmailTokens as '400ce95360aaffa14a99dfdf969ba5166c69a59eb6'} from 'ACTIONS_MODULE10'\nexport {disconnectCompanyGmail as '401d3d830065dd7c4777fad67f642392f48735c4ab'} from 'ACTIONS_MODULE10'\nexport {disconnectUserGmail as '404575d602ef4c60c0058b592b8c3e42fbcd13fc4c'} from 'ACTIONS_MODULE10'\nexport {getCompanyEmailProvider as '40787b1598849126560f9f0b0f8fe8967338c7bf28'} from 'ACTIONS_MODULE10'\nexport {getCompanyGmailTokens as '40beeb56302a20d27cd8ba7a0988310f855633d7e6'} from 'ACTIONS_MODULE10'\nexport {refreshUserGmailToken as '602fab67313b110e6ccb66e54b1e16450b2a772cc7'} from 'ACTIONS_MODULE10'\nexport {sendCompanyGmailEmail as '60302947fc4caffa53a719728f3c2cebace926098c'} from 'ACTIONS_MODULE10'\nexport {syncUserInbox as '603643b13bf288cc628303bb4d12df0311b11434c7'} from 'ACTIONS_MODULE10'\nexport {checkCompanyGmailHealth as '60856182db5eaec7f85eda2a5a94c5d7d3524325d6'} from 'ACTIONS_MODULE10'\nexport {refreshCompanyGmailToken as '60eeb51685ac265a4ad793a230a515fe6e462f16f4'} from 'ACTIONS_MODULE10'\nexport {fetchUserInbox as '708daa303e36e37247e22b5b828b6aad8c73ac283b'} from 'ACTIONS_MODULE10'\nexport {setCompanyEmailProvider as '70dd3bc4222a87350dc137fa9cbcb849fa1913b397'} from 'ACTIONS_MODULE10'\nexport {storeGmailMessage as '78d41ef818e75fef94d65a87ea1f0faf418132e3c5'} from 'ACTIONS_MODULE10'\nexport {storeUserGmailTokens as '7e3a356960ddd52a3fa4dc6d981ae7202a59eb9a3d'} from 'ACTIONS_MODULE10'\nexport {storeCompanyGmailTokens as '7f06df826c4fff42950e712c0f548254e275be2a52'} from 'ACTIONS_MODULE10'\nexport {getProviderHealthDashboard as '00a122f9d5fe3a1603c636c3a251886129b66154f8'} from 'ACTIONS_MODULE11'\nexport {checkProviderAlert as '40c7885bdc4fe4cdd5f57e78579230c58088adbef4'} from 'ACTIONS_MODULE11'\nexport {cleanupOldEvents as '40d3c4ceeaee653aa257a28ed429a7fd272fa9fb66'} from 'ACTIONS_MODULE11'\nexport {recordProviderEvent as '40e06418f4b93b40c84a25511e0468e1e8a41ddecf'} from 'ACTIONS_MODULE11'\nexport {getProviderStats as '60c643a41ce1a8e6cc8338da6e2f3678c386910460'} from 'ACTIONS_MODULE11'\nexport {recordSendFailure as '78255c3fa8c9facf7c3f353202f2907836e8eb5539'} from 'ACTIONS_MODULE11'\nexport {recordSendSuccess as '783861d25688b32ba086bbe9e45444975c36a1b285'} from 'ACTIONS_MODULE11'\nexport {recordFallbackTriggered as '78766431b437b16f7cb00b4d64a2f3be5e092ed724'} from 'ACTIONS_MODULE11'\nexport {deleteNotification as '40fab1894acc5e3d1fdd8d8c6128a7cecee06e7e6a'} from 'ACTIONS_MODULE12'\nexport {markAllAsRead as '00cf212b0097820096122537beac12e3403b97d564'} from 'ACTIONS_MODULE12'\nexport {markAsRead as '4094cf679b4a10ca0f969f4fc1b55602aac4e0fbc3'} from 'ACTIONS_MODULE12'\nexport {makeCall as '40b2df540ec465c5dc19545c96486485bb50b5633b'} from 'ACTIONS_MODULE2'\nexport {getWebRTCCredentials as '000478fbf5363dae5000d525663da13e29908cb952'} from 'ACTIONS_MODULE2'\nexport {signOut as '0043ae510c3322ea499beb9e1bb77d06afb4ef19bd'} from 'ACTIONS_MODULE13'\nexport {switchCompany as '4097c3c574342661f9a3c8244961d001234449f36f'} from 'ACTIONS_MODULE14'\nexport {updateUserStatus as '4081009dd4dff14ff4ece62648bad23a83f2f9f63c'} from 'ACTIONS_MODULE15'\nexport {getTotalUnreadCountAction as '00ebc03a4ffc993aea7ec2e541686105c2bace2437'} from 'ACTIONS_MODULE16'\nexport {getCompanyPendingActions as '40e9589cb639f2902eb841bedc1247d966486d6fd7'} from 'ACTIONS_MODULE17'\nexport {checkIsCompanyOwner as '001be5cf82b793f19f6a7d010c91c14577fa7a130d'} from 'ACTIONS_MODULE17'\nexport {getCustomerByPhone as '6013add076e3eaed7dc37e8b800ce977d5abb8d49a'} from 'ACTIONS_MODULE18'\nexport {startCallRecording as '404e47931374ad2a1b54bc11f357703790f6104530'} from 'ACTIONS_MODULE2'\nexport {stopCallRecording as '40d5cc291162e2fd61245bdb851d5e8ed609e4ed19'} from 'ACTIONS_MODULE2'\nexport {deleteCustomer as '4082b52123c24a95685a53c36313418a95c259c65b'} from 'ACTIONS_MODULE18'\nexport {searchCustomers as '60193685409a9d118f1b364e14ecf57d05fa5638a9'} from 'ACTIONS_MODULE18'\nexport {getCustomersForDialer as '0077abd0cb1e555f91adaa482ad0b2f565bbd0629a'} from 'ACTIONS_MODULE18'\nexport {getPendingSupportSessions as '000f90f949d6a2f5484d061d5a738a59a8c846aeaa'} from 'ACTIONS_MODULE19'\nexport {getActiveSupportSessions as '00665c1bbcd52d612d5bb4bf3be5e7fc75554132e6'} from 'ACTIONS_MODULE19'\nexport {approveSupportSessionRequest as '602e89ae7ace85fc30cd3b4b1dd865d517c0cb1cd5'} from 'ACTIONS_MODULE19'\nexport {rejectSupportSessionRequest as '60886af124323873afd4d5b64bb4143abbcba2c154'} from 'ACTIONS_MODULE19'\nexport {endActiveSupportSession as '40369e8ea4eced7bdaef8203d369469ee7b630db8c'} from 'ACTIONS_MODULE19'\nexport {createEmailFolderAction as '408d3694fd0dd48e424f53c9bf5083b946ab3ec990'} from 'ACTIONS_MODULE20'\nexport {getEmailFolderCountsAction as '009e962eae57bf128b2023081fd7259048edd8884a'} from 'ACTIONS_MODULE16'\nexport {getEmailFoldersAction as '00235a0ba91f1ba226f33fa40dcf4c93a2c3548c70'} from 'ACTIONS_MODULE20'\nexport {deleteEmailFolderAction as '40c55f8e0922f2c7fd8d502e4c75395bf5f0470430'} from 'ACTIONS_MODULE20'\nexport {searchVendors as '404a3266e0319dbd8c24fec80bb69ecfe029d2a768'} from 'ACTIONS_MODULE21'\nexport {getSmsFolderCountsAction as '0006f7bd89b72f0836ec7bf4db73019f1b32e6c24a'} from 'ACTIONS_MODULE22'\nexport {archiveInvoice as '4040183412a317fcfc6e30ea0018dc23ca1dd4ca1b'} from 'ACTIONS_MODULE23'\nexport {unlinkInvoiceFromJob as '403a81dea3436d2f9aa1f3bd091b670f166ecf43f5'} from 'ACTIONS_MODULE23'\nexport {bulkArchiveInvoices as '40e6b5cf58080ef28c0bf188d5d0cab7dd8ed747b4'} from 'ACTIONS_MODULE24'\nexport {bulkSendInvoices as '6050e425a7385bd0b0f913f4694f52604f6bdbc4cf'} from 'ACTIONS_MODULE25'\nexport {bulkSendEstimates as '60b18dc886c03a02ed84dd5d16db62590ebcf42ba1'} from 'ACTIONS_MODULE25'\n"],"names":[],"mappings":"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","ignoreList":[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]}