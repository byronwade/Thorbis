{"version":3,"sources":["../../../../../../apps/web/src/components/communication/sms-page-client.tsx"],"sourcesContent":["/**\n * SMS Communication Page\n * \n * Single page for all SMS folders with filter-based navigation\n * Route: /dashboard/communication/sms?folder=inbox\n * \n * Shows SMS list on left, detail panel on right when SMS is selected\n */\n\n\"use client\";\n\nimport type { CompanySms, GetSmsResult, SmsTemplateContext } from \"@/actions/sms-actions\";\nimport {\n    getSmsAction,\n    getSmsByIdAction,\n    getSmsConversationAction,\n    markSmsAsReadAction,\n    markSmsConversationAsReadAction,\n    getCompanyContextAction,\n} from \"@/actions/sms-actions\";\nimport { sendTextMessage } from \"@/actions/telnyx\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { SmsMessageInput } from \"@/components/communication/sms-message-input\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { cn } from \"@/lib/utils\";\nimport { useSidebar } from \"@/components/ui/sidebar\";\nimport { PanelLeft } from \"lucide-react\";\nimport {\n    AlertTriangle,\n    Archive,\n    ArrowLeft,\n    Loader2,\n    MessageSquare,\n    MoreHorizontal,\n    Paperclip,\n    Plus,\n    RefreshCw,\n    Reply,\n    Send,\n    Star,\n    StickyNote,\n    Trash,\n    X\n} from \"lucide-react\";\nimport { useCallback, useEffect, useRef, useState, useTransition } from \"react\";\nimport { toast } from \"sonner\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\n\ntype SmsPageClientProps = {\n    initialSms: GetSmsResult;\n    initialFolder: string;\n    initialSmsId: string | null;\n};\n\nexport function SmsPageClient({ initialSms, initialFolder, initialSmsId }: SmsPageClientProps) {\n    const router = useRouter();\n    const { toggleSidebar } = useSidebar();\n    const searchParams = useSearchParams();\n    const folder = searchParams.get(\"folder\") || initialFolder;\n    const smsId = searchParams.get(\"id\") || initialSmsId;\n    const [isPending, startTransition] = useTransition();\n    const [sms, setSms] = useState<GetSmsResult | null>(initialSms);\n    const [loading, setLoading] = useState(false);\n    const [refreshing, setRefreshing] = useState(false);\n    const [error, setError] = useState<string | null>(null);\n    const [selectedSms, setSelectedSms] = useState<CompanySms | null>(null);\n    const [conversationMessages, setConversationMessages] = useState<CompanySms[]>([]);\n    const [loadingConversation, setLoadingConversation] = useState(false);\n    const [searchQuery, setSearchQuery] = useState(\"\");\n    const [searchInput, setSearchInput] = useState(\"\");\n    const [messageInput, setMessageInput] = useState(\"\");\n    const [sendingMessage, setSendingMessage] = useState(false);\n    const [attachments, setAttachments] = useState<File[]>([]);\n    const [companyContext, setCompanyContext] = useState<SmsTemplateContext | null>(null);\n    const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n    const selectedSmsRef = useRef<CompanySms | null>(null);\n    const conversationScrollRef = useRef<HTMLDivElement>(null);\n\n    // Fetch SMS messages function with optimistic loading\n    const fetchSms = useCallback(async (showRefreshing = false) => {\n        if (showRefreshing) {\n            setRefreshing(true);\n        } else {\n            setLoading(true);\n        }\n        setError(null);\n        \n        startTransition(async () => {\n            try {\n                const result = await getSmsAction({ \n                    limit: 50, \n                    offset: 0,\n                    type: \"all\",\n                    folder: folder === \"inbox\" ? undefined : folder,\n                    search: searchQuery || undefined,\n                    sortBy: \"created_at\",\n                    sortOrder: \"desc\"\n                });\n                \n                setSms(result);\n                \n                // Update selected SMS if it still exists (preserve selection)\n                const currentSelected = selectedSmsRef.current;\n                if (currentSelected) {\n                    const updatedSms = result.sms.find(s => s.id === currentSelected.id);\n                    if (updatedSms) {\n                        setSelectedSms(updatedSms);\n                        selectedSmsRef.current = updatedSms;\n                    } else {\n                        setSelectedSms(null);\n                        selectedSmsRef.current = null;\n                        setConversationMessages([]);\n                    }\n                }\n            } catch (err) {\n                const errorMessage = err instanceof Error ? err.message : \"Failed to load SMS\";\n                setError(errorMessage);\n                toast.error(\"Failed to load SMS\", { description: errorMessage });\n            } finally {\n                setLoading(false);\n                setRefreshing(false);\n            }\n        });\n    }, [searchQuery, folder]);\n\n    // Refetch when folder or search changes (but not on initial mount - we have initialSms)\n    const isInitialMount = useRef(true);\n    useEffect(() => {\n        if (isInitialMount.current) {\n            isInitialMount.current = false;\n            return;\n        }\n        fetchSms();\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [folder, searchQuery]); // Refetch on folder/search change\n\n    // Fetch company context once on mount (for template auto-fill)\n    useEffect(() => {\n        getCompanyContextAction().then((result) => {\n            if (result.success && result.context) {\n                setCompanyContext(result.context);\n            }\n        });\n    }, []);\n\n    // Handle search input with debounce\n    useEffect(() => {\n        if (searchTimeoutRef.current) {\n            clearTimeout(searchTimeoutRef.current);\n        }\n\n        searchTimeoutRef.current = setTimeout(() => {\n            setSearchQuery(searchInput);\n        }, 300);\n\n        return () => {\n            if (searchTimeoutRef.current) {\n                clearTimeout(searchTimeoutRef.current);\n            }\n        };\n    }, [searchInput]);\n\n    // Fetch conversation messages for a phone number\n    const fetchConversation = useCallback(async (phoneNumber: string) => {\n        if (!phoneNumber) return;\n        \n        setLoadingConversation(true);\n        try {\n            const result = await getSmsConversationAction(phoneNumber);\n            if (result.success && result.messages) {\n                setConversationMessages(result.messages);\n                \n                // Mark all unread messages in conversation as read\n                const unreadMessages = result.messages.filter(msg => !msg.read_at && msg.direction === \"inbound\");\n                if (unreadMessages.length > 0) {\n                    // Optimistically update UI\n                    setConversationMessages(prev => prev.map(msg => \n                        !msg.read_at && msg.direction === \"inbound\" \n                            ? { ...msg, read_at: new Date().toISOString() }\n                            : msg\n                    ));\n                    \n                    // Update database\n                    markSmsConversationAsReadAction(phoneNumber)\n                        .then((result) => {\n                            if (result.success) {\n                                // Update conversation messages optimistically (don't reload list)\n                                setConversationMessages(prev => prev.map(msg => \n                                    !msg.read_at && msg.direction === \"inbound\" \n                                        ? { ...msg, read_at: new Date().toISOString() }\n                                        : msg\n                                ));\n                                // Update SMS list optimistically (don't reload)\n                                setSms(prev => {\n                                    if (!prev) return prev;\n                                    return {\n                                        ...prev,\n                                        sms: prev.sms.map(s => \n                                            !s.read_at && s.direction === \"inbound\" && \n                                            (s.from_address === phoneNumber || s.to_address === phoneNumber)\n                                                ? { ...s, read_at: new Date().toISOString() }\n                                                : s\n                                        )\n                                    };\n                                });\n                                // Notify sidebar to refresh counts (but don't reload SMS list)\n                                window.dispatchEvent(new CustomEvent(\"sms-read\"));\n                            }\n                        })\n                        .catch(() => {\n                            // Error marking as read - fail silently\n                        });\n                }\n                \n                // Scroll to bottom after messages load\n                setTimeout(() => {\n                    if (conversationScrollRef.current) {\n                        conversationScrollRef.current.scrollTop = conversationScrollRef.current.scrollHeight;\n                    }\n                }, 100);\n            }\n        } catch (err) {\n            toast.error(\"Failed to load conversation\");\n        } finally{\n            setLoadingConversation(false);\n        }\n    }, []);\n\n    // Handle SMS selection - update URL but stay on same page (no refresh)\n    const handleSmsSelect = useCallback((sms: CompanySms) => {\n        // Optimistic: Update state immediately (no waiting for navigation)\n        setSelectedSms(sms);\n        selectedSmsRef.current = sms;\n        \n        // Update URL using replace (not push) to avoid page refresh\n        const queryParams = new URLSearchParams();\n        if (folder && folder !== \"inbox\") queryParams.set(\"folder\", folder);\n        queryParams.set(\"id\", sms.id);\n        \n        router.replace(`/dashboard/communication/sms?${queryParams.toString()}`, { scroll: false });\n        \n        // Fetch conversation thread immediately (this shows the messages)\n        const phoneNumber = sms.direction === \"inbound\" ? sms.from_address : sms.to_address;\n        if (phoneNumber) {\n            fetchConversation(phoneNumber);\n        }\n\n        // Optimistic update for read status (after conversation is loading)\n        if (!sms.read_at) {\n            setSms(prev => {\n                if (!prev) return prev;\n                return {\n                    ...prev,\n                    sms: prev.sms.map(s => \n                        s.id === sms.id ? { ...s, read_at: new Date().toISOString() } : s\n                    )\n                };\n            });\n            // Mark as read in background (don't wait, don't reload list)\n            markSmsAsReadAction({ smsId: sms.id })\n                .then((success) => {\n                    if (success) {\n                        // Only update the specific SMS in the list, don't reload everything\n                        setSms(prev => {\n                            if (!prev) return prev;\n                            return {\n                                ...prev,\n                                sms: prev.sms.map(s => \n                                    s.id === sms.id ? { ...s, read_at: new Date().toISOString() } : s\n                                )\n                            };\n                        });\n                        // Notify sidebar to refresh counts (but don't reload SMS list)\n                        window.dispatchEvent(new CustomEvent(\"sms-read\"));\n                    }\n                })\n                .catch(() => {\n                    // Error marking as read - fail silently\n                });\n        }\n    }, [router, folder, fetchConversation]);\n\n    // Load SMS from URL if ID is present (from path or query)\n    // Only run if smsId changed and SMS isn't already selected (prevents double-loading)\n    // This handles direct URL navigation (e.g., sharing a link)\n    useEffect(() => {\n        // Skip if SMS is already selected (handleSmsSelect already handled it)\n        if (smsId && smsId === selectedSmsRef.current?.id) {\n            return;\n        }\n\n        if (smsId && sms?.sms) {\n            const smsMessage = sms.sms.find(s => s.id === smsId);\n            if (smsMessage) {\n                // Update state directly without calling handleSmsSelect (to avoid URL update loop)\n                setSelectedSms(smsMessage);\n                selectedSmsRef.current = smsMessage;\n                \n                // Fetch conversation thread immediately (this shows the messages)\n                const phoneNumber = smsMessage.direction === \"inbound\" ? smsMessage.from_address : smsMessage.to_address;\n                if (phoneNumber) {\n                    fetchConversation(phoneNumber);\n                }\n\n                // Optimistic update for read status (after conversation is loading)\n                if (!smsMessage.read_at) {\n                    setSms(prev => {\n                        if (!prev) return prev;\n                        return {\n                            ...prev,\n                            sms: prev.sms.map(s => \n                                s.id === smsMessage.id ? { ...s, read_at: new Date().toISOString() } : s\n                            )\n                        };\n                    });\n                    markSmsAsReadAction({ smsId: smsMessage.id })\n                        .then((success) => {\n                            if (success) {\n                                // Only update the specific SMS in the list, don't reload everything\n                                setSms(prev => {\n                                    if (!prev) return prev;\n                                    return {\n                                        ...prev,\n                                        sms: prev.sms.map(s => \n                                            s.id === smsMessage.id ? { ...s, read_at: new Date().toISOString() } : s\n                                        )\n                                    };\n                                });\n                                // Notify sidebar to refresh counts (but don't reload SMS list)\n                                window.dispatchEvent(new CustomEvent(\"sms-read\"));\n                            }\n                        })\n                        .catch(() => {\n                            // Error marking as read - fail silently\n                        });\n                }\n            } else if (!smsMessage) {\n                startTransition(async () => {\n                    try {\n                        const result = await getSmsByIdAction(smsId);\n                        if (result.success && result.sms) {\n                            setSelectedSms(result.sms);\n                            selectedSmsRef.current = result.sms;\n                            \n                            // Fetch conversation thread\n                            const phoneNumber = result.sms.direction === \"inbound\" ? result.sms.from_address : result.sms.to_address;\n                            if (phoneNumber) {\n                                fetchConversation(phoneNumber);\n                            }\n                        }\n                    } catch (err) {\n                        // Failed to fetch SMS by ID - fail silently\n                    }\n                });\n            }\n        } else if (!smsId && selectedSms) {\n            setSelectedSms(null);\n            selectedSmsRef.current = null;\n            setConversationMessages([]);\n        }\n    }, [smsId, sms?.sms, fetchConversation]);\n\n    const handleRefresh = useCallback(() => {\n        fetchSms(true);\n        toast.success(\"Refreshing SMS...\");\n    }, [fetchSms]);\n\n    const handleDelete = useCallback(async (smsId: string) => {\n        if (!confirm(\"Are you sure you want to delete this SMS?\")) {\n            return;\n        }\n\n        try {\n            toast.success(\"SMS deleted\");\n            \n            if (sms) {\n                setSms({\n                    ...sms,\n                    sms: sms.sms.filter(s => s.id !== smsId),\n                    total: sms.total - 1,\n                });\n            }\n\n            if (selectedSms?.id === smsId) {\n                setSelectedSms(null);\n                setConversationMessages([]);\n                const params = new URLSearchParams();\n                if (folder && folder !== \"inbox\") params.set(\"folder\", folder);\n                router.push(`/dashboard/communication/sms${params.toString() ? `?${params.toString()}` : \"\"}`, { scroll: false });\n            }\n        } catch (err) {\n            toast.error(\"Failed to delete SMS\", {\n                description: err instanceof Error ? err.message : \"Unknown error\"\n            });\n        }\n    }, [sms, selectedSms, folder, router]);\n\n    const getSenderName = (sms: CompanySms) => {\n        if (sms.customer?.first_name || sms.customer?.last_name) {\n            return `${sms.customer.first_name || \"\"} ${sms.customer.last_name || \"\"}`.trim();\n        }\n        return sms.from_name || sms.from_address || \"Unknown\";\n    };\n\n    const getSenderInitial = (sms: CompanySms) => {\n        const name = getSenderName(sms);\n        return name[0]?.toUpperCase() || \"U\";\n    };\n\n    // Handle file attachments\n    const handleAttachFiles = useCallback((files: File[]) => {\n        setAttachments((prev) => [...prev, ...files]);\n    }, []);\n\n    // Handle sending a message (with attachments support)\n    const handleSendMessage = useCallback(async () => {\n        if ((!messageInput.trim() && attachments.length === 0) || !selectedSms || sendingMessage) return;\n\n        const phoneNumber = selectedSms.direction === \"inbound\" ? selectedSms.from_address : selectedSms.to_address;\n        if (!phoneNumber) {\n            toast.error(\"Cannot determine recipient phone number\");\n            return;\n        }\n\n        setSendingMessage(true);\n        try {\n            // If we have attachments, upload them first and send as MMS\n            if (attachments.length > 0) {\n                // Upload files to storage and get URLs\n                const { uploadSmsAttachments } = await import(\"@/actions/sms-actions\");\n                const uploadResult = await uploadSmsAttachments(attachments);\n                \n                if (!uploadResult.success || !uploadResult.urls) {\n                    toast.error(uploadResult.error || \"Failed to upload attachments\");\n                    setSendingMessage(false);\n                    return;\n                }\n\n                // Send MMS with attachments\n                const { sendMMSMessage } = await import(\"@/actions/telnyx\");\n                const result = await sendMMSMessage({\n                    to: phoneNumber,\n                    from: \"\", // Will use default from company settings\n                    text: messageInput.trim() || undefined,\n                    mediaUrls: uploadResult.urls,\n                    customerId: selectedSms.customer_id || undefined,\n                });\n\n                if (result.success) {\n                    setMessageInput(\"\");\n                    setAttachments([]);\n                    toast.success(\"Message with attachments sent\");\n                    // Refresh conversation\n                    fetchConversation(phoneNumber);\n                    // Refresh SMS list\n                    fetchSms(true);\n                } else {\n                    toast.error(result.error || \"Failed to send message\");\n                }\n            } else {\n                // Send regular SMS\n                const result = await sendTextMessage({\n                    to: phoneNumber,\n                    from: \"\", // Will use default from company settings\n                    text: messageInput.trim(),\n                    customerId: selectedSms.customer_id || undefined,\n                });\n\n                if (result.success) {\n                    setMessageInput(\"\");\n                    toast.success(\"Message sent\");\n                    // Refresh conversation\n                    fetchConversation(phoneNumber);\n                    // Refresh SMS list\n                    fetchSms(true);\n                } else {\n                    toast.error(result.error || \"Failed to send message\");\n                }\n            }\n        } catch (err) {\n            toast.error(\"Failed to send message\", {\n                description: err instanceof Error ? err.message : \"Unknown error\"\n            });\n        } finally {\n            setSendingMessage(false);\n        }\n    }, [messageInput, attachments, selectedSms, sendingMessage, fetchConversation, fetchSms]);\n\n\n    // Format timestamp for messages\n    const formatMessageTime = (date: string) => {\n        const messageDate = new Date(date);\n        const now = new Date();\n        const isToday = messageDate.toDateString() === now.toDateString();\n        \n        if (isToday) {\n            return messageDate.toLocaleTimeString('en-US', {\n                hour: 'numeric',\n                minute: '2-digit'\n            });\n        }\n        \n        return messageDate.toLocaleDateString('en-US', {\n            month: 'short',\n            day: 'numeric',\n            hour: 'numeric',\n            minute: '2-digit'\n        });\n    };\n\n    // Mobile: show list when no SMS selected, show detail when SMS selected\n    // Desktop: always show both panels side by side\n    const showListOnMobile = !selectedSms;\n    const showDetailOnMobile = !!selectedSms;\n\n    return (\n        <div className=\"flex h-full w-full flex-col overflow-hidden bg-sidebar\">\n            <div className=\"flex flex-1 overflow-hidden min-h-0 md:gap-2\">\n                {/* SMS List Panel - Hidden on mobile when SMS is selected */}\n                <div className={cn(\n                    \"bg-card mb-1 shadow-sm flex flex-col overflow-hidden\",\n                    \"w-full h-full\", // Mobile: full width/height\n                    \"md:w-[400px] lg:w-[480px] md:rounded-tr-2xl\", // Desktop: fixed width with rounded corner\n                    // Mobile visibility logic\n                    showListOnMobile ? \"flex\" : \"hidden md:flex\"\n                )}>\n                    <div className=\"w-full h-full flex flex-col\">\n                        <div className=\"sticky top-0 z-15 flex items-center justify-between gap-1.5 p-2 pb-0 transition-colors bg-card\">\n                            <div className=\"w-full\">\n                                <div className=\"grid grid-cols-12 gap-2 mt-1\">\n                                    <div className=\"col-span-12 flex gap-2\">\n                                        {/* Sidebar toggle - larger on mobile for touch */}\n                                        <Button\n                                            variant=\"ghost\"\n                                            size=\"sm\"\n                                            className=\"h-10 w-10 p-0 md:h-8 md:w-8 shrink-0\"\n                                            onClick={toggleSidebar}\n                                            title=\"Toggle sidebar\"\n                                        >\n                                            <PanelLeft className=\"h-5 w-5 md:h-4 md:w-4\" />\n                                        </Button>\n                                        <div className=\"relative flex-1\">\n                                            {/* Search input - text-base on mobile to prevent iOS zoom */}\n                                            <Input\n                                                type=\"search\"\n                                                placeholder=\"Search SMS...\"\n                                                value={searchInput}\n                                                onChange={(e) => setSearchInput(e.target.value)}\n                                                className=\"h-10 md:h-8 pl-9 pr-20 text-base md:text-sm border-input bg-white dark:bg-[#141414] dark:border-none\"\n                                            />\n                                            <svg\n                                                width=\"10\"\n                                                height=\"10\"\n                                                viewBox=\"0 0 10 10\"\n                                                fill=\"none\"\n                                                xmlns=\"http://www.w3.org/2000/svg\"\n                                                className=\"absolute left-3 top-1/2 -translate-y-1/2 fill-[#71717A] dark:fill-[#6F6F6F]\"\n                                            >\n                                                <path\n                                                    fillRule=\"evenodd\"\n                                                    clipRule=\"evenodd\"\n                                                    d=\"M6.81038 7.0756C6.18079 7.54011 5.40248 7.81466 4.56004 7.81466C2.46451 7.81466 0.765747 6.11589 0.765747 4.02037C0.765747 1.92484 2.46451 0.226074 4.56004 0.226074C6.65557 0.226074 8.35433 1.92484 8.35433 4.02037C8.35433 4.8628 8.07978 5.64112 7.61527 6.27071L9.70535 8.36078C9.92761 8.58305 9.92761 8.94341 9.70535 9.16568C9.48308 9.38794 9.12272 9.38794 8.90046 9.16568L6.81038 7.0756ZM7.21604 4.02037C7.21604 5.48724 6.02691 6.67637 4.56004 6.67637C3.09317 6.67637 1.90403 5.48724 1.90403 4.02037C1.90403 2.5535 3.09317 1.36436 4.56004 1.36436C6.02691 1.36436 7.21604 2.5535 7.21604 4.02037Z\"\n                                                />\n                                            </svg>\n                                            {searchInput && (\n                                                <button\n                                                    onClick={() => setSearchInput(\"\")}\n                                                    className=\"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground\"\n                                                >\n                                                    <X className=\"h-3 w-3\" />\n                                                </button>\n                                            )}\n                                        </div>\n                                        <Button\n                                            variant=\"ghost\"\n                                            size=\"sm\"\n                                            onClick={handleRefresh}\n                                            disabled={refreshing}\n                                            className=\"h-10 w-10 p-0 md:h-8 md:w-8\"\n                                            title=\"Refresh\"\n                                        >\n                                            <RefreshCw className={`h-5 w-5 md:h-4 md:w-4 text-muted-foreground ${refreshing ? 'animate-spin' : ''}`} />\n                                        </Button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* SMS Items */}\n                        <div className=\"relative z-1 flex-1 overflow-hidden pt-0 min-h-0\">\n                            <div className=\"hide-link-indicator flex h-full w-full\">\n                                <div className=\"flex flex-1 flex-col\" id=\"sms-list-scroll\">\n                                    <ScrollArea className=\"scrollbar-none flex-1 overflow-x-hidden h-full\">\n                                        {loading ? (\n                                            <div className=\"flex items-center justify-center p-8\">\n                                                <div className=\"text-center\">\n                                                    <Loader2 className=\"h-8 w-8 animate-spin text-primary mx-auto mb-4\" />\n                                                    <p className=\"text-sm text-muted-foreground\">Loading SMS...</p>\n                                                </div>\n                                            </div>\n                                        ) : error ? (\n                                            <div className=\"flex items-center justify-center p-8\">\n                                                <div className=\"text-center\">\n                                                    <AlertTriangle className=\"h-8 w-8 text-destructive mx-auto mb-4\" />\n                                                    <p className=\"text-sm text-destructive mb-2 font-medium\">Failed to load SMS</p>\n                                                    <p className=\"text-xs text-muted-foreground mb-4\">{error}</p>\n                                                    <Button\n                                                        variant=\"outline\"\n                                                        size=\"sm\"\n                                                        onClick={() => fetchSms()}\n                                                    >\n                                                        Try Again\n                                                    </Button>\n                                                </div>\n                                            </div>\n                                        ) : sms?.sms?.length ? (\n                                            <div className=\"min-h-[200px] px-2\">\n                                                {sms.sms.map((smsMessage) => {\n                                                    const isSelected = selectedSms?.id === smsMessage.id;\n                                                    return (\n                                                        <div\n                                                            key={smsMessage.id}\n                                                            className=\"select-none md:my-1\"\n                                                        >\n                                                            <div\n                                                                className={`hover:bg-accent group flex cursor-pointer flex-col items-start rounded-lg py-2 text-left text-sm transition-all hover:opacity-100 relative ${\n                                                                    isSelected \n                                                                        ? 'bg-accent opacity-100' \n                                                                        : ''\n                                                                } ${!smsMessage.read_at ? 'opacity-100' : 'opacity-60'}`}\n                                                                onClick={() => handleSmsSelect(smsMessage)}\n                                                            >\n                                                                {/* Hover Action Toolbar - pointer-events-none on container allows clicks to pass through */}\n                                                                <div\n                                                                    className=\"dark:bg-panelDark pointer-events-none absolute right-2 z-25 flex -translate-y-1/2 items-center gap-1 rounded-xl border bg-white p-1 opacity-0 shadow-sm group-hover:opacity-100 top-[-1] transition-opacity duration-200\"\n                                                                >\n                                                                    <Button\n                                                                        variant=\"ghost\"\n                                                                        size=\"sm\"\n                                                                        className=\"pointer-events-auto h-6 w-6 overflow-visible p-0 hover:bg-accent\"\n                                                                        onClick={(e) => e.stopPropagation()}\n                                                                    >\n                                                                        <Star className=\"h-4 w-4 fill-transparent stroke-[#9D9D9D] dark:stroke-[#9D9D9D]\" />\n                                                                    </Button>\n                                                                    <Button\n                                                                        variant=\"ghost\"\n                                                                        size=\"sm\"\n                                                                        className=\"pointer-events-auto h-6 w-6 p-0 hover:bg-accent\"\n                                                                        onClick={(e) => e.stopPropagation()}\n                                                                    >\n                                                                        <AlertTriangle className=\"fill-[#9D9D9D] h-3.5 w-3.5\" />\n                                                                    </Button>\n                                                                    <Button\n                                                                        variant=\"ghost\"\n                                                                        size=\"sm\"\n                                                                        className=\"pointer-events-auto h-6 w-6 p-0 hover:bg-accent\"\n                                                                        onClick={(e) => e.stopPropagation()}\n                                                                    >\n                                                                        <Archive className=\"fill-[#9D9D9D] h-4 w-4\" />\n                                                                    </Button>\n                                                                    <Button\n                                                                        variant=\"ghost\"\n                                                                        size=\"sm\"\n                                                                        className=\"pointer-events-auto h-6 w-6 p-0 hover:bg-[#FDE4E9] dark:hover:bg-[#411D23]\"\n                                                                        onClick={(e) => {\n                                                                            e.stopPropagation();\n                                                                            handleDelete(smsMessage.id);\n                                                                        }}\n                                                                    >\n                                                                        <Trash className=\"fill-[#F43F5E] h-4 w-4\" />\n                                                                    </Button>\n                                                                </div>\n\n                                                                {/* SMS Card Content */}\n                                                                <div className=\"relative flex w-full items-center justify-between gap-4 px-2\">\n                                                                    {/* Avatar */}\n                                                                    <Avatar className=\"h-8 w-8 shrink-0 rounded-full border\">\n                                                                        <AvatarFallback className=\"bg-white dark:bg-[#373737] text-[#9F9F9D] font-bold text-xs\">\n                                                                            {getSenderInitial(smsMessage)}\n                                                                        </AvatarFallback>\n                                                                    </Avatar>\n\n                                                                    {/* SMS Info */}\n                                                                    <div className=\"flex w-full justify-between\">\n                                                                        <div className=\"w-full\">\n                                                                            {/* Sender Name + Time */}\n                                                                            <div className=\"flex w-full flex-row items-center justify-between\">\n                                                                                <div className=\"flex flex-row items-center gap-[4px]\">\n                                                                                    <span className={`font-${!smsMessage.read_at ? 'bold' : 'bold'} text-md flex items-baseline gap-1 group-hover:opacity-100`}>\n                                                                                        <div className=\"flex items-center gap-1\">\n                                                                                            <span className=\"line-clamp-1 overflow-hidden text-sm\">\n                                                                                                {getSenderName(smsMessage)}\n                                                                                            </span>\n                                                                                            {!smsMessage.read_at && (\n                                                                                                <span className=\"ml-0.5 size-2 rounded-full bg-[#006FFE]\"></span>\n                                                                                            )}\n                                                                                        </div>\n                                                                                    </span>\n                                                                                </div>\n                                                                                <p className=\"text-muted-foreground text-nowrap text-xs font-normal opacity-70 transition-opacity group-hover:opacity-100 dark:text-[#8C8C8C]\">\n                                                                                    {smsMessage.created_at ? new Date(smsMessage.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : ''}\n                                                                                </p>\n                                                                            </div>\n\n                                                                            {/* Message Preview */}\n                                                                            <div className=\"flex justify-between\">\n                                                                                <p className=\"mt-1 line-clamp-1 w-[95%] min-w-0 overflow-hidden text-sm text-[#8C8C8C]\">\n                                                                                    {smsMessage.body || \"No message\"}\n                                                                                </p>\n                                                                            </div>\n                                                                        </div>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    );\n                                                })}\n                                            </div>\n                                        ) : (\n                                            <div className=\"flex items-center justify-center p-8\">\n                                                <div className=\"text-center\">\n                                                    <MessageSquare className=\"h-16 w-16 text-muted-foreground opacity-50 mx-auto mb-4\" />\n                                                    <p className=\"text-sm font-medium text-muted-foreground mb-1\">\n                                                        {searchQuery ? \"No SMS found\" : \"No SMS yet\"}\n                                                    </p>\n                                                    <p className=\"text-xs text-muted-foreground\">\n                                                        {searchQuery \n                                                            ? \"Try adjusting your search terms\" \n                                                            : \"SMS messages will appear here when received\"}\n                                                    </p>\n                                                </div>\n                                            </div>\n                                        )}\n                                    </ScrollArea>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                {/* SMS Detail - Right Panel (iPhone-style chat interface) */}\n                {/* Mobile: shown when SMS selected, Desktop: always visible as flex-1 */}\n                <div className={cn(\n                    \"bg-card mb-1 shadow-sm flex flex-col min-w-0 overflow-hidden\",\n                    \"w-full h-full\", // Mobile: full width/height\n                    \"md:rounded-tl-2xl md:flex-1\", // Desktop: rounded corner and flex\n                    showDetailOnMobile ? \"flex\" : \"hidden md:flex\"\n                )}>\n                    <div className=\"relative flex-1 min-h-0 flex flex-col\">\n                        {selectedSms ? (\n                            <>\n                                {/* Header Toolbar */}\n                                <div className=\"sticky top-0 z-15 flex shrink-0 items-center justify-between gap-1.5 p-2 pb-0 transition-colors bg-card\">\n                                    <div className=\"flex flex-1 items-center gap-2\">\n                                        {/* Back button (mobile) / Close button (desktop) */}\n                                        <Button\n                                            variant=\"ghost\"\n                                            size=\"sm\"\n                                            onClick={() => {\n                                                setSelectedSms(null);\n                                                selectedSmsRef.current = null;\n                                                setConversationMessages([]);\n                                                const params = new URLSearchParams();\n                                                if (folder && folder !== \"inbox\") params.set(\"folder\", folder);\n                                                router.push(`/dashboard/communication/sms?${params.toString()}`, { scroll: false });\n                                            }}\n                                            className=\"h-10 w-10 p-0 md:h-8 md:w-8 hover:bg-accent/80 active:bg-accent transition-colors\"\n                                            title=\"Back to list\"\n                                        >\n                                            {/* Arrow on mobile, X on desktop */}\n                                            <ArrowLeft className=\"h-5 w-5 md:hidden text-muted-foreground\" />\n                                            <X className=\"h-4 w-4 hidden md:block text-muted-foreground\" />\n                                        </Button>\n                                    </div>\n                                    <div className=\"flex items-center gap-1\">\n                                        <Button variant=\"ghost\" size=\"sm\" className=\"h-10 w-10 p-0 md:h-8 md:w-8 hover:bg-accent/80 active:bg-accent transition-colors\" title=\"More options\">\n                                            <MoreHorizontal className=\"h-5 w-5 md:h-4 md:w-4 text-muted-foreground\" />\n                                        </Button>\n                                    </div>\n                                </div>\n\n                                {/* Contact Info Section */}\n                                <div className=\"border-b border-border/50 px-2 py-4 space-y-3\">\n                                    <div className=\"flex items-center gap-3\">\n                                        <Avatar className=\"h-9 w-9 shrink-0 rounded-md\">\n                                            <AvatarFallback className=\"bg-muted text-muted-foreground font-semibold text-sm rounded-md\">\n                                                {getSenderInitial(selectedSms)}\n                                            </AvatarFallback>\n                                        </Avatar>\n                                        <div className=\"flex-1 min-w-0\">\n                                            <div className=\"font-semibold text-sm text-foreground\">\n                                                {getSenderName(selectedSms)}\n                                            </div>\n                                            <div className=\"text-xs text-muted-foreground\">\n                                                {selectedSms.direction === \"inbound\" \n                                                    ? selectedSms.from_address || \"Unknown\"\n                                                    : selectedSms.to_address || \"Unknown\"}\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                {/* Messages Area - iPhone Style */}\n                                <div \n                                    ref={conversationScrollRef}\n                                    className=\"flex-1 overflow-y-auto bg-card px-4 py-4\"\n                                >\n                                    {loadingConversation ? (\n                                        <div className=\"flex items-center justify-center h-full\">\n                                            <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                                        </div>\n                                    ) : conversationMessages.length === 0 ? (\n                                        <div className=\"flex items-center justify-center h-full\">\n                                            <div className=\"text-center\">\n                                                <MessageSquare className=\"h-12 w-12 text-muted-foreground opacity-50 mx-auto mb-2\" />\n                                                <p className=\"text-sm text-muted-foreground\">No messages yet</p>\n                                            </div>\n                                        </div>\n                                    ) : (\n                                        <div className=\"space-y-2\">\n                                            {conversationMessages.map((msg, index) => {\n                                                const isOutbound = msg.direction === \"outbound\";\n                                                const showTime = index === 0 || \n                                                    new Date(msg.created_at).getTime() - new Date(conversationMessages[index - 1].created_at).getTime() > 5 * 60 * 1000; // 5 minutes\n                                                \n                                                return (\n                                                    <div key={msg.id} className=\"flex flex-col\">\n                                                        {showTime && (\n                                                            <div className=\"flex justify-center my-2\">\n                                                                <span className=\"text-xs text-muted-foreground bg-muted/50 px-2 py-1 rounded-full\">\n                                                                    {formatMessageTime(msg.created_at)}\n                                                                </span>\n                                                            </div>\n                                                        )}\n                                                        <div className={cn(\n                                                            \"flex flex-col\",\n                                                            isOutbound ? \"items-end\" : \"items-start\"\n                                                        )}>\n                                                            <div className={cn(\n                                                                \"max-w-[75%] rounded-2xl px-4 py-2 shadow-sm\",\n                                                                isOutbound\n                                                                    ? \"bg-primary text-primary-foreground rounded-tr-sm\"\n                                                                    : \"bg-muted text-foreground rounded-tl-sm\"\n                                                            )}>\n                                                                {/* Show attachments if present */}\n                                                                {msg.provider_metadata && typeof msg.provider_metadata === 'object' && 'attachments' in msg.provider_metadata && Array.isArray(msg.provider_metadata.attachments) && msg.provider_metadata.attachments.length > 0 && (\n                                                                    <div className={cn(\"mb-2 space-y-2\", msg.body ? \"\" : \"\")}>\n                                                                        {msg.provider_metadata.attachments.map((att: any, attIdx: number) => {\n                                                                            const isImage = att.type === 'image' || (att.url && /\\.(jpg|jpeg|png|gif|webp)$/i.test(att.url));\n                                                                            return (\n                                                                                <div key={attIdx} className=\"rounded-lg overflow-hidden\">\n                                                                                    {isImage ? (\n                                                                                        <img\n                                                                                            src={att.url}\n                                                                                            alt={att.filename || \"Image\"}\n                                                                                            className=\"max-w-full max-h-64 object-contain rounded-lg\"\n                                                                                            loading=\"lazy\"\n                                                                                        />\n                                                                                    ) : (\n                                                                                        <a\n                                                                                            href={att.url}\n                                                                                            target=\"_blank\"\n                                                                                            rel=\"noopener noreferrer\"\n                                                                                            className={cn(\n                                                                                                \"flex items-center gap-2 p-2 rounded-lg hover:opacity-80 transition-opacity\",\n                                                                                                isOutbound ? \"bg-primary-foreground/20\" : \"bg-background/20\"\n                                                                                            )}\n                                                                                        >\n                                                                                            <Paperclip className=\"h-4 w-4\" />\n                                                                                            <span className=\"text-xs truncate\">{att.filename || \"Attachment\"}</span>\n                                                                                        </a>\n                                                                                    )}\n                                                                                </div>\n                                                                            );\n                                                                        })}\n                                                                    </div>\n                                                                )}\n                                                                {msg.body && (\n                                                                    <p className=\"text-sm whitespace-pre-wrap break-words\">\n                                                                        {msg.body}\n                                                                    </p>\n                                                                )}\n                                                                {!msg.body && (!msg.provider_metadata || typeof msg.provider_metadata !== 'object' || !('attachments' in msg.provider_metadata) || !Array.isArray(msg.provider_metadata.attachments) || msg.provider_metadata.attachments.length === 0) && (\n                                                                    <p className=\"text-sm opacity-70 italic\">No message content</p>\n                                                                )}\n                                                            </div>\n                                                            <span className={cn(\n                                                                \"text-xs text-muted-foreground mt-0.5\",\n                                                                isOutbound ? \"text-right\" : \"text-left\"\n                                                            )}>\n                                                                {new Date(msg.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                                                            </span>\n                                                        </div>\n                                                    </div>\n                                                );\n                                            })}\n                                        </div>\n                                    )}\n                                </div>\n\n                                {/* Message Input - iPhone Style with Emojis & Attachments */}\n                                <SmsMessageInput\n                                    value={messageInput}\n                                    onChange={setMessageInput}\n                                    onSend={handleSendMessage}\n                                    onAttach={handleAttachFiles}\n                                    sending={sendingMessage}\n                                    disabled={!selectedSms}\n                                    placeholder=\"Text Message\"\n                                    // Pass customer context for templates\n                                    customerId={selectedSms?.customer_id || undefined}\n                                    customerName={selectedSms?.customer ? `${selectedSms.customer.first_name || \"\"} ${selectedSms.customer.last_name || \"\"}`.trim() : undefined}\n                                    customerFirstName={selectedSms?.customer?.first_name || undefined}\n                                    // Pass company context for templates\n                                    companyName={companyContext?.companyName}\n                                    companyPhone={companyContext?.companyPhone}\n                                    // Enable AI suggestions if customer is linked\n                                    enableAiSuggestions={Boolean(selectedSms?.customer_id)}\n                                />\n                            </>\n                        ) : (\n                            /* Empty State - No SMS Selected */\n                            <div className=\"flex flex-col items-center justify-center h-full px-4 py-8\">\n                                <div className=\"text-center space-y-4 max-w-md\">\n                                    <MessageSquare className=\"h-16 w-16 text-muted-foreground opacity-50 mx-auto\" />\n                                    <div className=\"space-y-2\">\n                                        <h3 className=\"text-lg font-semibold text-foreground\">No conversation selected</h3>\n                                        <p className=\"text-sm text-muted-foreground\">\n                                            Select a conversation from the list to view messages, or create a new SMS to get started.\n                                        </p>\n                                    </div>\n                                    <Button\n                                        onClick={() => {\n                                            if (typeof window !== \"undefined\") {\n                                                window.dispatchEvent(new CustomEvent(\"open-recipient-selector\", {\n                                                    detail: { type: \"sms\" }\n                                                }));\n                                            }\n                                        }}\n                                        className=\"mt-4 h-12 px-6 md:h-11 md:px-5\"\n                                        size=\"lg\"\n                                    >\n                                        <Plus className=\"h-5 w-5 md:h-4 md:w-4 mr-2\" />\n                                        Create new SMS\n                                    </Button>\n                                </div>\n                            </div>\n                        )}\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}