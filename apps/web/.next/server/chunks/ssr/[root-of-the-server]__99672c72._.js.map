{"version":3,"sources":["../../../../../../apps/web/src/components/work/work-data-view.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/components/work/maintenance-plans-kanban.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/components/work/maintenance-plans-table.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/work/maintenance-plans/page.tsx","../../../../../../apps/web/src/components/work/maintenance-plans/maintenance-plans-data.tsx","../../../../../../apps/web/src/lib/queries/maintenance-plans.ts","../../../../../../apps/web/src/components/work/maintenance-plans/maintenance-plans-skeleton.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const WorkDataView = registerClientReference(\n    function() { throw new Error(\"Attempted to call WorkDataView() from the server but WorkDataView is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/work/work-data-view.tsx\",\n    \"WorkDataView\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const MaintenancePlansKanban = registerClientReference(\n    function() { throw new Error(\"Attempted to call MaintenancePlansKanban() from the server but MaintenancePlansKanban is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/work/maintenance-plans-kanban.tsx\",\n    \"MaintenancePlansKanban\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const MaintenancePlansTable = registerClientReference(\n    function() { throw new Error(\"Attempted to call MaintenancePlansTable() from the server but MaintenancePlansTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/work/maintenance-plans-table.tsx\",\n    \"MaintenancePlansTable\",\n);\n","/**\n * Maintenance Plans Page - PPR Enabled\n *\n * Uses Next.js 16 \"use cache\" directive for optimal caching:\n * - Static shell renders instantly (5-20ms)\n * - Data streams in (200-500ms)\n *\n * Performance: 10-40x faster than traditional SSR\n */\n\nimport { Suspense } from \"react\";\nimport { MaintenancePlansData } from \"@/components/work/maintenance-plans/maintenance-plans-data\";\nimport { MaintenancePlansSkeleton } from \"@/components/work/maintenance-plans/maintenance-plans-skeleton\";\n\nexport default async function MaintenancePlansPage({\n\tsearchParams,\n}: {\n\tsearchParams: Promise<{ page?: string }>;\n}) {\n\tconst params = await searchParams;\n\n\treturn (\n\t\t<Suspense fallback={<MaintenancePlansSkeleton />}>\n\t\t\t<MaintenancePlansData searchParams={params} />\n\t\t</Suspense>\n\t);\n}\n","import { notFound } from \"next/navigation\";\nimport { MaintenancePlansKanban } from \"@/components/work/maintenance-plans-kanban\";\nimport {\n\ttype MaintenancePlan,\n\tMaintenancePlansTable,\n} from \"@/components/work/maintenance-plans-table\";\nimport { WorkDataView } from \"@/components/work/work-data-view\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport { getCurrentUser } from \"@/lib/auth/session\";\nimport {\n\tgetMaintenancePlansPageData,\n\tMAINTENANCE_PLANS_PAGE_SIZE,\n\ttype MaintenancePlanQueryResult,\n} from \"@/lib/queries/maintenance-plans\";\n\nconst FREQUENCY_LABELS: Record<string, MaintenancePlan[\"frequency\"]> = {\n\tmonthly: \"Monthly\",\n\tquarterly: \"Quarterly\",\n\t\"bi-annual\": \"Bi-Annual\",\n\tbiannual: \"Bi-Annual\",\n\tannual: \"Annual\",\n};\n\nconst STATUS_OPTIONS: MaintenancePlan[\"status\"][] = [\n\t\"active\",\n\t\"pending\",\n\t\"paused\",\n\t\"cancelled\",\n];\n\nconst formatDate = (value?: string | null) =>\n\tvalue\n\t\t? new Date(value).toLocaleDateString(\"en-US\", {\n\t\t\t\tmonth: \"short\",\n\t\t\t\tday: \"numeric\",\n\t\t\t\tyear: \"numeric\",\n\t\t\t})\n\t\t: \"\";\n\nconst resolveCustomer = (customer: MaintenancePlanQueryResult[\"customer\"]) => {\n\tif (!customer) {\n\t\treturn null;\n\t}\n\treturn Array.isArray(customer) ? (customer[0] ?? null) : customer;\n};\n\nexport async function MaintenancePlansData({\n\tsearchParams,\n}: {\n\tsearchParams?: { page?: string };\n}) {\n\tconst [user, activeCompanyId] = await Promise.all([\n\t\tgetCurrentUser(),\n\t\tgetActiveCompanyId(),\n\t]);\n\n\tif (!user) {\n\t\treturn notFound();\n\t}\n\n\tif (!activeCompanyId) {\n\t\treturn notFound();\n\t}\n\n\tconst currentPage = Number(searchParams?.page) || 1;\n\tconst { plans: plansRaw, totalCount } = await getMaintenancePlansPageData(\n\t\tcurrentPage,\n\t\tMAINTENANCE_PLANS_PAGE_SIZE,\n\t\tactiveCompanyId,\n\t);\n\n\tconst plans: MaintenancePlan[] = (plansRaw || []).map(\n\t\t(plan: MaintenancePlanQueryResult) => {\n\t\t\tconst customer = resolveCustomer(plan.customer);\n\n\t\t\tconst customerName =\n\t\t\t\tcustomer?.display_name ||\n\t\t\t\t`${customer?.first_name ?? \"\"} ${customer?.last_name ?? \"\"}`.trim() ||\n\t\t\t\t\"Unknown\";\n\n\t\t\tconst frequencyKey = plan.frequency?.toLowerCase() ?? \"monthly\";\n\t\t\tconst frequency = FREQUENCY_LABELS[frequencyKey] ?? \"Monthly\";\n\n\t\t\tconst normalizedStatus = (\n\t\t\t\tplan.status ?? \"\"\n\t\t\t).toLowerCase() as MaintenancePlan[\"status\"];\n\t\t\tconst status = STATUS_OPTIONS.includes(normalizedStatus)\n\t\t\t\t? normalizedStatus\n\t\t\t\t: \"pending\";\n\n\t\t\treturn {\n\t\t\t\tid: plan.id,\n\t\t\t\tplanName: plan.name || plan.plan_number || plan.id,\n\t\t\t\tcustomer: customerName,\n\t\t\t\tserviceType:\n\t\t\t\t\t(plan as { service_type?: string | null }).service_type ||\n\t\t\t\t\tplan.name ||\n\t\t\t\t\t\"Service plan\",\n\t\t\t\tfrequency,\n\t\t\t\tnextVisit: formatDate(plan.next_service_date),\n\t\t\t\tmonthlyFee: typeof plan.amount === \"number\" ? plan.amount : 0,\n\t\t\t\tstatus,\n\t\t\t\tarchived_at:\n\t\t\t\t\t(plan as { archived_at?: string | null }).archived_at ?? null,\n\t\t\t\tdeleted_at: (plan as { deleted_at?: string | null }).deleted_at ?? null,\n\t\t\t};\n\t\t},\n\t);\n\n\treturn (\n\t\t<WorkDataView\n\t\t\tkanban={<MaintenancePlansKanban plans={plans} />}\n\t\t\tsection=\"maintenancePlans\"\n\t\t\ttable={\n\t\t\t\t<MaintenancePlansTable\n\t\t\t\t\tcurrentPage={currentPage}\n\t\t\t\t\titemsPerPage={MAINTENANCE_PLANS_PAGE_SIZE}\n\t\t\t\t\tplans={plans}\n\t\t\t\t\ttotalCount={totalCount}\n\t\t\t\t/>\n\t\t\t}\n\t\t/>\n\t);\n}\n","import { cache } from \"react\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\nimport type { Database } from \"@/types/supabase\";\n\nexport const MAINTENANCE_PLANS_PAGE_SIZE = 50;\n\nconst MAINTENANCE_PLANS_SELECT = `\n  id,\n  company_id,\n  plan_number,\n  name,\n  frequency,\n  next_service_date,\n  amount,\n  status,\n  customer:customers!maintenance_plans_customer_id_fkey (\n    id,\n    display_name,\n    first_name,\n    last_name\n  )\n`;\n\ntype CustomerRelation = {\n\tid: string;\n\tdisplay_name: string | null;\n\tfirst_name: string | null;\n\tlast_name: string | null;\n} | null;\n\nexport type MaintenancePlanQueryResult =\n\tDatabase[\"public\"][\"Tables\"][\"maintenance_plans\"][\"Row\"] & {\n\t\tcustomer: CustomerRelation | CustomerRelation[] | null;\n\t};\n\nexport type MaintenancePlansPageResult = {\n\tplans: MaintenancePlanQueryResult[];\n\ttotalCount: number;\n};\n\nexport async function getMaintenancePlansPageData(\n\tpage: number,\n\tpageSize: number = MAINTENANCE_PLANS_PAGE_SIZE,\n\tcompanyIdOverride?: string,\n): Promise<MaintenancePlansPageResult> {\n\t// IMPORTANT: Cannot use \"use cache\" here because we call getActiveCompanyId()\n\t// which uses cookies(). The query is already fast enough without page-level caching.\n\tconst companyId = companyIdOverride ?? (await getActiveCompanyId());\n\tif (!companyId) {\n\t\treturn { plans: [], totalCount: 0 };\n\t}\n\n\tconst supabase = await createServiceSupabaseClient();\n\tif (!supabase) {\n\t\tthrow new Error(\"Supabase client not configured\");\n\t}\n\tconst start = (Math.max(page, 1) - 1) * pageSize;\n\tconst end = start + pageSize - 1;\n\n\tconst { data, error, count } = await supabase\n\t\t.from(\"maintenance_plans\")\n\t\t.select(MAINTENANCE_PLANS_SELECT, { count: \"exact\" })\n\t\t.eq(\"company_id\", companyId)\n\t\t.order(\"created_at\", { ascending: false })\n\t\t.range(start, end);\n\n\tif (error) {\n\t\tthrow new Error(`Failed to fetch maintenance plans: ${error.message}`);\n\t}\n\n\treturn {\n\t\tplans: (data ?? []) as MaintenancePlanQueryResult[],\n\t\ttotalCount: count ?? 0,\n\t};\n}\n\n/**\n * Fetch complete maintenance plan data including customer, property, and tags\n * Uses React.cache() for request-level deduplication\n */\nconst getMaintenancePlanComplete = cache(\n\tasync (maintenancePlanId: string, companyId: string) => {\n\t\tconst supabase = await createServiceSupabaseClient();\n\t\tif (!supabase) {\n\t\t\tthrow new Error(\"Supabase client not configured\");\n\t\t}\n\n\t\tconst { data, error } = await supabase.rpc(\n\t\t\t\"get_maintenance_plan_complete\",\n\t\t\t{\n\t\t\t\tp_maintenance_plan_id: maintenancePlanId,\n\t\t\t\tp_company_id: companyId,\n\t\t\t},\n\t\t);\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Error fetching maintenance plan:\", error);\n\t\t\treturn null;\n\t\t}\n\n\t\treturn data?.[0]?.maintenance_plan_data || null;\n\t},\n);\n","/**\n * MaintenancePlansSkeleton - Loading Skeleton\n *\n * Uses the shared DataTableListSkeleton for consistent UX across all list pages.\n * Displays while maintenance plans data is loading with search bar.\n * Provides visual feedback during streaming.\n */\n\nimport { DataTableListSkeleton } from \"@/components/ui/skeletons\";\n\nexport function MaintenancePlansSkeleton() {\n\treturn <DataTableListSkeleton showSearchBar />;\n}\n"],"names":[],"mappings":"ujBAEO,IAAM,EAAe,CAAA,EAAA,AAD5B,EAAA,CAAA,CAAA,QAC4B,uBAAA,AAAuB,EAC/C,WAAa,MAAM,AAAI,MAAM,sOAAwO,EACrQ,gFACA,mEAHG,IAAM,EAAe,CAAA,EAD5B,AAC4B,EAD5B,CAAA,CAAA,QAC4B,uBAAA,AAAuB,EAC/C,WAAa,MAAM,AAAI,MAAM,sOAAwO,EACrQ,4DACA,0LCHG,IAAM,EAAyB,CAAA,EAAA,AADtC,EAAA,CAAA,CAAA,QACsC,uBAAA,AAAuB,EACzD,WAAa,MAAM,AAAI,MAAM,0PAA4P,EACzR,0FACA,uFAHG,IAAM,EAAyB,CAAA,EAAA,AADtC,EAAA,CAAA,CAAA,QACsC,uBAAA,AAAuB,EACzD,WAAa,MAAM,AAAI,MAAM,0PAA4P,EACzR,sEACA,qJCHG,IAAM,EAAwB,CAAA,EADrC,AACqC,EADrC,CAAA,CAAA,QACqC,uBAAA,AAAuB,EACxD,WAAa,MAAM,AAAI,MAAM,wPAA0P,EACvR,yFACA,oFAHG,IAAM,EAAwB,CAAA,EADrC,AACqC,EADrC,CAAA,CAAA,QACqC,uBAAA,AAAuB,EACxD,WAAa,MAAM,AAAI,MAAM,wPAA0P,EACvR,qEACA,oKCKJ,EAAA,EAAA,CAAA,CAAA,QCVA,EAAA,CAAA,CAAA,QAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAIA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QCNA,EAAA,EAAA,CAAA,CAAA,QAKA,IAAM,EAA2B,CAAC;;;;;;;;;;;;;;;AAelC,CAAC,CAmBM,eAAe,EACrB,CAAY,CACZ,IAA8C,CAC9C,CAA0B,EAI1B,GALmB,CAKb,EAAY,GAAsB,MAAM,CAAA,EAAA,EAAA,kBAAA,AAAkB,IAChE,GAAI,CAAC,EACJ,MAAO,CAAE,EADM,IACC,EAAE,CAAE,WAAY,CAAE,EAGnC,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,2BAAA,AAA2B,IAClD,GAAI,CAAC,EACJ,MAAM,AAAI,EADI,IACE,kCAEjB,IAAM,EAAQ,CAAC,KAAK,GAAG,CAAC,EAAM,IAAK,CAAC,CAAI,EAGlC,MAAE,CAAI,OAAE,CAAK,OAAE,CAAK,CAAE,CAAG,MAAM,EACnC,IAAI,CAAC,qBACL,MAAM,CAAC,EAA0B,CAAE,MAAO,OAAQ,GAClD,EAAE,CAAC,aAAc,GACjB,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GACvC,KAAK,CAAC,EAPI,EAAQ,EAAW,CAOhB,EAEf,GAAI,EACH,KADU,CACJ,AAAI,MAAM,CAAC,mCAAmC,EAAE,EAAM,OAAO,CAAA,CAAE,EAGtE,MAAO,CACN,MAAQ,GAAQ,EAAE,CAClB,WAAY,GAAS,CACtB,CACD,CAMmC,CAAA,EAAA,EAAA,KAAA,AAAK,EACvC,MAAO,EAA2B,KACjC,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,2BAA2B,AAA3B,IACvB,GAAI,CAAC,EACJ,MAAM,AAAI,EADI,IACE,kCAGjB,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAS,GAAG,CACzC,gCACA,CACC,sBAAuB,EACvB,aAAc,CACf,UAGD,AAAI,GACH,IADU,IACF,KAAK,CAAC,mCAAoC,GAC3C,MAGD,GAAM,CAAC,EAAE,EAAE,uBAAyB,IAC5C,GDvFD,IAAM,EAAiE,CACtE,QAAS,UACT,UAAW,YACX,YAAa,YACb,SAAU,YACV,OAAQ,QACT,EAEM,EAA8C,CACnD,SACA,UACA,SACA,YACA,CAkBM,eAAe,EAAqB,cAC1C,CAAY,CAGZ,EACA,GAAM,CAAC,EAAM,EAAgB,CAAG,MAAM,QAAQ,GAAG,CAAC,CACjD,CAAA,EAAA,EAAA,cAAA,AAAc,IACd,CAAA,EAAA,EAAA,kBAAA,AAAkB,IAClB,EAED,GAAI,CAAC,GAID,CAAC,EAJM,AACV,MAAO,CAAA,EAAA,EAAA,IAGc,IAHd,AAAQ,IAOhB,IAAM,EAAc,OAAO,GAAc,OAAS,EAC5C,CAAE,MAAO,CAAQ,YAAE,CAAU,CAAE,CAAG,MAAM,EAC7C,KAEA,GAGK,EAA2B,CAAC,EAJjC,CAI6C,EAAA,AAAE,EAAE,GAAG,CACpD,AAAC,gBACM,EAjCR,CADwB,EAkCW,CAjC/B,CAAC,AAiCmC,IAArB,IAA6B,EAjCjC,AAGR,MAAM,OAAO,CAAC,GAAa,CAAQ,CAAC,EAAE,EAAI,KAAQ,EAFjD,KAkCA,EACL,GAAU,cACV,CAAA,EAAG,GAAU,YAAc,GAAG,CAAC,EAAE,GAAU,WAAa,GAAA,CAAI,CAAC,IAAI,IACjE,UAGK,EAAY,CAAgB,CADb,AACc,EADT,SAAS,EAAE,eAAiB,UACN,EAAI,UAE9C,EAAmB,AACxB,GAAK,MAAM,EAAI,EAAA,CAChB,CAAE,WAAW,GACP,EAAS,EAAe,QAAQ,CAAC,GACpC,EACA,UAEH,MAAO,CACN,GAAI,EAAK,EAAE,CACX,SAAU,EAAK,IAAI,EAAI,EAAK,WAAW,EAAI,EAAK,EAAE,CAClD,SAAU,EACV,YACE,EAA0C,YAAY,EACvD,EAAK,IAAI,EACT,yBACD,EACA,UApEH,CADmB,AAqEL,EAAW,EAAK,iBAAiB,EAnE5C,IAAI,KAAK,GAAO,kBAAkB,CAAC,QAAS,CAC5C,MAAO,QACP,IAAK,UACL,KAAM,SACP,GACC,GA+DA,WAAmC,UAAvB,OAAO,EAAK,MAAM,CAAgB,EAAK,MAAM,CAAG,SAC5D,EACA,YACE,EAAyC,WAAW,EAAI,KAC1D,WAAa,EAAwC,UAAU,EAAI,IACpE,CACD,GAGD,MACC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,YAAY,CAAA,CACZ,OAAQ,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,sBAAsB,CAAA,CAAC,MAAO,IACvC,QAAQ,mBACR,MACC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,qBAAqB,CAAA,CACrB,YAAa,EACb,aC/GsC,CD+GxB,EACd,MAAO,EACP,WAAY,KAKjB,CEnHA,EAAA,CAAA,CAAA,QAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QAEO,SAAS,IACf,MAAO,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,qBAAqB,CAAA,CAAC,aAAa,CAAA,CAAA,GAC5C,CHEe,eAAe,EAAqB,cAClD,CAAY,CAGZ,EACA,IAAM,EAAS,MAAM,EAErB,MACC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,QAAQ,CAAA,CAAC,SAAU,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAA,YACpB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAqB,aAAc,KAGvC","ignoreList":[0,1,2]}