module.exports=[471320,607462,285322,301594,301226,a=>{"use strict";var b=a.i(504348),c=a.i(459208);let d={background:"#fafafa",surface:"#fcfcfc",surfaceStrong:"#f2f2f2",primary:"#3c6ff5",primaryText:"#fafafa",heading:"#171717",text:"#171717",muted:"#737373",border:"#e6e6e6",success:"#22c55e",warning:"#f59e0b",error:"#ef4444"};function e({href:a,children:e,variant:f="primary"}){let g={primary:{backgroundColor:d.primary,color:d.primaryText,border:"none"},outline:{backgroundColor:"transparent",color:d.primary,border:`2px solid ${d.primary}`}};return(0,b.jsx)(c.Button,{href:a,style:{display:"inline-block",padding:"12px 24px",fontSize:"16px",fontWeight:"600",textDecoration:"none",borderRadius:"8px",textAlign:"center",transition:"all 0.2s ease",...g[f]},children:e})}a.s(["EMAIL_COLORS",0,d],607462),a.s(["Button",()=>e],471320);var f=a.i(424340),g=a.i(402239);function h({children:a,title:c,style:d}){return(0,b.jsxs)(f.Section,{style:{...i,...d},children:[c&&(0,b.jsx)(g.Text,{style:j,children:c}),a]})}let i={backgroundColor:d.surface,border:`1px solid ${d.border}`,borderRadius:"8px",padding:"24px",margin:"16px 0"},j={fontSize:"18px",fontWeight:"600",color:d.heading,margin:"0 0 16px 0"};a.s(["Card",()=>h],285322);var k=a.i(173686);function l({children:a,level:c=1,style:e}){let f=`h${c}`,g={1:{fontSize:"32px",fontWeight:"700",color:d.heading,margin:"0 0 16px 0",lineHeight:"1.2"},2:{fontSize:"24px",fontWeight:"600",color:d.text,margin:"0 0 12px 0",lineHeight:"1.3"},3:{fontSize:"18px",fontWeight:"600",color:d.muted,margin:"0 0 8px 0",lineHeight:"1.4"}};return(0,b.jsx)(k.Heading,{as:f,style:{...g[c],...e},children:a})}a.s(["Heading",()=>l],301594);var m=a.i(280105),n=a.i(995146),o=a.i(550042),p=a.i(858257),q=a.i(835929),r=a.i(54101),s=a.i(843775),t=a.i(225249);let u=process.env.NEXT_PUBLIC_THORBIS_LOGO_URL||"https://thorbis.com/logo-white.png",v=process.env.NEXT_PUBLIC_WEBSITE_URL||"https://thorbis.com",w=process.env.THORBIS_SUPPORT_EMAIL||"support@thorbis.com",x=`${v}/docs`,y=`${v}/privacy`,z=`${v}/terms`;function A({children:a,previewText:c}){return(0,b.jsxs)(q.Html,{children:[(0,b.jsx)(o.Head,{children:(0,b.jsx)("style",{children:`
          @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

          /* Reset email client styles */
          body { margin: 0; padding: 0; }
          table { border-collapse: collapse; }
          img { border: 0; }

          /* Responsive */
          @media only screen and (max-width: 600px) {
            .mobile-padding { padding: 20px !important; }
            .mobile-text { font-size: 14px !important; }
            .mobile-heading { font-size: 24px !important; }
          }
        `})}),c&&(0,b.jsx)(t.Preview,{children:c}),(0,b.jsx)(m.Body,{style:B,children:(0,b.jsxs)(n.Container,{style:C,children:[(0,b.jsx)(f.Section,{style:D,children:(0,b.jsx)(r.Img,{src:u,alt:"Thorbis",width:"160",height:"40",style:E})}),(0,b.jsx)(f.Section,{style:F,className:"mobile-padding",children:a}),(0,b.jsx)(p.Hr,{style:G}),(0,b.jsxs)(f.Section,{style:H,className:"mobile-padding",children:[(0,b.jsxs)(g.Text,{style:I,children:["Need help?"," ",(0,b.jsx)(s.Link,{href:`mailto:${w}`,style:J,children:"Contact Support"})," • ",(0,b.jsx)(s.Link,{href:x,style:J,children:"Documentation"})]}),(0,b.jsxs)(g.Text,{style:I,children:[(0,b.jsx)(s.Link,{href:y,style:J,children:"Privacy Policy"})," • ",(0,b.jsx)(s.Link,{href:z,style:J,children:"Terms of Service"})]}),(0,b.jsxs)(g.Text,{style:K,children:["© ",new Date().getFullYear()," Thorbis. All rights reserved."]}),(0,b.jsx)(g.Text,{style:L,children:"Thorbis • 123 Innovation Drive, San Francisco, CA 94105"}),(0,b.jsxs)(g.Text,{style:M,children:["You're receiving this email because you have an account with Thorbis."," ",(0,b.jsx)(s.Link,{href:"{{unsubscribe_url}}",style:J,children:"Unsubscribe from marketing emails"})]})]})]})})]})}let B={backgroundColor:d.background,fontFamily:'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale"},C={backgroundColor:d.surface,maxWidth:"600px",margin:"0 auto"},D={backgroundColor:d.primary,padding:"40px 0",textAlign:"center"},E={margin:"0 auto",display:"block"},F={padding:"48px 40px",color:d.text,fontSize:"16px",lineHeight:"24px"},G={borderColor:d.border,borderWidth:"1px",margin:"0"},H={padding:"32px 40px",textAlign:"center",backgroundColor:d.surfaceStrong},I={color:d.muted,fontSize:"14px",lineHeight:"24px",margin:"8px 0"},J={color:d.primary,textDecoration:"none",fontWeight:"500"},K={color:d.muted,fontSize:"13px",margin:"16px 0 0 0",fontWeight:"600"},L={color:d.muted,fontSize:"12px",margin:"8px 0"},M={color:d.muted,fontSize:"11px",margin:"16px 0 0 0",lineHeight:"18px"};a.s(["BaseLayout",()=>A],301226)},740493,a=>{"use strict";var b=a.i(504348),c=a.i(402239),d=a.i(471320),e=a.i(285322),f=a.i(301594),g=a.i(301226),h=a.i(607462);function i({customerName:a,invoiceNumber:h,totalAmount:i,dueDate:B,items:C,paymentUrl:D,downloadUrl:E,previewText:F=`Invoice ${h} for ${i}`}){return(0,b.jsxs)(g.BaseLayout,{previewText:F,children:[(0,b.jsxs)(f.Heading,{level:1,children:["Invoice ",h]}),(0,b.jsxs)(c.Text,{style:j,children:["Hi ",a,","]}),(0,b.jsx)(c.Text,{style:j,children:"Thank you for your business! Please find your invoice details below."}),(0,b.jsxs)(e.Card,{style:k,children:[(0,b.jsxs)("div",{style:l,children:[(0,b.jsx)(c.Text,{style:m,children:"Amount Due"}),(0,b.jsx)(c.Text,{style:n,children:i})]}),(0,b.jsxs)("div",{style:o,children:[(0,b.jsxs)("div",{style:p,children:[(0,b.jsx)(c.Text,{style:q,children:"Invoice Number:"}),(0,b.jsx)(c.Text,{style:r,children:h})]}),(0,b.jsxs)("div",{style:p,children:[(0,b.jsx)(c.Text,{style:q,children:"Due Date:"}),(0,b.jsx)(c.Text,{style:r,children:B})]})]})]}),C.length>0&&(0,b.jsxs)(e.Card,{style:s,children:[(0,b.jsx)(f.Heading,{level:3,style:{marginBottom:"16px"},children:"Invoice Details"}),(0,b.jsxs)("table",{style:t,children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{style:u,children:"Description"}),(0,b.jsx)("th",{style:{...u,textAlign:"center"},children:"Qty"}),(0,b.jsx)("th",{style:{...u,textAlign:"right"},children:"Amount"})]})}),(0,b.jsx)("tbody",{children:C.map((a,c)=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{style:v,children:a.description}),(0,b.jsx)("td",{style:{...v,textAlign:"center"},children:a.quantity}),(0,b.jsx)("td",{style:{...v,textAlign:"right"},children:a.amount})]},c))}),(0,b.jsx)("tfoot",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{colSpan:2,style:{...v,fontWeight:"bold"},children:"Total"}),(0,b.jsx)("td",{style:{...v,textAlign:"right",fontWeight:"bold"},children:i})]})})]})]}),(0,b.jsx)("div",{style:w,children:(0,b.jsx)(d.Button,{href:D,children:"Pay Now"})}),(0,b.jsx)(e.Card,{style:x,children:(0,b.jsx)(c.Text,{style:y,children:(0,b.jsx)("a",{href:E,style:z,children:"Download PDF Invoice"})})}),(0,b.jsx)(c.Text,{style:A,children:"If you have any questions about this invoice, please don't hesitate to contact us. We appreciate your prompt payment."})]})}let j={fontSize:"16px",lineHeight:"26px",color:h.EMAIL_COLORS.text,margin:"16px 0"},k={backgroundColor:h.EMAIL_COLORS.primary,padding:"24px",borderRadius:"8px",marginBottom:"24px"},l={textAlign:"center",marginBottom:"16px"},m={fontSize:"14px",color:"rgba(255, 255, 255, 0.8)",margin:"0 0 4px 0"},n={fontSize:"36px",fontWeight:"bold",color:"#ffffff",margin:"0"},o={borderTop:"1px solid rgba(255, 255, 255, 0.2)",paddingTop:"16px"},p={display:"flex",justifyContent:"space-between",marginBottom:"8px"},q={fontSize:"14px",color:"rgba(255, 255, 255, 0.8)",margin:"0"},r={fontSize:"14px",color:"#ffffff",fontWeight:"500",margin:"0"},s={marginBottom:"24px"},t={width:"100%",borderCollapse:"collapse"},u={fontSize:"12px",fontWeight:"600",color:h.EMAIL_COLORS.muted,textTransform:"uppercase",textAlign:"left",padding:"8px 0",borderBottom:`1px solid ${h.EMAIL_COLORS.border}`},v={fontSize:"14px",color:h.EMAIL_COLORS.text,padding:"12px 0",borderBottom:`1px solid ${h.EMAIL_COLORS.border}`},w={textAlign:"center",margin:"32px 0"},x={textAlign:"center",padding:"16px",marginBottom:"24px"},y={fontSize:"14px",color:h.EMAIL_COLORS.muted,margin:"0"},z={color:h.EMAIL_COLORS.primary,textDecoration:"underline"},A={fontSize:"14px",color:h.EMAIL_COLORS.muted,textAlign:"center",margin:"24px 0 0 0"};a.s(["default",()=>i])},873212,a=>a.a(async(b,c)=>{try{var d=a.i(780195),e=a.i(218188),f=a.i(136874),g=a.i(198114),h=a.i(463556),i=a.i(740493),j=a.i(395731),k=b([g]);function l(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format((a||0)/100)}function m(a){return a?new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"}async function n(a){try{let b=await (0,f.createClient)();if(!b)return{success:!1,error:"Database connection failed"};let{data:{user:c}}=await b.auth.getUser();if(!c)return{success:!1,error:"Not authenticated"};let{data:d,error:j}=await b.from("invoices").select(`
				*,
				customer:customers!customer_id(
					id,
					first_name,
					last_name,
					email
				),
				company:companies!company_id(
					id,
					name
				)
			`).eq("id",a).single();if(j||!d)return{success:!1,error:"Invoice not found"};if(!d.customer?.email)return{success:!1,error:"Customer has no email address"};let k=[d.customer.first_name,d.customer.last_name].filter(Boolean).join(" ")||"Valued Customer",n="http://localhost:3000",o=`${n}/pay/${a}`,p=`${n}/api/invoices/${a}/pdf`,q=function(a){if(!a)return[];try{return(Array.isArray(a)?a:[]).map(a=>({description:a.description||a.name||"Item",quantity:a.quantity||1,amount:l(a.total||a.amount||a.unit_price||0)}))}catch{return[]}}(d.line_items),r=(0,i.default)({customerName:k,invoiceNumber:d.invoice_number||`INV-${a.slice(0,8)}`,totalAmount:l(d.total_amount),dueDate:m(d.due_date),items:q.length>0?q:[{description:d.title||"Services Rendered",quantity:1,amount:l(d.total_amount)}],paymentUrl:o,downloadUrl:p,previewText:`Invoice ${d.invoice_number||a.slice(0,8)} for ${l(d.total_amount)}`}),s=await (0,g.sendEmail)({to:d.customer.email,subject:`Invoice ${d.invoice_number||`#${a.slice(0,8)}`} from ${d.company?.name||"Your Service Provider"}`,template:r,templateType:h.EmailTemplate.INVOICE_SENT,companyId:d.company_id,tags:[{name:"invoice_id",value:a},{name:"customer_id",value:d.customer_id}]});if(!s.success)return{success:!1,error:s.error||"Failed to send email"};return await b.from("invoices").update({sent_at:new Date().toISOString(),reminder_count:(d.reminder_count||0)+1,last_reminder_sent_at:new Date().toISOString()}).eq("id",a),(0,e.revalidatePath)(`/dashboard/customers/${d.customer_id}`),(0,e.revalidatePath)(`/dashboard/work/invoices/${a}`),(0,e.revalidatePath)("/dashboard/work/invoices"),{success:!0,message:`Invoice sent to ${d.customer.email}`,data:{emailId:s.data?.id}}}catch(a){return console.error("[sendInvoiceEmail] Error:",a),{success:!1,error:a instanceof Error?a.message:"Failed to send invoice"}}}async function o(b){let c=(await a.A(538088)).default;try{let a=await (0,f.createClient)();if(!a)return{success:!1,error:"Database connection failed"};let{data:{user:d}}=await a.auth.getUser();if(!d)return{success:!1,error:"Not authenticated"};let{data:i,error:j}=await a.from("estimates").select(`
				*,
				customer:customers!customer_id(
					id,
					first_name,
					last_name,
					email
				),
				company:companies!company_id(
					id,
					name
				)
			`).eq("id",b).single();if(j||!i)return{success:!1,error:"Estimate not found"};if(!i.customer?.email)return{success:!1,error:"Customer has no email address"};let k=[i.customer.first_name,i.customer.last_name].filter(Boolean).join(" ")||"Valued Customer",n="http://localhost:3000",o=`${n}/dashboard/work/estimates/${b}`,p=`${n}/estimates/${b}/accept`,q=function(a){if(!a)return[];try{return(Array.isArray(a)?a:[]).map(a=>({description:a.description||a.name||"Service",amount:l(a.total||a.amount||a.unit_price||0)}))}catch{return[]}}(i.line_items),r=c({customerName:k,estimateNumber:i.estimate_number||`EST-${b.slice(0,8)}`,totalAmount:l(i.total_amount),validUntil:m(i.valid_until||i.expires_at),items:q.length>0?q:[{description:i.title||"Proposed Services",amount:l(i.total_amount)}],acceptUrl:p,viewUrl:o,previewText:`Estimate ${i.estimate_number||b.slice(0,8)} for ${l(i.total_amount)}`}),s=await (0,g.sendEmail)({to:i.customer.email,subject:`Estimate ${i.estimate_number||`#${b.slice(0,8)}`} from ${i.company?.name||"Your Service Provider"}`,template:r,templateType:h.EmailTemplate.ESTIMATE_SENT,companyId:i.company_id,tags:[{name:"estimate_id",value:b},{name:"customer_id",value:i.customer_id}]});if(!s.success)return{success:!1,error:s.error||"Failed to send email"};return await a.from("estimates").update({sent_at:new Date().toISOString()}).eq("id",b),(0,e.revalidatePath)(`/dashboard/customers/${i.customer_id}`),(0,e.revalidatePath)(`/dashboard/work/estimates/${b}`),(0,e.revalidatePath)("/dashboard/work/estimates"),{success:!0,message:`Estimate sent to ${i.customer.email}`,data:{emailId:s.data?.id}}}catch(a){return console.error("[sendEstimateEmail] Error:",a),{success:!1,error:a instanceof Error?a.message:"Failed to send estimate"}}}[g]=k.then?(await k)():k,(0,j.ensureServerEntryExports)([n,o]),(0,d.registerServerReference)(n,"401d437f15534a88ca15a64f6eb984496a9be06f5a",null),(0,d.registerServerReference)(o,"40295f87d7cac83dfc3c1e3626ca045351b8684bcf",null),a.s(["sendEstimateEmail",()=>o,"sendInvoiceEmail",()=>n]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=apps_web_src_36823f0b._.js.map