module.exports=[207142,a=>{"use strict";var b=a.i(780195),c=a.i(136874);async function d(a,b,d){let e=await (0,c.createClient)();if(!e)return{success:!1,error:"Database not available"};try{let{data:a,error:c}=await e.from("appointments").select("id, assigned_to").eq("id",b).single();if(c)throw Error(`Schedule check failed: ${c.message}`);if(!a)throw Error("Schedule not found");let{data:f,error:g}=await e.from("appointments").update({assigned_to:d}).eq("id",b).select().single();if(g)throw Error(`Schedule update failed: ${g.message}`);return{success:!0,data:f}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to assign job"}}}async function e(a,b,d){let e=await (0,c.createClient)();if(!e)return{success:!1,error:"Database not available"};try{let c=Math.round((d.getTime()-b.getTime())/6e4),f=a=>{let b=a.getFullYear(),c=String(a.getMonth()+1).padStart(2,"0"),d=String(a.getDate()).padStart(2,"0"),e=String(a.getHours()).padStart(2,"0"),f=String(a.getMinutes()).padStart(2,"0"),g=String(a.getSeconds()).padStart(2,"0");return`${b}-${c}-${d} ${e}:${f}:${g}`},g=f(b),h=f(d),{error:i}=await e.from("appointments").update({start_time:g,end_time:h,duration:c}).eq("id",a);if(i)throw i;return{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to update times"}}}async function f(a,b){let d=await (0,c.createClient)();if(!d)return{success:!1,error:"Database not available"};try{let{data:{user:c}}=await d.auth.getUser();if(!c)return{success:!1,error:"Not authenticated"};let{error:e}=await d.from("appointments").update({status:"cancelled",assigned_to:null,cancelled_at:new Date().toISOString(),cancelled_by:c.id,cancellation_reason:b||null}).eq("id",a);if(e)throw e;return{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to cancel appointment"}}}async function g(a,b,d){let e=await (0,c.createClient)();if(!e)return{success:!1,error:"Database not available"};try{let{data:{user:c}}=await e.auth.getUser();if(!c)return{success:!1,error:"Not authenticated"};let f=new Date().toISOString(),{error:g}=await e.from("appointments").update({status:"cancelled",assigned_to:null,cancelled_at:f,cancelled_by:c.id,cancellation_reason:d||null}).eq("id",a);if(g)throw g;if(b){let{error:a}=await e.from("jobs").update({status:"cancelled",cancelled_at:f,cancelled_by:c.id,cancellation_reason:d||null}).eq("id",b);if(a)throw a}return{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to cancel job and appointment"}}}async function h(a){let b=await (0,c.createClient)();if(!b)return{success:!1,error:"Database not available"};try{let{error:c}=await b.from("appointments").update({archived_at:new Date().toISOString()}).eq("id",a);if(c)throw c;return{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to archive appointment"}}}async function i(a){let b=await (0,c.createClient)();if(!b)return{success:!1,error:"Database not available"};try{let{data:{user:c}}=await b.auth.getUser();if(!c)return{success:!1,error:"Not authenticated"};let d=new Date().toISOString(),{error:e}=await b.from("appointments").update({status:"completed",actual_end_time:d,completed_by:c.id}).eq("id",a);if(e)throw e;return{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to complete appointment"}}}async function j(a,b,d={}){let e=await (0,c.createClient)();if(!e)return{success:!1,error:"Database not available"};try{let{data:{user:c}}=await e.auth.getUser();if(!c)return{success:!1,error:"Not authenticated"};let f=new Date().toISOString(),g={status:b,updated_at:f,...d};"closed"===b&&(g.completed_by=c.id,g.actual_end_time=g.actual_end_time??f);let{error:h}=await e.from("appointments").update(g).eq("id",a);if(h)throw h;return{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:`Failed to update appointment status to ${b}`}}}async function k(a){return j(a,"dispatched")}async function l(a){return j(a,"arrived",{actual_start_time:new Date().toISOString()})}async function m(a){return j(a,"closed",{actual_end_time:new Date().toISOString()})}async function n(a,b,d,e){let f=await (0,c.createClient)();if(!f)return{success:!1,error:"Database not available"};try{let c=Math.round((e.getTime()-d.getTime())/6e4),g=a=>{let b=a.getFullYear(),c=String(a.getMonth()+1).padStart(2,"0"),d=String(a.getDate()).padStart(2,"0"),e=String(a.getHours()).padStart(2,"0"),f=String(a.getMinutes()).padStart(2,"0"),g=String(a.getSeconds()).padStart(2,"0");return`${b}-${c}-${d} ${e}:${f}:${g}`},h=g(d),i=g(e),{data:j,error:k}=await f.from("appointments").update({assigned_to:b,start_time:h,end_time:i,duration:c,updated_at:new Date().toISOString()}).eq("id",a).select().single();if(k)throw k;return{success:!0,data:j}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to move appointment"}}}async function o(a,b,d,e){let f=await (0,c.createClient)();if(!f)return{success:!1,error:"Database not available"};try{let c=Math.round((e.getTime()-d.getTime())/6e4),g=a=>{let b=a.getFullYear(),c=String(a.getMonth()+1).padStart(2,"0"),d=String(a.getDate()).padStart(2,"0"),e=String(a.getHours()).padStart(2,"0"),f=String(a.getMinutes()).padStart(2,"0"),g=String(a.getSeconds()).padStart(2,"0");return`${b}-${c}-${d} ${e}:${f}:${g}`},h=g(d),i=g(e),{data:j,error:k}=await f.from("appointments").update({assigned_to:b,start_time:h,end_time:i,duration:c,status:"scheduled",updated_at:new Date().toISOString()}).eq("id",a).select().single();if(k)throw k;return{success:!0,data:j}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to assign appointment"}}}async function p(a){let b=await (0,c.createClient)();if(!b)return{success:!1,error:"Database not available"};try{let{error:c}=await b.from("appointments").update({assigned_to:null,updated_at:new Date().toISOString()}).eq("id",a);if(c)throw c;return{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to move appointment to Unscheduled"}}}async function q(b,d,e,f){let g=await (0,c.createClient)();if(!g)return{success:!1,error:"Database not available"};try{let{data:{user:c}}=await g.auth.getUser();if(!c)return{success:!1,error:"Not authenticated"};let{data:h}=await g.from("company_memberships").select("company_id").eq("user_id",c.id).eq("status","active").single();if(!h?.company_id)return{success:!1,error:"No active company membership"};let{data:i}=await g.from("company_telnyx_settings").select("phone_number, status").eq("company_id",h.company_id).eq("status","ready").single();if(!i?.phone_number)return{success:!1,error:"No phone number configured for SMS"};let{data:j}=await g.from("companies").select("name").eq("id",h.company_id).single(),k=`Hi! ${d} from ${j?.name||"your service provider"} is on the way to your appointment.`;if(f)try{let a=await fetch(`http://localhost:3000/api/travel-time?destination=${encodeURIComponent(f)}`,{headers:{Cookie:`sb-access-token=${c.id}`}});if(a.ok){let b=await a.json();b.durationText&&(k+=` Estimated arrival: ${b.durationText}.`)}}catch{}k+=" We'll see you soon!";let{sendSMS:l}=await a.A(612244);if(!(await l({to:e,from:i.phone_number,text:k})).success)return{success:!1,error:"Failed to send SMS"};return await g.from("appointments").update({status:"dispatched",dispatched_at:new Date().toISOString()}).eq("id",b),{success:!0,message:"On My Way notification sent successfully"}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to send On My Way notification"}}}(0,a.i(395731).ensureServerEntryExports)([d,e,f,g,h,i,k,l,m,n,o,p,q]),(0,b.registerServerReference)(d,"70438a2d19c2934dbf340f65960cb3301f88d38cd3",null),(0,b.registerServerReference)(e,"70482cdf6ba7060ca0b16f2ea28d8691a93cbe5912",null),(0,b.registerServerReference)(f,"601fcf9855a0cae3a0f1238e7e6ab0a7248f5ff0d4",null),(0,b.registerServerReference)(g,"70b85397633d2ec7a4e8ec1d3ac4ab0702216ae896",null),(0,b.registerServerReference)(h,"405048d6a264d7ae3ad8ea60c8cc225c5627b9ed33",null),(0,b.registerServerReference)(i,"40871b78d9e0136f2bfb2a26d724bac08c55979e01",null),(0,b.registerServerReference)(k,"4023cefc494eedf9321cc01c41274bd09e0baceb4b",null),(0,b.registerServerReference)(l,"401af1cccca2877b6fdd4f049a5ef44df19cbda3ce",null),(0,b.registerServerReference)(m,"40e3ca7c75a73c22bad7803143ef99c89a1af186a6",null),(0,b.registerServerReference)(n,"78c41f78e3378f8c7d47b291fe9c195473167021b0",null),(0,b.registerServerReference)(o,"7888bc41e5951bce9e22d1f72c7e04f2c1f98ec769",null),(0,b.registerServerReference)(p,"4090075f04f8b8e0ce55f600da981c4363c44553f7",null),(0,b.registerServerReference)(q,"7880f45196246990bf710fa56eb7e4cd5c15291c34",null),a.s(["archiveAppointment",()=>h,"arriveAppointment",()=>l,"assignJobToTechnician",()=>d,"assignNewAppointment",()=>o,"cancelAppointment",()=>f,"cancelJobAndAppointment",()=>g,"closeAppointment",()=>m,"completeAppointment",()=>i,"dispatchAppointment",()=>k,"moveAppointment",()=>n,"sendOnMyWayNotification",()=>q,"unassignAppointment",()=>p,"updateAppointmentTimes",()=>e])},755517,a=>a.a(async(b,c)=>{try{a.i(288344),a.i(285956),a.i(336176),a.i(933427),a.i(82608);var d=a.i(970552),e=a.i(765839),f=a.i(198114);a.i(103984),a.i(941771),a.i(854963),a.i(672766),a.i(404352);var g=a.i(304381);a.i(371603),a.i(396829),a.i(444057),a.i(910711);var h=a.i(571708);a.i(495405),a.i(417781),a.i(890375),a.i(162803),a.i(207142),a.i(366398),a.i(839691);var i=b([d,e,f,g,h]);[d,e,f,g,h]=i.then?(await i)():i,a.s([]),c()}catch(a){c(a)}},!1),10023,a=>a.a(async(b,c)=>{try{var d=a.i(755517),e=a.i(288344),f=a.i(285956),g=a.i(336176),h=a.i(933427),i=a.i(82608),j=a.i(970552),k=a.i(765839),l=a.i(198114),m=a.i(103984),n=a.i(941771),o=a.i(854963),p=a.i(672766),q=a.i(404352),r=a.i(304381),s=a.i(371603),t=a.i(396829),u=a.i(444057),v=a.i(910711),w=a.i(571708),x=a.i(495405),y=a.i(417781),z=a.i(890375),A=a.i(162803),B=a.i(207142),C=a.i(366398),D=a.i(839691),E=b([d,j,k,l,r,w]);[d,j,k,l,r,w]=E.then?(await E)():E,a.s(["000478fbf5363dae5000d525663da13e29908cb952",()=>g.getWebRTCCredentials,"0006f7bd89b72f0836ec7bf4db73019f1b32e6c24a",()=>A.getSmsFolderCountsAction,"000f90f949d6a2f5484d061d5a738a59a8c846aeaa",()=>x.getPendingSupportSessions,"001be5cf82b793f19f6a7d010c91c14577fa7a130d",()=>v.checkIsCompanyOwner,"001f005176797ef23488068124fb9a744915a477de",()=>e.getCurrentUserRole,"00235a0ba91f1ba226f33fa40dcf4c93a2c3548c70",()=>y.getEmailFoldersAction,"0043ae510c3322ea499beb9e1bb77d06afb4ef19bd",()=>r.signOut,"004cdde5e6ae8991bab4ba61ae40647c2b823200ba",()=>n.resetHourlyCounters,"00665c1bbcd52d612d5bb4bf3be5e7fc75554132e6",()=>x.getActiveSupportSessions,"006acf41615a2f7795c47b6d7a3016e18300f2ad17",()=>n.resetDailyCounters,"007505a78985e53e083a498c97761ed8a463d3d379",()=>j.checkTelnyxVerificationStatus,"0077abd0cb1e555f91adaa482ad0b2f565bbd0629a",()=>w.getCustomersForDialer,"009e962eae57bf128b2023081fd7259048edd8884a",()=>u.getEmailFolderCountsAction,"00a122f9d5fe3a1603c636c3a251886129b66154f8",()=>p.getProviderHealthDashboard,"00a13dbd00149949fc1367d3e76ae7d789e07f5321",()=>h.createServiceSupabaseClient,"00c53a1f02416c3261983f8096f19a3450bfd51775",()=>m.runHealthCheckForAllDomains,"00cf212b0097820096122537beac12e3403b97d564",()=>q.markAllAsRead,"00ebc03a4ffc993aea7ec2e541686105c2bace2437",()=>u.getTotalUnreadCountAction,"00fe74bdf14126b5ad89e9480e82978d6357f356b3",()=>o.isGmailIntegrationEnabled,"4002f454c46f4c21ca6e9e26362583ccff69c9f914",()=>g.transcribeCallRecording,"4009b5533bd04d9fad82f2e95351e90a25ffe05192",()=>D.startJob,"400b8fb96146bfd004a3166563a5ab5536bb610c70",()=>m.getDomainHealth,"400ce95360aaffa14a99dfdf969ba5166c69a59eb6",()=>o.getUserGmailTokens,"4013f2d8e15e9f879b9243e34cbb744045fea3ab6f",()=>D.removeCustomerFromJob,"4019cf9f81eb3c06f82b5c2f8eb042f3d95d91e933",()=>g.getCompanyPhoneNumbers,"401af1cccca2877b6fdd4f049a5ef44df19cbda3ce",()=>B.arriveAppointment,"401d3d830065dd7c4777fad67f642392f48735c4ab",()=>o.disconnectCompanyGmail,"4023cefc494eedf9321cc01c41274bd09e0baceb4b",()=>B.dispatchAppointment,"40247c617842c31b242455a0961cbd2c3297606a16",()=>g.getCallRoutingRules,"4029b163c1c0acfd806352a72fe8030c8ae4f7f8ac",()=>n.incrementEmailCounter,"40369e8ea4eced7bdaef8203d369469ee7b630db8c",()=>x.endActiveSupportSession,"40413bfa888916480edbc33ebb812158fddf960f89",()=>g.updateCallRoutingRule,"404575d602ef4c60c0058b592b8c3e42fbcd13fc4c",()=>o.disconnectUserGmail,"404a3266e0319dbd8c24fec80bb69ecfe029d2a768",()=>z.searchVendors,"404d6f2891af89c71d5bde33d110a216bdd3ee4729",()=>m.recordDeliveryEvent,"404e47931374ad2a1b54bc11f357703790f6104530",()=>g.startCallRecording,"405048d6a264d7ae3ad8ea60c8cc225c5627b9ed33",()=>B.archiveAppointment,"405a16958f97c37bd4b5711bd8761510bdab55839f",()=>g.transferActiveCall,"405c57a8fed352b8679525b56014eb8c49105c850c",()=>m.getCompanyDomainsHealth,"406864ae05b8b51c66cc2c335999e5011a41cb521f",()=>g.searchPhoneNumbers,"406ba1c9655fc9a1b2015aea1e701e0412af96ce58",()=>D.createJob,"406f6624261c6dd1a908026fa1408a3f6d507b6e7d",()=>e.canDeleteTeamMember,"40704f0e856ad801ef93b43436f219a36f7c0efd2c",()=>f.getPayrixMerchantAccount,"40787b1598849126560f9f0b0f8fe8967338c7bf28",()=>o.getCompanyEmailProvider,"407a5a7d0a7dd7989a963eb2485a3527c1dcb20a70",()=>n.getCompanyActiveDomain,"4081009dd4dff14ff4ece62648bad23a83f2f9f63c",()=>t.updateUserStatus,"4082b52123c24a95685a53c36313418a95c259c65b",()=>w.deleteCustomer,"40871b78d9e0136f2bfb2a26d724bac08c55979e01",()=>B.completeAppointment,"4087f0badccd6aaf6a28b640ab4bbc513f0832d105",()=>j.submitAutomatedVerification,"408d3694fd0dd48e424f53c9bf5083b946ab3ec990",()=>y.createEmailFolderAction,"4090075f04f8b8e0ce55f600da981c4363c44553f7",()=>B.unassignAppointment,"4094cf679b4a10ca0f969f4fc1b55602aac4e0fbc3",()=>q.markAsRead,"4097c3c574342661f9a3c8244961d001234449f36f",()=>s.switchCompany,"40ad037af6f6ab1a3004746d3a1b65afa65527002d",()=>m.processResendWebhookEvent,"40ae25402a089e45aa071d979e8cc6ad136205cc98",()=>j.registerCompanyFor10DLC,"40af86a915f04df8d7cc189fe26e45e0cc24663080",()=>n.checkRateLimit,"40b2df540ec465c5dc19545c96486485bb50b5633b",()=>g.makeCall,"40beeb56302a20d27cd8ba7a0988310f855633d7e6",()=>o.getCompanyGmailTokens,"40c55f8e0922f2c7fd8d502e4c75395bf5f0470430",()=>y.deleteEmailFolderAction,"40c7885bdc4fe4cdd5f57e78579230c58088adbef4",()=>p.checkProviderAlert,"40d050abdabe2ee7293436c505c5f27b4408a2f27c",()=>g.sendTextMessage,"40d347232a1bdd45e08aefd1c04b02a94f66dfd261",()=>D.completeJob,"40d3c4ceeaee653aa257a28ed429a7fd272fa9fb66",()=>p.cleanupOldEvents,"40d5cc291162e2fd61245bdb851d5e8ed609e4ed19",()=>g.stopCallRecording,"40e06418f4b93b40c84a25511e0468e1e8a41ddecf",()=>p.recordProviderEvent,"40e3ca7c75a73c22bad7803143ef99c89a1af186a6",()=>B.closeAppointment,"40e9589cb639f2902eb841bedc1247d966486d6fd7",()=>v.getCompanyPendingActions,"40ecf2c792e84ef4b898fda98ec27277b4a9dddef2",()=>m.generateDeliverabilityReport,"40edd91786b2a482e617fb16f2474d26ec295435e7",()=>g.sendMMSMessage,"40f01c38bcd0dedd8819f5121a098e2ffd43eb6e19",()=>C.createAppointment,"40f1e5f08b8bcdc5c42b2b4791562d08761d764af2",()=>D.archiveJob,"40f8c061cf84f884e77af3425bc24b8a8d72f598fb",()=>l.sendEmail,"40fab1894acc5e3d1fdd8d8c6128a7cecee06e7e6a",()=>q.deleteNotification,"40fd6a80b32792fab749933f98f07503d8e94c0305",()=>g.purchasePhoneNumber,"6013add076e3eaed7dc37e8b800ce977d5abb8d49a",()=>w.getCustomerByPhone,"6016b788b64107b06bd9f3b8d7ab9a318b65e38c27",()=>D.updateJob,"60193685409a9d118f1b364e14ecf57d05fa5638a9",()=>w.searchCustomers,"601fcf9855a0cae3a0f1238e7e6ab0a7248f5ff0d4",()=>B.cancelAppointment,"602e89ae7ace85fc30cd3b4b1dd865d517c0cb1cd5",()=>x.approveSupportSessionRequest,"602fab67313b110e6ccb66e54b1e16450b2a772cc7",()=>o.refreshUserGmailToken,"60302947fc4caffa53a719728f3c2cebace926098c",()=>o.sendCompanyGmailEmail,"603643b13bf288cc628303bb4d12df0311b11434c7",()=>o.syncUserInbox,"6045f8436f9cdfdadb7bfe3955677adfc5f4102de0",()=>l.handleComplaintWebhook,"606753f8910b46d5792f4bdeb457cdf29d1a8bbadc",()=>i.ensureMessagingBranding,"607d0f958daf66b2a0d5277cdda17600dace5156bb",()=>g.deleteCallRoutingRule,"60853f1e409364f7e171e27229217994ff224414e6",()=>g.toggleCallRoutingRule,"60856182db5eaec7f85eda2a5a94c5d7d3524325d6",()=>o.checkCompanyGmailHealth,"60886af124323873afd4d5b64bb4143abbcba2c154",()=>x.rejectSupportSessionRequest,"60b3560b98c07f1ddca0d11759032bb0aef5d4341c",()=>D.updateJobStatus,"60c643a41ce1a8e6cc8338da6e2f3678c386910460",()=>p.getProviderStats,"60eeb51685ac265a4ad793a230a515fe6e462f16f4",()=>o.refreshCompanyGmailToken,"70438a2d19c2934dbf340f65960cb3301f88d38cd3",()=>B.assignJobToTechnician,"70482cdf6ba7060ca0b16f2ea28d8691a93cbe5912",()=>B.updateAppointmentTimes,"708daa303e36e37247e22b5b828b6aad8c73ac283b",()=>o.fetchUserInbox,"70a648f43fa62ae3dcf2070eb90413e96e81591e77",()=>i.ensureMessagingCampaign,"70b85397633d2ec7a4e8ec1d3ac4ab0702216ae896",()=>B.cancelJobAndAppointment,"70c4422bfad1179a11fcab9e7932fcf83e2c5a0958",()=>D.assignCustomerToJob,"70dd3bc4222a87350dc137fa9cbcb849fa1913b397",()=>o.setCompanyEmailProvider,"70f58c5ba46ef02b620d7dc87bae8fc83f6d480755",()=>k.sendVerificationSubmittedEmail,"78255c3fa8c9facf7c3f353202f2907836e8eb5539",()=>p.recordSendFailure,"783861d25688b32ba086bbe9e45444975c36a1b285",()=>p.recordSendSuccess,"78766431b437b16f7cb00b4d64a2f3be5e092ed724",()=>p.recordFallbackTriggered,"7880f45196246990bf710fa56eb7e4cd5c15291c34",()=>B.sendOnMyWayNotification,"7888bc41e5951bce9e22d1f72c7e04f2c1f98ec769",()=>B.assignNewAppointment,"78a8ea4f1cfa571a366adccf36ac04b1c85d61ae2b",()=>l.handleBounceWebhook,"78c41f78e3378f8c7d47b291fe9c195473167021b0",()=>B.moveAppointment,"78d41ef818e75fef94d65a87ea1f0faf418132e3c5",()=>o.storeGmailMessage,"7e3a356960ddd52a3fa4dc6d981ae7202a59eb9a3d",()=>o.storeUserGmailTokens,"7f06df826c4fff42950e712c0f548254e275be2a52",()=>o.storeCompanyGmailTokens]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=apps_web_cff91975._.js.map