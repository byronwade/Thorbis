module.exports=[168241,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call RoleBasedDashboard() from the server but RoleBasedDashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/dashboard/role-based-dashboard.tsx <module evaluation>","RoleBasedDashboard");a.s(["RoleBasedDashboard",0,b])},717022,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call RoleBasedDashboard() from the server but RoleBasedDashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/dashboard/role-based-dashboard.tsx","RoleBasedDashboard");a.s(["RoleBasedDashboard",0,b])},565533,a=>{"use strict";a.i(168241);var b=a.i(717022);a.n(b)},731287,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call PinBoardContent() from the server but PinBoardContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/dashboard/pin-board/pin-board-content.tsx <module evaluation>","PinBoardContent");a.s(["PinBoardContent",0,b])},942499,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call PinBoardContent() from the server but PinBoardContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/dashboard/pin-board/pin-board-content.tsx","PinBoardContent");a.s(["PinBoardContent",0,b])},644355,a=>{"use strict";a.i(731287);var b=a.i(942499);a.n(b)},867820,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call PinBoardPostCard() from the server but PinBoardPostCard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/dashboard/pin-board/pin-board-post-card.tsx <module evaluation>","PinBoardPostCard");a.s(["PinBoardPostCard",0,b])},427012,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call PinBoardPostCard() from the server but PinBoardPostCard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/dashboard/pin-board/pin-board-post-card.tsx","PinBoardPostCard");a.s(["PinBoardPostCard",0,b])},704158,a=>{"use strict";a.i(867820);var b=a.i(427012);a.n(b)},941663,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call PinBoardEditorDialog() from the server but PinBoardEditorDialog is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/dashboard/pin-board/pin-board-editor.tsx <module evaluation>","PinBoardEditorDialog");a.s(["PinBoardEditorDialog",0,b])},997331,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call PinBoardEditorDialog() from the server but PinBoardEditorDialog is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/dashboard/pin-board/pin-board-editor.tsx","PinBoardEditorDialog");a.s(["PinBoardEditorDialog",0,b])},498297,a=>{"use strict";a.i(941663);var b=a.i(997331);a.n(b)},443224,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call PinBoardFileUpload() from the server but PinBoardFileUpload is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/dashboard/pin-board/pin-board-file-upload.tsx <module evaluation>","PinBoardFileUpload");a.s(["PinBoardFileUpload",0,b])},397310,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call PinBoardFileUpload() from the server but PinBoardFileUpload is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/dashboard/pin-board/pin-board-file-upload.tsx","PinBoardFileUpload");a.s(["PinBoardFileUpload",0,b])},107810,a=>{"use strict";a.i(443224);var b=a.i(397310);a.n(b)},57221,a=>{"use strict";var b=a.i(742210);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call AttachmentIndicator() from the server but AttachmentIndicator is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/dashboard/pin-board/pin-board-file-preview.tsx <module evaluation>","AttachmentIndicator"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call PinBoardFilePreview() from the server but PinBoardFilePreview is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/dashboard/pin-board/pin-board-file-preview.tsx <module evaluation>","PinBoardFilePreview");a.s(["AttachmentIndicator",0,c,"PinBoardFilePreview",0,d])},590007,a=>{"use strict";var b=a.i(742210);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call AttachmentIndicator() from the server but AttachmentIndicator is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/dashboard/pin-board/pin-board-file-preview.tsx","AttachmentIndicator"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call PinBoardFilePreview() from the server but PinBoardFilePreview is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/dashboard/pin-board/pin-board-file-preview.tsx","PinBoardFilePreview");a.s(["AttachmentIndicator",0,c,"PinBoardFilePreview",0,d])},974434,a=>{"use strict";a.i(57221);var b=a.i(590007);a.n(b)},894811,a=>{"use strict";var b=a.i(504348),c=a.i(429969),d=a.i(565533);a.i(467361);var e=a.i(445074),f=a.i(136874);let g=(0,c.cache)(async a=>{let b=await (0,f.createClient)();if(!b)return[];let{data:c,error:d}=await b.from("pin_board_categories").select("*").eq("company_id",a).order("sort_order",{ascending:!0});return d?(console.error("Failed to fetch pin board categories:",d),[]):c??[]}),h=(0,c.cache)(async(a,b)=>{let c=await (0,f.createClient)();if(!c)return[];let{categorySlug:d,limit:e=50,includeUnpublished:g=!1}=b??{},h=c.from("pin_board_posts").select(`
      *,
      category:pin_board_categories(id, name, slug, icon, color),
      attachments:pin_board_attachments(id, file_name, file_type, file_size, file_url, description)
    `).eq("company_id",a).order("is_pinned",{ascending:!1}).order("created_at",{ascending:!1}).limit(e);if(g||(h=h.eq("is_published",!0)),d){let{data:b}=await c.from("pin_board_categories").select("id").eq("company_id",a).eq("slug",d).single();b&&(h=h.eq("category_id",b.id))}let{data:i,error:j}=await h;return j?(console.error("Failed to fetch pin board posts:",j),[]):i??[]});(0,c.cache)(async(a,b)=>{let c=await (0,f.createClient)();if(!c)return null;let{data:d,error:e}=await c.from("pin_board_posts").select(`
      *,
      category:pin_board_categories(id, name, slug, icon, color),
      attachments:pin_board_attachments(id, file_name, file_type, file_size, file_url, description, sort_order)
    `).eq("id",b).eq("company_id",a).single();return e?(console.error("Failed to fetch pin board post:",e),null):d}),(0,c.cache)(async(a,b)=>{if(0===b.length)return{};let c=await (0,f.createClient)();if(!c)return{};let{data:d,error:e}=await c.from("pin_board_views").select("post_id").eq("company_id",a).in("post_id",b);if(e)return console.error("Failed to fetch pin board views:",e),{};let g={};for(let a of d??[])g[a.post_id]=(g[a.post_id]||0)+1;return g}),(0,c.cache)(async(a,b,c)=>{if(0===c.length)return new Set;let d=await (0,f.createClient)();if(!d)return new Set;let{data:e,error:g}=await d.from("pin_board_views").select("post_id").eq("company_id",a).eq("user_id",b).in("post_id",c);return g?(console.error("Failed to fetch user viewed posts:",g),new Set):new Set((e??[]).map(a=>a.post_id))}),(0,c.cache)(async(a,b,c=20)=>{let d=await (0,f.createClient)();if(!d)return[];let{data:e,error:g}=await d.from("pin_board_posts").select(`
      *,
      category:pin_board_categories(id, name, slug, icon, color)
    `).eq("company_id",a).eq("is_published",!0).or(`title.ilike.%${b}%,content.ilike.%${b}%`).order("is_pinned",{ascending:!1}).order("created_at",{ascending:!1}).limit(c);return g?(console.error("Failed to search pin board posts:",g),[]):e??[]});let i=(0,c.cache)(async a=>{let b=await (0,f.createClient)();if(!b)return{};let{data:c,error:d}=await b.from("pin_board_posts").select("category_id").eq("company_id",a).eq("is_published",!0);if(d)return console.error("Failed to fetch category stats:",d),{};let e={all:c?.length??0};for(let a of c??[])a.category_id&&(e[a.category_id]=(e[a.category_id]||0)+1);return e});var j=a.i(644355);async function k(){let a=await (0,e.getActiveCompanyId)();if(!a)return null;let[c,d,f]=await Promise.all([g(a),h(a,{limit:50}),i(a)]);return(0,b.jsx)(j.PinBoardContent,{categories:c,posts:d,categoryStats:f,companyId:a})}a.i(704158),a.i(498297),a.i(416128);var l=a.i(109483);function m(){return(0,b.jsxs)("div",{className:"bg-card/50 border-border/50 backdrop-blur-sm rounded-xl border overflow-hidden",children:[(0,b.jsxs)("div",{className:"p-6 border-b border-border/50",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(l.Skeleton,{className:"h-10 w-10 rounded-lg"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Skeleton,{className:"h-5 w-32"}),(0,b.jsx)(l.Skeleton,{className:"h-4 w-48"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(l.Skeleton,{className:"h-9 w-64"}),(0,b.jsx)(l.Skeleton,{className:"h-9 w-24"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-4",children:[(0,b.jsx)(l.Skeleton,{className:"h-8 w-16"}),(0,b.jsx)(l.Skeleton,{className:"h-8 w-32"}),(0,b.jsx)(l.Skeleton,{className:"h-8 w-28"}),(0,b.jsx)(l.Skeleton,{className:"h-8 w-24"}),(0,b.jsx)(l.Skeleton,{className:"h-8 w-36"})]})]}),(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(a=>(0,b.jsxs)("div",{className:"border rounded-lg p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Skeleton,{className:"h-4 w-4"}),(0,b.jsx)(l.Skeleton,{className:"h-5 w-20"})]}),(0,b.jsx)(l.Skeleton,{className:"h-5 w-3/4"}),(0,b.jsx)(l.Skeleton,{className:"h-4 w-full"}),(0,b.jsx)(l.Skeleton,{className:"h-4 w-2/3"}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-2",children:[(0,b.jsx)(l.Skeleton,{className:"h-3 w-24"}),(0,b.jsx)(l.Skeleton,{className:"h-3 w-8"})]})]},a))})})]})}a.i(107810),a.i(974434);var n=a.i(54214);let o={revenue:[],jobs:[],communications:[]},p={metrics:{revenueToday:0,averageTicket:0,jobsScheduledToday:0,jobsCompletedToday:0,jobsInProgress:0,unassignedJobs:0,outstandingInvoicesAmount:0,overdueInvoicesCount:0,communicationsToday:0},alerts:[],operations:{inProgress:[],unassigned:[]},schedule:[],communications:[],financial:{openInvoices:[]},activity:[],analytics:o,lastUpdated:new Date().toISOString()};function q(a){return"number"==typeof a?a:0}function r(a,b,c){if(a&&a.trim().length>0)return a;let d=[b,c].filter(a=>a&&a.trim().length>0).join(" ");return d.length>0?d:void 0}let s=(0,c.cache)(async a=>{try{let b,c,d=await (0,f.createClient)();if(!d||!a)return p;let e=new Date,g=((b=new Date(e)).setHours(0,0,0,0),b).toISOString(),h=((c=new Date(e)).setHours(23,59,59,999),c).toISOString(),[i,j,k,l,m,s,t,u,v]=await Promise.all([d.from("jobs").select(`
          id,
          job_number,
          title,
          status,
          priority,
          scheduled_start,
          total_amount,
          customers:customers!customer_id(
            display_name,
            first_name,
            last_name
          ),
          properties:properties!property_id(
            address,
            city,
            state,
            zip_code
          )
        `).eq("company_id",a).gte("scheduled_start",g).lt("scheduled_start",h).is("deleted_at",null).order("scheduled_start",{ascending:!0}).limit(50),d.from("jobs").select(`
          id,
          job_number,
          title,
          status,
          priority,
          scheduled_start,
          total_amount,
          customers:customers!customer_id(
            display_name,
            first_name,
            last_name
          ),
          properties:properties!property_id(
            address,
            city,
            state,
            zip_code
          )
        `).eq("company_id",a).in("status",["in_progress","en_route","on_hold"]).is("deleted_at",null).order("updated_at",{ascending:!1}).limit(15),d.from("jobs").select("id, total_amount, actual_end").eq("company_id",a).eq("status","completed").gte("actual_end",g).lt("actual_end",h).is("deleted_at",null),d.from("jobs").select(`
          id,
          job_number,
          title,
          status,
          priority,
          scheduled_start,
          total_amount,
          customers:customers!customer_id(
            display_name,
            first_name,
            last_name
          ),
          properties:properties!property_id(
            address,
            city,
            state,
            zip_code
          )
        `).eq("company_id",a).in("status",["scheduled","dispatch_required","pending"]).is("assigned_to",null).is("deleted_at",null).order("scheduled_start",{ascending:!0}).limit(15),d.from("appointments").select(`
          id,
          title,
          start_time,
          end_time,
          status,
          assigned_user:users!assigned_to(
            id,
            first_name,
            last_name
          ),
          customers:customers!customer_id(
            display_name,
            first_name,
            last_name
          ),
          properties:properties!property_id(
            address,
            city,
            state,
            zip_code
          ),
          job:jobs!job_id(
            id,
            job_number,
            status
          )
        `).eq("company_id",a).gte("start_time",g).lt("start_time",h).is("deleted_at",null).order("start_time",{ascending:!0}).limit(12),d.from("communications").select(`
          id,
          type,
          direction,
          subject,
          status,
          created_at,
          customers:customers!customer_id(
            display_name,
            first_name,
            last_name
          )
        `).eq("company_id",a).gte("created_at",g).lt("created_at",h).is("deleted_at",null).order("created_at",{ascending:!1}).limit(20),d.from("invoices").select(`
          id,
          invoice_number,
          status,
          total_amount,
          balance_amount,
          due_date,
          customers:customers!customer_id(
            display_name,
            first_name,
            last_name
          )
        `).eq("company_id",a).in("status",["sent","partial","unpaid","overdue"]).is("deleted_at",null).order("due_date",{ascending:!0}).limit(20),d.from("activity_log").select(`
          id,
          entity_type,
          action,
          category,
          created_at,
          actor_name
        `).eq("company_id",a).order("created_at",{ascending:!1}).limit(25),(0,n.getAnalyticsTrends)(a,90).catch(()=>o)]),w=i.data??[],x=j.data??[],y=k.data??[],z=l.data??[],A=m.data??[],B=s.data??[],C=t.data??[],D=u.data??[],E=y.reduce((a,b)=>a+q(b.financial?.total_amount??0),0),F=y.length>0?E/y.length:0,G=C.reduce((a,b)=>a+q(b.balance_amount),0),H=C.filter(a=>!!a.due_date&&("overdue"===a.status||new Date(a.due_date).getTime()<e.getTime())).length,I={revenueToday:E/100,averageTicket:F/100,jobsScheduledToday:w.length,jobsCompletedToday:y.length,jobsInProgress:x.length,unassignedJobs:z.length,outstandingInvoicesAmount:G/100,overdueInvoicesCount:H,communicationsToday:B.length},J=[];I.unassignedJobs>0&&J.push({id:"unassigned-jobs",level:I.unassignedJobs>5?"critical":"warning",title:`${I.unassignedJobs} job${1===I.unassignedJobs?"":"s"} awaiting assignment`,description:"Assign technicians to keep response times within SLA targets."}),I.overdueInvoicesCount>0&&J.push({id:"overdue-invoices",level:"warning",title:`${I.overdueInvoicesCount} overdue invoice${1===I.overdueInvoicesCount?"":"s"}`,description:"Follow up with customers to accelerate collections."}),0===I.revenueToday&&J.push({id:"revenue-zero",level:"info",title:"No completed revenue recorded yet today",description:"Keep an eye on active jobs to ensure timely completion."});let K=a=>({id:a.id,jobNumber:a.job_number,title:a.title,status:a.status,priority:a.priority,scheduledStart:a.scheduled_start,customerName:r(a.customers?.display_name,a.customers?.first_name,a.customers?.last_name),address:a.properties&&[a.properties.address,a.properties.city,a.properties.state,a.properties.zip_code].filter(Boolean).join(", "),totalAmountCents:q(a.financial?.total_amount??0)}),L={inProgress:x.slice(0,6).map(K),unassigned:z.slice(0,6).map(K)},M=A.map(a=>({id:a.id,title:a.title||a.job?.job_number||"Service Visit",startTime:a.start_time,endTime:a.end_time,status:a.status,technicianName:r(void 0,a.assigned_user?.first_name,a.assigned_user?.last_name),customerName:r(a.customers?.display_name,a.customers?.first_name,a.customers?.last_name),address:a.properties&&[a.properties.address,a.properties.city,a.properties.state,a.properties.zip_code].filter(Boolean).join(", "),jobId:a.job?.id??null})).slice(0,8),N=B.map(a=>({id:a.id,type:a.type,direction:a.direction,subject:a.subject,status:a.status,createdAt:a.created_at,customerName:r(a.customers?.display_name,a.customers?.first_name,a.customers?.last_name)})),O=C.map(a=>({id:a.id,invoiceNumber:a.invoice_number,status:a.status,totalAmountCents:q(a.total_amount),balanceAmountCents:q(a.balance_amount),dueDate:a.due_date,customerName:r(a.customers?.display_name,a.customers?.first_name,a.customers?.last_name)})),P=D.map(a=>({id:a.id,entityType:a.entity_type,action:a.action,createdAt:a.created_at,actorName:a.actor_name}));return{metrics:I,alerts:J,operations:L,schedule:M,communications:N,financial:{openInvoices:O},activity:P,analytics:v,lastUpdated:e.toISOString()}}catch{return p}});async function t(){let a=await (0,e.getActiveCompanyId)(),f=a?await s(a):null,g=Date.now();return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(d.RoleBasedDashboard,{dashboardData:f,renderedAt:g}),(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(m,{}),children:(0,b.jsx)(k,{})})]})}function u({children:a}){return(0,b.jsx)("div",{className:"mx-auto flex min-h-full w-full max-w-7xl flex-col gap-4 md:gap-6 p-4 md:p-6 pb-16",children:a})}function v(){return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[void 0,void 0,void 0,void 0].map((a,c)=>(0,b.jsxs)("div",{className:"bg-card animate-pulse rounded-lg border p-6",children:[(0,b.jsx)("div",{className:"bg-muted h-4 w-24 rounded"}),(0,b.jsx)("div",{className:"bg-muted mt-2 h-8 w-32 rounded"}),(0,b.jsx)("div",{className:"bg-muted mt-2 h-3 w-20 rounded"})]},c))}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-card animate-pulse rounded-lg border p-6",children:[(0,b.jsx)("div",{className:"bg-muted h-6 w-32 rounded"}),(0,b.jsx)("div",{className:"mt-4 space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((a,c)=>(0,b.jsx)("div",{className:"bg-muted h-16 rounded"},c))})]}),(0,b.jsxs)("div",{className:"bg-card animate-pulse rounded-lg border p-6",children:[(0,b.jsx)("div",{className:"bg-muted h-6 w-32 rounded"}),(0,b.jsx)("div",{className:"mt-4 space-y-3",children:[void 0,void 0,void 0,void 0].map((a,c)=>(0,b.jsx)("div",{className:"bg-muted h-16 rounded"},c))})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-card animate-pulse rounded-lg border p-6",children:[(0,b.jsx)("div",{className:"bg-muted h-6 w-32 rounded"}),(0,b.jsx)("div",{className:"mt-4 space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((a,c)=>(0,b.jsx)("div",{className:"bg-muted h-16 rounded"},c))})]}),(0,b.jsxs)("div",{className:"bg-card animate-pulse rounded-lg border p-6",children:[(0,b.jsx)("div",{className:"bg-muted h-6 w-32 rounded"}),(0,b.jsx)("div",{className:"mt-4 space-y-3",children:[void 0,void 0,void 0,void 0].map((a,c)=>(0,b.jsx)("div",{className:"bg-muted h-16 rounded"},c))})]})]})]})]})}function w(){return(0,b.jsx)(u,{children:(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(v,{}),children:(0,b.jsx)(t,{})})})}a.s(["default",()=>w],894811)}];

//# sourceMappingURL=apps_web_src_cfea6b76._.js.map