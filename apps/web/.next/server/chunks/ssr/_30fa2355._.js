module.exports=[461508,a=>{"use strict";var b=a.i(288344),c=a.i(780195),d=a.i(218188),e=a.i(136874),f=a.i(313170),g=a.i(870547),h=a.i(361300);async function i(a){let b=await (0,e.createClient)();if(!b)return{success:!1,error:"Service unavailable"};try{let c=await (0,h.fetchCompanyTelnyxSettings)(b,a);if(!c||!c.messaging_profile_id||!c.call_control_application_id)return{success:!1,error:"Company Telnyx settings not found. Run provisioning first."};let e=[],i=`https://thorbis.com/api/webhooks/telnyx?company=${a}`,j=await (0,g.fixMessagingProfile)(c.messaging_profile_id,{webhookUrl:i});if(j.success&&j.fixed)e.push(...j.changes);else if(!j.success)return{success:!1,error:`Failed to update messaging profile: ${j.error}`};try{let a=await f.telnyxClient.callControlApplications.retrieve(c.call_control_application_id);a.data?.webhook_event_url!==i&&(await f.telnyxClient.callControlApplications.update(c.call_control_application_id,{webhook_event_url:i,webhook_api_version:"2"}),e.push(`Updated call control webhook URL to ${i}`),e.push("Updated call control webhook API version to 2"))}catch(a){return{success:!1,error:`Failed to update call control application: ${a?.message||a}`}}return(0,d.revalidatePath)("/dashboard/communication"),{success:!0,fixed:e.length>0,changes:e}}catch(a){return{success:!1,error:a?.message||"Failed to fix webhooks"}}}async function j(a){let b=await (0,e.createClient)();if(!b)return{success:!1,error:"Service unavailable"};try{let c=await (0,h.fetchCompanyTelnyxSettings)(b,a);if(!c||!c.default_outbound_phone_number_id||!c.messaging_profile_id)return{success:!1,error:"Company Telnyx settings incomplete. Run provisioning first."};let e=process.env.TELNYX_API_KEY;if(!e)return{success:!1,error:"TELNYX_API_KEY not configured"};let f=await fetch(`https://api.telnyx.com/v2/phone_numbers/${c.default_outbound_phone_number_id}/messaging`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({messaging_profile_id:c.messaging_profile_id})}),g=await f.json();if(!f.ok)return{success:!1,error:`${f.status} ${JSON.stringify(g)}`};return(0,d.revalidatePath)("/dashboard/communication"),{success:!0,data:g.data,message:`Phone number ${c.default_outbound_number} enabled for SMS/MMS`}}catch(a){return{success:!1,error:a?.message||"Failed to enable messaging on phone number"}}}(0,a.i(395731).ensureServerEntryExports)([i,j]),(0,c.registerServerReference)(i,"406c6b0465a4a880dc5b4941deaa6865c4c201462c",null),(0,c.registerServerReference)(j,"40e18cfbd64c1c29c2bc1c090326c6641bbac47e1b",null),a.s([],810835),a.i(810835),a.s(["001f005176797ef23488068124fb9a744915a477de",()=>b.getCurrentUserRole,"406c6b0465a4a880dc5b4941deaa6865c4c201462c",()=>i,"406f6624261c6dd1a908026fa1408a3f6d507b6e7d",()=>b.canDeleteTeamMember,"40e18cfbd64c1c29c2bc1c090326c6641bbac47e1b",()=>j],461508)},858982,a=>{a.v(b=>Promise.all(["server/chunks/ssr/3c0ae_next_4427392f._.js"].map(b=>a.l(b))).then(()=>b(857782)))}];

//# sourceMappingURL=_30fa2355._.js.map