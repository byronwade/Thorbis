{"version":3,"sources":["../../../../../../apps/web/src/components/work/work-data-view.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/components/work/materials-kanban.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/components/work/materials-table.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/work/materials/page.tsx","../../../../../../apps/web/src/components/work/materials/materials-data.tsx","../../../../../../apps/web/src/lib/queries/materials.ts","../../../../../../apps/web/src/components/work/materials/materials-skeleton.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const WorkDataView = registerClientReference(\n    function() { throw new Error(\"Attempted to call WorkDataView() from the server but WorkDataView is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/work/work-data-view.tsx\",\n    \"WorkDataView\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const MaterialsKanban = registerClientReference(\n    function() { throw new Error(\"Attempted to call MaterialsKanban() from the server but MaterialsKanban is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/work/materials-kanban.tsx\",\n    \"MaterialsKanban\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const MaterialsTable = registerClientReference(\n    function() { throw new Error(\"Attempted to call MaterialsTable() from the server but MaterialsTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/work/materials-table.tsx\",\n    \"MaterialsTable\",\n);\n","/**\n * Materials Page - PPR Enabled with Inline Stats\n *\n * Uses Next.js 16 \"use cache\" directive for optimal caching:\n * - Static shell renders instantly (5-20ms)\n * - Stats stream in toolbar (100-200ms)\n * - Data streams in main content (200-500ms)\n *\n * Performance: 10-40x faster than traditional SSR\n * Clean design: Stats integrated directly into toolbar\n */\n\nimport { Suspense } from \"react\";\nimport { MaterialsData } from \"@/components/work/materials/materials-data\";\nimport { MaterialsSkeleton } from \"@/components/work/materials/materials-skeleton\";\n\nexport default async function MaterialsPage({\n\tsearchParams,\n}: {\n\tsearchParams: Promise<{ page?: string }>;\n}) {\n\tconst params = await searchParams;\n\treturn (\n\t\t<div className=\"flex h-full flex-col\">\n\t\t\t{/* Stats now shown in toolbar - see layout.tsx */}\n\n\t\t\t{/* Table - Main content */}\n\t\t\t<div className=\"flex-1 overflow-hidden\">\n\t\t\t\t<Suspense fallback={<MaterialsSkeleton />}>\n\t\t\t\t\t<MaterialsData searchParams={params} />\n\t\t\t\t</Suspense>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","import { notFound } from \"next/navigation\";\nimport { MaterialsKanban } from \"@/components/work/materials-kanban\";\nimport {\n\ttype Material,\n\tMaterialsTable,\n} from \"@/components/work/materials-table\";\nimport { WorkDataView } from \"@/components/work/work-data-view\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport {\n\tgetMaterialsPageData,\n\tMATERIALS_PAGE_SIZE,\n} from \"@/lib/queries/materials\";\n\ntype PriceBookItemRow = {\n\tid: string;\n\tcompany_id: string;\n\tname: string | null;\n\tdescription: string | null;\n\tsku: string | null;\n\tcategory: string | null;\n\tsubcategory: string | null;\n\tunit: string | null;\n\tis_active: boolean | null;\n};\n\ntype InventoryRow = {\n\tid: string;\n\tupdated_at: string | null;\n\tquantity_on_hand: number | null;\n\tquantity_reserved: number | null;\n\tquantity_available: number | null;\n\tminimum_quantity: number | null;\n\tcost_per_unit: number | null;\n\ttotal_cost_value: number | null;\n\tstatus: string | null;\n\twarehouse_location: string | null;\n\tprimary_location: string | null;\n\tis_low_stock: boolean | null;\n\tlow_stock_alert_sent: boolean | null;\n\tnotes: string | null;\n\tdeleted_at: string | null;\n\tprice_book_item: PriceBookItemRow | PriceBookItemRow[] | null;\n};\n\nexport async function MaterialsData({\n\tsearchParams,\n}: {\n\tsearchParams?: { page?: string };\n}) {\n\tconst activeCompanyId = await getActiveCompanyId();\n\tif (!activeCompanyId) {\n\t\treturn notFound();\n\t}\n\n\tconst currentPage = Number(searchParams?.page) || 1;\n\tconst { materials: materialsRaw, totalCount } = await getMaterialsPageData(\n\t\tcurrentPage,\n\t\tMATERIALS_PAGE_SIZE,\n\t\tactiveCompanyId,\n\t);\n\n\tconst inventoryRows = materialsRaw as InventoryRow[];\n\n\tconst materials = inventoryRows.reduce<Material[]>((accumulator, row) => {\n\t\tconst item = Array.isArray(row.price_book_item)\n\t\t\t? (row.price_book_item[0] ?? null)\n\t\t\t: row.price_book_item;\n\n\t\tif (!item) {\n\t\t\treturn accumulator;\n\t\t}\n\n\t\tconst quantityAvailable = Number(\n\t\t\trow.quantity_available ?? row.quantity_on_hand ?? 0,\n\t\t);\n\t\tconst unitCost = Number(row.cost_per_unit ?? 0);\n\t\tconst totalValue =\n\t\t\tNumber(row.total_cost_value ?? 0) ||\n\t\t\tunitCost * Number(row.quantity_on_hand ?? quantityAvailable ?? 0);\n\n\t\tconst isActive = item.is_active !== false;\n\t\tconst archivedAt = isActive\n\t\t\t? null\n\t\t\t: (row.deleted_at ?? row.updated_at ?? null);\n\n\t\tconst categoryLabel = [item.category, item.subcategory]\n\t\t\t.filter(Boolean)\n\t\t\t.join(\" â€¢ \");\n\n\t\tconst material: Material = {\n\t\t\tid: row.id,\n\t\t\titemCode: item.sku || item.name || \"Uncoded Item\",\n\t\t\tdescription: item.description || item.name || \"Unnamed Material\",\n\t\t\tcategory: categoryLabel || \"Uncategorized\",\n\t\t\tquantity: quantityAvailable,\n\t\t\tunit: item.unit || \"each\",\n\t\t\tunitCost,\n\t\t\ttotalValue,\n\t\t\tstatus: (row.status as Material[\"status\"]) || \"in-stock\",\n\t\t\tarchived_at: archivedAt,\n\t\t\tdeleted_at: row.deleted_at ?? null,\n\t\t};\n\n\t\taccumulator.push(material);\n\t\treturn accumulator;\n\t}, []);\n\n\treturn (\n\t\t<WorkDataView\n\t\t\tkanban={<MaterialsKanban materials={materials} />}\n\t\t\tsection=\"materials\"\n\t\t\ttable={\n\t\t\t\t<MaterialsTable\n\t\t\t\t\tcurrentPage={currentPage}\n\t\t\t\t\titemsPerPage={MATERIALS_PAGE_SIZE}\n\t\t\t\t\tmaterials={materials}\n\t\t\t\t\ttotalCount={totalCount}\n\t\t\t\t/>\n\t\t\t}\n\t\t/>\n\t);\n}\n","import { cache } from \"react\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\n\nexport const MATERIALS_PAGE_SIZE = 50;\n\nconst MATERIALS_SELECT = `\n  id,\n  price_book_item_id,\n  quantity_on_hand,\n  quantity_reserved,\n  quantity_available,\n  minimum_quantity,\n  cost_per_unit,\n  total_cost_value,\n  updated_at,\n  status,\n  warehouse_location,\n  primary_location,\n  is_low_stock,\n  low_stock_alert_sent,\n  notes,\n  deleted_at,\n  price_book_item:price_book_items!inventory_price_book_item_id_price_book_items_id_fk (\n    id,\n    company_id,\n    name,\n    description,\n    sku,\n    category,\n    subcategory,\n    unit,\n    is_active\n  )\n`;\n\nexport type MaterialRecord = {\n\tid: string;\n\tprice_book_item_id: string | null;\n\tquantity_on_hand: number | null;\n\tquantity_reserved: number | null;\n\tquantity_available: number | null;\n\tminimum_quantity: number | null;\n\tcost_per_unit: number | null;\n\ttotal_cost_value: number | null;\n\tupdated_at: string | null;\n\tstatus: string | null;\n\twarehouse_location: string | null;\n\tprimary_location: string | null;\n\tis_low_stock: boolean | null;\n\tlow_stock_alert_sent: boolean | null;\n\tnotes: string | null;\n\tdeleted_at: string | null;\n\tprice_book_item?: Record<string, unknown> | Record<string, unknown>[] | null;\n};\n\nexport type MaterialsPageResult = {\n\tmaterials: MaterialRecord[];\n\ttotalCount: number;\n};\n\nexport const getMaterialsPageData = cache(\n\tasync (\n\t\tpage: number,\n\t\tpageSize: number = MATERIALS_PAGE_SIZE,\n\t\tcompanyIdOverride?: string,\n\t): Promise<MaterialsPageResult> => {\n\t\t// IMPORTANT: Cannot use \"use cache\" here because we call getActiveCompanyId()\n\t\t// which uses cookies(). React.cache() provides request-level deduplication.\n\t\tconst companyId = companyIdOverride ?? (await getActiveCompanyId());\n\t\tif (!companyId) {\n\t\t\treturn { materials: [], totalCount: 0 };\n\t\t}\n\n\t\tconst supabase = await createServiceSupabaseClient();\n\t\tif (!supabase) {\n\t\t\tthrow new Error(\"Supabase client not configured\");\n\t\t}\n\t\tconst start = (Math.max(page, 1) - 1) * pageSize;\n\t\tconst end = start + pageSize - 1;\n\n\t\tconst { data, error, count } = await supabase\n\t\t\t.from(\"inventory\")\n\t\t\t.select(MATERIALS_SELECT, { count: \"exact\" })\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"updated_at\", { ascending: false })\n\t\t\t.range(start, end);\n\n\t\tif (error) {\n\t\t\tthrow new Error(`Failed to fetch materials: ${error.message}`);\n\t\t}\n\n\t\treturn {\n\t\t\tmaterials: data ?? [],\n\t\t\ttotalCount: count ?? 0,\n\t\t};\n\t},\n);\n","/**\n * MaterialsSkeleton - Loading Skeleton\n *\n * Uses the shared DataTableListSkeleton for consistent UX across all list pages.\n * Displays while materials inventory data is loading with search bar.\n * Provides visual feedback during streaming.\n */\n\nimport { DataTableListSkeleton } from \"@/components/ui/skeletons\";\n\nexport function MaterialsSkeleton() {\n\treturn <DataTableListSkeleton showSearchBar />;\n}\n"],"names":[],"mappings":"ujBAEO,IAAM,EAAe,CAAA,EAAA,AAD5B,EAAA,CAAA,CAAA,QAC4B,uBAAA,AAAuB,EAC/C,WAAa,MAAM,AAAI,MAAM,sOAAwO,EACrQ,gFACA,mEAHG,IAAM,EAAe,CAAA,EAD5B,AAC4B,EAD5B,CAAA,CAAA,QAC4B,uBAAA,AAAuB,EAC/C,WAAa,MAAU,AAAJ,MAAU,sOAAwO,EACrQ,4DACA,wLCHG,IAAM,EAAkB,CAAA,EAD/B,AAC+B,EAD/B,CAAA,CAAA,QAC+B,uBAAA,AAAuB,EAClD,WAAa,MAAM,AAAI,MAAM,4OAA8O,EAC3Q,kFACA,yEAHG,IAAM,EAAkB,CAAA,EAAA,AAD/B,EAAA,CAAA,CAAA,QAC+B,uBAAA,AAAuB,EAClD,WAAa,MAAM,AAAI,MAAM,4OAA8O,EAC3Q,8DACA,uICHG,IAAM,EAAiB,CAAA,EAAA,AAD9B,EAAA,CAAA,CAAA,QAC8B,uBAAA,AAAuB,EACjD,WAAa,MAAM,AAAI,MAAM,0OAA4O,EACzQ,iFACA,uEAHG,IAAM,EAAiB,CAAA,EAAA,AAD9B,EAAA,CAAA,CAAA,QAC8B,uBAAA,AAAuB,EACjD,WAAa,MAAM,AAAI,MAAM,0OAA4O,EACzQ,6DACA,uJCOJ,EAAA,EAAA,CAAA,CAAA,QCZA,EAAA,CAAA,CAAA,QAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAIA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QCLA,EAAA,EAAA,CAAA,CAAA,QAEO,IAAM,EAAsB,GAE7B,EAAmB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4B1B,CAAC,CA2BY,EAAuB,CAAA,EAAA,EAAA,KAAA,AAAK,EACxC,MACC,EACA,EAAmB,CAAmB,CACtC,KAIA,IAAM,EAAY,GAAsB,MAAM,CAAA,EAAA,EAAA,kBAAA,AAAkB,IAChE,GAAI,CAAC,EACJ,MAAO,CAAE,EADM,QACK,EAAE,CAAE,WAAY,CAAE,EAGvC,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,2BAAA,AAA2B,IAClD,GAAI,CAAC,EACJ,MAAM,AAAI,EADI,IACE,kCAEjB,IAAM,EAAQ,AAAC,MAAK,GAAG,CAAC,EAAM,IAAK,CAAC,CAAI,EAGlC,CAAE,MAAI,OAAE,CAAK,OAAE,CAAK,CAAE,CAAG,MAAM,EACnC,IAAI,CAAC,aACL,MAAM,CAAC,EAAkB,CAAE,MAAO,OAAQ,GAC1C,EAAE,CAAC,aAAc,GACjB,EAAE,CAAC,aAAc,MACjB,KAAK,CAAC,aAAc,CAAE,UAAW,EAAM,GACvC,KAAK,CAAC,EARI,EAAQ,EAAW,CAQhB,EAEf,GAAI,EACH,KADU,CACJ,AAAI,MAAM,CAAC,2BAA2B,EAAE,EAAM,OAAO,CAAA,CAAE,EAG9D,MAAO,CACN,UAAW,GAAQ,EAAE,CACrB,WAAY,GAAS,CACtB,CACD,GDrDM,eAAe,EAAc,cACnC,CAAY,CAGZ,EACA,IAAM,EAAkB,MAAM,CAAA,EAAA,EAAA,kBAAA,AAAkB,IAChD,GAAI,CAAC,EACJ,MAAO,CAAA,EAAA,EAAA,IADc,IACd,AAAQ,IAGhB,IAAM,EAAc,OAAO,GAAc,OAAS,EAC5C,CAAE,UAAW,CAAY,YAAE,CAAU,CAAE,CAAG,MAAM,EACrD,EACA,EACA,GAKK,EAFgB,AAEJ,EAAc,MAAM,CAAa,CAAC,EAAa,KAChE,IAAM,EAAO,MAAM,OAAO,CAAC,EAAI,eAAe,EAC1C,EAAI,eAAe,CAAC,EAAE,EAAI,KAC3B,EAAI,eAAe,CAEtB,GAAI,CAAC,EACJ,IADU,GACH,EAGR,IAAM,EAAoB,OACzB,EAAI,kBAAkB,EAAI,EAAI,gBAAgB,EAAI,GAE7C,EAAW,OAAO,EAAI,aAAa,EAAI,GACvC,EACL,OAAO,EAAI,gBAAgB,EAAI,IAC/B,EAAW,OAAO,EAAI,gBAAgB,EAAI,GAAqB,GAG1D,EAAa,CADiB,IAAnB,EAAK,SAAS,CAE5B,KACC,EAAI,UAAU,EAAI,EAAI,UAAU,EAAI,KAElC,EAAgB,CAAC,EAAK,QAAQ,CAAE,EAAK,WAAW,CAAC,CACrD,MAAM,CAAC,SACP,IAAI,CAAC,OAED,EAAqB,CAC1B,GAAI,EAAI,EAAE,CACV,SAAU,EAAK,GAAG,EAAI,EAAK,IAAI,EAAI,eACnC,YAAa,EAAK,WAAW,EAAI,EAAK,IAAI,EAAI,mBAC9C,SAAU,GAAiB,gBAC3B,SAAU,EACV,KAAM,EAAK,IAAI,EAAI,gBACnB,EACA,aACA,OAAS,EAAI,MAAM,EAA2B,WAC9C,YAAa,EACb,WAAY,EAAI,UAAU,EAAI,IAC/B,EAGA,OADA,EAAY,IAAI,CAAC,GACV,CACR,EAAG,EAAE,EAEL,MACC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,YAAY,CAAA,CACZ,OAAQ,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,CAAC,UAAW,IACpC,QAAQ,YACR,MACC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,cAAc,CAAA,CACd,YAAa,EACb,aAAc,EACd,UAAW,EACX,WAAY,KAKjB,CEjHA,EAAA,CAAA,CAAA,QAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QAEO,SAAS,IACf,MAAO,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,qBAAqB,CAAA,CAAC,aAAa,CAAA,CAAA,GAC5C,CHIe,eAAe,EAAc,cAC3C,CAAY,CAGZ,EACA,IAAM,EAAS,MAAM,EACrB,MACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gCAId,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,kCACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,QAAQ,CAAA,CAAC,SAAU,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAA,YACpB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAc,aAAc,SAKlC","ignoreList":[0,1,2]}