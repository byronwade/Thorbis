{"version":3,"sources":["../../../../../../apps/web/src/components/schedule/schedule-page-client.tsx/__nextjs-internal-proxy.mjs","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/addDays.js","../../../../../../node_modules/.pnpm/date-fns%404.1.0/node_modules/date-fns/subDays.js","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/schedule/page.tsx","../../../../../../apps/web/src/components/layout/company-gate.tsx","../../../../../../apps/web/src/lib/schedule-bootstrap.ts","../../../../../../apps/web/src/components/schedule/schedule-types.ts","../../../../../../apps/web/src/lib/schedule-data.ts"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const SchedulePageClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call SchedulePageClient() from the server but SchedulePageClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/schedule/schedule-page-client.tsx\",\n    \"SchedulePageClient\",\n);\n","import { constructFrom } from \"./constructFrom.js\";\nimport { toDate } from \"./toDate.js\";\n\n/**\n * The {@link addDays} function options.\n */\n\n/**\n * @name addDays\n * @category Day Helpers\n * @summary Add the specified number of days to the given date.\n *\n * @description\n * Add the specified number of days to the given date.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The date to be changed\n * @param amount - The amount of days to be added.\n * @param options - An object with options\n *\n * @returns The new date with the days added\n *\n * @example\n * // Add 10 days to 1 September 2014:\n * const result = addDays(new Date(2014, 8, 1), 10)\n * //=> Thu Sep 11 2014 00:00:00\n */\nexport function addDays(date, amount, options) {\n  const _date = toDate(date, options?.in);\n  if (isNaN(amount)) return constructFrom(options?.in || date, NaN);\n\n  // If 0 days, no-op to avoid changing times in the hour before end of DST\n  if (!amount) return _date;\n\n  _date.setDate(_date.getDate() + amount);\n  return _date;\n}\n\n// Fallback for modularized imports:\nexport default addDays;\n","import { addDays } from \"./addDays.js\";\n\n/**\n * The {@link subDays} function options.\n */\n\n/**\n * @name subDays\n * @category Day Helpers\n * @summary Subtract the specified number of days from the given date.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The date to be changed\n * @param amount - The amount of days to be subtracted.\n * @param options - An object with options\n *\n * @returns The new date with the days subtracted\n *\n * @example\n * // Subtract 10 days from 1 September 2014:\n * const result = subDays(new Date(2014, 8, 1), 10)\n * //=> Fri Aug 22 2014 00:00:00\n */\nexport function subDays(date, amount, options) {\n  return addDays(date, -amount, options);\n}\n\n// Fallback for modularized imports:\nexport default subDays;\n","/**\n * Schedule Page - PPR Enabled\n *\n * Uses Partial Prerendering for instant page loads:\n * - Static shell renders instantly (5-20ms)\n * - Schedule data streams in (200-500ms)\n *\n * Performance: 8-20x faster than traditional SSR\n *\n * Note: Weather is now displayed in the app header globally\n */\n\nimport { addDays, subDays } from \"date-fns\";\nimport { Suspense } from \"react\";\nimport { CompanyGate } from \"@/components/layout/company-gate\";\nimport { SchedulePageClient } from \"@/components/schedule/schedule-page-client\";\nimport {\n\tgetActiveCompanyId,\n\tgetUserCompanies,\n} from \"@/lib/auth/company-context\";\nimport type { ScheduleBootstrapSerialized } from \"@/lib/schedule-bootstrap\";\nimport { serializeScheduleBootstrap } from \"@/lib/schedule-bootstrap\";\nimport { fetchScheduleData } from \"@/lib/schedule-data\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\n\nasync function getSchedulingSupabaseClient() {\n\ttry {\n\t\t// Try service role client first (bypasses RLS for full company visibility)\n\t\tconst serviceClient = await createServiceSupabaseClient();\n\t\tif (serviceClient) {\n\t\t\treturn serviceClient;\n\t\t}\n\t\t// Service role key not configured - fall back to auth client\n\t\tconsole.warn(\n\t\t\t\"SUPABASE_SERVICE_ROLE_KEY not configured – falling back to authenticated client\",\n\t\t);\n\t\treturn await createClient();\n\t} catch (error) {\n\t\t// Service client creation failed - fall back to auth client\n\t\tconsole.warn(\n\t\t\t\"Supabase service role client failed to initialize – falling back to authenticated client:\",\n\t\t\terror instanceof Error ? error.message : String(error),\n\t\t);\n\t\treturn await createClient();\n\t}\n}\n\n// Schedule data component (async, streams in)\nasync function ScheduleData() {\n\tlet initialData: ScheduleBootstrapSerialized | undefined;\n\tlet bootstrapError: string | null = null;\n\n\tconst companyId = await getActiveCompanyId();\n\tif (!companyId) {\n\t\tconst companies = await getUserCompanies();\n\t\treturn (\n\t\t\t<CompanyGate\n\t\t\t\tcontext=\"scheduling\"\n\t\t\t\thasCompanies={(companies ?? []).length > 0}\n\t\t\t/>\n\t\t);\n\t}\n\n\ttry {\n\t\tconst supabase = await getSchedulingSupabaseClient();\n\n\t\tconst now = new Date();\n\t\tconst defaultRange = {\n\t\t\tstart: subDays(now, 7),\n\t\t\tend: addDays(now, 30),\n\t\t};\n\n\t\t// Fetch schedule data\n\t\tconst { jobs, technicians } = await fetchScheduleData({\n\t\t\tsupabase,\n\t\t\tcompanyId,\n\t\t\trange: defaultRange,\n\t\t});\n\n\t\tinitialData = serializeScheduleBootstrap({\n\t\t\tcompanyId,\n\t\t\tjobs,\n\t\t\ttechnicians,\n\t\t\trange: defaultRange,\n\t\t\tlastSync: new Date(),\n\t\t});\n\t} catch (error) {\n\t\t// Log the full error details to help debug\n\t\tconsole.error(\"Schedule data fetch failed:\", error);\n\t\tif (error instanceof Error) {\n\t\t\tconsole.error(\"Error stack:\", error.stack);\n\t\t}\n\n\t\tbootstrapError =\n\t\t\terror instanceof Error\n\t\t\t\t? error.message\n\t\t\t\t: typeof error === \"string\"\n\t\t\t\t\t? error\n\t\t\t\t\t: \"Unable to load schedule data\";\n\t}\n\n\treturn (\n\t\t<SchedulePageClient\n\t\t\tbootstrapError={bootstrapError}\n\t\t\tinitialData={initialData}\n\t\t/>\n\t);\n}\n\n// Loading skeleton\nfunction ScheduleSkeleton() {\n\treturn (\n\t\t<div className=\"flex h-full w-full items-center justify-center\">\n\t\t\t<div className=\"flex flex-col items-center gap-4\">\n\t\t\t\t<div className=\"border-primary/20 border-t-primary size-12 animate-spin rounded-full border-4\" />\n\t\t\t\t<p className=\"text-muted-foreground text-sm\">Loading schedule...</p>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nexport default function SchedulePage() {\n\treturn (\n\t\t<Suspense fallback={<ScheduleSkeleton />}>\n\t\t\t<ScheduleData />\n\t\t</Suspense>\n\t);\n}\n","import { Building2 } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tCard,\n\tCardContent,\n\tCardDescription,\n\tCardHeader,\n\tCardTitle,\n} from \"@/components/ui/card\";\n\ntype CompanyGateProps = {\n\tcontext?: string;\n\thasCompanies?: boolean;\n};\n\nexport function CompanyGate({\n\tcontext = \"this page\",\n\thasCompanies = false,\n}: CompanyGateProps) {\n\tconst description = hasCompanies\n\t\t? `Choose an active workspace from the switcher so we know which ${context} data to load.`\n\t\t: `You’re not part of any workspace yet. Ask an admin to invite you or create one to unlock ${context}.`;\n\n\treturn (\n\t\t<div className=\"flex min-h-[60vh] items-center justify-center px-6 py-12\">\n\t\t\t<Card className=\"max-w-xl shadow-lg\">\n\t\t\t\t<CardHeader className=\"flex items-start gap-3\">\n\t\t\t\t\t<div className=\"bg-muted rounded-lg p-3\">\n\t\t\t\t\t\t<Building2 className=\"text-muted-foreground size-6\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<CardTitle>Connect a workspace to continue</CardTitle>\n\t\t\t\t\t\t<CardDescription>{description}</CardDescription>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"flex flex-wrap gap-3\">\n\t\t\t\t\t<Button asChild>\n\t\t\t\t\t\t<Link href=\"/dashboard/settings\">Open settings</Link>\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button asChild variant=\"outline\">\n\t\t\t\t\t\t<Link href=\"/dashboard\">Back to dashboard</Link>\n\t\t\t\t\t</Button>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n","import type {\n\tCustomer,\n\tJob,\n\tRecurrenceRule,\n\tTechnician,\n\tTechnicianSchedule,\n} from \"@/components/schedule/schedule-types\";\nimport type { UnassignedJobsMeta } from \"@/lib/schedule/types\";\n\nexport type SerializedRecurrenceRule = Omit<RecurrenceRule, \"endDate\"> & {\n\tendDate?: string;\n};\n\nexport type SerializedCustomer = Omit<Customer, \"createdAt\" | \"updatedAt\"> & {\n\tcreatedAt: string;\n\tupdatedAt: string;\n};\n\nexport type SerializedTechnicianSchedule = Omit<\n\tTechnicianSchedule,\n\t\"daysOff\"\n> & {\n\tdaysOff: string[];\n};\n\nexport type SerializedTechnician = Omit<\n\tTechnician,\n\t\"createdAt\" | \"updatedAt\" | \"schedule\"\n> & {\n\tcreatedAt: string;\n\tupdatedAt: string;\n\tschedule: SerializedTechnicianSchedule;\n};\n\nexport type SerializedJob = Omit<\n\tJob,\n\t| \"startTime\"\n\t| \"endTime\"\n\t| \"createdAt\"\n\t| \"updatedAt\"\n\t| \"customer\"\n\t| \"recurrence\"\n> & {\n\tstartTime: string;\n\tendTime: string;\n\tcreatedAt: string;\n\tupdatedAt: string;\n\tcustomer: SerializedCustomer;\n\trecurrence?: SerializedRecurrenceRule;\n};\n\nexport type ScheduleBootstrapSerialized = {\n\tcompanyId: string;\n\trange: {\n\t\tstart: string;\n\t\tend: string;\n\t};\n\tlastSync: string;\n\tjobs: SerializedJob[];\n\ttechnicians: SerializedTechnician[];\n\tunassignedMeta?: UnassignedJobsMeta;\n};\n\nexport type ScheduleHydrationPayload = {\n\tcompanyId: string;\n\trange: {\n\t\tstart: Date;\n\t\tend: Date;\n\t};\n\tlastSync: Date;\n\tjobs: Job[];\n\ttechnicians: Technician[];\n\tunassignedMeta?: UnassignedJobsMeta;\n};\n\nexport function serializeScheduleBootstrap(\n\tpayload: ScheduleHydrationPayload,\n): ScheduleBootstrapSerialized {\n\treturn {\n\t\tcompanyId: payload.companyId,\n\t\trange: {\n\t\t\tstart: payload.range.start.toISOString(),\n\t\t\tend: payload.range.end.toISOString(),\n\t\t},\n\t\tlastSync: payload.lastSync.toISOString(),\n\t\tjobs: payload.jobs.map(serializeJob),\n\t\ttechnicians: payload.technicians.map(serializeTechnician),\n\t\tunassignedMeta: payload.unassignedMeta,\n\t};\n}\n\nexport function deserializeScheduleBootstrap(\n\tpayload: ScheduleBootstrapSerialized,\n): ScheduleHydrationPayload {\n\treturn {\n\t\tcompanyId: payload.companyId,\n\t\trange: {\n\t\t\tstart: new Date(payload.range.start),\n\t\t\tend: new Date(payload.range.end),\n\t\t},\n\t\tlastSync: new Date(payload.lastSync),\n\t\tjobs: payload.jobs.map(deserializeJob),\n\t\ttechnicians: payload.technicians.map(deserializeTechnician),\n\t\tunassignedMeta: payload.unassignedMeta,\n\t};\n}\n\nexport function serializeJob(job: Job): SerializedJob {\n\treturn {\n\t\t...job,\n\t\tstartTime: job.startTime.toISOString(),\n\t\tendTime: job.endTime.toISOString(),\n\t\tcreatedAt: job.createdAt.toISOString(),\n\t\tupdatedAt: job.updatedAt.toISOString(),\n\t\tcustomer: {\n\t\t\t...job.customer,\n\t\t\tcreatedAt: job.customer.createdAt.toISOString(),\n\t\t\tupdatedAt: job.customer.updatedAt.toISOString(),\n\t\t},\n\t\trecurrence: job.recurrence\n\t\t\t? serializeRecurrence(job.recurrence)\n\t\t\t: undefined,\n\t};\n}\n\nexport function deserializeJob(job: SerializedJob): Job {\n\treturn {\n\t\t...job,\n\t\tstartTime: new Date(job.startTime),\n\t\tendTime: new Date(job.endTime),\n\t\tcreatedAt: new Date(job.createdAt),\n\t\tupdatedAt: new Date(job.updatedAt),\n\t\tcustomer: {\n\t\t\t...job.customer,\n\t\t\tcreatedAt: new Date(job.customer.createdAt),\n\t\t\tupdatedAt: new Date(job.customer.updatedAt),\n\t\t},\n\t\trecurrence: job.recurrence\n\t\t\t? deserializeRecurrence(job.recurrence)\n\t\t\t: undefined,\n\t};\n}\n\nfunction serializeTechnician(technician: Technician): SerializedTechnician {\n\treturn {\n\t\t...technician,\n\t\tcreatedAt: technician.createdAt.toISOString(),\n\t\tupdatedAt: technician.updatedAt.toISOString(),\n\t\tschedule: serializeTechnicianSchedule(technician.schedule),\n\t};\n}\n\nfunction deserializeTechnician(technician: SerializedTechnician): Technician {\n\treturn {\n\t\t...technician,\n\t\tcreatedAt: new Date(technician.createdAt),\n\t\tupdatedAt: new Date(technician.updatedAt),\n\t\tschedule: deserializeTechnicianSchedule(technician.schedule),\n\t};\n}\n\nfunction serializeTechnicianSchedule(\n\tschedule: TechnicianSchedule,\n): SerializedTechnicianSchedule {\n\treturn {\n\t\t...schedule,\n\t\tdaysOff: schedule.daysOff.map((date) => date.toISOString()),\n\t};\n}\n\nfunction deserializeTechnicianSchedule(\n\tschedule: SerializedTechnicianSchedule,\n): TechnicianSchedule {\n\treturn {\n\t\t...schedule,\n\t\tdaysOff: schedule.daysOff.map((value) => new Date(value)),\n\t};\n}\n\nfunction serializeRecurrence(\n\trecurrence: RecurrenceRule,\n): SerializedRecurrenceRule {\n\treturn {\n\t\t...recurrence,\n\t\tendDate: recurrence.endDate ? recurrence.endDate.toISOString() : undefined,\n\t};\n}\n\nfunction deserializeRecurrence(\n\trecurrence: SerializedRecurrenceRule,\n): RecurrenceRule {\n\treturn {\n\t\t...recurrence,\n\t\tendDate: recurrence.endDate ? new Date(recurrence.endDate) : undefined,\n\t};\n}\n","// ============================================\n// CORE DATA TYPES\n// ============================================\n\nexport type Address = {\n\tstreet: string;\n\tcity: string;\n\tstate: string;\n\tzip: string;\n\tcountry: string;\n};\n\nexport type Location = {\n\taddress: Address;\n\tcoordinates: {\n\t\tlat: number;\n\t\tlng: number;\n\t};\n\tplaceId?: string; // Google Places ID\n};\n\nexport type Customer = {\n\tid: string;\n\tname: string;\n\temail?: string;\n\tphone?: string;\n\tcompany?: string;\n\tlocation: Location;\n\tnotes?: string;\n\tcreatedAt: Date;\n\tupdatedAt: Date;\n};\n\nexport type RecurrenceRule = {\n\tfrequency: \"daily\" | \"weekly\" | \"monthly\" | \"yearly\";\n\tinterval: number; // Every N days/weeks/months/years\n\tendDate?: Date;\n\tcount?: number; // Stop after N occurrences\n\tdaysOfWeek?: number[]; // 0-6 (Sunday-Saturday)\n\tdayOfMonth?: number; // 1-31\n\tmonthOfYear?: number; // 1-12\n};\n\nexport type JobMetadata = {\n\testimatedDuration?: number; // minutes\n\tactualDuration?: number; // minutes\n\tmaterials?: string[];\n\tnotes?: string;\n\tinternalNotes?: string;\n\tattachments?: string[]; // URLs\n\ttags?: string[];\n\tcustomFields?: Record<string, any>;\n};\n\nexport type JobAssignmentRole = \"primary\" | \"assistant\" | \"crew\" | \"supervisor\";\n\nexport type JobAssignment = {\n\ttechnicianId: string | null;\n\tteamMemberId?: string | null;\n\tdisplayName: string;\n\tavatar?: string | null;\n\trole: JobAssignmentRole;\n\tstatus?: Technician[\"status\"];\n\tisActive: boolean;\n};\n\nexport type JobType =\n\t| \"service\"\n\t| \"service_call\"\n\t| \"repair\"\n\t| \"installation\"\n\t| \"maintenance\"\n\t| \"premium_maintenance\"\n\t| \"inspection\"\n\t| \"emergency\"\n\t| \"estimate\"\n\t| \"callback\"\n\t| \"other\";\n\n// Appointment category for visual differentiation (meeting vs job vs event)\nexport type AppointmentCategory = \"job\" | \"meeting\" | \"event\";\n\n// Maps database appointment types to display categories\nexport function getAppointmentCategory(\n\ttype?: string | null,\n\tallDay?: boolean,\n): AppointmentCategory {\n\t// All-day appointments are events\n\tif (allDay) return \"event\";\n\n\tswitch (type?.toLowerCase()) {\n\t\tcase \"meeting\":\n\t\tcase \"appointment\":\n\t\tcase \"follow_up\":\n\t\tcase \"consultation\":\n\t\tcase \"call\":\n\t\t\treturn \"meeting\";\n\t\tcase \"event\":\n\t\tcase \"training\":\n\t\tcase \"conference\":\n\t\tcase \"holiday\":\n\t\t\treturn \"event\";\n\t\tcase \"job\":\n\t\tcase \"service\":\n\t\tcase \"repair\":\n\t\tcase \"installation\":\n\t\tcase \"maintenance\":\n\t\tcase \"inspection\":\n\t\tcase \"estimate\":\n\t\tcase \"callback\":\n\t\tdefault:\n\t\t\treturn \"job\";\n\t}\n}\n\nexport type Job = {\n\tid: string; // Schedule ID\n\tjobId?: string; // Actual job ID (for linking to job details)\n\ttechnicianId: string; // Primary technician id (falls back to first assignment or empty string)\n\tassignments: JobAssignment[];\n\tisUnassigned: boolean;\n\n\t// Job details\n\ttitle: string;\n\tdescription?: string;\n\tjobType?: JobType;\n\tappointmentType?: string; // Raw type from appointments table (job, appointment, meeting, etc.)\n\tappointmentCategory?: AppointmentCategory; // Derived: job | meeting | event\n\tcustomer: Customer;\n\tlocation: Location;\n\n\t// Scheduling\n\tstartTime: Date;\n\tendTime: Date;\n\tallDay?: boolean; // For meetings, events\n\n\t// Status\n\tstatus:\n\t\t| \"scheduled\"\n\t\t| \"dispatched\"\n\t\t| \"arrived\"\n\t\t| \"in-progress\"\n\t\t| \"closed\"\n\t\t| \"completed\"\n\t\t| \"cancelled\";\n\tpriority: \"low\" | \"medium\" | \"high\" | \"urgent\";\n\n\t// Recurrence\n\trecurrence?: RecurrenceRule;\n\tparentJobId?: string; // For recurring job instances\n\n\t// Metadata\n\tmetadata: JobMetadata;\n\n\t// Audit\n\tcreatedAt: Date;\n\tupdatedAt: Date;\n\tcreatedBy?: string;\n\tupdatedBy?: string;\n};\n\nexport type TechnicianSchedule = {\n\tavailableHours: {\n\t\tstart: number; // 0-23\n\t\tend: number; // 0-23\n\t};\n\tdaysOff: Date[];\n\tbreakTimes?: Array<{\n\t\tstart: number; // minutes from day start\n\t\tend: number;\n\t}>;\n};\n\nexport type Technician = {\n\tid: string;\n\tuserId?: string;\n\tteamMemberId?: string;\n\tname: string;\n\temail?: string;\n\tphone?: string;\n\tavatar?: string;\n\tcolor?: string;\n\n\t// Employment\n\trole: string;\n\tdepartment?: string;\n\tskills?: string[];\n\tcertifications?: string[];\n\n\t// Status\n\tstatus: \"available\" | \"on-job\" | \"on-break\" | \"offline\";\n\tisActive?: boolean;\n\tcurrentLocation?: Location;\n\n\t// Schedule\n\tschedule: TechnicianSchedule;\n\n\t// Audit\n\tcreatedAt: Date;\n\tupdatedAt: Date;\n};\n\n// ============================================\n// LEGACY COMPATIBILITY (for migration)\n// ============================================\n\n/** @deprecated Use Job with Date objects instead */\nexport type LegacyJob = {\n\tid: string;\n\ttitle: string;\n\tcustomer: string;\n\tstartTime: string; // HH:MM format\n\tendTime: string; // HH:MM format\n\tstatus: \"scheduled\" | \"in-progress\" | \"completed\" | \"cancelled\";\n\tpriority: \"low\" | \"medium\" | \"high\" | \"urgent\";\n\tlocation: string;\n\taddress: string;\n\tlat: number;\n\tlng: number;\n\tdescription?: string;\n\testimatedDuration?: string;\n};\n","import type { SupabaseClient } from \"@supabase/supabase-js\";\nimport { addDays, subDays } from \"date-fns\";\nimport { cache } from \"react\";\nimport {\n\tgetAppointmentCategory,\n\ttype Job,\n\ttype JobAssignment,\n\ttype Technician,\n} from \"@/components/schedule/schedule-types\";\nimport type { UnassignedJobsMeta } from \"@/lib/schedule/types\";\nimport type { ScheduleHydrationPayload } from \"@/lib/schedule-bootstrap\";\nimport type { Database } from \"@/types/supabase\";\n\ntype Tables = Database[\"public\"][\"Tables\"];\n\ntype ScheduleRow = Tables[\"appointments\"][\"Row\"];\ntype CustomerRow = Tables[\"customers\"][\"Row\"];\ntype PropertyRow = Tables[\"properties\"][\"Row\"];\ntype JobRow = Tables[\"jobs\"][\"Row\"];\ntype TeamMemberRow = Tables[\"team_members\"][\"Row\"];\ntype JobTeamAssignmentRow = Tables[\"job_team_assignments\"][\"Row\"];\ntype JobRecord = Tables[\"jobs\"][\"Row\"];\n\ntype JobCustomer = Pick<\n\tCustomerRow,\n\t| \"id\"\n\t| \"first_name\"\n\t| \"last_name\"\n\t| \"email\"\n\t| \"phone\"\n\t| \"created_at\"\n\t| \"updated_at\"\n>;\n\ntype JobRowWithRelations = JobRecord & {\n\tcustomer?: JobCustomer | JobCustomer[] | null;\n\tproperty?: ScheduleProperty | ScheduleProperty[] | null;\n\tjob_team_assignments?: Array<\n\t\tJobTeamAssignmentRow & {\n\t\t\tteam_member: TeamMemberRow | null;\n\t\t}\n\t> | null;\n};\n\nexport type ScheduleRecord = ScheduleRow & {\n\tcustomer: Pick<\n\t\tCustomerRow,\n\t\t\"id\" | \"first_name\" | \"last_name\" | \"email\" | \"phone\"\n\t> | null;\n\tjob:\n\t\t| (JobRow & {\n\t\t\t\tjob_team_assignments: Array<\n\t\t\t\t\tJobTeamAssignmentRow & {\n\t\t\t\t\t\tteam_member: TeamMemberRow | null;\n\t\t\t\t\t}\n\t\t\t\t> | null;\n\t\t  })\n\t\t| null;\n};\n\ntype ScheduleProperty = Pick<\n\tPropertyRow,\n\t| \"id\"\n\t| \"name\"\n\t| \"address\"\n\t| \"address2\"\n\t| \"city\"\n\t| \"state\"\n\t| \"zip_code\"\n\t| \"country\"\n\t| \"lat\"\n\t| \"lon\"\n>;\n\ntype Range = {\n\tstart: Date;\n\tend: Date;\n};\n\ntype LoadParams = {\n\tsupabase: SupabaseClient<Database>;\n\tcompanyId: string;\n\trange?: Range;\n\tunscheduledLimit?: number;\n\tunscheduledOffset?: number;\n\tunscheduledSearch?: string;\n};\n\ntype TeamMemberRecord = TeamMemberRow & {\n\tusers: {\n\t\tid: string;\n\t\tname: string | null;\n\t\temail: string | null;\n\t\tphone: string | null;\n\t\tavatar: string | null;\n\t} | null;\n};\n\nexport type TechniciansLookup = {\n\ttechnicians: Technician[];\n\tbyId: Map<string, Technician>;\n\tbyUserId: Map<string, Technician>;\n\tbyTeamMemberId: Map<string, Technician>;\n};\n\nconst UNASSIGNED_TECHNICIAN_ID = \"__unassigned\";\n\n// Retry utility with exponential backoff for resilient data fetching\ntype RetryOptions = {\n\tmaxRetries?: number;\n\tinitialDelay?: number;\n\tmaxDelay?: number;\n\tbackoffFactor?: number;\n\tshouldRetry?: (error: unknown) => boolean;\n};\n\nconst DEFAULT_RETRY_OPTIONS: Required<RetryOptions> = {\n\tmaxRetries: 3,\n\tinitialDelay: 500,\n\tmaxDelay: 5000,\n\tbackoffFactor: 2,\n\tshouldRetry: (error) => {\n\t\t// Retry on network errors, timeouts, and server errors (5xx)\n\t\tif (error instanceof Error) {\n\t\t\tconst message = error.message.toLowerCase();\n\t\t\treturn (\n\t\t\t\tmessage.includes(\"network\") ||\n\t\t\t\tmessage.includes(\"timeout\") ||\n\t\t\t\tmessage.includes(\"connection\") ||\n\t\t\t\tmessage.includes(\"fetch failed\") ||\n\t\t\t\tmessage.includes(\"econnreset\") ||\n\t\t\t\tmessage.includes(\"500\") ||\n\t\t\t\tmessage.includes(\"502\") ||\n\t\t\t\tmessage.includes(\"503\") ||\n\t\t\t\tmessage.includes(\"504\")\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t},\n};\n\nasync function withRetry<T>(\n\tfn: () => Promise<T>,\n\tcontext: string,\n\toptions: RetryOptions = {},\n): Promise<T> {\n\tconst opts = { ...DEFAULT_RETRY_OPTIONS, ...options };\n\tlet lastError: unknown;\n\tlet delay = opts.initialDelay;\n\n\tfor (let attempt = 0; attempt <= opts.maxRetries; attempt++) {\n\t\ttry {\n\t\t\treturn await fn();\n\t\t} catch (error) {\n\t\t\tlastError = error;\n\n\t\t\tif (attempt === opts.maxRetries || !opts.shouldRetry(error)) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t`[Schedule] ${context} failed after ${attempt + 1} attempt(s):`,\n\t\t\t\t\terror instanceof Error ? error.message : String(error),\n\t\t\t\t);\n\t\t\t\tthrow error;\n\t\t\t}\n\n\t\t\tconsole.warn(\n\t\t\t\t`[Schedule] ${context} attempt ${attempt + 1} failed, retrying in ${delay}ms...`,\n\t\t\t\terror instanceof Error ? error.message : String(error),\n\t\t\t);\n\n\t\t\tawait new Promise((resolve) => setTimeout(resolve, delay));\n\t\t\tdelay = Math.min(delay * opts.backoffFactor, opts.maxDelay);\n\t\t}\n\t}\n\n\tthrow lastError;\n}\n\nconst scheduleSelect = `\n  *,\n  customer:customers(\n    id,\n    first_name,\n    last_name,\n    email,\n    phone\n  ),\n  job:jobs(\n    id,\n    job_number,\n    title,\n    job_type,\n    company_id,\n    job_team_assignments:job_team_assignments!job_team_assignments_job_id_fkey(\n      id,\n      role,\n      team_member_id,\n      removed_at,\n      team_member:team_members(\n        id,\n        company_id,\n        status,\n        job_title,\n        department,\n        archived_at,\n        user_id,\n        phone,\n        email,\n        invited_name,\n        created_at,\n        updated_at\n      )\n    )\n  )\n`;\n\nconst UNSCHEDULED_JOBS_SELECT = `\n  *,\n  customer:customers!customer_id(\n    id,\n    first_name,\n    last_name,\n    email,\n    phone,\n    created_at,\n    updated_at\n  ),\n  property:properties!property_id(\n    id,\n    name,\n    address,\n    address2,\n    city,\n    state,\n    zip_code,\n    country,\n    lat,\n    lon\n  ),\n  job_team_assignments:job_team_assignments!job_team_assignments_job_id_fkey(\n    id,\n    role,\n    team_member_id,\n    removed_at,\n    team_member:team_members(\n      id,\n      company_id,\n      status,\n      job_title,\n      department,\n      archived_at,\n      user_id,\n      phone,\n      email,\n      invited_name,\n      created_at,\n      updated_at\n    )\n  )\n`;\n\nconst DEFAULT_TECHNICIAN_COLOR = \"#3B82F6\";\n\nconst DEFAULT_SCHEDULE = {\n\tworkingHours: { start: \"08:00\", end: \"17:00\" },\n\tdaysOff: [] as Date[],\n\tavailableHours: { start: 0, end: 40 },\n};\n\nconst DEFAULT_LOCATION = {\n\taddress: {\n\t\tstreet: \"\",\n\t\tcity: \"\",\n\t\tstate: \"\",\n\t\tzip: \"\",\n\t\tcountry: \"\",\n\t},\n\tcoordinates: {\n\t\tlat: 0,\n\t\tlng: 0,\n\t},\n};\n\nconst DEFAULT_UNSCHEDULED_DURATION_MINUTES = 60;\nconst DEFAULT_UNSCHEDULED_PAGE_SIZE = 50;\n\ntype UnscheduledQueryOptions = {\n\tlimit?: number;\n\toffset?: number;\n\tsearch?: string;\n};\n\nexport async function fetchScheduleData({\n\tsupabase,\n\tcompanyId,\n\trange,\n\tunscheduledLimit = DEFAULT_UNSCHEDULED_PAGE_SIZE,\n\tunscheduledOffset = 0,\n\tunscheduledSearch = \"\",\n}: LoadParams): Promise<{\n\tjobs: Job[];\n\ttechnicians: Technician[];\n\tunassignedMeta: UnassignedJobsMeta;\n}> {\n\tconst scheduleQuery = supabase\n\t\t.from(\"appointments\")\n\t\t.select(scheduleSelect)\n\t\t.eq(\"company_id\", companyId)\n\t\t.is(\"deleted_at\", null)\n\t\t.is(\"archived_at\", null)\n\t\t.order(\"start_time\", { ascending: true });\n\n\tif (range) {\n\t\tscheduleQuery.lte(\"start_time\", range.end.toISOString());\n\t\tscheduleQuery.gte(\"end_time\", range.start.toISOString());\n\t}\n\n\t// Fetch all three queries in parallel with retry logic (eliminates waterfall)\n\tlet scheduleResult;\n\tlet teamMembers;\n\tlet unscheduledResult;\n\n\ttry {\n\t\t[scheduleResult, teamMembers, unscheduledResult] = await withRetry(\n\t\t\t() =>\n\t\t\t\tPromise.all([\n\t\t\t\t\tscheduleQuery,\n\t\t\t\t\tfetchTeamMembersWithUsers(supabase, companyId),\n\t\t\t\t\tfetchUnscheduledJobs(supabase, companyId, {\n\t\t\t\t\t\tlimit: unscheduledLimit,\n\t\t\t\t\t\toffset: unscheduledOffset,\n\t\t\t\t\t\tsearch: unscheduledSearch,\n\t\t\t\t\t}),\n\t\t\t\t]),\n\t\t\t\"fetchScheduleData parallel queries\",\n\t\t);\n\t} catch (error) {\n\t\tconsole.error(\"[Schedule] Failed to fetch schedule data:\", error);\n\t\tthrow new Error(\n\t\t\t`Schedule data query failed: ${error instanceof Error ? error.message : String(error)}`,\n\t\t);\n\t}\n\n\tconst scheduleRows = scheduleResult.data ?? [];\n\tconst scheduleError = scheduleResult.error;\n\n\tif (scheduleError) {\n\t\tconsole.error(\"Appointments query error:\", scheduleError);\n\t\tthrow new Error(`Appointments query failed: ${scheduleError.message}`);\n\t}\n\n\tconst scheduledJobIds = new Set(\n\t\tscheduleRows\n\t\t\t.map((row) => (row as ScheduleRow).job_id)\n\t\t\t.filter((id): id is string => Boolean(id)),\n\t);\n\n\tconst unscheduledJobRows = unscheduledResult.rows.filter(\n\t\t(row) => !scheduledJobIds.has(row.id),\n\t);\n\tconst unscheduledMeta = {\n\t\ttotalCount: unscheduledResult.totalCount,\n\t\thasMore: unscheduledResult.hasMore,\n\t\tfetchedCount: unscheduledResult.rows.length,\n\t};\n\n\tlet propertyMap;\n\ttry {\n\t\tpropertyMap = await withRetry(\n\t\t\t() =>\n\t\t\t\tfetchPropertiesByIds(\n\t\t\t\t\tsupabase,\n\t\t\t\t\tcollectPropertyIds(scheduleRows as ScheduleRow[], unscheduledJobRows),\n\t\t\t\t),\n\t\t\t\"fetchPropertiesByIds\",\n\t\t);\n\t} catch (error) {\n\t\tconsole.error(\"[Schedule] Failed to fetch properties:\", error);\n\t\t// Return empty map as fallback - jobs will still work but without property details\n\t\tpropertyMap = new Map<string, ScheduleProperty>();\n\t}\n\n\tconst technicianLookups = mapTeamMembersToTechnicians(teamMembers);\n\n\tconst normalizedSchedules = scheduleRows as unknown as ScheduleRecord[];\n\n\tconst scheduledJobs = normalizedSchedules.map((schedule) =>\n\t\tmapScheduleToJob(\n\t\t\tschedule,\n\t\t\ttechnicianLookups,\n\t\t\tpropertyMap.get(schedule.property_id ?? \"\") ?? null,\n\t\t),\n\t);\n\n\tconst unscheduledJobs = unscheduledJobRows.map((jobRow) =>\n\t\tmapJobRowToUnscheduledJob(\n\t\t\tjobRow,\n\t\t\ttechnicianLookups,\n\t\t\tpropertyMap.get(jobRow.property_id ?? \"\") ?? null,\n\t\t),\n\t);\n\n\tconst jobs = [...scheduledJobs, ...unscheduledJobs];\n\n\treturn {\n\t\tjobs,\n\t\ttechnicians: technicianLookups.technicians,\n\t\tunassignedMeta: {\n\t\t\tlimit: unscheduledLimit,\n\t\t\tnextOffset: unscheduledOffset + unscheduledMeta.fetchedCount,\n\t\t\thasMore: unscheduledMeta.hasMore,\n\t\t\tsearch: unscheduledSearch,\n\t\t\ttotalCount: unscheduledMeta.totalCount,\n\t\t},\n\t};\n}\n\nfunction resolveScheduleRange(range?: Range, anchor: Date = new Date()): Range {\n\tif (range) {\n\t\treturn range;\n\t}\n\n\tconst start = subDays(anchor, 7);\n\tconst end = addDays(anchor, 30);\n\treturn { start, end };\n}\n\nasync function loadScheduleSnapshot(\n\tparams: LoadParams & { range?: Range },\n): Promise<ScheduleHydrationPayload> {\n\tconst resolvedRange = resolveScheduleRange(params.range);\n\tconst { jobs, technicians, unassignedMeta } = await fetchScheduleData({\n\t\t...params,\n\t\trange: resolvedRange,\n\t});\n\n\treturn {\n\t\tcompanyId: params.companyId,\n\t\trange: resolvedRange,\n\t\tlastSync: new Date(),\n\t\tjobs,\n\t\ttechnicians,\n\t\tunassignedMeta,\n\t};\n}\n\nfunction createTechnicianJobMap(jobs: Job[]): Record<string, Job[]> {\n\treturn jobs.reduce<Record<string, Job[]>>((acc, job) => {\n\t\tconst key = job.technicianId || UNASSIGNED_TECHNICIAN_ID;\n\t\tif (!acc[key]) {\n\t\t\tacc[key] = [];\n\t\t}\n\t\tacc[key].push(job);\n\t\treturn acc;\n\t}, {});\n}\n\n// Optimized: Single query with join instead of N+1 pattern\nasync function fetchTeamMembersWithUsers(\n\tsupabase: SupabaseClient<Database>,\n\tcompanyId: string,\n): Promise<TeamMemberRecord[]> {\n\t// Use a single query with left join to profiles via user_id\n\tconst { data: membersWithUsers, error } = await supabase\n\t\t.from(\"company_memberships\")\n\t\t.select(`\n\t\t\t*,\n\t\t\tusers:profiles!company_memberships_profile_id_fkey(\n\t\t\t\tid,\n\t\t\t\tfull_name,\n\t\t\t\temail,\n\t\t\t\tphone,\n\t\t\t\tavatar_url\n\t\t\t)\n\t\t`)\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"status\", \"active\")\n\t\t.is(\"archived_at\", null);\n\n\tif (error) {\n\t\t// Fallback to the old two-query approach if join fails\n\t\tconsole.warn(\n\t\t\t\"Join query failed, falling back to sequential queries:\",\n\t\t\terror.message,\n\t\t);\n\t\treturn fetchTeamMembersWithUsersFallback(supabase, companyId);\n\t}\n\n\treturn (membersWithUsers ?? []).map((member) => ({\n\t\t...member,\n\t\tusers: member.users\n\t\t\t? {\n\t\t\t\t\tid: member.users.id,\n\t\t\t\t\tname: member.users.full_name,\n\t\t\t\t\temail: member.users.email,\n\t\t\t\t\tphone: member.users.phone,\n\t\t\t\t\tavatar: member.users.avatar_url,\n\t\t\t\t}\n\t\t\t: null,\n\t})) as TeamMemberRecord[];\n}\n\n// Fallback function if the join doesn't work\nasync function fetchTeamMembersWithUsersFallback(\n\tsupabase: SupabaseClient<Database>,\n\tcompanyId: string,\n): Promise<TeamMemberRecord[]> {\n\tconst { data: bareMembers, error: bareError } = await supabase\n\t\t.from(\"company_memberships\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"status\", \"active\")\n\t\t.is(\"archived_at\", null);\n\n\tif (bareError) {\n\t\tthrow bareError;\n\t}\n\n\tconst userIds = Array.from(\n\t\tnew Set(\n\t\t\t(bareMembers ?? [])\n\t\t\t\t.map((member) => member.user_id)\n\t\t\t\t.filter((id): id is string => Boolean(id)),\n\t\t),\n\t);\n\n\tconst usersById = new Map<string, TeamMemberRecord[\"users\"]>();\n\tif (userIds.length > 0) {\n\t\tconst { data: users, error: userError } = await supabase\n\t\t\t.from(\"profiles\")\n\t\t\t.select(\"id, full_name, email, phone, avatar_url\")\n\t\t\t.in(\"id\", userIds);\n\t\tif (userError) {\n\t\t\tthrow userError;\n\t\t}\n\t\t(users ?? []).forEach((user) => {\n\t\t\tusersById.set(user.id, user);\n\t\t});\n\t}\n\n\treturn (bareMembers ?? []).map((member) => ({\n\t\t...member,\n\t\tusers: member.user_id ? (usersById.get(member.user_id) ?? null) : null,\n\t})) as TeamMemberRecord[];\n}\n\nasync function fetchUnscheduledJobs(\n\tsupabase: SupabaseClient<Database>,\n\tcompanyId: string,\n\toptions: UnscheduledQueryOptions,\n): Promise<{\n\trows: JobRowWithRelations[];\n\ttotalCount: number;\n\thasMore: boolean;\n}> {\n\tconst limit = options.limit ?? DEFAULT_UNSCHEDULED_PAGE_SIZE;\n\tconst offset = options.offset ?? 0;\n\n\tlet query = supabase\n\t\t.from(\"jobs\")\n\t\t.select(UNSCHEDULED_JOBS_SELECT, { count: \"exact\" })\n\t\t.eq(\"company_id\", companyId)\n\t\t.is(\"deleted_at\", null)\n\t\t.is(\"archived_at\", null)\n\t\t.is(\"scheduled_start\", null)\n\t\t.is(\"scheduled_end\", null)\n\t\t.not(\"status\", \"in\", '(\"completed\",\"cancelled\")')\n\t\t.order(\"created_at\", { ascending: false })\n\t\t.range(offset, offset + limit - 1);\n\n\tif (options.search?.trim()) {\n\t\tconst sanitized = options.search.trim().replace(/,/g, \"\\\\,\");\n\t\tconst term = `%${sanitized}%`;\n\t\tquery = query.or(\n\t\t\t`title.ilike.${term},job_number.ilike.${term},description.ilike.${term}`,\n\t\t);\n\t}\n\n\tlet data;\n\tlet count;\n\tlet error;\n\n\ttry {\n\t\tconst result = await query;\n\t\tdata = result.data;\n\t\tcount = result.count;\n\t\terror = result.error;\n\t} catch (fetchError) {\n\t\tconsole.error(\"[Schedule] Unscheduled jobs fetch failed:\", fetchError);\n\t\t// Return empty result instead of throwing - allows schedule to still load with scheduled jobs\n\t\treturn { rows: [], totalCount: 0, hasMore: false };\n\t}\n\n\tif (error) {\n\t\tconsole.error(\"[Schedule] Unscheduled jobs query error:\", error);\n\t\t// Return empty result as fallback\n\t\treturn { rows: [], totalCount: 0, hasMore: false };\n\t}\n\n\tconst rows = (data ?? []) as JobRowWithRelations[];\n\tconst totalCount = typeof count === \"number\" ? count : rows.length;\n\tconst hasMore = offset + rows.length < totalCount;\n\n\treturn { rows, totalCount, hasMore };\n}\n\nasync function fetchPropertiesByIds(\n\tsupabase: SupabaseClient<Database>,\n\tpropertyIds: string[],\n): Promise<Map<string, ScheduleProperty>> {\n\tconst map = new Map<string, ScheduleProperty>();\n\tif (propertyIds.length === 0) {\n\t\treturn map;\n\t}\n\n\tconst chunkSize = 100;\n\tfor (let i = 0; i < propertyIds.length; i += chunkSize) {\n\t\tconst chunk = propertyIds.slice(i, i + chunkSize);\n\t\ttry {\n\t\t\tconst { data, error } = await supabase\n\t\t\t\t.from(\"properties\")\n\t\t\t\t.select(\n\t\t\t\t\t\"id, name, address, address2, city, state, zip_code, country, lat, lon\",\n\t\t\t\t)\n\t\t\t\t.in(\"id\", chunk);\n\n\t\t\tif (error) {\n\t\t\t\tconsole.error(\"[Schedule] Properties query error:\", error);\n\t\t\t\t// Continue with next chunk instead of failing completely\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t(data ?? []).forEach((property) => map.set(property.id, property));\n\t\t} catch (chunkError) {\n\t\t\tconsole.error(\n\t\t\t\t`[Schedule] Failed to fetch properties chunk ${i / chunkSize + 1}:`,\n\t\t\t\tchunkError,\n\t\t\t);\n\t\t}\n\t}\n\treturn map;\n}\n\nfunction mapTeamMembersToTechnicians(\n\tteamMembers: TeamMemberRecord[],\n): TechniciansLookup {\n\tconst technicians: Technician[] = [];\n\tconst byId = new Map<string, Technician>();\n\tconst byUserId = new Map<string, Technician>();\n\tconst byTeamMemberId = new Map<string, Technician>();\n\n\tteamMembers.forEach((member) => {\n\t\tconst technicianId = member.user_id ?? member.id;\n\t\tif (!technicianId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst user = member.users;\n\t\tconst technician: Technician = {\n\t\t\tid: technicianId,\n\t\t\tuserId: member.user_id ?? undefined,\n\t\t\tteamMemberId: member.id,\n\t\t\tname:\n\t\t\t\tuser?.name || member.invited_name || member.job_title || \"Team Member\",\n\t\t\temail: user?.email || member.email || undefined,\n\t\t\tphone: user?.phone || member.phone || undefined,\n\t\t\tavatar: user?.avatar || undefined,\n\t\t\trole: member.job_title || member.role || \"Team Member\",\n\t\t\tdepartment: member.department || undefined,\n\t\t\tstatus: member.status === \"active\" ? \"available\" : \"offline\",\n\t\t\tisActive: member.status === \"active\" && !member.archived_at,\n\t\t\tschedule: { ...DEFAULT_SCHEDULE },\n\t\t\tcolor: DEFAULT_TECHNICIAN_COLOR,\n\t\t\tcreatedAt: new Date(member.created_at),\n\t\t\tupdatedAt: new Date(member.updated_at),\n\t\t};\n\n\t\ttechnicians.push(technician);\n\t\tbyId.set(technician.id, technician);\n\t\tif (technician.userId) {\n\t\t\tbyUserId.set(technician.userId, technician);\n\t\t}\n\t\tif (technician.teamMemberId) {\n\t\t\tbyTeamMemberId.set(technician.teamMemberId, technician);\n\t\t}\n\t});\n\n\treturn { technicians, byId, byUserId, byTeamMemberId };\n}\n\nfunction collectPropertyIds(\n\tschedules: ScheduleRow[],\n\tunscheduledJobs: JobRowWithRelations[],\n): string[] {\n\tconst ids = new Set<string>();\n\tschedules.forEach((row) => {\n\t\tif (row.property_id) {\n\t\t\tids.add(row.property_id);\n\t\t}\n\t});\n\tunscheduledJobs.forEach((job) => {\n\t\tif (job.property_id) {\n\t\t\tids.add(job.property_id);\n\t\t}\n\t});\n\treturn Array.from(ids);\n}\n\nfunction normalizeSingleRecord<T>(value: T | T[] | null | undefined): T | null {\n\tif (Array.isArray(value)) {\n\t\treturn value[0] ?? null;\n\t}\n\treturn value ?? null;\n}\n\nfunction mapJobRowToUnscheduledJob(\n\tjob: JobRowWithRelations,\n\tlookups: TechniciansLookup,\n\tproperty: ScheduleProperty | null,\n): Job {\n\tconst location = buildLocation(property);\n\tconst customer = buildJobCustomer(job, location.address.street);\n\tconst assignments = buildAssignmentsFromJobRow(job, lookups);\n\tconst startTime = job.scheduled_start\n\t\t? new Date(job.scheduled_start)\n\t\t: new Date(job.created_at);\n\tconst endTime = job.scheduled_end\n\t\t? new Date(job.scheduled_end)\n\t\t: new Date(\n\t\t\t\tstartTime.getTime() + DEFAULT_UNSCHEDULED_DURATION_MINUTES * 60 * 1000,\n\t\t\t);\n\n\treturn {\n\t\tid: job.id,\n\t\tjobId: job.id,\n\t\ttechnicianId: \"\",\n\t\tassignments,\n\t\tisUnassigned: true,\n\t\ttitle: job.title || job.job_number || \"Job\",\n\t\tdescription: job.description || undefined,\n\t\tjobType: (job.job_type as Job[\"jobType\"]) || undefined,\n\t\tcustomer,\n\t\tlocation,\n\t\tstartTime,\n\t\tendTime,\n\t\tstatus: mapJobStatus(job.status),\n\t\tpriority: mapJobPriority(job.priority),\n\t\tmetadata: buildJobMetadata(job),\n\t\tcreatedAt: new Date(job.created_at),\n\t\tupdatedAt: new Date(job.updated_at),\n\t};\n}\n\nfunction buildAssignmentsFromJobRow(\n\tjob: JobRowWithRelations,\n\tlookups: TechniciansLookup,\n): JobAssignment[] {\n\tconst assignments: JobAssignment[] = [];\n\n\tif (job.assigned_to) {\n\t\tconst technician =\n\t\t\tlookups.byUserId.get(job.assigned_to) ||\n\t\t\tlookups.byId.get(job.assigned_to);\n\t\tassignments.push({\n\t\t\ttechnicianId: null,\n\t\t\tteamMemberId: technician?.teamMemberId,\n\t\t\tdisplayName: technician?.name || \"Primary Technician\",\n\t\t\tavatar: technician?.avatar ?? null,\n\t\t\trole: \"primary\",\n\t\t\tstatus: technician?.status ?? \"available\",\n\t\t\tisActive: technician?.isActive ?? true,\n\t\t});\n\t}\n\n\tconst crewAssignments = Array.isArray(job.job_team_assignments)\n\t\t? job.job_team_assignments\n\t\t: job.job_team_assignments\n\t\t\t? [job.job_team_assignments]\n\t\t\t: [];\n\n\tcrewAssignments\n\t\t.filter((assignment) => !assignment.removed_at)\n\t\t.forEach((assignment) => {\n\t\t\tconst teamMember = assignment.team_member;\n\t\t\tif (!teamMember) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst technician =\n\t\t\t\t(teamMember.user_id && lookups.byUserId.get(teamMember.user_id)) ||\n\t\t\t\tlookups.byTeamMemberId.get(teamMember.id);\n\n\t\t\tassignments.push({\n\t\t\t\ttechnicianId: null,\n\t\t\t\tteamMemberId: teamMember.id,\n\t\t\t\tdisplayName:\n\t\t\t\t\ttechnician?.name ||\n\t\t\t\t\tteamMember.invited_name ||\n\t\t\t\t\tteamMember.job_title ||\n\t\t\t\t\t\"Crew Member\",\n\t\t\t\tavatar: technician?.avatar ?? null,\n\t\t\t\trole: (assignment.role as JobAssignment[\"role\"]) || \"crew\",\n\t\t\t\tstatus: technician?.status ?? deriveTechnicianStatus(teamMember.status),\n\t\t\t\tisActive: technician?.isActive ?? teamMember.status === \"active\",\n\t\t\t});\n\t\t});\n\n\treturn dedupeAssignments(assignments);\n}\n\nfunction buildJobCustomer(\n\tjob: JobRowWithRelations,\n\tfallbackStreet: string,\n): Job[\"customer\"] {\n\tconst customerRecord = normalizeSingleRecord(job.customer);\n\tconst name = [\n\t\tcustomerRecord?.first_name?.trim() ?? \"\",\n\t\tcustomerRecord?.last_name?.trim() ?? \"\",\n\t]\n\t\t.filter(Boolean)\n\t\t.join(\" \")\n\t\t.trim();\n\n\treturn {\n\t\tid: customerRecord?.id || job.customer_id || `customer-${job.id}`,\n\t\tname: name || job.title || \"Unspecified Customer\",\n\t\temail: customerRecord?.email || undefined,\n\t\tphone: customerRecord?.phone || undefined,\n\t\tlocation: {\n\t\t\t...DEFAULT_LOCATION,\n\t\t\taddress: {\n\t\t\t\t...DEFAULT_LOCATION.address,\n\t\t\t\tstreet: fallbackStreet,\n\t\t\t},\n\t\t},\n\t\tcreatedAt: new Date(customerRecord?.created_at ?? job.created_at),\n\t\tupdatedAt: new Date(customerRecord?.updated_at ?? job.updated_at),\n\t};\n}\n\nfunction buildJobMetadata(job: JobRowWithRelations): Job[\"metadata\"] {\n\tconst baseMetadata =\n\t\tjob.metadata && typeof job.metadata === \"object\"\n\t\t\t? (job.metadata as Job[\"metadata\"])\n\t\t\t: {};\n\tconst metadata = { ...baseMetadata };\n\tif (job.notes) {\n\t\tmetadata.notes = job.notes;\n\t}\n\treturn metadata;\n}\n\nfunction mapJobPriority(value?: string | null): Job[\"priority\"] {\n\tif (!value) {\n\t\treturn \"medium\";\n\t}\n\tconst normalized = value.toLowerCase();\n\tswitch (normalized) {\n\t\tcase \"low\":\n\t\tcase \"medium\":\n\t\tcase \"high\":\n\t\tcase \"urgent\":\n\t\t\treturn normalized as Job[\"priority\"];\n\t\tcase \"critical\":\n\t\tcase \"emergency\":\n\t\t\treturn \"urgent\";\n\t\tdefault:\n\t\t\treturn \"medium\";\n\t}\n}\n\nfunction mapJobStatus(value?: string | null): Job[\"status\"] {\n\tif (!value) {\n\t\treturn \"scheduled\";\n\t}\n\tconst normalized = value.toLowerCase();\n\tswitch (normalized) {\n\t\tcase \"scheduled\":\n\t\tcase \"dispatched\":\n\t\tcase \"arrived\":\n\t\tcase \"closed\":\n\t\tcase \"cancelled\":\n\t\t\treturn normalized as Job[\"status\"];\n\t\tcase \"in-progress\":\n\t\tcase \"in_progress\":\n\t\t\treturn \"in-progress\";\n\t\tcase \"completed\":\n\t\tcase \"complete\":\n\t\tcase \"done\":\n\t\t\treturn \"completed\";\n\t\tcase \"inprogress\":\n\t\t\treturn \"in-progress\";\n\t\tcase \"open\":\n\t\tcase \"pending\":\n\t\tcase \"draft\":\n\t\tdefault:\n\t\t\treturn \"scheduled\";\n\t}\n}\n\nfunction mapScheduleToJob(\n\tschedule: ScheduleRecord,\n\tlookups: TechniciansLookup,\n\tproperty: ScheduleProperty | null,\n): Job {\n\tconst location = buildLocation(property);\n\tconst customer = buildCustomer(schedule, location.address.street);\n\tconst assignments = buildAssignments(schedule, lookups);\n\n\tconst primaryAssignment = assignments.find(\n\t\t(assignment) => assignment.role === \"primary\",\n\t);\n\tconst technicianId = primaryAssignment?.technicianId ?? \"\";\n\n\treturn {\n\t\tid: schedule.id,\n\t\tjobId: schedule.job_id || undefined,\n\t\ttechnicianId,\n\t\tassignments,\n\t\tisUnassigned: assignments.length === 0,\n\t\ttitle: schedule.title || schedule.job?.title || \"Appointment\",\n\t\tdescription: schedule.description || undefined,\n\t\tjobType: (schedule.job?.job_type as Job[\"jobType\"]) || undefined,\n\t\tappointmentType: schedule.type || undefined,\n\t\tappointmentCategory: getAppointmentCategory(\n\t\t\tschedule.type,\n\t\t\tschedule.all_day ?? false,\n\t\t),\n\t\tcustomer,\n\t\tlocation,\n\t\tstartTime: new Date(schedule.start_time),\n\t\tendTime: new Date(schedule.end_time),\n\t\tallDay: schedule.all_day,\n\t\tstatus:\n\t\t\t(schedule.status as Job[\"status\"]) && isJobStatus(schedule.status)\n\t\t\t\t? (schedule.status as Job[\"status\"])\n\t\t\t\t: \"scheduled\",\n\t\tpriority: \"medium\",\n\t\trecurrence: schedule.is_recurring\n\t\t\t? {\n\t\t\t\t\tfrequency: \"weekly\",\n\t\t\t\t\tinterval: 1,\n\t\t\t\t\tendDate: schedule.recurrence_end_date\n\t\t\t\t\t\t? new Date(schedule.recurrence_end_date)\n\t\t\t\t\t\t: undefined,\n\t\t\t\t}\n\t\t\t: undefined,\n\t\tmetadata: {\n\t\t\testimatedDuration: schedule.duration,\n\t\t\tnotes: schedule.notes || undefined,\n\t\t},\n\t\tcreatedAt: new Date(schedule.created_at),\n\t\tupdatedAt: new Date(schedule.updated_at),\n\t};\n}\n\nfunction buildAssignments(\n\tschedule: ScheduleRecord,\n\tlookups: TechniciansLookup,\n): JobAssignment[] {\n\tconst assignments: JobAssignment[] = [];\n\n\tif (schedule.assigned_to) {\n\t\tconst technician =\n\t\t\tlookups.byUserId.get(schedule.assigned_to) ||\n\t\t\tlookups.byId.get(schedule.assigned_to);\n\t\tassignments.push({\n\t\t\ttechnicianId: technician?.id ?? schedule.assigned_to,\n\t\t\tteamMemberId: technician?.teamMemberId,\n\t\t\tdisplayName: technician?.name || \"Primary Technician\",\n\t\t\tavatar: technician?.avatar || null,\n\t\t\trole: \"primary\",\n\t\t\tstatus: technician?.status ?? \"available\",\n\t\t\tisActive: technician?.isActive ?? true,\n\t\t});\n\t}\n\n\tconst crewAssignments =\n\t\tschedule.job?.job_team_assignments?.filter(\n\t\t\t(assignment) => !assignment.removed_at,\n\t\t) ?? [];\n\n\tcrewAssignments.forEach((assignment) => {\n\t\tconst teamMember = assignment.team_member;\n\t\tif (!teamMember) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst technician =\n\t\t\t(teamMember.user_id && lookups.byUserId.get(teamMember.user_id)) ||\n\t\t\tlookups.byTeamMemberId.get(teamMember.id);\n\n\t\tconst displayName =\n\t\t\ttechnician?.name ||\n\t\t\tteamMember.invited_name ||\n\t\t\tteamMember.job_title ||\n\t\t\t\"Crew Member\";\n\n\t\tassignments.push({\n\t\t\ttechnicianId: technician?.id ?? teamMember.user_id ?? teamMember.id,\n\t\t\tteamMemberId: teamMember.id,\n\t\t\tdisplayName,\n\t\t\tavatar: technician?.avatar || null,\n\t\t\trole: (assignment.role as JobAssignment[\"role\"]) || \"crew\",\n\t\t\tstatus: technician?.status ?? deriveTechnicianStatus(teamMember.status),\n\t\t\tisActive: technician?.isActive ?? teamMember.status === \"active\",\n\t\t});\n\t});\n\n\treturn dedupeAssignments(assignments);\n}\n\nfunction dedupeAssignments(assignments: JobAssignment[]): JobAssignment[] {\n\tconst seen = new Set<string>();\n\n\treturn assignments.filter((assignment) => {\n\t\tconst key = `${assignment.role}-${assignment.technicianId ?? assignment.teamMemberId ?? \"\"}`;\n\t\tif (seen.has(key)) {\n\t\t\treturn false;\n\t\t}\n\t\tseen.add(key);\n\t\treturn true;\n\t});\n}\n\nfunction buildCustomer(\n\tschedule: ScheduleRecord,\n\tfallbackStreet: string,\n): Job[\"customer\"] {\n\tconst customerRecord = schedule.customer;\n\tconst name =\n\t\tcustomerRecord &&\n\t\t`${customerRecord.first_name ?? \"\"} ${customerRecord.last_name ?? \"\"}`.trim();\n\n\treturn {\n\t\tid: customerRecord?.id || schedule.customer_id || `customer-${schedule.id}`,\n\t\tname: name && name.length > 0 ? name : \"Unspecified Customer\",\n\t\temail: customerRecord?.email || undefined,\n\t\tphone: customerRecord?.phone || undefined,\n\t\tlocation: {\n\t\t\t...DEFAULT_LOCATION,\n\t\t\taddress: {\n\t\t\t\t...DEFAULT_LOCATION.address,\n\t\t\t\tstreet: fallbackStreet,\n\t\t\t},\n\t\t},\n\t\tcreatedAt: new Date(schedule.created_at),\n\t\tupdatedAt: new Date(schedule.updated_at),\n\t};\n}\n\nfunction buildLocation(property: ScheduleProperty | null): Job[\"location\"] {\n\tif (!property) {\n\t\treturn { ...DEFAULT_LOCATION };\n\t}\n\n\treturn {\n\t\taddress: {\n\t\t\tstreet: property.address || property.address2 || property.name || \"\",\n\t\t\tcity: property.city || \"\",\n\t\t\tstate: property.state || \"\",\n\t\t\tzip: property.zip_code || \"\",\n\t\t\tcountry: property.country || \"\",\n\t\t},\n\t\tcoordinates: {\n\t\t\tlat: property.lat || 0,\n\t\t\tlng: property.lon || 0,\n\t\t},\n\t};\n}\n\nfunction deriveTechnicianStatus(status?: string | null): Technician[\"status\"] {\n\treturn status === \"active\" ? \"available\" : \"offline\";\n}\n\nfunction isJobStatus(value: string): value is Job[\"status\"] {\n\treturn [\n\t\t\"scheduled\",\n\t\t\"dispatched\",\n\t\t\"arrived\",\n\t\t\"in-progress\",\n\t\t\"closed\",\n\t\t\"completed\",\n\t\t\"cancelled\",\n\t].includes(value);\n}\n\nexport async function fetchAdditionalUnscheduledJobs({\n\tsupabase,\n\tcompanyId,\n\tlimit = DEFAULT_UNSCHEDULED_PAGE_SIZE,\n\toffset = 0,\n\tsearch = \"\",\n}: {\n\tsupabase: SupabaseClient<Database>;\n\tcompanyId: string;\n\tlimit?: number;\n\toffset?: number;\n\tsearch?: string;\n}): Promise<{ jobs: Job[]; meta: UnassignedJobsMeta }> {\n\tconst teamMembers = await fetchTeamMembersWithUsers(supabase, companyId);\n\tconst technicianLookups = mapTeamMembersToTechnicians(teamMembers);\n\tconst { rows, totalCount, hasMore } = await fetchUnscheduledJobs(\n\t\tsupabase,\n\t\tcompanyId,\n\t\t{\n\t\t\tlimit,\n\t\t\toffset,\n\t\t\tsearch,\n\t\t},\n\t);\n\n\tconst propertyMap = await fetchPropertiesByIds(\n\t\tsupabase,\n\t\tcollectPropertyIds([], rows),\n\t);\n\tconst jobs = rows.map((row) =>\n\t\tmapJobRowToUnscheduledJob(\n\t\t\trow,\n\t\t\ttechnicianLookups,\n\t\t\tpropertyMap.get(row.property_id ?? \"\") ?? null,\n\t\t),\n\t);\n\n\treturn {\n\t\tjobs,\n\t\tmeta: {\n\t\t\tlimit,\n\t\t\tnextOffset: offset + rows.length,\n\t\t\thasMore,\n\t\t\tsearch,\n\t\t\ttotalCount,\n\t\t},\n\t};\n}\n"],"names":[],"mappings":"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","ignoreList":[0,1,2]}