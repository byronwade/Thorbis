module.exports=[803474,698677,a=>{"use strict";var b=a.i(780195),c=a.i(666680);let d=new Set(["gmail.com","yahoo.com","hotmail.com","outlook.com","live.com","msn.com","aol.com","icloud.com","me.com","mac.com","protonmail.com","proton.me","zoho.com","mail.com","gmx.com","yandex.com","fastmail.com","tempmail.com","guerrillamail.com","mailinator.com","10minutemail.com","throwaway.email","google.com","microsoft.com","apple.com","amazon.com","facebook.com","meta.com"]),e=new Set(["mail","email","smtp","pop","imap","webmail","mx","ns","dns","www","api","app","admin","support","help","billing","status"]);function f(){return{allowCustomDomain:!0,requireSubdomain:!1,maxDomainsAllowed:10}}function g(a){if(!a||"string"!=typeof a)return{valid:!1,error:"Domain is required"};let b=a.toLowerCase().trim();if(!/^[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*\.[a-z]{2,}$/.test(b))return{valid:!1,error:"Invalid domain format"};let{rootDomain:c,subdomain:f}=function(a){let b=a.toLowerCase().trim(),c=b.split(".");if(c.length<2)return{subdomain:null,rootDomain:b,tld:""};let d=c.slice(-2).join(".");if(["co.uk","com.au","co.nz","com.br","co.jp"].includes(d)&&c.length>2){let a=c.slice(-3).join(".");return{subdomain:c.length>3?c.slice(0,-3).join("."):null,rootDomain:a,tld:d}}let e=c[c.length-1],f=c.slice(-2).join(".");return{subdomain:c.length>2?c.slice(0,-2).join("."):null,rootDomain:f,tld:e}}(b);return d.has(c)?{valid:!1,error:`Cannot register public email provider domain: ${c}`}:f&&e.has(f.split(".")[0])?{valid:!1,error:`Subdomain "${f}" is reserved. Please use a different subdomain.`}:{valid:!0,normalizedDomain:b,isSubdomain:!!f,rootDomain:c,subdomain:f||void 0}}function h(a){let b=a.toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),c=process.env.PLATFORM_EMAIL_DOMAIN||"mail.stratos.app";return`${b}.${c}`}function i(a){let b=f();return a>=b.maxDomainsAllowed?{allowed:!1,reason:`Maximum ${b.maxDomainsAllowed} domain(s) allowed. Contact support if you need more.`}:{allowed:!0}}function j(a){return[`mail.${a}`,`notifications.${a}`,`updates.${a}`,`alerts.${a}`,`messages.${a}`]}async function k(a,b){let c=process.env.RESEND_API_KEY;if(!c)return{success:!1,error:"Resend API key is not configured"};let d=await fetch(`https://api.resend.com${a}`,{...b,headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json",...b.headers}});return d.ok?{success:!0,data:await d.json().catch(()=>({}))}:{success:!1,error:(await d.json().catch(()=>null))?.message||d.statusText}}async function l(a){let{domain:b,currentDomainCount:c}=a,d=i(c);if(!d.allowed)return{success:!1,error:d.reason||"Cannot register more domains"};let e=g(b);return e.valid?{...await k("/domains",{method:"POST",body:JSON.stringify({name:e.normalizedDomain})}),validation:e}:{success:!1,error:e.error||"Invalid domain",validation:e}}async function m(a){return k("/domains",{method:"POST",body:JSON.stringify({name:a})})}async function n(a){return k(`/domains/${a}`,{method:"GET"})}async function o(a){return k(`/domains/${a}/verify`,{method:"POST"})}async function p(a){return k(`/domains/${a}`,{method:"DELETE"})}async function q(){return k("/domains",{method:"GET"})}async function r(a){return k("/inbound",{method:"POST",body:JSON.stringify(a)})}async function s(a){return k(`/inbound/${a}`,{method:"DELETE"})}async function t(){return k("/inbound",{method:"GET"})}async function u(a){return k(`/domains/${a}`,{method:"GET"})}async function v({payload:a,headers:b}){let d=process.env.RESEND_WEBHOOK_SECRET,{svixId:e,svixTimestamp:f,svixSignature:g}=b;if(!d||!e||!f||!g)return!1;let h=g.split(" "),i=`${e}.${f}.${a}`,j=d.startsWith("whsec_")?Buffer.from(d.slice(6),"base64"):Buffer.from(d),k=c.default.createHmac("sha256",j).update(i).digest("base64");for(let a of h){let[b,c]=a.split(",");if("v1"===b&&c===k)return!0}return!1}async function w(a){return k(`/emails/${a}`,{method:"GET"})}async function x(a){return k(`/emails/${a}/attachments`,{method:"GET"})}async function y(a,b){return k(`/emails/${a}/attachments/${b}`,{method:"GET"})}async function z(a){try{let b=await q();if(!b.success||!b.data)return{success:!1,records:[],error:"Failed to fetch domains from Resend"};let c=b.data.data?.find(b=>b.name===a);if(!c)return{success:!1,records:[],error:`Domain ${a} not found in Resend`};await o(c.id);let d=await n(c.id);if(!d.success||!d.data)return{success:!1,records:[],error:"Failed to verify domain"};let e=(d.data.records||[]).map((a,b)=>({id:`${a.type.toLowerCase()}-${b}`,type:a.type,name:a.name,value:a.value,purpose:({TXT:"SPF - Authorizes sending",CNAME:"DKIM - Email signing",MX:"Email routing",DMARC:"DMARC - Policy"})[a.type]||"Email authentication",verified:"verified"===d.data.status}));return{success:!0,records:e}}catch(a){return{success:!1,records:[],error:a instanceof Error?a.message:"Unknown error"}}}a.s(["canRegisterMoreDomains",()=>i,"generatePlatformSubdomain",()=>h,"getDomainConfig",()=>f,"suggestSubdomains",()=>j,"validateDomain",()=>g],698677),(0,a.i(395731).ensureServerEntryExports)([l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,g,h,f,i,j]),(0,b.registerServerReference)(l,"40dd02be06e348a74860635cfe9c258d89280ced9d",null),(0,b.registerServerReference)(m,"4017a05febc1cf68c7903fae5aaee0f35b84d97286",null),(0,b.registerServerReference)(n,"4076dec4a9eb448ab44dfdb7bead21594e23130a1d",null),(0,b.registerServerReference)(o,"400bc8c2a06c58456fa7075980952ced22a12a6c7d",null),(0,b.registerServerReference)(p,"4008d44ec43b63659eb7fe7ac055ada8f0d9ebeebf",null),(0,b.registerServerReference)(q,"00f30ab128dbfcdce3da4e6304ccc5b09d22ade3e7",null),(0,b.registerServerReference)(r,"40938dcb3c9688726ecb2e9a23967f982917c1c338",null),(0,b.registerServerReference)(s,"40e7d11352b90e422a6b9febe025fc070f22eb4e27",null),(0,b.registerServerReference)(t,"008dcd7f16385e33c321d8c4d5ee67ed70cd2e6cc4",null),(0,b.registerServerReference)(u,"40270424dad52527bfa7a7eecb82b30081bf993272",null),(0,b.registerServerReference)(v,"400d84efb892773afc206a981281dcc29de7db5bb1",null),(0,b.registerServerReference)(w,"4043776cdf3f10962a68094e14e27c38af263d35df",null),(0,b.registerServerReference)(x,"40e7a4019084f7f2454ffc40e86ffb62bc7d612c4f",null),(0,b.registerServerReference)(y,"60dc8b5b8994042a695f50666c3e54b5f11ebe09ba",null),(0,b.registerServerReference)(z,"408e8512d617464bd693967a1d8950ef88fe0c25cc",null),(0,b.registerServerReference)(g,"7f724ced097d083b0345ab93078a8d36d0bdbbb591",null),(0,b.registerServerReference)(h,"7f381b11c060f860f44ba472c9f102d627e8222997",null),(0,b.registerServerReference)(f,"7fc932397243cce243339f8c93b7c84d373f4259e7",null),(0,b.registerServerReference)(i,"7f0f3da913f838626033f18c7d58c2f11b85d0a1df",null),(0,b.registerServerReference)(j,"7f070ef63aad72c229acc0969dd34d8e485cd14240",null),a.s(["createInboundRoute",()=>r,"createResendDomain",()=>m,"createResendDomainWithValidation",()=>l,"deleteInboundRoute",()=>s,"deleteResendDomain",()=>p,"getReceivedEmail",()=>w,"getReceivedEmailAttachment",()=>y,"getResendDomain",()=>n,"getResendDomainMetrics",()=>u,"listInboundRoutes",()=>t,"listReceivedEmailAttachments",()=>x,"listResendDomains",()=>q,"verifyDomainDNS",()=>z,"verifyResendDomain",()=>o,"verifyResendWebhookSignature",()=>v],803474)},73130,a=>{"use strict";var b=a.i(803474),c=a.i(698677);a.s(["canRegisterMoreDomains",()=>c.canRegisterMoreDomains,"createInboundRoute",()=>b.createInboundRoute,"createResendDomain",()=>b.createResendDomain,"createResendDomainWithValidation",()=>b.createResendDomainWithValidation,"deleteInboundRoute",()=>b.deleteInboundRoute,"deleteResendDomain",()=>b.deleteResendDomain,"generatePlatformSubdomain",()=>c.generatePlatformSubdomain,"getDomainConfig",()=>c.getDomainConfig,"getReceivedEmail",()=>b.getReceivedEmail,"getReceivedEmailAttachment",()=>b.getReceivedEmailAttachment,"getResendDomain",()=>b.getResendDomain,"getResendDomainMetrics",()=>b.getResendDomainMetrics,"listInboundRoutes",()=>b.listInboundRoutes,"listReceivedEmailAttachments",()=>b.listReceivedEmailAttachments,"listResendDomains",()=>b.listResendDomains,"suggestSubdomains",()=>c.suggestSubdomains,"validateDomain",()=>c.validateDomain,"verifyDomainDNS",()=>b.verifyDomainDNS,"verifyResendDomain",()=>b.verifyResendDomain,"verifyResendWebhookSignature",()=>b.verifyResendWebhookSignature])}];

//# sourceMappingURL=apps_web_src_lib_email_resend-domains_ts_fb6b2c6f._.js.map