module.exports=[233405,(a,b,c)=>{b.exports=a.x("child_process",()=>require("child_process"))},427699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},921517,(a,b,c)=>{b.exports=a.x("http",()=>require("http"))},524836,(a,b,c)=>{b.exports=a.x("https",()=>require("https"))},174813,a=>{"use strict";var b=a.i(780195),c=a.i(88997),d=a.i(136874);let e={PHONE_PORTING:process.env.STRIPE_PRICE_ID_PHONE_PORTING||"",PHONE_NEW_NUMBER_SETUP:process.env.STRIPE_PRICE_ID_PHONE_NEW_NUMBER_SETUP||"",BASE_PLAN:process.env.STRIPE_PRICE_ID_BASE_PLAN||"",PHONE_NEW_NUMBER_MONTHLY:process.env.STRIPE_PRICE_ID_PHONE_NEW_NUMBER_MONTHLY||"",GMAIL_WORKSPACE_PER_USER:process.env.STRIPE_PRICE_ID_GMAIL_WORKSPACE_PER_USER||"",PROFIT_RHINO:process.env.STRIPE_PRICE_ID_PROFIT_RHINO||""};var f=a.i(395731);let g=new c.default(process.env.STRIPE_SECRET_KEY,{apiVersion:"2024-11-20.acacia"});async function h(a){try{var b,c;let f,h,i,j=(f=[],e.PHONE_PORTING||f.push("STRIPE_PRICE_ID_PHONE_PORTING"),e.PHONE_NEW_NUMBER_SETUP||f.push("STRIPE_PRICE_ID_PHONE_NEW_NUMBER_SETUP"),e.BASE_PLAN||f.push("STRIPE_PRICE_ID_BASE_PLAN"),e.PHONE_NEW_NUMBER_MONTHLY||f.push("STRIPE_PRICE_ID_PHONE_NEW_NUMBER_MONTHLY"),e.GMAIL_WORKSPACE_PER_USER||f.push("STRIPE_PRICE_ID_GMAIL_WORKSPACE_PER_USER"),e.PROFIT_RHINO||f.push("STRIPE_PRICE_ID_PROFIT_RHINO"),{isValid:0===f.length,missing:f});if(!j.isValid)return{success:!1,error:`Missing Stripe configuration: ${j.missing.join(", ")}`};let k=await (0,d.createClient)(),{data:l,error:m}=await k.from("companies").select("id, name, email").eq("id",a.companyId).single();if(m||!l)return{success:!1,error:"Company not found"};let n=l.stripe_customer_id;n||(n=(await g.customers.create({email:l.email||void 0,name:l.name,metadata:{company_id:a.companyId,team_member_id:a.teamMemberId,source:"onboarding"}})).id,await k.from("companies").update({stripe_customer_id:n}).eq("id",a.companyId));let o=(b=a.selections,(h=[]).push({price:e.BASE_PLAN,quantity:1}),b.newPhoneNumberCount>0&&h.push({price:e.PHONE_NEW_NUMBER_MONTHLY,quantity:b.newPhoneNumberCount}),b.gmailWorkspaceUsers>0&&h.push({price:e.GMAIL_WORKSPACE_PER_USER,quantity:b.gmailWorkspaceUsers}),b.profitRhinoEnabled&&h.push({price:e.PROFIT_RHINO,quantity:1}),h),p=(c=a.selections,i=[],c.phonePortingCount>0&&i.push({price:e.PHONE_PORTING,quantity:c.phonePortingCount}),c.newPhoneNumberCount>0&&i.push({price:e.PHONE_NEW_NUMBER_SETUP,quantity:c.newPhoneNumberCount}),i),q=Math.floor(Date.now()/1e3)+1209600,r=[...o.map(a=>({price:a.price,quantity:a.quantity||1})),...p.map(a=>({price:a.price,quantity:a.quantity||1}))],s=await g.checkout.sessions.create({customer:n,mode:"subscription",payment_method_types:["card","us_bank_account"],line_items:r,subscription_data:{trial_end:q,metadata:{company_id:a.companyId,team_member_id:a.teamMemberId,phone_porting_count:a.selections.phonePortingCount.toString(),new_phone_count:a.selections.newPhoneNumberCount.toString(),gmail_users:a.selections.gmailWorkspaceUsers.toString(),profit_rhino:a.selections.profitRhinoEnabled.toString()}},metadata:{company_id:a.companyId,team_member_id:a.teamMemberId,source:"onboarding"},success_url:a.successUrl,cancel_url:a.cancelUrl,billing_address_collection:"required",allow_promotion_codes:!0});return{success:!0,checkoutUrl:s.url||void 0,sessionId:s.id}}catch(a){return console.error("Error creating checkout session:",a),{success:!1,error:a instanceof Error?a.message:"Failed to create checkout session"}}}async function i(a){try{let b=await (0,d.createClient)(),c=await g.checkout.sessions.retrieve(a.sessionId,{expand:["subscription","customer"]});if(!c.subscription)return{success:!1,error:"No subscription found in checkout session"};let e="string"==typeof c.subscription?await g.subscriptions.retrieve(c.subscription):c.subscription,f="string"==typeof c.customer?c.customer:c.customer?.id,h=e.trial_end?new Date(1e3*e.trial_end).toISOString():null,{error:i}=await b.from("companies").update({stripe_customer_id:f,stripe_subscription_id:e.id,stripe_subscription_status:e.status,trial_ends_at:h,payment_method_collected:!0,updated_at:new Date().toISOString()}).eq("id",a.companyId);if(i)return console.error("Error updating company:",i),{success:!1,error:"Failed to save subscription details"};return{success:!0,subscriptionId:e.id,customerId:f||void 0}}catch(a){return console.error("Error handling checkout success:",a),{success:!1,error:a instanceof Error?a.message:"Failed to process checkout success"}}}async function j(a){try{let b=await g.checkout.sessions.retrieve(a);return{success:!0,status:b.payment_status,completed:"paid"===b.payment_status,subscriptionId:"string"==typeof b.subscription?b.subscription:b.subscription?.id}}catch(a){return console.error("Error retrieving session status:",a),{success:!1,error:a instanceof Error?a.message:"Failed to retrieve session status"}}}(0,f.ensureServerEntryExports)([h,i,j]),(0,b.registerServerReference)(h,"40a8e3dc048482f4958e757e844a571c2aa09fb85f",null),(0,b.registerServerReference)(i,"40d14f6558c60bb8ac81bd55721914deda37f9dfbf",null),(0,b.registerServerReference)(j,"40fb44613f937f45885495bd9c9961ab0418a7c548",null),a.s(["createOnboardingCheckoutSession",()=>h,"getCheckoutSessionStatus",()=>j,"handleCheckoutSuccess",()=>i],174813)},654058,a=>a.a(async(b,c)=>{try{a.i(288344),a.i(285956),a.i(336176),a.i(933427),a.i(82608);var d=a.i(970552),e=a.i(765839),f=a.i(198114);a.i(103984),a.i(941771),a.i(854963),a.i(672766),a.i(404352);var g=a.i(304381);a.i(371603),a.i(396829),a.i(444057),a.i(910711);var h=a.i(571708);a.i(495405),a.i(174813);var i=b([d,e,f,g,h]);[d,e,f,g,h]=i.then?(await i)():i,a.s([]),c()}catch(a){c(a)}},!1),52048,a=>a.a(async(b,c)=>{try{var d=a.i(654058),e=a.i(288344),f=a.i(285956),g=a.i(336176),h=a.i(933427),i=a.i(82608),j=a.i(970552),k=a.i(765839),l=a.i(198114),m=a.i(103984),n=a.i(941771),o=a.i(854963),p=a.i(672766),q=a.i(404352),r=a.i(304381),s=a.i(371603),t=a.i(396829),u=a.i(444057),v=a.i(910711),w=a.i(571708),x=a.i(495405),y=a.i(174813),z=b([d,j,k,l,r,w]);[d,j,k,l,r,w]=z.then?(await z)():z,a.s(["000478fbf5363dae5000d525663da13e29908cb952",()=>g.getWebRTCCredentials,"000f90f949d6a2f5484d061d5a738a59a8c846aeaa",()=>x.getPendingSupportSessions,"001be5cf82b793f19f6a7d010c91c14577fa7a130d",()=>v.checkIsCompanyOwner,"001f005176797ef23488068124fb9a744915a477de",()=>e.getCurrentUserRole,"0043ae510c3322ea499beb9e1bb77d06afb4ef19bd",()=>r.signOut,"004cdde5e6ae8991bab4ba61ae40647c2b823200ba",()=>n.resetHourlyCounters,"00665c1bbcd52d612d5bb4bf3be5e7fc75554132e6",()=>x.getActiveSupportSessions,"006acf41615a2f7795c47b6d7a3016e18300f2ad17",()=>n.resetDailyCounters,"007505a78985e53e083a498c97761ed8a463d3d379",()=>j.checkTelnyxVerificationStatus,"0077abd0cb1e555f91adaa482ad0b2f565bbd0629a",()=>w.getCustomersForDialer,"00a122f9d5fe3a1603c636c3a251886129b66154f8",()=>p.getProviderHealthDashboard,"00a13dbd00149949fc1367d3e76ae7d789e07f5321",()=>h.createServiceSupabaseClient,"00c53a1f02416c3261983f8096f19a3450bfd51775",()=>m.runHealthCheckForAllDomains,"00cf212b0097820096122537beac12e3403b97d564",()=>q.markAllAsRead,"00ebc03a4ffc993aea7ec2e541686105c2bace2437",()=>u.getTotalUnreadCountAction,"00fe74bdf14126b5ad89e9480e82978d6357f356b3",()=>o.isGmailIntegrationEnabled,"4002f454c46f4c21ca6e9e26362583ccff69c9f914",()=>g.transcribeCallRecording,"400b8fb96146bfd004a3166563a5ab5536bb610c70",()=>m.getDomainHealth,"400ce95360aaffa14a99dfdf969ba5166c69a59eb6",()=>o.getUserGmailTokens,"4019cf9f81eb3c06f82b5c2f8eb042f3d95d91e933",()=>g.getCompanyPhoneNumbers,"401d3d830065dd7c4777fad67f642392f48735c4ab",()=>o.disconnectCompanyGmail,"40247c617842c31b242455a0961cbd2c3297606a16",()=>g.getCallRoutingRules,"4029b163c1c0acfd806352a72fe8030c8ae4f7f8ac",()=>n.incrementEmailCounter,"40369e8ea4eced7bdaef8203d369469ee7b630db8c",()=>x.endActiveSupportSession,"40413bfa888916480edbc33ebb812158fddf960f89",()=>g.updateCallRoutingRule,"404575d602ef4c60c0058b592b8c3e42fbcd13fc4c",()=>o.disconnectUserGmail,"404d6f2891af89c71d5bde33d110a216bdd3ee4729",()=>m.recordDeliveryEvent,"404e47931374ad2a1b54bc11f357703790f6104530",()=>g.startCallRecording,"405a16958f97c37bd4b5711bd8761510bdab55839f",()=>g.transferActiveCall,"405c57a8fed352b8679525b56014eb8c49105c850c",()=>m.getCompanyDomainsHealth,"406864ae05b8b51c66cc2c335999e5011a41cb521f",()=>g.searchPhoneNumbers,"406f6624261c6dd1a908026fa1408a3f6d507b6e7d",()=>e.canDeleteTeamMember,"40704f0e856ad801ef93b43436f219a36f7c0efd2c",()=>f.getPayrixMerchantAccount,"40787b1598849126560f9f0b0f8fe8967338c7bf28",()=>o.getCompanyEmailProvider,"407a5a7d0a7dd7989a963eb2485a3527c1dcb20a70",()=>n.getCompanyActiveDomain,"4081009dd4dff14ff4ece62648bad23a83f2f9f63c",()=>t.updateUserStatus,"4082b52123c24a95685a53c36313418a95c259c65b",()=>w.deleteCustomer,"4087f0badccd6aaf6a28b640ab4bbc513f0832d105",()=>j.submitAutomatedVerification,"4094cf679b4a10ca0f969f4fc1b55602aac4e0fbc3",()=>q.markAsRead,"4097c3c574342661f9a3c8244961d001234449f36f",()=>s.switchCompany,"40a8e3dc048482f4958e757e844a571c2aa09fb85f",()=>y.createOnboardingCheckoutSession,"40ad037af6f6ab1a3004746d3a1b65afa65527002d",()=>m.processResendWebhookEvent,"40ae25402a089e45aa071d979e8cc6ad136205cc98",()=>j.registerCompanyFor10DLC,"40af86a915f04df8d7cc189fe26e45e0cc24663080",()=>n.checkRateLimit,"40b2df540ec465c5dc19545c96486485bb50b5633b",()=>g.makeCall,"40beeb56302a20d27cd8ba7a0988310f855633d7e6",()=>o.getCompanyGmailTokens,"40c7885bdc4fe4cdd5f57e78579230c58088adbef4",()=>p.checkProviderAlert,"40d050abdabe2ee7293436c505c5f27b4408a2f27c",()=>g.sendTextMessage,"40d14f6558c60bb8ac81bd55721914deda37f9dfbf",()=>y.handleCheckoutSuccess,"40d3c4ceeaee653aa257a28ed429a7fd272fa9fb66",()=>p.cleanupOldEvents,"40d5cc291162e2fd61245bdb851d5e8ed609e4ed19",()=>g.stopCallRecording,"40e06418f4b93b40c84a25511e0468e1e8a41ddecf",()=>p.recordProviderEvent,"40e9589cb639f2902eb841bedc1247d966486d6fd7",()=>v.getCompanyPendingActions,"40ecf2c792e84ef4b898fda98ec27277b4a9dddef2",()=>m.generateDeliverabilityReport,"40edd91786b2a482e617fb16f2474d26ec295435e7",()=>g.sendMMSMessage,"40f8c061cf84f884e77af3425bc24b8a8d72f598fb",()=>l.sendEmail,"40fab1894acc5e3d1fdd8d8c6128a7cecee06e7e6a",()=>q.deleteNotification,"40fb44613f937f45885495bd9c9961ab0418a7c548",()=>y.getCheckoutSessionStatus,"40fd6a80b32792fab749933f98f07503d8e94c0305",()=>g.purchasePhoneNumber,"6013add076e3eaed7dc37e8b800ce977d5abb8d49a",()=>w.getCustomerByPhone,"60193685409a9d118f1b364e14ecf57d05fa5638a9",()=>w.searchCustomers,"602e89ae7ace85fc30cd3b4b1dd865d517c0cb1cd5",()=>x.approveSupportSessionRequest,"602fab67313b110e6ccb66e54b1e16450b2a772cc7",()=>o.refreshUserGmailToken,"60302947fc4caffa53a719728f3c2cebace926098c",()=>o.sendCompanyGmailEmail,"603643b13bf288cc628303bb4d12df0311b11434c7",()=>o.syncUserInbox,"6045f8436f9cdfdadb7bfe3955677adfc5f4102de0",()=>l.handleComplaintWebhook,"606753f8910b46d5792f4bdeb457cdf29d1a8bbadc",()=>i.ensureMessagingBranding,"607d0f958daf66b2a0d5277cdda17600dace5156bb",()=>g.deleteCallRoutingRule,"60853f1e409364f7e171e27229217994ff224414e6",()=>g.toggleCallRoutingRule,"60856182db5eaec7f85eda2a5a94c5d7d3524325d6",()=>o.checkCompanyGmailHealth,"60886af124323873afd4d5b64bb4143abbcba2c154",()=>x.rejectSupportSessionRequest,"60c643a41ce1a8e6cc8338da6e2f3678c386910460",()=>p.getProviderStats,"60eeb51685ac265a4ad793a230a515fe6e462f16f4",()=>o.refreshCompanyGmailToken,"708daa303e36e37247e22b5b828b6aad8c73ac283b",()=>o.fetchUserInbox,"70a648f43fa62ae3dcf2070eb90413e96e81591e77",()=>i.ensureMessagingCampaign,"70dd3bc4222a87350dc137fa9cbcb849fa1913b397",()=>o.setCompanyEmailProvider,"70f58c5ba46ef02b620d7dc87bae8fc83f6d480755",()=>k.sendVerificationSubmittedEmail,"78255c3fa8c9facf7c3f353202f2907836e8eb5539",()=>p.recordSendFailure,"783861d25688b32ba086bbe9e45444975c36a1b285",()=>p.recordSendSuccess,"78766431b437b16f7cb00b4d64a2f3be5e092ed724",()=>p.recordFallbackTriggered,"78a8ea4f1cfa571a366adccf36ac04b1c85d61ae2b",()=>l.handleBounceWebhook,"78d41ef818e75fef94d65a87ea1f0faf418132e3c5",()=>o.storeGmailMessage,"7e3a356960ddd52a3fa4dc6d981ae7202a59eb9a3d",()=>o.storeUserGmailTokens,"7f06df826c4fff42950e712c0f548254e275be2a52",()=>o.storeCompanyGmailTokens]),c()}catch(a){c(a)}},!1),769989,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[root-of-the-server]__f6c731fd._.js","server/chunks/ssr/3c0ae_next_dist_compiled_d01f76b2._.js"].map(b=>a.l(b))).then(()=>b(227185)))},642757,a=>{a.v(a=>Promise.resolve().then(()=>a(149664)))},315292,a=>{a.v(b=>Promise.all(["server/chunks/ssr/apps_web_src_lib_email_email-tracking_ts_73b89830._.js"].map(b=>a.l(b))).then(()=>b(582891)))},449334,a=>{a.v(a=>Promise.resolve().then(()=>a(343860)))},37652,a=>{a.v(b=>Promise.all(["server/chunks/ssr/apps_web_src_lib_auth_company-context_ts_732d588b._.js"].map(b=>a.l(b))).then(()=>b(480513)))},710933,a=>{a.v(a=>Promise.resolve().then(()=>a(136874)))},463923,a=>{a.v(b=>Promise.all(["server/chunks/ssr/apps_web_src_lib_email_resend-domains_ts_fb6b2c6f._.js"].map(b=>a.l(b))).then(()=>b(73130)))},707466,a=>{a.v(a=>Promise.resolve().then(()=>a(933427)))},593976,a=>{a.v(a=>Promise.resolve().then(()=>a(198114)))},841477,a=>{a.v(b=>Promise.all(["server/chunks/ssr/apps_web_src_emails_plain-text-email_tsx_5acac822._.js"].map(b=>a.l(b))).then(()=>b(917126)))},365581,a=>{a.v(a=>Promise.resolve().then(()=>a(869251)))},612244,a=>{a.v(a=>Promise.resolve().then(()=>a(918448)))},115593,a=>{a.v(a=>Promise.resolve().then(()=>a(111732)))},520183,a=>{a.v(b=>Promise.all(["server/chunks/ssr/apps_web_src_lib_ai_memory-service_ts_be9d7ea7._.js"].map(b=>a.l(b))).then(()=>b(294670)))},329699,a=>{a.v(b=>Promise.all(["server/chunks/ssr/apps_web_src_lib_services_weather-service_ts_313b9cab._.js"].map(b=>a.l(b))).then(()=>b(728951)))},809861,a=>{a.v(b=>Promise.all(["server/chunks/ssr/apps_web_src_lib_services_traffic-service_ts_a210ff55._.js"].map(b=>a.l(b))).then(()=>b(46443)))},404530,a=>{a.v(a=>Promise.resolve().then(()=>a(81441)))},420584,a=>{a.v(a=>Promise.resolve().then(()=>a(928660)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__2e9b880c._.js.map