module.exports=[351261,a=>{"use strict";var b=a.i(861467),c=a.i(565308),d=a.i(60222),e=a.i(50466),f=a.i(145679);a.i(288007);var g=a.i(986990);a.i(445255);var h=a.i(18170),i=a.i(425809),j=a.i(700760);let k=[{id:"draft",name:"Draft",accentColor:"#6B7280"},{id:"sent",name:"Sent",accentColor:"#2563EB"},{id:"accepted",name:"Accepted",accentColor:"#22C55E"},{id:"declined",name:"Declined",accentColor:"#EF4444"}],l=new Map(k.map(a=>[a.id,a.name])),m=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});function n({estimates:a}){return(0,b.jsx)(i.EntityKanban,{calculateColumnMeta:(a,b)=>{let c=b.filter(b=>b.columnId===a),d=c.reduce((a,b)=>a+b.entity.amount,0);return{count:c.length,total:d}},columns:k,data:a,entityName:"estimates",formatTotal:a=>m.format(a/100),mapToKanbanItem:a=>({id:a.id,columnId:a.status,entity:a,estimate:a}),renderCard:a=>(0,b.jsx)(o,{item:{...a,estimate:a.entity}}),renderDragOverlay:a=>(0,b.jsx)("div",{className:"border-border/70 bg-background/95 w-[280px] rounded-xl border p-4 shadow-lg",children:(0,b.jsx)(o,{item:{...a,estimate:a.entity}})}),showTotals:!0,updateEntityStatus:(a,b)=>({...a,status:b})})}function o({item:a}){let{estimate:i,columnId:k}=a;return(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{className:"flex items-start justify-between gap-3",children:(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-muted-foreground text-xs font-semibold tracking-wide uppercase",children:i.estimateNumber}),(0,b.jsx)("h3",{className:"text-foreground text-sm font-semibold",children:i.project}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)(g.Badge,{className:(0,j.cn)("text-xs","declined"===k&&"bg-destructive/10 text-destructive"),variant:"declined"===k?"destructive":"secondary",children:l.get(k)??k}),(0,b.jsx)(g.Badge,{className:"bg-muted/60 text-muted-foreground",variant:"outline",children:m.format(i.amount/100)})]})]})}),(0,b.jsxs)("div",{className:"text-muted-foreground space-y-2 text-xs",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.ClipboardList,{className:"text-primary size-4"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:i.customer})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(d.CalendarDays,{className:"text-primary size-4"}),(0,b.jsxs)("span",{children:[i.date," â†’ ",i.validUntil]})]})]}),(0,b.jsxs)("div",{className:"text-muted-foreground flex items-center justify-between pt-2 text-xs",children:[(0,b.jsxs)("span",{children:["Valid until ",i.validUntil]}),(0,b.jsx)(h.Button,{asChild:!0,className:"text-primary gap-1 text-xs",size:"sm",variant:"ghost",children:(0,b.jsxs)(f.default,{href:`/dashboard/work/estimates/${i.id}`,children:["View",(0,b.jsx)(c.ArrowUpRight,{className:"size-3.5"})]})})]})]})}a.s(["EstimatesKanban",()=>n])},3978,a=>{"use strict";var b=a.i(861467),c=a.i(452168),d=a.i(187056),e=a.i(319895),f=a.i(94436),g=a.i(739044),h=a.i(145679),i=a.i(783281);a.i(400355);var j=a.i(694340);a.i(445255);var k=a.i(18170);a.i(956852);var l=a.i(90125),m=a.i(380340),n=a.i(493667);a.i(156120);var o=a.i(779555),p=a.i(792268);function q({estimates:q,itemsPerPage:r=50,totalCount:s,currentPage:t=1}){let[u,v]=(0,i.useState)({Status:"all",Archive:"active"}),[w,x]=(0,i.useState)(!1),[y,z]=(0,i.useState)(!1),[A,B]=(0,i.useState)(!1),[C,D]=(0,i.useState)(null),[E,F]=(0,i.useState)(new Set),[G,H]=(0,i.useState)(new Set),I=(0,i.useMemo)(()=>{let a={all:q.length,draft:0,sent:0,accepted:0,declined:0,expired:0};for(let b of q)"draft"===b.status?a.draft++:"sent"===b.status?a.sent++:"accepted"===b.status?a.accepted++:"declined"===b.status?a.declined++:"expired"===b.status&&a.expired++;return a},[q]),J=(0,i.useMemo)(()=>{let a=0,b=0;for(let c of q)c.archived_at||c.deleted_at?b++:a++;return{all:q.length,active:a,archived:b}},[q]),K=[{label:"Status",options:[{label:"All Statuses",value:"all",count:I.all},{label:"Draft",value:"draft",count:I.draft},{label:"Sent",value:"sent",count:I.sent},{label:"Accepted",value:"accepted",count:I.accepted},{label:"Declined",value:"declined",count:I.declined},{label:"Expired",value:"expired",count:I.expired}]},{label:"Archive",options:[{label:"Active Only",value:"active",count:J.active},{label:"All Estimates",value:"all",count:J.all},{label:"Archived Only",value:"archived",count:J.archived}]}],L=(0,i.useMemo)(()=>q.filter(a=>{let b=u.Status;if("all"!==b&&a.status!==b)return!1;let c=u.Archive,d=!!(a.archived_at||a.deleted_at);return("active"!==c||!d)&&("archived"!==c||!!d)}),[q,u]),M=+("all"!==u.Status)+ +("active"!==u.Archive),N=[{key:"estimateNumber",header:"Estimate #",width:"w-36",shrink:!0,sortable:!0,hideable:!1,sortFn:(a,b)=>a.estimateNumber.localeCompare(b.estimateNumber),render:a=>(0,b.jsx)(h.default,{className:"text-foreground hover:text-primary text-sm font-medium transition-colors hover:underline",href:`/dashboard/work/estimates/${a.id}`,onClick:a=>a.stopPropagation(),children:a.estimateNumber})},{key:"customer",header:"Customer",width:"w-48",shrink:!0,sortable:!0,hideable:!1,sortFn:(a,b)=>a.customer.localeCompare(b.customer),render:a=>(0,b.jsx)("span",{className:"text-foreground text-sm font-medium",children:a.customer})},{key:"project",header:"Project",width:"flex-1",sortable:!0,hideable:!1,sortFn:(a,b)=>a.project.localeCompare(b.project),render:a=>(0,b.jsx)(h.default,{className:"block min-w-0",href:`/dashboard/work/estimates/${a.id}`,onClick:a=>a.stopPropagation(),children:(0,b.jsx)("span",{className:"text-foreground text-sm leading-tight font-medium hover:underline",children:a.project})})},{key:"date",header:"Date",width:"w-32",shrink:!0,hideOnMobile:!0,sortable:!0,hideable:!0,sortFn:(a,b)=>a.date.localeCompare(b.date),render:a=>(0,b.jsx)("span",{className:"text-muted-foreground text-sm tabular-nums",children:a.date})},{key:"validUntil",header:"Valid Until",width:"w-32",shrink:!0,hideOnMobile:!0,sortable:!0,hideable:!0,sortFn:(a,b)=>a.validUntil.localeCompare(b.validUntil),render:a=>(0,b.jsx)("span",{className:"text-muted-foreground text-sm tabular-nums",children:a.validUntil})},{key:"amount",header:"Amount",width:"w-32",shrink:!0,align:"right",sortable:!0,hideable:!1,sortFn:(a,b)=>a.amount-b.amount,render:a=>(0,b.jsx)("span",{className:"font-semibold tabular-nums",children:(0,p.formatCurrency)(a.amount,{decimals:2})})},{key:"status",header:"Status",width:"w-28",shrink:!0,sortable:!0,hideable:!1,sortFn:(a,b)=>a.status.localeCompare(b.status),render:a=>(0,b.jsx)(n.EstimateStatusBadge,{status:a.status})},{key:"actions",header:"",width:"w-10",shrink:!0,render:a=>(0,b.jsx)("div",{"data-no-row-click":!0,children:(0,b.jsxs)(l.DropdownMenu,{children:[(0,b.jsx)(l.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(k.Button,{size:"icon",variant:"ghost",children:(0,b.jsx)(f.MoreHorizontal,{className:"size-4"})})}),(0,b.jsxs)(l.DropdownMenuContent,{align:"end",children:[(0,b.jsx)(l.DropdownMenuLabel,{children:"Actions"}),(0,b.jsx)(l.DropdownMenuSeparator,{}),(0,b.jsxs)(l.DropdownMenuItem,{children:[(0,b.jsx)(g.Send,{className:"mr-2 size-4"}),"Send to Customer"]}),(0,b.jsxs)(l.DropdownMenuItem,{children:[(0,b.jsx)(d.Download,{className:"mr-2 size-4"}),"Download PDF"]}),(0,b.jsx)(l.DropdownMenuSeparator,{}),(0,b.jsxs)(l.DropdownMenuItem,{className:"text-destructive",onClick:()=>{D(a.id),x(!0)},children:[(0,b.jsx)(c.Archive,{className:"mr-2 size-4"}),"Archive Estimate"]})]})]})})}],[O,P]=(0,i.useState)(!1),Q=[{label:"Send",icon:(0,b.jsx)(g.Send,{className:"h-4 w-4"}),onClick:async b=>{if(!O){if(0===L.filter(a=>b.has(a.id)).length){let{toast:b}=await a.A(899612);b.error("No estimates selected");return}H(b),B(!0)}}},{label:"Archive Selected",icon:(0,b.jsx)(c.Archive,{className:"h-4 w-4"}),onClick:async a=>{F(a),z(!0)},variant:"destructive"}];return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.FullWidthDataTable,{bulkActions:Q,columns:N,data:L,emptyIcon:(0,b.jsx)(e.FileText,{className:"text-muted-foreground mx-auto h-12 w-12"}),emptyMessage:"No estimates found",enableSelection:!0,entity:"estimates",getHighlightClass:()=>"bg-success/30 dark:bg-success/10",getItemId:a=>a.id,isArchived:a=>!!(a.archived_at||a.deleted_at),isHighlighted:a=>"accepted"===a.status,itemsPerPage:r,totalCount:s??L.length,currentPageFromServer:t,serverPagination:!0,onRefresh:()=>window.location.reload(),onRowClick:a=>window.location.href=`/dashboard/work/estimates/${a.id}`,searchFilter:(a,b)=>{let c=b.toLowerCase();return a.estimateNumber.toLowerCase().includes(c)||a.customer.toLowerCase().includes(c)||a.project.toLowerCase().includes(c)||a.status.toLowerCase().includes(c)},searchPlaceholder:"Search estimates by number, customer, project, or status...",showArchived:"active"!==u.Archive,showRefresh:!1,toolbarActions:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(o.TableFilters,{activeFilters:u,filters:K,onFilterChange:(a,b)=>{v(c=>({...c,[a]:b}))}}),(0,b.jsx)(o.ClearFiltersButton,{count:M,onClear:()=>{v({Status:"all",Archive:"active"})}})]})}),(0,b.jsx)(j.AlertDialog,{onOpenChange:x,open:w,children:(0,b.jsxs)(j.AlertDialogContent,{children:[(0,b.jsxs)(j.AlertDialogHeader,{children:[(0,b.jsx)(j.AlertDialogTitle,{children:"Archive Estimate?"}),(0,b.jsx)(j.AlertDialogDescription,{children:"This estimate will be archived and can be restored within 90 days. After 90 days, it will be permanently deleted."})]}),(0,b.jsxs)(j.AlertDialogFooter,{children:[(0,b.jsx)(j.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(j.AlertDialogAction,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:async()=>{if(C){let{archiveEstimate:b}=await a.A(362197);await b(C),window.location.reload()}},children:"Archive"})]})]})}),(0,b.jsx)(j.AlertDialog,{onOpenChange:z,open:y,children:(0,b.jsxs)(j.AlertDialogContent,{children:[(0,b.jsxs)(j.AlertDialogHeader,{children:[(0,b.jsxs)(j.AlertDialogTitle,{children:["Archive ",E.size," Estimate(s)?"]}),(0,b.jsx)(j.AlertDialogDescription,{children:"These estimates will be archived and can be restored within 90 days. After 90 days, they will be permanently deleted."})]}),(0,b.jsxs)(j.AlertDialogFooter,{children:[(0,b.jsx)(j.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(j.AlertDialogAction,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:async()=>{let{archiveEstimate:b}=await a.A(362197);for(let a of E)await b(a);window.location.reload()},children:"Archive All"})]})]})}),(0,b.jsx)(j.AlertDialog,{onOpenChange:B,open:A,children:(0,b.jsxs)(j.AlertDialogContent,{children:[(0,b.jsxs)(j.AlertDialogHeader,{children:[(0,b.jsxs)(j.AlertDialogTitle,{children:["Send ",G.size," Estimate(s)?"]}),(0,b.jsxs)(j.AlertDialogDescription,{children:["This will send ",G.size," estimate",1!==G.size?"s":""," via email to your customers.",(0,b.jsx)("br",{}),(0,b.jsx)("br",{}),(0,b.jsx)("strong",{children:"Estimated time:"})," ",Math.ceil(.5*G.size)," second",1!==Math.ceil(.5*G.size)?"s":"",(0,b.jsx)("br",{}),(0,b.jsx)("br",{}),"Note: Only estimates with customer email addresses will be sent."]})]}),(0,b.jsxs)(j.AlertDialogFooter,{children:[(0,b.jsx)(j.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(j.AlertDialogAction,{onClick:async()=>{B(!1),P(!0);let{useSyncStore:b}=await a.A(800564),{startOperation:c,completeOperation:d}=b.getState(),{toast:e}=await a.A(899612),f=Array.from(G),g=f.length,h=c({type:"bulk_send_estimates",title:`Sending ${g} estimate${1!==g?"s":""}`,description:"Preparing emails...",total:g,current:0});try{let{bulkSendEstimates:b}=await a.A(891586),c=await b(f,{batchSize:10,batchDelay:1e3});c.success||(c.results?.successful??0)>0?(d(h,!0),e.success(c.message)):(d(h,!1,c.error||"Failed to send estimates"),e.error(c.error||"Failed to send estimates")),(c.results?.successful??0)>0&&window.location.reload()}catch(a){d(h,!1,a instanceof Error?a.message:"Failed to send estimates"),e.error(a instanceof Error?a.message:"Failed to send estimates")}finally{P(!1),H(new Set)}},children:"Send Estimates"})]})]})})]})}a.s(["EstimatesTable",()=>q],3978)}];

//# sourceMappingURL=apps_web_src_components_work_236ef556._.js.map