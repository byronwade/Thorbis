module.exports=[288344,a=>{"use strict";var b=a.i(780195);a.i(218188);var c=a.i(146057);a.i(467361);var d=a.i(445074);a.i(997053);var e=a.i(311487),f=a.i(974406),g=a.i(136874),h=a.i(395731);async function i(){return(0,f.withErrorHandling)(async()=>{let a=await (0,g.createClient)();if(!a)throw Error("Database connection not available");let{data:{user:b}}=await a.auth.getUser();if(!b)throw Error("Not authenticated");let c=await (0,d.getActiveCompanyId)();if(!c)throw Error("No active company");return await (0,e.getUserRole)(a,b.id,c)})}async function j(a){return(0,f.withErrorHandling)(async()=>{let b=await (0,g.createClient)();if(!b)throw Error("Database connection not available");let c=await (0,d.getActiveCompanyId)();if(!c)throw Error("No active company");let{data:e,error:f}=await b.from("company_memberships").select("user_id, role").eq("id",a).eq("company_id",c).single();if(f||!e)throw Error("Team member not found");let{data:h}=await b.from("companies").select("owner_id").eq("id",c).single();return h&&h.owner_id===e.user_id?{canDelete:!1,reason:"Cannot delete company owner. Transfer ownership first before removing this team member."}:{canDelete:!0}})}c.z.object({teamMemberId:c.z.string().uuid(),newRole:c.z.enum(["owner","admin","manager","dispatcher","technician","csr"]),reason:c.z.string().optional()}),c.z.object({teamMemberId:c.z.string().uuid(),permissions:c.z.record(c.z.string(),c.z.boolean())}),(0,h.ensureServerEntryExports)([i,j]),(0,b.registerServerReference)(i,"001f005176797ef23488068124fb9a744915a477de",null),(0,b.registerServerReference)(j,"406f6624261c6dd1a908026fa1408a3f6d507b6e7d",null),a.s(["canDeleteTeamMember",()=>j,"getCurrentUserRole",()=>i])},818944,a=>{"use strict";let b={AUTH_UNAUTHORIZED:"AUTH_UNAUTHORIZED",AUTH_FORBIDDEN:"AUTH_FORBIDDEN",AUTH_TOKEN_EXPIRED:"AUTH_TOKEN_EXPIRED",AUTH_TOKEN_INVALID:"AUTH_TOKEN_INVALID",AUTH_EMAIL_NOT_VERIFIED:"AUTH_EMAIL_NOT_VERIFIED",VALIDATION_FAILED:"VALIDATION_FAILED",VALIDATION_REQUIRED_FIELD:"VALIDATION_REQUIRED_FIELD",VALIDATION_INVALID_FORMAT:"VALIDATION_INVALID_FORMAT",VALIDATION_OUT_OF_RANGE:"VALIDATION_OUT_OF_RANGE",DB_RECORD_NOT_FOUND:"DB_RECORD_NOT_FOUND",DB_DUPLICATE_ENTRY:"DB_DUPLICATE_ENTRY",DB_CONSTRAINT_VIOLATION:"DB_CONSTRAINT_VIOLATION",DB_FOREIGN_KEY_VIOLATION:"DB_FOREIGN_KEY_VIOLATION",DB_CONNECTION_ERROR:"DB_CONNECTION_ERROR",DB_QUERY_ERROR:"DB_QUERY_ERROR",DB_INSERT_ERROR:"DB_INSERT_ERROR",DB_UPDATE_ERROR:"DB_UPDATE_ERROR",BUSINESS_RULE_VIOLATION:"BUSINESS_RULE_VIOLATION",INSUFFICIENT_PERMISSIONS:"INSUFFICIENT_PERMISSIONS",OPERATION_NOT_ALLOWED:"OPERATION_NOT_ALLOWED",RESOURCE_LOCKED:"RESOURCE_LOCKED",RESOURCE_DELETED:"RESOURCE_DELETED",SERVICE_UNAVAILABLE:"SERVICE_UNAVAILABLE",SERVICE_TIMEOUT:"SERVICE_TIMEOUT",SERVICE_RATE_LIMIT:"SERVICE_RATE_LIMIT",SERVICE_INTEGRATION_ERROR:"SERVICE_INTEGRATION_ERROR",EXTERNAL_API_ERROR:"EXTERNAL_API_ERROR",FILE_NOT_FOUND:"FILE_NOT_FOUND",FILE_TOO_LARGE:"FILE_TOO_LARGE",FILE_INVALID_TYPE:"FILE_INVALID_TYPE",FILE_UPLOAD_FAILED:"FILE_UPLOAD_FAILED",PAYMENT_FAILED:"PAYMENT_FAILED",PAYMENT_DECLINED:"PAYMENT_DECLINED",PAYMENT_INSUFFICIENT_FUNDS:"PAYMENT_INSUFFICIENT_FUNDS",PAYMENT_INVALID_AMOUNT:"PAYMENT_INVALID_AMOUNT",PAYMENT_ALREADY_REFUNDED:"PAYMENT_ALREADY_REFUNDED",PAYMENT_CANNOT_REFUND:"PAYMENT_CANNOT_REFUND",UNKNOWN_ERROR:"UNKNOWN_ERROR",INTERNAL_SERVER_ERROR:"INTERNAL_SERVER_ERROR",BAD_REQUEST:"BAD_REQUEST",NOT_IMPLEMENTED:"NOT_IMPLEMENTED",UNAUTHORIZED:"UNAUTHORIZED",NOT_FOUND:"NOT_FOUND",CONFLICT:"CONFLICT",EXPIRED:"EXPIRED",VALIDATION_ERROR:"VALIDATION_ERROR"};class c extends Error{code;statusCode;details;constructor(a,d=b.UNKNOWN_ERROR,e=400,f){super(a),this.code=d,this.statusCode=e,this.details=f,this.name="ActionError",Error.captureStackTrace&&Error.captureStackTrace(this,c)}toJSON(){return{success:!1,error:this.message,code:this.code,statusCode:this.statusCode,...this.details&&{details:this.details}}}static fromUnknown(a){return a instanceof c?a:a instanceof Error?new c(a.message,b.INTERNAL_SERVER_ERROR,500):new c("An unexpected error occurred",b.UNKNOWN_ERROR,500)}}a.s(["ActionError",()=>c,"ERROR_CODES",0,b,"ERROR_MESSAGES",0,{unauthorized:()=>"You must be logged in to perform this action",forbidden:a=>`You don't have permission to access this ${a}`,emailNotVerified:()=>"Please verify your email before continuing",requiredField:a=>`${a} is required`,invalidFormat:a=>`${a} has an invalid format`,outOfRange:(a,b,c)=>`${a} must be between ${b} and ${c}`,notFound:a=>`${a} not found`,alreadyExists:a=>`${a} already exists`,cannotDelete:(a,b)=>`Cannot delete ${a}: ${b}`,insufficientFunds:()=>"Insufficient funds for this transaction",cannotRefund:a=>`Cannot process refund: ${a}`,resourceLocked:a=>`${a} is currently being modified by another user`,operationFailed:a=>`Failed to ${a}`,serviceUnavailable:a=>`${a} is currently unavailable`}])},974406,a=>{"use strict";var b=a.i(269269),c=a.i(818944);async function d(a){try{let b=await a();return{success:!0,data:b}}catch(a){if(a instanceof c.ActionError)return a.code===c.ERROR_CODES.AUTH_FORBIDDEN||a.code===c.ERROR_CODES.AUTH_UNAUTHORIZED||console.error(`[Action Error] ${a.code}: ${a.message}`),{success:!1,error:a.message,code:a.code,...a.details&&{details:a.details}};if(a instanceof b.ZodError)return{success:!1,error:a.issues[0]?.message||"Validation failed",code:c.ERROR_CODES.VALIDATION_FAILED,details:{issues:a.issues.map(a=>({field:a.path.join("."),message:a.message}))}};if(a instanceof Error)return{success:!1,error:"An unexpected error occurred",code:c.ERROR_CODES.INTERNAL_SERVER_ERROR};return{success:!1,error:"An unexpected error occurred",code:c.ERROR_CODES.UNKNOWN_ERROR}}}function e(a){if(!a)throw new c.ActionError("Database connection failed",c.ERROR_CODES.DB_CONNECTION_ERROR,500)}function f(a){if(!a)throw new c.ActionError("You must be logged in to perform this action",c.ERROR_CODES.AUTH_UNAUTHORIZED,401)}function g(a,b){if(!a)throw new c.ActionError(`${b} not found`,c.ERROR_CODES.DB_RECORD_NOT_FOUND,404)}a.s(["assertAuthenticated",()=>f,"assertExists",()=>g,"assertSupabase",()=>e,"withErrorHandling",()=>d])},311487,a=>{"use strict";async function b(a,b,c,d){let{data:e,error:f}=await a.rpc("has_role",{user_uuid:b,required_role:c,company_uuid:d});return!f&&!0===e}async function c(a,b,c){let{data:d,error:e}=await a.rpc("get_user_role",{user_uuid:b,company_uuid:c});return e?null:d}async function d(a,b,c,d){let{data:e,error:f}=await a.rpc("has_permission",{user_uuid:b,permission_key:c,company_uuid:d});return!f&&!0===e}async function e(a,b,c){let{data:d,error:e}=await a.rpc("is_company_owner",{user_uuid:b,company_uuid:c});return!e&&!0===d}a.s(["getUserRole",()=>c,"hasPermission",()=>d,"hasRole",()=>b,"isCompanyOwner",()=>e])},997053,a=>{"use strict";a.i(311487),a.s([])}];

//# sourceMappingURL=_47bef957._.js.map