module.exports=[760325,a=>{"use strict";var b=a.i(861467),c=a.i(337241),d=a.i(783281),e=a.i(156916),f=a.i(761447),g=a.i(789815),h=a.i(128952),i=a.i(898062);a.i(380934);var j=a.i(347421);a.i(129112);var k=a.i(256003);function l({title:a,description:c,children:e,icon:f,badge:g,className:h,rootMargin:i="100px",loadImmediately:k=!1}){let[l,m]=(0,d.useState)(k),n=(0,d.useRef)(null);return(0,d.useEffect)(()=>{if(k)return;let a=new IntersectionObserver(([b])=>{b?.isIntersecting&&(m(!0),a.disconnect())},{rootMargin:i,threshold:.1});return n.current&&a.observe(n.current),()=>a.disconnect()},[k,i]),(0,b.jsxs)(j.Card,{ref:n,className:h,children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[f,(0,b.jsx)(j.CardTitle,{className:"text-lg",children:a})]}),g&&(0,b.jsx)("span",{className:"bg-muted rounded-full px-2 py-0.5 text-xs font-medium",children:g})]}),c&&(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:c})]}),(0,b.jsx)(j.CardContent,{children:"function"==typeof e?e({isVisible:l}):e})]})}function m({rows:a=3}){return(0,b.jsx)("div",{className:"space-y-3",children:Array.from({length:a}).map((a,c)=>(0,b.jsx)(k.Skeleton,{className:"h-16 w-full"},c))})}a.i(445255);var n=a.i(18170),o=a.i(132440);function p(a,b,c={}){let{enabled:e=!0}=c,[f,g]=(0,d.useState)(null),[h,i]=(0,d.useState)(null),[j,k]=(0,d.useState)(!1),l=(0,d.useRef)(null);return(0,d.useEffect)(()=>{e&&(l.current!==a||null===f)&&(async()=>{k(!0),i(null);try{let c=await b();if(c.error)throw c.error;g(c.data),l.current=a}catch(a){i(a instanceof Error?a:Error("Failed to fetch data"))}finally{k(!1)}})()},[e,a,b,f]),{data:f,error:h,isLoading:j}}var q=a.i(792268);function r({invoiceId:a,customerId:c,jobId:d,companyId:e,loadImmediately:f=!1}){return(0,b.jsx)(l,{title:"Communications",icon:(0,b.jsx)(h.MessageSquare,{className:"h-5 w-5"}),loadImmediately:f,children:({isVisible:f})=>{let{data:j,isLoading:k,error:l}=function(a,b,c,d,e=!0){return p(["invoice-communications",a,b,c],async()=>{let e=(0,o.createClient)(),f=[`invoice_id.eq.${a}`];b&&f.push(`customer_id.eq.${b}`),c&&f.push(`job_id.eq.${c}`);let g=e.from("communications").select(`
					*,
					customer:customers!customer_id(id, first_name, last_name)
				`).eq("company_id",d).order("created_at",{ascending:!1}).limit(50);g=f.length>1?g.or(f.join(",")):g.eq("invoice_id",a);let h=await g;return{data:(h.data||[]).filter((a,b,c)=>!!a?.id&&c.findIndex(b=>b.id===a.id)===b)??[],error:h.error}},{enabled:e})}(a,c,d,e,f);return k?(0,b.jsx)(m,{rows:3}):l?(0,b.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"Failed to load communications"}):j&&0!==j.length?(0,b.jsxs)("div",{className:"space-y-3",children:[j.slice(0,10).map(a=>(0,b.jsx)("div",{className:"rounded-lg border p-3",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:`mt-0.5 flex h-8 w-8 items-center justify-center rounded-full ${(a=>{switch(a?.toLowerCase()){case"email":return"bg-blue-100 text-blue-600";case"phone":case"call":return"bg-green-100 text-green-600";default:return"bg-gray-100 text-gray-600"}})(a.type)}`,children:(a=>{switch(a?.toLowerCase()){case"email":return(0,b.jsx)(g.Mail,{className:"h-4 w-4"});case"phone":case"call":return(0,b.jsx)(i.Phone,{className:"h-4 w-4"});default:return(0,b.jsx)(h.MessageSquare,{className:"h-4 w-4"})}})(a.type)}),(0,b.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm font-medium capitalize",children:a.type||"Communication"}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:(0,q.formatDate)(a.created_at)})]}),a.subject&&(0,b.jsx)("p",{className:"text-sm font-medium",children:a.subject}),a.message&&(0,b.jsx)("p",{className:"text-muted-foreground line-clamp-2 text-sm",children:a.message}),a.customer&&(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["To:"," ",a.customer.first_name||a.customer.last_name?`${a.customer.first_name} ${a.customer.last_name}`.trim():"Customer"]}),a.status&&(0,b.jsx)("span",{className:`inline-block rounded-full px-2 py-0.5 text-xs ${"sent"===a.status||"delivered"===a.status?"bg-green-100 text-green-700":"pending"===a.status?"bg-yellow-100 text-yellow-700":"failed"===a.status?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:a.status})]})]})},a.id)),j.length>10&&(0,b.jsxs)(n.Button,{variant:"outline",size:"sm",className:"w-full",children:["View All Communications (",j.length,")"]})]}):(0,b.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"No communications found"})}})}var s=a.i(48199),t=a.i(145679);function u({jobId:a,loadImmediately:c=!1}){return a?(0,b.jsx)(l,{title:"Related Job",icon:(0,b.jsx)(s.Briefcase,{className:"h-5 w-5"}),loadImmediately:c,children:({isVisible:c})=>{let{data:d,isLoading:e,error:f}=function(a,b=!0){return p(["invoice-job",a],async()=>{if(!a)return{data:null,error:null};let b=(0,o.createClient)();return await b.from("jobs").select("id, job_number, title, property_id").eq("id",a).single()},{enabled:b&&!!a})}(a,c);return e?(0,b.jsx)(m,{rows:2}):f?(0,b.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"Failed to load job details"}):d?(0,b.jsx)(t.default,{href:`/dashboard/work/jobs/${d.id}`,className:"hover:bg-accent block rounded-lg border p-4 transition-colors",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-sm font-medium",children:["Job #",d.job_number]}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"View Details →"})]}),d.title&&(0,b.jsx)("p",{className:"text-muted-foreground line-clamp-2 text-sm",children:d.title})]})}):(0,b.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"Job not found"})}}):(0,b.jsx)(l,{title:"Related Job",icon:(0,b.jsx)(s.Briefcase,{className:"h-5 w-5"}),loadImmediately:!0,children:(0,b.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"No job linked to this invoice"})})}var v=a.i(638446),w=a.i(527936),x=a.i(263758),y=a.i(698540),z=a.i(874544),A=a.i(198803),B=a.i(757844);a.i(19256);var C=a.i(417132);a.i(839984);var D=a.i(372712);a.i(458393);var E=a.i(82012);a.i(605919);var F=a.i(229614);a.i(897346);var G=a.i(75892),H=a.i(700760),I=a.i(169021),J=(0,I.createServerReference)("40b886386a6f7298961914ae721c16cba685c0df71",I.callServer,void 0,I.findSourceMapURL,"collectManualPayment");let K=[{id:"cash",name:"Cash",description:"Customer paid with cash",icon:y.Banknote},{id:"check",name:"Check",description:"Customer paid with check",icon:z.FileCheck},{id:"card",name:"Credit/Debit Card",description:"Process card payment",icon:w.CreditCard},{id:"ach",name:"Bank Transfer (ACH)",description:"Process ACH payment",icon:x.Building2}];function L({invoiceId:a,invoiceNumber:c,customerId:f,customerName:g,companyId:h,amountDue:i,currency:j="USD",trigger:k,onSuccess:l}){let[m,o]=(0,d.useState)(!1),[p,q]=(0,d.useTransition)(),[r,s]=(0,d.useState)("cash"),[t,u]=(0,d.useState)((i/100).toFixed(2)),[v,w]=(0,d.useState)(""),[x,y]=(0,d.useState)(""),[z,I]=(0,d.useState)(""),[L,M]=(0,d.useState)(""),[N,O]=(0,d.useState)(""),[P,Q]=(0,d.useState)(g),[R,S]=(0,d.useState)(""),[T,U]=(0,d.useState)(""),[V,W]=(0,d.useState)(g),X=async b=>{b.preventDefault();let c=Math.round(100*Number.parseFloat(t));c<=0?e.toast.error("Invalid amount",{description:"Please enter a valid payment amount."}):q(async()=>{try{let b=await J({invoiceId:a,companyId:h,customerId:f,paymentMethod:r,amount:c,notes:v||void 0,checkNumber:"check"===r?x:void 0,cardDetails:"card"===r?{cardNumber:z.replace(/\s/g,""),cardExpiry:L,cardCvc:N,cardName:P}:void 0,achDetails:"ach"===r?{accountNumber:R,routingNumber:T,accountName:V}:void 0});b.success?(e.toast.success("Payment collected",{description:`Payment of ${Z(c)} has been recorded.`}),o(!1),Y(),l?.()):e.toast.error("Payment failed",{description:b.error||"Unable to process payment."})}catch(a){e.toast.error("Payment error",{description:"An unexpected error occurred. Please try again."})}})},Y=()=>{s("cash"),u((i/100).toFixed(2)),w(""),y(""),I(""),M(""),O(""),Q(g),S(""),U(""),W(g)},Z=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:j}).format(a/100);return(0,b.jsxs)(C.Dialog,{open:m,onOpenChange:o,children:[(0,b.jsx)(C.DialogTrigger,{asChild:!0,children:k||(0,b.jsxs)(n.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(B.Receipt,{className:"mr-2 h-4 w-4"}),"Collect Payment"]})}),(0,b.jsx)(C.DialogContent,{className:"sm:max-w-[500px]",children:(0,b.jsxs)("form",{onSubmit:X,children:[(0,b.jsxs)(C.DialogHeader,{children:[(0,b.jsx)(C.DialogTitle,{children:"Collect Payment"}),(0,b.jsxs)(C.DialogDescription,{children:["Record a payment for Invoice #",c," from ",g]})]}),(0,b.jsxs)("div",{className:"space-y-6 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(E.Label,{htmlFor:"amount",children:"Payment Amount"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("span",{className:"text-muted-foreground absolute left-3 top-1/2 -translate-y-1/2",children:"$"}),(0,b.jsx)(D.Input,{id:"amount",type:"number",step:"0.01",min:"0.01",value:t,onChange:a=>u(a.target.value),className:"pl-8",required:!0})]}),100*Number.parseFloat(t)<i&&(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Partial payment (",Z(i-100*Number.parseFloat(t))," remaining)"]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)(E.Label,{children:"Payment Method"}),(0,b.jsx)(F.RadioGroup,{value:r,onValueChange:a=>s(a),className:"grid gap-2",children:K.map(a=>{let c=a.icon;return(0,b.jsxs)("div",{children:[(0,b.jsx)(F.RadioGroupItem,{value:a.id,id:a.id,className:"peer sr-only"}),(0,b.jsxs)(E.Label,{htmlFor:a.id,className:(0,H.cn)("flex cursor-pointer items-center gap-3 rounded-lg border-2 p-3 transition-colors","peer-data-[state=checked]:border-primary peer-data-[state=checked]:bg-primary/5","hover:border-primary/50"),children:[(0,b.jsx)(c,{className:"h-5 w-5 text-muted-foreground"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:a.name}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:a.description})]})]})]},a.id)})})]}),"check"===r&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(E.Label,{htmlFor:"checkNumber",children:"Check Number"}),(0,b.jsx)(D.Input,{id:"checkNumber",value:x,onChange:a=>y(a.target.value),placeholder:"Enter check number",required:!0})]}),"card"===r&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(E.Label,{htmlFor:"cardName",children:"Cardholder Name"}),(0,b.jsx)(D.Input,{id:"cardName",value:P,onChange:a=>Q(a.target.value),required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(E.Label,{htmlFor:"cardNumber",children:"Card Number"}),(0,b.jsx)(D.Input,{id:"cardNumber",maxLength:19,value:z,onChange:a=>{let b=a.target.value.replace(/\s/g,"");I(b.match(/.{1,4}/g)?.join(" ")||b)},placeholder:"1234 5678 9012 3456",required:!0})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(E.Label,{htmlFor:"cardExpiry",children:"Expiry"}),(0,b.jsx)(D.Input,{id:"cardExpiry",maxLength:5,value:L,onChange:a=>{let b=a.target.value.replace(/\D/g,"");b.length>=2?M(`${b.slice(0,2)}/${b.slice(2,4)}`):M(b)},placeholder:"MM/YY",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(E.Label,{htmlFor:"cardCvc",children:"CVC"}),(0,b.jsx)(D.Input,{id:"cardCvc",maxLength:4,value:N,onChange:a=>O(a.target.value.replace(/\D/g,"")),placeholder:"123",required:!0})]})]})]}),"ach"===r&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(E.Label,{htmlFor:"accountName",children:"Account Holder Name"}),(0,b.jsx)(D.Input,{id:"accountName",value:V,onChange:a=>W(a.target.value),required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(E.Label,{htmlFor:"routingNumber",children:"Routing Number"}),(0,b.jsx)(D.Input,{id:"routingNumber",maxLength:9,value:T,onChange:a=>U(a.target.value.replace(/\D/g,"")),placeholder:"110000000",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(E.Label,{htmlFor:"accountNumber",children:"Account Number"}),(0,b.jsx)(D.Input,{id:"accountNumber",value:R,onChange:a=>S(a.target.value.replace(/\D/g,"")),placeholder:"000123456789",required:!0})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(E.Label,{htmlFor:"notes",children:"Notes (Optional)"}),(0,b.jsx)(G.Textarea,{id:"notes",value:v,onChange:a=>w(a.target.value),placeholder:"Add any notes about this payment...",rows:2})]})]}),(0,b.jsxs)(C.DialogFooter,{children:[(0,b.jsx)(n.Button,{type:"button",variant:"outline",onClick:()=>o(!1),disabled:p,children:"Cancel"}),(0,b.jsx)(n.Button,{type:"submit",disabled:p,children:p?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(A.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(B.Receipt,{className:"mr-2 h-4 w-4"}),"Collect ",Z(100*Number.parseFloat(t))]})})]})]})})]})}a.i(288007);var M=a.i(986990);function N({customerId:a,invoiceId:c,invoiceNumber:d,customerName:e,companyId:f,amountDue:g,loadImmediately:h=!1,onPaymentSuccess:i}){let j=c&&f&&g&&g>0;return(0,b.jsx)(l,{title:"Payment Methods",icon:(0,b.jsx)(w.CreditCard,{className:"h-5 w-5"}),loadImmediately:h,children:({isVisible:h})=>{let{data:k,isLoading:l,error:q}=function(a,b=!0){return p(["invoice-payment-methods",a],async()=>{let b=(0,o.createClient)();return await b.from("customer_payment_methods").select("*").eq("customer_id",a).eq("is_active",!0).order("is_default",{ascending:!1})},{enabled:b})}(a,h);return l?(0,b.jsx)(m,{rows:2}):q?(0,b.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"Failed to load payment methods"}):k&&0!==k.length?(0,b.jsxs)("div",{className:"space-y-3",children:[k.map(a=>(0,b.jsx)("div",{className:"rounded-lg border p-3",children:(0,b.jsx)("div",{className:"flex items-start justify-between gap-2",children:(0,b.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:"card"===a.type?"Credit Card":a.type}),a.is_default&&(0,b.jsxs)(M.Badge,{variant:"default",className:"text-xs",children:[(0,b.jsx)(v.Check,{className:"mr-1 h-3 w-3"}),"Default"]})]}),a.last4&&(0,b.jsxs)("p",{className:"text-muted-foreground text-sm",children:["•••• ",a.last4]}),a.brand&&(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:a.brand}),a.exp_month&&a.exp_year&&(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Expires ",a.exp_month,"/",a.exp_year]})]})})},a.id)),j?(0,b.jsx)(L,{invoiceId:c,invoiceNumber:d||"",customerId:a,customerName:e||"Customer",companyId:f,amountDue:g,onSuccess:i,trigger:(0,b.jsx)(n.Button,{variant:"outline",size:"sm",className:"w-full",children:"Collect Payment"})}):(0,b.jsx)(n.Button,{variant:"outline",size:"sm",className:"w-full",disabled:!0,children:"Collect Payment"})]}):(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"No saved payment methods"}),(0,b.jsx)(n.Button,{variant:"outline",size:"sm",className:"w-full",children:"Add Payment Method"})]})}})}var O=a.i(274956);function P({invoiceId:a,loadImmediately:c=!1}){return(0,b.jsx)(l,{title:"Payments Received",icon:(0,b.jsx)(O.DollarSign,{className:"h-5 w-5"}),loadImmediately:c,children:({isVisible:c})=>{let{data:d,isLoading:e,error:f}=function(a,b=!0){return p(["invoice-payments",a],async()=>{let b=(0,o.createClient)();return await b.from("invoice_payments").select(`
					id,
					amount_applied,
					applied_at,
					notes,
					payment:payments!payment_id (
						id,
						payment_number,
						amount,
						payment_method,
						payment_type,
						status,
						card_brand,
						card_last4,
						check_number,
						reference_number,
						processor_name,
						receipt_url,
						receipt_number,
						refunded_amount,
						refund_reason,
						processed_at,
						completed_at,
						notes
					)
				`).eq("invoice_id",a).order("applied_at",{ascending:!1})},{enabled:b})}(a,c);return e?(0,b.jsx)(m,{rows:3}):f?(0,b.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"Failed to load payments"}):d&&0!==d.length?(0,b.jsxs)("div",{className:"space-y-3",children:[d.map(a=>{let c=a.payment;return c?(0,b.jsx)("div",{className:"rounded-lg border p-3",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"mt-0.5 flex h-8 w-8 items-center justify-center rounded-full bg-green-100",children:(0,b.jsx)(w.CreditCard,{className:"h-4 w-4 text-green-600"})}),(0,b.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:(0,q.formatCurrency)(a.amount_applied)}),(0,b.jsx)("span",{className:`inline-block rounded-full px-2 py-0.5 text-xs ${"completed"===c.status?"bg-green-100 text-green-700":"pending"===c.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}`,children:c.status})]}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Payment #",c.payment_number]}),c.payment_method&&(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:[c.payment_method,c.card_last4&&` ending in ${c.card_last4}`]}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Applied ",(0,q.formatDate)(a.applied_at)]}),a.notes&&(0,b.jsxs)("p",{className:"text-muted-foreground text-xs italic",children:['"',a.notes,'"']})]})]})},a.id):null}),d.length>5&&(0,b.jsx)(n.Button,{variant:"outline",size:"sm",className:"w-full",children:"View All Payments"})]}):(0,b.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"No payments received yet"})}})}var Q=a.i(396919);function R({propertyId:a,loadImmediately:c=!1}){return a?(0,b.jsx)(l,{title:"Service Location",icon:(0,b.jsx)(Q.Home,{className:"h-5 w-5"}),loadImmediately:c,children:({isVisible:c})=>{let{data:d,isLoading:e,error:f}=function(a,b=!0){return p(["invoice-property",a],async()=>{if(!a)return{data:null,error:null};let b=(0,o.createClient)();return await b.from("properties").select("*").eq("id",a).single()},{enabled:b&&!!a})}(a,c);return e?(0,b.jsx)(m,{rows:3}):f?(0,b.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"Failed to load property details"}):d?(0,b.jsx)(t.default,{href:`/dashboard/properties/${d.id}`,className:"hover:bg-accent block rounded-lg border p-4 transition-colors",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:d.name||"Property"}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"View Details →"})]}),d.address&&(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:d.address}),(d.city||d.state||d.zip_code)&&(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:[d.city,d.state,d.zip_code].filter(Boolean).join(", ")})]})}):(0,b.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"Property not found"})}}):(0,b.jsx)(l,{title:"Service Location",icon:(0,b.jsx)(Q.Home,{className:"h-5 w-5"}),loadImmediately:!0,children:(0,b.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"No property linked to this invoice"})})}var S=a.i(319895),T=a.i(645072);function U({estimateId:a,invoiceId:c,invoiceCreatedAt:d,loadImmediately:e=!1}){return(0,b.jsx)(l,{title:"Workflow Timeline",icon:(0,b.jsx)(T.GitBranch,{className:"h-5 w-5"}),loadImmediately:e,children:({isVisible:e})=>{let{data:f,isLoading:g}=function(a,b=!0){return p(["invoice-estimate",a],async()=>{if(!a)return{data:null,error:null};let b=(0,o.createClient)();return await b.from("estimates").select("id, estimate_number, created_at, status").eq("id",a).maybeSingle()},{enabled:b&&!!a})}(a,e),{data:h,isLoading:i}=function(a,b=!0){return p(["invoice-contract",a],async()=>{let b=(0,o.createClient)();return await b.from("contracts").select("id, contract_number, created_at, status, signed_at").eq("invoice_id",a).is("deleted_at",null).maybeSingle()},{enabled:b})}(c,e);return g||i?(0,b.jsx)(m,{rows:3}):(0,b.jsxs)("div",{className:"space-y-3",children:[f&&(0,b.jsxs)(t.default,{href:`/dashboard/work/estimates/${f.id}`,className:"hover:bg-accent flex items-start gap-3 rounded-lg border p-3 transition-colors",children:[(0,b.jsx)("div",{className:"mt-0.5 flex h-6 w-6 items-center justify-center rounded-full bg-blue-100 text-blue-600",children:(0,b.jsx)(S.FileText,{className:"h-3.5 w-3.5"})}),(0,b.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-sm font-medium",children:["Estimate #",f.estimate_number]}),(0,b.jsx)(v.Check,{className:"h-4 w-4 text-green-600"})]}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Created ",(0,q.formatDate)(f.created_at)]}),(0,b.jsx)("span",{className:"inline-block rounded-full bg-blue-100 px-2 py-0.5 text-xs text-blue-700",children:f.status})]})]}),h&&(0,b.jsxs)(t.default,{href:`/dashboard/work/contracts/${h.id}`,className:"hover:bg-accent flex items-start gap-3 rounded-lg border p-3 transition-colors",children:[(0,b.jsx)("div",{className:"mt-0.5 flex h-6 w-6 items-center justify-center rounded-full bg-purple-100 text-purple-600",children:(0,b.jsx)(z.FileCheck,{className:"h-3.5 w-3.5"})}),(0,b.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-sm font-medium",children:["Contract #",h.contract_number]}),(0,b.jsx)(v.Check,{className:"h-4 w-4 text-green-600"})]}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:h.signed_at?`Signed ${(0,q.formatDate)(h.signed_at)}`:`Created ${(0,q.formatDate)(h.created_at)}`}),(0,b.jsx)("span",{className:"inline-block rounded-full bg-purple-100 px-2 py-0.5 text-xs text-purple-700",children:h.status})]})]}),(0,b.jsxs)("div",{className:"border-primary/50 bg-primary/5 flex items-start gap-3 rounded-lg border p-3",children:[(0,b.jsx)("div",{className:"bg-primary text-primary-foreground mt-0.5 flex h-6 w-6 items-center justify-center rounded-full",children:(0,b.jsx)(S.FileText,{className:"h-3.5 w-3.5"})}),(0,b.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:"Invoice (Current)"}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Created ",(0,q.formatDate)(d)]})]})]}),!f&&!h&&(0,b.jsx)("div",{className:"text-muted-foreground text-center text-sm",children:"No workflow history available"})]})}})}var V=a.i(836994),W=a.i(949729);a.i(146697);var X=a.i(778737);function Y({entityData:a,metrics:g}){let h=(0,c.useRouter)(),{invoice:i,customer:j,company:k,companyId:l}=a,[m,n]=(0,d.useState)(i),o=(0,d.useMemo)(()=>i?.invoice_tags?i.invoice_tags.map(a=>({id:a.id,name:a.name,slug:a.slug,color:a.color,category:a.category,icon:a.icon})):[],[i?.invoice_tags]);return(0,b.jsx)(V.DetailPageContentLayout,{children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("h1",{className:"text-2xl font-bold",children:["Invoice #",m.invoice_number]}),(0,b.jsx)(M.Badge,{className:(a=>{switch(a?.toLowerCase()){case"paid":return"bg-green-100 text-green-700";case"partial":return"bg-yellow-100 text-yellow-700";case"overdue":return"bg-red-100 text-red-700";case"draft":return"bg-gray-100 text-gray-700";default:return"bg-blue-100 text-blue-700"}})(m.status),children:m.status})]}),j&&(0,b.jsxs)("p",{className:"text-muted-foreground",children:["Customer:"," ",j.display_name||j.company_name||`${j.first_name||""} ${j.last_name||""}`.trim()||j.email||"Unknown"]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("div",{className:"text-muted-foreground text-sm",children:"Total Amount"}),(0,b.jsx)("div",{className:"text-2xl font-bold",children:(0,q.formatCurrency)(m.total_amount||0)}),m.balance_amount>0&&(0,b.jsxs)("div",{className:"mt-1 text-sm text-red-600",children:["Balance: ",(0,q.formatCurrency)(m.balance_amount)]})]})]}),(0,b.jsx)(X.Separator,{}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-muted-foreground text-sm",children:"Issue Date"}),(0,b.jsx)("div",{className:"font-medium",children:(0,q.formatDate)(m.issue_date||m.created_at)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-muted-foreground text-sm",children:"Due Date"}),(0,b.jsx)("div",{className:"font-medium",children:m.due_date?(0,q.formatDate)(m.due_date):"Not set"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-muted-foreground text-sm",children:"Paid Amount"}),(0,b.jsx)("div",{className:"font-medium text-green-600",children:(0,q.formatCurrency)(m.paid_amount||0)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-muted-foreground text-sm",children:"Payment Terms"}),(0,b.jsx)("div",{className:"font-medium",children:m.payment_terms||"Net 30"})]})]}),(0,b.jsx)(X.Separator,{}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"mb-4 text-xl font-semibold",children:"Invoice Details"}),(0,b.jsxs)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[(0,b.jsx)(u,{jobId:m.job_id,loadImmediately:!0}),(0,b.jsx)(R,{propertyId:m.job?.property_id||m.property_id}),(0,b.jsx)(U,{estimateId:m.converted_from_estimate_id,invoiceId:m.id,invoiceCreatedAt:m.created_at}),(0,b.jsx)(P,{invoiceId:m.id}),(0,b.jsx)(N,{customerId:m.customer_id}),(0,b.jsx)(r,{invoiceId:m.id,customerId:m.customer_id,jobId:m.job_id,companyId:l})]})]}),m.line_items&&m.line_items.length>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(X.Separator,{}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"mb-4 text-xl font-semibold",children:"Line Items"}),(0,b.jsx)("div",{className:"rounded-lg border",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-muted/50 border-b",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"p-3 text-left text-sm font-medium",children:"Item"}),(0,b.jsx)("th",{className:"p-3 text-right text-sm font-medium",children:"Qty"}),(0,b.jsx)("th",{className:"p-3 text-right text-sm font-medium",children:"Rate"}),(0,b.jsx)("th",{className:"p-3 text-right text-sm font-medium",children:"Amount"})]})}),(0,b.jsx)("tbody",{children:m.line_items.map((a,c)=>(0,b.jsxs)("tr",{className:"border-b last:border-0",children:[(0,b.jsxs)("td",{className:"p-3",children:[(0,b.jsx)("div",{className:"font-medium",children:a.description}),a.notes&&(0,b.jsx)("div",{className:"text-muted-foreground text-sm",children:a.notes})]}),(0,b.jsx)("td",{className:"p-3 text-right",children:a.quantity}),(0,b.jsx)("td",{className:"p-3 text-right",children:(0,q.formatCurrency)(a.rate||0)}),(0,b.jsx)("td",{className:"p-3 text-right font-medium",children:(0,q.formatCurrency)(a.amount||0)})]},c))})]})})]})]}),m.notes&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(X.Separator,{}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"mb-2 text-lg font-semibold",children:"Notes"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:m.notes})]})]}),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(X.Separator,{}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"mb-3 text-lg font-semibold",children:"Tags"}),(0,b.jsx)("div",{className:"bg-muted/50 rounded-md p-4",children:(0,b.jsx)(W.EntityTags,{entityId:i.id,entityType:"invoice",onUpdateTags:async(a,b)=>{let c=await (0,f.updateEntityTags)("invoice",a,b);c.success?h.refresh():e.toast.error(c.error||"Failed to update tags")},tags:o})})]})]})]})})}a.s(["InvoicePageContentOptimized",()=>Y],760325)}];

//# sourceMappingURL=apps_web_src_components_invoices_invoice-page-content-optimized_tsx_dbe5046a._.js.map