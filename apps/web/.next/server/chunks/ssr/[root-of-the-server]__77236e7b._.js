module.exports=[193695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},997868,a=>{a.n(a.i(884849))},592581,a=>{a.n(a.i(596565))},134005,a=>{a.n(a.i(977930))},565165,a=>{a.n(a.i(728209))},147941,a=>{a.n(a.i(484103))},304434,a=>{a.n(a.i(632684))},407521,a=>{a.n(a.i(693094))},797797,a=>{a.n(a.i(977207))},290022,a=>{a.n(a.i(362735))},729157,a=>{a.n(a.i(470009))},712363,a=>{a.n(a.i(279732))},208120,a=>{a.n(a.i(52860))},863056,a=>{a.n(a.i(77721))},721135,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call ToolbarStatsProvider() from the server but ToolbarStatsProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/layout/toolbar-stats-provider.tsx <module evaluation>","ToolbarStatsProvider");a.s(["ToolbarStatsProvider",0,b])},444593,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call ToolbarStatsProvider() from the server but ToolbarStatsProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/layout/toolbar-stats-provider.tsx","ToolbarStatsProvider");a.s(["ToolbarStatsProvider",0,b])},206372,a=>{"use strict";a.i(721135);var b=a.i(444593);a.n(b)},842784,a=>{a.n(a.i(514070))},590058,a=>{a.n(a.i(254692))},162349,a=>{"use strict";function b(a,c={}){let{minimumFractionDigits:d=0,maximumFractionDigits:e=c.decimals??2,showZero:f=!0,decimals:g}=c,h=void 0!==g?g:e,i=void 0!==g?g:d;return null==a?f?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(0):"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:i,maximumFractionDigits:h}).format(a/100)}function c(a,b={}){let d;if(!a)return"—";let e="number"==typeof a||"string"==typeof a?new Date(a):a;if(Number.isNaN(e.getTime()))return"—";let f="table";"string"==typeof b?f=b||"table":(f=b.preset||"table",d=b.custom);let g=d||({short:{month:"short",day:"numeric",year:"numeric"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"},table:{month:"short",day:"numeric",year:"numeric"},time:{hour:"numeric",minute:"2-digit",hour12:!0},datetime:{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}})[f];return new Intl.DateTimeFormat("en-US",g).format(e)}a.s(["formatCurrency",()=>b,"formatDate",()=>c])},559290,a=>{"use strict";var b=a.i(429969);a.i(467361);var c=a.i(445074),d=a.i(933427);let e=`
  id,
  company_id,
  contract_number,
  title,
  status,
  contract_type,
  signer_name,
  signer_email,
  signer_company,
  signer_title,
  archived_at,
  deleted_at,
  created_at,
  updated_at,
  valid_from,
  valid_until,
  sent_at,
  signed_at,
  viewed_at,
  invoice:invoices!contracts_invoice_id_invoices_id_fk (
    id,
    invoice_number,
    customer:customers!invoices_customer_id_customers_id_fk (
      id,
      display_name,
      first_name,
      last_name,
      company_name,
      email
    )
  ),
  estimate:estimates!contracts_estimate_id_estimates_id_fk (
    id,
    estimate_number,
    customer:customers!estimates_customer_id_customers_id_fk (
      id,
      display_name,
      first_name,
      last_name,
      company_name,
      email
    )
  ),
  job:jobs!contracts_job_id_jobs_id_fk (
    id,
    job_number,
    title,
    customer:customers!jobs_customer_id_customers_id_fk (
      id,
      display_name,
      first_name,
      last_name,
      company_name,
      email
    )
  )
`;async function f(a,b=50,g){let h=g??await (0,c.getActiveCompanyId)();if(!h)return{contracts:[],totalCount:0};let i=await (0,d.createServiceSupabaseClient)();if(!i)throw Error("Supabase client not configured");let j=(Math.max(a,1)-1)*b,{data:k,error:l,count:m}=await i.from("contracts").select(e,{count:"exact"}).eq("company_id",h).order("created_at",{ascending:!1}).range(j,j+b-1);if(l)throw Error(`Failed to fetch contracts: ${l.message}`);return{contracts:k??[],totalCount:m??0}}(0,b.cache)(async a=>{let b=a??await (0,c.getActiveCompanyId)();if(!b)return[];let e=await (0,d.createServiceSupabaseClient)();if(!e)throw Error("Supabase client not configured");let{data:f,error:g}=await e.from("contracts").select("status, archived_at, deleted_at").eq("company_id",b);if(g)throw Error(`Failed to fetch contract stats: ${g.message}`);return f??[]});let g=(0,b.cache)(async(a,b)=>{let c=await (0,d.createServiceSupabaseClient)();if(!c)throw Error("Supabase client not configured");let{data:e,error:f}=await c.rpc("get_contract_complete",{p_contract_id:a,p_company_id:b});return f?(console.error("Error fetching contract:",f),null):e?.[0]?.contract_data||null});a.s(["CONTRACTS_PAGE_SIZE",0,50,"getContractComplete",0,g,"getContractsPageData",()=>f])},396730,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call ContractPageContent() from the server but ContractPageContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/contracts/contract-page-content.tsx <module evaluation>","ContractPageContent");a.s(["ContractPageContent",0,b])},935375,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call ContractPageContent() from the server but ContractPageContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/contracts/contract-page-content.tsx","ContractPageContent");a.s(["ContractPageContent",0,b])},629396,a=>{"use strict";a.i(396730);var b=a.i(935375);a.n(b)},431434,a=>{"use strict";var b=a.i(504348),c=a.i(429969);a.i(692167);var d=a.i(852596),e=a.i(206372),f=a.i(629396);a.i(467361);var g=a.i(445074),h=a.i(162349),i=a.i(559290),j=a.i(136874);function k(a,b){if(!a)return b;let c=(0,h.formatDate)(a,{preset:"short"});return"—"===c?b:c}async function l({contractId:c}){var h;let l=await (0,j.createClient)();if(!l)return(0,d.notFound)();let{data:{user:m}}=await l.auth.getUser();if(!m)return(0,d.notFound)();await (0,g.isActiveCompanyOnboardingComplete)()||(0,d.redirect)("/dashboard");let{getActiveCompanyId:n}=await a.A(37652),o=await n();o||(0,d.redirect)("/dashboard");let p=await (0,i.getContractComplete)(c,o);if(!p)return(0,d.notFound)();let q=p.estimate,r=p.invoice,s=p.job,t=q?.customer||r?.customer||s?.customer||null,u=q?.customer?.id||r?.customer?.id||s?.customer?.id,[{data:v},{data:w}]=await Promise.all([s?.id?l.from("jobs").select("property_id, property:properties!property_id(*)").eq("id",s.id).single().then(a=>({data:a.data?.property?Array.isArray(a.data.property)?a.data.property[0]:a.data.property:null,error:a.error})):Promise.resolve({data:null,error:null}),s?.id?l.from("appointments").select("id, scheduled_start, scheduled_end, status, type").eq("job_id",s.id).is("deleted_at",null).order("scheduled_start",{ascending:!1}).limit(5):Promise.resolve({data:[],error:null})]),x=t??null,y=q??null,z=r??null,A=s??null,B=x?.display_name||`${x?.first_name||""} ${x?.last_name||""}`.trim()||p.signer_email||"Unknown Customer",C={id:p.id,contractNumber:p.contract_number,title:p.title,description:p.description,customerName:function(a,b){if(!a)return b;if(a.display_name)return a.display_name;let c=`${a.first_name||""} ${a.last_name||""}`.trim();return c||b}(x,B),customerId:u||null,status:p.status,contractType:p.contract_type,signerName:p.signer_name,signerEmail:p.signer_email,signerTitle:p.signer_title,signerCompany:p.signer_company,signedAt:p.signed_at,sentAt:p.sent_at,viewedAt:p.viewed_at,createdAt:p.created_at,validFrom:p.valid_from,validUntil:p.valid_until,ipAddress:p.ip_address,content:p.content,terms:p.terms,notes:p.notes,contract_tags:p.contract_tags||[]},D=[y,z,A].filter(Boolean).length,E=[{label:"Status",value:(h=C.status??null)?h.toString().split("_").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" "):"Draft"},{label:"Sent",value:k(C.sentAt,"Not sent")},{label:"Signed",value:k(C.signedAt,"Pending")},{label:"Valid Until",value:k(C.validUntil,"No expiry")},{label:"Linked Records",value:D}];return(0,b.jsx)(e.ToolbarStatsProvider,{stats:E,children:(0,b.jsx)(f.ContractPageContent,{entityData:{contract:C,customer:x,property:v??null,estimate:y,invoice:z,job:A,appointments:w??[]}})})}function m({children:a}){return(0,b.jsx)("div",{className:"flex h-full w-full flex-col overflow-auto",children:(0,b.jsx)("div",{className:"mx-auto w-full max-w-7xl",children:a})})}function n(){return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"bg-muted h-6 w-32 animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-8 w-64 animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-4 w-48 animate-pulse rounded"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("div",{className:"bg-muted h-10 w-24 animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-10 w-24 animate-pulse rounded"})]})]}),(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:[1,2,3,4,5].map(a=>(0,b.jsx)("div",{className:"bg-card h-24 animate-pulse rounded-lg border p-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"bg-muted h-4 w-20 animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-6 w-16 animate-pulse rounded"})]})},a))}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex gap-4 border-b",children:[1,2,3,4].map(a=>(0,b.jsx)("div",{className:"bg-muted h-10 w-24 animate-pulse rounded-t"},a))}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"bg-card h-64 animate-pulse rounded-lg border p-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"bg-muted h-6 w-32 animate-pulse rounded"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"bg-muted h-4 w-full animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-4 w-3/4 animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-4 w-5/6 animate-pulse rounded"})]})]})}),(0,b.jsx)("div",{className:"bg-card h-48 animate-pulse rounded-lg border p-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"bg-muted h-6 w-32 animate-pulse rounded"}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,b.jsx)("div",{className:"bg-muted h-4 w-full animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-4 w-full animate-pulse rounded"})]})]})}),(0,b.jsx)("div",{className:"bg-card h-32 animate-pulse rounded-lg border p-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"bg-muted h-6 w-32 animate-pulse rounded"}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)("div",{className:"bg-muted h-4 w-24 animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-4 w-24 animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-4 w-24 animate-pulse rounded"})]})]})})]})]})]})}async function o({params:a}){let{id:d}=await a;return(0,b.jsx)(m,{children:(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(n,{}),children:(0,b.jsx)(l,{contractId:d})})})}a.s(["default",()=>o],431434)},37652,a=>{a.v(b=>Promise.all(["server/chunks/ssr/apps_web_src_lib_auth_company-context_ts_732d588b._.js"].map(b=>a.l(b))).then(()=>b(480513)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__77236e7b._.js.map