{"version":3,"sources":["../../../../../../apps/web/src/components/work/job-details/job-help-footer.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/components/work/job-details/job-page-content.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/work/%5Bid%5D/page.tsx","../../../../../../apps/web/src/lib/queries/job-metrics.ts","../../../../../../apps/web/src/lib/queries/job-details.ts","../../../../../../apps/web/src/queries/jobs.ts","../../../../../../apps/web/src/lib/validations/job-domain-schemas.ts"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const JobHelpFooter = registerClientReference(\n    function() { throw new Error(\"Attempted to call JobHelpFooter() from the server but JobHelpFooter is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/work/job-details/job-help-footer.tsx\",\n    \"JobHelpFooter\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const JobPageContent = registerClientReference(\n    function() { throw new Error(\"Attempted to call JobPageContent() from the server but JobPageContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/work/job-details/job-page-content.tsx\",\n    \"JobPageContent\",\n);\n","/**\n * Job Details Page - Streaming Server Component (OPTIMIZED + OPTIMISTIC)\n *\n * PERFORMANCE OPTIMIZATION (2025-11-18):\n * - Uses single RPC query with LATERAL joins\n * - Streaming Suspense boundaries for instant UI\n * - Progressive enhancement: show skeleton → show data\n * - Speed: Instant skeleton, data streams in as ready\n *\n * OPTIMISTIC UI PATTERNS:\n * 1. Instant skeleton/shell rendering\n * 2. Progressive data streaming with Suspense\n * 3. Independent section loading (header first, details stream)\n * 4. No full-page blocking\n */\n\nimport { notFound } from \"next/navigation\";\nimport { Suspense } from \"react\";\nimport { getAvailableTeamMembers } from \"@/actions/team-assignments\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { JobHelpFooter } from \"@/components/work/job-details/job-help-footer\";\nimport { JobPageContent } from \"@/components/work/job-details/job-page-content\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport { calculateJobMetrics } from \"@/lib/queries/job-metrics\";\nimport { getJobComplete } from \"@/lib/queries/job-details\";\nimport { getJob } from \"@/queries/jobs\";\n\n// Skeleton for individual sections\nfunction JobSectionSkeleton() {\n\treturn (\n\t\t<div className=\"space-y-3\">\n\t\t\t<Skeleton className=\"h-8 w-full\" />\n\t\t\t<Skeleton className=\"h-24 w-full\" />\n\t\t\t<Skeleton className=\"h-24 w-full\" />\n\t\t</div>\n\t);\n}\n\n// Minimal skeleton for instant page shell\nfunction JobPageSkeleton() {\n\treturn (\n\t\t<div className=\"flex h-full w-full flex-col space-y-6 p-6\">\n\t\t\t{/* Header skeleton - shows instantly */}\n\t\t\t<div className=\"space-y-4\">\n\t\t\t\t<Skeleton className=\"h-10 w-64\" />\n\t\t\t\t<div className=\"flex gap-4\">\n\t\t\t\t\t<Skeleton className=\"h-20 w-48\" />\n\t\t\t\t\t<Skeleton className=\"h-20 w-48\" />\n\t\t\t\t\t<Skeleton className=\"h-20 w-48\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Content sections skeleton */}\n\t\t\t<div className=\"grid gap-6 lg:grid-cols-2\">\n\t\t\t\t<JobSectionSkeleton />\n\t\t\t\t<JobSectionSkeleton />\n\t\t\t</div>\n\t\t\t<div className=\"grid gap-6\">\n\t\t\t\t<JobSectionSkeleton />\n\t\t\t\t<JobSectionSkeleton />\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n// Job details with all nested data\nasync function JobDetails({ jobId }: { jobId: string }) {\n\tconst companyId = await getActiveCompanyId();\n\tif (!companyId) return notFound();\n\n\t// This is the slow RPC query - wrapped in its own Suspense\n\tconst [jobCompleteResult, jobResult, availableMembersResult] =\n\t\tawait Promise.all([\n\t\t\tgetJobComplete(jobId, companyId),\n\t\t\tgetJob(jobId),\n\t\t\tgetAvailableTeamMembers(),\n\t\t]);\n\n\tif (!jobCompleteResult.success) {\n\t\tconsole.error(\"Failed to load job complete data:\", jobCompleteResult.error);\n\t\tif (!jobResult.success || !jobResult.data) {\n\t\t\treturn notFound();\n\t\t}\n\t}\n\n\tif (!jobResult.success || !jobResult.data) {\n\t\treturn notFound();\n\t}\n\n\tconst availableTeamMembers =\n\t\tavailableMembersResult.success && Array.isArray(availableMembersResult.data)\n\t\t\t? availableMembersResult.data\n\t\t\t: [];\n\n\tif (!availableMembersResult.success) {\n\t\tconsole.error(\n\t\t\t\"Failed to load available team members:\",\n\t\t\tavailableMembersResult.error,\n\t\t);\n\t}\n\n\t// Process team assignments from RPC result\n\tconst teamAssignments = (jobCompleteResult.data?.teamAssignments || []).map(\n\t\t(assignment: any) => {\n\t\t\tconst member = assignment.team_member;\n\t\t\tconst memberUser = member?.user;\n\n\t\t\tconst snakeCaseUser = memberUser\n\t\t\t\t? {\n\t\t\t\t\t\tid: memberUser.id,\n\t\t\t\t\t\temail: memberUser.email,\n\t\t\t\t\t\tfirst_name: memberUser.name?.split(\" \")[0] || \"\",\n\t\t\t\t\t\tlast_name: memberUser.name?.split(\" \").slice(1).join(\" \") || \"\",\n\t\t\t\t\t\tavatar_url: memberUser.avatar,\n\t\t\t\t\t\tphone: memberUser.phone,\n\t\t\t\t\t\tname: memberUser.name || memberUser.email,\n\t\t\t\t\t\traw_user_meta_data: {\n\t\t\t\t\t\t\tfirst_name: memberUser.name?.split(\" \")[0] || \"\",\n\t\t\t\t\t\t\tlast_name: memberUser.name?.split(\" \").slice(1).join(\" \") || \"\",\n\t\t\t\t\t\t\tavatar_url: memberUser.avatar,\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t: null;\n\n\t\t\tconst teamMemberSnake = member\n\t\t\t\t? {\n\t\t\t\t\t\tid: member.id,\n\t\t\t\t\t\tuser_id: member.user_id,\n\t\t\t\t\t\tjob_title: member.job_title,\n\t\t\t\t\t\tcompany_id: companyId,\n\t\t\t\t\t\tstatus: member.status ?? \"active\",\n\t\t\t\t\t\tuser: snakeCaseUser,\n\t\t\t\t\t\tusers: snakeCaseUser ? [snakeCaseUser] : [],\n\t\t\t\t\t}\n\t\t\t\t: null;\n\n\t\t\treturn {\n\t\t\t\t...assignment,\n\t\t\t\tjobId: assignment.job_id,\n\t\t\t\tjob_id: assignment.job_id,\n\t\t\t\tteam_member_id: assignment.team_member_id,\n\t\t\t\tassigned_at: assignment.assigned_at,\n\t\t\t\tassigned_by: assignment.assigned_by,\n\t\t\t\tteam_member: teamMemberSnake,\n\t\t\t};\n\t\t},\n\t);\n\n\tconsole.log(\"✅ Optimized job data loaded:\", {\n\t\tinvoices: jobCompleteResult.data?.invoices?.length || 0,\n\t\testimates: jobCompleteResult.data?.estimates?.length || 0,\n\t\tpayments: jobCompleteResult.data?.payments?.length || 0,\n\t\tappointments: jobCompleteResult.data?.appointments?.length || 0,\n\t\tteamAssignments: teamAssignments.length,\n\t});\n\n\tconst jobData = {\n\t\tjob: jobResult.data,\n\t\tcustomer:\n\t\t\tjobCompleteResult.data?.customer ?? jobResult.data.customer ?? null,\n\t\tproperty:\n\t\t\tjobCompleteResult.data?.property ?? jobResult.data.property ?? null,\n\t\tschedules: jobCompleteResult.data?.appointments || [],\n\t\tinvoices: jobCompleteResult.data?.invoices || [],\n\t\testimates: jobCompleteResult.data?.estimates || [],\n\t\tpayments: jobCompleteResult.data?.payments || [],\n\t\tpurchaseOrders: jobCompleteResult.data?.purchaseOrders || [],\n\t\tactivities: [],\n\t\tcustomerNotes: jobCompleteResult.data?.customerNotes || [],\n\t\tjobNotes: jobCompleteResult.data?.jobNotes || [],\n\t\tjobEquipment: jobCompleteResult.data?.jobEquipment || [],\n\t\tteamAssignments,\n\t\tavailableTeamMembers,\n\t};\n\n\t// Calculate comprehensive job metrics\n\tconst metrics = calculateJobMetrics({\n\t\tjob: jobResult.data,\n\t\tinvoices: jobCompleteResult.data?.invoices || [],\n\t\testimates: jobCompleteResult.data?.estimates || [],\n\t\tpayments: jobCompleteResult.data?.payments || [],\n\t\tpurchaseOrders: jobCompleteResult.data?.purchaseOrders || [],\n\t\ttimeEntries: jobCompleteResult.data?.timeEntries || [],\n\t\ttasks: jobCompleteResult.data?.tasks || [],\n\t});\n\n\tconsole.log(\"✅ Job metrics calculated:\", {\n\t\ttotalRevenue: metrics.financial.totalRevenue / 100,\n\t\tnetProfit: metrics.financial.netProfit / 100,\n\t\tprofitMargin: metrics.financial.profitMargin.toFixed(1) + \"%\",\n\t\ttotalHours: metrics.time.totalHoursLogged,\n\t\toverallProgress: metrics.completion.overallProgress.toFixed(1) + \"%\",\n\t\thealth: metrics.summary.health,\n\t\thealthScore: metrics.summary.healthScore,\n\t});\n\n\treturn (\n\t\t<JobPageContent entityData={jobData} jobData={jobData} metrics={metrics} />\n\t);\n}\n\nexport async function generateMetadata({\n\tparams,\n}: {\n\tparams: Promise<{ id: string }>;\n}) {\n\tconst { id: _id } = await params;\n\treturn {\n\t\ttitle: \"Job Details\",\n\t};\n}\n\nexport default async function JobDetailsPage({\n\tparams,\n}: {\n\tparams: Promise<{ id: string }>;\n}) {\n\tconst { id: jobId } = await params;\n\n\treturn (\n\t\t<div className=\"flex h-full w-full flex-col\">\n\t\t\t{/* Main Content */}\n\t\t\t<div className=\"flex-1\">\n\t\t\t\t{/* Job details with streaming data */}\n\t\t\t\t<Suspense\n\t\t\t\t\tfallback={\n\t\t\t\t\t\t<div className=\"space-y-6 p-6\">\n\t\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t\t<Skeleton className=\"h-10 w-64\" />\n\t\t\t\t\t\t\t\t<div className=\"flex gap-4\">\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-20 w-48\" />\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-20 w-48\" />\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-20 w-48\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"grid gap-6 lg:grid-cols-2\">\n\t\t\t\t\t\t\t\t<JobSectionSkeleton />\n\t\t\t\t\t\t\t\t<JobSectionSkeleton />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"grid gap-6\">\n\t\t\t\t\t\t\t\t<JobSectionSkeleton />\n\t\t\t\t\t\t\t\t<JobSectionSkeleton />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t}\n\t\t\t\t>\n\t\t\t\t\t<JobDetails jobId={jobId} />\n\t\t\t\t</Suspense>\n\t\t\t</div>\n\n\t\t\t{/* Help Footer - Below the fold, full width, distinct styling */}\n\t\t\t<JobHelpFooter />\n\t\t</div>\n\t);\n}\n","/**\n * Job Metrics Calculation Utilities\n *\n * Calculates comprehensive job metrics including:\n * - Financial metrics (revenue, costs, profit, margins)\n * - Time metrics (hours logged, estimated vs actual)\n * - Completion metrics (progress, overdue status)\n * - Performance metrics (efficiency, variance)\n *\n * USAGE:\n * ```typescript\n * import { calculateJobMetrics } from '@/lib/queries/job-metrics';\n *\n * const metrics = calculateJobMetrics({\n *   job,\n *   invoices,\n *   estimates,\n *   payments,\n *   purchaseOrders,\n *   timeEntries,\n *   tasks\n * });\n * ```\n */\n\nexport interface JobMetricsInput {\n\tjob: {\n\t\tid: string;\n\t\tstatus: string;\n\t\tpriority: string;\n\t\tscheduled_start?: string | null;\n\t\tscheduled_end?: string | null;\n\t\tcreated_at: string;\n\t\tupdated_at: string;\n\t};\n\tinvoices?: Array<{\n\t\ttotal_amount: number;\n\t\tpaid_amount: number;\n\t\tbalance_amount: number;\n\t\tstatus: string;\n\t}>;\n\testimates?: Array<{\n\t\ttotal_amount: number;\n\t\tstatus: string;\n\t\tconverted_at?: string | null;\n\t}>;\n\tpayments?: Array<{\n\t\tamount: number;\n\t\tstatus: string;\n\t\tcompleted_at?: string | null;\n\t}>;\n\tpurchaseOrders?: Array<{\n\t\ttotal_amount: number;\n\t\tstatus: string;\n\t}>;\n\ttimeEntries?: Array<{\n\t\ttotal_hours: number;\n\t\thourly_rate?: number;\n\t\tis_billable?: boolean;\n\t\tis_overtime?: boolean;\n\t\tclock_in: string;\n\t\tclock_out?: string | null;\n\t}>;\n\ttasks?: Array<{\n\t\tstatus: string;\n\t\testimated_hours?: number;\n\t\tactual_hours?: number;\n\t}>;\n\tfinancial?: {\n\t\ttotal_amount?: number;\n\t\tpaid_amount?: number;\n\t\tdeposit_amount?: number;\n\t};\n}\n\nexport interface JobMetrics {\n\t// Financial Metrics\n\tfinancial: {\n\t\ttotalRevenue: number; // Sum of all invoice totals\n\t\tcollectedRevenue: number; // Sum of all payments\n\t\toutstandingRevenue: number; // Revenue not yet collected\n\t\testimatedRevenue: number; // Sum of pending estimates\n\t\tconvertedEstimateRevenue: number; // Sum of accepted estimates\n\t\ttotalCosts: number; // Sum of purchase orders + labor costs\n\t\tlaborCosts: number; // Sum of time entries * rates\n\t\tmaterialCosts: number; // Sum of purchase orders\n\t\tnetProfit: number; // Revenue - costs\n\t\tprofitMargin: number; // (netProfit / totalRevenue) * 100\n\t\tdepositCollected: number; // Deposit amount if paid\n\t\tbalanceDue: number; // Remaining balance on all invoices\n\t};\n\n\t// Time Metrics\n\ttime: {\n\t\ttotalHoursLogged: number; // Sum of all time entries\n\t\tbillableHours: number; // Sum of billable time entries\n\t\tnonBillableHours: number; // Sum of non-billable time entries\n\t\tovertimeHours: number; // Sum of overtime entries\n\t\testimatedHours: number; // Sum of task estimates\n\t\tactualHours: number; // Sum of task actuals\n\t\thoursVariance: number; // estimated - actual\n\t\thoursVariancePercent: number; // (variance / estimated) * 100\n\t\taverageHourlyRate: number; // Total labor cost / total hours\n\t\tactiveClockedInHours: number; // Hours for currently clocked-in entries\n\t};\n\n\t// Completion Metrics\n\tcompletion: {\n\t\toverallProgress: number; // Overall % complete (0-100)\n\t\ttasksTotal: number; // Total number of tasks\n\t\ttasksCompleted: number; // Number of completed tasks\n\t\ttasksInProgress: number; // Number of in-progress tasks\n\t\ttasksPending: number; // Number of pending tasks\n\t\tisOverdue: boolean; // Is job past scheduled end?\n\t\tdaysOverdue: number; // Days past scheduled end (0 if not overdue)\n\t\testimatedCompletionDate: string | null; // Projected completion\n\t\tdaysSinceCreated: number; // Days since job created\n\t\tdaysSinceLastUpdate: number; // Days since last update\n\t};\n\n\t// Status Metrics\n\tstatus: {\n\t\tjobStatus: string; // Current job status\n\t\tpriority: string; // Job priority\n\t\thasOpenInvoices: boolean; // Any unpaid invoices?\n\t\thasPendingEstimates: boolean; // Any pending estimates?\n\t\thasActivePurchaseOrders: boolean; // Any open POs?\n\t\tisFullyPaid: boolean; // All invoices paid?\n\t\trequiresAction: boolean; // Needs attention (overdue, unpaid, etc.)\n\t};\n\n\t// Performance Metrics\n\tperformance: {\n\t\trevenuePerHour: number; // Total revenue / total hours\n\t\tcostPerHour: number; // Total costs / total hours\n\t\tprofitPerHour: number; // Net profit / total hours\n\t\testimateAccuracy: number; // How accurate were estimates? (0-100)\n\t\tinvoiceConversionRate: number; // % of estimates converted to invoices\n\t\tcollectionRate: number; // % of invoiced revenue collected\n\t\tefficiency: number; // Actual vs estimated hours efficiency (0-100)\n\t};\n\n\t// Summary\n\tsummary: {\n\t\thealth: \"excellent\" | \"good\" | \"fair\" | \"poor\" | \"critical\"; // Overall job health\n\t\thealthScore: number; // 0-100 score\n\t\talerts: string[]; // List of issues requiring attention\n\t\twarnings: string[]; // List of potential issues\n\t};\n}\n\n/**\n * Calculate comprehensive job metrics\n */\nexport function calculateJobMetrics(input: JobMetricsInput): JobMetrics {\n\tconst {\n\t\tjob,\n\t\tinvoices = [],\n\t\testimates = [],\n\t\tpayments = [],\n\t\tpurchaseOrders = [],\n\t\ttimeEntries = [],\n\t\ttasks = [],\n\t\tfinancial,\n\t} = input;\n\n\t// Common date references for all time calculations\n\tconst now = new Date();\n\tconst createdAt = new Date(job.created_at);\n\tconst updatedAt = new Date(job.updated_at);\n\n\t// Initialize metrics\n\tconst metrics: JobMetrics = {\n\t\tfinancial: {\n\t\t\ttotalRevenue: 0,\n\t\t\tcollectedRevenue: 0,\n\t\t\toutstandingRevenue: 0,\n\t\t\testimatedRevenue: 0,\n\t\t\tconvertedEstimateRevenue: 0,\n\t\t\ttotalCosts: 0,\n\t\t\tlaborCosts: 0,\n\t\t\tmaterialCosts: 0,\n\t\t\tnetProfit: 0,\n\t\t\tprofitMargin: 0,\n\t\t\tdepositCollected: 0,\n\t\t\tbalanceDue: 0,\n\t\t},\n\t\ttime: {\n\t\t\ttotalHoursLogged: 0,\n\t\t\tbillableHours: 0,\n\t\t\tnonBillableHours: 0,\n\t\t\tovertimeHours: 0,\n\t\t\testimatedHours: 0,\n\t\t\tactualHours: 0,\n\t\t\thoursVariance: 0,\n\t\t\thoursVariancePercent: 0,\n\t\t\taverageHourlyRate: 0,\n\t\t\tactiveClockedInHours: 0,\n\t\t},\n\t\tcompletion: {\n\t\t\toverallProgress: 0,\n\t\t\ttasksTotal: tasks.length,\n\t\t\ttasksCompleted: 0,\n\t\t\ttasksInProgress: 0,\n\t\t\ttasksPending: 0,\n\t\t\tisOverdue: false,\n\t\t\tdaysOverdue: 0,\n\t\t\testimatedCompletionDate: null,\n\t\t\tdaysSinceCreated: 0,\n\t\t\tdaysSinceLastUpdate: 0,\n\t\t},\n\t\tstatus: {\n\t\t\tjobStatus: job.status,\n\t\t\tpriority: job.priority,\n\t\t\thasOpenInvoices: false,\n\t\t\thasPendingEstimates: false,\n\t\t\thasActivePurchaseOrders: false,\n\t\t\tisFullyPaid: false,\n\t\t\trequiresAction: false,\n\t\t},\n\t\tperformance: {\n\t\t\trevenuePerHour: 0,\n\t\t\tcostPerHour: 0,\n\t\t\tprofitPerHour: 0,\n\t\t\testimateAccuracy: 0,\n\t\t\tinvoiceConversionRate: 0,\n\t\t\tcollectionRate: 0,\n\t\t\tefficiency: 0,\n\t\t},\n\t\tsummary: {\n\t\t\thealth: \"good\",\n\t\t\thealthScore: 0,\n\t\t\talerts: [],\n\t\t\twarnings: [],\n\t\t},\n\t};\n\n\t// === FINANCIAL CALCULATIONS ===\n\n\t// Calculate invoice revenue\n\tmetrics.financial.totalRevenue = invoices.reduce(\n\t\t(sum, inv) => sum + (inv.total_amount || 0),\n\t\t0,\n\t);\n\tmetrics.financial.balanceDue = invoices.reduce(\n\t\t(sum, inv) => sum + (inv.balance_amount || 0),\n\t\t0,\n\t);\n\n\t// Calculate collected revenue from payments\n\tmetrics.financial.collectedRevenue = payments\n\t\t.filter((p) => p.status === \"completed\" || p.status === \"succeeded\")\n\t\t.reduce((sum, p) => sum + (p.amount || 0), 0);\n\n\tmetrics.financial.outstandingRevenue =\n\t\tmetrics.financial.totalRevenue - metrics.financial.collectedRevenue;\n\n\t// Calculate estimate revenue\n\tconst pendingEstimates = estimates.filter(\n\t\t(e) => e.status === \"pending\" || e.status === \"sent\",\n\t);\n\tmetrics.financial.estimatedRevenue = pendingEstimates.reduce(\n\t\t(sum, e) => sum + (e.total_amount || 0),\n\t\t0,\n\t);\n\n\tconst convertedEstimates = estimates.filter((e) => e.converted_at);\n\tmetrics.financial.convertedEstimateRevenue = convertedEstimates.reduce(\n\t\t(sum, e) => sum + (e.total_amount || 0),\n\t\t0,\n\t);\n\n\t// Calculate costs\n\tmetrics.financial.materialCosts = purchaseOrders\n\t\t.filter((po) => po.status !== \"cancelled\")\n\t\t.reduce((sum, po) => sum + (po.total_amount || 0), 0);\n\n\t// Calculate labor costs from time entries\n\ttimeEntries.forEach((entry) => {\n\t\tconst hours = entry.total_hours || 0;\n\t\tconst rate = entry.hourly_rate || 0;\n\t\tconst laborCost = hours * rate;\n\n\t\tmetrics.financial.laborCosts += laborCost;\n\n\t\t// Check if actively clocked in (no clock_out)\n\t\tif (!entry.clock_out) {\n\t\t\tconst clockInTime = new Date(entry.clock_in);\n\t\t\tconst hoursElapsed =\n\t\t\t\t(now.getTime() - clockInTime.getTime()) / (1000 * 60 * 60);\n\t\t\tmetrics.time.activeClockedInHours += hoursElapsed;\n\t\t}\n\t});\n\n\tmetrics.financial.totalCosts =\n\t\tmetrics.financial.laborCosts + metrics.financial.materialCosts;\n\tmetrics.financial.netProfit =\n\t\tmetrics.financial.totalRevenue - metrics.financial.totalCosts;\n\tmetrics.financial.profitMargin =\n\t\tmetrics.financial.totalRevenue > 0\n\t\t\t? (metrics.financial.netProfit / metrics.financial.totalRevenue) * 100\n\t\t\t: 0;\n\n\t// Deposit from financial table or invoices\n\tif (financial?.deposit_amount) {\n\t\tmetrics.financial.depositCollected = financial.deposit_amount;\n\t}\n\n\t// === TIME CALCULATIONS ===\n\n\ttimeEntries.forEach((entry) => {\n\t\tconst hours = entry.total_hours || 0;\n\t\tmetrics.time.totalHoursLogged += hours;\n\n\t\tif (entry.is_billable) {\n\t\t\tmetrics.time.billableHours += hours;\n\t\t} else {\n\t\t\tmetrics.time.nonBillableHours += hours;\n\t\t}\n\n\t\tif (entry.is_overtime) {\n\t\t\tmetrics.time.overtimeHours += hours;\n\t\t}\n\t});\n\n\t// Calculate task time metrics\n\ttasks.forEach((task) => {\n\t\tmetrics.time.estimatedHours += task.estimated_hours || 0;\n\t\tmetrics.time.actualHours += task.actual_hours || 0;\n\t});\n\n\tmetrics.time.hoursVariance =\n\t\tmetrics.time.estimatedHours - metrics.time.actualHours;\n\tmetrics.time.hoursVariancePercent =\n\t\tmetrics.time.estimatedHours > 0\n\t\t\t? (metrics.time.hoursVariance / metrics.time.estimatedHours) * 100\n\t\t\t: 0;\n\n\tmetrics.time.averageHourlyRate =\n\t\tmetrics.time.totalHoursLogged > 0\n\t\t\t? metrics.financial.laborCosts / metrics.time.totalHoursLogged\n\t\t\t: 0;\n\n\t// === COMPLETION CALCULATIONS ===\n\n\ttasks.forEach((task) => {\n\t\tif (task.status === \"completed\" || task.status === \"done\") {\n\t\t\tmetrics.completion.tasksCompleted++;\n\t\t} else if (task.status === \"in_progress\") {\n\t\t\tmetrics.completion.tasksInProgress++;\n\t\t} else {\n\t\t\tmetrics.completion.tasksPending++;\n\t\t}\n\t});\n\n\tmetrics.completion.overallProgress =\n\t\ttasks.length > 0\n\t\t\t? (metrics.completion.tasksCompleted / tasks.length) * 100\n\t\t\t: 0;\n\n\t// Check if overdue\n\tif (job.scheduled_end) {\n\t\tconst scheduledEnd = new Date(job.scheduled_end);\n\t\tif (now > scheduledEnd && job.status !== \"completed\") {\n\t\t\tmetrics.completion.isOverdue = true;\n\t\t\tmetrics.completion.daysOverdue = Math.ceil(\n\t\t\t\t(now.getTime() - scheduledEnd.getTime()) / (1000 * 60 * 60 * 24),\n\t\t\t);\n\t\t}\n\t}\n\n\t// Days since created/updated\n\n\tmetrics.completion.daysSinceCreated = Math.floor(\n\t\t(now.getTime() - createdAt.getTime()) / (1000 * 60 * 60 * 24),\n\t);\n\tmetrics.completion.daysSinceLastUpdate = Math.floor(\n\t\t(now.getTime() - updatedAt.getTime()) / (1000 * 60 * 60 * 24),\n\t);\n\n\t// === STATUS CALCULATIONS ===\n\n\tmetrics.status.hasOpenInvoices = invoices.some(\n\t\t(inv) => inv.status !== \"paid\" && inv.balance_amount > 0,\n\t);\n\tmetrics.status.hasPendingEstimates = estimates.some(\n\t\t(e) => e.status === \"pending\",\n\t);\n\tmetrics.status.hasActivePurchaseOrders = purchaseOrders.some(\n\t\t(po) => po.status === \"pending\" || po.status === \"ordered\",\n\t);\n\tmetrics.status.isFullyPaid =\n\t\tmetrics.financial.totalRevenue > 0 && metrics.financial.balanceDue === 0;\n\n\t// === PERFORMANCE CALCULATIONS ===\n\n\tmetrics.performance.revenuePerHour =\n\t\tmetrics.time.totalHoursLogged > 0\n\t\t\t? metrics.financial.totalRevenue / metrics.time.totalHoursLogged\n\t\t\t: 0;\n\n\tmetrics.performance.costPerHour =\n\t\tmetrics.time.totalHoursLogged > 0\n\t\t\t? metrics.financial.totalCosts / metrics.time.totalHoursLogged\n\t\t\t: 0;\n\n\tmetrics.performance.profitPerHour =\n\t\tmetrics.time.totalHoursLogged > 0\n\t\t\t? metrics.financial.netProfit / metrics.time.totalHoursLogged\n\t\t\t: 0;\n\n\t// Estimate accuracy (how close were estimates to actuals)\n\tif (metrics.time.estimatedHours > 0 && metrics.time.actualHours > 0) {\n\t\tconst variance = Math.abs(\n\t\t\tmetrics.time.estimatedHours - metrics.time.actualHours,\n\t\t);\n\t\tconst accuracy = 100 - (variance / metrics.time.estimatedHours) * 100;\n\t\tmetrics.performance.estimateAccuracy = Math.max(0, Math.min(100, accuracy));\n\t}\n\n\t// Invoice conversion rate\n\tif (estimates.length > 0) {\n\t\tconst convertedCount = estimates.filter((e) => e.converted_at).length;\n\t\tmetrics.performance.invoiceConversionRate =\n\t\t\t(convertedCount / estimates.length) * 100;\n\t}\n\n\t// Collection rate\n\tif (metrics.financial.totalRevenue > 0) {\n\t\tmetrics.performance.collectionRate =\n\t\t\t(metrics.financial.collectedRevenue / metrics.financial.totalRevenue) *\n\t\t\t100;\n\t}\n\n\t// Efficiency (actual vs estimated - lower actual is better)\n\tif (metrics.time.estimatedHours > 0 && metrics.time.actualHours > 0) {\n\t\tmetrics.performance.efficiency = Math.min(\n\t\t\t100,\n\t\t\t(metrics.time.estimatedHours / metrics.time.actualHours) * 100,\n\t\t);\n\t}\n\n\t// === HEALTH SUMMARY ===\n\n\tlet healthScore = 100;\n\tconst alerts: string[] = [];\n\tconst warnings: string[] = [];\n\n\t// Check for critical issues (alerts)\n\tif (metrics.completion.isOverdue && metrics.completion.daysOverdue > 7) {\n\t\talerts.push(`Job is ${metrics.completion.daysOverdue} days overdue`);\n\t\thealthScore -= 20;\n\t} else if (metrics.completion.isOverdue) {\n\t\twarnings.push(`Job is ${metrics.completion.daysOverdue} days overdue`);\n\t\thealthScore -= 10;\n\t}\n\n\tif (metrics.financial.profitMargin < 0) {\n\t\talerts.push(\n\t\t\t`Job is unprofitable (${metrics.financial.profitMargin.toFixed(1)}% margin)`,\n\t\t);\n\t\thealthScore -= 25;\n\t} else if (metrics.financial.profitMargin < 10) {\n\t\twarnings.push(\n\t\t\t`Low profit margin (${metrics.financial.profitMargin.toFixed(1)}%)`,\n\t\t);\n\t\thealthScore -= 10;\n\t}\n\n\tif (metrics.status.hasOpenInvoices && metrics.financial.balanceDue > 0) {\n\t\tconst daysOutstanding = metrics.completion.daysSinceLastUpdate;\n\t\tif (daysOutstanding > 30) {\n\t\t\talerts.push(\n\t\t\t\t`Outstanding balance of $${(metrics.financial.balanceDue / 100).toFixed(2)} for ${daysOutstanding} days`,\n\t\t\t);\n\t\t\thealthScore -= 15;\n\t\t} else if (daysOutstanding > 14) {\n\t\t\twarnings.push(\n\t\t\t\t`Outstanding balance of $${(metrics.financial.balanceDue / 100).toFixed(2)}`,\n\t\t\t);\n\t\t\thealthScore -= 5;\n\t\t}\n\t}\n\n\tif (metrics.time.hoursVariancePercent > 50 && metrics.time.actualHours > 0) {\n\t\twarnings.push(\n\t\t\t`Hours exceeded estimate by ${metrics.time.hoursVariancePercent.toFixed(0)}%`,\n\t\t);\n\t\thealthScore -= 10;\n\t}\n\n\tif (\n\t\tmetrics.completion.daysSinceLastUpdate > 14 &&\n\t\tjob.status !== \"completed\"\n\t) {\n\t\twarnings.push(\n\t\t\t`No updates in ${metrics.completion.daysSinceLastUpdate} days`,\n\t\t);\n\t\thealthScore -= 5;\n\t}\n\n\tif (metrics.time.activeClockedInHours > 0) {\n\t\twarnings.push(\n\t\t\t`Active time entry: ${metrics.time.activeClockedInHours.toFixed(1)} hours clocked in`,\n\t\t);\n\t}\n\n\t// Determine overall health\n\thealthScore = Math.max(0, Math.min(100, healthScore));\n\tmetrics.summary.healthScore = healthScore;\n\n\tif (healthScore >= 90) {\n\t\tmetrics.summary.health = \"excellent\";\n\t} else if (healthScore >= 75) {\n\t\tmetrics.summary.health = \"good\";\n\t} else if (healthScore >= 60) {\n\t\tmetrics.summary.health = \"fair\";\n\t} else if (healthScore >= 40) {\n\t\tmetrics.summary.health = \"poor\";\n\t} else {\n\t\tmetrics.summary.health = \"critical\";\n\t}\n\n\tmetrics.summary.alerts = alerts;\n\tmetrics.summary.warnings = warnings;\n\n\t// Mark as requiring action if there are any alerts\n\tmetrics.status.requiresAction = alerts.length > 0;\n\n\treturn metrics;\n}\n\n/**\n * Format currency for display\n */\nfunction formatCurrency(cents: number): string {\n\treturn new Intl.NumberFormat(\"en-US\", {\n\t\tstyle: \"currency\",\n\t\tcurrency: \"USD\",\n\t}).format(cents / 100);\n}\n\n/**\n * Format hours for display\n */\nfunction formatHours(hours: number): string {\n\tif (hours < 1) {\n\t\treturn `${Math.round(hours * 60)}m`;\n\t}\n\tconst h = Math.floor(hours);\n\tconst m = Math.round((hours - h) * 60);\n\treturn m > 0 ? `${h}h ${m}m` : `${h}h`;\n}\n\n/**\n * Format percentage for display\n */\nfunction formatPercentage(percentage: number, decimals = 1): string {\n\treturn `${percentage.toFixed(decimals)}%`;\n}\n\n/**\n * Get health color for UI\n */\nfunction getHealthColor(\n\thealth: JobMetrics[\"summary\"][\"health\"],\n): string {\n\tswitch (health) {\n\t\tcase \"excellent\":\n\t\t\treturn \"text-green-600\";\n\t\tcase \"good\":\n\t\t\treturn \"text-blue-600\";\n\t\tcase \"fair\":\n\t\t\treturn \"text-yellow-600\";\n\t\tcase \"poor\":\n\t\t\treturn \"text-orange-600\";\n\t\tcase \"critical\":\n\t\t\treturn \"text-red-600\";\n\t\tdefault:\n\t\t\treturn \"text-gray-600\";\n\t}\n}\n\n/**\n * Get priority color for UI\n */\nfunction getPriorityColor(priority: string): string {\n\tswitch (priority.toLowerCase()) {\n\t\tcase \"urgent\":\n\t\t\treturn \"text-red-600 bg-red-50\";\n\t\tcase \"high\":\n\t\t\treturn \"text-orange-600 bg-orange-50\";\n\t\tcase \"medium\":\n\t\t\treturn \"text-yellow-600 bg-yellow-50\";\n\t\tcase \"low\":\n\t\t\treturn \"text-blue-600 bg-blue-50\";\n\t\tdefault:\n\t\t\treturn \"text-gray-600 bg-gray-50\";\n\t}\n}\n","/**\n * Job Details Queries - React.cache() Wrapped Data Fetching\n *\n * Provides request-level query deduplication for job details page.\n * Multiple components can call these functions - only 1 DB query executes per request.\n *\n * ARCHITECTURE:\n * - Uses React.cache() for automatic deduplication\n * - Cannot use \"use cache\" because we need cookies() for company context\n * - Follows CLAUDE.md Rule #3 (Performance Patterns - React.cache())\n *\n * PERFORMANCE OPTIMIZATION (2025-11-18):\n * - NEW: getJobComplete() - Single RPC with LATERAL joins\n * - Before: 14-16 queries (N+1 pattern)\n * - After: 1 RPC query\n * - Speed: ~88% faster (6.5s → 0.8s)\n * - Follows CLAUDE.md Pattern #2 (Eliminate N+1 Queries)\n */\n\nimport { cache } from \"react\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport { createClient } from \"@/lib/supabase/server\";\n\n/**\n * Get complete job data with all nested relationships (OPTIMIZED)\n *\n * Uses single RPC function with LATERAL joins to eliminate N+1 queries.\n * This is the RECOMMENDED function for fetching job details.\n *\n * PERFORMANCE:\n * - Before: 14-16 separate queries\n * - After: 1 RPC with LATERAL joins\n * - Speed: ~88% faster (6.5s → 0.8s)\n * - Network: 93% reduction (14 round trips → 1)\n *\n * Uses React.cache() for request-level deduplication\n */\nexport const getJobComplete = cache(\n\tasync (jobId: string, companyId: string) => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"No supabase client\",\n\t\t\t\tdata: null,\n\t\t\t};\n\t\t}\n\n\t\ttry {\n\t\t\tconst { data, error } = await supabase\n\t\t\t\t.rpc(\"get_job_complete\", {\n\t\t\t\t\tp_job_id: jobId,\n\t\t\t\t\tp_company_id: companyId,\n\t\t\t\t})\n\t\t\t\t.single();\n\n\t\t\tif (error) {\n\t\t\t\tconsole.error(\"Error fetching job complete:\", error);\n\t\t\t\tconsole.error(\"Error details:\", JSON.stringify(error, null, 2));\n\t\t\t\tconsole.error(\"Job ID:\", jobId, \"Company ID:\", companyId);\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror: error.message || \"Failed to fetch job data\",\n\t\t\t\t\tdata: null,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tdata: {\n\t\t\t\t\tjob: data.job,\n\t\t\t\t\tcustomer: data.customer,\n\t\t\t\t\tproperty: data.property,\n\t\t\t\t\tinvoices: data.invoices || [],\n\t\t\t\t\testimates: data.estimates || [],\n\t\t\t\t\tpayments: data.payments || [],\n\t\t\t\t\tpurchaseOrders: data.purchase_orders || [],\n\t\t\t\t\tappointments: data.appointments || [],\n\t\t\t\t\tcustomerNotes: data.customer_notes || [],\n\t\t\t\t\tteamAssignments: data.team_assignments || [],\n\t\t\t\t\ttimeEntries: data.time_entries || [],\n\t\t\t\t\ttasks: data.tasks || [],\n\t\t\t\t\tjobEquipment: data.job_equipment || [],\n\t\t\t\t\tjobNotes: data.job_notes || [],\n\t\t\t\t},\n\t\t\t\terror: null,\n\t\t\t};\n\t\t} catch (err) {\n\t\t\tconsole.error(\"Unexpected error in getJobComplete:\", err);\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: err instanceof Error ? err.message : \"Unknown error\",\n\t\t\t\tdata: null,\n\t\t\t};\n\t\t}\n\t},\n);\n\n/**\n * Get appointments for a job (cached)\n *\n * Called by:\n * - page.tsx (parent)\n * - appointments-section.tsx (Server Component)\n *\n * Result: Only 1 DB query despite 2 calls\n */\nconst getJobAppointments = cache(\n\tasync (jobId: string, companyId: string) => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase)\n\t\t\treturn { data: null, error: new Error(\"No supabase client\") };\n\n\t\tconst result = await supabase\n\t\t\t.from(\"appointments\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"job_id\", jobId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"start_time\", { ascending: false })\n\t\t\t.limit(100);\n\n\t\treturn result;\n\t},\n);\n\n/**\n * Get invoices for a job (cached)\n */\nconst getJobInvoices = cache(\n\tasync (jobId: string, companyId: string) => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase)\n\t\t\treturn { data: null, error: new Error(\"No supabase client\") };\n\n\t\tconst result = await supabase\n\t\t\t.from(\"invoices\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"job_id\", jobId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(100);\n\n\t\treturn result;\n\t},\n);\n\n/**\n * Get estimates for a job (cached)\n */\nconst getJobEstimates = cache(\n\tasync (jobId: string, companyId: string) => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase)\n\t\t\treturn { data: null, error: new Error(\"No supabase client\") };\n\n\t\tconst result = await supabase\n\t\t\t.from(\"estimates\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"job_id\", jobId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(100);\n\n\t\treturn result;\n\t},\n);\n\n/**\n * Get payments for a job (cached)\n */\nconst getJobPayments = cache(\n\tasync (jobId: string, companyId: string) => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase)\n\t\t\treturn { data: null, error: new Error(\"No supabase client\") };\n\n\t\tconst result = await supabase\n\t\t\t.from(\"payments\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"job_id\", jobId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(100);\n\n\t\treturn result;\n\t},\n);\n\n/**\n * Get purchase orders for a job (cached)\n */\nconst getJobPurchaseOrders = cache(\n\tasync (jobId: string, companyId: string) => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase)\n\t\t\treturn { data: null, error: new Error(\"No supabase client\") };\n\n\t\tconst result = await supabase\n\t\t\t.from(\"purchase_orders\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"job_id\", jobId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(100);\n\n\t\treturn result;\n\t},\n);\n\n/**\n * Get activity log for a job (cached)\n */\nconst getJobActivityLog = cache(\n\tasync (jobId: string, companyId: string) => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase)\n\t\t\treturn { data: null, error: new Error(\"No supabase client\") };\n\n\t\tconst result = await supabase\n\t\t\t.from(\"job_activity_log\")\n\t\t\t.select(\n\t\t\t\t`\n\t\t\t*,\n\t\t\tuser:users!job_activity_log_user_id_fkey (\n\t\t\t\tid,\n\t\t\t\traw_user_meta_data\n\t\t\t)\n\t\t`,\n\t\t\t)\n\t\t\t.eq(\"job_id\", jobId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(50);\n\n\t\treturn result;\n\t},\n);\n\n/**\n * Get job notes (cached)\n */\nconst getJobNotes = cache(async (jobId: string, companyId: string) => {\n\tconst supabase = await createClient();\n\tif (!supabase) return { data: null, error: new Error(\"No supabase client\") };\n\n\tconst result = await supabase\n\t\t.from(\"job_notes\")\n\t\t.select(\"*\")\n\t\t.eq(\"job_id\", jobId)\n\t\t.eq(\"company_id\", companyId)\n\t\t.is(\"deleted_at\", null)\n\t\t.order(\"created_at\", { ascending: false })\n\t\t.limit(100);\n\n\treturn result;\n});\n\n/**\n * Get customer notes for a job's customer (cached)\n */\nconst getCustomerNotes = cache(\n\tasync (customerId: string, companyId: string) => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase)\n\t\t\treturn { data: null, error: new Error(\"No supabase client\") };\n\n\t\tconst result = await supabase\n\t\t\t.from(\"customer_notes\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(100);\n\n\t\treturn result;\n\t},\n);\n\n/**\n * Get enriched appointments with nested data (team members, equipment, assigned user)\n *\n * This is a complex query that fetches appointments with their nested relationships.\n * Uses React.cache() for deduplication across the component tree.\n */\nconst getEnrichedJobAppointments = cache(\n\tasync (jobId: string, companyId: string) => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) return [];\n\n\t\t// Fetch appointments\n\t\tconst { data: appointments } = await supabase\n\t\t\t.from(\"appointments\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"job_id\", jobId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"start_time\", { ascending: false })\n\t\t\t.limit(100);\n\n\t\tlet enrichedAppointments = appointments || [];\n\n\t\tif (enrichedAppointments.length > 0) {\n\t\t\tconst appointmentIds = enrichedAppointments.map((a: any) => a.id);\n\n\t\t\t// Fetch nested data in parallel\n\t\t\tconst [teamAssignmentsData, equipmentData, assignedUsersData] =\n\t\t\t\tawait Promise.all([\n\t\t\t\t\tsupabase\n\t\t\t\t\t\t.from(\"appointment_team_assignments\")\n\t\t\t\t\t\t.select(\n\t\t\t\t\t\t\t`\n\t\t\t\t\tid,\n\t\t\t\t\tappointment_id,\n\t\t\t\t\trole,\n\t\t\t\t\tteam_member:team_members!appointment_team_assignments_team_member_id_fkey (\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tuser_id,\n\t\t\t\t\t\trole\n\t\t\t\t\t)\n\t\t\t\t`,\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.in(\"appointment_id\", appointmentIds),\n\n\t\t\t\t\tsupabase\n\t\t\t\t\t\t.from(\"appointment_equipment\")\n\t\t\t\t\t\t.select(\n\t\t\t\t\t\t\t`\n\t\t\t\t\tid,\n\t\t\t\t\tappointment_id,\n\t\t\t\t\tnotes,\n\t\t\t\t\tequipment:equipment!appointment_equipment_equipment_id_fkey (\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tserial_number,\n\t\t\t\t\t\ttype\n\t\t\t\t\t)\n\t\t\t\t`,\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.in(\"appointment_id\", appointmentIds),\n\n\t\t\t\t\tsupabase\n\t\t\t\t\t\t.from(\"profiles\")\n\t\t\t\t\t\t.select(\"id, full_name, email, avatar_url\")\n\t\t\t\t\t\t.in(\n\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\tenrichedAppointments\n\t\t\t\t\t\t\t\t.map((a: any) => a.assigned_to)\n\t\t\t\t\t\t\t\t.filter(Boolean),\n\t\t\t\t\t\t),\n\t\t\t\t]);\n\n\t\t\t// Fetch user data for team members\n\t\t\tconst teamMemberUserIds = (teamAssignmentsData.data || [])\n\t\t\t\t.map((a: any) => a.team_member?.user_id)\n\t\t\t\t.filter(Boolean);\n\n\t\t\tconst teamMemberUsers = new Map();\n\t\t\tif (teamMemberUserIds.length > 0) {\n\t\t\t\tconst { data: users } = await supabase\n\t\t\t\t\t.from(\"profiles\")\n\t\t\t\t\t.select(\"id, full_name, email, avatar_url\")\n\t\t\t\t\t.in(\"id\", teamMemberUserIds);\n\n\t\t\t\t(users || []).forEach((user: any) => {\n\t\t\t\t\tteamMemberUsers.set(user.id, user);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Build lookup maps\n\t\t\tconst teamMap = new Map();\n\t\t\t(teamAssignmentsData.data || []).forEach((assignment: any) => {\n\t\t\t\tif (!teamMap.has(assignment.appointment_id)) {\n\t\t\t\t\tteamMap.set(assignment.appointment_id, []);\n\t\t\t\t}\n\t\t\t\tconst user = assignment.team_member\n\t\t\t\t\t? teamMemberUsers.get(assignment.team_member.user_id)\n\t\t\t\t\t: null;\n\t\t\t\tconst flattenedMember = user\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tid: assignment.id,\n\t\t\t\t\t\t\tname: user.name || user.email || \"Unknown\",\n\t\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\t\tavatar: user.avatar,\n\t\t\t\t\t\t\trole: assignment.role,\n\t\t\t\t\t\t}\n\t\t\t\t\t: null;\n\n\t\t\t\tif (flattenedMember) {\n\t\t\t\t\tteamMap.get(assignment.appointment_id).push(flattenedMember);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst equipmentMap = new Map();\n\t\t\t(equipmentData.data || []).forEach((eq: any) => {\n\t\t\t\tif (!equipmentMap.has(eq.appointment_id)) {\n\t\t\t\t\tequipmentMap.set(eq.appointment_id, []);\n\t\t\t\t}\n\t\t\t\tequipmentMap.get(eq.appointment_id).push(eq);\n\t\t\t});\n\n\t\t\tconst usersMap = new Map();\n\t\t\t(assignedUsersData.data || []).forEach((user: any) => {\n\t\t\t\tusersMap.set(user.id, user);\n\t\t\t});\n\n\t\t\t// Enrich appointments\n\t\t\tenrichedAppointments = enrichedAppointments.map((appointment: any) => ({\n\t\t\t\t...appointment,\n\t\t\t\tteam_members: teamMap.get(appointment.id) || [],\n\t\t\t\tequipment: equipmentMap.get(appointment.id) || [],\n\t\t\t\tassigned_user: appointment.assigned_to\n\t\t\t\t\t? usersMap.get(appointment.assigned_to)\n\t\t\t\t\t: null,\n\t\t\t}));\n\t\t}\n\n\t\treturn enrichedAppointments;\n\t},\n);\n","/**\n * Job Queries - Data Fetching Functions (NOT Server Actions)\n *\n * These are regular async functions for fetching data in Server Components.\n * They are NOT Server Actions and should NOT have \"use server\" directive.\n *\n * Use these for:\n * - Fetching data in Server Components\n * - Reading data without mutations\n * - Server-side rendering\n *\n * DO NOT use for:\n * - Form submissions\n * - Data mutations\n * - Client-side data fetching\n */\n\nimport type { PostgrestError } from \"@supabase/supabase-js\";\nimport { cache } from \"react\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\nimport { getJobWithDomains } from \"@/lib/validations/job-domain-schemas\";\n\nexport type ActionResult<T> = {\n\tsuccess: boolean;\n\tdata?: T;\n\terror?: string;\n};\n\ntype JobDomainName = Parameters<typeof getJobWithDomains>[0][number];\n\nconst JOB_DOMAIN_NAMES: JobDomainName[] = [\n\t\"financial\",\n\t\"workflow\",\n\t\"timeTracking\",\n\t\"customerApproval\",\n\t\"equipmentService\",\n\t\"dispatch\",\n\t\"quality\",\n\t\"safety\",\n\t\"aiEnrichment\",\n\t\"multiEntity\",\n];\n\nconst JOB_WITH_DOMAINS_QUERY = getJobWithDomains(JOB_DOMAIN_NAMES);\n\nconst DOMAIN_TABLE_CONFIGS = [\n\t{ key: \"financial\", table: \"job_financial\" },\n\t{ key: \"workflow\", table: \"job_workflow\" },\n\t{ key: \"timeTracking\", table: \"job_time_tracking\" },\n\t{ key: \"customerApproval\", table: \"job_customer_approval\" },\n\t{ key: \"equipmentService\", table: \"job_equipment_service\" },\n\t{ key: \"dispatch\", table: \"job_dispatch\" },\n\t{ key: \"quality\", table: \"job_quality\" },\n\t{ key: \"safety\", table: \"job_safety\" },\n\t{ key: \"aiEnrichment\", table: \"job_ai_enrichment\" },\n\t{ key: \"multiEntity\", table: \"job_multi_entity\" },\n] as const satisfies Array<{ key: JobDomainName; table: string }>;\n\nfunction normalizeDomainRecord<T>(\n\trecord: T | T[] | null | undefined,\n): T | null {\n\tif (!record) {\n\t\treturn null;\n\t}\n\treturn Array.isArray(record) ? (record[0] ?? null) : record;\n}\n\nfunction buildJobResponse(job: any) {\n\tconst financial =\n\t\tnormalizeDomainRecord(job.financial ?? job.job_financial) ?? null;\n\tconst timeTracking =\n\t\tnormalizeDomainRecord(job.timeTracking ?? job.job_time_tracking) ?? null;\n\tconst workflow =\n\t\tnormalizeDomainRecord(job.workflow ?? job.job_workflow) ?? null;\n\tconst quality = normalizeDomainRecord(job.quality ?? job.job_quality) ?? null;\n\tconst dispatch =\n\t\tnormalizeDomainRecord(job.dispatch ?? job.job_dispatch) ?? null;\n\tconst safety = normalizeDomainRecord(job.safety ?? job.job_safety) ?? null;\n\tconst customerApproval =\n\t\tnormalizeDomainRecord(job.customerApproval ?? job.job_customer_approval) ??\n\t\tnull;\n\tconst equipmentService =\n\t\tnormalizeDomainRecord(job.equipmentService ?? job.job_equipment_service) ??\n\t\tnull;\n\tconst aiEnrichment =\n\t\tnormalizeDomainRecord(job.aiEnrichment ?? job.job_ai_enrichment) ?? null;\n\tconst multiEntity =\n\t\tnormalizeDomainRecord(job.multiEntity ?? job.job_multi_entity) ?? null;\n\n\treturn {\n\t\t...job,\n\t\tfinancial,\n\t\ttimeTracking,\n\t\tworkflow,\n\t\tquality,\n\t\tdispatch,\n\t\tsafety,\n\t\tcustomerApproval,\n\t\tequipmentService,\n\t\taiEnrichment,\n\t\tmultiEntity,\n\t\ttotal_amount:\n\t\t\tfinancial?.total_amount ??\n\t\t\tjob.total_amount ??\n\t\t\tjob.job_financial?.[0]?.total_amount ??\n\t\t\tnull,\n\t\tpaid_amount:\n\t\t\tfinancial?.paid_amount ??\n\t\t\tjob.paid_amount ??\n\t\t\tjob.job_financial?.[0]?.paid_amount ??\n\t\t\tnull,\n\t\testimated_labor_hours:\n\t\t\ttimeTracking?.estimated_labor_hours ??\n\t\t\tjob.estimated_labor_hours ??\n\t\t\tjob.job_time_tracking?.[0]?.estimated_labor_hours ??\n\t\t\tnull,\n\t\tactual_labor_hours:\n\t\t\ttimeTracking?.total_labor_hours ??\n\t\t\ttimeTracking?.actual_labor_hours ??\n\t\t\tjob.actual_labor_hours ??\n\t\t\tjob.total_labor_hours ??\n\t\t\tnull,\n\t\tworkflow_stage:\n\t\t\tworkflow?.workflow_stage ??\n\t\t\tjob.workflow_stage ??\n\t\t\tjob.job_workflow?.[0]?.workflow_stage ??\n\t\t\tnull,\n\t\tpriority_score:\n\t\t\tquality?.internal_priority_score ??\n\t\t\tjob.priority_score ??\n\t\t\tjob.job_quality?.[0]?.internal_priority_score ??\n\t\t\tnull,\n\t\tai_categories:\n\t\t\taiEnrichment?.ai_categories ??\n\t\t\tjob.ai_categories ??\n\t\t\tjob.job_ai_enrichment?.[0]?.ai_categories ??\n\t\t\tnull,\n\t};\n}\n\nasync function fetchDomainsIndividually(\n\tsupabaseClient: NonNullable<Awaited<ReturnType<typeof createClient>>>,\n\tjobId: string,\n\tcompanyId: string,\n) {\n\tconst results = await Promise.all(\n\t\tDOMAIN_TABLE_CONFIGS.map(async ({ key, table }) => {\n\t\t\tconst { data, error } = await supabaseClient\n\t\t\t\t.from(table)\n\t\t\t\t.select(\"*\")\n\t\t\t\t.eq(\"job_id\", jobId)\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.maybeSingle();\n\n\t\t\treturn {\n\t\t\t\tkey,\n\t\t\t\tdata: data ?? null,\n\t\t\t\terror: error || null,\n\t\t\t};\n\t\t}),\n\t);\n\n\tconst domainData: Partial<Record<JobDomainName, any>> = {};\n\tconst domainErrors: Array<{ key: JobDomainName; error: PostgrestError }> = [];\n\n\tfor (const result of results) {\n\t\tdomainData[result.key] = result.data;\n\t\tif (result.error) {\n\t\t\tdomainErrors.push({ key: result.key, error: result.error });\n\t\t}\n\t}\n\n\treturn {\n\t\tdata: domainData,\n\t\terrors: domainErrors,\n\t};\n}\n\n/**\n * Get job by ID with all domain data\n *\n * ARCHITECTURE: Uses React.cache() for request-level deduplication\n * - Called by multiple components → only 1 DB query\n * - Cannot use \"use cache\" because we need cookies() for company context\n * - React.cache() gives us deduplication within the same request\n *\n * This is a regular async function, NOT a Server Action\n */\nexport const getJob = cache(\n\tasync (jobId: string): Promise<ActionResult<any>> => {\n\t\ttry {\n\t\t\tconst supabase = await createClient();\n\t\t\tif (!supabase) {\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror: \"Database client not initialized\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst activeCompanyId = await getActiveCompanyId();\n\t\t\tif (!activeCompanyId) {\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror: \"No active company found\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// First, try to get just the core job to verify it exists\n\t\t\tconst { data: coreJob, error: coreError } = await supabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\"*\")\n\t\t\t\t.eq(\"id\", jobId)\n\t\t\t\t.eq(\"company_id\", activeCompanyId)\n\t\t\t\t.is(\"deleted_at\", null)\n\t\t\t\t.maybeSingle();\n\n\t\t\tif (coreError) {\n\t\t\t\tconsole.error(\"Error fetching core job:\", {\n\t\t\t\t\tjobId,\n\t\t\t\t\tcompanyId: activeCompanyId,\n\t\t\t\t\terror: coreError,\n\t\t\t\t});\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror: coreError.message || \"Failed to fetch job\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!coreJob) {\n\t\t\t\tconsole.warn(\"Job not found:\", { jobId, companyId: activeCompanyId });\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror: \"Job not found\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Attempt to fetch job with domain tables using the regular authed client first\n\t\t\tconst { data: jobWithDomains, error: jobDomainsError } = await supabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\n\t\t\t\t\t`\n\t\t\t\t${JOB_WITH_DOMAINS_QUERY},\n\t\t\t\tcustomer:customers!customer_id(id, first_name, last_name, email, phone, display_name, company_name),\n\t\t\t\tproperty:properties!property_id(id, address, city, state, zip_code, customer_id)\n\t\t\t`,\n\t\t\t\t)\n\t\t\t\t.eq(\"id\", jobId)\n\t\t\t\t.eq(\"company_id\", activeCompanyId)\n\t\t\t\t.is(\"deleted_at\", null)\n\t\t\t\t.maybeSingle();\n\n\t\t\tlet enrichedJob: any = jobWithDomains ?? null;\n\t\t\tlet domainError: PostgrestError | null = jobDomainsError ?? null;\n\n\t\t\t// Fallback: try again with service role client to bypass incomplete RLS policies\n\t\t\tif (!enrichedJob) {\n\t\t\t\tconst serviceSupabase = await createServiceSupabaseClient();\n\t\t\t\tif (serviceSupabase) {\n\t\t\t\t\tconst { data: serviceJob, error: serviceError } =\n\t\t\t\t\t\tawait serviceSupabase\n\t\t\t\t\t\t\t.from(\"jobs\")\n\t\t\t\t\t\t\t.select(\n\t\t\t\t\t\t\t\t`\n\t\t\t\t\t\t${JOB_WITH_DOMAINS_QUERY},\n\t\t\t\t\t\tcustomer:customers!customer_id(id, first_name, last_name, email, phone, display_name, company_name),\n\t\t\t\t\t\tproperty:properties!property_id(id, address, city, state, zip_code, customer_id)\n\t\t\t\t\t`,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.eq(\"id\", jobId)\n\t\t\t\t\t\t\t.eq(\"company_id\", activeCompanyId)\n\t\t\t\t\t\t\t.is(\"deleted_at\", null)\n\t\t\t\t\t\t\t.maybeSingle();\n\n\t\t\t\t\tif (serviceJob) {\n\t\t\t\t\t\tenrichedJob = serviceJob;\n\t\t\t\t\t\tdomainError = null;\n\t\t\t\t\t} else if (serviceError) {\n\t\t\t\t\t\tdomainError = serviceError;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Final fallback: fetch each domain table individually using the authed client\n\t\t\tif (!enrichedJob) {\n\t\t\t\tconst { data: domainData, errors: domainErrors } =\n\t\t\t\t\tawait fetchDomainsIndividually(supabase, jobId, activeCompanyId);\n\n\t\t\t\tif (domainErrors.length > 0) {\n\t\t\t\t\tdomainError = domainError ?? domainErrors[0]?.error ?? null;\n\t\t\t\t}\n\n\t\t\t\t// Also fetch customer and property data if they exist\n\t\t\t\tconst [customerData, propertyData] = await Promise.all([\n\t\t\t\t\tcoreJob.customer_id\n\t\t\t\t\t\t? supabase\n\t\t\t\t\t\t\t\t.from(\"customers\")\n\t\t\t\t\t\t\t\t.select(\n\t\t\t\t\t\t\t\t\t\"id, first_name, last_name, email, phone, display_name, company_name\",\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.eq(\"id\", coreJob.customer_id)\n\t\t\t\t\t\t\t\t.maybeSingle()\n\t\t\t\t\t\t: { data: null },\n\t\t\t\t\tcoreJob.property_id\n\t\t\t\t\t\t? supabase\n\t\t\t\t\t\t\t\t.from(\"properties\")\n\t\t\t\t\t\t\t\t.select(\"id, address, city, state, zip_code, customer_id\")\n\t\t\t\t\t\t\t\t.eq(\"id\", coreJob.property_id)\n\t\t\t\t\t\t\t\t.maybeSingle()\n\t\t\t\t\t\t: { data: null },\n\t\t\t\t]);\n\n\t\t\t\tenrichedJob = {\n\t\t\t\t\t...coreJob,\n\t\t\t\t\t...domainData,\n\t\t\t\t\tcustomer: customerData.data,\n\t\t\t\t\tproperty: propertyData.data,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (enrichedJob) {\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: true,\n\t\t\t\t\tdata: buildJobResponse(enrichedJob),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (domainError) {\n\t\t\t\tconsole.error(\"Error fetching job with domains:\", {\n\t\t\t\t\tjobId,\n\t\t\t\t\terror: domainError,\n\t\t\t\t\terrorMessage: domainError?.message,\n\t\t\t\t\terrorCode: domainError?.code,\n\t\t\t\t\terrorDetails: domainError?.details,\n\t\t\t\t\terrorHint: domainError?.hint,\n\t\t\t\t\tselectQuery: JOB_WITH_DOMAINS_QUERY,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Fall back to the core job data if enriched joins fail entirely\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tdata: buildJobResponse(coreJob),\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Unexpected error in getJob:\", error);\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror:\n\t\t\t\t\terror instanceof Error ? error.message : \"Unknown error occurred\",\n\t\t\t};\n\t\t}\n\t},\n);\n","/**\n * Job Domain Schemas\n *\n * Zod validation schemas for job domain tables after refactoring.\n * The jobs table has been split into 11 focused domain tables for:\n * - Better performance (smaller queries)\n * - Improved security (fine-grained RLS)\n * - Easier maintenance (isolated domains)\n * - Better scalability (targeted optimizations)\n */\n\nimport { z } from \"zod\";\n\n// ============================================================================\n// JOB_FINANCIAL - Financial and billing information\n// ============================================================================\n\nconst jobFinancialInsertSchema = z.object({\n\tjob_id: z.string().uuid(),\n\tcompany_id: z.string().uuid(),\n\ttotal_amount: z.number().int().default(0),\n\tpaid_amount: z.number().int().default(0),\n\tdeposit_amount: z.number().int().default(0),\n\tdeposit_paid_at: z.date().optional().nullable(),\n\tpayment_terms: z.string().max(200).optional().nullable(),\n\tpayment_due_date: z.date().optional().nullable(),\n\tinvoice_generated_at: z.date().optional().nullable(),\n});\n\nconst jobFinancialUpdateSchema = jobFinancialInsertSchema\n\t.partial()\n\t.omit({ job_id: true, company_id: true });\n\nconst jobFinancialSelectSchema = jobFinancialInsertSchema.extend({\n\tid: z.string().uuid(),\n\tcreated_at: z.date(),\n\tupdated_at: z.date(),\n});\n\nexport type JobFinancialInsert = z.infer<typeof jobFinancialInsertSchema>;\nexport type JobFinancialUpdate = z.infer<typeof jobFinancialUpdateSchema>;\nexport type JobFinancialSelect = z.infer<typeof jobFinancialSelectSchema>;\n\n// ============================================================================\n// JOB_WORKFLOW - Workflow and template information\n// ============================================================================\n\nconst jobWorkflowInsertSchema = z.object({\n\tjob_id: z.string().uuid(),\n\tcompany_id: z.string().uuid(),\n\ttemplate_id: z.string().uuid().optional().nullable(),\n\tworkflow_stage: z.string().max(100).optional().nullable(),\n\tworkflow_completed_stages: z.array(z.any()).default([]),\n\tworkflow_stage_changed_at: z.date().optional().nullable(),\n});\n\nconst jobWorkflowUpdateSchema = jobWorkflowInsertSchema\n\t.partial()\n\t.omit({ job_id: true, company_id: true });\n\nconst jobWorkflowSelectSchema = jobWorkflowInsertSchema.extend({\n\tid: z.string().uuid(),\n\tcreated_at: z.date(),\n\tupdated_at: z.date(),\n});\n\nexport type JobWorkflowInsert = z.infer<typeof jobWorkflowInsertSchema>;\nexport type JobWorkflowUpdate = z.infer<typeof jobWorkflowUpdateSchema>;\nexport type JobWorkflowSelect = z.infer<typeof jobWorkflowSelectSchema>;\n\n// ============================================================================\n// JOB_TIME_TRACKING - Time tracking and labor hours\n// ============================================================================\n\nconst jobTimeTrackingInsertSchema = z.object({\n\tjob_id: z.string().uuid(),\n\tcompany_id: z.string().uuid(),\n\ttechnician_clock_in: z.date().optional().nullable(),\n\ttechnician_clock_out: z.date().optional().nullable(),\n\tactual_start: z.date().optional().nullable(),\n\tactual_end: z.date().optional().nullable(),\n\ttotal_labor_hours: z.number().default(0),\n\testimated_labor_hours: z.number().optional().nullable(),\n\tbreak_time_minutes: z.number().int().default(0),\n});\n\nconst jobTimeTrackingUpdateSchema = jobTimeTrackingInsertSchema\n\t.partial()\n\t.omit({ job_id: true, company_id: true });\n\nconst jobTimeTrackingSelectSchema = jobTimeTrackingInsertSchema.extend({\n\tid: z.string().uuid(),\n\tcreated_at: z.date(),\n\tupdated_at: z.date(),\n});\n\nexport type JobTimeTrackingInsert = z.infer<typeof jobTimeTrackingInsertSchema>;\nexport type JobTimeTrackingUpdate = z.infer<typeof jobTimeTrackingUpdateSchema>;\nexport type JobTimeTrackingSelect = z.infer<typeof jobTimeTrackingSelectSchema>;\n\n// ============================================================================\n// JOB_CUSTOMER_APPROVAL - Customer signatures and approval\n// ============================================================================\n\nconst jobCustomerApprovalInsertSchema = z.object({\n\tjob_id: z.string().uuid(),\n\tcompany_id: z.string().uuid(),\n\tcustomer_signature: z.any().optional().nullable(),\n\tcustomer_approval_status: z\n\t\t.enum([\"pending\", \"approved\", \"rejected\"])\n\t\t.default(\"pending\"),\n\tcustomer_approval_timestamp: z.date().optional().nullable(),\n\tcustomer_notes: z.string().optional().nullable(),\n});\n\nconst jobCustomerApprovalUpdateSchema = jobCustomerApprovalInsertSchema\n\t.partial()\n\t.omit({ job_id: true, company_id: true });\n\nconst jobCustomerApprovalSelectSchema =\n\tjobCustomerApprovalInsertSchema.extend({\n\t\tid: z.string().uuid(),\n\t\tcreated_at: z.date(),\n\t\tupdated_at: z.date(),\n\t});\n\nexport type JobCustomerApprovalInsert = z.infer<\n\ttypeof jobCustomerApprovalInsertSchema\n>;\nexport type JobCustomerApprovalUpdate = z.infer<\n\ttypeof jobCustomerApprovalUpdateSchema\n>;\nexport type JobCustomerApprovalSelect = z.infer<\n\ttypeof jobCustomerApprovalSelectSchema\n>;\n\n// ============================================================================\n// JOB_EQUIPMENT_SERVICE - Equipment service tracking\n// ============================================================================\n\nconst jobEquipmentServiceInsertSchema = z.object({\n\tjob_id: z.string().uuid(),\n\tcompany_id: z.string().uuid(),\n\tprimary_equipment_id: z.string().uuid().optional().nullable(),\n\tequipment_service_history: z.array(z.any()).default([]),\n\tequipment_serviced: z.array(z.any()).default([]),\n\tjob_warranty_info: z.any().optional().nullable(),\n\tjob_service_agreement_id: z.string().uuid().optional().nullable(),\n\tjob_recurrence_id: z.string().uuid().optional().nullable(),\n});\n\nconst jobEquipmentServiceUpdateSchema = jobEquipmentServiceInsertSchema\n\t.partial()\n\t.omit({ job_id: true, company_id: true });\n\nconst jobEquipmentServiceSelectSchema =\n\tjobEquipmentServiceInsertSchema.extend({\n\t\tid: z.string().uuid(),\n\t\tcreated_at: z.date(),\n\t\tupdated_at: z.date(),\n\t});\n\nexport type JobEquipmentServiceInsert = z.infer<\n\ttypeof jobEquipmentServiceInsertSchema\n>;\nexport type JobEquipmentServiceUpdate = z.infer<\n\ttypeof jobEquipmentServiceUpdateSchema\n>;\nexport type JobEquipmentServiceSelect = z.infer<\n\ttypeof jobEquipmentServiceSelectSchema\n>;\n\n// ============================================================================\n// JOB_DISPATCH - Dispatch and routing information\n// ============================================================================\n\nconst jobDispatchInsertSchema = z.object({\n\tjob_id: z.string().uuid(),\n\tcompany_id: z.string().uuid(),\n\tdispatch_zone: z.string().max(100).optional().nullable(),\n\ttravel_time_minutes: z.number().int().optional().nullable(),\n\troute_order: z.number().int().optional().nullable(),\n\tprevious_job_id: z.string().uuid().optional().nullable(),\n\tnext_job_id: z.string().uuid().optional().nullable(),\n});\n\nconst jobDispatchUpdateSchema = jobDispatchInsertSchema\n\t.partial()\n\t.omit({ job_id: true, company_id: true });\n\nconst jobDispatchSelectSchema = jobDispatchInsertSchema.extend({\n\tid: z.string().uuid(),\n\tcreated_at: z.date(),\n\tupdated_at: z.date(),\n});\n\nexport type JobDispatchInsert = z.infer<typeof jobDispatchInsertSchema>;\nexport type JobDispatchUpdate = z.infer<typeof jobDispatchUpdateSchema>;\nexport type JobDispatchSelect = z.infer<typeof jobDispatchSelectSchema>;\n\n// ============================================================================\n// JOB_QUALITY - Quality metrics and inspections\n// ============================================================================\n\nconst jobQualityInsertSchema = z.object({\n\tjob_id: z.string().uuid(),\n\tcompany_id: z.string().uuid(),\n\tinspection_required: z.boolean().default(false),\n\tinspection_completed_at: z.date().optional().nullable(),\n\tquality_score: z.number().int().min(0).max(100).optional().nullable(),\n\tcustomer_satisfaction_rating: z\n\t\t.number()\n\t\t.int()\n\t\t.min(1)\n\t\t.max(5)\n\t\t.optional()\n\t\t.nullable(),\n\tquality_notes: z.string().optional().nullable(),\n\tinternal_priority_score: z.number().int().optional().nullable(),\n});\n\nconst jobQualityUpdateSchema = jobQualityInsertSchema\n\t.partial()\n\t.omit({ job_id: true, company_id: true });\n\nconst jobQualitySelectSchema = jobQualityInsertSchema.extend({\n\tid: z.string().uuid(),\n\tcreated_at: z.date(),\n\tupdated_at: z.date(),\n});\n\nexport type JobQualityInsert = z.infer<typeof jobQualityInsertSchema>;\nexport type JobQualityUpdate = z.infer<typeof jobQualityUpdateSchema>;\nexport type JobQualitySelect = z.infer<typeof jobQualitySelectSchema>;\n\n// ============================================================================\n// JOB_SAFETY - Safety and compliance information\n// ============================================================================\n\nconst jobSafetyInsertSchema = z.object({\n\tjob_id: z.string().uuid(),\n\tcompany_id: z.string().uuid(),\n\trequires_permit: z.boolean().default(false),\n\tpermit_obtained_at: z.date().optional().nullable(),\n\thazards_identified: z.string().optional().nullable(),\n\tsafety_notes: z.string().optional().nullable(),\n});\n\nconst jobSafetyUpdateSchema = jobSafetyInsertSchema\n\t.partial()\n\t.omit({ job_id: true, company_id: true });\n\nconst jobSafetySelectSchema = jobSafetyInsertSchema.extend({\n\tid: z.string().uuid(),\n\tcreated_at: z.date(),\n\tupdated_at: z.date(),\n});\n\nexport type JobSafetyInsert = z.infer<typeof jobSafetyInsertSchema>;\nexport type JobSafetyUpdate = z.infer<typeof jobSafetyUpdateSchema>;\nexport type JobSafetySelect = z.infer<typeof jobSafetySelectSchema>;\n\n// ============================================================================\n// JOB_AI_ENRICHMENT - AI-powered analysis\n// ============================================================================\n\nconst jobAiEnrichmentInsertSchema = z.object({\n\tjob_id: z.string().uuid(),\n\tcompany_id: z.string().uuid(),\n\tai_categories: z.any().optional().nullable(),\n\tai_equipment: z.any().optional().nullable(),\n\tai_service_type: z.string().optional().nullable(),\n\tai_priority_score: z.number().int().optional().nullable(),\n\tai_tags: z.any().optional().nullable(),\n\tai_processed_at: z.date().optional().nullable(),\n});\n\nconst jobAiEnrichmentUpdateSchema = jobAiEnrichmentInsertSchema\n\t.partial()\n\t.omit({ job_id: true, company_id: true });\n\nconst jobAiEnrichmentSelectSchema = jobAiEnrichmentInsertSchema.extend({\n\tid: z.string().uuid(),\n\tcreated_at: z.date(),\n\tupdated_at: z.date(),\n});\n\nexport type JobAiEnrichmentInsert = z.infer<typeof jobAiEnrichmentInsertSchema>;\nexport type JobAiEnrichmentUpdate = z.infer<typeof jobAiEnrichmentUpdateSchema>;\nexport type JobAiEnrichmentSelect = z.infer<typeof jobAiEnrichmentSelectSchema>;\n\n// ============================================================================\n// JOB_MULTI_ENTITY - Multi-customer/property support\n// ============================================================================\n\nconst jobMultiEntityInsertSchema = z.object({\n\tjob_id: z.string().uuid(),\n\tcompany_id: z.string().uuid(),\n\tprimary_customer_id: z.string().uuid().optional().nullable(),\n\tprimary_property_id: z.string().uuid().optional().nullable(),\n\trequires_multiple_properties: z.boolean().default(false),\n\trequires_multiple_customers: z.boolean().default(false),\n\tdeleted_by: z.string().uuid().optional().nullable(),\n\tpermanent_delete_scheduled_at: z.date().optional().nullable(),\n});\n\nconst jobMultiEntityUpdateSchema = jobMultiEntityInsertSchema\n\t.partial()\n\t.omit({ job_id: true, company_id: true });\n\nconst jobMultiEntitySelectSchema = jobMultiEntityInsertSchema.extend({\n\tid: z.string().uuid(),\n\tcreated_at: z.date(),\n\tupdated_at: z.date(),\n});\n\nexport type JobMultiEntityInsert = z.infer<typeof jobMultiEntityInsertSchema>;\nexport type JobMultiEntityUpdate = z.infer<typeof jobMultiEntityUpdateSchema>;\nexport type JobMultiEntitySelect = z.infer<typeof jobMultiEntitySelectSchema>;\n\n// ============================================================================\n// COMPOSITE TYPE - Complete job with all domains\n// ============================================================================\n\nconst jobCompleteSchema = z.object({\n\t// Core job\n\tid: z.string().uuid(),\n\tcompany_id: z.string().uuid(),\n\tjob_number: z.string(),\n\ttitle: z.string(),\n\tdescription: z.string().nullable(),\n\tstatus: z.enum([\n\t\t\"quoted\",\n\t\t\"scheduled\",\n\t\t\"in_progress\",\n\t\t\"on_hold\",\n\t\t\"completed\",\n\t\t\"cancelled\",\n\t\t\"archived\",\n\t]),\n\tpriority: z.enum([\"low\", \"medium\", \"high\", \"urgent\"]),\n\tjob_type: z.string().nullable(),\n\tservice_type: z.string().nullable(),\n\tproperty_id: z.string().uuid().nullable(),\n\tcustomer_id: z.string().uuid().nullable(),\n\tassigned_to: z.string().uuid().nullable(),\n\tscheduled_start: z.date().nullable(),\n\tscheduled_end: z.date().nullable(),\n\tnotes: z.string().nullable(),\n\tmetadata: z.any().nullable(),\n\tcreated_at: z.date(),\n\tupdated_at: z.date(),\n\tdeleted_at: z.date().nullable(),\n\tarchived_at: z.date().nullable(),\n\tsearch_vector: z.any().nullable(),\n\n\t// Domain data (all optional - may not be loaded)\n\tfinancial: jobFinancialSelectSchema.optional().nullable(),\n\tworkflow: jobWorkflowSelectSchema.optional().nullable(),\n\ttimeTracking: jobTimeTrackingSelectSchema.optional().nullable(),\n\tcustomerApproval: jobCustomerApprovalSelectSchema.optional().nullable(),\n\tequipmentService: jobEquipmentServiceSelectSchema.optional().nullable(),\n\tdispatch: jobDispatchSelectSchema.optional().nullable(),\n\tquality: jobQualitySelectSchema.optional().nullable(),\n\tsafety: jobSafetySelectSchema.optional().nullable(),\n\taiEnrichment: jobAiEnrichmentSelectSchema.optional().nullable(),\n\tmultiEntity: jobMultiEntitySelectSchema.optional().nullable(),\n});\n\nexport type JobComplete = z.infer<typeof jobCompleteSchema>;\n\n// ============================================================================\n// HELPER FUNCTIONS - Build complete job queries\n// ============================================================================\n\n/**\n * Get the Supabase select string for a complete job with all domains\n *\n * Usage:\n * ```typescript\n * const { data } = await supabase\n *   .from('jobs')\n *   .select(getJobCompleteSelect())\n *   .eq('id', jobId)\n *   .single();\n * ```\n */\nfunction getJobCompleteSelect(): string {\n\treturn `\n\t\t*,\n\t\tfinancial:job_financial(*),\n\t\tworkflow:job_workflow(*),\n\t\ttimeTracking:job_time_tracking(*),\n\t\tcustomerApproval:job_customer_approval(*),\n\t\tequipmentService:job_equipment_service(*),\n\t\tdispatch:job_dispatch(*),\n\t\tquality:job_quality(*),\n\t\tsafety:job_safety(*),\n\t\taiEnrichment:job_ai_enrichment(*),\n\t\tmultiEntity:job_multi_entity(*)\n\t`\n\t\t.trim()\n\t\t.replace(/\\s+/g, \" \");\n}\n\n/**\n * Get a minimal job select (for list views)\n * Only includes core fields + financial for display\n */\nfunction getJobListSelect(): string {\n\treturn `\n\t\t*,\n\t\tfinancial:job_financial(total_amount, paid_amount)\n\t`\n\t\t.trim()\n\t\t.replace(/\\s+/g, \" \");\n}\n\n/**\n * Get job select for specific domains\n *\n * @param domains - Array of domain names to include\n *\n * Usage:\n * ```typescript\n * getJobWithDomains(['financial', 'workflow', 'timeTracking'])\n * ```\n */\nexport function getJobWithDomains(\n\tdomains: Array<\n\t\t| \"financial\"\n\t\t| \"workflow\"\n\t\t| \"timeTracking\"\n\t\t| \"customerApproval\"\n\t\t| \"equipmentService\"\n\t\t| \"dispatch\"\n\t\t| \"quality\"\n\t\t| \"safety\"\n\t\t| \"aiEnrichment\"\n\t\t| \"multiEntity\"\n\t>,\n): string {\n\tconst domainMap = {\n\t\tfinancial: \"financial:job_financial(*)\",\n\t\tworkflow: \"workflow:job_workflow(*)\",\n\t\ttimeTracking: \"timeTracking:job_time_tracking(*)\",\n\t\tcustomerApproval: \"customerApproval:job_customer_approval(*)\",\n\t\tequipmentService: \"equipmentService:job_equipment_service(*)\",\n\t\tdispatch: \"dispatch:job_dispatch(*)\",\n\t\tquality: \"quality:job_quality(*)\",\n\t\tsafety: \"safety:job_safety(*)\",\n\t\taiEnrichment: \"aiEnrichment:job_ai_enrichment(*)\",\n\t\tmultiEntity: \"multiEntity:job_multi_entity(*)\",\n\t};\n\n\tconst selects = [\"*\", ...domains.map((d) => domainMap[d])];\n\treturn selects.join(\", \");\n}\n"],"names":[],"mappings":"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","ignoreList":[0,1]}