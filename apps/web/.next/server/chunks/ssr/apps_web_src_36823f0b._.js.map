{"version":3,"sources":["../../../../../../apps/web/src/emails/components/button.tsx","../../../../../../apps/web/src/emails/theme.ts","../../../../../../apps/web/src/emails/components/card.tsx","../../../../../../apps/web/src/emails/components/heading.tsx","../../../../../../apps/web/src/emails/layouts/base-layout.tsx","../../../../../../apps/web/src/emails/templates/billing/invoice-sent.tsx","../../../../../../apps/web/src/actions/invoice-communications.ts"],"sourcesContent":["/**\n * Email Button Component - Matches dashboard button design\n *\n * Design:\n * - Primary variant with Thorbis Electric Blue\n * - Outline variant for secondary actions\n * - Responsive and accessible\n * - Supports both link and button styles\n */\n\nimport { Button as EmailButton } from \"@react-email/components\";\nimport { EMAIL_COLORS } from \"../theme\";\n\ntype ButtonProps = {\n\thref: string;\n\tchildren: React.ReactNode;\n\tvariant?: \"primary\" | \"outline\";\n};\n\nexport function Button({ href, children, variant = \"primary\" }: ButtonProps) {\n\tconst baseStyle = {\n\t\tdisplay: \"inline-block\",\n\t\tpadding: \"12px 24px\",\n\t\tfontSize: \"16px\",\n\t\tfontWeight: \"600\",\n\t\ttextDecoration: \"none\",\n\t\tborderRadius: \"8px\",\n\t\ttextAlign: \"center\" as const,\n\t\ttransition: \"all 0.2s ease\",\n\t};\n\n\tconst variantStyles = {\n\t\tprimary: {\n\t\t\tbackgroundColor: EMAIL_COLORS.primary, // Thorbis Electric Blue\n\t\t\tcolor: EMAIL_COLORS.primaryText,\n\t\t\tborder: \"none\",\n\t\t},\n\t\toutline: {\n\t\t\tbackgroundColor: \"transparent\",\n\t\t\tcolor: EMAIL_COLORS.primary,\n\t\t\tborder: `2px solid ${EMAIL_COLORS.primary}`,\n\t\t},\n\t};\n\n\treturn (\n\t\t<EmailButton\n\t\t\thref={href}\n\t\t\tstyle={{\n\t\t\t\t...baseStyle,\n\t\t\t\t...variantStyles[variant],\n\t\t\t}}\n\t\t>\n\t\t\t{children}\n\t\t</EmailButton>\n\t);\n}\n","export const EMAIL_COLORS = {\n\tbackground: \"#fafafa\",\n\tsurface: \"#fcfcfc\",\n\tsurfaceStrong: \"#f2f2f2\",\n\tprimary: \"#3c6ff5\",\n\tprimaryText: \"#fafafa\",\n\theading: \"#171717\",\n\ttext: \"#171717\",\n\tmuted: \"#737373\",\n\tborder: \"#e6e6e6\",\n\tsuccess: \"#22c55e\",\n\twarning: \"#f59e0b\",\n\terror: \"#ef4444\",\n};\n","/**\n * Email Card Component - Information card matching dashboard cards\n *\n * Design:\n * - Clean white background with subtle border\n * - Rounded corners\n * - Padding for content spacing\n * - Optional header and footer sections\n */\n\nimport { Section, Text } from \"@react-email/components\";\nimport type { ReactNode } from \"react\";\nimport { EMAIL_COLORS } from \"../theme\";\n\ntype CardProps = {\n\tchildren: ReactNode;\n\ttitle?: string;\n\tstyle?: React.CSSProperties;\n};\n\nexport function Card({ children, title, style }: CardProps) {\n\treturn (\n\t\t<Section\n\t\t\tstyle={{\n\t\t\t\t...cardStyle,\n\t\t\t\t...style,\n\t\t\t}}\n\t\t>\n\t\t\t{title && <Text style={titleStyle}>{title}</Text>}\n\t\t\t{children}\n\t\t</Section>\n\t);\n}\n\nconst cardStyle = {\n\tbackgroundColor: EMAIL_COLORS.surface,\n\tborder: `1px solid ${EMAIL_COLORS.border}`,\n\tborderRadius: \"8px\",\n\tpadding: \"24px\",\n\tmargin: \"16px 0\",\n};\n\nconst titleStyle = {\n\tfontSize: \"18px\",\n\tfontWeight: \"600\",\n\tcolor: EMAIL_COLORS.heading,\n\tmargin: \"0 0 16px 0\",\n};\n","/**\n * Email Heading Component - Typography for email headings\n *\n * Design:\n * - H1, H2, H3 variants\n * - Matches dashboard typography\n * - Proper spacing and hierarchy\n */\n\nimport { Heading as EmailHeading } from \"@react-email/components\";\nimport { EMAIL_COLORS } from \"../theme\";\n\ntype HeadingProps = {\n\tchildren: React.ReactNode;\n\tlevel?: 1 | 2 | 3;\n\tstyle?: React.CSSProperties;\n};\n\nexport function Heading({ children, level = 1, style }: HeadingProps) {\n\tconst headingTag = `h${level}` as \"h1\" | \"h2\" | \"h3\";\n\tconst headingStyles = {\n\t\t1: {\n\t\t\tfontSize: \"32px\",\n\t\t\tfontWeight: \"700\",\n\t\t\tcolor: EMAIL_COLORS.heading,\n\t\t\tmargin: \"0 0 16px 0\",\n\t\t\tlineHeight: \"1.2\",\n\t\t},\n\t\t2: {\n\t\t\tfontSize: \"24px\",\n\t\t\tfontWeight: \"600\",\n\t\t\tcolor: EMAIL_COLORS.text,\n\t\t\tmargin: \"0 0 12px 0\",\n\t\t\tlineHeight: \"1.3\",\n\t\t},\n\t\t3: {\n\t\t\tfontSize: \"18px\",\n\t\t\tfontWeight: \"600\",\n\t\t\tcolor: EMAIL_COLORS.muted,\n\t\t\tmargin: \"0 0 8px 0\",\n\t\t\tlineHeight: \"1.4\",\n\t\t},\n\t};\n\n\treturn (\n\t\t<EmailHeading\n\t\t\tas={headingTag}\n\t\t\tstyle={{\n\t\t\t\t...headingStyles[level],\n\t\t\t\t...style,\n\t\t\t}}\n\t\t>\n\t\t\t{children}\n\t\t</EmailHeading>\n\t);\n}\n","/**\n * Thorbis-Branded Email Layout\n *\n * For platform/system emails:\n * - Clean, full-width design (no cards)\n * - Thorbis logo image from CDN/env\n * - Thorbis Electric Blue branding\n * - Professional footer with Thorbis info\n *\n * Uses environment variables for:\n * - Logo URL\n * - App URL\n * - Support email\n * - Company info\n */\n\nimport {\n\tBody,\n\tContainer,\n\tHead,\n\tHr,\n\tHtml,\n\tImg,\n\tLink,\n\tPreview,\n\tSection,\n\tText,\n} from \"@react-email/components\";\nimport type { ReactNode } from \"react\";\nimport { EMAIL_COLORS } from \"../theme\";\n\ntype BaseLayoutProps = {\n\tchildren: ReactNode;\n\tpreviewText?: string;\n};\n\n// Environment-based configuration\nconst THORBIS_LOGO_URL =\n\tprocess.env.NEXT_PUBLIC_THORBIS_LOGO_URL ||\n\t\"https://thorbis.com/logo-white.png\";\nconst THORBIS_APP_URL =\n\tprocess.env.NEXT_PUBLIC_APP_URL || \"https://app.thorbis.com\";\nconst THORBIS_WEBSITE =\n\tprocess.env.NEXT_PUBLIC_WEBSITE_URL || \"https://thorbis.com\";\nconst THORBIS_SUPPORT_EMAIL =\n\tprocess.env.THORBIS_SUPPORT_EMAIL || \"support@thorbis.com\";\nconst THORBIS_DOCS_URL = `${THORBIS_WEBSITE}/docs`;\nconst THORBIS_PRIVACY_URL = `${THORBIS_WEBSITE}/privacy`;\nconst THORBIS_TERMS_URL = `${THORBIS_WEBSITE}/terms`;\n\nexport function BaseLayout({ children, previewText }: BaseLayoutProps) {\n\treturn (\n\t\t<Html>\n\t\t\t<Head>\n\t\t\t\t<style>{`\n          @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');\n\n          /* Reset email client styles */\n          body { margin: 0; padding: 0; }\n          table { border-collapse: collapse; }\n          img { border: 0; }\n\n          /* Responsive */\n          @media only screen and (max-width: 600px) {\n            .mobile-padding { padding: 20px !important; }\n            .mobile-text { font-size: 14px !important; }\n            .mobile-heading { font-size: 24px !important; }\n          }\n        `}</style>\n\t\t\t</Head>\n\t\t\t{previewText && <Preview>{previewText}</Preview>}\n\t\t\t<Body style={main}>\n\t\t\t\t<Container style={container}>\n\t\t\t\t\t{/* Header with Thorbis logo on blue background */}\n\t\t\t\t\t<Section style={header}>\n\t\t\t\t\t\t<Img\n\t\t\t\t\t\t\tsrc={THORBIS_LOGO_URL}\n\t\t\t\t\t\t\talt=\"Thorbis\"\n\t\t\t\t\t\t\twidth=\"160\"\n\t\t\t\t\t\t\theight=\"40\"\n\t\t\t\t\t\t\tstyle={logo}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Section>\n\n\t\t\t\t\t{/* Main content - full width, no cards */}\n\t\t\t\t\t<Section style={content} className=\"mobile-padding\">\n\t\t\t\t\t\t{children}\n\t\t\t\t\t</Section>\n\n\t\t\t\t\t{/* Divider */}\n\t\t\t\t\t<Hr style={divider} />\n\n\t\t\t\t\t{/* Footer */}\n\t\t\t\t\t<Section style={footer} className=\"mobile-padding\">\n\t\t\t\t\t\t{/* Support Links */}\n\t\t\t\t\t\t<Text style={footerText}>\n\t\t\t\t\t\t\tNeed help?{\" \"}\n\t\t\t\t\t\t\t<Link href={`mailto:${THORBIS_SUPPORT_EMAIL}`} style={footerLink}>\n\t\t\t\t\t\t\t\tContact Support\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t{\" • \"}\n\t\t\t\t\t\t\t<Link href={THORBIS_DOCS_URL} style={footerLink}>\n\t\t\t\t\t\t\t\tDocumentation\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</Text>\n\n\t\t\t\t\t\t{/* Legal Links */}\n\t\t\t\t\t\t<Text style={footerText}>\n\t\t\t\t\t\t\t<Link href={THORBIS_PRIVACY_URL} style={footerLink}>\n\t\t\t\t\t\t\t\tPrivacy Policy\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t{\" • \"}\n\t\t\t\t\t\t\t<Link href={THORBIS_TERMS_URL} style={footerLink}>\n\t\t\t\t\t\t\t\tTerms of Service\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</Text>\n\n\t\t\t\t\t\t{/* Company Info */}\n\t\t\t\t\t\t<Text style={footerCopyright}>\n\t\t\t\t\t\t\t© {new Date().getFullYear()} Thorbis. All rights reserved.\n\t\t\t\t\t\t</Text>\n\n\t\t\t\t\t\t<Text style={footerAddress}>\n\t\t\t\t\t\t\tThorbis • 123 Innovation Drive, San Francisco, CA 94105\n\t\t\t\t\t\t</Text>\n\n\t\t\t\t\t\t{/* Unsubscribe - required for CAN-SPAM compliance */}\n\t\t\t\t\t\t<Text style={footerUnsubscribe}>\n\t\t\t\t\t\t\tYou're receiving this email because you have an account with\n\t\t\t\t\t\t\tThorbis.{\" \"}\n\t\t\t\t\t\t\t<Link href=\"{{unsubscribe_url}}\" style={footerLink}>\n\t\t\t\t\t\t\t\tUnsubscribe from marketing emails\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</Text>\n\t\t\t\t\t</Section>\n\t\t\t\t</Container>\n\t\t\t</Body>\n\t\t</Html>\n\t);\n}\n\n// Styles - Clean, full-width design\nconst main = {\n\tbackgroundColor: EMAIL_COLORS.background,\n\tfontFamily:\n\t\t'Inter, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif',\n\tWebkitFontSmoothing: \"antialiased\" as const,\n\tMozOsxFontSmoothing: \"grayscale\" as const,\n};\n\nconst container = {\n\tbackgroundColor: EMAIL_COLORS.surface,\n\tmaxWidth: \"600px\",\n\tmargin: \"0 auto\",\n};\n\nconst header = {\n\tbackgroundColor: EMAIL_COLORS.primary, // Thorbis Electric Blue\n\tpadding: \"40px 0\",\n\ttextAlign: \"center\" as const,\n};\n\nconst logo = {\n\tmargin: \"0 auto\",\n\tdisplay: \"block\",\n};\n\nconst content = {\n\tpadding: \"48px 40px\",\n\tcolor: EMAIL_COLORS.text,\n\tfontSize: \"16px\",\n\tlineHeight: \"24px\",\n};\n\nconst divider = {\n\tborderColor: EMAIL_COLORS.border,\n\tborderWidth: \"1px\",\n\tmargin: \"0\",\n};\n\nconst footer = {\n\tpadding: \"32px 40px\",\n\ttextAlign: \"center\" as const,\n\tbackgroundColor: EMAIL_COLORS.surfaceStrong,\n};\n\nconst footerText = {\n\tcolor: EMAIL_COLORS.muted,\n\tfontSize: \"14px\",\n\tlineHeight: \"24px\",\n\tmargin: \"8px 0\",\n};\n\nconst footerLink = {\n\tcolor: EMAIL_COLORS.primary,\n\ttextDecoration: \"none\",\n\tfontWeight: \"500\",\n};\n\nconst footerCopyright = {\n\tcolor: EMAIL_COLORS.muted,\n\tfontSize: \"13px\",\n\tmargin: \"16px 0 0 0\",\n\tfontWeight: \"600\",\n};\n\nconst footerAddress = {\n\tcolor: EMAIL_COLORS.muted,\n\tfontSize: \"12px\",\n\tmargin: \"8px 0\",\n};\n\nconst footerUnsubscribe = {\n\tcolor: EMAIL_COLORS.muted,\n\tfontSize: \"11px\",\n\tmargin: \"16px 0 0 0\",\n\tlineHeight: \"18px\",\n};\n","/**\n * Invoice Sent Email Template\n *\n * Sent to customers when an invoice is generated.\n * Features:\n * - Invoice summary with amount due\n * - Line items breakdown\n * - Payment button with secure link\n * - Download PDF link\n */\n\nimport { Text } from \"@react-email/components\";\nimport { Button } from \"@/emails/components/button\";\nimport { Card } from \"@/emails/components/card\";\nimport { Heading } from \"@/emails/components/heading\";\nimport { BaseLayout } from \"@/emails/layouts/base-layout\";\nimport { EMAIL_COLORS } from \"@/emails/theme\";\n\nexport type InvoiceSentEmailProps = {\n\tcustomerName: string;\n\tinvoiceNumber: string;\n\ttotalAmount: string;\n\tdueDate: string;\n\titems: Array<{\n\t\tdescription: string;\n\t\tquantity: number;\n\t\tamount: string;\n\t}>;\n\tpaymentUrl: string;\n\tdownloadUrl: string;\n\tpreviewText?: string;\n};\n\nexport default function InvoiceSentEmail({\n\tcustomerName,\n\tinvoiceNumber,\n\ttotalAmount,\n\tdueDate,\n\titems,\n\tpaymentUrl,\n\tdownloadUrl,\n\tpreviewText = `Invoice ${invoiceNumber} for ${totalAmount}`,\n}: InvoiceSentEmailProps) {\n\treturn (\n\t\t<BaseLayout previewText={previewText}>\n\t\t\t<Heading level={1}>Invoice {invoiceNumber}</Heading>\n\n\t\t\t<Text style={paragraph}>Hi {customerName},</Text>\n\n\t\t\t<Text style={paragraph}>\n\t\t\t\tThank you for your business! Please find your invoice details below.\n\t\t\t</Text>\n\n\t\t\t{/* Invoice Summary Card */}\n\t\t\t<Card style={invoiceCard}>\n\t\t\t\t<div style={invoiceHeader}>\n\t\t\t\t\t<Text style={invoiceLabel}>Amount Due</Text>\n\t\t\t\t\t<Text style={invoiceAmount}>{totalAmount}</Text>\n\t\t\t\t</div>\n\t\t\t\t<div style={invoiceDetails}>\n\t\t\t\t\t<div style={detailRow}>\n\t\t\t\t\t\t<Text style={detailLabel}>Invoice Number:</Text>\n\t\t\t\t\t\t<Text style={detailValue}>{invoiceNumber}</Text>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style={detailRow}>\n\t\t\t\t\t\t<Text style={detailLabel}>Due Date:</Text>\n\t\t\t\t\t\t<Text style={detailValue}>{dueDate}</Text>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</Card>\n\n\t\t\t{/* Line Items */}\n\t\t\t{items.length > 0 && (\n\t\t\t\t<Card style={itemsCard}>\n\t\t\t\t\t<Heading level={3} style={{ marginBottom: \"16px\" }}>\n\t\t\t\t\t\tInvoice Details\n\t\t\t\t\t</Heading>\n\t\t\t\t\t<table style={itemsTable}>\n\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<th style={tableHeader}>Description</th>\n\t\t\t\t\t\t\t\t<th style={{ ...tableHeader, textAlign: \"center\" }}>Qty</th>\n\t\t\t\t\t\t\t\t<th style={{ ...tableHeader, textAlign: \"right\" }}>Amount</th>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t{items.map((item, index) => (\n\t\t\t\t\t\t\t\t<tr key={index}>\n\t\t\t\t\t\t\t\t\t<td style={tableCell}>{item.description}</td>\n\t\t\t\t\t\t\t\t\t<td style={{ ...tableCell, textAlign: \"center\" }}>\n\t\t\t\t\t\t\t\t\t\t{item.quantity}\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td style={{ ...tableCell, textAlign: \"right\" }}>\n\t\t\t\t\t\t\t\t\t\t{item.amount}\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t<tfoot>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td colSpan={2} style={{ ...tableCell, fontWeight: \"bold\" }}>\n\t\t\t\t\t\t\t\t\tTotal\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td\n\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\t...tableCell,\n\t\t\t\t\t\t\t\t\t\ttextAlign: \"right\",\n\t\t\t\t\t\t\t\t\t\tfontWeight: \"bold\",\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{totalAmount}\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</tfoot>\n\t\t\t\t\t</table>\n\t\t\t\t</Card>\n\t\t\t)}\n\n\t\t\t{/* Payment Button */}\n\t\t\t<div style={buttonContainer}>\n\t\t\t\t<Button href={paymentUrl}>Pay Now</Button>\n\t\t\t</div>\n\n\t\t\t{/* Secondary Actions */}\n\t\t\t<Card style={actionsCard}>\n\t\t\t\t<Text style={actionsText}>\n\t\t\t\t\t<a href={downloadUrl} style={link}>\n\t\t\t\t\t\tDownload PDF Invoice\n\t\t\t\t\t</a>\n\t\t\t\t</Text>\n\t\t\t</Card>\n\n\t\t\t{/* Footer Note */}\n\t\t\t<Text style={footerNote}>\n\t\t\t\tIf you have any questions about this invoice, please don't hesitate to\n\t\t\t\tcontact us. We appreciate your prompt payment.\n\t\t\t</Text>\n\t\t</BaseLayout>\n\t);\n}\n\n// Styles\nconst paragraph: React.CSSProperties = {\n\tfontSize: \"16px\",\n\tlineHeight: \"26px\",\n\tcolor: EMAIL_COLORS.text,\n\tmargin: \"16px 0\",\n};\n\nconst invoiceCard: React.CSSProperties = {\n\tbackgroundColor: EMAIL_COLORS.primary,\n\tpadding: \"24px\",\n\tborderRadius: \"8px\",\n\tmarginBottom: \"24px\",\n};\n\nconst invoiceHeader: React.CSSProperties = {\n\ttextAlign: \"center\" as const,\n\tmarginBottom: \"16px\",\n};\n\nconst invoiceLabel: React.CSSProperties = {\n\tfontSize: \"14px\",\n\tcolor: \"rgba(255, 255, 255, 0.8)\",\n\tmargin: \"0 0 4px 0\",\n};\n\nconst invoiceAmount: React.CSSProperties = {\n\tfontSize: \"36px\",\n\tfontWeight: \"bold\",\n\tcolor: \"#ffffff\",\n\tmargin: \"0\",\n};\n\nconst invoiceDetails: React.CSSProperties = {\n\tborderTop: \"1px solid rgba(255, 255, 255, 0.2)\",\n\tpaddingTop: \"16px\",\n};\n\nconst detailRow: React.CSSProperties = {\n\tdisplay: \"flex\",\n\tjustifyContent: \"space-between\",\n\tmarginBottom: \"8px\",\n};\n\nconst detailLabel: React.CSSProperties = {\n\tfontSize: \"14px\",\n\tcolor: \"rgba(255, 255, 255, 0.8)\",\n\tmargin: \"0\",\n};\n\nconst detailValue: React.CSSProperties = {\n\tfontSize: \"14px\",\n\tcolor: \"#ffffff\",\n\tfontWeight: \"500\",\n\tmargin: \"0\",\n};\n\nconst itemsCard: React.CSSProperties = {\n\tmarginBottom: \"24px\",\n};\n\nconst itemsTable: React.CSSProperties = {\n\twidth: \"100%\",\n\tborderCollapse: \"collapse\" as const,\n};\n\nconst tableHeader: React.CSSProperties = {\n\tfontSize: \"12px\",\n\tfontWeight: \"600\",\n\tcolor: EMAIL_COLORS.muted,\n\ttextTransform: \"uppercase\" as const,\n\ttextAlign: \"left\" as const,\n\tpadding: \"8px 0\",\n\tborderBottom: `1px solid ${EMAIL_COLORS.border}`,\n};\n\nconst tableCell: React.CSSProperties = {\n\tfontSize: \"14px\",\n\tcolor: EMAIL_COLORS.text,\n\tpadding: \"12px 0\",\n\tborderBottom: `1px solid ${EMAIL_COLORS.border}`,\n};\n\nconst buttonContainer: React.CSSProperties = {\n\ttextAlign: \"center\" as const,\n\tmargin: \"32px 0\",\n};\n\nconst actionsCard: React.CSSProperties = {\n\ttextAlign: \"center\" as const,\n\tpadding: \"16px\",\n\tmarginBottom: \"24px\",\n};\n\nconst actionsText: React.CSSProperties = {\n\tfontSize: \"14px\",\n\tcolor: EMAIL_COLORS.muted,\n\tmargin: \"0\",\n};\n\nconst link: React.CSSProperties = {\n\tcolor: EMAIL_COLORS.primary,\n\ttextDecoration: \"underline\",\n};\n\nconst footerNote: React.CSSProperties = {\n\tfontSize: \"14px\",\n\tcolor: EMAIL_COLORS.muted,\n\ttextAlign: \"center\" as const,\n\tmargin: \"24px 0 0 0\",\n};\n","\"use server\";\n\n/**\n * Invoice Communications Server Actions\n *\n * Handles sending invoices and estimates via email:\n * - Send invoice to customer with PDF attachment\n * - Send estimate to customer with PDF attachment\n * - Track sent status and communication history\n */\n\nimport { revalidatePath } from \"next/cache\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { sendEmail } from \"@/lib/email/email-sender\";\nimport { EmailTemplate } from \"@/lib/email/email-types\";\nimport InvoiceSentEmail from \"@/emails/templates/billing/invoice-sent\";\n\n/**\n * Format currency amount from cents to display string\n */\nfunction formatCurrency(cents: number | null | undefined): string {\n\tconst amount = (cents || 0) / 100;\n\treturn new Intl.NumberFormat(\"en-US\", {\n\t\tstyle: \"currency\",\n\t\tcurrency: \"USD\",\n\t}).format(amount);\n}\n\n/**\n * Format date for display\n */\nfunction formatDate(date: string | Date | null | undefined): string {\n\tif (!date) return \"N/A\";\n\treturn new Date(date).toLocaleDateString(\"en-US\", {\n\t\tyear: \"numeric\",\n\t\tmonth: \"long\",\n\t\tday: \"numeric\",\n\t});\n}\n\n/**\n * Parse line items from JSON to array format for email template\n */\nfunction parseLineItems(\n\tlineItems: unknown\n): Array<{ description: string; quantity: number; amount: string }> {\n\tif (!lineItems) return [];\n\n\ttry {\n\t\tconst items = Array.isArray(lineItems) ? lineItems : [];\n\t\treturn items.map((item: any) => ({\n\t\t\tdescription: item.description || item.name || \"Item\",\n\t\t\tquantity: item.quantity || 1,\n\t\t\tamount: formatCurrency(item.total || item.amount || item.unit_price || 0),\n\t\t}));\n\t} catch {\n\t\treturn [];\n\t}\n}\n\n/**\n * Send invoice via email\n */\nexport async function sendInvoiceEmail(invoiceId: string) {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tif (!supabase) {\n\t\t\treturn { success: false, error: \"Database connection failed\" };\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\n\t\tif (!user) {\n\t\t\treturn { success: false, error: \"Not authenticated\" };\n\t\t}\n\n\t\t// Get invoice with customer and company details\n\t\tconst { data: invoice, error } = await supabase\n\t\t\t.from(\"invoices\")\n\t\t\t.select(\n\t\t\t\t`\n\t\t\t\t*,\n\t\t\t\tcustomer:customers!customer_id(\n\t\t\t\t\tid,\n\t\t\t\t\tfirst_name,\n\t\t\t\t\tlast_name,\n\t\t\t\t\temail\n\t\t\t\t),\n\t\t\t\tcompany:companies!company_id(\n\t\t\t\t\tid,\n\t\t\t\t\tname\n\t\t\t\t)\n\t\t\t`\n\t\t\t)\n\t\t\t.eq(\"id\", invoiceId)\n\t\t\t.single();\n\n\t\tif (error || !invoice) {\n\t\t\treturn { success: false, error: \"Invoice not found\" };\n\t\t}\n\n\t\tif (!invoice.customer?.email) {\n\t\t\treturn { success: false, error: \"Customer has no email address\" };\n\t\t}\n\n\t\t// Build customer name\n\t\tconst customerName = [\n\t\t\tinvoice.customer.first_name,\n\t\t\tinvoice.customer.last_name,\n\t\t]\n\t\t\t.filter(Boolean)\n\t\t\t.join(\" \") || \"Valued Customer\";\n\n\t\t// Build URLs\n\t\tconst siteUrl = process.env.NEXT_PUBLIC_SITE_URL || \"http://localhost:3000\";\n\t\tconst paymentUrl = `${siteUrl}/pay/${invoiceId}`;\n\t\tconst downloadUrl = `${siteUrl}/api/invoices/${invoiceId}/pdf`;\n\n\t\t// Parse line items\n\t\tconst items = parseLineItems(invoice.line_items);\n\n\t\t// Create email template\n\t\tconst emailTemplate = InvoiceSentEmail({\n\t\t\tcustomerName,\n\t\t\tinvoiceNumber: invoice.invoice_number || `INV-${invoiceId.slice(0, 8)}`,\n\t\t\ttotalAmount: formatCurrency(invoice.total_amount),\n\t\t\tdueDate: formatDate(invoice.due_date),\n\t\t\titems:\n\t\t\t\titems.length > 0\n\t\t\t\t\t? items\n\t\t\t\t\t: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdescription: invoice.title || \"Services Rendered\",\n\t\t\t\t\t\t\t\tquantity: 1,\n\t\t\t\t\t\t\t\tamount: formatCurrency(invoice.total_amount),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\tpaymentUrl,\n\t\t\tdownloadUrl,\n\t\t\tpreviewText: `Invoice ${invoice.invoice_number || invoiceId.slice(0, 8)} for ${formatCurrency(invoice.total_amount)}`,\n\t\t});\n\n\t\t// Send the email\n\t\tconst emailResult = await sendEmail({\n\t\t\tto: invoice.customer.email,\n\t\t\tsubject: `Invoice ${invoice.invoice_number || `#${invoiceId.slice(0, 8)}`} from ${invoice.company?.name || \"Your Service Provider\"}`,\n\t\t\ttemplate: emailTemplate,\n\t\t\ttemplateType: EmailTemplate.INVOICE_SENT,\n\t\t\tcompanyId: invoice.company_id,\n\t\t\ttags: [\n\t\t\t\t{ name: \"invoice_id\", value: invoiceId },\n\t\t\t\t{ name: \"customer_id\", value: invoice.customer_id },\n\t\t\t],\n\t\t});\n\n\t\tif (!emailResult.success) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: emailResult.error || \"Failed to send email\",\n\t\t\t};\n\t\t}\n\n\t\t// Update sent_at timestamp and increment reminder count\n\t\tawait supabase\n\t\t\t.from(\"invoices\")\n\t\t\t.update({\n\t\t\t\tsent_at: new Date().toISOString(),\n\t\t\t\treminder_count: (invoice.reminder_count || 0) + 1,\n\t\t\t\tlast_reminder_sent_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", invoiceId);\n\n\t\trevalidatePath(`/dashboard/customers/${invoice.customer_id}`);\n\t\trevalidatePath(`/dashboard/work/invoices/${invoiceId}`);\n\t\trevalidatePath(`/dashboard/work/invoices`);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tmessage: `Invoice sent to ${invoice.customer.email}`,\n\t\t\tdata: { emailId: emailResult.data?.id },\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"[sendInvoiceEmail] Error:\", error);\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Failed to send invoice\",\n\t\t};\n\t}\n}\n\n/**\n * Parse line items for estimate template (slightly different format)\n */\nfunction parseEstimateLineItems(\n\tlineItems: unknown\n): Array<{ description: string; amount: string }> {\n\tif (!lineItems) return [];\n\n\ttry {\n\t\tconst items = Array.isArray(lineItems) ? lineItems : [];\n\t\treturn items.map((item: any) => ({\n\t\t\tdescription: item.description || item.name || \"Service\",\n\t\t\tamount: formatCurrency(item.total || item.amount || item.unit_price || 0),\n\t\t}));\n\t} catch {\n\t\treturn [];\n\t}\n}\n\n/**\n * Send estimate via email\n */\nexport async function sendEstimateEmail(estimateId: string) {\n\t// Dynamic import to avoid loading the template until needed\n\tconst EstimateSentEmail = (\n\t\tawait import(\"@/emails/templates/billing/estimate-sent\")\n\t).default;\n\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tif (!supabase) {\n\t\t\treturn { success: false, error: \"Database connection failed\" };\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\n\t\tif (!user) {\n\t\t\treturn { success: false, error: \"Not authenticated\" };\n\t\t}\n\n\t\t// Get estimate with customer and company details\n\t\tconst { data: estimate, error } = await supabase\n\t\t\t.from(\"estimates\")\n\t\t\t.select(\n\t\t\t\t`\n\t\t\t\t*,\n\t\t\t\tcustomer:customers!customer_id(\n\t\t\t\t\tid,\n\t\t\t\t\tfirst_name,\n\t\t\t\t\tlast_name,\n\t\t\t\t\temail\n\t\t\t\t),\n\t\t\t\tcompany:companies!company_id(\n\t\t\t\t\tid,\n\t\t\t\t\tname\n\t\t\t\t)\n\t\t\t`\n\t\t\t)\n\t\t\t.eq(\"id\", estimateId)\n\t\t\t.single();\n\n\t\tif (error || !estimate) {\n\t\t\treturn { success: false, error: \"Estimate not found\" };\n\t\t}\n\n\t\tif (!estimate.customer?.email) {\n\t\t\treturn { success: false, error: \"Customer has no email address\" };\n\t\t}\n\n\t\t// Build customer name\n\t\tconst customerName = [\n\t\t\testimate.customer.first_name,\n\t\t\testimate.customer.last_name,\n\t\t]\n\t\t\t.filter(Boolean)\n\t\t\t.join(\" \") || \"Valued Customer\";\n\n\t\t// Build URLs\n\t\tconst siteUrl = process.env.NEXT_PUBLIC_SITE_URL || \"http://localhost:3000\";\n\t\tconst viewUrl = `${siteUrl}/dashboard/work/estimates/${estimateId}`;\n\t\tconst acceptUrl = `${siteUrl}/estimates/${estimateId}/accept`;\n\n\t\t// Parse line items\n\t\tconst items = parseEstimateLineItems(estimate.line_items);\n\n\t\t// Create email template\n\t\tconst emailTemplate = EstimateSentEmail({\n\t\t\tcustomerName,\n\t\t\testimateNumber: estimate.estimate_number || `EST-${estimateId.slice(0, 8)}`,\n\t\t\ttotalAmount: formatCurrency(estimate.total_amount),\n\t\t\tvalidUntil: formatDate(estimate.valid_until || estimate.expires_at),\n\t\t\titems:\n\t\t\t\titems.length > 0\n\t\t\t\t\t? items\n\t\t\t\t\t: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdescription: estimate.title || \"Proposed Services\",\n\t\t\t\t\t\t\t\tamount: formatCurrency(estimate.total_amount),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\tacceptUrl,\n\t\t\tviewUrl,\n\t\t\tpreviewText: `Estimate ${estimate.estimate_number || estimateId.slice(0, 8)} for ${formatCurrency(estimate.total_amount)}`,\n\t\t});\n\n\t\t// Send the email\n\t\tconst emailResult = await sendEmail({\n\t\t\tto: estimate.customer.email,\n\t\t\tsubject: `Estimate ${estimate.estimate_number || `#${estimateId.slice(0, 8)}`} from ${estimate.company?.name || \"Your Service Provider\"}`,\n\t\t\ttemplate: emailTemplate,\n\t\t\ttemplateType: EmailTemplate.ESTIMATE_SENT,\n\t\t\tcompanyId: estimate.company_id,\n\t\t\ttags: [\n\t\t\t\t{ name: \"estimate_id\", value: estimateId },\n\t\t\t\t{ name: \"customer_id\", value: estimate.customer_id },\n\t\t\t],\n\t\t});\n\n\t\tif (!emailResult.success) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: emailResult.error || \"Failed to send email\",\n\t\t\t};\n\t\t}\n\n\t\t// Update sent_at timestamp\n\t\tawait supabase\n\t\t\t.from(\"estimates\")\n\t\t\t.update({ sent_at: new Date().toISOString() })\n\t\t\t.eq(\"id\", estimateId);\n\n\t\trevalidatePath(`/dashboard/customers/${estimate.customer_id}`);\n\t\trevalidatePath(`/dashboard/work/estimates/${estimateId}`);\n\t\trevalidatePath(`/dashboard/work/estimates`);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tmessage: `Estimate sent to ${estimate.customer.email}`,\n\t\t\tdata: { emailId: emailResult.data?.id },\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"[sendEstimateEmail] Error:\", error);\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Failed to send estimate\",\n\t\t};\n\t}\n}\n"],"names":[],"mappings":"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"}