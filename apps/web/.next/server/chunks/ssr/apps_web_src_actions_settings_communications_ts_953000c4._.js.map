{"version":3,"sources":["../../../../../../apps/web/src/actions/settings/communications.ts"],"sourcesContent":["/**\n * Communication Settings Server Actions\n *\n * Handles email, SMS, phone, and notification settings\n */\n\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { z } from \"zod\";\nimport {\n\tActionError,\n\tERROR_CODES,\n\tERROR_MESSAGES,\n} from \"@/lib/errors/action-error\";\nimport {\n\ttype ActionResult,\n\tassertAuthenticated,\n\twithErrorHandling,\n} from \"@/lib/errors/with-error-handling\";\nimport { createClient } from \"@/lib/supabase/server\";\n\n// ============================================================================\n// HELPER FUNCTIONS\n// ============================================================================\n\nasync function getCompanyId(supabase: any, userId: string): Promise<string> {\n\tconst { data: teamMember } = await supabase\n\t\t.from(\"company_memberships\")\n\t\t.select(\"company_id\")\n\t\t.eq(\"user_id\", userId)\n\t\t.eq(\"status\", \"active\")\n\t\t.single();\n\n\tif (!teamMember?.company_id) {\n\t\tthrow new ActionError(\n\t\t\t\"You must be part of a company\",\n\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t403,\n\t\t);\n\t}\n\n\treturn teamMember.company_id;\n}\n\n// ============================================================================\n// EMAIL SETTINGS\n// ============================================================================\n\nconst emailSettingsSchema = z.object({\n\tsmtpEnabled: z.boolean().default(false),\n\tsmtpHost: z.string().optional(),\n\tsmtpPort: z.coerce.number().optional(),\n\tsmtpUsername: z.string().optional(),\n\tsmtpPassword: z.string().optional(),\n\tsmtpFromEmail: z.string().email().optional().or(z.literal(\"\")),\n\tsmtpFromName: z.string().optional(),\n\tsmtpUseTls: z.boolean().default(true),\n\tdefaultSignature: z.string().optional(),\n\tautoCcEnabled: z.boolean().default(false),\n\tautoCcEmail: z.string().email().optional().or(z.literal(\"\")),\n\ttrackOpens: z.boolean().default(true),\n\ttrackClicks: z.boolean().default(true),\n\temailLogoUrl: z.string().optional(),\n\tprimaryColor: z\n\t\t.string()\n\t\t.regex(/^#[0-9A-F]{6}$/i)\n\t\t.default(\"#3b82f6\"),\n});\n\nexport async function updateEmailSettings(\n\tformData: FormData,\n): Promise<ActionResult<void>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst data = emailSettingsSchema.parse({\n\t\t\tsmtpEnabled: formData.get(\"smtpEnabled\") === \"true\",\n\t\t\tsmtpHost: formData.get(\"smtpHost\") || undefined,\n\t\t\tsmtpPort: formData.get(\"smtpPort\") || undefined,\n\t\t\tsmtpUsername: formData.get(\"smtpUsername\") || undefined,\n\t\t\tsmtpPassword: formData.get(\"smtpPassword\") || undefined,\n\t\t\tsmtpFromEmail: formData.get(\"smtpFromEmail\") || undefined,\n\t\t\tsmtpFromName: formData.get(\"smtpFromName\") || undefined,\n\t\t\tsmtpUseTls: formData.get(\"smtpUseTls\") !== \"false\",\n\t\t\tdefaultSignature: formData.get(\"defaultSignature\") || undefined,\n\t\t\tautoCcEnabled: formData.get(\"autoCcEnabled\") === \"true\",\n\t\t\tautoCcEmail: formData.get(\"autoCcEmail\") || undefined,\n\t\t\ttrackOpens: formData.get(\"trackOpens\") !== \"false\",\n\t\t\ttrackClicks: formData.get(\"trackClicks\") !== \"false\",\n\t\t\temailLogoUrl: formData.get(\"emailLogoUrl\") || undefined,\n\t\t\tprimaryColor: formData.get(\"primaryColor\") || \"#3b82f6\",\n\t\t});\n\n\t\t// Encrypt password if provided (in a real app, use proper encryption)\n\t\tconst encryptedPassword = data.smtpPassword\n\t\t\t? Buffer.from(data.smtpPassword).toString(\"base64\")\n\t\t\t: null;\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"communication_email_settings\")\n\t\t\t.upsert({\n\t\t\t\tcompany_id: companyId,\n\t\t\t\tsmtp_enabled: data.smtpEnabled,\n\t\t\t\tsmtp_host: data.smtpHost,\n\t\t\t\tsmtp_port: data.smtpPort,\n\t\t\t\tsmtp_username: data.smtpUsername,\n\t\t\t\tsmtp_password_encrypted: encryptedPassword,\n\t\t\t\tsmtp_from_email: data.smtpFromEmail,\n\t\t\t\tsmtp_from_name: data.smtpFromName,\n\t\t\t\tsmtp_use_tls: data.smtpUseTls,\n\t\t\t\tdefault_signature: data.defaultSignature,\n\t\t\t\tauto_cc_enabled: data.autoCcEnabled,\n\t\t\t\tauto_cc_email: data.autoCcEmail,\n\t\t\t\ttrack_opens: data.trackOpens,\n\t\t\t\ttrack_clicks: data.trackClicks,\n\t\t\t\temail_logo_url: data.emailLogoUrl,\n\t\t\t\tprimary_color: data.primaryColor,\n\t\t\t});\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"update email settings\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/settings/communications/email\");\n\t});\n}\n\nexport async function getEmailSettings(): Promise<ActionResult<any>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"communication_email_settings\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (error && error.code !== \"PGRST116\") {\n\t\t\t// PGRST116 = no rows returned\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"fetch email settings\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\treturn data || null;\n\t});\n}\n\nexport async function getEmailInfrastructure(): Promise<\n\tActionResult<{\n\t\tdomain: Record<string, unknown> | null;\n\t\tinboundRoute: Record<string, unknown> | null;\n\t}>\n> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst [{ data: domain }, { data: inboundRoute }] = await Promise.all([\n\t\t\tsupabase\n\t\t\t\t.from(\"company_email_domains\")\n\t\t\t\t.select(\"*\")\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t\t.maybeSingle(),\n\t\t\tsupabase\n\t\t\t\t.from(\"communication_email_inbound_routes\")\n\t\t\t\t.select(\"*\")\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.maybeSingle(),\n\t\t]);\n\n\t\treturn {\n\t\t\tdomain: domain ?? null,\n\t\t\tinboundRoute: inboundRoute ?? null,\n\t\t};\n\t});\n}\n\n// ============================================================================\n// SMS SETTINGS\n// ============================================================================\n\nconst quickRepliesConfigSchema = z.object({\n\tgreeting_enabled: z.boolean().default(false),\n\tgreeting_message: z.string().default(\"Hi! Thanks for reaching out to {{company_name}}. How can we help you today?\"),\n\tafter_hours_enabled: z.boolean().default(false),\n\tafter_hours_message: z.string().default(\"Thanks for your message! We're currently closed but will respond first thing in the morning. For emergencies, call {{emergency_phone}}.\"),\n\tappointment_reminder_enabled: z.boolean().default(false),\n\tappointment_reminder_hours_before: z.number().default(24),\n\tappointment_reminder_message: z.string().default(\"Reminder: You have an appointment with {{company_name}} tomorrow at {{appointment_time}}. Reply YES to confirm or call us to reschedule.\"),\n\tjob_complete_enabled: z.boolean().default(false),\n\tjob_complete_message: z.string().default(\"Your service has been completed! Thank you for choosing {{company_name}}. Please let us know if you have any questions.\"),\n\treview_request_enabled: z.boolean().default(false),\n\treview_request_delay_hours: z.number().default(24),\n\treview_request_message: z.string().default(\"Thank you for choosing {{company_name}}! We'd love to hear about your experience. Please leave us a review: {{review_link}}\"),\n});\n\nconst smsSettingsSchema = z.object({\n\tprovider: z.enum([\"twilio\", \"other\"]).default(\"twilio\"),\n\tproviderApiKey: z.string().optional(),\n\tsenderNumber: z.string().optional(),\n\tautoReplyEnabled: z.boolean().default(false),\n\tautoReplyMessage: z.string().optional(),\n\toptOutMessage: z.string().default(\"Reply STOP to unsubscribe\"),\n\tincludeOptOut: z.boolean().default(true),\n\tconsentRequired: z.boolean().default(true),\n\tquickRepliesEnabled: z.boolean().default(false),\n\tquickRepliesConfig: quickRepliesConfigSchema.optional(),\n});\n\nexport async function updateSmsSettings(\n\tformData: FormData,\n): Promise<ActionResult<void>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\t// Parse quick replies config from JSON string\n\t\tlet quickRepliesConfig = undefined;\n\t\tconst quickRepliesConfigStr = formData.get(\"quickRepliesConfig\") as string;\n\t\tif (quickRepliesConfigStr) {\n\t\t\ttry {\n\t\t\t\tquickRepliesConfig = JSON.parse(quickRepliesConfigStr);\n\t\t\t} catch (_e) {\n\t\t\t\t// Invalid JSON, use undefined\n\t\t\t}\n\t\t}\n\n\t\tconst data = smsSettingsSchema.parse({\n\t\t\tprovider: formData.get(\"provider\") || \"twilio\",\n\t\t\tproviderApiKey: formData.get(\"providerApiKey\") || undefined,\n\t\t\tsenderNumber: formData.get(\"senderNumber\") || undefined,\n\t\t\tautoReplyEnabled: formData.get(\"autoReplyEnabled\") === \"true\",\n\t\t\tautoReplyMessage: formData.get(\"autoReplyMessage\") || undefined,\n\t\t\toptOutMessage:\n\t\t\t\tformData.get(\"optOutMessage\") || \"Reply STOP to unsubscribe\",\n\t\t\tincludeOptOut: formData.get(\"includeOptOut\") !== \"false\",\n\t\t\tconsentRequired: formData.get(\"consentRequired\") !== \"false\",\n\t\t\tquickRepliesEnabled: formData.get(\"quickRepliesEnabled\") === \"true\",\n\t\t\tquickRepliesConfig,\n\t\t});\n\n\t\t// Encrypt API key if provided\n\t\tconst encryptedApiKey = data.providerApiKey\n\t\t\t? Buffer.from(data.providerApiKey).toString(\"base64\")\n\t\t\t: null;\n\n\t\tconst { error } = await supabase.from(\"communication_sms_settings\").upsert({\n\t\t\tcompany_id: companyId,\n\t\t\tprovider: data.provider,\n\t\t\tprovider_api_key_encrypted: encryptedApiKey,\n\t\t\tsender_number: data.senderNumber,\n\t\t\tauto_reply_enabled: data.autoReplyEnabled,\n\t\t\tauto_reply_message: data.autoReplyMessage,\n\t\t\topt_out_message: data.optOutMessage,\n\t\t\tinclude_opt_out: data.includeOptOut,\n\t\t\tconsent_required: data.consentRequired,\n\t\t\tquick_replies_enabled: data.quickRepliesEnabled,\n\t\t\tquick_replies_config: data.quickRepliesConfig,\n\t\t});\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"update SMS settings\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/settings/communications/sms\");\n\t});\n}\n\nexport async function getSmsSettings(): Promise<ActionResult<any>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"communication_sms_settings\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (error && error.code !== \"PGRST116\") {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"fetch SMS settings\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\treturn data || null;\n\t});\n}\n\n// ============================================================================\n// PHONE SETTINGS\n// ============================================================================\n\nconst phoneSettingsSchema = z.object({\n\troutingStrategy: z\n\t\t.enum([\"round_robin\", \"skills_based\", \"priority\", \"simultaneous\"])\n\t\t.default(\"round_robin\"),\n\tfallbackNumber: z.string().optional(),\n\tbusinessHoursOnly: z.boolean().default(false),\n\tvoicemailEnabled: z.boolean().default(true),\n\tvoicemailGreetingUrl: z.string().optional(),\n\tvoicemailEmailNotifications: z.boolean().default(true),\n\tvoicemailTranscriptionEnabled: z.boolean().default(false),\n\trecordingEnabled: z.boolean().default(false),\n\trecordingAnnouncement: z\n\t\t.string()\n\t\t.default(\"This call may be recorded for quality assurance\"),\n\trecordingConsentRequired: z.boolean().default(true),\n\tivrEnabled: z.boolean().default(false),\n\tivrMenu: z.string().optional(),\n});\n\nexport async function updatePhoneSettings(\n\tformData: FormData,\n): Promise<ActionResult<void>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst ivrMenuStr = formData.get(\"ivrMenu\") as string;\n\t\tlet ivrMenuJson = {};\n\t\tif (ivrMenuStr) {\n\t\t\ttry {\n\t\t\t\tivrMenuJson = JSON.parse(ivrMenuStr);\n\t\t\t} catch (_e) {\n\t\t\t\t// Invalid JSON, use empty object\n\t\t\t}\n\t\t}\n\n\t\tconst data = phoneSettingsSchema.parse({\n\t\t\troutingStrategy: formData.get(\"routingStrategy\") || \"round_robin\",\n\t\t\tfallbackNumber: formData.get(\"fallbackNumber\") || undefined,\n\t\t\tbusinessHoursOnly: formData.get(\"businessHoursOnly\") === \"true\",\n\t\t\tvoicemailEnabled: formData.get(\"voicemailEnabled\") !== \"false\",\n\t\t\tvoicemailGreetingUrl: formData.get(\"voicemailGreetingUrl\") || undefined,\n\t\t\tvoicemailEmailNotifications:\n\t\t\t\tformData.get(\"voicemailEmailNotifications\") !== \"false\",\n\t\t\tvoicemailTranscriptionEnabled:\n\t\t\t\tformData.get(\"voicemailTranscriptionEnabled\") === \"true\",\n\t\t\trecordingEnabled: formData.get(\"recordingEnabled\") === \"true\",\n\t\t\trecordingAnnouncement:\n\t\t\t\tformData.get(\"recordingAnnouncement\") ||\n\t\t\t\t\"This call may be recorded for quality assurance\",\n\t\t\trecordingConsentRequired:\n\t\t\t\tformData.get(\"recordingConsentRequired\") !== \"false\",\n\t\t\tivrEnabled: formData.get(\"ivrEnabled\") === \"true\",\n\t\t\tivrMenu: ivrMenuStr || undefined,\n\t\t});\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"communication_phone_settings\")\n\t\t\t.upsert({\n\t\t\t\tcompany_id: companyId,\n\t\t\t\trouting_strategy: data.routingStrategy,\n\t\t\t\tfallback_number: data.fallbackNumber,\n\t\t\t\tbusiness_hours_only: data.businessHoursOnly,\n\t\t\t\tvoicemail_enabled: data.voicemailEnabled,\n\t\t\t\tvoicemail_greeting_url: data.voicemailGreetingUrl,\n\t\t\t\tvoicemail_email_notifications: data.voicemailEmailNotifications,\n\t\t\t\tvoicemail_transcription_enabled: data.voicemailTranscriptionEnabled,\n\t\t\t\trecording_enabled: data.recordingEnabled,\n\t\t\t\trecording_announcement: data.recordingAnnouncement,\n\t\t\t\trecording_consent_required: data.recordingConsentRequired,\n\t\t\t\tivr_enabled: data.ivrEnabled,\n\t\t\t\tivr_menu: ivrMenuJson,\n\t\t\t});\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"update phone settings\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/settings/communications/phone\");\n\t});\n}\n\nexport async function getPhoneSettings(): Promise<ActionResult<any>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"communication_phone_settings\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (error && error.code !== \"PGRST116\") {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"fetch phone settings\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\treturn data || null;\n\t});\n}\n\n// ============================================================================\n// NOTIFICATION SETTINGS\n// ============================================================================\n\nconst notificationSettingsSchema = z.object({\n\t// Job Notifications\n\tnotifyNewJobs: z.boolean().default(true),\n\tnotifyJobUpdates: z.boolean().default(true),\n\tnotifyJobCompletions: z.boolean().default(true),\n\n\t// Customer Notifications\n\tnotifyNewCustomers: z.boolean().default(false),\n\tnotifyCustomerUpdates: z.boolean().default(false),\n\n\t// Invoice Notifications\n\tnotifyInvoiceSent: z.boolean().default(true),\n\tnotifyInvoicePaid: z.boolean().default(true),\n\tnotifyInvoiceOverdue: z.boolean().default(true),\n\n\t// Estimate Notifications\n\tnotifyEstimateSent: z.boolean().default(true),\n\tnotifyEstimateApproved: z.boolean().default(true),\n\tnotifyEstimateDeclined: z.boolean().default(false),\n\n\t// Schedule Notifications\n\tnotifyScheduleChanges: z.boolean().default(true),\n\tnotifyTechnicianAssigned: z.boolean().default(true),\n\n\t// Communication Channels\n\temailNotifications: z.boolean().default(true),\n\tsmsNotifications: z.boolean().default(false),\n\tpushNotifications: z.boolean().default(true),\n\tinAppNotifications: z.boolean().default(true),\n});\n\nexport async function updateNotificationSettings(\n\tformData: FormData,\n): Promise<ActionResult<void>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst data = notificationSettingsSchema.parse({\n\t\t\tnotifyNewJobs: formData.get(\"notifyNewJobs\") !== \"false\",\n\t\t\tnotifyJobUpdates: formData.get(\"notifyJobUpdates\") !== \"false\",\n\t\t\tnotifyJobCompletions: formData.get(\"notifyJobCompletions\") !== \"false\",\n\t\t\tnotifyNewCustomers: formData.get(\"notifyNewCustomers\") === \"true\",\n\t\t\tnotifyCustomerUpdates: formData.get(\"notifyCustomerUpdates\") === \"true\",\n\t\t\tnotifyInvoiceSent: formData.get(\"notifyInvoiceSent\") !== \"false\",\n\t\t\tnotifyInvoicePaid: formData.get(\"notifyInvoicePaid\") !== \"false\",\n\t\t\tnotifyInvoiceOverdue: formData.get(\"notifyInvoiceOverdue\") !== \"false\",\n\t\t\tnotifyEstimateSent: formData.get(\"notifyEstimateSent\") !== \"false\",\n\t\t\tnotifyEstimateApproved:\n\t\t\t\tformData.get(\"notifyEstimateApproved\") !== \"false\",\n\t\t\tnotifyEstimateDeclined: formData.get(\"notifyEstimateDeclined\") === \"true\",\n\t\t\tnotifyScheduleChanges: formData.get(\"notifyScheduleChanges\") !== \"false\",\n\t\t\tnotifyTechnicianAssigned:\n\t\t\t\tformData.get(\"notifyTechnicianAssigned\") !== \"false\",\n\t\t\temailNotifications: formData.get(\"emailNotifications\") !== \"false\",\n\t\t\tsmsNotifications: formData.get(\"smsNotifications\") === \"true\",\n\t\t\tpushNotifications: formData.get(\"pushNotifications\") !== \"false\",\n\t\t\tinAppNotifications: formData.get(\"inAppNotifications\") !== \"false\",\n\t\t});\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"communication_notification_settings\")\n\t\t\t.upsert({\n\t\t\t\tcompany_id: companyId,\n\t\t\t\tnotify_new_jobs: data.notifyNewJobs,\n\t\t\t\tnotify_job_updates: data.notifyJobUpdates,\n\t\t\t\tnotify_job_completions: data.notifyJobCompletions,\n\t\t\t\tnotify_new_customers: data.notifyNewCustomers,\n\t\t\t\tnotify_customer_updates: data.notifyCustomerUpdates,\n\t\t\t\tnotify_invoice_sent: data.notifyInvoiceSent,\n\t\t\t\tnotify_invoice_paid: data.notifyInvoicePaid,\n\t\t\t\tnotify_invoice_overdue: data.notifyInvoiceOverdue,\n\t\t\t\tnotify_estimate_sent: data.notifyEstimateSent,\n\t\t\t\tnotify_estimate_approved: data.notifyEstimateApproved,\n\t\t\t\tnotify_estimate_declined: data.notifyEstimateDeclined,\n\t\t\t\tnotify_schedule_changes: data.notifyScheduleChanges,\n\t\t\t\tnotify_technician_assigned: data.notifyTechnicianAssigned,\n\t\t\t\temail_notifications: data.emailNotifications,\n\t\t\t\tsms_notifications: data.smsNotifications,\n\t\t\t\tpush_notifications: data.pushNotifications,\n\t\t\t\tin_app_notifications: data.inAppNotifications,\n\t\t\t});\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"update notification settings\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/settings/communications/notifications\");\n\t});\n}\n\nexport async function getNotificationSettings(): Promise<ActionResult<any>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"communication_notification_settings\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (error && error.code !== \"PGRST116\") {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"fetch notification settings\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\treturn data || null;\n\t});\n}\n"],"names":[],"mappings":"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"}