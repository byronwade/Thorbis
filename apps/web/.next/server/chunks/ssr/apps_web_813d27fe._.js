module.exports=[273816,a=>{"use strict";var b=a.i(780195);a.i(467361);var c=a.i(445074),d=a.i(136874),e=a.i(218188),f=a.i(146057),g=a.i(395731);let h=f.z.object({name:f.z.string().min(1,"Name is required").max(100),slug:f.z.string().min(1).max(100).regex(/^[a-z0-9-]+$/,"Slug must be lowercase with hyphens only"),description:f.z.string().max(500).optional(),icon:f.z.string().max(50).default("folder"),color:f.z.string().max(20).default("blue"),sortOrder:f.z.number().int().min(0).default(0)}),i=f.z.object({title:f.z.string().min(1,"Title is required").max(200),content:f.z.string().optional(),excerpt:f.z.string().max(500).optional(),categoryId:f.z.string().uuid().optional().nullable(),isPinned:f.z.boolean().default(!1),isPublished:f.z.boolean().default(!0),priority:f.z.number().int().min(0).max(100).default(0)});async function j(a,b){let{data:{user:c}}=await a.auth.getUser();if(!c)throw Error("You must be logged in");let{data:d}=await a.from("company_memberships").select("role").eq("user_id",c.id).eq("company_id",b).single();if(!d||!["owner","admin"].includes(d.role||""))throw Error("Only admins and owners can manage pin board content");return c}async function k(a){let b=await (0,d.createClient)(),f=await (0,c.getActiveCompanyId)();if(!b)return{success:!1,error:"Database connection failed"};if(!f)return{success:!1,error:"No active company"};try{await j(b,f);let c=h.parse(a),{data:d,error:g}=await b.from("pin_board_categories").insert({company_id:f,name:c.name,slug:c.slug,description:c.description,icon:c.icon,color:c.color,sort_order:c.sortOrder}).select().single();if(g)throw g;return(0,e.revalidatePath)("/dashboard"),{success:!0,data:d}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to create category"}}}async function l(a,b){let f=await (0,d.createClient)(),g=await (0,c.getActiveCompanyId)();if(!f)return{success:!1,error:"Database connection failed"};if(!g)return{success:!1,error:"No active company"};try{await j(f,g);let c={};b.name&&(c.name=b.name),b.slug&&(c.slug=b.slug),void 0!==b.description&&(c.description=b.description),b.icon&&(c.icon=b.icon),b.color&&(c.color=b.color),void 0!==b.sortOrder&&(c.sort_order=b.sortOrder);let{data:d,error:h}=await f.from("pin_board_categories").update(c).eq("id",a).eq("company_id",g).select().single();if(h)throw h;return(0,e.revalidatePath)("/dashboard"),{success:!0,data:d}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to update category"}}}async function m(a){let b=await (0,d.createClient)(),f=await (0,c.getActiveCompanyId)();if(!b)return{success:!1,error:"Database connection failed"};if(!f)return{success:!1,error:"No active company"};try{await j(b,f);let{error:c}=await b.from("pin_board_categories").delete().eq("id",a).eq("company_id",f);if(c)throw c;return(0,e.revalidatePath)("/dashboard"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to delete category"}}}async function n(a){let b=await (0,d.createClient)(),f=await (0,c.getActiveCompanyId)();if(!b)return{success:!1,error:"Database connection failed"};if(!f)return{success:!1,error:"No active company"};try{let c=await j(b,f),d=i.parse(a),g=d.excerpt;if(!g&&d.content){let a=d.content.replace(/<[^>]*>/g,"");g=a.substring(0,200)+(a.length>200?"...":"")}let{data:h,error:k}=await b.from("pin_board_posts").insert({company_id:f,category_id:d.categoryId,title:d.title,content:d.content,excerpt:g,is_pinned:d.isPinned,is_published:d.isPublished,priority:d.priority,created_by:c.id,updated_by:c.id,published_at:d.isPublished?new Date().toISOString():null}).select(`
        *,
        category:pin_board_categories(id, name, slug, icon, color),
        author:profiles!pin_board_posts_created_by_fkey(id, full_name, avatar_url)
      `).single();if(k)throw k;return(0,e.revalidatePath)("/dashboard"),{success:!0,data:h}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to create post"}}}async function o(a,b){let f=await (0,d.createClient)(),g=await (0,c.getActiveCompanyId)();if(!f)return{success:!1,error:"Database connection failed"};if(!g)return{success:!1,error:"No active company"};try{let c={updated_by:(await j(f,g)).id};b.title&&(c.title=b.title),void 0!==b.content&&(c.content=b.content),void 0!==b.excerpt&&(c.excerpt=b.excerpt),void 0!==b.categoryId&&(c.category_id=b.categoryId),void 0!==b.isPinned&&(c.is_pinned=b.isPinned),void 0!==b.isPublished&&(c.is_published=b.isPublished,b.isPublished&&(c.published_at=new Date().toISOString())),void 0!==b.priority&&(c.priority=b.priority);let{data:d}=await f.from("pin_board_posts").select("version").eq("id",a).single();d&&(c.version=(d.version||1)+1);let{data:h,error:i}=await f.from("pin_board_posts").update(c).eq("id",a).eq("company_id",g).select(`
        *,
        category:pin_board_categories(id, name, slug, icon, color),
        author:profiles!pin_board_posts_created_by_fkey(id, full_name, avatar_url)
      `).single();if(i)throw i;return(0,e.revalidatePath)("/dashboard"),{success:!0,data:h}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to update post"}}}async function p(a){let b=await (0,d.createClient)(),f=await (0,c.getActiveCompanyId)();if(!b)return{success:!1,error:"Database connection failed"};if(!f)return{success:!1,error:"No active company"};try{await j(b,f);let{error:c}=await b.from("pin_board_posts").delete().eq("id",a).eq("company_id",f);if(c)throw c;return(0,e.revalidatePath)("/dashboard"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to delete post"}}}async function q(a){let b=await (0,d.createClient)(),f=await (0,c.getActiveCompanyId)();if(!b)return{success:!1,error:"Database connection failed"};if(!f)return{success:!1,error:"No active company"};try{await j(b,f);let{data:c}=await b.from("pin_board_posts").select("is_pinned").eq("id",a).eq("company_id",f).single();if(!c)return{success:!1,error:"Post not found"};let{data:d,error:g}=await b.from("pin_board_posts").update({is_pinned:!c.is_pinned}).eq("id",a).eq("company_id",f).select().single();if(g)throw g;return(0,e.revalidatePath)("/dashboard"),{success:!0,data:d}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to toggle pin"}}}async function r(a){let b=await (0,d.createClient)(),e=await (0,c.getActiveCompanyId)();if(!b||!e)return{success:!1};try{let{data:{user:c}}=await b.auth.getUser();if(!c)return{success:!1};return await b.from("pin_board_views").upsert({post_id:a,user_id:c.id,company_id:e,viewed_at:new Date().toISOString()},{onConflict:"post_id,user_id"}),{success:!0}}catch{return{success:!1}}}async function s(a,b){let f=await (0,d.createClient)(),g=await (0,c.getActiveCompanyId)();if(!f)return{success:!1,error:"Database connection failed"};if(!g)return{success:!1,error:"No active company"};try{let c=await j(f,g),{data:d,error:h}=await f.from("pin_board_attachments").insert({post_id:a,company_id:g,file_name:b.fileName,file_type:b.fileType,file_size:b.fileSize,file_url:b.fileUrl,description:b.description,uploaded_by:c.id}).select().single();if(h)throw h;return(0,e.revalidatePath)("/dashboard"),{success:!0,data:d}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to add attachment"}}}async function t(a){let b=await (0,d.createClient)(),f=await (0,c.getActiveCompanyId)();if(!b)return{success:!1,error:"Database connection failed"};if(!f)return{success:!1,error:"No active company"};try{await j(b,f);let{error:c}=await b.from("pin_board_attachments").delete().eq("id",a).eq("company_id",f);if(c)throw c;return(0,e.revalidatePath)("/dashboard"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to delete attachment"}}}async function u(a){let b=await (0,d.createClient)(),e=await (0,c.getActiveCompanyId)();if(!b)return{success:!1,error:"Database connection failed"};if(!e)return{success:!1,error:"No active company"};try{let c=await j(b,e),d=a.get("file"),f=a.get("postId");if(!d)return{success:!1,error:"No file provided"};if(d.size>0x3200000)return{success:!1,error:"File too large (max 50MB)"};let g=Date.now(),h=Math.random().toString(36).substring(2,8),i=d.name.replace(/[^a-zA-Z0-9.-]/g,"_"),k=`${e}/pin-board/${g}-${h}-${i}`,{data:l,error:m}=await b.storage.from("company-files").upload(k,d,{contentType:d.type,upsert:!1});if(m)return console.error("Upload error:",m),{success:!1,error:"Failed to upload file"};let{data:n}=b.storage.from("company-files").getPublicUrl(k),o=n.publicUrl,p=null;if(f){let{data:a,error:g}=await b.from("pin_board_attachments").insert({post_id:f,company_id:e,file_name:d.name,file_type:d.type,file_size:d.size,file_url:o,uploaded_by:c.id}).select().single();g?console.error("Attachment record error:",g):p=a.id}return{success:!0,data:{id:p||`temp-${g}`,url:o,fileName:d.name,fileType:d.type,fileSize:d.size,storagePath:k}}}catch(a){return console.error("Upload error:",a),{success:!1,error:a instanceof Error?a.message:"Failed to upload file"}}}async function v(a){let b=await (0,d.createClient)(),e=await (0,c.getActiveCompanyId)();if(!b)return{success:!1,error:"Database connection failed"};if(!e)return{success:!1,error:"No active company"};try{let{data:c,error:d}=await b.from("pin_board_attachments").select("file_url").eq("id",a).eq("company_id",e).single();if(d||!c)return{success:!1,error:"Attachment not found"};return{success:!0,url:c.file_url}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to get file URL"}}}async function w(){let a=await (0,d.createClient)(),b=await (0,c.getActiveCompanyId)();if(!a)return{success:!1,error:"Database connection failed"};if(!b)return{success:!1,error:"No active company"};try{await j(a,b);let{error:c}=await a.from("pin_board_categories").upsert([{name:"SOPs & Procedures",slug:"sops",icon:"file-text",color:"blue",sort_order:0},{name:"Contractors & Partners",slug:"contractors",icon:"users",color:"green",sort_order:1},{name:"Sales Materials",slug:"sales",icon:"briefcase",color:"purple",sort_order:2},{name:"Company Announcements",slug:"announcements",icon:"megaphone",color:"orange",sort_order:3},{name:"Training & Resources",slug:"training",icon:"graduation-cap",color:"cyan",sort_order:4}].map(a=>({...a,company_id:b,is_default:!0})),{onConflict:"company_id,slug"});if(c)throw c;return(0,e.revalidatePath)("/dashboard"),{success:!0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to seed categories"}}}(0,g.ensureServerEntryExports)([k,l,m,n,o,p,q,r,s,t,u,v,w]),(0,b.registerServerReference)(k,"4046a530c9ff01cc48d1b926f23f7f9f63b7d7c400",null),(0,b.registerServerReference)(l,"603ab4e6c082614099b91c8290c8676886c935b736",null),(0,b.registerServerReference)(m,"4094a4781ce2efc6fa2af40e68616c638a3ca3c9ed",null),(0,b.registerServerReference)(n,"40dc77b5f9ca3202fa201ef81720e3cbace41ac8bc",null),(0,b.registerServerReference)(o,"60d423f9bdf26d134c4870cbc58040a267b22ce261",null),(0,b.registerServerReference)(p,"40f19de32ea7cf4c1fadaf0575d8264a11b2ac7b27",null),(0,b.registerServerReference)(q,"406fa38ca6dc131deb6b17173761702aef956ef128",null),(0,b.registerServerReference)(r,"4047974945f509c6c7d6e42c1e9dec95547fb145b0",null),(0,b.registerServerReference)(s,"6029f52d809220cbbca9b0eaa5cdbe24cbbc04f0bd",null),(0,b.registerServerReference)(t,"407c567404ab080d22797109df3b3ac1d1a97d073d",null),(0,b.registerServerReference)(u,"40dde340a1ab28fdc9de8160ea41491ef22c26d9c8",null),(0,b.registerServerReference)(v,"40aec415660240e3e8868ad5e03b60f6a63d78f050",null),(0,b.registerServerReference)(w,"004e6f3afc27f62378bd167afbbf0ddd00b672187e",null),a.s(["addPinBoardAttachment",()=>s,"createPinBoardPost",()=>n,"deletePinBoardPost",()=>p,"markPostAsViewed",()=>r,"togglePinBoardPostPin",()=>q,"updatePinBoardPost",()=>o,"uploadPinBoardFile",()=>u])},455172,a=>a.a(async(b,c)=>{try{a.i(288344),a.i(285956),a.i(336176),a.i(933427),a.i(82608);var d=a.i(970552),e=a.i(765839),f=a.i(198114);a.i(103984),a.i(941771),a.i(854963),a.i(672766),a.i(404352);var g=a.i(304381);a.i(371603),a.i(396829),a.i(444057),a.i(910711);var h=a.i(571708);a.i(495405),a.i(273816);var i=b([d,e,f,g,h]);[d,e,f,g,h]=i.then?(await i)():i,a.s([]),c()}catch(a){c(a)}},!1),555344,a=>a.a(async(b,c)=>{try{var d=a.i(455172),e=a.i(288344),f=a.i(285956),g=a.i(336176),h=a.i(933427),i=a.i(82608),j=a.i(970552),k=a.i(765839),l=a.i(198114),m=a.i(103984),n=a.i(941771),o=a.i(854963),p=a.i(672766),q=a.i(404352),r=a.i(304381),s=a.i(371603),t=a.i(396829),u=a.i(444057),v=a.i(910711),w=a.i(571708),x=a.i(495405),y=a.i(273816),z=b([d,j,k,l,r,w]);[d,j,k,l,r,w]=z.then?(await z)():z,a.s(["000478fbf5363dae5000d525663da13e29908cb952",()=>g.getWebRTCCredentials,"000f90f949d6a2f5484d061d5a738a59a8c846aeaa",()=>x.getPendingSupportSessions,"001be5cf82b793f19f6a7d010c91c14577fa7a130d",()=>v.checkIsCompanyOwner,"001f005176797ef23488068124fb9a744915a477de",()=>e.getCurrentUserRole,"0043ae510c3322ea499beb9e1bb77d06afb4ef19bd",()=>r.signOut,"004cdde5e6ae8991bab4ba61ae40647c2b823200ba",()=>n.resetHourlyCounters,"00665c1bbcd52d612d5bb4bf3be5e7fc75554132e6",()=>x.getActiveSupportSessions,"006acf41615a2f7795c47b6d7a3016e18300f2ad17",()=>n.resetDailyCounters,"007505a78985e53e083a498c97761ed8a463d3d379",()=>j.checkTelnyxVerificationStatus,"0077abd0cb1e555f91adaa482ad0b2f565bbd0629a",()=>w.getCustomersForDialer,"00a122f9d5fe3a1603c636c3a251886129b66154f8",()=>p.getProviderHealthDashboard,"00a13dbd00149949fc1367d3e76ae7d789e07f5321",()=>h.createServiceSupabaseClient,"00c53a1f02416c3261983f8096f19a3450bfd51775",()=>m.runHealthCheckForAllDomains,"00cf212b0097820096122537beac12e3403b97d564",()=>q.markAllAsRead,"00ebc03a4ffc993aea7ec2e541686105c2bace2437",()=>u.getTotalUnreadCountAction,"00fe74bdf14126b5ad89e9480e82978d6357f356b3",()=>o.isGmailIntegrationEnabled,"4002f454c46f4c21ca6e9e26362583ccff69c9f914",()=>g.transcribeCallRecording,"400b8fb96146bfd004a3166563a5ab5536bb610c70",()=>m.getDomainHealth,"400ce95360aaffa14a99dfdf969ba5166c69a59eb6",()=>o.getUserGmailTokens,"4019cf9f81eb3c06f82b5c2f8eb042f3d95d91e933",()=>g.getCompanyPhoneNumbers,"401d3d830065dd7c4777fad67f642392f48735c4ab",()=>o.disconnectCompanyGmail,"40247c617842c31b242455a0961cbd2c3297606a16",()=>g.getCallRoutingRules,"4029b163c1c0acfd806352a72fe8030c8ae4f7f8ac",()=>n.incrementEmailCounter,"40369e8ea4eced7bdaef8203d369469ee7b630db8c",()=>x.endActiveSupportSession,"40413bfa888916480edbc33ebb812158fddf960f89",()=>g.updateCallRoutingRule,"404575d602ef4c60c0058b592b8c3e42fbcd13fc4c",()=>o.disconnectUserGmail,"4047974945f509c6c7d6e42c1e9dec95547fb145b0",()=>y.markPostAsViewed,"404d6f2891af89c71d5bde33d110a216bdd3ee4729",()=>m.recordDeliveryEvent,"404e47931374ad2a1b54bc11f357703790f6104530",()=>g.startCallRecording,"405a16958f97c37bd4b5711bd8761510bdab55839f",()=>g.transferActiveCall,"405c57a8fed352b8679525b56014eb8c49105c850c",()=>m.getCompanyDomainsHealth,"406864ae05b8b51c66cc2c335999e5011a41cb521f",()=>g.searchPhoneNumbers,"406f6624261c6dd1a908026fa1408a3f6d507b6e7d",()=>e.canDeleteTeamMember,"406fa38ca6dc131deb6b17173761702aef956ef128",()=>y.togglePinBoardPostPin,"40704f0e856ad801ef93b43436f219a36f7c0efd2c",()=>f.getPayrixMerchantAccount,"40787b1598849126560f9f0b0f8fe8967338c7bf28",()=>o.getCompanyEmailProvider,"407a5a7d0a7dd7989a963eb2485a3527c1dcb20a70",()=>n.getCompanyActiveDomain,"4081009dd4dff14ff4ece62648bad23a83f2f9f63c",()=>t.updateUserStatus,"4082b52123c24a95685a53c36313418a95c259c65b",()=>w.deleteCustomer,"4087f0badccd6aaf6a28b640ab4bbc513f0832d105",()=>j.submitAutomatedVerification,"4094cf679b4a10ca0f969f4fc1b55602aac4e0fbc3",()=>q.markAsRead,"4097c3c574342661f9a3c8244961d001234449f36f",()=>s.switchCompany,"40ad037af6f6ab1a3004746d3a1b65afa65527002d",()=>m.processResendWebhookEvent,"40ae25402a089e45aa071d979e8cc6ad136205cc98",()=>j.registerCompanyFor10DLC,"40af86a915f04df8d7cc189fe26e45e0cc24663080",()=>n.checkRateLimit,"40b2df540ec465c5dc19545c96486485bb50b5633b",()=>g.makeCall,"40beeb56302a20d27cd8ba7a0988310f855633d7e6",()=>o.getCompanyGmailTokens,"40c7885bdc4fe4cdd5f57e78579230c58088adbef4",()=>p.checkProviderAlert,"40d050abdabe2ee7293436c505c5f27b4408a2f27c",()=>g.sendTextMessage,"40d3c4ceeaee653aa257a28ed429a7fd272fa9fb66",()=>p.cleanupOldEvents,"40d5cc291162e2fd61245bdb851d5e8ed609e4ed19",()=>g.stopCallRecording,"40dc77b5f9ca3202fa201ef81720e3cbace41ac8bc",()=>y.createPinBoardPost,"40dde340a1ab28fdc9de8160ea41491ef22c26d9c8",()=>y.uploadPinBoardFile,"40e06418f4b93b40c84a25511e0468e1e8a41ddecf",()=>p.recordProviderEvent,"40e9589cb639f2902eb841bedc1247d966486d6fd7",()=>v.getCompanyPendingActions,"40ecf2c792e84ef4b898fda98ec27277b4a9dddef2",()=>m.generateDeliverabilityReport,"40edd91786b2a482e617fb16f2474d26ec295435e7",()=>g.sendMMSMessage,"40f19de32ea7cf4c1fadaf0575d8264a11b2ac7b27",()=>y.deletePinBoardPost,"40f8c061cf84f884e77af3425bc24b8a8d72f598fb",()=>l.sendEmail,"40fab1894acc5e3d1fdd8d8c6128a7cecee06e7e6a",()=>q.deleteNotification,"40fd6a80b32792fab749933f98f07503d8e94c0305",()=>g.purchasePhoneNumber,"6013add076e3eaed7dc37e8b800ce977d5abb8d49a",()=>w.getCustomerByPhone,"60193685409a9d118f1b364e14ecf57d05fa5638a9",()=>w.searchCustomers,"6029f52d809220cbbca9b0eaa5cdbe24cbbc04f0bd",()=>y.addPinBoardAttachment,"602e89ae7ace85fc30cd3b4b1dd865d517c0cb1cd5",()=>x.approveSupportSessionRequest,"602fab67313b110e6ccb66e54b1e16450b2a772cc7",()=>o.refreshUserGmailToken,"60302947fc4caffa53a719728f3c2cebace926098c",()=>o.sendCompanyGmailEmail,"603643b13bf288cc628303bb4d12df0311b11434c7",()=>o.syncUserInbox,"6045f8436f9cdfdadb7bfe3955677adfc5f4102de0",()=>l.handleComplaintWebhook,"606753f8910b46d5792f4bdeb457cdf29d1a8bbadc",()=>i.ensureMessagingBranding,"607d0f958daf66b2a0d5277cdda17600dace5156bb",()=>g.deleteCallRoutingRule,"60853f1e409364f7e171e27229217994ff224414e6",()=>g.toggleCallRoutingRule,"60856182db5eaec7f85eda2a5a94c5d7d3524325d6",()=>o.checkCompanyGmailHealth,"60886af124323873afd4d5b64bb4143abbcba2c154",()=>x.rejectSupportSessionRequest,"60c643a41ce1a8e6cc8338da6e2f3678c386910460",()=>p.getProviderStats,"60d423f9bdf26d134c4870cbc58040a267b22ce261",()=>y.updatePinBoardPost,"60eeb51685ac265a4ad793a230a515fe6e462f16f4",()=>o.refreshCompanyGmailToken,"708daa303e36e37247e22b5b828b6aad8c73ac283b",()=>o.fetchUserInbox,"70a648f43fa62ae3dcf2070eb90413e96e81591e77",()=>i.ensureMessagingCampaign,"70dd3bc4222a87350dc137fa9cbcb849fa1913b397",()=>o.setCompanyEmailProvider,"70f58c5ba46ef02b620d7dc87bae8fc83f6d480755",()=>k.sendVerificationSubmittedEmail,"78255c3fa8c9facf7c3f353202f2907836e8eb5539",()=>p.recordSendFailure,"783861d25688b32ba086bbe9e45444975c36a1b285",()=>p.recordSendSuccess,"78766431b437b16f7cb00b4d64a2f3be5e092ed724",()=>p.recordFallbackTriggered,"78a8ea4f1cfa571a366adccf36ac04b1c85d61ae2b",()=>l.handleBounceWebhook,"78d41ef818e75fef94d65a87ea1f0faf418132e3c5",()=>o.storeGmailMessage,"7e3a356960ddd52a3fa4dc6d981ae7202a59eb9a3d",()=>o.storeUserGmailTokens,"7f06df826c4fff42950e712c0f548254e275be2a52",()=>o.storeCompanyGmailTokens]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=apps_web_813d27fe._.js.map