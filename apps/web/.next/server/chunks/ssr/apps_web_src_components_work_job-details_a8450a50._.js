module.exports=[47176,a=>{"use strict";a.i(861467),a.i(90083);var b=a.i(587969),c=a.i(96250);a.i(624126);var d=a.i(274956),e=a.i(319895);a.i(352770);var f=a.i(781157),g=a.i(334838);a.i(739044);var h=a.i(300298);function i(){return null}a.i(783281),a.i(288007),a.i(986990),a.i(445255),a.i(18170),a.i(839984),a.i(372712),a.i(897346),a.i(75892),e.FileText,b.Calendar,g.Play,f.Pause,c.CheckCircle2,h.X,e.FileText,d.DollarSign,a.s(["JobHelpFooter",()=>i])},879143,a=>{"use strict";var b=a.i(861467),c=a.i(89626),d=a.i(97997),e=a.i(263758),f=a.i(587969),g=a.i(572863),h=a.i(253520),i=a.i(337850),j=a.i(274956),k=a.i(187056),l=a.i(984270),m=a.i(319895),n=a.i(332284),o=a.i(4229),p=a.i(789815),q=a.i(824124),r=a.i(128952),s=a.i(949747),t=a.i(898062),u=a.i(638727),v=a.i(757844),w=a.i(232553),x=a.i(966183),y=a.i(283753),z=a.i(334044),A=a.i(414379),B=a.i(597635),C=a.i(320091),D=a.i(101482),E=a.i(362841),F=a.i(145679),G=a.i(337241),H=a.i(783281),I=a.i(761447),J=a.i(860600),K=a.i(2130),L=a.i(816461),M=a.i(740423),N=a.i(169021),O=(0,N.createServerReference)("408e80b3cde6acbbf52029b5b34cf969f275e65d9d",N.callServer,void 0,N.findSourceMapURL,"findOrCreateProperty"),P=(0,N.createServerReference)("408f899c6c9ae9bf0d3ddd5dc5f59d9eb034eefefe",N.callServer,void 0,N.findSourceMapURL,"assignTeamMemberToJob"),Q=(0,N.createServerReference)("40bc97e60829c913eadb2dcb8c0210e5703090afdf",N.callServer,void 0,N.findSourceMapURL,"removeTeamMemberFromJob"),R=a.i(739044),S=a.i(179329);a.i(445255);var T=a.i(18170);a.i(19256);var U=a.i(417132);a.i(40744);var V=a.i(419573),W=a.i(382281);a.i(897346);var X=a.i(75892),Y=a.i(251048);function Z({open:a,onOpenChange:c,customerName:d,customerPhone:e,customerId:f,companyId:g,companyPhones:h=[],jobId:i,propertyId:j,invoiceId:k,estimateId:l,onCommunicationCreated:m}){let{toast:n}=(0,Y.useToast)(),[o,p]=(0,H.useTransition)(),[q,s]=(0,H.useState)(""),[t,u]=(0,H.useState)(h[0]?.number||""),v=q.length,w=v<=160?+(v>0):Math.ceil(v/153);return(0,b.jsx)(U.Dialog,{onOpenChange:c,open:a,children:(0,b.jsxs)(U.DialogContent,{className:"sm:max-w-lg",children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsxs)(U.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(r.MessageSquare,{className:"size-5"}),"Send Text Message"]}),(0,b.jsxs)(U.DialogDescription,{children:["Send an SMS message to ",d]})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsx)("div",{className:"bg-muted/50 rounded-lg border p-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"bg-primary/10 text-primary flex size-10 items-center justify-center rounded-full text-sm font-semibold",children:d.split(" ").map(a=>a[0]).join("").toUpperCase()}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:d}),(0,b.jsx)("div",{className:"text-muted-foreground text-xs",children:e})]})]})}),h.length>0?(0,b.jsx)(W.StandardFormField,{label:"Send From",htmlFor:"sms-from",children:(0,b.jsxs)(V.Select,{onValueChange:u,value:t,children:[(0,b.jsx)(V.SelectTrigger,{id:"sms-from",children:(0,b.jsx)(V.SelectValue,{placeholder:"Select a phone number"})}),(0,b.jsx)(V.SelectContent,{children:h.map(a=>(0,b.jsx)(V.SelectItem,{value:a.number,children:a.label||a.number},a.id))})]})}):(0,b.jsxs)("div",{className:"border-warning bg-warning dark:border-warning dark:bg-warning rounded-lg border p-4 text-center",children:[(0,b.jsx)("p",{className:"text-warning dark:text-warning text-sm",children:"No company phone numbers configured."}),(0,b.jsx)("p",{className:"text-warning dark:text-warning mt-1 text-xs",children:"Purchase or port a phone number from Settings → Phone Numbers"})]}),(0,b.jsxs)(W.StandardFormField,{label:"Message",htmlFor:"sms-message",children:[(0,b.jsx)(X.Textarea,{id:"sms-message",className:"min-h-[120px] resize-y",onChange:a=>s(a.target.value),placeholder:"Type your message here...",value:q}),(0,b.jsxs)("div",{className:"text-muted-foreground flex items-center justify-between text-xs",children:[(0,b.jsxs)("span",{children:[v," characters"]}),(0,b.jsxs)("span",{className:w>1?"text-amber-500":"",children:[w," SMS segment",1!==w?"s":""]})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(T.Button,{disabled:o,onClick:()=>c(!1),variant:"outline",children:"Cancel"}),(0,b.jsxs)(T.Button,{disabled:o||!q.trim()||!t||0===h.length,onClick:()=>{q.trim()?t?p(async()=>{let a=await (0,S.sendTextMessage)({to:e,from:t,text:q,companyId:g,customerId:f,jobId:i,propertyId:j,invoiceId:k,estimateId:l});a.success&&"data"in a&&a.data?(n.success(`Text message sent to ${d}`),m?.(a.data),s(""),c(!1)):n.error(a.error||"Failed to send text message")}):n.error("Please select a company phone number to send from"):n.error("Please enter a message to send")},children:[(0,b.jsx)(R.Send,{className:"mr-2 size-4"}),0===h.length?"No Phone Numbers":"Send Message"]})]})]})})}var $=a.i(836994),_=a.i(770735),aa=a.i(949729);a.i(400355);var ab=a.i(694340);a.i(516775);var ac=a.i(560272);a.i(288007);var ad=a.i(986990);a.i(919381);var ae=a.i(662143);a.i(839984);var af=a.i(372712);a.i(297229);var ag=a.i(489904);a.i(146697);var ah=a.i(778737);a.i(129112);var ai=a.i(256003);a.i(897618);var aj=a.i(709929);a.i(476036);var ak=a.i(930514),al=a.i(151183);a.i(685272);var am=a.i(692569),an=a.i(571135),ao=a.i(132440),ap=a.i(700760),aq=(0,N.createServerReference)("40df181f2aa3e0769d3e7da5a87fb03c360b1659f1",N.callServer,void 0,N.findSourceMapURL,"getCustomerProperties"),ar=(0,N.createServerReference)("407903e35c92a73720ba1d8412141271ed3380a794",N.callServer,void 0,N.findSourceMapURL,"searchCustomersForJob"),as=a.i(90083),at=a.i(624126),au=a.i(480298),av=a.i(688014),aw=a.i(821278);a.i(857463);var ax=a.i(161367),ay=a.i(792268);function az({job:a,customer:c,property:e,metrics:f,teamAssignments:g,timeEntries:i,invoices:k,payments:l,estimates:m,userRole:n="owner",onTitleChange:o,onSave:p,onCancel:q,isSaving:r=!1,hasChanges:s=!1}){var t;let[u,v]=(0,H.useState)([]);return(0,H.useEffect)(()=>{v(function(a){let{job:c,customer:e,metrics:f,teamAssignments:g,timeEntries:i,invoices:k,payments:l,estimates:m,userRole:n}=a,o=[],p=new Date,q=(f.totalAmount||0)-(f.paidAmount||0),r=c.scheduled_start?new Date(c.scheduled_start):null,s=r&&r<p&&"completed"!==c.status,t=k.filter(a=>{let b=a.due_date?new Date(a.due_date):null;return b&&b<p&&"paid"!==a.status});if(s&&0===g.length){let a=Math.floor((p.getTime()-r.getTime())/36e5);o.push({type:"critical",icon:(0,b.jsx)(d.AlertCircle,{className:"h-4 w-4"}),title:`Job Overdue by ${a} hours`,message:"dispatcher"===n?`This job was scheduled ${a}h ago but no technician is assigned. Dispatch protocol requires immediate assignment for jobs overdue by more than 2 hours.`:`This job is ${a} hours overdue. Company policy requires immediate action for jobs past their scheduled time. Contact dispatch or reassign technicians.`,action:{label:"Assign Technician",onClick:()=>{let a=document.querySelector('[data-section="team-assignments"]');a?.scrollIntoView({behavior:"smooth",block:"center"})}}})}if(t.length>0&&q>0){let a=t.reduce((a,b)=>new Date(b.due_date)<new Date(a.due_date)?b:a),c=Math.floor((p.getTime()-new Date(a.due_date).getTime())/864e5);c>=30?o.push({type:"critical",icon:(0,b.jsx)(j.DollarSign,{className:"h-4 w-4"}),title:`Outstanding Balance: ${(0,ay.formatCurrency)(q)} (${c} days overdue)`,message:"owner"===n||"manager"===n?`Company policy requires escalation for accounts 30+ days past due. The balance of ${(0,ay.formatCurrency)(q)} has been outstanding since ${new Date(a.due_date).toLocaleDateString()}. Consider collection agency referral or payment plan negotiation.`:`This account is ${c} days past due. Per company policy, accounts over 30 days require manager approval before scheduling additional work. Contact management before proceeding.`,action:{label:"View Invoices",onClick:()=>{let a=document.querySelector('[data-section="invoices"]');a?.scrollIntoView({behavior:"smooth",block:"center"})}}}):c>=15&&o.push({type:"warning",icon:(0,b.jsx)(at.Clock,{className:"h-4 w-4"}),title:`Payment Overdue: ${(0,ay.formatCurrency)(q)} (${c} days)`,message:`Customer has an outstanding balance ${c} days past due. Company policy recommends friendly follow-up call at 15 days. Consider offering payment plan or checking if there are service quality concerns.`,action:{label:"Send Payment Reminder",onClick:()=>{}}})}let u=f.totalAmount||0;u>5e5&&0===m.length&&o.push({type:"warning",icon:(0,b.jsx)(au.Lightbulb,{className:"h-4 w-4"}),title:"High-Value Job Without Approved Estimate",message:"technician"===n?"Company policy requires written estimates for jobs over $5,000 before work begins. Ensure you have customer approval documented before proceeding with any repairs or installations.":`This is a high-value job (potential revenue ${(0,ay.formatCurrency)(u)}) with no estimate on file. Best practice is to provide detailed written estimates for all jobs exceeding $5,000 to protect both the company and customer.`,action:{label:"Create Estimate",onClick:()=>{}}});let v=100*(e?.total_revenue||0);v>1e6&&o.push({type:"success",icon:(0,b.jsx)(av.TrendingUp,{className:"h-4 w-4"}),title:`VIP Customer: ${(0,ay.formatCurrency)(v)} Lifetime Value`,message:`${e?.display_name||e?.first_name+" "+e?.last_name} is a high-value customer with ${(0,ay.formatCurrency)(v)} in total revenue. Prioritize excellent service and consider offering loyalty perks or discounts on future work.`,action:{label:"View Customer History",onClick:()=>{window.location.href=`/dashboard/customers/${e?.id}`}}});let w=i.find(a=>a.clock_in_time&&!a.clock_out_time);if(w){let a=new Date(w.clock_in_time),c=(p.getTime()-a.getTime())/36e5;o.push({type:"info",icon:(0,b.jsx)(aw.Zap,{className:"h-4 w-4"}),title:"Job In Progress",message:"technician"===n?`You've been clocked in for ${c.toFixed(1)} hours. Remember to clock out when complete and document all parts used and work performed.`:`Technician currently on-site and clocked in for ${c.toFixed(1)} hours. Real-time updates available in team tracking.`,action:{label:"View Time Entries",onClick:()=>{let a=document.querySelector('[data-section="time-entries"]');a?.scrollIntoView({behavior:"smooth",block:"center"})}}})}if(l.length>0){let a=l[0],c=new Date(a.payment_date||a.created_at),d=Math.floor((p.getTime()-c.getTime())/864e5);d<=7&&o.push({type:"success",icon:(0,b.jsx)(h.CheckCircle,{className:"h-4 w-4"}),title:"Recent Payment Received",message:`Customer paid ${(0,ay.formatCurrency)(a.amount)} ${0===d?"today":d+" days ago"}. Account is in good standing. Consider following up to ensure satisfaction and request a review.`,action:{label:"Send Review Request",onClick:()=>{}}})}return"dispatcher"===n&&0===g.length&&"scheduled"===c.status&&o.push({type:"warning",icon:(0,b.jsx)(at.Clock,{className:"h-4 w-4"}),title:"Technician Assignment Required",message:"This job is scheduled but has no technician assigned. Dispatch protocol requires all scheduled jobs to have team assignments at least 24 hours in advance for route optimization.",action:{label:"Assign Team",onClick:()=>{let a=document.querySelector('[data-section="team-assignments"]');a?.scrollIntoView({behavior:"smooth",block:"center"})}}}),"technician"!==n||"in_progress"!==c.status||w||o.push({type:"warning",icon:(0,b.jsx)(at.Clock,{className:"h-4 w-4"}),title:"Clock-In Reminder",message:"This job is marked as 'In Progress' but you haven't clocked in yet. Company policy requires accurate time tracking for all billable hours. Please clock in before starting work.",action:{label:"Clock In Now",onClick:()=>{}}}),o}({job:a,customer:c,property:e,metrics:f,teamAssignments:g,timeEntries:i,invoices:k,payments:l,estimates:m,userRole:n}))},[a.id,a.status,a.priority,c?.id,f.totalAmount,f.paidAmount,g.length,k.length,n]),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)(af.Input,{className:"h-auto border-0 bg-transparent p-0 text-2xl font-bold tracking-tight shadow-none focus-visible:ring-0 md:text-3xl",onChange:a=>o(a.target.value),placeholder:"Enter job title...",value:a.title}),(0,b.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[(0,b.jsxs)(ad.Badge,{variant:"secondary",className:"font-mono text-xs",children:["#",a.job_number]}),(0,b.jsx)(ad.Badge,{variant:function(a){switch(a?.toLowerCase()){case"completed":case"paid":return"default";case"in_progress":case"scheduled":return"secondary";case"overdue":case"cancelled":case"urgent":return"destructive";default:return"outline"}}(a.status),className:"capitalize",children:a.status?.replace(/_/g," ")}),a.priority&&"low"!==a.priority&&(0,b.jsx)(ad.Badge,{variant:"urgent"===(t=a.priority)||"high"===t?"destructive":"outline",className:"capitalize",children:a.priority})]})]}),s&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(T.Button,{variant:"outline",size:"sm",onClick:q,children:"Cancel"}),(0,b.jsx)(T.Button,{size:"sm",onClick:p,disabled:r,children:r?"Saving...":"Save Changes"})]})]}),u.length>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ah.Separator,{}),(0,b.jsx)("div",{className:"space-y-2",children:u.map((a,c)=>(0,b.jsx)(aA,{insight:a},c))})]})]})}function aA({insight:a}){return(0,b.jsx)(ax.Alert,{variant:"critical"===a.type?"destructive":"default",className:"relative",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:`mt-0.5 shrink-0 ${(a=>{switch(a){case"critical":return"text-destructive";case"warning":return"text-yellow-600 dark:text-yellow-400";case"success":return"text-green-600 dark:text-green-400";default:return"text-blue-600 dark:text-blue-400"}})(a.type)}`,children:a.icon}),(0,b.jsxs)("div",{className:"flex-1 min-w-0 space-y-1",children:[(0,b.jsx)("div",{className:"font-semibold text-sm leading-tight",children:a.title}),(0,b.jsx)(ax.AlertDescription,{className:"text-xs leading-relaxed",children:a.message}),a.action&&(0,b.jsxs)(T.Button,{variant:"link",size:"sm",className:"h-auto p-0 text-xs gap-1",onClick:a.action.onClick,children:[a.action.label,(0,b.jsx)(as.ArrowRight,{className:"h-3 w-3"})]})]})]})})}var aB=a.i(638446),aC=a.i(300298),aD=a.i(75618),aE=(0,N.createServerReference)("40e9803ebaeabdd8b04052b6c8ee82a0faeea4b5e9",N.callServer,void 0,N.findSourceMapURL,"uploadDocument");let aF={"image/jpeg":[".jpg",".jpeg"],"image/png":[".png"],"image/heic":[".heic"],"image/heif":[".heif"],"image/webp":[".webp"],"image/gif":[".gif"],"image/bmp":[".bmp"],"image/tiff":[".tiff",".tif"],"application/pdf":[".pdf"],"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"application/vnd.ms-excel":[".xls"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"text/plain":[".txt"],"text/csv":[".csv"]};function aG({jobId:a,companyId:c,onUploadComplete:d,onCancel:e}){let{toast:f}=(0,Y.useToast)(),[h,i]=(0,H.useState)([]),[j,k]=(0,H.useState)(!1),[l,n]=(0,H.useState)(0),o=()=>Math.random().toString(36).substring(2,15),p=a=>a.startsWith("image/"),q=a=>{let b=a.type;return Object.keys(aF).includes(b)?a.size>0x6400000?`${a.name}: Too large (max 100MB)`:null:`${a.name}: Unsupported file type`},r=(0,H.useCallback)(a=>{if(!a)return;let b=[],c=[];Array.from(a).forEach(a=>{let d=q(a);if(d)return void c.push(d);let e=URL.createObjectURL(a),f=!p(a.type);b.push({id:o(),file:a,preview:e,category:"other",caption:"",isDocument:f})}),c.length>0&&f.error(`Some files couldn't be added: ${c.join(", ")}`),i(a=>[...a,...b])},[f,o,p,q]),s=a=>{i(b=>{let c=b.find(b=>b.id===a);return c&&URL.revokeObjectURL(c.preview),b.filter(b=>b.id!==a)})},t=async()=>{if(0!==h.length){k(!0),n(0);try{let b=0,g=0;for(let d=0;d<h.length;d++){let e=h[d];try{let d=new FormData;d.append("file",e.file),d.append("companyId",c),d.append("contextType","job"),d.append("contextId",a),e.isDocument?d.append("folder","documents"):d.append("folder","photos"),e.caption&&d.append("description",e.caption),e.category&&d.append("tags",JSON.stringify([e.category]));let h=await aE(d);if(h?.success)b++;else{g++;let a=h?.error||"Unknown error";a.includes("Access denied")?f.error(`Access denied for ${e.file.name}. Please verify you have permission to upload files to this job.`):a.includes("Storage upload failed")?f.error(`Storage error for ${e.file.name}. The file may be too large or the storage service is unavailable.`):f.error(`Failed to upload ${e.file.name}: ${a}`)}}catch(b){g++;let a=b instanceof Error?b.message:String(b);a.includes("unexpected response")?f.error(`Server error uploading ${e.file.name}. Please try again or contact support if the problem persists.`):f.error(`Error uploading ${e.file.name}: ${a}`)}n(Math.round((d+1)/h.length*100))}b>0&&f.success(`Successfully uploaded ${b} ${1===b?"file":"files"}${g>0?` (${g} failed)`:""}`),g>0&&0===b&&f.error("All uploads failed. Please check your permissions and try again."),h.forEach(a=>URL.revokeObjectURL(a.preview)),i([]),d&&d(),e&&setTimeout(()=>e(),100)}catch(b){let a=b instanceof Error?b.message:"Failed to upload files";f.error(a)}finally{k(!1),n(0)}}};return(0,b.jsxs)("div",{className:"bg-muted/30 space-y-3 rounded-lg border p-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("input",{accept:Object.values(aF).flat().join(","),className:"absolute inset-0 cursor-pointer opacity-0",id:"inline-file-upload",multiple:!0,onChange:a=>{r(a.target.files),a.target.value=""},type:"file"}),(0,b.jsxs)("div",{className:"border-muted-foreground/25 bg-background hover:border-muted-foreground/50 flex items-center gap-3 rounded-md border-2 border-dashed p-3",children:[(0,b.jsxs)("div",{className:"flex gap-1",children:[(0,b.jsx)("div",{className:"bg-primary/10 flex size-8 items-center justify-center rounded",children:(0,b.jsx)(g.Camera,{className:"text-primary size-4"})}),(0,b.jsx)("div",{className:"bg-primary/10 flex size-8 items-center justify-center rounded",children:(0,b.jsx)(m.FileText,{className:"text-primary size-4"})})]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Click or drag files here"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Images & documents up to 100MB"})]}),(0,b.jsx)(B.Upload,{className:"text-muted-foreground size-5"})]})]}),h.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-sm font-medium",children:[h.length," file",1!==h.length?"s":""," selected"]}),(0,b.jsx)(T.Button,{onClick:()=>h.forEach(a=>s(a.id)),size:"sm",variant:"ghost",children:"Clear all"})]}),(0,b.jsx)("div",{className:"grid gap-2",children:h.map(a=>{var c;return(0,b.jsxs)("div",{className:"bg-background flex items-center gap-3 rounded-md border p-2",children:[(0,b.jsx)("div",{className:"bg-muted relative size-12 shrink-0 overflow-hidden rounded",children:a.isDocument?(0,b.jsx)("div",{className:"flex size-full items-center justify-center",children:(0,b.jsx)(m.FileText,{className:"text-muted-foreground size-6"})}):(0,b.jsx)(aD.default,{alt:a.file.name,className:"object-cover",fill:!0,src:a.preview})}),(0,b.jsxs)("div",{className:"flex min-w-0 flex-1 items-center gap-2",children:[(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"truncate text-sm font-medium",children:a.file.name}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:(c=a.file.size)<1024?`${c} B`:c<1048576?`${(c/1024).toFixed(1)} KB`:`${(c/1048576).toFixed(1)} MB`})]}),(0,b.jsxs)(V.Select,{onValueChange:b=>{var c;return c=a.id,void i(a=>a.map(a=>a.id===c?{...a,category:b}:a))},value:a.category,children:[(0,b.jsx)(V.SelectTrigger,{className:"h-7 w-24 text-xs",children:(0,b.jsx)(V.SelectValue,{})}),(0,b.jsxs)(V.SelectContent,{children:[(0,b.jsx)(V.SelectItem,{value:"before",children:"Before"}),(0,b.jsx)(V.SelectItem,{value:"during",children:"During"}),(0,b.jsx)(V.SelectItem,{value:"after",children:"After"}),(0,b.jsx)(V.SelectItem,{value:"other",children:"Other"})]})]}),(0,b.jsx)(af.Input,{className:"h-7 w-32 text-xs",onChange:b=>{var c,d;return c=a.id,d=b.target.value,void i(a=>a.map(a=>a.id===c?{...a,caption:d}:a))},placeholder:"Caption",value:a.caption}),(0,b.jsx)(T.Button,{className:"size-7 p-0",onClick:()=>s(a.id),size:"sm",variant:"ghost",children:(0,b.jsx)(aC.X,{className:"size-4"})})]})]},a.id)})}),j&&(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Uploading..."}),(0,b.jsxs)("span",{className:"font-medium",children:[l,"%"]})]}),(0,b.jsx)("div",{className:"bg-muted h-1.5 overflow-hidden rounded-full",children:(0,b.jsx)("div",{className:"bg-primary h-full transition-all duration-300",style:{width:`${l}%`}})})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(T.Button,{disabled:j,onClick:e,size:"sm",variant:"outline",children:"Cancel"}),(0,b.jsx)(T.Button,{disabled:0===h.length||j,onClick:t,size:"sm",children:j?(0,b.jsx)(b.Fragment,{children:"Uploading..."}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aB.Check,{className:"mr-1 size-4"}),"Upload ",h.length," ",1===h.length?"File":"Files"]})})]})]})]})}var aH=a.i(854729),aI=a.i(50900);function aJ({activities:a}){let[d,e]=(0,H.useState)(""),[f,g]=(0,H.useState)(1),h=(0,H.useMemo)(()=>{let b=[...a];if(d.trim()){let a=d.toLowerCase();b=b.filter(b=>b.description?.toLowerCase().includes(a)||b.activity_type?.toLowerCase().includes(a)||b.entity_type?.toLowerCase().includes(a)||b.metadata?.estimate_number?.toLowerCase().includes(a)||b.metadata?.invoice_number?.toLowerCase().includes(a))}return b.sort((a,b)=>new Date(b.created_at).getTime()-new Date(a.created_at).getTime()),b},[a,d]),j=(0,H.useMemo)(()=>{let a=(f-1)*10;return h.slice(a,a+10)},[h,f]),k=Math.ceil(h.length/10);return(0,b.jsxs)("div",{children:[a.length>5&&(0,b.jsx)("div",{className:"border-b p-3",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(aI.Search,{className:"text-muted-foreground absolute top-1/2 left-3 size-4 -translate-y-1/2"}),(0,b.jsx)(af.Input,{className:"pl-9",onChange:a=>{e(a.target.value),g(1)},placeholder:"Search activities...",value:d})]})}),(0,b.jsx)("div",{className:"divide-y",children:j.length>0?j.map(a=>{let d=Array.isArray(a.user)?a.user[0]:a.user,e=d?{name:d.raw_user_meta_data?.name||d.name||"Unknown User",email:d.raw_user_meta_data?.email||d.email,avatar:d.raw_user_meta_data?.avatar_url||d.avatar}:null,f=a.activity_type||"general",g=a.entity_type,h=a.metadata||{},j={created:{icon:(0,b.jsx)(y.Sparkles,{className:"size-3"}),iconColor:"text-emerald-600 dark:text-emerald-400",borderColor:"border-l-emerald-500",label:"Created"},sent:{icon:(0,b.jsx)(p.Mail,{className:"size-3"}),iconColor:"text-blue-600 dark:text-blue-400",borderColor:"border-l-blue-500",label:"Sent"},viewed:{icon:(0,b.jsx)(aH.Eye,{className:"size-3"}),iconColor:"text-purple-600 dark:text-purple-400",borderColor:"border-l-purple-500",label:"Viewed"},status_changed:{icon:(0,b.jsx)(c.Activity,{className:"size-3"}),iconColor:"text-orange-600 dark:text-orange-400",borderColor:"border-l-orange-500",label:"Status Changed"},note_added:{icon:(0,b.jsx)(r.MessageSquare,{className:"size-3"}),iconColor:"text-cyan-600 dark:text-cyan-400",borderColor:"border-l-cyan-500",label:"Note Added"},assigned:{icon:(0,b.jsx)(C.User,{className:"size-3"}),iconColor:"text-indigo-600 dark:text-indigo-400",borderColor:"border-l-indigo-500",label:"Assigned"}}[f]||{icon:(0,b.jsx)(c.Activity,{className:"size-3"}),iconColor:"text-gray-600 dark:text-gray-400",borderColor:"border-l-gray-500",label:f.replace(/_/g," ")};return(0,b.jsxs)("div",{className:(0,ap.cn)("hover:bg-muted/30 flex gap-3 border-l-2 px-4 py-2.5 transition-colors",j.borderColor),children:[(0,b.jsx)("div",{className:(0,ap.cn)("bg-muted flex size-7 shrink-0 items-center justify-center rounded-full",j.iconColor),children:j.icon}),(0,b.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col gap-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,b.jsx)(ad.Badge,{className:"text-xs",variant:"outline",children:j.label}),g&&(0,b.jsx)(ad.Badge,{className:"text-xs",variant:"secondary",children:g}),h.estimate_number&&(0,b.jsx)(ad.Badge,{className:"font-mono text-xs",variant:"outline",children:h.estimate_number}),h.invoice_number&&(0,b.jsx)(ad.Badge,{className:"font-mono text-xs",variant:"outline",children:h.invoice_number}),e?.name&&(0,b.jsxs)("div",{className:"text-muted-foreground flex items-center gap-1 text-xs",children:[(0,b.jsxs)(ac.Avatar,{className:"size-4",children:[(0,b.jsx)(ac.AvatarImage,{src:e.avatar}),(0,b.jsx)(ac.AvatarFallback,{className:"text-[8px]",children:e.name.substring(0,2).toUpperCase()})]}),(0,b.jsx)("span",{children:e.name})]})]}),(0,b.jsx)("time",{className:"text-muted-foreground shrink-0 text-xs",children:new Date(a.created_at).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})]}),(0,b.jsx)("p",{className:"text-sm leading-snug",children:a.description||"Activity logged"}),(h.amount||h.old_status||h.email||h.method)&&(0,b.jsxs)("div",{className:"text-muted-foreground flex flex-wrap gap-3 text-xs",children:[h.amount&&(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(v.Receipt,{className:"size-3"}),"$",(h.amount/100).toFixed(2)]}),h.old_status&&h.new_status&&(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(i.ChevronRight,{className:"size-3"}),h.old_status," → ",h.new_status]}),h.email&&(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(p.Mail,{className:"size-3"}),h.email]}),h.method&&(0,b.jsxs)("span",{className:"flex items-center gap-1",children:["via ",h.method]})]})]})]},a.id)}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,b.jsx)("div",{className:"bg-muted mx-auto mb-4 flex size-12 items-center justify-center rounded-full",children:(0,b.jsx)(c.Activity,{className:"text-muted-foreground size-6"})}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:d?"No activities match your search":"No activity yet"})]})}),k>1&&(0,b.jsxs)("div",{className:"flex items-center justify-between border-t px-4 py-3",children:[(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Showing ",(f-1)*10+1,"-",Math.min(10*f,h.length)," ","of ",h.length," activities"]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(T.Button,{disabled:1===f,onClick:()=>g(a=>Math.max(1,a-1)),size:"sm",variant:"outline",children:"Previous"}),(0,b.jsx)(T.Button,{disabled:f===k,onClick:()=>g(a=>Math.min(k,a+1)),size:"sm",variant:"outline",children:"Next"})]})]})]})}var aK=a.i(349669);a.i(156120);var aL=a.i(678532);function aM({appointment:a,showExpanded:c=!1}){let d=new Date(a.start_time),e=new Date(a.end_time),f=a=>a.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),g=Array.isArray(a.assigned_user)?a.assigned_user[0]:a.assigned_user,h=a.team_members&&a.team_members.length>0,i=a.equipment&&a.equipment.length>0,j=a.notes||a.access_instructions,k=a.actual_start_time||a.actual_end_time,l=h||i||j||k;return(0,b.jsx)(aL.ExpandableRow,{defaultExpanded:c,details:l?(0,b.jsxs)("div",{className:"divide-y",children:[h&&(0,b.jsx)(aL.ExpandableRowSection,{icon:(0,b.jsx)(D.Users,{className:"size-4"}),title:"Team Members",children:(0,b.jsx)("div",{className:"space-y-2",children:a.team_members?.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-3 rounded-md border p-2",children:[(0,b.jsxs)(ac.Avatar,{className:"size-8",children:[(0,b.jsx)(ac.AvatarImage,{src:a.avatar}),(0,b.jsx)(ac.AvatarFallback,{className:"text-xs",children:a.name.substring(0,2).toUpperCase()})]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"text-foreground text-sm font-medium",children:a.name}),a.role&&(0,b.jsx)("div",{className:"text-muted-foreground text-xs",children:a.role})]}),a.email&&(0,b.jsx)(F.default,{className:"text-primary text-xs hover:underline",href:`mailto:${a.email}`,children:a.email})]},a.id))})}),i&&(0,b.jsx)(aL.ExpandableRowSection,{icon:(0,b.jsx)(E.Wrench,{className:"size-4"}),title:"Equipment",children:(0,b.jsx)("div",{className:"space-y-2",children:a.equipment?.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-md border p-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(E.Wrench,{className:"text-muted-foreground size-4"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-foreground text-sm font-medium",children:a.name}),a.serial_number&&(0,b.jsxs)("div",{className:"text-muted-foreground font-mono text-xs",children:["SN: ",a.serial_number]})]})]}),a.type&&(0,b.jsx)(ad.Badge,{variant:"outline",children:a.type})]},a.id))})}),k&&(0,b.jsx)(aL.ExpandableRowSection,{icon:(0,b.jsx)(at.Clock,{className:"size-4"}),title:"Time Tracking",children:(0,b.jsxs)("div",{className:"grid gap-2 text-sm sm:grid-cols-2",children:[a.actual_start_time&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Actual Start:"})," ",(0,b.jsx)("span",{className:"font-medium",children:new Date(a.actual_start_time).toLocaleString()})]}),a.actual_end_time&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Actual End:"})," ",(0,b.jsx)("span",{className:"font-medium",children:new Date(a.actual_end_time).toLocaleString()})]}),a.actual_duration&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Actual Duration:"})," ",(0,b.jsxs)("span",{className:"font-medium",children:[a.actual_duration," min"]})]}),a.duration&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Estimated Duration:"})," ",(0,b.jsxs)("span",{className:"font-medium",children:[a.duration," min"]})]})]})}),j&&(0,b.jsxs)(aL.ExpandableRowSection,{icon:(0,b.jsx)(m.FileText,{className:"size-4"}),title:"Notes & Instructions",children:[a.access_instructions&&(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsxs)("div",{className:"mb-1 flex items-center gap-2 text-xs font-medium",children:[(0,b.jsx)(q.MapPin,{className:"size-3"}),"Access Instructions"]}),(0,b.jsx)("p",{className:"bg-muted/50 rounded-md border p-2 text-xs whitespace-pre-wrap",children:a.access_instructions})]}),a.notes&&(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"mb-1 text-xs font-medium",children:"Internal Notes"}),(0,b.jsx)("p",{className:"bg-muted/50 rounded-md border p-2 text-xs whitespace-pre-wrap",children:a.notes})]})]})]}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,b.jsx)(m.FileText,{className:"text-muted-foreground mb-2 size-8"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No additional details available"})]}),disabled:!l,showIndicator:l,summary:(0,b.jsxs)("div",{className:"flex flex-1 items-center gap-4 py-3 pr-4",children:[(0,b.jsxs)("div",{className:"flex w-32 shrink-0 flex-col",children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:d.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),(0,b.jsxs)("div",{className:"text-muted-foreground text-xs",children:[f(d)," - ",f(e)]})]}),(0,b.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,b.jsx)("div",{className:"truncate text-sm font-medium",children:a.title||"Untitled Appointment"}),a.type&&(0,b.jsx)("div",{className:"text-muted-foreground truncate text-xs",children:a.type})]}),g&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(ac.Avatar,{className:"size-6",children:[(0,b.jsx)(ac.AvatarImage,{src:g.avatar}),(0,b.jsx)(ac.AvatarFallback,{className:"text-[10px]",children:g.name.substring(0,2).toUpperCase()})]}),(0,b.jsx)("span",{className:"text-muted-foreground hidden text-xs sm:inline",children:g.name})]}),a.status&&(0,b.jsx)(ad.Badge,{className:(0,ap.cn)("h-6 shrink-0 rounded-full px-3 text-xs capitalize",(a=>{switch(a?.toLowerCase()){case"completed":return"bg-green-500/10 text-green-700 dark:text-green-400";case"in_progress":return"bg-blue-500/10 text-blue-700 dark:text-blue-400";case"scheduled":return"bg-purple-500/10 text-purple-700 dark:text-purple-400";case"cancelled":return"bg-red-500/10 text-red-700 dark:text-red-400";default:return"bg-gray-500/10 text-gray-700 dark:text-gray-400"}})(a.status)),variant:"secondary",children:a.status.replace(/_/g," ")}),l&&(0,b.jsxs)("div",{className:"text-muted-foreground flex shrink-0 items-center gap-1 text-xs",children:[h&&(0,b.jsxs)(ad.Badge,{className:"h-5 px-1.5",variant:"outline",children:[(0,b.jsx)(D.Users,{className:"mr-1 size-3"}),a.team_members?.length]}),i&&(0,b.jsxs)(ad.Badge,{className:"h-5 px-1.5",variant:"outline",children:[(0,b.jsx)(E.Wrench,{className:"mr-1 size-3"}),a.equipment?.length]})]})]})})}function aN({appointments:a}){let[c,d]=(0,H.useState)(""),[e,g]=(0,H.useState)("all"),h=(0,H.useMemo)(()=>Array.from(new Set(a.map(a=>a.status).filter(Boolean))),[a]),i=(0,H.useMemo)(()=>{let b=a;if(c.trim()){let a=c.toLowerCase();b=b.filter(b=>{let c=Array.isArray(b.assigned_user)?b.assigned_user[0]:b.assigned_user;return b.title?.toLowerCase().includes(a)||b.type?.toLowerCase().includes(a)||b.description?.toLowerCase().includes(a)||c?.name.toLowerCase().includes(a)})}return"all"!==e&&(b=b.filter(a=>a.status===e)),b.sort((a,b)=>new Date(b.start_time).getTime()-new Date(a.start_time).getTime()),b},[a,c,e]);return(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsxs)("div",{className:"bg-background sticky top-0 z-10 flex flex-wrap items-center gap-2 border-b p-3",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(aI.Search,{className:"text-muted-foreground absolute top-1/2 left-3 size-4 -translate-y-1/2"}),(0,b.jsx)(af.Input,{className:"h-9 pl-9",onChange:a=>d(a.target.value),placeholder:"Search appointments...",value:c})]}),(0,b.jsxs)(V.Select,{onValueChange:g,value:e,children:[(0,b.jsxs)(V.SelectTrigger,{className:"h-9 w-[160px]",children:[(0,b.jsx)(aK.Filter,{className:"mr-2 size-4"}),(0,b.jsx)(V.SelectValue,{placeholder:"All Statuses"})]}),(0,b.jsxs)(V.SelectContent,{children:[(0,b.jsx)(V.SelectItem,{value:"all",children:"All Statuses"}),h.map(a=>(0,b.jsx)(V.SelectItem,{value:a||"",children:a?.replace(/_/g," ")},a))]})]}),(0,b.jsxs)(ad.Badge,{className:"h-9 px-3",variant:"outline",children:[i.length," of ",a.length]})]}),(0,b.jsx)("div",{className:"divide-y",children:i.length>0?i.map(a=>(0,b.jsx)(aM,{appointment:a},a.id)):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,b.jsx)(f.Calendar,{className:"text-muted-foreground mb-3 size-12"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:c||"all"!==e?"No appointments match your filters":"No appointments scheduled"}),(c||"all"!==e)&&(0,b.jsx)(T.Button,{className:"mt-3",onClick:()=>{d(""),g("all")},size:"sm",variant:"outline",children:"Clear Filters"})]})})]})}var aO=a.i(858781),aP=a.i(58772),aP=aP;a.i(956852);var aQ=a.i(90125);function aR({currentCustomer:a,currentProperty:c,onAssignCustomer:d,onRemoveCustomer:e,onRemoveProperty:f,searchCustomers:g,getCustomerProperties:h}){let[j,k]=(0,H.useState)(!1),[l,m]=(0,H.useState)(""),[n,o]=(0,H.useState)(!1),[p,r]=(0,H.useState)([]),[s,t]=(0,H.useState)(null),[u,v]=(0,H.useState)([]),[w,x]=(0,H.useState)(null),[y,z]=(0,H.useState)(!1),[A,B]=(0,H.useState)(!1),[D,E]=(0,H.useState)(!1),[G,I]=(0,H.useState)(!1);(0,H.useEffect)(()=>{if(!l||l.length<2)return void r([]);let a=setTimeout(async()=>{o(!0);try{let a=await g(l);r(a)}catch(a){console.error("Error searching customers:",a),r([])}finally{o(!1)}},300);return()=>clearTimeout(a)},[l,g]),(0,H.useEffect)(()=>{if(!s){v([]),x(null);return}!async function(){z(!0);try{let a=await h(s.id);v(a),1===a.length&&x(a[0])}catch(a){console.error("Error loading properties:",a),v([])}finally{z(!1)}}()},[s,h]);let J=a=>a.company_name?`${a.display_name} (${a.company_name})`:a.display_name,K=async()=>{if(s){I(!0);try{await d(s,w),k(!1),t(null),x(null),m("")}catch(a){console.error("Error assigning customer:",a)}finally{I(!1)}}},L=async()=>{try{await e(),B(!1)}catch(a){console.error("Error removing customer:",a)}},M=async()=>{try{await f(),E(!1)}catch(a){console.error("Error removing property:",a)}},N=(0,b.jsxs)(ag.Popover,{onOpenChange:k,open:j,children:[(0,b.jsx)(ag.PopoverTrigger,{asChild:!0,children:(0,b.jsx)(T.Button,{className:(0,ap.cn)("justify-start transition-all",a?"px-3":"w-full"),size:a?"sm":"default",variant:a?"ghost":"outline",children:a?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(C.User,{className:"mr-2 size-4"}),(0,b.jsx)("span",{children:"Change"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(C.User,{className:"text-muted-foreground mr-2 size-4"}),(0,b.jsx)("span",{children:"Assign Customer & Property"}),(0,b.jsx)(aO.ChevronsUpDown,{className:"ml-auto size-4 opacity-50"})]})})}),(0,b.jsx)(ag.PopoverContent,{align:"start",className:"w-[650px] p-0 shadow-xl",children:(0,b.jsxs)("div",{className:"flex h-[550px] flex-col",children:[(0,b.jsxs)("div",{className:"bg-muted/30 border-b p-4",children:[(0,b.jsx)("h3",{className:"mb-3 text-base font-semibold",children:"Assign Customer & Property"}),(0,b.jsx)("div",{className:"space-y-2",children:(0,b.jsxs)("div",{className:"text-muted-foreground flex items-center gap-2 text-xs",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)("div",{className:"bg-primary/20 text-primary flex size-5 items-center justify-center rounded-full text-[10px] font-bold",children:"1"}),(0,b.jsx)("span",{className:(0,ap.cn)(s?"text-primary font-medium":""),children:"Select Customer"})]}),(0,b.jsx)(i.ChevronRight,{className:"size-3"}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)("div",{className:(0,ap.cn)("flex size-5 items-center justify-center rounded-full text-[10px] font-bold",s?"bg-primary/20 text-primary":"bg-muted text-muted-foreground"),children:"2"}),(0,b.jsx)("span",{className:(0,ap.cn)(s?"text-primary font-medium":"text-muted-foreground"),children:"Choose Property"})]})]})})]}),(0,b.jsx)("div",{className:"bg-background border-b p-4",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(aI.Search,{className:"text-muted-foreground absolute top-1/2 left-3 size-4 -translate-y-1/2"}),(0,b.jsx)("input",{className:"border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-11 w-full rounded-lg border px-10 py-2 text-sm transition-shadow file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",onChange:a=>m(a.target.value),placeholder:"Search by name, email, phone, company, or address...",value:l}),n&&(0,b.jsx)("div",{className:"absolute top-1/2 right-3 -translate-y-1/2",children:(0,b.jsx)("div",{className:"border-primary/30 border-t-primary size-4 animate-spin rounded-full border-2"})})]})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto",children:s?(0,b.jsx)("div",{className:"bg-primary/5 border-b p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsxs)("div",{className:"bg-primary/20 text-primary flex size-10 flex-shrink-0 items-center justify-center rounded-full text-sm font-bold",children:[s.first_name?.[0],s.last_name?.[0]]}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsxs)("div",{className:"mb-1 flex items-center gap-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold",children:J(s)}),(0,b.jsx)(aB.Check,{className:"text-primary size-4 flex-shrink-0"})]}),(0,b.jsxs)("div",{className:"text-muted-foreground space-y-0.5 text-xs",children:[s.email&&(0,b.jsx)("div",{className:"truncate",children:s.email}),s.phone&&(0,b.jsx)("div",{children:s.phone})]})]}),(0,b.jsx)(T.Button,{onClick:()=>t(null),size:"sm",variant:"ghost",children:"Change"})]})}):l.length<2?(0,b.jsxs)("div",{className:"flex h-full flex-col items-center justify-center p-8 text-center",children:[(0,b.jsx)(aI.Search,{className:"text-muted-foreground mb-3 size-10"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Type at least 2 characters to search"})]}):0!==p.length||n?(0,b.jsx)("div",{className:"divide-y",children:p.map(a=>(0,b.jsxs)("button",{className:"hover:bg-muted/50 flex w-full items-start gap-3 p-4 text-left transition-all hover:shadow-sm",onClick:()=>{t(a),m("")},type:"button",children:[(0,b.jsxs)("div",{className:"bg-muted/80 flex size-10 flex-shrink-0 items-center justify-center rounded-full text-sm font-semibold",children:[a.first_name?.[0],a.last_name?.[0]]}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsxs)("div",{className:"mb-1 flex items-center gap-2",children:[(0,b.jsx)("div",{className:"truncate text-sm font-medium",children:J(a)}),(0,b.jsx)(ad.Badge,{className:"flex-shrink-0 capitalize",variant:"outline",children:a.type})]}),(0,b.jsxs)("div",{className:"text-muted-foreground space-y-0.5 text-xs",children:[a.email&&(0,b.jsx)("div",{className:"truncate",children:a.email}),a.phone&&(0,b.jsx)("div",{children:a.phone}),a.address&&(0,b.jsxs)("div",{className:"truncate text-[11px]",children:[a.address,", ",a.city,","," ",a.state]})]})]}),(0,b.jsx)(i.ChevronRight,{className:"text-muted-foreground mt-2 size-4 flex-shrink-0"})]},a.id))}):(0,b.jsxs)("div",{className:"flex h-full flex-col items-center justify-center p-8 text-center",children:[(0,b.jsx)(C.User,{className:"text-muted-foreground mb-3 size-10"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No customers found"})]})}),s&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"bg-muted/30 border-t p-4",children:(0,b.jsx)("div",{className:"space-y-3",children:y?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(ai.Skeleton,{className:"h-16 w-full"}),(0,b.jsx)(ai.Skeleton,{className:"h-16 w-full"})]}):0===u.length?(0,b.jsxs)("div",{className:"bg-background rounded-lg border border-dashed p-6 text-center",children:[(0,b.jsx)(q.MapPin,{className:"text-muted-foreground mx-auto mb-2 size-10"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-1 text-sm font-medium",children:"No properties found"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"You can still assign this customer without a property"})]}):(0,b.jsxs)("div",{className:"max-h-[180px] space-y-2 overflow-y-auto pr-1",children:[(0,b.jsx)("p",{className:"text-muted-foreground mb-2 text-xs font-medium",children:"Select a property (optional)"}),u.map(a=>(0,b.jsxs)("button",{className:(0,ap.cn)("hover:bg-muted/80 flex w-full items-start gap-3 rounded-lg border p-3 text-left transition-all",w?.id===a.id&&"border-primary bg-primary/10 shadow-sm"),onClick:()=>x(a),type:"button",children:[(0,b.jsx)(q.MapPin,{className:(0,ap.cn)("mt-0.5 size-4 flex-shrink-0",w?.id===a.id?"text-primary":"text-muted-foreground")}),(0,b.jsxs)("div",{className:"min-w-0 flex-1 text-sm",children:[(0,b.jsx)("div",{className:"truncate font-medium",children:a.address}),a.address_line2&&(0,b.jsx)("div",{className:"text-muted-foreground truncate text-xs",children:a.address_line2}),(0,b.jsxs)("div",{className:"text-muted-foreground truncate text-xs",children:[a.city,", ",a.state," ",a.zip]})]}),w?.id===a.id&&(0,b.jsx)(aB.Check,{className:"text-primary size-4 flex-shrink-0"})]},a.id))]})})}),(0,b.jsx)("div",{className:"bg-background border-t p-4",children:(0,b.jsx)(T.Button,{className:"h-11 w-full text-base font-medium shadow-sm",disabled:G,onClick:K,size:"lg",children:G?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"mr-2 size-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"Assigning..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aB.Check,{className:"mr-2 size-5"}),"Assign to Job"]})})})]})]})})]});return(0,b.jsxs)("div",{className:"flex w-full gap-2",children:[a?(0,b.jsxs)("div",{className:"flex flex-1 gap-0",children:[(0,b.jsxs)(aQ.DropdownMenu,{children:[(0,b.jsx)(aQ.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(T.Button,{className:"flex-1 justify-start rounded-r-none border-r-0",size:"default",variant:"outline",children:[(0,b.jsx)(C.User,{className:"mr-2 size-4"}),(0,b.jsx)("span",{className:"truncate font-medium",children:J(a)}),(0,b.jsx)(i.ChevronRight,{className:"ml-auto size-4 opacity-50"})]})}),(0,b.jsxs)(aQ.DropdownMenuContent,{align:"start",className:"w-64",children:[(0,b.jsx)(aQ.DropdownMenuLabel,{className:"font-normal",children:(0,b.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium leading-none",children:J(a)}),a.type&&(0,b.jsx)(ad.Badge,{className:"mt-1 w-fit capitalize",variant:"secondary",size:"sm",children:a.type}),a.email&&(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:a.email}),a.phone&&(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:a.phone})]})}),c&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsx)(aQ.DropdownMenuLabel,{className:"font-normal",children:(0,b.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-muted-foreground",children:"Property"}),(0,b.jsx)("p",{className:"text-sm font-medium leading-none",children:c.address}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:[c.city,", ",c.state," ",c.zip]})]})})]}),(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsx)(aQ.DropdownMenuItem,{asChild:!0,children:(0,b.jsxs)(F.default,{href:`/dashboard/customers/${a.id}`,className:"cursor-pointer",children:[(0,b.jsx)(aH.Eye,{className:"mr-2 size-4"}),"View Customer Profile"]})}),c&&(0,b.jsx)(aQ.DropdownMenuItem,{asChild:!0,children:(0,b.jsxs)(F.default,{href:`/dashboard/work/properties/${c.id}`,className:"cursor-pointer",children:[(0,b.jsx)(q.MapPin,{className:"mr-2 size-4"}),"View Property Details"]})}),(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsxs)(aQ.DropdownMenuItem,{onSelect:a=>{a.preventDefault(),k(!0)},children:[(0,b.jsx)(aO.ChevronsUpDown,{className:"mr-2 size-4"}),"Change Customer/Property"]}),c&&(0,b.jsxs)(aQ.DropdownMenuItem,{onSelect:a=>{a.preventDefault(),E(!0)},children:[(0,b.jsx)(aP.default,{className:"mr-2 size-4"}),"Unlink Property"]}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"text-destructive focus:text-destructive",onSelect:a=>{a.preventDefault(),B(!0)},children:[(0,b.jsx)(aP.default,{className:"mr-2 size-4"}),"Unlink Customer"]})]})]}),(0,b.jsx)(T.Button,{className:"rounded-l-none px-3",size:"default",variant:"outline",onClick:()=>B(!0),children:(0,b.jsx)(aP.default,{className:"size-4 text-destructive"})})]}):N,(0,b.jsx)(ab.AlertDialog,{onOpenChange:B,open:A,children:(0,b.jsxs)(ab.AlertDialogContent,{children:[(0,b.jsxs)(ab.AlertDialogHeader,{children:[(0,b.jsx)(ab.AlertDialogTitle,{children:"Unlink Customer?"}),(0,b.jsxs)(ab.AlertDialogDescription,{children:["Are you sure you want to unlink"," ",(0,b.jsx)("strong",{children:a?.display_name})," from this job?",(0,b.jsx)("br",{}),(0,b.jsx)("br",{}),"This will also unlink any associated property. The customer and property records will remain in your system, but this job will no longer be associated with them."]})]}),(0,b.jsxs)(ab.AlertDialogFooter,{children:[(0,b.jsx)(ab.AlertDialogCancel,{children:"Cancel"}),(0,b.jsxs)(ab.AlertDialogAction,{onClick:L,children:[(0,b.jsx)(aP.default,{className:"mr-2 size-4"}),"Unlink Customer"]})]})]})}),(0,b.jsx)(ab.AlertDialog,{onOpenChange:E,open:D,children:(0,b.jsxs)(ab.AlertDialogContent,{children:[(0,b.jsxs)(ab.AlertDialogHeader,{children:[(0,b.jsx)(ab.AlertDialogTitle,{children:"Unlink Property?"}),(0,b.jsxs)(ab.AlertDialogDescription,{children:["This will unlink ",(0,b.jsx)("strong",{children:c?.address})," from this job. The customer will remain assigned. The property record will remain in your system."]})]}),(0,b.jsxs)(ab.AlertDialogFooter,{children:[(0,b.jsx)(ab.AlertDialogCancel,{children:"Cancel"}),(0,b.jsxs)(ab.AlertDialogAction,{onClick:M,children:[(0,b.jsx)(aP.default,{className:"mr-2 size-4"}),"Unlink Property"]})]})]})})]})}var aS=a.i(452168),aT=a.i(10348),aU=a.i(94436),aV=a.i(156916),aW=(0,N.createServerReference)("600d248fca67343a7a300d336e6a84b87acdd15e2e",N.callServer,void 0,N.findSourceMapURL,"bulkArchive"),aX=a.i(680121),aY=a.i(373702),aZ=a.i(380340),a$=a.i(493667),a_=a.i(858707);function a0({estimates:a}){let c=(0,G.useRouter)(),[d,e]=(0,H.useState)(!1),[f,g]=(0,H.useState)(new Set),[i,j]=(0,H.useState)(!1),[l,m]=(0,H.useState)(null),[n,o]=(0,H.useState)(!1),p=(0,H.useCallback)(a=>(0,ay.formatCurrency)(a,{minimumFractionDigits:0,maximumFractionDigits:0}),[]),q=(0,H.useCallback)(async()=>{if(0!==f.size){j(!0);try{let a=await aW(Array.from(f),"estimate");a.success&&a.data?(aV.toast.success(`Successfully archived ${a.data.archived} estimate${1===a.data.archived?"":"s"}`),e(!1),g(new Set),c.refresh()):aV.toast.error("Failed to archive estimates")}catch(a){aV.toast.error("Failed to archive estimates")}finally{j(!1)}}},[f]),r=(0,H.useCallback)(async()=>{if(l){o(!0);try{let a=await (0,aX.unlinkEstimateFromJob)(l);a.success?(aV.toast.success("Estimate unlinked from job"),m(null),c.refresh()):aV.toast.error(a.error||"Failed to unlink estimate")}catch(a){aV.toast.error("Failed to unlink estimate")}finally{o(!1)}}},[l]),s=(0,H.useMemo)(()=>[{key:"estimate_number",header:"Estimate #",width:"w-40",shrink:!0,render:a=>(0,b.jsx)(F.default,{className:"text-foreground hover:text-primary truncate text-xs font-medium transition-colors hover:underline",href:`/dashboard/work/estimates/${a.id}`,title:a.estimate_number,children:a.estimate_number})},{key:"title",header:"Title",width:"flex-1",render:a=>(0,b.jsx)(F.default,{className:"block min-w-0",href:`/dashboard/work/estimates/${a.id}`,onClick:a=>a.stopPropagation(),title:a.title||void 0,children:(0,b.jsx)("span",{className:"text-foreground truncate text-xs leading-tight font-medium hover:underline",children:a.title||"—"})})},{key:"status",header:"Status",width:"w-32",shrink:!0,render:a=>(0,b.jsx)(a$.EstimateStatusBadge,{status:a.status})},{key:"total_amount",header:"Amount",width:"w-36",shrink:!0,align:"right",render:a=>(0,b.jsx)("span",{className:"text-xs font-semibold tabular-nums",children:p(a.total_amount)})},{key:"valid_until",header:"Valid Until",width:"w-36",shrink:!0,hideOnMobile:!0,render:a=>(0,b.jsx)("span",{className:"text-muted-foreground text-xs tabular-nums",children:a.valid_until?(0,ay.formatDate)(a.valid_until,"short"):"—"})},{key:"actions",header:"",width:"w-12",shrink:!0,align:"right",render:a=>(0,b.jsxs)(aQ.DropdownMenu,{children:[(0,b.jsx)(aQ.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(T.Button,{className:"size-8 p-0",size:"sm",variant:"ghost",children:(0,b.jsx)(aU.MoreHorizontal,{className:"size-4"})})}),(0,b.jsxs)(aQ.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,b.jsx)(aQ.DropdownMenuItem,{asChild:!0,className:"cursor-pointer",children:(0,b.jsxs)(F.default,{href:`/dashboard/work/estimates/${a.id}`,children:[(0,b.jsx)(aH.Eye,{className:"mr-2 size-4"}),"View Details"]})}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",children:[(0,b.jsx)(k.Download,{className:"mr-2 size-4"}),"Download PDF"]}),(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",children:[(0,b.jsx)(R.Send,{className:"mr-2 size-4"}),"Send to Customer"]}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",children:[(0,b.jsx)(h.CheckCircle,{className:"mr-2 size-4"}),"Convert to Invoice"]}),(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>m(a.id),children:[(0,b.jsx)(aT.Link2Off,{className:"mr-2 size-4"}),"Unlink from Job"]})]})]})}],[p]),t=(0,H.useMemo)(()=>[{label:"Archive Selected",icon:(0,b.jsx)(aS.Archive,{className:"h-4 w-4"}),variant:"destructive",onClick:a=>{g(a),e(!0)}}],[]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aZ.FullWidthDataTable,{...a_.TablePresets.compact(),bulkActions:t,columns:s,data:a,emptyIcon:(0,b.jsx)(v.Receipt,{className:"text-muted-foreground/50 size-12"}),emptyMessage:"No estimates found for this job",getItemId:a=>a.id,noPadding:!0,searchFilter:(a,b)=>{let c=b.toLowerCase();return a.estimate_number?.toLowerCase().includes(c)||a.title?.toLowerCase().includes(c)||a.status?.toLowerCase().includes(c)},searchPlaceholder:"Search estimates..."}),(0,b.jsx)(aY.ArchiveConfirmDialog,{entityType:"estimate",isLoading:i,itemCount:f.size,onConfirm:q,onOpenChange:e,open:d}),(0,b.jsx)(U.Dialog,{onOpenChange:a=>!a&&m(null),open:null!==l,children:(0,b.jsxs)(U.DialogContent,{children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsx)(U.DialogTitle,{children:"Unlink Estimate from Job?"}),(0,b.jsx)(U.DialogDescription,{children:"This will remove the job association from this estimate. The estimate will remain in the system but will no longer appear on this job's page."})]}),(0,b.jsxs)(U.DialogFooter,{children:[(0,b.jsx)(T.Button,{disabled:n,onClick:()=>m(null),variant:"outline",children:"Cancel"}),(0,b.jsx)(T.Button,{disabled:n,onClick:r,variant:"destructive",children:n?"Unlinking...":"Unlink Estimate"})]})]})})]})}var a1=a.i(527936),a2=a.i(877923);function a3({invoices:a}){let c=(0,G.useRouter)(),[d,e]=(0,H.useState)(null),[f,g]=(0,H.useState)(!1),h=(0,H.useCallback)(a=>(0,ay.formatCurrency)(a,{minimumFractionDigits:0,maximumFractionDigits:0}),[]),i=(0,H.useCallback)(async()=>{if(d){g(!0);try{let a=await (0,a2.unlinkInvoiceFromJob)(d);a.success?(aV.toast.success("Invoice unlinked from job"),e(null),c.refresh()):aV.toast.error(a.error||"Failed to unlink invoice")}catch(a){aV.toast.error("Failed to unlink invoice")}finally{g(!1)}}},[d,c]),j=(0,H.useMemo)(()=>[{key:"invoice_number",header:"Invoice #",width:"w-32",shrink:!0,render:a=>(0,b.jsx)(F.default,{className:"text-foreground text-xs leading-tight font-medium hover:underline",href:`/dashboard/work/invoices/${a.id}`,onClick:a=>a.stopPropagation(),children:a.invoice_number})},{key:"title",header:"Title",render:a=>(0,b.jsx)(F.default,{className:"text-foreground text-xs leading-tight font-medium hover:underline",href:`/dashboard/work/invoices/${a.id}`,onClick:a=>a.stopPropagation(),children:a.title||"—"})},{key:"status",header:"Status",width:"w-24",shrink:!0,render:a=>(0,b.jsx)(a$.InvoiceStatusBadge,{status:a.status})},{key:"total_amount",header:"Amount",width:"w-32",shrink:!0,align:"right",render:a=>(0,b.jsx)("span",{className:"font-medium",children:h(a.total_amount)})},{key:"balance_amount",header:"Balance",width:"w-32",shrink:!0,align:"right",render:a=>{let c=a.balance_amount??a.total_amount-a.paid_amount;return c>0?(0,b.jsx)("span",{className:"text-destructive font-medium",children:h(c)}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"Paid"})}},{key:"due_date",header:"Due Date",width:"w-28",shrink:!0,hideOnMobile:!0,render:a=>(0,b.jsx)("span",{className:"text-xs",children:(0,ay.formatDate)(a.due_date,"short")})},{key:"actions",header:"",width:"w-12",shrink:!0,align:"right",render:a=>{let c=a.balance_amount??a.total_amount-a.paid_amount,d="paid"!==a.status&&c>0;return(0,b.jsxs)(aQ.DropdownMenu,{children:[(0,b.jsx)(aQ.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(T.Button,{className:"size-8 p-0",size:"sm",variant:"ghost",children:(0,b.jsx)(aU.MoreHorizontal,{className:"size-4"})})}),(0,b.jsxs)(aQ.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",children:[(0,b.jsx)(aH.Eye,{className:"mr-2 size-4"}),"View Details"]}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",children:[(0,b.jsx)(k.Download,{className:"mr-2 size-4"}),"Download PDF"]}),(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",children:[(0,b.jsx)(R.Send,{className:"mr-2 size-4"}),"Send to Customer"]}),d&&(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",children:[(0,b.jsx)(a1.CreditCard,{className:"mr-2 size-4"}),"Record Payment"]}),(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>e(a.id),children:[(0,b.jsx)(aT.Link2Off,{className:"mr-2 size-4"}),"Unlink from Job"]})]})]})}}],[h]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aZ.FullWidthDataTable,{...a_.TablePresets.compact(),columns:j,data:a,emptyIcon:(0,b.jsx)(m.FileText,{className:"text-muted-foreground/50 size-12"}),emptyMessage:"No invoices found for this job",getItemId:a=>a.id,noPadding:!0,searchFilter:(a,b)=>{let c=b.toLowerCase();return a.invoice_number?.toLowerCase().includes(c)||a.title?.toLowerCase().includes(c)||a.status?.toLowerCase().includes(c)},searchPlaceholder:"Search invoices..."}),(0,b.jsx)(U.Dialog,{onOpenChange:a=>!a&&e(null),open:null!==d,children:(0,b.jsxs)(U.DialogContent,{children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsx)(U.DialogTitle,{children:"Unlink Invoice from Job?"}),(0,b.jsx)(U.DialogDescription,{children:"This will remove the job association from this invoice. The invoice will remain in the system but will no longer appear on this job's page."})]}),(0,b.jsxs)(U.DialogFooter,{children:[(0,b.jsx)(T.Button,{disabled:f,onClick:()=>e(null),variant:"outline",children:"Cancel"}),(0,b.jsx)(T.Button,{disabled:f,onClick:i,variant:"destructive",children:f?"Unlinking...":"Unlink Invoice"})]})]})})]})}var a4=a.i(525756),a5=a.i(558520),a6=a.i(339632);function a7({notes:a,onDeleteNote:c}){let d=(0,G.useRouter)(),[e,f]=(0,H.useState)(null),[g,h]=(0,H.useState)(null),[i,j]=(0,H.useState)(!1),[k,l]=(0,H.useState)(!1),[n,o]=(0,H.useState)(new Set),[p,q]=(0,H.useState)(!1),r=(0,H.useCallback)(async()=>{if(e&&c){j(!0);try{let a=await c(e);a.success?(aV.toast.success("Note deleted"),f(null),d.refresh()):aV.toast.error(a.error||"Failed to delete note")}catch(a){aV.toast.error("Failed to delete note")}finally{j(!1)}}},[e,c,d]),s=(0,H.useCallback)(async()=>{if(0!==n.size){q(!0);try{let a=await aW(Array.from(n),"job_note");a.success&&a.data?(aV.toast.success(`Successfully archived ${a.data.archived} note${1===a.data.archived?"":"s"}`),l(!1),o(new Set),d.refresh()):aV.toast.error("Failed to archive notes")}catch(a){aV.toast.error("Failed to archive notes")}finally{q(!1)}}},[n,d]),t=(0,H.useCallback)(a=>a?a.split(/[-_]/).map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" "):"General",[]),u=(0,H.useCallback)((a,b=100)=>a.length<=b?a:`${a.substring(0,b)}...`,[]),v=(0,H.useMemo)(()=>a.find(a=>a.id===g),[a,g]),w=(0,H.useMemo)(()=>[{label:"Archive Selected",icon:(0,b.jsx)(aS.Archive,{className:"h-4 w-4"}),variant:"destructive",onClick:a=>{o(a),l(!0)}}],[]),x=(0,H.useMemo)(()=>[{key:"content",header:"Note",render:a=>(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[a.is_important&&(0,b.jsx)(a5.Flag,{className:"text-destructive mt-0.5 size-4 shrink-0 fill-current"}),(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("span",{className:"text-xs leading-tight",children:u(a.content)}),a.content.length>100&&(0,b.jsx)("button",{className:"text-primary text-xs font-medium hover:underline",onClick:b=>{b.stopPropagation(),h(a.id)},type:"button",children:"Read more"})]})]})},{key:"note_type",header:"Type",width:"w-28",shrink:!0,hideOnMobile:!0,render:a=>(0,b.jsx)(ad.Badge,{variant:"outline",className:"font-normal",children:t(a.note_type)})},{key:"is_important",header:"Important",width:"w-24",shrink:!0,hideOnMobile:!0,align:"center",render:a=>a.is_important?(0,b.jsx)(a5.Flag,{className:"text-destructive size-4 fill-current"}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"—"})},{key:"created_by_name",header:"Author",width:"w-36",shrink:!0,hideOnMobile:!0,render:a=>(0,b.jsx)("span",{className:"text-xs",children:a.created_by_name||"Unknown"})},{key:"created_at",header:"Date",width:"w-32",shrink:!0,render:a=>(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:(0,ay.formatDate)(a.created_at,"short")})},{key:"actions",header:"",width:"w-12",shrink:!0,align:"right",render:a=>(0,b.jsxs)(aQ.DropdownMenu,{children:[(0,b.jsx)(aQ.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(T.Button,{className:"size-8 p-0",size:"sm",variant:"ghost",children:(0,b.jsx)(aU.MoreHorizontal,{className:"size-4"})})}),(0,b.jsxs)(aQ.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",onClick:()=>h(a.id),children:[(0,b.jsx)(aH.Eye,{className:"mr-2 size-4"}),"View Full Note"]}),(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",children:[(0,b.jsx)(a4.Edit,{className:"mr-2 size-4"}),"Edit Note"]}),(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>{o(new Set([a.id])),l(!0)},children:[(0,b.jsx)(aS.Archive,{className:"mr-2 size-4"}),"Archive Note"]}),c&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>f(a.id),children:[(0,b.jsx)(a6.Trash2,{className:"mr-2 size-4"}),"Delete Note"]})]})]})]})}],[u,t,c]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aZ.FullWidthDataTable,{...a_.TablePresets.compact(),bulkActions:w,columns:x,data:a,emptyIcon:(0,b.jsx)(m.FileText,{className:"text-muted-foreground/50 size-12"}),emptyMessage:"No notes found for this job",getItemId:a=>a.id,noPadding:!0,searchFilter:(a,b)=>{let c=b.toLowerCase();return a.content.toLowerCase().includes(c)||a.note_type?.toLowerCase().includes(c)||a.created_by_name?.toLowerCase().includes(c)},searchPlaceholder:"Search notes...",getRowClassName:a=>a.is_important?"border-l-2 border-l-destructive":""}),(0,b.jsx)(aY.ArchiveConfirmDialog,{entityType:"note",isLoading:p,itemCount:n.size,onConfirm:s,onOpenChange:l,open:k}),(0,b.jsx)(U.Dialog,{onOpenChange:a=>!a&&h(null),open:null!==g,children:(0,b.jsxs)(U.DialogContent,{className:"max-w-2xl",children:[(0,b.jsx)(U.DialogHeader,{children:(0,b.jsxs)(U.DialogTitle,{className:"flex items-center gap-2",children:[v?.is_important&&(0,b.jsx)(a5.Flag,{className:"text-destructive size-5 fill-current"}),"Note Details"]})}),v&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-muted-foreground mb-1 text-xs font-medium tracking-wide uppercase",children:"Type"}),(0,b.jsx)(ad.Badge,{variant:"outline",children:t(v.note_type)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-muted-foreground mb-1 text-xs font-medium tracking-wide uppercase",children:"Content"}),(0,b.jsx)("p",{className:"text-foreground text-xs leading-relaxed whitespace-pre-wrap",children:v.content})]}),(0,b.jsxs)("div",{className:"border-border/40 flex items-center justify-between border-t pt-3",children:[(0,b.jsxs)("div",{className:"text-muted-foreground text-xs",children:["Created by"," ",(0,b.jsx)("span",{className:"font-medium",children:v.created_by_name||"Unknown"})]}),(0,b.jsx)("div",{className:"text-muted-foreground text-xs",children:(0,ay.formatDate)(v.created_at,"datetime")})]})]}),(0,b.jsx)(U.DialogFooter,{children:(0,b.jsx)(T.Button,{onClick:()=>h(null),variant:"outline",children:"Close"})})]})}),(0,b.jsx)(U.Dialog,{onOpenChange:a=>!a&&f(null),open:null!==e,children:(0,b.jsxs)(U.DialogContent,{children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsx)(U.DialogTitle,{children:"Delete Note?"}),(0,b.jsx)(U.DialogDescription,{children:"This will permanently delete this note. This action cannot be undone. Are you sure you want to continue?"})]}),(0,b.jsxs)(U.DialogFooter,{children:[(0,b.jsx)(T.Button,{disabled:i,onClick:()=>f(null),variant:"outline",children:"Cancel"}),(0,b.jsx)(T.Button,{disabled:i,onClick:r,variant:"destructive",children:i?"Deleting...":"Delete Note"})]})]})})]})}var a8=a.i(124481);function a9({payments:a,onDeletePayment:c}){let d=(0,G.useRouter)(),[e,f]=(0,H.useState)(null),[g,h]=(0,H.useState)(!1),[i,j]=(0,H.useState)(!1),[l,m]=(0,H.useState)(new Set),[n,o]=(0,H.useState)(!1),[p,q]=(0,H.useState)(null),[r,s]=(0,H.useState)(!1),t=(0,H.useCallback)(a=>(0,ay.formatCurrency)(a,{minimumFractionDigits:2,maximumFractionDigits:2}),[]),u=(0,H.useCallback)(async()=>{if(0!==l.size){o(!0);try{let a=await aW(Array.from(l),"payment");a.success&&a.data?(aV.toast.success(`Successfully archived ${a.data.archived} payment${1===a.data.archived?"":"s"}`),j(!1),m(new Set),d.refresh()):aV.toast.error("Failed to archive payments")}catch(a){aV.toast.error("Failed to archive payments")}finally{o(!1)}}},[l,d]),v=(0,H.useCallback)(async()=>{if(p){s(!0);try{let a=await (0,a8.unlinkPaymentFromJob)(p);a.success?(aV.toast.success("Payment unlinked from job"),q(null),d.refresh()):aV.toast.error(a.error||"Failed to unlink payment")}catch(a){aV.toast.error("Failed to unlink payment")}finally{s(!1)}}},[p,d]),w=(0,H.useCallback)(async()=>{if(e&&c){h(!0);try{let a=await c(e);a.success?(aV.toast.success("Payment deleted"),f(null),d.refresh()):aV.toast.error(a.error||"Failed to delete payment")}catch(a){aV.toast.error("Failed to delete payment")}finally{h(!1)}}},[e,c,d]),x=(0,H.useCallback)(a=>a?a.split(/[-_]/).map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" "):"—",[]),y=(0,H.useMemo)(()=>[{label:"Archive Selected",icon:(0,b.jsx)(aS.Archive,{className:"h-4 w-4"}),variant:"destructive",onClick:a=>{m(a),j(!0)}}],[]),z=(0,H.useMemo)(()=>[{key:"payment_date",header:"Date",width:"w-32",shrink:!0,render:a=>(0,b.jsx)("span",{className:"text-xs font-medium",children:(0,ay.formatDate)(a.payment_date||a.created_at,"short")})},{key:"amount",header:"Amount",width:"w-32",shrink:!0,align:"right",render:a=>(0,b.jsx)("span",{className:"font-semibold",children:t(a.amount)})},{key:"payment_method",header:"Method",width:"w-32",shrink:!0,hideOnMobile:!0,render:a=>(0,b.jsx)("span",{className:"text-xs",children:x(a.payment_method)})},{key:"reference_number",header:"Reference",width:"w-36",shrink:!0,hideOnMobile:!0,render:a=>(0,b.jsx)("span",{className:"text-muted-foreground font-mono text-xs",children:a.reference_number||"—"})},{key:"notes",header:"Notes",render:a=>(0,b.jsx)("span",{className:"text-muted-foreground line-clamp-1 text-xs",children:a.notes||"—"})},{key:"actions",header:"",width:"w-12",shrink:!0,align:"right",render:a=>(0,b.jsxs)(aQ.DropdownMenu,{children:[(0,b.jsx)(aQ.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(T.Button,{className:"size-8 p-0",size:"sm",variant:"ghost",children:(0,b.jsx)(aU.MoreHorizontal,{className:"size-4"})})}),(0,b.jsxs)(aQ.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",children:[(0,b.jsx)(aH.Eye,{className:"mr-2 size-4"}),"View Details"]}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",children:[(0,b.jsx)(k.Download,{className:"mr-2 size-4"}),"Download Receipt"]}),(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",children:[(0,b.jsx)(a4.Edit,{className:"mr-2 size-4"}),"Edit Payment"]}),(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>q(a.id),children:[(0,b.jsx)(aT.Link2Off,{className:"mr-2 size-4"}),"Unlink from Job"]}),c&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>f(a.id),children:[(0,b.jsx)(a6.Trash2,{className:"mr-2 size-4"}),"Delete Payment"]})]})]})]})}],[t,x,c]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aZ.FullWidthDataTable,{...a_.TablePresets.compact(),bulkActions:y,columns:z,data:a,emptyIcon:(0,b.jsx)(a1.CreditCard,{className:"text-muted-foreground/50 size-12"}),emptyMessage:"No payments found for this job",getItemId:a=>a.id,noPadding:!0,searchFilter:(a,b)=>{let c=b.toLowerCase();return a.reference_number?.toLowerCase().includes(c)||a.payment_method?.toLowerCase().includes(c)||a.notes?.toLowerCase().includes(c)||t(a.amount).toLowerCase().includes(c)},searchPlaceholder:"Search payments..."}),(0,b.jsx)(aY.ArchiveConfirmDialog,{entityType:"payment",isLoading:n,itemCount:l.size,onConfirm:u,onOpenChange:j,open:i}),(0,b.jsx)(U.Dialog,{onOpenChange:a=>!a&&q(null),open:null!==p,children:(0,b.jsxs)(U.DialogContent,{children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsx)(U.DialogTitle,{children:"Unlink Payment from Job?"}),(0,b.jsx)(U.DialogDescription,{children:"This will remove the job association from this payment. The payment will remain in the system but will no longer appear on this job's page."})]}),(0,b.jsxs)(U.DialogFooter,{children:[(0,b.jsx)(T.Button,{disabled:r,onClick:()=>q(null),variant:"outline",children:"Cancel"}),(0,b.jsx)(T.Button,{disabled:r,onClick:v,variant:"destructive",children:r?"Unlinking...":"Unlink Payment"})]})]})}),c&&(0,b.jsx)(U.Dialog,{onOpenChange:a=>!a&&f(null),open:null!==e,children:(0,b.jsxs)(U.DialogContent,{children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsx)(U.DialogTitle,{children:"Delete Payment?"}),(0,b.jsx)(U.DialogDescription,{children:"This will permanently delete this payment record. This action cannot be undone. Are you sure you want to continue?"})]}),(0,b.jsxs)(U.DialogFooter,{children:[(0,b.jsx)(T.Button,{disabled:g,onClick:()=>f(null),variant:"outline",children:"Cancel"}),(0,b.jsx)(T.Button,{disabled:g,onClick:w,variant:"destructive",children:g?"Deleting...":"Delete Payment"})]})]})})]})}function ba({purchaseOrders:a}){let c=(0,G.useRouter)(),[d,e]=(0,H.useState)(!1),[f,g]=(0,H.useState)(new Set),[h,i]=(0,H.useState)(!1),j=(0,H.useCallback)(a=>(0,ay.formatCurrency)(a,{minimumFractionDigits:0,maximumFractionDigits:0}),[]),l=(0,H.useCallback)(async()=>{if(0!==f.size){i(!0);try{let a=await aW(Array.from(f),"purchase_order");a.success&&a.data?(aV.toast.success(`Successfully archived ${a.data.archived} purchase order${1===a.data.archived?"":"s"}`),e(!1),g(new Set),c.refresh()):aV.toast.error("Failed to archive purchase orders")}catch(a){aV.toast.error("Failed to archive purchase orders")}finally{i(!1)}}},[f]),m=(0,H.useMemo)(()=>[{key:"po_number",header:"PO #",width:"w-40",shrink:!0,render:a=>(0,b.jsxs)("div",{className:"flex min-w-0 items-center gap-2",children:[(0,b.jsx)(F.default,{className:"text-foreground hover:text-primary truncate text-xs font-medium transition-colors hover:underline",href:`/dashboard/work/purchase-orders/${a.id}`,title:a.po_number,children:a.po_number}),a.auto_generated&&(0,b.jsx)(ad.Badge,{className:"shrink-0 text-xs",variant:"outline",children:"Auto"})]})},{key:"title",header:"Title",width:"flex-1",render:a=>(0,b.jsx)(F.default,{className:"block min-w-0",href:`/dashboard/work/purchase-orders/${a.id}`,onClick:a=>a.stopPropagation(),title:a.title||void 0,children:(0,b.jsx)("span",{className:"text-foreground truncate text-xs leading-tight font-medium hover:underline",children:a.title||"—"})})},{key:"vendor",header:"Vendor",width:"w-48",shrink:!0,render:a=>(0,b.jsx)("span",{className:"text-foreground block truncate text-xs",title:a.vendor,children:a.vendor})},{key:"status",header:"Status",width:"w-32",shrink:!0,render:a=>(0,b.jsx)(a$.StatusBadge,{status:a.status,type:"purchase_order"})},{key:"total_amount",header:"Amount",width:"w-36",shrink:!0,align:"right",render:a=>(0,b.jsx)("span",{className:"text-xs font-semibold tabular-nums",children:j(a.total_amount)})},{key:"expected_delivery",header:"Expected Delivery",width:"w-40",shrink:!0,hideOnMobile:!0,render:a=>(0,b.jsx)("span",{className:"text-muted-foreground text-xs tabular-nums",children:a.expected_delivery?(0,ay.formatDate)(a.expected_delivery,"short"):"—"})},{key:"actions",header:"",width:"w-12",shrink:!0,align:"right",render:a=>(0,b.jsxs)(aQ.DropdownMenu,{children:[(0,b.jsx)(aQ.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(T.Button,{className:"size-8 p-0",size:"sm",variant:"ghost",children:(0,b.jsx)(aU.MoreHorizontal,{className:"size-4"})})}),(0,b.jsxs)(aQ.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",children:[(0,b.jsx)(aH.Eye,{className:"mr-2 size-4"}),"View Details"]}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",children:[(0,b.jsx)(k.Download,{className:"mr-2 size-4"}),"Download PDF"]}),(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",children:[(0,b.jsx)(R.Send,{className:"mr-2 size-4"}),"Send to Vendor"]})]})]})}],[j]),n=(0,H.useMemo)(()=>[{label:"Archive Selected",icon:(0,b.jsx)(aS.Archive,{className:"h-4 w-4"}),variant:"destructive",onClick:a=>{g(a),e(!0)}}],[]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aZ.FullWidthDataTable,{...a_.TablePresets.compact(),bulkActions:n,columns:m,data:a,emptyIcon:(0,b.jsx)(s.Package,{className:"text-muted-foreground/50 size-12"}),emptyMessage:"No purchase orders found for this job",getItemId:a=>a.id,noPadding:!0,searchFilter:(a,b)=>{let c=b.toLowerCase();return a.po_number?.toLowerCase().includes(c)||a.title?.toLowerCase().includes(c)||a.vendor?.toLowerCase().includes(c)||a.status?.toLowerCase().includes(c)},searchPlaceholder:"Search purchase orders..."}),(0,b.jsx)(aY.ArchiveConfirmDialog,{entityType:"purchase order",isLoading:h,itemCount:f.size,onConfirm:l,onOpenChange:e,open:d})]})}var bb=a.i(288614),bc=a.i(909693);function bd({jobId:a,currentStatus:c}){(0,G.useRouter)();let{toast:d}=(0,Y.useToast)(),[e,f]=(0,H.useState)(null),g=async()=>{f("arrive");try{let b=await (0,bc.startJob)(a);b.success?d.success("Job started - technician arrived"):d.error(b.error||"Failed to mark job as arrived")}catch{d.error("Failed to mark job as arrived")}finally{f(null)}},i=async()=>{f("close");try{let b=await (0,bb.completeJob)(a);b.success?d.success("Job closed successfully"):d.error(b.error||"Failed to close job")}catch{d.error("Failed to close job")}finally{f(null)}},j="scheduled"===c,k="in_progress"===c;return(0,b.jsx)("div",{className:"space-y-3",children:"completed"!==c&&"cancelled"!==c&&(j||k)&&(0,b.jsxs)("div",{className:"flex justify-end",children:[j&&(0,b.jsxs)(T.Button,{className:"bg-success hover:bg-success",disabled:"arrive"===e,onClick:g,children:[(0,b.jsx)(h.CheckCircle,{className:"mr-2 h-4 w-4"}),"arrive"===e?"Arriving...":"Arrive at Site"]}),k&&(0,b.jsxs)(T.Button,{className:"bg-accent hover:bg-accent",disabled:"close"===e,onClick:i,children:[(0,b.jsx)(h.CheckCircle,{className:"mr-2 h-4 w-4"}),"close"===e?"Closing...":"Complete Job"]})]})})}var be=a.i(721659),bf=a.i(96250),bg=a.i(352770),bh=a.i(278932);let bi={quoted:["scheduled","cancelled"],scheduled:["in_progress","on_hold","cancelled"],in_progress:["on_hold","completed","cancelled"],on_hold:["scheduled","in_progress","cancelled"],completed:["invoiced"],cancelled:["quoted","scheduled"],invoiced:["paid"],paid:[]},bj={quoted:["customer_id"],scheduled:["customer_id","scheduled_start","scheduled_end"],in_progress:["customer_id","scheduled_start","assigned_to"],on_hold:["customer_id"],completed:["customer_id","scheduled_start"],cancelled:[],invoiced:["customer_id","total_amount"],paid:["customer_id","total_amount"]},bk={customer_id:"Customer",scheduled_start:"Start Date",scheduled_end:"End Date",assigned_to:"Assigned Team Member",property_id:"Property",total_amount:"Total Amount"};function bl(a){return({quoted:"Quoted",scheduled:"Scheduled",in_progress:"In Progress",on_hold:"On Hold",completed:"Completed",cancelled:"Cancelled",invoiced:"Invoiced",paid:"Paid"})[a]||a}function bm(a){return({quoted:"outline",scheduled:"secondary",in_progress:"default",on_hold:"secondary",completed:"default",cancelled:"destructive",invoiced:"secondary",paid:"default"})[a]||"default"}function bn({currentStatus:a,onStatusChange:c,job:e,disabled:f=!1,showAllStatuses:g=!1}){let h=(0,H.useMemo)(()=>{let b=bi[a]||[];return[a,...b]},[a]),i=(0,H.useMemo)(()=>({quoted:"scheduled",scheduled:"in_progress",in_progress:"completed",on_hold:"in_progress",completed:"invoiced",cancelled:null,invoiced:"paid",paid:null})[a]||null,[a]),j=g?["quoted","scheduled","in_progress","on_hold","completed","cancelled","invoiced","paid"]:h,k=(0,H.useCallback)(b=>b===a?{allowed:!0}:function(a){let{currentStatus:b,newStatus:c,job:d}=a;if(b===c)return{allowed:!0};let e=bi[b];if(!e.includes(c))return{allowed:!1,reason:`Cannot transition from "${b}" to "${c}". Valid next statuses: ${e.join(", ")}`};let f=bj[c],g=[];for(let a of f){let b=d[a];(null==b||""===b)&&g.push(bk[a]||a)}if(g.length>0)return{allowed:!1,reason:`Cannot transition to "${c}" - missing required fields`,requiredFields:g};let h=[];if("scheduled"!==b||"in_progress"!==c||d.teamAssignments&&0!==d.teamAssignments.length||h.push("No team members assigned to this job"),"completed"===b&&"invoiced"===c){let a=d.estimates&&d.estimates.length>0,b=d.total_amount&&d.total_amount>0;if(!a&&!b)return{allowed:!1,reason:"Cannot create invoice - no estimates or total amount defined"}}if("invoiced"===b&&"paid"===c){if(!d.invoices||0===d.invoices.length)return{allowed:!1,reason:"Cannot mark as paid - no invoices found"};let a=d.invoices.filter(a=>"paid"!==a.status&&"cancelled"!==a.status);if(a.length>0)return{allowed:!1,reason:`Cannot mark as paid - ${a.length} invoice(s) still unpaid`}}return"paid"===b?{allowed:!1,reason:"Cannot change status of paid jobs. Create a new job if needed."}:{allowed:!0,warnings:h.length>0?h:void 0}}({currentStatus:a,newStatus:b,job:e}),[a,e]),l=(0,H.useCallback)(a=>{k(a).allowed&&c(a)},[k,c]),m=(0,H.useMemo)(()=>k(a),[a,k]),n=(0,H.useMemo)(()=>{let b=h.filter(b=>b!==a);return{current:bl(a),nextSteps:b.map(a=>bl(a)),recommended:i?bl(i):null}},[a,h,i]);return(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsxs)(V.Select,{value:a,onValueChange:l,disabled:f,children:[(0,b.jsx)(V.SelectTrigger,{className:"w-full",children:(0,b.jsx)(V.SelectValue,{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(ad.Badge,{variant:bm(a),children:bl(a)}),i&&a!==i&&(0,b.jsxs)("span",{className:"text-muted-foreground text-xs",children:["→ Next: ",bl(i)]})]})})}),(0,b.jsx)(V.SelectContent,{children:j.map(c=>{let e=k(c),f=!e.allowed,g=c===a,h=c===i;return(0,b.jsxs)(V.SelectItem,{value:c,disabled:f&&!g,className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(ad.Badge,{variant:bm(c),className:"text-xs",children:bl(c)}),g&&(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"(current)"}),h&&!g&&(0,b.jsx)("span",{className:"text-primary text-xs",children:"(recommended)"}),f&&!g&&(0,b.jsx)("span",{className:"text-destructive text-xs",children:(0,b.jsx)(d.AlertCircle,{className:"inline h-3 w-3"})}),e.warnings&&e.warnings.length>0&&(0,b.jsx)("span",{className:"text-yellow-600 text-xs",children:(0,b.jsx)(bh.Info,{className:"inline h-3 w-3"})})]}),f&&!g&&e.reason&&(0,b.jsx)("div",{className:"text-destructive mt-1 text-xs",children:e.reason}),f&&!g&&e.requiredFields&&e.requiredFields.length>0&&(0,b.jsxs)("div",{className:"text-destructive mt-1 text-xs",children:["Missing: ",e.requiredFields.join(", ")]})]},c)})})]})}),(0,b.jsxs)(ag.Popover,{children:[(0,b.jsx)(ag.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(T.Button,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground h-8 w-8 p-0",children:[(0,b.jsx)(bg.HelpCircle,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"sr-only",children:"View workflow information"})]})}),(0,b.jsx)(ag.PopoverContent,{className:"w-80",align:"start",children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"mb-2 font-semibold text-sm",children:["Current Status: ",n.current]}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["This job is currently in the"," ",n.current.toLowerCase()," stage."]})]}),n.nextSteps.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"mb-2 flex items-center gap-1 font-semibold text-sm",children:[(0,b.jsx)(as.ArrowRight,{className:"h-3 w-3"}),"Available Next Steps"]}),(0,b.jsx)("ul",{className:"space-y-1",children:n.nextSteps.map((a,c)=>(0,b.jsxs)("li",{className:`flex items-center gap-2 text-xs ${a===n.recommended?"text-primary font-medium":"text-muted-foreground"}`,children:[(0,b.jsx)(bf.CheckCircle2,{className:"h-3 w-3"}),a,a===n.recommended&&(0,b.jsx)(ad.Badge,{variant:"default",className:"ml-auto text-xs",children:"Recommended"})]},c))})]}),0===n.nextSteps.length&&"paid"!==a&&(0,b.jsx)("div",{children:(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"This status cannot be changed further. Job is complete."})}),"paid"===a&&(0,b.jsx)("div",{className:"rounded-md border-green-600 bg-green-50 p-2 dark:bg-green-950",children:(0,b.jsx)("p",{className:"text-green-900 text-xs dark:text-green-100",children:"✓ Job is fully paid. No further status changes allowed."})}),(0,b.jsx)("div",{className:"border-t pt-2",children:(0,b.jsx)("p",{className:"text-muted-foreground text-xs italic",children:"Status changes follow your workflow rules. Some transitions may require additional information like dates, assignments, or invoices."})})]})})]})]}),m.warnings&&m.warnings.length>0&&(0,b.jsxs)(ax.Alert,{variant:"default",className:"border-yellow-600",children:[(0,b.jsx)(bh.Info,{className:"h-4 w-4 text-yellow-600"}),(0,b.jsx)(ax.AlertDescription,{children:(0,b.jsx)("ul",{className:"list-disc space-y-1 pl-4",children:m.warnings.map((a,c)=>(0,b.jsx)("li",{className:"text-sm",children:a},c))})})]}),"paid"===a&&(0,b.jsxs)(ax.Alert,{variant:"default",className:"border-green-600",children:[(0,b.jsx)(bf.CheckCircle2,{className:"h-4 w-4 text-green-600"}),(0,b.jsx)(ax.AlertDescription,{children:"This job is marked as paid. No further status changes are allowed."})]})]})}function bo({tasks:a,onToggleComplete:c,onDeleteTask:d}){let e=(0,G.useRouter)(),[f,g]=(0,H.useState)(null),[i,j]=(0,H.useState)(!1),[k,l]=(0,H.useState)(!1),[m,n]=(0,H.useState)(new Set),[o,p]=(0,H.useState)(!1),q=(0,H.useCallback)(async()=>{if(f&&d){j(!0);try{let a=await d(f);a.success?(aV.toast.success("Task deleted"),g(null),e.refresh()):aV.toast.error(a.error||"Failed to delete task")}catch(a){aV.toast.error("Failed to delete task")}finally{j(!1)}}},[f,d,e]),r=(0,H.useCallback)(async()=>{if(0!==m.size){p(!0);try{let a=await aW(Array.from(m),"job_task");a.success&&a.data?(aV.toast.success(`Successfully archived ${a.data.archived} task${1===a.data.archived?"":"s"}`),l(!1),n(new Set),e.refresh()):aV.toast.error("Failed to archive tasks")}catch(a){aV.toast.error("Failed to archive tasks")}finally{p(!1)}}},[m,e]),s=(0,H.useCallback)(async(a,b)=>{if(c)try{let d=await c(a,!b);d.success?(aV.toast.success(b?"Task marked incomplete":"Task completed"),e.refresh()):aV.toast.error(d.error||"Failed to update task")}catch(a){aV.toast.error("Failed to update task")}},[c,e]),t=(0,H.useCallback)(a=>a||"Other",[]),u=(0,H.useCallback)(a=>{switch(a){case"Pre-Job":case"Safety":return"default";case"On-Site":case"Quality":return"secondary";default:return"outline"}},[]),v=a.filter(a=>a.is_completed).length,w=a.length,x=w>0?Math.round(v/w*100):0,y=(0,H.useMemo)(()=>[{label:"Archive Selected",icon:(0,b.jsx)(aS.Archive,{className:"h-4 w-4"}),variant:"destructive",onClick:a=>{n(a),l(!0)}}],[]),z=(0,H.useMemo)(()=>[{key:"status",header:"",width:"w-12",shrink:!0,align:"center",render:a=>(0,b.jsx)("button",{className:"flex items-center justify-center",onClick:b=>{b.stopPropagation(),s(a.id,a.is_completed)},type:"button",disabled:!c,children:(0,b.jsx)("input",{checked:a.is_completed,className:(0,ap.cn)("border-border h-5 w-5 cursor-pointer rounded focus:ring-2",a.is_completed?"text-success focus:ring-green-500":"focus:ring-primary"),onChange:()=>{},type:"checkbox",disabled:!c})})},{key:"title",header:"Task",render:a=>(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:(0,ap.cn)("text-xs font-medium",a.is_completed&&"text-muted-foreground line-through"),children:a.title}),a.is_required&&(0,b.jsx)(ad.Badge,{variant:"destructive",className:"text-xs",children:"Required"})]}),a.description&&(0,b.jsx)("p",{className:"text-muted-foreground line-clamp-2 text-xs",children:a.description})]})},{key:"category",header:"Category",width:"w-28",shrink:!0,hideOnMobile:!0,render:a=>(0,b.jsx)(ad.Badge,{variant:u(a.category),className:"font-normal",children:t(a.category)})},{key:"assigned_user",header:"Assigned To",width:"w-36",shrink:!0,hideOnMobile:!0,render:a=>{let c=Array.isArray(a.assigned_user)?a.assigned_user[0]:a.assigned_user;return c?(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(ac.Avatar,{className:"h-6 w-6",children:[(0,b.jsx)(ac.AvatarImage,{src:c.avatar}),(0,b.jsx)(ac.AvatarFallback,{className:"text-xs",children:c.name?.substring(0,2).toUpperCase()||"TM"})]}),(0,b.jsx)("span",{className:"max-w-24 truncate text-xs",children:c.name})]}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"—"})}},{key:"due_date",header:"Due Date",width:"w-32",shrink:!0,hideOnMobile:!0,render:a=>{if(a.is_completed&&a.completed_at)return(0,b.jsxs)("div",{className:"text-success flex items-center gap-1 text-xs",children:[(0,b.jsx)(h.CheckCircle,{className:"size-3"}),(0,ay.formatDate)(a.completed_at,"short")]});if(a.due_date){let c=new Date(a.due_date)<new Date&&!a.is_completed;return(0,b.jsxs)("div",{className:(0,ap.cn)("flex items-center gap-1 text-xs",c?"text-destructive":"text-muted-foreground"),children:[(0,b.jsx)(at.Clock,{className:"size-3"}),(0,ay.formatDate)(a.due_date,"short")]})}return(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"—"})}},{key:"actions",header:"",width:"w-12",shrink:!0,align:"right",render:a=>(0,b.jsxs)(aQ.DropdownMenu,{children:[(0,b.jsx)(aQ.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(T.Button,{className:"size-8 p-0",size:"sm",variant:"ghost",children:(0,b.jsx)(aU.MoreHorizontal,{className:"size-4"})})}),(0,b.jsxs)(aQ.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",onClick:()=>s(a.id,a.is_completed),disabled:!c,children:[(0,b.jsx)(h.CheckCircle,{className:"mr-2 size-4"}),a.is_completed?"Mark Incomplete":"Mark Complete"]}),(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"cursor-pointer",children:[(0,b.jsx)(a4.Edit,{className:"mr-2 size-4"}),"Edit Task"]}),(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>{n(new Set([a.id])),l(!0)},children:[(0,b.jsx)(aS.Archive,{className:"mr-2 size-4"}),"Archive Task"]}),d&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>g(a.id),children:[(0,b.jsx)(a6.Trash2,{className:"mr-2 size-4"}),"Delete Task"]})]})]})]})}],[s,t,u,c,d]);return(0,b.jsxs)(b.Fragment,{children:[w>0&&(0,b.jsxs)("div",{className:"bg-muted/30 border-border mb-4 rounded-lg border p-4",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center justify-between text-xs",children:[(0,b.jsx)("span",{className:"font-medium",children:"Overall Progress"}),(0,b.jsxs)("span",{className:"text-muted-foreground",children:[v," of ",w," completed (",x,"%)"]})]}),(0,b.jsx)("div",{className:"bg-muted h-2 w-full overflow-hidden rounded-full",children:(0,b.jsx)("div",{className:"bg-success h-full transition-all",style:{width:`${x}%`}})})]}),(0,b.jsx)(aZ.FullWidthDataTable,{...a_.TablePresets.compact(),bulkActions:y,columns:z,data:a,emptyIcon:(0,b.jsx)(h.CheckCircle,{className:"text-muted-foreground/50 size-12"}),emptyMessage:"No tasks added yet. Create a step-by-step checklist for the field crew.",getItemId:a=>a.id,noPadding:!0,searchFilter:(a,b)=>{let c=b.toLowerCase();return a.title.toLowerCase().includes(c)||a.description?.toLowerCase().includes(c)||a.category?.toLowerCase().includes(c)},searchPlaceholder:"Search tasks...",getRowClassName:a=>(0,ap.cn)(a.is_completed&&"bg-secondary/30 opacity-75",a.is_required&&!a.is_completed&&"border-l-2 border-l-destructive")}),(0,b.jsx)(aY.ArchiveConfirmDialog,{entityType:"task",isLoading:o,itemCount:m.size,onConfirm:r,onOpenChange:l,open:k}),(0,b.jsx)(U.Dialog,{onOpenChange:a=>!a&&g(null),open:null!==f,children:(0,b.jsxs)(U.DialogContent,{children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsx)(U.DialogTitle,{children:"Delete Task?"}),(0,b.jsx)(U.DialogDescription,{children:"This will permanently delete this task. This action cannot be undone. Are you sure you want to continue?"})]}),(0,b.jsxs)(U.DialogFooter,{children:[(0,b.jsx)(T.Button,{disabled:i,onClick:()=>g(null),variant:"outline",children:"Cancel"}),(0,b.jsx)(T.Button,{disabled:i,onClick:q,variant:"destructive",children:i?"Deleting...":"Delete Task"})]})]})})]})}a.i(421695);var bp=a.i(736786);function bq({availableMembers:a,currentMemberIds:c,onAssign:d,trigger:e}){let[f,g]=(0,H.useState)(!1),[h,i]=(0,H.useState)(""),[j,k]=(0,H.useState)(null),[l,m]=(0,H.useState)("crew"),[n,o]=(0,H.useState)(!1),p=a.filter(a=>!c.includes(a.id)),q=h.trim()?p.filter(a=>{let b=h.toLowerCase();return[a.user.firstName,a.user.lastName].filter(Boolean).join(" ").toLowerCase().includes(b)||a.user.email?.toLowerCase().includes(b)||a.jobTitle?.toLowerCase().includes(b)}):p,r=async()=>{if(j){o(!0);try{await d(j.id,l),g(!1),k(null),m("crew"),i("")}finally{o(!1)}}},s=a=>[a.user.firstName,a.user.lastName].filter(Boolean).join(" ")||a.user.email;return(0,b.jsxs)(ag.Popover,{open:f,onOpenChange:a=>{g(a),a||(k(null),m("crew"),i(""))},children:[(0,b.jsx)(ag.PopoverTrigger,{asChild:!0,children:e||(0,b.jsxs)(T.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(D.Users,{className:"mr-2 h-4 w-4"}),"Add Team Member"]})}),(0,b.jsxs)(ag.PopoverContent,{className:"w-[400px] p-0",align:"start",children:[(0,b.jsxs)(bp.Command,{shouldFilter:!1,children:[(0,b.jsx)(bp.CommandInput,{placeholder:"Search team members...",value:h,onValueChange:i}),(0,b.jsxs)(bp.CommandList,{children:[0===q.length&&(0,b.jsx)(bp.CommandEmpty,{children:h.trim()?"No team members found":"No available team members"}),q.length>0&&(0,b.jsx)(bp.CommandGroup,{heading:"Available Team Members",children:q.map(a=>(0,b.jsxs)("div",{onClick:()=>k(a),className:(0,ap.cn)("relative flex cursor-pointer select-none items-center justify-between gap-2 rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground",j?.id===a.id&&"bg-accent"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"bg-primary/10 text-primary flex h-8 w-8 items-center justify-center rounded-full",children:(0,b.jsx)(C.User,{className:"h-4 w-4"})}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:s(a)}),a.jobTitle&&(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:a.jobTitle})]})]}),j?.id===a.id&&(0,b.jsx)(aB.Check,{className:"h-4 w-4"})]},a.id))})]})]}),j&&(0,b.jsxs)("div",{className:"space-y-3 border-t p-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(C.User,{className:"text-muted-foreground h-4 w-4"}),(0,b.jsx)("span",{className:"font-medium",children:s(j)}),j.jobTitle&&(0,b.jsx)(ad.Badge,{variant:"secondary",className:"text-xs",children:j.jobTitle})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-xs font-medium",children:"Role"}),(0,b.jsxs)(V.Select,{value:l,onValueChange:m,children:[(0,b.jsx)(V.SelectTrigger,{className:"h-9",children:(0,b.jsx)(V.SelectValue,{})}),(0,b.jsxs)(V.SelectContent,{children:[(0,b.jsx)(V.SelectItem,{value:"primary",children:"Primary"}),(0,b.jsx)(V.SelectItem,{value:"supervisor",children:"Supervisor"}),(0,b.jsx)(V.SelectItem,{value:"assistant",children:"Assistant"}),(0,b.jsx)(V.SelectItem,{value:"crew",children:"Crew"})]})]})]}),(0,b.jsx)(T.Button,{onClick:r,disabled:n,className:"w-full",size:"sm",children:n?"Assigning...":"Assign to Job"})]})]})]})}var br=a.i(71083),br=br,bs=a.i(860442);function bt({teamMembers:a,onRemoveMember:c}){let d=(0,G.useRouter)(),[e,f]=(0,H.useState)(null),[g,h]=(0,H.useState)(!1),i=(0,H.useRef)(0),j=(0,H.useCallback)(()=>{let a=Date.now();a-i.current<1e3?console.warn("⚠️ Refresh called too frequently, skipping to prevent loop"):(i.current=a,d.refresh())},[d]),k=(0,H.useCallback)(async()=>{if(e&&c){h(!0);try{let a=await c(e);a.success?(aV.toast.success("Team member removed from job"),f(null),j()):aV.toast.error(a.error||"Failed to remove team member")}catch(a){aV.toast.error("Failed to remove team member")}finally{h(!1)}}},[e,c,j]),l=(0,H.useCallback)(a=>{let b=a.team_member.user;return b.name?b.name:b.first_name||b.last_name?[b.first_name,b.last_name].filter(Boolean).join(" "):b.email||"Unknown User"},[]),m=(0,H.useCallback)(a=>{let b=a.team_member.user;if(b.first_name&&b.last_name)return`${b.first_name[0]}${b.last_name[0]}`.toUpperCase();let c=b.name||b.email||"?",d=c.split(" ");return d.length>=2?`${d[0][0]}${d[1][0]}`.toUpperCase():c.substring(0,2).toUpperCase()},[]),n=(0,H.useMemo)(()=>[{key:"name",header:"Name",render:a=>{let c=l(a),d=m(a),e=a.team_member.user.avatar_url;return(0,b.jsxs)(F.default,{className:"flex items-center gap-2.5 text-xs leading-tight hover:underline",href:`/dashboard/team/${a.user_id}`,onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)(ac.Avatar,{className:"size-8",children:[e&&(0,b.jsx)(ac.AvatarImage,{alt:c,src:e}),(0,b.jsx)(ac.AvatarFallback,{className:"bg-primary/10 text-primary text-xs font-semibold",children:d})]}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-foreground font-medium",children:c}),a.team_member.user.email&&(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:a.team_member.user.email})]})]})}},{key:"job_title",header:"Job Title",width:"w-40",shrink:!0,hideOnMobile:!0,render:a=>(0,b.jsx)("span",{className:"text-xs",children:a.team_member.job_title||"—"})},{key:"role",header:"Role",width:"w-32",shrink:!0,render:a=>(0,b.jsx)("span",{className:"text-xs",children:a.role||"Team Member"})},{key:"assigned_at",header:"Assigned Date",width:"w-32",shrink:!0,hideOnMobile:!0,render:a=>(0,b.jsx)("span",{className:"text-xs",children:(0,ay.formatDate)(a.assigned_at,"short")})},{key:"actions",header:"",width:"w-12",shrink:!0,align:"right",render:a=>(0,b.jsxs)(aQ.DropdownMenu,{children:[(0,b.jsx)(aQ.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(T.Button,{className:"size-8 p-0",size:"sm",variant:"ghost",children:(0,b.jsx)(aU.MoreHorizontal,{className:"size-4"})})}),(0,b.jsxs)(aQ.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,b.jsx)(aQ.DropdownMenuItem,{className:"cursor-pointer",asChild:!0,children:(0,b.jsxs)(F.default,{href:`/dashboard/team/${a.user_id}`,children:[(0,b.jsx)(aH.Eye,{className:"mr-2 size-4"}),"View Profile"]})}),(0,b.jsx)(aQ.DropdownMenuSeparator,{}),(0,b.jsxs)(aQ.DropdownMenuItem,{className:"text-destructive focus:text-destructive cursor-pointer",onClick:()=>f(a.id),disabled:!c,children:[(0,b.jsx)(br.default,{className:"mr-2 size-4"}),"Remove from Job"]})]})]})}],[l,m,c]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aZ.FullWidthDataTable,{...a_.TablePresets.compact(),columns:n,data:a,emptyIcon:(0,b.jsx)(bs.UserX,{className:"text-muted-foreground/50 size-12"}),emptyMessage:"No team members assigned to this job",getItemId:a=>a.id,noPadding:!0,searchFilter:(a,b)=>{let c=b.toLowerCase();return l(a).toLowerCase().includes(c)||a.team_member.user.email?.toLowerCase().includes(c)||a.team_member.job_title?.toLowerCase().includes(c)||a.role?.toLowerCase().includes(c)},searchPlaceholder:"Search team members..."}),(0,b.jsx)(U.Dialog,{onOpenChange:a=>!a&&f(null),open:null!==e,children:(0,b.jsxs)(U.DialogContent,{children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsx)(U.DialogTitle,{children:"Remove Team Member from Job?"}),(0,b.jsx)(U.DialogDescription,{children:"This will remove this team member's assignment to this job. The team member will remain in the system but will no longer be associated with this job."})]}),(0,b.jsxs)(U.DialogFooter,{children:[(0,b.jsx)(T.Button,{disabled:g,onClick:()=>f(null),variant:"outline",children:"Cancel"}),(0,b.jsx)(T.Button,{disabled:g,onClick:k,variant:"destructive",children:g?"Removing...":"Remove Member"})]})]})})]})}var bu=a.i(774804),bv=a.i(891032);function bw({entityData:a,jobData:N,metrics:R}){let S=a||N,as=S?.job??S??null;if(!as)return(0,b.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"Job Not Found"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"This job may have been deleted or you don't have access to it."})]})});let at=(0,G.useRouter)(),{toast:au}=(0,Y.useToast)(),av=(0,am.useRoleStore)(a=>a.role),[aw,ax]=(0,H.useTransition)(),ay=(0,H.useRef)(0),aA=(0,H.useCallback)(()=>{let a=Date.now();a-ay.current<1e3?console.warn("⚠️ Refresh called too frequently, skipping to prevent loop"):(ay.current=a,ax(()=>{at.refresh()}))},[at]),[aB,aC]=(0,H.useState)(()=>S?.job?{...S.job,priority:S.job.priority||"medium"}:{priority:"medium"}),[aD,aE]=(0,H.useState)(!1),[aF,aH]=(0,H.useState)(!1),[aI,aK]=(0,H.useState)(!1),[aL,aM]=(0,H.useState)(!1),[aO,aP]=(0,H.useState)(!1),[aQ,aS]=(0,H.useState)(!1),[aT,aU]=(0,H.useState)(!1),[aV,aW]=(0,H.useState)(!1),[aX,aY]=(0,H.useState)(!1),[aZ,a$]=(0,H.useState)(!1),[a_,a1]=(0,H.useState)(!1),[a2,a4]=(0,H.useState)(""),[a5,a6]=(0,H.useState)(""),[a8,bb]=(0,H.useState)(""),[bc,bf]=(0,H.useState)(!1),[bg,bh]=(0,H.useState)(!1),[bi,bj]=(0,H.useState)(!1),[bk,bl]=(0,H.useState)(!1),[bm,bp]=(0,H.useState)(!1),[br,bs]=(0,H.useState)(!1),[bw,bx]=(0,H.useState)(""),[by,bz]=(0,H.useState)(""),[bA,bB]=(0,H.useState)(""),[bC,bD]=(0,H.useState)(""),[bE,bF]=(0,H.useState)(!1),[bG,bH]=(0,H.useState)([]),[bI,bJ]=(0,H.useState)([]),[bK,bL]=(0,H.useState)([]),[bM,bN]=(0,H.useState)([]),{customer:bO,property:bP,assignedUser:bQ,teamAssignments:bR=[],availableTeamMembers:bS=[],timeEntries:bT=[],invoices:bU=[],estimates:bV=[],payments:bW=[],purchaseOrders:bX=[],tasks:bY=[],photos:bZ=[],documents:b$=[],signatures:b_=[],activities:b0=[],communications:b1=[],equipment:b2=[],jobEquipment:b3=[],jobMaterials:b4=[],jobNotes:b5=[],schedules:b6=[],allCustomers:b7=[],allProperties:b8=[],companyPhones:b9=[]}=S||{},[ca,cb]=(0,H.useState)(bV),[cc,cd]=(0,H.useState)(bU),[ce,cf]=(0,H.useState)(bW),[cg,ch]=(0,H.useState)(b3),[ci,cj]=(0,H.useState)(bY),[ck,cl]=(0,H.useState)(b5),cm=(0,H.useRef)(bV),cn=(0,H.useRef)(bU),co=(0,H.useRef)(bW),cp=(0,H.useRef)(b3),cq=(0,H.useRef)(bY),cr=(0,H.useRef)(b5);(0,H.useEffect)(()=>{let a=bV.length!==cm.current.length||bV.some((a,b)=>a?.id!==cm.current[b]?.id),b=bU.length!==cn.current.length||bU.some((a,b)=>a?.id!==cn.current[b]?.id),c=bW.length!==co.current.length||bW.some((a,b)=>a?.id!==co.current[b]?.id),d=b3.length!==cp.current.length||b3.some((a,b)=>a?.id!==cp.current[b]?.id),e=bY.length!==cq.current.length||bY.some((a,b)=>a?.id!==cq.current[b]?.id),f=b5.length!==cr.current.length||b5.some((a,b)=>a?.id!==cr.current[b]?.id);a&&(cb(bV),cm.current=bV),b&&(cd(bU),cn.current=bU),c&&(cf(bW),co.current=bW),d&&(ch(b3),cp.current=b3),e&&(cj(bY),cq.current=bY),f&&(cl(b5),cr.current=b5)},[bV,bU,bW,b3,bY,b5]);let cs=(0,H.useMemo)(()=>a?.job_tags?a.job_tags.map(a=>({label:a.name||a.label,color:a.color})):[],[a?.job_tags]);(0,H.useEffect)(()=>{bi&&as?.company_id&&(async()=>{let a=(0,ao.createClient)(),{data:b,error:c}=await a.from("estimates").select(`
					id,
					estimate_number,
					total_amount,
					status,
					created_at,
					customer:customers(id, name)
				`).eq("company_id",as.company_id).or(`job_id.is.null,job_id.neq.${as.id}`).order("created_at",{ascending:!1}).limit(50);!c&&b&&bH(b)})()},[bi,as?.company_id,as?.id]),(0,H.useEffect)(()=>{bk&&as?.company_id&&(async()=>{let a=(0,ao.createClient)(),{data:b,error:c}=await a.from("invoices").select(`
					id,
					invoice_number,
					total_amount,
					status,
					created_at,
					customer:customers(id, name)
				`).eq("company_id",as.company_id).or(`job_id.is.null,job_id.neq.${as.id}`).order("created_at",{ascending:!1}).limit(50);!c&&b&&bJ(b)})()},[bk,as?.company_id,as?.id]),(0,H.useEffect)(()=>{bm&&as?.company_id&&(async()=>{let a=(0,ao.createClient)(),{data:b,error:c}=await a.from("payments").select(`
					id,
					amount,
					payment_method,
					reference_number,
					created_at,
					customer:customers(id, name)
				`).eq("company_id",as.company_id).or(`job_id.is.null,job_id.neq.${as.id}`).order("created_at",{ascending:!1}).limit(50);!c&&b&&bL(b)})()},[bm,as?.company_id,as?.id]),(0,H.useEffect)(()=>{br&&as?.company_id&&(async()=>{let a=(0,ao.createClient)(),{data:b,error:c}=await a.from("equipment").select("id, name, category, serial_number, created_at").eq("company_id",as.company_id).order("created_at",{ascending:!1}).limit(50);!c&&b&&bN(b)})()},[br,as?.company_id]);let ct=(0,H.useMemo)(()=>({1:()=>{let a=document.querySelector('[data-section-id="customer"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},2:()=>{let a=document.querySelector('[data-section-id="team"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},3:()=>{let a=document.querySelector('[data-section-id="appointments"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},4:()=>{let a=document.querySelector('[data-section-id="estimates"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},5:()=>{let a=document.querySelector('[data-section-id="invoices"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},6:()=>{let a=document.querySelector('[data-section-id="payments"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},7:()=>{let a=document.querySelector('[data-section-id="purchase-orders"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},8:()=>{let a=document.querySelector('[data-section-id="tasks"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},9:()=>{let a=document.querySelector('[data-section-id="notes"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}}}),[]);(0,al.useSectionShortcuts)(ct);let[cu,cv]=(0,H.useState)(bO),[cw,cx]=(0,H.useState)(bP),cy=!!(cw?.lat&&cw?.lon)||!0,[cz,cA]=(0,H.useState)(""),[cB,cC]=(0,H.useState)(""),[cD,cE]=(0,H.useState)("search"),[cF,cG]=(0,H.useState)(!1),[cH,cI]=(0,H.useState)(!1),[cJ,cK]=(0,H.useState)(!1),[cL,cM]=(0,H.useState)(!1),[cN,cO]=(0,H.useState)({name:"",address:"",address2:"",city:"",state:"",zipCode:""}),[cP,cQ]=(0,H.useState)(!1),[cR,cS]=(0,H.useState)(!1),cT=H.default.useRef(null),cU=(0,an.useUIStore)(a=>a.setIncomingCall),cV=cu?.id?b8.filter(a=>a.customer_id===cu.id):[],cW=(a,b)=>{aC({...aB,[a]:b}),aE(!0)},cX=async()=>{if(!cu?.id)return void au.error("Please select a customer first");cM(!0);try{let a=new FormData;a.append("customerId",cu.id),a.append("name",cN.name),a.append("address",cN.address),a.append("address2",cN.address2),a.append("city",cN.city),a.append("state",cN.state),a.append("zipCode",cN.zipCode);let b=await O(a);if(b.success&&b.data){let a=new FormData;a.append("propertyId",b.data);let c=await (0,M.updateJob)(as.id,a);c.success?(au.success("Property created and assigned successfully"),cK(!1),cO({name:"",address:"",address2:"",city:"",state:"",zipCode:""})):au.error(c.error||"Failed to assign property to job")}else au.error(b.error??"Failed to create property")}catch(a){au.error("Failed to create property")}finally{cM(!1)}},cY=async(a,b)=>{try{let c=await P({jobId:as.id,teamMemberId:a,role:b});c.success?(au.success("Team member assigned"),aA()):(console.error("Assignment failed:",c.error,c),au.error(c.error||"Failed to assign team member"))}catch(b){console.error("Failed to assign team member:",b);let a=b instanceof Error?b.message:"Failed to assign team member";au.error(a)}},cZ=async a=>{try{let b=await Q({jobId:as.id,teamMemberId:a});if(b.success)return au.success("Team member removed"),aA(),{success:!0};{let a=b.error||"Failed to remove team member";return au.error(a),{success:!1,error:a}}}catch(b){console.error("Failed to remove team member:",b);let a=b instanceof Error?b.message:"Failed to remove team member";return au.error(a),{success:!1,error:a}}};b7.filter(a=>{if(!cz)return!0;let b=cz.toLowerCase(),c=`${a.first_name} ${a.last_name}`.toLowerCase(),d=a.phone?.toLowerCase()||"",e=a.email?.toLowerCase()||"",f=a.company_name?.toLowerCase()||"";return c.includes(b)||d.includes(b)||e.includes(b)||f.includes(b)}),cV.filter(a=>{if(!cB)return!0;let b=cB.toLowerCase(),c=a.name?.toLowerCase()||"",d=a.address?.toLowerCase()||"",e=a.city?.toLowerCase()||"";return c.includes(b)||d.includes(b)||e.includes(b)});let c$=async()=>{let a={...aB};aH(!0);try{let b=new FormData;aB.title!==S.job.title&&b.append("title",aB.title),aB.description!==S.job.description&&b.append("description",aB.description||""),aB.status!==S.job.status&&b.append("status",aB.status),aB.priority!==S.job.priority&&b.append("priority",aB.priority||"medium"),aB.job_type!==S.job.job_type&&b.append("jobType",aB.job_type||""),aB.notes!==S.job.notes&&b.append("notes",aB.notes||"");let c=await (0,M.updateJob)(S.job.id,b);if(c.success){au.success("Changes saved successfully"),aE(!1);let a={...aB};b.has("title")&&(a.title=b.get("title")),b.has("description")&&(a.description=b.get("description")),b.has("status")&&(a.status=b.get("status")),b.has("priority")&&(a.priority=b.get("priority")),b.has("jobType")&&(a.job_type=b.get("jobType")),b.has("notes")&&(a.notes=b.get("notes")),aC(a)}else aC(a),aE(!1),au.error(c.error||"Failed to save changes - changes reverted")}catch(b){aC(a),aE(!1),au.error("Failed to save changes - changes reverted")}finally{aH(!1)}},c_=async a=>{let b=new FormData;void 0!==a.labor_hours_estimated&&b.append("labor_hours_estimated",a.labor_hours_estimated.toString()),void 0!==a.labor_hours_actual&&b.append("labor_hours_actual",a.labor_hours_actual.toString()),void 0!==a.labor_rate&&b.append("labor_rate",a.labor_rate.toString()),void 0!==a.labor_burden_percent&&b.append("labor_burden_percent",a.labor_burden_percent.toString()),void 0!==a.labor_cost_total&&b.append("labor_cost_total",a.labor_cost_total.toString()),void 0!==a.materials_cost_actual&&b.append("materials_cost_actual",a.materials_cost_actual.toString()),void 0!==a.materials_markup_percent&&b.append("materials_markup_percent",a.materials_markup_percent.toString()),void 0!==a.materials_revenue&&b.append("materials_revenue",a.materials_revenue.toString()),void 0!==a.equipment_cost&&b.append("equipment_cost",a.equipment_cost.toString()),void 0!==a.subcontractor_cost&&b.append("subcontractor_cost",a.subcontractor_cost.toString()),void 0!==a.overhead_allocation&&b.append("overhead_allocation",a.overhead_allocation.toString()),void 0!==a.total_cost_actual&&b.append("total_cost_actual",a.total_cost_actual.toString()),void 0!==a.total_revenue&&b.append("total_revenue",a.total_revenue.toString()),void 0!==a.profit_margin_actual&&b.append("profit_margin_actual",a.profit_margin_actual.toString()),void 0!==a.profit_margin_target&&b.append("profit_margin_target",a.profit_margin_target.toString());let c=await (0,M.updateJob)(as.id,b);if(c.success)au.success("Job costing updated successfully");else throw au.error(c.error||"Failed to update job costing"),Error(c.error||"Failed to update job costing")},c0=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a/100),c1=a=>a?new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}).format(new Date(a)):"Not set",c2=a=>{if(!a)return"—";let b="string"==typeof a||"number"==typeof a?new Date(a):a;if(!b||Number.isNaN(b.getTime()))return"—";let c=Math.round((b.getTime()-Date.now())/6e4),d=new Intl.RelativeTimeFormat("en",{numeric:"auto"});if(60>Math.abs(c))return d.format(c,"minute");let e=Math.round(c/60);if(24>Math.abs(e))return d.format(e,"hour");let f=Math.round(e/24);if(30>Math.abs(f))return d.format(f,"day");let g=Math.round(f/30);if(12>Math.abs(g))return d.format(g,"month");let h=Math.round(g/12);return d.format(h,"year")},c3=cu?`/dashboard/customers/${cu.id}`:null,c4=a=>{if(!a)return null;if("string"==typeof a)try{return JSON.parse(a)}catch{return null}return"object"==typeof a?a:null},c5=(0,H.useMemo)(()=>{let a=a=>a.filter(a=>"string"==typeof a&&a.trim().length>0).map(a=>a.trim());if(!cu?.tags)return[];if(Array.isArray(cu.tags))return a(cu.tags);if("string"==typeof cu.tags)try{let b=JSON.parse(cu.tags);if(Array.isArray(b))return a(b);if("string"==typeof b)return b.split(",").map(a=>a.trim()).filter(Boolean)}catch{return cu.tags.split(",").map(a=>a.trim()).filter(Boolean)}return[]},[cu?.tags]),c6=(0,H.useMemo)(()=>{let a=c4(cu?.metadata);return a&&"object"==typeof a?a:{}},[cu?.metadata,c4]),c7=(0,H.useMemo)(()=>{let a=c4(cu?.communication_preferences);return a&&"object"==typeof a?a:null},[cu?.communication_preferences,c4]),c8=(0,H.useMemo)(()=>{let a=c6.membershipTier||c6.membership_level||c6.membership||c6.plan;return a||(c5.find(a=>{if("string"!=typeof a)return!1;let b=a.toLowerCase();return["vip","member","plan","tier","priority"].some(a=>b.includes(a))})??null)},[c6,c5]),c9=cu?.outstanding_balance??cu?.outstandingBalance??0,da=(0,H.useMemo)(()=>cu?"blocked"===(cu.status||"").toLowerCase()?{tone:"destructive",label:"Credit Hold",description:"Account is blocked until balance issues are resolved."}:c9>0?{tone:"warning",label:"Balance Due",description:`${c0(c9)} outstanding`}:"inactive"===(cu.status||"").toLowerCase()?{tone:"warning",label:"Inactive",description:"Customer marked inactive. Reactivate to schedule work."}:{tone:"positive",label:"In Good Standing",description:"No outstanding balances or restrictions."}:{tone:"neutral",label:"No customer",description:""},[cu,c9,c0]),db={positive:"border-emerald-100 bg-emerald-50 text-emerald-700 dark:border-emerald-400/20 dark:bg-emerald-400/10 dark:text-emerald-200",warning:"border-warning bg-warning text-warning dark:border-warning/20 dark:bg-warning/10 dark:text-warning",destructive:"border-rose-100 bg-rose-50 text-rose-700 dark:border-rose-400/20 dark:bg-rose-400/10 dark:text-rose-200",neutral:"border-muted bg-muted/40 text-muted-foreground dark:border-muted/30 dark:bg-muted/20 dark:text-muted-foreground"},dc=db[da.tone]??db.neutral,dd=(cu?.payment_terms??cu?.paymentTerms??"due_on_receipt").replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()),de=cu?.credit_limit??cu?.creditLimit??0,df=(0,H.useMemo)(()=>(Array.isArray(cc)?cc:[]).filter(a=>["sent","viewed","partial","overdue"].includes((a?.status||"").toLowerCase())),[cc]),dg=(0,H.useMemo)(()=>{let a=Date.now();return df.filter(b=>{if("overdue"===(b?.status||"").toLowerCase())return!0;let c=b?.due_date??b?.dueDate??b?.due_on??b?.dueOn;if(!c)return!1;let d=new Date(c);return!Number.isNaN(d.getTime())&&d.getTime()<a})},[df]);(0,H.useMemo)(()=>df.reduce((a,b)=>a+((b?.balance_amount??b?.balanceAmount??0)||0),0),[df]);let dh=(0,H.useMemo)(()=>{let a=df.map(a=>{let b=a?.due_date??a?.dueDate??a?.due_on??a?.dueOn;return{invoice:a,dueDate:b?new Date(b):null}}).filter(a=>a.dueDate&&!Number.isNaN(a.dueDate.getTime())).sort((a,b)=>a.dueDate?.getTime()-b.dueDate?.getTime());return a[0]?.invoice??null},[df]),di=(0,H.useMemo)(()=>{let a=Array.isArray(b6)?b6:[],b=Date.now();return a.map(a=>{let b=a?.start_time??a?.startTime??a?.start_at??a?.startAt;return{schedule:a,startDate:b?new Date(b):null}}).filter(({startDate:a})=>a&&!Number.isNaN(a.getTime())&&a.getTime()>b).sort((a,b)=>a.startDate?.getTime()-b.startDate?.getTime()).map(({schedule:a})=>a)},[b6])[0]??null,dj=b1?.[0]??null,dk=(0,H.useMemo)(()=>c7?[{key:"email",label:"Email",enabled:c7.email??c7.Email??!0},{key:"sms",label:"SMS",enabled:c7.sms??c7.SMS??!1},{key:"phone",label:"Phone",enabled:c7.phone??c7.Phone??!1}]:null,[c7]),dl=cu?.preferred_contact_method??cu?.preferredContactMethod??("string"==typeof c7?.preferred?c7?.preferred:null)??"email",dm=dl?dl.replace(/_/g," "):"Not set",dn=cu?.source??c6?.source??c6?.acquiredVia??"—",dp=cu?.portal_enabled??cu?.portalEnabled??!1,dq=cu?.portal_last_login_at??cu?.portalLastLoginAt??null,dr=cu?.created_at??cu?.createdAt??null;cu?.last_invoice_date??cu?.lastInvoiceDate,cu?.last_payment_date??cu?.lastPaymentDate;let ds=cu?.last_job_date??cu?.lastJobDate??null,dt=cu?.average_job_value??cu?.averageJobValue??0,du=cu?.total_revenue??cu?.totalRevenue??0,dv=cu?.total_jobs??cu?.totalJobs??0;df.length;let dw=dg.length;cu?.internal_notes??cu?.internalNotes;let dx=(0,H.useMemo)(()=>{if(!Array.isArray(bR)||0===bR.length)return[];let a=new Set;return bR.map(b=>{let c=b?.team_member||b?.teamMember;if(!c)return null;let d=c.users||c.user||b?.user||b?.assigned_user,e=c.id??b.id;return!e||a.has(e)?null:(a.add(e),{id:e,userId:d?.id??c.user_id??b.user_id??null,name:d?.name??c.name??c.display_name??"Team member",title:c.job_title??b.job_title??b.role??d?.job_title??null,avatar:d?.avatar??d?.avatar_url??d?.profile_image_url??c.avatar??null,email:d?.email??c.email??null})}).filter(Boolean)},[bR]),dy=(0,H.useMemo)(()=>Array.isArray(bR)&&0!==bR.length?Array.from(new Set(bR.map(a=>a.team_member_id||a.teamMemberId||a.team_member?.id||a.id||null).filter(a=>!!a))):[],[bR]);[cu?.address,cu?.city,cu?.state,cu?.zip_code??cu?.zipCode].filter(Boolean).join(", ");let dz=cu?.secondary_phone??cu?.secondaryPhone??null,dA=cu?.billing_email??cu?.billingEmail??cu?.email??null;dj?.created_at??dj?.createdAt,dj?.channel??dj?.type??dj?.medium,dh?.due_date??dh?.dueDate??dh?.due_on??dh?.dueOn,dh?.balance_amount??dh?.balanceAmount;let dB=(cu?.status||"active").replace(/_/g," ");(as?[(0,b.jsxs)(ad.Badge,{className:"font-mono text-xs",variant:"secondary",children:["#",as.job_number]},"job-number"),aB.status?(0,b.jsx)(ad.Badge,{className:"font-medium capitalize",variant:(a=>{switch(a?.toLowerCase()){case"paid":case"approved":case"completed":case"in_progress":return"default";case"sent":case"scheduled":case"confirmed":default:return"secondary";case"overdue":case"cancelled":case"no_show":return"destructive";case"rescheduled":case"draft":case"pending":return"outline"}})(aB.status),children:aB.status.replace(/_/g," ")},"job-status"):null,aB.priority?(0,b.jsx)(ad.Badge,{className:"font-medium capitalize",variant:"high"===aB.priority||"urgent"===aB.priority?"destructive":"outline",children:aB.priority},"job-priority"):null]:[]).filter(Boolean);let dC=async()=>{aS(!0);try{let a=await (0,J.archiveJob)(as.id);a.success?(au.success("Job archived successfully"),aP(!1),at.push("/dashboard/work")):au.error(a.error||"Failed to archive job")}catch{au.error("Failed to archive job")}finally{aS(!1)}};cu&&(F.default,cu.id,C.User,cu.first_name,cu.last_name),cw&&(b.Fragment,F.default,cw.id,q.MapPin,cw.city,cw.state,cw.zip_code||cw.zipCode),aD&&[].unshift((0,b.jsx)(T.Button,{onClick:()=>{aC({...as,priority:as.priority||"medium"}),aE(!1)},size:"sm",variant:"outline",children:"Cancel"},"cancel"),(0,b.jsxs)(T.Button,{disabled:aF,onClick:c$,size:"sm",children:[(0,b.jsx)(w.Save,{className:"mr-2 h-4 w-4"}),aF?"Saving...":"Save Changes"]},"save"));let dD={title:(0,b.jsx)(az,{job:aB,customer:cu,property:cw,metrics:R,teamAssignments:bR,timeEntries:bT,invoices:cc,payments:ce,estimates:ca,userRole:av,onTitleChange:a=>cW("title",a),onSave:c$,onCancel:()=>{aC({...as,priority:as.priority||"medium"}),aE(!1)},isSaving:aF,hasChanges:aD})};(0,H.useMemo)(()=>cw?{address:cw.address,city:cw.city,state:cw.state,zip_code:cw.zip_code,lat:cw.lat,lon:cw.lon}:void 0,[cw?.address,cw?.city,cw?.state,cw?.zip_code,cw?.lat,cw?.lon]);let dE=(0,b.jsx)("div",{className:"space-y-3",children:(0,b.jsx)(_.DetailPageSurface,{padding:"sm",variant:"default",className:"rounded-xl",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,b.jsx)(W.StandardFormField,{label:"Status",className:"mb-0 min-w-[140px]",children:(0,b.jsx)(bn,{currentStatus:aB.status||"quoted",onStatusChange:a=>cW("status",a),job:{id:S.job.id,scheduled_start:aB.scheduled_start||S.job.scheduled_start,scheduled_end:aB.scheduled_end||S.job.scheduled_end,assigned_to:aB.assigned_to||S.job.assigned_to,customer_id:aB.customer_id||S.job.customer_id,property_id:aB.property_id||S.property?.id,total_amount:aB.total_amount||S.job.total_amount,invoices:S.invoices,estimates:S.estimates,teamAssignments:S.teamAssignments}})}),(0,b.jsx)(W.StandardFormField,{label:"Priority",className:"mb-0 min-w-[120px]",children:(0,b.jsxs)(V.Select,{onValueChange:a=>cW("priority",a),value:aB.priority||void 0,children:[(0,b.jsx)(V.SelectTrigger,{className:"h-8",children:(0,b.jsx)(V.SelectValue,{placeholder:"Set priority",children:(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)(d.AlertCircle,{className:"h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"capitalize text-xs",children:aB.priority||"Set priority"})]})})}),(0,b.jsxs)(V.SelectContent,{children:[(0,b.jsx)(V.SelectItem,{value:"low",children:"Low"}),(0,b.jsx)(V.SelectItem,{value:"medium",children:"Medium"}),(0,b.jsx)(V.SelectItem,{value:"high",children:"High"}),(0,b.jsx)(V.SelectItem,{value:"urgent",children:"Urgent"})]})]})}),cw&&(0,b.jsx)(W.StandardFormField,{label:"Travel",className:"mb-0",children:(0,b.jsx)(bu.TravelTime,{property:cw})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-4 lg:grid-cols-6",children:[cu&&(0,b.jsxs)(ag.Popover,{children:[(0,b.jsx)(ag.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)("button",{className:"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50",children:[(0,b.jsxs)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1",children:[(0,b.jsx)(C.User,{className:"h-2.5 w-2.5"}),"Customer"]}),(0,b.jsx)("div",{className:"text-xs font-medium truncate",children:cu.display_name||`${cu.first_name} ${cu.last_name}`}),(0,b.jsx)("div",{className:"text-[10px] text-muted-foreground truncate",children:cu.phone||cu.email||cu.type||""})]})}),(0,b.jsx)(ag.PopoverContent,{className:"w-64",align:"start",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Name"}),(0,b.jsx)(F.default,{href:`/dashboard/customers/${cu.id}`,className:"text-sm font-medium text-primary hover:underline",children:cu.display_name||`${cu.first_name} ${cu.last_name}`})]}),cu.phone&&(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Phone"}),(0,b.jsx)("a",{href:`tel:${cu.phone}`,className:"text-sm text-primary hover:underline",children:cu.phone})]}),cu.email&&(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Email"}),(0,b.jsx)("a",{href:`mailto:${cu.email}`,className:"text-sm text-primary hover:underline",children:cu.email})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Type"}),(0,b.jsx)(ad.Badge,{variant:"outline",className:"text-xs",children:cu.type||"residential"})]})]})})]}),cw&&(0,b.jsxs)(ag.Popover,{children:[(0,b.jsx)(ag.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)("button",{className:"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50",children:[(0,b.jsxs)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1",children:[(0,b.jsx)(q.MapPin,{className:"h-2.5 w-2.5"}),"Location"]}),(0,b.jsx)("div",{className:"text-xs font-medium truncate",children:cw.address}),(0,b.jsxs)("div",{className:"text-[10px] text-muted-foreground truncate",children:[cw.city,", ",cw.state]})]})}),(0,b.jsx)(ag.PopoverContent,{className:"w-64",align:"start",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Address"}),(0,b.jsxs)("div",{className:"text-sm",children:[cw.address,cw.address_line2&&`, ${cw.address_line2}`,(0,b.jsx)("br",{}),cw.city,", ",cw.state," ",cw.zip]}),cw.lat&&cw.lon&&(0,b.jsxs)("a",{href:`https://www.google.com/maps?q=${cw.lat},${cw.lon}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline mt-1 inline-flex items-center gap-1",children:[(0,b.jsx)(l.ExternalLink,{className:"h-3 w-3"}),"Open in Maps"]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Type"}),(0,b.jsx)(ad.Badge,{variant:"outline",className:"text-xs",children:cw.property_type||"Unknown"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Access"}),cw.access_code?(0,b.jsx)("code",{className:"text-xs bg-muted px-1.5 py-0.5 rounded",children:cw.access_code}):(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"None"})]})]})]})})]}),(0,b.jsxs)(ag.Popover,{children:[(0,b.jsx)(ag.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)("button",{className:"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50",children:[(0,b.jsxs)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1",children:[(0,b.jsx)(f.Calendar,{className:"h-2.5 w-2.5"}),"Schedule"]}),aB.scheduled_start?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"text-xs font-medium",children:new Date(aB.scheduled_start).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}),(0,b.jsxs)("div",{className:"text-[10px] text-muted-foreground",children:[bR?.length||0," tech",bR?.length!==1?"s":""]})]}):(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Not scheduled"})]})}),(0,b.jsx)(ag.PopoverContent,{className:"w-64",align:"start",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Start"}),(0,b.jsx)("div",{className:"text-sm",children:aB.scheduled_start?c1(aB.scheduled_start):"Not set"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"End"}),(0,b.jsx)("div",{className:"text-sm",children:aB.scheduled_end?c1(aB.scheduled_end):"Not set"})]})]}),bR&&bR.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"text-xs text-muted-foreground mb-1",children:["Team (",bR.length,")"]}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:bR.map(a=>(0,b.jsx)(ad.Badge,{variant:"secondary",className:"text-xs",children:a.user?.name||"Unknown"},a.id))})]})]})})]}),(0,b.jsxs)(ag.Popover,{children:[(0,b.jsx)(ag.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)("button",{className:"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50",children:[(0,b.jsxs)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1",children:[(0,b.jsx)(j.DollarSign,{className:"h-2.5 w-2.5"}),"Financial"]}),(0,b.jsx)("div",{className:"text-xs font-semibold",children:c0(aB.total_amount||0)}),(0,b.jsx)("div",{className:"text-[10px] text-muted-foreground",children:ce&&ce.length>0?`${c0(ce.reduce((a,b)=>a+(b.amount||0),0))} paid`:"$0 paid"})]})}),(0,b.jsx)(ag.PopoverContent,{className:"w-64",align:"start",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Job Value"}),(0,b.jsx)("div",{className:"text-sm font-semibold",children:c0(aB.total_amount||0)})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Payments"}),(0,b.jsx)("div",{className:"text-sm font-semibold text-green-600 dark:text-green-400",children:ce&&ce.length>0?c0(ce.reduce((a,b)=>a+(b.amount||0),0)):"$0"}),(0,b.jsxs)("div",{className:"text-[10px] text-muted-foreground",children:[ce?.length||0," payment",ce?.length!==1?"s":""]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Estimates"}),(0,b.jsx)("div",{className:"text-sm",children:ca?.length||0}),ca&&ca.length>0&&(0,b.jsx)(ad.Badge,{variant:ca.some(a=>"accepted"===a.status)?"default":"secondary",className:"text-[10px] mt-0.5",children:ca.find(a=>"accepted"===a.status)?"Accepted":"Pending"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Invoices"}),(0,b.jsx)("div",{className:"text-sm",children:cc?.length||0})]})]})]})})]}),(0,b.jsxs)(ag.Popover,{children:[(0,b.jsx)(ag.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)("button",{className:"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50",children:[(0,b.jsxs)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1",children:[(0,b.jsx)(r.MessageSquare,{className:"h-2.5 w-2.5"}),"Activity"]}),(0,b.jsxs)("div",{className:"text-xs font-medium",children:[(b1?.length||0)+(ck?.length||0)+(bZ?.length||0)+(b$?.length||0)," ","items"]}),(0,b.jsxs)("div",{className:"text-[10px] text-muted-foreground",children:[b1?.length||0," msg • ",ck?.length||0," ","notes"]})]})}),(0,b.jsx)(ag.PopoverContent,{className:"w-64",align:"start",children:(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Messages"}),(0,b.jsx)("div",{className:"text-sm font-semibold",children:b1?.length||0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),(0,b.jsx)("div",{className:"text-sm font-semibold",children:ck?.length||0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Photos"}),(0,b.jsx)("div",{className:"text-sm font-semibold",children:bZ?.length||0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Documents"}),(0,b.jsx)("div",{className:"text-sm font-semibold",children:b$?.length||0})]})]})})]}),(0,b.jsxs)(ae.Collapsible,{children:[(0,b.jsx)(ae.CollapsibleTrigger,{asChild:!0,children:(0,b.jsxs)("button",{className:"text-left p-2 rounded-md hover:bg-muted/50 transition-colors border border-transparent hover:border-border/50 w-full",children:[(0,b.jsxs)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wide mb-1 flex items-center gap-1",children:[(0,b.jsx)(E.Wrench,{className:"h-2.5 w-2.5"}),"Service"]}),(0,b.jsx)("div",{className:"text-xs font-medium truncate",children:aB.service_type||aB.job_type||"Not set"}),(0,b.jsxs)("div",{className:"text-[10px] text-muted-foreground",children:[cg?.length||0," equipment"]})]})}),(0,b.jsx)(ae.CollapsibleContent,{className:"mt-2",children:(0,b.jsxs)("div",{className:"space-y-2 p-2 bg-muted/30 rounded-md",children:[(0,b.jsx)(W.StandardFormField,{label:"Service Type",htmlFor:"service-type",className:"mb-0",children:(0,b.jsx)(af.Input,{id:"service-type",onChange:a=>cW("service_type",a.target.value),placeholder:"e.g. HVAC Maintenance",value:aB.service_type||aB.job_type||"",className:"h-8 text-sm"})}),cg&&cg.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Equipment"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1.5",children:cg.map(a=>(0,b.jsx)(ad.Badge,{variant:"outline",className:"text-xs",children:a.equipment?.name||a.equipment_id},a.id))})]}),(0,b.jsx)(W.StandardFormField,{label:"Description",htmlFor:"job-description",className:"mb-0",children:(0,b.jsx)(X.Textarea,{id:"job-description",onChange:a=>cW("description",a.target.value),placeholder:"Add context, expectations, or key notes for the crew.",value:aB.description||"",className:"min-h-[60px] text-sm"})})]})})]})]}),(0,b.jsx)("div",{className:"flex justify-end pt-2 border-t border-border/40",children:(0,b.jsx)(bd,{currentStatus:as.status,jobId:as.id})})]})})}),dF=[];dF.push({id:"customer",title:"Customer & Property",icon:(0,b.jsx)(C.User,{className:"size-4"}),count:+!!cu,actions:(0,b.jsx)(aR,{currentCustomer:cu?{id:cu.id,first_name:cu.first_name||"",last_name:cu.last_name||"",display_name:cu.display_name||"",email:cu.email||"",phone:cu.phone||"",company_name:cu.company_name,type:cu.type||"residential",address:cu.address,city:cu.city,state:cu.state,zip:cu.zip}:null,currentProperty:cw?{id:cw.id,customer_id:cw.customer_id,address:cw.address||"",address_line2:cw.address_line2,city:cw.city||"",state:cw.state||"",zip:cw.zip||"",property_type:cw.property_type}:null,getCustomerProperties:aq,onAssignCustomer:async(a,b)=>{let c=await (0,K.assignCustomerToJob)(as.id,a.id,b?.id||null);c.success?(cv(a),cx(b??null),au.success("Customer and property assigned successfully"),aA()):au.error(c.error||"Failed to assign customer")},onRemoveCustomer:async()=>{let a=await (0,L.removeCustomerFromJob)(as.id);a.success?(cv(null),cx(null),au.success("Customer and property removed successfully"),aA()):au.error(a.error||"Failed to remove customer")},onRemoveProperty:async()=>{if(!cu)return;let a=await (0,K.assignCustomerToJob)(as.id,cu.id,null);a.success?(cx(null),au.success("Property removed from job"),aA()):au.error(a.error||"Failed to remove property")},searchCustomers:ar}),content:(0,b.jsx)(ak.UnifiedAccordionContent,{className:"space-y-6",children:(0,b.jsxs)("div",{className:"flex flex-col gap-6 lg:flex-row",children:[cu?(0,b.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col gap-6",children:[(0,b.jsx)("div",{className:"border-border/60 bg-card/80 rounded-xl border p-6 shadow-sm",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-6",children:[(0,b.jsxs)("div",{className:"flex min-w-0 items-start gap-4",children:[(0,b.jsxs)("div",{className:"bg-primary/10 text-primary flex size-14 flex-shrink-0 items-center justify-center rounded-full text-xl font-semibold",children:[cu.first_name?.[0],cu.last_name?.[0]]}),(0,b.jsxs)("div",{className:"min-w-0 space-y-1.5",children:[c3?(0,b.jsxs)(F.default,{className:"text-foreground hover:text-primary block text-lg font-semibold transition-colors",href:c3,children:[cu.first_name," ",cu.last_name]}):(0,b.jsxs)("span",{className:"text-foreground block text-lg font-semibold",children:[cu.first_name," ",cu.last_name]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)(ad.Badge,{className:"h-6 rounded-full px-2.5 text-[11px] font-medium capitalize",variant:"outline",children:dB}),(0,b.jsxs)("span",{className:(0,ap.cn)("inline-flex items-center gap-1 rounded-full border px-2.5 py-0.5 text-[11px] font-medium",dc),title:da.description,children:[(0,b.jsx)(x.ShieldCheck,{className:"h-3 w-3"}),da.label]}),c8&&(0,b.jsxs)("span",{className:"bg-primary/10 text-primary inline-flex items-center gap-1 rounded-full px-2.5 py-0.5 text-[11px] font-medium",children:[(0,b.jsx)(y.Sparkles,{className:"h-3 w-3"}),c8]})]})]})]}),c3&&(0,b.jsx)(T.Button,{asChild:!0,className:"flex-shrink-0",size:"sm",variant:"outline",children:(0,b.jsxs)(F.default,{className:"flex items-center gap-1.5",href:c3,children:["View Profile",(0,b.jsx)(i.ChevronRight,{className:"h-3.5 w-3.5"})]})})]})}),(0,b.jsx)("div",{className:"border-border/60 bg-card/80 rounded-xl border shadow-sm",children:(0,b.jsxs)("div",{className:"divide-border/40 bg-muted/20 grid grid-cols-2 divide-x divide-y sm:divide-y-0 md:grid-cols-4 px-4 py-4 sm:px-6",children:[(0,b.jsxs)("div",{className:"px-3 py-3 first:pl-0 last:pr-0 sm:py-0",children:[(0,b.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Lifetime Value"}),(0,b.jsx)("div",{className:"text-foreground mt-1 text-lg font-bold",children:c0(du)}),(0,b.jsxs)("div",{className:"text-muted-foreground mt-0.5 text-xs",children:[dv," job",1===dv?"":"s"," ·"," ",c0(dt)," avg"]})]}),(0,b.jsxs)("div",{className:"px-3 py-3 first:pl-0 last:pr-0 sm:py-0",children:[(0,b.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Balance Due"}),(0,b.jsx)("div",{className:(0,ap.cn)("mt-1 text-lg font-bold",c9>0?"text-warning":"text-foreground"),children:c0(c9)}),(0,b.jsx)("div",{className:"text-muted-foreground mt-0.5 text-xs",children:dw>0?`${dw} overdue`:dd})]}),(0,b.jsxs)("div",{className:"px-3 py-3 first:pl-0 last:pr-0 sm:py-0",children:[(0,b.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Credit Limit"}),(0,b.jsx)("div",{className:"text-foreground mt-1 text-lg font-bold",children:de>0?c0(de):"None"}),(0,b.jsx)("div",{className:"text-muted-foreground mt-0.5 text-xs",children:de>0&&c9>0?`${Math.round(c9/de*100)}% used`:de>0?"Available":"Cash only"})]}),(0,b.jsxs)("div",{className:"px-3 py-3 first:pl-0 last:pr-0 sm:py-0",children:[(0,b.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Customer Since"}),(0,b.jsx)("div",{className:"text-foreground mt-1 text-lg font-bold",children:dr?c2(dr):"—"}),(0,b.jsxs)("div",{className:"text-muted-foreground mt-0.5 text-xs capitalize",children:["via ",dn]})]})]})}),(0,b.jsx)("div",{className:"border-border/60 bg-card/80 rounded-xl border p-6 shadow-sm",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Contact"}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[cu.email&&(0,b.jsx)(T.Button,{className:"h-7 w-7 p-0",onClick:()=>{let a=new URLSearchParams;a.set("compose","true"),a.set("to",cu.email),a.set("name",`${cu.first_name} ${cu.last_name}`),a.set("customerId",cu.id),at.push(`/dashboard/communication/email?${a.toString()}`)},size:"sm",title:"Send Email",variant:"outline",children:(0,b.jsx)(p.Mail,{className:"h-3.5 w-3.5"})}),cu.phone&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(T.Button,{className:"h-7 w-7 p-0",onClick:()=>{cU({number:cu.phone,name:`${cu.first_name} ${cu.last_name}`,avatar:cu.avatar_url})},size:"sm",title:"Call",variant:"outline",children:(0,b.jsx)(t.Phone,{className:"h-3.5 w-3.5"})}),(0,b.jsx)(T.Button,{className:"h-7 w-7 p-0",onClick:()=>cQ(!0),size:"sm",title:"Send Text Message",variant:"outline",children:(0,b.jsx)(r.MessageSquare,{className:"h-3.5 w-3.5"})})]})]})]}),(0,b.jsxs)("dl",{className:"grid gap-3",children:[cu.email&&(0,b.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,b.jsx)("div",{className:"bg-muted flex size-8 flex-shrink-0 items-center justify-center rounded-lg",children:(0,b.jsx)(p.Mail,{className:"text-muted-foreground h-3.5 w-3.5"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("dt",{className:"text-muted-foreground text-[10px] font-medium tracking-wide uppercase",children:"Email"}),(0,b.jsx)("dd",{className:"text-foreground truncate text-sm font-medium",children:cu.email})]})]}),cu.phone&&(0,b.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,b.jsx)("div",{className:"bg-muted flex size-8 flex-shrink-0 items-center justify-center rounded-lg",children:(0,b.jsx)(t.Phone,{className:"text-muted-foreground h-3.5 w-3.5"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("dt",{className:"text-muted-foreground text-[10px] font-medium tracking-wide uppercase",children:"Phone"}),(0,b.jsx)("dd",{className:"text-foreground text-sm font-medium",children:cu.phone})]})]}),dz&&(0,b.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,b.jsx)("div",{className:"bg-muted flex size-8 flex-shrink-0 items-center justify-center rounded-lg",children:(0,b.jsx)(t.Phone,{className:"text-muted-foreground h-3.5 w-3.5"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("dt",{className:"text-muted-foreground text-[10px] font-medium tracking-wide uppercase",children:"Alt Phone"}),(0,b.jsx)("dd",{className:"text-foreground text-sm font-medium",children:dz})]})]}),dA&&dA!==cu.email&&(0,b.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,b.jsx)("div",{className:"bg-muted flex size-8 flex-shrink-0 items-center justify-center rounded-lg",children:(0,b.jsx)(v.Receipt,{className:"text-muted-foreground h-3.5 w-3.5"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("dt",{className:"text-muted-foreground text-[10px] font-medium tracking-wide uppercase",children:"Billing Email"}),(0,b.jsx)("dd",{className:"text-foreground truncate text-sm font-medium",children:dA})]})]})]})]})}),(0,b.jsx)("div",{className:"border-border/60 bg-card/80 rounded-xl border p-6 shadow-sm",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Account Details"}),(0,b.jsxs)("dl",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("dt",{className:"text-muted-foreground text-xs",children:"Portal Access"}),(0,b.jsx)("dd",{className:"text-foreground mt-1 text-sm font-medium",children:dp?(0,b.jsxs)("span",{className:"inline-flex items-center gap-1.5 text-emerald-700 dark:text-emerald-200",children:[(0,b.jsx)(n.Globe,{className:"h-3.5 w-3.5"})," Enabled"]}):(0,b.jsx)("span",{className:"text-muted-foreground",children:"Disabled"})}),dp&&dq&&(0,b.jsxs)("dd",{className:"text-muted-foreground mt-0.5 text-xs",children:["Last login ",c2(dq)]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("dt",{className:"text-muted-foreground text-xs",children:"Preferred Contact"}),(0,b.jsx)("dd",{className:"text-foreground mt-1 text-sm font-medium capitalize",children:dm}),dk&&(0,b.jsx)("dd",{className:"mt-1.5 flex flex-wrap gap-1.5",children:dk.map(a=>a.enabled&&(0,b.jsx)("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-700 dark:bg-emerald-400/10 dark:text-emerald-200",children:a.label},a.key))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("dt",{className:"text-muted-foreground text-xs",children:"Last Activity"}),(0,b.jsx)("dd",{className:"text-foreground mt-1 text-sm font-medium",children:ds?c2(ds):"No activity"}),di&&(0,b.jsxs)("dd",{className:"text-muted-foreground mt-0.5 text-xs",children:["Next:"," ",c2(di.start_time??di.startTime??di.start_at??di.startAt)]})]})]})]})}),(0,b.jsx)("div",{className:"border-border/60 bg-card/80 rounded-xl border p-6 shadow-sm",children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(A.Tag,{className:"text-muted-foreground size-4"}),(0,b.jsx)("h4",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Job Tags"})]}),(0,b.jsx)(aa.EntityTags,{entityId:as.id,entityType:"job",tags:cs,onUpdateTags:async(a,b)=>{(await (0,I.updateEntityTags)("job",a,b)).success&&aA()}})]})}),(dx.length>0||c5.length>0)&&(0,b.jsx)("div",{className:"border-border/60 bg-card/80 rounded-xl border p-6 shadow-sm",children:(0,b.jsxs)("div",{className:"space-y-4",children:[dx.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Assigned Team"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:dx.filter(Boolean).map(a=>(0,b.jsxs)(F.default,{className:"group border-border/60 bg-background text-foreground hover:border-primary/50 hover:bg-primary/5 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-medium transition-colors",href:a?.id?`/dashboard/settings/team/${a.id}`:"/dashboard/settings/team",children:[(0,b.jsx)(ac.Avatar,{className:"bg-muted h-6 w-6 border border-white/10",children:a?.avatar?(0,b.jsx)(ac.AvatarImage,{alt:a?.name||"Team Member",src:a.avatar}):(0,b.jsx)(ac.AvatarFallback,{className:"text-[10px]",children:a?.name?.split(" ").map(a=>a[0]).join("").slice(0,2).toUpperCase()||"TM"})}),(0,b.jsx)("span",{children:a?.name||"Unknown"})]},a?.id||"unknown"))})]}),c5.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Tags"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:c5.map(a=>(0,b.jsx)("span",{className:"bg-primary/10 text-primary inline-flex items-center gap-1 rounded-full px-2.5 py-0.5 text-xs font-medium",children:a},a))})]})]})})]}):(0,b.jsxs)("div",{className:"border-border/60 bg-background flex flex-1 flex-col items-center justify-center rounded-xl border border-dashed p-6 text-center",children:[(0,b.jsx)("div",{className:"bg-muted mb-3 flex size-12 items-center justify-center rounded-full",children:(0,b.jsx)(C.User,{className:"text-muted-foreground size-6"})}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No customer assigned"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1 text-xs",children:"Assign a customer to unlock profile insights."})]}),(0,b.jsx)("aside",{className:"mt-6 space-y-6 lg:mt-0 lg:w-[360px]",children:cw?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"border-border/60 bg-card/80 rounded-xl border p-0 shadow-sm",children:cy?(0,b.jsx)(bv.PropertyLocationVisual,{property:cw}):(0,b.jsxs)("div",{className:"space-y-4 p-6",children:[(0,b.jsx)(ai.Skeleton,{className:"h-40 w-full rounded-lg"}),(0,b.jsxs)("div",{className:"text-muted-foreground space-y-1 text-sm",children:[(0,b.jsx)("p",{children:"Connect a Google Maps API key or add coordinates to visualize this location."}),(0,b.jsx)("p",{className:"text-xs",children:"Update property details to include latitude and longitude for enhanced routing."})]})]})}),(0,b.jsxs)("div",{className:"border-border/60 bg-card/80 space-y-3 rounded-xl border p-6 shadow-sm",children:[(0,b.jsx)("div",{className:"text-muted-foreground text-[10px] font-semibold tracking-wider uppercase",children:"Property Details"}),(0,b.jsxs)("dl",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("dt",{className:"text-muted-foreground text-xs",children:"Address"}),(0,b.jsxs)("dd",{className:"text-foreground",children:[cw.address,cw.address2?`, ${cw.address2}`:"",(0,b.jsx)("br",{}),cw.city,", ",cw.state," ",cw.zip_code]})]}),cw.square_footage&&(0,b.jsxs)("div",{children:[(0,b.jsx)("dt",{className:"text-muted-foreground text-xs",children:"Square Footage"}),(0,b.jsx)("dd",{className:"text-foreground",children:cw.square_footage})]}),cw.year_built&&(0,b.jsxs)("div",{children:[(0,b.jsx)("dt",{className:"text-muted-foreground text-xs",children:"Year Built"}),(0,b.jsx)("dd",{className:"text-foreground",children:cw.year_built})]})]})]})]}):(0,b.jsx)("div",{className:"border-border/60 bg-background text-muted-foreground flex flex-col items-center justify-center rounded-xl border border-dashed p-6 text-center text-sm",children:"No property assigned"})})]})})});let dG=(0,H.useMemo)(()=>Array.isArray(bR)&&0!==bR.length?bR.map(a=>{let b=a?.team_member||a?.teamMember;if(!b)return null;let c=b.user||b.users?.[0]||a?.user||a?.assigned_user,d=c?.id||b.user_id||a.user_id;if(!d)return null;let e=null;return c?.name?e=c.name:c?.first_name||c?.last_name?e=[c.first_name,c.last_name].filter(Boolean).join(" "):b.user?.name?e=b.user.name:c?.email&&(e=c.email),{id:a.id||a.team_member_id||b.id,user_id:d,team_member:{job_title:b.job_title||a.job_title||void 0,user:{name:e||void 0,email:c?.email||b.email||void 0,avatar_url:c?.avatar_url||c?.avatar||b.avatar||void 0,first_name:c?.first_name||(e?e.split(" ")[0]:void 0),last_name:c?.last_name||(e&&e.includes(" ")?e.split(" ").slice(1).join(" "):void 0)}},assigned_at:a.assigned_at||a.assignedAt||new Date().toISOString(),role:a.role||"crew"}}).filter(a=>null!==a):[],[bR]);dF.push({id:"team",title:"Team Members",icon:(0,b.jsx)(D.Users,{className:"size-4"}),count:dG.length,actions:(0,b.jsx)(bq,{availableMembers:bS,currentMemberIds:dy,onAssign:cY}),content:(0,b.jsx)(ak.UnifiedAccordionContent,{className:"overflow-x-auto p-0 sm:p-0",children:(0,b.jsx)(bt,{teamMembers:dG,onRemoveMember:cZ})})}),dF.push({id:"appointments",title:"Appointments",icon:(0,b.jsx)(f.Calendar,{className:"size-4"}),count:b6.length,actions:(0,b.jsxs)(T.Button,{onClick:()=>at.push(`/dashboard/schedule/new?jobId=${as.id}`),size:"sm",variant:"outline",children:[(0,b.jsx)(u.Plus,{className:"mr-2 h-4 w-4"})," Add Appointment"]}),content:(0,b.jsx)(ak.UnifiedAccordionContent,{className:"p-0 sm:p-0",children:(0,b.jsx)(aN,{appointments:b6})})}),dF.push({id:"equipment-serviced",title:"Equipment Serviced",icon:(0,b.jsx)(E.Wrench,{className:"size-4"}),count:cg.length,actions:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(T.Button,{onClick:()=>bs(!0),size:"sm",variant:"ghost",children:[(0,b.jsx)(o.Link2,{className:"mr-2 h-4 w-4"})," Link Existing"]}),(0,b.jsxs)(T.Button,{onClick:()=>at.push(`/dashboard/work/equipment/new?jobId=${as.id}`),size:"sm",variant:"outline",children:[(0,b.jsx)(u.Plus,{className:"mr-2 h-4 w-4"})," Add Equipment"]})]}),content:(0,b.jsx)(ak.UnifiedAccordionContent,{children:0===cg.length?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,b.jsx)("div",{className:"bg-muted mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full",children:(0,b.jsx)(E.Wrench,{className:"text-muted-foreground h-8 w-8"})}),(0,b.jsx)("h3",{className:"mb-2 text-lg font-semibold",children:"No equipment has been added to this job yet"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-4 text-sm",children:"Equipment serviced on this job will appear here"}),(0,b.jsxs)(T.Button,{onClick:()=>{},size:"sm",variant:"secondary",children:[(0,b.jsx)(u.Plus,{className:"mr-2 h-4 w-4"})," Add Equipment"]})]}):(0,b.jsx)("div",{className:"space-y-4",children:cg.map(a=>(0,b.jsxs)("div",{className:"hover:bg-accent/50 space-y-3 rounded-lg border p-4 transition-colors",children:[(0,b.jsx)("div",{className:"flex items-start justify-between",children:(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,b.jsx)("h4",{className:"font-semibold",children:a.equipment?.name}),(0,b.jsx)(ad.Badge,{variant:"secondary",children:a.service_type})]}),(0,b.jsx)("div",{className:"text-muted-foreground space-y-1 text-sm",children:(0,b.jsxs)("p",{children:[a.equipment?.manufacturer," ",a.equipment?.model,a.equipment?.serial_number&&` • SN: ${a.equipment.serial_number}`]})})]})}),a.work_performed&&(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("span",{className:"font-medium",children:"Work Performed:"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:a.work_performed})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-4 text-sm",children:[a.condition_before&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground mr-2",children:"Before:"}),(0,b.jsx)(ad.Badge,{variant:"outline",children:a.condition_before})]}),a.condition_after&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground mr-2",children:"After:"}),(0,b.jsx)(ad.Badge,{variant:"default",children:a.condition_after})]})]})]},a.id))})})}),b2.length>0&&dF.push({id:"equipment",title:"Customer Equipment at Property",icon:(0,b.jsx)(e.Building2,{className:"size-4"}),count:b2.length,content:(0,b.jsx)(ak.UnifiedAccordionContent,{className:"p-0",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(aj.Table,{children:[(0,b.jsx)(aj.TableHeader,{children:(0,b.jsxs)(aj.TableRow,{children:[(0,b.jsx)(aj.TableHead,{children:"Equipment"}),(0,b.jsx)(aj.TableHead,{children:"Type"}),(0,b.jsx)(aj.TableHead,{children:"Manufacturer"}),(0,b.jsx)(aj.TableHead,{children:"Model"}),(0,b.jsx)(aj.TableHead,{children:"Serial #"}),(0,b.jsx)(aj.TableHead,{children:"Last Service"})]})}),(0,b.jsx)(aj.TableBody,{children:b2.map(a=>(0,b.jsxs)(aj.TableRow,{children:[(0,b.jsx)(aj.TableCell,{className:"font-medium",children:a.name}),(0,b.jsx)(aj.TableCell,{children:a.type}),(0,b.jsx)(aj.TableCell,{children:a.manufacturer||"N/A"}),(0,b.jsx)(aj.TableCell,{children:a.model||"N/A"}),(0,b.jsx)(aj.TableCell,{className:"font-mono text-sm",children:a.serial_number||"N/A"}),(0,b.jsx)(aj.TableCell,{className:"text-sm",children:a.last_service_date?c1(a.last_service_date):"Never"})]},a.id))})]})})})}),dF.push({id:"estimates",title:"Estimates",icon:(0,b.jsx)(v.Receipt,{className:"size-4"}),count:ca.length,actions:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(T.Button,{onClick:()=>bj(!0),size:"sm",variant:"ghost",children:[(0,b.jsx)(o.Link2,{className:"mr-2 h-4 w-4"})," Link Existing"]}),(0,b.jsxs)(T.Button,{onClick:()=>at.push(`/dashboard/work/estimates/new?jobId=${as.id}`),size:"sm",variant:"outline",children:[(0,b.jsx)(u.Plus,{className:"mr-2 h-4 w-4"})," Create Estimate"]})]}),content:(0,b.jsx)(ak.UnifiedAccordionContent,{className:"overflow-x-auto p-0 sm:p-0",children:(0,b.jsx)(a0,{estimates:ca})})}),dF.push({id:"invoices",title:"Invoices",icon:(0,b.jsx)(m.FileText,{className:"size-4"}),count:cc.length,actions:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(T.Button,{onClick:()=>bl(!0),size:"sm",variant:"ghost",children:[(0,b.jsx)(o.Link2,{className:"mr-2 h-4 w-4"})," Link Existing"]}),(0,b.jsxs)(T.Button,{onClick:()=>at.push(`/dashboard/work/invoices/new?jobId=${as.id}`),size:"sm",variant:"outline",children:[(0,b.jsx)(u.Plus,{className:"mr-2 h-4 w-4"})," Create Invoice"]})]}),content:(0,b.jsx)(ak.UnifiedAccordionContent,{className:"overflow-x-auto p-0 sm:p-0",children:(0,b.jsx)(a3,{invoices:cc})})}),dF.push({id:"payments",title:"Payments",icon:(0,b.jsx)(j.DollarSign,{className:"size-4"}),count:ce.length,actions:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(T.Button,{onClick:()=>bp(!0),size:"sm",variant:"ghost",children:[(0,b.jsx)(o.Link2,{className:"mr-2 h-4 w-4"})," Link Existing"]}),(0,b.jsxs)(T.Button,{onClick:()=>at.push(`/dashboard/work/payments/new?jobId=${as.id}`),size:"sm",variant:"outline",children:[(0,b.jsx)(u.Plus,{className:"mr-2 h-4 w-4"})," Record Payment"]})]}),content:(0,b.jsx)(ak.UnifiedAccordionContent,{className:"overflow-x-auto p-0 sm:p-0",children:(0,b.jsx)(a9,{payments:ce})})}),dF.push({id:"purchase-orders",title:"Purchase Orders",icon:(0,b.jsx)(s.Package,{className:"size-4"}),count:bX.length,actions:(0,b.jsxs)(T.Button,{onClick:()=>at.push(`/dashboard/work/purchase-orders/new?jobId=${as.id}`),size:"sm",variant:"outline",children:[(0,b.jsx)(u.Plus,{className:"mr-2 h-4 w-4"})," Create PO"]}),content:(0,b.jsx)(ak.UnifiedAccordionContent,{className:"overflow-x-auto p-0 sm:p-0",children:(0,b.jsx)(ba,{purchaseOrders:bX})})}),dF.push({id:"photos",title:"Photos & Documents",icon:(0,b.jsx)(g.Camera,{className:"size-4"}),count:bZ.length+b$.length,actions:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("input",{accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt,.csv",className:"hidden",multiple:!0,onChange:a=>{a.target.files&&a.target.files.length>0&&aK(!0)},ref:cT,type:"file"}),(0,b.jsxs)(T.Button,{onClick:()=>cT.current?.click(),size:"sm",variant:"outline",children:[(0,b.jsx)(u.Plus,{className:"mr-2 h-4 w-4"})," Upload"]})]}),content:(0,b.jsx)(ak.UnifiedAccordionContent,{className:"p-0",children:(0,b.jsxs)("div",{className:(0,ap.cn)("relative transition-colors",aL&&"bg-primary/5 ring-primary ring-2 ring-inset"),onDragEnter:a=>{a.preventDefault(),a.stopPropagation(),aM(!0)},onDragLeave:a=>{a.preventDefault(),a.stopPropagation(),a.currentTarget===a.target&&aM(!1)},onDragOver:a=>{a.preventDefault(),a.stopPropagation()},onDrop:a=>{a.preventDefault(),a.stopPropagation(),aM(!1),aK(!0)},children:[aL&&(0,b.jsx)("div",{className:"bg-primary/5 pointer-events-none absolute inset-0 z-10 flex items-center justify-center backdrop-blur-sm",children:(0,b.jsxs)("div",{className:"border-primary bg-background rounded-lg border-2 border-dashed p-8 text-center",children:[(0,b.jsx)(B.Upload,{className:"text-primary mx-auto mb-2 h-12 w-12"}),(0,b.jsx)("p",{className:"text-primary font-semibold",children:"Drop files to upload"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Photos, documents, and more"})]})}),(0,b.jsx)("div",{className:"bg-muted/30 border-b px-6 py-3",children:(0,b.jsxs)("div",{className:"text-muted-foreground flex items-center gap-2 text-sm",children:[(0,b.jsx)(B.Upload,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Drag and drop files anywhere in this section to upload"})]})}),(0,b.jsxs)("div",{className:"space-y-6 px-6 py-6",children:[aI&&(0,b.jsx)(aG,{companyId:as.company_id,jobId:as.id,onCancel:()=>aK(!1),onUploadComplete:()=>{aK(!1)}}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"mb-3 flex items-center justify-between",children:(0,b.jsxs)("h4",{className:"font-semibold",children:["Photos by Category (",bZ.length,")"]})}),bZ.length>0?(0,b.jsx)("div",{className:"grid gap-3 md:grid-cols-4",children:["before","during","after","issue","equipment","completion","other"].map(a=>{let c=bZ.filter(b=>b.category===a).length;return(0,b.jsxs)("div",{className:"rounded-lg border p-4 text-center",children:[(0,b.jsx)("p",{className:"text-muted-foreground text-xs font-medium uppercase",children:a}),(0,b.jsx)("p",{className:"text-3xl font-bold",children:c})]},a)})}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,b.jsx)("div",{className:"bg-muted mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full",children:(0,b.jsx)(g.Camera,{className:"text-muted-foreground h-8 w-8"})}),(0,b.jsx)("h3",{className:"mb-2 text-lg font-semibold",children:"No photos uploaded yet"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-4 text-sm",children:"Upload photos to document the job progress"}),(0,b.jsxs)(T.Button,{onClick:()=>aK(!0),size:"sm",variant:"secondary",children:[(0,b.jsx)(u.Plus,{className:"mr-2 h-4 w-4"})," Upload Photos"]})]})]}),(0,b.jsx)(ah.Separator,{}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"mb-3 font-semibold",children:["Documents (",b$.length,")"]}),b$.length>0?(0,b.jsx)("div",{className:"space-y-2",children:b$.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(m.FileText,{className:"text-muted-foreground h-4 w-4"}),(0,b.jsx)("span",{className:"text-sm",children:a.file_name})]}),(0,b.jsx)(T.Button,{className:"h-8 px-2",size:"sm",variant:"secondary",children:(0,b.jsx)(k.Download,{className:"h-3.5 w-3.5"})})]},a.id))}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,b.jsx)("div",{className:"bg-muted mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full",children:(0,b.jsx)(m.FileText,{className:"text-muted-foreground h-8 w-8"})}),(0,b.jsx)("h3",{className:"mb-2 text-lg font-semibold",children:"No documents uploaded yet"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-4 text-sm",children:"Upload documents, receipts, or other files related to this job"}),(0,b.jsxs)(T.Button,{onClick:()=>aK(!0),size:"sm",variant:"secondary",children:[(0,b.jsx)(u.Plus,{className:"mr-2 h-4 w-4"})," Upload Document"]})]})]}),(0,b.jsx)(ah.Separator,{}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"mb-3 font-semibold",children:"Signatures"}),(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,b.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Customer Signature"}),b_.find(a=>"customer"===a.signature_type)?(0,b.jsxs)(ad.Badge,{variant:"default",children:[(0,b.jsx)(h.CheckCircle,{className:"mr-1 h-3 w-3"})," Signed"]}):(0,b.jsx)(ad.Badge,{variant:"secondary",children:"Pending"})]}),b_.find(a=>"customer"===a.signature_type)&&(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Signed"," ",c1(b_.find(a=>"customer"===a.signature_type).signed_at)]})]}),(0,b.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Technician Signature"}),b_.find(a=>"technician"===a.signature_type)?(0,b.jsxs)(ad.Badge,{variant:"default",children:[(0,b.jsx)(h.CheckCircle,{className:"mr-1 h-3 w-3"})," Signed"]}):(0,b.jsx)(ad.Badge,{variant:"secondary",children:"Pending"})]}),b_.find(a=>"technician"===a.signature_type)&&(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Signed"," ",c1(b_.find(a=>"technician"===a.signature_type).signed_at)]})]})]})]})]})]})})}),dF.push({id:"tasks",title:"Job Tasks & Checklist",icon:(0,b.jsx)(h.CheckCircle,{className:"size-4"}),count:ci.length,actions:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(T.Button,{onClick:()=>aY(!0),size:"sm",variant:"outline",children:[(0,b.jsx)(u.Plus,{className:"mr-2 h-4 w-4"})," Add Task"]}),(0,b.jsx)(T.Button,{onClick:()=>a1(!0),size:"sm",variant:"outline",children:"Load Template"})]}),content:(0,b.jsx)(ak.UnifiedAccordionContent,{className:"overflow-x-auto p-0 sm:p-0",children:(0,b.jsx)(bo,{tasks:ci})})}),dF.push({id:"notes",title:"Notes",icon:(0,b.jsx)(z.StickyNote,{className:"size-4"}),count:ck.length,actions:(0,b.jsxs)(T.Button,{onClick:()=>a$(!0),size:"sm",variant:"outline",children:[(0,b.jsx)(u.Plus,{className:"mr-2 h-4 w-4"})," Add Note"]}),content:(0,b.jsx)(ak.UnifiedAccordionContent,{className:"overflow-x-auto p-0 sm:p-0",children:(0,b.jsx)(a7,{notes:ck})})}),dF.push({id:"activity",title:"Activity & Communications",icon:(0,b.jsx)(c.Activity,{className:"size-4"}),count:b0.length+b1.length,actions:(0,b.jsxs)(T.Button,{onClick:()=>{let a="/dashboard/communication/messages",b=cu?.id?`${a}?customerId=${cu.id}`:a;at.push(b)},size:"sm",variant:"outline",children:[(0,b.jsx)(u.Plus,{className:"mr-2 h-4 w-4"})," Add Communication"]}),content:(0,b.jsx)(ak.UnifiedAccordionContent,{className:"p-0",children:(0,b.jsx)(aJ,{activities:[...b0,...b1]})})});let dH=[];return cu&&dH.push({id:`customer-${cu.id}`,type:"customer",title:`${cu.first_name} ${cu.last_name}`,subtitle:cu.email||cu.phone||void 0,href:`/dashboard/customers/${cu.id}`}),cw&&dH.push({id:`property-${cw.id}`,type:"property",title:cw.name||cw.address,subtitle:`${cw.city||""}, ${cw.state||""}`,href:`/dashboard/work/properties/${cw.id}`}),bQ&&dH.push({id:`technician-${bQ.id}`,type:"team",title:bQ.name,subtitle:bQ.email||bQ.phone||void 0,href:bQ.id?`/dashboard/settings/team/${bQ.id}`:"/dashboard/settings/team"}),as?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)($.DetailPageContentLayout,{activities:b0,beforeContent:dE,customSections:dF,enableReordering:!0,header:dD,notes:ck,relatedItems:dH,showStandardSections:{activities:!1,notes:!1,attachments:!1},storageKey:"job-details"}),(0,b.jsx)(U.Dialog,{onOpenChange:cK,open:cJ,children:(0,b.jsxs)(U.DialogContent,{className:"sm:max-w-[500px]",children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsx)(U.DialogTitle,{children:"Create New Property"}),(0,b.jsxs)(U.DialogDescription,{children:["Add a new property for ",cu?.first_name," ",cu?.last_name]})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsx)(W.StandardFormField,{label:"Property Name",htmlFor:"property-name",children:(0,b.jsx)(af.Input,{id:"property-name",onChange:a=>cO({...cN,name:a.target.value}),placeholder:"Main Residence",value:cN.name})}),(0,b.jsx)(W.StandardFormField,{label:"Address",htmlFor:"property-address",required:!0,children:(0,b.jsx)(af.Input,{id:"property-address",onChange:a=>cO({...cN,address:a.target.value}),placeholder:"123 Main St",value:cN.address})}),(0,b.jsx)(W.StandardFormField,{label:"Address Line 2",htmlFor:"property-address2",children:(0,b.jsx)(af.Input,{id:"property-address2",onChange:a=>cO({...cN,address2:a.target.value}),placeholder:"Apt 4B",value:cN.address2})}),(0,b.jsxs)(W.StandardFormRow,{cols:2,children:[(0,b.jsx)(W.StandardFormField,{label:"City",htmlFor:"property-city",required:!0,children:(0,b.jsx)(af.Input,{id:"property-city",onChange:a=>cO({...cN,city:a.target.value}),placeholder:"New York",value:cN.city})}),(0,b.jsx)(W.StandardFormField,{label:"State",htmlFor:"property-state",required:!0,children:(0,b.jsx)(af.Input,{id:"property-state",onChange:a=>cO({...cN,state:a.target.value}),placeholder:"NY",value:cN.state})})]}),(0,b.jsx)(W.StandardFormField,{label:"ZIP Code",htmlFor:"property-zip",required:!0,children:(0,b.jsx)(af.Input,{id:"property-zip",onChange:a=>cO({...cN,zipCode:a.target.value}),placeholder:"10001",value:cN.zipCode})})]}),(0,b.jsxs)(U.DialogFooter,{children:[(0,b.jsx)(T.Button,{disabled:cL,onClick:()=>cK(!1),variant:"outline",children:"Cancel"}),(0,b.jsx)(T.Button,{disabled:cL||!cN.address||!cN.city||!cN.state||!cN.zipCode,onClick:cX,children:cL?"Creating...":"Create Property"})]})]})}),cu?.phone&&(0,b.jsx)(Z,{companyId:as.company_id,companyPhones:b9,customerId:cu.id,customerName:`${cu.first_name} ${cu.last_name}`,customerPhone:cu.phone,jobId:as.id,onOpenChange:cQ,open:cP,propertyId:cw?.id}),(0,b.jsx)(U.Dialog,{onOpenChange:aP,open:aO,children:(0,b.jsxs)(U.DialogContent,{children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsx)(U.DialogTitle,{children:"Archive Job"}),(0,b.jsx)(U.DialogDescription,{children:"Archiving removes this job from active workflows. You can restore it from the archive within 90 days."})]}),(0,b.jsxs)(U.DialogFooter,{children:[(0,b.jsx)(T.Button,{disabled:aQ,onClick:()=>aP(!1),variant:"outline",children:"Cancel"}),(0,b.jsx)(T.Button,{disabled:aQ,onClick:dC,variant:"destructive",children:aQ?"Archiving...":"Archive Job"})]})]})}),(0,b.jsx)(ab.AlertDialog,{onOpenChange:cS,open:cR,children:(0,b.jsxs)(ab.AlertDialogContent,{children:[(0,b.jsxs)(ab.AlertDialogHeader,{children:[(0,b.jsx)(ab.AlertDialogTitle,{children:"Remove Customer and Property?"}),(0,b.jsx)(ab.AlertDialogDescription,{children:"This will clear the customer and property fields from this job. This action can be undone by reassigning a customer and property."})]}),(0,b.jsxs)(ab.AlertDialogFooter,{children:[(0,b.jsx)(ab.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(ab.AlertDialogAction,{onClick:async()=>{try{let a=new FormData;a.append("customer_id",""),a.append("property_id","");let b=await (0,M.updateJob)(as.id,a);b.success?au.success("Customer and property removed"):au.error(b.error||"Failed to remove customer and property")}catch{au.error("Failed to remove customer and property")}},children:"Remove"})]})]})}),R&&(0,b.jsx)(be.JobStatisticsSheet,{invoices:cc,job:as,jobMaterials:b4,metrics:R,onOpenChange:aU,open:aT,payments:ce,teamAssignments:bR,timeEntries:bT,onUpdateCosting:c_}),(0,b.jsx)(U.Dialog,{onOpenChange:aY,open:aX,children:(0,b.jsxs)(U.DialogContent,{className:"sm:max-w-[500px]",children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsx)(U.DialogTitle,{children:"Add Task"}),(0,b.jsx)(U.DialogDescription,{children:"Create a new task or checklist item for this job."})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsx)(W.StandardFormField,{label:"Title",htmlFor:"task-title",required:!0,children:(0,b.jsx)(af.Input,{id:"task-title",onChange:a=>a4(a.target.value),placeholder:"Enter task title...",value:a2})}),(0,b.jsx)(W.StandardFormField,{label:"Description",htmlFor:"task-description",description:"Optional",children:(0,b.jsx)(X.Textarea,{id:"task-description",onChange:a=>a6(a.target.value),placeholder:"Enter task description...",value:a5,className:"min-h-[80px]"})})]}),(0,b.jsxs)(U.DialogFooter,{children:[(0,b.jsx)(T.Button,{disabled:bc,onClick:()=>{a4(""),a6(""),aY(!1)},variant:"outline",children:"Cancel"}),(0,b.jsx)(T.Button,{disabled:bc||!a2.trim(),onClick:async()=>{if(!a2.trim())return;bf(!0);let a={id:`temp-${Date.now()}`,job_id:as.id,title:a2.trim(),description:a5.trim()||null,is_completed:!1,is_required:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};cj([...ci,a]),a4(""),a6(""),aY(!1);try{let b=(0,ao.createClient)(),{data:c,error:d}=await b.from("job_tasks").insert({job_id:as.id,title:a.title,description:a.description,is_completed:!1,is_required:!1}).select().single();d?(cj(ci),au.error("Failed to create task")):(cj(b=>b.map(b=>b.id===a.id?c:b)),au.success("Task created successfully"))}catch{cj(ci),au.error("Failed to create task")}finally{bf(!1)}},children:bc?"Creating...":"Create Task"})]})]})}),(0,b.jsx)(U.Dialog,{onOpenChange:a$,open:aZ,children:(0,b.jsxs)(U.DialogContent,{className:"sm:max-w-[500px]",children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsx)(U.DialogTitle,{children:"Add Note"}),(0,b.jsx)(U.DialogDescription,{children:"Add a note or comment for this job."})]}),(0,b.jsx)("div",{className:"space-y-4 py-4",children:(0,b.jsx)(W.StandardFormField,{label:"Note Content",htmlFor:"note-content",required:!0,children:(0,b.jsx)(X.Textarea,{id:"note-content",onChange:a=>bb(a.target.value),placeholder:"Enter note content...",value:a8,className:"min-h-[120px]"})})}),(0,b.jsxs)(U.DialogFooter,{children:[(0,b.jsx)(T.Button,{disabled:bg,onClick:()=>{bb(""),a$(!1)},variant:"outline",children:"Cancel"}),(0,b.jsx)(T.Button,{disabled:bg||!a8.trim(),onClick:async()=>{if(!a8.trim())return;bh(!0);let a=(0,ao.createClient)(),{data:{user:b}}=await a.auth.getUser(),c={id:`temp-${Date.now()}`,job_id:as.id,content:a8.trim(),note_type:"general",is_important:!1,created_by:b?.id||null,created_by_name:b?.email||"Unknown",created_at:new Date().toISOString()};cl([...ck,c]),bb(""),a$(!1);try{let{data:d,error:e}=await a.from("job_notes").insert({job_id:as.id,content:c.content,note_type:"general",is_important:!1,created_by:b?.id||null}).select().single();e?(cl(ck),au.error("Failed to create note")):(cl(a=>a.map(a=>a.id===c.id?d:a)),au.success("Note created successfully"))}catch{cl(ck),au.error("Failed to create note")}finally{bh(!1)}},children:bg?"Creating...":"Create Note"})]})]})}),(0,b.jsx)(U.Dialog,{onOpenChange:a1,open:a_,children:(0,b.jsxs)(U.DialogContent,{className:"sm:max-w-[500px]",children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsx)(U.DialogTitle,{children:"Load Task Template"}),(0,b.jsx)(U.DialogDescription,{children:"Select a task template to apply to this job. This feature will be available soon."})]}),(0,b.jsx)("div",{className:"space-y-4 py-4",children:(0,b.jsx)("div",{className:"text-muted-foreground rounded-lg border border-dashed p-6 text-center text-sm",children:"Task templates feature is coming soon. You'll be able to save and load predefined task checklists for different job types."})}),(0,b.jsx)(U.DialogFooter,{children:(0,b.jsx)(T.Button,{onClick:()=>a1(!1),variant:"outline",children:"Close"})})]})}),(0,b.jsx)(U.Dialog,{onOpenChange:bj,open:bi,children:(0,b.jsxs)(U.DialogContent,{className:"sm:max-w-[700px]",children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsx)(U.DialogTitle,{children:"Link Existing Estimate"}),(0,b.jsx)(U.DialogDescription,{children:"Search and select an estimate to link to this job. Only unlinked estimates are shown."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(af.Input,{placeholder:"Search by estimate number, customer, or status...",value:bw,onChange:a=>bx(a.target.value),className:"pl-10"}),(0,b.jsx)(m.FileText,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"})]}),(0,b.jsx)("div",{className:"border rounded-lg max-h-[400px] overflow-y-auto",children:0===bG.filter(a=>{if(!bw)return!0;let b=bw.toLowerCase();return a.estimate_number.toLowerCase().includes(b)||a.status.toLowerCase().includes(b)||a.customer?.name?.toLowerCase().includes(b)}).length?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,b.jsx)(m.FileText,{className:"h-12 w-12 text-muted-foreground/50 mb-3"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No estimates found"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Try adjusting your search"})]}):(0,b.jsx)("div",{className:"divide-y",children:bG.filter(a=>{if(!bw)return!0;let b=bw.toLowerCase();return a.estimate_number.toLowerCase().includes(b)||a.status.toLowerCase().includes(b)||a.customer?.name?.toLowerCase().includes(b)}).map(a=>(0,b.jsx)("button",{onClick:async()=>{bF(!0),cb([...ca,{...a,job_id:as.id}]),bj(!1),bx("");try{let b=(0,ao.createClient)(),{error:c}=await b.from("estimates").update({job_id:as.id}).eq("id",a.id);c?(cb(ca),au.error("Failed to link estimate")):au.success("Estimate linked successfully")}catch{cb(ca),au.error("Failed to link estimate")}finally{bF(!1)}},disabled:bE,className:"w-full px-4 py-3 hover:bg-accent transition-colors text-left disabled:opacity-50 disabled:cursor-not-allowed",children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("span",{className:"font-semibold text-sm",children:a.estimate_number}),(0,b.jsx)(ad.Badge,{variant:"outline",className:"text-xs",children:a.status})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,b.jsx)(C.User,{className:"h-3 w-3"}),(0,b.jsx)("span",{className:"truncate",children:a.customer?.name||"No customer"})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:"font-semibold text-sm",children:["$",(a.total_amount/100).toFixed(2)]}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:new Date(a.created_at).toLocaleDateString()})]})]})},a.id))})})]}),(0,b.jsx)(U.DialogFooter,{children:(0,b.jsx)(T.Button,{onClick:()=>{bj(!1),bx("")},variant:"outline",disabled:bE,children:"Cancel"})})]})}),(0,b.jsx)(U.Dialog,{onOpenChange:bl,open:bk,children:(0,b.jsxs)(U.DialogContent,{className:"sm:max-w-[700px]",children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsx)(U.DialogTitle,{children:"Link Existing Invoice"}),(0,b.jsx)(U.DialogDescription,{children:"Search and select an invoice to link to this job. Only unlinked invoices are shown."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(af.Input,{placeholder:"Search by invoice number, customer, or status...",value:by,onChange:a=>bz(a.target.value),className:"pl-10"}),(0,b.jsx)(m.FileText,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"})]}),(0,b.jsx)("div",{className:"border rounded-lg max-h-[400px] overflow-y-auto",children:0===bI.filter(a=>{if(!by)return!0;let b=by.toLowerCase();return a.invoice_number.toLowerCase().includes(b)||a.status.toLowerCase().includes(b)||a.customer?.name?.toLowerCase().includes(b)}).length?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,b.jsx)(m.FileText,{className:"h-12 w-12 text-muted-foreground/50 mb-3"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No invoices found"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Try adjusting your search"})]}):(0,b.jsx)("div",{className:"divide-y",children:bI.filter(a=>{if(!by)return!0;let b=by.toLowerCase();return a.invoice_number.toLowerCase().includes(b)||a.status.toLowerCase().includes(b)||a.customer?.name?.toLowerCase().includes(b)}).map(a=>(0,b.jsx)("button",{onClick:async()=>{bF(!0),cd([...cc,{...a,job_id:as.id}]),bl(!1),bz("");try{let b=(0,ao.createClient)(),{error:c}=await b.from("invoices").update({job_id:as.id}).eq("id",a.id);c?(cd(cc),au.error("Failed to link invoice")):au.success("Invoice linked successfully")}catch{cd(cc),au.error("Failed to link invoice")}finally{bF(!1)}},disabled:bE,className:"w-full px-4 py-3 hover:bg-accent transition-colors text-left disabled:opacity-50 disabled:cursor-not-allowed",children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("span",{className:"font-semibold text-sm",children:a.invoice_number}),(0,b.jsx)(ad.Badge,{variant:"outline",className:"text-xs",children:a.status})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,b.jsx)(C.User,{className:"h-3 w-3"}),(0,b.jsx)("span",{className:"truncate",children:a.customer?.name||"No customer"})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:"font-semibold text-sm",children:["$",(a.total_amount/100).toFixed(2)]}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:new Date(a.created_at).toLocaleDateString()})]})]})},a.id))})})]}),(0,b.jsx)(U.DialogFooter,{children:(0,b.jsx)(T.Button,{onClick:()=>{bl(!1),bz("")},variant:"outline",disabled:bE,children:"Cancel"})})]})}),(0,b.jsx)(U.Dialog,{onOpenChange:bp,open:bm,children:(0,b.jsxs)(U.DialogContent,{className:"sm:max-w-[700px]",children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsx)(U.DialogTitle,{children:"Link Existing Payment"}),(0,b.jsx)(U.DialogDescription,{children:"Search and select a payment to link to this job. Only unlinked payments are shown."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(af.Input,{placeholder:"Search by reference, payment method, or customer...",value:bA,onChange:a=>bB(a.target.value),className:"pl-10"}),(0,b.jsx)(j.DollarSign,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"})]}),(0,b.jsx)("div",{className:"border rounded-lg max-h-[400px] overflow-y-auto",children:0===bK.filter(a=>{if(!bA)return!0;let b=bA.toLowerCase();return a.payment_method.toLowerCase().includes(b)||a.reference_number?.toLowerCase().includes(b)||a.customer?.name?.toLowerCase().includes(b)}).length?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,b.jsx)(j.DollarSign,{className:"h-12 w-12 text-muted-foreground/50 mb-3"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No payments found"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Try adjusting your search"})]}):(0,b.jsx)("div",{className:"divide-y",children:bK.filter(a=>{if(!bA)return!0;let b=bA.toLowerCase();return a.payment_method.toLowerCase().includes(b)||a.reference_number?.toLowerCase().includes(b)||a.customer?.name?.toLowerCase().includes(b)}).map(a=>(0,b.jsx)("button",{onClick:async()=>{bF(!0),cf([...ce,{...a,job_id:as.id}]),bp(!1),bB("");try{let b=(0,ao.createClient)(),{error:c}=await b.from("payments").update({job_id:as.id}).eq("id",a.id);c?(cf(ce),au.error("Failed to link payment")):au.success("Payment linked successfully")}catch{cf(ce),au.error("Failed to link payment")}finally{bF(!1)}},disabled:bE,className:"w-full px-4 py-3 hover:bg-accent transition-colors text-left disabled:opacity-50 disabled:cursor-not-allowed",children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("span",{className:"font-semibold text-sm",children:a.reference_number||"No reference"}),(0,b.jsx)(ad.Badge,{variant:"outline",className:"text-xs",children:a.payment_method})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,b.jsx)(C.User,{className:"h-3 w-3"}),(0,b.jsx)("span",{className:"truncate",children:a.customer?.name||"No customer"})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:"font-semibold text-sm",children:["$",(a.amount/100).toFixed(2)]}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:new Date(a.created_at).toLocaleDateString()})]})]})},a.id))})})]}),(0,b.jsx)(U.DialogFooter,{children:(0,b.jsx)(T.Button,{onClick:()=>{bp(!1),bB("")},variant:"outline",disabled:bE,children:"Cancel"})})]})}),(0,b.jsx)(U.Dialog,{onOpenChange:bs,open:br,children:(0,b.jsxs)(U.DialogContent,{className:"sm:max-w-[700px]",children:[(0,b.jsxs)(U.DialogHeader,{children:[(0,b.jsx)(U.DialogTitle,{children:"Link Existing Equipment"}),(0,b.jsx)(U.DialogDescription,{children:"Search and link existing equipment to this job. Select equipment from the list below."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(af.Input,{placeholder:"Search by equipment name, category, or serial number...",value:bC,onChange:a=>bD(a.target.value),className:"pl-10"}),(0,b.jsx)(E.Wrench,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"})]}),(0,b.jsx)("div",{className:"border rounded-lg max-h-[400px] overflow-y-auto",children:0===bM.filter(a=>{if(!bC)return!0;let b=bC.toLowerCase();return a.name.toLowerCase().includes(b)||a.category?.toLowerCase().includes(b)||a.serial_number?.toLowerCase().includes(b)}).length?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,b.jsx)(E.Wrench,{className:"h-12 w-12 text-muted-foreground/50 mb-4"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"No equipment found"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Try adjusting your search terms or create new equipment from the inventory section."})]}):bM.filter(a=>{if(!bC)return!0;let b=bC.toLowerCase();return a.name.toLowerCase().includes(b)||a.category?.toLowerCase().includes(b)||a.serial_number?.toLowerCase().includes(b)}).map((a,c,d)=>(0,b.jsxs)("div",{children:[(0,b.jsx)("button",{onClick:async()=>{bF(!0);let b={id:`temp-${Date.now()}`,company_id:as.company_id,job_id:as.id,equipment_id:a.id,equipment:a,service_type:null,service_description:null,hours_spent:null,parts_cost:null,labor_cost:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};ch([...cg,b]),bs(!1),bD("");try{let c=(0,ao.createClient)(),{data:d}=await c.from("job_equipment").select("id").eq("job_id",as.id).eq("equipment_id",a.id).single();if(d){ch(cg),au.error("Equipment is already linked to this job"),bF(!1);return}let{data:e,error:f}=await c.from("job_equipment").insert({company_id:as.company_id,job_id:as.id,equipment_id:a.id}).select("*, equipment:equipment_id(*)").single();f?(ch(cg),au.error("Failed to link equipment")):(ch(a=>a.map(a=>a.id===b.id?e:a)),au.success("Equipment linked successfully"))}catch{ch(cg),au.error("Failed to link equipment")}finally{bF(!1)}},disabled:bE,className:"w-full px-4 py-3 hover:bg-accent transition-colors text-left disabled:opacity-50 disabled:cursor-not-allowed",children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("span",{className:"font-semibold text-sm truncate",children:a.name}),a.category&&(0,b.jsx)(ad.Badge,{variant:"outline",className:"text-xs shrink-0",children:a.category})]}),a.serial_number&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,b.jsx)(E.Wrench,{className:"h-3 w-3"}),(0,b.jsxs)("span",{className:"truncate",children:["SN: ",a.serial_number]})]})]}),(0,b.jsx)("div",{className:"text-right shrink-0",children:(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:new Date(a.created_at).toLocaleDateString()})})]})}),c<d.length-1&&(0,b.jsx)("div",{className:"border-b"})]},a.id))})]})]})})]}):(0,b.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,b.jsx)("div",{className:"text-center",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"Job not found"})})})}a.s(["JobPageContent",()=>bw],879143)}];

//# sourceMappingURL=apps_web_src_components_work_job-details_a8450a50._.js.map