{"version":3,"sources":["../../../../../../apps/web/src/components/communication/email-page-client.tsx","../../../../../../apps/web/src/components/communication/customer-info-pill.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n\tAlertTriangle,\n\tArchive,\n\tArrowLeft,\n\tCheckCheck,\n\tChevronRight,\n\tDownload,\n\tEye,\n\tFlag,\n\tForward,\n\tInfo,\n\tLoader2,\n\tMoreHorizontal,\n\tMousePointerClick,\n\tPanelLeft,\n\tPrinter,\n\tRefreshCw,\n\tReply,\n\tReplyAll,\n\tSend,\n\tStar,\n\tStickyNote,\n\tTrash2,\n\tUser,\n\tX,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useParams, useRouter, useSearchParams } from \"next/navigation\";\nimport { useCallback, useEffect, useRef, useState, useTransition } from \"react\";\nimport { toast } from \"sonner\";\nimport {\n\tarchiveAllEmailsAction,\n\tarchiveEmailAction,\n\tfetchEmailContentAction,\n\tgetEmailsAction,\n\tmarkEmailAsReadAction,\n\tretryFailedEmailAction,\n\ttoggleSpamEmailAction,\n\ttoggleStarEmailAction,\n} from \"@/actions/email-actions\";\nimport { CustomerInfoPill } from \"@/components/communication/customer-info-pill\";\nimport { EmailContent } from \"@/components/communication/email-content\";\nimport { EmailFullComposer } from \"@/components/communication/email-full-composer\";\nimport {\n\tEmailReplyComposer,\n\ttype EmailReplyMode,\n} from \"@/components/communication/email-reply-composer\";\nimport {\n\tAlertDialog,\n\tAlertDialogAction,\n\tAlertDialogCancel,\n\tAlertDialogContent,\n\tAlertDialogDescription,\n\tAlertDialogFooter,\n\tAlertDialogHeader,\n\tAlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n\tSheet,\n\tSheetContent,\n\tSheetDescription,\n\tSheetHeader,\n\tSheetTitle,\n\tSheetTrigger,\n} from \"@/components/ui/sheet\";\nimport { useSidebar } from \"@/components/ui/sidebar\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport type {\n\tEmailCategory,\n\tEmailFolder,\n\tEmailRecord,\n\tEmailsResult,\n\tInboxType,\n} from \"@/lib/queries/emails\";\nimport { useRoleStore } from \"@/lib/stores/role-store\";\nimport { cn } from \"@/lib/utils\";\nimport { getCustomerDisplayName } from \"@/lib/utils/customer-display\";\nimport { USER_ROLES } from \"@/types/roles\";\n\ntype EmailPageClientProps = {\n\tinitialEmails: EmailsResult;\n\tinitialInboxType: InboxType;\n\tinitialFolder?: EmailFolder;\n\tinitialCategory?: EmailCategory;\n\tinitialEmailId: string | null;\n\tcompanyId: string | null;\n};\n\nexport function EmailPageClient({\n\tinitialEmails,\n\tinitialInboxType,\n\tinitialFolder,\n\tinitialCategory,\n\tinitialEmailId,\n\tcompanyId,\n}: EmailPageClientProps) {\n\tconst router = useRouter();\n\tconst searchParams = useSearchParams();\n\tconst params = useParams();\n\n\t// Read current inbox type and folder/category from URL\n\tconst inboxType: InboxType =\n\t\t(searchParams?.get(\"inbox\") as InboxType) || initialInboxType;\n\tconst folder = searchParams?.get(\"folder\") || initialFolder;\n\tconst category = searchParams?.get(\"category\") || initialCategory;\n\n\tconst emailIdFromPath = params?.id as string | undefined;\n\tconst emailIdFromQuery = searchParams?.get(\"id\");\n\tconst emailId = emailIdFromPath || emailIdFromQuery || initialEmailId;\n\tconst [isPending, startTransition] = useTransition();\n\tconst [emails, setEmails] = useState<EmailsResult>(initialEmails);\n\t// Note: removed `loading` state - we use `refreshing` for all fetches to keep UI optimistic\n\tconst [refreshing, setRefreshing] = useState(false);\n\tconst [error, setError] = useState<string | null>(null);\n\tconst [selectedEmail, setSelectedEmail] = useState<EmailRecord | null>(() => {\n\t\tif (initialEmailId && initialEmails.emails) {\n\t\t\treturn initialEmails.emails.find((e) => e.id === initialEmailId) || null;\n\t\t}\n\t\treturn null;\n\t});\n\tconst [emailContent, setEmailContent] = useState<{\n\t\thtml?: string | null;\n\t\ttext?: string | null;\n\t} | null>(() => {\n\t\tif (selectedEmail) {\n\t\t\treturn {\n\t\t\t\thtml: selectedEmail.body_html || null,\n\t\t\t\ttext: selectedEmail.body || null,\n\t\t\t};\n\t\t}\n\t\treturn null;\n\t});\n\tconst [loadingContent, setLoadingContent] = useState(false);\n\tconst [searchQuery, setSearchQuery] = useState(\"\");\n\tconst [searchInput, setSearchInput] = useState(\"\");\n\tconst searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\tconst selectedEmailRef = useRef<EmailRecord | null>(selectedEmail);\n\tconst { toggleSidebar } = useSidebar();\n\tconst [replyMode, setReplyMode] = useState<EmailReplyMode | null>(null);\n\tconst [composeMode, setComposeMode] = useState(false);\n\tconst [notesOpen, setNotesOpen] = useState(false);\n\tconst [emailNotes, setEmailNotes] = useState<string>(\"\");\n\tconst [archiveAllDialogOpen, setArchiveAllDialogOpen] = useState(false);\n\tconst [retrying, setRetrying] = useState(false);\n\tconst role = useRoleStore((state) => state.role);\n\tconst isOwner = role === USER_ROLES.OWNER || role === USER_ROLES.ADMIN;\n\n\t// Handle compose=true query param from navigation\n\tuseEffect(() => {\n\t\tconst shouldCompose = searchParams?.get(\"compose\") === \"true\";\n\t\tif (shouldCompose && !composeMode) {\n\t\t\tsetComposeMode(true);\n\t\t\tsetSelectedEmail(null);\n\t\t\tsetEmailContent(null);\n\t\t\tselectedEmailRef.current = null;\n\t\t\tconst newParams = new URLSearchParams(searchParams?.toString() || \"\");\n\t\t\tnewParams.delete(\"compose\");\n\t\t\tnewParams.delete(\"to\");\n\t\t\tnewParams.delete(\"name\");\n\t\t\tnewParams.delete(\"customerId\");\n\t\t\tconst newUrl = newParams.toString()\n\t\t\t\t? `/dashboard/communication/email?${newParams.toString()}`\n\t\t\t\t: \"/dashboard/communication/email\";\n\t\t\trouter.replace(newUrl);\n\t\t}\n\t}, [searchParams, router, composeMode]);\n\n\t// Keyboard shortcut: 'C' to open compose mode\n\tuseEffect(() => {\n\t\tconst handleKeyDown = (e: KeyboardEvent) => {\n\t\t\tconst target = e.target as HTMLElement;\n\t\t\tif (\n\t\t\t\ttarget.tagName === \"INPUT\" ||\n\t\t\t\ttarget.tagName === \"TEXTAREA\" ||\n\t\t\t\ttarget.isContentEditable\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\te.key === \"c\" &&\n\t\t\t\t!e.metaKey &&\n\t\t\t\t!e.ctrlKey &&\n\t\t\t\t!e.altKey &&\n\t\t\t\t!composeMode\n\t\t\t) {\n\t\t\t\te.preventDefault();\n\t\t\t\tsetComposeMode(true);\n\t\t\t\tsetSelectedEmail(null);\n\t\t\t\tsetEmailContent(null);\n\t\t\t\tselectedEmailRef.current = null;\n\t\t\t}\n\t\t};\n\n\t\twindow.addEventListener(\"keydown\", handleKeyDown);\n\t\treturn () => window.removeEventListener(\"keydown\", handleKeyDown);\n\t}, [composeMode]);\n\n\t// Fetch emails function (for refresh and search)\n\t// OPTIMISTIC: Always use refreshing state (subtle indicator) instead of blocking loading spinner\n\t// This ensures emails stay visible while new data is being fetched\n\tconst fetchEmails = useCallback(\n\t\tasync (showRefreshing = false) => {\n\t\t\tsetRefreshing(true);\n\t\t\tsetError(null);\n\n\t\t\tstartTransition(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst result = await getEmailsAction({\n\t\t\t\t\t\tlimit: 50,\n\t\t\t\t\t\toffset: 0,\n\t\t\t\t\t\ttype: \"all\",\n\t\t\t\t\t\tinboxType,\n\t\t\t\t\t\tfolder:\n\t\t\t\t\t\t\tinboxType === \"personal\" ? (folder as EmailFolder) : undefined,\n\t\t\t\t\t\tcategory:\n\t\t\t\t\t\t\tinboxType === \"company\" ? (category as EmailCategory) : undefined,\n\t\t\t\t\t\tsearch: searchQuery || undefined,\n\t\t\t\t\t\tsortBy: \"created_at\",\n\t\t\t\t\t\tsortOrder: \"desc\",\n\t\t\t\t\t});\n\n\t\t\t\t\tconst normalizedEmails = result.emails.map((email) => {\n\t\t\t\t\t\tlet parsedToAddress = email.to_address;\n\t\t\t\t\t\tif (typeof email.to_address === \"string\") {\n\t\t\t\t\t\t\tconst trimmed = email.to_address.trim();\n\t\t\t\t\t\t\tif (trimmed.startsWith(\"[\") && trimmed.endsWith(\"]\")) {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tconst parsed = JSON.parse(email.to_address);\n\t\t\t\t\t\t\t\t\tif (Array.isArray(parsed) && parsed.length > 0) {\n\t\t\t\t\t\t\t\t\t\tparsedToAddress = parsed[0];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t// Keep original\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn { ...email, to_address: parsedToAddress };\n\t\t\t\t\t});\n\n\t\t\t\t\tsetEmails({\n\t\t\t\t\t\t...result,\n\t\t\t\t\t\temails: normalizedEmails as unknown as EmailRecord[],\n\t\t\t\t\t});\n\n\t\t\t\t\tconst currentSelected = selectedEmailRef.current;\n\t\t\t\t\tif (currentSelected) {\n\t\t\t\t\t\tconst updatedEmail = result.emails.find(\n\t\t\t\t\t\t\t(e) => e.id === currentSelected.id,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (updatedEmail) {\n\t\t\t\t\t\t\tsetSelectedEmail(updatedEmail as unknown as EmailRecord);\n\t\t\t\t\t\t\tselectedEmailRef.current = updatedEmail as unknown as EmailRecord;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetSelectedEmail(null);\n\t\t\t\t\t\t\tselectedEmailRef.current = null;\n\t\t\t\t\t\t\tsetEmailContent(null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.error(\"Failed to fetch emails:\", err);\n\t\t\t\t\tconst errorMessage =\n\t\t\t\t\t\terr instanceof Error ? err.message : \"Failed to load emails\";\n\t\t\t\t\tsetError(errorMessage);\n\t\t\t\t\ttoast.error(\"Failed to load emails\", { description: errorMessage });\n\t\t\t\t} finally {\n\t\t\t\t\tsetRefreshing(false);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t[searchQuery, folder, inboxType, category],\n\t);\n\n\t// Refetch when search changes (NOT on initial mount - we have server data)\n\tuseEffect(() => {\n\t\tif (searchQuery) {\n\t\t\tfetchEmails();\n\t\t}\n\t}, [searchQuery]);\n\n\t// Use ref to track refreshing state without triggering effect re-runs\n\tconst refreshingRef = useRef(refreshing);\n\trefreshingRef.current = refreshing;\n\n\t// Auto-refresh emails every 30 seconds to catch new incoming emails\n\t// This prevents the \"have to refresh to see emails\" issue\n\tuseEffect(() => {\n\t\tconst interval = setInterval(() => {\n\t\t\t// Only auto-refresh if not in compose mode and not already refreshing\n\t\t\tif (!composeMode && !refreshingRef.current) {\n\t\t\t\tfetchEmails();\n\t\t\t}\n\t\t}, 30000);\n\n\t\t// Also listen for custom events that indicate new emails\n\t\tconst handleNewEmail = () => {\n\t\t\tfetchEmails();\n\t\t};\n\t\twindow.addEventListener(\"email-received\", handleNewEmail);\n\t\twindow.addEventListener(\"email-sent\", handleNewEmail);\n\n\t\treturn () => {\n\t\t\tclearInterval(interval);\n\t\t\twindow.removeEventListener(\"email-received\", handleNewEmail);\n\t\t\twindow.removeEventListener(\"email-sent\", handleNewEmail);\n\t\t};\n\t}, [fetchEmails, composeMode]);\n\n\t// Refetch when inbox type, folder, or category changes (but not on initial mount)\n\tconst initialFolderRef = useRef(folder);\n\tconst initialInboxTypeRef = useRef(inboxType);\n\tconst initialCategoryRef = useRef(category);\n\tuseEffect(() => {\n\t\tconst folderChanged = folder !== initialFolderRef.current;\n\t\tconst inboxTypeChanged = inboxType !== initialInboxTypeRef.current;\n\t\tconst categoryChanged = category !== initialCategoryRef.current;\n\n\t\tif (folderChanged || inboxTypeChanged || categoryChanged) {\n\t\t\tinitialFolderRef.current = folder;\n\t\t\tinitialInboxTypeRef.current = inboxType;\n\t\t\tinitialCategoryRef.current = category;\n\t\t\tfetchEmails();\n\t\t}\n\t}, [folder, inboxType, category, fetchEmails]);\n\n\t// Handle search input with debounce\n\tuseEffect(() => {\n\t\tif (searchTimeoutRef.current) {\n\t\t\tclearTimeout(searchTimeoutRef.current);\n\t\t}\n\n\t\tsearchTimeoutRef.current = setTimeout(() => {\n\t\t\tsetSearchQuery(searchInput);\n\t\t}, 300);\n\n\t\treturn () => {\n\t\t\tif (searchTimeoutRef.current) {\n\t\t\t\tclearTimeout(searchTimeoutRef.current);\n\t\t\t}\n\t\t};\n\t}, [searchInput]);\n\n\t// Handle email selection\n\tconst handleEmailSelect = useCallback(\n\t\t(email: EmailRecord) => {\n\t\t\tsetSelectedEmail(email);\n\t\t\tselectedEmailRef.current = email;\n\n\t\t\tconst queryParams = new URLSearchParams();\n\t\t\tif (folder && folder !== \"inbox\") queryParams.set(\"folder\", folder);\n\t\t\tqueryParams.set(\"id\", email.id);\n\n\t\t\trouter.replace(\n\t\t\t\t`/dashboard/communication/email?${queryParams.toString()}`,\n\t\t\t\t{ scroll: false },\n\t\t\t);\n\n\t\t\tconst hasContent = email.body_html || email.body;\n\t\t\tif (hasContent) {\n\t\t\t\tsetEmailContent({\n\t\t\t\t\thtml: email.body_html || null,\n\t\t\t\t\ttext: email.body || null,\n\t\t\t\t});\n\t\t\t\tsetLoadingContent(false);\n\t\t\t} else {\n\t\t\t\tsetLoadingContent(true);\n\t\t\t\tfetchEmailContentAction(email.id)\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\t\tsetEmailContent({\n\t\t\t\t\t\t\t\thtml: result.html || null,\n\t\t\t\t\t\t\t\ttext: result.text || null,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetEmailContent({ html: null, text: null });\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\tsetEmailContent({ html: null, text: null });\n\t\t\t\t\t})\n\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\tsetLoadingContent(false);\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!email.read_at) {\n\t\t\t\tsetEmails((prev) => ({\n\t\t\t\t\t...prev,\n\t\t\t\t\temails: prev.emails.map((e) =>\n\t\t\t\t\t\te.id === email.id ? { ...e, read_at: new Date().toISOString() } : e,\n\t\t\t\t\t),\n\t\t\t\t}));\n\t\t\t\tmarkEmailAsReadAction({ emailId: email.id })\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\t\twindow.dispatchEvent(new CustomEvent(\"email-read\"));\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch(console.error);\n\t\t\t}\n\t\t},\n\t\t[router, folder],\n\t);\n\n\t// Load email from URL if ID changes\n\tuseEffect(() => {\n\t\tif (emailId && emailId === selectedEmailRef.current?.id) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (emailId && emails?.emails) {\n\t\t\tconst email = emails.emails.find((e) => e.id === emailId);\n\t\t\tif (email) {\n\t\t\t\tsetSelectedEmail(email);\n\t\t\t\tselectedEmailRef.current = email;\n\n\t\t\t\tconst hasContent = email.body_html || email.body;\n\t\t\t\tif (hasContent) {\n\t\t\t\t\tsetEmailContent({\n\t\t\t\t\t\thtml: email.body_html || null,\n\t\t\t\t\t\ttext: email.body || null,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tsetLoadingContent(true);\n\t\t\t\t\tfetchEmailContentAction(email.id)\n\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\t\t\tsetEmailContent({\n\t\t\t\t\t\t\t\t\thtml: result.html || null,\n\t\t\t\t\t\t\t\t\ttext: result.text || null,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsetEmailContent({ html: null, text: null });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\tsetEmailContent({ html: null, text: null });\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\tsetLoadingContent(false);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (!email.read_at) {\n\t\t\t\t\tsetEmails((prev) => ({\n\t\t\t\t\t\t...prev,\n\t\t\t\t\t\temails: prev.emails.map((e) =>\n\t\t\t\t\t\t\te.id === email.id\n\t\t\t\t\t\t\t\t? { ...e, read_at: new Date().toISOString() }\n\t\t\t\t\t\t\t\t: e,\n\t\t\t\t\t\t),\n\t\t\t\t\t}));\n\t\t\t\t\tmarkEmailAsReadAction({ emailId: email.id }).catch(console.error);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (!emailId && selectedEmail) {\n\t\t\tsetSelectedEmail(null);\n\t\t\tselectedEmailRef.current = null;\n\t\t\tsetEmailContent(null);\n\t\t}\n\t}, [emailId, emails?.emails]);\n\n\tconst handleRefresh = useCallback(() => {\n\t\tfetchEmails(true);\n\t\ttoast.success(\"Refreshing emails...\");\n\t}, [fetchEmails]);\n\n\tconst handleArchive = useCallback(\n\t\tasync (emailId: string) => {\n\t\t\ttry {\n\t\t\t\tif (folder !== \"archive\") {\n\t\t\t\t\tsetEmails((prev) => ({\n\t\t\t\t\t\t...prev,\n\t\t\t\t\t\temails: prev.emails.filter((e) => e.id !== emailId),\n\t\t\t\t\t\ttotal: prev.total - 1,\n\t\t\t\t\t}));\n\n\t\t\t\t\tif (selectedEmail?.id === emailId) {\n\t\t\t\t\t\tsetSelectedEmail(null);\n\t\t\t\t\t\tsetEmailContent(null);\n\t\t\t\t\t\tselectedEmailRef.current = null;\n\t\t\t\t\t\tconst params = new URLSearchParams();\n\t\t\t\t\t\tif (folder && folder !== \"inbox\") params.set(\"folder\", folder);\n\t\t\t\t\t\trouter.replace(\n\t\t\t\t\t\t\t`/dashboard/communication/email?${params.toString()}`,\n\t\t\t\t\t\t\t{ scroll: false },\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst result = await archiveEmailAction(emailId);\n\t\t\t\tif (result.success) {\n\t\t\t\t\ttoast.success(\"Email archived\");\n\t\t\t\t\twindow.dispatchEvent(new CustomEvent(\"email-archived\"));\n\t\t\t\t} else {\n\t\t\t\t\tfetchEmails(false);\n\t\t\t\t\ttoast.error(\"Failed to archive email\", {\n\t\t\t\t\t\tdescription: result.error || \"Unknown error\",\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tfetchEmails(false);\n\t\t\t\ttoast.error(\"Failed to archive email\");\n\t\t\t}\n\t\t},\n\t\t[fetchEmails, folder, selectedEmail, router],\n\t);\n\n\t// Confirm archive all - called from dialog\n\tconst confirmArchiveAll = useCallback(async () => {\n\t\tif (!emails?.emails || emails.emails.length === 0) {\n\t\t\ttoast.info(\"No emails to archive\");\n\t\t\tsetArchiveAllDialogOpen(false);\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tsetRefreshing(true);\n\t\t\tsetArchiveAllDialogOpen(false);\n\t\t\tconst result = await archiveAllEmailsAction(\n\t\t\t\t(folder || \"inbox\") as string,\n\t\t\t);\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\n\t\t\t\t\t`Archived ${result.archived} email${result.archived === 1 ? \"\" : \"s\"}`,\n\t\t\t\t);\n\t\t\t\tfetchEmails(false);\n\t\t\t\tsetSelectedEmail(null);\n\t\t\t\tsetEmailContent(null);\n\t\t\t\twindow.dispatchEvent(new CustomEvent(\"email-archived\"));\n\t\t\t} else {\n\t\t\t\ttoast.error(\"Failed to archive emails\", {\n\t\t\t\t\tdescription: result.error || \"Unknown error\",\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (err) {\n\t\t\ttoast.error(\"Failed to archive emails\");\n\t\t} finally {\n\t\t\tsetRefreshing(false);\n\t\t}\n\t}, [emails, folder, fetchEmails]);\n\n\tconst handleToggleSpam = useCallback(\n\t\tasync (emailId: string) => {\n\t\t\ttry {\n\t\t\t\tconst emailToUpdate = emails?.emails.find((e) => e.id === emailId);\n\t\t\t\tconst currentTags = (emailToUpdate?.tags as string[]) || [];\n\t\t\t\tconst isSpam =\n\t\t\t\t\tcurrentTags.includes(\"spam\") || emailToUpdate?.category === \"spam\";\n\t\t\t\tconst willBeSpam = !isSpam;\n\n\t\t\t\tsetEmails((prev) => {\n\t\t\t\t\tif (willBeSpam && folder !== \"spam\") {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...prev,\n\t\t\t\t\t\t\temails: prev.emails.filter((e) => e.id !== emailId),\n\t\t\t\t\t\t\ttotal: prev.total - 1,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!willBeSpam && folder === \"spam\") {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...prev,\n\t\t\t\t\t\t\temails: prev.emails.filter((e) => e.id !== emailId),\n\t\t\t\t\t\t\ttotal: prev.total - 1,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...prev,\n\t\t\t\t\t\temails: prev.emails.map((e) => {\n\t\t\t\t\t\t\tif (e.id === emailId) {\n\t\t\t\t\t\t\t\tconst newTags = willBeSpam\n\t\t\t\t\t\t\t\t\t? [...currentTags, \"spam\"]\n\t\t\t\t\t\t\t\t\t: currentTags.filter((tag) => tag !== \"spam\");\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t...e,\n\t\t\t\t\t\t\t\t\ttags: newTags.length > 0 ? newTags : null,\n\t\t\t\t\t\t\t\t\tcategory: willBeSpam ? \"spam\" : null,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn e;\n\t\t\t\t\t\t}),\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tif (\n\t\t\t\t\tselectedEmail?.id === emailId &&\n\t\t\t\t\t((willBeSpam && folder !== \"spam\") ||\n\t\t\t\t\t\t(!willBeSpam && folder === \"spam\"))\n\t\t\t\t) {\n\t\t\t\t\tsetSelectedEmail(null);\n\t\t\t\t\tsetEmailContent(null);\n\t\t\t\t\tselectedEmailRef.current = null;\n\t\t\t\t}\n\n\t\t\t\tconst result = await toggleSpamEmailAction(emailId);\n\t\t\t\tif (result.success) {\n\t\t\t\t\ttoast.success(\n\t\t\t\t\t\twillBeSpam ? \"Email marked as spam\" : \"Email removed from spam\",\n\t\t\t\t\t);\n\t\t\t\t\twindow.dispatchEvent(new CustomEvent(\"email-spam-toggled\"));\n\t\t\t\t} else {\n\t\t\t\t\tfetchEmails(false);\n\t\t\t\t\ttoast.error(\"Failed to update spam status\");\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\tfetchEmails(false);\n\t\t\t\ttoast.error(\"Failed to update spam status\");\n\t\t\t}\n\t\t},\n\t\t[fetchEmails, selectedEmail, folder, emails],\n\t);\n\n\tconst handleStar = useCallback(\n\t\tasync (emailId: string) => {\n\t\t\ttry {\n\t\t\t\tconst emailToUpdate = emails?.emails.find((e) => e.id === emailId);\n\t\t\t\tconst currentTags = (emailToUpdate?.tags as string[]) || [];\n\t\t\t\tconst isStarred = currentTags.includes(\"starred\");\n\t\t\t\tconst willBeStarred = !isStarred;\n\n\t\t\t\tsetEmails((prev) => {\n\t\t\t\t\tconst updatedEmails = prev.emails.map((e) => {\n\t\t\t\t\t\tif (e.id === emailId) {\n\t\t\t\t\t\t\tconst newTags = willBeStarred\n\t\t\t\t\t\t\t\t? [...currentTags, \"starred\"]\n\t\t\t\t\t\t\t\t: currentTags.filter((tag) => tag !== \"starred\");\n\t\t\t\t\t\t\treturn { ...e, tags: newTags.length > 0 ? newTags : null };\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn e;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (folder === \"starred\") {\n\t\t\t\t\t\tconst filteredEmails = updatedEmails.filter((e) => {\n\t\t\t\t\t\t\tconst tags = (e.tags as string[]) || [];\n\t\t\t\t\t\t\treturn tags.includes(\"starred\");\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...prev,\n\t\t\t\t\t\t\temails: filteredEmails,\n\t\t\t\t\t\t\ttotal: filteredEmails.length,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\treturn { ...prev, emails: updatedEmails };\n\t\t\t\t});\n\n\t\t\t\tif (selectedEmail?.id === emailId) {\n\t\t\t\t\tconst newTags = willBeStarred\n\t\t\t\t\t\t? [...currentTags, \"starred\"]\n\t\t\t\t\t\t: currentTags.filter((tag) => tag !== \"starred\");\n\t\t\t\t\tsetSelectedEmail({\n\t\t\t\t\t\t...selectedEmail,\n\t\t\t\t\t\ttags: newTags.length > 0 ? newTags : null,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (folder === \"starred\" && !willBeStarred) {\n\t\t\t\t\t\tsetSelectedEmail(null);\n\t\t\t\t\t\tsetEmailContent(null);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst result = await toggleStarEmailAction(emailId);\n\t\t\t\tif (result.success) {\n\t\t\t\t\twindow.dispatchEvent(new CustomEvent(\"email-starred-toggled\"));\n\t\t\t\t} else {\n\t\t\t\t\tfetchEmails(false);\n\t\t\t\t\ttoast.error(\"Failed to star email\");\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\tfetchEmails(false);\n\t\t\t\ttoast.error(\"Failed to star email\");\n\t\t\t}\n\t\t},\n\t\t[fetchEmails, selectedEmail, folder, emails],\n\t);\n\n\tconst handlePrintEmail = useCallback(() => {\n\t\tif (!selectedEmail) return;\n\n\t\tconst printContent = `\n\t\t\t<!DOCTYPE html>\n\t\t\t<html>\n\t\t\t<head>\n\t\t\t\t<title>${selectedEmail.subject || \"Email\"}</title>\n\t\t\t\t<style>\n\t\t\t\t\tbody { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }\n\t\t\t\t\t.header { border-bottom: 1px solid #e5e7eb; padding-bottom: 20px; margin-bottom: 20px; }\n\t\t\t\t\t.subject { font-size: 24px; font-weight: 600; margin-bottom: 12px; }\n\t\t\t\t\t.meta { color: #6b7280; font-size: 14px; }\n\t\t\t\t\t.meta-row { margin-bottom: 4px; }\n\t\t\t\t\t.body { line-height: 1.6; }\n\t\t\t\t</style>\n\t\t\t</head>\n\t\t\t<body>\n\t\t\t\t<div class=\"header\">\n\t\t\t\t\t<div class=\"subject\">${selectedEmail.subject || \"No Subject\"}</div>\n\t\t\t\t\t<div class=\"meta\">\n\t\t\t\t\t\t<div class=\"meta-row\"><strong>From:</strong> ${selectedEmail.from_name || \"\"} &lt;${selectedEmail.from_address || \"Unknown\"}&gt;</div>\n\t\t\t\t\t\t<div class=\"meta-row\"><strong>To:</strong> ${selectedEmail.to_address || \"Unknown\"}</div>\n\t\t\t\t\t\t<div class=\"meta-row\"><strong>Date:</strong> ${new Date(selectedEmail.created_at).toLocaleString()}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"body\">\n\t\t\t\t\t${emailContent?.html || selectedEmail.body_html || emailContent?.text || selectedEmail.body || \"No content\"}\n\t\t\t\t</div>\n\t\t\t</body>\n\t\t\t</html>\n\t\t`;\n\n\t\tconst printWindow = window.open(\"\", \"_blank\");\n\t\tif (printWindow) {\n\t\t\tprintWindow.document.write(printContent);\n\t\t\tprintWindow.document.close();\n\t\t\tprintWindow.focus();\n\t\t\tsetTimeout(() => printWindow.print(), 250);\n\t\t}\n\t}, [selectedEmail, emailContent]);\n\n\tconst handleDownloadEml = useCallback(() => {\n\t\tif (!selectedEmail) return;\n\n\t\tconst boundary = `----=_Part_${Date.now()}_${Math.random().toString(36).slice(2)}`;\n\t\tconst date = new Date(selectedEmail.created_at).toUTCString();\n\n\t\tconst emlContent = `MIME-Version: 1.0\nDate: ${date}\nSubject: ${selectedEmail.subject || \"No Subject\"}\nFrom: ${selectedEmail.from_name ? `${selectedEmail.from_name} <${selectedEmail.from_address}>` : selectedEmail.from_address || \"Unknown\"}\nTo: ${selectedEmail.to_address || \"Unknown\"}\nContent-Type: multipart/alternative; boundary=\"${boundary}\"\n\n--${boundary}\nContent-Type: text/plain; charset=\"UTF-8\"\nContent-Transfer-Encoding: 7bit\n\n${emailContent?.text || selectedEmail.body || \"No content\"}\n\n--${boundary}\nContent-Type: text/html; charset=\"UTF-8\"\nContent-Transfer-Encoding: 7bit\n\n${emailContent?.html || selectedEmail.body_html || \"<p>No content</p>\"}\n\n--${boundary}--\n`;\n\n\t\tconst blob = new Blob([emlContent], { type: \"message/rfc822\" });\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst link = document.createElement(\"a\");\n\t\tlink.href = url;\n\t\t// Safely sanitize filename - replace non-alphanumeric chars, handle empty/invalid subjects\n\t\tconst safeSubject =\n\t\t\t(selectedEmail.subject || \"email\")\n\t\t\t\t.replace(/[^a-z0-9\\s-]/gi, \"_\")\n\t\t\t\t.replace(/\\s+/g, \"_\")\n\t\t\t\t.slice(0, 50) || \"email\";\n\t\tlink.download = `${safeSubject}.eml`;\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t\tURL.revokeObjectURL(url);\n\n\t\ttoast.success(\"Email downloaded\");\n\t}, [selectedEmail, emailContent]);\n\n\tconst handleDelete = useCallback(\n\t\tasync (emailId: string) => {\n\t\t\ttry {\n\t\t\t\tsetEmails((prev) => ({\n\t\t\t\t\t...prev,\n\t\t\t\t\temails: prev.emails.filter((e) => e.id !== emailId),\n\t\t\t\t\ttotal: prev.total - 1,\n\t\t\t\t}));\n\n\t\t\t\tif (selectedEmail?.id === emailId) {\n\t\t\t\t\tsetSelectedEmail(null);\n\t\t\t\t\tsetEmailContent(null);\n\t\t\t\t\tselectedEmailRef.current = null;\n\t\t\t\t\tconst params = new URLSearchParams();\n\t\t\t\t\tif (folder && folder !== \"inbox\") params.set(\"folder\", folder);\n\t\t\t\t\trouter.replace(\n\t\t\t\t\t\t`/dashboard/communication/email?${params.toString()}`,\n\t\t\t\t\t\t{ scroll: false },\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\ttoast.success(\"Email moved to trash\");\n\t\t\t} catch {\n\t\t\t\tfetchEmails(false);\n\t\t\t\ttoast.error(\"Failed to delete email\");\n\t\t\t}\n\t\t},\n\t\t[fetchEmails, selectedEmail, folder, router],\n\t);\n\n\tconst handleRetry = useCallback(\n\t\tasync (emailId: string) => {\n\t\t\tif (!emailId) return;\n\n\t\t\tsetRetrying(true);\n\t\t\ttry {\n\t\t\t\tconst result = await retryFailedEmailAction(emailId);\n\n\t\t\t\tif (result.success) {\n\t\t\t\t\ttoast.success(\"Email sent successfully!\");\n\t\t\t\t\t// Refresh emails to get updated status\n\t\t\t\t\tfetchEmails(true);\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(\"Failed to send email\", {\n\t\t\t\t\t\tdescription: result.error || \"Please try again later\",\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"Failed to retry email:\", err);\n\t\t\t\ttoast.error(\"Failed to send email\", {\n\t\t\t\t\tdescription:\n\t\t\t\t\t\terr instanceof Error ? err.message : \"Unknown error occurred\",\n\t\t\t\t});\n\t\t\t} finally {\n\t\t\t\tsetRetrying(false);\n\t\t\t}\n\t\t},\n\t\t[fetchEmails],\n\t);\n\n\t// Mobile: show list when no email selected, show detail when email selected\n\t// Desktop: always show both panels side by side\n\tconst showListOnMobile = !selectedEmail && !composeMode;\n\tconst showDetailOnMobile = selectedEmail || composeMode;\n\n\treturn (\n\t\t<div className=\"flex h-full w-full flex-col overflow-hidden bg-sidebar\">\n\t\t\t<div className=\"flex flex-1 overflow-hidden min-h-0 md:gap-2\">\n\t\t\t\t{/* Email List Panel - Hidden on mobile when email is selected */}\n\t\t\t\t<div\n\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\"bg-card mb-1 shadow-sm flex flex-col overflow-hidden\",\n\t\t\t\t\t\t\"w-full h-full\", // Mobile: full width/height\n\t\t\t\t\t\t\"md:w-[400px] lg:w-[480px] md:rounded-tr-2xl\", // Desktop: fixed width with rounded corner\n\t\t\t\t\t\t// Mobile visibility logic\n\t\t\t\t\t\tshowListOnMobile ? \"flex\" : \"hidden md:flex\",\n\t\t\t\t\t)}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"w-full h-full flex flex-col\">\n\t\t\t\t\t\t<div className=\"sticky top-0 z-15 flex items-center justify-between gap-1.5 p-2 pb-0 transition-colors bg-card\">\n\t\t\t\t\t\t\t<div className=\"w-full\">\n\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-12 gap-2 mt-1\">\n\t\t\t\t\t\t\t\t\t<div className=\"col-span-12 flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t{/* Sidebar toggle - larger on mobile for touch */}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={toggleSidebar}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8 shrink-0\"\n\t\t\t\t\t\t\t\t\t\t\ttitle=\"Toggle sidebar\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<PanelLeft className=\"h-5 w-5 md:h-4 md:w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t<div className=\"relative flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t{/* Search input - text-base on mobile to prevent iOS zoom */}\n\t\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"search\"\n\t\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Search emails...\"\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={searchInput}\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => setSearchInput(e.target.value)}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 md:h-8 pl-9 pr-20 text-base md:text-sm border-input bg-white dark:bg-[#141414] dark:border-none\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\twidth=\"10\"\n\t\t\t\t\t\t\t\t\t\t\t\theight=\"10\"\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 10 10\"\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"absolute left-3 top-1/2 -translate-y-1/2 fill-[#71717A] dark:fill-[#6F6F6F]\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M6.81038 7.0756C6.18079 7.54011 5.40248 7.81466 4.56004 7.81466C2.46451 7.81466 0.765747 6.11589 0.765747 4.02037C0.765747 1.92484 2.46451 0.226074 4.56004 0.226074C6.65557 0.226074 8.35433 1.92484 8.35433 4.02037C8.35433 4.8628 8.07978 5.64112 7.61527 6.27071L9.70535 8.36078C9.92761 8.58305 9.92761 8.94341 9.70535 9.16568C9.48308 9.38794 9.12272 9.38794 8.90046 9.16568L6.81038 7.0756ZM7.21604 4.02037C7.21604 5.48724 6.02691 6.67637 4.56004 6.67637C3.09317 6.67637 1.90403 5.48724 1.90403 4.02037C1.90403 2.5535 3.09317 1.36436 4.56004 1.36436C6.02691 1.36436 7.21604 2.5535 7.21604 4.02037Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t{searchInput && (\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setSearchInput(\"\")}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<X className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={handleRefresh}\n\t\t\t\t\t\t\t\t\t\t\tdisabled={refreshing}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8\"\n\t\t\t\t\t\t\t\t\t\t\ttitle=\"Refresh\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<RefreshCw\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`h-5 w-5 md:h-4 md:w-4 text-muted-foreground ${refreshing ? \"animate-spin\" : \"\"}`}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/* Archive All - Owner only, icon button with confirmation dialog */}\n\t\t\t\t\t\t\t\t\t\t{isOwner &&\n\t\t\t\t\t\t\t\t\t\t\tfolder !== \"archive\" &&\n\t\t\t\t\t\t\t\t\t\t\temails?.emails &&\n\t\t\t\t\t\t\t\t\t\t\temails.emails.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setArchiveAllDialogOpen(true)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={refreshing}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 w-8 p-0 group/archive-all hover:bg-destructive/10\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Archive all emails\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Archive className=\"h-4 w-4 text-muted-foreground group-hover/archive-all:text-destructive transition-colors\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/* Subtle progress bar when refreshing - visible only during fetch */}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\"bg-[#006FFE] relative z-5 h-0.5 w-full transition-opacity\",\n\t\t\t\t\t\t\t\trefreshing ? \"opacity-100 animate-pulse\" : \"opacity-0\",\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t{/* Email Items */}\n\t\t\t\t\t\t<div className=\"relative z-1 flex-1 overflow-hidden pt-0 min-h-0\">\n\t\t\t\t\t\t\t<div className=\"hide-link-indicator flex h-full w-full\">\n\t\t\t\t\t\t\t\t<div className=\"flex flex-1 flex-col\" id=\"mail-list-scroll\">\n\t\t\t\t\t\t\t\t\t<ScrollArea className=\"scrollbar-none flex-1 overflow-x-hidden h-full\">\n\t\t\t\t\t\t\t\t\t\t{/* Only show error when there's no data at all - otherwise show existing emails optimistically */}\n\t\t\t\t\t\t\t\t\t\t{error &&\n\t\t\t\t\t\t\t\t\t\t(!emails?.emails || emails.emails.length === 0) ? (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center p-8\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-8 w-8 text-destructive mx-auto mb-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-destructive mb-2 font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tFailed to load emails\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground mb-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{error}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => fetchEmails()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tTry Again\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t) : emails?.emails?.length ? (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-h-[200px] px-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t{emails.emails.map((email) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst isSelected = selectedEmail?.id === email.id;\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div key={email.id} className=\"select-none md:my-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"hover:bg-accent group flex cursor-pointer flex-col items-start rounded-lg py-2 text-left text-sm transition-all hover:opacity-100 relative\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisSelected ? \"bg-accent opacity-100\" : \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t!email.read_at ? \"opacity-100\" : \"opacity-60\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleEmailSelect(email)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Hover Action Toolbar */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"dark:bg-panelDark absolute right-2 z-25 flex -translate-y-1/2 items-center gap-1 rounded-xl border bg-white p-1 opacity-0 shadow-sm group-hover:opacity-100 top-[-1] transition-opacity duration-200\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-6 w-6 overflow-visible p-0 hover:bg-accent group/star\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleStar(email.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temail.tags &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tArray.isArray(email.tags) &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temail.tags.includes(\"starred\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"Unstar\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Star\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Star\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"h-4 w-4 transition-colors group-hover/star:text-yellow-500\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temail.tags &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tArray.isArray(email.tags) &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temail.tags.includes(\"starred\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"fill-yellow-500 text-yellow-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-6 w-6 p-0 hover:bg-accent group/spam\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleToggleSpam(email.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temail.category === \"spam\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"Not spam\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Spam\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Flag\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"h-4 w-4 transition-colors group-hover/spam:text-orange-500\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temail.category === \"spam\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"fill-orange-500 text-orange-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-6 w-6 p-0 hover:bg-accent group/archive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleArchive(email.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Archive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Archive className=\"h-4 w-4 text-muted-foreground transition-colors group-hover/archive:text-blue-500\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Email Card Content */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"relative flex w-full items-center justify-between gap-4 px-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Avatar className=\"h-8 w-8 shrink-0 rounded-full border\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarFallback className=\"bg-white dark:bg-[#373737] text-[#9F9F9D] font-bold text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{email.from_address?.[0]?.toUpperCase() ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"U\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex w-full justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-full\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex w-full flex-row items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-row items-center gap-[4px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-bold text-md flex items-baseline gap-1 group-hover:opacity-100\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"line-clamp-1 overflow-hidden text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{email.direction === \"outbound\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? email.to_address ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Unknown recipient\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: email.from_name ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temail.from_address ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Unknown sender\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{!email.read_at && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"ml-0.5 size-2 rounded-full bg-[#006FFE]\"></span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-nowrap text-xs font-normal opacity-70 transition-opacity group-hover:opacity-100 dark:text-[#8C8C8C]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{email.created_at\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? new Date(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temail.created_at,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t).toLocaleTimeString([], {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thour: \"2-digit\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tminute: \"2-digit\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"mt-1 line-clamp-1 min-w-0 overflow-hidden text-sm text-[#8C8C8C] flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{email.subject || \"No subject\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Status badges */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1 shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Customer link badge */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{email.customer?.id && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thref={`/dashboard/customers/${email.customer.id}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation()\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"px-1.5 py-0.5 rounded text-[10px] bg-primary/10 text-primary hover:bg-primary/20 transition-colors flex items-center gap-0.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle={`View ${getCustomerDisplayName(email.customer)} profile`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<User className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"hidden sm:inline\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{getCustomerDisplayName(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temail.customer,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{email.status === \"draft\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-1.5 py-0.5 rounded text-[10px] bg-muted text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tDraft\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{email.status === \"failed\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-1.5 py-0.5 rounded text-[10px] bg-destructive/10 text-destructive cursor-help flex items-center gap-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tFailed\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tEmail failed to send\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground mt-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tClick email to retry or view\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdetails\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{email.direction === \"outbound\" &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temail.status !== \"draft\" &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temail.status !== \"failed\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-1.5 py-0.5 rounded text-[10px] bg-blue-500/10 text-blue-600\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSent\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center p-8\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{refreshing ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground mx-auto mb-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tLoading emails...\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-medium text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{searchQuery\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"No emails found\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"No emails yet\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{searchQuery\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"Try adjusting your search terms\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Emails will appear here when received\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</ScrollArea>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Right Panel - Email Composer OR Email Detail */}\n\t\t\t\t{/* Mobile: shown when email selected or compose mode, Desktop: always visible as flex-1 */}\n\t\t\t\t{composeMode ? (\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"bg-card mb-1 shadow-sm flex flex-col min-w-0 overflow-hidden\",\n\t\t\t\t\t\t\t\"w-full h-full\", // Mobile: full width/height\n\t\t\t\t\t\t\t\"md:rounded-tl-2xl md:flex-1\", // Desktop: rounded corner and flex\n\t\t\t\t\t\t\tshowDetailOnMobile ? \"flex\" : \"hidden md:flex\",\n\t\t\t\t\t\t)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<EmailFullComposer\n\t\t\t\t\t\t\tcompanyId={companyId}\n\t\t\t\t\t\t\tonClose={() => setComposeMode(false)}\n\t\t\t\t\t\t\tonSent={() => {\n\t\t\t\t\t\t\t\tsetComposeMode(false);\n\t\t\t\t\t\t\t\tfetchEmails(true);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tclassName=\"h-full\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t) : selectedEmail ? (\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"bg-card mb-1 shadow-sm flex flex-col min-w-0 overflow-hidden\",\n\t\t\t\t\t\t\t\"w-full h-full\", // Mobile: full width/height\n\t\t\t\t\t\t\t\"md:rounded-tl-2xl md:flex-1\", // Desktop: rounded corner and flex\n\t\t\t\t\t\t\tshowDetailOnMobile ? \"flex\" : \"hidden md:flex\",\n\t\t\t\t\t\t)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div className=\"relative flex-1 min-h-0 flex flex-col\">\n\t\t\t\t\t\t\t<div className=\"bg-card relative flex flex-col overflow-hidden transition-all duration-300 h-full flex-1 min-h-0\">\n\t\t\t\t\t\t\t\t{/* Email Header Toolbar */}\n\t\t\t\t\t\t\t\t<div className=\"sticky top-0 z-15 flex shrink-0 items-center justify-between gap-1.5 p-2 pb-0 transition-colors bg-card\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex flex-1 items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t{/* Back button (mobile) / Close button (desktop) */}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tsetSelectedEmail(null);\n\t\t\t\t\t\t\t\t\t\t\t\tsetEmailContent(null);\n\t\t\t\t\t\t\t\t\t\t\t\tselectedEmailRef.current = null;\n\t\t\t\t\t\t\t\t\t\t\t\tconst params = new URLSearchParams();\n\t\t\t\t\t\t\t\t\t\t\t\tif (folder && folder !== \"inbox\")\n\t\t\t\t\t\t\t\t\t\t\t\t\tparams.set(\"folder\", folder);\n\t\t\t\t\t\t\t\t\t\t\t\trouter.push(\n\t\t\t\t\t\t\t\t\t\t\t\t\t`/dashboard/communication/email?${params.toString()}`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t{ scroll: false },\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8\"\n\t\t\t\t\t\t\t\t\t\t\ttitle=\"Back to list\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{/* Arrow on mobile, X on desktop */}\n\t\t\t\t\t\t\t\t\t\t\t<ArrowLeft className=\"h-5 w-5 md:hidden text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t<X className=\"h-4 w-4 hidden md:block text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t<Separator\n\t\t\t\t\t\t\t\t\t\t\torientation=\"vertical\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-4 bg-border/60 hidden md:block\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t{/* Reply all - hidden text on mobile */}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-auto md:px-2\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => setReplyMode(\"reply-all\")}\n\t\t\t\t\t\t\t\t\t\t\ttitle=\"Reply all\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<ReplyAll className=\"h-5 w-5 md:h-4 md:w-4 md:mr-1.5 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm leading-none font-medium hidden md:inline\">\n\t\t\t\t\t\t\t\t\t\t\t\tReply all\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/* Notes - hidden on mobile, accessible via more menu */}\n\t\t\t\t\t\t\t\t\t\t<Sheet open={notesOpen} onOpenChange={setNotesOpen}>\n\t\t\t\t\t\t\t\t\t\t\t<SheetTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8 hidden md:flex\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Notes\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<StickyNote className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</SheetTrigger>\n\t\t\t\t\t\t\t\t\t\t\t<SheetContent>\n\t\t\t\t\t\t\t\t\t\t\t\t<SheetHeader>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<SheetTitle>Email Notes</SheetTitle>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<SheetDescription>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tAdd private notes about this email.\n\t\t\t\t\t\t\t\t\t\t\t\t\t</SheetDescription>\n\t\t\t\t\t\t\t\t\t\t\t\t</SheetHeader>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"py-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Add your notes here...\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={emailNotes}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => setEmailNotes(e.target.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"min-h-[200px] resize-none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"mt-4 flex justify-end gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setNotesOpen(false)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.success(\"Notes saved\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetNotesOpen(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSave Notes\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</SheetContent>\n\t\t\t\t\t\t\t\t\t\t</Sheet>\n\t\t\t\t\t\t\t\t\t\t{/* Star - visible on all sizes */}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8 group/star\"\n\t\t\t\t\t\t\t\t\t\t\ttitle={\n\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail?.tags?.includes(\"starred\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"Unstar\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Star\"\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail && handleStar(selectedEmail.id)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Star\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"h-5 w-5 md:h-4 md:w-4 transition-colors group-hover/star:text-yellow-500\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail?.tags?.includes(\"starred\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"fill-yellow-500 text-yellow-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/* Spam - hidden on mobile, in more menu */}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8 hidden md:flex group/spam\"\n\t\t\t\t\t\t\t\t\t\t\ttitle={\n\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail?.category === \"spam\" ? \"Not spam\" : \"Spam\"\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail && handleToggleSpam(selectedEmail.id)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Flag\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"h-4 w-4 transition-colors group-hover/spam:text-orange-500\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail?.category === \"spam\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"fill-orange-500 text-orange-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/* Archive - visible on all sizes */}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8\"\n\t\t\t\t\t\t\t\t\t\t\ttitle=\"Archive\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail && handleArchive(selectedEmail.id)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Archive className=\"h-5 w-5 md:h-4 md:w-4\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/* More menu */}\n\t\t\t\t\t\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"More\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<MoreHorizontal className=\"h-5 w-5 md:h-4 md:w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuContent align=\"end\" className=\"w-48\">\n\t\t\t\t\t\t\t\t\t\t\t\t{/* Mobile-only options */}\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail && handleToggleSpam(selectedEmail.id)\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"md:hidden\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Flag className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail?.category === \"spam\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"Not spam\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Mark as spam\"}\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setNotesOpen(true)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"md:hidden\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<StickyNote className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tNotes\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuSeparator className=\"md:hidden\" />\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem onClick={handlePrintEmail}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Printer className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tPrint\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem onClick={handleDownloadEml}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Download className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tDownload as .eml\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail && handleDelete(selectedEmail.id)\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-destructive focus:text-destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tDelete\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t\t\t\t\t\t</DropdownMenu>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{/* Email Content */}\n\t\t\t\t\t\t\t\t<div className=\"flex min-h-0 flex-1 flex-col overflow-hidden\">\n\t\t\t\t\t\t\t\t\t<div className=\"relative overflow-hidden flex-1 h-full min-h-0 flex flex-col\">\n\t\t\t\t\t\t\t\t\t\t<TooltipProvider delayDuration={100}>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"border-b border-border/50 px-2 py-4 space-y-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t<h1 className=\"text-base font-semibold text-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.subject || \"No Subject\"}\n\t\t\t\t\t\t\t\t\t\t\t\t</h1>\n\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Avatar className=\"h-9 w-9 shrink-0 rounded-md cursor-pointer\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarFallback className=\"bg-muted text-muted-foreground font-semibold text-sm rounded-md\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.from_address?.[0]?.toUpperCase() ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"U\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold text-sm text-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.from_name ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail.from_address ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Unknown\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{!selectedEmail.read_at && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"h-2 w-2 rounded-full bg-primary\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tto{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.to_address?.split(\"@\")[0] ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"you\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<CustomerInfoPill\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcustomer={selectedEmail.customer}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfallbackName={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail.from_name || undefined\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfallbackEmail={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail.from_address || undefined\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{new Date(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail.created_at,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t).toLocaleTimeString(\"en-US\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thour: \"numeric\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tminute: \"2-digit\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t{/* Email Tracking Status - Only for outbound */}\n\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.direction === \"outbound\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-col gap-2 pt-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1 flex-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail.sent_at\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-blue-500/10 text-blue-600\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-muted text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Send className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>Sent</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.sent_at\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? `Sent ${new Date(selectedEmail.sent_at).toLocaleString()}`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Not sent yet\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.sent_at && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ChevronRight className=\"h-3 w-3 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.sent_at && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail.delivered_at\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-green-500/10 text-green-600\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-muted text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<CheckCheck className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>Delivered</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.delivered_at\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? `Delivered ${new Date(selectedEmail.delivered_at).toLocaleString()}`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Waiting...\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.delivered_at && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ChevronRight className=\"h-3 w-3 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.delivered_at && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail.opened_at\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-purple-500/10 text-purple-600\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-muted/50 text-muted-foreground/70\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Eye className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tOpened\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.open_count &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail.open_count > 1\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? ` (${selectedEmail.open_count})`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-3 w-3 text-amber-500\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.opened_at\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? `Opened ${new Date(selectedEmail.opened_at).toLocaleString()}`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Not opened\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-amber-500 mt-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t Unreliable metric\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.delivered_at && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ChevronRight className=\"h-3 w-3 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.delivered_at && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail.clicked_at\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-amber-500/10 text-amber-600\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-muted text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<MousePointerClick className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tClicked\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.click_count &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail.click_count > 1\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? ` (${selectedEmail.click_count})`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.clicked_at\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? `Clicked ${new Date(selectedEmail.clicked_at).toLocaleString()}`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"No clicks\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TooltipProvider>\n\n\t\t\t\t\t\t\t\t\t\t{/* Email Body */}\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 overflow-hidden flex flex-col min-h-0\">\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 overflow-y-auto px-2 py-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t{loadingContent ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center py-12\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground mx-auto mb-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tLoading email content...\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<EmailContent\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thtml={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temailContent?.html ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail.body_html ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnull\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temailContent?.text || selectedEmail.body || null\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tattachments={null}\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t{/* Reply Composer or Action Bar */}\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"px-2 py-4 pb-safe\">\n\t\t\t\t\t\t\t\t\t\t\t\t{replyMode ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<EmailReplyComposer\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmode={replyMode}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail={selectedEmail as any}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompanyId={companyId}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClose={() => setReplyMode(null)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonSent={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetReplyMode(null);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfetchEmails(true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t) : selectedEmail.status === \"failed\" ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 flex-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Retry button for failed emails */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-11 px-4 flex-1 md:flex-none md:h-9\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleRetry(selectedEmail.id)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={retrying}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{retrying ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-5 w-5 md:h-4 md:w-4 mr-2 animate-spin\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSending...\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<RefreshCw className=\"h-5 w-5 md:h-4 md:w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tRetry Send\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Show failure reason if available */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.failure_reason && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-full flex items-start gap-2 p-3 rounded-lg bg-destructive/10 border border-destructive/20\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-4 w-4 text-destructive shrink-0 mt-0.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-medium text-destructive\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tFailed to send\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground mt-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.failure_reason}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 flex-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Reply - primary action, larger on mobile */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-11 px-4 flex-1 md:flex-none md:h-9\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setReplyMode(\"reply\")}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Reply className=\"h-5 w-5 md:h-4 md:w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tReply\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Reply All - secondary on mobile */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-11 px-3 flex-1 md:flex-none md:h-9 md:px-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setReplyMode(\"reply-all\")}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ReplyAll className=\"h-5 w-5 md:h-4 md:w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"hidden xs:inline\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tReply All\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"xs:hidden\">All</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Forward - secondary on mobile */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-11 px-3 flex-1 md:flex-none md:h-9 md:px-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setReplyMode(\"forward\")}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Forward className=\"h-5 w-5 md:h-4 md:w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tForward\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t) : null}\n\t\t\t</div>\n\n\t\t\t{/* Archive All Confirmation Dialog - Owner only */}\n\t\t\t<AlertDialog\n\t\t\t\topen={archiveAllDialogOpen}\n\t\t\t\tonOpenChange={setArchiveAllDialogOpen}\n\t\t\t>\n\t\t\t\t<AlertDialogContent>\n\t\t\t\t\t<AlertDialogHeader>\n\t\t\t\t\t\t<AlertDialogTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<AlertTriangle className=\"h-5 w-5 text-destructive\" />\n\t\t\t\t\t\t\tArchive All{\" \"}\n\t\t\t\t\t\t\t{folder\n\t\t\t\t\t\t\t\t? folder.charAt(0).toUpperCase() + folder.slice(1)\n\t\t\t\t\t\t\t\t: \"Inbox\"}{\" \"}\n\t\t\t\t\t\t\tEmails\n\t\t\t\t\t\t</AlertDialogTitle>\n\t\t\t\t\t\t<AlertDialogDescription>\n\t\t\t\t\t\t\tThis will archive <strong>{emails?.emails?.length || 0}</strong>{\" \"}\n\t\t\t\t\t\t\temail{(emails?.emails?.length || 0) !== 1 ? \"s\" : \"\"} from your{\" \"}\n\t\t\t\t\t\t\t<strong>{folder || \"inbox\"}</strong> folder. This action can be\n\t\t\t\t\t\t\tundone by viewing the Archive folder.\n\t\t\t\t\t\t</AlertDialogDescription>\n\t\t\t\t\t</AlertDialogHeader>\n\t\t\t\t\t<AlertDialogFooter>\n\t\t\t\t\t\t<AlertDialogCancel>Cancel</AlertDialogCancel>\n\t\t\t\t\t\t<AlertDialogAction\n\t\t\t\t\t\t\tonClick={confirmArchiveAll}\n\t\t\t\t\t\t\tclassName=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tArchive All\n\t\t\t\t\t\t</AlertDialogAction>\n\t\t\t\t\t</AlertDialogFooter>\n\t\t\t\t</AlertDialogContent>\n\t\t\t</AlertDialog>\n\t\t</div>\n\t);\n}\n","\"use client\";\n\nimport { ChevronDown, ExternalLink, Mail, Phone, User } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { cn } from \"@/lib/utils\";\nimport {\n\tgetCustomerDisplayName,\n\tgetCustomerInitials,\n} from \"@/lib/utils/customer-display\";\n\nexport interface CustomerData {\n\tid?: string;\n\tfirst_name?: string | null;\n\tlast_name?: string | null;\n\tdisplay_name?: string | null;\n\temail?: string | null;\n\tphone?: string | null;\n\tcompany_name?: string | null;\n}\n\ninterface CustomerInfoPillProps {\n\tcustomer: CustomerData | null | undefined;\n\t/** Fallback name if no customer linked */\n\tfallbackName?: string;\n\t/** Fallback email if no customer linked */\n\tfallbackEmail?: string;\n\t/** Fallback phone if no customer linked */\n\tfallbackPhone?: string;\n\t/** Additional CSS classes */\n\tclassName?: string;\n\t/** Size variant */\n\tsize?: \"sm\" | \"default\";\n}\n\n/**\n * A pill-shaped badge displaying customer name with a popover\n * showing detailed customer information on click.\n */\nexport function CustomerInfoPill({\n\tcustomer,\n\tfallbackName,\n\tfallbackEmail,\n\tfallbackPhone,\n\tclassName,\n\tsize = \"default\",\n}: CustomerInfoPillProps) {\n\tconst email = customer?.email || fallbackEmail;\n\tconst phone = customer?.phone || fallbackPhone;\n\n\t// Use unified customer display utility\n\tconst displayName = getCustomerDisplayName(\n\t\tcustomer ? { ...customer, email: customer.email || fallbackEmail } : null,\n\t\tfallbackName || fallbackEmail,\n\t);\n\tconst hasCustomerProfile = !!customer?.id;\n\n\t// Get initials using utility\n\tconst initials = getCustomerInitials(customer);\n\n\treturn (\n\t\t<Popover>\n\t\t\t<PopoverTrigger asChild>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\"inline-flex items-center gap-1 rounded-full border border-border/50 bg-muted/50 hover:bg-muted transition-colors cursor-pointer\",\n\t\t\t\t\t\tsize === \"sm\" ? \"px-2 py-0.5 text-xs\" : \"px-2.5 py-1 text-sm\",\n\t\t\t\t\t\tclassName,\n\t\t\t\t\t)}\n\t\t\t\t>\n\t\t\t\t\t<span className=\"font-medium truncate max-w-[150px]\">\n\t\t\t\t\t\t{displayName}\n\t\t\t\t\t</span>\n\t\t\t\t\t<ChevronDown\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"text-muted-foreground\",\n\t\t\t\t\t\t\tsize === \"sm\" ? \"h-3 w-3\" : \"h-3.5 w-3.5\",\n\t\t\t\t\t\t)}\n\t\t\t\t\t/>\n\t\t\t\t</button>\n\t\t\t</PopoverTrigger>\n\t\t\t<PopoverContent className=\"w-72 p-0\" align=\"start\">\n\t\t\t\t<div className=\"p-4\">\n\t\t\t\t\t{/* Header with avatar */}\n\t\t\t\t\t<div className=\"flex items-start gap-3 mb-3\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\"flex items-center justify-center rounded-full bg-primary/10 text-primary font-semibold\",\n\t\t\t\t\t\t\t\tsize === \"sm\" ? \"h-10 w-10 text-sm\" : \"h-12 w-12 text-base\",\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{initials || <User className=\"h-5 w-5\" />}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t<p className=\"font-semibold text-foreground truncate\">\n\t\t\t\t\t\t\t\t{displayName}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t{customer?.company_name && (\n\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground truncate\">\n\t\t\t\t\t\t\t\t\t{customer.company_name}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{!hasCustomerProfile && (\n\t\t\t\t\t\t\t\t<span className=\"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400 mt-1\">\n\t\t\t\t\t\t\t\t\tNot linked\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Contact details */}\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t{email && (\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-sm\">\n\t\t\t\t\t\t\t\t<Mail className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\thref={`mailto:${email}`}\n\t\t\t\t\t\t\t\t\tclassName=\"text-foreground hover:text-primary truncate transition-colors\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{email}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{phone && (\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-sm\">\n\t\t\t\t\t\t\t\t<Phone className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\thref={`tel:${phone}`}\n\t\t\t\t\t\t\t\t\tclassName=\"text-foreground hover:text-primary transition-colors\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{phone}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{!email && !phone && (\n\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground italic\">\n\t\t\t\t\t\t\t\tNo contact info available\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Footer with profile link */}\n\t\t\t\t{hasCustomerProfile && (\n\t\t\t\t\t<div className=\"border-t border-border px-4 py-3 bg-muted/30\">\n\t\t\t\t\t\t<Button variant=\"outline\" size=\"sm\" className=\"w-full\" asChild>\n\t\t\t\t\t\t\t<Link href={`/dashboard/customers/${customer.id}`}>\n\t\t\t\t\t\t\t\t<span>View Full Profile</span>\n\t\t\t\t\t\t\t\t<ExternalLink className=\"h-3.5 w-3.5 ml-1.5\" />\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</PopoverContent>\n\t\t</Popover>\n\t);\n}\n"],"names":[],"mappings":"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"}