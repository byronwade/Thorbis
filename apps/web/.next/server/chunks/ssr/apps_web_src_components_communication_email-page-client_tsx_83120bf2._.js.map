{"version":3,"sources":["../../../../../../apps/web/src/components/communication/email-page-client.tsx","../../../../../../apps/web/src/actions/data%3Adcf2eb%20%3Ctext/javascript%3E","../../../../../../apps/web/src/actions/data%3Acba4c0%20%3Ctext/javascript%3E","../../../../../../apps/web/src/actions/data%3Ab1deba%20%3Ctext/javascript%3E","../../../../../../apps/web/src/actions/data%3A001272%20%3Ctext/javascript%3E","../../../../../../apps/web/src/components/communication/customer-info-pill.tsx","../../../../../../apps/web/src/components/communication/email-full-composer.tsx","../../../../../../apps/web/src/actions/data%3Af4910e%20%3Ctext/javascript%3E","../../../../../../apps/web/src/actions/data%3A0e9a65%20%3Ctext/javascript%3E","../../../../../../apps/web/src/components/communication/recipient-autocomplete.tsx","../../../../../../apps/web/src/components/communication/email-reply-composer.tsx","../../../../../../apps/web/src/lib/email/address-utils.ts"],"sourcesContent":["\"use client\";\n\nimport type { EmailRecord, EmailsResult, EmailFolder, InboxType, EmailCategory } from \"@/lib/queries/emails\";\nimport {\n\tarchiveEmailAction,\n\tarchiveAllEmailsAction,\n\tfetchEmailContentAction,\n\tgetEmailsAction,\n\tmarkEmailAsReadAction,\n\ttoggleSpamEmailAction,\n\ttoggleStarEmailAction,\n\tretryFailedEmailAction,\n} from \"@/actions/email-actions\";\nimport { CustomerInfoPill } from \"@/components/communication/customer-info-pill\";\nimport { EmailContent } from \"@/components/communication/email-content\";\nimport { EmailFullComposer } from \"@/components/communication/email-full-composer\";\nimport { EmailReplyComposer, type EmailReplyMode } from \"@/components/communication/email-reply-composer\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport {\n\tAlertTriangle,\n\tArchive,\n\tArrowLeft,\n\tCheckCheck,\n\tChevronRight,\n\tDownload,\n\tEye,\n\tFlag,\n\tForward,\n\tInfo,\n\tLoader2,\n\tMoreHorizontal,\n\tMousePointerClick,\n\tPanelLeft,\n\tPrinter,\n\tRefreshCw,\n\tReply,\n\tReplyAll,\n\tSend,\n\tStar,\n\tStickyNote,\n\tTrash2,\n\tUser,\n\tX\n} from \"lucide-react\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n\tSheet,\n\tSheetContent,\n\tSheetDescription,\n\tSheetHeader,\n\tSheetTitle,\n\tSheetTrigger,\n} from \"@/components/ui/sheet\";\nimport {\n\tAlertDialog,\n\tAlertDialogAction,\n\tAlertDialogCancel,\n\tAlertDialogContent,\n\tAlertDialogDescription,\n\tAlertDialogFooter,\n\tAlertDialogHeader,\n\tAlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useCallback, useEffect, useRef, useState, useTransition } from \"react\";\nimport { toast } from \"sonner\";\nimport { useRouter, useSearchParams, useParams } from \"next/navigation\";\nimport Link from \"next/link\";\nimport { cn } from \"@/lib/utils\";\nimport { getCustomerDisplayName } from \"@/lib/utils/customer-display\";\nimport { useSidebar } from \"@/components/ui/sidebar\";\nimport { useRoleStore } from \"@/lib/stores/role-store\";\nimport { USER_ROLES } from \"@/types/roles\";\n\ntype EmailPageClientProps = {\n\tinitialEmails: EmailsResult;\n\tinitialInboxType: InboxType;\n\tinitialFolder?: EmailFolder;\n\tinitialCategory?: EmailCategory;\n\tinitialEmailId: string | null;\n\tcompanyId: string | null;\n};\n\nexport function EmailPageClient({\n\tinitialEmails,\n\tinitialInboxType,\n\tinitialFolder,\n\tinitialCategory,\n\tinitialEmailId,\n\tcompanyId,\n}: EmailPageClientProps) {\n\tconst router = useRouter();\n\tconst searchParams = useSearchParams();\n\tconst params = useParams();\n\n\t// Read current inbox type and folder/category from URL\n\tconst inboxType: InboxType = (searchParams?.get(\"inbox\") as InboxType) || initialInboxType;\n\tconst folder = searchParams?.get(\"folder\") || initialFolder;\n\tconst category = searchParams?.get(\"category\") || initialCategory;\n\n\tconst emailIdFromPath = params?.id as string | undefined;\n\tconst emailIdFromQuery = searchParams?.get(\"id\");\n\tconst emailId = emailIdFromPath || emailIdFromQuery || initialEmailId;\n\tconst [isPending, startTransition] = useTransition();\n\tconst [emails, setEmails] = useState<EmailsResult>(initialEmails);\n\t// Note: removed `loading` state - we use `refreshing` for all fetches to keep UI optimistic\n\tconst [refreshing, setRefreshing] = useState(false);\n\tconst [error, setError] = useState<string | null>(null);\n\tconst [selectedEmail, setSelectedEmail] = useState<EmailRecord | null>(() => {\n\t\tif (initialEmailId && initialEmails.emails) {\n\t\t\treturn initialEmails.emails.find(e => e.id === initialEmailId) || null;\n\t\t}\n\t\treturn null;\n\t});\n\tconst [emailContent, setEmailContent] = useState<{ html?: string | null; text?: string | null } | null>(() => {\n\t\tif (selectedEmail) {\n\t\t\treturn {\n\t\t\t\thtml: selectedEmail.body_html || null,\n\t\t\t\ttext: selectedEmail.body || null,\n\t\t\t};\n\t\t}\n\t\treturn null;\n\t});\n\tconst [loadingContent, setLoadingContent] = useState(false);\n\tconst [searchQuery, setSearchQuery] = useState(\"\");\n\tconst [searchInput, setSearchInput] = useState(\"\");\n\tconst searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\tconst selectedEmailRef = useRef<EmailRecord | null>(selectedEmail);\n\tconst { toggleSidebar } = useSidebar();\n\tconst [replyMode, setReplyMode] = useState<EmailReplyMode | null>(null);\n\tconst [composeMode, setComposeMode] = useState(false);\n\tconst [notesOpen, setNotesOpen] = useState(false);\n\tconst [emailNotes, setEmailNotes] = useState<string>(\"\");\n\tconst [archiveAllDialogOpen, setArchiveAllDialogOpen] = useState(false);\n\tconst [retrying, setRetrying] = useState(false);\n\tconst role = useRoleStore((state) => state.role);\n\tconst isOwner = role === USER_ROLES.OWNER || role === USER_ROLES.ADMIN;\n\n\t// Handle compose=true query param from navigation\n\tuseEffect(() => {\n\t\tconst shouldCompose = searchParams?.get(\"compose\") === \"true\";\n\t\tif (shouldCompose && !composeMode) {\n\t\t\tsetComposeMode(true);\n\t\t\tsetSelectedEmail(null);\n\t\t\tsetEmailContent(null);\n\t\t\tselectedEmailRef.current = null;\n\t\t\tconst newParams = new URLSearchParams(searchParams?.toString() || \"\");\n\t\t\tnewParams.delete(\"compose\");\n\t\t\tnewParams.delete(\"to\");\n\t\t\tnewParams.delete(\"name\");\n\t\t\tnewParams.delete(\"customerId\");\n\t\t\tconst newUrl = newParams.toString()\n\t\t\t\t? `/dashboard/communication/email?${newParams.toString()}`\n\t\t\t\t: \"/dashboard/communication/email\";\n\t\t\trouter.replace(newUrl);\n\t\t}\n\t}, [searchParams, router, composeMode]);\n\n\t// Keyboard shortcut: 'C' to open compose mode\n\tuseEffect(() => {\n\t\tconst handleKeyDown = (e: KeyboardEvent) => {\n\t\t\tconst target = e.target as HTMLElement;\n\t\t\tif (target.tagName === \"INPUT\" || target.tagName === \"TEXTAREA\" || target.isContentEditable) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (e.key === \"c\" && !e.metaKey && !e.ctrlKey && !e.altKey && !composeMode) {\n\t\t\t\te.preventDefault();\n\t\t\t\tsetComposeMode(true);\n\t\t\t\tsetSelectedEmail(null);\n\t\t\t\tsetEmailContent(null);\n\t\t\t\tselectedEmailRef.current = null;\n\t\t\t}\n\t\t};\n\n\t\twindow.addEventListener(\"keydown\", handleKeyDown);\n\t\treturn () => window.removeEventListener(\"keydown\", handleKeyDown);\n\t}, [composeMode]);\n\n\t// Fetch emails function (for refresh and search)\n\t// OPTIMISTIC: Always use refreshing state (subtle indicator) instead of blocking loading spinner\n\t// This ensures emails stay visible while new data is being fetched\n\tconst fetchEmails = useCallback(async (showRefreshing = false) => {\n\t\tsetRefreshing(true);\n\t\tsetError(null);\n\n\t\tstartTransition(async () => {\n\t\t\ttry {\n\t\t\t\tconst result = await getEmailsAction({\n\t\t\t\t\tlimit: 50,\n\t\t\t\t\toffset: 0,\n\t\t\t\t\ttype: \"all\",\n\t\t\t\t\tinboxType,\n\t\t\t\t\tfolder: inboxType === \"personal\" ? (folder as EmailFolder) : undefined,\n\t\t\t\t\tcategory: inboxType === \"company\" ? (category as EmailCategory) : undefined,\n\t\t\t\t\tsearch: searchQuery || undefined,\n\t\t\t\t\tsortBy: \"created_at\",\n\t\t\t\t\tsortOrder: \"desc\"\n\t\t\t\t});\n\n\t\t\t\tconst normalizedEmails = result.emails.map(email => {\n\t\t\t\t\tlet parsedToAddress = email.to_address;\n\t\t\t\t\tif (typeof email.to_address === 'string') {\n\t\t\t\t\t\tconst trimmed = email.to_address.trim();\n\t\t\t\t\t\tif (trimmed.startsWith('[') && trimmed.endsWith(']')) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst parsed = JSON.parse(email.to_address);\n\t\t\t\t\t\t\t\tif (Array.isArray(parsed) && parsed.length > 0) {\n\t\t\t\t\t\t\t\t\tparsedToAddress = parsed[0];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t// Keep original\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn { ...email, to_address: parsedToAddress };\n\t\t\t\t});\n\n\t\t\t\tsetEmails({\n\t\t\t\t\t...result,\n\t\t\t\t\temails: normalizedEmails as unknown as EmailRecord[],\n\t\t\t\t});\n\n\t\t\t\tconst currentSelected = selectedEmailRef.current;\n\t\t\t\tif (currentSelected) {\n\t\t\t\t\tconst updatedEmail = result.emails.find(e => e.id === currentSelected.id);\n\t\t\t\t\tif (updatedEmail) {\n\t\t\t\t\t\tsetSelectedEmail(updatedEmail as unknown as EmailRecord);\n\t\t\t\t\t\tselectedEmailRef.current = updatedEmail as unknown as EmailRecord;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetSelectedEmail(null);\n\t\t\t\t\t\tselectedEmailRef.current = null;\n\t\t\t\t\t\tsetEmailContent(null);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"Failed to fetch emails:\", err);\n\t\t\t\tconst errorMessage = err instanceof Error ? err.message : \"Failed to load emails\";\n\t\t\t\tsetError(errorMessage);\n\t\t\t\ttoast.error(\"Failed to load emails\", { description: errorMessage });\n\t\t\t} finally {\n\t\t\t\tsetRefreshing(false);\n\t\t\t}\n\t\t});\n\t}, [searchQuery, folder, inboxType, category]);\n\n\t// Refetch when search changes (NOT on initial mount - we have server data)\n\tuseEffect(() => {\n\t\tif (searchQuery) {\n\t\t\tfetchEmails();\n\t\t}\n\t}, [searchQuery]);\n\n\t// Use ref to track refreshing state without triggering effect re-runs\n\tconst refreshingRef = useRef(refreshing);\n\trefreshingRef.current = refreshing;\n\n\t// Auto-refresh emails every 30 seconds to catch new incoming emails\n\t// This prevents the \"have to refresh to see emails\" issue\n\tuseEffect(() => {\n\t\tconst interval = setInterval(() => {\n\t\t\t// Only auto-refresh if not in compose mode and not already refreshing\n\t\t\tif (!composeMode && !refreshingRef.current) {\n\t\t\t\tfetchEmails();\n\t\t\t}\n\t\t}, 30000);\n\n\t\t// Also listen for custom events that indicate new emails\n\t\tconst handleNewEmail = () => {\n\t\t\tfetchEmails();\n\t\t};\n\t\twindow.addEventListener(\"email-received\", handleNewEmail);\n\t\twindow.addEventListener(\"email-sent\", handleNewEmail);\n\n\t\treturn () => {\n\t\t\tclearInterval(interval);\n\t\t\twindow.removeEventListener(\"email-received\", handleNewEmail);\n\t\t\twindow.removeEventListener(\"email-sent\", handleNewEmail);\n\t\t};\n\t}, [fetchEmails, composeMode]);\n\n\t// Refetch when inbox type, folder, or category changes (but not on initial mount)\n\tconst initialFolderRef = useRef(folder);\n\tconst initialInboxTypeRef = useRef(inboxType);\n\tconst initialCategoryRef = useRef(category);\n\tuseEffect(() => {\n\t\tconst folderChanged = folder !== initialFolderRef.current;\n\t\tconst inboxTypeChanged = inboxType !== initialInboxTypeRef.current;\n\t\tconst categoryChanged = category !== initialCategoryRef.current;\n\n\t\tif (folderChanged || inboxTypeChanged || categoryChanged) {\n\t\t\tinitialFolderRef.current = folder;\n\t\t\tinitialInboxTypeRef.current = inboxType;\n\t\t\tinitialCategoryRef.current = category;\n\t\t\tfetchEmails();\n\t\t}\n\t}, [folder, inboxType, category, fetchEmails]);\n\n\t// Handle search input with debounce\n\tuseEffect(() => {\n\t\tif (searchTimeoutRef.current) {\n\t\t\tclearTimeout(searchTimeoutRef.current);\n\t\t}\n\n\t\tsearchTimeoutRef.current = setTimeout(() => {\n\t\t\tsetSearchQuery(searchInput);\n\t\t}, 300);\n\n\t\treturn () => {\n\t\t\tif (searchTimeoutRef.current) {\n\t\t\t\tclearTimeout(searchTimeoutRef.current);\n\t\t\t}\n\t\t};\n\t}, [searchInput]);\n\n\t// Handle email selection\n\tconst handleEmailSelect = useCallback((email: EmailRecord) => {\n\t\tsetSelectedEmail(email);\n\t\tselectedEmailRef.current = email;\n\n\t\tconst queryParams = new URLSearchParams();\n\t\tif (folder && folder !== \"inbox\") queryParams.set(\"folder\", folder);\n\t\tqueryParams.set(\"id\", email.id);\n\n\t\trouter.replace(`/dashboard/communication/email?${queryParams.toString()}`, { scroll: false });\n\n\t\tconst hasContent = email.body_html || email.body;\n\t\tif (hasContent) {\n\t\t\tsetEmailContent({\n\t\t\t\thtml: email.body_html || null,\n\t\t\t\ttext: email.body || null,\n\t\t\t});\n\t\t\tsetLoadingContent(false);\n\t\t} else {\n\t\t\tsetLoadingContent(true);\n\t\t\tfetchEmailContentAction(email.id)\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\tsetEmailContent({\n\t\t\t\t\t\t\thtml: result.html || null,\n\t\t\t\t\t\t\ttext: result.text || null,\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetEmailContent({ html: null, text: null });\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tsetEmailContent({ html: null, text: null });\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tsetLoadingContent(false);\n\t\t\t\t});\n\t\t}\n\n\t\tif (!email.read_at) {\n\t\t\tsetEmails(prev => ({\n\t\t\t\t...prev,\n\t\t\t\temails: prev.emails.map(e =>\n\t\t\t\t\te.id === email.id ? { ...e, read_at: new Date().toISOString() } : e\n\t\t\t\t)\n\t\t\t}));\n\t\t\tmarkEmailAsReadAction({ emailId: email.id })\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\twindow.dispatchEvent(new CustomEvent(\"email-read\"));\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(console.error);\n\t\t}\n\t}, [router, folder]);\n\n\t// Load email from URL if ID changes\n\tuseEffect(() => {\n\t\tif (emailId && emailId === selectedEmailRef.current?.id) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (emailId && emails?.emails) {\n\t\t\tconst email = emails.emails.find(e => e.id === emailId);\n\t\t\tif (email) {\n\t\t\t\tsetSelectedEmail(email);\n\t\t\t\tselectedEmailRef.current = email;\n\n\t\t\t\tconst hasContent = email.body_html || email.body;\n\t\t\t\tif (hasContent) {\n\t\t\t\t\tsetEmailContent({\n\t\t\t\t\t\thtml: email.body_html || null,\n\t\t\t\t\t\ttext: email.body || null,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tsetLoadingContent(true);\n\t\t\t\t\tfetchEmailContentAction(email.id)\n\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\t\t\tsetEmailContent({\n\t\t\t\t\t\t\t\t\thtml: result.html || null,\n\t\t\t\t\t\t\t\t\ttext: result.text || null,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsetEmailContent({ html: null, text: null });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\tsetEmailContent({ html: null, text: null });\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\tsetLoadingContent(false);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (!email.read_at) {\n\t\t\t\t\tsetEmails(prev => ({\n\t\t\t\t\t\t...prev,\n\t\t\t\t\t\temails: prev.emails.map(e =>\n\t\t\t\t\t\t\te.id === email.id ? { ...e, read_at: new Date().toISOString() } : e\n\t\t\t\t\t\t)\n\t\t\t\t\t}));\n\t\t\t\t\tmarkEmailAsReadAction({ emailId: email.id }).catch(console.error);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (!emailId && selectedEmail) {\n\t\t\tsetSelectedEmail(null);\n\t\t\tselectedEmailRef.current = null;\n\t\t\tsetEmailContent(null);\n\t\t}\n\t}, [emailId, emails?.emails]);\n\n\tconst handleRefresh = useCallback(() => {\n\t\tfetchEmails(true);\n\t\ttoast.success(\"Refreshing emails...\");\n\t}, [fetchEmails]);\n\n\tconst handleArchive = useCallback(async (emailId: string) => {\n\t\ttry {\n\t\t\tif (folder !== \"archive\") {\n\t\t\t\tsetEmails(prev => ({\n\t\t\t\t\t...prev,\n\t\t\t\t\temails: prev.emails.filter(e => e.id !== emailId),\n\t\t\t\t\ttotal: prev.total - 1,\n\t\t\t\t}));\n\n\t\t\t\tif (selectedEmail?.id === emailId) {\n\t\t\t\t\tsetSelectedEmail(null);\n\t\t\t\t\tsetEmailContent(null);\n\t\t\t\t\tselectedEmailRef.current = null;\n\t\t\t\t\tconst params = new URLSearchParams();\n\t\t\t\t\tif (folder && folder !== \"inbox\") params.set(\"folder\", folder);\n\t\t\t\t\trouter.replace(`/dashboard/communication/email?${params.toString()}`, { scroll: false });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst result = await archiveEmailAction(emailId);\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Email archived\");\n\t\t\t\twindow.dispatchEvent(new CustomEvent(\"email-archived\"));\n\t\t\t} else {\n\t\t\t\tfetchEmails(false);\n\t\t\t\ttoast.error(\"Failed to archive email\", {\n\t\t\t\t\tdescription: result.error || \"Unknown error\"\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tfetchEmails(false);\n\t\t\ttoast.error(\"Failed to archive email\");\n\t\t}\n\t}, [fetchEmails, folder, selectedEmail, router]);\n\n\t// Confirm archive all - called from dialog\n\tconst confirmArchiveAll = useCallback(async () => {\n\t\tif (!emails?.emails || emails.emails.length === 0) {\n\t\t\ttoast.info(\"No emails to archive\");\n\t\t\tsetArchiveAllDialogOpen(false);\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tsetRefreshing(true);\n\t\t\tsetArchiveAllDialogOpen(false);\n\t\t\tconst result = await archiveAllEmailsAction((folder || \"inbox\") as string);\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(`Archived ${result.archived} email${result.archived === 1 ? '' : 's'}`);\n\t\t\t\tfetchEmails(false);\n\t\t\t\tsetSelectedEmail(null);\n\t\t\t\tsetEmailContent(null);\n\t\t\t\twindow.dispatchEvent(new CustomEvent(\"email-archived\"));\n\t\t\t} else {\n\t\t\t\ttoast.error(\"Failed to archive emails\", {\n\t\t\t\t\tdescription: result.error || \"Unknown error\"\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (err) {\n\t\t\ttoast.error(\"Failed to archive emails\");\n\t\t} finally {\n\t\t\tsetRefreshing(false);\n\t\t}\n\t}, [emails, folder, fetchEmails]);\n\n\tconst handleToggleSpam = useCallback(async (emailId: string) => {\n\t\ttry {\n\t\t\tconst emailToUpdate = emails?.emails.find(e => e.id === emailId);\n\t\t\tconst currentTags = (emailToUpdate?.tags as string[]) || [];\n\t\t\tconst isSpam = currentTags.includes(\"spam\") || emailToUpdate?.category === \"spam\";\n\t\t\tconst willBeSpam = !isSpam;\n\n\t\t\tsetEmails(prev => {\n\t\t\t\tif (willBeSpam && folder !== \"spam\") {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...prev,\n\t\t\t\t\t\temails: prev.emails.filter(e => e.id !== emailId),\n\t\t\t\t\t\ttotal: prev.total - 1,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (!willBeSpam && folder === \"spam\") {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...prev,\n\t\t\t\t\t\temails: prev.emails.filter(e => e.id !== emailId),\n\t\t\t\t\t\ttotal: prev.total - 1,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\t...prev,\n\t\t\t\t\temails: prev.emails.map(e => {\n\t\t\t\t\t\tif (e.id === emailId) {\n\t\t\t\t\t\t\tconst newTags = willBeSpam\n\t\t\t\t\t\t\t\t? [...currentTags, \"spam\"]\n\t\t\t\t\t\t\t\t: currentTags.filter(tag => tag !== \"spam\");\n\t\t\t\t\t\t\treturn { ...e, tags: newTags.length > 0 ? newTags : null, category: willBeSpam ? \"spam\" : null };\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn e;\n\t\t\t\t\t}),\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tif (selectedEmail?.id === emailId && ((willBeSpam && folder !== \"spam\") || (!willBeSpam && folder === \"spam\"))) {\n\t\t\t\tsetSelectedEmail(null);\n\t\t\t\tsetEmailContent(null);\n\t\t\t\tselectedEmailRef.current = null;\n\t\t\t}\n\n\t\t\tconst result = await toggleSpamEmailAction(emailId);\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(willBeSpam ? \"Email marked as spam\" : \"Email removed from spam\");\n\t\t\t\twindow.dispatchEvent(new CustomEvent(\"email-spam-toggled\"));\n\t\t\t} else {\n\t\t\t\tfetchEmails(false);\n\t\t\t\ttoast.error(\"Failed to update spam status\");\n\t\t\t}\n\t\t} catch {\n\t\t\tfetchEmails(false);\n\t\t\ttoast.error(\"Failed to update spam status\");\n\t\t}\n\t}, [fetchEmails, selectedEmail, folder, emails]);\n\n\tconst handleStar = useCallback(async (emailId: string) => {\n\t\ttry {\n\t\t\tconst emailToUpdate = emails?.emails.find(e => e.id === emailId);\n\t\t\tconst currentTags = (emailToUpdate?.tags as string[]) || [];\n\t\t\tconst isStarred = currentTags.includes(\"starred\");\n\t\t\tconst willBeStarred = !isStarred;\n\n\t\t\tsetEmails(prev => {\n\t\t\t\tconst updatedEmails = prev.emails.map(e => {\n\t\t\t\t\tif (e.id === emailId) {\n\t\t\t\t\t\tconst newTags = willBeStarred\n\t\t\t\t\t\t\t? [...currentTags, \"starred\"]\n\t\t\t\t\t\t\t: currentTags.filter(tag => tag !== \"starred\");\n\t\t\t\t\t\treturn { ...e, tags: newTags.length > 0 ? newTags : null };\n\t\t\t\t\t}\n\t\t\t\t\treturn e;\n\t\t\t\t});\n\n\t\t\t\tif (folder === \"starred\") {\n\t\t\t\t\tconst filteredEmails = updatedEmails.filter(e => {\n\t\t\t\t\t\tconst tags = (e.tags as string[]) || [];\n\t\t\t\t\t\treturn tags.includes(\"starred\");\n\t\t\t\t\t});\n\t\t\t\t\treturn { ...prev, emails: filteredEmails, total: filteredEmails.length };\n\t\t\t\t}\n\n\t\t\t\treturn { ...prev, emails: updatedEmails };\n\t\t\t});\n\n\t\t\tif (selectedEmail?.id === emailId) {\n\t\t\t\tconst newTags = willBeStarred\n\t\t\t\t\t? [...currentTags, \"starred\"]\n\t\t\t\t\t: currentTags.filter(tag => tag !== \"starred\");\n\t\t\t\tsetSelectedEmail({ ...selectedEmail, tags: newTags.length > 0 ? newTags : null });\n\n\t\t\t\tif (folder === \"starred\" && !willBeStarred) {\n\t\t\t\t\tsetSelectedEmail(null);\n\t\t\t\t\tsetEmailContent(null);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst result = await toggleStarEmailAction(emailId);\n\t\t\tif (result.success) {\n\t\t\t\twindow.dispatchEvent(new CustomEvent(\"email-starred-toggled\"));\n\t\t\t} else {\n\t\t\t\tfetchEmails(false);\n\t\t\t\ttoast.error(\"Failed to star email\");\n\t\t\t}\n\t\t} catch {\n\t\t\tfetchEmails(false);\n\t\t\ttoast.error(\"Failed to star email\");\n\t\t}\n\t}, [fetchEmails, selectedEmail, folder, emails]);\n\n\tconst handlePrintEmail = useCallback(() => {\n\t\tif (!selectedEmail) return;\n\n\t\tconst printContent = `\n\t\t\t<!DOCTYPE html>\n\t\t\t<html>\n\t\t\t<head>\n\t\t\t\t<title>${selectedEmail.subject || 'Email'}</title>\n\t\t\t\t<style>\n\t\t\t\t\tbody { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }\n\t\t\t\t\t.header { border-bottom: 1px solid #e5e7eb; padding-bottom: 20px; margin-bottom: 20px; }\n\t\t\t\t\t.subject { font-size: 24px; font-weight: 600; margin-bottom: 12px; }\n\t\t\t\t\t.meta { color: #6b7280; font-size: 14px; }\n\t\t\t\t\t.meta-row { margin-bottom: 4px; }\n\t\t\t\t\t.body { line-height: 1.6; }\n\t\t\t\t</style>\n\t\t\t</head>\n\t\t\t<body>\n\t\t\t\t<div class=\"header\">\n\t\t\t\t\t<div class=\"subject\">${selectedEmail.subject || 'No Subject'}</div>\n\t\t\t\t\t<div class=\"meta\">\n\t\t\t\t\t\t<div class=\"meta-row\"><strong>From:</strong> ${selectedEmail.from_name || ''} &lt;${selectedEmail.from_address || 'Unknown'}&gt;</div>\n\t\t\t\t\t\t<div class=\"meta-row\"><strong>To:</strong> ${selectedEmail.to_address || 'Unknown'}</div>\n\t\t\t\t\t\t<div class=\"meta-row\"><strong>Date:</strong> ${new Date(selectedEmail.created_at).toLocaleString()}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"body\">\n\t\t\t\t\t${emailContent?.html || selectedEmail.body_html || emailContent?.text || selectedEmail.body || 'No content'}\n\t\t\t\t</div>\n\t\t\t</body>\n\t\t\t</html>\n\t\t`;\n\n\t\tconst printWindow = window.open('', '_blank');\n\t\tif (printWindow) {\n\t\t\tprintWindow.document.write(printContent);\n\t\t\tprintWindow.document.close();\n\t\t\tprintWindow.focus();\n\t\t\tsetTimeout(() => printWindow.print(), 250);\n\t\t}\n\t}, [selectedEmail, emailContent]);\n\n\tconst handleDownloadEml = useCallback(() => {\n\t\tif (!selectedEmail) return;\n\n\t\tconst boundary = `----=_Part_${Date.now()}_${Math.random().toString(36).slice(2)}`;\n\t\tconst date = new Date(selectedEmail.created_at).toUTCString();\n\n\t\tconst emlContent = `MIME-Version: 1.0\nDate: ${date}\nSubject: ${selectedEmail.subject || 'No Subject'}\nFrom: ${selectedEmail.from_name ? `${selectedEmail.from_name} <${selectedEmail.from_address}>` : selectedEmail.from_address || 'Unknown'}\nTo: ${selectedEmail.to_address || 'Unknown'}\nContent-Type: multipart/alternative; boundary=\"${boundary}\"\n\n--${boundary}\nContent-Type: text/plain; charset=\"UTF-8\"\nContent-Transfer-Encoding: 7bit\n\n${emailContent?.text || selectedEmail.body || 'No content'}\n\n--${boundary}\nContent-Type: text/html; charset=\"UTF-8\"\nContent-Transfer-Encoding: 7bit\n\n${emailContent?.html || selectedEmail.body_html || '<p>No content</p>'}\n\n--${boundary}--\n`;\n\n\t\tconst blob = new Blob([emlContent], { type: 'message/rfc822' });\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst link = document.createElement('a');\n\t\tlink.href = url;\n\t\t// Safely sanitize filename - replace non-alphanumeric chars, handle empty/invalid subjects\n\t\tconst safeSubject = (selectedEmail.subject || 'email')\n\t\t\t.replace(/[^a-z0-9\\s-]/gi, '_')\n\t\t\t.replace(/\\s+/g, '_')\n\t\t\t.slice(0, 50) || 'email';\n\t\tlink.download = `${safeSubject}.eml`;\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t\tURL.revokeObjectURL(url);\n\n\t\ttoast.success(\"Email downloaded\");\n\t}, [selectedEmail, emailContent]);\n\n\tconst handleDelete = useCallback(async (emailId: string) => {\n\t\ttry {\n\t\t\tsetEmails(prev => ({\n\t\t\t\t...prev,\n\t\t\t\temails: prev.emails.filter(e => e.id !== emailId),\n\t\t\t\ttotal: prev.total - 1,\n\t\t\t}));\n\n\t\t\tif (selectedEmail?.id === emailId) {\n\t\t\t\tsetSelectedEmail(null);\n\t\t\t\tsetEmailContent(null);\n\t\t\t\tselectedEmailRef.current = null;\n\t\t\t\tconst params = new URLSearchParams();\n\t\t\t\tif (folder && folder !== \"inbox\") params.set(\"folder\", folder);\n\t\t\t\trouter.replace(`/dashboard/communication/email?${params.toString()}`, { scroll: false });\n\t\t\t}\n\n\t\t\ttoast.success(\"Email moved to trash\");\n\t\t} catch {\n\t\t\tfetchEmails(false);\n\t\t\ttoast.error(\"Failed to delete email\");\n\t\t}\n\t}, [fetchEmails, selectedEmail, folder, router]);\n\n\tconst handleRetry = useCallback(async (emailId: string) => {\n\t\tif (!emailId) return;\n\n\t\tsetRetrying(true);\n\t\ttry {\n\t\t\tconst result = await retryFailedEmailAction(emailId);\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Email sent successfully!\");\n\t\t\t\t// Refresh emails to get updated status\n\t\t\t\tfetchEmails(true);\n\t\t\t} else {\n\t\t\t\ttoast.error(\"Failed to send email\", {\n\t\t\t\t\tdescription: result.error || \"Please try again later\",\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.error(\"Failed to retry email:\", err);\n\t\t\ttoast.error(\"Failed to send email\", {\n\t\t\t\tdescription: err instanceof Error ? err.message : \"Unknown error occurred\",\n\t\t\t});\n\t\t} finally {\n\t\t\tsetRetrying(false);\n\t\t}\n\t}, [fetchEmails]);\n\n\t// Mobile: show list when no email selected, show detail when email selected\n\t// Desktop: always show both panels side by side\n\tconst showListOnMobile = !selectedEmail && !composeMode;\n\tconst showDetailOnMobile = selectedEmail || composeMode;\n\n\treturn (\n\t\t<div className=\"flex h-full w-full flex-col overflow-hidden bg-sidebar\">\n\t\t\t<div className=\"flex flex-1 overflow-hidden min-h-0 md:gap-2\">\n\t\t\t\t{/* Email List Panel - Hidden on mobile when email is selected */}\n\t\t\t\t<div className={cn(\n\t\t\t\t\t\"bg-card mb-1 shadow-sm flex flex-col overflow-hidden\",\n\t\t\t\t\t\"w-full h-full\", // Mobile: full width/height\n\t\t\t\t\t\"md:w-[400px] lg:w-[480px] md:rounded-tr-2xl\", // Desktop: fixed width with rounded corner\n\t\t\t\t\t// Mobile visibility logic\n\t\t\t\t\tshowListOnMobile ? \"flex\" : \"hidden md:flex\"\n\t\t\t\t)}>\n\t\t\t\t\t<div className=\"w-full h-full flex flex-col\">\n\t\t\t\t\t\t<div className=\"sticky top-0 z-15 flex items-center justify-between gap-1.5 p-2 pb-0 transition-colors bg-card\">\n\t\t\t\t\t\t\t<div className=\"w-full\">\n\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-12 gap-2 mt-1\">\n\t\t\t\t\t\t\t\t\t<div className=\"col-span-12 flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t{/* Sidebar toggle - larger on mobile for touch */}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={toggleSidebar}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8 shrink-0\"\n\t\t\t\t\t\t\t\t\t\t\ttitle=\"Toggle sidebar\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<PanelLeft className=\"h-5 w-5 md:h-4 md:w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t<div className=\"relative flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t{/* Search input - text-base on mobile to prevent iOS zoom */}\n\t\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"search\"\n\t\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Search emails...\"\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={searchInput}\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => setSearchInput(e.target.value)}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 md:h-8 pl-9 pr-20 text-base md:text-sm border-input bg-white dark:bg-[#141414] dark:border-none\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\twidth=\"10\"\n\t\t\t\t\t\t\t\t\t\t\t\theight=\"10\"\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 10 10\"\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"absolute left-3 top-1/2 -translate-y-1/2 fill-[#71717A] dark:fill-[#6F6F6F]\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M6.81038 7.0756C6.18079 7.54011 5.40248 7.81466 4.56004 7.81466C2.46451 7.81466 0.765747 6.11589 0.765747 4.02037C0.765747 1.92484 2.46451 0.226074 4.56004 0.226074C6.65557 0.226074 8.35433 1.92484 8.35433 4.02037C8.35433 4.8628 8.07978 5.64112 7.61527 6.27071L9.70535 8.36078C9.92761 8.58305 9.92761 8.94341 9.70535 9.16568C9.48308 9.38794 9.12272 9.38794 8.90046 9.16568L6.81038 7.0756ZM7.21604 4.02037C7.21604 5.48724 6.02691 6.67637 4.56004 6.67637C3.09317 6.67637 1.90403 5.48724 1.90403 4.02037C1.90403 2.5535 3.09317 1.36436 4.56004 1.36436C6.02691 1.36436 7.21604 2.5535 7.21604 4.02037Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t{searchInput && (\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setSearchInput(\"\")}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<X className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={handleRefresh}\n\t\t\t\t\t\t\t\t\t\t\tdisabled={refreshing}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8\"\n\t\t\t\t\t\t\t\t\t\t\ttitle=\"Refresh\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<RefreshCw className={`h-5 w-5 md:h-4 md:w-4 text-muted-foreground ${refreshing ? 'animate-spin' : ''}`} />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/* Archive All - Owner only, icon button with confirmation dialog */}\n\t\t\t\t\t\t\t\t\t\t{isOwner && folder !== \"archive\" && emails?.emails && emails.emails.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setArchiveAllDialogOpen(true)}\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={refreshing}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 w-8 p-0 group/archive-all hover:bg-destructive/10\"\n\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Archive all emails\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Archive className=\"h-4 w-4 text-muted-foreground group-hover/archive-all:text-destructive transition-colors\" />\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/* Subtle progress bar when refreshing - visible only during fetch */}\n\t\t\t\t\t\t<div className={cn(\n\t\t\t\t\t\t\t\"bg-[#006FFE] relative z-5 h-0.5 w-full transition-opacity\",\n\t\t\t\t\t\t\trefreshing ? \"opacity-100 animate-pulse\" : \"opacity-0\"\n\t\t\t\t\t\t)} />\n\n\t\t\t\t\t\t{/* Email Items */}\n\t\t\t\t\t\t<div className=\"relative z-1 flex-1 overflow-hidden pt-0 min-h-0\">\n\t\t\t\t\t\t\t<div className=\"hide-link-indicator flex h-full w-full\">\n\t\t\t\t\t\t\t\t<div className=\"flex flex-1 flex-col\" id=\"mail-list-scroll\">\n\t\t\t\t\t\t\t\t\t<ScrollArea className=\"scrollbar-none flex-1 overflow-x-hidden h-full\">\n\t\t\t\t\t\t\t\t\t\t{/* Only show error when there's no data at all - otherwise show existing emails optimistically */}\n\t\t\t\t\t\t\t\t\t\t{error && (!emails?.emails || emails.emails.length === 0) ? (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center p-8\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-8 w-8 text-destructive mx-auto mb-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-destructive mb-2 font-medium\">Failed to load emails</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground mb-4\">{error}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button variant=\"outline\" size=\"sm\" onClick={() => fetchEmails()}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tTry Again\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t) : emails?.emails?.length ? (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-h-[200px] px-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t{emails.emails.map((email) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst isSelected = selectedEmail?.id === email.id;\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div key={email.id} className=\"select-none md:my-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"hover:bg-accent group flex cursor-pointer flex-col items-start rounded-lg py-2 text-left text-sm transition-all hover:opacity-100 relative\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisSelected ? \"bg-accent opacity-100\" : \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t!email.read_at ? \"opacity-100\" : \"opacity-60\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleEmailSelect(email)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Hover Action Toolbar */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"dark:bg-panelDark absolute right-2 z-25 flex -translate-y-1/2 items-center gap-1 rounded-xl border bg-white p-1 opacity-0 shadow-sm group-hover:opacity-100 top-[-1] transition-opacity duration-200\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-6 w-6 overflow-visible p-0 hover:bg-accent group/star\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleStar(email.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle={email.tags && Array.isArray(email.tags) && email.tags.includes(\"starred\") ? \"Unstar\" : \"Star\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Star className={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"h-4 w-4 transition-colors group-hover/star:text-yellow-500\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temail.tags && Array.isArray(email.tags) && email.tags.includes(\"starred\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"fill-yellow-500 text-yellow-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-6 w-6 p-0 hover:bg-accent group/spam\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleToggleSpam(email.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle={email.category === \"spam\" ? \"Not spam\" : \"Spam\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Flag className={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"h-4 w-4 transition-colors group-hover/spam:text-orange-500\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temail.category === \"spam\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"fill-orange-500 text-orange-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-6 w-6 p-0 hover:bg-accent group/archive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleArchive(email.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Archive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Archive className=\"h-4 w-4 text-muted-foreground transition-colors group-hover/archive:text-blue-500\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Email Card Content */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"relative flex w-full items-center justify-between gap-4 px-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Avatar className=\"h-8 w-8 shrink-0 rounded-full border\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarFallback className=\"bg-white dark:bg-[#373737] text-[#9F9F9D] font-bold text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{email.from_address?.[0]?.toUpperCase() || \"U\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex w-full justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-full\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex w-full flex-row items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-row items-center gap-[4px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-bold text-md flex items-baseline gap-1 group-hover:opacity-100\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"line-clamp-1 overflow-hidden text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{email.direction === \"outbound\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? (email.to_address || \"Unknown recipient\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: (email.from_name || email.from_address || \"Unknown sender\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{!email.read_at && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"ml-0.5 size-2 rounded-full bg-[#006FFE]\"></span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-nowrap text-xs font-normal opacity-70 transition-opacity group-hover:opacity-100 dark:text-[#8C8C8C]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{email.created_at ? new Date(email.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : ''}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"mt-1 line-clamp-1 min-w-0 overflow-hidden text-sm text-[#8C8C8C] flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{email.subject || \"No subject\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Status badges */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1 shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Customer link badge */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{email.customer?.id && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thref={`/dashboard/customers/${email.customer.id}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"px-1.5 py-0.5 rounded text-[10px] bg-primary/10 text-primary hover:bg-primary/20 transition-colors flex items-center gap-0.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle={`View ${getCustomerDisplayName(email.customer)} profile`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<User className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"hidden sm:inline\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{getCustomerDisplayName(email.customer)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{email.status === \"draft\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-1.5 py-0.5 rounded text-[10px] bg-muted text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tDraft\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{email.status === \"failed\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-1.5 py-0.5 rounded text-[10px] bg-destructive/10 text-destructive cursor-help flex items-center gap-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tFailed\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"font-medium\">Email failed to send</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground mt-1\">Click email to retry or view details</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{email.direction === \"outbound\" && email.status !== \"draft\" && email.status !== \"failed\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-1.5 py-0.5 rounded text-[10px] bg-blue-500/10 text-blue-600\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSent\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center p-8\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{refreshing ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground mx-auto mb-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">Loading emails...</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-medium text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{searchQuery ? \"No emails found\" : \"No emails yet\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{searchQuery ? \"Try adjusting your search terms\" : \"Emails will appear here when received\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</ScrollArea>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Right Panel - Email Composer OR Email Detail */}\n\t\t\t{/* Mobile: shown when email selected or compose mode, Desktop: always visible as flex-1 */}\n\t\t\t\t{composeMode ? (\n\t\t\t\t\t<div className={cn(\n\t\t\t\t\t\t\"bg-card mb-1 shadow-sm flex flex-col min-w-0 overflow-hidden\",\n\t\t\t\t\t\t\"w-full h-full\", // Mobile: full width/height\n\t\t\t\t\t\t\"md:rounded-tl-2xl md:flex-1\", // Desktop: rounded corner and flex\n\t\t\t\t\t\tshowDetailOnMobile ? \"flex\" : \"hidden md:flex\"\n\t\t\t\t\t)}>\n\t\t\t\t\t\t<EmailFullComposer\n\t\t\t\t\t\t\tcompanyId={companyId}\n\t\t\t\t\t\t\tonClose={() => setComposeMode(false)}\n\t\t\t\t\t\t\tonSent={() => {\n\t\t\t\t\t\t\t\tsetComposeMode(false);\n\t\t\t\t\t\t\t\tfetchEmails(true);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tclassName=\"h-full\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t) : selectedEmail ? (\n\t\t\t\t\t<div className={cn(\n\t\t\t\t\t\t\"bg-card mb-1 shadow-sm flex flex-col min-w-0 overflow-hidden\",\n\t\t\t\t\t\t\"w-full h-full\", // Mobile: full width/height\n\t\t\t\t\t\t\"md:rounded-tl-2xl md:flex-1\", // Desktop: rounded corner and flex\n\t\t\t\t\t\tshowDetailOnMobile ? \"flex\" : \"hidden md:flex\"\n\t\t\t\t\t)}>\n\t\t\t\t\t\t<div className=\"relative flex-1 min-h-0 flex flex-col\">\n\t\t\t\t\t\t\t<div className=\"bg-card relative flex flex-col overflow-hidden transition-all duration-300 h-full flex-1 min-h-0\">\n\t\t\t\t\t\t\t\t{/* Email Header Toolbar */}\n\t\t\t\t\t\t\t\t<div className=\"sticky top-0 z-15 flex shrink-0 items-center justify-between gap-1.5 p-2 pb-0 transition-colors bg-card\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex flex-1 items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t{/* Back button (mobile) / Close button (desktop) */}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tsetSelectedEmail(null);\n\t\t\t\t\t\t\t\t\t\t\t\tsetEmailContent(null);\n\t\t\t\t\t\t\t\t\t\t\t\tselectedEmailRef.current = null;\n\t\t\t\t\t\t\t\t\t\t\t\tconst params = new URLSearchParams();\n\t\t\t\t\t\t\t\t\t\t\t\tif (folder && folder !== \"inbox\") params.set(\"folder\", folder);\n\t\t\t\t\t\t\t\t\t\t\t\trouter.push(`/dashboard/communication/email?${params.toString()}`, { scroll: false });\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8\"\n\t\t\t\t\t\t\t\t\t\t\ttitle=\"Back to list\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{/* Arrow on mobile, X on desktop */}\n\t\t\t\t\t\t\t\t\t\t\t<ArrowLeft className=\"h-5 w-5 md:hidden text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t<X className=\"h-4 w-4 hidden md:block text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t<Separator orientation=\"vertical\" className=\"h-4 bg-border/60 hidden md:block\" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t{/* Reply all - hidden text on mobile */}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-auto md:px-2\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => setReplyMode(\"reply-all\")}\n\t\t\t\t\t\t\t\t\t\t\ttitle=\"Reply all\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<ReplyAll className=\"h-5 w-5 md:h-4 md:w-4 md:mr-1.5 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm leading-none font-medium hidden md:inline\">Reply all</span>\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/* Notes - hidden on mobile, accessible via more menu */}\n\t\t\t\t\t\t\t\t\t\t<Sheet open={notesOpen} onOpenChange={setNotesOpen}>\n\t\t\t\t\t\t\t\t\t\t\t<SheetTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" className=\"h-10 w-10 p-0 md:h-8 md:w-8 hidden md:flex\" title=\"Notes\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<StickyNote className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</SheetTrigger>\n\t\t\t\t\t\t\t\t\t\t\t<SheetContent>\n\t\t\t\t\t\t\t\t\t\t\t\t<SheetHeader>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<SheetTitle>Email Notes</SheetTitle>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<SheetDescription>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tAdd private notes about this email.\n\t\t\t\t\t\t\t\t\t\t\t\t\t</SheetDescription>\n\t\t\t\t\t\t\t\t\t\t\t\t</SheetHeader>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"py-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Add your notes here...\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={emailNotes}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => setEmailNotes(e.target.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"min-h-[200px] resize-none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"mt-4 flex justify-end gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button variant=\"outline\" size=\"sm\" onClick={() => setNotesOpen(false)}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button size=\"sm\" onClick={() => { toast.success(\"Notes saved\"); setNotesOpen(false); }}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSave Notes\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</SheetContent>\n\t\t\t\t\t\t\t\t\t\t</Sheet>\n\t\t\t\t\t\t\t\t\t\t{/* Star - visible on all sizes */}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8 group/star\"\n\t\t\t\t\t\t\t\t\t\t\ttitle={selectedEmail?.tags?.includes(\"starred\") ? \"Unstar\" : \"Star\"}\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => selectedEmail && handleStar(selectedEmail.id)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Star className={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\"h-5 w-5 md:h-4 md:w-4 transition-colors group-hover/star:text-yellow-500\",\n\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail?.tags?.includes(\"starred\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"fill-yellow-500 text-yellow-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\"\n\t\t\t\t\t\t\t\t\t\t\t)} />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/* Spam - hidden on mobile, in more menu */}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8 hidden md:flex group/spam\"\n\t\t\t\t\t\t\t\t\t\t\ttitle={selectedEmail?.category === \"spam\" ? \"Not spam\" : \"Spam\"}\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => selectedEmail && handleToggleSpam(selectedEmail.id)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Flag className={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\"h-4 w-4 transition-colors group-hover/spam:text-orange-500\",\n\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail?.category === \"spam\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"fill-orange-500 text-orange-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\"\n\t\t\t\t\t\t\t\t\t\t\t)} />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/* Archive - visible on all sizes */}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 p-0 md:h-8 md:w-8\"\n\t\t\t\t\t\t\t\t\t\t\ttitle=\"Archive\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => selectedEmail && handleArchive(selectedEmail.id)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Archive className=\"h-5 w-5 md:h-4 md:w-4\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/* More menu */}\n\t\t\t\t\t\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" className=\"h-10 w-10 p-0 md:h-8 md:w-8\" title=\"More\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<MoreHorizontal className=\"h-5 w-5 md:h-4 md:w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuContent align=\"end\" className=\"w-48\">\n\t\t\t\t\t\t\t\t\t\t\t\t{/* Mobile-only options */}\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => selectedEmail && handleToggleSpam(selectedEmail.id)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"md:hidden\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Flag className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail?.category === \"spam\" ? \"Not spam\" : \"Mark as spam\"}\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setNotesOpen(true)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"md:hidden\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<StickyNote className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tNotes\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuSeparator className=\"md:hidden\" />\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem onClick={handlePrintEmail}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Printer className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tPrint\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem onClick={handleDownloadEml}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Download className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tDownload as .eml\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => selectedEmail && handleDelete(selectedEmail.id)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-destructive focus:text-destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tDelete\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t\t\t\t\t\t</DropdownMenu>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{/* Email Content */}\n\t\t\t\t\t\t\t\t<div className=\"flex min-h-0 flex-1 flex-col overflow-hidden\">\n\t\t\t\t\t\t\t\t\t<div className=\"relative overflow-hidden flex-1 h-full min-h-0 flex flex-col\">\n\t\t\t\t\t\t\t\t\t\t<TooltipProvider delayDuration={100}>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"border-b border-border/50 px-2 py-4 space-y-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t<h1 className=\"text-base font-semibold text-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.subject || \"No Subject\"}\n\t\t\t\t\t\t\t\t\t\t\t\t</h1>\n\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Avatar className=\"h-9 w-9 shrink-0 rounded-md cursor-pointer\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarFallback className=\"bg-muted text-muted-foreground font-semibold text-sm rounded-md\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.from_address?.[0]?.toUpperCase() || \"U\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold text-sm text-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.from_name || selectedEmail.from_address || \"Unknown\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{!selectedEmail.read_at && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"h-2 w-2 rounded-full bg-primary\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>to {selectedEmail.to_address?.split('@')[0] || 'you'}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<CustomerInfoPill\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcustomer={selectedEmail.customer}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfallbackName={selectedEmail.from_name || undefined}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfallbackEmail={selectedEmail.from_address || undefined}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{new Date(selectedEmail.created_at).toLocaleTimeString('en-US', {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thour: 'numeric',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tminute: '2-digit'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t{/* Email Tracking Status - Only for outbound */}\n\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.direction === \"outbound\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-col gap-2 pt-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1 flex-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail.sent_at ? \"bg-blue-500/10 text-blue-600\" : \"bg-muted text-muted-foreground\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Send className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>Sent</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>{selectedEmail.sent_at ? `Sent ${new Date(selectedEmail.sent_at).toLocaleString()}` : \"Not sent yet\"}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.sent_at && <ChevronRight className=\"h-3 w-3 text-muted-foreground\" />}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.sent_at && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail.delivered_at ? \"bg-green-500/10 text-green-600\" : \"bg-muted text-muted-foreground\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<CheckCheck className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>Delivered</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>{selectedEmail.delivered_at ? `Delivered ${new Date(selectedEmail.delivered_at).toLocaleString()}` : \"Waiting...\"}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.delivered_at && <ChevronRight className=\"h-3 w-3 text-muted-foreground\" />}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.delivered_at && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail.opened_at ? \"bg-purple-500/10 text-purple-600\" : \"bg-muted/50 text-muted-foreground/70\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Eye className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>Opened{selectedEmail.open_count && selectedEmail.open_count > 1 ? ` (${selectedEmail.open_count})` : \"\"}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-3 w-3 text-amber-500\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>{selectedEmail.opened_at ? `Opened ${new Date(selectedEmail.opened_at).toLocaleString()}` : \"Not opened\"}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-amber-500 mt-1\"> Unreliable metric</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.delivered_at && <ChevronRight className=\"h-3 w-3 text-muted-foreground\" />}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.delivered_at && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail.clicked_at ? \"bg-amber-500/10 text-amber-600\" : \"bg-muted text-muted-foreground\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<MousePointerClick className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>Clicked{selectedEmail.click_count && selectedEmail.click_count > 1 ? ` (${selectedEmail.click_count})` : \"\"}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>{selectedEmail.clicked_at ? `Clicked ${new Date(selectedEmail.clicked_at).toLocaleString()}` : \"No clicks\"}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TooltipProvider>\n\n\t\t\t\t\t\t\t\t\t\t{/* Email Body */}\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 overflow-hidden flex flex-col min-h-0\">\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 overflow-y-auto px-2 py-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t{loadingContent ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center py-12\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground mx-auto mb-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">Loading email content...</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<EmailContent\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thtml={emailContent?.html || selectedEmail.body_html || null}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext={emailContent?.text || selectedEmail.body || null}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tattachments={null}\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t{/* Reply Composer or Action Bar */}\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"px-2 py-4 pb-safe\">\n\t\t\t\t\t\t\t\t\t\t\t\t{replyMode ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<EmailReplyComposer\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmode={replyMode}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedEmail={selectedEmail as any}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompanyId={companyId}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClose={() => setReplyMode(null)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonSent={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetReplyMode(null);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfetchEmails(true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t) : selectedEmail.status === \"failed\" ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 flex-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Retry button for failed emails */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-11 px-4 flex-1 md:flex-none md:h-9\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleRetry(selectedEmail.id)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={retrying}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{retrying ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-5 w-5 md:h-4 md:w-4 mr-2 animate-spin\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSending...\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<RefreshCw className=\"h-5 w-5 md:h-4 md:w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tRetry Send\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Show failure reason if available */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedEmail.failure_reason && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-full flex items-start gap-2 p-3 rounded-lg bg-destructive/10 border border-destructive/20\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-4 w-4 text-destructive shrink-0 mt-0.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-medium text-destructive\">Failed to send</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground mt-0.5\">{selectedEmail.failure_reason}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 flex-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Reply - primary action, larger on mobile */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"default\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-11 px-4 flex-1 md:flex-none md:h-9\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setReplyMode(\"reply\")}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Reply className=\"h-5 w-5 md:h-4 md:w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tReply\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Reply All - secondary on mobile */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-11 px-3 flex-1 md:flex-none md:h-9 md:px-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setReplyMode(\"reply-all\")}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ReplyAll className=\"h-5 w-5 md:h-4 md:w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"hidden xs:inline\">Reply All</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"xs:hidden\">All</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Forward - secondary on mobile */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-11 px-3 flex-1 md:flex-none md:h-9 md:px-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setReplyMode(\"forward\")}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Forward className=\"h-5 w-5 md:h-4 md:w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tForward\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t) : null}\n\t\t\t</div>\n\n\t\t\t{/* Archive All Confirmation Dialog - Owner only */}\n\t\t\t<AlertDialog open={archiveAllDialogOpen} onOpenChange={setArchiveAllDialogOpen}>\n\t\t\t\t<AlertDialogContent>\n\t\t\t\t\t<AlertDialogHeader>\n\t\t\t\t\t\t<AlertDialogTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<AlertTriangle className=\"h-5 w-5 text-destructive\" />\n\t\t\t\t\t\t\tArchive All {folder ? folder.charAt(0).toUpperCase() + folder.slice(1) : 'Inbox'} Emails\n\t\t\t\t\t\t</AlertDialogTitle>\n\t\t\t\t\t\t<AlertDialogDescription>\n\t\t\t\t\t\t\tThis will archive <strong>{emails?.emails?.length || 0}</strong> email{(emails?.emails?.length || 0) !== 1 ? 's' : ''} from your <strong>{folder || 'inbox'}</strong> folder.\n\t\t\t\t\t\t\tThis action can be undone by viewing the Archive folder.\n\t\t\t\t\t\t</AlertDialogDescription>\n\t\t\t\t\t</AlertDialogHeader>\n\t\t\t\t\t<AlertDialogFooter>\n\t\t\t\t\t\t<AlertDialogCancel>Cancel</AlertDialogCancel>\n\t\t\t\t\t\t<AlertDialogAction\n\t\t\t\t\t\t\tonClick={confirmArchiveAll}\n\t\t\t\t\t\t\tclassName=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tArchive All\n\t\t\t\t\t\t</AlertDialogAction>\n\t\t\t\t\t</AlertDialogFooter>\n\t\t\t\t</AlertDialogContent>\n\t\t\t</AlertDialog>\n\t\t</div>\n\t);\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"40c9873b94db1de913ae9956b543ae7d67e32a3a25\":\"archiveAllEmailsAction\"},\"apps/web/src/actions/email-actions.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var archiveAllEmailsAction=/*#__PURE__*/createServerReference(\"40c9873b94db1de913ae9956b543ae7d67e32a3a25\",callServer,void 0,findSourceMapURL,\"archiveAllEmailsAction\");","/* __next_internal_action_entry_do_not_use__ [{\"70f55d0fe7fe54925069d66485de41507bc67cdf38\":\"fetchEmailContentAction\"},\"apps/web/src/actions/email-actions.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var fetchEmailContentAction=/*#__PURE__*/createServerReference(\"70f55d0fe7fe54925069d66485de41507bc67cdf38\",callServer,void 0,findSourceMapURL,\"fetchEmailContentAction\");","/* __next_internal_action_entry_do_not_use__ [{\"408f0392fe38f20921ddeedcb09702a487a451816c\":\"toggleSpamEmailAction\"},\"apps/web/src/actions/email-actions.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var toggleSpamEmailAction=/*#__PURE__*/createServerReference(\"408f0392fe38f20921ddeedcb09702a487a451816c\",callServer,void 0,findSourceMapURL,\"toggleSpamEmailAction\");","/* __next_internal_action_entry_do_not_use__ [{\"40acfa669f558a4f0b50a4d805bdaca76777deb01d\":\"retryFailedEmailAction\"},\"apps/web/src/actions/email-actions.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var retryFailedEmailAction=/*#__PURE__*/createServerReference(\"40acfa669f558a4f0b50a4d805bdaca76777deb01d\",callServer,void 0,findSourceMapURL,\"retryFailedEmailAction\");","\"use client\";\n\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { cn } from \"@/lib/utils\";\nimport { getCustomerDisplayName, getCustomerInitials } from \"@/lib/utils/customer-display\";\nimport { ChevronDown, ExternalLink, Mail, Phone, User } from \"lucide-react\";\nimport Link from \"next/link\";\n\nexport interface CustomerData {\n\tid?: string;\n\tfirst_name?: string | null;\n\tlast_name?: string | null;\n\tdisplay_name?: string | null;\n\temail?: string | null;\n\tphone?: string | null;\n\tcompany_name?: string | null;\n}\n\ninterface CustomerInfoPillProps {\n\tcustomer: CustomerData | null | undefined;\n\t/** Fallback name if no customer linked */\n\tfallbackName?: string;\n\t/** Fallback email if no customer linked */\n\tfallbackEmail?: string;\n\t/** Fallback phone if no customer linked */\n\tfallbackPhone?: string;\n\t/** Additional CSS classes */\n\tclassName?: string;\n\t/** Size variant */\n\tsize?: \"sm\" | \"default\";\n}\n\n/**\n * A pill-shaped badge displaying customer name with a popover\n * showing detailed customer information on click.\n */\nexport function CustomerInfoPill({\n\tcustomer,\n\tfallbackName,\n\tfallbackEmail,\n\tfallbackPhone,\n\tclassName,\n\tsize = \"default\",\n}: CustomerInfoPillProps) {\n\tconst email = customer?.email || fallbackEmail;\n\tconst phone = customer?.phone || fallbackPhone;\n\n\t// Use unified customer display utility\n\tconst displayName = getCustomerDisplayName(\n\t\tcustomer ? { ...customer, email: customer.email || fallbackEmail } : null,\n\t\tfallbackName || fallbackEmail\n\t);\n\tconst hasCustomerProfile = !!customer?.id;\n\n\t// Get initials using utility\n\tconst initials = getCustomerInitials(customer);\n\n\treturn (\n\t\t<Popover>\n\t\t\t<PopoverTrigger asChild>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\"inline-flex items-center gap-1 rounded-full border border-border/50 bg-muted/50 hover:bg-muted transition-colors cursor-pointer\",\n\t\t\t\t\t\tsize === \"sm\" ? \"px-2 py-0.5 text-xs\" : \"px-2.5 py-1 text-sm\",\n\t\t\t\t\t\tclassName\n\t\t\t\t\t)}\n\t\t\t\t>\n\t\t\t\t\t<span className=\"font-medium truncate max-w-[150px]\">{displayName}</span>\n\t\t\t\t\t<ChevronDown className={cn(\"text-muted-foreground\", size === \"sm\" ? \"h-3 w-3\" : \"h-3.5 w-3.5\")} />\n\t\t\t\t</button>\n\t\t\t</PopoverTrigger>\n\t\t\t<PopoverContent className=\"w-72 p-0\" align=\"start\">\n\t\t\t\t<div className=\"p-4\">\n\t\t\t\t\t{/* Header with avatar */}\n\t\t\t\t\t<div className=\"flex items-start gap-3 mb-3\">\n\t\t\t\t\t\t<div className={cn(\n\t\t\t\t\t\t\t\"flex items-center justify-center rounded-full bg-primary/10 text-primary font-semibold\",\n\t\t\t\t\t\t\tsize === \"sm\" ? \"h-10 w-10 text-sm\" : \"h-12 w-12 text-base\"\n\t\t\t\t\t\t)}>\n\t\t\t\t\t\t\t{initials || <User className=\"h-5 w-5\" />}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t<p className=\"font-semibold text-foreground truncate\">{displayName}</p>\n\t\t\t\t\t\t\t{customer?.company_name && (\n\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground truncate\">{customer.company_name}</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{!hasCustomerProfile && (\n\t\t\t\t\t\t\t\t<span className=\"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400 mt-1\">\n\t\t\t\t\t\t\t\t\tNot linked\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Contact details */}\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t{email && (\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-sm\">\n\t\t\t\t\t\t\t\t<Mail className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\thref={`mailto:${email}`}\n\t\t\t\t\t\t\t\t\tclassName=\"text-foreground hover:text-primary truncate transition-colors\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{email}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{phone && (\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-sm\">\n\t\t\t\t\t\t\t\t<Phone className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\thref={`tel:${phone}`}\n\t\t\t\t\t\t\t\t\tclassName=\"text-foreground hover:text-primary transition-colors\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{phone}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{!email && !phone && (\n\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground italic\">No contact info available</p>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Footer with profile link */}\n\t\t\t\t{hasCustomerProfile && (\n\t\t\t\t\t<div className=\"border-t border-border px-4 py-3 bg-muted/30\">\n\t\t\t\t\t\t<Button variant=\"outline\" size=\"sm\" className=\"w-full\" asChild>\n\t\t\t\t\t\t\t<Link href={`/dashboard/customers/${customer.id}`}>\n\t\t\t\t\t\t\t\t<span>View Full Profile</span>\n\t\t\t\t\t\t\t\t<ExternalLink className=\"h-3.5 w-3.5 ml-1.5\" />\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</PopoverContent>\n\t\t</Popover>\n\t);\n}\n","\"use client\";\n\nimport { sendCustomerEmailAction } from \"@/actions/communications\";\nimport { saveDraftAction, deleteDraftAction } from \"@/actions/email-actions\";\nimport { Button } from \"@/components/ui/button\";\nimport { toast as sonnerToast } from \"sonner\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n\tBold,\n\tCalendar,\n\tChevronDown,\n\tClock,\n\tItalic,\n\tLink as LinkIcon,\n\tList,\n\tListOrdered,\n\tLoader2,\n\tPaperclip,\n\tSend,\n\tSparkles,\n\tTrash2,\n\tUnderline,\n\tX,\n} from \"lucide-react\";\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport {\n\tRecipientAutocomplete,\n\ttype Recipient,\n} from \"@/components/communication/recipient-autocomplete\";\nimport dynamic from \"next/dynamic\";\n\n// Dynamically import CustomerContextCard to reduce initial bundle size\nconst CustomerContextCard = dynamic(\n\t() => import(\"@/components/communication/customer-context-card\").then((mod) => mod.CustomerContextCard),\n\t{\n\t\tloading: () => (\n\t\t\t<div className=\"flex items-center justify-center py-4\">\n\t\t\t\t<Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n\t\t\t</div>\n\t\t),\n\t\tssr: false,\n\t}\n);\n\ntype EmailAttachment = {\n\tfilename: string;\n\tcontent: string;\n\tcontentType?: string;\n\tsize: number;\n};\n\nconst templateDefinitions = [\n\t{\n\t\tid: \"follow-up\",\n\t\tlabel: \"Friendly follow-up\",\n\t\tbody: \"Hi there,\\n\\nJust checking in  let me know if you have any questions or if you'd like to see anything else from my side.\\n\\nBest,\",\n\t},\n\t{\n\t\tid: \"thank-you\",\n\t\tlabel: \"Thank you note\",\n\t\tbody: \"Hi there,\\n\\nThanks again for your patience while we sorted this out. Let me know if there's anything else I can help with.\\n\\nWarm regards,\",\n\t},\n\t{\n\t\tid: \"next-steps\",\n\t\tlabel: \"Outline next steps\",\n\t\tbody: \"Hi there,\\n\\nI've outlined the next steps:\\n1. Review the details above.\\n2. Confirm when you'd like to move forward.\\n3. I'll lock everything in once you reply.\\n\\nLet me know if you want to adjust anything.\",\n\t},\n\t{\n\t\tid: \"introduction\",\n\t\tlabel: \"Introduction\",\n\t\tbody: \"Hi there,\\n\\nI wanted to reach out and introduce myself. I'm looking forward to working with you.\\n\\nPlease let me know if you have any questions.\\n\\nBest regards,\",\n\t},\n];\n\nconst signatureOptions = [\n\t{ id: \"none\", label: \"No signature\", value: \"\" },\n\t{ id: \"support\", label: \"Thorbis Support\", value: \"\\n\\nThanks,\\nThorbis Support Team\" },\n\t{ id: \"tech\", label: \"Technical Lead\", value: \"\\n\\nBest regards,\\nJordan  Technical Lead\" },\n];\n\ninterface EmailFullComposerProps {\n\tcompanyId: string | null;\n\tonClose: () => void;\n\tonSent?: (record: Record<string, unknown>) => void;\n\tinitialRecipient?: Recipient;\n\tclassName?: string;\n}\n\nexport function EmailFullComposer({\n\tcompanyId,\n\tonClose,\n\tonSent,\n\tinitialRecipient,\n\tclassName,\n}: EmailFullComposerProps) {\n\tconst { toast: toastApi } = useToast();\n\tconst textareaRef = useRef<HTMLTextAreaElement>(null);\n\tconst fileInputRef = useRef<HTMLInputElement>(null);\n\tconst autoSaveTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n\t// Form state\n\tconst [body, setBody] = useState(\"\");\n\tconst [subject, setSubject] = useState(\"\");\n\tconst [recipients, setRecipients] = useState<Recipient[]>(initialRecipient ? [initialRecipient] : []);\n\tconst [ccRecipients, setCcRecipients] = useState<Recipient[]>([]);\n\tconst [bccRecipients, setBccRecipients] = useState<Recipient[]>([]);\n\tconst [showCc, setShowCc] = useState(false);\n\tconst [showBcc, setShowBcc] = useState(false);\n\tconst [attachments, setAttachments] = useState<EmailAttachment[]>([]);\n\tconst [signatureId, setSignatureId] = useState(\"support\");\n\n\t// UI state\n\tconst [isSending, setIsSending] = useState(false);\n\tconst [isDirty, setIsDirty] = useState(false);\n\tconst [lastSaved, setLastSaved] = useState<Date | null>(null);\n\tconst [draftId, setDraftId] = useState<string | null>(null);\n\tconst [isSavingDraft, setIsSavingDraft] = useState(false);\n\n\t// Schedule send state\n\tconst [scheduleOpen, setScheduleOpen] = useState(false);\n\tconst [scheduledDate, setScheduledDate] = useState<string>(\"\");\n\tconst [scheduledTime, setScheduledTime] = useState<string>(\"\");\n\n\t// Undo send state\n\tconst UNDO_SEND_DELAY = 5000;\n\tconst [isPendingSend, setIsPendingSend] = useState(false);\n\tconst [undoCountdown, setUndoCountdown] = useState(5);\n\tconst sendTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\tconst countdownIntervalRef = useRef<NodeJS.Timeout | null>(null);\n\tconst countdownToastIdRef = useRef<string | number | null>(null);\n\tconst pendingEmailDataRef = useRef<{\n\t\tto: string[];\n\t\tsubject: string;\n\t\tbody: string;\n\t\tcustomerName: string;\n\t\tcompanyId: string;\n\t\tcustomerId?: string;\n\t\tcc?: string[];\n\t\tbcc?: string[];\n\t\tattachments?: { filename: string; content: string; contentType?: string }[];\n\t} | null>(null);\n\n\tconst signature = useMemo(\n\t\t() => signatureOptions.find((opt) => opt.id === signatureId) ?? signatureOptions[0],\n\t\t[signatureId],\n\t);\n\n\t// Extract first customer recipient for context card\n\tconst customerRecipient = useMemo(\n\t\t() => recipients.find((r) => r.type === \"customer\" && r.id),\n\t\t[recipients],\n\t);\n\n\t// Mark as dirty when content changes\n\tuseEffect(() => {\n\t\tif (body || subject || recipients.length > 0) {\n\t\t\tsetIsDirty(true);\n\t\t}\n\t}, [body, subject, recipients]);\n\n\t// Save draft function\n\tconst saveDraft = useCallback(async () => {\n\t\t// Don't save if there's nothing to save or if we're already saving\n\t\tif (isSavingDraft || (!body && !subject && recipients.length === 0)) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsSavingDraft(true);\n\t\ttry {\n\t\t\tconst firstCustomerRecipient = recipients.find((r) => r.type === \"customer\");\n\t\t\tconst result = await saveDraftAction({\n\t\t\t\tid: draftId || undefined,\n\t\t\t\tto: recipients.map((r) => r.email).filter(Boolean),\n\t\t\t\tcc: ccRecipients.map((r) => r.email).filter(Boolean),\n\t\t\t\tbcc: bccRecipients.map((r) => r.email).filter(Boolean),\n\t\t\t\tsubject,\n\t\t\t\tbody,\n\t\t\t\tcustomerId: firstCustomerRecipient?.id,\n\t\t\t\tattachments: attachments.length > 0 ? attachments.map(a => ({\n\t\t\t\t\tfilename: a.filename,\n\t\t\t\t\tcontent: a.content,\n\t\t\t\t\tcontentType: a.contentType,\n\t\t\t\t})) : undefined,\n\t\t\t});\n\n\t\t\tif (result.success && result.draftId) {\n\t\t\t\tsetDraftId(result.draftId);\n\t\t\t\tsetLastSaved(new Date());\n\t\t\t\tsetIsDirty(false);\n\t\t\t} else {\n\t\t\t\tconsole.error(\"Failed to save draft:\", result.error);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error saving draft:\", error);\n\t\t} finally {\n\t\t\tsetIsSavingDraft(false);\n\t\t}\n\t}, [body, subject, recipients, ccRecipients, bccRecipients, attachments, draftId, isSavingDraft]);\n\n\t// Auto-save draft every 30 seconds when dirty\n\tuseEffect(() => {\n\t\tif (!isDirty) return;\n\n\t\tautoSaveTimeoutRef.current = setTimeout(() => {\n\t\t\tsaveDraft();\n\t\t}, 30000);\n\n\t\treturn () => {\n\t\t\tif (autoSaveTimeoutRef.current) {\n\t\t\t\tclearTimeout(autoSaveTimeoutRef.current);\n\t\t\t}\n\t\t};\n\t}, [isDirty, saveDraft]);\n\n\t// Cleanup on unmount\n\tuseEffect(() => {\n\t\treturn () => {\n\t\t\tif (sendTimeoutRef.current) clearTimeout(sendTimeoutRef.current);\n\t\t\tif (countdownIntervalRef.current) clearInterval(countdownIntervalRef.current);\n\t\t\tif (autoSaveTimeoutRef.current) clearTimeout(autoSaveTimeoutRef.current);\n\t\t};\n\t}, []);\n\n\t// Auto-resize textarea as user types - grows to fill available space\n\tconst handleTextareaInput = useCallback(() => {\n\t\tconst textarea = textareaRef.current;\n\t\tif (textarea) {\n\t\t\t// Reset height to auto to get the correct scrollHeight\n\t\t\ttextarea.style.height = \"auto\";\n\t\t\t// Let it grow to its natural height - parent container handles overflow\n\t\t\ttextarea.style.height = `${textarea.scrollHeight}px`;\n\t\t}\n\t}, []);\n\n\t// Trigger resize when body changes\n\tuseEffect(() => {\n\t\thandleTextareaInput();\n\t}, [body, handleTextareaInput]);\n\n\t// Focus textarea on mount\n\tuseEffect(() => {\n\t\tsetTimeout(() => textareaRef.current?.focus(), 100);\n\t}, []);\n\n\tconst cancelSend = useCallback(() => {\n\t\tif (sendTimeoutRef.current) {\n\t\t\tclearTimeout(sendTimeoutRef.current);\n\t\t\tsendTimeoutRef.current = null;\n\t\t}\n\t\tif (countdownIntervalRef.current) {\n\t\t\tclearInterval(countdownIntervalRef.current);\n\t\t\tcountdownIntervalRef.current = null;\n\t\t}\n\t\tif (countdownToastIdRef.current !== null) {\n\t\t\tsonnerToast.dismiss(countdownToastIdRef.current);\n\t\t\tcountdownToastIdRef.current = null;\n\t\t}\n\t\tsetIsPendingSend(false);\n\t\tsetUndoCountdown(5);\n\t\tpendingEmailDataRef.current = null;\n\t\ttoastApi.success(\"Send cancelled\");\n\t}, [toastApi]);\n\n\tconst executeSend = useCallback(async () => {\n\t\tconst emailData = pendingEmailDataRef.current;\n\t\tif (!emailData) return;\n\n\t\t// Dismiss countdown toast\n\t\tif (countdownToastIdRef.current !== null) {\n\t\t\tsonnerToast.dismiss(countdownToastIdRef.current);\n\t\t\tcountdownToastIdRef.current = null;\n\t\t}\n\n\t\tsetIsSending(true);\n\t\ttry {\n\t\t\tconst result = await sendCustomerEmailAction(emailData);\n\t\t\tif (result.success) {\n\t\t\t\t// Delete the draft if it was saved\n\t\t\t\tif (draftId) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait deleteDraftAction(draftId);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error(\"Failed to delete draft after send:\", error);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ttoastApi.success(\"Email sent successfully\");\n\t\t\t\tonSent?.(result.data ?? {});\n\t\t\t\tonClose();\n\t\t\t} else {\n\t\t\t\ttoastApi.error(result.error || \"Failed to send email\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Send failed:\", error);\n\t\t\ttoastApi.error(error instanceof Error ? error.message : \"Failed to send\");\n\t\t} finally {\n\t\t\tsetIsSending(false);\n\t\t\tsetIsPendingSend(false);\n\t\t\tpendingEmailDataRef.current = null;\n\t\t}\n\t}, [toastApi, onSent, onClose, draftId]);\n\n\tconst handleSend = async () => {\n\t\tif (!companyId) {\n\t\t\ttoastApi.error(\"Unable to send - missing company context\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst recipientList = recipients.map((r) => r.email).filter(Boolean);\n\n\t\tif (recipientList.length === 0) {\n\t\t\ttoastApi.error(\"Add at least one recipient\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (!subject.trim()) {\n\t\t\ttoastApi.error(\"Please add a subject\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (!body.trim()) {\n\t\t\ttoastApi.error(\"Please write a message\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst finalBody = body + (signature?.value || \"\");\n\t\tconst firstCustomerRecipient = recipients.find((r) => r.type === \"customer\");\n\t\tconst ccList = ccRecipients.map((r) => r.email).filter(Boolean);\n\t\tconst bccList = bccRecipients.map((r) => r.email).filter(Boolean);\n\n\t\tpendingEmailDataRef.current = {\n\t\t\tto: recipientList,\n\t\t\tsubject,\n\t\t\tbody: finalBody,\n\t\t\tcustomerName: firstCustomerRecipient?.name || \"Customer\",\n\t\t\tcompanyId,\n\t\t\tcustomerId: firstCustomerRecipient?.id,\n\t\t\tcc: ccList.length > 0 ? ccList : undefined,\n\t\t\tbcc: bccList.length > 0 ? bccList : undefined,\n\t\t\tattachments: attachments.length > 0 ? attachments.map(a => ({\n\t\t\t\tfilename: a.filename,\n\t\t\t\tcontent: a.content,\n\t\t\t\tcontentType: a.contentType,\n\t\t\t})) : undefined,\n\t\t};\n\n\t\tsetIsPendingSend(true);\n\t\tsetUndoCountdown(5);\n\n\t\t// Create initial toast and store ID\n\t\tlet countdown = 5;\n\t\tcountdownToastIdRef.current = sonnerToast.info(\n\t\t\t<div className=\"flex items-center justify-between gap-4 w-full\">\n\t\t\t\t<span>Sending email in {countdown}s...</span>\n\t\t\t\t<button\n\t\t\t\t\tclassName=\"text-sm font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300\"\n\t\t\t\t\tonClick={() => cancelSend()}\n\t\t\t\t>\n\t\t\t\t\tUndo\n\t\t\t\t</button>\n\t\t\t</div>,\n\t\t\t{ duration: UNDO_SEND_DELAY + 500 }\n\t\t);\n\n\t\t// Update toast every second with new countdown\n\t\tcountdownIntervalRef.current = setInterval(() => {\n\t\t\tcountdown--;\n\t\t\tsetUndoCountdown(countdown);\n\n\t\t\t// Update the toast with new countdown\n\t\t\tif (countdownToastIdRef.current !== null && countdown > 0) {\n\t\t\t\tsonnerToast.info(\n\t\t\t\t\t<div className=\"flex items-center justify-between gap-4 w-full\">\n\t\t\t\t\t\t<span>Sending email in {countdown}s...</span>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclassName=\"text-sm font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300\"\n\t\t\t\t\t\t\tonClick={() => cancelSend()}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tUndo\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>,\n\t\t\t\t\t{\n\t\t\t\t\t\tid: countdownToastIdRef.current,\n\t\t\t\t\t\tduration: UNDO_SEND_DELAY + 500\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (countdown <= 0 && countdownIntervalRef.current) {\n\t\t\t\tclearInterval(countdownIntervalRef.current);\n\t\t\t\tcountdownIntervalRef.current = null;\n\t\t\t}\n\t\t}, 1000);\n\n\t\tsendTimeoutRef.current = setTimeout(() => {\n\t\t\tif (countdownIntervalRef.current) {\n\t\t\t\tclearInterval(countdownIntervalRef.current);\n\t\t\t\tcountdownIntervalRef.current = null;\n\t\t\t}\n\t\t\texecuteSend();\n\t\t}, UNDO_SEND_DELAY);\n\t};\n\n\tconst handleScheduleSend = async (scheduledFor: Date) => {\n\t\tif (!companyId) {\n\t\t\ttoastApi.error(\"Unable to send - missing company context\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst recipientList = recipients.map((r) => r.email).filter(Boolean);\n\t\tif (recipientList.length === 0) {\n\t\t\ttoastApi.error(\"Add at least one recipient\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (!subject.trim()) {\n\t\t\ttoastApi.error(\"Please add a subject\");\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsSending(true);\n\t\ttry {\n\t\t\tconst finalBody = body + (signature?.value || \"\");\n\t\t\tconst firstCustomerRecipient = recipients.find((r) => r.type === \"customer\");\n\t\t\tconst ccList = ccRecipients.map((r) => r.email).filter(Boolean);\n\t\t\tconst bccList = bccRecipients.map((r) => r.email).filter(Boolean);\n\n\t\t\tconst result = await sendCustomerEmailAction({\n\t\t\t\tto: recipientList,\n\t\t\t\tsubject,\n\t\t\t\tbody: finalBody,\n\t\t\t\tcustomerName: firstCustomerRecipient?.name || \"Customer\",\n\t\t\t\tcompanyId,\n\t\t\t\tcustomerId: firstCustomerRecipient?.id,\n\t\t\t\tcc: ccList.length > 0 ? ccList : undefined,\n\t\t\t\tbcc: bccList.length > 0 ? bccList : undefined,\n\t\t\t\tattachments: attachments.length > 0 ? attachments.map(a => ({\n\t\t\t\t\tfilename: a.filename,\n\t\t\t\t\tcontent: a.content,\n\t\t\t\t\tcontentType: a.contentType,\n\t\t\t\t})) : undefined,\n\t\t\t\tscheduledFor: scheduledFor.toISOString(),\n\t\t\t});\n\n\t\t\tif (result.success) {\n\t\t\t\tconst formattedTime = scheduledFor.toLocaleString(\"en-US\", {\n\t\t\t\t\tweekday: \"short\",\n\t\t\t\t\tmonth: \"short\",\n\t\t\t\t\tday: \"numeric\",\n\t\t\t\t\thour: \"numeric\",\n\t\t\t\t\tminute: \"2-digit\",\n\t\t\t\t});\n\t\t\t\ttoastApi.success(`Email scheduled for ${formattedTime}`);\n\t\t\t\tonSent?.(result.data ?? {});\n\t\t\t\tonClose();\n\t\t\t} else {\n\t\t\t\ttoastApi.error(result.error || \"Failed to schedule email\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Schedule failed:\", error);\n\t\t\ttoastApi.error(error instanceof Error ? error.message : \"Failed to schedule\");\n\t\t} finally {\n\t\t\tsetIsSending(false);\n\t\t\tsetScheduleOpen(false);\n\t\t}\n\t};\n\n\tconst getSchedulePreset = (preset: string): Date => {\n\t\tconst now = new Date();\n\t\tconst tomorrow = new Date(now);\n\t\ttomorrow.setDate(tomorrow.getDate() + 1);\n\n\t\tswitch (preset) {\n\t\t\tcase \"tomorrow_morning\":\n\t\t\t\ttomorrow.setHours(9, 0, 0, 0);\n\t\t\t\treturn tomorrow;\n\t\t\tcase \"tomorrow_afternoon\":\n\t\t\t\ttomorrow.setHours(14, 0, 0, 0);\n\t\t\t\treturn tomorrow;\n\t\t\tcase \"monday_morning\": {\n\t\t\t\tconst monday = new Date(now);\n\t\t\t\tconst daysUntilMonday = (8 - now.getDay()) % 7 || 7;\n\t\t\t\tmonday.setDate(monday.getDate() + daysUntilMonday);\n\t\t\t\tmonday.setHours(9, 0, 0, 0);\n\t\t\t\treturn monday;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\treturn tomorrow;\n\t\t}\n\t};\n\n\tconst handleCustomSchedule = () => {\n\t\tif (!scheduledDate || !scheduledTime) {\n\t\t\ttoastApi.error(\"Please select both date and time\");\n\t\t\treturn;\n\t\t}\n\t\thandleScheduleSend(new Date(`${scheduledDate}T${scheduledTime}`));\n\t};\n\n\tconst handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n\t\tif (e.key === \"Enter\" && (e.metaKey || e.ctrlKey)) {\n\t\t\te.preventDefault();\n\t\t\thandleSend();\n\t\t}\n\t};\n\n\tconst handleFileSelect = useCallback(async (e: React.ChangeEvent<HTMLInputElement>) => {\n\t\tconst files = e.target.files;\n\t\tif (!files || files.length === 0) return;\n\n\t\tconst maxSize = 10 * 1024 * 1024;\n\t\tconst newAttachments: EmailAttachment[] = [];\n\n\t\tfor (const file of Array.from(files)) {\n\t\t\tif (file.size > maxSize) {\n\t\t\t\ttoastApi.error(`File \"${file.name}\" is too large (max 10MB)`);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst content = await new Promise<string>((resolve, reject) => {\n\t\t\t\t\tconst reader = new FileReader();\n\t\t\t\t\treader.onload = () => {\n\t\t\t\t\t\tconst base64 = (reader.result as string).split(\",\")[1];\n\t\t\t\t\t\tresolve(base64);\n\t\t\t\t\t};\n\t\t\t\t\treader.onerror = reject;\n\t\t\t\t\treader.readAsDataURL(file);\n\t\t\t\t});\n\n\t\t\t\tnewAttachments.push({\n\t\t\t\t\tfilename: file.name,\n\t\t\t\t\tcontent,\n\t\t\t\t\tcontentType: file.type,\n\t\t\t\t\tsize: file.size,\n\t\t\t\t});\n\t\t\t} catch {\n\t\t\t\ttoastApi.error(`Failed to read file \"${file.name}\"`);\n\t\t\t}\n\t\t}\n\n\t\tif (newAttachments.length > 0) {\n\t\t\tsetAttachments((prev) => [...prev, ...newAttachments]);\n\t\t}\n\n\t\tif (fileInputRef.current) {\n\t\t\tfileInputRef.current.value = \"\";\n\t\t}\n\t}, [toastApi]);\n\n\tconst removeAttachment = useCallback((filename: string) => {\n\t\tsetAttachments((prev) => prev.filter((a) => a.filename !== filename));\n\t}, []);\n\n\tconst formatFileSize = (bytes: number) => {\n\t\tif (bytes < 1024) return `${bytes} B`;\n\t\tif (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n\t\treturn `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n\t};\n\n\t// Save draft and close (X button behavior)\n\tconst handleClose = useCallback(async () => {\n\t\t// Save the draft before closing if there's content\n\t\tif (isDirty && (body || subject || recipients.length > 0)) {\n\t\t\tawait saveDraft();\n\t\t}\n\t\tonClose();\n\t}, [isDirty, body, subject, recipients, saveDraft, onClose]);\n\n\t// Delete draft and close (trash button behavior)\n\tconst handleDiscard = useCallback(async () => {\n\t\t// If there's a saved draft, delete it\n\t\tif (draftId) {\n\t\t\ttry {\n\t\t\t\tawait deleteDraftAction(draftId);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Failed to delete draft:\", error);\n\t\t\t}\n\t\t}\n\t\tonClose();\n\t}, [draftId, onClose]);\n\n\tconst applyTemplate = (templateId: string) => {\n\t\tconst template = templateDefinitions.find((t) => t.id === templateId);\n\t\tif (template) {\n\t\t\tsetBody(template.body);\n\t\t}\n\t};\n\n\treturn (\n\t\t<TooltipProvider>\n\t\t\t<div className={cn(\n\t\t\t\t\"flex flex-col h-full overflow-hidden bg-card\",\n\t\t\t\tclassName\n\t\t\t)}>\n\t\t\t\t{/* Header - Clean minimal design */}\n\t\t\t\t<div className=\"flex items-center justify-between px-3 py-2 border-b border-border/50\">\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<span className=\"text-xs font-medium text-muted-foreground uppercase tracking-wide\">\n\t\t\t\t\t\t\tNew Message\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t{isSavingDraft ? (\n\t\t\t\t\t\t\t<span className=\"text-[10px] text-muted-foreground/60\">\n\t\t\t\t\t\t\t\t Saving draft...\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t) : lastSaved ? (\n\t\t\t\t\t\t\t<span className=\"text-[10px] text-muted-foreground/60\">\n\t\t\t\t\t\t\t\t Draft saved {lastSaved.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t) : null}\n\t\t\t\t\t</div>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\tclassName=\"h-7 w-7 p-0 text-muted-foreground hover:text-foreground\"\n\t\t\t\t\t\tonClick={handleClose}\n\t\t\t\t\t>\n\t\t\t\t\t\t<X className=\"h-4 w-4\" />\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Recipients Section - Clean layout matching reply composer */}\n\t\t\t\t<div className=\"px-3 py-2 space-y-2 border-b border-border/50\">\n\t\t\t\t\t{/* To Field */}\n\t\t\t\t\t<div className=\"flex items-start gap-2\">\n\t\t\t\t\t\t<span className=\"text-xs font-medium text-muted-foreground w-12 pt-2\">To:</span>\n\t\t\t\t\t\t<RecipientAutocomplete\n\t\t\t\t\t\t\tvalue={recipients}\n\t\t\t\t\t\t\tonChange={setRecipients}\n\t\t\t\t\t\t\tplaceholder=\"Search customers, vendors, or type email...\"\n\t\t\t\t\t\t\tclassName=\"flex-1\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div className=\"flex items-center gap-1 pt-1.5\">\n\t\t\t\t\t\t\t{!showCc && (\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tonClick={() => setShowCc(true)}\n\t\t\t\t\t\t\t\t\tclassName=\"text-xs text-muted-foreground hover:text-foreground px-1.5 py-0.5 rounded hover:bg-muted transition-colors\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tCc\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{!showBcc && (\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tonClick={() => setShowBcc(true)}\n\t\t\t\t\t\t\t\t\tclassName=\"text-xs text-muted-foreground hover:text-foreground px-1.5 py-0.5 rounded hover:bg-muted transition-colors\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tBcc\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* CC Field */}\n\t\t\t\t\t{showCc && (\n\t\t\t\t\t\t<div className=\"flex items-start gap-2\">\n\t\t\t\t\t\t\t<span className=\"text-xs font-medium text-muted-foreground w-12 pt-2\">Cc:</span>\n\t\t\t\t\t\t\t<RecipientAutocomplete\n\t\t\t\t\t\t\t\tvalue={ccRecipients}\n\t\t\t\t\t\t\t\tonChange={setCcRecipients}\n\t\t\t\t\t\t\t\tplaceholder=\"Add Cc recipients...\"\n\t\t\t\t\t\t\t\tclassName=\"flex-1\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tsetShowCc(false);\n\t\t\t\t\t\t\t\t\tsetCcRecipients([]);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tclassName=\"text-xs text-muted-foreground hover:text-destructive pt-2\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* BCC Field */}\n\t\t\t\t\t{showBcc && (\n\t\t\t\t\t\t<div className=\"flex items-start gap-2\">\n\t\t\t\t\t\t\t<span className=\"text-xs font-medium text-muted-foreground w-12 pt-2\">Bcc:</span>\n\t\t\t\t\t\t\t<RecipientAutocomplete\n\t\t\t\t\t\t\t\tvalue={bccRecipients}\n\t\t\t\t\t\t\t\tonChange={setBccRecipients}\n\t\t\t\t\t\t\t\tplaceholder=\"Add Bcc recipients...\"\n\t\t\t\t\t\t\t\tclassName=\"flex-1\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tsetShowBcc(false);\n\t\t\t\t\t\t\t\t\tsetBccRecipients([]);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tclassName=\"text-xs text-muted-foreground hover:text-destructive pt-2\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Subject Field */}\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<span className=\"text-xs font-medium text-muted-foreground w-12\">Subject:</span>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tvalue={subject}\n\t\t\t\t\t\t\tonChange={(e) => setSubject(e.target.value)}\n\t\t\t\t\t\t\tplaceholder=\"Subject\"\n\t\t\t\t\t\t\tclassName=\"flex-1 bg-transparent text-sm outline-none placeholder:text-muted-foreground\"\n\t\t\t\t\t\t\tautoComplete=\"off\"\n\t\t\t\t\t\t\tautoCorrect=\"off\"\n\t\t\t\t\t\t\tautoCapitalize=\"off\"\n\t\t\t\t\t\t\tspellCheck=\"true\"\n\t\t\t\t\t\t\tname=\"email-subject\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Customer Context Card */}\n\t\t\t\t{customerRecipient?.id && (\n\t\t\t\t\t<div className=\"px-3 py-2 border-b border-border/50\">\n\t\t\t\t\t\t<CustomerContextCard customerId={customerRecipient.id} />\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\n\t\t\t\t{/* Message Body */}\n\t\t\t\t<div className=\"flex-1 flex flex-col min-h-0 overflow-hidden\">\n\t\t\t\t\t<div className=\"px-3 py-2 flex-1 overflow-y-auto\">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tref={textareaRef}\n\t\t\t\t\t\t\tvalue={body}\n\t\t\t\t\t\t\tonChange={(e) => setBody(e.target.value)}\n\t\t\t\t\t\t\tonInput={handleTextareaInput}\n\t\t\t\t\t\t\tonKeyDown={handleKeyDown}\n\t\t\t\t\t\t\tplaceholder=\"Write your message...\"\n\t\t\t\t\t\t\tclassName=\"w-full resize-none bg-transparent text-sm outline-none placeholder:text-muted-foreground min-h-[80px]\"\n\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t{/* Signature Preview - Always visible */}\n\t\t\t\t\t\t{signature.value && (\n\t\t\t\t\t\t\t<div className=\"mt-2 pt-2 border-t border-dashed border-border/50\">\n\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1 flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t<span>Signature</span>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => setSignatureId(\"none\")}\n\t\t\t\t\t\t\t\t\t\tclassName=\"text-[10px] hover:text-foreground transition-colors\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tRemove\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"text-sm text-muted-foreground whitespace-pre-wrap\">\n\t\t\t\t\t\t\t\t\t{signature.value.trim()}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Attachments */}\n\t\t\t\t\t{attachments.length > 0 && (\n\t\t\t\t\t\t<div className=\"px-3 py-2 border-t border-border/50\">\n\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\n\t\t\t\t\t\t\t\t{attachments.map((attachment) => (\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tkey={attachment.filename}\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center gap-1.5 px-2 py-1 bg-background border rounded-md text-xs\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Paperclip className=\"h-3 w-3 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t<span className=\"max-w-[120px] truncate\">{attachment.filename}</span>\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">({formatFileSize(attachment.size)})</span>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => removeAttachment(attachment.filename)}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"ml-1 text-muted-foreground hover:text-destructive\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{/* Hidden file input */}\n\t\t\t\t<input\n\t\t\t\t\tref={fileInputRef}\n\t\t\t\t\ttype=\"file\"\n\t\t\t\t\tmultiple\n\t\t\t\t\tclassName=\"hidden\"\n\t\t\t\t\tonChange={handleFileSelect}\n\t\t\t\t\taccept=\"*/*\"\n\t\t\t\t/>\n\n\t\t\t\t{/* Footer Toolbar - Clean design matching reply composer */}\n\t\t\t\t<div className=\"flex items-center justify-between gap-1 border-t border-border/50 px-2 py-1.5\">\n\t\t\t\t\t<div className=\"flex items-center gap-0.5\">\n\t\t\t\t\t\t{/* Attachments */}\n\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\tclassName=\"h-7 w-7 p-0\"\n\t\t\t\t\t\t\t\t\tonClick={() => fileInputRef.current?.click()}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Paperclip className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent side=\"top\">Attach file</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t{/* Link */}\n\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" className=\"h-7 w-7 p-0\">\n\t\t\t\t\t\t\t\t\t<LinkIcon className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent side=\"top\">Insert link</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t<div className=\"w-px h-4 bg-border mx-1\" />\n\n\t\t\t\t\t\t{/* Formatting Dropdown */}\n\t\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 gap-1\">\n\t\t\t\t\t\t\t\t\t<Bold className=\"h-3.5 w-3.5 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t<ChevronDown className=\"h-3 w-3 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t\t<DropdownMenuContent align=\"start\" className=\"w-40\">\n\t\t\t\t\t\t\t\t<DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t<Bold className=\"h-4 w-4 mr-2\" /> Bold\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t<Italic className=\"h-4 w-4 mr-2\" /> Italic\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t<Underline className=\"h-4 w-4 mr-2\" /> Underline\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t<DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t<List className=\"h-4 w-4 mr-2\" /> Bullet list\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t<ListOrdered className=\"h-4 w-4 mr-2\" /> Numbered list\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t\t</DropdownMenu>\n\n\t\t\t\t\t\t{/* Templates & Signatures */}\n\t\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 gap-1\">\n\t\t\t\t\t\t\t\t\t<Sparkles className=\"h-3.5 w-3.5 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground hidden sm:inline\">Templates</span>\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t\t<DropdownMenuContent align=\"start\" className=\"w-48\">\n\t\t\t\t\t\t\t\t{templateDefinitions.map((template) => (\n\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\tkey={template.id}\n\t\t\t\t\t\t\t\t\t\tonClick={() => applyTemplate(template.id)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{template.label}\n\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t<DropdownMenuItem className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\tSignature: {signature.label}\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t{signatureOptions.map((opt) => (\n\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\tkey={opt.id}\n\t\t\t\t\t\t\t\t\t\tonClick={() => setSignatureId(opt.id)}\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"pl-6\",\n\t\t\t\t\t\t\t\t\t\t\tsignatureId === opt.id && \"font-medium text-primary\",\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{opt.label}\n\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t\t</DropdownMenu>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t{/* Discard */}\n\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\tclassName=\"h-7 w-7 p-0 text-muted-foreground hover:text-destructive\"\n\t\t\t\t\t\t\t\t\tonClick={handleDiscard}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Trash2 className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent side=\"top\">Discard</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t{/* Send Button with Schedule Option */}\n\t\t\t\t\t\t{isPendingSend ? (\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\tclassName=\"h-7 px-3 gap-1.5 rounded-full bg-amber-500 hover:bg-amber-600\"\n\t\t\t\t\t\t\t\tonClick={cancelSend}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span className=\"text-xs font-medium\">Undo ({undoCountdown}s)</span>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<div className=\"flex items-center\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\tclassName=\"h-7 px-3 gap-1.5 rounded-l-full rounded-r-none\"\n\t\t\t\t\t\t\t\t\tonClick={handleSend}\n\t\t\t\t\t\t\t\t\tdisabled={isSending || !body.trim() || recipients.length === 0}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{isSending ? (\n\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-3.5 w-3.5 animate-spin\" />\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<Send className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t<span className=\"text-xs font-medium\">Send</span>\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t<Popover open={scheduleOpen} onOpenChange={setScheduleOpen}>\n\t\t\t\t\t\t\t\t\t<PopoverTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-7 px-1.5 rounded-l-none rounded-r-full border-l border-primary-foreground/20\"\n\t\t\t\t\t\t\t\t\t\t\tdisabled={isSending || !body.trim() || recipients.length === 0}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<ChevronDown className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t</PopoverTrigger>\n\t\t\t\t\t\t\t\t\t<PopoverContent className=\"w-72 p-2\" align=\"end\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs font-medium text-muted-foreground px-2 py-1\">\n\t\t\t\t\t\t\t\t\t\t\t\tSchedule send\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"space-y-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full justify-start h-8 text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleScheduleSend(getSchedulePreset(\"tomorrow_morning\"))}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Clock className=\"h-3.5 w-3.5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tTomorrow morning (9:00 AM)\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full justify-start h-8 text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleScheduleSend(getSchedulePreset(\"tomorrow_afternoon\"))}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Clock className=\"h-3.5 w-3.5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tTomorrow afternoon (2:00 PM)\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full justify-start h-8 text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleScheduleSend(getSchedulePreset(\"monday_morning\"))}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Calendar className=\"h-3.5 w-3.5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tMonday morning (9:00 AM)\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"border-t border-border pt-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs font-medium text-muted-foreground px-2 py-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tPick date & time\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2 px-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={scheduledDate}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => setScheduledDate(e.target.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmin={new Date().toISOString().split(\"T\")[0]}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"time\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={scheduledTime}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => setScheduledTime(e.target.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full mt-2 h-8 text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={handleCustomSchedule}\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={!scheduledDate || !scheduledTime}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Clock className=\"h-3.5 w-3.5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tSchedule\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</PopoverContent>\n\t\t\t\t\t\t\t\t</Popover>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Keyboard shortcut hint */}\n\t\t\t\t<div className=\"px-3 pb-1.5 text-[10px] text-muted-foreground/60 text-right\">\n\t\t\t\t\t + Enter to send\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</TooltipProvider>\n\t);\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"401d356a968cf8d1f995402d9f67be44efdfa030c2\":\"saveDraftAction\"},\"apps/web/src/actions/email-actions.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var saveDraftAction=/*#__PURE__*/createServerReference(\"401d356a968cf8d1f995402d9f67be44efdfa030c2\",callServer,void 0,findSourceMapURL,\"saveDraftAction\");","/* __next_internal_action_entry_do_not_use__ [{\"402a8624506c3a970451b4011123033b4cf44a1c0d\":\"deleteDraftAction\"},\"apps/web/src/actions/email-actions.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var deleteDraftAction=/*#__PURE__*/createServerReference(\"402a8624506c3a970451b4011123033b4cf44a1c0d\",callServer,void 0,findSourceMapURL,\"deleteDraftAction\");","\"use client\";\n\nimport { searchCustomers } from \"@/actions/customers\";\nimport { searchVendors } from \"@/actions/vendors\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { cn } from \"@/lib/utils\";\nimport {\n\tBuilding2,\n\tChevronRight,\n\tLoader2,\n\tMail,\n\tPlus,\n\tSearch,\n\tUser,\n\tUsers,\n\tX,\n} from \"lucide-react\";\nimport {\n\tuseCallback,\n\tuseEffect,\n\tuseMemo,\n\tuseRef,\n\tuseState,\n\tuseTransition,\n} from \"react\";\n\nexport type Recipient = {\n\tid: string;\n\ttype: \"customer\" | \"vendor\" | \"team\" | \"custom\";\n\tname: string;\n\temail: string;\n};\n\ntype Customer = {\n\tid: string;\n\tdisplay_name: string;\n\temail?: string | null;\n\tphone?: string | null;\n\tcompany_name?: string | null;\n};\n\ntype Vendor = {\n\tid: string;\n\tname: string;\n\tdisplay_name?: string | null;\n\temail?: string | null;\n};\n\ntype Suggestion = {\n\tid: string;\n\ttype: \"customer\" | \"vendor\" | \"team\" | \"custom\";\n\tname: string;\n\temail: string;\n\tsubtitle?: string;\n};\n\ntype SuggestionGroup = {\n\tid: string;\n\tlabel: string;\n\ticon: React.ReactNode;\n\taction?: () => void;\n\tsuggestions?: Suggestion[];\n};\n\ninterface RecipientAutocompleteProps {\n\tvalue: Recipient[];\n\tonChange: (recipients: Recipient[]) => void;\n\tplaceholder?: string;\n\tclassName?: string;\n\t/** Pre-populate recent/thread recipients */\n\trecentRecipients?: Recipient[];\n}\n\nexport function RecipientAutocomplete({\n\tvalue,\n\tonChange,\n\tplaceholder = \"Search or type email...\",\n\tclassName,\n\trecentRecipients = [],\n}: RecipientAutocompleteProps) {\n\tconst inputRef = useRef<HTMLInputElement>(null);\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst [inputValue, setInputValue] = useState(\"\");\n\tconst [isFocused, setIsFocused] = useState(false);\n\tconst [customers, setCustomers] = useState<Suggestion[]>([]);\n\tconst [vendors, setVendors] = useState<Suggestion[]>([]);\n\tconst [loading, setLoading] = useState(false);\n\tconst [selectedIndex, setSelectedIndex] = useState(0);\n\tconst [isPending, startTransition] = useTransition();\n\tconst [isReadOnly, setIsReadOnly] = useState(true);\n\n\t// Generate a stable random name to prevent browser pattern recognition\n\tconst randomInputName = useMemo(() => `recipient-${Math.random().toString(36).slice(2)}`, []);\n\n\t// Filter out already selected recipients\n\tconst selectedEmails = useMemo(\n\t\t() => new Set((value || []).map((r) => r.email.toLowerCase())),\n\t\t[value]\n\t);\n\n\t// Debounced search\n\tuseEffect(() => {\n\t\tif (inputValue.trim().length < 2) {\n\t\t\tsetCustomers([]);\n\t\t\tsetVendors([]);\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeoutId = setTimeout(() => {\n\t\t\tsetLoading(true);\n\t\t\tstartTransition(async () => {\n\t\t\t\ttry {\n\t\t\t\t\t// Search customers with error handling\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst customersResult = await searchCustomers(inputValue, { limit: 5 });\n\t\t\t\t\t\tif (customersResult.success && customersResult.data) {\n\t\t\t\t\t\t\tconst customerArray = Array.isArray(customersResult.data)\n\t\t\t\t\t\t\t\t? customersResult.data\n\t\t\t\t\t\t\t\t: [customersResult.data];\n\n\t\t\t\t\t\t\tconst mapped = customerArray\n\t\t\t\t\t\t\t\t.filter((c: any) => c.email && !selectedEmails.has(c.email.toLowerCase()))\n\t\t\t\t\t\t\t\t.map((c: any) => ({\n\t\t\t\t\t\t\t\t\tid: c.id,\n\t\t\t\t\t\t\t\t\ttype: \"customer\" as const,\n\t\t\t\t\t\t\t\t\tname:\n\t\t\t\t\t\t\t\t\t\tc.display_name ||\n\t\t\t\t\t\t\t\t\t\t`${c.first_name || \"\"} ${c.last_name || \"\"}`.trim() ||\n\t\t\t\t\t\t\t\t\t\t\"Customer\",\n\t\t\t\t\t\t\t\t\temail: c.email,\n\t\t\t\t\t\t\t\t\tsubtitle: c.company_name || undefined,\n\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\tsetCustomers(mapped);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetCustomers([]);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (customerError) {\n\t\t\t\t\t\t// Silently handle customer search errors - user can still use custom email\n\t\t\t\t\t\tsetCustomers([]);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Search vendors with error handling\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst vendorsResult = await searchVendors(inputValue);\n\t\t\t\t\t\tif (vendorsResult.success && vendorsResult.data) {\n\t\t\t\t\t\t\tconst vendorArray = Array.isArray(vendorsResult.data)\n\t\t\t\t\t\t\t\t? vendorsResult.data\n\t\t\t\t\t\t\t\t: [vendorsResult.data];\n\n\t\t\t\t\t\t\tconst mapped = vendorArray\n\t\t\t\t\t\t\t\t.filter((v: any) => v.email && !selectedEmails.has(v.email.toLowerCase()))\n\t\t\t\t\t\t\t\t.map((v: any) => ({\n\t\t\t\t\t\t\t\t\tid: v.id,\n\t\t\t\t\t\t\t\t\ttype: \"vendor\" as const,\n\t\t\t\t\t\t\t\t\tname: v.display_name || v.name,\n\t\t\t\t\t\t\t\t\temail: v.email,\n\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\tsetVendors(mapped);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetVendors([]);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (vendorError) {\n\t\t\t\t\t\t// Silently handle vendor search errors - user can still use custom email\n\t\t\t\t\t\tsetVendors([]);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\t// General error handler\n\t\t\t\t\tsetCustomers([]);\n\t\t\t\t\tsetVendors([]);\n\t\t\t\t} finally {\n\t\t\t\t\tsetLoading(false);\n\t\t\t\t}\n\t\t\t});\n\t\t}, 200);\n\n\t\treturn () => clearTimeout(timeoutId);\n\t}, [inputValue, selectedEmails]);\n\n\t// Build suggestion groups\n\tconst suggestionGroups = useMemo<SuggestionGroup[]>(() => {\n\t\tconst groups: SuggestionGroup[] = [];\n\n\t\t// Custom email option (if valid email typed)\n\t\tconst emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\t\tconst isValidEmail = emailRegex.test(inputValue.trim());\n\t\tif (isValidEmail && !selectedEmails.has(inputValue.trim().toLowerCase())) {\n\t\t\tgroups.push({\n\t\t\t\tid: \"custom\",\n\t\t\t\tlabel: \"Add Email\",\n\t\t\t\ticon: <Mail className=\"h-4 w-4\" />,\n\t\t\t\tsuggestions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: `custom-${inputValue}`,\n\t\t\t\t\t\ttype: \"custom\",\n\t\t\t\t\t\tname: inputValue.trim(),\n\t\t\t\t\t\temail: inputValue.trim(),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t}\n\n\t\t// Recent/Thread recipients (from the email thread)\n\t\tconst filteredRecent = recentRecipients.filter(\n\t\t\t(r) => !selectedEmails.has(r.email.toLowerCase())\n\t\t);\n\t\tif (filteredRecent.length > 0 && inputValue.trim().length < 2) {\n\t\t\tgroups.push({\n\t\t\t\tid: \"recent\",\n\t\t\t\tlabel: \"From this thread\",\n\t\t\t\ticon: <Mail className=\"h-4 w-4\" />,\n\t\t\t\tsuggestions: filteredRecent.map((r) => ({\n\t\t\t\t\tid: r.id,\n\t\t\t\t\ttype: r.type,\n\t\t\t\t\tname: r.name,\n\t\t\t\t\temail: r.email,\n\t\t\t\t})),\n\t\t\t});\n\t\t}\n\n\t\t// Customers\n\t\tif (customers.length > 0) {\n\t\t\tgroups.push({\n\t\t\t\tid: \"customers\",\n\t\t\t\tlabel: \"Customers\",\n\t\t\t\ticon: <User className=\"h-4 w-4\" />,\n\t\t\t\tsuggestions: customers,\n\t\t\t});\n\t\t}\n\n\t\t// Vendors\n\t\tif (vendors.length > 0) {\n\t\t\tgroups.push({\n\t\t\t\tid: \"vendors\",\n\t\t\t\tlabel: \"Vendors\",\n\t\t\t\ticon: <Building2 className=\"h-4 w-4\" />,\n\t\t\t\tsuggestions: vendors,\n\t\t\t});\n\t\t}\n\n\t\treturn groups;\n\t}, [inputValue, customers, vendors, recentRecipients, selectedEmails]);\n\n\t// Check if input is a valid email\n\tconst isValidEmail = useMemo(() => {\n\t\tconst emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\t\treturn emailRegex.test(inputValue.trim());\n\t}, [inputValue]);\n\n\t// Show custom email option whenever user is typing (primary feature)\n\tconst showCustomEmailOption = useMemo(() => {\n\t\tconst trimmedInput = inputValue.trim();\n\t\t// Show if there's any input and it's not already selected\n\t\treturn trimmedInput.length > 0 && !selectedEmails.has(trimmedInput.toLowerCase());\n\t}, [inputValue, selectedEmails]);\n\n\t// Flatten suggestions for keyboard navigation\n\tconst flatSuggestions = useMemo(\n\t\t() => suggestionGroups.flatMap((g) => g.suggestions || []),\n\t\t[suggestionGroups]\n\t);\n\n\tconst addRecipient = useCallback(\n\t\t(suggestion: Suggestion) => {\n\t\t\tconst newRecipient: Recipient = {\n\t\t\t\tid: suggestion.id,\n\t\t\t\ttype: suggestion.type,\n\t\t\t\tname: suggestion.name,\n\t\t\t\temail: suggestion.email,\n\t\t\t};\n\n\t\t\tif (!selectedEmails.has(newRecipient.email.toLowerCase())) {\n\t\t\t\tonChange([...(value || []), newRecipient]);\n\t\t\t}\n\n\t\t\tsetInputValue(\"\");\n\t\t\tsetCustomers([]);\n\t\t\tsetVendors([]);\n\t\t\tinputRef.current?.focus();\n\t\t},\n\t\t[value, onChange, selectedEmails]\n\t);\n\n\tconst addCustomEmail = useCallback(() => {\n\t\tconst email = inputValue.trim();\n\n\t\t// Validate email format when adding\n\t\tif (!isValidEmail) {\n\t\t\t// Could show a toast error here if desired\n\t\t\treturn;\n\t\t}\n\n\t\taddRecipient({\n\t\t\tid: `custom-${email}`,\n\t\t\ttype: \"custom\",\n\t\t\tname: email,\n\t\t\temail: email,\n\t\t});\n\t}, [inputValue, isValidEmail, addRecipient]);\n\n\tconst removeRecipient = useCallback(\n\t\t(email: string) => {\n\t\t\tonChange((value || []).filter((r) => r.email !== email));\n\t\t},\n\t\t[value, onChange]\n\t);\n\n\tconst handleKeyDown = useCallback(\n\t\t(e: React.KeyboardEvent<HTMLInputElement>) => {\n\t\t\tconst recipients = value || [];\n\t\t\tif (e.key === \"Backspace\" && inputValue === \"\" && recipients.length > 0) {\n\t\t\t\te.preventDefault();\n\t\t\t\tremoveRecipient(recipients[recipients.length - 1].email);\n\t\t\t} else if (e.key === \"ArrowDown\") {\n\t\t\t\te.preventDefault();\n\t\t\t\tsetSelectedIndex((prev) => Math.min(prev + 1, flatSuggestions.length - 1));\n\t\t\t} else if (e.key === \"ArrowUp\") {\n\t\t\t\te.preventDefault();\n\t\t\t\tsetSelectedIndex((prev) => Math.max(prev - 1, 0));\n\t\t\t} else if (e.key === \"Enter\") {\n\t\t\t\te.preventDefault();\n\t\t\t\tif (flatSuggestions.length > 0 && selectedIndex < flatSuggestions.length) {\n\t\t\t\t\taddRecipient(flatSuggestions[selectedIndex]);\n\t\t\t\t} else if (inputValue.trim()) {\n\t\t\t\t\tconst emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\t\t\t\t\tif (emailRegex.test(inputValue.trim())) {\n\t\t\t\t\t\taddRecipient({\n\t\t\t\t\t\t\tid: `custom-${inputValue}`,\n\t\t\t\t\t\t\ttype: \"custom\",\n\t\t\t\t\t\t\tname: inputValue.trim(),\n\t\t\t\t\t\t\temail: inputValue.trim(),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (e.key === \"Escape\") {\n\t\t\t\tsetIsFocused(false);\n\t\t\t} else if (e.key === \",\" || e.key === \";\" || e.key === \"Tab\") {\n\t\t\t\tconst emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\t\t\t\tif (emailRegex.test(inputValue.trim())) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\taddRecipient({\n\t\t\t\t\t\tid: `custom-${inputValue}`,\n\t\t\t\t\t\ttype: \"custom\",\n\t\t\t\t\t\tname: inputValue.trim(),\n\t\t\t\t\t\temail: inputValue.trim(),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t[inputValue, value, flatSuggestions, selectedIndex, addRecipient, removeRecipient]\n\t);\n\n\t// Close dropdown when clicking outside\n\tuseEffect(() => {\n\t\tconst handleClickOutside = (e: MouseEvent) => {\n\t\t\tif (containerRef.current && !containerRef.current.contains(e.target as Node)) {\n\t\t\t\tsetIsFocused(false);\n\t\t\t}\n\t\t};\n\n\t\tdocument.addEventListener(\"mousedown\", handleClickOutside);\n\t\treturn () => document.removeEventListener(\"mousedown\", handleClickOutside);\n\t}, []);\n\n\t// Reset selection when suggestions change\n\tuseEffect(() => {\n\t\tsetSelectedIndex(0);\n\t}, [flatSuggestions.length]);\n\n\tconst showDropdown = isFocused && (suggestionGroups.length > 0 || loading || inputValue.trim().length === 0);\n\n\tconst getTypeIcon = (type: Recipient[\"type\"]) => {\n\t\tswitch (type) {\n\t\t\tcase \"customer\":\n\t\t\t\treturn <User className=\"h-3 w-3\" />;\n\t\t\tcase \"vendor\":\n\t\t\t\treturn <Building2 className=\"h-3 w-3\" />;\n\t\t\tcase \"team\":\n\t\t\t\treturn <Users className=\"h-3 w-3\" />;\n\t\t\tdefault:\n\t\t\t\treturn <Mail className=\"h-3 w-3\" />;\n\t\t}\n\t};\n\n\tconst getTypeColor = (type: Recipient[\"type\"]) => {\n\t\tswitch (type) {\n\t\t\tcase \"customer\":\n\t\t\t\treturn \"bg-blue-500/10 text-blue-600 dark:text-blue-400 border-blue-500/20\";\n\t\t\tcase \"vendor\":\n\t\t\t\treturn \"bg-purple-500/10 text-purple-600 dark:text-purple-400 border-purple-500/20\";\n\t\t\tcase \"team\":\n\t\t\t\treturn \"bg-green-500/10 text-green-600 dark:text-green-400 border-green-500/20\";\n\t\t\tdefault:\n\t\t\t\treturn \"bg-muted text-muted-foreground border-border\";\n\t\t}\n\t};\n\n\treturn (\n\t\t<div ref={containerRef} className={cn(\"relative\", className)}>\n\t\t\t{/* Input Container with Chips */}\n\t\t\t<div\n\t\t\t\tclassName={cn(\n\t\t\t\t\t\"flex flex-wrap items-center gap-1.5 min-h-[36px] px-2 py-1.5\",\n\t\t\t\t\t\"rounded-lg border border-input bg-background\",\n\t\t\t\t\t\"transition-colors cursor-text\",\n\t\t\t\t\tisFocused && \"border-primary ring-1 ring-primary/20\"\n\t\t\t\t)}\n\t\t\t\tonClick={() => inputRef.current?.focus()}\n\t\t\t>\n\t\t\t\t{/* Recipient Chips */}\n\t\t\t\t{(value || []).map((recipient) => (\n\t\t\t\t\t<div\n\t\t\t\t\t\tkey={recipient.email}\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"flex items-center gap-1.5 h-7 pl-2 pr-1 rounded-md border text-xs font-medium\",\n\t\t\t\t\t\t\tgetTypeColor(recipient.type)\n\t\t\t\t\t\t)}\n\t\t\t\t\t>\n\t\t\t\t\t\t{getTypeIcon(recipient.type)}\n\t\t\t\t\t\t<span className=\"max-w-[120px] truncate\">{recipient.name || recipient.email}</span>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\tremoveRecipient(recipient.email);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tclassName=\"ml-0.5 p-0.5 rounded hover:bg-black/10 dark:hover:bg-white/10 transition-colors\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<X className=\"h-3 w-3\" />\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t))}\n\n\t\t\t\t{/* Input with anti-autocomplete techniques */}\n\t\t\t\t<div className=\"flex-1 min-w-[140px] flex items-center gap-1.5\">\n\t\t\t\t\t<Search className=\"h-3.5 w-3.5 text-muted-foreground shrink-0\" />\n\t\t\t\t\t<form autoComplete=\"off\" onSubmit={(e) => e.preventDefault()} className=\"flex-1\">\n\t\t\t\t\t\t{/* Hidden decoy input to catch autocomplete */}\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tname=\"decoy\"\n\t\t\t\t\t\t\tautoComplete=\"off\"\n\t\t\t\t\t\t\ttabIndex={-1}\n\t\t\t\t\t\t\tstyle={{ position: 'absolute', left: '-9999px', width: '1px', height: '1px' }}\n\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref={inputRef}\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tvalue={inputValue}\n\t\t\t\t\t\t\tonChange={(e) => setInputValue(e.target.value)}\n\t\t\t\t\t\t\tonFocus={() => {\n\t\t\t\t\t\t\t\tsetIsFocused(true);\n\t\t\t\t\t\t\t\t// Remove readonly on focus to allow typing\n\t\t\t\t\t\t\t\tsetIsReadOnly(false);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tonBlur={() => {\n\t\t\t\t\t\t\t\t// Re-enable readonly when not focused\n\t\t\t\t\t\t\t\tsetTimeout(() => setIsReadOnly(true), 100);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tonKeyDown={handleKeyDown}\n\t\t\t\t\t\t\tplaceholder={(value || []).length === 0 ? placeholder : \"Add more...\"}\n\t\t\t\t\t\t\tclassName=\"flex-1 bg-transparent text-sm outline-none placeholder:text-muted-foreground w-full\"\n\t\t\t\t\t\t\tautoComplete=\"chrome-off\"\n\t\t\t\t\t\t\tautoCorrect=\"off\"\n\t\t\t\t\t\t\tautoCapitalize=\"off\"\n\t\t\t\t\t\t\tspellCheck=\"false\"\n\t\t\t\t\t\t\tdata-form-type=\"other\"\n\t\t\t\t\t\t\tdata-lpignore=\"true\"\n\t\t\t\t\t\t\tdata-1p-ignore=\"true\"\n\t\t\t\t\t\t\trole=\"combobox\"\n\t\t\t\t\t\t\taria-autocomplete=\"list\"\n\t\t\t\t\t\t\taria-expanded={showDropdown}\n\t\t\t\t\t\t\taria-controls=\"recipient-suggestions\"\n\t\t\t\t\t\t\tname={randomInputName}\n\t\t\t\t\t\t\treadOnly={isReadOnly}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Suggestions Dropdown */}\n\t\t\t{showDropdown && (\n\t\t\t\t<div className=\"absolute z-50 left-0 right-0 mt-1.5 bg-popover border border-border rounded-lg shadow-lg overflow-hidden\">\n\t\t\t\t\t<ScrollArea className=\"max-h-[280px]\">\n\t\t\t\t\t\t{loading && (\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 px-3 py-3 text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t<Loader2 className=\"h-4 w-4 animate-spin\" />\n\t\t\t\t\t\t\t\tSearching...\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{/* Add Custom Email Option - Always show at TOP while typing */}\n\t\t\t\t\t\t{showCustomEmailOption && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<div className=\"p-1.5\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\tonClick={addCustomEmail}\n\t\t\t\t\t\t\t\t\t\tdisabled={!isValidEmail}\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"flex items-center gap-2 w-full px-2 py-2 text-left rounded-md transition-colors\",\n\t\t\t\t\t\t\t\t\t\t\tisValidEmail\n\t\t\t\t\t\t\t\t\t\t\t\t? \"hover:bg-accent cursor-pointer\"\n\t\t\t\t\t\t\t\t\t\t\t\t: \"opacity-60 cursor-not-allowed\"\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div className={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"flex items-center justify-center h-7 w-7 shrink-0 rounded-full\",\n\t\t\t\t\t\t\t\t\t\t\tisValidEmail ? \"bg-blue-500/10\" : \"bg-muted\"\n\t\t\t\t\t\t\t\t\t\t)}>\n\t\t\t\t\t\t\t\t\t\t\t<Mail className={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\"h-4 w-4\",\n\t\t\t\t\t\t\t\t\t\t\t\tisValidEmail ? \"text-blue-600 dark:text-blue-400\" : \"text-muted-foreground\"\n\t\t\t\t\t\t\t\t\t\t\t)} />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-medium\">Add \"{inputValue.trim()}\"</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t{isValidEmail ? \"Use this email address\" : \"Enter a valid email address\"}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<Plus className=\"h-4 w-4 text-muted-foreground shrink-0\" />\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{(suggestionGroups.length > 0 || loading) && <Separator />}\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{!loading && suggestionGroups.length === 0 && inputValue.trim().length >= 2 && !showCustomEmailOption && (\n\t\t\t\t\t\t\t<div className=\"px-3 py-4 text-center\">\n\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">No results found</p>\n\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground/70 mt-1\">\n\t\t\t\t\t\t\t\t\tType a valid email to add manually\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{/* Quick Actions when no search */}\n\t\t\t\t\t\t{!loading && inputValue.trim().length < 2 && suggestionGroups.length === 0 && (\n\t\t\t\t\t\t\t<div className=\"p-2\">\n\t\t\t\t\t\t\t\t<p className=\"px-2 py-1.5 text-[10px] font-medium text-muted-foreground/70 uppercase tracking-wider\">\n\t\t\t\t\t\t\t\t\tQuick Add\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<div className=\"space-y-0.5\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center gap-2 w-full px-2 py-2 text-sm text-left rounded-md hover:bg-accent transition-colors\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => inputRef.current?.focus()}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center h-8 w-8 rounded-full bg-blue-500/10\">\n\t\t\t\t\t\t\t\t\t\t\t<User className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">Search customers</span>\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Type to search your customers</p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<ChevronRight className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center gap-2 w-full px-2 py-2 text-sm text-left rounded-md hover:bg-accent transition-colors\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => inputRef.current?.focus()}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center h-8 w-8 rounded-full bg-purple-500/10\">\n\t\t\t\t\t\t\t\t\t\t\t<Building2 className=\"h-4 w-4 text-purple-600 dark:text-purple-400\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">Search vendors</span>\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Type to search your vendors</p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<ChevronRight className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{/* Suggestion Groups */}\n\t\t\t\t\t\t{!loading &&\n\t\t\t\t\t\t\tsuggestionGroups.map((group, groupIndex) => (\n\t\t\t\t\t\t\t\t<div key={group.id}>\n\t\t\t\t\t\t\t\t\t{groupIndex > 0 && <Separator />}\n\t\t\t\t\t\t\t\t\t<div className=\"p-1.5\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1 px-2 py-0.5 text-[10px] font-medium text-muted-foreground/70 uppercase tracking-wider\">\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"opacity-70\">{group.icon}</span>\n\t\t\t\t\t\t\t\t\t\t\t{group.label}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"space-y-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t{group.suggestions?.map((suggestion) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst flatIndex = flatSuggestions.findIndex(\n\t\t\t\t\t\t\t\t\t\t\t\t\t(s) => s.id === suggestion.id\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\tconst isSelected = flatIndex === selectedIndex;\n\n\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={suggestion.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => addRecipient(suggestion)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex items-center gap-2 w-full px-2 py-1.5 text-left rounded-md transition-colors\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisSelected ? \"bg-accent\" : \"hover:bg-accent/50\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Avatar className=\"h-7 w-7 shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarFallback className=\"text-[10px] bg-muted\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{suggestion.type === \"vendor\" ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Building2 className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : suggestion.type === \"custom\" ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Mail className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsuggestion.name\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.split(\" \")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.map((n) => n[0])\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.join(\"\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.toUpperCase()\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.slice(0, 2)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-medium truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{suggestion.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{suggestion.email}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{suggestion.subtitle && `  ${suggestion.subtitle}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Plus className=\"h-4 w-4 text-muted-foreground shrink-0\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t</ScrollArea>\n\n\t\t\t\t\t{/* Footer hint */}\n\t\t\t\t\t<div className=\"px-3 py-1.5 border-t border-border bg-muted/30\">\n\t\t\t\t\t\t<p className=\"text-[10px] text-muted-foreground\">\n\t\t\t\t\t\t\t<kbd className=\"px-1 py-0.5 rounded bg-muted text-[10px] font-mono\"></kbd> navigate\n\t\t\t\t\t\t\t<span className=\"mx-1.5\"></span>\n\t\t\t\t\t\t\t<kbd className=\"px-1 py-0.5 rounded bg-muted text-[10px] font-mono\">Enter</kbd> select\n\t\t\t\t\t\t\t<span className=\"mx-1.5\"></span>\n\t\t\t\t\t\t\t<kbd className=\"px-1 py-0.5 rounded bg-muted text-[10px] font-mono\">,</kbd> add email\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","\"use client\";\n\nimport { sendCustomerEmailAction } from \"@/actions/communications\";\nimport type { CompanyEmail } from \"@/actions/email-actions\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n\tBold,\n\tCalendar,\n\tChevronDown,\n\tChevronUp,\n\tClock,\n\tImageIcon,\n\tItalic,\n\tLink as LinkIcon,\n\tList,\n\tListOrdered,\n\tLoader2,\n\tMoreHorizontal,\n\tPaperclip,\n\tSend,\n\tSparkles,\n\tTrash2,\n\tUnderline,\n} from \"lucide-react\";\nimport { useCallback, useEffect, useMemo, useRef, useState, useTransition } from \"react\";\nimport {\n\textractFullEmailAddress,\n\tnormalizeEmailAddressList,\n} from \"@/lib/email/address-utils\";\nimport { cn } from \"@/lib/utils\";\nimport {\n\tRecipientAutocomplete,\n\ttype Recipient,\n} from \"@/components/communication/recipient-autocomplete\";\n\nexport type EmailReplyMode = \"reply\" | \"reply-all\" | \"forward\";\n\ntype EmailAttachment = {\n\tfilename: string;\n\tcontent: string; // Base64 encoded\n\tcontentType?: string;\n\tsize: number;\n};\n\nconst templateDefinitions = [\n\t{\n\t\tid: \"follow-up\",\n\t\tlabel: \"Friendly follow-up\",\n\t\tbody: \"Hi there,\\n\\nJust checking in  let me know if you have any questions or if you'd like to see anything else from my side.\\n\\nBest,\",\n\t},\n\t{\n\t\tid: \"thank-you\",\n\t\tlabel: \"Thank you note\",\n\t\tbody: \"Hi there,\\n\\nThanks again for your patience while we sorted this out. Let me know if there's anything else I can help with.\\n\\nWarm regards,\",\n\t},\n\t{\n\t\tid: \"next-steps\",\n\t\tlabel: \"Outline next steps\",\n\t\tbody: \"Hi there,\\n\\nI've outlined the next steps:\\n1. Review the details above.\\n2. Confirm when you'd like to move forward.\\n3. I'll lock everything in once you reply.\\n\\nLet me know if you want to adjust anything.\",\n\t},\n];\n\nconst signatureOptions = [\n\t{ id: \"none\", label: \"No signature\", value: \"\" },\n\t{ id: \"support\", label: \"Thorbis Support\", value: \"\\n\\nThanks,\\nThorbis Support Team\" },\n\t{ id: \"tech\", label: \"Technical Lead\", value: \"\\n\\nBest regards,\\nJordan  Technical Lead\" },\n];\n\ninterface EmailReplyComposerProps {\n\tmode: EmailReplyMode;\n\tselectedEmail: CompanyEmail | null;\n\tcompanyId: string | null;\n\tonClose: () => void;\n\tonSent?: (record: Record<string, unknown>) => void;\n\tclassName?: string;\n}\n\nexport function EmailReplyComposer({\n\tmode,\n\tselectedEmail,\n\tcompanyId,\n\tonClose,\n\tonSent,\n\tclassName,\n}: EmailReplyComposerProps) {\n\tconst { toast: toastApi } = useToast();\n\tconst textareaRef = useRef<HTMLTextAreaElement>(null);\n\tconst fileInputRef = useRef<HTMLInputElement>(null);\n\tconst [body, setBody] = useState(\"\");\n\tconst [isExpanded, setIsExpanded] = useState(false);\n\tconst [isSending, setIsSending] = useState(false);\n\tconst [signatureId, setSignatureId] = useState(\"support\");\n\tconst [showQuote, setShowQuote] = useState(false);\n\tconst [recipients, setRecipients] = useState<Recipient[]>([]);\n\tconst [ccRecipients, setCcRecipients] = useState<Recipient[]>([]);\n\tconst [bccRecipients, setBccRecipients] = useState<Recipient[]>([]);\n\tconst [showCc, setShowCc] = useState(false);\n\tconst [showBcc, setShowBcc] = useState(false);\n\tconst [subject, setSubject] = useState(\"\");\n\tconst [attachments, setAttachments] = useState<EmailAttachment[]>([]);\n\n\t// Schedule send state\n\tconst [scheduleOpen, setScheduleOpen] = useState(false);\n\tconst [scheduledDate, setScheduledDate] = useState<string>(\"\");\n\tconst [scheduledTime, setScheduledTime] = useState<string>(\"\");\n\n\t// Undo send state - 5 second delay before actually sending\n\tconst UNDO_SEND_DELAY = 5000; // 5 seconds\n\tconst [isPendingSend, setIsPendingSend] = useState(false);\n\tconst [undoCountdown, setUndoCountdown] = useState(5);\n\tconst sendTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\tconst countdownIntervalRef = useRef<NodeJS.Timeout | null>(null);\n\tconst pendingEmailDataRef = useRef<{\n\t\tto: string[];\n\t\tsubject: string;\n\t\tbody: string;\n\t\tcustomerName: string;\n\t\tcompanyId: string;\n\t\tcustomerId?: string;\n\t\tcc?: string[];\n\t\tbcc?: string[];\n\t\tattachments?: { filename: string; content: string; contentType?: string }[];\n\t} | null>(null);\n\n\tconst signature = useMemo(\n\t\t() => signatureOptions.find((opt) => opt.id === signatureId) ?? signatureOptions[0],\n\t\t[signatureId],\n\t);\n\n\t// Build all thread recipients (for suggestions)\n\tconst threadRecipients = useMemo<Recipient[]>(() => {\n\t\tif (!selectedEmail) return [];\n\n\t\tconst all: Recipient[] = [];\n\t\tconst seen = new Set<string>();\n\n\t\tconst add = (email: string, name?: string, type: Recipient[\"type\"] = \"custom\") => {\n\t\t\tconst lower = email.toLowerCase();\n\t\t\tif (email && email !== \"Unknown\" && !seen.has(lower)) {\n\t\t\t\tseen.add(lower);\n\t\t\t\tall.push({\n\t\t\t\t\tid: `thread-${email}`,\n\t\t\t\t\ttype,\n\t\t\t\t\tname: name || email,\n\t\t\t\t\temail,\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\t// From address\n\t\tconst fromAddress = extractFullEmailAddress(\n\t\t\tselectedEmail.from_address,\n\t\t\tselectedEmail.provider_metadata,\n\t\t\t\"from\",\n\t\t);\n\t\tadd(\n\t\t\tfromAddress,\n\t\t\tselectedEmail.customer?.display_name || selectedEmail.from_name || fromAddress,\n\t\t\tselectedEmail.customer_id ? \"customer\" : \"custom\"\n\t\t);\n\n\t\t// To addresses\n\t\tconst toAddresses = normalizeEmailAddressList(selectedEmail.to_address);\n\t\ttoAddresses.forEach((addr) => add(addr));\n\n\t\t// CC addresses if available\n\t\tif (selectedEmail.cc_address) {\n\t\t\tconst ccAddresses = normalizeEmailAddressList(selectedEmail.cc_address);\n\t\t\tccAddresses.forEach((addr) => add(addr));\n\t\t}\n\n\t\treturn all;\n\t}, [selectedEmail]);\n\n\t// Build default subject and initial recipients based on mode\n\tuseEffect(() => {\n\t\tif (!selectedEmail) return;\n\n\t\t// Subject\n\t\tconst base = selectedEmail.subject?.trim() || \"No subject\";\n\t\tconst prefix = mode === \"forward\" ? \"Fwd:\" : \"Re:\";\n\t\tconst newSubject = base.toLowerCase().startsWith(prefix.toLowerCase())\n\t\t\t? base\n\t\t\t: `${prefix} ${base}`;\n\t\tsetSubject(newSubject);\n\n\t\t// Recipients - based on reply mode\n\t\tconst fromAddress = extractFullEmailAddress(\n\t\t\tselectedEmail.from_address,\n\t\t\tselectedEmail.provider_metadata,\n\t\t\t\"from\",\n\t\t);\n\t\tconst toAddresses = normalizeEmailAddressList(selectedEmail.to_address);\n\t\tconst recipientMap = new Map<string, Recipient>();\n\n\t\tconst addRecipient = (email: string, name?: string, type: Recipient[\"type\"] = \"custom\") => {\n\t\t\tif (email && email !== \"Unknown\" && !recipientMap.has(email.toLowerCase())) {\n\t\t\t\trecipientMap.set(email.toLowerCase(), {\n\t\t\t\t\tid: `initial-${email}`,\n\t\t\t\t\ttype,\n\t\t\t\t\tname: name || email,\n\t\t\t\t\temail,\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tif (mode === \"reply\") {\n\t\t\t// Reply: only to sender\n\t\t\taddRecipient(\n\t\t\t\tfromAddress,\n\t\t\t\tselectedEmail.customer?.display_name || selectedEmail.from_name || fromAddress,\n\t\t\t\tselectedEmail.customer_id ? \"customer\" : \"custom\"\n\t\t\t);\n\t\t} else if (mode === \"reply-all\") {\n\t\t\t// Reply All: sender + all To + all CC\n\t\t\taddRecipient(\n\t\t\t\tfromAddress,\n\t\t\t\tselectedEmail.customer?.display_name || selectedEmail.from_name || fromAddress,\n\t\t\t\tselectedEmail.customer_id ? \"customer\" : \"custom\"\n\t\t\t);\n\t\t\ttoAddresses.forEach((addr) => addRecipient(addr));\n\t\t\tif (selectedEmail.cc_address) {\n\t\t\t\tconst ccAddresses = normalizeEmailAddressList(selectedEmail.cc_address);\n\t\t\t\tccAddresses.forEach((addr) => addRecipient(addr));\n\t\t\t}\n\t\t}\n\t\t// Forward: no initial recipients\n\n\t\tsetRecipients(Array.from(recipientMap.values()));\n\t}, [mode, selectedEmail]);\n\n\t// Auto-resize textarea\n\tconst handleInput = useCallback(() => {\n\t\tconst textarea = textareaRef.current;\n\t\tif (textarea) {\n\t\t\ttextarea.style.height = \"auto\";\n\t\t\ttextarea.style.height = `${Math.min(textarea.scrollHeight, 200)}px`;\n\t\t}\n\t}, []);\n\n\tuseEffect(() => {\n\t\thandleInput();\n\t}, [body, handleInput]);\n\n\t// Focus textarea on mount\n\tuseEffect(() => {\n\t\tsetTimeout(() => textareaRef.current?.focus(), 100);\n\t}, []);\n\n\tconst applyTemplate = (templateId: string) => {\n\t\tconst template = templateDefinitions.find((t) => t.id === templateId);\n\t\tif (template) {\n\t\t\tsetBody(template.body);\n\t\t}\n\t};\n\n\t// Actually send the email (called after undo timeout expires)\n\tconst executeSend = useCallback(async () => {\n\t\tconst emailData = pendingEmailDataRef.current;\n\t\tif (!emailData) return;\n\n\t\tsetIsSending(true);\n\t\tsetIsPendingSend(false);\n\n\t\ttry {\n\t\t\tconst result = await sendCustomerEmailAction(emailData);\n\n\t\t\tif (result.success) {\n\t\t\t\ttoastApi.success(\"Email sent successfully\");\n\t\t\t\tonSent?.(result.data ?? {});\n\t\t\t\tonClose();\n\t\t\t} else {\n\t\t\t\ttoastApi.error(result.error || \"Failed to send\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Send failed:\", error);\n\t\t\ttoastApi.error(error instanceof Error ? error.message : \"Failed to send\");\n\t\t} finally {\n\t\t\tsetIsSending(false);\n\t\t\tpendingEmailDataRef.current = null;\n\t\t}\n\t}, [toastApi, onSent, onClose]);\n\n\t// Cancel the pending send\n\tconst cancelSend = useCallback(() => {\n\t\tif (sendTimeoutRef.current) {\n\t\t\tclearTimeout(sendTimeoutRef.current);\n\t\t\tsendTimeoutRef.current = null;\n\t\t}\n\t\tif (countdownIntervalRef.current) {\n\t\t\tclearInterval(countdownIntervalRef.current);\n\t\t\tcountdownIntervalRef.current = null;\n\t\t}\n\t\tsetIsPendingSend(false);\n\t\tsetUndoCountdown(5);\n\t\tpendingEmailDataRef.current = null;\n\t\ttoastApi.success(\"Email cancelled - not sent\");\n\t}, [toastApi]);\n\n\t// Cleanup timeouts on unmount\n\tuseEffect(() => {\n\t\treturn () => {\n\t\t\tif (sendTimeoutRef.current) clearTimeout(sendTimeoutRef.current);\n\t\t\tif (countdownIntervalRef.current) clearInterval(countdownIntervalRef.current);\n\t\t};\n\t}, []);\n\n\t// Schedule send presets\n\tconst getSchedulePreset = (preset: \"tomorrow_morning\" | \"tomorrow_afternoon\" | \"monday_morning\") => {\n\t\tconst now = new Date();\n\t\tlet date: Date;\n\n\t\tswitch (preset) {\n\t\t\tcase \"tomorrow_morning\":\n\t\t\t\tdate = new Date(now);\n\t\t\t\tdate.setDate(date.getDate() + 1);\n\t\t\t\tdate.setHours(8, 0, 0, 0);\n\t\t\t\tbreak;\n\t\t\tcase \"tomorrow_afternoon\":\n\t\t\t\tdate = new Date(now);\n\t\t\t\tdate.setDate(date.getDate() + 1);\n\t\t\t\tdate.setHours(13, 0, 0, 0);\n\t\t\t\tbreak;\n\t\t\tcase \"monday_morning\":\n\t\t\t\tdate = new Date(now);\n\t\t\t\tconst dayOfWeek = date.getDay();\n\t\t\t\tconst daysUntilMonday = dayOfWeek === 0 ? 1 : (8 - dayOfWeek);\n\t\t\t\tdate.setDate(date.getDate() + daysUntilMonday);\n\t\t\t\tdate.setHours(8, 0, 0, 0);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn date;\n\t};\n\n\t// Handle schedule send\n\tconst handleScheduleSend = async (scheduledFor: Date) => {\n\t\tif (!selectedEmail || !companyId) {\n\t\t\ttoastApi.error(\"Unable to schedule - missing context\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst recipientList = recipients.map((r) => r.email).filter(Boolean);\n\n\t\tif (recipientList.length === 0) {\n\t\t\ttoastApi.error(\"Add at least one recipient\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (!body.trim()) {\n\t\t\ttoastApi.error(\"Please write a message\");\n\t\t\treturn;\n\t\t}\n\n\t\t// Validate scheduled time is in the future\n\t\tif (scheduledFor <= new Date()) {\n\t\t\ttoastApi.error(\"Schedule time must be in the future\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst finalBody = body + (signature?.value || \"\");\n\t\tconst firstCustomerRecipient = recipients.find((r) => r.type === \"customer\");\n\t\tconst ccList = ccRecipients.map((r) => r.email).filter(Boolean);\n\t\tconst bccList = bccRecipients.map((r) => r.email).filter(Boolean);\n\n\t\tsetIsSending(true);\n\n\t\ttry {\n\t\t\tconst result = await sendCustomerEmailAction({\n\t\t\t\tto: recipientList,\n\t\t\t\tsubject,\n\t\t\t\tbody: finalBody,\n\t\t\t\tcustomerName:\n\t\t\t\t\tfirstCustomerRecipient?.name ||\n\t\t\t\t\tselectedEmail.customer?.display_name ||\n\t\t\t\t\tselectedEmail.customer?.first_name ||\n\t\t\t\t\tselectedEmail.from_name ||\n\t\t\t\t\tselectedEmail.from_address ||\n\t\t\t\t\t\"Customer\",\n\t\t\t\tcompanyId,\n\t\t\t\tcustomerId: selectedEmail.customer_id ?? undefined,\n\t\t\t\tcc: ccList.length > 0 ? ccList : undefined,\n\t\t\t\tbcc: bccList.length > 0 ? bccList : undefined,\n\t\t\t\tattachments: attachments.length > 0 ? attachments.map(a => ({\n\t\t\t\t\tfilename: a.filename,\n\t\t\t\t\tcontent: a.content,\n\t\t\t\t\tcontentType: a.contentType,\n\t\t\t\t})) : undefined,\n\t\t\t\tscheduledFor: scheduledFor.toISOString(),\n\t\t\t});\n\n\t\t\tif (result.success) {\n\t\t\t\tconst formattedTime = scheduledFor.toLocaleString(\"en-US\", {\n\t\t\t\t\tweekday: \"short\",\n\t\t\t\t\tmonth: \"short\",\n\t\t\t\t\tday: \"numeric\",\n\t\t\t\t\thour: \"numeric\",\n\t\t\t\t\tminute: \"2-digit\",\n\t\t\t\t});\n\t\t\t\ttoastApi.success(`Email scheduled for ${formattedTime}`);\n\t\t\t\tonSent?.(result.data ?? {});\n\t\t\t\tonClose();\n\t\t\t} else {\n\t\t\t\ttoastApi.error(result.error || \"Failed to schedule email\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Schedule failed:\", error);\n\t\t\ttoastApi.error(error instanceof Error ? error.message : \"Failed to schedule\");\n\t\t} finally {\n\t\t\tsetIsSending(false);\n\t\t\tsetScheduleOpen(false);\n\t\t}\n\t};\n\n\t// Handle custom schedule\n\tconst handleCustomSchedule = () => {\n\t\tif (!scheduledDate || !scheduledTime) {\n\t\t\ttoastApi.error(\"Please select both date and time\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst scheduledFor = new Date(`${scheduledDate}T${scheduledTime}`);\n\t\thandleScheduleSend(scheduledFor);\n\t};\n\n\tconst handleSend = async () => {\n\t\tif (!selectedEmail || !companyId) {\n\t\t\ttoastApi.error(\"Unable to send - missing context\");\n\t\t\treturn;\n\t\t}\n\n\t\t// Extract email addresses from recipients\n\t\tconst recipientList = recipients.map((r) => r.email).filter(Boolean);\n\n\t\tif (recipientList.length === 0) {\n\t\t\ttoastApi.error(\"Add at least one recipient\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (!body.trim()) {\n\t\t\ttoastApi.error(\"Please write a message\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst finalBody = body + (signature?.value || \"\");\n\n\t\t// Get customer info from first recipient if it's a customer\n\t\tconst firstCustomerRecipient = recipients.find((r) => r.type === \"customer\");\n\n\t\t// Extract CC/BCC email addresses\n\t\tconst ccList = ccRecipients.map((r) => r.email).filter(Boolean);\n\t\tconst bccList = bccRecipients.map((r) => r.email).filter(Boolean);\n\n\t\t// Store email data for delayed send\n\t\tpendingEmailDataRef.current = {\n\t\t\tto: recipientList,\n\t\t\tsubject,\n\t\t\tbody: finalBody,\n\t\t\tcustomerName:\n\t\t\t\tfirstCustomerRecipient?.name ||\n\t\t\t\tselectedEmail.customer?.display_name ||\n\t\t\t\tselectedEmail.customer?.first_name ||\n\t\t\t\tselectedEmail.from_name ||\n\t\t\t\tselectedEmail.from_address ||\n\t\t\t\t\"Customer\",\n\t\t\tcompanyId,\n\t\t\tcustomerId: selectedEmail.customer_id ?? undefined,\n\t\t\tcc: ccList.length > 0 ? ccList : undefined,\n\t\t\tbcc: bccList.length > 0 ? bccList : undefined,\n\t\t\tattachments: attachments.length > 0 ? attachments.map(a => ({\n\t\t\t\tfilename: a.filename,\n\t\t\t\tcontent: a.content,\n\t\t\t\tcontentType: a.contentType,\n\t\t\t})) : undefined,\n\t\t};\n\n\t\t// Start undo countdown\n\t\tsetIsPendingSend(true);\n\t\tsetUndoCountdown(5);\n\n\t\t// Show toast with undo button\n\t\ttoastApi.info(\n\t\t\t<div className=\"flex items-center justify-between gap-4 w-full\">\n\t\t\t\t<span>Sending email in {5}s...</span>\n\t\t\t\t<button\n\t\t\t\t\tclassName=\"text-sm font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300\"\n\t\t\t\t\tonClick={() => cancelSend()}\n\t\t\t\t>\n\t\t\t\t\tUndo\n\t\t\t\t</button>\n\t\t\t</div>,\n\t\t\t{ duration: UNDO_SEND_DELAY + 500 }\n\t\t);\n\n\t\t// Start countdown interval for UI feedback\n\t\tlet countdown = 5;\n\t\tcountdownIntervalRef.current = setInterval(() => {\n\t\t\tcountdown--;\n\t\t\tsetUndoCountdown(countdown);\n\t\t\tif (countdown <= 0) {\n\t\t\t\tif (countdownIntervalRef.current) {\n\t\t\t\t\tclearInterval(countdownIntervalRef.current);\n\t\t\t\t\tcountdownIntervalRef.current = null;\n\t\t\t\t}\n\t\t\t}\n\t\t}, 1000);\n\n\t\t// Schedule actual send after delay\n\t\tsendTimeoutRef.current = setTimeout(() => {\n\t\t\tif (countdownIntervalRef.current) {\n\t\t\t\tclearInterval(countdownIntervalRef.current);\n\t\t\t\tcountdownIntervalRef.current = null;\n\t\t\t}\n\t\t\texecuteSend();\n\t\t}, UNDO_SEND_DELAY);\n\t};\n\n\tconst handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n\t\t// Cmd/Ctrl + Enter to send\n\t\tif (e.key === \"Enter\" && (e.metaKey || e.ctrlKey)) {\n\t\t\te.preventDefault();\n\t\t\thandleSend();\n\t\t}\n\t};\n\n\tconst handleFileSelect = useCallback(async (e: React.ChangeEvent<HTMLInputElement>) => {\n\t\tconst files = e.target.files;\n\t\tif (!files || files.length === 0) return;\n\n\t\tconst maxSize = 10 * 1024 * 1024; // 10MB per file\n\t\tconst newAttachments: EmailAttachment[] = [];\n\n\t\tfor (const file of Array.from(files)) {\n\t\t\tif (file.size > maxSize) {\n\t\t\t\ttoastApi.error(`File \"${file.name}\" is too large (max 10MB)`);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst content = await new Promise<string>((resolve, reject) => {\n\t\t\t\t\tconst reader = new FileReader();\n\t\t\t\t\treader.onload = () => {\n\t\t\t\t\t\tconst base64 = (reader.result as string).split(\",\")[1];\n\t\t\t\t\t\tresolve(base64);\n\t\t\t\t\t};\n\t\t\t\t\treader.onerror = reject;\n\t\t\t\t\treader.readAsDataURL(file);\n\t\t\t\t});\n\n\t\t\t\tnewAttachments.push({\n\t\t\t\t\tfilename: file.name,\n\t\t\t\t\tcontent,\n\t\t\t\t\tcontentType: file.type,\n\t\t\t\t\tsize: file.size,\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\ttoastApi.error(`Failed to read file \"${file.name}\"`);\n\t\t\t}\n\t\t}\n\n\t\tif (newAttachments.length > 0) {\n\t\t\tsetAttachments((prev) => [...prev, ...newAttachments]);\n\t\t}\n\n\t\t// Reset file input\n\t\tif (fileInputRef.current) {\n\t\t\tfileInputRef.current.value = \"\";\n\t\t}\n\t}, [toastApi]);\n\n\tconst removeAttachment = useCallback((filename: string) => {\n\t\tsetAttachments((prev) => prev.filter((a) => a.filename !== filename));\n\t}, []);\n\n\tconst formatFileSize = (bytes: number) => {\n\t\tif (bytes < 1024) return `${bytes} B`;\n\t\tif (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n\t\treturn `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n\t};\n\n\tconst quoteText = useMemo(() => {\n\t\tif (!selectedEmail) return \"\";\n\t\tconst fromName =\n\t\t\tselectedEmail.customer?.display_name ||\n\t\t\tselectedEmail.from_name ||\n\t\t\tselectedEmail.from_address ||\n\t\t\t\"Unknown\";\n\t\tconst date = new Date(selectedEmail.created_at).toLocaleString(\"en-US\", {\n\t\t\tmonth: \"short\",\n\t\t\tday: \"numeric\",\n\t\t\thour: \"numeric\",\n\t\t\tminute: \"2-digit\",\n\t\t});\n\t\treturn `On ${date}, ${fromName} wrote:\\n${selectedEmail.body || \"\"}`;\n\t}, [selectedEmail]);\n\n\t// Smart reply suggestions based on email content\n\tconst smartReplies = useMemo(() => {\n\t\tif (!selectedEmail?.body && !selectedEmail?.subject) return [];\n\n\t\tconst emailContent = `${selectedEmail.subject || \"\"} ${selectedEmail.body || \"\"}`.toLowerCase();\n\t\tconst suggestions: string[] = [];\n\n\t\t// Questions - suggest answers\n\t\tif (emailContent.includes(\"?\") || emailContent.includes(\"when\") || emailContent.includes(\"can you\")) {\n\t\t\tif (emailContent.includes(\"schedule\") || emailContent.includes(\"appointment\") || emailContent.includes(\"when\")) {\n\t\t\t\tsuggestions.push(\"Yes, I can schedule that. What time works best for you?\");\n\t\t\t\tsuggestions.push(\"Let me check our availability and get back to you shortly.\");\n\t\t\t}\n\t\t\tif (emailContent.includes(\"price\") || emailContent.includes(\"cost\") || emailContent.includes(\"quote\")) {\n\t\t\t\tsuggestions.push(\"I'll prepare a quote for you and send it over shortly.\");\n\t\t\t\tsuggestions.push(\"The pricing depends on a few factors. Could you provide more details?\");\n\t\t\t}\n\t\t\tif (emailContent.includes(\"available\") || emailContent.includes(\"free\")) {\n\t\t\t\tsuggestions.push(\"Yes, I'm available. When would you like to meet?\");\n\t\t\t\tsuggestions.push(\"Let me check my schedule and get back to you.\");\n\t\t\t}\n\t\t}\n\n\t\t// Thank you messages\n\t\tif (emailContent.includes(\"thank\") || emailContent.includes(\"thanks\") || emailContent.includes(\"appreciate\")) {\n\t\t\tsuggestions.push(\"You're welcome! Let me know if you need anything else.\");\n\t\t\tsuggestions.push(\"Happy to help! Don't hesitate to reach out.\");\n\t\t}\n\n\t\t// Confirmation requests\n\t\tif (emailContent.includes(\"confirm\") || emailContent.includes(\"let me know\")) {\n\t\t\tsuggestions.push(\"Confirmed! I'll proceed as discussed.\");\n\t\t\tsuggestions.push(\"Got it, thanks for confirming.\");\n\t\t}\n\n\t\t// Urgent / ASAP\n\t\tif (emailContent.includes(\"urgent\") || emailContent.includes(\"asap\") || emailContent.includes(\"emergency\")) {\n\t\t\tsuggestions.push(\"I understand the urgency. I'm on it right now.\");\n\t\t\tsuggestions.push(\"I'll prioritize this and get back to you shortly.\");\n\t\t}\n\n\t\t// Invoice / Payment related\n\t\tif (emailContent.includes(\"invoice\") || emailContent.includes(\"payment\") || emailContent.includes(\"bill\")) {\n\t\t\tsuggestions.push(\"I'll send the invoice right away.\");\n\t\t\tsuggestions.push(\"Thank you for the payment confirmation.\");\n\t\t}\n\n\t\t// Default fallbacks if no specific matches\n\t\tif (suggestions.length === 0) {\n\t\t\tsuggestions.push(\"Thanks for reaching out. I'll get back to you shortly.\");\n\t\t\tsuggestions.push(\"Got it, thanks for the update.\");\n\t\t\tsuggestions.push(\"I'll look into this and follow up.\");\n\t\t}\n\n\t\t// Return max 3 suggestions\n\t\treturn suggestions.slice(0, 3);\n\t}, [selectedEmail]);\n\n\t// Apply smart reply to body\n\tconst applySmartReply = (suggestion: string) => {\n\t\tsetBody(suggestion);\n\t\ttextareaRef.current?.focus();\n\t};\n\n\tif (!selectedEmail) return null;\n\n\treturn (\n\t\t<TooltipProvider>\n\t\t\t<div\n\t\t\t\tclassName={cn(\n\t\t\t\t\t\"w-full overflow-hidden rounded-xl border border-border bg-background shadow-sm transition-all duration-200\",\n\t\t\t\t\t\"focus-within:border-primary/50 focus-within:shadow-md\",\n\t\t\t\t\tclassName,\n\t\t\t\t)}\n\t\t\t>\n\t\t\t\t{/* Collapsed Header - Click to expand recipients/subject */}\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tonClick={() => setIsExpanded(!isExpanded)}\n\t\t\t\t\tclassName=\"flex w-full items-center justify-between gap-2 px-3 py-2 text-left hover:bg-muted/50 transition-colors\"\n\t\t\t\t>\n\t\t\t\t\t<div className=\"flex items-center gap-2 min-w-0 flex-1\">\n\t\t\t\t\t\t<span className=\"text-xs font-medium text-muted-foreground uppercase tracking-wide shrink-0\">\n\t\t\t\t\t\t\t{mode === \"forward\" ? \"Forward\" : \"Reply\"}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span className=\"text-sm text-foreground truncate\">\n\t\t\t\t\t\t\t{recipients.length > 0\n\t\t\t\t\t\t\t\t? recipients.map((r) => r.name).join(\", \")\n\t\t\t\t\t\t\t\t: \"Add recipients...\"}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t{isExpanded ? (\n\t\t\t\t\t\t<ChevronUp className=\"h-4 w-4 text-muted-foreground shrink-0\" />\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<ChevronDown className=\"h-4 w-4 text-muted-foreground shrink-0\" />\n\t\t\t\t\t)}\n\t\t\t\t</button>\n\n\t\t\t\t{/* Expanded Recipients/Subject */}\n\t\t\t\t{isExpanded && (\n\t\t\t\t\t<div className=\"border-t border-border/50 px-3 py-2 space-y-2 bg-muted/30\">\n\t\t\t\t\t\t<div className=\"flex items-start gap-2\">\n\t\t\t\t\t\t\t<span className=\"text-xs font-medium text-muted-foreground w-12 pt-2\">To:</span>\n\t\t\t\t\t\t\t<RecipientAutocomplete\n\t\t\t\t\t\t\t\tvalue={recipients}\n\t\t\t\t\t\t\t\tonChange={setRecipients}\n\t\t\t\t\t\t\t\tplaceholder=\"Search customers, vendors, or type email...\"\n\t\t\t\t\t\t\t\trecentRecipients={threadRecipients}\n\t\t\t\t\t\t\t\tclassName=\"flex-1\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-1 pt-1.5\">\n\t\t\t\t\t\t\t\t{!showCc && (\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => setShowCc(true)}\n\t\t\t\t\t\t\t\t\t\tclassName=\"text-xs text-muted-foreground hover:text-foreground px-1.5 py-0.5 rounded hover:bg-muted transition-colors\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tCc\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{!showBcc && (\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => setShowBcc(true)}\n\t\t\t\t\t\t\t\t\t\tclassName=\"text-xs text-muted-foreground hover:text-foreground px-1.5 py-0.5 rounded hover:bg-muted transition-colors\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tBcc\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{showCc && (\n\t\t\t\t\t\t\t<div className=\"flex items-start gap-2\">\n\t\t\t\t\t\t\t\t<span className=\"text-xs font-medium text-muted-foreground w-12 pt-2\">Cc:</span>\n\t\t\t\t\t\t\t\t<RecipientAutocomplete\n\t\t\t\t\t\t\t\t\tvalue={ccRecipients}\n\t\t\t\t\t\t\t\t\tonChange={setCcRecipients}\n\t\t\t\t\t\t\t\t\tplaceholder=\"Add Cc recipients...\"\n\t\t\t\t\t\t\t\t\trecentRecipients={threadRecipients}\n\t\t\t\t\t\t\t\t\tclassName=\"flex-1\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\tsetShowCc(false);\n\t\t\t\t\t\t\t\t\t\tsetCcRecipients([]);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tclassName=\"text-xs text-muted-foreground hover:text-destructive pt-2\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{showBcc && (\n\t\t\t\t\t\t\t<div className=\"flex items-start gap-2\">\n\t\t\t\t\t\t\t\t<span className=\"text-xs font-medium text-muted-foreground w-12 pt-2\">Bcc:</span>\n\t\t\t\t\t\t\t\t<RecipientAutocomplete\n\t\t\t\t\t\t\t\t\tvalue={bccRecipients}\n\t\t\t\t\t\t\t\t\tonChange={setBccRecipients}\n\t\t\t\t\t\t\t\t\tplaceholder=\"Add Bcc recipients...\"\n\t\t\t\t\t\t\t\t\trecentRecipients={threadRecipients}\n\t\t\t\t\t\t\t\t\tclassName=\"flex-1\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\tsetShowBcc(false);\n\t\t\t\t\t\t\t\t\t\tsetBccRecipients([]);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tclassName=\"text-xs text-muted-foreground hover:text-destructive pt-2\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<span className=\"text-xs font-medium text-muted-foreground w-12\">Subject:</span>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\tvalue={subject}\n\t\t\t\t\t\t\t\tonChange={(e) => setSubject(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"Subject\"\n\t\t\t\t\t\t\t\tclassName=\"flex-1 bg-transparent text-base md:text-sm outline-none placeholder:text-muted-foreground\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\n\t\t\t\t{/* Smart Reply Suggestions */}\n\t\t\t\t{smartReplies.length > 0 && !body && (\n\t\t\t\t\t<div className=\"px-3 py-2 border-b border-border/50\">\n\t\t\t\t\t\t<div className=\"flex items-center gap-1.5 flex-wrap\">\n\t\t\t\t\t\t\t<Sparkles className=\"h-3.5 w-3.5 text-muted-foreground shrink-0\" />\n\t\t\t\t\t\t\t{smartReplies.map((suggestion, index) => (\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tonClick={() => applySmartReply(suggestion)}\n\t\t\t\t\t\t\t\t\tclassName=\"text-xs px-2.5 py-1 rounded-full border border-border bg-muted/50 hover:bg-muted hover:border-primary/50 transition-colors truncate max-w-[200px]\"\n\t\t\t\t\t\t\t\t\ttitle={suggestion}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{suggestion.length > 40 ? `${suggestion.slice(0, 40)}...` : suggestion}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\n\t\t\t\t{/* Message Body */}\n\t\t\t\t<div className=\"px-3 py-2\">\n\t\t\t\t\t<textarea\n\t\t\t\t\t\tref={textareaRef}\n\t\t\t\t\t\tvalue={body}\n\t\t\t\t\t\tonChange={(e) => setBody(e.target.value)}\n\t\t\t\t\t\tonInput={handleInput}\n\t\t\t\t\t\tonKeyDown={handleKeyDown}\n\t\t\t\t\t\tplaceholder=\"Write your reply...\"\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"w-full resize-none bg-transparent outline-none\",\n\t\t\t\t\t\t\t\"text-base md:text-sm\", // 16px on mobile to prevent iOS zoom\n\t\t\t\t\t\t\t\"placeholder:text-muted-foreground\",\n\t\t\t\t\t\t\t\"min-h-[80px] max-h-[200px]\",\n\t\t\t\t\t\t)}\n\t\t\t\t\t\trows={3}\n\t\t\t\t\t/>\n\n\t\t\t\t\t{/* Signature Preview - Always visible */}\n\t\t\t\t\t{signature.value && (\n\t\t\t\t\t\t<div className=\"mt-2 pt-2 border-t border-dashed border-border/50\">\n\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground mb-1 flex items-center justify-between\">\n\t\t\t\t\t\t\t\t<span>Signature</span>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tonClick={() => setSignatureId(\"none\")}\n\t\t\t\t\t\t\t\t\tclassName=\"text-[10px] hover:text-foreground transition-colors\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tRemove\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"text-sm text-muted-foreground whitespace-pre-wrap\">\n\t\t\t\t\t\t\t\t{signature.value.trim()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{/* Quoted Text Toggle */}\n\t\t\t\t{selectedEmail.body && (\n\t\t\t\t\t<div className=\"px-3 pb-2\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tonClick={() => setShowQuote(!showQuote)}\n\t\t\t\t\t\t\tclassName=\"text-xs text-muted-foreground hover:text-foreground flex items-center gap-1\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<MoreHorizontal className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t{showQuote ? \"Hide\" : \"Show\"} quoted text\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{showQuote && (\n\t\t\t\t\t\t\t<div className=\"mt-2 pl-3 border-l-2 border-muted text-xs text-muted-foreground whitespace-pre-wrap max-h-[100px] overflow-y-auto\">\n\t\t\t\t\t\t\t\t{quoteText}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\n\t\t\t\t{/* Attachments Display */}\n\t\t\t\t{attachments.length > 0 && (\n\t\t\t\t\t<div className=\"px-3 py-2 border-t border-border/50 bg-muted/20\">\n\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\n\t\t\t\t\t\t\t{attachments.map((attachment) => (\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tkey={attachment.filename}\n\t\t\t\t\t\t\t\t\tclassName=\"flex items-center gap-1.5 px-2 py-1 bg-background border rounded-md text-xs\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Paperclip className=\"h-3 w-3 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t<span className=\"max-w-[120px] truncate\">{attachment.filename}</span>\n\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">({formatFileSize(attachment.size)})</span>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => removeAttachment(attachment.filename)}\n\t\t\t\t\t\t\t\t\t\tclassName=\"ml-1 text-muted-foreground hover:text-destructive\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\n\t\t\t\t{/* Hidden file input */}\n\t\t\t\t<input\n\t\t\t\t\tref={fileInputRef}\n\t\t\t\t\ttype=\"file\"\n\t\t\t\t\tmultiple\n\t\t\t\t\tclassName=\"hidden\"\n\t\t\t\t\tonChange={handleFileSelect}\n\t\t\t\t\taccept=\"*/*\"\n\t\t\t\t/>\n\n\t\t\t\t{/* Footer Toolbar */}\n\t\t\t\t<div className=\"flex items-center justify-between gap-1 border-t border-border/50 px-2 py-1.5 bg-muted/30\">\n\t\t\t\t\t<div className=\"flex items-center gap-0.5\">\n\t\t\t\t\t\t{/* Attachments */}\n\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\tclassName=\"h-7 w-7 p-0\"\n\t\t\t\t\t\t\t\t\tonClick={() => fileInputRef.current?.click()}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Paperclip className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent side=\"top\">Attach file</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t{/* Image */}\n\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" className=\"h-7 w-7 p-0\">\n\t\t\t\t\t\t\t\t\t<ImageIcon className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent side=\"top\">Insert image</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t{/* Link */}\n\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" className=\"h-7 w-7 p-0\">\n\t\t\t\t\t\t\t\t\t<LinkIcon className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent side=\"top\">Insert link</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t<div className=\"w-px h-4 bg-border mx-1\" />\n\n\t\t\t\t\t\t{/* Formatting Dropdown */}\n\t\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 gap-1\">\n\t\t\t\t\t\t\t\t\t<Bold className=\"h-3.5 w-3.5 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t<ChevronDown className=\"h-3 w-3 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t\t<DropdownMenuContent align=\"start\" className=\"w-40\">\n\t\t\t\t\t\t\t\t<DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t<Bold className=\"h-4 w-4 mr-2\" /> Bold\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t<Italic className=\"h-4 w-4 mr-2\" /> Italic\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t<Underline className=\"h-4 w-4 mr-2\" /> Underline\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t<DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t<List className=\"h-4 w-4 mr-2\" /> Bullet list\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t<DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t<ListOrdered className=\"h-4 w-4 mr-2\" /> Numbered list\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t\t</DropdownMenu>\n\n\t\t\t\t\t\t{/* Templates & More */}\n\t\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 gap-1\">\n\t\t\t\t\t\t\t\t\t<Sparkles className=\"h-3.5 w-3.5 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground hidden sm:inline\">Templates</span>\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t\t<DropdownMenuContent align=\"start\" className=\"w-48\">\n\t\t\t\t\t\t\t\t{templateDefinitions.map((template) => (\n\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\tkey={template.id}\n\t\t\t\t\t\t\t\t\t\tonClick={() => applyTemplate(template.id)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{template.label}\n\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t<DropdownMenuItem className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\tSignature: {signature.label}\n\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t{signatureOptions.map((opt) => (\n\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\tkey={opt.id}\n\t\t\t\t\t\t\t\t\t\tonClick={() => setSignatureId(opt.id)}\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"pl-6\",\n\t\t\t\t\t\t\t\t\t\t\tsignatureId === opt.id && \"font-medium text-primary\",\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{opt.label}\n\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t\t</DropdownMenu>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t{/* Discard */}\n\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\tclassName=\"h-7 w-7 p-0 text-muted-foreground hover:text-destructive\"\n\t\t\t\t\t\t\t\t\tonClick={onClose}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Trash2 className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent side=\"top\">Discard</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t{/* Send Button with Schedule Option */}\n\t\t\t\t\t\t{isPendingSend ? (\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\tclassName=\"h-7 px-3 gap-1.5 rounded-full bg-amber-500 hover:bg-amber-600\"\n\t\t\t\t\t\t\t\tonClick={cancelSend}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span className=\"text-xs font-medium\">Undo ({undoCountdown}s)</span>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<div className=\"flex items-center\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\tclassName=\"h-7 px-3 gap-1.5 rounded-l-full rounded-r-none\"\n\t\t\t\t\t\t\t\t\tonClick={handleSend}\n\t\t\t\t\t\t\t\t\tdisabled={isSending || !body.trim()}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{isSending ? (\n\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-3.5 w-3.5 animate-spin\" />\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<Send className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t<span className=\"text-xs font-medium\">Send</span>\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t<Popover open={scheduleOpen} onOpenChange={setScheduleOpen}>\n\t\t\t\t\t\t\t\t\t<PopoverTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-7 px-1.5 rounded-l-none rounded-r-full border-l border-primary-foreground/20\"\n\t\t\t\t\t\t\t\t\t\t\tdisabled={isSending || !body.trim()}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<ChevronDown className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t</PopoverTrigger>\n\t\t\t\t\t\t\t\t\t<PopoverContent className=\"w-72 p-2\" align=\"end\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs font-medium text-muted-foreground px-2 py-1\">\n\t\t\t\t\t\t\t\t\t\t\t\tSchedule send\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"space-y-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full justify-start h-8 text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleScheduleSend(getSchedulePreset(\"tomorrow_morning\"))}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Clock className=\"h-3.5 w-3.5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tTomorrow morning (8:00 AM)\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full justify-start h-8 text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleScheduleSend(getSchedulePreset(\"tomorrow_afternoon\"))}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Clock className=\"h-3.5 w-3.5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tTomorrow afternoon (1:00 PM)\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full justify-start h-8 text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleScheduleSend(getSchedulePreset(\"monday_morning\"))}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Calendar className=\"h-3.5 w-3.5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tMonday morning (8:00 AM)\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"border-t border-border pt-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs font-medium text-muted-foreground px-2 py-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tPick date & time\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2 px-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"schedule-date\" className=\"sr-only\">Date</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"schedule-date\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={scheduledDate}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => setScheduledDate(e.target.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmin={new Date().toISOString().split(\"T\")[0]}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"schedule-time\" className=\"sr-only\">Time</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"schedule-time\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"time\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={scheduledTime}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => setScheduledTime(e.target.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full mt-2 h-8 text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={handleCustomSchedule}\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={!scheduledDate || !scheduledTime}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Clock className=\"h-3.5 w-3.5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tSchedule\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</PopoverContent>\n\t\t\t\t\t\t\t\t</Popover>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Keyboard shortcut hint */}\n\t\t\t\t<div className=\"px-3 pb-1.5 text-[10px] text-muted-foreground/60 text-right\">\n\t\t\t\t\t + Enter to send\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</TooltipProvider>\n\t);\n}\n","const extractEmailFromFormat = (str: string): string => {\n\tconst emailMatch = str.match(/<([^>]+)>/);\n\tif (emailMatch && emailMatch[1]) {\n\t\treturn emailMatch[1].trim();\n\t}\n\tif (str.includes(\"@\") && str.length > 3) {\n\t\treturn str.trim();\n\t}\n\treturn str.trim();\n};\n\nfunction normalizeArray(value: unknown): string[] {\n\tif (!value) return [];\n\tif (Array.isArray(value)) {\n\t\treturn value\n\t\t\t.map((item) => (typeof item === \"string\" ? item.trim() : \"\"))\n\t\t\t.filter(Boolean);\n\t}\n\tif (typeof value === \"string\") {\n\t\tconst trimmed = value.trim();\n\t\tif (!trimmed) return [];\n\t\tif (trimmed.startsWith(\"[\") && trimmed.endsWith(\"]\")) {\n\t\t\ttry {\n\t\t\t\tconst parsed = JSON.parse(trimmed);\n\t\t\t\tif (Array.isArray(parsed)) {\n\t\t\t\t\treturn parsed\n\t\t\t\t\t\t.map((item) => (typeof item === \"string\" ? item.trim() : \"\"))\n\t\t\t\t\t\t.filter(Boolean);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\t// fall back to comma-separated parsing\n\t\t\t}\n\t\t}\n\t\treturn trimmed\n\t\t\t.split(/[;,]+/)\n\t\t\t.map((item) => item.trim())\n\t\t\t.filter(Boolean);\n\t}\n\treturn [];\n}\n\nfunction getFromProviderMetadata(\n\tproviderMetadata?: Record<string, unknown> | null,\n\tmetadataKey?: string,\n): string | null {\n\tif (!providerMetadata || !metadataKey) return null;\n\tconst metadataValue = providerMetadata[metadataKey];\n\tif (!metadataValue) return null;\n\tif (typeof metadataValue === \"string\" && metadataValue.includes(\"@\")) {\n\t\treturn extractEmailFromFormat(metadataValue);\n\t}\n\tif (typeof metadataValue === \"object\") {\n\t\tconst data = (metadataValue as any).data;\n\t\tif (data && metadataKey && data[metadataKey]) {\n\t\t\treturn extractEmailFromFormat(data[metadataKey]);\n\t\t}\n\t}\n\treturn null;\n}\n\nexport function extractFullEmailAddress(\n\tvalue: unknown,\n\tproviderMetadata?: Record<string, unknown> | null,\n\tmetadataKey?: string,\n): string {\n\tif (typeof value === \"string\" && value.length > 0) {\n\t\tconst extracted = extractEmailFromFormat(value);\n\t\tif (extracted.length > 1 && extracted.includes(\"@\")) {\n\t\t\treturn extracted;\n\t\t}\n\t}\n\n\tif (Array.isArray(value) && value.length > 0) {\n\t\tconst first = value[0];\n\t\tif (typeof first === \"string\" && first.length > 0) {\n\t\t\tconst extracted = extractEmailFromFormat(first);\n\t\t\tif (extracted.length > 1 && extracted.includes(\"@\")) {\n\t\t\t\treturn extracted;\n\t\t\t}\n\t\t}\n\t\tif (first && typeof first === \"object\" && \"email\" in first) {\n\t\t\tconst email = (first as { email?: string }).email;\n\t\t\tif (email && typeof email === \"string\" && email.length > 0) {\n\t\t\t\treturn extractEmailFromFormat(email);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (value && typeof value === \"object\" && !Array.isArray(value)) {\n\t\tconst obj = value as Record<string, unknown>;\n\t\tif (\"email\" in obj && typeof obj.email === \"string\" && obj.email.length > 0) {\n\t\t\treturn extractEmailFromFormat(obj.email);\n\t\t}\n\t}\n\n\tconst fallback = getFromProviderMetadata(providerMetadata, metadataKey);\n\tif (fallback) return fallback;\n\n\treturn \"Unknown\";\n}\n\nexport function normalizeEmailAddressList(\n\tvalue: string | string[] | null | undefined,\n): string[] {\n\treturn normalizeArray(value);\n}\n"],"names":[],"mappings":"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"}