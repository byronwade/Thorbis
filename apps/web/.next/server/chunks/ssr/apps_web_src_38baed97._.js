module.exports=[255227,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call JobHelpFooter() from the server but JobHelpFooter is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/job-details/job-help-footer.tsx <module evaluation>","JobHelpFooter");a.s(["JobHelpFooter",0,b])},478541,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call JobHelpFooter() from the server but JobHelpFooter is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/job-details/job-help-footer.tsx","JobHelpFooter");a.s(["JobHelpFooter",0,b])},713073,a=>{"use strict";a.i(255227);var b=a.i(478541);a.n(b)},504937,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call JobPageContent() from the server but JobPageContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/job-details/job-page-content.tsx <module evaluation>","JobPageContent");a.s(["JobPageContent",0,b])},637926,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call JobPageContent() from the server but JobPageContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/job-details/job-page-content.tsx","JobPageContent");a.s(["JobPageContent",0,b])},80436,a=>{"use strict";a.i(504937);var b=a.i(637926);a.n(b)},728013,a=>{"use strict";let b;var c=a.i(504348);a.i(692167);var d=a.i(852596),e=a.i(429969),f=a.i(670078);a.i(416128);var g=a.i(109483),h=a.i(713073),i=a.i(80436);a.i(467361);var j=a.i(445074),k=a.i(136874);let l=(0,e.cache)(async(a,b)=>{let c=await (0,k.createClient)();if(!c)return{success:!1,error:"No supabase client",data:null};try{let{data:d,error:e}=await c.rpc("get_job_complete",{p_job_id:a,p_company_id:b}).single();if(e)return console.error("Error fetching job complete:",e),console.error("Error details:",JSON.stringify(e,null,2)),console.error("Job ID:",a,"Company ID:",b),{success:!1,error:e.message||"Failed to fetch job data",data:null};return{success:!0,data:{job:d.job,customer:d.customer,property:d.property,invoices:d.invoices||[],estimates:d.estimates||[],payments:d.payments||[],purchaseOrders:d.purchase_orders||[],appointments:d.appointments||[],customerNotes:d.customer_notes||[],teamAssignments:d.team_assignments||[],timeEntries:d.time_entries||[],tasks:d.tasks||[],jobEquipment:d.job_equipment||[],jobNotes:d.job_notes||[]},error:null}}catch(a){return console.error("Unexpected error in getJobComplete:",a),{success:!1,error:a instanceof Error?a.message:"Unknown error",data:null}}});(0,e.cache)(async(a,b)=>{let c=await (0,k.createClient)();return c?await c.from("appointments").select("*").eq("job_id",a).eq("company_id",b).is("deleted_at",null).order("start_time",{ascending:!1}).limit(100):{data:null,error:Error("No supabase client")}}),(0,e.cache)(async(a,b)=>{let c=await (0,k.createClient)();return c?await c.from("invoices").select("*").eq("job_id",a).eq("company_id",b).order("created_at",{ascending:!1}).limit(100):{data:null,error:Error("No supabase client")}}),(0,e.cache)(async(a,b)=>{let c=await (0,k.createClient)();return c?await c.from("estimates").select("*").eq("job_id",a).eq("company_id",b).order("created_at",{ascending:!1}).limit(100):{data:null,error:Error("No supabase client")}}),(0,e.cache)(async(a,b)=>{let c=await (0,k.createClient)();return c?await c.from("payments").select("*").eq("job_id",a).eq("company_id",b).order("created_at",{ascending:!1}).limit(100):{data:null,error:Error("No supabase client")}}),(0,e.cache)(async(a,b)=>{let c=await (0,k.createClient)();return c?await c.from("purchase_orders").select("*").eq("job_id",a).eq("company_id",b).order("created_at",{ascending:!1}).limit(100):{data:null,error:Error("No supabase client")}}),(0,e.cache)(async(a,b)=>{let c=await (0,k.createClient)();return c?await c.from("job_activity_log").select(`
			*,
			user:users!job_activity_log_user_id_fkey (
				id,
				raw_user_meta_data
			)
		`).eq("job_id",a).eq("company_id",b).order("created_at",{ascending:!1}).limit(50):{data:null,error:Error("No supabase client")}}),(0,e.cache)(async(a,b)=>{let c=await (0,k.createClient)();return c?await c.from("job_notes").select("*").eq("job_id",a).eq("company_id",b).is("deleted_at",null).order("created_at",{ascending:!1}).limit(100):{data:null,error:Error("No supabase client")}}),(0,e.cache)(async(a,b)=>{let c=await (0,k.createClient)();return c?await c.from("customer_notes").select("*").eq("customer_id",a).eq("company_id",b).is("deleted_at",null).order("created_at",{ascending:!1}).limit(100):{data:null,error:Error("No supabase client")}}),(0,e.cache)(async(a,b)=>{let c=await (0,k.createClient)();if(!c)return[];let{data:d}=await c.from("appointments").select("*").eq("job_id",a).eq("company_id",b).is("deleted_at",null).order("start_time",{ascending:!1}).limit(100),e=d||[];if(e.length>0){let a=e.map(a=>a.id),[b,d,f]=await Promise.all([c.from("appointment_team_assignments").select(`
					id,
					appointment_id,
					role,
					team_member:team_members!appointment_team_assignments_team_member_id_fkey (
						id,
						user_id,
						role
					)
				`).in("appointment_id",a),c.from("appointment_equipment").select(`
					id,
					appointment_id,
					notes,
					equipment:equipment!appointment_equipment_equipment_id_fkey (
						id,
						name,
						serial_number,
						type
					)
				`).in("appointment_id",a),c.from("profiles").select("id, full_name, email, avatar_url").in("id",e.map(a=>a.assigned_to).filter(Boolean))]),g=(b.data||[]).map(a=>a.team_member?.user_id).filter(Boolean),h=new Map;if(g.length>0){let{data:a}=await c.from("profiles").select("id, full_name, email, avatar_url").in("id",g);(a||[]).forEach(a=>{h.set(a.id,a)})}let i=new Map;(b.data||[]).forEach(a=>{i.has(a.appointment_id)||i.set(a.appointment_id,[]);let b=a.team_member?h.get(a.team_member.user_id):null,c=b?{id:a.id,name:b.name||b.email||"Unknown",email:b.email,avatar:b.avatar,role:a.role}:null;c&&i.get(a.appointment_id).push(c)});let j=new Map;(d.data||[]).forEach(a=>{j.has(a.appointment_id)||j.set(a.appointment_id,[]),j.get(a.appointment_id).push(a)});let k=new Map;(f.data||[]).forEach(a=>{k.set(a.id,a)}),e=e.map(a=>({...a,team_members:i.get(a.id)||[],equipment:j.get(a.id)||[],assigned_user:a.assigned_to?k.get(a.assigned_to):null}))}return e});var m=a.i(933427),n=a.i(146057);let o=n.z.object({job_id:n.z.string().uuid(),company_id:n.z.string().uuid(),total_amount:n.z.number().int().default(0),paid_amount:n.z.number().int().default(0),deposit_amount:n.z.number().int().default(0),deposit_paid_at:n.z.date().optional().nullable(),payment_terms:n.z.string().max(200).optional().nullable(),payment_due_date:n.z.date().optional().nullable(),invoice_generated_at:n.z.date().optional().nullable()});o.partial().omit({job_id:!0,company_id:!0});let p=o.extend({id:n.z.string().uuid(),created_at:n.z.date(),updated_at:n.z.date()}),q=n.z.object({job_id:n.z.string().uuid(),company_id:n.z.string().uuid(),template_id:n.z.string().uuid().optional().nullable(),workflow_stage:n.z.string().max(100).optional().nullable(),workflow_completed_stages:n.z.array(n.z.any()).default([]),workflow_stage_changed_at:n.z.date().optional().nullable()});q.partial().omit({job_id:!0,company_id:!0});let r=q.extend({id:n.z.string().uuid(),created_at:n.z.date(),updated_at:n.z.date()}),s=n.z.object({job_id:n.z.string().uuid(),company_id:n.z.string().uuid(),technician_clock_in:n.z.date().optional().nullable(),technician_clock_out:n.z.date().optional().nullable(),actual_start:n.z.date().optional().nullable(),actual_end:n.z.date().optional().nullable(),total_labor_hours:n.z.number().default(0),estimated_labor_hours:n.z.number().optional().nullable(),break_time_minutes:n.z.number().int().default(0)});s.partial().omit({job_id:!0,company_id:!0});let t=s.extend({id:n.z.string().uuid(),created_at:n.z.date(),updated_at:n.z.date()}),u=n.z.object({job_id:n.z.string().uuid(),company_id:n.z.string().uuid(),customer_signature:n.z.any().optional().nullable(),customer_approval_status:n.z.enum(["pending","approved","rejected"]).default("pending"),customer_approval_timestamp:n.z.date().optional().nullable(),customer_notes:n.z.string().optional().nullable()});u.partial().omit({job_id:!0,company_id:!0});let v=u.extend({id:n.z.string().uuid(),created_at:n.z.date(),updated_at:n.z.date()}),w=n.z.object({job_id:n.z.string().uuid(),company_id:n.z.string().uuid(),primary_equipment_id:n.z.string().uuid().optional().nullable(),equipment_service_history:n.z.array(n.z.any()).default([]),equipment_serviced:n.z.array(n.z.any()).default([]),job_warranty_info:n.z.any().optional().nullable(),job_service_agreement_id:n.z.string().uuid().optional().nullable(),job_recurrence_id:n.z.string().uuid().optional().nullable()});w.partial().omit({job_id:!0,company_id:!0});let x=w.extend({id:n.z.string().uuid(),created_at:n.z.date(),updated_at:n.z.date()}),y=n.z.object({job_id:n.z.string().uuid(),company_id:n.z.string().uuid(),dispatch_zone:n.z.string().max(100).optional().nullable(),travel_time_minutes:n.z.number().int().optional().nullable(),route_order:n.z.number().int().optional().nullable(),previous_job_id:n.z.string().uuid().optional().nullable(),next_job_id:n.z.string().uuid().optional().nullable()});y.partial().omit({job_id:!0,company_id:!0});let z=y.extend({id:n.z.string().uuid(),created_at:n.z.date(),updated_at:n.z.date()}),A=n.z.object({job_id:n.z.string().uuid(),company_id:n.z.string().uuid(),inspection_required:n.z.boolean().default(!1),inspection_completed_at:n.z.date().optional().nullable(),quality_score:n.z.number().int().min(0).max(100).optional().nullable(),customer_satisfaction_rating:n.z.number().int().min(1).max(5).optional().nullable(),quality_notes:n.z.string().optional().nullable(),internal_priority_score:n.z.number().int().optional().nullable()});A.partial().omit({job_id:!0,company_id:!0});let B=A.extend({id:n.z.string().uuid(),created_at:n.z.date(),updated_at:n.z.date()}),C=n.z.object({job_id:n.z.string().uuid(),company_id:n.z.string().uuid(),requires_permit:n.z.boolean().default(!1),permit_obtained_at:n.z.date().optional().nullable(),hazards_identified:n.z.string().optional().nullable(),safety_notes:n.z.string().optional().nullable()});C.partial().omit({job_id:!0,company_id:!0});let D=C.extend({id:n.z.string().uuid(),created_at:n.z.date(),updated_at:n.z.date()}),E=n.z.object({job_id:n.z.string().uuid(),company_id:n.z.string().uuid(),ai_categories:n.z.any().optional().nullable(),ai_equipment:n.z.any().optional().nullable(),ai_service_type:n.z.string().optional().nullable(),ai_priority_score:n.z.number().int().optional().nullable(),ai_tags:n.z.any().optional().nullable(),ai_processed_at:n.z.date().optional().nullable()});E.partial().omit({job_id:!0,company_id:!0});let F=E.extend({id:n.z.string().uuid(),created_at:n.z.date(),updated_at:n.z.date()}),G=n.z.object({job_id:n.z.string().uuid(),company_id:n.z.string().uuid(),primary_customer_id:n.z.string().uuid().optional().nullable(),primary_property_id:n.z.string().uuid().optional().nullable(),requires_multiple_properties:n.z.boolean().default(!1),requires_multiple_customers:n.z.boolean().default(!1),deleted_by:n.z.string().uuid().optional().nullable(),permanent_delete_scheduled_at:n.z.date().optional().nullable()});G.partial().omit({job_id:!0,company_id:!0});let H=G.extend({id:n.z.string().uuid(),created_at:n.z.date(),updated_at:n.z.date()});n.z.object({id:n.z.string().uuid(),company_id:n.z.string().uuid(),job_number:n.z.string(),title:n.z.string(),description:n.z.string().nullable(),status:n.z.enum(["quoted","scheduled","in_progress","on_hold","completed","cancelled","archived"]),priority:n.z.enum(["low","medium","high","urgent"]),job_type:n.z.string().nullable(),service_type:n.z.string().nullable(),property_id:n.z.string().uuid().nullable(),customer_id:n.z.string().uuid().nullable(),assigned_to:n.z.string().uuid().nullable(),scheduled_start:n.z.date().nullable(),scheduled_end:n.z.date().nullable(),notes:n.z.string().nullable(),metadata:n.z.any().nullable(),created_at:n.z.date(),updated_at:n.z.date(),deleted_at:n.z.date().nullable(),archived_at:n.z.date().nullable(),search_vector:n.z.any().nullable(),financial:p.optional().nullable(),workflow:r.optional().nullable(),timeTracking:t.optional().nullable(),customerApproval:v.optional().nullable(),equipmentService:x.optional().nullable(),dispatch:z.optional().nullable(),quality:B.optional().nullable(),safety:D.optional().nullable(),aiEnrichment:F.optional().nullable(),multiEntity:H.optional().nullable()});let I=(b={financial:"financial:job_financial(*)",workflow:"workflow:job_workflow(*)",timeTracking:"timeTracking:job_time_tracking(*)",customerApproval:"customerApproval:job_customer_approval(*)",equipmentService:"equipmentService:job_equipment_service(*)",dispatch:"dispatch:job_dispatch(*)",quality:"quality:job_quality(*)",safety:"safety:job_safety(*)",aiEnrichment:"aiEnrichment:job_ai_enrichment(*)",multiEntity:"multiEntity:job_multi_entity(*)"},["*",...["financial","workflow","timeTracking","customerApproval","equipmentService","dispatch","quality","safety","aiEnrichment","multiEntity"].map(a=>b[a])].join(", ")),J=[{key:"financial",table:"job_financial"},{key:"workflow",table:"job_workflow"},{key:"timeTracking",table:"job_time_tracking"},{key:"customerApproval",table:"job_customer_approval"},{key:"equipmentService",table:"job_equipment_service"},{key:"dispatch",table:"job_dispatch"},{key:"quality",table:"job_quality"},{key:"safety",table:"job_safety"},{key:"aiEnrichment",table:"job_ai_enrichment"},{key:"multiEntity",table:"job_multi_entity"}];function K(a){return a?Array.isArray(a)?a[0]??null:a:null}function L(a){let b=K(a.financial??a.job_financial)??null,c=K(a.timeTracking??a.job_time_tracking)??null,d=K(a.workflow??a.job_workflow)??null,e=K(a.quality??a.job_quality)??null,f=K(a.dispatch??a.job_dispatch)??null,g=K(a.safety??a.job_safety)??null,h=K(a.customerApproval??a.job_customer_approval)??null,i=K(a.equipmentService??a.job_equipment_service)??null,j=K(a.aiEnrichment??a.job_ai_enrichment)??null,k=K(a.multiEntity??a.job_multi_entity)??null;return{...a,financial:b,timeTracking:c,workflow:d,quality:e,dispatch:f,safety:g,customerApproval:h,equipmentService:i,aiEnrichment:j,multiEntity:k,total_amount:b?.total_amount??a.total_amount??a.job_financial?.[0]?.total_amount??null,paid_amount:b?.paid_amount??a.paid_amount??a.job_financial?.[0]?.paid_amount??null,estimated_labor_hours:c?.estimated_labor_hours??a.estimated_labor_hours??a.job_time_tracking?.[0]?.estimated_labor_hours??null,actual_labor_hours:c?.total_labor_hours??c?.actual_labor_hours??a.actual_labor_hours??a.total_labor_hours??null,workflow_stage:d?.workflow_stage??a.workflow_stage??a.job_workflow?.[0]?.workflow_stage??null,priority_score:e?.internal_priority_score??a.priority_score??a.job_quality?.[0]?.internal_priority_score??null,ai_categories:j?.ai_categories??a.ai_categories??a.job_ai_enrichment?.[0]?.ai_categories??null}}async function M(a,b,c){let d=await Promise.all(J.map(async({key:d,table:e})=>{let{data:f,error:g}=await a.from(e).select("*").eq("job_id",b).eq("company_id",c).maybeSingle();return{key:d,data:f??null,error:g||null}})),e={},f=[];for(let a of d)e[a.key]=a.data,a.error&&f.push({key:a.key,error:a.error});return{data:e,errors:f}}let N=(0,e.cache)(async a=>{try{let b=await (0,k.createClient)();if(!b)return{success:!1,error:"Database client not initialized"};let c=await (0,j.getActiveCompanyId)();if(!c)return{success:!1,error:"No active company found"};let{data:d,error:e}=await b.from("jobs").select("*").eq("id",a).eq("company_id",c).is("deleted_at",null).maybeSingle();if(e)return console.error("Error fetching core job:",{jobId:a,companyId:c,error:e}),{success:!1,error:e.message||"Failed to fetch job"};if(!d)return console.warn("Job not found:",{jobId:a,companyId:c}),{success:!1,error:"Job not found"};let{data:f,error:g}=await b.from("jobs").select(`
				${I},
				customer:customers!customer_id(id, first_name, last_name, email, phone, display_name, company_name),
				property:properties!property_id(id, address, city, state, zip_code, customer_id)
			`).eq("id",a).eq("company_id",c).is("deleted_at",null).maybeSingle(),h=f??null,i=g??null;if(!h){let b=await (0,m.createServiceSupabaseClient)();if(b){let{data:d,error:e}=await b.from("jobs").select(`
						${I},
						customer:customers!customer_id(id, first_name, last_name, email, phone, display_name, company_name),
						property:properties!property_id(id, address, city, state, zip_code, customer_id)
					`).eq("id",a).eq("company_id",c).is("deleted_at",null).maybeSingle();d?(h=d,i=null):e&&(i=e)}}if(!h){let{data:e,errors:f}=await M(b,a,c);f.length>0&&(i=i??f[0]?.error??null);let[g,j]=await Promise.all([d.customer_id?b.from("customers").select("id, first_name, last_name, email, phone, display_name, company_name").eq("id",d.customer_id).maybeSingle():{data:null},d.property_id?b.from("properties").select("id, address, city, state, zip_code, customer_id").eq("id",d.property_id).maybeSingle():{data:null}]);h={...d,...e,customer:g.data,property:j.data}}if(h)return{success:!0,data:L(h)};return i&&console.error("Error fetching job with domains:",{jobId:a,error:i,errorMessage:i?.message,errorCode:i?.code,errorDetails:i?.details,errorHint:i?.hint,selectQuery:I}),{success:!0,data:L(d)}}catch(a){return console.error("Unexpected error in getJob:",a),{success:!1,error:a instanceof Error?a.message:"Unknown error occurred"}}});function O(){return(0,c.jsxs)("div",{className:"space-y-3",children:[(0,c.jsx)(g.Skeleton,{className:"h-8 w-full"}),(0,c.jsx)(g.Skeleton,{className:"h-24 w-full"}),(0,c.jsx)(g.Skeleton,{className:"h-24 w-full"})]})}async function P({jobId:a}){let b=await (0,j.getActiveCompanyId)();if(!b)return(0,d.notFound)();let[e,g,h]=await Promise.all([l(a,b),N(a),(0,f.getAvailableTeamMembers)()]);if(!e.success&&(console.error("Failed to load job complete data:",e.error),!g.success||!g.data)||!g.success||!g.data)return(0,d.notFound)();let k=h.success&&Array.isArray(h.data)?h.data:[];h.success||console.error("Failed to load available team members:",h.error);let m=(e.data?.teamAssignments||[]).map(a=>{let c=a.team_member,d=c?.user,e=d?{id:d.id,email:d.email,first_name:d.name?.split(" ")[0]||"",last_name:d.name?.split(" ").slice(1).join(" ")||"",avatar_url:d.avatar,phone:d.phone,name:d.name||d.email,raw_user_meta_data:{first_name:d.name?.split(" ")[0]||"",last_name:d.name?.split(" ").slice(1).join(" ")||"",avatar_url:d.avatar}}:null,f=c?{id:c.id,user_id:c.user_id,job_title:c.job_title,company_id:b,status:c.status??"active",user:e,users:e?[e]:[]}:null;return{...a,jobId:a.job_id,job_id:a.job_id,team_member_id:a.team_member_id,assigned_at:a.assigned_at,assigned_by:a.assigned_by,team_member:f}}),n={job:g.data,customer:e.data?.customer??g.data.customer??null,property:e.data?.property??g.data.property??null,schedules:e.data?.appointments||[],invoices:e.data?.invoices||[],estimates:e.data?.estimates||[],payments:e.data?.payments||[],purchaseOrders:e.data?.purchaseOrders||[],activities:[],customerNotes:e.data?.customerNotes||[],jobNotes:e.data?.jobNotes||[],jobEquipment:e.data?.jobEquipment||[],teamAssignments:m,availableTeamMembers:k},o=function(a){let{job:b,invoices:c=[],estimates:d=[],payments:e=[],purchaseOrders:f=[],timeEntries:g=[],tasks:h=[],financial:i}=a,j=new Date,k=new Date(b.created_at),l=new Date(b.updated_at),m={financial:{totalRevenue:0,collectedRevenue:0,outstandingRevenue:0,estimatedRevenue:0,convertedEstimateRevenue:0,totalCosts:0,laborCosts:0,materialCosts:0,netProfit:0,profitMargin:0,depositCollected:0,balanceDue:0},time:{totalHoursLogged:0,billableHours:0,nonBillableHours:0,overtimeHours:0,estimatedHours:0,actualHours:0,hoursVariance:0,hoursVariancePercent:0,averageHourlyRate:0,activeClockedInHours:0},completion:{overallProgress:0,tasksTotal:h.length,tasksCompleted:0,tasksInProgress:0,tasksPending:0,isOverdue:!1,daysOverdue:0,estimatedCompletionDate:null,daysSinceCreated:0,daysSinceLastUpdate:0},status:{jobStatus:b.status,priority:b.priority,hasOpenInvoices:!1,hasPendingEstimates:!1,hasActivePurchaseOrders:!1,isFullyPaid:!1,requiresAction:!1},performance:{revenuePerHour:0,costPerHour:0,profitPerHour:0,estimateAccuracy:0,invoiceConversionRate:0,collectionRate:0,efficiency:0},summary:{health:"good",healthScore:0,alerts:[],warnings:[]}};m.financial.totalRevenue=c.reduce((a,b)=>a+(b.total_amount||0),0),m.financial.balanceDue=c.reduce((a,b)=>a+(b.balance_amount||0),0),m.financial.collectedRevenue=e.filter(a=>"completed"===a.status||"succeeded"===a.status).reduce((a,b)=>a+(b.amount||0),0),m.financial.outstandingRevenue=m.financial.totalRevenue-m.financial.collectedRevenue;let n=d.filter(a=>"pending"===a.status||"sent"===a.status);m.financial.estimatedRevenue=n.reduce((a,b)=>a+(b.total_amount||0),0);let o=d.filter(a=>a.converted_at);if(m.financial.convertedEstimateRevenue=o.reduce((a,b)=>a+(b.total_amount||0),0),m.financial.materialCosts=f.filter(a=>"cancelled"!==a.status).reduce((a,b)=>a+(b.total_amount||0),0),g.forEach(a=>{let b=a.total_hours||0,c=a.hourly_rate||0;if(m.financial.laborCosts+=b*c,!a.clock_out){let b=new Date(a.clock_in),c=(j.getTime()-b.getTime())/36e5;m.time.activeClockedInHours+=c}}),m.financial.totalCosts=m.financial.laborCosts+m.financial.materialCosts,m.financial.netProfit=m.financial.totalRevenue-m.financial.totalCosts,m.financial.profitMargin=m.financial.totalRevenue>0?m.financial.netProfit/m.financial.totalRevenue*100:0,i?.deposit_amount&&(m.financial.depositCollected=i.deposit_amount),g.forEach(a=>{let b=a.total_hours||0;m.time.totalHoursLogged+=b,a.is_billable?m.time.billableHours+=b:m.time.nonBillableHours+=b,a.is_overtime&&(m.time.overtimeHours+=b)}),h.forEach(a=>{m.time.estimatedHours+=a.estimated_hours||0,m.time.actualHours+=a.actual_hours||0}),m.time.hoursVariance=m.time.estimatedHours-m.time.actualHours,m.time.hoursVariancePercent=m.time.estimatedHours>0?m.time.hoursVariance/m.time.estimatedHours*100:0,m.time.averageHourlyRate=m.time.totalHoursLogged>0?m.financial.laborCosts/m.time.totalHoursLogged:0,h.forEach(a=>{"completed"===a.status||"done"===a.status?m.completion.tasksCompleted++:"in_progress"===a.status?m.completion.tasksInProgress++:m.completion.tasksPending++}),m.completion.overallProgress=h.length>0?m.completion.tasksCompleted/h.length*100:0,b.scheduled_end){let a=new Date(b.scheduled_end);j>a&&"completed"!==b.status&&(m.completion.isOverdue=!0,m.completion.daysOverdue=Math.ceil((j.getTime()-a.getTime())/864e5))}if(m.completion.daysSinceCreated=Math.floor((j.getTime()-k.getTime())/864e5),m.completion.daysSinceLastUpdate=Math.floor((j.getTime()-l.getTime())/864e5),m.status.hasOpenInvoices=c.some(a=>"paid"!==a.status&&a.balance_amount>0),m.status.hasPendingEstimates=d.some(a=>"pending"===a.status),m.status.hasActivePurchaseOrders=f.some(a=>"pending"===a.status||"ordered"===a.status),m.status.isFullyPaid=m.financial.totalRevenue>0&&0===m.financial.balanceDue,m.performance.revenuePerHour=m.time.totalHoursLogged>0?m.financial.totalRevenue/m.time.totalHoursLogged:0,m.performance.costPerHour=m.time.totalHoursLogged>0?m.financial.totalCosts/m.time.totalHoursLogged:0,m.performance.profitPerHour=m.time.totalHoursLogged>0?m.financial.netProfit/m.time.totalHoursLogged:0,m.time.estimatedHours>0&&m.time.actualHours>0){let a=100-Math.abs(m.time.estimatedHours-m.time.actualHours)/m.time.estimatedHours*100;m.performance.estimateAccuracy=Math.max(0,Math.min(100,a))}if(d.length>0){let a=d.filter(a=>a.converted_at).length;m.performance.invoiceConversionRate=a/d.length*100}m.financial.totalRevenue>0&&(m.performance.collectionRate=m.financial.collectedRevenue/m.financial.totalRevenue*100),m.time.estimatedHours>0&&m.time.actualHours>0&&(m.performance.efficiency=Math.min(100,m.time.estimatedHours/m.time.actualHours*100));let p=100,q=[],r=[];if(m.completion.isOverdue&&m.completion.daysOverdue>7?(q.push(`Job is ${m.completion.daysOverdue} days overdue`),p-=20):m.completion.isOverdue&&(r.push(`Job is ${m.completion.daysOverdue} days overdue`),p-=10),m.financial.profitMargin<0?(q.push(`Job is unprofitable (${m.financial.profitMargin.toFixed(1)}% margin)`),p-=25):m.financial.profitMargin<10&&(r.push(`Low profit margin (${m.financial.profitMargin.toFixed(1)}%)`),p-=10),m.status.hasOpenInvoices&&m.financial.balanceDue>0){let a=m.completion.daysSinceLastUpdate;a>30?(q.push(`Outstanding balance of $${(m.financial.balanceDue/100).toFixed(2)} for ${a} days`),p-=15):a>14&&(r.push(`Outstanding balance of $${(m.financial.balanceDue/100).toFixed(2)}`),p-=5)}return m.time.hoursVariancePercent>50&&m.time.actualHours>0&&(r.push(`Hours exceeded estimate by ${m.time.hoursVariancePercent.toFixed(0)}%`),p-=10),m.completion.daysSinceLastUpdate>14&&"completed"!==b.status&&(r.push(`No updates in ${m.completion.daysSinceLastUpdate} days`),p-=5),m.time.activeClockedInHours>0&&r.push(`Active time entry: ${m.time.activeClockedInHours.toFixed(1)} hours clocked in`),p=Math.max(0,Math.min(100,p)),m.summary.healthScore=p,p>=90?m.summary.health="excellent":p>=75?m.summary.health="good":p>=60?m.summary.health="fair":p>=40?m.summary.health="poor":m.summary.health="critical",m.summary.alerts=q,m.summary.warnings=r,m.status.requiresAction=q.length>0,m}({job:g.data,invoices:e.data?.invoices||[],estimates:e.data?.estimates||[],payments:e.data?.payments||[],purchaseOrders:e.data?.purchaseOrders||[],timeEntries:e.data?.timeEntries||[],tasks:e.data?.tasks||[]});return(0,c.jsx)(i.JobPageContent,{entityData:n,jobData:n,metrics:o})}async function Q({params:a}){let{id:b}=await a;return{title:"Job Details"}}async function R({params:a}){let{id:b}=await a;return(0,c.jsxs)("div",{className:"flex h-full w-full flex-col",children:[(0,c.jsx)("div",{className:"flex-1",children:(0,c.jsx)(e.Suspense,{fallback:(0,c.jsxs)("div",{className:"space-y-6 p-6",children:[(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsx)(g.Skeleton,{className:"h-10 w-64"}),(0,c.jsxs)("div",{className:"flex gap-4",children:[(0,c.jsx)(g.Skeleton,{className:"h-20 w-48"}),(0,c.jsx)(g.Skeleton,{className:"h-20 w-48"}),(0,c.jsx)(g.Skeleton,{className:"h-20 w-48"})]})]}),(0,c.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,c.jsx)(O,{}),(0,c.jsx)(O,{})]}),(0,c.jsxs)("div",{className:"grid gap-6",children:[(0,c.jsx)(O,{}),(0,c.jsx)(O,{})]})]}),children:(0,c.jsx)(P,{jobId:b})})}),(0,c.jsx)(h.JobHelpFooter,{})]})}a.s(["default",()=>R,"generateMetadata",()=>Q],728013)}];

//# sourceMappingURL=apps_web_src_38baed97._.js.map