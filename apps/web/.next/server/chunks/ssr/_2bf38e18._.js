module.exports=[311487,a=>{"use strict";async function b(a,b,c,d){let{data:e,error:f}=await a.rpc("has_role",{user_uuid:b,required_role:c,company_uuid:d});return!f&&!0===e}async function c(a,b,c){let{data:d,error:e}=await a.rpc("get_user_role",{user_uuid:b,company_uuid:c});return e?null:d}async function d(a,b,c,d){let{data:e,error:f}=await a.rpc("has_permission",{user_uuid:b,permission_key:c,company_uuid:d});return!f&&!0===e}async function e(a,b,c){let{data:d,error:e}=await a.rpc("is_company_owner",{user_uuid:b,company_uuid:c});return!e&&!0===d}a.s(["getUserRole",()=>c,"hasPermission",()=>d,"hasRole",()=>b,"isCompanyOwner",()=>e])},997053,a=>{"use strict";a.i(311487),a.s([])},288344,a=>{"use strict";var b=a.i(780195);a.i(218188);var c=a.i(146057);a.i(467361);var d=a.i(445074);a.i(997053);var e=a.i(311487),f=a.i(974406),g=a.i(136874),h=a.i(395731);async function i(){return(0,f.withErrorHandling)(async()=>{let a=await (0,g.createClient)();if(!a)throw Error("Database connection not available");let{data:{user:b}}=await a.auth.getUser();if(!b)throw Error("Not authenticated");let c=await (0,d.getActiveCompanyId)();if(!c)throw Error("No active company");return await (0,e.getUserRole)(a,b.id,c)})}async function j(a){return(0,f.withErrorHandling)(async()=>{let b=await (0,g.createClient)();if(!b)throw Error("Database connection not available");let c=await (0,d.getActiveCompanyId)();if(!c)throw Error("No active company");let{data:e,error:f}=await b.from("company_memberships").select("user_id, role").eq("id",a).eq("company_id",c).single();if(f||!e)throw Error("Team member not found");let{data:h}=await b.from("companies").select("owner_id").eq("id",c).single();return h&&h.owner_id===e.user_id?{canDelete:!1,reason:"Cannot delete company owner. Transfer ownership first before removing this team member."}:{canDelete:!0}})}c.z.object({teamMemberId:c.z.string().uuid(),newRole:c.z.enum(["owner","admin","manager","dispatcher","technician","csr"]),reason:c.z.string().optional()}),c.z.object({teamMemberId:c.z.string().uuid(),permissions:c.z.record(c.z.string(),c.z.boolean())}),(0,h.ensureServerEntryExports)([i,j]),(0,b.registerServerReference)(i,"001f005176797ef23488068124fb9a744915a477de",null),(0,b.registerServerReference)(j,"406f6624261c6dd1a908026fa1408a3f6d507b6e7d",null),a.s(["canDeleteTeamMember",()=>j,"getCurrentUserRole",()=>i])},538271,140621,a=>{"use strict";let b={debug:0,info:1,warn:2,error:3},c=process.env.TELNYX_LOG_LEVEL||"info",d=["phone","phoneNumber","phone_number","from","to","fromNumber","toNumber","from_number","to_number","apiKey","api_key","authToken","auth_token","password","secret","token"];function e(a){let b=a.replace(/\D/g,"");return b.length<4?"****":`***${b.slice(-4)}`}function f(a){let[b,c]=a.split("@");if(!c)return"***@***";let d=b.length>2?`${b[0]}***${b[b.length-1]}`:"***";return`${d}@${c}`}class g{parent;context;constructor(a,b){this.parent=a,this.context=b}debug(a,b){this.parent.debug(a,{...this.context,...b})}info(a,b){this.parent.info(a,{...this.context,...b})}warn(a,b){this.parent.warn(a,{...this.context,...b})}error(a,b){this.parent.error(a,{...this.context,...b})}}let h=new class{service="telnyx";defaultContext={};setDefaultContext(a){this.defaultContext={...this.defaultContext,...a}}clearDefaultContext(){this.defaultContext={}}shouldLog(a){return b[a]>=b[c]}log(a,b,c){if(!this.shouldLog(a))return;let g={timestamp:new Date().toISOString(),level:a,service:this.service,message:b},h={...this.defaultContext,...c};Object.keys(h).length>0&&(g.context=function a(b,c=0){if(c>10)return"[MAX_DEPTH]";if(null==b)return b;if("string"==typeof b)return b.replace(/\+?1?\d{10,15}/g,a=>e(a)).replace(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,a=>f(a));if("number"==typeof b||"boolean"==typeof b)return b;if(Array.isArray(b))return b.map(b=>a(b,c+1));if("object"==typeof b){let g={};for(let[h,i]of Object.entries(b))d.some(a=>h.toLowerCase().includes(a.toLowerCase()))?"string"==typeof i?i.includes("@")?g[h]=f(i):/\d/.test(i)?g[h]=e(i):g[h]="[REDACTED]":g[h]="[REDACTED]":g[h]=a(i,c+1);return g}return b}(h));{let b=JSON.stringify(g);switch(a){case"error":console.error(b);break;case"warn":console.warn(b)}}}debug(a,b){this.log("debug",a,b)}info(a,b){this.log("info",a,b)}warn(a,b){this.log("warn",a,b)}error(a,b){this.log("error",a,b)}child(a){return new g(this,a)}logRequestStart(a,b,c){let d=c?.correlationId||`tlx_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,e=Date.now();return this.debug(`${a} ${b} started`,{...c,correlationId:d,endpoint:b}),{correlationId:d,startTime:e}}logRequestEnd(a,b,c,d,e){let f=Date.now()-d;(c>=400?this.warn.bind(this):this.info.bind(this))(`${a} ${b} completed`,{...e,endpoint:b,statusCode:c,latencyMs:f})}logRequestError(a,b,c,d,e){let f=Date.now()-d;this.error(`${a} ${b} failed`,{...e,endpoint:b,error:c.message,latencyMs:f})}};a.s(["telnyxLogger",0,h],538271);let i={maxRetries:5,baseDelayMs:1e3,maxDelayMs:32e3,jitterFactor:.3,retryableStatusCodes:[408,429,500,502,503,504],retryableErrorCodes:["ECONNRESET","ETIMEDOUT","ECONNREFUSED","EPIPE","ENOTFOUND","ENETUNREACH","EAI_AGAIN"]},j={failureThreshold:5,resetTimeoutMs:6e4,halfOpenRequests:3},k=new Map;function l(a){return k.has(a)||k.set(a,{state:"closed",failures:0,lastFailureTime:0,halfOpenSuccesses:0,halfOpenFailures:0}),k.get(a)}function m(a,b,c=j){let d=l(a),e=Date.now();b?"half-open"===d.state?(d.halfOpenSuccesses++,d.halfOpenSuccesses>=c.halfOpenRequests&&(d.state="closed",d.failures=0,d.halfOpenSuccesses=0,d.halfOpenFailures=0,h.info("Circuit breaker closed",{endpoint:a}))):"closed"===d.state&&(d.failures=0):(d.lastFailureTime=e,"half-open"===d.state?(d.halfOpenFailures++,d.state="open",d.halfOpenSuccesses=0,d.halfOpenFailures=0,h.warn("Circuit breaker reopened",{endpoint:a})):"closed"===d.state&&(d.failures++,d.failures>=c.failureThreshold&&(d.state="open",h.error("Circuit breaker opened",{endpoint:a,failures:d.failures}))))}function n(a,b){let c=Error(a);return c.name="RetryError",c.statusCode=b.statusCode,c.errorCode=b.errorCode,c.retryable=b.retryable,c.attempts=b.attempts,c.lastError=b.lastError,c}function o(a){return new Promise(b=>setTimeout(b,a))}async function p(a,b={}){let c,d={...i,...b.config},e={...j,...b.circuitBreakerConfig},f=b.endpoint||"default",g=b.correlationId||q();if(!function(a,b=j){let c=l(a),d=Date.now();return"closed"===c.state||"open"!==c.state||d-c.lastFailureTime>=b.resetTimeoutMs&&(c.state="half-open",c.halfOpenSuccesses=0,c.halfOpenFailures=0,h.info("Circuit breaker half-open",{endpoint:a}),!0)}(f,e)){let a=n(`Circuit breaker open for endpoint: ${f}`,{retryable:!1,attempts:0});throw h.warn("Request blocked by circuit breaker",{endpoint:f,correlationId:g}),a}let k=0;for(;k<=d.maxRetries;)try{let b=await a();return m(f,!0,e),k>0&&h.info("Request succeeded after retry",{endpoint:f,attempt:k,correlationId:g}),b}catch(l){c=l instanceof Error?l:Error(String(l));let a=function(a,b=i){if(!a)return!1;if(a instanceof Error){let c=a.code;if(c&&b.retryableErrorCodes.includes(c)||a.message.includes("fetch failed")||a.message.includes("network")||a.message.includes("timeout")||a.message.includes("ECONNRESET"))return!0}if("object"==typeof a&&null!==a){let c=a.statusCode||a.status;if(c&&b.retryableStatusCodes.includes(c))return!0}return!1}(l,d);if(h.warn("Request failed",{endpoint:f,attempt:k,retryable:a,error:c.message,correlationId:g}),m(f,!1,e),!a||k>=d.maxRetries)throw n(`Request failed after ${k+1} attempt(s): ${c.message}`,{retryable:a,attempts:k+1,lastError:c,statusCode:l.statusCode,errorCode:l.code});let j=function(a,b=i){let c=Math.min(b.baseDelayMs*Math.pow(2,a),b.maxDelayMs),d=c*b.jitterFactor*Math.random();return Math.floor(c+d)}(k,d);if("object"==typeof l&&null!==l&&"response"in l){let a=l.response;if(a){let b=function(a){let b=a.headers.get("Retry-After");if(!b)return null;let c=parseInt(b,10);if(!isNaN(c))return 1e3*c;let d=Date.parse(b);return isNaN(d)?null:Math.max(0,d-Date.now())}(a);b&&(j=Math.min(b,d.maxDelayMs))}}b.onRetry&&b.onRetry(k,c,j),h.info("Retrying request",{endpoint:f,attempt:k+1,delayMs:j,correlationId:g}),await o(j),k++}throw n(`Request failed after ${d.maxRetries+1} attempts`,{retryable:!1,attempts:d.maxRetries+1,lastError:c})}function q(){return`tlx_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}a.s(["generateCorrelationId",()=>q,"sleep",()=>o,"withRetry",()=>p],140621)}];

//# sourceMappingURL=_2bf38e18._.js.map