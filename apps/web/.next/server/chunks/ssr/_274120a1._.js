module.exports=[146674,a=>{"use strict";let b=(0,a.i(203431).default)("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);a.s(["default",()=>b])},155519,a=>{"use strict";var b=a.i(146674);a.s(["ArrowUp",()=>b.default])},757516,a=>{"use strict";let b=(0,a.i(203431).default)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);a.s(["default",()=>b])},21220,a=>{"use strict";var b=a.i(757516);a.s(["Paperclip",()=>b.default])},275456,a=>{"use strict";let b=(0,a.i(203431).default)("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);a.s(["default",()=>b])},572863,a=>{"use strict";var b=a.i(275456);a.s(["Camera",()=>b.default])},534683,a=>{"use strict";let b=(0,a.i(203431).default)("message-square-text",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}],["path",{d:"M7 11h10",key:"1twpyw"}],["path",{d:"M7 15h6",key:"d9of3u"}],["path",{d:"M7 7h8",key:"af5zfr"}]]);a.s(["default",()=>b])},744789,a=>{"use strict";var b=a.i(408292);a.s(["PanelLeft",()=>b.default])},642599,a=>{"use strict";var b=a.i(976719);a.s(["ImageIcon",()=>b.default])},336405,a=>{"use strict";let b=(0,a.i(203431).default)("smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);a.s(["default",()=>b])},13378,a=>{"use strict";var b=a.i(336405);a.s(["Smile",()=>b.default])},805277,a=>{"use strict";var b=a.i(861467),c=a.i(604);a.i(516775);var d=a.i(560272);a.i(445255);var e=a.i(18170);a.i(839984);var f=a.i(372712),g=a.i(700760),h=a.i(127487),i=a.i(989630),j=a.i(198803),k=a.i(128952),l=a.i(94436),m=a.i(744789),n=a.i(21220),o=a.i(246840),p=a.i(50900),q=a.i(300298),r=a.i(783281),s=a.i(156916),t=a.i(337241),u=a.i(169021),v=(0,u.createServerReference)("407cdb4f27b0a3c9f049dfd3b6d0861b01b26a0e85",u.callServer,void 0,u.findSourceMapURL,"getTeamChannelMessagesAction"),w=(0,u.createServerReference)("40d31525c81948d6fd1432186542094856234a3c66",u.callServer,void 0,u.findSourceMapURL,"sendTeamChannelMessageAction"),x=(0,u.createServerReference)("40581e668b6daea6cb7c47a00911750a07df65b573",u.callServer,void 0,u.findSourceMapURL,"markTeamChannelAsReadAction");let y=[{id:"general",name:"General",type:"public"},{id:"sales",name:"Sales",type:"public"},{id:"support",name:"Support",type:"public"},{id:"technicians",name:"Technicians",type:"public"},{id:"management",name:"Management",type:"private"}];function z({initialChannels:u,initialChannelId:z}){(0,t.useRouter)();let A=(0,t.useSearchParams)().get("channel")||z||"general",{toggleSidebar:B}=(0,h.useSidebar)(),C=u.length>0?u:y,D=C.find(a=>a.id===A)||C[0],[E,F]=(0,r.useState)([]),[G,H]=(0,r.useState)(!1),[I,J]=(0,r.useState)(!1),[K,L]=(0,r.useState)(null),[M,N]=(0,r.useState)(""),[O,P]=(0,r.useState)(!1),[Q,R]=(0,r.useState)([]),[S,T]=(0,r.useState)(""),[U,V]=(0,r.useState)(""),W=(0,r.useRef)(null),X=(0,r.useRef)(null),Y=(0,r.useCallback)(async(a=!1)=>{a?J(!0):H(!0),L(null);try{let a=await v({channel:A,limit:100,offset:0});a.success&&a.messages?(F(a.messages),a.messages.filter(a=>!a.read_at&&"inbound"===a.direction).length>0&&(F(a=>a.map(a=>a.read_at||"inbound"!==a.direction?a:{...a,read_at:new Date().toISOString()})),x(A).then(a=>{a.success&&setTimeout(()=>{Y(!1)},500)}).catch(()=>{}))):L(a.error||"Failed to load messages")}catch(a){L(a instanceof Error?a.message:"Unknown error")}finally{H(!1),J(!1)}},[A]);(0,r.useEffect)(()=>{W.current&&(W.current.scrollTop=W.current.scrollHeight)},[E]);let Z=(0,r.useRef)(!0);(0,r.useEffect)(()=>{if(Z.current){Z.current=!1;return}Y()},[A]),(0,r.useEffect)(()=>(X.current&&clearTimeout(X.current),X.current=setTimeout(()=>{T(U),U&&Y()},300),()=>{X.current&&clearTimeout(X.current)}),[U]);let $=(0,r.useCallback)(()=>{Y(!0)},[A]),_=(0,r.useCallback)(async()=>{if((M.trim()||0!==Q.length)&&!O){P(!0);try{let b=[];if(Q.length>0){let{uploadSmsAttachments:c}=await a.A(928738),d=await c(Q);if(!d.success||!d.urls){s.toast.error(d.error||"Failed to upload attachments"),P(!1);return}b=Q.map((a,b)=>({type:a.type.startsWith("image/")?"image":"file",filename:a.name,url:d.urls?.[b]}))}let c=await w({channel:A,text:M.trim(),attachments:b});c.success?(N(""),R([]),s.toast.success("Message sent"),Y(!0)):s.toast.error(c.error||"Failed to send message")}catch(a){s.toast.error("Failed to send message",{description:a instanceof Error?a.message:"Unknown error"})}finally{P(!1)}}},[M,Q,A,O]),aa=(0,r.useCallback)(a=>{R(b=>[...b,...a])},[]);return(0,b.jsx)("div",{className:"flex h-full w-full flex-col overflow-hidden bg-sidebar",children:(0,b.jsxs)("div",{className:"bg-card mb-1 rounded-tl-2xl shadow-sm lg:h-full flex flex-col min-w-0 flex-1 overflow-hidden",children:[(0,b.jsxs)("div",{className:"sticky top-0 z-10 flex items-center justify-between gap-2 p-3 border-b border-border bg-card",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 shrink-0",onClick:B,title:"Toggle sidebar",children:(0,b.jsx)(m.PanelLeft,{className:"h-4 w-4"})}),(0,b.jsxs)("div",{className:"relative flex-1 max-w-md",children:[(0,b.jsx)(f.Input,{type:"search",placeholder:"Search messages...",value:U,onChange:a=>V(a.target.value),className:"h-8 pl-9 pr-8"}),(0,b.jsx)(p.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),U&&(0,b.jsx)("button",{onClick:()=>V(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:(0,b.jsx)(q.X,{className:"h-3 w-3"})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 shrink-0 ml-2",children:[(0,b.jsx)(i.Hash,{className:"h-5 w-5 text-muted-foreground"}),(0,b.jsx)("h1",{className:"font-semibold text-base",children:D.name})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:$,disabled:I,className:"h-8 w-8 p-0",title:"Refresh",children:(0,b.jsx)(o.RefreshCw,{className:`h-4 w-4 text-muted-foreground ${I?"animate-spin":""}`})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",title:"More options",children:(0,b.jsx)(l.MoreHorizontal,{className:"h-4 w-4 text-muted-foreground"})})]})]}),(0,b.jsx)("div",{ref:W,className:"flex-1 overflow-y-auto bg-gradient-to-b from-background to-muted/20 px-4 py-4",children:G?(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsx)(j.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):K?(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-sm text-destructive mb-2 font-medium",children:K}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:()=>Y(),children:"Try Again"})]})}):0===E.length?(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(k.MessageSquare,{className:"h-12 w-12 text-muted-foreground opacity-50 mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No messages yet"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Start the conversation!"})]})}):(0,b.jsx)("div",{className:"space-y-2",children:E.map((a,c)=>{let e,f,h,i,j,k="outbound"===a.direction,l=0===c||new Date(a.created_at).getTime()-new Date(E[c-1].created_at).getTime()>3e5;return(0,b.jsxs)("div",{className:"flex flex-col",children:[l&&(0,b.jsx)("div",{className:"flex justify-center my-2",children:(0,b.jsx)("span",{className:"text-xs text-muted-foreground bg-muted/50 px-2 py-1 rounded-full",children:(e=new Date(a.created_at),h=Math.floor((f=new Date().getTime()-e.getTime())/6e4),i=Math.floor(f/36e5),j=Math.floor(f/864e5),h<1?"Just now":h<60?`${h}m ago`:i<24?`${i}h ago`:j<7?`${j}d ago`:e.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}))})}),(0,b.jsxs)("div",{className:(0,g.cn)("flex gap-3",k?"justify-end":"justify-start"),children:[!k&&a.sent_by_user&&(0,b.jsx)(d.Avatar,{className:"h-8 w-8 shrink-0",children:(0,b.jsx)(d.AvatarFallback,{children:a.sent_by_user.name?.[0]?.toUpperCase()||"U"})}),(0,b.jsxs)("div",{className:(0,g.cn)("max-w-[75%] rounded-2xl px-4 py-2 shadow-sm",k?"bg-primary text-primary-foreground rounded-tr-sm":"bg-muted text-foreground rounded-tl-sm"),children:[!k&&a.sent_by_user&&(0,b.jsx)("div",{className:"text-xs font-medium mb-1 opacity-80",children:a.sent_by_user.name||"Unknown"}),a.provider_metadata&&"object"==typeof a.provider_metadata&&"attachments"in a.provider_metadata&&Array.isArray(a.provider_metadata.attachments)&&a.provider_metadata.attachments.length>0&&(0,b.jsx)("div",{className:(0,g.cn)("mb-2 space-y-2",(a.body,"")),children:a.provider_metadata.attachments.map((a,c)=>{let d="image"===a.type||a.url&&/\.(jpg|jpeg|png|gif|webp)$/i.test(a.url);return(0,b.jsx)("div",{className:"rounded-lg overflow-hidden",children:d?(0,b.jsx)("img",{src:a.url,alt:a.filename||"Image",className:"max-w-full max-h-64 object-contain rounded-lg",loading:"lazy"}):(0,b.jsxs)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:(0,g.cn)("flex items-center gap-2 p-2 rounded-lg hover:opacity-80 transition-opacity",k?"bg-primary-foreground/20":"bg-background/20"),children:[(0,b.jsx)(n.Paperclip,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"text-xs truncate",children:a.filename||"Attachment"})]})},c)})}),a.body&&(0,b.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:a.body}),!a.body&&(!a.provider_metadata||"object"!=typeof a.provider_metadata||!("attachments"in a.provider_metadata)||!Array.isArray(a.provider_metadata.attachments)||0===a.provider_metadata.attachments.length)&&(0,b.jsx)("p",{className:"text-sm opacity-70 italic",children:"No message content"}),(0,b.jsx)("span",{className:(0,g.cn)("text-xs opacity-70 mt-1 block",k?"text-right":"text-left"),children:new Date(a.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})]},a.id)})})}),(0,b.jsx)(c.SmsMessageInput,{value:M,onChange:N,onSend:_,onAttach:aa,sending:O,disabled:!1,placeholder:`Message #${D.name.toLowerCase()}`})]})})}a.s(["TeamsPageClient",()=>z],805277)},928738,a=>{a.v(b=>Promise.all(["server/chunks/ssr/apps_web_src_actions_1ec6dfb2._.js"].map(b=>a.l(b))).then(()=>b(680522)))}];

//# sourceMappingURL=_274120a1._.js.map