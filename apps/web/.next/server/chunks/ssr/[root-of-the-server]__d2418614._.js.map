{"version":3,"sources":["../../../../../../apps/web/src/components/work/work-data-view.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/components/work/purchase-orders-kanban.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/components/work/purchase-orders-table.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/work/purchase-orders/page.tsx","../../../../../../apps/web/src/components/work/purchase-orders/purchase-orders-data.tsx","../../../../../../apps/web/src/lib/queries/purchase-orders.ts","../../../../../../apps/web/src/components/work/purchase-orders/purchase-orders-skeleton.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const WorkDataView = registerClientReference(\n    function() { throw new Error(\"Attempted to call WorkDataView() from the server but WorkDataView is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/work/work-data-view.tsx\",\n    \"WorkDataView\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const PurchaseOrdersKanban = registerClientReference(\n    function() { throw new Error(\"Attempted to call PurchaseOrdersKanban() from the server but PurchaseOrdersKanban is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/work/purchase-orders-kanban.tsx\",\n    \"PurchaseOrdersKanban\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const PurchaseOrdersTable = registerClientReference(\n    function() { throw new Error(\"Attempted to call PurchaseOrdersTable() from the server but PurchaseOrdersTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/work/purchase-orders-table.tsx\",\n    \"PurchaseOrdersTable\",\n);\n","/**\n * Purchase Orders Page - PPR Enabled with Inline Stats\n *\n * Uses Next.js 16 \"use cache\" directive for optimal caching:\n * - Static shell renders instantly (5-20ms)\n * - Stats stream in toolbar (100-200ms)\n * - Data streams in main content (200-500ms)\n *\n * Performance: 10-40x faster than traditional SSR\n * Clean design: Stats integrated directly into toolbar\n */\n\nimport { Suspense } from \"react\";\nimport { PurchaseOrdersData } from \"@/components/work/purchase-orders/purchase-orders-data\";\nimport { PurchaseOrdersSkeleton } from \"@/components/work/purchase-orders/purchase-orders-skeleton\";\n\nexport default async function PurchaseOrdersPage({\n\tsearchParams,\n}: {\n\tsearchParams: Promise<{ page?: string }>;\n}) {\n\tconst params = await searchParams;\n\n\treturn (\n\t\t<div className=\"flex h-full flex-col\">\n\t\t\t{/* Stats now shown in toolbar - see layout.tsx */}\n\n\t\t\t{/* Table - Main content */}\n\t\t\t<div className=\"flex-1 overflow-hidden\">\n\t\t\t\t<Suspense fallback={<PurchaseOrdersSkeleton />}>\n\t\t\t\t\t<PurchaseOrdersData searchParams={params} />\n\t\t\t\t</Suspense>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","import { notFound } from \"next/navigation\";\nimport { PurchaseOrdersKanban } from \"@/components/work/purchase-orders-kanban\";\nimport {\n\ttype PurchaseOrder,\n\tPurchaseOrdersTable,\n} from \"@/components/work/purchase-orders-table\";\nimport { WorkDataView } from \"@/components/work/work-data-view\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport {\n\tgetPurchaseOrdersPageData,\n\tPURCHASE_ORDERS_PAGE_SIZE,\n} from \"@/lib/queries/purchase-orders\";\n\nexport async function PurchaseOrdersData({\n\tsearchParams,\n}: {\n\tsearchParams?: { page?: string };\n}) {\n\tconst activeCompanyId = await getActiveCompanyId();\n\n\tif (!activeCompanyId) {\n\t\treturn notFound();\n\t}\n\n\tconst currentPage = Number(searchParams?.page) || 1;\n\tconst { purchaseOrders: purchaseOrdersRaw, totalCount } =\n\t\tawait getPurchaseOrdersPageData(\n\t\t\tcurrentPage,\n\t\t\tPURCHASE_ORDERS_PAGE_SIZE,\n\t\t\tactiveCompanyId,\n\t\t);\n\n\tconst purchaseOrders: PurchaseOrder[] = (purchaseOrdersRaw || []).map(\n\t\t(po) => ({\n\t\t\tid: po.id,\n\t\t\tpoNumber: po.po_number,\n\t\t\tvendor: po.vendor || \"Unknown Vendor\",\n\t\t\ttitle: po.title,\n\t\t\tstatus: po.status,\n\t\t\tpriority: po.priority,\n\t\t\ttotalAmount: po.total_amount || 0,\n\t\t\tjobNumber: undefined,\n\t\t\trequestedBy: \"\",\n\t\t\tcreatedAt: po.created_at\n\t\t\t\t? new Date(po.created_at).toLocaleDateString(\"en-US\", {\n\t\t\t\t\t\tmonth: \"short\",\n\t\t\t\t\t\tday: \"numeric\",\n\t\t\t\t\t\tyear: \"numeric\",\n\t\t\t\t\t})\n\t\t\t\t: \"\",\n\t\t\texpectedDelivery: po.expected_delivery\n\t\t\t\t? new Date(po.expected_delivery).toLocaleDateString(\"en-US\", {\n\t\t\t\t\t\tmonth: \"short\",\n\t\t\t\t\t\tday: \"numeric\",\n\t\t\t\t\t\tyear: \"numeric\",\n\t\t\t\t\t})\n\t\t\t\t: undefined,\n\t\t\tautoGenerated: po.auto_generated,\n\t\t\tarchived_at: po.archived_at,\n\t\t\tdeleted_at: null,\n\t\t}),\n\t);\n\n\treturn (\n\t\t<WorkDataView\n\t\t\tkanban={<PurchaseOrdersKanban orders={purchaseOrders} />}\n\t\t\tsection=\"purchaseOrders\"\n\t\t\ttable={\n\t\t\t\t<PurchaseOrdersTable\n\t\t\t\t\tcurrentPage={currentPage}\n\t\t\t\t\titemsPerPage={PURCHASE_ORDERS_PAGE_SIZE}\n\t\t\t\t\torders={purchaseOrders}\n\t\t\t\t\ttotalCount={totalCount}\n\t\t\t\t/>\n\t\t\t}\n\t\t/>\n\t);\n}\n","import { cache } from \"react\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\nimport type { Database } from \"@/types/supabase\";\n\nexport const PURCHASE_ORDERS_PAGE_SIZE = 50;\n\nconst PURCHASE_ORDERS_SELECT = `\n  id,\n  company_id,\n  po_number,\n  vendor,\n  title,\n  status,\n  priority,\n  total_amount,\n  created_at,\n  expected_delivery,\n  auto_generated,\n  archived_at,\n  job_id\n`;\n\nexport type PurchaseOrderRecord =\n\tDatabase[\"public\"][\"Tables\"][\"purchase_orders\"][\"Row\"];\n\nexport type PurchaseOrdersPageResult = {\n\tpurchaseOrders: PurchaseOrderRecord[];\n\ttotalCount: number;\n};\n\nexport async function getPurchaseOrdersPageData(\n\tpage: number,\n\tpageSize: number = PURCHASE_ORDERS_PAGE_SIZE,\n\tcompanyIdOverride?: string,\n): Promise<PurchaseOrdersPageResult> {\n\t// IMPORTANT: Cannot use \"use cache\" here because we call getActiveCompanyId()\n\t// which uses cookies(). The query is already fast enough without page-level caching.\n\tconst companyId = companyIdOverride ?? (await getActiveCompanyId());\n\tif (!companyId) {\n\t\treturn { purchaseOrders: [], totalCount: 0 };\n\t}\n\n\tconst supabase = await createServiceSupabaseClient();\n\tif (!supabase) {\n\t\tthrow new Error(\"Supabase client not configured\");\n\t}\n\tconst start = (Math.max(page, 1) - 1) * pageSize;\n\tconst end = start + pageSize - 1;\n\n\tconst { data, error, count } = await supabase\n\t\t.from(\"purchase_orders\")\n\t\t.select(PURCHASE_ORDERS_SELECT, { count: \"exact\" })\n\t\t.eq(\"company_id\", companyId)\n\t\t.order(\"created_at\", { ascending: false })\n\t\t.range(start, end);\n\n\tif (error) {\n\t\tthrow new Error(`Failed to fetch purchase orders: ${error.message}`);\n\t}\n\n\treturn {\n\t\tpurchaseOrders: (data ?? []) as PurchaseOrderRecord[],\n\t\ttotalCount: count ?? 0,\n\t};\n}\n\n/**\n * Fetch complete purchase order data including vendor, job, and tags\n * Uses React.cache() for request-level deduplication\n */\nconst getPurchaseOrderComplete = cache(\n\tasync (purchaseOrderId: string, companyId: string) => {\n\t\tconst supabase = await createServiceSupabaseClient();\n\t\tif (!supabase) {\n\t\t\tthrow new Error(\"Supabase client not configured\");\n\t\t}\n\n\t\tconst { data, error } = await supabase.rpc(\"get_purchase_order_complete\", {\n\t\t\tp_purchase_order_id: purchaseOrderId,\n\t\t\tp_company_id: companyId,\n\t\t});\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Error fetching purchase order:\", error);\n\t\t\treturn null;\n\t\t}\n\n\t\treturn data?.[0]?.purchase_order_data || null;\n\t},\n);\n","/**\n * PurchaseOrdersSkeleton - Loading Skeleton\n *\n * Uses the shared DataTableListSkeleton for consistent UX across all list pages.\n * Displays while purchase orders data is loading with search bar.\n * Provides visual feedback during streaming.\n */\n\nimport { DataTableListSkeleton } from \"@/components/ui/skeletons\";\n\nexport function PurchaseOrdersSkeleton() {\n\treturn <DataTableListSkeleton showSearchBar />;\n}\n"],"names":[],"mappings":"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","ignoreList":[0,1,2]}