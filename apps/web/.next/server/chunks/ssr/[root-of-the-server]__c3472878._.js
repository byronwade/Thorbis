module.exports=[193695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},997868,a=>{a.n(a.i(884849))},592581,a=>{a.n(a.i(596565))},134005,a=>{a.n(a.i(977930))},565165,a=>{a.n(a.i(728209))},147941,a=>{a.n(a.i(484103))},304434,a=>{a.n(a.i(632684))},407521,a=>{a.n(a.i(693094))},797797,a=>{a.n(a.i(977207))},290022,a=>{a.n(a.i(362735))},729157,a=>{a.n(a.i(470009))},712363,a=>{a.n(a.i(279732))},208120,a=>{a.n(a.i(52860))},863056,a=>{a.n(a.i(77721))},468729,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call WorkDataView() from the server but WorkDataView is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/work-data-view.tsx <module evaluation>","WorkDataView");a.s(["WorkDataView",0,b])},750692,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call WorkDataView() from the server but WorkDataView is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/work-data-view.tsx","WorkDataView");a.s(["WorkDataView",0,b])},310669,a=>{"use strict";a.i(468729);var b=a.i(750692);a.n(b)},19154,a=>{a.n(a.i(456621))},271141,a=>{a.n(a.i(581567))},766109,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call ServiceAgreementsKanban() from the server but ServiceAgreementsKanban is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/service-agreements-kanban.tsx <module evaluation>","ServiceAgreementsKanban");a.s(["ServiceAgreementsKanban",0,b])},20477,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call ServiceAgreementsKanban() from the server but ServiceAgreementsKanban is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/service-agreements-kanban.tsx","ServiceAgreementsKanban");a.s(["ServiceAgreementsKanban",0,b])},603708,a=>{"use strict";a.i(766109);var b=a.i(20477);a.n(b)},699623,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call ServiceAgreementsTable() from the server but ServiceAgreementsTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/service-agreements-table.tsx <module evaluation>","ServiceAgreementsTable");a.s(["ServiceAgreementsTable",0,b])},731823,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call ServiceAgreementsTable() from the server but ServiceAgreementsTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/service-agreements-table.tsx","ServiceAgreementsTable");a.s(["ServiceAgreementsTable",0,b])},255738,a=>{"use strict";a.i(699623);var b=a.i(731823);a.n(b)},674902,a=>{"use strict";var b=a.i(504348),c=a.i(429969);a.i(692167);var d=a.i(852596),e=a.i(603708),f=a.i(255738),g=a.i(310669);a.i(467361);var h=a.i(445074),i=a.i(933427);let j=`
  id,
  company_id,
  plan_number,
  name,
  type,
  frequency,
  start_date,
  end_date,
  status,
  price,
  archived_at,
  deleted_at,
  customer:customers!service_plans_customer_id_customers_id_fk (
    id,
    display_name,
    first_name,
    last_name
  )
`;async function k(a,b=50,c){let d=c??await (0,h.getActiveCompanyId)();if(!d)return{agreements:[],totalCount:0};let e=await (0,i.createServiceSupabaseClient)();if(!e)throw Error("Supabase client not configured");let f=(Math.max(a,1)-1)*b,{data:g,error:l,count:m}=await e.from("service_plans").select(j,{count:"exact"}).eq("company_id",d).eq("type","contract").order("created_at",{ascending:!1}).range(f,f+b-1);if(l)throw Error(`Failed to fetch service agreements: ${l.message}`);return{agreements:g??[],totalCount:m??0}}async function l({searchParams:a}){let c=await (0,h.getActiveCompanyId)();if(!c)return(0,d.notFound)();let i=Number(a?.page)||1,{agreements:j,totalCount:l}=await k(i,50,c),m=(j||[]).map(a=>{let b=Array.isArray(a.customer)?a.customer[0]:a.customer,c=b?.display_name||`${b?.first_name||""} ${b?.last_name||""}`.trim()||"Unknown",d=a.start_date&&new Date(a.start_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),e=a.end_date&&new Date(a.end_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),f="Maintenance Contract",g=String(a.plan_type||a.type||"").toLowerCase();return g.includes("sla")?f="Service Level Agreement":g.includes("warranty")?f="Extended Warranty":g.includes("support")&&(f="Support Contract"),{id:a.id,agreementNumber:a.agreement_number||a.id,customer:c,type:f,startDate:d||"",endDate:e||"",value:"number"==typeof a.value?a.value:0,status:a.status||"pending",archived_at:a.archived_at??null,deleted_at:a.deleted_at??null}});return(0,b.jsx)(g.WorkDataView,{kanban:(0,b.jsx)(e.ServiceAgreementsKanban,{agreements:m}),section:"serviceAgreements",table:(0,b.jsx)(f.ServiceAgreementsTable,{agreements:m,currentPage:i,itemsPerPage:50,totalCount:l})})}(0,c.cache)(async(a,b)=>{let c=await (0,i.createServiceSupabaseClient)();if(!c)throw Error("Supabase client not configured");let{data:d,error:e}=await c.rpc("get_service_agreement_complete",{p_service_agreement_id:a,p_company_id:b});return e?(console.error("Error fetching service agreement:",e),null):d?.[0]?.service_agreement_data||null}),a.i(250202);var m=a.i(709027);function n(){return(0,b.jsx)(m.DataTableListSkeleton,{showSearchBar:!0})}async function o({searchParams:a}){let d=await a;return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(n,{}),children:(0,b.jsx)(l,{searchParams:d})})}a.s(["default",()=>o],674902)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__c3472878._.js.map