module.exports=[951615,(a,b,c)=>{b.exports=a.x("node:buffer",()=>require("node:buffer"))},546081,a=>{"use strict";var b=a.i(951615);async function c(a){try{let c=process.env.TELNYX_API_KEY;if(!c)return{success:!1,error:"TELNYX_API_KEY is not configured"};let e=a.username.replace(/[^a-zA-Z0-9]/g,""),f=e.length>0?e:b.Buffer.from(a.username||"user").toString("hex"),g=Date.now().toString(36),h=Math.max(1,64-g.length),i=f.slice(0,h),j=`${i}${g}`,k=await fetch("https://api.telnyx.com/v2/credential_connections",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`}});if(k.ok){let a=await k.json();if(a.data&&Array.isArray(a.data))for(let b of a.data.filter(a=>a.connection_name?.startsWith(i)))try{await fetch(`https://api.telnyx.com/v2/credential_connections/${b.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${c}`}})}catch(a){}}let l=d(32),m=await fetch("https://api.telnyx.com/v2/credential_connections",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({connection_name:j,user_name:j,password:l,ttl:a.ttl||86400})});if(!m.ok){let b=await m.text(),e=d(32),f=await fetch("https://api.telnyx.com/v2/texml_credentials",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({connection_name:j,user_name:j,password:e})});if(!f.ok)throw await f.text(),Error(`Telnyx API error: ${m.status} - ${b}`);let g=await f.json(),h={username:g.data?.user_name||j,password:g.data?.password||e,expires_at:Date.now()+1e3*(a.ttl||86400),realm:"sip.telnyx.com",sip_uri:`sip:${j}@sip.telnyx.com`,stun_servers:["stun:stun.telnyx.com:3478","stun:stun.telnyx.com:3479"],turn_servers:[{urls:["turn:turn.telnyx.com:3478?transport=udp","turn:turn.telnyx.com:3478?transport=tcp"],username:g.data?.user_name||j,credential:g.data?.password||d(24)}]};return{success:!0,credential:h}}let n=await m.json(),o={username:n.data?.user_name||j,password:n.data?.password||l,expires_at:n.data?.expires_at?new Date(n.data.expires_at).getTime():Date.now()+1e3*(a.ttl||86400),realm:n.data?.realm||"sip.telnyx.com",sip_uri:n.data?.sip_uri||`sip:${j}@sip.telnyx.com`,stun_servers:n.data?.ice_servers?.stun||["stun:stun.telnyx.com:3478","stun:stun.telnyx.com:3479"],turn_servers:n.data?.ice_servers?.turn||[{urls:["turn:turn.telnyx.com:3478?transport=udp","turn:turn.telnyx.com:3478?transport=tcp"],username:n.data?.user_name||j,credential:n.data?.password}]};return{success:!0,credential:o}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to generate WebRTC token"}}}function d(a=32){let b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*",c="";for(let d=0;d<a;d++)c+=b.charAt(Math.floor(Math.random()*b.length));return c}a.s(["generateWebRTCToken",()=>c])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__19a3dae2._.js.map