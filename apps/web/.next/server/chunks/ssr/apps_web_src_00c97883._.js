module.exports=[958995,a=>{"use strict";var b=a.i(504348),c=a.i(402239),d=a.i(471320),e=a.i(285322),f=a.i(301594),g=a.i(301226),h=a.i(607462);function i({inviteeName:a,inviterName:h,companyName:i,role:J,jobTitle:K,invitationUrl:L,expiresInDays:M=7,supportEmail:N="support@thorbis.com",supportPhone:O="(555) 123-4567",previewText:P=`You've been invited to join ${i}`}){let Q=J.charAt(0).toUpperCase()+J.slice(1);return(0,b.jsxs)(g.BaseLayout,{previewText:P,children:[(0,b.jsx)(f.Heading,{level:1,children:"Welcome to the Team!"}),(0,b.jsxs)(c.Text,{style:j,children:["Hi ",a,","]}),(0,b.jsxs)(c.Text,{style:j,children:[h," has invited you to join ",(0,b.jsx)("strong",{children:i})," on Thorbis. We're excited to have you on board!"]}),(0,b.jsxs)(e.Card,{style:k,children:[(0,b.jsx)("div",{style:l,children:"ðŸŽ‰"}),(0,b.jsx)(c.Text,{style:m,children:"You're Invited!"}),(0,b.jsxs)(c.Text,{style:n,children:["You've been invited as a ",(0,b.jsx)("strong",{children:Q}),K?` - ${K}`:"","."]}),(0,b.jsx)(c.Text,{style:n,children:"Click the button below to accept your invitation and set up your account."})]}),(0,b.jsx)("div",{style:o,children:(0,b.jsx)(d.Button,{href:L,children:"Accept Invitation"})}),(0,b.jsx)(e.Card,{style:p,children:(0,b.jsxs)(c.Text,{style:q,children:["â° This invitation link will expire in"," ",(0,b.jsxs)("strong",{children:[M," days"]}),". Please accept your invitation soon."]})}),(0,b.jsxs)(e.Card,{style:r,children:[(0,b.jsx)(f.Heading,{level:3,children:"What you can do with Thorbis:"}),(0,b.jsxs)("ul",{style:s,children:[(0,b.jsxs)("li",{style:t,children:[(0,b.jsx)("strong",{children:"ðŸ“… Manage Jobs & Schedule:"})," Create and track jobs, schedule appointments, and coordinate with your team"]}),(0,b.jsxs)("li",{style:t,children:[(0,b.jsx)("strong",{children:"ðŸ‘¥ Customer Management:"})," Access complete customer information, history, and communication logs"]}),(0,b.jsxs)("li",{style:t,children:[(0,b.jsx)("strong",{children:"ðŸ’° Invoicing & Payments:"})," Generate invoices, estimates, and track payments in real-time"]}),(0,b.jsxs)("li",{style:t,children:[(0,b.jsx)("strong",{children:"ðŸ“Š Reports & Analytics:"})," View performance metrics and business insights"]}),(0,b.jsxs)("li",{style:t,children:[(0,b.jsx)("strong",{children:"ðŸ’¬ Team Communication:"})," Collaborate with your team through built-in messaging"]}),(0,b.jsxs)("li",{style:t,children:[(0,b.jsx)("strong",{children:"ðŸ“± Mobile Access:"})," Access your work from any device, anywhere"]})]})]}),(0,b.jsxs)(e.Card,{style:u,children:[(0,b.jsx)(f.Heading,{level:3,children:"Secure & Reliable"}),(0,b.jsx)(c.Text,{style:v,children:"Your account is protected with industry-standard security. All data is encrypted and backed up regularly to keep your business safe."})]}),(0,b.jsxs)(e.Card,{style:w,children:[(0,b.jsx)(f.Heading,{level:3,children:"Getting Started is Easy"}),(0,b.jsxs)("div",{style:x,children:[(0,b.jsxs)("div",{style:y,children:[(0,b.jsx)("div",{style:z,children:"1"}),(0,b.jsx)(c.Text,{style:A,children:'Click the "Accept Invitation" button above'})]}),(0,b.jsxs)("div",{style:y,children:[(0,b.jsx)("div",{style:z,children:"2"}),(0,b.jsx)(c.Text,{style:A,children:"Complete your profile and set a secure password"})]}),(0,b.jsxs)("div",{style:y,children:[(0,b.jsx)("div",{style:z,children:"3"}),(0,b.jsx)(c.Text,{style:A,children:"Explore the platform and start collaborating!"})]})]})]}),(0,b.jsxs)(e.Card,{style:B,children:[(0,b.jsx)(f.Heading,{level:3,children:"Need Help?"}),(0,b.jsx)(c.Text,{style:C,children:"If you have any questions about getting started or need assistance, our support team is here to help."}),(0,b.jsxs)("div",{style:D,children:[(0,b.jsxs)("div",{style:E,children:[(0,b.jsx)(c.Text,{style:F,children:"Email:"}),(0,b.jsx)("a",{href:`mailto:${N}`,style:G,children:N})]}),(0,b.jsxs)("div",{style:E,children:[(0,b.jsx)(c.Text,{style:F,children:"Phone:"}),(0,b.jsx)("a",{href:`tel:${O}`,style:G,children:O})]})]})]}),(0,b.jsxs)(c.Text,{style:H,children:[(0,b.jsx)("strong",{children:"Note:"})," If you didn't expect this invitation or believe you received this email in error, please contact us at"," ",(0,b.jsx)("a",{href:`mailto:${N}`,style:I,children:N}),"."]})]})}let j={color:"#374151",fontSize:"16px",lineHeight:"24px",margin:"0 0 16px 0"},k={background:"linear-gradient(135deg, hsl(217 91% 60%) 0%, hsl(217 91% 50%) 100%)",borderRadius:"12px",padding:"40px",margin:"24px 0",textAlign:"center"},l={fontSize:"64px",margin:"0 0 16px 0"},m={color:h.EMAIL_COLORS.primaryText,fontSize:"24px",fontWeight:"600",margin:"0 0 12px 0"},n={color:h.EMAIL_COLORS.primaryText,fontSize:"16px",lineHeight:"24px",margin:"0 0 12px 0",opacity:"0.95"},o={margin:"32px 0",textAlign:"center"},p={backgroundColor:"#fef3c7",border:"1px solid #fde68a",borderRadius:"8px",padding:"16px",margin:"24px 0",textAlign:"center"},q={color:"#92400e",fontSize:"14px",lineHeight:"20px",margin:"0"},r={backgroundColor:"#f0fdf4",border:"1px solid #bbf7d0",margin:"24px 0"},s={color:"#166534",fontSize:"14px",lineHeight:"22px",margin:"12px 0 0 20px",padding:"0"},t={margin:"0 0 12px 0"},u={backgroundColor:"#f5f3ff",border:"1px solid #ddd6fe",margin:"24px 0"},v={color:"#5b21b6",fontSize:"15px",lineHeight:"22px",margin:"12px 0 0 0"},w={backgroundColor:"#eff6ff",border:"1px solid #bfdbfe",margin:"24px 0"},x={display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"20px",margin:"20px 0 0 0"},y={textAlign:"center"},z={width:"40px",height:"40px",backgroundColor:"hsl(217 91% 60%)",color:h.EMAIL_COLORS.primaryText,borderRadius:"50%",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"18px",fontWeight:"600",margin:"0 auto 12px auto"},A={color:"#1e40af",fontSize:"13px",lineHeight:"18px",margin:"0"},B={backgroundColor:"#fef2f2",border:"1px solid #fecaca",margin:"24px 0"},C={color:"#991b1b",fontSize:"15px",lineHeight:"22px",margin:"12px 0 20px 0"},D={display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},E={textAlign:"center"},F={color:"#6b7280",fontSize:"12px",textTransform:"uppercase",letterSpacing:"0.05em",margin:"0 0 8px 0"},G={color:"hsl(217 91% 60%)",fontSize:"15px",fontWeight:"600",textDecoration:"underline"},H={color:"#6b7280",fontSize:"13px",lineHeight:"20px",margin:"32px 0 0 0",padding:"20px",backgroundColor:"#f9fafb",borderRadius:"8px",textAlign:"center"},I={color:"hsl(217 91% 60%)",textDecoration:"underline"};a.s(["default",()=>i])},541150,a=>{"use strict";var b=a.i(666680);let c=process.env.INVITATION_SECRET||"fallback-secret-change-in-production";function d(a){let d={...a,exp:Date.now()+6048e5,nonce:(0,b.randomBytes)(16).toString("hex")},e=Buffer.from(JSON.stringify(d)).toString("base64url"),f=(0,b.createHmac)("sha256",c).update(e).digest("base64url");return`${e}.${f}`}a.s(["generateInvitationToken",()=>d])},900800,a=>a.a(async(b,c)=>{try{var d=a.i(780195),e=a.i(218188),f=a.i(146057),g=a.i(958995),h=a.i(37933),i=a.i(463556),j=a.i(818944),k=a.i(974406),l=a.i(541150),m=a.i(136874),n=a.i(395731),o=b([h]);function p(){return"http://localhost:3000".replace(/\/$/,"")}async function q(a){return(0,k.withErrorHandling)(async()=>{let b=await (0,m.createClient)();if(!b)throw new j.ActionError("Database connection failed",j.ERROR_CODES.DB_CONNECTION_ERROR);let{data:c,error:d}=await b.from("companies").select("id, name, onboarding_progress").eq("id",a).single();if(d||!c)throw new j.ActionError("Company not found",j.ERROR_CODES.DB_RECORD_NOT_FOUND,404);let e=c.onboarding_progress?.step2?.teamMembers||[];if(!Array.isArray(e)||0===e.length)return{sent:0,failed:0};let{data:{user:f}}=await b.auth.getUser();(0,k.assertAuthenticated)(f?.id);let{data:n}=await b.from("profiles").select("full_name, email").eq("id",f.id).single(),o=0,q=0,r=p();for(let d of e){if(d.isCurrentUser){let{error:c}=await b.from("company_memberships").upsert({company_id:a,user_id:f.id,role:d.role,status:"active",job_title:"Owner",phone:d.phone||null,joined_at:new Date().toISOString()},{onConflict:"user_id,company_id"});c&&console.error("Failed to upsert owner membership:",c.message);continue}try{let e=(0,l.generateInvitationToken)({email:d.email,companyId:c.id,role:d.role}),j=new Date;j.setDate(j.getDate()+7);let{error:k}=await b.from("team_invitations").insert({company_id:a,email:d.email,first_name:d.firstName,last_name:d.lastName,role:d.role,phone:d.phone||null,token:e,invited_by:f.id,expires_at:j.toISOString()});if(k){q++;continue}let m=`${r}/accept-invitation?token=${e}`;(await (0,h.sendPlatformEmail)({to:d.email,subject:`You've been invited to join ${c.name} on Thorbis`,template:(0,g.default)({inviteeName:`${d.firstName} ${d.lastName}`,inviterName:n?.name||n?.email||"Your colleague",companyName:c.name,role:d.role,magicLink:m,expiresInDays:7}),templateType:i.EmailTemplate.TEAM_INVITATION})).success?o++:q++}catch(a){q++}}return{sent:o,failed:q}})}async function r(a){return(0,k.withErrorHandling)(async()=>{let b=await (0,m.createClient)();if(!b)throw new j.ActionError("Database connection failed",j.ERROR_CODES.DB_CONNECTION_ERROR);let{data:{user:c}}=await b.auth.getUser();(0,k.assertAuthenticated)(c?.id);let{data:d}=await b.from("company_memberships").select("company_id, companies!inner(name)").eq("user_id",c.id).eq("status","active").single();if(!d?.company_id)throw new j.ActionError("You must be part of a company to invite team members",j.ERROR_CODES.AUTH_FORBIDDEN,403);let i=a.get("email"),n=a.get("firstName"),o=a.get("lastName"),q=a.get("role"),r=a.get("phone"),s=f.z.object({email:f.z.string().email(),firstName:f.z.string().min(1),lastName:f.z.string().min(1),role:f.z.enum(["owner","admin","manager","technician","dispatcher"])}).parse({email:i,firstName:n,lastName:o,role:q}),t=(0,l.generateInvitationToken)({email:s.email,companyId:d.company_id,role:s.role}),u=new Date;u.setDate(u.getDate()+7);let{error:v}=await b.from("team_invitations").insert({company_id:d.company_id,email:s.email,first_name:s.firstName,last_name:s.lastName,role:s.role,phone:r||null,token:t,invited_by:c.id,expires_at:u.toISOString()});if(v)throw new j.ActionError(j.ERROR_MESSAGES.operationFailed("send invitation"),j.ERROR_CODES.DB_QUERY_ERROR);let w=p(),x=`${w}/accept-invitation?token=${t}`,y=Array.isArray(d.companies)?d.companies[0]:d.companies,{data:z}=await b.from("profiles").select("full_name, email").eq("id",c.id).single();return!(await (0,h.sendPlatformEmail)({to:s.email,subject:`You've been invited to join ${y?.name} on Thorbis`,template:(0,g.default)({inviteeName:`${s.firstName} ${s.lastName}`,inviterName:z?.name||z?.email||"Your colleague",companyName:y?.name||"the team",role:s.role,magicLink:x,expiresInDays:7}),templateType:"team-invitation"})).success,(0,e.revalidatePath)("/dashboard/settings/team"),"Invitation sent successfully"})}[h]=o.then?(await o)():o,(0,n.ensureServerEntryExports)([q,r]),(0,d.registerServerReference)(q,"40f98f6926a8ec07816315d95d659e5059859476ef",null),(0,d.registerServerReference)(r,"402687fa9fb62ed4a942d5e407b78cf6702d51ceb7",null),a.s(["sendSingleTeamInvitation",()=>r,"sendTeamMemberInvitations",()=>q]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=apps_web_src_00c97883._.js.map