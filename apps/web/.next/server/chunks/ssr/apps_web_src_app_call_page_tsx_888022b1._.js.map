{"version":3,"sources":["../../../../../../apps/web/src/app/call/page.tsx","../../../../../../apps/web/src/actions/data%3A727e83%20%3Ctext/javascript%3E","../../../../../../apps/web/src/actions/data%3A7207d6%20%3Ctext/javascript%3E","../../../../../../apps/web/src/components/call/call-toolbar.tsx","../../../../../../apps/web/src/components/call/customer-sidebar.tsx","../../../../../../apps/web/src/types/csr-reminders.ts","../../../../../../apps/web/src/components/call/customer-alert-banner.tsx","../../../../../../apps/web/src/components/call/customer-stats-bar.tsx","../../../../../../apps/web/src/components/call/previous-call-summary.tsx","../../../../../../apps/web/src/components/call/quick-actions-panel.tsx","../../../../../../apps/web/src/components/call/csr-schedule-view.tsx","../../../../../../apps/web/src/actions/data%3A13d0b2%20%3Ctext/javascript%3E","../../../../../../apps/web/src/components/call/schedule-timeline.tsx","../../../../../../apps/web/src/components/call/call-wrap-up-dialog.tsx","../../../../../../apps/web/src/components/call/keyboard-shortcuts-help.tsx","../../../../../../apps/web/src/components/call/ai-suggestions-widget.tsx","../../../../../../apps/web/src/components/call/sentiment-indicator.tsx","../../../../../../apps/web/src/components/call/extracted-info-panel.tsx","../../../../../../apps/web/src/components/call/smart-call-notes.tsx","../../../../../../apps/web/src/components/call/call-skeleton.tsx","../../../../../../apps/web/src/components/communication/transcript-panel.tsx","../../../../../../apps/web/src/lib/stores/transcript-store.ts","../../../../../../apps/web/src/hooks/use-call-quality.ts","../../../../../../apps/web/src/hooks/use-call-shortcuts.ts","../../../../../../apps/web/src/lib/utils/pop-out-manager.ts"],"sourcesContent":["\"use client\";\n\n/**\n * Call Window Page - Complete Redesign\n *\n * New architecture with:\n * - Top toolbar with call controls and customer info\n * - Left panel: Live transcript with AI analysis (35%)\n * - Right panel: Customer sidebar with collapsibles (65%)\n * - Real Telnyx integration\n * - Real customer data from database\n * - AI-powered auto-fill from transcript\n * - No mock data, no separate forms\n * - Keyboard shortcuts for all actions\n * - AI-powered suggestions and sentiment analysis\n * - Accessibility features (skip links, ARIA labels)\n *\n * The customer sidebar collapsibles show existing data or empty states\n * for new customers, with real-time AI auto-fill from the transcript.\n */\n\nimport type { Call as TelnyxCall } from \"@telnyx/webrtc\";\nimport { AlertCircle, CalendarDays, MessageSquare } from \"lucide-react\";\nimport { useSearchParams } from \"next/navigation\";\nimport { Suspense, useCallback, useEffect, useRef, useState } from \"react\";\nimport {\n\tgetCustomerCallData,\n\tgetCustomerCallDataById,\n} from \"@/actions/call-customer-data\";\nimport {\n\tCallToolbar,\n\tCallWrapUpDialog,\n\tKeyboardShortcutsHelp,\n} from \"@/components/call\";\nimport { CallWindowSkeleton } from \"@/components/call/call-skeleton\";\nimport { CSRScheduleView } from \"@/components/call/csr-schedule-view\";\nimport { CustomerSidebar } from \"@/components/call/customer-sidebar\";\nimport { SkipLink } from \"@/components/layout/skip-link\";\nimport { TranscriptPanel } from \"@/components/communication/transcript-panel\";\nimport { Button } from \"@/components/ui/button\";\nimport { useCallQuality } from \"@/hooks/use-call-quality\";\nimport { useCallShortcuts } from \"@/hooks/use-call-shortcuts\";\nimport { useTelnyxWebRTC } from \"@/hooks/use-telnyx-webrtc\";\nimport { useUIStore } from \"@/lib/stores\";\nimport { useTranscriptStore } from \"@/lib/stores/transcript-store\";\nimport {\n\tgetCallIdFromUrl,\n\tisPopOutMessage,\n\ttype PopOutMessage,\n\tsendToMain,\n\tverifyMessageOrigin,\n} from \"@/lib/utils/pop-out-manager\";\nimport type { CustomerCallData } from \"@/types/call\";\n\nfunction CallWindowContent() {\n\tconst searchParams = useSearchParams();\n\tconst callId = searchParams?.get(\"callId\") || getCallIdFromUrl();\n\tconst customerId = searchParams?.get(\"customerId\");\n\tconst direction = searchParams?.get(\"direction\") as\n\t\t| \"inbound\"\n\t\t| \"outbound\"\n\t\t| null;\n\n\t// Store hooks\n\tconst {\n\t\tcall,\n\t\tanswerCall,\n\t\tendCall,\n\t\ttoggleMute,\n\t\ttoggleHold,\n\t\ttoggleRecording,\n\t\trequestVideo,\n\t\tendVideo,\n\t\tsetCustomerData,\n\t\tsetCallMetadata,\n\t\tsetTelnyxCallState,\n\t} = useUIStore();\n\n\tconst { clearTranscript } = useTranscriptStore();\n\n\t// WebRTC hook for accessing the actual call object\n\tconst webrtc = useTelnyxWebRTC({\n\t\tusername: process.env.NEXT_PUBLIC_TELNYX_SIP_USERNAME || \"\",\n\t\tpassword: process.env.NEXT_PUBLIC_TELNYX_SIP_PASSWORD || \"\",\n\t\tautoConnect: false,\n\t});\n\n\t// Real-time call quality monitoring\n\tconst { quality: connectionQuality, metrics: qualityMetrics } =\n\t\tuseCallQuality({\n\t\t\tcall: webrtc.currentCall as TelnyxCall | null,\n\t\t\tupdateInterval: 2000, // Update every 2 seconds\n\t\t});\n\n\t// Local state\n\tconst [_isReady, setIsReady] = useState(false);\n\tconst [isLoadingCustomer, setIsLoadingCustomer] = useState(false);\n\tconst [currentTime, setCurrentTime] = useState(0);\n\tconst [_showTransfer, setShowTransfer] = useState(false);\n\tconst [companyId, setCompanyId] = useState<string | null>(\n\t\tsearchParams?.get(\"companyId\") ?? null,\n\t);\n\tconst [leftPanelView, setLeftPanelView] = useState<\"transcript\" | \"schedule\">(\n\t\t\"schedule\",\n\t);\n\n\t// Enhanced state for Phase 1 & 2 components\n\tconst [showShortcutsHelp, setShowShortcutsHelp] = useState(false);\n\tconst [showWrapUpDialog, setShowWrapUpDialog] = useState(false);\n\tconst [holdStartTime, setHoldStartTime] = useState<number | undefined>();\n\tconst [recordingStartTime, setRecordingStartTime] = useState<number | undefined>();\n\tconst [callNotes, setCallNotes] = useState(\"\");\n\n\t// Refs for focus management\n\tconst mainContentRef = useRef<HTMLDivElement>(null);\n\n\t// Format call duration\n\tconst formatDuration = (seconds: number) => {\n\t\tconst mins = Math.floor(seconds / 60);\n\t\tconst secs = seconds % 60;\n\t\treturn `${mins}:${secs.toString().padStart(2, \"0\")}`;\n\t};\n\n\t// Quick action handlers for CustomerSidebar\n\tconst handleCreateJob = useCallback(() => {\n\t\t// Open job creation modal or navigate to job creation\n\t\tconsole.log(\"Create job for customer\");\n\t}, []);\n\n\tconst handleScheduleAppointment = useCallback(() => {\n\t\t// Open appointment scheduling\n\t\tsetLeftPanelView(\"schedule\");\n\t}, []);\n\n\tconst handleSendSMS = useCallback(() => {\n\t\t// Open SMS composer\n\t\tconsole.log(\"Send SMS to customer\");\n\t}, []);\n\n\tconst handleSendEmail = useCallback(() => {\n\t\t// Open email composer\n\t\tconsole.log(\"Send email to customer\");\n\t}, []);\n\n\tconst handleTakePayment = useCallback(() => {\n\t\t// Open payment modal\n\t\tconsole.log(\"Take payment from customer\");\n\t}, []);\n\n\tconst handleAddNote = useCallback(() => {\n\t\t// Focus on notes input\n\t\tconsole.log(\"Add note\");\n\t}, []);\n\n\t// Initialize call window\n\tuseEffect(() => {\n\t\tif (!callId) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Send ready message to main window\n\t\tsendToMain({\n\t\t\ttype: \"CALL_POP_OUT_READY\",\n\t\t\tcallId,\n\t\t\ttimestamp: Date.now(),\n\t\t});\n\n\t\tsetIsReady(true);\n\n\t\t// Set call metadata\n\t\tif (direction) {\n\t\t\tsetCallMetadata({\n\t\t\t\tcallControlId: callId,\n\t\t\t\tcallSessionId: callId,\n\t\t\t\tdirection,\n\t\t\t});\n\t\t}\n\t}, [callId, direction, setCallMetadata]);\n\n\t// Fetch customer data\n\tuseEffect(() => {\n\t\tif (!callId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst fetchCustomerData = async () => {\n\t\t\tsetIsLoadingCustomer(true);\n\n\t\t\ttry {\n\t\t\t\t// Resolve company ID from URL or cached state\n\t\t\t\tlet resolvedCompanyId =\n\t\t\t\t\tcompanyId ?? searchParams?.get(\"companyId\") ?? null;\n\n\t\t\t\t// Update state if we got it from URL params\n\t\t\t\tif (resolvedCompanyId && !companyId) {\n\t\t\t\t\tsetCompanyId(resolvedCompanyId);\n\t\t\t\t}\n\n\t\t\t\t// If not in URL, fetch from user session\n\t\t\t\tif (!resolvedCompanyId) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst { createClient } = await import(\"@/lib/supabase/client\");\n\t\t\t\t\t\tconst supabase = createClient();\n\t\t\t\t\t\tif (!supabase) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\tdata: { user },\n\t\t\t\t\t\t\terror: userError,\n\t\t\t\t\t\t} = await supabase.auth.getUser();\n\n\t\t\t\t\t\tif (userError) {\n\t\t\t\t\t\t\tconsole.error(\"Call window: Failed to get user:\", userError.message);\n\t\t\t\t\t\t\treturn; // Cannot proceed without user\n\t\t\t\t\t\t} else if (user) {\n\t\t\t\t\t\t\tconst { data: teamMembers, error: teamError } = await supabase\n\t\t\t\t\t\t\t\t.from(\"company_memberships\")\n\t\t\t\t\t\t\t\t.select(\"company_id, status, joined_at\")\n\t\t\t\t\t\t\t\t.eq(\"user_id\", user.id)\n\t\t\t\t\t\t\t\t.eq(\"status\", \"active\")\n\t\t\t\t\t\t\t\t.order(\"joined_at\", { ascending: false });\n\n\t\t\t\t\t\t\tif (teamError) {\n\t\t\t\t\t\t\t\tconsole.error(\"Call window: Failed to fetch team memberships:\", teamError.message);\n\t\t\t\t\t\t\t\treturn; // Cannot proceed without company context\n\t\t\t\t\t\t\t} else if (Array.isArray(teamMembers) && teamMembers.length > 0) {\n\t\t\t\t\t\t\t\tif (teamMembers.length > 1) {\n\t\t\t\t\t\t\t\t\t// User has multiple active memberships - using most recent\n\t\t\t\t\t\t\t\t\tconsole.info(\"Call window: User has multiple memberships, using most recent\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tconst activeMembership = teamMembers[0];\n\t\t\t\t\t\t\t\tif (activeMembership?.company_id) {\n\t\t\t\t\t\t\t\t\tresolvedCompanyId = activeMembership.company_id;\n\t\t\t\t\t\t\t\t\tsetCompanyId(activeMembership.company_id);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (_error) {}\n\t\t\t\t}\n\n\t\t\t\tif (!resolvedCompanyId) {\n\t\t\t\t\tsetIsLoadingCustomer(false);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet result;\n\t\t\t\tif (customerId) {\n\t\t\t\t\t// Outbound call - we know the customer\n\t\t\t\t\tresult = await getCustomerCallDataById(customerId, resolvedCompanyId);\n\t\t\t\t} else {\n\t\t\t\t\t// Inbound call - lookup by phone number\n\t\t\t\t\tconst callerNumber = call.caller?.number || searchParams?.get(\"from\");\n\t\t\t\t\tif (callerNumber) {\n\t\t\t\t\t\tresult = await getCustomerCallData(callerNumber, resolvedCompanyId);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (result?.success && result.data) {\n\t\t\t\t\tsetCustomerData(result.data);\n\t\t\t\t}\n\t\t\t} catch (_error) {\n\t\t\t} finally {\n\t\t\t\tsetIsLoadingCustomer(false);\n\t\t\t}\n\t\t};\n\n\t\tfetchCustomerData();\n\t}, [\n\t\tcallId,\n\t\tcustomerId,\n\t\tcall.caller?.number,\n\t\tsearchParams,\n\t\tsetCustomerData,\n\t\tcompanyId,\n\t]);\n\n\t// Update call timer\n\tuseEffect(() => {\n\t\tif (call.status !== \"active\" || !call.startTime) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst interval = setInterval(() => {\n\t\t\tsetCurrentTime(Math.floor((Date.now() - call.startTime!) / 1000));\n\t\t}, 1000);\n\n\t\treturn () => clearInterval(interval);\n\t}, [call.status, call.startTime]);\n\n\t// Handle messages from main window\n\tuseEffect(() => {\n\t\tconst handleMessage = (event: MessageEvent<PopOutMessage>) => {\n\t\t\tif (!verifyMessageOrigin(event)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!isPopOutMessage(event.data)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst message = event.data;\n\n\t\t\tswitch (message.type) {\n\t\t\t\tcase \"CALL_STATE_SYNC\":\n\t\t\t\t\t// Sync call state from main window\n\t\t\t\t\tif (message.callData) {\n\t\t\t\t\t\t// Call state sync is handled by the call store directly\n\t\t\t\t\t\t// This message type is reserved for future state synchronization needs\n\t\t\t\t\t\tconsole.debug(\"Call window: Received state sync\", message.callData);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"CALL_ACTION\":\n\t\t\t\t\t// Handle call actions from main window\n\t\t\t\t\tif (message.action === \"end\") {\n\t\t\t\t\t\tendCall();\n\t\t\t\t\t\tclearTranscript();\n\t\t\t\t\t} else if (message.action === \"mute\") {\n\t\t\t\t\t\ttoggleMute();\n\t\t\t\t\t} else if (message.action === \"unmute\") {\n\t\t\t\t\t\ttoggleMute();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"TRANSCRIPT_UPDATE\":\n\t\t\t\t\t// Transcript updates are handled by TranscriptPanel\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"CUSTOMER_DATA_UPDATE\":\n\t\t\t\t\tif (message.customerData) {\n\t\t\t\t\t\tsetCustomerData(message.customerData);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\n\t\twindow.addEventListener(\"message\", handleMessage);\n\t\treturn () => window.removeEventListener(\"message\", handleMessage);\n\t}, [endCall, toggleMute, clearTranscript, setCustomerData]);\n\n\t// Call action handlers\n\tconst handleCallAction = useCallback(\n\t\t(action: string) => {\n\t\t\tif (!callId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (action) {\n\t\t\t\tcase \"mute\":\n\t\t\t\tcase \"unmute\":\n\t\t\t\t\ttoggleMute();\n\t\t\t\t\tsendToMain({\n\t\t\t\t\t\ttype: \"CALL_ACTION\",\n\t\t\t\t\t\tcallId,\n\t\t\t\t\t\taction: call.isMuted ? \"unmute\" : \"mute\",\n\t\t\t\t\t\ttimestamp: Date.now(),\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"hold\":\n\t\t\t\tcase \"unhold\":\n\t\t\t\t\t// Track hold start time\n\t\t\t\t\tif (!call.isOnHold) {\n\t\t\t\t\t\tsetHoldStartTime(Date.now());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetHoldStartTime(undefined);\n\t\t\t\t\t}\n\t\t\t\t\ttoggleHold();\n\t\t\t\t\tsendToMain({\n\t\t\t\t\t\ttype: \"CALL_ACTION\",\n\t\t\t\t\t\tcallId,\n\t\t\t\t\t\taction: call.isOnHold ? \"unhold\" : \"hold\",\n\t\t\t\t\t\ttimestamp: Date.now(),\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"record_start\":\n\t\t\t\tcase \"record_stop\":\n\t\t\t\t\t// Track recording start time\n\t\t\t\t\tif (!call.isRecording) {\n\t\t\t\t\t\tsetRecordingStartTime(Date.now());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetRecordingStartTime(undefined);\n\t\t\t\t\t}\n\t\t\t\t\ttoggleRecording();\n\t\t\t\t\tsendToMain({\n\t\t\t\t\t\ttype: \"CALL_ACTION\",\n\t\t\t\t\t\tcallId,\n\t\t\t\t\t\taction: call.isRecording ? \"record_stop\" : \"record_start\",\n\t\t\t\t\t\ttimestamp: Date.now(),\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"end\":\n\t\t\t\t\t// Show wrap-up dialog before ending\n\t\t\t\t\tsetShowWrapUpDialog(true);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"force_end\":\n\t\t\t\t\t// Force end without wrap-up (used after completing wrap-up)\n\t\t\t\t\tendCall();\n\t\t\t\t\tclearTranscript();\n\t\t\t\t\tsendToMain({\n\t\t\t\t\t\ttype: \"CALL_ACTION\",\n\t\t\t\t\t\tcallId,\n\t\t\t\t\t\taction: \"end\",\n\t\t\t\t\t\ttimestamp: Date.now(),\n\t\t\t\t\t});\n\t\t\t\t\t// Close window after a short delay\n\t\t\t\t\tsetTimeout(() => window.close(), 500);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\t[\n\t\t\tcallId,\n\t\t\tcall.isMuted,\n\t\t\tcall.isOnHold,\n\t\t\tcall.isRecording,\n\t\t\ttoggleMute,\n\t\t\ttoggleHold,\n\t\t\ttoggleRecording,\n\t\t\tendCall,\n\t\t\tclearTranscript,\n\t\t],\n\t);\n\n\t// Handle wrap-up completion\n\tconst handleWrapUpComplete = useCallback(\n\t\t(data: {\n\t\t\tdisposition: string;\n\t\t\tnotes: string;\n\t\t\tfollowUp: {\n\t\t\t\tenabled: boolean;\n\t\t\t\ttype: string;\n\t\t\t\tdate?: Date;\n\t\t\t\tnotes?: string;\n\t\t\t};\n\t\t\tsendConfirmation: boolean;\n\t\t\tcreateJob: boolean;\n\t\t}) => {\n\t\t\t// Save wrap-up data\n\t\t\tconsole.log(\"Call wrap-up data:\", data);\n\t\t\tsetCallNotes(data.notes);\n\n\t\t\t// Now actually end the call\n\t\t\thandleCallAction(\"force_end\");\n\t\t\tsetShowWrapUpDialog(false);\n\t\t},\n\t\t[handleCallAction],\n\t);\n\n\t// Handle wrap-up cancel (user wants to continue call)\n\tconst handleWrapUpCancel = useCallback(() => {\n\t\tsetShowWrapUpDialog(false);\n\t}, []);\n\n\tconst handleVideoToggle = useCallback(() => {\n\t\tif (!callId) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (call.videoStatus === \"off\") {\n\t\t\trequestVideo();\n\t\t\tsendToMain({\n\t\t\t\ttype: \"CALL_ACTION\",\n\t\t\t\tcallId,\n\t\t\t\taction: \"video_on\",\n\t\t\t\ttimestamp: Date.now(),\n\t\t\t});\n\t\t} else {\n\t\t\tendVideo();\n\t\t\tsendToMain({\n\t\t\t\ttype: \"CALL_ACTION\",\n\t\t\t\tcallId,\n\t\t\t\taction: \"video_off\",\n\t\t\t\ttimestamp: Date.now(),\n\t\t\t});\n\t\t}\n\t}, [callId, call.videoStatus, requestVideo, endVideo]);\n\n\tconst handleTransfer = useCallback(() => {\n\t\tsetShowTransfer(true);\n\t\t// Transfer functionality would be implemented here\n\t}, []);\n\n\tconst handleClose = useCallback(() => {\n\t\twindow.close();\n\t}, []);\n\n\t// Keyboard shortcuts\n\tuseCallShortcuts(\n\t\t{\n\t\t\tonToggleMute: () => handleCallAction(call.isMuted ? \"unmute\" : \"mute\"),\n\t\t\tonToggleHold: () => handleCallAction(call.isOnHold ? \"unhold\" : \"hold\"),\n\t\t\tonToggleRecording: () =>\n\t\t\t\thandleCallAction(call.isRecording ? \"record_stop\" : \"record_start\"),\n\t\t\tonEndCall: () => handleCallAction(\"end\"),\n\t\t\tonCreateJob: handleCreateJob,\n\t\t\tonScheduleAppointment: handleScheduleAppointment,\n\t\t\tonSendSMS: handleSendSMS,\n\t\t\tonSendEmail: handleSendEmail,\n\t\t\tonFocusNotes: handleAddNote,\n\t\t\tonShowHelp: () => setShowShortcutsHelp(true),\n\t\t\tonViewTranscript: () => setLeftPanelView(\"transcript\"),\n\t\t\tonViewSchedule: () => setLeftPanelView(\"schedule\"),\n\t\t\tonEscape: () => {\n\t\t\t\t// Close any open dialogs\n\t\t\t\tif (showShortcutsHelp) setShowShortcutsHelp(false);\n\t\t\t\tif (showWrapUpDialog) setShowWrapUpDialog(false);\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tenabled: call.status === \"active\",\n\t\t},\n\t);\n\n\t// Error states\n\tif (!callId) {\n\t\treturn (\n\t\t\t<div className=\"bg-background flex h-screen items-center justify-center\">\n\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t<AlertCircle className=\"text-destructive mx-auto mb-4 h-12 w-12\" />\n\t\t\t\t\t<h1 className=\"mb-2 text-2xl font-bold\">Invalid Call</h1>\n\t\t\t\t\t<p className=\"text-muted-foreground\">No call ID provided</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tconst isActive = call.status === \"active\";\n\tconst customerData = call.customerData as CustomerCallData | null;\n\n\t// Get caller name from customer data or call data\n\tconst callerName =\n\t\tcustomerData?.customer?.first_name && customerData?.customer?.last_name\n\t\t\t? `${customerData.customer.first_name} ${customerData.customer.last_name}`.trim()\n\t\t\t: customerData?.customer?.first_name\n\t\t\t\t? customerData.customer.first_name\n\t\t\t\t: call.caller?.name || \"Unknown Caller\";\n\n\t// Get caller number from customer data or call data\n\tconst callerNumber =\n\t\tcustomerData?.customer?.phone || call.caller?.number || \"No number\";\n\n\treturn (\n\t\t<div className=\"bg-background flex h-screen flex-col\">\n\t\t\t{/* Accessibility: Skip link */}\n\t\t\t<SkipLink />\n\n\t\t\t{/* Toolbar */}\n\t\t\t<CallToolbar\n\t\t\t\tcallDuration={formatDuration(currentTime)}\n\t\t\t\tcallerName={callerName}\n\t\t\t\tcallerNumber={callerNumber}\n\t\t\t\tcallId={callId}\n\t\t\t\tconnectionQuality={connectionQuality || \"unknown\"}\n\t\t\t\tcustomerData={customerData}\n\t\t\t\tisActive={isActive}\n\t\t\t\tisMuted={call.isMuted}\n\t\t\t\tisOnHold={call.isOnHold}\n\t\t\t\tisRecording={call.isRecording}\n\t\t\t\tholdStartTime={holdStartTime}\n\t\t\t\trecordingStartTime={recordingStartTime}\n\t\t\t\tonClose={handleClose}\n\t\t\t\tonEndCall={() => handleCallAction(\"end\")}\n\t\t\t\tonHoldToggle={() => handleCallAction(call.isOnHold ? \"unhold\" : \"hold\")}\n\t\t\t\tonMuteToggle={() => handleCallAction(call.isMuted ? \"unmute\" : \"mute\")}\n\t\t\t\tonRecordToggle={() =>\n\t\t\t\t\thandleCallAction(call.isRecording ? \"record_stop\" : \"record_start\")\n\t\t\t\t}\n\t\t\t\tonTransfer={handleTransfer}\n\t\t\t\tonVideoToggle={handleVideoToggle}\n\t\t\t\tonShowShortcuts={() => setShowShortcutsHelp(true)}\n\t\t\t\tvideoStatus={call.videoStatus}\n\t\t\t/>\n\n\t\t\t{/* Main Content */}\n\t\t\t<main\n\t\t\t\tid=\"main-content\"\n\t\t\t\tref={mainContentRef}\n\t\t\t\tclassName=\"flex flex-1 overflow-hidden\"\n\t\t\t\trole=\"main\"\n\t\t\t\taria-label=\"Call window main content\"\n\t\t\t>\n\t\t\t\t{/* Left: Transcript/Schedule (35%) */}\n\t\t\t\t<section\n\t\t\t\t\tclassName=\"bg-muted/20 flex w-[35%] flex-col\"\n\t\t\t\t\taria-label={leftPanelView === \"transcript\" ? \"Call transcript\" : \"Schedule view\"}\n\t\t\t\t>\n\t\t\t\t\t{/* Toggle Buttons */}\n\t\t\t\t\t<div className=\"bg-card/50 flex border-b\" role=\"tablist\" aria-label=\"View selection\">\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tclassName=\"flex-1 rounded-none border-r\"\n\t\t\t\t\t\t\tonClick={() => setLeftPanelView(\"transcript\")}\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tvariant={leftPanelView === \"transcript\" ? \"secondary\" : \"ghost\"}\n\t\t\t\t\t\t\trole=\"tab\"\n\t\t\t\t\t\t\taria-selected={leftPanelView === \"transcript\"}\n\t\t\t\t\t\t\taria-controls=\"left-panel-content\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<MessageSquare className=\"mr-2 h-4 w-4\" aria-hidden=\"true\" />\n\t\t\t\t\t\t\tTranscript\n\t\t\t\t\t\t\t<span className=\"sr-only\">(Press T)</span>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tclassName=\"flex-1 rounded-none\"\n\t\t\t\t\t\t\tonClick={() => setLeftPanelView(\"schedule\")}\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tvariant={leftPanelView === \"schedule\" ? \"secondary\" : \"ghost\"}\n\t\t\t\t\t\t\trole=\"tab\"\n\t\t\t\t\t\t\taria-selected={leftPanelView === \"schedule\"}\n\t\t\t\t\t\t\taria-controls=\"left-panel-content\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<CalendarDays className=\"mr-2 h-4 w-4\" aria-hidden=\"true\" />\n\t\t\t\t\t\t\tSchedule\n\t\t\t\t\t\t\t<span className=\"sr-only\">(Press S)</span>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Content */}\n\t\t\t\t\t<div\n\t\t\t\t\t\tid=\"left-panel-content\"\n\t\t\t\t\t\tclassName=\"flex-1 overflow-hidden\"\n\t\t\t\t\t\trole=\"tabpanel\"\n\t\t\t\t\t\taria-label={leftPanelView === \"transcript\" ? \"Call transcript panel\" : \"Schedule panel\"}\n\t\t\t\t\t>\n\t\t\t\t\t\t{leftPanelView === \"transcript\" ? (\n\t\t\t\t\t\t\t<TranscriptPanel />\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<CSRScheduleView companyId={companyId || undefined} />\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</section>\n\n\t\t\t\t{/* Right: Customer Sidebar (65% - Full Height) */}\n\t\t\t\t<section\n\t\t\t\t\tclassName=\"flex-1 overflow-hidden\"\n\t\t\t\t\taria-label=\"Customer information\"\n\t\t\t\t>\n\t\t\t\t\t<CustomerSidebar\n\t\t\t\t\t\tcustomerData={customerData}\n\t\t\t\t\t\tisLoading={isLoadingCustomer}\n\t\t\t\t\t\tonCreateJob={handleCreateJob}\n\t\t\t\t\t\tonScheduleAppointment={handleScheduleAppointment}\n\t\t\t\t\t\tonSendSMS={handleSendSMS}\n\t\t\t\t\t\tonSendEmail={handleSendEmail}\n\t\t\t\t\t\tonTakePayment={handleTakePayment}\n\t\t\t\t\t\tonAddNote={handleAddNote}\n\t\t\t\t\t/>\n\t\t\t\t</section>\n\t\t\t</main>\n\n\t\t\t{/* Dialogs */}\n\t\t\t<KeyboardShortcutsHelp\n\t\t\t\topen={showShortcutsHelp}\n\t\t\t\tonOpenChange={setShowShortcutsHelp}\n\t\t\t/>\n\n\t\t\t<CallWrapUpDialog\n\t\t\t\topen={showWrapUpDialog}\n\t\t\t\tonOpenChange={setShowWrapUpDialog}\n\t\t\t\tonComplete={handleWrapUpComplete}\n\t\t\t\tonCancel={handleWrapUpCancel}\n\t\t\t\tcallDuration={currentTime}\n\t\t\t\tcustomerName={callerName}\n\t\t\t\texistingNotes={callNotes}\n\t\t\t/>\n\t\t</div>\n\t);\n}\n\nexport default function CallWindowPage() {\n\treturn (\n\t\t<Suspense fallback={<CallWindowSkeleton />}>\n\t\t\t<CallWindowContent />\n\t\t</Suspense>\n\t);\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"600f2001e85494de7547a5213c6143dced69476baf\":\"getCustomerCallData\"},\"apps/web/src/actions/call-customer-data.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var getCustomerCallData=/*#__PURE__*/createServerReference(\"600f2001e85494de7547a5213c6143dced69476baf\",callServer,void 0,findSourceMapURL,\"getCustomerCallData\");","/* __next_internal_action_entry_do_not_use__ [{\"60e51c1544e88202aee90bf80bbe297c22b52e59cc\":\"getCustomerCallDataById\"},\"apps/web/src/actions/call-customer-data.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var getCustomerCallDataById=/*#__PURE__*/createServerReference(\"60e51c1544e88202aee90bf80bbe297c22b52e59cc\",callServer,void 0,findSourceMapURL,\"getCustomerCallDataById\");","\"use client\";\n\n/**\n * Call Toolbar Component - Enhanced for CSR Efficiency\n *\n * Top toolbar for call window with all call controls, customer info, and actions.\n *\n * Enhanced features:\n * - Prominent mute indicator (full-width banner when muted)\n * - Hold timer display\n * - Recording duration and indicator\n * - Keyboard shortcut hints on hover\n * - Visual pulse animations for active states\n */\n\nimport {\n\tArrowRightLeft,\n\tCircle,\n\tKeyboard,\n\tMic,\n\tMicOff,\n\tPause,\n\tPhoneOff,\n\tPlay,\n\tSignal,\n\tSquare,\n\tTimer,\n\tVideo,\n\tVideoOff,\n\tWifi,\n\tWifiOff,\n\tX,\n} from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { cn } from \"@/lib/utils\";\nimport type { CustomerCallData } from \"@/types/call\";\n\ntype CallToolbarProps = {\n\t// Call state\n\tcallId: string;\n\tisActive: boolean;\n\tisMuted: boolean;\n\tisOnHold: boolean;\n\tisRecording: boolean;\n\tvideoStatus: \"off\" | \"requesting\" | \"ringing\" | \"connected\" | \"declined\";\n\tconnectionQuality: \"excellent\" | \"good\" | \"poor\" | \"unknown\";\n\tcallDuration: string;\n\n\t// Enhanced state tracking\n\tholdStartTime?: number; // Timestamp when hold started\n\trecordingStartTime?: number; // Timestamp when recording started\n\n\t// Customer data\n\tcustomerData: CustomerCallData | null;\n\tcallerName: string;\n\tcallerNumber: string;\n\n\t// Actions\n\tonMuteToggle: () => void;\n\tonHoldToggle: () => void;\n\tonRecordToggle: () => void;\n\tonVideoToggle: () => void;\n\tonTransfer: () => void;\n\tonEndCall: () => void;\n\tonClose: () => void;\n\tonShowShortcuts?: () => void;\n};\n\nexport function CallToolbar({\n\tcallId,\n\tisActive,\n\tisMuted,\n\tisOnHold,\n\tisRecording,\n\tvideoStatus,\n\tconnectionQuality,\n\tcallDuration,\n\tholdStartTime,\n\trecordingStartTime,\n\tcustomerData,\n\tcallerName,\n\tcallerNumber,\n\tonMuteToggle,\n\tonHoldToggle,\n\tonRecordToggle,\n\tonVideoToggle,\n\tonTransfer,\n\tonEndCall,\n\tonClose,\n\tonShowShortcuts,\n}: CallToolbarProps) {\n\tconst [_showMoreMenu, _setShowMoreMenu] = useState(false);\n\n\t// Track hold duration\n\tconst [holdDuration, setHoldDuration] = useState(0);\n\tuseEffect(() => {\n\t\tif (!isOnHold || !holdStartTime) {\n\t\t\tsetHoldDuration(0);\n\t\t\treturn;\n\t\t}\n\n\t\tconst interval = setInterval(() => {\n\t\t\tsetHoldDuration(Math.floor((Date.now() - holdStartTime) / 1000));\n\t\t}, 1000);\n\n\t\treturn () => clearInterval(interval);\n\t}, [isOnHold, holdStartTime]);\n\n\t// Track recording duration\n\tconst [recordingDuration, setRecordingDuration] = useState(0);\n\tuseEffect(() => {\n\t\tif (!isRecording || !recordingStartTime) {\n\t\t\tsetRecordingDuration(0);\n\t\t\treturn;\n\t\t}\n\n\t\tconst interval = setInterval(() => {\n\t\t\tsetRecordingDuration(Math.floor((Date.now() - recordingStartTime) / 1000));\n\t\t}, 1000);\n\n\t\treturn () => clearInterval(interval);\n\t}, [isRecording, recordingStartTime]);\n\n\t// Format duration helper\n\tconst formatTimerDuration = (seconds: number): string => {\n\t\tconst mins = Math.floor(seconds / 60);\n\t\tconst secs = seconds % 60;\n\t\treturn `${mins}:${secs.toString().padStart(2, \"0\")}`;\n\t};\n\n\t// Get initials for avatar\n\tconst getInitials = (name: string) => {\n\t\tif (!name || name === \"Unknown Caller\") {\n\t\t\treturn \"?\";\n\t\t}\n\t\treturn name\n\t\t\t.split(\" \")\n\t\t\t.map((n) => n[0])\n\t\t\t.join(\"\")\n\t\t\t.toUpperCase()\n\t\t\t.slice(0, 2);\n\t};\n\n\t// Get connection quality icon and color\n\tconst getConnectionIcon = () => {\n\t\tswitch (connectionQuality) {\n\t\t\tcase \"excellent\":\n\t\t\t\treturn <Signal className=\"text-success h-3 w-3\" />;\n\t\t\tcase \"good\":\n\t\t\t\treturn <Wifi className=\"text-warning h-3 w-3\" />;\n\t\t\tcase \"poor\":\n\t\t\t\treturn <WifiOff className=\"text-destructive h-3 w-3\" />;\n\t\t\tdefault:\n\t\t\t\treturn <Signal className=\"text-muted-foreground h-3 w-3\" />;\n\t\t}\n\t};\n\n\t// Get connection quality badge variant\n\tconst getQualityVariant = () => {\n\t\tswitch (connectionQuality) {\n\t\t\tcase \"excellent\":\n\t\t\t\treturn \"default\";\n\t\t\tcase \"good\":\n\t\t\t\treturn \"secondary\";\n\t\t\tcase \"poor\":\n\t\t\t\treturn \"destructive\";\n\t\t\tdefault:\n\t\t\t\treturn \"outline\";\n\t\t}\n\t};\n\n\tconst customerAvatar =\n\t\tcustomerData?.customer &&\n\t\ttypeof customerData.customer === \"object\" &&\n\t\t\"avatar_url\" in customerData.customer\n\t\t\t? ((customerData.customer as { avatar_url?: string }).avatar_url ??\n\t\t\t\tundefined)\n\t\t\t: undefined;\n\n\treturn (\n\t\t<TooltipProvider delayDuration={300}>\n\t\t\t<div className=\"relative\">\n\t\t\t\t{/* Mute Banner - Full width when muted */}\n\t\t\t\t{isMuted && (\n\t\t\t\t\t<div className=\"bg-destructive/10 border-destructive/30 flex items-center justify-center gap-2 border-b px-4 py-2\">\n\t\t\t\t\t\t<MicOff className=\"text-destructive h-4 w-4 animate-pulse\" />\n\t\t\t\t\t\t<span className=\"text-destructive text-sm font-medium\">\n\t\t\t\t\t\t\tYou are muted\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span className=\"text-destructive/70 text-xs\">\n\t\t\t\t\t\t\tPress M to unmute\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\n\t\t\t\t{/* Hold Banner - Full width when on hold */}\n\t\t\t\t{isOnHold && (\n\t\t\t\t\t<div className=\"bg-warning/10 border-warning/30 flex items-center justify-center gap-2 border-b px-4 py-2\">\n\t\t\t\t\t\t<Timer className=\"text-warning h-4 w-4\" />\n\t\t\t\t\t\t<span className=\"text-warning text-sm font-medium\">\n\t\t\t\t\t\t\tCall on hold\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<Badge variant=\"outline\" className=\"text-warning border-warning/50 font-mono text-xs\">\n\t\t\t\t\t\t\t{formatTimerDuration(holdDuration)}\n\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t<span className=\"text-warning/70 text-xs\">\n\t\t\t\t\t\t\tPress H to resume\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\n\t\t\t\t<div className=\"bg-card/50 flex items-center justify-between px-6 py-3 backdrop-blur-sm\">\n\t\t\t\t\t{/* Left: Customer Info */}\n\t\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t<Avatar className=\"h-11 w-11\">\n\t\t\t\t\t\t\t\t<AvatarImage src={customerAvatar} />\n\t\t\t\t\t\t\t\t<AvatarFallback\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"text-base font-semibold transition-all\",\n\t\t\t\t\t\t\t\t\t\tisActive\n\t\t\t\t\t\t\t\t\t\t\t? \"bg-emerald-500/20 text-emerald-600 ring-2 ring-emerald-500/30\"\n\t\t\t\t\t\t\t\t\t\t\t: \"bg-muted text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{getInitials(callerName)}\n\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t{isActive && (\n\t\t\t\t\t\t\t\t<div className=\"ring-background absolute -top-0.5 -right-0.5 h-3 w-3 rounded-full bg-emerald-500 ring-2\" />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"space-y-0.5\">\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<span className=\"text-foreground text-sm font-semibold\">\n\t\t\t\t\t\t\t\t\t{callerName}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t{isActive && (\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground font-mono text-xs tabular-nums\">\n\t\t\t\t\t\t\t\t\t\t\t{callDuration}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t{isRecording && (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Circle className=\"size-2 animate-pulse fill-red-500 text-red-500\" />\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-destructive font-mono text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tREC {formatTimerDuration(recordingDuration)}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground font-mono text-xs\">\n\t\t\t\t\t\t\t\t\t{callerNumber}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t{customerData?.isKnownCustomer && (\n\t\t\t\t\t\t\t\t\t<Badge className=\"h-4 px-1.5 text-[10px]\" variant=\"outline\">\n\t\t\t\t\t\t\t\t\t\tCustomer\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Center: Call Controls */}\n\t\t\t\t\t<div className=\"flex items-center justify-center gap-2\">\n\t\t\t\t\t\t{/* Mute */}\n\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"h-10 w-10 rounded-full transition-all hover:scale-105\",\n\t\t\t\t\t\t\t\t\t\tisMuted && \"ring-destructive/50 ring-2 ring-offset-2\",\n\t\t\t\t\t\t\t\t\t\t!isMuted && \"hover:bg-muted\",\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\tonClick={onMuteToggle}\n\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\tvariant={isMuted ? \"destructive\" : \"ghost\"}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{isMuted ? (\n\t\t\t\t\t\t\t\t\t\t<MicOff className=\"size-4 animate-pulse\" />\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<Mic className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent side=\"bottom\">\n\t\t\t\t\t\t\t\t<p>{isMuted ? \"Unmute\" : \"Mute\"}</p>\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">Press M</p>\n\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t{/* Hold */}\n\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"h-10 w-10 rounded-full transition-all hover:scale-105\",\n\t\t\t\t\t\t\t\t\t\tisOnHold && \"ring-warning/50 ring-2 ring-offset-2\",\n\t\t\t\t\t\t\t\t\t\t!isOnHold && \"hover:bg-muted\",\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\tonClick={onHoldToggle}\n\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\tvariant={isOnHold ? \"secondary\" : \"ghost\"}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{isOnHold ? (\n\t\t\t\t\t\t\t\t\t\t<Play className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<Pause className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent side=\"bottom\">\n\t\t\t\t\t\t\t\t<p>{isOnHold ? \"Resume\" : \"Hold\"}</p>\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">Press H</p>\n\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t{/* Record */}\n\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"h-10 w-10 rounded-full transition-all hover:scale-105\",\n\t\t\t\t\t\t\t\t\t\tisRecording && \"ring-destructive/50 ring-2 ring-offset-2\",\n\t\t\t\t\t\t\t\t\t\t!isRecording && \"hover:bg-muted\",\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\tonClick={onRecordToggle}\n\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\tvariant={isRecording ? \"destructive\" : \"ghost\"}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{isRecording ? (\n\t\t\t\t\t\t\t\t\t\t<Circle className=\"size-4 animate-pulse fill-current\" />\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<Square className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent side=\"bottom\">\n\t\t\t\t\t\t\t\t<p>{isRecording ? \"Stop Recording\" : \"Record\"}</p>\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">Press R</p>\n\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t<div className=\"bg-border mx-2 h-6 w-px\" />\n\n\t\t\t\t\t\t{/* Video */}\n\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"h-10 w-10 rounded-full transition-all hover:scale-105\",\n\t\t\t\t\t\t\t\t\t\tvideoStatus === \"off\" && \"hover:bg-muted\",\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\tonClick={onVideoToggle}\n\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\tvariant={videoStatus === \"connected\" ? \"default\" : \"ghost\"}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{videoStatus === \"connected\" ? (\n\t\t\t\t\t\t\t\t\t\t<Video className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<VideoOff className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent side=\"bottom\">\n\t\t\t\t\t\t\t\t<p>{videoStatus === \"connected\" ? \"End Video\" : \"Start Video\"}</p>\n\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t{/* Transfer */}\n\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName=\"hover:bg-muted h-10 w-10 rounded-full transition-all hover:scale-105\"\n\t\t\t\t\t\t\t\t\tonClick={onTransfer}\n\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<ArrowRightLeft className=\"size-4\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent side=\"bottom\">\n\t\t\t\t\t\t\t\t<p>Transfer Call</p>\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">Press T</p>\n\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t<div className=\"bg-border mx-2 h-6 w-px\" />\n\n\t\t\t\t\t\t{/* End Call */}\n\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName=\"text-destructive-foreground h-12 w-12 rounded-full transition-all hover:scale-105\"\n\t\t\t\t\t\t\t\t\tonClick={onEndCall}\n\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<PhoneOff className=\"size-5\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent side=\"bottom\">\n\t\t\t\t\t\t\t\t<p>End Call</p>\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">Press Shift+E</p>\n\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Right: Connection Quality, Shortcuts & Close */}\n\t\t\t\t\t<div className=\"flex items-center gap-1.5\">\n\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\tclassName=\"font-mono text-[10px]\"\n\t\t\t\t\t\t\ttitle={\n\t\t\t\t\t\t\t\tconnectionQuality === \"unknown\"\n\t\t\t\t\t\t\t\t\t? \"Monitoring connection quality...\"\n\t\t\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvariant={getQualityVariant() as any}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{getConnectionIcon()}\n\t\t\t\t\t\t\t<span className=\"ml-1 capitalize\">{connectionQuality}</span>\n\t\t\t\t\t\t</Badge>\n\n\t\t\t\t\t\t{/* Keyboard Shortcuts Button */}\n\t\t\t\t\t\t{onShowShortcuts && (\n\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 w-8\"\n\t\t\t\t\t\t\t\t\t\tonClick={onShowShortcuts}\n\t\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Keyboard className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t<TooltipContent side=\"bottom\">\n\t\t\t\t\t\t\t\t\t<p>Keyboard Shortcuts</p>\n\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">Press ?</p>\n\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tclassName=\"h-8 w-8\"\n\t\t\t\t\t\t\tonClick={onClose}\n\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<X className=\"h-4 w-4\" />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</TooltipProvider>\n\t);\n}\n","\"use client\";\n\n/**\n * Customer Sidebar Component - Enhanced for CSR Efficiency\n *\n * Left sidebar showing customer data, jobs, invoices, appointments, etc.\n *\n * Enhanced features:\n * - Alert banner for critical customer information\n * - Sticky stats bar always visible\n * - Previous call summary for context\n * - Quick actions panel\n * - Reorganized sections for faster access\n */\n\nimport {\n\tAlertCircle,\n\tBriefcase,\n\tBuilding2,\n\tCalendar,\n\tFacebook,\n\tFileText,\n\tGlobe,\n\tHome,\n\tLightbulb,\n\tLinkedin,\n\tMail,\n\tMapPin,\n\tPhone,\n\tPlus,\n\tSave,\n\tTwitter,\n\tUser,\n\tWrench,\n\tX,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport {\n\tStandardFormField,\n\tStandardFormRow,\n} from \"@/components/ui/standard-form-field\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n\tUnifiedAccordion,\n\ttype UnifiedAccordionSection,\n} from \"@/components/ui/unified-accordion\";\nimport type { CustomerCallData } from \"@/types/call\";\nimport { DEFAULT_CSR_REMINDERS } from \"@/types/csr-reminders\";\n\nimport { CustomerAlertBanner } from \"./customer-alert-banner\";\nimport { CustomerStatsBar } from \"./customer-stats-bar\";\nimport { PreviousCallSummary } from \"./previous-call-summary\";\nimport { QuickActionsPanel } from \"./quick-actions-panel\";\n\ntype CustomerSidebarProps = {\n\tcustomerData: CustomerCallData | null;\n\tisLoading?: boolean;\n\t// Quick action handlers\n\tonCreateJob?: () => void;\n\tonScheduleAppointment?: () => void;\n\tonSendSMS?: () => void;\n\tonSendEmail?: () => void;\n\tonTakePayment?: () => void;\n\tonAddNote?: () => void;\n\t// Previous call data\n\tpreviousCall?: {\n\t\tid: string;\n\t\tdate: string;\n\t\tduration: number;\n\t\tdisposition: string;\n\t\tcsrName: string;\n\t\tnotes?: string;\n\t\ttopics?: string[];\n\t\tsentiment?: \"positive\" | \"neutral\" | \"negative\";\n\t\tfollowUpScheduled?: boolean;\n\t\tissueResolved?: boolean;\n\t} | null;\n};\n\nexport function CustomerSidebar({\n\tcustomerData,\n\tisLoading,\n\tonCreateJob,\n\tonScheduleAppointment,\n\tonSendSMS,\n\tonSendEmail,\n\tonTakePayment,\n\tonAddNote,\n\tpreviousCall,\n}: CustomerSidebarProps) {\n\t// TODO: Fetch CSR reminders from user settings/company settings\n\t// For now, use default reminders\n\tconst csrReminders = DEFAULT_CSR_REMINDERS.filter((r) => r.enabled).sort(\n\t\t(a, b) => a.order - b.order,\n\t);\n\n\t// Calculate open balance from unpaid invoices\n\tconst openBalance = customerData?.invoices\n\t\t.filter((inv) => inv.status === \"unpaid\" || inv.status === \"overdue\")\n\t\t.reduce((sum, inv) => sum + (inv.total_amount || 0), 0) || 0;\n\n\t// Get last visit date from appointments or jobs\n\tconst lastVisitDate = customerData?.jobs\n\t\t.filter((job) => job.status === \"completed\")\n\t\t.sort((a, b) => {\n\t\t\tconst dateA = a.completed_at || a.updated_at || \"\";\n\t\t\tconst dateB = b.completed_at || b.updated_at || \"\";\n\t\t\treturn new Date(dateB).getTime() - new Date(dateA).getTime();\n\t\t})[0]?.completed_at || null;\n\n\tif (isLoading) {\n\t\treturn (\n\t\t\t<div className=\"flex h-full items-center justify-center p-6\">\n\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t<div className=\"border-primary mx-auto mb-4 h-12 w-12 animate-spin rounded-full border-4 border-t-transparent\" />\n\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\tLoading customer data...\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tif (!customerData) {\n\t\treturn (\n\t\t\t<div className=\"flex h-full items-center justify-center p-6\">\n\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t<AlertCircle className=\"text-muted-foreground mx-auto mb-4 h-12 w-12\" />\n\t\t\t\t\t<p className=\"text-foreground font-medium\">No customer data</p>\n\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-sm\">\n\t\t\t\t\t\tCustomer information will appear here\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tconst {\n\t\tcustomer,\n\t\tstats,\n\t\tjobs,\n\t\tinvoices,\n\t\testimates,\n\t\tappointments,\n\t\tproperties,\n\t\tequipment,\n\t} = customerData;\n\n\t// Format currency\n\tconst formatCurrency = (amount: number) =>\n\t\tnew Intl.NumberFormat(\"en-US\", {\n\t\t\tstyle: \"currency\",\n\t\t\tcurrency: \"USD\",\n\t\t}).format(amount);\n\n\t// Format date\n\tconst formatDate = (date: string | null) => {\n\t\tif (!date) {\n\t\t\treturn \"N/A\";\n\t\t}\n\t\treturn new Date(date).toLocaleDateString(\"en-US\", {\n\t\t\tmonth: \"short\",\n\t\t\tday: \"numeric\",\n\t\t\tyear: \"numeric\",\n\t\t});\n\t};\n\n\t// State for editable customer data\n\tconst [phoneNumbers, setPhoneNumbers] = useState<string[]>(\n\t\tcustomer?.phone ? [customer.phone] : [\"\"],\n\t);\n\tconst [emailAddresses, setEmailAddresses] = useState<string[]>(\n\t\tcustomer?.email ? [customer.email] : [\"\"],\n\t);\n\n\t// Add/remove phone numbers\n\tconst addPhoneNumber = () => setPhoneNumbers([...phoneNumbers, \"\"]);\n\tconst removePhoneNumber = (index: number) => {\n\t\tsetPhoneNumbers(phoneNumbers.filter((_, i) => i !== index));\n\t};\n\tconst updatePhoneNumber = (index: number, value: string) => {\n\t\tconst updated = [...phoneNumbers];\n\t\tupdated[index] = value;\n\t\tsetPhoneNumbers(updated);\n\t};\n\n\t// Add/remove email addresses\n\tconst addEmailAddress = () => setEmailAddresses([...emailAddresses, \"\"]);\n\tconst removeEmailAddress = (index: number) => {\n\t\tsetEmailAddresses(emailAddresses.filter((_, i) => i !== index));\n\t};\n\tconst updateEmailAddress = (index: number, value: string) => {\n\t\tconst updated = [...emailAddresses];\n\t\tupdated[index] = value;\n\t\tsetEmailAddresses(updated);\n\t};\n\n\t// Save customer data\n\tconst handleSaveCustomer = async () => {\n\t\t// TODO: Implement save logic\n\t};\n\n\t// Build sections array for UnifiedAccordion\n\tconst sections: UnifiedAccordionSection[] = [\n\t\t// Customer Overview - Fully Editable\n\t\t{\n\t\t\tid: \"overview\",\n\t\t\ttitle: \"Customer Overview\",\n\t\t\ticon: <User className=\"h-4 w-4\" />,\n\t\t\tactions: (\n\t\t\t\t<Button\n\t\t\t\t\tclassName=\"h-8 gap-1.5 px-3\"\n\t\t\t\t\tonClick={handleSaveCustomer}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"default\"\n\t\t\t\t>\n\t\t\t\t\t<Save className=\"h-3.5 w-3.5\" />\n\t\t\t\t\tSave\n\t\t\t\t</Button>\n\t\t\t),\n\t\t\tcontent: (\n\t\t\t\t<div className=\"space-y-6 p-6\">\n\t\t\t\t\t{/* Basic Information */}\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<h4 className=\"text-sm font-semibold\">Basic Information</h4>\n\n\t\t\t\t\t\t<StandardFormRow cols={2}>\n\t\t\t\t\t\t\t<StandardFormField label=\"First Name\" htmlFor=\"firstName\">\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tdefaultValue={customer?.first_name || \"\"}\n\t\t\t\t\t\t\t\t\tid=\"firstName\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"Enter first name\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t\t\t<StandardFormField label=\"Last Name\" htmlFor=\"lastName\">\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tdefaultValue={customer?.last_name || \"\"}\n\t\t\t\t\t\t\t\t\tid=\"lastName\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"Enter last name\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t\t</StandardFormRow>\n\n\t\t\t\t\t\t<StandardFormField label=\"Company\" htmlFor=\"company\">\n\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t<Building2 className=\"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2\" />\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tclassName=\"pl-9\"\n\t\t\t\t\t\t\t\t\tdefaultValue={customer?.company_name || \"\"}\n\t\t\t\t\t\t\t\t\tid=\"company\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"Enter company name\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Contact Information */}\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t<h4 className=\"text-sm font-semibold\">Contact Information</h4>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* Email Addresses */}\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label>Email Addresses</Label>\n\t\t\t\t\t\t\t{emailAddresses.map((email, index) => (\n\t\t\t\t\t\t\t\t<div className=\"flex gap-2\" key={index}>\n\t\t\t\t\t\t\t\t\t<div className=\"relative flex-1\">\n\t\t\t\t\t\t\t\t\t\t<Mail className=\"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2\" />\n\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"pl-9\"\n\t\t\t\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\tupdateEmailAddress(index, e.target.value)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"email@example.com\"\n\t\t\t\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={email}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{emailAddresses.length > 1 && (\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-9 w-9\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => removeEmailAddress(index)}\n\t\t\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<X className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t\t\tonClick={addEmailAddress}\n\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Plus className=\"mr-2 h-4 w-4\" />\n\t\t\t\t\t\t\t\tAdd Email\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* Phone Numbers */}\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label>Phone Numbers</Label>\n\t\t\t\t\t\t\t{phoneNumbers.map((phone, index) => (\n\t\t\t\t\t\t\t\t<div className=\"flex gap-2\" key={index}>\n\t\t\t\t\t\t\t\t\t<div className=\"relative flex-1\">\n\t\t\t\t\t\t\t\t\t\t<Phone className=\"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2\" />\n\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"pl-9\"\n\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => updatePhoneNumber(index, e.target.value)}\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"(555) 123-4567\"\n\t\t\t\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={phone}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{phoneNumbers.length > 1 && (\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-9 w-9\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => removePhoneNumber(index)}\n\t\t\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<X className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t\t\tonClick={addPhoneNumber}\n\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Plus className=\"mr-2 h-4 w-4\" />\n\t\t\t\t\t\t\t\tAdd Phone\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Address */}\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<h4 className=\"text-sm font-semibold\">Address</h4>\n\n\t\t\t\t\t\t<StandardFormField label=\"Street Address\" htmlFor=\"address\">\n\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t<MapPin className=\"text-muted-foreground absolute top-3 left-3 h-4 w-4\" />\n\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\tclassName=\"min-h-[60px] pl-9\"\n\t\t\t\t\t\t\t\t\tdefaultValue={customer?.address || \"\"}\n\t\t\t\t\t\t\t\t\tid=\"address\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"123 Main Street\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</StandardFormField>\n\n\t\t\t\t\t\t<StandardFormRow cols={3}>\n\t\t\t\t\t\t\t<StandardFormField label=\"City\" htmlFor=\"city\">\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tdefaultValue={customer?.city || \"\"}\n\t\t\t\t\t\t\t\t\tid=\"city\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"City\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t\t\t<StandardFormField label=\"State\" htmlFor=\"state\">\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tdefaultValue={customer?.state || \"\"}\n\t\t\t\t\t\t\t\t\tid=\"state\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"State\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t\t\t<StandardFormField label=\"ZIP Code\" htmlFor=\"zipCode\">\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tdefaultValue={customer?.zip_code || \"\"}\n\t\t\t\t\t\t\t\t\tid=\"zipCode\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"12345\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t\t</StandardFormRow>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Enrichment Data */}\n\t\t\t\t\t{customer && (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t<h4 className=\"text-sm font-semibold\">Enrichment Data</h4>\n\n\t\t\t\t\t\t\t<StandardFormField label=\"Website\" htmlFor=\"website\">\n\t\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t\t<Globe className=\"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2\" />\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\tclassName=\"pl-9\"\n\t\t\t\t\t\t\t\t\t\tdefaultValue=\"\"\n\t\t\t\t\t\t\t\t\t\tid=\"website\"\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"https://example.com\"\n\t\t\t\t\t\t\t\t\t\ttype=\"url\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</StandardFormField>\n\n\t\t\t\t\t\t\t<StandardFormRow cols={3}>\n\t\t\t\t\t\t\t\t<StandardFormField label=\"LinkedIn\" htmlFor=\"linkedin\">\n\t\t\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t\t\t<Linkedin className=\"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2\" />\n\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"pl-9\"\n\t\t\t\t\t\t\t\t\t\t\tdefaultValue=\"\"\n\t\t\t\t\t\t\t\t\t\t\tid=\"linkedin\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Profile URL\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t\t\t\t<StandardFormField label=\"Twitter\" htmlFor=\"twitter\">\n\t\t\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t\t\t<Twitter className=\"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2\" />\n\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"pl-9\"\n\t\t\t\t\t\t\t\t\t\t\tdefaultValue=\"\"\n\t\t\t\t\t\t\t\t\t\t\tid=\"twitter\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"@username\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t\t\t\t<StandardFormField label=\"Facebook\" htmlFor=\"facebook\">\n\t\t\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t\t\t<Facebook className=\"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2\" />\n\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"pl-9\"\n\t\t\t\t\t\t\t\t\t\t\tdefaultValue=\"\"\n\t\t\t\t\t\t\t\t\t\t\tid=\"facebook\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Profile URL\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</StandardFormField>\n\t\t\t\t\t\t\t</StandardFormRow>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t),\n\t\t},\n\t\t// Jobs\n\t\t{\n\t\t\tid: \"jobs\",\n\t\t\ttitle: \"Jobs\",\n\t\t\ticon: <Briefcase className=\"h-4 w-4\" />,\n\t\t\tcount: jobs.length,\n\t\t\tactions: (\n\t\t\t\t<Button\n\t\t\t\t\tclassName=\"h-8 gap-1.5 px-3\"\n\t\t\t\t\tonClick={() => {}}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t>\n\t\t\t\t\t<Plus className=\"mr-2 h-3.5 w-3.5\" />\n\t\t\t\t\tLink Job\n\t\t\t\t</Button>\n\t\t\t),\n\t\t\tcontent:\n\t\t\t\tjobs.length > 0 ? (\n\t\t\t\t\t<div className=\"space-y-2 p-6\">\n\t\t\t\t\t\t{jobs.map((job) => (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName=\"bg-muted/30 rounded-lg border p-3 text-sm\"\n\t\t\t\t\t\t\t\tkey={job.id}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"mb-1 flex items-start justify-between\">\n\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t\t{job.title || \"Untitled Job\"}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t<Badge className=\"text-xs\" variant=\"outline\">\n\t\t\t\t\t\t\t\t\t\t{job.status}\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground font-mono text-xs\">\n\t\t\t\t\t\t\t\t\t#{job.job_number}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t{job.financial?.total_amount && (\n\t\t\t\t\t\t\t\t\t<p className=\"mt-1 text-xs\">\n\t\t\t\t\t\t\t\t\t\t{formatCurrency(job.financial.total_amount)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"flex flex-col items-center justify-center p-6 py-12 text-center\">\n\t\t\t\t\t\t<Briefcase className=\"text-muted-foreground mb-4 h-12 w-12\" />\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">No jobs found</p>\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\tThis customer has no jobs yet\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t),\n\t\t},\n\t\t// Invoices\n\t\t{\n\t\t\tid: \"invoices\",\n\t\t\ttitle: \"Invoices\",\n\t\t\ticon: <FileText className=\"h-4 w-4\" />,\n\t\t\tcount: invoices.length,\n\t\t\tactions: (\n\t\t\t\t<Button\n\t\t\t\t\tclassName=\"h-8 gap-1.5 px-3\"\n\t\t\t\t\tonClick={() => {}}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t>\n\t\t\t\t\t<Plus className=\"mr-2 h-3.5 w-3.5\" />\n\t\t\t\t\tLink Invoice\n\t\t\t\t</Button>\n\t\t\t),\n\t\t\tcontent:\n\t\t\t\tinvoices.length > 0 ? (\n\t\t\t\t\t<div className=\"space-y-2 p-6\">\n\t\t\t\t\t\t{invoices.map((invoice) => (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName=\"bg-muted/30 rounded-lg border p-3 text-sm\"\n\t\t\t\t\t\t\t\tkey={invoice.id}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"mb-1 flex items-start justify-between\">\n\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t\tInvoice #{invoice.invoice_number}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\tclassName=\"text-xs\"\n\t\t\t\t\t\t\t\t\t\tvariant={\n\t\t\t\t\t\t\t\t\t\t\tinvoice.status === \"paid\"\n\t\t\t\t\t\t\t\t\t\t\t\t? \"default\"\n\t\t\t\t\t\t\t\t\t\t\t\t: invoice.status === \"unpaid\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"outline\"\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{invoice.status}\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<p className=\"font-semibold\">\n\t\t\t\t\t\t\t\t\t{formatCurrency(invoice.total_amount || 0)}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\tDue: {formatDate(invoice.due_date)}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"flex flex-col items-center justify-center p-6 py-12 text-center\">\n\t\t\t\t\t\t<FileText className=\"text-muted-foreground mb-4 h-12 w-12\" />\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">No invoices found</p>\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\tThis customer has no invoices yet\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t),\n\t\t},\n\t\t// Appointments\n\t\t{\n\t\t\tid: \"appointments\",\n\t\t\ttitle: \"Appointments\",\n\t\t\ticon: <Calendar className=\"h-4 w-4\" />,\n\t\t\tcount: appointments.length,\n\t\t\tactions: (\n\t\t\t\t<Button\n\t\t\t\t\tclassName=\"h-8 gap-1.5 px-3\"\n\t\t\t\t\tonClick={() => {}}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t>\n\t\t\t\t\t<Plus className=\"mr-2 h-3.5 w-3.5\" />\n\t\t\t\t\tSchedule\n\t\t\t\t</Button>\n\t\t\t),\n\t\t\tcontent:\n\t\t\t\tappointments.length > 0 ? (\n\t\t\t\t\t<div className=\"space-y-2 p-6\">\n\t\t\t\t\t\t{appointments.map((appointment) => {\n\t\t\t\t\t\t\tconst appointmentDate =\n\t\t\t\t\t\t\t\t(appointment as { scheduled_start?: string }).scheduled_start ??\n\t\t\t\t\t\t\t\t(appointment as { scheduled_for?: string }).scheduled_for ??\n\t\t\t\t\t\t\t\t(appointment as { start_time?: string }).start_time ??\n\t\t\t\t\t\t\t\t(appointment as { scheduled_at?: string }).scheduled_at ??\n\t\t\t\t\t\t\t\tnull;\n\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclassName=\"bg-muted/30 rounded-lg border p-3 text-sm\"\n\t\t\t\t\t\t\t\t\tkey={appointment.id}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div className=\"mb-1 flex items-start justify-between\">\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t{appointment.title || \"Appointment\"}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t<Badge className=\"text-xs\" variant=\"outline\">\n\t\t\t\t\t\t\t\t\t\t\t{appointment.status}\n\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t{appointmentDate\n\t\t\t\t\t\t\t\t\t\t\t? formatDate(appointmentDate)\n\t\t\t\t\t\t\t\t\t\t\t: \"Date to be scheduled\"}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})}\n\t\t\t\t\t</div>\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"flex flex-col items-center justify-center p-6 py-12 text-center\">\n\t\t\t\t\t\t<Calendar className=\"text-muted-foreground mb-4 h-12 w-12\" />\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">No appointments</p>\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\tNo scheduled appointments for this customer\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t),\n\t\t},\n\t\t// Properties\n\t\t{\n\t\t\tid: \"properties\",\n\t\t\ttitle: \"Properties\",\n\t\t\ticon: <Home className=\"h-4 w-4\" />,\n\t\t\tcount: properties.length,\n\t\t\tactions: (\n\t\t\t\t<Button\n\t\t\t\t\tclassName=\"h-8 gap-1.5 px-3\"\n\t\t\t\t\tonClick={() => {}}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t>\n\t\t\t\t\t<Plus className=\"mr-2 h-3.5 w-3.5\" />\n\t\t\t\t\tLink Property\n\t\t\t\t</Button>\n\t\t\t),\n\t\t\tcontent:\n\t\t\t\tproperties.length > 0 ? (\n\t\t\t\t\t<div className=\"space-y-2 p-6\">\n\t\t\t\t\t\t{properties.map((property) => (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName=\"bg-muted/30 rounded-lg border p-3 text-sm\"\n\t\t\t\t\t\t\t\tkey={property.id}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"mb-1 flex items-start gap-2\">\n\t\t\t\t\t\t\t\t\t<MapPin className=\"text-muted-foreground mt-0.5 h-4 w-4 shrink-0\" />\n\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t<p className=\"font-medium\">{property.name || \"Property\"}</p>\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{property.address}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"flex flex-col items-center justify-center p-6 py-12 text-center\">\n\t\t\t\t\t\t<Home className=\"text-muted-foreground mb-4 h-12 w-12\" />\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">No properties</p>\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\tNo properties associated with this customer\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t),\n\t\t},\n\t\t// Equipment\n\t\t{\n\t\t\tid: \"equipment\",\n\t\t\ttitle: \"Equipment\",\n\t\t\ticon: <Wrench className=\"h-4 w-4\" />,\n\t\t\tcount: equipment.length,\n\t\t\tactions: (\n\t\t\t\t<Button\n\t\t\t\t\tclassName=\"h-8 gap-1.5 px-3\"\n\t\t\t\t\tonClick={() => {}}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t>\n\t\t\t\t\t<Plus className=\"mr-2 h-3.5 w-3.5\" />\n\t\t\t\t\tAdd Equipment\n\t\t\t\t</Button>\n\t\t\t),\n\t\t\tcontent:\n\t\t\t\tequipment.length > 0 ? (\n\t\t\t\t\t<div className=\"space-y-2 p-6\">\n\t\t\t\t\t\t{equipment.map((item) => (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName=\"bg-muted/30 rounded-lg border p-3 text-sm\"\n\t\t\t\t\t\t\t\tkey={item.id}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<p className=\"font-medium\">{item.name || \"Equipment\"}</p>\n\t\t\t\t\t\t\t\t{item.model && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\tModel: {item.model}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{item.serial_number && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground font-mono text-xs\">\n\t\t\t\t\t\t\t\t\t\tS/N: {item.serial_number}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"flex flex-col items-center justify-center p-6 py-12 text-center\">\n\t\t\t\t\t\t<Wrench className=\"text-muted-foreground mb-4 h-12 w-12\" />\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">No equipment</p>\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\tNo equipment associated with this customer\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t),\n\t\t},\n\t\t// Notes\n\t\t{\n\t\t\tid: \"notes\",\n\t\t\ttitle: \"Notes\",\n\t\t\ticon: <FileText className=\"h-4 w-4\" />,\n\t\t\tcount: customer?.notes ? 1 : 0, // Count is 1 if notes exist (single text field)\n\t\t\tactions: (\n\t\t\t\t<Button\n\t\t\t\t\tclassName=\"h-8 gap-1.5 px-3\"\n\t\t\t\t\tonClick={() => {}}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t>\n\t\t\t\t\t<Plus className=\"mr-2 h-3.5 w-3.5\" />\n\t\t\t\t\tAdd Note\n\t\t\t\t</Button>\n\t\t\t),\n\t\t\tcontent: (\n\t\t\t\t<div className=\"space-y-4 p-6\">\n\t\t\t\t\t{/* Example notes - replace with actual data */}\n\t\t\t\t\t{customer?.notes ? (\n\t\t\t\t\t\t<div className=\"space-y-3\">\n\t\t\t\t\t\t\t{/* Single note example */}\n\t\t\t\t\t\t\t<div className=\"bg-muted/30 rounded-lg border p-4\">\n\t\t\t\t\t\t\t\t<div className=\"mb-2 flex items-start justify-between\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm\">{customer.notes}</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground flex items-center gap-2 text-xs\">\n\t\t\t\t\t\t\t\t\t<User className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t<span>System</span>\n\t\t\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t{formatDate(\n\t\t\t\t\t\t\t\t\t\t\tcustomer.created_at || new Date().toISOString(),\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"flex flex-col items-center justify-center py-12 text-center\">\n\t\t\t\t\t\t\t<FileText className=\"text-muted-foreground mb-4 h-12 w-12\" />\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">No notes yet</p>\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\tAdd notes about this customer\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tclassName=\"mt-4\"\n\t\t\t\t\t\t\t\tonClick={() => {}}\n\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Plus className=\"mr-2 h-4 w-4\" />\n\t\t\t\t\t\t\t\tAdd Note\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t),\n\t\t},\n\t];\n\n\treturn (\n\t\t<div className=\"flex h-full flex-col\">\n\t\t\t{/* Sticky Stats Bar - Always visible */}\n\t\t\t{customer && stats && (\n\t\t\t\t<CustomerStatsBar\n\t\t\t\t\tstats={stats}\n\t\t\t\t\topenBalance={openBalance}\n\t\t\t\t\tlastVisitDate={lastVisitDate}\n\t\t\t\t/>\n\t\t\t)}\n\n\t\t\t<ScrollArea className=\"flex-1\">\n\t\t\t\t<div className=\"flex flex-col gap-4 p-4\">\n\t\t\t\t\t{/* Customer Alert Banner - Critical info first */}\n\t\t\t\t\t{customerData && stats && (\n\t\t\t\t\t\t<CustomerAlertBanner\n\t\t\t\t\t\t\tcustomerData={customerData}\n\t\t\t\t\t\t\tstats={stats}\n\t\t\t\t\t\t\tonTakePayment={onTakePayment}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Previous Call Summary - Context for this call */}\n\t\t\t\t\t<PreviousCallSummary lastCall={previousCall ?? null} />\n\n\t\t\t\t\t{/* Quick Actions Panel */}\n\t\t\t\t\t<section className=\"border-border/60 bg-card overflow-hidden rounded-xl border p-4 shadow-sm\">\n\t\t\t\t\t\t<QuickActionsPanel\n\t\t\t\t\t\t\tonCreateJob={onCreateJob || (() => {})}\n\t\t\t\t\t\t\tonScheduleAppointment={onScheduleAppointment || (() => {})}\n\t\t\t\t\t\t\tonSendSMS={onSendSMS || (() => {})}\n\t\t\t\t\t\t\tonSendEmail={onSendEmail || (() => {})}\n\t\t\t\t\t\t\tonTakePayment={onTakePayment}\n\t\t\t\t\t\t\tonAddNote={onAddNote || (() => {})}\n\t\t\t\t\t\t\tcustomerEmail={customer?.email}\n\t\t\t\t\t\t\tcustomerPhone={customer?.phone}\n\t\t\t\t\t\t\thasOutstandingBalance={openBalance > 0}\n\t\t\t\t\t\t\toutstandingAmount={openBalance}\n\t\t\t\t\t\t\tlayout=\"grid\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</section>\n\n\t\t\t\t\t{/* CSR Reminders - Condensed */}\n\t\t\t\t\t{csrReminders.length > 0 && (\n\t\t\t\t\t\t<section className=\"border-primary/20 bg-primary/5 overflow-hidden rounded-xl border shadow-sm\">\n\t\t\t\t\t\t\t<div className=\"flex items-start gap-3 p-4\">\n\t\t\t\t\t\t\t\t<div className=\"bg-primary/10 rounded-full p-2\">\n\t\t\t\t\t\t\t\t\t<Lightbulb className=\"text-primary h-4 w-4\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"flex-1 space-y-2\">\n\t\t\t\t\t\t\t\t\t<h3 className=\"text-foreground text-sm font-semibold\">\n\t\t\t\t\t\t\t\t\t\tCall Reminders\n\t\t\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t\t\t<ul className=\"text-muted-foreground space-y-1.5 text-xs\">\n\t\t\t\t\t\t\t\t\t\t{csrReminders.map((reminder) => (\n\t\t\t\t\t\t\t\t\t\t\t<li className=\"flex items-start gap-2\" key={reminder.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-primary mt-0.5\"></span>\n\t\t\t\t\t\t\t\t\t\t\t\t<span>{reminder.text}</span>\n\t\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</section>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Customer Tags */}\n\t\t\t\t\t{customer && (\n\t\t\t\t\t\t<section className=\"border-border/60 bg-card overflow-hidden rounded-xl border p-4 shadow-sm\">\n\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t<h4 className=\"text-muted-foreground text-xs font-semibold tracking-wide uppercase\">\n\t\t\t\t\t\t\t\t\t\tCustomer Tags\n\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-6 px-2 text-xs\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => {}}\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Plus className=\"mr-1 h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\tAdd\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-1.5\">\n\t\t\t\t\t\t\t\t\t{/* TODO: Fetch real tags from customer data */}\n\t\t\t\t\t\t\t\t\t<Badge className=\"text-xs\" variant=\"secondary\">\n\t\t\t\t\t\t\t\t\t\tVIP\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t<Badge className=\"text-xs\" variant=\"secondary\">\n\t\t\t\t\t\t\t\t\t\tRecurring\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\tclassName=\"hover:bg-muted cursor-pointer text-xs\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Plus className=\"mr-1 h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\tAdd Tag\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</section>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Customer Data Sections */}\n\t\t\t\t\t<section className=\"border-border/60 bg-card overflow-hidden rounded-xl border shadow-sm\">\n\t\t\t\t\t\t<div className=\"flex flex-col gap-4 p-0\">\n\t\t\t\t\t\t\t<UnifiedAccordion\n\t\t\t\t\t\t\t\tdefaultOpenSection={null}\n\t\t\t\t\t\t\t\tenableReordering={false}\n\t\t\t\t\t\t\t\tsections={sections}\n\t\t\t\t\t\t\t\tstorageKey=\"call-window-customer-sidebar\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</section>\n\t\t\t\t</div>\n\t\t\t</ScrollArea>\n\t\t</div>\n\t);\n}\n","/**\n * CSR Reminders Types\n *\n * Configurable reminders that appear at the top of the call window\n * to help CSRs follow best practices during customer calls.\n */\n\nexport type CSRReminder = {\n\tid: string;\n\ttext: string;\n\tenabled: boolean;\n\torder: number;\n};\n\nexport type CSRReminderSettings = {\n\tenabled: boolean;\n\treminders: CSRReminder[];\n};\n\n/**\n * Default CSR reminders\n */\nexport const DEFAULT_CSR_REMINDERS: CSRReminder[] = [\n\t{\n\t\tid: \"greeting\",\n\t\ttext: \"Greet customer warmly and smile while speaking\",\n\t\tenabled: true,\n\t\torder: 1,\n\t},\n\t{\n\t\tid: \"verify\",\n\t\ttext: \"Verify customer name, phone, and service address\",\n\t\tenabled: true,\n\t\torder: 2,\n\t},\n\t{\n\t\tid: \"availability\",\n\t\ttext: \"Ask about preferred appointment times and availability\",\n\t\tenabled: true,\n\t\torder: 3,\n\t},\n\t{\n\t\tid: \"confirm\",\n\t\ttext: \"Confirm all details before ending the call\",\n\t\tenabled: true,\n\t\torder: 4,\n\t},\n];\n\n/**\n * Additional optional reminders that can be enabled\n */\nconst OPTIONAL_CSR_REMINDERS: CSRReminder[] = [\n\t{\n\t\tid: \"upsell\",\n\t\ttext: \"Mention maintenance plans or additional services\",\n\t\tenabled: false,\n\t\torder: 5,\n\t},\n\t{\n\t\tid: \"feedback\",\n\t\ttext: \"Ask if customer has any questions or concerns\",\n\t\tenabled: false,\n\t\torder: 6,\n\t},\n\t{\n\t\tid: \"followup\",\n\t\ttext: \"Inform customer about follow-up communication\",\n\t\tenabled: false,\n\t\torder: 7,\n\t},\n\t{\n\t\tid: \"payment\",\n\t\ttext: \"Discuss payment options and pricing\",\n\t\tenabled: false,\n\t\torder: 8,\n\t},\n\t{\n\t\tid: \"emergency\",\n\t\ttext: \"Ask if this is an emergency requiring immediate service\",\n\t\tenabled: false,\n\t\torder: 9,\n\t},\n];\n","\"use client\";\n\n/**\n * Customer Alert Banner Component\n *\n * Displays prominent alerts at the top of the customer sidebar for:\n * - Past due balance (red)\n * - VIP customer status (gold)\n * - Problem history/at-risk (orange)\n * - Recent complaints (needs attention)\n *\n * CSRs need to see critical customer information at a glance\n * without scrolling or hunting through sections.\n */\n\nimport {\n\tAlertTriangle,\n\tBadgeCheck,\n\tBan,\n\tCreditCard,\n\tCrown,\n\tMessageSquareWarning,\n\tShieldAlert,\n\tStar,\n\tTrendingDown,\n\tX,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { cn } from \"@/lib/utils\";\nimport type { CustomerCallData, CustomerStats } from \"@/types/call\";\n\ntype AlertType =\n\t| \"past_due\"\n\t| \"vip\"\n\t| \"at_risk\"\n\t| \"complaint\"\n\t| \"blocked\"\n\t| \"new_customer\"\n\t| \"high_value\";\n\ntype Alert = {\n\tid: string;\n\ttype: AlertType;\n\ttitle: string;\n\tdescription: string;\n\tamount?: number;\n\tdismissible?: boolean;\n\taction?: {\n\t\tlabel: string;\n\t\tonClick: () => void;\n\t};\n};\n\ntype CustomerAlertBannerProps = {\n\tcustomerData: CustomerCallData | null;\n\tstats: CustomerStats | null;\n\tonTakePayment?: () => void;\n\tonViewHistory?: () => void;\n\tonViewComplaints?: () => void;\n\tclassName?: string;\n};\n\nconst alertConfig: Record<\n\tAlertType,\n\t{\n\t\ticon: React.ElementType;\n\t\tbgColor: string;\n\t\tborderColor: string;\n\t\ttextColor: string;\n\t\ticonColor: string;\n\t}\n> = {\n\tpast_due: {\n\t\ticon: CreditCard,\n\t\tbgColor: \"bg-destructive/10 dark:bg-destructive/20\",\n\t\tborderColor: \"border-destructive/50\",\n\t\ttextColor: \"text-destructive\",\n\t\ticonColor: \"text-destructive\",\n\t},\n\tvip: {\n\t\ticon: Crown,\n\t\tbgColor: \"bg-amber-500/10 dark:bg-amber-500/20\",\n\t\tborderColor: \"border-amber-500/50\",\n\t\ttextColor: \"text-amber-600 dark:text-amber-400\",\n\t\ticonColor: \"text-amber-500\",\n\t},\n\tat_risk: {\n\t\ticon: TrendingDown,\n\t\tbgColor: \"bg-orange-500/10 dark:bg-orange-500/20\",\n\t\tborderColor: \"border-orange-500/50\",\n\t\ttextColor: \"text-orange-600 dark:text-orange-400\",\n\t\ticonColor: \"text-orange-500\",\n\t},\n\tcomplaint: {\n\t\ticon: MessageSquareWarning,\n\t\tbgColor: \"bg-warning/10 dark:bg-warning/20\",\n\t\tborderColor: \"border-warning/50\",\n\t\ttextColor: \"text-warning\",\n\t\ticonColor: \"text-warning\",\n\t},\n\tblocked: {\n\t\ticon: Ban,\n\t\tbgColor: \"bg-destructive/15 dark:bg-destructive/25\",\n\t\tborderColor: \"border-destructive\",\n\t\ttextColor: \"text-destructive\",\n\t\ticonColor: \"text-destructive\",\n\t},\n\tnew_customer: {\n\t\ticon: Star,\n\t\tbgColor: \"bg-primary/10 dark:bg-primary/20\",\n\t\tborderColor: \"border-primary/50\",\n\t\ttextColor: \"text-primary\",\n\t\ticonColor: \"text-primary\",\n\t},\n\thigh_value: {\n\t\ticon: BadgeCheck,\n\t\tbgColor: \"bg-success/10 dark:bg-success/20\",\n\t\tborderColor: \"border-success/50\",\n\t\ttextColor: \"text-success\",\n\t\ticonColor: \"text-success\",\n\t},\n};\n\nexport function CustomerAlertBanner({\n\tcustomerData,\n\tstats,\n\tonTakePayment,\n\tonViewHistory,\n\tonViewComplaints,\n\tclassName,\n}: CustomerAlertBannerProps) {\n\tconst [dismissedAlerts, setDismissedAlerts] = useState<Set<string>>(\n\t\tnew Set(),\n\t);\n\n\t// Generate alerts based on customer data\n\tconst alerts: Alert[] = [];\n\n\tif (!customerData || !stats) {\n\t\treturn null;\n\t}\n\n\tconst { customer } = customerData;\n\n\t// Check for past due invoices\n\tif (stats.openInvoices > 0) {\n\t\t// Calculate total outstanding (from unpaid invoices)\n\t\tconst unpaidTotal = customerData.invoices\n\t\t\t.filter((inv) => inv.status === \"unpaid\" || inv.status === \"overdue\")\n\t\t\t.reduce((sum, inv) => sum + (inv.total_amount || 0), 0);\n\n\t\tif (unpaidTotal > 0) {\n\t\t\tconst hasOverdue = customerData.invoices.some(\n\t\t\t\t(inv) => inv.status === \"overdue\",\n\t\t\t);\n\t\t\talerts.push({\n\t\t\t\tid: \"past_due\",\n\t\t\t\ttype: \"past_due\",\n\t\t\t\ttitle: hasOverdue ? \"Past Due Balance\" : \"Outstanding Balance\",\n\t\t\t\tdescription: `${stats.openInvoices} unpaid invoice${stats.openInvoices > 1 ? \"s\" : \"\"}`,\n\t\t\t\tamount: unpaidTotal,\n\t\t\t\taction: onTakePayment\n\t\t\t\t\t? { label: \"Take Payment\", onClick: onTakePayment }\n\t\t\t\t\t: undefined,\n\t\t\t});\n\t\t}\n\t}\n\n\t// Check for VIP status (based on tags or high revenue)\n\tconst isVIP =\n\t\tcustomer?.tags?.includes(\"VIP\") ||\n\t\tcustomer?.tags?.includes(\"vip\") ||\n\t\tcustomer?.priority_level === \"high\";\n\tif (isVIP) {\n\t\talerts.push({\n\t\t\tid: \"vip\",\n\t\t\ttype: \"vip\",\n\t\t\ttitle: \"VIP Customer\",\n\t\t\tdescription: \"Priority service  Extended support\",\n\t\t\tdismissible: true,\n\t\t});\n\t}\n\n\t// Check for high value customer\n\tif (stats.totalRevenue > 10000 && !isVIP) {\n\t\talerts.push({\n\t\t\tid: \"high_value\",\n\t\t\ttype: \"high_value\",\n\t\t\ttitle: \"High Value Customer\",\n\t\t\tdescription: `Lifetime value: ${formatCurrency(stats.totalRevenue)}`,\n\t\t\tdismissible: true,\n\t\t});\n\t}\n\n\t// Check for new customer (first call or created recently)\n\tconst isNewCustomer =\n\t\tcustomer?.created_at &&\n\t\tnew Date(customer.created_at) >\n\t\t\tnew Date(Date.now() - 30 * 24 * 60 * 60 * 1000); // Within 30 days\n\tif (isNewCustomer && stats.totalRevenue === 0) {\n\t\talerts.push({\n\t\t\tid: \"new_customer\",\n\t\t\ttype: \"new_customer\",\n\t\t\ttitle: \"New Customer\",\n\t\t\tdescription: \"First interaction  Make a great impression!\",\n\t\t\tdismissible: true,\n\t\t});\n\t}\n\n\t// Check for at-risk indicators (multiple cancelled jobs, declining engagement)\n\tconst cancelledJobs = customerData.jobs.filter(\n\t\t(job) => job.status === \"cancelled\",\n\t).length;\n\tif (cancelledJobs >= 2) {\n\t\talerts.push({\n\t\t\tid: \"at_risk\",\n\t\t\ttype: \"at_risk\",\n\t\t\ttitle: \"At-Risk Customer\",\n\t\t\tdescription: `${cancelledJobs} cancelled jobs  Consider retention offer`,\n\t\t\taction: onViewHistory\n\t\t\t\t? { label: \"View History\", onClick: onViewHistory }\n\t\t\t\t: undefined,\n\t\t});\n\t}\n\n\t// Check for recent complaints (would come from notes/communications)\n\t// This is a placeholder - in production, you'd query for recent negative interactions\n\tconst hasRecentComplaint =\n\t\tcustomer?.notes?.toLowerCase().includes(\"complaint\") ||\n\t\tcustomer?.notes?.toLowerCase().includes(\"unhappy\") ||\n\t\tcustomer?.notes?.toLowerCase().includes(\"frustrated\");\n\tif (hasRecentComplaint) {\n\t\talerts.push({\n\t\t\tid: \"complaint\",\n\t\t\ttype: \"complaint\",\n\t\t\ttitle: \"Recent Complaint\",\n\t\t\tdescription: \"Customer had a previous issue  Handle with care\",\n\t\t\taction: onViewComplaints\n\t\t\t\t? { label: \"View Details\", onClick: onViewComplaints }\n\t\t\t\t: undefined,\n\t\t});\n\t}\n\n\t// Check for blocked/problem customer\n\tif (\n\t\tcustomer?.status === \"blocked\" ||\n\t\tcustomer?.tags?.includes(\"problem\") ||\n\t\tcustomer?.tags?.includes(\"do-not-service\")\n\t) {\n\t\talerts.push({\n\t\t\tid: \"blocked\",\n\t\t\ttype: \"blocked\",\n\t\t\ttitle: \"Service Restricted\",\n\t\t\tdescription: \"Check with manager before scheduling\",\n\t\t});\n\t}\n\n\t// Filter out dismissed alerts\n\tconst visibleAlerts = alerts.filter(\n\t\t(alert) => !dismissedAlerts.has(alert.id),\n\t);\n\n\tif (visibleAlerts.length === 0) {\n\t\treturn null;\n\t}\n\n\tconst handleDismiss = (alertId: string) => {\n\t\tsetDismissedAlerts((prev) => new Set([...prev, alertId]));\n\t};\n\n\treturn (\n\t\t<div className={cn(\"space-y-2\", className)}>\n\t\t\t{visibleAlerts.map((alert) => {\n\t\t\t\tconst config = alertConfig[alert.type];\n\t\t\t\tconst Icon = config.icon;\n\n\t\t\t\treturn (\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"relative overflow-hidden rounded-lg border p-3 transition-all\",\n\t\t\t\t\t\t\tconfig.bgColor,\n\t\t\t\t\t\t\tconfig.borderColor,\n\t\t\t\t\t\t)}\n\t\t\t\t\t\tkey={alert.id}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div className=\"flex items-start gap-3\">\n\t\t\t\t\t\t\t{/* Icon */}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\"mt-0.5 flex h-8 w-8 shrink-0 items-center justify-center rounded-full\",\n\t\t\t\t\t\t\t\t\tconfig.bgColor,\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Icon className={cn(\"h-4 w-4\", config.iconColor)} />\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Content */}\n\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<h4 className={cn(\"text-sm font-semibold\", config.textColor)}>\n\t\t\t\t\t\t\t\t\t\t{alert.title}\n\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t\t{alert.amount !== undefined && (\n\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\"font-mono text-xs\", config.textColor)}\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(alert.amount)}\n\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<p\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"mt-0.5 text-xs opacity-80\",\n\t\t\t\t\t\t\t\t\t\tconfig.textColor,\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{alert.description}\n\t\t\t\t\t\t\t\t</p>\n\n\t\t\t\t\t\t\t\t{/* Action button */}\n\t\t\t\t\t\t\t\t{alert.action && (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\"mt-2 h-7 text-xs\", config.textColor)}\n\t\t\t\t\t\t\t\t\t\tonClick={alert.action.onClick}\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{alert.action.label}\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Dismiss button */}\n\t\t\t\t\t\t\t{alert.dismissible && (\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"h-6 w-6 shrink-0 opacity-60 hover:opacity-100\",\n\t\t\t\t\t\t\t\t\t\tconfig.textColor,\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\tonClick={() => handleDismiss(alert.id)}\n\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<X className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t})}\n\t\t</div>\n\t);\n}\n\n// Helper function to format currency\nfunction formatCurrency(amount: number): string {\n\treturn new Intl.NumberFormat(\"en-US\", {\n\t\tstyle: \"currency\",\n\t\tcurrency: \"USD\",\n\t\tminimumFractionDigits: 0,\n\t\tmaximumFractionDigits: 0,\n\t}).format(amount);\n}\n","\"use client\";\n\n/**\n * Customer Stats Bar\n *\n * Sticky stats bar showing critical customer metrics at a glance.\n * Always visible at the top of the customer sidebar during calls.\n *\n * Shows:\n * - Total revenue (color-coded)\n * - Open balance\n * - Active jobs count\n * - Last visit date\n * - Customer since date\n */\n\nimport {\n\tBanknote,\n\tBriefcase,\n\tCalendar,\n\tClock,\n\tCreditCard,\n\tTrendingDown,\n\tTrendingUp,\n\tUser,\n} from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { cn } from \"@/lib/utils\";\nimport type { CustomerStats } from \"@/types/call\";\n\ntype CustomerStatsBarProps = {\n\tstats: CustomerStats;\n\topenBalance?: number;\n\tlastVisitDate?: string | null;\n\tclassName?: string;\n};\n\n// Revenue tiers for color coding\nconst getRevenueColor = (revenue: number): string => {\n\tif (revenue >= 10000) return \"text-success\"; // High value\n\tif (revenue >= 5000) return \"text-primary\"; // Good value\n\tif (revenue >= 1000) return \"text-foreground\"; // Average\n\treturn \"text-muted-foreground\"; // Low/new\n};\n\nconst getRevenueLabel = (revenue: number): string => {\n\tif (revenue >= 10000) return \"High Value\";\n\tif (revenue >= 5000) return \"Good\";\n\tif (revenue >= 1000) return \"Average\";\n\tif (revenue > 0) return \"New\";\n\treturn \"No History\";\n};\n\nexport function CustomerStatsBar({\n\tstats,\n\topenBalance = 0,\n\tlastVisitDate,\n\tclassName,\n}: CustomerStatsBarProps) {\n\t// Format currency\n\tconst formatCurrency = (amount: number): string => {\n\t\tif (amount >= 1000) {\n\t\t\treturn `$${(amount / 1000).toFixed(1)}k`;\n\t\t}\n\t\treturn new Intl.NumberFormat(\"en-US\", {\n\t\t\tstyle: \"currency\",\n\t\t\tcurrency: \"USD\",\n\t\t\tminimumFractionDigits: 0,\n\t\t\tmaximumFractionDigits: 0,\n\t\t}).format(amount);\n\t};\n\n\t// Format date\n\tconst formatDate = (date: string | null): string => {\n\t\tif (!date) return \"Never\";\n\t\tconst d = new Date(date);\n\t\tconst now = new Date();\n\t\tconst diffDays = Math.floor(\n\t\t\t(now.getTime() - d.getTime()) / (1000 * 60 * 60 * 24),\n\t\t);\n\n\t\tif (diffDays === 0) return \"Today\";\n\t\tif (diffDays === 1) return \"Yesterday\";\n\t\tif (diffDays < 7) return `${diffDays} days ago`;\n\t\tif (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;\n\t\tif (diffDays < 365) return `${Math.floor(diffDays / 30)} months ago`;\n\t\treturn d.toLocaleDateString(\"en-US\", { month: \"short\", year: \"numeric\" });\n\t};\n\n\t// Get customer tenure\n\tconst getCustomerTenure = (): string => {\n\t\tif (!stats.customerSince) return \"New\";\n\t\tconst start = new Date(stats.customerSince);\n\t\tconst now = new Date();\n\t\tconst diffYears =\n\t\t\t(now.getTime() - start.getTime()) / (1000 * 60 * 60 * 24 * 365);\n\n\t\tif (diffYears < 1) {\n\t\t\tconst months = Math.floor(diffYears * 12);\n\t\t\treturn months <= 1 ? \"< 1 mo\" : `${months} mo`;\n\t\t}\n\t\treturn `${Math.floor(diffYears)}y`;\n\t};\n\n\tconst revenueColor = getRevenueColor(stats.totalRevenue);\n\tconst hasOpenBalance = openBalance > 0;\n\n\treturn (\n\t\t<TooltipProvider delayDuration={200}>\n\t\t\t<div\n\t\t\t\tclassName={cn(\n\t\t\t\t\t\"bg-card/80 sticky top-0 z-10 border-b backdrop-blur-sm\",\n\t\t\t\t\tclassName,\n\t\t\t\t)}\n\t\t\t>\n\t\t\t\t<div className=\"grid grid-cols-5 divide-x\">\n\t\t\t\t\t{/* Revenue */}\n\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t<div className=\"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50\">\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t<Banknote className={cn(\"h-3.5 w-3.5\", revenueColor)} />\n\t\t\t\t\t\t\t\t\t<span className={cn(\"text-xs font-bold\", revenueColor)}>\n\t\t\t\t\t\t\t\t\t\t{formatCurrency(stats.totalRevenue)}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-[10px]\">\n\t\t\t\t\t\t\t\t\tRevenue\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t<p>Total Lifetime Revenue</p>\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t{getRevenueLabel(stats.totalRevenue)} customer\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t{/* Open Balance */}\n\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50\",\n\t\t\t\t\t\t\t\t\thasOpenBalance && \"bg-destructive/5\",\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t<CreditCard\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"h-3.5 w-3.5\",\n\t\t\t\t\t\t\t\t\t\t\thasOpenBalance\n\t\t\t\t\t\t\t\t\t\t\t\t? \"text-destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"text-xs font-bold\",\n\t\t\t\t\t\t\t\t\t\t\thasOpenBalance\n\t\t\t\t\t\t\t\t\t\t\t\t? \"text-destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{hasOpenBalance ? formatCurrency(openBalance) : \"$0\"}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-[10px]\">\n\t\t\t\t\t\t\t\t\t{hasOpenBalance ? \"Due\" : \"Balance\"}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t<p>{hasOpenBalance ? \"Outstanding Balance\" : \"No Balance Due\"}</p>\n\t\t\t\t\t\t\t{hasOpenBalance && (\n\t\t\t\t\t\t\t\t<p className=\"text-destructive text-xs\">\n\t\t\t\t\t\t\t\t\t{stats.openInvoices} unpaid invoice\n\t\t\t\t\t\t\t\t\t{stats.openInvoices !== 1 ? \"s\" : \"\"}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t{/* Active Jobs */}\n\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t<div className=\"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50\">\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t<Briefcase\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"h-3.5 w-3.5\",\n\t\t\t\t\t\t\t\t\t\t\tstats.activeJobs > 0\n\t\t\t\t\t\t\t\t\t\t\t\t? \"text-primary\"\n\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"text-xs font-bold\",\n\t\t\t\t\t\t\t\t\t\t\tstats.activeJobs > 0\n\t\t\t\t\t\t\t\t\t\t\t\t? \"text-primary\"\n\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{stats.activeJobs}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-[10px]\">Active</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t<p>Active Jobs</p>\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t{stats.totalJobs} total jobs\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t{/* Last Visit */}\n\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t<div className=\"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50\">\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t<Clock className=\"text-muted-foreground h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t<span className=\"text-foreground text-xs font-bold\">\n\t\t\t\t\t\t\t\t\t\t{formatDate(lastVisitDate ?? null)}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-[10px]\">\n\t\t\t\t\t\t\t\t\tLast Visit\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t<p>Last Service Visit</p>\n\t\t\t\t\t\t\t{lastVisitDate && (\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t{new Date(lastVisitDate).toLocaleDateString(\"en-US\", {\n\t\t\t\t\t\t\t\t\t\tweekday: \"short\",\n\t\t\t\t\t\t\t\t\t\tmonth: \"short\",\n\t\t\t\t\t\t\t\t\t\tday: \"numeric\",\n\t\t\t\t\t\t\t\t\t\tyear: \"numeric\",\n\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t{/* Customer Since */}\n\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t<div className=\"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50\">\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t<User className=\"text-muted-foreground h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t<span className=\"text-foreground text-xs font-bold\">\n\t\t\t\t\t\t\t\t\t\t{getCustomerTenure()}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-[10px]\">Member</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t<p>Customer Since</p>\n\t\t\t\t\t\t\t{stats.customerSince && (\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t{new Date(stats.customerSince).toLocaleDateString(\"en-US\", {\n\t\t\t\t\t\t\t\t\t\tmonth: \"long\",\n\t\t\t\t\t\t\t\t\t\tyear: \"numeric\",\n\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</TooltipProvider>\n\t);\n}\n","\"use client\";\n\n/**\n * Previous Call Summary\n *\n * Shows the last call's summary to give CSRs context about\n * prior interactions with the customer.\n *\n * Includes:\n * - Date/time of last call\n * - Call disposition\n * - CSR who handled the call\n * - Notes/summary\n * - Topics discussed (from AI analysis)\n */\n\nimport {\n\tCalendar,\n\tChevronDown,\n\tChevronUp,\n\tClock,\n\tFileText,\n\tMessageSquare,\n\tPhone,\n\tSparkles,\n\tUser,\n\tAlertTriangle,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { cn } from \"@/lib/utils\";\n\ntype CallSummary = {\n\tid: string;\n\tdate: string;\n\tduration: number; // in seconds\n\tdisposition: string;\n\tcsrName: string;\n\tnotes?: string;\n\ttopics?: string[];\n\tsentiment?: \"positive\" | \"neutral\" | \"negative\";\n\tfollowUpScheduled?: boolean;\n\tissueResolved?: boolean;\n};\n\ntype PreviousCallSummaryProps = {\n\tlastCall: CallSummary | null;\n\trecentCalls?: CallSummary[];\n\tonViewAllCalls?: () => void;\n\tclassName?: string;\n};\n\nconst dispositionColors: Record<string, string> = {\n\tresolved: \"bg-success/10 text-success border-success/30\",\n\tcallback_scheduled: \"bg-warning/10 text-warning border-warning/30\",\n\tescalated: \"bg-orange-500/10 text-orange-500 border-orange-500/30\",\n\tvoicemail_left: \"bg-muted text-muted-foreground border-muted\",\n\ttransferred: \"bg-muted text-muted-foreground border-muted\",\n\tcustomer_hung_up: \"bg-muted text-muted-foreground border-muted\",\n\tappointment_booked: \"bg-primary/10 text-primary border-primary/30\",\n\tquote_provided: \"bg-primary/10 text-primary border-primary/30\",\n\tpayment_taken: \"bg-success/10 text-success border-success/30\",\n\tother: \"bg-muted text-muted-foreground border-muted\",\n};\n\nconst sentimentColors: Record<string, string> = {\n\tpositive: \"text-success\",\n\tneutral: \"text-muted-foreground\",\n\tnegative: \"text-destructive\",\n};\n\nconst sentimentIcons: Record<string, string> = {\n\tpositive: \"\",\n\tneutral: \"\",\n\tnegative: \"\",\n};\n\nexport function PreviousCallSummary({\n\tlastCall,\n\trecentCalls = [],\n\tonViewAllCalls,\n\tclassName,\n}: PreviousCallSummaryProps) {\n\tconst [isExpanded, setIsExpanded] = useState(false);\n\n\tif (!lastCall) {\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName={cn(\n\t\t\t\t\t\"border-primary/20 bg-primary/5 rounded-xl border p-4\",\n\t\t\t\t\tclassName,\n\t\t\t\t)}\n\t\t\t>\n\t\t\t\t<div className=\"flex items-start gap-3\">\n\t\t\t\t\t<div className=\"bg-primary/10 rounded-full p-2\">\n\t\t\t\t\t\t<Phone className=\"text-primary h-4 w-4\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t<h4 className=\"text-sm font-semibold\">First Call</h4>\n\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-xs\">\n\t\t\t\t\t\t\tThis is the first call with this customer. No previous call\n\t\t\t\t\t\t\thistory available.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\t// Format duration\n\tconst formatDuration = (seconds: number): string => {\n\t\tconst mins = Math.floor(seconds / 60);\n\t\tconst secs = seconds % 60;\n\t\tif (mins === 0) return `${secs}s`;\n\t\treturn `${mins}m ${secs}s`;\n\t};\n\n\t// Format date\n\tconst formatDate = (dateStr: string): string => {\n\t\tconst date = new Date(dateStr);\n\t\tconst now = new Date();\n\t\tconst diffDays = Math.floor(\n\t\t\t(now.getTime() - date.getTime()) / (1000 * 60 * 60 * 24),\n\t\t);\n\n\t\tif (diffDays === 0) {\n\t\t\treturn `Today at ${date.toLocaleTimeString(\"en-US\", {\n\t\t\t\thour: \"numeric\",\n\t\t\t\tminute: \"2-digit\",\n\t\t\t})}`;\n\t\t}\n\t\tif (diffDays === 1) {\n\t\t\treturn `Yesterday at ${date.toLocaleTimeString(\"en-US\", {\n\t\t\t\thour: \"numeric\",\n\t\t\t\tminute: \"2-digit\",\n\t\t\t})}`;\n\t\t}\n\t\tif (diffDays < 7) {\n\t\t\treturn `${diffDays} days ago`;\n\t\t}\n\t\treturn date.toLocaleDateString(\"en-US\", {\n\t\t\tmonth: \"short\",\n\t\t\tday: \"numeric\",\n\t\t\tyear: date.getFullYear() !== now.getFullYear() ? \"numeric\" : undefined,\n\t\t});\n\t};\n\n\t// Format disposition for display\n\tconst formatDisposition = (disposition: string): string => {\n\t\treturn disposition\n\t\t\t.replace(/_/g, \" \")\n\t\t\t.replace(/\\b\\w/g, (l) => l.toUpperCase());\n\t};\n\n\tconst dispositionClass =\n\t\tdispositionColors[lastCall.disposition] || dispositionColors.other;\n\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\n\t\t\t\t\"bg-muted/30 overflow-hidden rounded-xl border transition-all\",\n\t\t\t\tclassName,\n\t\t\t)}\n\t\t>\n\t\t\t{/* Header */}\n\t\t\t<button\n\t\t\t\tclassName=\"flex w-full items-center justify-between p-4 text-left transition-colors hover:bg-muted/50\"\n\t\t\t\tonClick={() => setIsExpanded(!isExpanded)}\n\t\t\t\ttype=\"button\"\n\t\t\t>\n\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t<div className=\"bg-muted rounded-full p-2\">\n\t\t\t\t\t\t<Phone className=\"text-muted-foreground h-4 w-4\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<h4 className=\"text-sm font-semibold\">Previous Call</h4>\n\t\t\t\t\t\t\t{lastCall.sentiment && (\n\t\t\t\t\t\t\t\t<span title={`Customer was ${lastCall.sentiment}`}>\n\t\t\t\t\t\t\t\t\t{sentimentIcons[lastCall.sentiment]}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t{formatDate(lastCall.date)}  {formatDuration(lastCall.duration)}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<Badge className={cn(\"text-xs\", dispositionClass)} variant=\"outline\">\n\t\t\t\t\t\t{formatDisposition(lastCall.disposition)}\n\t\t\t\t\t</Badge>\n\t\t\t\t\t{isExpanded ? (\n\t\t\t\t\t\t<ChevronUp className=\"text-muted-foreground h-4 w-4\" />\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<ChevronDown className=\"text-muted-foreground h-4 w-4\" />\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</button>\n\n\t\t\t{/* Expanded Content */}\n\t\t\t{isExpanded && (\n\t\t\t\t<div className=\"border-t p-4 pt-3\">\n\t\t\t\t\t{/* Quick Stats */}\n\t\t\t\t\t<div className=\"mb-3 grid grid-cols-3 gap-2\">\n\t\t\t\t\t\t<div className=\"bg-card rounded-lg p-2 text-center\">\n\t\t\t\t\t\t\t<div className=\"flex items-center justify-center gap-1\">\n\t\t\t\t\t\t\t\t<User className=\"text-muted-foreground h-3 w-3\" />\n\t\t\t\t\t\t\t\t<span className=\"text-xs font-medium\">{lastCall.csrName}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-[10px]\">\n\t\t\t\t\t\t\t\tHandled by\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"bg-card rounded-lg p-2 text-center\">\n\t\t\t\t\t\t\t<div className=\"flex items-center justify-center gap-1\">\n\t\t\t\t\t\t\t\t<Clock className=\"text-muted-foreground h-3 w-3\" />\n\t\t\t\t\t\t\t\t<span className=\"text-xs font-medium\">\n\t\t\t\t\t\t\t\t\t{formatDuration(lastCall.duration)}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-[10px]\">Duration</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"bg-card rounded-lg p-2 text-center\">\n\t\t\t\t\t\t\t<div className=\"flex items-center justify-center gap-1\">\n\t\t\t\t\t\t\t\t{lastCall.issueResolved ? (\n\t\t\t\t\t\t\t\t\t<span className=\"text-success text-xs font-medium\">Yes</span>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<span className=\"text-warning text-xs font-medium\">No</span>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-[10px]\">Resolved</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Topics discussed */}\n\t\t\t\t\t{lastCall.topics && lastCall.topics.length > 0 && (\n\t\t\t\t\t\t<div className=\"mb-3\">\n\t\t\t\t\t\t\t<div className=\"mb-1.5 flex items-center gap-1\">\n\t\t\t\t\t\t\t\t<Sparkles className=\"text-primary h-3 w-3\" />\n\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs font-medium\">\n\t\t\t\t\t\t\t\t\tTopics Discussed\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-1\">\n\t\t\t\t\t\t\t\t{lastCall.topics.map((topic, index) => (\n\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\tclassName=\"text-[10px]\"\n\t\t\t\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{topic}\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Notes */}\n\t\t\t\t\t{lastCall.notes && (\n\t\t\t\t\t\t<div className=\"mb-3\">\n\t\t\t\t\t\t\t<div className=\"mb-1.5 flex items-center gap-1\">\n\t\t\t\t\t\t\t\t<FileText className=\"text-muted-foreground h-3 w-3\" />\n\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs font-medium\">\n\t\t\t\t\t\t\t\t\tNotes\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<p className=\"bg-card rounded-lg border p-2 text-xs\">\n\t\t\t\t\t\t\t\t{lastCall.notes}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Follow-up alert */}\n\t\t\t\t\t{lastCall.followUpScheduled && !lastCall.issueResolved && (\n\t\t\t\t\t\t<div className=\"bg-warning/10 border-warning/30 flex items-start gap-2 rounded-lg border p-2\">\n\t\t\t\t\t\t\t<AlertTriangle className=\"text-warning mt-0.5 h-3.5 w-3.5 shrink-0\" />\n\t\t\t\t\t\t\t<p className=\"text-warning text-xs\">\n\t\t\t\t\t\t\t\tFollow-up was scheduled for this customer. Check if issue was\n\t\t\t\t\t\t\t\tresolved.\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* View all button */}\n\t\t\t\t\t{onViewAllCalls && recentCalls.length > 0 && (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tclassName=\"mt-3 w-full gap-1 text-xs\"\n\t\t\t\t\t\t\tonClick={onViewAllCalls}\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<MessageSquare className=\"h-3 w-3\" />\n\t\t\t\t\t\t\tView All {recentCalls.length + 1} Calls\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","\"use client\";\n\n/**\n * Quick Actions Panel\n *\n * CSR-specific quick actions for the call window.\n * All actions open as slide-over panels with customer data pre-filled.\n *\n * Actions:\n * - New Job (J)\n * - Schedule Appointment (A)\n * - Send SMS (S)\n * - Send Email (E)\n * - Take Payment\n * - Add Note (N)\n *\n * Each action shows keyboard shortcut hint.\n */\n\nimport {\n\tBriefcase,\n\tCalendar,\n\tCreditCard,\n\tFileText,\n\tMail,\n\tMessageSquare,\n\tPlus,\n\tSend,\n\tSparkles,\n} from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { cn } from \"@/lib/utils\";\n\ntype QuickAction = {\n\tid: string;\n\tlabel: string;\n\tshortLabel?: string;\n\ticon: React.ReactNode;\n\tshortcut?: string;\n\tvariant?: \"default\" | \"secondary\" | \"outline\" | \"ghost\";\n\tonClick: () => void;\n\tdisabled?: boolean;\n\tbadge?: string;\n\tdescription?: string;\n};\n\ntype QuickActionsPanelProps = {\n\tonCreateJob: () => void;\n\tonScheduleAppointment: () => void;\n\tonSendSMS: () => void;\n\tonSendEmail: () => void;\n\tonTakePayment?: () => void;\n\tonAddNote: () => void;\n\tonAISuggestion?: () => void;\n\tcustomerEmail?: string;\n\tcustomerPhone?: string;\n\thasOutstandingBalance?: boolean;\n\toutstandingAmount?: number;\n\tclassName?: string;\n\tlayout?: \"horizontal\" | \"vertical\" | \"grid\";\n};\n\nexport function QuickActionsPanel({\n\tonCreateJob,\n\tonScheduleAppointment,\n\tonSendSMS,\n\tonSendEmail,\n\tonTakePayment,\n\tonAddNote,\n\tonAISuggestion,\n\tcustomerEmail,\n\tcustomerPhone,\n\thasOutstandingBalance,\n\toutstandingAmount,\n\tclassName,\n\tlayout = \"grid\",\n}: QuickActionsPanelProps) {\n\tconst actions: QuickAction[] = [\n\t\t{\n\t\t\tid: \"job\",\n\t\t\tlabel: \"New Job\",\n\t\t\tshortLabel: \"Job\",\n\t\t\ticon: <Briefcase className=\"h-4 w-4\" />,\n\t\t\tshortcut: \"J\",\n\t\t\tvariant: \"default\",\n\t\t\tonClick: onCreateJob,\n\t\t\tdescription: \"Create a new job for this customer\",\n\t\t},\n\t\t{\n\t\t\tid: \"appointment\",\n\t\t\tlabel: \"Schedule\",\n\t\t\ticon: <Calendar className=\"h-4 w-4\" />,\n\t\t\tshortcut: \"A\",\n\t\t\tvariant: \"outline\",\n\t\t\tonClick: onScheduleAppointment,\n\t\t\tdescription: \"Schedule an appointment\",\n\t\t},\n\t\t{\n\t\t\tid: \"sms\",\n\t\t\tlabel: \"SMS\",\n\t\t\ticon: <MessageSquare className=\"h-4 w-4\" />,\n\t\t\tshortcut: \"S\",\n\t\t\tvariant: \"outline\",\n\t\t\tonClick: onSendSMS,\n\t\t\tdisabled: !customerPhone,\n\t\t\tdescription: customerPhone\n\t\t\t\t? \"Send SMS to customer\"\n\t\t\t\t: \"No phone number available\",\n\t\t},\n\t\t{\n\t\t\tid: \"email\",\n\t\t\tlabel: \"Email\",\n\t\t\ticon: <Mail className=\"h-4 w-4\" />,\n\t\t\tshortcut: \"E\",\n\t\t\tvariant: \"outline\",\n\t\t\tonClick: onSendEmail,\n\t\t\tdisabled: !customerEmail,\n\t\t\tdescription: customerEmail\n\t\t\t\t? \"Send email to customer\"\n\t\t\t\t: \"No email address available\",\n\t\t},\n\t\t{\n\t\t\tid: \"note\",\n\t\t\tlabel: \"Note\",\n\t\t\ticon: <FileText className=\"h-4 w-4\" />,\n\t\t\tshortcut: \"N\",\n\t\t\tvariant: \"outline\",\n\t\t\tonClick: onAddNote,\n\t\t\tdescription: \"Add a note to this call\",\n\t\t},\n\t];\n\n\t// Add payment action if available and has outstanding balance\n\tif (onTakePayment && hasOutstandingBalance) {\n\t\tactions.push({\n\t\t\tid: \"payment\",\n\t\t\tlabel: \"Payment\",\n\t\t\ticon: <CreditCard className=\"h-4 w-4\" />,\n\t\t\tvariant: \"secondary\",\n\t\t\tonClick: onTakePayment,\n\t\t\tbadge: outstandingAmount\n\t\t\t\t? `$${outstandingAmount.toLocaleString()}`\n\t\t\t\t: \"Due\",\n\t\t\tdescription: \"Take payment for outstanding balance\",\n\t\t});\n\t}\n\n\tconst layoutClasses = {\n\t\thorizontal: \"flex flex-wrap items-center gap-2\",\n\t\tvertical: \"flex flex-col gap-2\",\n\t\tgrid: \"grid grid-cols-3 gap-2\",\n\t};\n\n\treturn (\n\t\t<TooltipProvider delayDuration={300}>\n\t\t\t<div className={cn(\"space-y-3\", className)}>\n\t\t\t\t{/* Header */}\n\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t<h4 className=\"text-muted-foreground flex items-center gap-2 text-xs font-semibold tracking-wide uppercase\">\n\t\t\t\t\t\t<Plus className=\"h-3 w-3\" />\n\t\t\t\t\t\tQuick Actions\n\t\t\t\t\t</h4>\n\t\t\t\t\t{onAISuggestion && (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tclassName=\"h-6 gap-1 px-2 text-xs\"\n\t\t\t\t\t\t\tonClick={onAISuggestion}\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Sparkles className=\"h-3 w-3\" />\n\t\t\t\t\t\t\tAI Suggest\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{/* Actions */}\n\t\t\t\t<div className={layoutClasses[layout]}>\n\t\t\t\t\t{actions.map((action) => (\n\t\t\t\t\t\t<Tooltip key={action.id}>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"relative h-10 gap-2 text-sm\",\n\t\t\t\t\t\t\t\t\t\tlayout === \"grid\" && \"w-full flex-col h-auto py-3\",\n\t\t\t\t\t\t\t\t\t\tlayout === \"vertical\" && \"w-full justify-start\",\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\tdisabled={action.disabled}\n\t\t\t\t\t\t\t\t\tonClick={action.onClick}\n\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\tvariant={action.variant || \"outline\"}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{action.icon}\n\t\t\t\t\t\t\t\t\t<span className={cn(layout === \"grid\" && \"text-xs\")}>\n\t\t\t\t\t\t\t\t\t\t{layout === \"horizontal\"\n\t\t\t\t\t\t\t\t\t\t\t? action.shortLabel || action.label\n\t\t\t\t\t\t\t\t\t\t\t: action.label}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t{action.badge && (\n\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"absolute -top-1 -right-1 h-5 px-1.5 text-[10px]\"\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{action.badge}\n\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent side=\"bottom\">\n\t\t\t\t\t\t\t\t<p>{action.description || action.label}</p>\n\t\t\t\t\t\t\t\t{action.shortcut && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\tPress {action.shortcut}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\n\t\t\t\t{/* Keyboard hint */}\n\t\t\t\t<p className=\"text-muted-foreground/60 text-center text-[10px]\">\n\t\t\t\t\tPress ? to see all shortcuts\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t</TooltipProvider>\n\t);\n}\n\n/**\n * Compact Quick Actions Bar\n *\n * Horizontal bar version for tight spaces\n */\ntype QuickActionsBarProps = Omit<QuickActionsPanelProps, \"layout\" | \"className\"> & {\n\tclassName?: string;\n};\n\nexport function QuickActionsBar(props: QuickActionsBarProps) {\n\treturn <QuickActionsPanel {...props} layout=\"horizontal\" />;\n}\n\n/**\n * Floating Quick Actions\n *\n * Positioned absolutely for overlay use\n */\ntype FloatingQuickActionsProps = QuickActionsPanelProps & {\n\tposition?: \"bottom-left\" | \"bottom-right\" | \"top-left\" | \"top-right\";\n};\n\nexport function FloatingQuickActions({\n\tposition = \"bottom-right\",\n\tclassName,\n\t...props\n}: FloatingQuickActionsProps) {\n\tconst positionClasses = {\n\t\t\"bottom-left\": \"bottom-4 left-4\",\n\t\t\"bottom-right\": \"bottom-4 right-4\",\n\t\t\"top-left\": \"top-4 left-4\",\n\t\t\"top-right\": \"top-4 right-4\",\n\t};\n\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\n\t\t\t\t\"bg-card/95 fixed z-50 rounded-xl border p-4 shadow-lg backdrop-blur-sm\",\n\t\t\t\tpositionClasses[position],\n\t\t\t\tclassName,\n\t\t\t)}\n\t\t>\n\t\t\t<QuickActionsPanel {...props} layout=\"vertical\" />\n\t\t</div>\n\t);\n}\n","\"use client\";\n\n/**\n * CSR Schedule View Component\n *\n * Displays all technicians' schedules for the day with real data from database.\n * Features:\n * - Timeline visualization with current time indicator\n * - All assigned technicians (not just leads)\n * - Available time slots\n * - Active jobs highlighted\n * - 2-hour appointment windows\n */\n\nimport {\n\tAlertCircle,\n\tCalendar,\n\tChevronLeft,\n\tChevronRight,\n\tClock,\n\tLoader2,\n\tMapPin,\n\tPlus,\n\tUser,\n\tUsers,\n} from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\nimport { useEffect, useState } from \"react\";\nimport {\n\tgetTechnicianSchedules,\n\ttype ScheduleAppointment,\n\ttype TechnicianSchedule,\n} from \"@/actions/schedule\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport {\n\tUnifiedAccordion,\n\ttype UnifiedAccordionSection,\n} from \"@/components/ui/unified-accordion\";\nimport { cn } from \"@/lib/utils\";\nimport { ScheduleTimeline } from \"./schedule-timeline\";\n\ntype CSRScheduleViewProps = {\n\tclassName?: string;\n\tcompanyId?: string;\n};\n\nexport function CSRScheduleView({\n\tclassName,\n\tcompanyId,\n}: CSRScheduleViewProps) {\n\tconst router = useRouter();\n\tconst [selectedDate, setSelectedDate] = useState(new Date());\n\tconst [selectedTechFilter, setSelectedTechFilter] = useState<string | null>(\n\t\tnull,\n\t);\n\tconst [technicians, setTechnicians] = useState<TechnicianSchedule[]>([]);\n\tconst [isLoading, setIsLoading] = useState(true);\n\tconst [error, setError] = useState<string | null>(null);\n\tconst [currentTime, setCurrentTime] = useState(new Date());\n\n\t// Update current time every minute\n\tuseEffect(() => {\n\t\tconst interval = setInterval(() => {\n\t\t\tsetCurrentTime(new Date());\n\t\t}, 60_000); // Update every minute\n\n\t\treturn () => clearInterval(interval);\n\t}, []);\n\n\t// Fetch schedule data\n\tuseEffect(() => {\n\t\tasync function fetchSchedule() {\n\t\t\tif (!companyId) {\n\t\t\t\tsetError(\"No company ID provided\");\n\t\t\t\tsetIsLoading(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetIsLoading(true);\n\t\t\tsetError(null);\n\n\t\t\ttry {\n\t\t\t\tconst schedules = await getTechnicianSchedules(selectedDate, companyId);\n\t\t\t\tsetTechnicians(schedules);\n\t\t\t} catch (_err) {\n\t\t\t\tsetError(\"Failed to load schedules\");\n\t\t\t} finally {\n\t\t\t\tsetIsLoading(false);\n\t\t\t}\n\t\t}\n\n\t\tfetchSchedule();\n\t}, [selectedDate, companyId]);\n\n\t// If loading, show spinner\n\tif (isLoading) {\n\t\treturn (\n\t\t\t<div className={cn(\"flex h-full items-center justify-center\", className)}>\n\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t<Loader2 className=\"text-primary mx-auto mb-4 h-8 w-8 animate-spin\" />\n\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">Loading schedules...</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\t// If error, show message\n\tif (error) {\n\t\treturn (\n\t\t\t<div className={cn(\"flex h-full items-center justify-center\", className)}>\n\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t<AlertCircle className=\"text-destructive mx-auto mb-4 h-8 w-8\" />\n\t\t\t\t\t<p className=\"text-sm font-medium\">{error}</p>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclassName=\"mt-4\"\n\t\t\t\t\t\tonClick={() => router.refresh()}\n\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t>\n\t\t\t\t\t\tRetry\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\t// Format time from ISO string\n\tconst formatTime = (dateString: string) => {\n\t\tconst date = new Date(dateString);\n\t\treturn date.toLocaleTimeString(\"en-US\", {\n\t\t\thour: \"numeric\",\n\t\t\tminute: \"2-digit\",\n\t\t\thour12: true,\n\t\t});\n\t};\n\n\tconst formatDate = (date: Date): string =>\n\t\tdate.toLocaleDateString(\"en-US\", {\n\t\t\tweekday: \"short\",\n\t\t\tmonth: \"short\",\n\t\t\tday: \"numeric\",\n\t\t});\n\n\tconst changeDate = (days: number) => {\n\t\tconst newDate = new Date(selectedDate);\n\t\tnewDate.setDate(newDate.getDate() + days);\n\t\tsetSelectedDate(newDate);\n\t};\n\n\tconst isToday = (date: Date): boolean => {\n\t\tconst today = new Date();\n\t\treturn (\n\t\t\tdate.getDate() === today.getDate() &&\n\t\t\tdate.getMonth() === today.getMonth() &&\n\t\t\tdate.getFullYear() === today.getFullYear()\n\t\t);\n\t};\n\n\tconst getStatusBadge = (status: ScheduleAppointment[\"status\"]) => {\n\t\tswitch (status) {\n\t\t\tcase \"completed\":\n\t\t\t\treturn (\n\t\t\t\t\t<Badge\n\t\t\t\t\t\tclassName=\"border-success/50 bg-success/10 text-success text-[10px]\"\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t>\n\t\t\t\t\t\tCompleted\n\t\t\t\t\t</Badge>\n\t\t\t\t);\n\t\t\tcase \"in_progress\":\n\t\t\t\treturn (\n\t\t\t\t\t<Badge\n\t\t\t\t\t\tclassName=\"border-warning/50 bg-warning/10 text-warning text-[10px]\"\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t>\n\t\t\t\t\t\tIn Progress\n\t\t\t\t\t</Badge>\n\t\t\t\t);\n\t\t\tcase \"cancelled\":\n\t\t\t\treturn (\n\t\t\t\t\t<Badge\n\t\t\t\t\t\tclassName=\"border-destructive/50 bg-destructive/10 text-destructive text-[10px]\"\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t>\n\t\t\t\t\t\tCancelled\n\t\t\t\t\t</Badge>\n\t\t\t\t);\n\t\t\tdefault:\n\t\t\t\treturn (\n\t\t\t\t\t<Badge className=\"text-[10px]\" variant=\"outline\">\n\t\t\t\t\t\tScheduled\n\t\t\t\t\t</Badge>\n\t\t\t\t);\n\t\t}\n\t};\n\n\tconst getInitials = (name: string) =>\n\t\tname\n\t\t\t.split(\" \")\n\t\t\t.map((n) => n[0])\n\t\t\t.join(\"\")\n\t\t\t.toUpperCase()\n\t\t\t.slice(0, 2);\n\n\t// Filter technicians if a specific one is selected\n\tconst filteredTechnicians = selectedTechFilter\n\t\t? technicians.filter((tech) => tech.id === selectedTechFilter)\n\t\t: technicians;\n\n\t// Calculate total appointments\n\tconst totalAppointments = technicians.reduce(\n\t\t(sum, tech) => sum + tech.appointments.length,\n\t\t0,\n\t);\n\n\t// Build accordion sections for each technician\n\tconst sections: UnifiedAccordionSection[] = filteredTechnicians.map(\n\t\t(tech) => ({\n\t\t\tid: tech.id,\n\t\t\ttitle: tech.name,\n\t\t\ticon: (\n\t\t\t\t<Avatar className=\"h-5 w-5\">\n\t\t\t\t\t<AvatarImage src={tech.avatar_url} />\n\t\t\t\t\t<AvatarFallback className={cn(\"text-[10px] text-white\", tech.color)}>\n\t\t\t\t\t\t{getInitials(tech.name)}\n\t\t\t\t\t</AvatarFallback>\n\t\t\t\t</Avatar>\n\t\t\t),\n\t\t\tcount: tech.appointments.length,\n\t\t\tactions: (\n\t\t\t\t<Badge className=\"text-[10px]\" variant=\"secondary\">\n\t\t\t\t\t{tech.role.replace(\"_\", \" \")}\n\t\t\t\t</Badge>\n\t\t\t),\n\t\t\tcontent: (\n\t\t\t\t<div className=\"space-y-4 p-4\">\n\t\t\t\t\t{/* Timeline */}\n\t\t\t\t\t<ScheduleTimeline\n\t\t\t\t\t\tappointments={tech.appointments}\n\t\t\t\t\t\tcurrentTime={currentTime}\n\t\t\t\t\t\ttechnicianColor={tech.color}\n\t\t\t\t\t\tworkingHours={tech.working_hours}\n\t\t\t\t\t/>\n\n\t\t\t\t\t{/* Appointments List */}\n\t\t\t\t\t{tech.appointments.length > 0 ? (\n\t\t\t\t\t\t<div className=\"space-y-3\">\n\t\t\t\t\t\t\t{tech.appointments.map((appointment) => (\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclassName=\"bg-card hover:bg-muted/50 rounded-lg border p-4 transition-colors\"\n\t\t\t\t\t\t\t\t\tkey={appointment.id}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{/* Time & Status */}\n\t\t\t\t\t\t\t\t\t<div className=\"mb-3 flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<Clock className=\"text-muted-foreground h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t\t{formatTime(appointment.scheduled_start)} -{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t\t{formatTime(appointment.scheduled_end)}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"text-[10px]\" variant=\"secondary\">\n\t\t\t\t\t\t\t\t\t\t\t\t{appointment.duration_hours}h window\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{getStatusBadge(appointment.status)}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{/* Job Info */}\n\t\t\t\t\t\t\t\t\t<div className=\"mb-3 space-y-1\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<User className=\"text-muted-foreground h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t{appointment.customer_name}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<MapPin className=\"text-muted-foreground h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t{appointment.address}, {appointment.city},{\" \"}\n\t\t\t\t\t\t\t\t\t\t\t\t{appointment.state}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"text-xs\" variant=\"outline\">\n\t\t\t\t\t\t\t\t\t\t\t\t{appointment.job_type}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground font-mono text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t#{appointment.job_number}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{/* Assigned Technicians */}\n\t\t\t\t\t\t\t\t\t{appointment.assigned_technicians.length > 1 && (\n\t\t\t\t\t\t\t\t\t\t<div className=\"border-t pt-3\">\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Users className=\"text-muted-foreground h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tTeam:\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{appointment.assigned_technicians.map(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(assignedTech) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-[10px]\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={assignedTech.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tassignedTech.is_lead ? \"default\" : \"secondary\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{assignedTech.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{assignedTech.is_lead && \" (Lead)\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"flex flex-col items-center justify-center py-8 text-center\">\n\t\t\t\t\t\t\t<Calendar className=\"text-muted-foreground mb-3 h-10 w-10\" />\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\t\t\tNo appointments today\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\tThis technician is available\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t),\n\t\t}),\n\t);\n\n\treturn (\n\t\t<div className={cn(\"flex h-full flex-col\", className)}>\n\t\t\t{/* Header */}\n\t\t\t<div className=\"bg-card/50 space-y-3 border-b p-4\">\n\t\t\t\t{/* Date Navigation */}\n\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclassName=\"h-8 w-8\"\n\t\t\t\t\t\tonClick={() => changeDate(-1)}\n\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronLeft className=\"h-4 w-4\" />\n\t\t\t\t\t</Button>\n\n\t\t\t\t\t<div className=\"flex flex-col items-center\">\n\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Calendar className=\"text-muted-foreground h-4 w-4\" />\n\t\t\t\t\t\t\t<span className=\"text-sm font-semibold\">\n\t\t\t\t\t\t\t\t{formatDate(selectedDate)}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{isToday(selectedDate) && (\n\t\t\t\t\t\t\t<Badge className=\"mt-1 text-[10px]\" variant=\"secondary\">\n\t\t\t\t\t\t\t\tToday\n\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclassName=\"h-8 w-8\"\n\t\t\t\t\t\tonClick={() => changeDate(1)}\n\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronRight className=\"h-4 w-4\" />\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Stats & Filter */}\n\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t<div className=\"bg-muted/30 flex items-center gap-2 rounded-lg border px-3 py-1.5\">\n\t\t\t\t\t\t<Users className=\"text-muted-foreground h-3.5 w-3.5\" />\n\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t{filteredTechnicians.length} Techs\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span className=\"text-muted-foreground\"></span>\n\t\t\t\t\t\t<span className=\"text-xs font-medium\">\n\t\t\t\t\t\t\t{totalAppointments} Appointments\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclassName=\"h-7 gap-1.5 px-2 text-xs\"\n\t\t\t\t\t\tonClick={() => setSelectedTechFilter(null)}\n\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{selectedTechFilter ? \"Show All\" : \"All Techs\"}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Technicians List */}\n\t\t\t<ScrollArea className=\"flex-1\">\n\t\t\t\t<div className=\"p-4\">\n\t\t\t\t\t<section className=\"border-border/60 bg-card overflow-hidden rounded-xl border shadow-sm\">\n\t\t\t\t\t\t<div className=\"flex flex-col gap-4 p-0\">\n\t\t\t\t\t\t\t<UnifiedAccordion\n\t\t\t\t\t\t\t\tdefaultOpenSection={sections[0]?.id}\n\t\t\t\t\t\t\t\tenableReordering={false}\n\t\t\t\t\t\t\t\tsections={sections}\n\t\t\t\t\t\t\t\tstorageKey=\"csr-schedule-technicians\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</section>\n\t\t\t\t</div>\n\t\t\t</ScrollArea>\n\n\t\t\t{/* Quick Actions */}\n\t\t\t<div className=\"bg-card/50 border-t p-3\">\n\t\t\t\t<Button\n\t\t\t\t\tclassName=\"w-full gap-2 text-xs\"\n\t\t\t\t\tonClick={() => {}}\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tvariant=\"default\"\n\t\t\t\t>\n\t\t\t\t\t<Plus className=\"h-3.5 w-3.5\" />\n\t\t\t\t\tBook New Appointment\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"60d61fe4e8976bdfeff5cf3386134c7b4b7b4f4bd0\":\"getTechnicianSchedules\"},\"apps/web/src/actions/schedule.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var getTechnicianSchedules=/*#__PURE__*/createServerReference(\"60d61fe4e8976bdfeff5cf3386134c7b4b7b4f4bd0\",callServer,void 0,findSourceMapURL,\"getTechnicianSchedules\");","\"use client\";\n\nimport { Clock, Users } from \"lucide-react\";\nimport type { ScheduleAppointment } from \"@/actions/schedule\";\nimport { cn } from \"@/lib/utils\";\n\ntype ScheduleTimelineProps = {\n\tappointments: ScheduleAppointment[];\n\tworkingHours: {\n\t\tstart: number;\n\t\tend: number;\n\t};\n\ttechnicianColor: string;\n\tcurrentTime?: Date;\n};\n\nexport function ScheduleTimeline({\n\tappointments,\n\tworkingHours,\n\ttechnicianColor,\n\tcurrentTime = new Date(),\n}: ScheduleTimelineProps) {\n\tconst { start: workStart, end: workEnd } = workingHours;\n\tconst totalHours = workEnd - workStart;\n\n\tconst getCurrentTimePosition = (): number => {\n\t\tconst now = currentTime;\n\t\tconst currentHour = now.getHours() + now.getMinutes() / 60;\n\n\t\tif (currentHour < workStart) {\n\t\t\treturn 0;\n\t\t}\n\t\tif (currentHour > workEnd) {\n\t\t\treturn 100;\n\t\t}\n\n\t\treturn ((currentHour - workStart) / totalHours) * 100;\n\t};\n\n\tconst getAppointmentStyle = (appointment: ScheduleAppointment) => {\n\t\tconst startTime = new Date(appointment.scheduled_start);\n\t\tconst endTime = new Date(appointment.scheduled_end);\n\n\t\tconst startHour = startTime.getHours() + startTime.getMinutes() / 60;\n\t\tconst endHour = endTime.getHours() + endTime.getMinutes() / 60;\n\n\t\tconst left = ((startHour - workStart) / totalHours) * 100;\n\t\tconst width = ((endHour - startHour) / totalHours) * 100;\n\n\t\treturn {\n\t\t\tleft: `${Math.max(0, left)}%`,\n\t\t\twidth: `${Math.min(100 - Math.max(0, left), width)}%`,\n\t\t};\n\t};\n\n\tconst getStatusColor = (status: ScheduleAppointment[\"status\"]) => {\n\t\tswitch (status) {\n\t\t\tcase \"in_progress\":\n\t\t\t\treturn \"bg-warning/80 border-warning\";\n\t\t\tcase \"completed\":\n\t\t\t\treturn \"bg-success/80 border-success\";\n\t\t\tcase \"cancelled\":\n\t\t\t\treturn \"bg-destructive/80 border-destructive\";\n\t\t\tdefault:\n\t\t\t\treturn `${technicianColor}/80 border-${technicianColor.replace(\"bg-\", \"\")}`;\n\t\t}\n\t};\n\n\tconst formatTime = (value: string) => {\n\t\tconst date = new Date(value);\n\t\treturn date.toLocaleTimeString(\"en-US\", {\n\t\t\thour: \"numeric\",\n\t\t\tminute: \"2-digit\",\n\t\t\thour12: true,\n\t\t});\n\t};\n\n\tconst hourMarkers = Array.from(\n\t\t{ length: totalHours + 1 },\n\t\t(_, i) => workStart + i,\n\t);\n\tconst currentTimePosition = getCurrentTimePosition();\n\tconst isWithinWorkingHours =\n\t\tcurrentTimePosition > 0 && currentTimePosition < 100;\n\n\treturn (\n\t\t<div className=\"space-y-3\">\n\t\t\t<div className=\"bg-muted/20 relative h-24 rounded-lg border p-2\">\n\t\t\t\t<div className=\"absolute inset-x-2 top-1 flex justify-between\">\n\t\t\t\t\t{hourMarkers.map((hour) => (\n\t\t\t\t\t\t<div className=\"flex flex-col items-center\" key={hour}>\n\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-[9px]\">\n\t\t\t\t\t\t\t\t{hour > 12 ? hour - 12 : hour === 0 ? 12 : hour}\n\t\t\t\t\t\t\t\t{hour >= 12 ? \"p\" : \"a\"}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"bg-card relative mt-6 h-12 rounded border\">\n\t\t\t\t\t{appointments.map((appointment) => {\n\t\t\t\t\t\tconst style = getAppointmentStyle(appointment);\n\t\t\t\t\t\tconst statusColor = getStatusColor(appointment.status);\n\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\"absolute top-1 h-10 rounded border-2 p-1 transition-all hover:z-10 hover:scale-105\",\n\t\t\t\t\t\t\t\t\tstatusColor,\n\t\t\t\t\t\t\t\t\tappointment.status === \"in_progress\" && \"animate-pulse\",\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\tkey={appointment.id}\n\t\t\t\t\t\t\t\tstyle={style}\n\t\t\t\t\t\t\t\ttitle={`${appointment.customer_name}  ${formatTime(appointment.scheduled_start)} - ${formatTime(appointment.scheduled_end)}`}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"flex h-full flex-col justify-center overflow-hidden px-1\">\n\t\t\t\t\t\t\t\t\t<p className=\"truncate text-[10px] leading-tight font-medium text-white\">\n\t\t\t\t\t\t\t\t\t\t{appointment.customer_name}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t{appointment.assigned_technicians.length > 1 && (\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-0.5 text-white/80\">\n\t\t\t\t\t\t\t\t\t\t\t<Users className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-[8px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t{appointment.assigned_technicians.length}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n\t\t\t\t\t})}\n\n\t\t\t\t\t{isWithinWorkingHours && (\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"absolute top-0 h-full w-0.5 bg-blue-500 shadow-lg\"\n\t\t\t\t\t\t\tstyle={{ left: `${currentTimePosition}%` }}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div className=\"absolute -top-1 left-1/2 -translate-x-1/2\">\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1 rounded bg-blue-500 px-1.5 py-0.5 text-white shadow-lg\">\n\t\t\t\t\t\t\t\t\t<Clock className=\"h-2.5 w-2.5\" />\n\t\t\t\t\t\t\t\t\t<span className=\"text-[9px] font-medium\">\n\t\t\t\t\t\t\t\t\t\t{currentTime.toLocaleTimeString(\"en-US\", {\n\t\t\t\t\t\t\t\t\t\t\thour: \"numeric\",\n\t\t\t\t\t\t\t\t\t\t\tminute: \"2-digit\",\n\t\t\t\t\t\t\t\t\t\t\thour12: true,\n\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div className=\"flex flex-wrap items-center gap-2 text-[10px]\">\n\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t<div className={cn(\"h-2 w-2 rounded\", technicianColor)} />\n\t\t\t\t\t<span className=\"text-muted-foreground\">Scheduled</span>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t<div className=\"bg-warning h-2 w-2 rounded\" />\n\t\t\t\t\t<span className=\"text-muted-foreground\">In Progress</span>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t<div className=\"bg-success h-2 w-2 rounded\" />\n\t\t\t\t\t<span className=\"text-muted-foreground\">Completed</span>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t<div className=\"h-2 w-2 rounded border-2 border-blue-500 bg-blue-500\" />\n\t\t\t\t\t<span className=\"text-muted-foreground\">Current Time</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","\"use client\";\n\n/**\n * Call Wrap-Up Dialog\n *\n * Shown when CSR clicks \"End Call\" to ensure proper call completion.\n * Requires:\n * - Call disposition (mandatory)\n * - Notes (mandatory if call > 2 minutes)\n * - Optional follow-up scheduling\n * - Optional email confirmation\n *\n * This prevents CSRs from ending calls without documenting the outcome.\n */\n\nimport {\n\tAlertTriangle,\n\tCalendar,\n\tCheckCircle2,\n\tClock,\n\tFileText,\n\tLoader2,\n\tMail,\n\tMessageSquare,\n\tPhone,\n\tPhoneOff,\n\tPlus,\n\tSend,\n\tX,\n} from \"lucide-react\";\nimport { useCallback, useEffect, useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n\tDialog,\n\tDialogContent,\n\tDialogDescription,\n\tDialogFooter,\n\tDialogHeader,\n\tDialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { cn } from \"@/lib/utils\";\n\ntype CallDisposition =\n\t| \"resolved\"\n\t| \"callback_scheduled\"\n\t| \"escalated\"\n\t| \"voicemail_left\"\n\t| \"wrong_number\"\n\t| \"spam\"\n\t| \"customer_hung_up\"\n\t| \"transferred\"\n\t| \"appointment_booked\"\n\t| \"quote_provided\"\n\t| \"payment_taken\"\n\t| \"other\";\n\ntype FollowUpType = \"callback\" | \"email\" | \"sms\" | \"appointment\";\n\ntype CallWrapUpData = {\n\tdisposition: CallDisposition;\n\tnotes: string;\n\tfollowUp: {\n\t\tenabled: boolean;\n\t\ttype: FollowUpType;\n\t\tdate?: Date;\n\t\tnotes?: string;\n\t};\n\tsendConfirmation: boolean;\n\tcreateJob: boolean;\n};\n\ntype CallWrapUpDialogProps = {\n\topen: boolean;\n\tonOpenChange: (open: boolean) => void;\n\tonComplete: (data: CallWrapUpData) => void;\n\tonCancel: () => void;\n\tcallDuration: number; // in seconds\n\tcustomerName: string;\n\tcustomerEmail?: string;\n\texistingNotes?: string;\n\tisSubmitting?: boolean;\n};\n\nconst dispositionOptions: Array<{\n\tvalue: CallDisposition;\n\tlabel: string;\n\ticon: React.ReactNode;\n\tcolor: string;\n}> = [\n\t{\n\t\tvalue: \"resolved\",\n\t\tlabel: \"Issue Resolved\",\n\t\ticon: <CheckCircle2 className=\"h-4 w-4\" />,\n\t\tcolor: \"text-success\",\n\t},\n\t{\n\t\tvalue: \"appointment_booked\",\n\t\tlabel: \"Appointment Booked\",\n\t\ticon: <Calendar className=\"h-4 w-4\" />,\n\t\tcolor: \"text-primary\",\n\t},\n\t{\n\t\tvalue: \"quote_provided\",\n\t\tlabel: \"Quote Provided\",\n\t\ticon: <FileText className=\"h-4 w-4\" />,\n\t\tcolor: \"text-primary\",\n\t},\n\t{\n\t\tvalue: \"payment_taken\",\n\t\tlabel: \"Payment Taken\",\n\t\ticon: <CheckCircle2 className=\"h-4 w-4\" />,\n\t\tcolor: \"text-success\",\n\t},\n\t{\n\t\tvalue: \"callback_scheduled\",\n\t\tlabel: \"Callback Scheduled\",\n\t\ticon: <Phone className=\"h-4 w-4\" />,\n\t\tcolor: \"text-warning\",\n\t},\n\t{\n\t\tvalue: \"escalated\",\n\t\tlabel: \"Escalated to Manager\",\n\t\ticon: <AlertTriangle className=\"h-4 w-4\" />,\n\t\tcolor: \"text-orange-500\",\n\t},\n\t{\n\t\tvalue: \"transferred\",\n\t\tlabel: \"Transferred\",\n\t\ticon: <Phone className=\"h-4 w-4\" />,\n\t\tcolor: \"text-muted-foreground\",\n\t},\n\t{\n\t\tvalue: \"voicemail_left\",\n\t\tlabel: \"Left Voicemail\",\n\t\ticon: <MessageSquare className=\"h-4 w-4\" />,\n\t\tcolor: \"text-muted-foreground\",\n\t},\n\t{\n\t\tvalue: \"customer_hung_up\",\n\t\tlabel: \"Customer Hung Up\",\n\t\ticon: <PhoneOff className=\"h-4 w-4\" />,\n\t\tcolor: \"text-muted-foreground\",\n\t},\n\t{\n\t\tvalue: \"wrong_number\",\n\t\tlabel: \"Wrong Number\",\n\t\ticon: <X className=\"h-4 w-4\" />,\n\t\tcolor: \"text-muted-foreground\",\n\t},\n\t{\n\t\tvalue: \"spam\",\n\t\tlabel: \"Spam/Unwanted\",\n\t\ticon: <AlertTriangle className=\"h-4 w-4\" />,\n\t\tcolor: \"text-destructive\",\n\t},\n\t{\n\t\tvalue: \"other\",\n\t\tlabel: \"Other\",\n\t\ticon: <FileText className=\"h-4 w-4\" />,\n\t\tcolor: \"text-muted-foreground\",\n\t},\n];\n\nconst followUpOptions: Array<{\n\tvalue: FollowUpType;\n\tlabel: string;\n\ticon: React.ReactNode;\n}> = [\n\t{\n\t\tvalue: \"callback\",\n\t\tlabel: \"Callback\",\n\t\ticon: <Phone className=\"h-4 w-4\" />,\n\t},\n\t{\n\t\tvalue: \"email\",\n\t\tlabel: \"Email\",\n\t\ticon: <Mail className=\"h-4 w-4\" />,\n\t},\n\t{\n\t\tvalue: \"sms\",\n\t\tlabel: \"SMS\",\n\t\ticon: <MessageSquare className=\"h-4 w-4\" />,\n\t},\n\t{\n\t\tvalue: \"appointment\",\n\t\tlabel: \"Appointment\",\n\t\ticon: <Calendar className=\"h-4 w-4\" />,\n\t},\n];\n\nexport function CallWrapUpDialog({\n\topen,\n\tonOpenChange,\n\tonComplete,\n\tonCancel,\n\tcallDuration,\n\tcustomerName,\n\tcustomerEmail,\n\texistingNotes = \"\",\n\tisSubmitting = false,\n}: CallWrapUpDialogProps) {\n\t// Form state\n\tconst [disposition, setDisposition] = useState<CallDisposition | \"\">(\"\");\n\tconst [notes, setNotes] = useState(existingNotes);\n\tconst [followUpEnabled, setFollowUpEnabled] = useState(false);\n\tconst [followUpType, setFollowUpType] = useState<FollowUpType>(\"callback\");\n\tconst [sendConfirmation, setSendConfirmation] = useState(false);\n\tconst [createJob, setCreateJob] = useState(false);\n\n\t// Validation\n\tconst notesRequired = callDuration > 120; // 2 minutes\n\tconst isValid =\n\t\tdisposition !== \"\" && (!notesRequired || notes.trim().length > 0);\n\n\t// Format call duration\n\tconst formatDuration = (seconds: number): string => {\n\t\tconst mins = Math.floor(seconds / 60);\n\t\tconst secs = seconds % 60;\n\t\treturn `${mins}:${secs.toString().padStart(2, \"0\")}`;\n\t};\n\n\t// Handle completion\n\tconst handleComplete = useCallback(() => {\n\t\tif (!isValid || !disposition) return;\n\n\t\tonComplete({\n\t\t\tdisposition,\n\t\t\tnotes: notes.trim(),\n\t\t\tfollowUp: {\n\t\t\t\tenabled: followUpEnabled,\n\t\t\t\ttype: followUpType,\n\t\t\t},\n\t\t\tsendConfirmation,\n\t\t\tcreateJob,\n\t\t});\n\t}, [\n\t\tisValid,\n\t\tdisposition,\n\t\tnotes,\n\t\tfollowUpEnabled,\n\t\tfollowUpType,\n\t\tsendConfirmation,\n\t\tcreateJob,\n\t\tonComplete,\n\t]);\n\n\t// Reset form when dialog opens\n\tuseEffect(() => {\n\t\tif (open) {\n\t\t\tsetDisposition(\"\");\n\t\t\tsetNotes(existingNotes);\n\t\t\tsetFollowUpEnabled(false);\n\t\t\tsetFollowUpType(\"callback\");\n\t\t\tsetSendConfirmation(false);\n\t\t\tsetCreateJob(false);\n\t\t}\n\t}, [open, existingNotes]);\n\n\t// Handle keyboard shortcuts\n\tuseEffect(() => {\n\t\tconst handleKeyDown = (e: KeyboardEvent) => {\n\t\t\tif (!open) return;\n\n\t\t\tif (e.key === \"Enter\" && (e.ctrlKey || e.metaKey) && isValid) {\n\t\t\t\te.preventDefault();\n\t\t\t\thandleComplete();\n\t\t\t}\n\t\t};\n\n\t\twindow.addEventListener(\"keydown\", handleKeyDown);\n\t\treturn () => window.removeEventListener(\"keydown\", handleKeyDown);\n\t}, [open, isValid, handleComplete]);\n\n\treturn (\n\t\t<Dialog onOpenChange={onOpenChange} open={open}>\n\t\t\t<DialogContent className=\"max-w-lg\">\n\t\t\t\t<DialogHeader>\n\t\t\t\t\t<DialogTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<PhoneOff className=\"text-destructive h-5 w-5\" />\n\t\t\t\t\t\tWrap Up Call\n\t\t\t\t\t</DialogTitle>\n\t\t\t\t\t<DialogDescription className=\"flex items-center gap-4\">\n\t\t\t\t\t\t<span>Complete this form before ending the call with</span>\n\t\t\t\t\t\t<Badge variant=\"outline\">{customerName}</Badge>\n\t\t\t\t\t</DialogDescription>\n\t\t\t\t</DialogHeader>\n\n\t\t\t\t{/* Call Duration */}\n\t\t\t\t<div className=\"bg-muted/50 flex items-center justify-between rounded-lg border p-3\">\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Clock className=\"text-muted-foreground h-4 w-4\" />\n\t\t\t\t\t\t<span className=\"text-sm font-medium\">Call Duration</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<Badge variant=\"secondary\" className=\"font-mono\">\n\t\t\t\t\t\t{formatDuration(callDuration)}\n\t\t\t\t\t</Badge>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Disposition (Required) */}\n\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t<Label className=\"flex items-center gap-1\">\n\t\t\t\t\t\tCall Disposition\n\t\t\t\t\t\t<span className=\"text-destructive\">*</span>\n\t\t\t\t\t</Label>\n\t\t\t\t\t<Select\n\t\t\t\t\t\tvalue={disposition}\n\t\t\t\t\t\tonValueChange={(value) => setDisposition(value as CallDisposition)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<SelectTrigger\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t!disposition && \"border-destructive/50\",\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<SelectValue placeholder=\"Select outcome...\" />\n\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t{dispositionOptions.map((option) => (\n\t\t\t\t\t\t\t\t<SelectItem key={option.value} value={option.value}>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t<span className={option.color}>{option.icon}</span>\n\t\t\t\t\t\t\t\t\t\t<span>{option.label}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t</Select>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Notes */}\n\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t<Label className=\"flex items-center gap-1\">\n\t\t\t\t\t\tCall Notes\n\t\t\t\t\t\t{notesRequired && <span className=\"text-destructive\">*</span>}\n\t\t\t\t\t\t{!notesRequired && (\n\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs ml-1\">\n\t\t\t\t\t\t\t\t(optional for short calls)\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</Label>\n\t\t\t\t\t<Textarea\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"min-h-[100px] resize-none\",\n\t\t\t\t\t\t\tnotesRequired && !notes.trim() && \"border-destructive/50\",\n\t\t\t\t\t\t)}\n\t\t\t\t\t\tplaceholder=\"Summarize the call, customer's issue, and resolution...\"\n\t\t\t\t\t\tvalue={notes}\n\t\t\t\t\t\tonChange={(e) => setNotes(e.target.value)}\n\t\t\t\t\t/>\n\t\t\t\t\t{notesRequired && !notes.trim() && (\n\t\t\t\t\t\t<p className=\"text-destructive text-xs flex items-center gap-1\">\n\t\t\t\t\t\t\t<AlertTriangle className=\"h-3 w-3\" />\n\t\t\t\t\t\t\tNotes required for calls over 2 minutes\n\t\t\t\t\t\t</p>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{/* Follow-up Options */}\n\t\t\t\t<div className=\"space-y-3 rounded-lg border p-4\">\n\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Checkbox\n\t\t\t\t\t\t\t\tid=\"followUp\"\n\t\t\t\t\t\t\t\tchecked={followUpEnabled}\n\t\t\t\t\t\t\t\tonCheckedChange={(checked) =>\n\t\t\t\t\t\t\t\t\tsetFollowUpEnabled(checked as boolean)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Label\n\t\t\t\t\t\t\t\thtmlFor=\"followUp\"\n\t\t\t\t\t\t\t\tclassName=\"text-sm font-medium cursor-pointer\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tSchedule Follow-up\n\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{followUpEnabled && (\n\t\t\t\t\t\t\t<Select\n\t\t\t\t\t\t\t\tvalue={followUpType}\n\t\t\t\t\t\t\t\tonValueChange={(value) =>\n\t\t\t\t\t\t\t\t\tsetFollowUpType(value as FollowUpType)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<SelectTrigger className=\"w-[140px] h-8\">\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{followUpOptions.map((option) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={option.value} value={option.value}>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t{option.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t<span>{option.label}</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Email Confirmation */}\n\t\t\t\t\t{customerEmail && (\n\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Checkbox\n\t\t\t\t\t\t\t\tid=\"sendConfirmation\"\n\t\t\t\t\t\t\t\tchecked={sendConfirmation}\n\t\t\t\t\t\t\t\tonCheckedChange={(checked) =>\n\t\t\t\t\t\t\t\t\tsetSendConfirmation(checked as boolean)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Label\n\t\t\t\t\t\t\t\thtmlFor=\"sendConfirmation\"\n\t\t\t\t\t\t\t\tclassName=\"text-sm cursor-pointer flex items-center gap-1\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Mail className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\tSend confirmation email\n\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Create Job */}\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Checkbox\n\t\t\t\t\t\t\tid=\"createJob\"\n\t\t\t\t\t\t\tchecked={createJob}\n\t\t\t\t\t\t\tonCheckedChange={(checked) => setCreateJob(checked as boolean)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Label\n\t\t\t\t\t\t\thtmlFor=\"createJob\"\n\t\t\t\t\t\t\tclassName=\"text-sm cursor-pointer flex items-center gap-1\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Plus className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\tCreate job from this call\n\t\t\t\t\t\t</Label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<DialogFooter className=\"gap-2 sm:gap-0\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\tonClick={onCancel}\n\t\t\t\t\t\tdisabled={isSubmitting}\n\t\t\t\t\t>\n\t\t\t\t\t\tContinue Call\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\tonClick={handleComplete}\n\t\t\t\t\t\tdisabled={!isValid || isSubmitting}\n\t\t\t\t\t\tclassName=\"gap-2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{isSubmitting ? (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<Loader2 className=\"h-4 w-4 animate-spin\" />\n\t\t\t\t\t\t\t\tSaving...\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<PhoneOff className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\tEnd Call\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</Button>\n\t\t\t\t</DialogFooter>\n\n\t\t\t\t{/* Keyboard hint */}\n\t\t\t\t<p className=\"text-muted-foreground text-center text-xs\">\n\t\t\t\t\tPress{\" \"}\n\t\t\t\t\t<kbd className=\"bg-muted rounded px-1.5 py-0.5 font-mono\">\n\t\t\t\t\t\tCtrl+Enter\n\t\t\t\t\t</kbd>{\" \"}\n\t\t\t\t\tto complete\n\t\t\t\t</p>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n","\"use client\";\n\n/**\n * Keyboard Shortcuts Help Panel\n *\n * Floating help panel showing all available keyboard shortcuts\n * for the call window. CSRs need to be fast during calls, and\n * keyboard shortcuts are essential for efficiency.\n *\n * Triggered by pressing \"?\" or clicking the shortcuts icon.\n */\n\nimport {\n\tCalendar,\n\tFileText,\n\tKeyboard,\n\tMic,\n\tMicOff,\n\tPause,\n\tPhone,\n\tPhoneOff,\n\tPlay,\n\tPlus,\n\tSquare,\n\tX,\n} from \"lucide-react\";\nimport { useEffect } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDialog,\n\tDialogContent,\n\tDialogDescription,\n\tDialogHeader,\n\tDialogTitle,\n} from \"@/components/ui/dialog\";\nimport { cn } from \"@/lib/utils\";\n\ntype ShortcutCategory = {\n\ttitle: string;\n\tshortcuts: Shortcut[];\n};\n\ntype Shortcut = {\n\tkeys: string[];\n\tdescription: string;\n\ticon?: React.ReactNode;\n\tdestructive?: boolean;\n};\n\nconst shortcutCategories: ShortcutCategory[] = [\n\t{\n\t\ttitle: \"Call Controls\",\n\t\tshortcuts: [\n\t\t\t{\n\t\t\t\tkeys: [\"M\"],\n\t\t\t\tdescription: \"Toggle mute/unmute\",\n\t\t\t\ticon: <Mic className=\"h-3.5 w-3.5\" />,\n\t\t\t},\n\t\t\t{\n\t\t\t\tkeys: [\"H\"],\n\t\t\t\tdescription: \"Toggle hold/resume\",\n\t\t\t\ticon: <Pause className=\"h-3.5 w-3.5\" />,\n\t\t\t},\n\t\t\t{\n\t\t\t\tkeys: [\"R\"],\n\t\t\t\tdescription: \"Toggle recording\",\n\t\t\t\ticon: <Square className=\"h-3.5 w-3.5\" />,\n\t\t\t},\n\t\t\t{\n\t\t\t\tkeys: [\"T\"],\n\t\t\t\tdescription: \"Transfer call\",\n\t\t\t\ticon: <Phone className=\"h-3.5 w-3.5\" />,\n\t\t\t},\n\t\t\t{\n\t\t\t\tkeys: [\"Shift\", \"E\"],\n\t\t\t\tdescription: \"End call\",\n\t\t\t\ticon: <PhoneOff className=\"h-3.5 w-3.5\" />,\n\t\t\t\tdestructive: true,\n\t\t\t},\n\t\t],\n\t},\n\t{\n\t\ttitle: \"Quick Actions\",\n\t\tshortcuts: [\n\t\t\t{\n\t\t\t\tkeys: [\"J\"],\n\t\t\t\tdescription: \"Create new job\",\n\t\t\t\ticon: <Plus className=\"h-3.5 w-3.5\" />,\n\t\t\t},\n\t\t\t{\n\t\t\t\tkeys: [\"A\"],\n\t\t\t\tdescription: \"Schedule appointment\",\n\t\t\t\ticon: <Calendar className=\"h-3.5 w-3.5\" />,\n\t\t\t},\n\t\t\t{\n\t\t\t\tkeys: [\"N\"],\n\t\t\t\tdescription: \"Focus notes field\",\n\t\t\t\ticon: <FileText className=\"h-3.5 w-3.5\" />,\n\t\t\t},\n\t\t\t{\n\t\t\t\tkeys: [\"S\"],\n\t\t\t\tdescription: \"Send SMS to customer\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkeys: [\"E\"],\n\t\t\t\tdescription: \"Send email to customer\",\n\t\t\t},\n\t\t],\n\t},\n\t{\n\t\ttitle: \"Navigation\",\n\t\tshortcuts: [\n\t\t\t{\n\t\t\t\tkeys: [\"1\"],\n\t\t\t\tdescription: \"View transcript panel\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkeys: [\"2\"],\n\t\t\t\tdescription: \"View schedule panel\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkeys: [\"Tab\"],\n\t\t\t\tdescription: \"Cycle through sections\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkeys: [\"Esc\"],\n\t\t\t\tdescription: \"Close dialogs/minimize\",\n\t\t\t},\n\t\t],\n\t},\n\t{\n\t\ttitle: \"General\",\n\t\tshortcuts: [\n\t\t\t{\n\t\t\t\tkeys: [\"?\"],\n\t\t\t\tdescription: \"Show this help panel\",\n\t\t\t\ticon: <Keyboard className=\"h-3.5 w-3.5\" />,\n\t\t\t},\n\t\t\t{\n\t\t\t\tkeys: [\"Ctrl\", \"S\"],\n\t\t\t\tdescription: \"Save notes\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkeys: [\"Ctrl\", \"C\"],\n\t\t\t\tdescription: \"Copy selected text\",\n\t\t\t},\n\t\t],\n\t},\n];\n\ntype KeyboardShortcutsHelpProps = {\n\topen: boolean;\n\tonOpenChange: (open: boolean) => void;\n};\n\nexport function KeyboardShortcutsHelp({\n\topen,\n\tonOpenChange,\n}: KeyboardShortcutsHelpProps) {\n\t// Close on Escape\n\tuseEffect(() => {\n\t\tconst handleKeyDown = (e: KeyboardEvent) => {\n\t\t\tif (e.key === \"Escape\" && open) {\n\t\t\t\tonOpenChange(false);\n\t\t\t}\n\t\t};\n\n\t\twindow.addEventListener(\"keydown\", handleKeyDown);\n\t\treturn () => window.removeEventListener(\"keydown\", handleKeyDown);\n\t}, [open, onOpenChange]);\n\n\treturn (\n\t\t<Dialog onOpenChange={onOpenChange} open={open}>\n\t\t\t<DialogContent className=\"max-h-[85vh] max-w-2xl overflow-y-auto\">\n\t\t\t\t<DialogHeader>\n\t\t\t\t\t<DialogTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Keyboard className=\"h-5 w-5\" />\n\t\t\t\t\t\tKeyboard Shortcuts\n\t\t\t\t\t</DialogTitle>\n\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\tUse these shortcuts for faster call handling. Press{\" \"}\n\t\t\t\t\t\t<kbd className=\"bg-muted rounded px-1.5 py-0.5 font-mono text-xs\">\n\t\t\t\t\t\t\t?\n\t\t\t\t\t\t</kbd>{\" \"}\n\t\t\t\t\t\tanytime to show this panel.\n\t\t\t\t\t</DialogDescription>\n\t\t\t\t</DialogHeader>\n\n\t\t\t\t<div className=\"mt-4 grid grid-cols-2 gap-6\">\n\t\t\t\t\t{shortcutCategories.map((category) => (\n\t\t\t\t\t\t<div className=\"space-y-3\" key={category.title}>\n\t\t\t\t\t\t\t<h3 className=\"text-sm font-semibold\">{category.title}</h3>\n\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t{category.shortcuts.map((shortcut, index) => (\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center justify-between rounded-lg border p-2\"\n\t\t\t\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t{shortcut.icon && (\n\t\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshortcut.destructive && \"text-destructive\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{shortcut.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"text-sm\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tshortcut.destructive && \"text-destructive\",\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{shortcut.description}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t{shortcut.keys.map((key, keyIndex) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<span key={keyIndex}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<kbd\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"bg-muted inline-flex min-w-[24px] items-center justify-center rounded px-1.5 py-0.5 font-mono text-xs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tshortcut.destructive &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"bg-destructive/10 text-destructive\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{key}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</kbd>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{keyIndex < shortcut.keys.length - 1 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground mx-0.5 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"bg-muted/50 mt-6 rounded-lg border p-4\">\n\t\t\t\t\t<div className=\"flex items-start gap-3\">\n\t\t\t\t\t\t<div className=\"bg-primary/10 rounded-full p-2\">\n\t\t\t\t\t\t\t<Keyboard className=\"text-primary h-4 w-4\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<h4 className=\"text-sm font-medium\">Pro Tips</h4>\n\t\t\t\t\t\t\t<ul className=\"text-muted-foreground mt-1 space-y-1 text-xs\">\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t Shortcuts only work when the call window is focused\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t Use{\" \"}\n\t\t\t\t\t\t\t\t\t<kbd className=\"bg-muted rounded px-1 font-mono\">Shift+E</kbd>{\" \"}\n\t\t\t\t\t\t\t\t\tfor end call to prevent accidental hangups\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t Press{\" \"}\n\t\t\t\t\t\t\t\t\t<kbd className=\"bg-muted rounded px-1 font-mono\">N</kbd> to\n\t\t\t\t\t\t\t\t\tquickly add notes during a call\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t The mute indicator turns red when you're muted\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n\n/**\n * Keyboard Shortcuts Button\n *\n * Small button to trigger the shortcuts help panel.\n * Can be placed in the toolbar or header.\n */\ntype KeyboardShortcutsButtonProps = {\n\tonClick: () => void;\n\tclassName?: string;\n};\n\nexport function KeyboardShortcutsButton({\n\tonClick,\n\tclassName,\n}: KeyboardShortcutsButtonProps) {\n\treturn (\n\t\t<Button\n\t\t\tclassName={cn(\"h-8 w-8\", className)}\n\t\t\tonClick={onClick}\n\t\t\tsize=\"icon\"\n\t\t\ttitle=\"Keyboard shortcuts (?)\"\n\t\t\tvariant=\"ghost\"\n\t\t>\n\t\t\t<Keyboard className=\"h-4 w-4\" />\n\t\t</Button>\n\t);\n}\n","\"use client\";\n\n/**\n * AI Suggestions Widget\n *\n * Displays AI-powered suggestions for next best actions during a call.\n * Analyzes transcript and customer context to recommend actions.\n *\n * Suggestions include:\n * - Create emergency job (detected urgency)\n * - Schedule maintenance (detected need)\n * - Offer payment plan (outstanding balance)\n * - Apply discount (unhappy customer)\n * - Escalate to manager (complex issue)\n */\n\nimport {\n\tAlertTriangle,\n\tArrowRight,\n\tBadgePercent,\n\tBriefcase,\n\tCalendar,\n\tCheckCircle2,\n\tCreditCard,\n\tLightbulb,\n\tLoader2,\n\tMessageSquare,\n\tPhone,\n\tRefreshCw,\n\tSparkles,\n\tThumbsDown,\n\tUserCog,\n\tX,\n\tZap,\n} from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { cn } from \"@/lib/utils\";\n\ntype SuggestionType =\n\t| \"emergency_job\"\n\t| \"schedule_maintenance\"\n\t| \"take_payment\"\n\t| \"offer_discount\"\n\t| \"escalate\"\n\t| \"send_quote\"\n\t| \"book_callback\"\n\t| \"upsell\"\n\t| \"retention_offer\"\n\t| \"verify_info\";\n\ntype Suggestion = {\n\tid: string;\n\ttype: SuggestionType;\n\ttitle: string;\n\tdescription: string;\n\treason: string;\n\tconfidence: number; // 0-100\n\tpriority: \"high\" | \"medium\" | \"low\";\n\taction: () => void;\n\tdismissed?: boolean;\n};\n\ntype AISuggestionsWidgetProps = {\n\tsuggestions: Suggestion[];\n\tisAnalyzing?: boolean;\n\tonRefresh?: () => void;\n\tonDismiss?: (suggestionId: string) => void;\n\tonAccept?: (suggestion: Suggestion) => void;\n\tclassName?: string;\n\tcompact?: boolean;\n};\n\nconst suggestionConfig: Record<\n\tSuggestionType,\n\t{\n\t\ticon: React.ElementType;\n\t\tcolor: string;\n\t\tbgColor: string;\n\t\tborderColor: string;\n\t}\n> = {\n\temergency_job: {\n\t\ticon: Zap,\n\t\tcolor: \"text-destructive\",\n\t\tbgColor: \"bg-destructive/10\",\n\t\tborderColor: \"border-destructive/30\",\n\t},\n\tschedule_maintenance: {\n\t\ticon: Calendar,\n\t\tcolor: \"text-primary\",\n\t\tbgColor: \"bg-primary/10\",\n\t\tborderColor: \"border-primary/30\",\n\t},\n\ttake_payment: {\n\t\ticon: CreditCard,\n\t\tcolor: \"text-success\",\n\t\tbgColor: \"bg-success/10\",\n\t\tborderColor: \"border-success/30\",\n\t},\n\toffer_discount: {\n\t\ticon: BadgePercent,\n\t\tcolor: \"text-warning\",\n\t\tbgColor: \"bg-warning/10\",\n\t\tborderColor: \"border-warning/30\",\n\t},\n\tescalate: {\n\t\ticon: UserCog,\n\t\tcolor: \"text-orange-500\",\n\t\tbgColor: \"bg-orange-500/10\",\n\t\tborderColor: \"border-orange-500/30\",\n\t},\n\tsend_quote: {\n\t\ticon: MessageSquare,\n\t\tcolor: \"text-primary\",\n\t\tbgColor: \"bg-primary/10\",\n\t\tborderColor: \"border-primary/30\",\n\t},\n\tbook_callback: {\n\t\ticon: Phone,\n\t\tcolor: \"text-muted-foreground\",\n\t\tbgColor: \"bg-muted\",\n\t\tborderColor: \"border-muted\",\n\t},\n\tupsell: {\n\t\ticon: Briefcase,\n\t\tcolor: \"text-success\",\n\t\tbgColor: \"bg-success/10\",\n\t\tborderColor: \"border-success/30\",\n\t},\n\tretention_offer: {\n\t\ticon: ThumbsDown,\n\t\tcolor: \"text-warning\",\n\t\tbgColor: \"bg-warning/10\",\n\t\tborderColor: \"border-warning/30\",\n\t},\n\tverify_info: {\n\t\ticon: CheckCircle2,\n\t\tcolor: \"text-muted-foreground\",\n\t\tbgColor: \"bg-muted\",\n\t\tborderColor: \"border-muted\",\n\t},\n};\n\nconst priorityOrder = { high: 0, medium: 1, low: 2 };\n\nexport function AISuggestionsWidget({\n\tsuggestions,\n\tisAnalyzing = false,\n\tonRefresh,\n\tonDismiss,\n\tonAccept,\n\tclassName,\n\tcompact = false,\n}: AISuggestionsWidgetProps) {\n\tconst [dismissedIds, setDismissedIds] = useState<Set<string>>(new Set());\n\n\t// Filter and sort suggestions\n\tconst visibleSuggestions = suggestions\n\t\t.filter((s) => !dismissedIds.has(s.id) && !s.dismissed)\n\t\t.sort((a, b) => {\n\t\t\t// Sort by priority first, then by confidence\n\t\t\tconst priorityDiff = priorityOrder[a.priority] - priorityOrder[b.priority];\n\t\t\tif (priorityDiff !== 0) return priorityDiff;\n\t\t\treturn b.confidence - a.confidence;\n\t\t})\n\t\t.slice(0, compact ? 2 : 4); // Show fewer in compact mode\n\n\tconst handleDismiss = (suggestionId: string) => {\n\t\tsetDismissedIds((prev) => new Set([...prev, suggestionId]));\n\t\tonDismiss?.(suggestionId);\n\t};\n\n\tconst handleAccept = (suggestion: Suggestion) => {\n\t\tsuggestion.action();\n\t\tonAccept?.(suggestion);\n\t\thandleDismiss(suggestion.id);\n\t};\n\n\tif (visibleSuggestions.length === 0 && !isAnalyzing) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<TooltipProvider delayDuration={300}>\n\t\t\t<div\n\t\t\t\tclassName={cn(\n\t\t\t\t\t\"overflow-hidden rounded-xl border shadow-sm\",\n\t\t\t\t\t\"bg-gradient-to-br from-violet-500/5 via-transparent to-indigo-500/5\",\n\t\t\t\t\t\"border-violet-500/20\",\n\t\t\t\t\tclassName,\n\t\t\t\t)}\n\t\t\t>\n\t\t\t\t{/* Header */}\n\t\t\t\t<div className=\"flex items-center justify-between border-b border-violet-500/10 px-4 py-2\">\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<div className=\"rounded-full bg-violet-500/10 p-1.5\">\n\t\t\t\t\t\t\t<Sparkles className=\"h-3.5 w-3.5 text-violet-500\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span className=\"text-sm font-semibold\">AI Suggestions</span>\n\t\t\t\t\t\t{isAnalyzing && (\n\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\tclassName=\"gap-1 border-violet-500/30 text-[10px] text-violet-500\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Loader2 className=\"h-2.5 w-2.5 animate-spin\" />\n\t\t\t\t\t\t\t\tAnalyzing...\n\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t\t{onRefresh && (\n\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName=\"h-7 w-7\"\n\t\t\t\t\t\t\t\t\tonClick={onRefresh}\n\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\tdisabled={isAnalyzing}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<RefreshCw\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"h-3.5 w-3.5\",\n\t\t\t\t\t\t\t\t\t\t\tisAnalyzing && \"animate-spin\",\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent>Refresh suggestions</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{/* Suggestions List */}\n\t\t\t\t<div className=\"space-y-2 p-3\">\n\t\t\t\t\t{visibleSuggestions.map((suggestion) => {\n\t\t\t\t\t\tconst config = suggestionConfig[suggestion.type];\n\t\t\t\t\t\tconst Icon = config.icon;\n\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\"group relative rounded-lg border p-3 transition-all\",\n\t\t\t\t\t\t\t\t\tconfig.bgColor,\n\t\t\t\t\t\t\t\t\tconfig.borderColor,\n\t\t\t\t\t\t\t\t\t\"hover:shadow-md\",\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\tkey={suggestion.id}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"flex items-start gap-3\">\n\t\t\t\t\t\t\t\t\t{/* Icon */}\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"mt-0.5 rounded-full p-2\",\n\t\t\t\t\t\t\t\t\t\t\tconfig.bgColor,\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Icon className={cn(\"h-4 w-4\", config.color)} />\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{/* Content */}\n\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<h4\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"text-sm font-semibold\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tconfig.color,\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{suggestion.title}\n\t\t\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t\t\t\t{suggestion.priority === \"high\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"border-destructive/50 bg-destructive/10 text-[10px] text-destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\tUrgent\n\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground ml-auto text-[10px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t{suggestion.confidence}% confident\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mt-0.5 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{suggestion.description}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t{!compact && (\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"mt-1 text-[10px] italic opacity-70\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Lightbulb className=\"mr-1 inline h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t{suggestion.reason}\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t{/* Action buttons */}\n\t\t\t\t\t\t\t\t\t\t<div className=\"mt-2 flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"h-7 gap-1 text-xs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tconfig.color,\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleAccept(suggestion)}\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{suggestion.title.split(\" \")[0]}\n\t\t\t\t\t\t\t\t\t\t\t\t<ArrowRight className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-7 w-7 opacity-0 transition-opacity group-hover:opacity-100\"\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDismiss(suggestion.id)}\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<X className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n\t\t\t\t\t})}\n\n\t\t\t\t\t{/* Loading state */}\n\t\t\t\t\t{isAnalyzing && visibleSuggestions.length === 0 && (\n\t\t\t\t\t\t<div className=\"flex items-center justify-center py-6\">\n\t\t\t\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t\t\t\t<Loader2 className=\"mx-auto h-6 w-6 animate-spin text-violet-500\" />\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mt-2 text-xs\">\n\t\t\t\t\t\t\t\t\tAnalyzing conversation...\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{/* Footer hint */}\n\t\t\t\t{visibleSuggestions.length > 0 && (\n\t\t\t\t\t<div className=\"border-t border-violet-500/10 px-3 py-2\">\n\t\t\t\t\t\t<p className=\"text-muted-foreground/60 text-center text-[10px]\">\n\t\t\t\t\t\t\tSuggestions based on transcript analysis and customer history\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</TooltipProvider>\n\t);\n}\n\n/**\n * Generate mock suggestions based on context\n * In production, this would call an AI service\n */\nexport function generateMockSuggestions(context: {\n\thasOutstandingBalance?: boolean;\n\tbalanceAmount?: number;\n\tcustomerSentiment?: \"positive\" | \"neutral\" | \"negative\";\n\tmentionedIssue?: string;\n\tisEmergency?: boolean;\n\tisMaintenanceDue?: boolean;\n\tisAtRisk?: boolean;\n}): Suggestion[] {\n\tconst suggestions: Suggestion[] = [];\n\n\tif (context.isEmergency) {\n\t\tsuggestions.push({\n\t\t\tid: \"emergency_job\",\n\t\t\ttype: \"emergency_job\",\n\t\t\ttitle: \"Create Emergency Job\",\n\t\t\tdescription: \"Customer mentioned urgent issue requiring immediate attention\",\n\t\t\treason: \"Detected keywords: 'leak', 'flooding', 'no heat', 'emergency'\",\n\t\t\tconfidence: 95,\n\t\t\tpriority: \"high\",\n\t\t\taction: () => console.log(\"Creating emergency job...\"),\n\t\t});\n\t}\n\n\tif (context.hasOutstandingBalance && context.balanceAmount) {\n\t\tsuggestions.push({\n\t\t\tid: \"take_payment\",\n\t\t\ttype: \"take_payment\",\n\t\t\ttitle: \"Offer Payment\",\n\t\t\tdescription: `Outstanding balance of $${context.balanceAmount.toLocaleString()}`,\n\t\t\treason: \"Customer has unpaid invoices - good opportunity to collect\",\n\t\t\tconfidence: 80,\n\t\t\tpriority: \"medium\",\n\t\t\taction: () => console.log(\"Opening payment...\"),\n\t\t});\n\t}\n\n\tif (context.customerSentiment === \"negative\") {\n\t\tsuggestions.push({\n\t\t\tid: \"offer_discount\",\n\t\t\ttype: \"offer_discount\",\n\t\t\ttitle: \"Consider Discount\",\n\t\t\tdescription: \"Customer seems frustrated - consider offering a goodwill discount\",\n\t\t\treason: \"Detected negative sentiment in conversation\",\n\t\t\tconfidence: 75,\n\t\t\tpriority: \"medium\",\n\t\t\taction: () => console.log(\"Applying discount...\"),\n\t\t});\n\t}\n\n\tif (context.isAtRisk) {\n\t\tsuggestions.push({\n\t\t\tid: \"retention_offer\",\n\t\t\ttype: \"retention_offer\",\n\t\t\ttitle: \"Retention Offer\",\n\t\t\tdescription: \"Customer at risk of churning - offer loyalty incentive\",\n\t\t\treason: \"Multiple cancelled appointments detected\",\n\t\t\tconfidence: 70,\n\t\t\tpriority: \"medium\",\n\t\t\taction: () => console.log(\"Showing retention offers...\"),\n\t\t});\n\t}\n\n\tif (context.isMaintenanceDue) {\n\t\tsuggestions.push({\n\t\t\tid: \"schedule_maintenance\",\n\t\t\ttype: \"schedule_maintenance\",\n\t\t\ttitle: \"Schedule Maintenance\",\n\t\t\tdescription: \"Annual maintenance is due for this customer\",\n\t\t\treason: \"Last maintenance was over 12 months ago\",\n\t\t\tconfidence: 85,\n\t\t\tpriority: \"low\",\n\t\t\taction: () => console.log(\"Opening scheduler...\"),\n\t\t});\n\t}\n\n\treturn suggestions;\n}\n","\"use client\";\n\n/**\n * Sentiment Indicator Component\n *\n * Real-time display of customer sentiment during calls.\n * Analyzes transcript to detect emotional state and alerts CSR\n * when sentiment drops so they can adjust their approach.\n *\n * Features:\n * - Real-time sentiment score (1-100)\n * - Visual indicator (emoji + color)\n * - Trend direction (improving/declining)\n * - Alert when sentiment drops significantly\n * - History sparkline\n */\n\nimport {\n\tAlertTriangle,\n\tArrowDown,\n\tArrowRight,\n\tArrowUp,\n\tFrown,\n\tMeh,\n\tSmile,\n\tTrendingDown,\n\tTrendingUp,\n} from \"lucide-react\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { cn } from \"@/lib/utils\";\n\ntype SentimentLevel = \"positive\" | \"neutral\" | \"negative\";\n\ntype SentimentData = {\n\tscore: number; // 0-100 (0 = very negative, 100 = very positive)\n\tlevel: SentimentLevel;\n\ttrend: \"improving\" | \"stable\" | \"declining\";\n\tconfidence: number; // 0-100\n\tlastChange?: number; // Change from previous reading\n\tkeywords?: string[]; // Detected emotional keywords\n};\n\ntype SentimentIndicatorProps = {\n\tsentiment: SentimentData;\n\tshowTrend?: boolean;\n\tshowKeywords?: boolean;\n\tcompact?: boolean;\n\tonAlert?: (sentiment: SentimentData) => void;\n\tclassName?: string;\n};\n\nconst sentimentConfig: Record<\n\tSentimentLevel,\n\t{\n\t\temoji: string;\n\t\ticon: React.ElementType;\n\t\tlabel: string;\n\t\tcolor: string;\n\t\tbgColor: string;\n\t\tborderColor: string;\n\t}\n> = {\n\tpositive: {\n\t\temoji: \"\",\n\t\ticon: Smile,\n\t\tlabel: \"Happy\",\n\t\tcolor: \"text-success\",\n\t\tbgColor: \"bg-success/10\",\n\t\tborderColor: \"border-success/30\",\n\t},\n\tneutral: {\n\t\temoji: \"\",\n\t\ticon: Meh,\n\t\tlabel: \"Neutral\",\n\t\tcolor: \"text-muted-foreground\",\n\t\tbgColor: \"bg-muted\",\n\t\tborderColor: \"border-muted\",\n\t},\n\tnegative: {\n\t\temoji: \"\",\n\t\ticon: Frown,\n\t\tlabel: \"Frustrated\",\n\t\tcolor: \"text-destructive\",\n\t\tbgColor: \"bg-destructive/10\",\n\t\tborderColor: \"border-destructive/30\",\n\t},\n};\n\nconst trendConfig = {\n\timproving: {\n\t\ticon: TrendingUp,\n\t\tlabel: \"Improving\",\n\t\tcolor: \"text-success\",\n\t},\n\tstable: {\n\t\ticon: ArrowRight,\n\t\tlabel: \"Stable\",\n\t\tcolor: \"text-muted-foreground\",\n\t},\n\tdeclining: {\n\t\ticon: TrendingDown,\n\t\tlabel: \"Declining\",\n\t\tcolor: \"text-destructive\",\n\t},\n};\n\nexport function SentimentIndicator({\n\tsentiment,\n\tshowTrend = true,\n\tshowKeywords = false,\n\tcompact = false,\n\tonAlert,\n\tclassName,\n}: SentimentIndicatorProps) {\n\tconst [showAlert, setShowAlert] = useState(false);\n\tconst config = sentimentConfig[sentiment.level];\n\tconst trend = trendConfig[sentiment.trend];\n\tconst Icon = config.icon;\n\tconst TrendIcon = trend.icon;\n\n\t// Show alert when sentiment drops significantly\n\tuseEffect(() => {\n\t\tif (\n\t\t\tsentiment.trend === \"declining\" &&\n\t\t\tsentiment.lastChange &&\n\t\t\tsentiment.lastChange < -15\n\t\t) {\n\t\t\tsetShowAlert(true);\n\t\t\tonAlert?.(sentiment);\n\n\t\t\t// Auto-dismiss after 5 seconds\n\t\t\tconst timer = setTimeout(() => setShowAlert(false), 5000);\n\t\t\treturn () => clearTimeout(timer);\n\t\t}\n\t}, [sentiment, onAlert]);\n\n\t// Calculate sentiment bar width\n\tconst barWidth = useMemo(() => {\n\t\treturn `${Math.max(0, Math.min(100, sentiment.score))}%`;\n\t}, [sentiment.score]);\n\n\tif (compact) {\n\t\treturn (\n\t\t\t<TooltipProvider delayDuration={200}>\n\t\t\t\t<Tooltip>\n\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\"flex items-center gap-1.5 rounded-full border px-2 py-1\",\n\t\t\t\t\t\t\t\tconfig.bgColor,\n\t\t\t\t\t\t\t\tconfig.borderColor,\n\t\t\t\t\t\t\t\tshowAlert && \"animate-pulse ring-2 ring-destructive/50\",\n\t\t\t\t\t\t\t\tclassName,\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span className=\"text-sm\">{config.emoji}</span>\n\t\t\t\t\t\t\t{showTrend && (\n\t\t\t\t\t\t\t\t<TrendIcon className={cn(\"h-3 w-3\", trend.color)} />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\tCustomer is {config.label.toLowerCase()} ({sentiment.score}%)\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\tTrend: {trend.label}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</TooltipContent>\n\t\t\t\t</Tooltip>\n\t\t\t</TooltipProvider>\n\t\t);\n\t}\n\n\treturn (\n\t\t<TooltipProvider delayDuration={200}>\n\t\t\t<div\n\t\t\t\tclassName={cn(\n\t\t\t\t\t\"overflow-hidden rounded-xl border shadow-sm\",\n\t\t\t\t\tconfig.bgColor,\n\t\t\t\t\tconfig.borderColor,\n\t\t\t\t\tshowAlert && \"ring-2 ring-destructive/50\",\n\t\t\t\t\tclassName,\n\t\t\t\t)}\n\t\t\t>\n\t\t\t\t{/* Alert Banner */}\n\t\t\t\t{showAlert && (\n\t\t\t\t\t<div className=\"flex items-center gap-2 border-b border-destructive/30 bg-destructive/10 px-3 py-2\">\n\t\t\t\t\t\t<AlertTriangle className=\"h-4 w-4 animate-pulse text-destructive\" />\n\t\t\t\t\t\t<span className=\"text-xs font-medium text-destructive\">\n\t\t\t\t\t\t\tCustomer sentiment dropping - consider adjusting approach\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\n\t\t\t\t<div className=\"p-4\">\n\t\t\t\t\t{/* Main Display */}\n\t\t\t\t\t<div className=\"flex items-center gap-4\">\n\t\t\t\t\t\t{/* Emoji */}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\"flex h-14 w-14 items-center justify-center rounded-full text-3xl\",\n\t\t\t\t\t\t\t\tconfig.bgColor,\n\t\t\t\t\t\t\t\t\"ring-2\",\n\t\t\t\t\t\t\t\tconfig.borderColor,\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{config.emoji}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* Info */}\n\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<span className={cn(\"text-lg font-bold\", config.color)}>\n\t\t\t\t\t\t\t\t\t{config.label}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\tclassName={cn(\"text-xs\", config.borderColor, config.color)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{sentiment.score}%\n\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Trend */}\n\t\t\t\t\t\t\t{showTrend && (\n\t\t\t\t\t\t\t\t<div className=\"mt-1 flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t<TrendIcon className={cn(\"h-3.5 w-3.5\", trend.color)} />\n\t\t\t\t\t\t\t\t\t<span className={cn(\"text-xs\", trend.color)}>\n\t\t\t\t\t\t\t\t\t\t{trend.label}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t{sentiment.lastChange !== undefined && (\n\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\"text-xs\",\n\t\t\t\t\t\t\t\t\t\t\t\tsentiment.lastChange > 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"text-success\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: sentiment.lastChange < 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"text-destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t({sentiment.lastChange > 0 ? \"+\" : \"\"}\n\t\t\t\t\t\t\t\t\t\t\t{sentiment.lastChange}%)\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t{/* Confidence */}\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-[10px]\">\n\t\t\t\t\t\t\t\t{sentiment.confidence}% confidence\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Sentiment Bar */}\n\t\t\t\t\t<div className=\"mt-4\">\n\t\t\t\t\t\t<div className=\"relative h-2 overflow-hidden rounded-full bg-gradient-to-r from-destructive/20 via-warning/20 to-success/20\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\"absolute left-0 top-0 h-full transition-all duration-500\",\n\t\t\t\t\t\t\t\t\tsentiment.score > 66\n\t\t\t\t\t\t\t\t\t\t? \"bg-success\"\n\t\t\t\t\t\t\t\t\t\t: sentiment.score > 33\n\t\t\t\t\t\t\t\t\t\t\t? \"bg-warning\"\n\t\t\t\t\t\t\t\t\t\t\t: \"bg-destructive\",\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\tstyle={{ width: barWidth }}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/* Indicator dot */}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName=\"absolute top-1/2 h-4 w-4 -translate-x-1/2 -translate-y-1/2 rounded-full border-2 border-background bg-foreground shadow-lg transition-all duration-500\"\n\t\t\t\t\t\t\t\tstyle={{ left: barWidth }}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"mt-1 flex justify-between text-[10px] text-muted-foreground\">\n\t\t\t\t\t\t\t<span>Frustrated</span>\n\t\t\t\t\t\t\t<span>Neutral</span>\n\t\t\t\t\t\t\t<span>Happy</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Keywords */}\n\t\t\t\t\t{showKeywords && sentiment.keywords && sentiment.keywords.length > 0 && (\n\t\t\t\t\t\t<div className=\"mt-3 border-t pt-3\">\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground mb-1.5 text-[10px] font-medium uppercase\">\n\t\t\t\t\t\t\t\tDetected Keywords\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-1\">\n\t\t\t\t\t\t\t\t{sentiment.keywords.map((keyword, index) => (\n\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"text-[10px]\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{keyword}\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</TooltipProvider>\n\t);\n}\n\n/**\n * Compact Sentiment Badge\n *\n * For use in the toolbar or header\n */\ntype SentimentBadgeProps = {\n\tsentiment: SentimentData;\n\tonClick?: () => void;\n\tclassName?: string;\n};\n\nexport function SentimentBadge({\n\tsentiment,\n\tonClick,\n\tclassName,\n}: SentimentBadgeProps) {\n\tconst config = sentimentConfig[sentiment.level];\n\tconst trend = trendConfig[sentiment.trend];\n\tconst TrendIcon = trend.icon;\n\n\treturn (\n\t\t<TooltipProvider delayDuration={200}>\n\t\t\t<Tooltip>\n\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"flex items-center gap-1.5 rounded-lg border px-2.5 py-1.5 transition-colors\",\n\t\t\t\t\t\t\tconfig.bgColor,\n\t\t\t\t\t\t\tconfig.borderColor,\n\t\t\t\t\t\t\t\"hover:opacity-80\",\n\t\t\t\t\t\t\tonClick && \"cursor-pointer\",\n\t\t\t\t\t\t\tclassName,\n\t\t\t\t\t\t)}\n\t\t\t\t\t\tonClick={onClick}\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span className=\"text-base\">{config.emoji}</span>\n\t\t\t\t\t\t<span className={cn(\"text-xs font-medium\", config.color)}>\n\t\t\t\t\t\t\t{sentiment.score}%\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<TrendIcon className={cn(\"h-3 w-3\", trend.color)} />\n\t\t\t\t\t</button>\n\t\t\t\t</TooltipTrigger>\n\t\t\t\t<TooltipContent>\n\t\t\t\t\t<p className=\"font-medium\">Customer Sentiment</p>\n\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t{config.label}  {trend.label}\n\t\t\t\t\t</p>\n\t\t\t\t</TooltipContent>\n\t\t\t</Tooltip>\n\t\t</TooltipProvider>\n\t);\n}\n\n/**\n * Calculate sentiment level from score\n */\nexport function getSentimentLevel(score: number): SentimentLevel {\n\tif (score >= 66) return \"positive\";\n\tif (score >= 33) return \"neutral\";\n\treturn \"negative\";\n}\n\n/**\n * Calculate sentiment trend from history\n */\nexport function getSentimentTrend(\n\thistory: number[],\n): \"improving\" | \"stable\" | \"declining\" {\n\tif (history.length < 2) return \"stable\";\n\n\tconst recent = history.slice(-3);\n\tconst avgRecent = recent.reduce((a, b) => a + b, 0) / recent.length;\n\tconst older = history.slice(-6, -3);\n\tconst avgOlder =\n\t\tolder.length > 0 ? older.reduce((a, b) => a + b, 0) / older.length : avgRecent;\n\n\tconst diff = avgRecent - avgOlder;\n\n\tif (diff > 5) return \"improving\";\n\tif (diff < -5) return \"declining\";\n\treturn \"stable\";\n}\n","\"use client\";\n\n/**\n * Extracted Information Panel\n *\n * Displays information automatically extracted from the call transcript\n * by AI analysis. CSRs can one-click to update customer records.\n *\n * Extracts:\n * - Contact information (phone, email, address)\n * - Issue details (type, urgency, description)\n * - Equipment mentioned (model, serial number)\n * - Dates and times mentioned\n * - Amounts/prices discussed\n * - Names mentioned\n */\n\nimport {\n\tCalendar,\n\tCheck,\n\tClock,\n\tCopy,\n\tDollarSign,\n\tHome,\n\tLoader2,\n\tMail,\n\tMapPin,\n\tPhone,\n\tPlus,\n\tRefreshCw,\n\tSparkles,\n\tTag,\n\tUser,\n\tWrench,\n\tX,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { cn } from \"@/lib/utils\";\n\ntype ExtractedItemType =\n\t| \"phone\"\n\t| \"email\"\n\t| \"address\"\n\t| \"name\"\n\t| \"date\"\n\t| \"time\"\n\t| \"amount\"\n\t| \"equipment\"\n\t| \"issue\"\n\t| \"reference\";\n\ntype ExtractedItem = {\n\tid: string;\n\ttype: ExtractedItemType;\n\tvalue: string;\n\tlabel?: string;\n\tconfidence: number; // 0-100\n\tsource: string; // Quote from transcript\n\ttimestamp: number;\n\tapplied?: boolean;\n};\n\ntype ExtractedInfoPanelProps = {\n\titems: ExtractedItem[];\n\tisExtracting?: boolean;\n\tonApply?: (item: ExtractedItem) => void;\n\tonDismiss?: (itemId: string) => void;\n\tonRefresh?: () => void;\n\tclassName?: string;\n};\n\nconst typeConfig: Record<\n\tExtractedItemType,\n\t{\n\t\ticon: React.ElementType;\n\t\tlabel: string;\n\t\tcolor: string;\n\t\tbgColor: string;\n\t}\n> = {\n\tphone: {\n\t\ticon: Phone,\n\t\tlabel: \"Phone\",\n\t\tcolor: \"text-primary\",\n\t\tbgColor: \"bg-primary/10\",\n\t},\n\temail: {\n\t\ticon: Mail,\n\t\tlabel: \"Email\",\n\t\tcolor: \"text-primary\",\n\t\tbgColor: \"bg-primary/10\",\n\t},\n\taddress: {\n\t\ticon: MapPin,\n\t\tlabel: \"Address\",\n\t\tcolor: \"text-orange-500\",\n\t\tbgColor: \"bg-orange-500/10\",\n\t},\n\tname: {\n\t\ticon: User,\n\t\tlabel: \"Name\",\n\t\tcolor: \"text-violet-500\",\n\t\tbgColor: \"bg-violet-500/10\",\n\t},\n\tdate: {\n\t\ticon: Calendar,\n\t\tlabel: \"Date\",\n\t\tcolor: \"text-success\",\n\t\tbgColor: \"bg-success/10\",\n\t},\n\ttime: {\n\t\ticon: Clock,\n\t\tlabel: \"Time\",\n\t\tcolor: \"text-success\",\n\t\tbgColor: \"bg-success/10\",\n\t},\n\tamount: {\n\t\ticon: DollarSign,\n\t\tlabel: \"Amount\",\n\t\tcolor: \"text-warning\",\n\t\tbgColor: \"bg-warning/10\",\n\t},\n\tequipment: {\n\t\ticon: Wrench,\n\t\tlabel: \"Equipment\",\n\t\tcolor: \"text-muted-foreground\",\n\t\tbgColor: \"bg-muted\",\n\t},\n\tissue: {\n\t\ticon: Tag,\n\t\tlabel: \"Issue\",\n\t\tcolor: \"text-destructive\",\n\t\tbgColor: \"bg-destructive/10\",\n\t},\n\treference: {\n\t\ticon: Tag,\n\t\tlabel: \"Reference\",\n\t\tcolor: \"text-muted-foreground\",\n\t\tbgColor: \"bg-muted\",\n\t},\n};\n\nexport function ExtractedInfoPanel({\n\titems,\n\tisExtracting = false,\n\tonApply,\n\tonDismiss,\n\tonRefresh,\n\tclassName,\n}: ExtractedInfoPanelProps) {\n\tconst [dismissedIds, setDismissedIds] = useState<Set<string>>(new Set());\n\tconst [copiedId, setCopiedId] = useState<string | null>(null);\n\n\t// Filter dismissed items and sort by timestamp\n\tconst visibleItems = items\n\t\t.filter((item) => !dismissedIds.has(item.id))\n\t\t.sort((a, b) => b.timestamp - a.timestamp);\n\n\tconst handleDismiss = (itemId: string) => {\n\t\tsetDismissedIds((prev) => new Set([...prev, itemId]));\n\t\tonDismiss?.(itemId);\n\t};\n\n\tconst handleCopy = async (item: ExtractedItem) => {\n\t\tawait navigator.clipboard.writeText(item.value);\n\t\tsetCopiedId(item.id);\n\t\tsetTimeout(() => setCopiedId(null), 2000);\n\t};\n\n\tconst handleApply = (item: ExtractedItem) => {\n\t\tonApply?.(item);\n\t\t// Mark as applied by adding to dismissed\n\t\thandleDismiss(item.id);\n\t};\n\n\t// Group items by type\n\tconst groupedItems = visibleItems.reduce(\n\t\t(acc, item) => {\n\t\t\tconst type = item.type;\n\t\t\tif (!acc[type]) acc[type] = [];\n\t\t\tacc[type].push(item);\n\t\t\treturn acc;\n\t\t},\n\t\t{} as Record<ExtractedItemType, ExtractedItem[]>,\n\t);\n\n\tif (visibleItems.length === 0 && !isExtracting) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<TooltipProvider delayDuration={300}>\n\t\t\t<div\n\t\t\t\tclassName={cn(\n\t\t\t\t\t\"overflow-hidden rounded-xl border shadow-sm\",\n\t\t\t\t\t\"bg-gradient-to-br from-emerald-500/5 via-transparent to-teal-500/5\",\n\t\t\t\t\t\"border-emerald-500/20\",\n\t\t\t\t\tclassName,\n\t\t\t\t)}\n\t\t\t>\n\t\t\t\t{/* Header */}\n\t\t\t\t<div className=\"flex items-center justify-between border-b border-emerald-500/10 px-4 py-2\">\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<div className=\"rounded-full bg-emerald-500/10 p-1.5\">\n\t\t\t\t\t\t\t<Sparkles className=\"h-3.5 w-3.5 text-emerald-500\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span className=\"text-sm font-semibold\">Extracted Info</span>\n\t\t\t\t\t\t{isExtracting && (\n\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\tclassName=\"gap-1 border-emerald-500/30 text-[10px] text-emerald-500\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Loader2 className=\"h-2.5 w-2.5 animate-spin\" />\n\t\t\t\t\t\t\t\tExtracting...\n\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t<Badge variant=\"secondary\" className=\"text-[10px]\">\n\t\t\t\t\t\t\t{visibleItems.length} found\n\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t{onRefresh && (\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tclassName=\"h-7 w-7\"\n\t\t\t\t\t\t\t\tonClick={onRefresh}\n\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\tdisabled={isExtracting}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<RefreshCw\n\t\t\t\t\t\t\t\t\tclassName={cn(\"h-3.5 w-3.5\", isExtracting && \"animate-spin\")}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Items List */}\n\t\t\t\t<div className=\"max-h-[300px] overflow-y-auto p-3\">\n\t\t\t\t\t{Object.entries(groupedItems).map(([type, typeItems]) => {\n\t\t\t\t\t\tconst config = typeConfig[type as ExtractedItemType];\n\t\t\t\t\t\tconst Icon = config.icon;\n\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div key={type} className=\"mb-3 last:mb-0\">\n\t\t\t\t\t\t\t\t{/* Type Header */}\n\t\t\t\t\t\t\t\t<div className=\"mb-2 flex items-center gap-1.5\">\n\t\t\t\t\t\t\t\t\t<div className={cn(\"rounded p-1\", config.bgColor)}>\n\t\t\t\t\t\t\t\t\t\t<Icon className={cn(\"h-3 w-3\", config.color)} />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"text-xs font-medium uppercase tracking-wide\",\n\t\t\t\t\t\t\t\t\t\t\tconfig.color,\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{config.label}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{/* Items */}\n\t\t\t\t\t\t\t\t<div className=\"space-y-1.5 pl-6\">\n\t\t\t\t\t\t\t\t\t{typeItems.map((item) => (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tkey={item.id}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"group flex items-center gap-2 rounded-lg border bg-card p-2 transition-colors hover:bg-muted/50\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{/* Value */}\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"truncate text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{item.value}\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t{item.label && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground truncate text-[10px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{item.label}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t{/* Confidence */}\n\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"shrink-0 text-[10px]\",\n\t\t\t\t\t\t\t\t\t\t\t\t\titem.confidence >= 90\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"border-success/50 text-success\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: item.confidence >= 70\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"border-warning/50 text-warning\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"border-muted text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{item.confidence}%\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\n\t\t\t\t\t\t\t\t\t\t\t{/* Actions */}\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex shrink-0 items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-6 w-6\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleCopy(item)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{copiedId === item.id ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Check className=\"h-3 w-3 text-success\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Copy className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent>Copy</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t\t\t\t\t\t{onApply && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-6 w-6\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleApply(item)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Plus className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tUpdate customer record\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-6 w-6\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDismiss(item.id)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<X className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TooltipContent>Dismiss</TooltipContent>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n\t\t\t\t\t})}\n\n\t\t\t\t\t{/* Loading state */}\n\t\t\t\t\t{isExtracting && visibleItems.length === 0 && (\n\t\t\t\t\t\t<div className=\"flex items-center justify-center py-6\">\n\t\t\t\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t\t\t\t<Loader2 className=\"mx-auto h-6 w-6 animate-spin text-emerald-500\" />\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mt-2 text-xs\">\n\t\t\t\t\t\t\t\t\tAnalyzing transcript...\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{/* Footer */}\n\t\t\t\t{visibleItems.length > 0 && (\n\t\t\t\t\t<div className=\"border-t border-emerald-500/10 px-3 py-2\">\n\t\t\t\t\t\t<p className=\"text-muted-foreground/60 text-center text-[10px]\">\n\t\t\t\t\t\t\tClick + to update customer record with extracted info\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</TooltipProvider>\n\t);\n}\n\n/**\n * Compact Extracted Info Badge\n *\n * Shows count of extracted items, expands on click\n */\ntype ExtractedInfoBadgeProps = {\n\tcount: number;\n\tonClick?: () => void;\n\tclassName?: string;\n};\n\nexport function ExtractedInfoBadge({\n\tcount,\n\tonClick,\n\tclassName,\n}: ExtractedInfoBadgeProps) {\n\tif (count === 0) return null;\n\n\treturn (\n\t\t<TooltipProvider delayDuration={200}>\n\t\t\t<Tooltip>\n\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"flex items-center gap-1.5 rounded-lg border px-2.5 py-1.5 transition-colors\",\n\t\t\t\t\t\t\t\"border-emerald-500/30 bg-emerald-500/10\",\n\t\t\t\t\t\t\t\"hover:bg-emerald-500/20\",\n\t\t\t\t\t\t\tclassName,\n\t\t\t\t\t\t)}\n\t\t\t\t\t\tonClick={onClick}\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Sparkles className=\"h-3.5 w-3.5 text-emerald-500\" />\n\t\t\t\t\t\t<span className=\"text-xs font-medium text-emerald-600\">\n\t\t\t\t\t\t\t{count}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</button>\n\t\t\t\t</TooltipTrigger>\n\t\t\t\t<TooltipContent>\n\t\t\t\t\t<p>{count} items extracted from transcript</p>\n\t\t\t\t</TooltipContent>\n\t\t\t</Tooltip>\n\t\t</TooltipProvider>\n\t);\n}\n","\"use client\";\n\n/**\n * Smart Call Notes Component\n *\n * Enhanced note-taking for CSRs with:\n * - Quick snippet templates\n * - Auto-save functionality\n * - AI-powered summary generation\n * - Keyboard shortcuts\n * - Character count\n * - Timestamp markers\n */\n\nimport {\n\tAlignLeft,\n\tCheck,\n\tChevronDown,\n\tClock,\n\tFileText,\n\tLoader2,\n\tRotateCcw,\n\tSave,\n\tSparkles,\n\tWand2,\n} from \"lucide-react\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { cn } from \"@/lib/utils\";\n\ntype NoteTemplate = {\n\tid: string;\n\tlabel: string;\n\ttext: string;\n\tcategory: \"greeting\" | \"hold\" | \"resolution\" | \"followup\" | \"general\";\n};\n\ntype SmartCallNotesProps = {\n\tvalue: string;\n\tonChange: (value: string) => void;\n\tonSave?: (value: string) => void;\n\tonGenerateSummary?: () => Promise<string>;\n\tisGenerating?: boolean;\n\tautoSave?: boolean;\n\tautoSaveDelay?: number;\n\tmaxLength?: number;\n\tplaceholder?: string;\n\tclassName?: string;\n};\n\nconst defaultTemplates: NoteTemplate[] = [\n\t// Greetings\n\t{\n\t\tid: \"greeting_standard\",\n\t\tlabel: \"Standard greeting\",\n\t\ttext: \"Greeted customer, verified account.\",\n\t\tcategory: \"greeting\",\n\t},\n\t{\n\t\tid: \"greeting_callback\",\n\t\tlabel: \"Callback greeting\",\n\t\ttext: \"Returning customer's call from earlier today.\",\n\t\tcategory: \"greeting\",\n\t},\n\n\t// Hold messages\n\t{\n\t\tid: \"hold_checking\",\n\t\tlabel: \"Checking system\",\n\t\ttext: \"Placed on hold to check system/availability.\",\n\t\tcategory: \"hold\",\n\t},\n\t{\n\t\tid: \"hold_supervisor\",\n\t\tlabel: \"Consulting supervisor\",\n\t\ttext: \"Placed on hold to consult with supervisor.\",\n\t\tcategory: \"hold\",\n\t},\n\t{\n\t\tid: \"hold_pricing\",\n\t\tlabel: \"Checking pricing\",\n\t\ttext: \"Placed on hold to verify pricing.\",\n\t\tcategory: \"hold\",\n\t},\n\n\t// Resolutions\n\t{\n\t\tid: \"resolution_scheduled\",\n\t\tlabel: \"Appointment scheduled\",\n\t\ttext: \"Scheduled appointment. Customer confirmed date/time.\",\n\t\tcategory: \"resolution\",\n\t},\n\t{\n\t\tid: \"resolution_quote\",\n\t\tlabel: \"Quote provided\",\n\t\ttext: \"Provided quote. Customer will review and call back.\",\n\t\tcategory: \"resolution\",\n\t},\n\t{\n\t\tid: \"resolution_payment\",\n\t\tlabel: \"Payment processed\",\n\t\ttext: \"Payment processed successfully. Confirmation sent.\",\n\t\tcategory: \"resolution\",\n\t},\n\t{\n\t\tid: \"resolution_info\",\n\t\tlabel: \"Information provided\",\n\t\ttext: \"Provided requested information. No further action needed.\",\n\t\tcategory: \"resolution\",\n\t},\n\n\t// Follow-ups\n\t{\n\t\tid: \"followup_callback\",\n\t\tlabel: \"Callback needed\",\n\t\ttext: \"Customer requested callback. Follow-up scheduled.\",\n\t\tcategory: \"followup\",\n\t},\n\t{\n\t\tid: \"followup_email\",\n\t\tlabel: \"Email to send\",\n\t\ttext: \"Will send follow-up email with details.\",\n\t\tcategory: \"followup\",\n\t},\n\t{\n\t\tid: \"followup_manager\",\n\t\tlabel: \"Manager review\",\n\t\ttext: \"Escalated to manager for review. Will follow up.\",\n\t\tcategory: \"followup\",\n\t},\n\n\t// General\n\t{\n\t\tid: \"general_voicemail\",\n\t\tlabel: \"Left voicemail\",\n\t\ttext: \"Called customer, no answer. Left voicemail.\",\n\t\tcategory: \"general\",\n\t},\n\t{\n\t\tid: \"general_transferred\",\n\t\tlabel: \"Call transferred\",\n\t\ttext: \"Transferred to appropriate department.\",\n\t\tcategory: \"general\",\n\t},\n];\n\nconst categoryLabels: Record<string, string> = {\n\tgreeting: \"Greetings\",\n\thold: \"Hold Messages\",\n\tresolution: \"Resolutions\",\n\tfollowup: \"Follow-ups\",\n\tgeneral: \"General\",\n};\n\nexport function SmartCallNotes({\n\tvalue,\n\tonChange,\n\tonSave,\n\tonGenerateSummary,\n\tisGenerating = false,\n\tautoSave = true,\n\tautoSaveDelay = 3000,\n\tmaxLength = 2000,\n\tplaceholder = \"Add notes about this call...\",\n\tclassName,\n}: SmartCallNotesProps) {\n\tconst [isSaving, setIsSaving] = useState(false);\n\tconst [lastSaved, setLastSaved] = useState<Date | null>(null);\n\tconst [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\n\tconst textareaRef = useRef<HTMLTextAreaElement>(null);\n\tconst saveTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n\t// Group templates by category\n\tconst groupedTemplates = defaultTemplates.reduce(\n\t\t(acc, template) => {\n\t\t\tif (!acc[template.category]) acc[template.category] = [];\n\t\t\tacc[template.category].push(template);\n\t\t\treturn acc;\n\t\t},\n\t\t{} as Record<string, NoteTemplate[]>,\n\t);\n\n\t// Handle save\n\tconst handleSave = useCallback(async () => {\n\t\tif (!onSave || !hasUnsavedChanges) return;\n\n\t\tsetIsSaving(true);\n\t\ttry {\n\t\t\tawait onSave(value);\n\t\t\tsetLastSaved(new Date());\n\t\t\tsetHasUnsavedChanges(false);\n\t\t} finally {\n\t\t\tsetIsSaving(false);\n\t\t}\n\t}, [onSave, value, hasUnsavedChanges]);\n\n\t// Auto-save effect\n\tuseEffect(() => {\n\t\tif (!autoSave || !hasUnsavedChanges) return;\n\n\t\tif (saveTimeoutRef.current) {\n\t\t\tclearTimeout(saveTimeoutRef.current);\n\t\t}\n\n\t\tsaveTimeoutRef.current = setTimeout(() => {\n\t\t\thandleSave();\n\t\t}, autoSaveDelay);\n\n\t\treturn () => {\n\t\t\tif (saveTimeoutRef.current) {\n\t\t\t\tclearTimeout(saveTimeoutRef.current);\n\t\t\t}\n\t\t};\n\t}, [autoSave, autoSaveDelay, hasUnsavedChanges, handleSave]);\n\n\t// Handle change\n\tconst handleChange = (newValue: string) => {\n\t\tif (newValue.length <= maxLength) {\n\t\t\tonChange(newValue);\n\t\t\tsetHasUnsavedChanges(true);\n\t\t}\n\t};\n\n\t// Insert template\n\tconst insertTemplate = (template: NoteTemplate) => {\n\t\tconst textarea = textareaRef.current;\n\t\tif (!textarea) {\n\t\t\t// Just append if no cursor position\n\t\t\thandleChange(value + (value ? \"\\n\" : \"\") + template.text);\n\t\t\treturn;\n\t\t}\n\n\t\tconst start = textarea.selectionStart;\n\t\tconst end = textarea.selectionEnd;\n\t\tconst before = value.substring(0, start);\n\t\tconst after = value.substring(end);\n\n\t\t// Add newline if not at start and previous char isn't newline\n\t\tconst prefix = start > 0 && !before.endsWith(\"\\n\") ? \"\\n\" : \"\";\n\t\tconst newValue = before + prefix + template.text + after;\n\n\t\thandleChange(newValue);\n\n\t\t// Set cursor after inserted text\n\t\tsetTimeout(() => {\n\t\t\tconst newPosition = start + prefix.length + template.text.length;\n\t\t\ttextarea.setSelectionRange(newPosition, newPosition);\n\t\t\ttextarea.focus();\n\t\t}, 0);\n\t};\n\n\t// Insert timestamp\n\tconst insertTimestamp = () => {\n\t\tconst timestamp = new Date().toLocaleTimeString(\"en-US\", {\n\t\t\thour: \"numeric\",\n\t\t\tminute: \"2-digit\",\n\t\t});\n\t\tconst marker = `[${timestamp}] `;\n\n\t\tconst textarea = textareaRef.current;\n\t\tif (!textarea) {\n\t\t\thandleChange(value + (value ? \"\\n\" : \"\") + marker);\n\t\t\treturn;\n\t\t}\n\n\t\tconst start = textarea.selectionStart;\n\t\tconst before = value.substring(0, start);\n\t\tconst after = value.substring(start);\n\n\t\t// Add newline if not at start\n\t\tconst prefix = start > 0 && !before.endsWith(\"\\n\") ? \"\\n\" : \"\";\n\t\tconst newValue = before + prefix + marker + after;\n\n\t\thandleChange(newValue);\n\n\t\t// Set cursor after marker\n\t\tsetTimeout(() => {\n\t\t\tconst newPosition = start + prefix.length + marker.length;\n\t\t\ttextarea.setSelectionRange(newPosition, newPosition);\n\t\t\ttextarea.focus();\n\t\t}, 0);\n\t};\n\n\t// Generate AI summary\n\tconst handleGenerateSummary = async () => {\n\t\tif (!onGenerateSummary) return;\n\n\t\tconst summary = await onGenerateSummary();\n\t\tif (summary) {\n\t\t\thandleChange(value + (value ? \"\\n\\n\" : \"\") + \"--- AI Summary ---\\n\" + summary);\n\t\t}\n\t};\n\n\t// Format last saved time\n\tconst formatLastSaved = (date: Date): string => {\n\t\tconst now = new Date();\n\t\tconst diffSeconds = Math.floor((now.getTime() - date.getTime()) / 1000);\n\n\t\tif (diffSeconds < 5) return \"Just saved\";\n\t\tif (diffSeconds < 60) return `Saved ${diffSeconds}s ago`;\n\t\treturn `Saved at ${date.toLocaleTimeString(\"en-US\", {\n\t\t\thour: \"numeric\",\n\t\t\tminute: \"2-digit\",\n\t\t})}`;\n\t};\n\n\treturn (\n\t\t<TooltipProvider delayDuration={300}>\n\t\t\t<div\n\t\t\t\tclassName={cn(\n\t\t\t\t\t\"border-border/60 bg-card overflow-hidden rounded-xl border shadow-sm\",\n\t\t\t\t\tclassName,\n\t\t\t\t)}\n\t\t\t>\n\t\t\t\t{/* Header */}\n\t\t\t\t<div className=\"flex items-center justify-between border-b px-4 py-2\">\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<FileText className=\"text-muted-foreground h-4 w-4\" />\n\t\t\t\t\t\t<span className=\"text-sm font-semibold\">Call Notes</span>\n\t\t\t\t\t\t{hasUnsavedChanges && (\n\t\t\t\t\t\t\t<Badge variant=\"outline\" className=\"text-[10px] text-warning\">\n\t\t\t\t\t\t\t\tUnsaved\n\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t{/* Templates dropdown */}\n\t\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t\t<Button className=\"h-7 gap-1 px-2 text-xs\" size=\"sm\" variant=\"ghost\">\n\t\t\t\t\t\t\t\t\t<AlignLeft className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\tTemplates\n\t\t\t\t\t\t\t\t\t<ChevronDown className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t\t<DropdownMenuContent align=\"end\" className=\"w-56\">\n\t\t\t\t\t\t\t\t{Object.entries(groupedTemplates).map(\n\t\t\t\t\t\t\t\t\t([category, templates], index) => (\n\t\t\t\t\t\t\t\t\t\t<div key={category}>\n\t\t\t\t\t\t\t\t\t\t\t{index > 0 && <DropdownMenuSeparator />}\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground px-2 py-1.5 text-xs font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t{categoryLabels[category]}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{templates.map((template) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={template.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => insertTemplate(template)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{template.label}\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t\t</DropdownMenu>\n\n\t\t\t\t\t\t{/* Timestamp button */}\n\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName=\"h-7 w-7\"\n\t\t\t\t\t\t\t\t\tonClick={insertTimestamp}\n\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Clock className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t<TooltipContent>Insert timestamp</TooltipContent>\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t{/* AI Summary button */}\n\t\t\t\t\t\t{onGenerateSummary && (\n\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-7 w-7\"\n\t\t\t\t\t\t\t\t\t\tonClick={handleGenerateSummary}\n\t\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\tdisabled={isGenerating}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{isGenerating ? (\n\t\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-3.5 w-3.5 animate-spin\" />\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<Wand2 className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t<TooltipContent>Generate AI summary</TooltipContent>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{/* Save button */}\n\t\t\t\t\t\t{onSave && (\n\t\t\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-7 w-7\"\n\t\t\t\t\t\t\t\t\t\tonClick={handleSave}\n\t\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\tdisabled={isSaving || !hasUnsavedChanges}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{isSaving ? (\n\t\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-3.5 w-3.5 animate-spin\" />\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<Save className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t\t\t<TooltipContent>Save notes (Ctrl+S)</TooltipContent>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Textarea */}\n\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t<Textarea\n\t\t\t\t\t\tref={textareaRef}\n\t\t\t\t\t\tclassName=\"min-h-[150px] resize-none rounded-none border-0 focus-visible:ring-0\"\n\t\t\t\t\t\tplaceholder={placeholder}\n\t\t\t\t\t\tvalue={value}\n\t\t\t\t\t\tonChange={(e) => handleChange(e.target.value)}\n\t\t\t\t\t\tonKeyDown={(e) => {\n\t\t\t\t\t\t\t// Save on Ctrl+S\n\t\t\t\t\t\t\tif ((e.ctrlKey || e.metaKey) && e.key === \"s\") {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\thandleSave();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Footer */}\n\t\t\t\t<div className=\"flex items-center justify-between border-t px-3 py-1.5\">\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t{lastSaved && (\n\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-[10px]\">\n\t\t\t\t\t\t\t\t{formatLastSaved(lastSaved)}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"text-[10px]\",\n\t\t\t\t\t\t\tvalue.length > maxLength * 0.9\n\t\t\t\t\t\t\t\t? \"text-destructive\"\n\t\t\t\t\t\t\t\t: \"text-muted-foreground\",\n\t\t\t\t\t\t)}\n\t\t\t\t\t>\n\t\t\t\t\t\t{value.length}/{maxLength}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</TooltipProvider>\n\t);\n}\n\n/**\n * Floating Quick Notes\n *\n * Minimal note-taking that floats over the call window\n */\ntype FloatingNotesProps = {\n\tvalue: string;\n\tonChange: (value: string) => void;\n\tclassName?: string;\n};\n\nexport function FloatingNotes({ value, onChange, className }: FloatingNotesProps) {\n\tconst [isExpanded, setIsExpanded] = useState(false);\n\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\n\t\t\t\t\"bg-card/95 rounded-xl border shadow-lg backdrop-blur-sm transition-all\",\n\t\t\t\tisExpanded ? \"w-80\" : \"w-auto\",\n\t\t\t\tclassName,\n\t\t\t)}\n\t\t>\n\t\t\t{isExpanded ? (\n\t\t\t\t<div className=\"p-3\">\n\t\t\t\t\t<div className=\"mb-2 flex items-center justify-between\">\n\t\t\t\t\t\t<span className=\"text-xs font-medium\">Quick Notes</span>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tclassName=\"h-6 w-6\"\n\t\t\t\t\t\t\tonClick={() => setIsExpanded(false)}\n\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<ChevronDown className=\"h-3 w-3\" />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<Textarea\n\t\t\t\t\t\tclassName=\"min-h-[100px] resize-none text-sm\"\n\t\t\t\t\t\tplaceholder=\"Quick notes...\"\n\t\t\t\t\t\tvalue={value}\n\t\t\t\t\t\tonChange={(e) => onChange(e.target.value)}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t) : (\n\t\t\t\t<Button\n\t\t\t\t\tclassName=\"gap-2\"\n\t\t\t\t\tonClick={() => setIsExpanded(true)}\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t>\n\t\t\t\t\t<FileText className=\"h-4 w-4\" />\n\t\t\t\t\tNotes\n\t\t\t\t\t{value && (\n\t\t\t\t\t\t<Badge variant=\"secondary\" className=\"text-[10px]\">\n\t\t\t\t\t\t\t{value.split(\"\\n\").length}\n\t\t\t\t\t\t</Badge>\n\t\t\t\t\t)}\n\t\t\t\t</Button>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","\"use client\";\n\n/**\n * Call Window Skeleton Components\n *\n * Loading skeletons for all call window components.\n * Provides visual feedback while data loads and prevents layout shift.\n */\n\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { cn } from \"@/lib/utils\";\n\n/**\n * Customer Stats Bar Skeleton\n */\nexport function CustomerStatsBarSkeleton({ className }: { className?: string }) {\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\n\t\t\t\t\"bg-card/80 sticky top-0 z-10 border-b backdrop-blur-sm\",\n\t\t\t\tclassName,\n\t\t\t)}\n\t\t>\n\t\t\t<div className=\"grid grid-cols-5 divide-x\">\n\t\t\t\t{Array.from({ length: 5 }).map((_, i) => (\n\t\t\t\t\t<div\n\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\tclassName=\"flex flex-col items-center justify-center gap-1.5 p-3\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Skeleton className=\"h-4 w-12\" />\n\t\t\t\t\t\t<Skeleton className=\"h-3 w-8\" />\n\t\t\t\t\t</div>\n\t\t\t\t))}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n/**\n * Customer Alert Banner Skeleton\n */\nexport function CustomerAlertBannerSkeleton({\n\tclassName,\n}: {\n\tclassName?: string;\n}) {\n\treturn (\n\t\t<div className={cn(\"space-y-2\", className)}>\n\t\t\t<div className=\"flex items-start gap-3 rounded-lg border bg-muted/20 p-3\">\n\t\t\t\t<Skeleton className=\"h-8 w-8 rounded-full\" />\n\t\t\t\t<div className=\"flex-1 space-y-2\">\n\t\t\t\t\t<Skeleton className=\"h-4 w-32\" />\n\t\t\t\t\t<Skeleton className=\"h-3 w-48\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n/**\n * Quick Actions Panel Skeleton\n */\nexport function QuickActionsPanelSkeleton({\n\tclassName,\n}: {\n\tclassName?: string;\n}) {\n\treturn (\n\t\t<div className={cn(\"space-y-3\", className)}>\n\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t<Skeleton className=\"h-4 w-24\" />\n\t\t\t\t<Skeleton className=\"h-6 w-16\" />\n\t\t\t</div>\n\t\t\t<div className=\"grid grid-cols-3 gap-2\">\n\t\t\t\t{Array.from({ length: 6 }).map((_, i) => (\n\t\t\t\t\t<Skeleton key={i} className=\"h-16 rounded-lg\" />\n\t\t\t\t))}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n/**\n * Previous Call Summary Skeleton\n */\nexport function PreviousCallSummarySkeleton({\n\tclassName,\n}: {\n\tclassName?: string;\n}) {\n\treturn (\n\t\t<div className={cn(\"rounded-xl border bg-muted/30 p-4\", className)}>\n\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t<Skeleton className=\"h-10 w-10 rounded-full\" />\n\t\t\t\t<div className=\"flex-1 space-y-2\">\n\t\t\t\t\t<Skeleton className=\"h-4 w-24\" />\n\t\t\t\t\t<Skeleton className=\"h-3 w-32\" />\n\t\t\t\t</div>\n\t\t\t\t<Skeleton className=\"h-5 w-16 rounded-full\" />\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n/**\n * AI Suggestions Widget Skeleton\n */\nexport function AISuggestionsWidgetSkeleton({\n\tclassName,\n}: {\n\tclassName?: string;\n}) {\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\n\t\t\t\t\"overflow-hidden rounded-xl border border-violet-500/20\",\n\t\t\t\t\"bg-gradient-to-br from-violet-500/5 via-transparent to-indigo-500/5\",\n\t\t\t\tclassName,\n\t\t\t)}\n\t\t>\n\t\t\t<div className=\"flex items-center justify-between border-b border-violet-500/10 px-4 py-2\">\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<Skeleton className=\"h-6 w-6 rounded-full\" />\n\t\t\t\t\t<Skeleton className=\"h-4 w-24\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"space-y-2 p-3\">\n\t\t\t\t{Array.from({ length: 2 }).map((_, i) => (\n\t\t\t\t\t<div key={i} className=\"rounded-lg border bg-card/50 p-3\">\n\t\t\t\t\t\t<div className=\"flex items-start gap-3\">\n\t\t\t\t\t\t\t<Skeleton className=\"h-8 w-8 rounded-full\" />\n\t\t\t\t\t\t\t<div className=\"flex-1 space-y-2\">\n\t\t\t\t\t\t\t\t<Skeleton className=\"h-4 w-32\" />\n\t\t\t\t\t\t\t\t<Skeleton className=\"h-3 w-48\" />\n\t\t\t\t\t\t\t\t<Skeleton className=\"h-7 w-20 rounded\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t))}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n/**\n * Sentiment Indicator Skeleton\n */\nexport function SentimentIndicatorSkeleton({\n\tclassName,\n}: {\n\tclassName?: string;\n}) {\n\treturn (\n\t\t<div className={cn(\"rounded-xl border bg-muted/30 p-4\", className)}>\n\t\t\t<div className=\"flex items-center gap-4\">\n\t\t\t\t<Skeleton className=\"h-14 w-14 rounded-full\" />\n\t\t\t\t<div className=\"flex-1 space-y-2\">\n\t\t\t\t\t<Skeleton className=\"h-5 w-24\" />\n\t\t\t\t\t<Skeleton className=\"h-3 w-32\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"mt-4 space-y-2\">\n\t\t\t\t<Skeleton className=\"h-2 w-full rounded-full\" />\n\t\t\t\t<div className=\"flex justify-between\">\n\t\t\t\t\t<Skeleton className=\"h-3 w-16\" />\n\t\t\t\t\t<Skeleton className=\"h-3 w-12\" />\n\t\t\t\t\t<Skeleton className=\"h-3 w-12\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n/**\n * Extracted Info Panel Skeleton\n */\nexport function ExtractedInfoPanelSkeleton({\n\tclassName,\n}: {\n\tclassName?: string;\n}) {\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\n\t\t\t\t\"overflow-hidden rounded-xl border border-emerald-500/20\",\n\t\t\t\t\"bg-gradient-to-br from-emerald-500/5 via-transparent to-teal-500/5\",\n\t\t\t\tclassName,\n\t\t\t)}\n\t\t>\n\t\t\t<div className=\"flex items-center justify-between border-b border-emerald-500/10 px-4 py-2\">\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<Skeleton className=\"h-6 w-6 rounded-full\" />\n\t\t\t\t\t<Skeleton className=\"h-4 w-24\" />\n\t\t\t\t</div>\n\t\t\t\t<Skeleton className=\"h-5 w-12 rounded-full\" />\n\t\t\t</div>\n\t\t\t<div className=\"space-y-3 p-3\">\n\t\t\t\t{Array.from({ length: 3 }).map((_, i) => (\n\t\t\t\t\t<div key={i} className=\"space-y-1.5\">\n\t\t\t\t\t\t<div className=\"flex items-center gap-1.5\">\n\t\t\t\t\t\t\t<Skeleton className=\"h-5 w-5 rounded\" />\n\t\t\t\t\t\t\t<Skeleton className=\"h-3 w-16\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"ml-6 space-y-1\">\n\t\t\t\t\t\t\t<Skeleton className=\"h-8 w-full rounded-lg\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t))}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n/**\n * Smart Call Notes Skeleton\n */\nexport function SmartCallNotesSkeleton({ className }: { className?: string }) {\n\treturn (\n\t\t<div className={cn(\"rounded-xl border bg-card\", className)}>\n\t\t\t<div className=\"flex items-center justify-between border-b px-4 py-2\">\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<Skeleton className=\"h-4 w-4\" />\n\t\t\t\t\t<Skeleton className=\"h-4 w-20\" />\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t<Skeleton className=\"h-7 w-16 rounded\" />\n\t\t\t\t\t<Skeleton className=\"h-7 w-7 rounded\" />\n\t\t\t\t\t<Skeleton className=\"h-7 w-7 rounded\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Skeleton className=\"m-3 h-[150px] rounded\" />\n\t\t\t<div className=\"flex items-center justify-between border-t px-3 py-1.5\">\n\t\t\t\t<Skeleton className=\"h-3 w-24\" />\n\t\t\t\t<Skeleton className=\"h-3 w-16\" />\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n/**\n * Transcript Panel Skeleton\n */\nexport function TranscriptPanelSkeleton({ className }: { className?: string }) {\n\treturn (\n\t\t<div className={cn(\"rounded-xl border bg-card\", className)}>\n\t\t\t<div className=\"flex items-center justify-between border-b px-4 py-3\">\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<Skeleton className=\"h-4 w-4\" />\n\t\t\t\t\t<Skeleton className=\"h-4 w-28\" />\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<Skeleton className=\"h-8 w-8 rounded\" />\n\t\t\t\t\t<Skeleton className=\"h-8 w-8 rounded\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"border-b p-3\">\n\t\t\t\t<Skeleton className=\"h-9 w-full rounded\" />\n\t\t\t</div>\n\t\t\t<div className=\"space-y-3 p-4\">\n\t\t\t\t{Array.from({ length: 4 }).map((_, i) => (\n\t\t\t\t\t<div\n\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"rounded-lg border p-3\",\n\t\t\t\t\t\t\ti % 2 === 0 ? \"ml-0 mr-8\" : \"ml-8 mr-0\",\n\t\t\t\t\t\t)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div className=\"mb-2 flex items-center justify-between\">\n\t\t\t\t\t\t\t<Skeleton className=\"h-3 w-12\" />\n\t\t\t\t\t\t\t<Skeleton className=\"h-3 w-16\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Skeleton className=\"h-4 w-full\" />\n\t\t\t\t\t\t<Skeleton className=\"mt-1 h-4 w-3/4\" />\n\t\t\t\t\t</div>\n\t\t\t\t))}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n/**\n * Customer Sidebar Skeleton\n */\nexport function CustomerSidebarSkeleton({ className }: { className?: string }) {\n\treturn (\n\t\t<div className={cn(\"flex h-full flex-col\", className)}>\n\t\t\t<CustomerStatsBarSkeleton />\n\t\t\t<div className=\"flex-1 space-y-4 overflow-hidden p-4\">\n\t\t\t\t<CustomerAlertBannerSkeleton />\n\t\t\t\t<PreviousCallSummarySkeleton />\n\t\t\t\t<div className=\"rounded-xl border bg-card p-4\">\n\t\t\t\t\t<QuickActionsPanelSkeleton />\n\t\t\t\t</div>\n\t\t\t\t<div className=\"rounded-xl border bg-card p-4\">\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<Skeleton className=\"h-4 w-24\" />\n\t\t\t\t\t\t<div className=\"flex gap-1.5\">\n\t\t\t\t\t\t\t<Skeleton className=\"h-6 w-12 rounded-full\" />\n\t\t\t\t\t\t\t<Skeleton className=\"h-6 w-16 rounded-full\" />\n\t\t\t\t\t\t\t<Skeleton className=\"h-6 w-14 rounded-full\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n/**\n * Full Call Window Skeleton\n */\nexport function CallWindowSkeleton() {\n\treturn (\n\t\t<div className=\"flex h-screen flex-col bg-background\">\n\t\t\t{/* Toolbar Skeleton */}\n\t\t\t<div className=\"flex items-center justify-between border-b px-6 py-3\">\n\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t<Skeleton className=\"h-11 w-11 rounded-full\" />\n\t\t\t\t\t<div className=\"space-y-1\">\n\t\t\t\t\t\t<Skeleton className=\"h-4 w-32\" />\n\t\t\t\t\t\t<Skeleton className=\"h-3 w-24\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t{Array.from({ length: 6 }).map((_, i) => (\n\t\t\t\t\t\t<Skeleton key={i} className=\"h-10 w-10 rounded-full\" />\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<Skeleton className=\"h-6 w-20 rounded-full\" />\n\t\t\t\t\t<Skeleton className=\"h-8 w-8 rounded\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Main Content Skeleton */}\n\t\t\t<div className=\"flex flex-1 overflow-hidden\">\n\t\t\t\t{/* Left Panel */}\n\t\t\t\t<div className=\"flex w-[35%] flex-col border-r\">\n\t\t\t\t\t<TranscriptPanelSkeleton className=\"flex-1\" />\n\t\t\t\t</div>\n\n\t\t\t\t{/* Right Panel */}\n\t\t\t\t<div className=\"w-[65%]\">\n\t\t\t\t\t<CustomerSidebarSkeleton className=\"h-full\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","\"use client\";\n\n/**\n * Transcript Panel - Client Component\n *\n * Live call transcript display with AI analysis highlighting\n *\n * Client-side features:\n * - Real-time transcript updates\n * - Auto-scroll to latest entry\n * - Speaker identification (CSR vs Customer)\n * - AI extraction highlighting\n * - Search functionality\n * - Copy/export transcript\n * - Timestamp markers\n *\n * Performance optimizations:\n * - Virtual scrolling for long transcripts\n * - Debounced search\n * - Memoized entry rendering\n */\n\nimport { Copy, Download, MessageSquare, Search, Sparkles } from \"lucide-react\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport {\n\tUnifiedAccordion,\n\ttype UnifiedAccordionSection,\n} from \"@/components/ui/unified-accordion\";\nimport { useTranscriptStore } from \"@/lib/stores/transcript-store\";\n\nexport function TranscriptPanel() {\n\tconst entries = useTranscriptStore((state) =>\n\t\tstate.filteredEntries.length > 0 ? state.filteredEntries : state.entries,\n\t);\n\tconst searchQuery = useTranscriptStore((state) => state.searchQuery);\n\tconst setSearchQuery = useTranscriptStore((state) => state.setSearchQuery);\n\tconst isRecording = useTranscriptStore((state) => state.isRecording);\n\tconst exportTranscript = useTranscriptStore(\n\t\t(state) => state.exportTranscript,\n\t);\n\tconst getFullTranscript = useTranscriptStore(\n\t\t(state) => state.getFullTranscript,\n\t);\n\n\tconst [autoScroll, setAutoScroll] = useState(true);\n\tconst scrollContainerRef = useRef<HTMLDivElement>(null);\n\n\t// Auto-scroll to bottom when new entries arrive\n\tuseEffect(() => {\n\t\tif (autoScroll && scrollContainerRef.current) {\n\t\t\tscrollContainerRef.current.scrollTop =\n\t\t\t\tscrollContainerRef.current.scrollHeight;\n\t\t}\n\t}, [autoScroll]);\n\n\t// Handle scroll to detect manual scrolling\n\tconst handleScroll = () => {\n\t\tif (scrollContainerRef.current) {\n\t\t\tconst { scrollTop, scrollHeight, clientHeight } =\n\t\t\t\tscrollContainerRef.current;\n\t\t\tconst isAtBottom = scrollHeight - scrollTop - clientHeight < 50;\n\t\t\tsetAutoScroll(isAtBottom);\n\t\t}\n\t};\n\n\t// Copy transcript to clipboard\n\tconst handleCopy = async () => {\n\t\tconst text = getFullTranscript();\n\t\tawait navigator.clipboard.writeText(text);\n\t};\n\n\t// Export transcript as JSON\n\tconst handleExport = () => {\n\t\tconst data = exportTranscript();\n\t\tconst blob = new Blob([data], { type: \"application/json\" });\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst a = document.createElement(\"a\");\n\t\ta.href = url;\n\t\ta.download = `transcript-${new Date().toISOString()}.json`;\n\t\ta.click();\n\t\tURL.revokeObjectURL(url);\n\t};\n\n\t// Format timestamp\n\tconst formatTime = (timestamp: number) => {\n\t\tconst date = new Date(timestamp);\n\t\treturn date.toLocaleTimeString(\"en-US\", {\n\t\t\thour: \"2-digit\",\n\t\t\tminute: \"2-digit\",\n\t\t\tsecond: \"2-digit\",\n\t\t});\n\t};\n\n\t// Build sections array for UnifiedAccordion\n\tconst sections: UnifiedAccordionSection[] = [\n\t\t{\n\t\t\tid: \"transcript\",\n\t\t\ttitle: \"Live Transcript\",\n\t\t\ticon: <MessageSquare className=\"h-4 w-4\" />,\n\t\t\tcount: entries.length,\n\t\t\tactions: (\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t{isRecording && (\n\t\t\t\t\t\t<div className=\"flex items-center gap-1.5\">\n\t\t\t\t\t\t\t<div className=\"bg-destructive size-2 animate-pulse rounded-full\" />\n\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs\">Recording</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclassName=\"h-8 px-2\"\n\t\t\t\t\t\tonClick={handleCopy}\n\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\ttitle=\"Copy transcript\"\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Copy className=\"size-3.5\" />\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclassName=\"h-8 px-2\"\n\t\t\t\t\t\tonClick={handleExport}\n\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\ttitle=\"Export transcript\"\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Download className=\"size-3.5\" />\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t),\n\t\t\tcontent: (\n\t\t\t\t<div className=\"flex flex-col\">\n\t\t\t\t\t{/* Search */}\n\t\t\t\t\t<div className=\"border-border border-b p-3\">\n\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t<Search className=\"text-muted-foreground absolute top-1/2 left-3 size-4 -translate-y-1/2\" />\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tclassName=\"bg-card h-9 pl-9 text-sm\"\n\t\t\t\t\t\t\t\tonChange={(e) => setSearchQuery(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"Search transcript...\"\n\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\tvalue={searchQuery}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Transcript entries */}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"h-[calc(100vh-28rem)] space-y-3 overflow-y-auto p-4\"\n\t\t\t\t\t\tonScroll={handleScroll}\n\t\t\t\t\t\tref={scrollContainerRef}\n\t\t\t\t\t>\n\t\t\t\t\t\t{entries.length === 0 ? (\n\t\t\t\t\t\t\t<div className=\"flex h-full flex-col items-center justify-center text-center\">\n\t\t\t\t\t\t\t\t<div className=\"bg-foreground rounded-full p-4\">\n\t\t\t\t\t\t\t\t\t<Sparkles className=\"text-muted-foreground size-8\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mt-4 text-sm font-medium\">\n\t\t\t\t\t\t\t\t\tNo transcript yet\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mt-1 text-xs\">\n\t\t\t\t\t\t\t\t\tTranscript will appear here during the call\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\tentries.map((entry) => (\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclassName={`rounded-lg p-3 ${entry.speaker === \"csr\" ? \"border-primary/30 bg-primary/20 border\" : \"border-border/50 bg-foreground/50 border\"}`}\n\t\t\t\t\t\t\t\t\tkey={entry.id}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{/* Entry header */}\n\t\t\t\t\t\t\t\t\t<div className=\"mb-1.5 flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`text-xs font-semibold ${entry.speaker === \"csr\" ? \"text-primary\" : \"text-muted-foreground\"}`}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{entry.speaker === \"csr\" ? \"CSR\" : \"Customer\"}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t{entry.isAnalyzing && (\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"bg-warning size-1 animate-pulse rounded-full\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-warning text-xxs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tAI Analyzing...\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground font-mono text-xxs\">\n\t\t\t\t\t\t\t\t\t\t\t{formatTime(entry.timestamp)}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{/* Entry text */}\n\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm leading-relaxed\">\n\t\t\t\t\t\t\t\t\t\t{entry.text}\n\t\t\t\t\t\t\t\t\t</p>\n\n\t\t\t\t\t\t\t\t\t{/* AI extracted data */}\n\t\t\t\t\t\t\t\t\t{entry.aiExtracted && (\n\t\t\t\t\t\t\t\t\t\t<div className=\"border-border mt-2 space-y-1 border-t pt-2\">\n\t\t\t\t\t\t\t\t\t\t\t{entry.aiExtracted.customerInfo && (\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{entry.aiExtracted.customerInfo.name && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"bg-success/30 text-success rounded px-2 py-0.5 text-xxs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tName: {entry.aiExtracted.customerInfo.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{entry.aiExtracted.customerInfo.email && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"bg-success/30 text-success rounded px-2 py-0.5 text-xxs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tEmail: {entry.aiExtracted.customerInfo.email}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t{entry.aiExtracted.issueCategories &&\n\t\t\t\t\t\t\t\t\t\t\t\tentry.aiExtracted.issueCategories.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{entry.aiExtracted.issueCategories.map(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(category) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"bg-warning/30 text-warning rounded px-2 py-0.5 text-xxs\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={category}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{category}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t{entry.aiExtracted.sentiment && (\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={`rounded px-2 py-0.5 text-xxs ${entry.aiExtracted.sentiment === \"positive\" ? \"bg-success/30 text-success\" : entry.aiExtracted.sentiment === \"negative\" ? \"bg-destructive/30 text-destructive\" : \"bg-foreground/30 text-muted-foreground\"}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tSentiment: {entry.aiExtracted.sentiment}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{entry.aiExtracted.confidence !== undefined && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground font-mono text-xxs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{Math.round(entry.aiExtracted.confidence)}%\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Auto-scroll indicator */}\n\t\t\t\t\t{!autoScroll && entries.length > 0 && (\n\t\t\t\t\t\t<div className=\"border-border bg-card border-t p-2 text-center\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclassName=\"text-primary hover:text-primary text-xs\"\n\t\t\t\t\t\t\t\tonClick={() => setAutoScroll(true)}\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t New messages below  Click to auto-scroll\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t),\n\t\t},\n\t];\n\n\treturn (\n\t\t<ScrollArea className=\"h-full\">\n\t\t\t<div className=\"flex flex-col gap-4 p-4\">\n\t\t\t\t<section className=\"border-border/60 bg-card overflow-hidden rounded-xl border shadow-sm\">\n\t\t\t\t\t<div className=\"flex flex-col gap-4 p-0\">\n\t\t\t\t\t\t<UnifiedAccordion\n\t\t\t\t\t\t\tdefaultOpenSection=\"transcript\"\n\t\t\t\t\t\t\tenableReordering={false}\n\t\t\t\t\t\t\tsections={sections}\n\t\t\t\t\t\t\tstorageKey=\"call-window-transcript-panel\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</section>\n\t\t\t</div>\n\t\t</ScrollArea>\n\t);\n}\n","/**\n * Transcript Store - Zustand State Management\n *\n * Manages live call transcript state including:\n * - Real-time transcript entries with speaker detection\n * - AI analysis status for each transcript segment\n * - Transcript search and export functionality\n * - Speaker identification and timestamp tracking\n *\n * Performance optimizations:\n * - Lightweight state management with Zustand\n * - No provider wrapper needed\n * - Selective subscriptions prevent unnecessary re-renders\n */\n\nimport { create } from \"zustand\";\nimport { devtools } from \"zustand/middleware\";\n\n// Transcript entry type\nexport type TranscriptEntry = {\n\tid: string;\n\tspeaker: \"csr\" | \"customer\";\n\ttext: string;\n\ttimestamp: number;\n\tisAnalyzing: boolean;\n\taiExtracted?: {\n\t\tcustomerInfo?: {\n\t\t\tname?: string;\n\t\t\temail?: string;\n\t\t\tphone?: string;\n\t\t\tcompany?: string;\n\t\t};\n\t\tissueCategories?: string[];\n\t\tactionItems?: string[];\n\t\tsentiment?: \"positive\" | \"neutral\" | \"negative\";\n\t\tconfidence?: number; // 0-100\n\t};\n};\n\n// Store state type\ntype TranscriptStore = {\n\t// State\n\tentries: TranscriptEntry[];\n\tisRecording: boolean;\n\tcurrentSpeaker: \"csr\" | \"customer\" | null;\n\tsearchQuery: string;\n\tfilteredEntries: TranscriptEntry[];\n\n\t// Actions\n\taddEntry: (\n\t\tentry: Omit<TranscriptEntry, \"id\" | \"timestamp\" | \"isAnalyzing\">,\n\t) => void;\n\tupdateEntry: (id: string, updates: Partial<TranscriptEntry>) => void;\n\tmarkAsAnalyzing: (id: string) => void;\n\tmarkAsAnalyzed: (\n\t\tid: string,\n\t\textracted: TranscriptEntry[\"aiExtracted\"],\n\t) => void;\n\tsetCurrentSpeaker: (speaker: \"csr\" | \"customer\" | null) => void;\n\tsetSearchQuery: (query: string) => void;\n\tstartRecording: () => void;\n\tstopRecording: () => void;\n\tclearTranscript: () => void;\n\texportTranscript: () => string;\n\tgetFullTranscript: () => string;\n};\n\n// Initial state\nconst initialState = {\n\tentries: [],\n\tisRecording: false,\n\tcurrentSpeaker: null,\n\tsearchQuery: \"\",\n\tfilteredEntries: [],\n};\n\n// Create store\nexport const useTranscriptStore = create<TranscriptStore>()(\n\tdevtools(\n\t\t(set, get) => ({\n\t\t\t...initialState,\n\n\t\t\taddEntry: (entry) => {\n\t\t\t\tconst newEntry: TranscriptEntry = {\n\t\t\t\t\t...entry,\n\t\t\t\t\tid: `transcript-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n\t\t\t\t\ttimestamp: Date.now(),\n\t\t\t\t\tisAnalyzing: false,\n\t\t\t\t};\n\n\t\t\t\tset((state) => {\n\t\t\t\t\tconst entries = [...state.entries, newEntry];\n\t\t\t\t\treturn {\n\t\t\t\t\t\tentries,\n\t\t\t\t\t\tfilteredEntries: state.searchQuery\n\t\t\t\t\t\t\t? entries.filter((e) =>\n\t\t\t\t\t\t\t\t\te.text\n\t\t\t\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t\t\t\t.includes(state.searchQuery.toLowerCase()),\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t: entries,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tupdateEntry: (id, updates) => {\n\t\t\t\tset((state) => {\n\t\t\t\t\tconst entries = state.entries.map((entry) =>\n\t\t\t\t\t\tentry.id === id ? { ...entry, ...updates } : entry,\n\t\t\t\t\t);\n\t\t\t\t\treturn {\n\t\t\t\t\t\tentries,\n\t\t\t\t\t\tfilteredEntries: state.searchQuery\n\t\t\t\t\t\t\t? entries.filter((e) =>\n\t\t\t\t\t\t\t\t\te.text\n\t\t\t\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t\t\t\t.includes(state.searchQuery.toLowerCase()),\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t: entries,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tmarkAsAnalyzing: (id) => {\n\t\t\t\tget().updateEntry(id, { isAnalyzing: true });\n\t\t\t},\n\n\t\t\tmarkAsAnalyzed: (id, extracted) => {\n\t\t\t\tget().updateEntry(id, {\n\t\t\t\t\tisAnalyzing: false,\n\t\t\t\t\taiExtracted: extracted,\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tsetCurrentSpeaker: (speaker) => set({ currentSpeaker: speaker }),\n\n\t\t\tsetSearchQuery: (query) => {\n\t\t\t\tset((state) => ({\n\t\t\t\t\tsearchQuery: query,\n\t\t\t\t\tfilteredEntries: query\n\t\t\t\t\t\t? state.entries.filter((e) =>\n\t\t\t\t\t\t\t\te.text.toLowerCase().includes(query.toLowerCase()),\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t: state.entries,\n\t\t\t\t}));\n\t\t\t},\n\n\t\t\tstartRecording: () => set({ isRecording: true }),\n\n\t\t\tstopRecording: () => set({ isRecording: false }),\n\n\t\t\tclearTranscript: () => set(initialState),\n\n\t\t\texportTranscript: () => {\n\t\t\t\tconst { entries } = get();\n\t\t\t\treturn JSON.stringify(\n\t\t\t\t\tentries.map((e) => ({\n\t\t\t\t\t\tspeaker: e.speaker,\n\t\t\t\t\t\ttext: e.text,\n\t\t\t\t\t\ttimestamp: new Date(e.timestamp).toISOString(),\n\t\t\t\t\t\taiExtracted: e.aiExtracted,\n\t\t\t\t\t})),\n\t\t\t\t\tnull,\n\t\t\t\t\t2,\n\t\t\t\t);\n\t\t\t},\n\n\t\t\tgetFullTranscript: () => {\n\t\t\t\tconst { entries } = get();\n\t\t\t\treturn entries\n\t\t\t\t\t.map((e) => {\n\t\t\t\t\t\tconst time = new Date(e.timestamp).toLocaleTimeString();\n\t\t\t\t\t\tconst speaker = e.speaker === \"csr\" ? \"CSR\" : \"Customer\";\n\t\t\t\t\t\treturn `[${time}] ${speaker}: ${e.text}`;\n\t\t\t\t\t})\n\t\t\t\t\t.join(\"\\n\");\n\t\t\t},\n\t\t}),\n\t\t{ name: \"TranscriptStore\" },\n\t),\n);\n","/**\n * Call Quality Monitoring Hook\n *\n * Monitors WebRTC connection quality using RTCPeerConnection stats.\n * Provides real-time quality metrics (excellent/good/poor) based on:\n * - Packet loss\n * - Jitter\n * - Round-trip time (RTT)\n * - Audio levels\n */\n\n\"use client\";\n\nimport type { Call } from \"@telnyx/webrtc\";\nimport { useCallback, useEffect, useState } from \"react\";\n\nexport type ConnectionQuality = \"excellent\" | \"good\" | \"poor\" | \"unknown\";\n\ntype QualityMetrics = {\n\tpacketLoss: number;\n\tjitter: number;\n\trtt: number;\n\taudioLevel: number;\n};\n\ntype UseCallQualityOptions = {\n\tcall: Call | null;\n\tupdateInterval?: number; // milliseconds\n};\n\ntype UseCallQualityReturn = {\n\tquality: ConnectionQuality;\n\tmetrics: QualityMetrics | null;\n\tisMonitoring: boolean;\n};\n\n/**\n * Calculate connection quality based on WebRTC metrics\n */\nfunction calculateQuality(metrics: QualityMetrics): ConnectionQuality {\n\tconst { packetLoss, jitter, rtt } = metrics;\n\n\t// Excellent: < 1% loss, < 30ms jitter, < 150ms RTT\n\tif (packetLoss < 1 && jitter < 30 && rtt < 150) {\n\t\treturn \"excellent\";\n\t}\n\n\t// Good: < 3% loss, < 50ms jitter, < 300ms RTT\n\tif (packetLoss < 3 && jitter < 50 && rtt < 300) {\n\t\treturn \"good\";\n\t}\n\n\t// Poor: anything worse\n\treturn \"poor\";\n}\n\n/**\n * Extract quality metrics from WebRTC stats\n */\nasync function getQualityMetrics(call: Call): Promise<QualityMetrics | null> {\n\ttry {\n\t\t// Access the underlying RTCPeerConnection\n\t\t// @ts-expect-error - Telnyx SDK may not expose this in types\n\t\tconst peerConnection = call._peer?.connection;\n\n\t\tif (!(peerConnection && peerConnection instanceof RTCPeerConnection)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst stats = await peerConnection.getStats();\n\t\tconst metrics: QualityMetrics = {\n\t\t\tpacketLoss: 0,\n\t\t\tjitter: 0,\n\t\t\trtt: 0,\n\t\t\taudioLevel: 0,\n\t\t};\n\n\t\tstats.forEach((report) => {\n\t\t\t// Inbound RTP stats (receiving audio)\n\t\t\tif (report.type === \"inbound-rtp\" && report.kind === \"audio\") {\n\t\t\t\tconst packetsLost = report.packetsLost || 0;\n\t\t\t\tconst packetsReceived = report.packetsReceived || 1;\n\t\t\t\tmetrics.packetLoss =\n\t\t\t\t\t(packetsLost / (packetsLost + packetsReceived)) * 100;\n\t\t\t\tmetrics.jitter = (report.jitter || 0) * 1000; // Convert to ms\n\t\t\t}\n\n\t\t\t// Candidate pair stats (RTT)\n\t\t\tif (report.type === \"candidate-pair\" && report.state === \"succeeded\") {\n\t\t\t\tmetrics.rtt = report.currentRoundTripTime\n\t\t\t\t\t? report.currentRoundTripTime * 1000\n\t\t\t\t\t: 0;\n\t\t\t}\n\n\t\t\t// Media source stats (audio level)\n\t\t\tif (report.type === \"media-source\" && report.kind === \"audio\") {\n\t\t\t\tmetrics.audioLevel = report.audioLevel || 0;\n\t\t\t}\n\t\t});\n\n\t\treturn metrics;\n\t} catch (_error) {\n\t\treturn null;\n\t}\n}\n\n/**\n * Hook to monitor call quality in real-time\n */\nexport function useCallQuality({\n\tcall,\n\tupdateInterval = 2000, // Update every 2 seconds\n}: UseCallQualityOptions): UseCallQualityReturn {\n\tconst [quality, setQuality] = useState<ConnectionQuality>(\"unknown\");\n\tconst [metrics, setMetrics] = useState<QualityMetrics | null>(null);\n\tconst [isMonitoring, setIsMonitoring] = useState(false);\n\n\tconst updateQuality = useCallback(async () => {\n\t\tif (!call) {\n\t\t\tsetQuality(\"unknown\");\n\t\t\tsetMetrics(null);\n\t\t\treturn;\n\t\t}\n\n\t\tconst newMetrics = await getQualityMetrics(call);\n\t\tif (newMetrics) {\n\t\t\tsetMetrics(newMetrics);\n\t\t\tsetQuality(calculateQuality(newMetrics));\n\t\t}\n\t}, [call]);\n\n\tuseEffect(() => {\n\t\tif (!call) {\n\t\t\tsetIsMonitoring(false);\n\t\t\tsetQuality(\"unknown\");\n\t\t\tsetMetrics(null);\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsMonitoring(true);\n\n\t\t// Initial update\n\t\tupdateQuality();\n\n\t\t// Set up interval for continuous monitoring\n\t\tconst intervalId = setInterval(updateQuality, updateInterval);\n\n\t\treturn () => {\n\t\t\tclearInterval(intervalId);\n\t\t\tsetIsMonitoring(false);\n\t\t};\n\t}, [call, updateInterval, updateQuality]);\n\n\treturn {\n\t\tquality,\n\t\tmetrics,\n\t\tisMonitoring,\n\t};\n}\n","\"use client\";\n\n/**\n * useCallShortcuts Hook\n *\n * Handles all keyboard shortcuts for the call window.\n * CSRs need fast access to call controls without using the mouse.\n *\n * Shortcuts:\n * - M: Toggle mute\n * - H: Toggle hold\n * - R: Toggle recording\n * - T: Transfer call\n * - Shift+E: End call (requires shift to prevent accidents)\n * - J: Create new job\n * - A: Schedule appointment\n * - N: Focus notes\n * - S: Send SMS\n * - E: Send email\n * - 1: View transcript\n * - 2: View schedule\n * - ?: Show help\n * - Esc: Close dialogs\n */\n\nimport { useCallback, useEffect, useRef } from \"react\";\n\ntype CallShortcutActions = {\n\tonToggleMute?: () => void;\n\tonToggleHold?: () => void;\n\tonToggleRecording?: () => void;\n\tonTransfer?: () => void;\n\tonEndCall?: () => void;\n\tonCreateJob?: () => void;\n\tonScheduleAppointment?: () => void;\n\tonFocusNotes?: () => void;\n\tonSendSMS?: () => void;\n\tonSendEmail?: () => void;\n\tonViewTranscript?: () => void;\n\tonViewSchedule?: () => void;\n\tonShowHelp?: () => void;\n\tonEscape?: () => void;\n};\n\ntype UseCallShortcutsOptions = {\n\t/**\n\t * Whether shortcuts are enabled (disable during text input)\n\t */\n\tenabled?: boolean;\n\n\t/**\n\t * Callback when any shortcut is triggered (for analytics/feedback)\n\t */\n\tonShortcutTriggered?: (shortcut: string) => void;\n};\n\nexport function useCallShortcuts(\n\tactions: CallShortcutActions,\n\toptions: UseCallShortcutsOptions = {},\n) {\n\tconst { enabled = true, onShortcutTriggered } = options;\n\n\t// Track if user is typing in an input field\n\tconst isTypingRef = useRef(false);\n\n\t// Check if the active element is an input or textarea\n\tconst isInputActive = useCallback(() => {\n\t\tconst activeElement = document.activeElement;\n\t\tif (!activeElement) return false;\n\n\t\tconst tagName = activeElement.tagName.toLowerCase();\n\t\tconst isInput = tagName === \"input\" || tagName === \"textarea\";\n\t\tconst isContentEditable =\n\t\t\tactiveElement.getAttribute(\"contenteditable\") === \"true\";\n\n\t\treturn isInput || isContentEditable;\n\t}, []);\n\n\t// Handle keydown events\n\tconst handleKeyDown = useCallback(\n\t\t(event: KeyboardEvent) => {\n\t\t\t// Skip if shortcuts are disabled\n\t\t\tif (!enabled) return;\n\n\t\t\t// Skip if typing in an input (except for specific shortcuts)\n\t\t\tif (isInputActive()) {\n\t\t\t\t// Only allow Escape and Ctrl combinations when typing\n\t\t\t\tif (event.key === \"Escape\") {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tactions.onEscape?.();\n\t\t\t\t\tonShortcutTriggered?.(\"escape\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Normalize key for comparison\n\t\t\tconst key = event.key.toLowerCase();\n\t\t\tconst hasCtrl = event.ctrlKey || event.metaKey;\n\t\t\tconst hasShift = event.shiftKey;\n\t\t\tconst hasAlt = event.altKey;\n\n\t\t\t// Skip if Alt is pressed (browser shortcuts)\n\t\t\tif (hasAlt) return;\n\n\t\t\t// Handle Ctrl combinations\n\t\t\tif (hasCtrl) {\n\t\t\t\tswitch (key) {\n\t\t\t\t\tcase \"s\":\n\t\t\t\t\t\t// Save notes - handled elsewhere\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Handle Shift combinations\n\t\t\tif (hasShift) {\n\t\t\t\tswitch (key) {\n\t\t\t\t\tcase \"e\":\n\t\t\t\t\t\t// End call (Shift+E to prevent accidents)\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tactions.onEndCall?.();\n\t\t\t\t\t\tonShortcutTriggered?.(\"end_call\");\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Handle single key shortcuts\n\t\t\tswitch (key) {\n\t\t\t\tcase \"m\":\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tactions.onToggleMute?.();\n\t\t\t\t\tonShortcutTriggered?.(\"toggle_mute\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"h\":\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tactions.onToggleHold?.();\n\t\t\t\t\tonShortcutTriggered?.(\"toggle_hold\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"r\":\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tactions.onToggleRecording?.();\n\t\t\t\t\tonShortcutTriggered?.(\"toggle_recording\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"t\":\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tactions.onTransfer?.();\n\t\t\t\t\tonShortcutTriggered?.(\"transfer\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"j\":\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tactions.onCreateJob?.();\n\t\t\t\t\tonShortcutTriggered?.(\"create_job\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"a\":\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tactions.onScheduleAppointment?.();\n\t\t\t\t\tonShortcutTriggered?.(\"schedule_appointment\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"n\":\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tactions.onFocusNotes?.();\n\t\t\t\t\tonShortcutTriggered?.(\"focus_notes\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"s\":\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tactions.onSendSMS?.();\n\t\t\t\t\tonShortcutTriggered?.(\"send_sms\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"e\":\n\t\t\t\t\t// Only send email if Shift is not pressed (Shift+E = end call)\n\t\t\t\t\tif (!hasShift) {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tactions.onSendEmail?.();\n\t\t\t\t\t\tonShortcutTriggered?.(\"send_email\");\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"1\":\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tactions.onViewTranscript?.();\n\t\t\t\t\tonShortcutTriggered?.(\"view_transcript\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"2\":\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tactions.onViewSchedule?.();\n\t\t\t\t\tonShortcutTriggered?.(\"view_schedule\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"?\":\n\t\t\t\tcase \"/\":\n\t\t\t\t\t// ? key (with or without shift)\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tactions.onShowHelp?.();\n\t\t\t\t\tonShortcutTriggered?.(\"show_help\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"escape\":\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tactions.onEscape?.();\n\t\t\t\t\tonShortcutTriggered?.(\"escape\");\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\t[enabled, isInputActive, actions, onShortcutTriggered],\n\t);\n\n\t// Attach event listener\n\tuseEffect(() => {\n\t\twindow.addEventListener(\"keydown\", handleKeyDown);\n\t\treturn () => window.removeEventListener(\"keydown\", handleKeyDown);\n\t}, [handleKeyDown]);\n\n\t// Return helpers for the component\n\treturn {\n\t\t/**\n\t\t * Check if shortcuts are currently enabled\n\t\t */\n\t\tisEnabled: enabled,\n\n\t\t/**\n\t\t * Manually trigger a shortcut action\n\t\t */\n\t\ttrigger: (action: keyof CallShortcutActions) => {\n\t\t\tconst fn = actions[action];\n\t\t\tif (typeof fn === \"function\") {\n\t\t\t\tfn();\n\t\t\t\tonShortcutTriggered?.(action);\n\t\t\t}\n\t\t},\n\t};\n}\n\n/**\n * Shortcut descriptions for UI display\n */\nexport const SHORTCUT_DESCRIPTIONS: Record<string, string> = {\n\ttoggle_mute: \"M\",\n\ttoggle_hold: \"H\",\n\ttoggle_recording: \"R\",\n\ttransfer: \"T\",\n\tend_call: \"Shift+E\",\n\tcreate_job: \"J\",\n\tschedule_appointment: \"A\",\n\tfocus_notes: \"N\",\n\tsend_sms: \"S\",\n\tsend_email: \"E\",\n\tview_transcript: \"1\",\n\tview_schedule: \"2\",\n\tshow_help: \"?\",\n\tescape: \"Esc\",\n};\n\n/**\n * Get shortcut hint for a specific action\n */\nexport function getShortcutHint(action: keyof typeof SHORTCUT_DESCRIPTIONS): string {\n\treturn SHORTCUT_DESCRIPTIONS[action] || \"\";\n}\n","/**\n * Pop-Out Window Manager\n *\n * Centralized utilities for managing pop-out windows\n *\n * Features:\n * - Window lifecycle management (create, close, focus)\n * - Message passing between main and pop-out windows\n * - State synchronization\n * - Security verification\n *\n * Used by:\n * - use-pop-out-drag.ts hook\n * - incoming-call-notification.tsx\n * - call/page.tsx\n */\n\n// Window configuration - Opens as new tab\nconst POP_OUT_CONFIG = {\n\ttarget: \"_blank\", // Opens in new tab\n\tfeatures: \"noopener,noreferrer\", // Security features\n} as const;\n\n// Message types for window communication\nexport type PopOutMessage =\n\t| {\n\t\t\ttype: \"CALL_STATE_INIT\";\n\t\t\tcallId: string;\n\t\t\ttimestamp: number;\n\t  }\n\t| {\n\t\t\ttype: \"CALL_STATE_SYNC\";\n\t\t\tcallId: string;\n\t\t\tcallData: {\n\t\t\t\tstatus: \"ringing\" | \"active\" | \"ended\";\n\t\t\t\tisMuted: boolean;\n\t\t\t\tisOnHold: boolean;\n\t\t\t\tisRecording: boolean;\n\t\t\t\tisVideoEnabled: boolean;\n\t\t\t\tduration: number;\n\t\t\t\tcustomerName: string;\n\t\t\t\tcustomerPhone: string;\n\t\t\t};\n\t\t\ttimestamp: number;\n\t  }\n\t| {\n\t\t\ttype: \"CALL_POP_OUT_READY\";\n\t\t\tcallId: string;\n\t\t\ttimestamp: number;\n\t  }\n\t| {\n\t\t\ttype: \"CALL_POP_OUT_CLOSED\";\n\t\t\tcallId: string;\n\t\t\ttimestamp: number;\n\t  }\n\t| {\n\t\t\ttype: \"CALL_ACTION\";\n\t\t\tcallId: string;\n\t\t\taction:\n\t\t\t\t| \"mute\"\n\t\t\t\t| \"unmute\"\n\t\t\t\t| \"hold\"\n\t\t\t\t| \"unhold\"\n\t\t\t\t| \"record_start\"\n\t\t\t\t| \"record_stop\"\n\t\t\t\t| \"video_on\"\n\t\t\t\t| \"video_off\"\n\t\t\t\t| \"end\";\n\t\t\ttimestamp: number;\n\t  }\n\t| {\n\t\t\ttype: \"TRANSCRIPT_ENTRY\";\n\t\t\tcallId: string;\n\t\t\tentry: {\n\t\t\t\tid: string;\n\t\t\t\tspeaker: \"csr\" | \"customer\";\n\t\t\t\ttext: string;\n\t\t\t\ttimestamp: number;\n\t\t\t};\n\t  }\n\t| {\n\t\t\ttype: \"AI_EXTRACTION_UPDATE\";\n\t\t\tcallId: string;\n\t\t\textraction: {\n\t\t\t\tcustomerInfo?: {\n\t\t\t\t\tname?: string;\n\t\t\t\t\temail?: string;\n\t\t\t\t\tphone?: string;\n\t\t\t\t\tcompany?: string;\n\t\t\t\t};\n\t\t\t\tissueCategories?: string[];\n\t\t\t\tactionItems?: string[];\n\t\t\t\tsentiment?: \"positive\" | \"neutral\" | \"negative\";\n\t\t\t\tconfidence?: number;\n\t\t\t};\n\t  }\n\t| {\n\t\t\ttype: \"FORM_DATA_UPDATE\";\n\t\t\tcallId: string;\n\t\t\tformType: \"customer\" | \"job\" | \"appointment\";\n\t\t\tformData: Record<string, any>;\n\t\t\ttimestamp: number;\n\t  }\n\t| {\n\t\t\ttype: \"REQUEST_FORM_DATA\";\n\t\t\tcallId: string;\n\t\t\tformType: \"customer\" | \"job\" | \"appointment\";\n\t\t\ttimestamp: number;\n\t  }\n\t| {\n\t\t\ttype: \"FORM_DATA_SYNC\";\n\t\t\tcallId: string;\n\t\t\tformType: \"customer\" | \"job\" | \"appointment\";\n\t\t\tformData: Record<string, any>;\n\t\t\ttimestamp: number;\n\t  }\n\t| {\n\t\t\ttype: \"TRANSCRIPT_UPDATE\";\n\t\t\tcallId: string;\n\t\t\ttranscript?: {\n\t\t\t\tentries: Array<{\n\t\t\t\t\tid: string;\n\t\t\t\t\tspeaker: \"csr\" | \"customer\";\n\t\t\t\t\ttext: string;\n\t\t\t\t\ttimestamp: number;\n\t\t\t\t}>;\n\t\t\t};\n\t\t\ttimestamp?: number;\n\t  }\n\t| {\n\t\t\ttype: \"CUSTOMER_DATA_UPDATE\";\n\t\t\tcallId: string;\n\t\t\tcustomerData: Record<string, unknown>;\n\t\t\ttimestamp?: number;\n\t  };\n\n/**\n * Creates a call window in a new browser tab\n */\nfunction createPopOutWindow(callId: string): Window | null {\n\tconst { target, features } = POP_OUT_CONFIG;\n\n\ttry {\n\t\tconst popOut = window.open(\n\t\t\t`/call?callId=${callId}`,\n\t\t\ttarget,\n\t\t\tfeatures,\n\t\t);\n\n\t\tif (!popOut) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn popOut;\n\t} catch (_error) {\n\t\treturn null;\n\t}\n}\n\n/**\n * Sends a message to a pop-out window with security verification\n */\nfunction sendToPopOut(\n\tpopOutWindow: Window | null,\n\tmessage: PopOutMessage,\n): boolean {\n\tif (!popOutWindow || popOutWindow.closed) {\n\t\treturn false;\n\t}\n\n\ttry {\n\t\tpopOutWindow.postMessage(message, window.location.origin);\n\t\treturn true;\n\t} catch (_error) {\n\t\treturn false;\n\t}\n}\n\n/**\n * Sends a message to the main window (called from pop-out)\n */\nexport function sendToMain(message: PopOutMessage): boolean {\n\tif (!window.opener || window.opener.closed) {\n\t\treturn false;\n\t}\n\n\ttry {\n\t\twindow.opener.postMessage(message, window.location.origin);\n\t\treturn true;\n\t} catch (_error) {\n\t\treturn false;\n\t}\n}\n\n/**\n * Verifies that a message event is from a trusted source\n */\nexport function verifyMessageOrigin(event: MessageEvent): boolean {\n\treturn event.origin === window.location.origin;\n}\n\n/**\n * Checks if a message is a valid PopOutMessage\n */\nexport function isPopOutMessage(data: unknown): data is PopOutMessage {\n\tif (typeof data !== \"object\" || data === null) {\n\t\treturn false;\n\t}\n\n\tconst message = data as Record<string, unknown>;\n\n\treturn (\n\t\ttypeof message.type === \"string\" &&\n\t\ttypeof message.callId === \"string\" &&\n\t\t[\n\t\t\t\"CALL_STATE_INIT\",\n\t\t\t\"CALL_STATE_SYNC\",\n\t\t\t\"CALL_POP_OUT_READY\",\n\t\t\t\"CALL_POP_OUT_CLOSED\",\n\t\t\t\"CALL_ACTION\",\n\t\t\t\"TRANSCRIPT_ENTRY\",\n\t\t\t\"TRANSCRIPT_UPDATE\",\n\t\t\t\"AI_EXTRACTION_UPDATE\",\n\t\t\t\"FORM_DATA_UPDATE\",\n\t\t\t\"REQUEST_FORM_DATA\",\n\t\t\t\"FORM_DATA_SYNC\",\n\t\t\t\"CUSTOMER_DATA_UPDATE\",\n\t\t].includes(message.type)\n\t);\n}\n\n/**\n * Monitors a pop-out window and calls callback when it closes\n */\nfunction monitorPopOutWindow(\n\tpopOutWindow: Window,\n\tonClose: () => void,\n\tintervalMs = 500,\n): () => void {\n\tconst checkInterval = setInterval(() => {\n\t\tif (popOutWindow.closed) {\n\t\t\tclearInterval(checkInterval);\n\t\t\tonClose();\n\t\t}\n\t}, intervalMs);\n\n\t// Return cleanup function\n\treturn () => clearInterval(checkInterval);\n}\n\n/**\n * Waits for pop-out window to be ready and sends initial data\n */\nfunction waitForPopOutReady(\n\tpopOutWindow: Window,\n\tcallId: string,\n\tonReady: () => void,\n\ttimeoutMs = 5000,\n): () => void {\n\tconst checkInterval = setInterval(() => {\n\t\tif (popOutWindow.closed) {\n\t\t\tclearInterval(checkInterval);\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\t// Try to send ready check message\n\t\t\tsendToPopOut(popOutWindow, {\n\t\t\t\ttype: \"CALL_STATE_INIT\",\n\t\t\t\tcallId,\n\t\t\t\ttimestamp: Date.now(),\n\t\t\t});\n\n\t\t\t// If successful, stop checking\n\t\t\tclearInterval(checkInterval);\n\t\t\tonReady();\n\t\t} catch (_error) {\n\t\t\t// Pop-out not ready yet, continue checking\n\t\t}\n\t}, 100);\n\n\t// Stop checking after timeout\n\tconst timeout = setTimeout(() => {\n\t\tclearInterval(checkInterval);\n\t}, timeoutMs);\n\n\t// Return cleanup function\n\treturn () => {\n\t\tclearInterval(checkInterval);\n\t\tclearTimeout(timeout);\n\t};\n}\n\n/**\n * Closes a pop-out window safely\n */\nfunction closePopOutWindow(popOutWindow: Window | null): void {\n\tif (popOutWindow && !popOutWindow.closed) {\n\t\ttry {\n\t\t\tpopOutWindow.close();\n\t\t} catch (_error) {}\n\t}\n}\n\n/**\n * Focuses a pop-out window (brings to front)\n */\nfunction focusPopOutWindow(popOutWindow: Window | null): void {\n\tif (popOutWindow && !popOutWindow.closed) {\n\t\ttry {\n\t\t\tpopOutWindow.focus();\n\t\t} catch (_error) {}\n\t}\n}\n\n/**\n * Returns whether the current window is a pop-out (has an opener)\n */\nfunction isPopOutWindow(): boolean {\n\treturn window.opener !== null && window.opener !== window;\n}\n\n/**\n * Gets the call ID from the pop-out window URL\n */\nexport function getCallIdFromUrl(): string | null {\n\tif (typeof window === \"undefined\") {\n\t\treturn null;\n\t}\n\n\tconst params = new URLSearchParams(window.location.search);\n\treturn params.get(\"callId\");\n}\n"],"names":[],"mappings":"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"}