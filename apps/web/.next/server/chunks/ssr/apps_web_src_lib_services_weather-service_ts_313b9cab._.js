module.exports=[728951,a=>{"use strict";var b=a.i(146057);let c="Thorbis-FMS/1.0 (support@thorbis.app)",d=b.z.object({event:b.z.string(),headline:b.z.string(),description:b.z.string(),severity:b.z.enum(["Extreme","Severe","Moderate","Minor","Unknown"]),urgency:b.z.enum(["Immediate","Expected","Future","Past","Unknown"]),onset:b.z.string().optional(),expires:b.z.string().optional(),instruction:b.z.string().nullable().optional()}),e=b.z.object({number:b.z.number(),name:b.z.string(),temperature:b.z.number(),temperatureUnit:b.z.string(),windSpeed:b.z.string(),windDirection:b.z.string(),shortForecast:b.z.string(),detailedForecast:b.z.string(),startTime:b.z.string(),endTime:b.z.string()}),f=b.z.object({location:b.z.object({lat:b.z.number(),lon:b.z.number(),gridId:b.z.string().optional(),gridX:b.z.number().optional(),gridY:b.z.number().optional()}),forecast:b.z.object({periods:b.z.array(e),updated:b.z.string().optional()}).optional(),hourly:b.z.object({periods:b.z.array(e),updated:b.z.string().optional()}).optional(),alerts:b.z.array(d),hasActiveAlerts:b.z.boolean(),highestSeverity:b.z.enum(["Extreme","Severe","Moderate","Minor","None"]),enrichedAt:b.z.string()});class g{cache=new Map;cacheTTL=18e5;async getWeatherData(a,b){let d=`${a.toFixed(4)},${b.toFixed(4)}`,e=this.cache.get(d);if(e&&Date.now()-e.timestamp<this.cacheTTL)return e.data;try{let e=await fetch(`https://api.weather.gov/points/${a.toFixed(4)},${b.toFixed(4)}`,{headers:{"User-Agent":c,Accept:"application/geo+json"}});if(!e.ok)return null;let g=(await e.json()).properties,[h,i,j]=await Promise.all([g.forecast?this.fetchJson(g.forecast):Promise.resolve(null),g.forecastHourly?this.fetchJson(g.forecastHourly):Promise.resolve(null),this.fetchJson(`https://api.weather.gov/alerts/active?point=${a},${b}`)]),k=[],l="None";if(j?.features)for(let a of j.features){let b=a.properties,c={event:b.event||"Unknown Event",headline:b.headline||"",description:b.description||"",severity:this.normalizeSeverity(b.severity),urgency:this.normalizeUrgency(b.urgency),onset:b.onset,expires:b.expires,instruction:b.instruction};k.push(c),"Unknown"!==c.severity&&this.severityRank(c.severity)>this.severityRank(l)&&(l=c.severity)}let m={location:{lat:a,lon:b,gridId:g.gridId,gridX:g.gridX,gridY:g.gridY},forecast:h?{periods:h.properties.periods.map(a=>({number:a.number,name:a.name,temperature:a.temperature,temperatureUnit:a.temperatureUnit,windSpeed:a.windSpeed,windDirection:a.windDirection,shortForecast:a.shortForecast,detailedForecast:a.detailedForecast,startTime:a.startTime,endTime:a.endTime})),updated:h.properties.updated||h.properties.generatedAt}:void 0,hourly:i?{periods:i.properties.periods.slice(0,24).map(a=>({number:a.number,name:a.name,temperature:a.temperature,temperatureUnit:a.temperatureUnit,windSpeed:a.windSpeed,windDirection:a.windDirection,shortForecast:a.shortForecast,detailedForecast:a.detailedForecast,startTime:a.startTime,endTime:a.endTime})),updated:i.properties.updated||i.properties.generatedAt}:void 0,alerts:k,hasActiveAlerts:k.length>0,highestSeverity:l,enrichedAt:new Date().toISOString()};return this.cache.set(d,{data:m,timestamp:Date.now()}),f.parse(m)}catch(a){return null}}async getActiveAlerts(a,b){try{let c=await this.fetchJson(`https://api.weather.gov/alerts/active?point=${a},${b}`);if(!c?.features)return[];return c.features.map(a=>({event:a.properties.event||"Unknown Event",headline:a.properties.headline||"",description:a.properties.description||"",severity:this.normalizeSeverity(a.properties.severity),urgency:this.normalizeUrgency(a.properties.urgency),onset:a.properties.onset,expires:a.properties.expires,instruction:a.properties.instruction}))}catch(a){return[]}}isSuitableForOutdoorWork(a){if("Extreme"===a.highestSeverity||"Severe"===a.highestSeverity)return{suitable:!1,reason:"Severe weather alert in effect"};if(a.hourly?.periods?.[0]){let b=a.hourly.periods[0];if(b.shortForecast.toLowerCase().includes("rain")||b.shortForecast.toLowerCase().includes("storm")||b.shortForecast.toLowerCase().includes("snow"))return{suitable:!1,reason:`${b.shortForecast} expected`};if(b.temperature<32)return{suitable:!1,reason:"Freezing temperatures"};if(b.temperature>100)return{suitable:!1,reason:"Extreme heat"}}return{suitable:!0}}async fetchJson(a){let b=await fetch(a,{headers:{"User-Agent":c,Accept:"application/geo+json"}});if(!b.ok)throw Error(`Fetch failed: ${b.status} ${a}`);return b.json()}normalizeSeverity(a){if(!a)return"Unknown";let b=a.toLowerCase();return b.includes("extreme")?"Extreme":b.includes("severe")?"Severe":b.includes("moderate")?"Moderate":b.includes("minor")?"Minor":"Unknown"}normalizeUrgency(a){if(!a)return"Unknown";let b=a.toLowerCase();return b.includes("immediate")?"Immediate":b.includes("expected")?"Expected":b.includes("future")?"Future":b.includes("past")?"Past":"Unknown"}severityRank(a){switch(a){case"Extreme":return 4;case"Severe":return 3;case"Moderate":return 2;case"Minor":return 1;default:return 0}}clearCache(){this.cache.clear()}}let h=new g;a.s(["WeatherService",()=>g,"weatherService",0,h])}];

//# sourceMappingURL=apps_web_src_lib_services_weather-service_ts_313b9cab._.js.map