module.exports=[807124,a=>{"use strict";var b=a.i(254799);class c{config;apiUrl="https://api.profitstars.com";constructor(a){this.config=a}getSupportedChannels(){return["ach","check"]}async processPayment(a){try{if(!a.paymentMethodId)return{success:!1,status:"failed",error:"Payment method (bank account) is required for ACH payments"};let b={merchant_id:this.config.merchantId,transaction_type:"ACH_DEBIT",amount:a.amount/100,account_number:a.paymentMethodId,routing_number:this.config.routingNumber,reference_number:a.invoiceId||`invoice-${Date.now()}`,description:a.description||"Invoice payment",metadata:{company_id:this.config.companyId,customer_id:a.customerId,invoice_id:a.invoiceId,...a.metadata}},c=await fetch(`${this.apiUrl}/v1/payments/ach`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`,"X-Merchant-ID":this.config.merchantId},body:JSON.stringify(b)}),d=await c.json();if(!c.ok)return{success:!1,status:"failed",error:d.message||"ACH payment processing failed",failureCode:d.error_code,failureMessage:d.message};return{success:!0,transactionId:d.transaction_id,processorTransactionId:d.transaction_id,status:"processed"===d.status?"succeeded":"processing",processorMetadata:d}}catch(a){return{success:!1,status:"failed",error:a instanceof Error?a.message:"Payment processing failed"}}}async refundPayment(a){try{let b={merchant_id:this.config.merchantId,original_transaction_id:a.transactionId,amount:a.amount?a.amount/100:void 0,reason:a.reason},c=await fetch(`${this.apiUrl}/v1/payments/refund`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`,"X-Merchant-ID":this.config.merchantId},body:JSON.stringify(b)}),d=await c.json();if(!c.ok)return{success:!1,status:"failed",error:d.message||"Refund failed"};return{success:!0,refundId:d.refund_id,processorRefundId:d.refund_id,status:"processed"===d.status?"succeeded":"processing"}}catch(a){return{success:!1,status:"failed",error:a instanceof Error?a.message:"Refund failed"}}}async getPaymentStatus(a){let b=await fetch(`${this.apiUrl}/v1/payments/${a}`,{method:"GET",headers:{Authorization:`Bearer ${this.config.apiKey}`,"X-Merchant-ID":this.config.merchantId}}),c=await b.json();if(!b.ok)throw Error(c.message||"Failed to get payment status");return{status:c.status||"unknown",amount:100*(c.amount||0),metadata:c}}verifyWebhook(a,c){if(!this.config.webhookSecret)return console.warn("[ProfitStars] No webhook secret configured - skipping verification"),!1;if(!c)return console.error("[ProfitStars] No webhook signature provided"),!1;try{let d=b.default.createHmac("sha256",this.config.webhookSecret).update(a,"utf8").digest("hex"),e=c.startsWith("sha256=")?c.slice(7):c,f=Buffer.from(d,"hex"),g=Buffer.from(e,"hex");if(f.length!==g.length)return console.error("[ProfitStars] Webhook signature length mismatch"),!1;if(!b.default.timingSafeEqual(f,g))return console.error("[ProfitStars] Webhook signature verification failed"),!1;try{let b=JSON.parse(a);if(b.timestamp){let a=new Date(b.timestamp).getTime(),c=Date.now();if(Math.abs(c-a)>3e5)return console.error("[ProfitStars] Webhook timestamp too old"),!1}}catch{}return!0}catch(a){return console.error("[ProfitStars] Webhook verification error:",a),!1}}}a.s(["ProfitStarsProcessor",()=>c])}];

//# sourceMappingURL=apps_web_src_lib_payments_processors_profitstars_ts_eabbf2bd._.js.map