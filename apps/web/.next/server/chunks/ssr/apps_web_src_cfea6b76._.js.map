{"version":3,"sources":["../../../../../../apps/web/src/components/dashboard/role-based-dashboard.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/components/dashboard/pin-board/pin-board-content.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/components/dashboard/pin-board/pin-board-post-card.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/components/dashboard/pin-board/pin-board-editor.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/components/dashboard/pin-board/pin-board-file-upload.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/components/dashboard/pin-board/pin-board-file-preview.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/page.tsx","../../../../../../apps/web/src/components/dashboard/dashboard-content.tsx","../../../../../../apps/web/src/components/dashboard/pin-board/pin-board-section.tsx","../../../../../../apps/web/src/lib/queries/pin-board.ts","../../../../../../apps/web/src/components/dashboard/pin-board/index.ts","../../../../../../apps/web/src/components/dashboard/pin-board/pin-board-skeleton.tsx","../../../../../../apps/web/src/lib/schedule-utils.ts","../../../../../../apps/web/src/lib/queries/mission-control-data.ts","../../../../../../apps/web/src/components/dashboard/dashboard-shell.tsx","../../../../../../apps/web/src/components/dashboard/dashboard-skeleton.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const RoleBasedDashboard = registerClientReference(\n    function() { throw new Error(\"Attempted to call RoleBasedDashboard() from the server but RoleBasedDashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/dashboard/role-based-dashboard.tsx\",\n    \"RoleBasedDashboard\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const PinBoardContent = registerClientReference(\n    function() { throw new Error(\"Attempted to call PinBoardContent() from the server but PinBoardContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/dashboard/pin-board/pin-board-content.tsx\",\n    \"PinBoardContent\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const PinBoardPostCard = registerClientReference(\n    function() { throw new Error(\"Attempted to call PinBoardPostCard() from the server but PinBoardPostCard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/dashboard/pin-board/pin-board-post-card.tsx\",\n    \"PinBoardPostCard\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const PinBoardEditorDialog = registerClientReference(\n    function() { throw new Error(\"Attempted to call PinBoardEditorDialog() from the server but PinBoardEditorDialog is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/dashboard/pin-board/pin-board-editor.tsx\",\n    \"PinBoardEditorDialog\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const PinBoardFileUpload = registerClientReference(\n    function() { throw new Error(\"Attempted to call PinBoardFileUpload() from the server but PinBoardFileUpload is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/dashboard/pin-board/pin-board-file-upload.tsx\",\n    \"PinBoardFileUpload\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const AttachmentIndicator = registerClientReference(\n    function() { throw new Error(\"Attempted to call AttachmentIndicator() from the server but AttachmentIndicator is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/dashboard/pin-board/pin-board-file-preview.tsx\",\n    \"AttachmentIndicator\",\n);\nexport const PinBoardFilePreview = registerClientReference(\n    function() { throw new Error(\"Attempted to call PinBoardFilePreview() from the server but PinBoardFilePreview is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/dashboard/pin-board/pin-board-file-preview.tsx\",\n    \"PinBoardFilePreview\",\n);\n","/**\n * Main Dashboard Page - PPR Enabled\n *\n * Uses Partial Prerendering for instant page loads:\n * - Static shell renders instantly (5-20ms)\n * - Dynamic content streams in (100-300ms)\n *\n * Performance: 10-100x faster than traditional SSR\n */\n\nimport { Suspense } from \"react\";\nimport { DashboardContent } from \"@/components/dashboard/dashboard-content\";\nimport { DashboardShell } from \"@/components/dashboard/dashboard-shell\";\nimport { DashboardSkeleton } from \"@/components/dashboard/dashboard-skeleton\";\n\n// Enable Partial Prerendering for this page (Next.js 16+)\n// PPR is now enabled globally via cacheComponents in next.config.ts\n// This export is no longer needed but kept for documentation\n// export const experimental_ppr = true;\n\nexport default function DashboardPage() {\n\treturn (\n\t\t<DashboardShell>\n\t\t\t<Suspense fallback={<DashboardSkeleton />}>\n\t\t\t\t<DashboardContent />\n\t\t\t</Suspense>\n\t\t</DashboardShell>\n\t);\n}\n","import { Suspense } from \"react\";\nimport { RoleBasedDashboard } from \"@/components/dashboard/role-based-dashboard\";\nimport { PinBoardSection } from \"@/components/dashboard/pin-board\";\nimport { PinBoardSkeleton } from \"@/components/dashboard/pin-board/pin-board-skeleton\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport { getMissionControlData } from \"@/lib/queries/mission-control-data\";\n\n/**\n * Dashboard Content - Async Server Component\n *\n * Fetches dashboard data and streams in after shell renders.\n * This component is wrapped in Suspense, so it doesn't block the initial page load.\n */\nexport async function DashboardContent() {\n\t// Fetch company ID and data server-side\n\tconst companyId = await getActiveCompanyId();\n\tconst dashboardData = companyId\n\t\t? await getMissionControlData(companyId)\n\t\t: null;\n\n\t// Capture the render timestamp so client components can format relative times\n\tconst renderedAt = Date.now();\n\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t<RoleBasedDashboard dashboardData={dashboardData} renderedAt={renderedAt} />\n\n\t\t\t{/* Pin Board / Content Portal - Streams independently */}\n\t\t\t<Suspense fallback={<PinBoardSkeleton />}>\n\t\t\t\t<PinBoardSection />\n\t\t\t</Suspense>\n\t\t</div>\n\t);\n}\n","/**\n * Pin Board Section - Server Component\n *\n * Main wrapper that fetches data and renders the pin board content.\n * Uses React.cache() for deduped queries.\n */\n\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport {\n  getPinBoardCategories,\n  getPinBoardPosts,\n  getPinBoardCategoryStats,\n} from \"@/lib/queries/pin-board\";\nimport { PinBoardContent } from \"./pin-board-content\";\n\nexport async function PinBoardSection() {\n  const companyId = await getActiveCompanyId();\n\n  if (!companyId) {\n    return null;\n  }\n\n  // Fetch data in parallel using React.cache()\n  const [categories, posts, categoryStats] = await Promise.all([\n    getPinBoardCategories(companyId),\n    getPinBoardPosts(companyId, { limit: 50 }),\n    getPinBoardCategoryStats(companyId),\n  ]);\n\n  return (\n    <PinBoardContent\n      categories={categories}\n      posts={posts}\n      categoryStats={categoryStats}\n      companyId={companyId}\n    />\n  );\n}\n","/**\n * Pin Board Query Functions\n *\n * Cached query functions using React.cache() for deduplication.\n * Multiple components calling these functions will share the same DB query.\n */\n\nimport { cache } from \"react\";\nimport { createClient } from \"@/lib/supabase/server\";\n\nexport type PinBoardCategory = {\n  id: string;\n  company_id: string;\n  name: string;\n  slug: string;\n  description: string | null;\n  icon: string;\n  color: string;\n  sort_order: number;\n  is_default: boolean;\n  created_at: string;\n  updated_at: string;\n};\n\nexport type PinBoardPost = {\n  id: string;\n  company_id: string;\n  category_id: string | null;\n  title: string;\n  content: string | null;\n  excerpt: string | null;\n  is_pinned: boolean;\n  is_published: boolean;\n  priority: number;\n  version: number;\n  created_by: string | null;\n  updated_by: string | null;\n  created_at: string;\n  updated_at: string;\n  published_at: string | null;\n  category?: PinBoardCategory | null;\n  author?: {\n    id: string;\n    full_name: string | null;\n    avatar_url: string | null;\n  } | null;\n  attachments?: PinBoardAttachment[];\n  view_count?: number;\n  has_viewed?: boolean;\n};\n\nexport type PinBoardAttachment = {\n  id: string;\n  post_id: string;\n  company_id: string;\n  file_name: string;\n  file_type: string | null;\n  file_size: number | null;\n  file_url: string;\n  description: string | null;\n  sort_order: number;\n  uploaded_by: string | null;\n  created_at: string;\n};\n\n/**\n * Get all categories for a company\n */\nexport const getPinBoardCategories = cache(async (companyId: string): Promise<PinBoardCategory[]> => {\n  const supabase = await createClient();\n  if (!supabase) return [];\n\n  const { data, error } = await supabase\n    .from(\"pin_board_categories\")\n    .select(\"*\")\n    .eq(\"company_id\", companyId)\n    .order(\"sort_order\", { ascending: true });\n\n  if (error) {\n    console.error(\"Failed to fetch pin board categories:\", error);\n    return [];\n  }\n\n  return data ?? [];\n});\n\n/**\n * Get all published posts for a company with optional category filter\n * Pinned posts appear first, then sorted by created_at DESC\n */\nexport const getPinBoardPosts = cache(async (\n  companyId: string,\n  options?: {\n    categorySlug?: string;\n    limit?: number;\n    includeUnpublished?: boolean;\n  }\n): Promise<PinBoardPost[]> => {\n  const supabase = await createClient();\n  if (!supabase) return [];\n  const { categorySlug, limit = 50, includeUnpublished = false } = options ?? {};\n\n  let query = supabase\n    .from(\"pin_board_posts\")\n    .select(`\n      *,\n      category:pin_board_categories(id, name, slug, icon, color),\n      attachments:pin_board_attachments(id, file_name, file_type, file_size, file_url, description)\n    `)\n    .eq(\"company_id\", companyId)\n    .order(\"is_pinned\", { ascending: false })\n    .order(\"created_at\", { ascending: false })\n    .limit(limit);\n\n  if (!includeUnpublished) {\n    query = query.eq(\"is_published\", true);\n  }\n\n  if (categorySlug) {\n    // Join with categories to filter by slug\n    const { data: category } = await supabase\n      .from(\"pin_board_categories\")\n      .select(\"id\")\n      .eq(\"company_id\", companyId)\n      .eq(\"slug\", categorySlug)\n      .single();\n\n    if (category) {\n      query = query.eq(\"category_id\", category.id);\n    }\n  }\n\n  const { data, error } = await query;\n\n  if (error) {\n    console.error(\"Failed to fetch pin board posts:\", error);\n    return [];\n  }\n\n  return (data ?? []) as PinBoardPost[];\n});\n\n/**\n * Get a single post by ID with full details\n */\nexport const getPinBoardPost = cache(async (\n  companyId: string,\n  postId: string\n): Promise<PinBoardPost | null> => {\n  const supabase = await createClient();\n  if (!supabase) return null;\n\n  const { data, error } = await supabase\n    .from(\"pin_board_posts\")\n    .select(`\n      *,\n      category:pin_board_categories(id, name, slug, icon, color),\n      attachments:pin_board_attachments(id, file_name, file_type, file_size, file_url, description, sort_order)\n    `)\n    .eq(\"id\", postId)\n    .eq(\"company_id\", companyId)\n    .single();\n\n  if (error) {\n    console.error(\"Failed to fetch pin board post:\", error);\n    return null;\n  }\n\n  return data as PinBoardPost;\n});\n\n/**\n * Get view statistics for posts\n */\nexport const getPinBoardPostViews = cache(async (\n  companyId: string,\n  postIds: string[]\n): Promise<Record<string, number>> => {\n  if (postIds.length === 0) return {};\n\n  const supabase = await createClient();\n  if (!supabase) return {};\n\n  const { data, error } = await supabase\n    .from(\"pin_board_views\")\n    .select(\"post_id\")\n    .eq(\"company_id\", companyId)\n    .in(\"post_id\", postIds);\n\n  if (error) {\n    console.error(\"Failed to fetch pin board views:\", error);\n    return {};\n  }\n\n  // Count views per post\n  const viewCounts: Record<string, number> = {};\n  for (const view of data ?? []) {\n    viewCounts[view.post_id] = (viewCounts[view.post_id] || 0) + 1;\n  }\n\n  return viewCounts;\n});\n\n/**\n * Check which posts the current user has viewed\n */\nexport const getUserViewedPosts = cache(async (\n  companyId: string,\n  userId: string,\n  postIds: string[]\n): Promise<Set<string>> => {\n  if (postIds.length === 0) return new Set();\n\n  const supabase = await createClient();\n  if (!supabase) return new Set();\n\n  const { data, error } = await supabase\n    .from(\"pin_board_views\")\n    .select(\"post_id\")\n    .eq(\"company_id\", companyId)\n    .eq(\"user_id\", userId)\n    .in(\"post_id\", postIds);\n\n  if (error) {\n    console.error(\"Failed to fetch user viewed posts:\", error);\n    return new Set();\n  }\n\n  return new Set((data ?? []).map(v => v.post_id));\n});\n\n/**\n * Search posts by title or content\n */\nexport const searchPinBoardPosts = cache(async (\n  companyId: string,\n  searchQuery: string,\n  limit = 20\n): Promise<PinBoardPost[]> => {\n  const supabase = await createClient();\n  if (!supabase) return [];\n\n  const { data, error } = await supabase\n    .from(\"pin_board_posts\")\n    .select(`\n      *,\n      category:pin_board_categories(id, name, slug, icon, color)\n    `)\n    .eq(\"company_id\", companyId)\n    .eq(\"is_published\", true)\n    .or(`title.ilike.%${searchQuery}%,content.ilike.%${searchQuery}%`)\n    .order(\"is_pinned\", { ascending: false })\n    .order(\"created_at\", { ascending: false })\n    .limit(limit);\n\n  if (error) {\n    console.error(\"Failed to search pin board posts:\", error);\n    return [];\n  }\n\n  return (data ?? []) as PinBoardPost[];\n});\n\n/**\n * Get post count by category\n */\nexport const getPinBoardCategoryStats = cache(async (\n  companyId: string\n): Promise<Record<string, number>> => {\n  const supabase = await createClient();\n  if (!supabase) return {};\n\n  const { data, error } = await supabase\n    .from(\"pin_board_posts\")\n    .select(\"category_id\")\n    .eq(\"company_id\", companyId)\n    .eq(\"is_published\", true);\n\n  if (error) {\n    console.error(\"Failed to fetch category stats:\", error);\n    return {};\n  }\n\n  const stats: Record<string, number> = { all: data?.length ?? 0 };\n  for (const post of data ?? []) {\n    if (post.category_id) {\n      stats[post.category_id] = (stats[post.category_id] || 0) + 1;\n    }\n  }\n\n  return stats;\n});\n","export { PinBoardSection } from \"./pin-board-section\";\nexport { PinBoardContent } from \"./pin-board-content\";\nexport { PinBoardPostCard } from \"./pin-board-post-card\";\nexport { PinBoardEditorDialog } from \"./pin-board-editor\";\nexport { PinBoardSkeleton } from \"./pin-board-skeleton\";\nexport { PinBoardFileUpload } from \"./pin-board-file-upload\";\nexport { PinBoardFilePreview, AttachmentIndicator } from \"./pin-board-file-preview\";\n","import { Skeleton } from \"@/components/ui/skeleton\";\n\nexport function PinBoardSkeleton() {\n  return (\n    <div className=\"bg-card/50 border-border/50 backdrop-blur-sm rounded-xl border overflow-hidden\">\n      {/* Header */}\n      <div className=\"p-6 border-b border-border/50\">\n        <div className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <Skeleton className=\"h-10 w-10 rounded-lg\" />\n            <div className=\"space-y-2\">\n              <Skeleton className=\"h-5 w-32\" />\n              <Skeleton className=\"h-4 w-48\" />\n            </div>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <Skeleton className=\"h-9 w-64\" />\n            <Skeleton className=\"h-9 w-24\" />\n          </div>\n        </div>\n\n        {/* Category Tabs */}\n        <div className=\"flex items-center gap-2 mt-4\">\n          <Skeleton className=\"h-8 w-16\" />\n          <Skeleton className=\"h-8 w-32\" />\n          <Skeleton className=\"h-8 w-28\" />\n          <Skeleton className=\"h-8 w-24\" />\n          <Skeleton className=\"h-8 w-36\" />\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"p-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {[1, 2, 3, 4, 5, 6].map((i) => (\n            <div key={i} className=\"border rounded-lg p-4 space-y-3\">\n              <div className=\"flex items-center gap-2\">\n                <Skeleton className=\"h-4 w-4\" />\n                <Skeleton className=\"h-5 w-20\" />\n              </div>\n              <Skeleton className=\"h-5 w-3/4\" />\n              <Skeleton className=\"h-4 w-full\" />\n              <Skeleton className=\"h-4 w-2/3\" />\n              <div className=\"flex items-center justify-between pt-2\">\n                <Skeleton className=\"h-3 w-24\" />\n                <Skeleton className=\"h-3 w-8\" />\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n","import type {\n\tAddress,\n\tCustomer,\n\tJob,\n\tJobAssignment,\n\tLegacyJob,\n\tLocation,\n\tTechnician,\n\tTechnicianSchedule,\n} from \"@/components/schedule/schedule-types\";\n\n/**\n * Utilities for schedule management\n */\n\n// ============================================\n// CONFLICT DETECTION\n// ============================================\n\nfunction hasTimeConflict(\n\tjob1Start: Date | string,\n\tjob1End: Date | string,\n\tjob2Start: Date | string,\n\tjob2End: Date | string,\n): boolean {\n\tconst start1 = job1Start instanceof Date ? job1Start : new Date(job1Start);\n\tconst end1 = job1End instanceof Date ? job1End : new Date(job1End);\n\tconst start2 = job2Start instanceof Date ? job2Start : new Date(job2Start);\n\tconst end2 = job2End instanceof Date ? job2End : new Date(job2End);\n\n\treturn (\n\t\t(start1 >= start2 && start1 < end2) ||\n\t\t(end1 > start2 && end1 <= end2) ||\n\t\t(start1 <= start2 && end1 >= end2)\n\t);\n}\n\nfunction findConflictingJobs(\n\tjobs: Job[],\n\ttechnicianId: string,\n\tstartTime: Date,\n\tendTime: Date,\n\texcludeJobId?: string,\n): Job[] {\n\treturn jobs.filter((job) => {\n\t\tif (excludeJobId && job.id === excludeJobId) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!jobHasTechnician(job, technicianId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn hasTimeConflict(startTime, endTime, job.startTime, job.endTime);\n\t});\n}\n\n// ============================================\n// MIGRATION UTILITIES\n// ============================================\n\nfunction legacyJobToJob(legacy: LegacyJob, technicianId: string): Job {\n\tconst today = new Date();\n\ttoday.setHours(0, 0, 0, 0);\n\n\t// Parse time strings\n\tconst [startHour, startMin] = legacy.startTime.split(\":\").map(Number);\n\tconst [endHour, endMin] = legacy.endTime.split(\":\").map(Number);\n\n\tconst startTime = new Date(today);\n\tstartTime.setHours(startHour, startMin, 0, 0);\n\n\tconst endTime = new Date(today);\n\tendTime.setHours(endHour, endMin, 0, 0);\n\n\t// Create address and location\n\tconst address: Address = {\n\t\tstreet: legacy.address,\n\t\tcity: \"\",\n\t\tstate: \"\",\n\t\tzip: \"\",\n\t\tcountry: \"USA\",\n\t};\n\n\tconst location: Location = {\n\t\taddress,\n\t\tcoordinates: {\n\t\t\tlat: legacy.lat,\n\t\t\tlng: legacy.lng,\n\t\t},\n\t};\n\n\t// Create customer\n\tconst customer: Customer = {\n\t\tid: `customer-${legacy.customer.toLowerCase().replace(/\\s+/g, \"-\")}`,\n\t\tname: legacy.customer,\n\t\tlocation,\n\t\tcreatedAt: new Date(),\n\t\tupdatedAt: new Date(),\n\t};\n\n\t// Calculate estimated duration in minutes\n\tconst estimatedDuration = legacy.estimatedDuration\n\t\t? Number.parseFloat(legacy.estimatedDuration.replace(/[^\\d.]/g, \"\")) * 60\n\t\t: undefined;\n\n\tconst assignments: JobAssignment[] = technicianId\n\t\t? [\n\t\t\t\t{\n\t\t\t\t\ttechnicianId,\n\t\t\t\t\tteamMemberId: undefined,\n\t\t\t\t\tdisplayName: \"Technician\",\n\t\t\t\t\tavatar: null,\n\t\t\t\t\trole: \"primary\",\n\t\t\t\t\tstatus: \"available\",\n\t\t\t\t\tisActive: true,\n\t\t\t\t},\n\t\t\t]\n\t\t: [];\n\n\treturn {\n\t\tid: legacy.id,\n\t\ttechnicianId,\n\t\tassignments,\n\t\tisUnassigned: assignments.length === 0,\n\t\ttitle: legacy.title,\n\t\tdescription: legacy.description,\n\t\tcustomer,\n\t\tlocation,\n\t\tstartTime,\n\t\tendTime,\n\t\tstatus: legacy.status,\n\t\tpriority: legacy.priority,\n\t\tmetadata: {\n\t\t\testimatedDuration,\n\t\t},\n\t\tcreatedAt: new Date(),\n\t\tupdatedAt: new Date(),\n\t};\n}\n\n// ============================================\n// TIME CALCULATIONS\n// ============================================\n\nfunction calculateDuration(\n\tstartTime: Date | string,\n\tendTime: Date | string,\n): number {\n\tconst start = startTime instanceof Date ? startTime : new Date(startTime);\n\tconst end = endTime instanceof Date ? endTime : new Date(endTime);\n\treturn Math.round((end.getTime() - start.getTime()) / (1000 * 60)); // minutes\n}\n\nfunction formatDuration(minutes: number): string {\n\tif (minutes < 60) {\n\t\treturn `${minutes}m`;\n\t}\n\n\tconst hours = Math.floor(minutes / 60);\n\tconst mins = minutes % 60;\n\n\treturn mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;\n}\n\nfunction addMinutes(date: Date, minutes: number): Date {\n\treturn new Date(date.getTime() + minutes * 60 * 1000);\n}\n\n// ============================================\n// WORK HOURS CALCULATIONS\n// ============================================\n\nfunction calculateWorkload(\n\tjobs: Job[],\n\ttechnicianSchedule: TechnicianSchedule,\n\tdate: Date,\n): {\n\ttotalMinutes: number;\n\tavailableMinutes: number;\n\tutilizationRate: number;\n} {\n\tconst dayStart = new Date(date);\n\tdayStart.setHours(technicianSchedule.availableHours.start, 0, 0, 0);\n\n\tconst dayEnd = new Date(date);\n\tdayEnd.setHours(technicianSchedule.availableHours.end, 0, 0, 0);\n\n\tconst availableMinutes = calculateDuration(dayStart, dayEnd);\n\n\t// Calculate total job duration for this day\n\tconst totalMinutes = jobs.reduce((sum, job) => {\n\t\t// Check if job is on this date\n\t\tif (\n\t\t\tjob.startTime.toDateString() === date.toDateString() ||\n\t\t\tjob.endTime.toDateString() === date.toDateString()\n\t\t) {\n\t\t\treturn sum + calculateDuration(job.startTime, job.endTime);\n\t\t}\n\t\treturn sum;\n\t}, 0);\n\n\tconst utilizationRate =\n\t\tavailableMinutes > 0 ? (totalMinutes / availableMinutes) * 100 : 0;\n\n\treturn {\n\t\ttotalMinutes,\n\t\tavailableMinutes,\n\t\tutilizationRate: Math.min(utilizationRate, 100),\n\t};\n}\n\n// ============================================\n// DATE UTILITIES\n// ============================================\n\nfunction isSameDay(date1: Date, date2: Date): boolean {\n\treturn (\n\t\tdate1.getFullYear() === date2.getFullYear() &&\n\t\tdate1.getMonth() === date2.getMonth() &&\n\t\tdate1.getDate() === date2.getDate()\n\t);\n}\n\nfunction isToday(date: Date): boolean {\n\treturn isSameDay(date, new Date());\n}\n\nexport function startOfDay(date: Date): Date {\n\tconst result = new Date(date);\n\tresult.setHours(0, 0, 0, 0);\n\treturn result;\n}\n\nexport function endOfDay(date: Date): Date {\n\tconst result = new Date(date);\n\tresult.setHours(23, 59, 59, 999);\n\treturn result;\n}\n\n// ============================================\n// RECURRING JOBS\n// ============================================\n\nfunction generateRecurringJobInstances(\n\tbaseJob: Job,\n\tstartDate: Date,\n\tendDate: Date,\n): Job[] {\n\tif (!baseJob.recurrence) {\n\t\treturn [baseJob];\n\t}\n\n\tconst instances: Job[] = [];\n\tconst {\n\t\tfrequency,\n\t\tinterval,\n\t\tcount,\n\t\tendDate: recurrenceEndDate,\n\t} = baseJob.recurrence;\n\n\tconst currentDate = new Date(baseJob.startTime);\n\tlet instanceCount = 0;\n\n\twhile (currentDate <= endDate) {\n\t\tif (currentDate >= startDate) {\n\t\t\t// Calculate job duration\n\t\t\tconst duration = calculateDuration(baseJob.startTime, baseJob.endTime);\n\n\t\t\t// Create new instance\n\t\t\tconst instance: Job = {\n\t\t\t\t...baseJob,\n\t\t\t\tid: `${baseJob.id}-instance-${instanceCount}`,\n\t\t\t\tparentJobId: baseJob.id,\n\t\t\t\tstartTime: new Date(currentDate),\n\t\t\t\tendTime: addMinutes(new Date(currentDate), duration),\n\t\t\t};\n\n\t\t\tinstances.push(instance);\n\t\t}\n\n\t\t// Move to next occurrence\n\t\tinstanceCount++;\n\n\t\tif (count && instanceCount >= count) {\n\t\t\tbreak;\n\t\t}\n\t\tif (recurrenceEndDate && currentDate >= recurrenceEndDate) {\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch (frequency) {\n\t\t\tcase \"daily\":\n\t\t\t\tcurrentDate.setDate(currentDate.getDate() + interval);\n\t\t\t\tbreak;\n\t\t\tcase \"weekly\":\n\t\t\t\tcurrentDate.setDate(currentDate.getDate() + interval * 7);\n\t\t\t\tbreak;\n\t\t\tcase \"monthly\":\n\t\t\t\tcurrentDate.setMonth(currentDate.getMonth() + interval);\n\t\t\t\tbreak;\n\t\t\tcase \"yearly\":\n\t\t\t\tcurrentDate.setFullYear(currentDate.getFullYear() + interval);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn instances;\n}\n\n// ============================================\n// FILTERING\n// ============================================\n\nexport function filterJobs(\n\tjobs: Job[],\n\tfilters: {\n\t\ttechnicianIds?: string[];\n\t\tstatuses?: Job[\"status\"][];\n\t\tpriorities?: Job[\"priority\"][];\n\t\tsearchQuery?: string;\n\t},\n): Job[] {\n\treturn jobs.filter((job) => {\n\t\t// Filter by technician\n\t\tif (\n\t\t\tfilters.technicianIds &&\n\t\t\tfilters.technicianIds.length > 0 &&\n\t\t\t!filters.technicianIds.some((technicianId) =>\n\t\t\t\tjobHasTechnician(job, technicianId),\n\t\t\t)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Filter by status\n\t\tif (\n\t\t\tfilters.statuses &&\n\t\t\tfilters.statuses.length > 0 &&\n\t\t\t!filters.statuses.includes(job.status)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Filter by priority\n\t\tif (\n\t\t\tfilters.priorities &&\n\t\t\tfilters.priorities.length > 0 &&\n\t\t\t!filters.priorities.includes(job.priority)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Filter by search query\n\t\tif (filters.searchQuery && filters.searchQuery.trim() !== \"\") {\n\t\t\tconst query = filters.searchQuery.toLowerCase();\n\t\t\tconst matchesTitle = job.title.toLowerCase().includes(query);\n\t\t\tconst matchesCustomer = job.customer.name.toLowerCase().includes(query);\n\t\t\tconst matchesDescription = job.description?.toLowerCase().includes(query);\n\n\t\t\tif (!(matchesTitle || matchesCustomer || matchesDescription)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t});\n}\n\n// ============================================\n// SORTING\n// ============================================\n\nexport function sortJobsByStartTime(jobs: Job[]): Job[] {\n\treturn [...jobs].sort((a, b) => {\n\t\t// Ensure dates are Date objects\n\t\tconst aTime =\n\t\t\ta.startTime instanceof Date ? a.startTime : new Date(a.startTime);\n\t\tconst bTime =\n\t\t\tb.startTime instanceof Date ? b.startTime : new Date(b.startTime);\n\t\treturn aTime.getTime() - bTime.getTime();\n\t});\n}\n\nfunction sortTechniciansByName(technicians: Technician[]): Technician[] {\n\treturn [...technicians].sort((a, b) => a.name.localeCompare(b.name));\n}\n\n// ============================================\n// VALIDATION\n// ============================================\n\nfunction validateJobTimes(\n\tstartTime: Date,\n\tendTime: Date,\n): {\n\tvalid: boolean;\n\terror?: string;\n} {\n\tif (startTime >= endTime) {\n\t\treturn {\n\t\t\tvalid: false,\n\t\t\terror: \"End time must be after start time\",\n\t\t};\n\t}\n\n\tconst duration = calculateDuration(startTime, endTime);\n\tif (duration < 15) {\n\t\treturn {\n\t\t\tvalid: false,\n\t\t\terror: \"Job must be at least 15 minutes long\",\n\t\t};\n\t}\n\n\treturn { valid: true };\n}\n\nfunction validateJob(job: Partial<Job>): {\n\tvalid: boolean;\n\terrors: string[];\n} {\n\tconst errors: string[] = [];\n\n\tif (!job.title || job.title.trim() === \"\") {\n\t\terrors.push(\"Title is required\");\n\t}\n\n\tconst hasTechnician =\n\t\t!!job.technicianId ||\n\t\tjob.assignments?.some((assignment) => assignment.technicianId);\n\n\tif (!hasTechnician) {\n\t\terrors.push(\"Technician must be assigned\");\n\t}\n\n\tif (!job.startTime) {\n\t\terrors.push(\"Start time is required\");\n\t}\n\n\tif (!job.endTime) {\n\t\terrors.push(\"End time is required\");\n\t}\n\n\tif (job.startTime && job.endTime) {\n\t\tconst timeValidation = validateJobTimes(job.startTime, job.endTime);\n\t\tif (!timeValidation.valid) {\n\t\t\terrors.push(timeValidation.error!);\n\t\t}\n\t}\n\n\treturn {\n\t\tvalid: errors.length === 0,\n\t\terrors,\n\t};\n}\n\nfunction jobHasTechnician(job: Job, technicianId: string): boolean {\n\tif (job.technicianId === technicianId) {\n\t\treturn true;\n\t}\n\n\treturn job.assignments.some(\n\t\t(assignment) => assignment.technicianId === technicianId,\n\t);\n}\n","import { cache } from \"react\";\nimport { endOfDay, startOfDay } from \"@/lib/schedule-utils\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { getAnalyticsTrends, type AnalyticsTrendData } from \"@/lib/queries/analytics\";\n\nconst CENTS_IN_DOLLAR = 100;\n\ntype NullableString = string | null | undefined;\n\ntype MissionControlJob = {\n\tid: string;\n\tjobNumber: NullableString;\n\ttitle: NullableString;\n\tstatus: NullableString;\n\tpriority: NullableString;\n\tscheduledStart: NullableString;\n\tcustomerName: NullableString;\n\taddress: NullableString;\n\ttotalAmountCents: number;\n};\n\ntype MissionControlScheduleItem = {\n\tid: string;\n\ttitle: NullableString;\n\tstartTime: NullableString;\n\tendTime: NullableString;\n\tstatus: NullableString;\n\ttechnicianName: NullableString;\n\tcustomerName: NullableString;\n\taddress: NullableString;\n\tjobId: NullableString;\n};\n\ntype MissionControlCommunication = {\n\tid: string;\n\ttype: NullableString;\n\tdirection: NullableString;\n\tsubject: NullableString;\n\tcreatedAt: NullableString;\n\tstatus: NullableString;\n\tcustomerName: NullableString;\n};\n\ntype MissionControlInvoice = {\n\tid: string;\n\tinvoiceNumber: NullableString;\n\tstatus: NullableString;\n\ttotalAmountCents: number;\n\tbalanceAmountCents: number;\n\tdueDate: NullableString;\n\tcustomerName: NullableString;\n};\n\ntype MissionControlActivity = {\n\tid: string;\n\tentityType: NullableString;\n\taction: NullableString;\n\tcreatedAt: NullableString;\n\tactorName: NullableString;\n};\n\ntype MissionControlAlert = {\n\tid: string;\n\tlevel: \"critical\" | \"warning\" | \"info\";\n\ttitle: string;\n\tdescription?: string;\n};\n\ntype MissionControlMetrics = {\n\trevenueToday: number;\n\taverageTicket: number;\n\tjobsScheduledToday: number;\n\tjobsCompletedToday: number;\n\tjobsInProgress: number;\n\tunassignedJobs: number;\n\toutstandingInvoicesAmount: number;\n\toverdueInvoicesCount: number;\n\tcommunicationsToday: number;\n};\n\nexport type MissionControlData = {\n\tmetrics: MissionControlMetrics;\n\talerts: MissionControlAlert[];\n\toperations: {\n\t\tinProgress: MissionControlJob[];\n\t\tunassigned: MissionControlJob[];\n\t};\n\tschedule: MissionControlScheduleItem[];\n\tcommunications: MissionControlCommunication[];\n\tfinancial: {\n\t\topenInvoices: MissionControlInvoice[];\n\t};\n\tactivity: MissionControlActivity[];\n\tanalytics: AnalyticsTrendData;\n\tlastUpdated: string;\n};\n\nconst EMPTY_ANALYTICS: AnalyticsTrendData = {\n\trevenue: [],\n\tjobs: [],\n\tcommunications: [],\n};\n\nconst EMPTY_DATA: MissionControlData = {\n\tmetrics: {\n\t\trevenueToday: 0,\n\t\taverageTicket: 0,\n\t\tjobsScheduledToday: 0,\n\t\tjobsCompletedToday: 0,\n\t\tjobsInProgress: 0,\n\t\tunassignedJobs: 0,\n\t\toutstandingInvoicesAmount: 0,\n\t\toverdueInvoicesCount: 0,\n\t\tcommunicationsToday: 0,\n\t},\n\talerts: [],\n\toperations: {\n\t\tinProgress: [],\n\t\tunassigned: [],\n\t},\n\tschedule: [],\n\tcommunications: [],\n\tfinancial: {\n\t\topenInvoices: [],\n\t},\n\tactivity: [],\n\tanalytics: EMPTY_ANALYTICS,\n\tlastUpdated: new Date().toISOString(),\n};\n\nfunction formatCurrencyCents(value: number | null | undefined): number {\n\treturn typeof value === \"number\" ? value : 0;\n}\n\nfunction resolveName(\n\tprimary?: NullableString,\n\tfallbackFirst?: NullableString,\n\tfallbackLast?: NullableString,\n) {\n\tif (primary && primary.trim().length > 0) {\n\t\treturn primary;\n\t}\n\tconst combined = [fallbackFirst, fallbackLast]\n\t\t.filter((part) => part && part.trim().length > 0)\n\t\t.join(\" \");\n\n\treturn combined.length > 0 ? combined : undefined;\n}\n\n// Use React.cache() for request-level deduplication\n// This ensures multiple components calling getMissionControlData in the same request\n// only trigger one database query\nexport const getMissionControlData = cache(async (\n\tcompanyId?: string,\n): Promise<MissionControlData> => {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tif (!supabase) {\n\t\t\treturn EMPTY_DATA;\n\t\t}\n\n\t\tif (!companyId) {\n\t\t\treturn EMPTY_DATA;\n\t\t}\n\n\t\tconst activeCompanyId = companyId;\n\n\t\tconst now = new Date();\n\t\tconst dayStart = startOfDay(now).toISOString();\n\t\tconst dayEnd = endOfDay(now).toISOString();\n\n\t\tconst [\n\t\t\tjobsTodayResult,\n\t\t\tinProgressJobsResult,\n\t\t\tcompletedTodayResult,\n\t\t\tunassignedJobsResult,\n\t\t\tschedulesResult,\n\t\t\tcommunicationsResult,\n\t\t\tinvoicesResult,\n\t\t\tactivityResult,\n\t\t\tanalyticsResult,\n\t\t] = await Promise.all([\n\t\t\tsupabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\n\t\t\t\t\t`\n          id,\n          job_number,\n          title,\n          status,\n          priority,\n          scheduled_start,\n          total_amount,\n          customers:customers!customer_id(\n            display_name,\n            first_name,\n            last_name\n          ),\n          properties:properties!property_id(\n            address,\n            city,\n            state,\n            zip_code\n          )\n        `,\n\t\t\t\t)\n\t\t\t\t.eq(\"company_id\", activeCompanyId)\n\t\t\t\t.gte(\"scheduled_start\", dayStart)\n\t\t\t\t.lt(\"scheduled_start\", dayEnd)\n\t\t\t\t.is(\"deleted_at\", null)\n\t\t\t\t.order(\"scheduled_start\", { ascending: true })\n\t\t\t\t.limit(50),\n\t\t\tsupabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\n\t\t\t\t\t`\n          id,\n          job_number,\n          title,\n          status,\n          priority,\n          scheduled_start,\n          total_amount,\n          customers:customers!customer_id(\n            display_name,\n            first_name,\n            last_name\n          ),\n          properties:properties!property_id(\n            address,\n            city,\n            state,\n            zip_code\n          )\n        `,\n\t\t\t\t)\n\t\t\t\t.eq(\"company_id\", activeCompanyId)\n\t\t\t\t.in(\"status\", [\"in_progress\", \"en_route\", \"on_hold\"])\n\t\t\t\t.is(\"deleted_at\", null)\n\t\t\t\t.order(\"updated_at\", { ascending: false })\n\t\t\t\t.limit(15),\n\t\t\tsupabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\"id, total_amount, actual_end\")\n\t\t\t\t.eq(\"company_id\", activeCompanyId)\n\t\t\t\t.eq(\"status\", \"completed\")\n\t\t\t\t.gte(\"actual_end\", dayStart)\n\t\t\t\t.lt(\"actual_end\", dayEnd)\n\t\t\t\t.is(\"deleted_at\", null),\n\t\t\tsupabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\n\t\t\t\t\t`\n          id,\n          job_number,\n          title,\n          status,\n          priority,\n          scheduled_start,\n          total_amount,\n          customers:customers!customer_id(\n            display_name,\n            first_name,\n            last_name\n          ),\n          properties:properties!property_id(\n            address,\n            city,\n            state,\n            zip_code\n          )\n        `,\n\t\t\t\t)\n\t\t\t\t.eq(\"company_id\", activeCompanyId)\n\t\t\t\t.in(\"status\", [\"scheduled\", \"dispatch_required\", \"pending\"])\n\t\t\t\t.is(\"assigned_to\", null)\n\t\t\t\t.is(\"deleted_at\", null)\n\t\t\t\t.order(\"scheduled_start\", { ascending: true })\n\t\t\t\t.limit(15),\n\t\t\tsupabase\n\t\t\t\t.from(\"appointments\")\n\t\t\t\t.select(\n\t\t\t\t\t`\n          id,\n          title,\n          start_time,\n          end_time,\n          status,\n          assigned_user:users!assigned_to(\n            id,\n            first_name,\n            last_name\n          ),\n          customers:customers!customer_id(\n            display_name,\n            first_name,\n            last_name\n          ),\n          properties:properties!property_id(\n            address,\n            city,\n            state,\n            zip_code\n          ),\n          job:jobs!job_id(\n            id,\n            job_number,\n            status\n          )\n        `,\n\t\t\t\t)\n\t\t\t\t.eq(\"company_id\", activeCompanyId)\n\t\t\t\t.gte(\"start_time\", dayStart)\n\t\t\t\t.lt(\"start_time\", dayEnd)\n\t\t\t\t.is(\"deleted_at\", null)\n\t\t\t\t.order(\"start_time\", { ascending: true })\n\t\t\t\t.limit(12),\n\t\t\tsupabase\n\t\t\t\t.from(\"communications\")\n\t\t\t\t.select(\n\t\t\t\t\t`\n          id,\n          type,\n          direction,\n          subject,\n          status,\n          created_at,\n          customers:customers!customer_id(\n            display_name,\n            first_name,\n            last_name\n          )\n        `,\n\t\t\t\t)\n\t\t\t\t.eq(\"company_id\", activeCompanyId)\n\t\t\t\t.gte(\"created_at\", dayStart)\n\t\t\t\t.lt(\"created_at\", dayEnd)\n\t\t\t\t.is(\"deleted_at\", null)\n\t\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t\t.limit(20),\n\t\t\tsupabase\n\t\t\t\t.from(\"invoices\")\n\t\t\t\t.select(\n\t\t\t\t\t`\n          id,\n          invoice_number,\n          status,\n          total_amount,\n          balance_amount,\n          due_date,\n          customers:customers!customer_id(\n            display_name,\n            first_name,\n            last_name\n          )\n        `,\n\t\t\t\t)\n\t\t\t\t.eq(\"company_id\", activeCompanyId)\n\t\t\t\t.in(\"status\", [\"sent\", \"partial\", \"unpaid\", \"overdue\"])\n\t\t\t\t.is(\"deleted_at\", null)\n\t\t\t\t.order(\"due_date\", { ascending: true })\n\t\t\t\t.limit(20),\n\t\t\tsupabase\n\t\t\t\t.from(\"activity_log\")\n\t\t\t\t.select(\n\t\t\t\t\t`\n          id,\n          entity_type,\n          action,\n          category,\n          created_at,\n          actor_name\n        `,\n\t\t\t\t)\n\t\t\t\t.eq(\"company_id\", activeCompanyId)\n\t\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t\t.limit(25),\n\t\t\t// Fetch analytics in parallel (eliminates waterfall)\n\t\t\tgetAnalyticsTrends(activeCompanyId, 90).catch(() => EMPTY_ANALYTICS),\n\t\t]);\n\n\t\tconst jobsToday = jobsTodayResult.data ?? [];\n\t\tconst inProgressJobs = inProgressJobsResult.data ?? [];\n\t\tconst completedToday = completedTodayResult.data ?? [];\n\t\tconst unassignedJobs = unassignedJobsResult.data ?? [];\n\t\tconst schedules = schedulesResult.data ?? [];\n\t\tconst communications = communicationsResult.data ?? [];\n\t\tconst invoices = invoicesResult.data ?? [];\n\t\tconst activities = activityResult.data ?? [];\n\n\t\tconst revenueTodayCents = completedToday.reduce(\n\t\t\t(sum, job) => sum + formatCurrencyCents(job.financial?.total_amount ?? 0),\n\t\t\t0,\n\t\t);\n\n\t\tconst averageTicketCents =\n\t\t\tcompletedToday.length > 0 ? revenueTodayCents / completedToday.length : 0;\n\n\t\tconst outstandingBalanceCents = invoices.reduce(\n\t\t\t(sum, invoice) => sum + formatCurrencyCents(invoice.balance_amount),\n\t\t\t0,\n\t\t);\n\n\t\tconst overdueInvoicesCount = invoices.filter((invoice) => {\n\t\t\tif (!invoice.due_date) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn (\n\t\t\t\tinvoice.status === \"overdue\" ||\n\t\t\t\tnew Date(invoice.due_date).getTime() < now.getTime()\n\t\t\t);\n\t\t}).length;\n\n\t\tconst metrics: MissionControlMetrics = {\n\t\t\trevenueToday: revenueTodayCents / CENTS_IN_DOLLAR,\n\t\t\taverageTicket: averageTicketCents / CENTS_IN_DOLLAR,\n\t\t\tjobsScheduledToday: jobsToday.length,\n\t\t\tjobsCompletedToday: completedToday.length,\n\t\t\tjobsInProgress: inProgressJobs.length,\n\t\t\tunassignedJobs: unassignedJobs.length,\n\t\t\toutstandingInvoicesAmount: outstandingBalanceCents / CENTS_IN_DOLLAR,\n\t\t\toverdueInvoicesCount,\n\t\t\tcommunicationsToday: communications.length,\n\t\t};\n\n\t\tconst alerts: MissionControlAlert[] = [];\n\n\t\tif (metrics.unassignedJobs > 0) {\n\t\t\talerts.push({\n\t\t\t\tid: \"unassigned-jobs\",\n\t\t\t\tlevel: metrics.unassignedJobs > 5 ? \"critical\" : \"warning\",\n\t\t\t\ttitle: `${metrics.unassignedJobs} job${metrics.unassignedJobs === 1 ? \"\" : \"s\"} awaiting assignment`,\n\t\t\t\tdescription:\n\t\t\t\t\t\"Assign technicians to keep response times within SLA targets.\",\n\t\t\t});\n\t\t}\n\n\t\tif (metrics.overdueInvoicesCount > 0) {\n\t\t\talerts.push({\n\t\t\t\tid: \"overdue-invoices\",\n\t\t\t\tlevel: \"warning\",\n\t\t\t\ttitle: `${metrics.overdueInvoicesCount} overdue invoice${metrics.overdueInvoicesCount === 1 ? \"\" : \"s\"}`,\n\t\t\t\tdescription: \"Follow up with customers to accelerate collections.\",\n\t\t\t});\n\t\t}\n\n\t\tif (metrics.revenueToday === 0) {\n\t\t\talerts.push({\n\t\t\t\tid: \"revenue-zero\",\n\t\t\t\tlevel: \"info\",\n\t\t\t\ttitle: \"No completed revenue recorded yet today\",\n\t\t\t\tdescription: \"Keep an eye on active jobs to ensure timely completion.\",\n\t\t\t});\n\t\t}\n\n\t\tconst mapJob = (job: any): MissionControlJob => ({\n\t\t\tid: job.id,\n\t\t\tjobNumber: job.job_number,\n\t\t\ttitle: job.title,\n\t\t\tstatus: job.status,\n\t\t\tpriority: job.priority,\n\t\t\tscheduledStart: job.scheduled_start,\n\t\t\tcustomerName: resolveName(\n\t\t\t\tjob.customers?.display_name,\n\t\t\t\tjob.customers?.first_name,\n\t\t\t\tjob.customers?.last_name,\n\t\t\t),\n\t\t\taddress:\n\t\t\t\tjob.properties &&\n\t\t\t\t[\n\t\t\t\t\tjob.properties.address,\n\t\t\t\t\tjob.properties.city,\n\t\t\t\t\tjob.properties.state,\n\t\t\t\t\tjob.properties.zip_code,\n\t\t\t\t]\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.join(\", \"),\n\t\t\ttotalAmountCents: formatCurrencyCents(job.financial?.total_amount ?? 0),\n\t\t});\n\n\t\tconst operations = {\n\t\t\tinProgress: inProgressJobs.slice(0, 6).map(mapJob),\n\t\t\tunassigned: unassignedJobs.slice(0, 6).map(mapJob),\n\t\t};\n\n\t\tconst scheduleItems: MissionControlScheduleItem[] = schedules\n\t\t\t.map((entry: any) => ({\n\t\t\t\tid: entry.id,\n\t\t\t\ttitle: entry.title || entry.job?.job_number || \"Service Visit\",\n\t\t\t\tstartTime: entry.start_time,\n\t\t\t\tendTime: entry.end_time,\n\t\t\t\tstatus: entry.status,\n\t\t\t\ttechnicianName: resolveName(\n\t\t\t\t\tundefined,\n\t\t\t\t\tentry.assigned_user?.first_name,\n\t\t\t\t\tentry.assigned_user?.last_name,\n\t\t\t\t),\n\t\t\t\tcustomerName: resolveName(\n\t\t\t\t\tentry.customers?.display_name,\n\t\t\t\t\tentry.customers?.first_name,\n\t\t\t\t\tentry.customers?.last_name,\n\t\t\t\t),\n\t\t\t\taddress:\n\t\t\t\t\tentry.properties &&\n\t\t\t\t\t[\n\t\t\t\t\t\tentry.properties.address,\n\t\t\t\t\t\tentry.properties.city,\n\t\t\t\t\t\tentry.properties.state,\n\t\t\t\t\t\tentry.properties.zip_code,\n\t\t\t\t\t]\n\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t.join(\", \"),\n\t\t\t\tjobId: entry.job?.id ?? null,\n\t\t\t}))\n\t\t\t.slice(0, 8);\n\n\t\tconst communicationItems: MissionControlCommunication[] =\n\t\t\tcommunications.map((item: any) => ({\n\t\t\t\tid: item.id,\n\t\t\t\ttype: item.type,\n\t\t\t\tdirection: item.direction,\n\t\t\t\tsubject: item.subject,\n\t\t\t\tstatus: item.status,\n\t\t\t\tcreatedAt: item.created_at,\n\t\t\t\tcustomerName: resolveName(\n\t\t\t\t\titem.customers?.display_name,\n\t\t\t\t\titem.customers?.first_name,\n\t\t\t\t\titem.customers?.last_name,\n\t\t\t\t),\n\t\t\t}));\n\n\t\tconst invoiceItems: MissionControlInvoice[] = invoices.map(\n\t\t\t(invoice: any) => ({\n\t\t\t\tid: invoice.id,\n\t\t\t\tinvoiceNumber: invoice.invoice_number,\n\t\t\t\tstatus: invoice.status,\n\t\t\t\ttotalAmountCents: formatCurrencyCents(invoice.total_amount),\n\t\t\t\tbalanceAmountCents: formatCurrencyCents(invoice.balance_amount),\n\t\t\t\tdueDate: invoice.due_date,\n\t\t\t\tcustomerName: resolveName(\n\t\t\t\t\tinvoice.customers?.display_name,\n\t\t\t\t\tinvoice.customers?.first_name,\n\t\t\t\t\tinvoice.customers?.last_name,\n\t\t\t\t),\n\t\t\t}),\n\t\t);\n\n\t\tconst activityItems: MissionControlActivity[] = activities.map(\n\t\t\t(entry: any) => ({\n\t\t\t\tid: entry.id,\n\t\t\t\tentityType: entry.entity_type,\n\t\t\t\taction: entry.action,\n\t\t\t\tcreatedAt: entry.created_at,\n\t\t\t\tactorName: entry.actor_name,\n\t\t\t}),\n\t\t);\n\n\t\tconst data: MissionControlData = {\n\t\t\tmetrics,\n\t\t\talerts,\n\t\t\toperations,\n\t\t\tschedule: scheduleItems,\n\t\t\tcommunications: communicationItems,\n\t\t\tfinancial: {\n\t\t\t\topenInvoices: invoiceItems,\n\t\t\t},\n\t\t\tactivity: activityItems,\n\t\t\tanalytics: analyticsResult,\n\t\t\tlastUpdated: now.toISOString(),\n\t\t};\n\n\t\treturn data;\n\t} catch {\n\t\treturn EMPTY_DATA;\n\t}\n});\n","import type { ReactNode } from \"react\";\n\ntype DashboardShellProps = {\n\tchildren: ReactNode;\n};\n\n/**\n * Dashboard Shell - Static Server Component\n *\n * Renders instantly (5-20ms) and is cached at the edge.\n * Contains only static layout elements - no data fetching.\n *\n * Uses max-w-7xl to match detail pages and provide a centered,\n * readable layout for the dashboard content.\n */\nexport function DashboardShell({ children }: DashboardShellProps) {\n\treturn (\n\t\t<div className=\"mx-auto flex min-h-full w-full max-w-7xl flex-col gap-4 md:gap-6 p-4 md:p-6 pb-16\">\n\t\t\t{/* Dynamic content slots */}\n\t\t\t{children}\n\t\t</div>\n\t);\n}\n","/**\n * Dashboard Skeleton - Loading State\n *\n * Matches the exact layout of the dashboard to prevent layout shifts.\n * Displays while dashboard content is loading.\n */\nexport function DashboardSkeleton() {\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t{/* Stats skeleton - 4 cards */}\n\t\t\t<div className=\"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4\">\n\t\t\t\t{[...new Array(4)].map((_, i) => (\n\t\t\t\t\t<div className=\"bg-card animate-pulse rounded-lg border p-6\" key={i}>\n\t\t\t\t\t\t<div className=\"bg-muted h-4 w-24 rounded\" />\n\t\t\t\t\t\t<div className=\"bg-muted mt-2 h-8 w-32 rounded\" />\n\t\t\t\t\t\t<div className=\"bg-muted mt-2 h-3 w-20 rounded\" />\n\t\t\t\t\t</div>\n\t\t\t\t))}\n\t\t\t</div>\n\n\t\t\t{/* Content skeleton - 2 columns */}\n\t\t\t<div className=\"grid grid-cols-1 gap-6 lg:grid-cols-2\">\n\t\t\t\t{/* Left column */}\n\t\t\t\t<div className=\"space-y-6\">\n\t\t\t\t\t{/* Operations card */}\n\t\t\t\t\t<div className=\"bg-card animate-pulse rounded-lg border p-6\">\n\t\t\t\t\t\t<div className=\"bg-muted h-6 w-32 rounded\" />\n\t\t\t\t\t\t<div className=\"mt-4 space-y-3\">\n\t\t\t\t\t\t\t{[...new Array(5)].map((_, i) => (\n\t\t\t\t\t\t\t\t<div className=\"bg-muted h-16 rounded\" key={i} />\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Schedule card */}\n\t\t\t\t\t<div className=\"bg-card animate-pulse rounded-lg border p-6\">\n\t\t\t\t\t\t<div className=\"bg-muted h-6 w-32 rounded\" />\n\t\t\t\t\t\t<div className=\"mt-4 space-y-3\">\n\t\t\t\t\t\t\t{[...new Array(4)].map((_, i) => (\n\t\t\t\t\t\t\t\t<div className=\"bg-muted h-16 rounded\" key={i} />\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Right column */}\n\t\t\t\t<div className=\"space-y-6\">\n\t\t\t\t\t{/* Communications card */}\n\t\t\t\t\t<div className=\"bg-card animate-pulse rounded-lg border p-6\">\n\t\t\t\t\t\t<div className=\"bg-muted h-6 w-32 rounded\" />\n\t\t\t\t\t\t<div className=\"mt-4 space-y-3\">\n\t\t\t\t\t\t\t{[...new Array(5)].map((_, i) => (\n\t\t\t\t\t\t\t\t<div className=\"bg-muted h-16 rounded\" key={i} />\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Financial card */}\n\t\t\t\t\t<div className=\"bg-card animate-pulse rounded-lg border p-6\">\n\t\t\t\t\t\t<div className=\"bg-muted h-6 w-32 rounded\" />\n\t\t\t\t\t\t<div className=\"mt-4 space-y-3\">\n\t\t\t\t\t\t\t{[...new Array(4)].map((_, i) => (\n\t\t\t\t\t\t\t\t<div className=\"bg-muted h-16 rounded\" key={i} />\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n"],"names":[],"mappings":"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","ignoreList":[0,1,2,3,4,5]}