module.exports=[793648,a=>{"use strict";var b=a.i(861467),c=a.i(337241),d=a.i(783281),e=a.i(452168),f=a.i(556253),g=a.i(587969),h=a.i(988253),i=a.i(527936),j=a.i(187056),k=a.i(319895),l=a.i(789815),m=a.i(128952),n=a.i(383413),o=a.i(898062),p=a.i(530762),q=a.i(757844),r=a.i(102420),s=a.i(781399),s=s,t=a.i(776824),u=a.i(863896),v=a.i(934308);a.i(288007);var w=a.i(986990);a.i(445255);var x=a.i(18170);a.i(19256);var y=a.i(417132);a.i(956852);var z=a.i(90125);a.i(928414);var A=a.i(745250),B=a.i(251048),C=a.i(112135),D=a.i(721659),E=a.i(638727),F=a.i(414379),G=a.i(156916),H=a.i(169021),I=(0,H.createServerReference)("6092a86a8f4d8e43fd3ca6d88d91e39f4114ccef7c",H.callServer,void 0,H.findSourceMapURL,"updateCustomerTags"),J=(0,H.createServerReference)("6056db4426045b4bf2dc38f10eea7d68780b38ba19",H.callServer,void 0,H.findSourceMapURL,"updateJobTags");a.i(839984);var K=a.i(372712);a.i(458393);var L=a.i(82012);a.i(146697);var M=a.i(778737),N=a.i(300298);let O={red:"bg-red-100 text-red-700 border-red-200 dark:bg-red-900/20 dark:text-red-400 dark:border-red-900/30",orange:"bg-orange-100 text-orange-700 border-orange-200 dark:bg-orange-900/20 dark:text-orange-400 dark:border-orange-900/30",amber:"bg-amber-100 text-amber-700 border-amber-200 dark:bg-amber-900/20 dark:text-amber-400 dark:border-amber-900/30",yellow:"bg-yellow-100 text-yellow-700 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-400 dark:border-yellow-900/30",green:"bg-green-100 text-green-700 border-green-200 dark:bg-green-900/20 dark:text-green-400 dark:border-green-900/30",emerald:"bg-emerald-100 text-emerald-700 border-emerald-200 dark:bg-emerald-900/20 dark:text-emerald-400 dark:border-emerald-900/30",teal:"bg-teal-100 text-teal-700 border-teal-200 dark:bg-teal-900/20 dark:text-teal-400 dark:border-teal-900/30",blue:"bg-blue-100 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-900/30",indigo:"bg-indigo-100 text-indigo-700 border-indigo-200 dark:bg-indigo-900/20 dark:text-indigo-400 dark:border-indigo-900/30",purple:"bg-purple-100 text-purple-700 border-purple-200 dark:bg-purple-900/20 dark:text-purple-400 dark:border-purple-900/30",pink:"bg-pink-100 text-pink-700 border-pink-200 dark:bg-pink-900/20 dark:text-pink-400 dark:border-pink-900/30",gray:"bg-gray-100 text-gray-700 border-gray-200 dark:bg-gray-900/20 dark:text-gray-400 dark:border-gray-900/30"};function P({tag:a,type:c,onRemove:d,showRemove:e=!1}){let f="string"==typeof a?a:a.label,g="string"==typeof a?void 0:a.color,h=g&&O[g]?O[g]:"customer"===c?O.blue:O.purple;return(0,b.jsxs)("div",{className:`inline-flex items-center gap-1.5 rounded-full border px-3 py-1.5 text-sm font-medium transition-colors ${h}`,children:[(0,b.jsx)(F.Tag,{className:"size-3"}),(0,b.jsx)("span",{children:f}),e&&d&&(0,b.jsx)(x.Button,{className:"size-4 p-0 hover:bg-transparent",onClick:a=>{a.stopPropagation(),d()},size:"icon",variant:"ghost",children:(0,b.jsx)(N.X,{className:"size-3"})})]})}let Q=["DNS - Do Not Service","Family Friend","10% Discount","VIP Customer","Payment Plan","Requires Appointment"],R=["Warranty Work","Follow-up Required","Emergency","Inspection Needed","Parts on Order","Callback Scheduled"];function S({open:a,onOpenChange:c,customerId:e,jobId:f,customerTags:g=[],jobTags:h=[],onUpdate:i}){let[j,k]=(0,d.useState)(g),[l,m]=(0,d.useState)(h),[n,o]=(0,d.useState)(""),[p,q]=(0,d.useState)(""),[r,s]=(0,d.useState)(!1),t=a=>{a&&!j.includes(a)&&k([...j,a]),o("")},u=a=>{a&&!l.includes(a)&&m([...l,a]),q("")},v=async()=>{s(!0);try{let a=[];e&&JSON.stringify(j)!==JSON.stringify(g)&&a.push(I(e,j)),f&&JSON.stringify(l)!==JSON.stringify(h)&&a.push(J(f,l));let b=await Promise.all(a);if(b.every(a=>a.success))G.toast.success("Tags updated successfully"),i?.(),c(!1);else{let a=b.find(a=>!a.success)?.error;G.toast.error(a||"Failed to update tags")}}catch(a){G.toast.error("Failed to update tags")}finally{s(!1)}};return(0,b.jsx)(y.Dialog,{onOpenChange:c,open:a,children:(0,b.jsxs)(y.DialogContent,{className:"max-h-[90vh] max-w-2xl overflow-y-auto",children:[(0,b.jsxs)(y.DialogHeader,{children:[(0,b.jsx)(y.DialogTitle,{children:"Manage Tags"}),(0,b.jsx)(y.DialogDescription,{children:"Add tags to organize and categorize this customer and job"})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[e&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(F.Tag,{className:"size-4 text-blue-600"}),(0,b.jsx)("h3",{className:"text-sm font-semibold",children:"Customer Tags"}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Apply to all jobs for this customer)"})]}),j.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:j.map(a=>(0,b.jsx)(P,{onRemove:()=>{k(j.filter(b=>b!==a))},showRemove:!0,tag:a,type:"customer"},a))}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(L.Label,{className:"text-xs",children:"Quick Add"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:Q.filter(a=>!j.includes(a)).map(a=>(0,b.jsxs)(x.Button,{className:"h-7 gap-1 text-xs",onClick:()=>t(a),size:"sm",variant:"outline",children:[(0,b.jsx)(E.Plus,{className:"size-3"}),a]},a))})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(K.Input,{onChange:a=>o(a.target.value),onKeyDown:a=>{"Enter"===a.key&&t(n)},placeholder:"Add custom customer tag...",value:n}),(0,b.jsx)(x.Button,{onClick:()=>t(n),size:"sm",variant:"outline",children:(0,b.jsx)(E.Plus,{className:"size-4"})})]})]}),e&&f&&(0,b.jsx)(M.Separator,{}),f&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(F.Tag,{className:"size-4 text-purple-600"}),(0,b.jsx)("h3",{className:"text-sm font-semibold",children:"Job Tags"}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Apply to this job only)"})]}),l.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:l.map(a=>(0,b.jsx)(P,{onRemove:()=>{m(l.filter(b=>b!==a))},showRemove:!0,tag:a,type:"job"},a))}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(L.Label,{className:"text-xs",children:"Quick Add"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:R.filter(a=>!l.includes(a)).map(a=>(0,b.jsxs)(x.Button,{className:"h-7 gap-1 text-xs",onClick:()=>u(a),size:"sm",variant:"outline",children:[(0,b.jsx)(E.Plus,{className:"size-3"}),a]},a))})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(K.Input,{onChange:a=>q(a.target.value),onKeyDown:a=>{"Enter"===a.key&&u(p)},placeholder:"Add custom job tag...",value:p}),(0,b.jsx)(x.Button,{onClick:()=>u(p),size:"sm",variant:"outline",children:(0,b.jsx)(E.Plus,{className:"size-4"})})]})]})]}),(0,b.jsxs)(y.DialogFooter,{children:[(0,b.jsx)(x.Button,{onClick:()=>c(!1),variant:"outline",children:"Cancel"}),(0,b.jsx)(x.Button,{disabled:r,onClick:v,children:r?"Saving...":"Save Changes"})]})]})})}function T({job:a,customer:E,metrics:F,timeEntries:G=[],teamAssignments:H=[],invoices:I=[],payments:J=[],jobMaterials:K=[]}){let L=(0,c.usePathname)(),M=(0,c.useRouter)(),{toast:N}=(0,B.useToast)(),O=(0,C.useDialerStore)(a=>a.openDialer),P=L?.split("/").pop(),[Q,R]=(0,d.useState)(!1),[T,U]=(0,d.useState)(!1),[V,W]=(0,d.useState)(!1),[X,Y]=(0,d.useState)(!1),Z=E?.tags||[],$=a?.metadata?.tags||a?.custom_fields?.tags||[],_=Z.length+$.length,aa=async()=>{if(!P)return void N.error("Job ID not found");U(!0);try{let a=await (0,t.archiveJob)(P);a.success?(N.success("Job archived successfully"),R(!1),M.push("/dashboard/work")):N.error(a.error||"Failed to archive job")}catch(a){N.error("Failed to archive job")}finally{U(!1)}},ab=async(a,b)=>{try{let c=await (0,u.updateJobStatus)(a,b);return{success:c.success,error:c.error}}catch(a){return console.error("Job status update error:",a),{success:!1,error:a instanceof Error?a.message:"Failed to update status"}}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[a?.status&&P&&(0,b.jsx)(v.StatusUpdateDropdown,{currentStatus:a.status,entityId:P,entityType:"job",onStatusChange:ab,size:"sm"}),(0,b.jsxs)(A.TooltipProvider,{children:[(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(x.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,b.jsxs)("a",{href:`/dashboard/work/appointments/new?jobId=${P}`,children:[(0,b.jsx)(g.Calendar,{}),(0,b.jsx)("span",{className:"hidden md:inline",children:"Schedule"})]})})}),(0,b.jsx)(A.TooltipContent,{children:(0,b.jsx)("p",{children:"Schedule appointment"})})]}),(0,b.jsxs)(z.DropdownMenu,{children:[(0,b.jsx)(z.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(x.Button,{size:"sm",variant:"outline",children:[(0,b.jsx)(o.Phone,{}),(0,b.jsx)("span",{className:"hidden md:inline",children:"Contact"})]})}),(0,b.jsxs)(z.DropdownMenuContent,{align:"start",children:[(0,b.jsx)(z.DropdownMenuLabel,{children:"Contact Customer"}),(0,b.jsx)(z.DropdownMenuSeparator,{}),(0,b.jsxs)(z.DropdownMenuItem,{disabled:!E?.phone,onClick:()=>{if(E?.phone)O(E.phone,E.id,E?.display_name||`${E?.first_name||""} ${E?.last_name||""}`.trim());else N.error("No phone number available")},children:[(0,b.jsx)(o.Phone,{className:"mr-2 size-3.5"}),E?.phone?`Call ${E.phone}`:"No phone number"]}),(0,b.jsxs)(z.DropdownMenuItem,{disabled:!E?.phone,onClick:()=>{E?.phone?M.push(`/dashboard/communication/messages?phone=${E.phone}&customerId=${E.id}`):N.error("No phone number available")},children:[(0,b.jsx)(m.MessageSquare,{className:"mr-2 size-3.5"}),E?.phone?"Send text message":"No phone number"]}),(0,b.jsxs)(z.DropdownMenuItem,{disabled:!E?.email,onClick:()=>{E?.email?M.push(`/dashboard/communication?email=${E.email}&customerId=${E.id}`):N.error("No email address available")},children:[(0,b.jsx)(l.Mail,{className:"mr-2 size-3.5"}),E?.email?`Email ${E.email}`:"No email address"]})]})]}),(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(x.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,b.jsxs)("a",{href:`/dashboard/work/payments/new?jobId=${P}`,children:[(0,b.jsx)(i.CreditCard,{}),(0,b.jsx)("span",{className:"hidden md:inline",children:"Payment"})]})})}),(0,b.jsx)(A.TooltipContent,{children:(0,b.jsx)("p",{children:"Collect payment"})})]}),(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(x.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,b.jsxs)("a",{href:`/dashboard/work/invoices/new?jobId=${P}`,children:[(0,b.jsx)(q.Receipt,{}),(0,b.jsx)("span",{className:"hidden md:inline",children:"Invoice"})]})})}),(0,b.jsx)(A.TooltipContent,{children:(0,b.jsx)("p",{children:"Create invoice"})})]}),(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(x.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,b.jsxs)("a",{href:`/dashboard/work/estimates/new?jobId=${P}`,children:[(0,b.jsx)(k.FileText,{}),(0,b.jsx)("span",{className:"hidden md:inline",children:"Estimate"})]})})}),(0,b.jsx)(A.TooltipContent,{children:(0,b.jsx)("p",{children:"Create estimate"})})]})]}),(0,b.jsxs)(z.DropdownMenu,{children:[(0,b.jsx)(z.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(x.Button,{size:"sm",variant:"outline",children:[(0,b.jsx)(n.MoreVertical,{}),(0,b.jsx)("span",{className:"hidden md:inline",children:"Actions"})]})}),(0,b.jsxs)(z.DropdownMenuContent,{align:"end",className:"w-56",children:[a&&F&&(0,b.jsxs)(z.DropdownMenuItem,{onClick:()=>W(!0),children:[(0,b.jsx)(f.BarChart3,{className:"mr-2 size-3.5"}),"View Statistics"]}),(0,b.jsxs)(z.DropdownMenuItem,{onClick:()=>Y(!0),children:[(0,b.jsx)(s.default,{className:"mr-2 size-3.5"}),"Manage Tags",_>0&&(0,b.jsx)(w.Badge,{className:"ml-auto h-5 px-1.5",variant:"secondary",children:_})]}),(0,b.jsx)(z.DropdownMenuSeparator,{}),(0,b.jsxs)(z.DropdownMenuItem,{onClick:()=>M.push(`/dashboard/work/new?cloneFrom=${P}`),children:[(0,b.jsx)(h.Copy,{className:"mr-2 size-3.5"}),"Clone Job"]}),(0,b.jsxs)(z.DropdownMenuItem,{onClick:()=>{let b=new Blob([[["Field","Value"],["Job Number",a?.job_number||""],["Title",a?.title||""],["Status",a?.status||""],["Customer",E?.display_name||""],["Phone",E?.phone||""],["Email",E?.email||""],["Created",a?.created_at?new Date(a.created_at).toLocaleDateString():""],["Total Revenue",F?.totalRevenue?`$${F.totalRevenue.toFixed(2)}`:"$0.00"]].map(a=>a.map(a=>`"${a}"`).join(",")).join("\n")],{type:"text/csv"}),c=window.URL.createObjectURL(b),d=document.createElement("a");d.href=c,d.download=`job-${a?.job_number||P}.csv`,d.click(),window.URL.revokeObjectURL(c),N.success("Job exported to CSV")},children:[(0,b.jsx)(j.Download,{className:"mr-2 size-3.5"}),"Export to CSV"]}),(0,b.jsxs)(z.DropdownMenuItem,{onClick:()=>{window.print(),N.success("Opening print dialog...")},children:[(0,b.jsx)(p.Printer,{className:"mr-2 size-3.5"}),"Print Details"]}),(0,b.jsxs)(z.DropdownMenuItem,{onClick:()=>{navigator.clipboard.writeText(window.location.href),N.success("Job link copied to clipboard")},children:[(0,b.jsx)(r.Share2,{className:"mr-2 size-3.5"}),"Share Link"]}),(0,b.jsx)(z.DropdownMenuSeparator,{}),(0,b.jsxs)(z.DropdownMenuItem,{className:"text-destructive",onClick:()=>R(!0),children:[(0,b.jsx)(e.Archive,{className:"mr-2 size-3.5"}),"Archive Job"]})]})]})]}),(0,b.jsx)(y.Dialog,{onOpenChange:R,open:Q,children:(0,b.jsxs)(y.DialogContent,{children:[(0,b.jsxs)(y.DialogHeader,{children:[(0,b.jsx)(y.DialogTitle,{children:"Archive Job"}),(0,b.jsx)(y.DialogDescription,{children:"Are you sure you want to archive this job? Archived jobs can be restored within 90 days. Completed or invoiced jobs cannot be archived."})]}),(0,b.jsxs)(y.DialogFooter,{children:[(0,b.jsx)(x.Button,{disabled:T,onClick:()=>R(!1),variant:"outline",children:"Cancel"}),(0,b.jsx)(x.Button,{disabled:T,onClick:aa,variant:"destructive",children:T?"Archiving...":"Archive Job"})]})]})}),a&&F&&(0,b.jsx)(D.JobStatisticsSheet,{invoices:I,job:a,jobMaterials:K,metrics:F,onOpenChange:W,open:V,payments:J,teamAssignments:H,timeEntries:G}),(0,b.jsx)(S,{customerId:E?.id,customerTags:Z,jobId:a?.id,jobTags:$,onOpenChange:Y,onUpdate:()=>{},open:X})]})}function U(){let a=(0,c.useParams)(),e=a?.id,[f,g]=(0,d.useState)(null);return(0,d.useEffect)(()=>{async function a(){try{let a=await fetch(`/api/jobs/${e}/toolbar-data`);if(a.ok){let b=await a.json();g(b)}}catch(a){}}e&&a()},[e]),(0,b.jsx)(T,{customer:f?.customer,invoices:f?.invoices||[],job:f?.job,jobMaterials:f?.jobMaterials||[],metrics:f?.metrics,payments:f?.payments||[],teamAssignments:f?.teamAssignments||[],timeEntries:f?.timeEntries||[]})}a.s(["JobDetailToolbarWrapper",()=>U],793648)}];

//# sourceMappingURL=apps_web_src_components_work_job-details_job-detail-toolbar-wrapper_tsx_f9b77a1c._.js.map