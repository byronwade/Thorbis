module.exports=[793648,a=>{"use strict";var b=a.i(861467),c=a.i(337241),d=a.i(783281),e=a.i(452168),f=a.i(556253),g=a.i(587969),h=a.i(988253),i=a.i(527936),j=a.i(187056),k=a.i(319895),l=a.i(789815),m=a.i(128952),n=a.i(383413),o=a.i(898062),p=a.i(530762),q=a.i(757844),r=a.i(102420),s=a.i(781399),s=s,t=a.i(860600);a.i(288007);var u=a.i(986990);a.i(445255);var v=a.i(18170);a.i(19256);var w=a.i(417132);a.i(956852);var x=a.i(90125);a.i(928414);var y=a.i(745250),z=a.i(251048),A=a.i(112135),B=a.i(721659),C=a.i(638727),D=a.i(414379),E=a.i(156916),F=a.i(169021),G=(0,F.createServerReference)("60f17c4aa6f5422ed664af74d27030f3031342ae78",F.callServer,void 0,F.findSourceMapURL,"updateCustomerTags"),H=(0,F.createServerReference)("60898a74b1f50c91ad212b879e4dd1f41f996ca0d1",F.callServer,void 0,F.findSourceMapURL,"updateJobTags");a.i(839984);var I=a.i(372712);a.i(458393);var J=a.i(82012);a.i(146697);var K=a.i(778737),L=a.i(300298);let M={red:"bg-red-100 text-red-700 border-red-200 dark:bg-red-900/20 dark:text-red-400 dark:border-red-900/30",orange:"bg-orange-100 text-orange-700 border-orange-200 dark:bg-orange-900/20 dark:text-orange-400 dark:border-orange-900/30",amber:"bg-amber-100 text-amber-700 border-amber-200 dark:bg-amber-900/20 dark:text-amber-400 dark:border-amber-900/30",yellow:"bg-yellow-100 text-yellow-700 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-400 dark:border-yellow-900/30",green:"bg-green-100 text-green-700 border-green-200 dark:bg-green-900/20 dark:text-green-400 dark:border-green-900/30",emerald:"bg-emerald-100 text-emerald-700 border-emerald-200 dark:bg-emerald-900/20 dark:text-emerald-400 dark:border-emerald-900/30",teal:"bg-teal-100 text-teal-700 border-teal-200 dark:bg-teal-900/20 dark:text-teal-400 dark:border-teal-900/30",blue:"bg-blue-100 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-900/30",indigo:"bg-indigo-100 text-indigo-700 border-indigo-200 dark:bg-indigo-900/20 dark:text-indigo-400 dark:border-indigo-900/30",purple:"bg-purple-100 text-purple-700 border-purple-200 dark:bg-purple-900/20 dark:text-purple-400 dark:border-purple-900/30",pink:"bg-pink-100 text-pink-700 border-pink-200 dark:bg-pink-900/20 dark:text-pink-400 dark:border-pink-900/30",gray:"bg-gray-100 text-gray-700 border-gray-200 dark:bg-gray-900/20 dark:text-gray-400 dark:border-gray-900/30"};function N({tag:a,type:c,onRemove:d,showRemove:e=!1}){let f="string"==typeof a?a:a.label,g="string"==typeof a?void 0:a.color,h=g&&M[g]?M[g]:"customer"===c?M.blue:M.purple;return(0,b.jsxs)("div",{className:`inline-flex items-center gap-1.5 rounded-full border px-3 py-1.5 text-sm font-medium transition-colors ${h}`,children:[(0,b.jsx)(D.Tag,{className:"size-3"}),(0,b.jsx)("span",{children:f}),e&&d&&(0,b.jsx)(v.Button,{className:"size-4 p-0 hover:bg-transparent",onClick:a=>{a.stopPropagation(),d()},size:"icon",variant:"ghost",children:(0,b.jsx)(L.X,{className:"size-3"})})]})}let O=["DNS - Do Not Service","Family Friend","10% Discount","VIP Customer","Payment Plan","Requires Appointment"],P=["Warranty Work","Follow-up Required","Emergency","Inspection Needed","Parts on Order","Callback Scheduled"];function Q({open:a,onOpenChange:c,customerId:e,jobId:f,customerTags:g=[],jobTags:h=[],onUpdate:i}){let[j,k]=(0,d.useState)(g),[l,m]=(0,d.useState)(h),[n,o]=(0,d.useState)(""),[p,q]=(0,d.useState)(""),[r,s]=(0,d.useState)(!1),t=a=>{a&&!j.includes(a)&&k([...j,a]),o("")},u=a=>{a&&!l.includes(a)&&m([...l,a]),q("")},x=async()=>{s(!0);try{let a=[];e&&JSON.stringify(j)!==JSON.stringify(g)&&a.push(G(e,j)),f&&JSON.stringify(l)!==JSON.stringify(h)&&a.push(H(f,l));let b=await Promise.all(a);if(b.every(a=>a.success))E.toast.success("Tags updated successfully"),i?.(),c(!1);else{let a=b.find(a=>!a.success)?.error;E.toast.error(a||"Failed to update tags")}}catch(a){E.toast.error("Failed to update tags")}finally{s(!1)}};return(0,b.jsx)(w.Dialog,{onOpenChange:c,open:a,children:(0,b.jsxs)(w.DialogContent,{className:"max-h-[90vh] max-w-2xl overflow-y-auto",children:[(0,b.jsxs)(w.DialogHeader,{children:[(0,b.jsx)(w.DialogTitle,{children:"Manage Tags"}),(0,b.jsx)(w.DialogDescription,{children:"Add tags to organize and categorize this customer and job"})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[e&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(D.Tag,{className:"size-4 text-blue-600"}),(0,b.jsx)("h3",{className:"text-sm font-semibold",children:"Customer Tags"}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Apply to all jobs for this customer)"})]}),j.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:j.map(a=>(0,b.jsx)(N,{onRemove:()=>{k(j.filter(b=>b!==a))},showRemove:!0,tag:a,type:"customer"},a))}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(J.Label,{className:"text-xs",children:"Quick Add"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:O.filter(a=>!j.includes(a)).map(a=>(0,b.jsxs)(v.Button,{className:"h-7 gap-1 text-xs",onClick:()=>t(a),size:"sm",variant:"outline",children:[(0,b.jsx)(C.Plus,{className:"size-3"}),a]},a))})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(I.Input,{onChange:a=>o(a.target.value),onKeyDown:a=>{"Enter"===a.key&&t(n)},placeholder:"Add custom customer tag...",value:n}),(0,b.jsx)(v.Button,{onClick:()=>t(n),size:"sm",variant:"outline",children:(0,b.jsx)(C.Plus,{className:"size-4"})})]})]}),e&&f&&(0,b.jsx)(K.Separator,{}),f&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(D.Tag,{className:"size-4 text-purple-600"}),(0,b.jsx)("h3",{className:"text-sm font-semibold",children:"Job Tags"}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Apply to this job only)"})]}),l.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:l.map(a=>(0,b.jsx)(N,{onRemove:()=>{m(l.filter(b=>b!==a))},showRemove:!0,tag:a,type:"job"},a))}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(J.Label,{className:"text-xs",children:"Quick Add"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:P.filter(a=>!l.includes(a)).map(a=>(0,b.jsxs)(v.Button,{className:"h-7 gap-1 text-xs",onClick:()=>u(a),size:"sm",variant:"outline",children:[(0,b.jsx)(C.Plus,{className:"size-3"}),a]},a))})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(I.Input,{onChange:a=>q(a.target.value),onKeyDown:a=>{"Enter"===a.key&&u(p)},placeholder:"Add custom job tag...",value:p}),(0,b.jsx)(v.Button,{onClick:()=>u(p),size:"sm",variant:"outline",children:(0,b.jsx)(C.Plus,{className:"size-4"})})]})]})]}),(0,b.jsxs)(w.DialogFooter,{children:[(0,b.jsx)(v.Button,{onClick:()=>c(!1),variant:"outline",children:"Cancel"}),(0,b.jsx)(v.Button,{disabled:r,onClick:x,children:r?"Saving...":"Save Changes"})]})]})})}function R({job:a,customer:C,metrics:D,timeEntries:E=[],teamAssignments:F=[],invoices:G=[],payments:H=[],jobMaterials:I=[]}){let J=(0,c.usePathname)(),K=(0,c.useRouter)(),{toast:L}=(0,z.useToast)(),M=(0,A.useDialerStore)(a=>a.openDialer),N=J?.split("/").pop(),[O,P]=(0,d.useState)(!1),[R,S]=(0,d.useState)(!1),[T,U]=(0,d.useState)(!1),[V,W]=(0,d.useState)(!1),X=C?.tags||[],Y=a?.metadata?.tags||a?.custom_fields?.tags||[],Z=X.length+Y.length,$=async()=>{if(!N)return void L.error("Job ID not found");S(!0);try{let a=await (0,t.archiveJob)(N);a.success?(L.success("Job archived successfully"),P(!1),K.push("/dashboard/work")):L.error(a.error||"Failed to archive job")}catch(a){L.error("Failed to archive job")}finally{S(!1)}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsxs)(y.TooltipProvider,{children:[(0,b.jsxs)(y.Tooltip,{children:[(0,b.jsx)(y.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(v.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,b.jsxs)("a",{href:`/dashboard/work/appointments/new?jobId=${N}`,children:[(0,b.jsx)(g.Calendar,{}),(0,b.jsx)("span",{className:"hidden md:inline",children:"Schedule"})]})})}),(0,b.jsx)(y.TooltipContent,{children:(0,b.jsx)("p",{children:"Schedule appointment"})})]}),(0,b.jsxs)(x.DropdownMenu,{children:[(0,b.jsx)(x.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(v.Button,{size:"sm",variant:"outline",children:[(0,b.jsx)(o.Phone,{}),(0,b.jsx)("span",{className:"hidden md:inline",children:"Contact"})]})}),(0,b.jsxs)(x.DropdownMenuContent,{align:"start",children:[(0,b.jsx)(x.DropdownMenuLabel,{children:"Contact Customer"}),(0,b.jsx)(x.DropdownMenuSeparator,{}),(0,b.jsxs)(x.DropdownMenuItem,{disabled:!C?.phone,onClick:()=>{if(C?.phone)M(C.phone,C.id,C?.display_name||`${C?.first_name||""} ${C?.last_name||""}`.trim());else L.error("No phone number available")},children:[(0,b.jsx)(o.Phone,{className:"mr-2 size-3.5"}),C?.phone?`Call ${C.phone}`:"No phone number"]}),(0,b.jsxs)(x.DropdownMenuItem,{disabled:!C?.phone,onClick:()=>{C?.phone?K.push(`/dashboard/communication/messages?phone=${C.phone}&customerId=${C.id}`):L.error("No phone number available")},children:[(0,b.jsx)(m.MessageSquare,{className:"mr-2 size-3.5"}),C?.phone?"Send text message":"No phone number"]}),(0,b.jsxs)(x.DropdownMenuItem,{disabled:!C?.email,onClick:()=>{C?.email?K.push(`/dashboard/communication?email=${C.email}&customerId=${C.id}`):L.error("No email address available")},children:[(0,b.jsx)(l.Mail,{className:"mr-2 size-3.5"}),C?.email?`Email ${C.email}`:"No email address"]})]})]}),(0,b.jsxs)(y.Tooltip,{children:[(0,b.jsx)(y.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(v.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,b.jsxs)("a",{href:`/dashboard/work/payments/new?jobId=${N}`,children:[(0,b.jsx)(i.CreditCard,{}),(0,b.jsx)("span",{className:"hidden md:inline",children:"Payment"})]})})}),(0,b.jsx)(y.TooltipContent,{children:(0,b.jsx)("p",{children:"Collect payment"})})]}),(0,b.jsxs)(y.Tooltip,{children:[(0,b.jsx)(y.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(v.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,b.jsxs)("a",{href:`/dashboard/work/invoices/new?jobId=${N}`,children:[(0,b.jsx)(q.Receipt,{}),(0,b.jsx)("span",{className:"hidden md:inline",children:"Invoice"})]})})}),(0,b.jsx)(y.TooltipContent,{children:(0,b.jsx)("p",{children:"Create invoice"})})]}),(0,b.jsxs)(y.Tooltip,{children:[(0,b.jsx)(y.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(v.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,b.jsxs)("a",{href:`/dashboard/work/estimates/new?jobId=${N}`,children:[(0,b.jsx)(k.FileText,{}),(0,b.jsx)("span",{className:"hidden md:inline",children:"Estimate"})]})})}),(0,b.jsx)(y.TooltipContent,{children:(0,b.jsx)("p",{children:"Create estimate"})})]})]}),(0,b.jsxs)(x.DropdownMenu,{children:[(0,b.jsx)(x.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(v.Button,{size:"sm",variant:"outline",children:[(0,b.jsx)(n.MoreVertical,{}),(0,b.jsx)("span",{className:"hidden md:inline",children:"Actions"})]})}),(0,b.jsxs)(x.DropdownMenuContent,{align:"end",className:"w-56",children:[a&&D&&(0,b.jsxs)(x.DropdownMenuItem,{onClick:()=>U(!0),children:[(0,b.jsx)(f.BarChart3,{className:"mr-2 size-3.5"}),"View Statistics"]}),(0,b.jsxs)(x.DropdownMenuItem,{onClick:()=>W(!0),children:[(0,b.jsx)(s.default,{className:"mr-2 size-3.5"}),"Manage Tags",Z>0&&(0,b.jsx)(u.Badge,{className:"ml-auto h-5 px-1.5",variant:"secondary",children:Z})]}),(0,b.jsx)(x.DropdownMenuSeparator,{}),(0,b.jsxs)(x.DropdownMenuItem,{onClick:()=>K.push(`/dashboard/work/new?cloneFrom=${N}`),children:[(0,b.jsx)(h.Copy,{className:"mr-2 size-3.5"}),"Clone Job"]}),(0,b.jsxs)(x.DropdownMenuItem,{onClick:()=>{let b=new Blob([[["Field","Value"],["Job Number",a?.job_number||""],["Title",a?.title||""],["Status",a?.status||""],["Customer",C?.display_name||""],["Phone",C?.phone||""],["Email",C?.email||""],["Created",a?.created_at?new Date(a.created_at).toLocaleDateString():""],["Total Revenue",D?.totalRevenue?`$${D.totalRevenue.toFixed(2)}`:"$0.00"]].map(a=>a.map(a=>`"${a}"`).join(",")).join("\n")],{type:"text/csv"}),c=window.URL.createObjectURL(b),d=document.createElement("a");d.href=c,d.download=`job-${a?.job_number||N}.csv`,d.click(),window.URL.revokeObjectURL(c),L.success("Job exported to CSV")},children:[(0,b.jsx)(j.Download,{className:"mr-2 size-3.5"}),"Export to CSV"]}),(0,b.jsxs)(x.DropdownMenuItem,{onClick:()=>{window.print(),L.success("Opening print dialog...")},children:[(0,b.jsx)(p.Printer,{className:"mr-2 size-3.5"}),"Print Details"]}),(0,b.jsxs)(x.DropdownMenuItem,{onClick:()=>{navigator.clipboard.writeText(window.location.href),L.success("Job link copied to clipboard")},children:[(0,b.jsx)(r.Share2,{className:"mr-2 size-3.5"}),"Share Link"]}),(0,b.jsx)(x.DropdownMenuSeparator,{}),(0,b.jsxs)(x.DropdownMenuItem,{className:"text-destructive",onClick:()=>P(!0),children:[(0,b.jsx)(e.Archive,{className:"mr-2 size-3.5"}),"Archive Job"]})]})]})]}),(0,b.jsx)(w.Dialog,{onOpenChange:P,open:O,children:(0,b.jsxs)(w.DialogContent,{children:[(0,b.jsxs)(w.DialogHeader,{children:[(0,b.jsx)(w.DialogTitle,{children:"Archive Job"}),(0,b.jsx)(w.DialogDescription,{children:"Are you sure you want to archive this job? Archived jobs can be restored within 90 days. Completed or invoiced jobs cannot be archived."})]}),(0,b.jsxs)(w.DialogFooter,{children:[(0,b.jsx)(v.Button,{disabled:R,onClick:()=>P(!1),variant:"outline",children:"Cancel"}),(0,b.jsx)(v.Button,{disabled:R,onClick:$,variant:"destructive",children:R?"Archiving...":"Archive Job"})]})]})}),a&&D&&(0,b.jsx)(B.JobStatisticsSheet,{invoices:G,job:a,jobMaterials:I,metrics:D,onOpenChange:U,open:T,payments:H,teamAssignments:F,timeEntries:E}),(0,b.jsx)(Q,{customerId:C?.id,customerTags:X,jobId:a?.id,jobTags:Y,onOpenChange:W,onUpdate:()=>{},open:V})]})}function S(){let a=(0,c.useParams)(),e=a?.id,[f,g]=(0,d.useState)(null);return(0,d.useEffect)(()=>{async function a(){try{let a=await fetch(`/api/jobs/${e}/toolbar-data`);if(a.ok){let b=await a.json();g(b)}}catch(a){}}e&&a()},[e]),(0,b.jsx)(R,{customer:f?.customer,invoices:f?.invoices||[],job:f?.job,jobMaterials:f?.jobMaterials||[],metrics:f?.metrics,payments:f?.payments||[],teamAssignments:f?.teamAssignments||[],timeEntries:f?.timeEntries||[]})}a.s(["JobDetailToolbarWrapper",()=>S],793648)}];

//# sourceMappingURL=apps_web_src_components_work_job-details_job-detail-toolbar-wrapper_tsx_f9b77a1c._.js.map