module.exports=[604,a=>{"use strict";var b=a.i(861467);a.i(445255);var c=a.i(18170);a.i(956852);var d=a.i(90125);a.i(297229);var e=a.i(489904);a.i(413309);var f=a.i(54210),g=a.i(700760),h=a.i(155519),i=a.i(572863),j=a.i(319895),k=a.i(642599),l=a.i(198803),m=a.i(534683),m=m,n=a.i(638727),o=a.i(13378),p=a.i(300298),q=a.i(783281);let r=[{id:"appointment-reminder",label:"Appointment Reminder",preview:"Reminder about upcoming appointment",build:a=>{let b=a.customerFirstName||"there",c=a.appointmentDate&&a.appointmentTime?`on ${a.appointmentDate} at ${a.appointmentTime}`:a.appointmentDate?`on ${a.appointmentDate}`:"for your upcoming appointment";return`Hi ${b}, this is a reminder about your appointment ${c}. Reply CONFIRM to confirm or call us to reschedule.`}},{id:"on-the-way",label:"On The Way",preview:"Technician en route notification",build:a=>{let b=a.customerFirstName||"there",c=a.technicianName||"Our technician";return`Hi ${b}, ${c} is on the way and should arrive shortly.`}},{id:"running-late",label:"Running Late",preview:"Apology for delay",build:a=>{let b=a.customerFirstName||"there";return`Hi ${b}, we apologize but our technician is running a bit behind schedule. We'll update you when they're on the way.`}},{id:"job-complete",label:"Job Complete",preview:"Work completed notification",build:a=>{let b=a.customerFirstName||"there",c=a.companyName?`choosing ${a.companyName}`:"your business";return`Hi ${b}, the work has been completed. If you have any questions, please don't hesitate to reach out. Thank you for ${c}!`}},{id:"payment-reminder",label:"Payment Reminder",preview:"Friendly payment reminder",build:a=>{let b=a.customerFirstName||"there",c=a.invoiceNumber&&a.amount?`invoice #${a.invoiceNumber} for $${a.amount}`:a.invoiceNumber?`invoice #${a.invoiceNumber}`:"your outstanding invoice";return`Hi ${b}, this is a friendly reminder that ${c} is due. Please let us know if you have any questions.`}},{id:"follow-up",label:"Follow Up",preview:"Service follow-up request",build:a=>{let b=a.customerFirstName||"there";return`Hi ${b}, just following up on our recent service. Is everything working well? We'd love to hear your feedback!`}},{id:"thank-you",label:"Thank You",preview:"Thank you message",build:a=>{let b=a.companyName?`choosing ${a.companyName}`:"your business";return`Thank you for ${b}! We appreciate your trust in us. If you have a moment, we'd love a review!`}},{id:"reschedule",label:"Reschedule Request",preview:"Reschedule appointment request",build:a=>{let b=a.customerFirstName||"there",c=a.companyPhone?`, or call us at ${a.companyPhone}`:"";return`Hi ${b}, we need to reschedule your appointment. Please reply with a date and time that works for you${c}.`}}],s=[{name:"Frequently Used",emojis:["ğŸ˜€","ğŸ˜‚","ğŸ˜","ğŸ¥°","ğŸ˜˜","ğŸ˜Š","ğŸ˜‰","ğŸ˜","ğŸ¤”","ğŸ˜","ğŸ˜’","ğŸ™„","ğŸ˜®","ğŸ¤—","ğŸ˜´","ğŸ˜‹","ğŸ˜","ğŸ¤¤","ğŸ˜ª","ğŸ˜µ"]},{name:"Smileys & People",emojis:["ğŸ˜€","ğŸ˜ƒ","ğŸ˜„","ğŸ˜","ğŸ˜†","ğŸ˜…","ğŸ¤£","ğŸ˜‚","ğŸ™‚","ğŸ™ƒ","ğŸ˜‰","ğŸ˜Š","ğŸ˜‡","ğŸ¥°","ğŸ˜","ğŸ¤©","ğŸ˜˜","ğŸ˜—","ğŸ˜š","ğŸ˜™","ğŸ˜‹","ğŸ˜›","ğŸ˜œ","ğŸ¤ª","ğŸ˜","ğŸ¤‘","ğŸ¤—","ğŸ¤­","ğŸ¤«","ğŸ¤”"]},{name:"Gestures",emojis:["ğŸ‘‹","ğŸ¤š","ğŸ–","âœ‹","ğŸ––","ğŸ‘Œ","ğŸ¤Œ","ğŸ¤","âœŒï¸","ğŸ¤","ğŸ¤Ÿ","ğŸ¤˜","ğŸ¤™","ğŸ‘ˆ","ğŸ‘‰","ğŸ‘†","ğŸ–•","ğŸ‘‡","â˜ï¸","ğŸ‘"]},{name:"Objects",emojis:["ğŸ“±","ğŸ’»","âŒš","ğŸ–¥","âŒ¨ï¸","ğŸ–±","ğŸ–²","ğŸ•¹","ğŸ—œ","ğŸ’¾","ğŸ’¿","ğŸ“€","ğŸ“·","ğŸ“¸","ğŸ“¹","ğŸ¥","ğŸ“½","ğŸ","ğŸ“","â˜ï¸"]},{name:"Symbols",emojis:["â¤ï¸","ğŸ§¡","ğŸ’›","ğŸ’š","ğŸ’™","ğŸ’œ","ğŸ–¤","ğŸ¤","ğŸ¤","ğŸ’”","â£ï¸","ğŸ’•","ğŸ’","ğŸ’“","ğŸ’—","ğŸ’–","ğŸ’˜","ğŸ’","ğŸ’Ÿ","â˜®ï¸"]}];function t({value:a,onChange:t,onSend:u,onAttach:v,sending:w=!1,disabled:x=!1,placeholder:y="Text Message",showSegmentCounter:z=!0,customerName:A,customerFirstName:B,customerId:C,jobType:D,companyName:E,companyPhone:F,technicianName:G,appointmentDate:H,appointmentTime:I,invoiceNumber:J,amount:K,enableAiSuggestions:L=!1}){let[M,N]=(0,q.useState)([]),[O,P]=(0,q.useState)(!1),[Q,R]=(0,q.useState)(!1),[S,T]=(0,q.useState)(""),[U,V]=(0,q.useState)(!1),W=(0,q.useRef)(null),X=(0,q.useRef)(null),Y=(0,q.useRef)(null),Z=(0,q.useRef)(null),$=function(a){if(!a)return{segments:0,charsPerSegment:160,isUnicode:!1};let b=!/^[@Â£$Â¥Ã¨Ã©Ã¹Ã¬Ã²Ã‡\nÃ˜Ã¸\rÃ…Ã¥Î”_Î¦Î“Î›Î©Î Î¨Î£Î˜Î\x1B !"#Â¤%&'()*+,\-./0-9:;<=>?Â¡A-ZÃ„Ã–Ã‘Ü§Â¿a-zÃ¤Ã¶Ã±Ã¼Ã ]*$/.test(a),c=b?70:160,d=b?67:153;return a.length<=c?{segments:1,charsPerSegment:c,isUnicode:b}:{segments:Math.ceil(a.length/d),charsPerSegment:d,isUnicode:b}}(a),_=z&&a.length>0&&(Q||a.length>100),aa=(0,q.useCallback)(async a=>{if(!L||a.length<3)return void T("");V(!0);try{let b=await fetch("/api/ai/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"system",content:`You are an SMS autocomplete assistant for a field service company. Complete the user's SMS message naturally and professionally.
Context: ${A?`Customer: ${A}`:""} ${D?`Job type: ${D}`:""} ${E?`Company: ${E}`:""}
IMPORTANT: Only return the completion text (what comes AFTER what the user typed). Keep it short (under 100 chars). No quotes or explanations.`},{role:"user",content:`Complete this SMS message: "${a}"`}],model:"claude-3-5-haiku-20241022",maxTokens:100})});if(b.ok){let a=await b.json(),c=a.content||a.message||"";c&&c.length>0&&c.length<150?T(c.trim()):T("")}}catch(a){console.error("AI suggestion error:",a),T("")}finally{V(!1)}},[L,A,D,E]);(0,q.useEffect)(()=>{if(Z.current&&clearTimeout(Z.current),T(""),L&&!(a.length<5)&&Q)return Z.current=setTimeout(()=>{aa(a)},500),()=>{Z.current&&clearTimeout(Z.current)}},[a,L,Q,aa]),(0,q.useEffect)(()=>{W.current&&W.current.textContent!==a&&(W.current.textContent=a)},[a]);let ab=(0,q.useCallback)(b=>{let c=b+" ",d=W.current;if(d){let b=window.getSelection();if(b&&b.rangeCount>0){let e=b.getRangeAt(0);if(d.contains(e.commonAncestorContainer)){e.deleteContents();let a=document.createTextNode(c);e.insertNode(a);let f=document.createRange();f.setStartAfter(a),f.setEndAfter(a),b.removeAllRanges(),b.addRange(f),t(d.textContent||"")}else t(a+c),requestAnimationFrame(()=>{if(d){d.focus();let a=document.createRange();a.selectNodeContents(d),a.collapse(!1);let b=window.getSelection();b?.removeAllRanges(),b?.addRange(a)}})}else t(a+c),requestAnimationFrame(()=>{if(d){d.focus();let a=document.createRange();a.selectNodeContents(d),a.collapse(!1);let b=window.getSelection();b?.removeAllRanges(),b?.addRange(a)}});d.focus()}else t(a+c);P(!1)},[a,t]),ac=(0,q.useCallback)(a=>{if(!a||0===a.length)return;let b=Array.from(a).map(a=>{let b={id:`${Date.now()}-${Math.random()}`,file:a,type:a.type.startsWith("image/")?"image":"file"};return"image"===b.type&&(b.preview=URL.createObjectURL(a)),b});N(a=>[...a,...b]),v&&v(Array.from(a))},[v]),ad=(0,q.useCallback)(a=>{N(b=>{let c=b.find(b=>b.id===a);return c?.preview&&URL.revokeObjectURL(c.preview),b.filter(b=>b.id!==a)})},[]),ae=(0,q.useCallback)(()=>{!a.trim()&&0===M.length||w||x||(u(),M.forEach(a=>{a.preview&&URL.revokeObjectURL(a.preview)}),N([]))},[a,M,w,x,u]),af=(0,q.useCallback)(b=>{if("Tab"===b.key&&S){b.preventDefault(),t(a+S),T(""),W.current&&(W.current.textContent=a+S,requestAnimationFrame(()=>{if(W.current){W.current.focus();let a=document.createRange();a.selectNodeContents(W.current),a.collapse(!1);let b=window.getSelection();b?.removeAllRanges(),b?.addRange(a)}}));return}if("Escape"===b.key&&S){b.preventDefault(),T("");return}"Enter"!==b.key||b.shiftKey||(b.preventDefault(),ae()),"Enter"===b.key&&(b.metaKey||b.ctrlKey)&&(b.preventDefault(),ae())},[ae,S,a,t]),ag=(0,q.useCallback)(a=>{a.preventDefault();let b=a.clipboardData.getData("text/plain"),c=window.getSelection();if(c&&c.rangeCount>0){let a=c.getRangeAt(0);a.deleteContents();let d=document.createTextNode(b);a.insertNode(d);let e=document.createRange();e.setStartAfter(d),e.setEndAfter(d),c.removeAllRanges(),c.addRange(e),t(W.current?.textContent||"")}},[t]),ah=(0,q.useCallback)((b,c=!1)=>{let d=W.current;if(!d)return void t(c?b:a+b);if(c)t(b),d.textContent=b,requestAnimationFrame(()=>{d.focus();let a=document.createRange();a.selectNodeContents(d),a.collapse(!1);let b=window.getSelection();b?.removeAllRanges(),b?.addRange(a)});else{let c=window.getSelection();if(c&&c.rangeCount>0){let e=c.getRangeAt(0);if(d.contains(e.commonAncestorContainer)){e.deleteContents();let a=document.createTextNode(b);e.insertNode(a);let f=document.createRange();f.setStartAfter(a),f.setEndAfter(a),c.removeAllRanges(),c.addRange(f),t(d.textContent||"")}else t(a+b)}else t(a+b);d.focus()}},[a,t]),ai=(0,q.useCallback)(a=>{let b={customerFirstName:B||A?.split(" ")[0],customerName:A,companyName:E,companyPhone:F,technicianName:G,appointmentDate:H,appointmentTime:I,invoiceNumber:J,amount:K};ah(a.build(b),!0)},[ah,B,A,E,F,G,H,I,J,K]);return(0,b.jsxs)("div",{className:"bg-card border-t border-border/50",children:[_&&(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2 px-3 pt-2 pb-1",children:[(0,b.jsxs)("span",{className:"text-[10px] text-muted-foreground",children:[a.length," chars"]}),(0,b.jsx)("span",{className:"text-[10px] text-muted-foreground",children:"Â·"}),(0,b.jsxs)("span",{className:(0,g.cn)("text-[10px] font-medium",$.segments>1?"text-amber-500":"text-muted-foreground"),children:[$.segments," segment",1!==$.segments?"s":""]}),$.isUnicode&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"text-[10px] text-muted-foreground",children:"Â·"}),(0,b.jsx)("span",{className:"text-[10px] text-amber-500",children:"Unicode"})]})]}),M.length>0&&(0,b.jsx)("div",{className:"px-3 pt-2",children:(0,b.jsx)(f.ScrollArea,{className:"w-full",children:(0,b.jsx)("div",{className:"flex gap-2",children:M.map(a=>(0,b.jsx)("div",{className:"group relative shrink-0",children:"image"===a.type&&a.preview?(0,b.jsxs)("div",{className:"relative size-16 overflow-hidden rounded-xl border border-border",children:[(0,b.jsx)("img",{src:a.preview,alt:a.file.name,className:"size-full object-cover"}),(0,b.jsx)(c.Button,{variant:"ghost",size:"sm",className:"absolute right-0.5 top-0.5 size-5 rounded-full bg-black/60 p-0 opacity-0 transition-opacity hover:bg-black/80 group-hover:opacity-100",onClick:()=>ad(a.id),children:(0,b.jsx)(p.X,{className:"size-3 text-white"})})]}):(0,b.jsxs)("div",{className:"relative flex size-16 items-center justify-center rounded-xl border border-border bg-muted",children:[(0,b.jsx)(j.FileText,{className:"size-5 text-muted-foreground"}),(0,b.jsx)(c.Button,{variant:"ghost",size:"sm",className:"absolute right-0.5 top-0.5 size-5 rounded-full bg-black/60 p-0 opacity-0 transition-opacity hover:bg-black/80 group-hover:opacity-100",onClick:()=>ad(a.id),children:(0,b.jsx)(p.X,{className:"size-3 text-white"})}),(0,b.jsx)("span",{className:"absolute bottom-1 left-1 right-1 truncate text-[8px] text-muted-foreground",children:a.file.name})]})},a.id))})})}),(0,b.jsxs)("div",{className:"flex items-end gap-1.5 p-2 pb-safe",children:[(0,b.jsxs)(d.DropdownMenu,{children:[(0,b.jsx)(d.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(c.Button,{type:"button",variant:"ghost",size:"icon",className:"mb-0.5 size-10 md:size-8 shrink-0 rounded-full hover:bg-muted",disabled:x,title:"Add attachment",children:(0,b.jsx)(n.Plus,{className:"size-6 md:size-5 text-muted-foreground"})})}),(0,b.jsxs)(d.DropdownMenuContent,{align:"start",side:"top",className:"w-48",children:[(0,b.jsxs)(d.DropdownMenuItem,{onClick:()=>Y.current?.click(),className:"gap-2",children:[(0,b.jsx)(i.Camera,{className:"size-4"}),(0,b.jsx)("span",{children:"Camera"})]}),(0,b.jsxs)(d.DropdownMenuItem,{onClick:()=>{let a=document.createElement("input");a.type="file",a.accept="image/*",a.multiple=!0,a.onchange=a=>ac(a.target.files),a.click()},className:"gap-2",children:[(0,b.jsx)(k.ImageIcon,{className:"size-4"}),(0,b.jsx)("span",{children:"Photo Library"})]}),(0,b.jsxs)(d.DropdownMenuItem,{onClick:()=>X.current?.click(),className:"gap-2",children:[(0,b.jsx)(j.FileText,{className:"size-4"}),(0,b.jsx)("span",{children:"Document"})]})]})]}),(0,b.jsxs)(d.DropdownMenu,{children:[(0,b.jsx)(d.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(c.Button,{type:"button",variant:"ghost",size:"icon",className:"mb-0.5 size-10 md:size-8 shrink-0 rounded-full hover:bg-muted",disabled:x,title:"Quick replies",children:(0,b.jsx)(m.default,{className:"size-5 md:size-4 text-muted-foreground"})})}),(0,b.jsxs)(d.DropdownMenuContent,{align:"start",side:"top",className:"w-56",children:[(0,b.jsx)("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground",children:"Quick Replies"}),r.map(a=>(0,b.jsxs)(d.DropdownMenuItem,{onClick:()=>ai(a),className:"flex-col items-start gap-0.5",children:[(0,b.jsx)("span",{className:"font-medium",children:a.label}),(0,b.jsx)("span",{className:"line-clamp-1 text-xs text-muted-foreground",children:a.preview})]},a.id))]})]}),(0,b.jsx)("input",{ref:X,type:"file",multiple:!0,accept:"*/*",className:"hidden",onChange:a=>ac(a.target.files)}),(0,b.jsx)("input",{ref:Y,type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:a=>ac(a.target.files)}),(0,b.jsx)("div",{className:"relative min-w-0 flex-1",children:(0,b.jsxs)("div",{className:(0,g.cn)("flex w-full items-center overflow-y-auto rounded-[18px] border border-border bg-muted/50 pl-3 pr-1 py-1 transition-colors","min-h-[44px] md:min-h-[36px] max-h-[120px]","focus-within:border-primary/30 focus-within:bg-background focus-within:ring-1 focus-within:ring-primary/20",(x||w)&&"cursor-not-allowed opacity-50"),onClick:()=>W.current?.focus(),children:[(0,b.jsxs)("div",{className:"relative min-w-0 flex-1",children:[(0,b.jsx)("div",{ref:W,contentEditable:!x&&!w,suppressContentEditableWarning:!0,spellCheck:!0,onInput:a=>{t(a.currentTarget.textContent||"")},onKeyDown:af,onPaste:ag,onFocus:()=>R(!0),onBlur:()=>R(!1),"data-placeholder":y,className:(0,g.cn)("w-full min-w-0 whitespace-pre-wrap break-words py-1 leading-5 outline-none","text-base md:text-sm","empty:before:pointer-events-none empty:before:text-muted-foreground/60 empty:before:content-[attr(data-placeholder)]",(x||w)&&"pointer-events-none")}),S&&a&&(0,b.jsxs)("div",{className:"pointer-events-none absolute inset-0 flex items-center overflow-hidden py-1 text-sm leading-5","aria-hidden":"true",children:[(0,b.jsx)("span",{className:"invisible whitespace-pre-wrap",children:a}),(0,b.jsx)("span",{className:"text-muted-foreground/40",children:S})]}),S&&(0,b.jsxs)("div",{className:"absolute -top-5 right-0 flex items-center gap-1 text-[10px] text-muted-foreground",children:[(0,b.jsx)("kbd",{className:"rounded border border-border bg-muted px-1 py-0.5 font-mono text-[9px]",children:"Tab"}),(0,b.jsx)("span",{children:"to accept"})]})]}),(0,b.jsxs)("div",{className:"flex shrink-0 items-center gap-0.5 pl-1",children:[(0,b.jsxs)(e.Popover,{open:O,onOpenChange:P,children:[(0,b.jsx)(e.PopoverTrigger,{asChild:!0,children:(0,b.jsx)("button",{type:"button",className:(0,g.cn)("flex size-9 md:size-7 items-center justify-center rounded-full transition-colors","hover:bg-muted/80",O&&"bg-muted"),disabled:x,title:"Add emoji",children:(0,b.jsx)(o.Smile,{className:"size-5 md:size-4 text-muted-foreground"})})}),(0,b.jsx)(e.PopoverContent,{side:"top",align:"end",className:"w-[300px] p-0",children:(0,b.jsx)(f.ScrollArea,{className:"h-[280px]",children:(0,b.jsx)("div",{className:"p-2",children:s.map((a,c)=>(0,b.jsxs)("div",{className:c>0?"mt-3":"",children:[(0,b.jsx)("h4",{className:"mb-1.5 px-1 text-[10px] font-semibold uppercase tracking-wider text-muted-foreground",children:a.name}),(0,b.jsx)("div",{className:"grid grid-cols-8 gap-0.5",children:a.emojis.map((a,c)=>(0,b.jsx)("button",{type:"button",className:"flex size-8 items-center justify-center rounded-lg text-lg transition-colors hover:bg-muted",onClick:()=>ab(a),children:a},`${a}-${c}`))})]},a.name))})})})]}),(0,b.jsx)("button",{type:"button",onClick:ae,disabled:!a.trim()&&0===M.length||w||x,className:(0,g.cn)("flex size-9 md:size-7 items-center justify-center rounded-full transition-all duration-200",a.trim()||M.length>0?"bg-primary hover:bg-primary/90 scale-100 active:scale-95":"bg-muted/50 scale-90"),children:w?(0,b.jsx)(l.Loader2,{className:(0,g.cn)("size-5 md:size-4 animate-spin",a.trim()||M.length>0?"text-primary-foreground":"text-muted-foreground")}):(0,b.jsx)(h.ArrowUp,{className:(0,g.cn)("size-5 md:size-4",a.trim()||M.length>0?"text-primary-foreground":"text-muted-foreground")})})]})]})})]})]})}a.s(["SmsMessageInput",()=>t],604)}];

//# sourceMappingURL=apps_web_src_components_communication_sms-message-input_tsx_f5c59682._.js.map