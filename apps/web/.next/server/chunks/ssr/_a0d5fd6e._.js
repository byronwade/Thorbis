module.exports=[311487,a=>{"use strict";async function b(a,b,c,d){let{data:e,error:f}=await a.rpc("has_role",{user_uuid:b,required_role:c,company_uuid:d});return!f&&!0===e}async function c(a,b,c){let{data:d,error:e}=await a.rpc("get_user_role",{user_uuid:b,company_uuid:c});return e?null:d}async function d(a,b,c,d){let{data:e,error:f}=await a.rpc("has_permission",{user_uuid:b,permission_key:c,company_uuid:d});return!f&&!0===e}async function e(a,b,c){let{data:d,error:e}=await a.rpc("is_company_owner",{user_uuid:b,company_uuid:c});return!e&&!0===d}a.s(["getUserRole",()=>c,"hasPermission",()=>d,"hasRole",()=>b,"isCompanyOwner",()=>e])},997053,a=>{"use strict";a.i(311487),a.s([])},288344,a=>{"use strict";var b=a.i(780195);a.i(218188);var c=a.i(146057);a.i(467361);var d=a.i(445074);a.i(997053);var e=a.i(311487),f=a.i(974406),g=a.i(136874),h=a.i(395731);async function i(){return(0,f.withErrorHandling)(async()=>{let a=await (0,g.createClient)();if(!a)throw Error("Database connection not available");let{data:{user:b}}=await a.auth.getUser();if(!b)throw Error("Not authenticated");let c=await (0,d.getActiveCompanyId)();if(!c)throw Error("No active company");return await (0,e.getUserRole)(a,b.id,c)})}async function j(a){return(0,f.withErrorHandling)(async()=>{let b=await (0,g.createClient)();if(!b)throw Error("Database connection not available");let c=await (0,d.getActiveCompanyId)();if(!c)throw Error("No active company");let{data:e,error:f}=await b.from("company_memberships").select("user_id, role").eq("id",a).eq("company_id",c).single();if(f||!e)throw Error("Team member not found");let{data:h}=await b.from("companies").select("owner_id").eq("id",c).single();return h&&h.owner_id===e.user_id?{canDelete:!1,reason:"Cannot delete company owner. Transfer ownership first before removing this team member."}:{canDelete:!0}})}c.z.object({teamMemberId:c.z.string().uuid(),newRole:c.z.enum(["owner","admin","manager","dispatcher","technician","csr"]),reason:c.z.string().optional()}),c.z.object({teamMemberId:c.z.string().uuid(),permissions:c.z.record(c.z.string(),c.z.boolean())}),(0,h.ensureServerEntryExports)([i,j]),(0,b.registerServerReference)(i,"001f005176797ef23488068124fb9a744915a477de",null),(0,b.registerServerReference)(j,"406f6624261c6dd1a908026fa1408a3f6d507b6e7d",null),a.s(["canDeleteTeamMember",()=>j,"getCurrentUserRole",()=>i])},338081,a=>{"use strict";var b=a.i(780195),c=a.i(319351),d=a.i(136874),e=a.i(395731);let f=/\s+/,g=(0,c.createClient)("https://togejqdwggezkxahomeh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvZ2VqcWR3Z2dlemt4YWhvbWVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3MjAyOTUsImV4cCI6MjA3NzI5NjI5NX0.a74QOxiIcxeALZsTsNXNDiOls1MZDsFfyGFq992eBBM",{auth:{persistSession:!1,autoRefreshToken:!1}});function h(a){return{...a,description:a?.description??void 0,icon:a?.icon??void 0}}function i(a){return{...a,excerpt:a?.excerpt??void 0,featured_image:a?.featured_image??void 0,author:a?.author??void 0,published_at:a?.published_at??void 0,updated_at:a?.updated_at??void 0,metaTitle:a?.metaTitle??void 0,metaDescription:a?.metaDescription??void 0,keywords:a?.keywords??void 0,tags:a?.tags?.map(a=>a.tag)??[],category:a?.category?h(a.category):a?.category}}async function j(a){try{if(!g)return{success:!1,error:"Supabase configuration is missing"};let b=g.from("kb_articles").select(`
        *,
        category:kb_categories(*),
        tags:kb_article_tags(
          tag:kb_tags(*)
        )
      `,{count:"exact"}).eq("published",!0).order("published_at",{ascending:!1});a?.category&&(b=b.eq("category.slug",a.category)),a?.featured!==void 0&&(b=b.eq("featured",a.featured));let c=a?.limit||20,d=a?.offset||0;b=b.range(d,d+c-1);let{data:e,error:f,count:h}=await b;if(f)return{success:!1,error:f.message};let j=e?.map(a=>i(a))??[];return{success:!0,articles:j,total:h||0}}catch(a){if(a instanceof Error)return{success:!1,error:a.message};return{success:!1,error:"Failed to fetch articles"}}}async function k(a,b){try{if(!g)return{success:!1,error:"Supabase configuration is missing"};let{data:c,error:d}=await g.from("kb_categories").select("id").eq("slug",a).eq("is_active",!0).single();if(d||!c)return{success:!1,error:"Category not found"};let{data:e,error:f}=await g.from("kb_articles").select(`
        *,
        category:kb_categories(*),
        tags:kb_article_tags(
          tag:kb_tags(*)
        )
      `).eq("category_id",c.id).eq("slug",b).eq("published",!0).single();if(f)return{success:!1,error:f.message};if(!e)return{success:!1,error:"Article not found"};let h=i(e);return{success:!0,article:h}}catch(a){if(a instanceof Error)return{success:!1,error:a.message};return{success:!1,error:"Failed to fetch article"}}}async function l(){try{if(!g)return{success:!1,error:"Supabase configuration is missing"};let{data:a,error:b}=await g.from("kb_categories").select("*").eq("is_active",!0).order("order",{ascending:!0}).order("title",{ascending:!0});if(b)return{success:!1,error:b.message};let c=new Map,d=[];if(a)for(let b of a)c.set(b.id,{...h(b),children:[]});if(a)for(let b of a){let a=c.get(b.id);if(!a)return;if(b.parent_id){let d=c.get(b.parent_id);d&&(d.children=d.children||[],d.children.push(a))}else d.push(a)}return{success:!0,categories:d}}catch(a){if(a instanceof Error)return{success:!1,error:a.message};return{success:!1,error:"Failed to fetch categories"}}}async function m(a,b){try{if(!g)return{success:!1,error:"Supabase configuration is missing"};if(!a||0===a.trim().length)return{success:!0,articles:[],total:0};let c=a.split(f).map(a=>`${a}:*`).join(" & "),d=b?.limit||20,e=b?.offset||0,{data:h,error:j,count:k}=await g.from("kb_articles").select(`
        *,
        category:kb_categories(*),
        tags:kb_article_tags(
          tag:kb_tags(*)
        )
      `,{count:"exact"}).eq("published",!0).textSearch("search_vector",c,{type:"websearch",config:"english"}).order("view_count",{ascending:!1}).limit(d).range(e,e+d-1);if(j)return{success:!1,error:j.message};let l=h?.map(a=>i(a))??[];return{success:!0,articles:l,total:k||0}}catch(a){if(a instanceof Error)return{success:!1,error:a.message};return{success:!1,error:"Failed to search articles"}}}async function n(a,b=5){try{if(!g)return{success:!1,error:"Supabase configuration is missing"};let{data:c,error:d}=await g.from("kb_article_related").select(`
        related_article:kb_articles!kb_article_related_related_article_id_fkey(
          *,
          category:kb_categories(*),
          tags:kb_article_tags(
            tag:kb_tags(*)
          )
        )
      `).eq("article_id",a).eq("related_article.published",!0).order("order",{ascending:!0}).limit(b);if(d)return{success:!1,error:d.message};let e=c?.map(a=>i(a.related_article))??[];return{success:!0,articles:e}}catch(a){if(a instanceof Error)return{success:!1,error:a.message};return{success:!1,error:"Failed to fetch related articles"}}}async function o(a){try{let b=await (0,d.createClient)();if(!b)return{success:!1,error:"Database connection not available"};let{error:c}=await b.rpc("increment_kb_article_views",{article_id:a});if(c){let{data:c}=await b.from("kb_articles").select("view_count").eq("id",a).single();if(c){let{error:d}=await b.from("kb_articles").update({view_count:(c.view_count||0)+1}).eq("id",a);if(d)return{success:!1,error:d.message}}}return{success:!0}}catch(a){if(a instanceof Error)return{success:!1,error:a.message};return{success:!1,error:"Failed to increment views"}}}async function p(a){try{let b=await (0,d.createClient)();if(!b)return{success:!1,error:"Database connection not available"};let{error:c}=await b.from("kb_feedback").insert({article_id:a.articleId,helpful:a.helpful,comment:a.comment,user_email:a.userEmail});if(c)return{success:!1,error:c.message};if(void 0!==a.helpful){let{data:c}=await b.from("kb_articles").select("helpful_count, not_helpful_count").eq("id",a.articleId).single();if(c){let d=!0===a.helpful?"helpful_count":"not_helpful_count",e=(c[d]||0)+1;await b.from("kb_articles").update({[d]:e}).eq("id",a.articleId)}}return{success:!0}}catch(a){if(a instanceof Error)return{success:!1,error:a.message};return{success:!1,error:"Failed to submit feedback"}}}(0,e.ensureServerEntryExports)([j,k,l,m,n,o,p]),(0,b.registerServerReference)(j,"4070bed0ecc25d050b4520c0f696340ebb01e5390b",null),(0,b.registerServerReference)(k,"60e4942793029c05824ec40bb94739dc0c0daa1438",null),(0,b.registerServerReference)(l,"00c1e90eff34225b6dd95f5f2f2a91828868b9fcfb",null),(0,b.registerServerReference)(m,"60301b0c2049c37f7b265049269699f6d4a7a33d92",null),(0,b.registerServerReference)(n,"605a67c4b75156644201622753ea0654e68cee60ae",null),(0,b.registerServerReference)(o,"40f0ec73569584e2e98c0966c6b8ceab6dc0c1f682",null),(0,b.registerServerReference)(p,"404ca2dce3a3b5558a45a363300d09bf2965522750",null),a.s(["getKBArticle",()=>k,"getKBArticles",()=>j,"getKBCategories",()=>l,"getKBRelatedArticles",()=>n,"incrementArticleViews",()=>o,"searchKBArticles",()=>m,"submitKBFeedback",()=>p])},208854,a=>{"use strict";var b=a.i(288344),c=a.i(338081);a.s([],350278),a.i(350278),a.s(["001f005176797ef23488068124fb9a744915a477de",()=>b.getCurrentUserRole,"00c1e90eff34225b6dd95f5f2f2a91828868b9fcfb",()=>c.getKBCategories,"404ca2dce3a3b5558a45a363300d09bf2965522750",()=>c.submitKBFeedback,"406f6624261c6dd1a908026fa1408a3f6d507b6e7d",()=>b.canDeleteTeamMember,"4070bed0ecc25d050b4520c0f696340ebb01e5390b",()=>c.getKBArticles,"40f0ec73569584e2e98c0966c6b8ceab6dc0c1f682",()=>c.incrementArticleViews,"60301b0c2049c37f7b265049269699f6d4a7a33d92",()=>c.searchKBArticles,"605a67c4b75156644201622753ea0654e68cee60ae",()=>c.getKBRelatedArticles,"60e4942793029c05824ec40bb94739dc0c0daa1438",()=>c.getKBArticle],208854)},858982,a=>{a.v(b=>Promise.all(["server/chunks/ssr/3c0ae_next_4427392f._.js"].map(b=>a.l(b))).then(()=>b(857782)))}];

//# sourceMappingURL=_a0d5fd6e._.js.map