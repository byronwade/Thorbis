module.exports=[193695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},997868,a=>{a.n(a.i(884849))},592581,a=>{a.n(a.i(596565))},134005,a=>{a.n(a.i(977930))},565165,a=>{a.n(a.i(728209))},147941,a=>{a.n(a.i(484103))},304434,a=>{a.n(a.i(632684))},407521,a=>{a.n(a.i(693094))},797797,a=>{a.n(a.i(977207))},290022,a=>{a.n(a.i(362735))},729157,a=>{a.n(a.i(470009))},712363,a=>{a.n(a.i(279732))},208120,a=>{a.n(a.i(52860))},863056,a=>{a.n(a.i(77721))},721135,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call ToolbarStatsProvider() from the server but ToolbarStatsProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/layout/toolbar-stats-provider.tsx <module evaluation>","ToolbarStatsProvider");a.s(["ToolbarStatsProvider",0,b])},444593,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call ToolbarStatsProvider() from the server but ToolbarStatsProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/layout/toolbar-stats-provider.tsx","ToolbarStatsProvider");a.s(["ToolbarStatsProvider",0,b])},206372,a=>{"use strict";a.i(721135);var b=a.i(444593);a.n(b)},8165,a=>{"use strict";function b(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(a/100)}function c(a){return[{label:"Total Revenue",value:b(a.totalRevenue),change:void 0,changeLabel:"all time"},{label:"Jobs",value:a.totalJobs.toString(),change:void 0,changeLabel:"total"},{label:"Properties",value:a.totalProperties.toString(),change:0,changeLabel:"locations"},{label:"Outstanding",value:b(a.outstandingBalance),change:a.outstandingBalance>0?-1:0,changeLabel:"balance due"}]}function d(a){let c=100*(a.activeJobs>0);return[{label:"Total Jobs",value:a.totalJobs.toString(),change:a.activeJobs>0?c:void 0,changeLabel:a.activeJobs>0?`${a.activeJobs} active`:"no active jobs"},{label:"Total Revenue",value:b(a.totalRevenue),change:a.totalRevenue>0?void 0:0,changeLabel:a.totalJobs>0?`${a.totalJobs} job${1!==a.totalJobs?"s":""}`:"no jobs yet"},{label:"Last Service",value:function(a){if(!a)return"Never";let b=new Date(a),c=Math.floor((new Date().getTime()-b.getTime())/864e5);return 0===c?"Today":1===c?"Yesterday":c<7?`${c} days ago`:c<30?`${Math.floor(c/7)} weeks ago`:c<365?`${Math.floor(c/30)} months ago`:`${Math.floor(c/365)} years ago`}(a.lastServiceDate),change:void 0,changeLabel:a.lastServiceDate?"completed":"no history"},{label:"Next Scheduled",value:function(a){if(!a)return"Not scheduled";let b=new Date(a),c=new Date,d=Math.floor((b.getTime()-c.getTime())/864e5);return d<0?"Overdue":0===d?"Today":1===d?"Tomorrow":d<7?`In ${d} days`:d<30?`In ${Math.floor(d/7)} weeks`:b.toLocaleDateString(void 0,{month:"short",day:"numeric"})}(a.nextScheduledDate),change:a.nextScheduledDate?100:void 0,changeLabel:a.equipmentCount?`${a.equipmentCount} equipment`:"no equipment"}]}function e(a){let c=a.totalAmount>0?Math.round(a.paidAmount/a.totalAmount*100):0,d=function(a){if(!a)return null;let b=new Date(a),c=new Date;return Math.ceil((b.getTime()-c.getTime())/864e5)}(a.dueDate),e=null!==d&&d<0;return[{label:"Total Amount",value:b(a.totalAmount)},{label:"Paid",value:b(a.paidAmount),change:c,changeLabel:`${c}% paid`},{label:"Balance Due",value:b(a.balanceAmount),change:a.balanceAmount>0?-1:1},{label:"Due Date",value:a.dueDate?new Date(a.dueDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"Not set",changeLabel:null!==d?e?`${Math.abs(d)} days overdue`:`${d} days remaining`:void 0,change:e?-1:null!==d&&d<=7?0:1}]}function f(a){var c,d;let e={draft:{change:void 0,label:"not sent"},sent:{change:50,label:"awaiting response"},accepted:{change:100,label:"customer approved"},rejected:{change:0,label:"declined"}}[a.status.toLowerCase()]||{change:void 0,label:a.status};return[{label:"Estimate Value",value:b(a.totalAmount),change:a.isAccepted?100:void 0,changeLabel:a.isAccepted?"accepted":`${a.lineItemsCount} item${1!==a.lineItemsCount?"s":""}`},{label:"Line Items",value:a.lineItemsCount.toString(),change:a.lineItemsCount>0?void 0:0,changeLabel:a.totalAmount>0?b(a.totalAmount):"no items"},{label:"Status",value:a.status,change:e.change,changeLabel:e.label},{label:"Valid Until",value:(c=a.validUntil,d=a.daysUntilExpiry,c&&null!==d?d<0?"Expired":0===d?"Expires today":1===d?"Expires tomorrow":d<7?`${d} days left`:new Date(c).toLocaleDateString(void 0,{month:"short",day:"numeric"}):"No expiry"),change:null!==a.daysUntilExpiry&&a.daysUntilExpiry>=0&&a.daysUntilExpiry<7?0:void 0,changeLabel:a.validUntil&&null!==a.daysUntilExpiry?a.daysUntilExpiry<0?"expired":0===a.daysUntilExpiry?"today":"valid":"no limit"}]}function g(a){return[{label:"Duration",value:`${Math.floor(a.duration/60)}h ${a.duration%60}m`,change:void 0},{label:"Travel Time",value:a.travelTime>0?`${a.travelTime}m`:"N/A",change:void 0},{label:"Team Members",value:(a.teamMemberCount??0).toString(),change:void 0},{label:"Job Value",value:b(a.jobValue),change:a.jobValue>1e5?10:void 0}]}function h(a){let c=a.minimumQuantity>0?Math.round((a.quantityAvailable-a.minimumQuantity)/a.minimumQuantity*100):void 0,d=a.quantityOnHand>0&&a.quantityReserved>0?Math.round(-a.quantityReserved/a.quantityOnHand*100):void 0;return[{label:"On Hand",value:a.quantityOnHand,changeLabel:"total units"},{label:"Available",value:a.quantityAvailable,change:c,changeLabel:a.minimumQuantity>0?`vs min ${a.minimumQuantity}`:"available units"},{label:"Reserved",value:a.quantityReserved,change:d,changeLabel:"allocated"},{label:"Inventory Value",value:b(a.totalValue),changeLabel:"at cost"}]}function i(a){return[{label:"Total Amount",value:b(a.totalAmount),change:void 0},{label:"Line Items",value:a.lineItemCount.toString(),change:void 0},{label:"Status",value:a.status,change:void 0},{label:"Delivery",value:void 0!==a.daysUntilDelivery?a.daysUntilDelivery>0?`${a.daysUntilDelivery} days`:"Today":"Not set",change:void 0}]}function j(a){var c;return[{label:"Total Jobs",value:a.totalJobs.toString(),change:a.jobsTrend||0,changeLabel:"vs last month"},{label:"Hours Worked",value:(c=a.hoursWorked,`${c.toFixed(1)}h`),change:a.hoursTrend||0,changeLabel:"vs last month"},{label:"Revenue Generated",value:b(a.revenueGenerated),change:a.revenueTrend||0,changeLabel:"vs last month"},{label:"Rating",value:a.customerRating>0?a.customerRating.toFixed(1):"N/A",change:0,changeLabel:"customer rating"}]}function k(a){let c=new Date(a.createdAt),d=a.processedAt?new Date(a.processedAt):null,e=d?Math.floor((d.getTime()-c.getTime())/6e4):null,f=(a.refundedAmount||0)>0,g=a.amount-(a.refundedAmount||0);return[{label:"Payment Amount",value:b(a.amount),change:f?-1:a.amount>0?100:void 0,changeLabel:f?`${b(a.refundedAmount||0)} refunded`:"received"},{label:"Net Amount",value:b(g),change:f?-1:void 0,changeLabel:f?"after refund":"processed"},{label:"Status",value:a.status,change:"completed"===a.status?100:void 0,changeLabel:"completed"===a.status?"successful":"pending"},{label:"Processing Time",value:null!==e?e<60?`${e}m`:`${Math.floor(e/60)}h ${e%60}m`:"Not processed",change:null!==e&&e<30?100:void 0,changeLabel:null!==e?`from ${c.toLocaleDateString()}`:"awaiting processing"}]}a.s(["generateAppointmentStats",()=>g,"generateCustomerStats",()=>c,"generateEstimateStats",()=>f,"generateInvoiceStats",()=>e,"generateMaterialStats",()=>h,"generatePaymentStats",()=>k,"generatePropertyStats",()=>d,"generatePurchaseOrderStats",()=>i,"generateTeamMemberStatsSimple",()=>j])},182597,a=>{a.n(a.i(545317))},285555,a=>{a.n(a.i(41484))},196428,a=>{"use strict";var b=a.i(429969);a.i(467361);var c=a.i(445074),d=a.i(933427);let e=`
  id,
  estimate_number,
  title,
  status,
  total_amount,
  created_at,
  valid_until,
  archived_at,
  deleted_at,
  customers!estimates_customer_id_customers_id_fk (
    display_name,
    first_name,
    last_name
  )
`;async function f(a,b=50){let g=await (0,c.getActiveCompanyId)();if(!g)return{estimates:[],totalCount:0};let h=await (0,d.createServiceSupabaseClient)();if(!h)throw Error("Supabase client not configured");let i=(Math.max(a,1)-1)*b,{data:j,error:k,count:l}=await h.from("estimates").select(e,{count:"exact"}).eq("company_id",g).order("created_at",{ascending:!1}).range(i,i+b-1);if(k)throw Error(`Failed to load estimates: ${k.message}`);return{estimates:j??[],totalCount:l??0}}let g=(0,b.cache)(async(a,b)=>{let c=await (0,d.createServiceSupabaseClient)();if(!c)throw Error("Supabase client not configured");let{data:e,error:f}=await c.rpc("get_estimate_complete",{p_estimate_id:a,p_company_id:b});return f?(console.error("Error fetching estimate:",f),null):e?.[0]?.estimate_data||null});a.s(["ESTIMATES_PAGE_SIZE",0,50,"getEstimateComplete",0,g,"getEstimatesPageData",()=>f])},855591,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call EstimatePageContent() from the server but EstimatePageContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/estimates/estimate-page-content.tsx <module evaluation>","EstimatePageContent");a.s(["EstimatePageContent",0,b])},654835,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call EstimatePageContent() from the server but EstimatePageContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/estimates/estimate-page-content.tsx","EstimatePageContent");a.s(["EstimatePageContent",0,b])},236816,a=>{"use strict";a.i(855591);var b=a.i(654835);a.n(b)},616451,a=>{"use strict";var b=a.i(504348),c=a.i(429969);a.i(692167);var d=a.i(852596),e=a.i(206372),f=a.i(236816);a.i(467361);var g=a.i(445074),h=a.i(196428),i=a.i(8165),j=a.i(136874);async function k({estimateId:c}){let k=await (0,j.createClient)();if(!k)return(0,d.notFound)();let{data:{user:l}}=await k.auth.getUser();if(!l)return(0,d.notFound)();await (0,g.isActiveCompanyOnboardingComplete)()||(0,d.redirect)("/dashboard");let{getActiveCompanyId:m}=await a.A(37652),n=await m();n||(0,d.redirect)("/dashboard");let o=await (0,h.getEstimateComplete)(c,n);if(!o)return(0,d.notFound)();let p=o.customer,q=o.job,r=o.property,{data:s}=await k.from("invoices").select("*").eq("converted_from_estimate_id",c).is("deleted_at",null).maybeSingle(),[{data:t},{data:u},{data:v},{data:w}]=await Promise.all([k.from("contracts").select("*").eq("estimate_id",c).is("deleted_at",null).maybeSingle(),k.from("activity_log").select("*, user:users!user_id(*)").eq("entity_type","estimate").eq("entity_id",c).order("created_at",{ascending:!1}).limit(50),k.from("notes").select("*").eq("entity_type","estimate").eq("entity_id",c).is("deleted_at",null).order("created_at",{ascending:!1}),k.from("attachments").select("*").eq("entity_type","estimate").eq("entity_id",c).order("created_at",{ascending:!1})]),x=o.line_items?"string"==typeof o.line_items?JSON.parse(o.line_items):o.line_items:[],y=o.valid_until?Math.ceil((new Date(o.valid_until).getTime()-Date.now())/864e5):null,z={totalAmount:o.total_amount||0,lineItemsCount:x.length,status:o.status||"draft",validUntil:o.valid_until,daysUntilExpiry:y,isAccepted:"accepted"===o.status},A=(0,i.generateEstimateStats)(z);return(0,b.jsx)(e.ToolbarStatsProvider,{stats:A,children:(0,b.jsx)("div",{className:"flex h-full w-full flex-col overflow-auto",children:(0,b.jsx)("div",{className:"mx-auto w-full max-w-7xl",children:(0,b.jsx)(f.EstimatePageContent,{entityData:{estimate:o,customer:p,job:q,property:r,invoice:s,contract:t,activities:u||[],notes:v||[],attachments:w||[]},metrics:z})})})})}function l(){return(0,b.jsx)("div",{className:"flex h-full w-full flex-col overflow-auto",children:(0,b.jsxs)("div",{className:"mx-auto w-full max-w-7xl space-y-6 p-6",children:[(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"bg-muted h-8 w-48 animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-4 w-64 animate-pulse rounded"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("div",{className:"bg-muted h-10 w-24 animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-10 w-24 animate-pulse rounded"})]})]})}),(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-4",children:[1,2,3,4].map(a=>(0,b.jsxs)("div",{className:"space-y-2 rounded-lg border p-4",children:[(0,b.jsx)("div",{className:"bg-muted h-4 w-20 animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-6 w-32 animate-pulse rounded"})]},a))}),(0,b.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,b.jsxs)("div",{className:"space-y-6 lg:col-span-2",children:[(0,b.jsxs)("div",{className:"space-y-4 rounded-lg border p-6",children:[(0,b.jsx)("div",{className:"bg-muted h-6 w-32 animate-pulse rounded"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"bg-muted h-4 w-full animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-4 w-3/4 animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-4 w-2/3 animate-pulse rounded"})]})]}),(0,b.jsxs)("div",{className:"space-y-4 rounded-lg border p-6",children:[(0,b.jsx)("div",{className:"bg-muted h-6 w-32 animate-pulse rounded"}),(0,b.jsx)("div",{className:"space-y-3",children:[1,2,3,4].map(a=>(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("div",{className:"bg-muted h-4 w-48 animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-4 w-24 animate-pulse rounded"})]},a))})]}),(0,b.jsx)("div",{className:"space-y-4 rounded-lg border p-6",children:(0,b.jsx)("div",{className:"space-y-2",children:[1,2,3].map(a=>(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("div",{className:"bg-muted h-4 w-24 animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-4 w-32 animate-pulse rounded"})]},a))})})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-4 rounded-lg border p-6",children:[(0,b.jsx)("div",{className:"bg-muted h-6 w-24 animate-pulse rounded"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"bg-muted h-4 w-full animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-4 w-3/4 animate-pulse rounded"})]})]}),(0,b.jsxs)("div",{className:"space-y-4 rounded-lg border p-6",children:[(0,b.jsx)("div",{className:"bg-muted h-6 w-24 animate-pulse rounded"}),(0,b.jsx)("div",{className:"space-y-2",children:[1,2,3].map(a=>(0,b.jsx)("div",{className:"bg-muted h-10 w-full animate-pulse rounded"},a))})]}),(0,b.jsxs)("div",{className:"space-y-4 rounded-lg border p-6",children:[(0,b.jsx)("div",{className:"bg-muted h-6 w-24 animate-pulse rounded"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"bg-muted h-4 w-full animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-4 w-2/3 animate-pulse rounded"})]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex gap-4 border-b",children:[1,2,3].map(a=>(0,b.jsx)("div",{className:"bg-muted h-10 w-24 animate-pulse rounded-t"},a))}),(0,b.jsx)("div",{className:"space-y-3",children:[1,2,3].map(a=>(0,b.jsx)("div",{className:"bg-muted h-20 w-full animate-pulse rounded"},a))})]})]})})}async function m({params:a}){let{id:d}=await a;return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(l,{}),children:(0,b.jsx)(k,{estimateId:d})})}a.s(["default",()=>m],616451)},37652,a=>{a.v(b=>Promise.all(["server/chunks/ssr/apps_web_src_lib_auth_company-context_ts_732d588b._.js"].map(b=>a.l(b))).then(()=>b(480513)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__1400676a._.js.map