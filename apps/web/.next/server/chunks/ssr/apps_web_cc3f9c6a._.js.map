{"version":3,"sources":["../../../../../../apps/web/src/actions/payments/collect-manual-payment.ts","../../../../../../apps/web/.next-internal/server/app/%28dashboard%29/dashboard/work/invoices/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["/**\n * Collect Manual Payment Server Action\n *\n * Handles payment collection by CSRs/staff for customer invoices.\n *\n * Supports:\n * - Cash payments (manual record)\n * - Check payments (manual record with check number)\n * - Card payments (processed via Adyen)\n * - ACH payments (processed via Adyen)\n */\n\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport {\n\tgetPaymentProcessor,\n\tupdateTrustScoreAfterPayment,\n} from \"@/lib/payments/processor\";\nimport type { PaymentChannel } from \"@/lib/payments/processor-types\";\nimport { createClient } from \"@/lib/supabase/server\";\n\ntype CollectPaymentResult = {\n\tsuccess: boolean;\n\terror?: string;\n\tpaymentId?: string;\n\ttransactionId?: string;\n};\n\ntype CollectPaymentParams = {\n\tinvoiceId: string;\n\tcompanyId: string;\n\tcustomerId: string;\n\tpaymentMethod: \"cash\" | \"check\" | \"card\" | \"ach\";\n\tamount: number; // In cents\n\tnotes?: string;\n\tcheckNumber?: string;\n\tcardDetails?: {\n\t\tcardNumber: string;\n\t\tcardExpiry: string;\n\t\tcardCvc: string;\n\t\tcardName: string;\n\t};\n\tachDetails?: {\n\t\taccountNumber: string;\n\t\troutingNumber: string;\n\t\taccountName: string;\n\t};\n};\n\nexport async function collectManualPayment(\n\tparams: CollectPaymentParams,\n): Promise<CollectPaymentResult> {\n\ttry {\n\t\tconst {\n\t\t\tinvoiceId,\n\t\t\tcompanyId,\n\t\t\tcustomerId,\n\t\t\tpaymentMethod,\n\t\t\tamount,\n\t\t\tnotes,\n\t\t\tcheckNumber,\n\t\t\tcardDetails: _cardDetails,\n\t\t\tachDetails: _achDetails,\n\t\t} = params;\n\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\treturn { success: false, error: \"Database unavailable\" };\n\t\t}\n\n\t\t// Verify user is authenticated\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\n\t\tif (!user) {\n\t\t\treturn { success: false, error: \"Unauthorized\" };\n\t\t}\n\n\t\t// Verify user has access to this company\n\t\tconst { data: membership } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\"role\")\n\t\t\t.eq(\"user_id\", user.id)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"status\", \"active\")\n\t\t\t.single();\n\n\t\tif (!membership) {\n\t\t\treturn { success: false, error: \"No access to this company\" };\n\t\t}\n\n\t\t// Get invoice details\n\t\tconst { data: invoice, error: invoiceError } = await supabase\n\t\t\t.from(\"invoices\")\n\t\t\t.select(\"id, invoice_number, total_amount, status, job_id\")\n\t\t\t.eq(\"id\", invoiceId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (invoiceError || !invoice) {\n\t\t\treturn { success: false, error: \"Invoice not found\" };\n\t\t}\n\n\t\tif (invoice.status === \"paid\") {\n\t\t\treturn { success: false, error: \"Invoice is already paid\" };\n\t\t}\n\n\t\tlet transactionId: string;\n\t\tlet processorType: string = \"manual\";\n\n\t\t// Process payment based on method\n\t\tif (paymentMethod === \"cash\" || paymentMethod === \"check\") {\n\t\t\t// Manual payments - just record them\n\t\t\ttransactionId = `manual_${Date.now()}`;\n\t\t\tprocessorType = \"manual\";\n\t\t} else {\n\t\t\t// Card or ACH - use payment processor\n\t\t\tconst channel: PaymentChannel = paymentMethod === \"card\" ? \"online\" : \"ach\";\n\n\t\t\tconst processor = await getPaymentProcessor(companyId, {\n\t\t\t\tamount,\n\t\t\t\tchannel,\n\t\t\t});\n\n\t\t\tif (!processor) {\n\t\t\t\t// No processor configured - allow in development\n\t\t\t\tconst isDevelopment = process.env.NODE_ENV === \"development\";\n\n\t\t\t\tif (isDevelopment) {\n\t\t\t\t\ttransactionId = `dev_txn_${Date.now()}`;\n\t\t\t\t\tprocessorType = \"manual\";\n\t\t\t\t} else {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror:\n\t\t\t\t\t\t\t\"Payment processing is not configured. Please set up payment processors in settings.\",\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Process through the payment processor\n\t\t\t\tconst paymentResponse = await processor.processPayment({\n\t\t\t\t\tamount,\n\t\t\t\t\tcurrency: \"USD\",\n\t\t\t\t\tinvoiceId,\n\t\t\t\t\tcustomerId,\n\t\t\t\t\tchannel,\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\tinvoice_number: invoice.invoice_number,\n\t\t\t\t\t\tpayment_method: paymentMethod,\n\t\t\t\t\t\tcollected_by: user.id,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tif (!paymentResponse.success) {\n\t\t\t\t\tawait updateTrustScoreAfterPayment(companyId, false, amount);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror:\n\t\t\t\t\t\t\tpaymentResponse.error ||\n\t\t\t\t\t\t\tpaymentResponse.failureMessage ||\n\t\t\t\t\t\t\t\"Payment processing failed\",\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (paymentResponse.status === \"requires_action\") {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror:\n\t\t\t\t\t\t\t\"Additional authentication required. Customer should use the online payment portal.\",\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\ttransactionId = paymentResponse.transactionId || `txn_${Date.now()}`;\n\t\t\t\tprocessorType = \"adyen\";\n\n\t\t\t\tawait updateTrustScoreAfterPayment(companyId, true, amount);\n\t\t\t}\n\t\t}\n\n\t\t// Calculate if this is a partial or full payment\n\t\tconst remainingAmount = invoice.total_amount - amount;\n\t\tconst newStatus = remainingAmount <= 0 ? \"paid\" : \"partial\";\n\n\t\t// Create payment record\n\t\tconst paymentNumber = `PAY-${Date.now()}`;\n\n\t\tconst { data: payment, error: paymentError } = await supabase\n\t\t\t.from(\"payments\")\n\t\t\t.insert({\n\t\t\t\tcompany_id: companyId,\n\t\t\t\tcustomer_id: customerId,\n\t\t\t\tinvoice_id: invoiceId,\n\t\t\t\tjob_id: invoice.job_id,\n\t\t\t\tpayment_number: paymentNumber,\n\t\t\t\tamount,\n\t\t\t\tcurrency: \"USD\",\n\t\t\t\tpayment_method: paymentMethod,\n\t\t\t\tpayment_type: \"payment\",\n\t\t\t\tstatus: \"completed\",\n\t\t\t\tcheck_number: checkNumber || null,\n\t\t\t\tnotes,\n\t\t\t\tnet_amount: amount,\n\t\t\t\tprocessor_fee: 0,\n\t\t\t\trefunded_amount: 0,\n\t\t\t\tis_reconciled: false,\n\t\t\t\tprocessed_at: new Date().toISOString(),\n\t\t\t\tprocessed_by: user.id,\n\t\t\t})\n\t\t\t.select(\"id\")\n\t\t\t.single();\n\n\t\tif (paymentError) {\n\t\t\treturn { success: false, error: paymentError.message };\n\t\t}\n\n\t\t// Update invoice status\n\t\tconst invoiceUpdate: Record<string, unknown> = {\n\t\t\tstatus: newStatus,\n\t\t\tupdated_at: new Date().toISOString(),\n\t\t};\n\n\t\tif (newStatus === \"paid\") {\n\t\t\tinvoiceUpdate.paid_at = new Date().toISOString();\n\t\t\tinvoiceUpdate.payment_method = paymentMethod;\n\t\t}\n\n\t\tconst { error: updateError } = await supabase\n\t\t\t.from(\"invoices\")\n\t\t\t.update(invoiceUpdate)\n\t\t\t.eq(\"id\", invoiceId);\n\n\t\tif (updateError) {\n\t\t\t// Payment was created but invoice update failed - log but don't fail\n\t\t\tconsole.error(\"[CollectPayment] Failed to update invoice:\", updateError);\n\t\t}\n\n\t\t// Log transaction\n\t\tawait supabase.from(\"payment_processor_transactions\").insert({\n\t\t\tcompany_id: companyId,\n\t\t\tinvoice_id: invoiceId,\n\t\t\tprocessor_type: processorType,\n\t\t\ttransaction_id: transactionId,\n\t\t\tamount,\n\t\t\tcurrency: \"USD\",\n\t\t\tstatus: \"success\",\n\t\t\tchannel: paymentMethod === \"card\" ? \"online\" : paymentMethod === \"ach\" ? \"ach\" : \"manual\",\n\t\t\tmetadata: {\n\t\t\t\tpayment_method: paymentMethod,\n\t\t\t\tcheck_number: checkNumber,\n\t\t\t\tcollected_by: user.id,\n\t\t\t\tnotes,\n\t\t\t},\n\t\t});\n\n\t\t// Revalidate paths\n\t\trevalidatePath(`/dashboard/work/invoices/${invoiceId}`);\n\t\trevalidatePath(\"/dashboard/work/invoices\");\n\t\trevalidatePath(\"/dashboard/work/payments\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tpaymentId: payment.id,\n\t\t\ttransactionId,\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"[CollectPayment] Error:\", error);\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Payment collection failed\",\n\t\t};\n\t}\n}\n","export {getCurrentUserRole as '001f005176797ef23488068124fb9a744915a477de'} from 'ACTIONS_MODULE0'\nexport {canDeleteTeamMember as '406f6624261c6dd1a908026fa1408a3f6d507b6e7d'} from 'ACTIONS_MODULE0'\nexport {getPayrixMerchantAccount as '40704f0e856ad801ef93b43436f219a36f7c0efd2c'} from 'ACTIONS_MODULE1'\nexport {getWebRTCCredentials as '000478fbf5363dae5000d525663da13e29908cb952'} from 'ACTIONS_MODULE2'\nexport {transcribeCallRecording as '4002f454c46f4c21ca6e9e26362583ccff69c9f914'} from 'ACTIONS_MODULE2'\nexport {getCompanyPhoneNumbers as '4019cf9f81eb3c06f82b5c2f8eb042f3d95d91e933'} from 'ACTIONS_MODULE2'\nexport {getCallRoutingRules as '40247c617842c31b242455a0961cbd2c3297606a16'} from 'ACTIONS_MODULE2'\nexport {updateCallRoutingRule as '40413bfa888916480edbc33ebb812158fddf960f89'} from 'ACTIONS_MODULE2'\nexport {startCallRecording as '404e47931374ad2a1b54bc11f357703790f6104530'} from 'ACTIONS_MODULE2'\nexport {transferActiveCall as '405a16958f97c37bd4b5711bd8761510bdab55839f'} from 'ACTIONS_MODULE2'\nexport {searchPhoneNumbers as '406864ae05b8b51c66cc2c335999e5011a41cb521f'} from 'ACTIONS_MODULE2'\nexport {makeCall as '40b2df540ec465c5dc19545c96486485bb50b5633b'} from 'ACTIONS_MODULE2'\nexport {sendTextMessage as '40d050abdabe2ee7293436c505c5f27b4408a2f27c'} from 'ACTIONS_MODULE2'\nexport {stopCallRecording as '40d5cc291162e2fd61245bdb851d5e8ed609e4ed19'} from 'ACTIONS_MODULE2'\nexport {sendMMSMessage as '40edd91786b2a482e617fb16f2474d26ec295435e7'} from 'ACTIONS_MODULE2'\nexport {purchasePhoneNumber as '40fd6a80b32792fab749933f98f07503d8e94c0305'} from 'ACTIONS_MODULE2'\nexport {deleteCallRoutingRule as '607d0f958daf66b2a0d5277cdda17600dace5156bb'} from 'ACTIONS_MODULE2'\nexport {toggleCallRoutingRule as '60853f1e409364f7e171e27229217994ff224414e6'} from 'ACTIONS_MODULE2'\nexport {createServiceSupabaseClient as '00a13dbd00149949fc1367d3e76ae7d789e07f5321'} from 'ACTIONS_MODULE3'\nexport {ensureMessagingBranding as '606753f8910b46d5792f4bdeb457cdf29d1a8bbadc'} from 'ACTIONS_MODULE4'\nexport {ensureMessagingCampaign as '70a648f43fa62ae3dcf2070eb90413e96e81591e77'} from 'ACTIONS_MODULE4'\nexport {checkTelnyxVerificationStatus as '007505a78985e53e083a498c97761ed8a463d3d379'} from 'ACTIONS_MODULE5'\nexport {submitAutomatedVerification as '4087f0badccd6aaf6a28b640ab4bbc513f0832d105'} from 'ACTIONS_MODULE5'\nexport {registerCompanyFor10DLC as '40ae25402a089e45aa071d979e8cc6ad136205cc98'} from 'ACTIONS_MODULE5'\nexport {sendVerificationSubmittedEmail as '70f58c5ba46ef02b620d7dc87bae8fc83f6d480755'} from 'ACTIONS_MODULE6'\nexport {sendEmail as '40f8c061cf84f884e77af3425bc24b8a8d72f598fb'} from 'ACTIONS_MODULE7'\nexport {handleComplaintWebhook as '6045f8436f9cdfdadb7bfe3955677adfc5f4102de0'} from 'ACTIONS_MODULE7'\nexport {handleBounceWebhook as '78a8ea4f1cfa571a366adccf36ac04b1c85d61ae2b'} from 'ACTIONS_MODULE7'\nexport {runHealthCheckForAllDomains as '00c53a1f02416c3261983f8096f19a3450bfd51775'} from 'ACTIONS_MODULE8'\nexport {getDomainHealth as '400b8fb96146bfd004a3166563a5ab5536bb610c70'} from 'ACTIONS_MODULE8'\nexport {recordDeliveryEvent as '404d6f2891af89c71d5bde33d110a216bdd3ee4729'} from 'ACTIONS_MODULE8'\nexport {getCompanyDomainsHealth as '405c57a8fed352b8679525b56014eb8c49105c850c'} from 'ACTIONS_MODULE8'\nexport {processResendWebhookEvent as '40ad037af6f6ab1a3004746d3a1b65afa65527002d'} from 'ACTIONS_MODULE8'\nexport {generateDeliverabilityReport as '40ecf2c792e84ef4b898fda98ec27277b4a9dddef2'} from 'ACTIONS_MODULE8'\nexport {resetHourlyCounters as '004cdde5e6ae8991bab4ba61ae40647c2b823200ba'} from 'ACTIONS_MODULE9'\nexport {resetDailyCounters as '006acf41615a2f7795c47b6d7a3016e18300f2ad17'} from 'ACTIONS_MODULE9'\nexport {incrementEmailCounter as '4029b163c1c0acfd806352a72fe8030c8ae4f7f8ac'} from 'ACTIONS_MODULE9'\nexport {getCompanyActiveDomain as '407a5a7d0a7dd7989a963eb2485a3527c1dcb20a70'} from 'ACTIONS_MODULE9'\nexport {checkRateLimit as '40af86a915f04df8d7cc189fe26e45e0cc24663080'} from 'ACTIONS_MODULE9'\nexport {isGmailIntegrationEnabled as '00fe74bdf14126b5ad89e9480e82978d6357f356b3'} from 'ACTIONS_MODULE10'\nexport {getUserGmailTokens as '400ce95360aaffa14a99dfdf969ba5166c69a59eb6'} from 'ACTIONS_MODULE10'\nexport {disconnectCompanyGmail as '401d3d830065dd7c4777fad67f642392f48735c4ab'} from 'ACTIONS_MODULE10'\nexport {disconnectUserGmail as '404575d602ef4c60c0058b592b8c3e42fbcd13fc4c'} from 'ACTIONS_MODULE10'\nexport {getCompanyEmailProvider as '40787b1598849126560f9f0b0f8fe8967338c7bf28'} from 'ACTIONS_MODULE10'\nexport {getCompanyGmailTokens as '40beeb56302a20d27cd8ba7a0988310f855633d7e6'} from 'ACTIONS_MODULE10'\nexport {refreshUserGmailToken as '602fab67313b110e6ccb66e54b1e16450b2a772cc7'} from 'ACTIONS_MODULE10'\nexport {sendCompanyGmailEmail as '60302947fc4caffa53a719728f3c2cebace926098c'} from 'ACTIONS_MODULE10'\nexport {syncUserInbox as '603643b13bf288cc628303bb4d12df0311b11434c7'} from 'ACTIONS_MODULE10'\nexport {checkCompanyGmailHealth as '60856182db5eaec7f85eda2a5a94c5d7d3524325d6'} from 'ACTIONS_MODULE10'\nexport {refreshCompanyGmailToken as '60eeb51685ac265a4ad793a230a515fe6e462f16f4'} from 'ACTIONS_MODULE10'\nexport {fetchUserInbox as '708daa303e36e37247e22b5b828b6aad8c73ac283b'} from 'ACTIONS_MODULE10'\nexport {setCompanyEmailProvider as '70dd3bc4222a87350dc137fa9cbcb849fa1913b397'} from 'ACTIONS_MODULE10'\nexport {storeGmailMessage as '78d41ef818e75fef94d65a87ea1f0faf418132e3c5'} from 'ACTIONS_MODULE10'\nexport {storeUserGmailTokens as '7e3a356960ddd52a3fa4dc6d981ae7202a59eb9a3d'} from 'ACTIONS_MODULE10'\nexport {storeCompanyGmailTokens as '7f06df826c4fff42950e712c0f548254e275be2a52'} from 'ACTIONS_MODULE10'\nexport {getProviderHealthDashboard as '00a122f9d5fe3a1603c636c3a251886129b66154f8'} from 'ACTIONS_MODULE11'\nexport {checkProviderAlert as '40c7885bdc4fe4cdd5f57e78579230c58088adbef4'} from 'ACTIONS_MODULE11'\nexport {cleanupOldEvents as '40d3c4ceeaee653aa257a28ed429a7fd272fa9fb66'} from 'ACTIONS_MODULE11'\nexport {recordProviderEvent as '40e06418f4b93b40c84a25511e0468e1e8a41ddecf'} from 'ACTIONS_MODULE11'\nexport {getProviderStats as '60c643a41ce1a8e6cc8338da6e2f3678c386910460'} from 'ACTIONS_MODULE11'\nexport {recordSendFailure as '78255c3fa8c9facf7c3f353202f2907836e8eb5539'} from 'ACTIONS_MODULE11'\nexport {recordSendSuccess as '783861d25688b32ba086bbe9e45444975c36a1b285'} from 'ACTIONS_MODULE11'\nexport {recordFallbackTriggered as '78766431b437b16f7cb00b4d64a2f3be5e092ed724'} from 'ACTIONS_MODULE11'\nexport {deleteNotification as '40fab1894acc5e3d1fdd8d8c6128a7cecee06e7e6a'} from 'ACTIONS_MODULE12'\nexport {markAllAsRead as '00cf212b0097820096122537beac12e3403b97d564'} from 'ACTIONS_MODULE12'\nexport {markAsRead as '4094cf679b4a10ca0f969f4fc1b55602aac4e0fbc3'} from 'ACTIONS_MODULE12'\nexport {makeCall as '40b2df540ec465c5dc19545c96486485bb50b5633b'} from 'ACTIONS_MODULE2'\nexport {getWebRTCCredentials as '000478fbf5363dae5000d525663da13e29908cb952'} from 'ACTIONS_MODULE2'\nexport {signOut as '0043ae510c3322ea499beb9e1bb77d06afb4ef19bd'} from 'ACTIONS_MODULE13'\nexport {switchCompany as '4097c3c574342661f9a3c8244961d001234449f36f'} from 'ACTIONS_MODULE14'\nexport {updateUserStatus as '4081009dd4dff14ff4ece62648bad23a83f2f9f63c'} from 'ACTIONS_MODULE15'\nexport {getTotalUnreadCountAction as '00ebc03a4ffc993aea7ec2e541686105c2bace2437'} from 'ACTIONS_MODULE16'\nexport {getCompanyPendingActions as '40e9589cb639f2902eb841bedc1247d966486d6fd7'} from 'ACTIONS_MODULE17'\nexport {checkIsCompanyOwner as '001be5cf82b793f19f6a7d010c91c14577fa7a130d'} from 'ACTIONS_MODULE17'\nexport {getCustomerByPhone as '6013add076e3eaed7dc37e8b800ce977d5abb8d49a'} from 'ACTIONS_MODULE18'\nexport {startCallRecording as '404e47931374ad2a1b54bc11f357703790f6104530'} from 'ACTIONS_MODULE2'\nexport {stopCallRecording as '40d5cc291162e2fd61245bdb851d5e8ed609e4ed19'} from 'ACTIONS_MODULE2'\nexport {deleteCustomer as '4082b52123c24a95685a53c36313418a95c259c65b'} from 'ACTIONS_MODULE18'\nexport {searchCustomers as '60193685409a9d118f1b364e14ecf57d05fa5638a9'} from 'ACTIONS_MODULE18'\nexport {getCustomersForDialer as '0077abd0cb1e555f91adaa482ad0b2f565bbd0629a'} from 'ACTIONS_MODULE18'\nexport {getPendingSupportSessions as '000f90f949d6a2f5484d061d5a738a59a8c846aeaa'} from 'ACTIONS_MODULE19'\nexport {getActiveSupportSessions as '00665c1bbcd52d612d5bb4bf3be5e7fc75554132e6'} from 'ACTIONS_MODULE19'\nexport {approveSupportSessionRequest as '602e89ae7ace85fc30cd3b4b1dd865d517c0cb1cd5'} from 'ACTIONS_MODULE19'\nexport {rejectSupportSessionRequest as '60886af124323873afd4d5b64bb4143abbcba2c154'} from 'ACTIONS_MODULE19'\nexport {endActiveSupportSession as '40369e8ea4eced7bdaef8203d369469ee7b630db8c'} from 'ACTIONS_MODULE19'\nexport {createEmailFolderAction as '408d3694fd0dd48e424f53c9bf5083b946ab3ec990'} from 'ACTIONS_MODULE20'\nexport {getEmailFolderCountsAction as '009e962eae57bf128b2023081fd7259048edd8884a'} from 'ACTIONS_MODULE16'\nexport {getEmailFoldersAction as '00235a0ba91f1ba226f33fa40dcf4c93a2c3548c70'} from 'ACTIONS_MODULE20'\nexport {deleteEmailFolderAction as '40c55f8e0922f2c7fd8d502e4c75395bf5f0470430'} from 'ACTIONS_MODULE20'\nexport {searchVendors as '404a3266e0319dbd8c24fec80bb69ecfe029d2a768'} from 'ACTIONS_MODULE21'\nexport {getSmsFolderCountsAction as '0006f7bd89b72f0836ec7bf4db73019f1b32e6c24a'} from 'ACTIONS_MODULE22'\nexport {updateEntityTags as '70ff12ee81a60340f786414d0baa7af58484dd7488'} from 'ACTIONS_MODULE23'\nexport {collectManualPayment as '40b886386a6f7298961914ae721c16cba685c0df71'} from 'ACTIONS_MODULE24'\n"],"names":[],"mappings":"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"}