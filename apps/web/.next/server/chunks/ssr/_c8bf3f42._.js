module.exports=[311487,a=>{"use strict";async function b(a,b,c,d){let{data:e,error:f}=await a.rpc("has_role",{user_uuid:b,required_role:c,company_uuid:d});return!f&&!0===e}async function c(a,b,c){let{data:d,error:e}=await a.rpc("get_user_role",{user_uuid:b,company_uuid:c});return e?null:d}async function d(a,b,c,d){let{data:e,error:f}=await a.rpc("has_permission",{user_uuid:b,permission_key:c,company_uuid:d});return!f&&!0===e}async function e(a,b,c){let{data:d,error:e}=await a.rpc("is_company_owner",{user_uuid:b,company_uuid:c});return!e&&!0===d}a.s(["getUserRole",()=>c,"hasPermission",()=>d,"hasRole",()=>b,"isCompanyOwner",()=>e])},997053,a=>{"use strict";a.i(311487),a.s([])},288344,a=>{"use strict";var b=a.i(780195);a.i(218188);var c=a.i(146057);a.i(467361);var d=a.i(445074);a.i(997053);var e=a.i(311487),f=a.i(974406),g=a.i(136874),h=a.i(395731);async function i(){return(0,f.withErrorHandling)(async()=>{let a=await (0,g.createClient)();if(!a)throw Error("Database connection not available");let{data:{user:b}}=await a.auth.getUser();if(!b)throw Error("Not authenticated");let c=await (0,d.getActiveCompanyId)();if(!c)throw Error("No active company");return await (0,e.getUserRole)(a,b.id,c)})}async function j(a){return(0,f.withErrorHandling)(async()=>{let b=await (0,g.createClient)();if(!b)throw Error("Database connection not available");let c=await (0,d.getActiveCompanyId)();if(!c)throw Error("No active company");let{data:e,error:f}=await b.from("company_memberships").select("user_id, role").eq("id",a).eq("company_id",c).single();if(f||!e)throw Error("Team member not found");let{data:h}=await b.from("companies").select("owner_id").eq("id",c).single();return h&&h.owner_id===e.user_id?{canDelete:!1,reason:"Cannot delete company owner. Transfer ownership first before removing this team member."}:{canDelete:!0}})}c.z.object({teamMemberId:c.z.string().uuid(),newRole:c.z.enum(["owner","admin","manager","dispatcher","technician","csr"]),reason:c.z.string().optional()}),c.z.object({teamMemberId:c.z.string().uuid(),permissions:c.z.record(c.z.string(),c.z.boolean())}),(0,h.ensureServerEntryExports)([i,j]),(0,b.registerServerReference)(i,"001f005176797ef23488068124fb9a744915a477de",null),(0,b.registerServerReference)(j,"406f6624261c6dd1a908026fa1408a3f6d507b6e7d",null),a.s(["canDeleteTeamMember",()=>j,"getCurrentUserRole",()=>i])},307641,a=>{"use strict";var b=a.i(780195),c=a.i(218188),d=a.i(146057),e=a.i(136874),f=a.i(395731);async function g(){let a=await (0,e.createClient)();if(!a)throw Error("Supabase client not configured");let{data:{user:b},error:c}=await a.auth.getUser();if(c||!b)throw Error("Not authenticated");let{data:d,error:f}=await a.from("company_memberships").select("company_id").eq("user_id",b.id).eq("status","active").single();if(f||!d)throw Error("No active company found");return{userId:b.id,companyId:d.company_id,supabase:a}}d.z.object({title:d.z.string().min(1,"Contract title is required"),description:d.z.string().optional(),content:d.z.string().min(1,"Contract content is required"),jobId:d.z.string().optional(),estimateId:d.z.string().optional(),invoiceId:d.z.string().optional(),contractType:d.z.enum(["service","maintenance","custom"]),validFrom:d.z.string().optional(),validUntil:d.z.string().optional(),terms:d.z.string().optional(),notes:d.z.string().optional(),signerName:d.z.string().optional(),signerEmail:d.z.string().email("Valid email required").min(1,"Signer email is required"),signerTitle:d.z.string().optional(),signerCompany:d.z.string().optional()}).refine(a=>a.estimateId||a.invoiceId,{message:"Contract must be linked to either an estimate or invoice",path:["estimateId"]});let h=d.z.object({contractId:d.z.string().min(1,"Contract ID is required"),signature:d.z.string().min(1,"Signature is required"),signerName:d.z.string().min(1,"Signer name is required"),signerEmail:d.z.string().email("Valid email required"),signerTitle:d.z.string().optional(),signerCompany:d.z.string().optional(),ipAddress:d.z.string().optional()}),i=(a,b)=>{};async function j(a){try{let{companyId:b,supabase:d,userId:e}=await g(),{data:f}=await d.from("contracts").select("status").eq("id",a).eq("company_id",b).single();if(f?.status==="signed"||f?.status==="active")return{success:!1,error:"Cannot archive signed or active contracts. Signed contracts must be retained for records."};let h=new Date().toISOString(),j=new Date(Date.now()+7776e6).toISOString(),{error:k}=await d.from("contracts").update({deleted_at:h,deleted_by:e,archived_at:h,permanent_delete_scheduled_at:j,status:"archived"}).eq("id",a).eq("company_id",b);if(k)throw i("Error archiving contract",k),Error("Failed to archive contract");return(0,c.revalidatePath)("/dashboard/work/contracts"),(0,c.revalidatePath)("/dashboard/settings/archive"),{success:!0}}catch(a){return{success:!1,error:"Failed to archive contract"}}}async function k(a){try{let b=h.parse({contractId:a.get("contractId"),signature:a.get("signature"),signerName:a.get("signerName"),signerEmail:a.get("signerEmail"),signerTitle:a.get("signerTitle"),signerCompany:a.get("signerCompany"),ipAddress:a.get("ipAddress")}),d=await (0,e.createClient)();if(!d)throw Error("Supabase client not configured");let{error:f}=await d.from("contracts").update({status:"signed",signature:b.signature,signer_name:b.signerName,signer_email:b.signerEmail,signer_title:b.signerTitle||null,signer_company:b.signerCompany||null,ip_address:b.ipAddress||null,signed_at:new Date().toISOString()}).eq("id",b.contractId);if(f)throw i("Error signing contract",f),Error("Failed to sign contract");return(0,c.revalidatePath)("/dashboard/work/contracts"),(0,c.revalidatePath)(`/dashboard/work/contracts/${b.contractId}`),{success:!0}}catch(a){if(a instanceof d.z.ZodError)return{success:!1,error:a.issues[0]?.message||"Validation error"};return{success:!1,error:"Failed to sign contract"}}}(0,f.ensureServerEntryExports)([j,k]),(0,b.registerServerReference)(j,"40801de9f07a4e8d8a8588c620f484e4e252c231ca",null),(0,b.registerServerReference)(k,"406958ced3b0e89447e1ace32b290ef9715c51c340",null),a.s(["archiveContract",()=>j,"signContract",()=>k])},441195,a=>{"use strict";var b=a.i(288344),c=a.i(307641);a.s([],838947),a.i(838947),a.s(["001f005176797ef23488068124fb9a744915a477de",()=>b.getCurrentUserRole,"406958ced3b0e89447e1ace32b290ef9715c51c340",()=>c.signContract,"406f6624261c6dd1a908026fa1408a3f6d507b6e7d",()=>b.canDeleteTeamMember],441195)},858982,a=>{a.v(b=>Promise.all(["server/chunks/ssr/3c0ae_next_4427392f._.js"].map(b=>a.l(b))).then(()=>b(857782)))}];

//# sourceMappingURL=_c8bf3f42._.js.map