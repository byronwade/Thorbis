module.exports=[116381,a=>{"use strict";var b=a.i(861467),c=a.i(916680),d=a.i(452168),e=a.i(805034),f=a.i(541087),g=a.i(337850),h=a.i(187056),i=a.i(854729),j=a.i(558520),k=a.i(190121),l=a.i(198803),m=a.i(94436),n=a.i(579741),n=n,o=a.i(744789),p=a.i(530762),q=a.i(246840),r=a.i(521995),s=a.i(27878),t=a.i(739044),u=a.i(171768),v=a.i(334044),w=a.i(339632),x=a.i(320091),y=a.i(300298),z=a.i(145679),A=a.i(337241),B=a.i(783281),C=a.i(156916),D=a.i(168542),E=a.i(315405),F=a.i(759815),G=a.i(622761),H=a.i(936035),I=a.i(737096),J=a.i(336137),K=a.i(339245),L=a.i(766153),M=a.i(984270),N=a.i(789815),O=a.i(898062);a.i(445255);var P=a.i(18170);a.i(297229);var Q=a.i(489904),R=a.i(700760),S=a.i(112932);function T({customer:a,fallbackName:c,fallbackEmail:d,fallbackPhone:e,className:f,size:g="default"}){let h=a?.email||d,i=a?.phone||e,j=(0,S.getCustomerDisplayName)(a?{...a,email:a.email||d}:null,c||d),k=!!a?.id,l=(0,S.getCustomerInitials)(a);return(0,b.jsxs)(Q.Popover,{children:[(0,b.jsx)(Q.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)("button",{type:"button",className:(0,R.cn)("inline-flex items-center gap-1 rounded-full border border-border/50 bg-muted/50 hover:bg-muted transition-colors cursor-pointer","sm"===g?"px-2 py-0.5 text-xs":"px-2.5 py-1 text-sm",f),children:[(0,b.jsx)("span",{className:"font-medium truncate max-w-[150px]",children:j}),(0,b.jsx)(L.ChevronDown,{className:(0,R.cn)("text-muted-foreground","sm"===g?"h-3 w-3":"h-3.5 w-3.5")})]})}),(0,b.jsxs)(Q.PopoverContent,{className:"w-72 p-0",align:"start",children:[(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3 mb-3",children:[(0,b.jsx)("div",{className:(0,R.cn)("flex items-center justify-center rounded-full bg-primary/10 text-primary font-semibold","sm"===g?"h-10 w-10 text-sm":"h-12 w-12 text-base"),children:l||(0,b.jsx)(x.User,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-semibold text-foreground truncate",children:j}),a?.company_name&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:a.company_name}),!k&&(0,b.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400 mt-1",children:"Not linked"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[h&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(N.Mail,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),(0,b.jsx)("a",{href:`mailto:${h}`,className:"text-foreground hover:text-primary truncate transition-colors",children:h})]}),i&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(O.Phone,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),(0,b.jsx)("a",{href:`tel:${i}`,className:"text-foreground hover:text-primary transition-colors",children:i})]}),!h&&!i&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground italic",children:"No contact info available"})]})]}),k&&(0,b.jsx)("div",{className:"border-t border-border px-4 py-3 bg-muted/30",children:(0,b.jsx)(P.Button,{variant:"outline",size:"sm",className:"w-full",asChild:!0,children:(0,b.jsxs)(z.default,{href:`/dashboard/customers/${a.id}`,children:[(0,b.jsx)("span",{children:"View Full Profile"}),(0,b.jsx)(M.ExternalLink,{className:"h-3.5 w-3.5 ml-1.5"})]})})})]})]})}var U=a.i(301784),V=a.i(809007),W=a.i(807833);a.i(400355);var X=a.i(694340);a.i(516775);var Y=a.i(560272);a.i(956852);var Z=a.i(90125);a.i(839984);var $=a.i(372712);a.i(413309);var _=a.i(54210);a.i(146697);var aa=a.i(778737);a.i(799390);var ab=a.i(985943),ac=a.i(127487);a.i(897346);var ad=a.i(75892);a.i(928414);var ae=a.i(745250),af=a.i(692569),ag=a.i(287580);function ah({initialEmails:a,initialInboxType:L,initialFolder:M,initialCategory:N,initialEmailId:O,companyId:Q}){let ah=(0,A.useRouter)(),ai=(0,A.useSearchParams)(),aj=(0,A.useParams)(),ak=ai?.get("inbox")||L,al=ai?.get("folder")||M,am=ai?.get("category")||N,an=aj?.id,ao=ai?.get("id"),ap=an||ao||O,[aq,ar]=(0,B.useTransition)(),[as,at]=(0,B.useState)(a),[au,av]=(0,B.useState)(!1),[aw,ax]=(0,B.useState)(null),[ay,az]=(0,B.useState)(()=>O&&a.emails&&a.emails.find(a=>a.id===O)||null),[aA,aB]=(0,B.useState)(()=>ay?{html:ay.body_html||null,text:ay.body||null}:null),[aC,aD]=(0,B.useState)(!1),[aE,aF]=(0,B.useState)(""),[aG,aH]=(0,B.useState)(""),aI=(0,B.useRef)(null),aJ=(0,B.useRef)(ay),{toggleSidebar:aK}=(0,ac.useSidebar)(),[aL,aM]=(0,B.useState)(null),[aN,aO]=(0,B.useState)(!1),[aP,aQ]=(0,B.useState)(!1),[aR,aS]=(0,B.useState)(""),[aT,aU]=(0,B.useState)(!1),[aV,aW]=(0,B.useState)(!1),aX=(0,af.useRoleStore)(a=>a.role),aY=aX===ag.USER_ROLES.OWNER||aX===ag.USER_ROLES.ADMIN;(0,B.useEffect)(()=>{if(ai?.get("compose")==="true"&&!aN){aO(!0),az(null),aB(null),aJ.current=null;let a=new URLSearchParams(ai?.toString()||"");a.delete("compose"),a.delete("to"),a.delete("name"),a.delete("customerId");let b=a.toString()?`/dashboard/communication/email?${a.toString()}`:"/dashboard/communication/email";ah.replace(b)}},[ai,ah,aN]),(0,B.useEffect)(()=>{let a=a=>{let b=a.target;"INPUT"!==b.tagName&&"TEXTAREA"!==b.tagName&&!b.isContentEditable&&("c"!==a.key||a.metaKey||a.ctrlKey||a.altKey||aN||(a.preventDefault(),aO(!0),az(null),aB(null),aJ.current=null))};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[aN]);let aZ=(0,B.useCallback)(async(a=!1)=>{av(!0),ax(null),ar(async()=>{try{let a=await (0,G.getEmailsAction)({limit:50,offset:0,type:"all",inboxType:ak,folder:"personal"===ak?al:void 0,category:"company"===ak?am:void 0,search:aE||void 0,sortBy:"created_at",sortOrder:"desc"}),b=a.emails.map(a=>{let b=a.to_address;if("string"==typeof a.to_address){let c=a.to_address.trim();if(c.startsWith("[")&&c.endsWith("]"))try{let c=JSON.parse(a.to_address);Array.isArray(c)&&c.length>0&&(b=c[0])}catch{}}return{...a,to_address:b}});at({...a,emails:b});let c=aJ.current;if(c){let b=a.emails.find(a=>a.id===c.id);b?(az(b),aJ.current=b):(az(null),aJ.current=null,aB(null))}}catch(b){console.error("Failed to fetch emails:",b);let a=b instanceof Error?b.message:"Failed to load emails";ax(a),C.toast.error("Failed to load emails",{description:a})}finally{av(!1)}})},[aE,al,ak,am]);(0,B.useEffect)(()=>{aE&&aZ()},[aE]);let a$=(0,B.useRef)(au);a$.current=au,(0,B.useEffect)(()=>{let a=setInterval(()=>{aN||a$.current||aZ()},3e4),b=()=>{aZ()};return window.addEventListener("email-received",b),window.addEventListener("email-sent",b),()=>{clearInterval(a),window.removeEventListener("email-received",b),window.removeEventListener("email-sent",b)}},[aZ,aN]);let a_=(0,B.useRef)(al),a0=(0,B.useRef)(ak),a1=(0,B.useRef)(am);(0,B.useEffect)(()=>{let a=al!==a_.current,b=ak!==a0.current,c=am!==a1.current;(a||b||c)&&(a_.current=al,a0.current=ak,a1.current=am,aZ())},[al,ak,am,aZ]),(0,B.useEffect)(()=>(aI.current&&clearTimeout(aI.current),aI.current=setTimeout(()=>{aF(aG)},300),()=>{aI.current&&clearTimeout(aI.current)}),[aG]);let a2=(0,B.useCallback)(a=>{az(a),aJ.current=a;let b=new URLSearchParams;al&&"inbox"!==al&&b.set("folder",al),b.set("id",a.id),ah.replace(`/dashboard/communication/email?${b.toString()}`,{scroll:!1}),a.body_html||a.body?(aB({html:a.body_html||null,text:a.body||null}),aD(!1)):(aD(!0),(0,F.fetchEmailContentAction)(a.id).then(a=>{a.success?aB({html:a.html||null,text:a.text||null}):aB({html:null,text:null})}).catch(()=>{aB({html:null,text:null})}).finally(()=>{aD(!1)})),a.read_at||(at(b=>({...b,emails:b.emails.map(b=>b.id===a.id?{...b,read_at:new Date().toISOString()}:b)})),(0,H.markEmailAsReadAction)({emailId:a.id}).then(a=>{a.success&&window.dispatchEvent(new CustomEvent("email-read"))}).catch(console.error))},[ah,al]);(0,B.useEffect)(()=>{if(!ap||ap!==aJ.current?.id)if(ap&&as?.emails){let a=as.emails.find(a=>a.id===ap);a&&(az(a),aJ.current=a,a.body_html||a.body?aB({html:a.body_html||null,text:a.body||null}):(aD(!0),(0,F.fetchEmailContentAction)(a.id).then(a=>{a.success?aB({html:a.html||null,text:a.text||null}):aB({html:null,text:null})}).catch(()=>{aB({html:null,text:null})}).finally(()=>{aD(!1)})),a.read_at||(at(b=>({...b,emails:b.emails.map(b=>b.id===a.id?{...b,read_at:new Date().toISOString()}:b)})),(0,H.markEmailAsReadAction)({emailId:a.id}).catch(console.error)))}else!ap&&ay&&(az(null),aJ.current=null,aB(null))},[ap,as?.emails]);let a3=(0,B.useCallback)(()=>{aZ(!0),C.toast.success("Refreshing emails...")},[aZ]),a4=(0,B.useCallback)(async a=>{try{if("archive"!==al&&(at(b=>({...b,emails:b.emails.filter(b=>b.id!==a),total:b.total-1})),ay?.id===a)){az(null),aB(null),aJ.current=null;let a=new URLSearchParams;al&&"inbox"!==al&&a.set("folder",al),ah.replace(`/dashboard/communication/email?${a.toString()}`,{scroll:!1})}let b=await (0,E.archiveEmailAction)(a);b.success?(C.toast.success("Email archived"),window.dispatchEvent(new CustomEvent("email-archived"))):(aZ(!1),C.toast.error("Failed to archive email",{description:b.error||"Unknown error"}))}catch(a){aZ(!1),C.toast.error("Failed to archive email")}},[aZ,al,ay,ah]),a5=(0,B.useCallback)(async()=>{if(!as?.emails||0===as.emails.length){C.toast.info("No emails to archive"),aU(!1);return}try{av(!0),aU(!1);let a=await (0,D.archiveAllEmailsAction)(al||"inbox");a.success?(C.toast.success(`Archived ${a.archived} email${1===a.archived?"":"s"}`),aZ(!1),az(null),aB(null),window.dispatchEvent(new CustomEvent("email-archived"))):C.toast.error("Failed to archive emails",{description:a.error||"Unknown error"})}catch(a){C.toast.error("Failed to archive emails")}finally{av(!1)}},[as,al,aZ]),a6=(0,B.useCallback)(async a=>{try{let b=as?.emails.find(b=>b.id===a),c=b?.tags||[],d=!(c.includes("spam")||b?.category==="spam");at(b=>d&&"spam"!==al||!d&&"spam"===al?{...b,emails:b.emails.filter(b=>b.id!==a),total:b.total-1}:{...b,emails:b.emails.map(b=>{if(b.id===a){let a=d?[...c,"spam"]:c.filter(a=>"spam"!==a);return{...b,tags:a.length>0?a:null,category:d?"spam":null}}return b})}),ay?.id===a&&(d&&"spam"!==al||!d&&"spam"===al)&&(az(null),aB(null),aJ.current=null),(await (0,J.toggleSpamEmailAction)(a)).success?(C.toast.success(d?"Email marked as spam":"Email removed from spam"),window.dispatchEvent(new CustomEvent("email-spam-toggled"))):(aZ(!1),C.toast.error("Failed to update spam status"))}catch{aZ(!1),C.toast.error("Failed to update spam status")}},[aZ,ay,al,as]),a7=(0,B.useCallback)(async a=>{try{let b=as?.emails.find(b=>b.id===a),c=b?.tags||[],d=!c.includes("starred");if(at(b=>{let e=b.emails.map(b=>{if(b.id===a){let a=d?[...c,"starred"]:c.filter(a=>"starred"!==a);return{...b,tags:a.length>0?a:null}}return b});if("starred"===al){let a=e.filter(a=>(a.tags||[]).includes("starred"));return{...b,emails:a,total:a.length}}return{...b,emails:e}}),ay?.id===a){let a=d?[...c,"starred"]:c.filter(a=>"starred"!==a);az({...ay,tags:a.length>0?a:null}),"starred"!==al||d||(az(null),aB(null))}(await (0,K.toggleStarEmailAction)(a)).success?window.dispatchEvent(new CustomEvent("email-starred-toggled")):(aZ(!1),C.toast.error("Failed to star email"))}catch{aZ(!1),C.toast.error("Failed to star email")}},[aZ,ay,al,as]),a8=(0,B.useCallback)(()=>{if(!ay)return;let a=`
			<!DOCTYPE html>
			<html>
			<head>
				<title>${ay.subject||"Email"}</title>
				<style>
					body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
					.header { border-bottom: 1px solid #e5e7eb; padding-bottom: 20px; margin-bottom: 20px; }
					.subject { font-size: 24px; font-weight: 600; margin-bottom: 12px; }
					.meta { color: #6b7280; font-size: 14px; }
					.meta-row { margin-bottom: 4px; }
					.body { line-height: 1.6; }
				</style>
			</head>
			<body>
				<div class="header">
					<div class="subject">${ay.subject||"No Subject"}</div>
					<div class="meta">
						<div class="meta-row"><strong>From:</strong> ${ay.from_name||""} &lt;${ay.from_address||"Unknown"}&gt;</div>
						<div class="meta-row"><strong>To:</strong> ${ay.to_address||"Unknown"}</div>
						<div class="meta-row"><strong>Date:</strong> ${new Date(ay.created_at).toLocaleString()}</div>
					</div>
				</div>
				<div class="body">
					${aA?.html||ay.body_html||aA?.text||ay.body||"No content"}
				</div>
			</body>
			</html>
		`,b=window.open("","_blank");b&&(b.document.write(a),b.document.close(),b.focus(),setTimeout(()=>b.print(),250))},[ay,aA]),a9=(0,B.useCallback)(()=>{if(!ay)return;let a=`----=_Part_${Date.now()}_${Math.random().toString(36).slice(2)}`,b=new Date(ay.created_at).toUTCString(),c=new Blob([`MIME-Version: 1.0
Date: ${b}
Subject: ${ay.subject||"No Subject"}
From: ${ay.from_name?`${ay.from_name} <${ay.from_address}>`:ay.from_address||"Unknown"}
To: ${ay.to_address||"Unknown"}
Content-Type: multipart/alternative; boundary="${a}"

--${a}
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 7bit

${aA?.text||ay.body||"No content"}

--${a}
Content-Type: text/html; charset="UTF-8"
Content-Transfer-Encoding: 7bit

${aA?.html||ay.body_html||"<p>No content</p>"}

--${a}--
`],{type:"message/rfc822"}),d=URL.createObjectURL(c),e=document.createElement("a");e.href=d;let f=(ay.subject||"email").replace(/[^a-z0-9\s-]/gi,"_").replace(/\s+/g,"_").slice(0,50)||"email";e.download=`${f}.eml`,document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(d),C.toast.success("Email downloaded")},[ay,aA]),ba=(0,B.useCallback)(async a=>{try{if(at(b=>({...b,emails:b.emails.filter(b=>b.id!==a),total:b.total-1})),ay?.id===a){az(null),aB(null),aJ.current=null;let a=new URLSearchParams;al&&"inbox"!==al&&a.set("folder",al),ah.replace(`/dashboard/communication/email?${a.toString()}`,{scroll:!1})}C.toast.success("Email moved to trash")}catch{aZ(!1),C.toast.error("Failed to delete email")}},[aZ,ay,al,ah]),bb=(0,B.useCallback)(async a=>{if(a){aW(!0);try{let b=await (0,I.retryFailedEmailAction)(a);b.success?(C.toast.success("Email sent successfully!"),aZ(!0)):C.toast.error("Failed to send email",{description:b.error||"Please try again later"})}catch(a){console.error("Failed to retry email:",a),C.toast.error("Failed to send email",{description:a instanceof Error?a.message:"Unknown error occurred"})}finally{aW(!1)}}},[aZ]),bc=!ay&&!aN,bd=ay||aN;return(0,b.jsxs)("div",{className:"flex h-full w-full flex-col overflow-hidden bg-sidebar",children:[(0,b.jsxs)("div",{className:"flex flex-1 overflow-hidden min-h-0 md:gap-2",children:[(0,b.jsx)("div",{className:(0,R.cn)("bg-card mb-1 shadow-sm flex flex-col overflow-hidden","w-full h-full","md:w-[400px] lg:w-[480px] md:rounded-tr-2xl",bc?"flex":"hidden md:flex"),children:(0,b.jsxs)("div",{className:"w-full h-full flex flex-col",children:[(0,b.jsx)("div",{className:"sticky top-0 z-15 flex items-center justify-between gap-1.5 p-2 pb-0 transition-colors bg-card",children:(0,b.jsx)("div",{className:"w-full",children:(0,b.jsx)("div",{className:"grid grid-cols-12 gap-2 mt-1",children:(0,b.jsxs)("div",{className:"col-span-12 flex gap-2",children:[(0,b.jsx)(P.Button,{variant:"ghost",size:"sm",onClick:aK,className:"h-10 w-10 p-0 md:h-8 md:w-8 shrink-0",title:"Toggle sidebar",children:(0,b.jsx)(o.PanelLeft,{className:"h-5 w-5 md:h-4 md:w-4 text-muted-foreground"})}),(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)($.Input,{type:"search",placeholder:"Search emails...",value:aG,onChange:a=>aH(a.target.value),className:"h-10 md:h-8 pl-9 pr-20 text-base md:text-sm border-input bg-white dark:bg-[#141414] dark:border-none"}),(0,b.jsx)("svg",{width:"10",height:"10",viewBox:"0 0 10 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"absolute left-3 top-1/2 -translate-y-1/2 fill-[#71717A] dark:fill-[#6F6F6F]",children:(0,b.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.81038 7.0756C6.18079 7.54011 5.40248 7.81466 4.56004 7.81466C2.46451 7.81466 0.765747 6.11589 0.765747 4.02037C0.765747 1.92484 2.46451 0.226074 4.56004 0.226074C6.65557 0.226074 8.35433 1.92484 8.35433 4.02037C8.35433 4.8628 8.07978 5.64112 7.61527 6.27071L9.70535 8.36078C9.92761 8.58305 9.92761 8.94341 9.70535 9.16568C9.48308 9.38794 9.12272 9.38794 8.90046 9.16568L6.81038 7.0756ZM7.21604 4.02037C7.21604 5.48724 6.02691 6.67637 4.56004 6.67637C3.09317 6.67637 1.90403 5.48724 1.90403 4.02037C1.90403 2.5535 3.09317 1.36436 4.56004 1.36436C6.02691 1.36436 7.21604 2.5535 7.21604 4.02037Z"})}),aG&&(0,b.jsx)("button",{onClick:()=>aH(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:(0,b.jsx)(y.X,{className:"h-3 w-3"})})]}),(0,b.jsx)(P.Button,{variant:"ghost",size:"sm",onClick:a3,disabled:au,className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"Refresh",children:(0,b.jsx)(q.RefreshCw,{className:`h-5 w-5 md:h-4 md:w-4 text-muted-foreground ${au?"animate-spin":""}`})}),aY&&"archive"!==al&&as?.emails&&as.emails.length>0&&(0,b.jsx)(P.Button,{variant:"ghost",size:"sm",onClick:()=>aU(!0),disabled:au,className:"h-8 w-8 p-0 group/archive-all hover:bg-destructive/10",title:"Archive all emails",children:(0,b.jsx)(d.Archive,{className:"h-4 w-4 text-muted-foreground group-hover/archive-all:text-destructive transition-colors"})})]})})})}),(0,b.jsx)("div",{className:(0,R.cn)("bg-[#006FFE] relative z-5 h-0.5 w-full transition-opacity",au?"opacity-100 animate-pulse":"opacity-0")}),(0,b.jsx)("div",{className:"relative z-1 flex-1 overflow-hidden pt-0 min-h-0",children:(0,b.jsx)("div",{className:"hide-link-indicator flex h-full w-full",children:(0,b.jsx)("div",{className:"flex flex-1 flex-col",id:"mail-list-scroll",children:(0,b.jsx)(_.ScrollArea,{className:"scrollbar-none flex-1 overflow-x-hidden h-full",children:aw&&(!as?.emails||0===as.emails.length)?(0,b.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(c.AlertTriangle,{className:"h-8 w-8 text-destructive mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-sm text-destructive mb-2 font-medium",children:"Failed to load emails"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-4",children:aw}),(0,b.jsx)(P.Button,{variant:"outline",size:"sm",onClick:()=>aZ(),children:"Try Again"})]})}):as?.emails?.length?(0,b.jsx)("div",{className:"min-h-[200px] px-2",children:as.emails.map(a=>{let e=ay?.id===a.id;return(0,b.jsx)("div",{className:"select-none md:my-1",children:(0,b.jsxs)("div",{className:(0,R.cn)("hover:bg-accent group flex cursor-pointer flex-col items-start rounded-lg py-2 text-left text-sm transition-all hover:opacity-100 relative",e?"bg-accent opacity-100":"",a.read_at?"opacity-60":"opacity-100"),onClick:()=>a2(a),children:[(0,b.jsxs)("div",{className:"dark:bg-panelDark absolute right-2 z-25 flex -translate-y-1/2 items-center gap-1 rounded-xl border bg-white p-1 opacity-0 shadow-sm group-hover:opacity-100 top-[-1] transition-opacity duration-200",onClick:a=>a.stopPropagation(),children:[(0,b.jsx)(P.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 overflow-visible p-0 hover:bg-accent group/star",onClick:b=>{b.stopPropagation(),a7(a.id)},title:a.tags&&Array.isArray(a.tags)&&a.tags.includes("starred")?"Unstar":"Star",children:(0,b.jsx)(u.Star,{className:(0,R.cn)("h-4 w-4 transition-colors group-hover/star:text-yellow-500",a.tags&&Array.isArray(a.tags)&&a.tags.includes("starred")?"fill-yellow-500 text-yellow-500":"text-muted-foreground")})}),(0,b.jsx)(P.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:bg-accent group/spam",onClick:b=>{b.stopPropagation(),a6(a.id)},title:"spam"===a.category?"Not spam":"Spam",children:(0,b.jsx)(j.Flag,{className:(0,R.cn)("h-4 w-4 transition-colors group-hover/spam:text-orange-500","spam"===a.category?"fill-orange-500 text-orange-500":"text-muted-foreground")})}),(0,b.jsx)(P.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:bg-accent group/archive",onClick:b=>{b.stopPropagation(),a4(a.id)},title:"Archive",children:(0,b.jsx)(d.Archive,{className:"h-4 w-4 text-muted-foreground transition-colors group-hover/archive:text-blue-500"})})]}),(0,b.jsxs)("div",{className:"relative flex w-full items-center justify-between gap-4 px-2",children:[(0,b.jsx)(Y.Avatar,{className:"h-8 w-8 shrink-0 rounded-full border",children:(0,b.jsx)(Y.AvatarFallback,{className:"bg-white dark:bg-[#373737] text-[#9F9F9D] font-bold text-xs",children:a.from_address?.[0]?.toUpperCase()||"U"})}),(0,b.jsx)("div",{className:"flex w-full justify-between",children:(0,b.jsxs)("div",{className:"w-full",children:[(0,b.jsxs)("div",{className:"flex w-full flex-row items-center justify-between",children:[(0,b.jsx)("div",{className:"flex flex-row items-center gap-[4px]",children:(0,b.jsx)("span",{className:"font-bold text-md flex items-baseline gap-1 group-hover:opacity-100",children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("span",{className:"line-clamp-1 overflow-hidden text-sm",children:"outbound"===a.direction?a.to_address||"Unknown recipient":a.from_name||a.from_address||"Unknown sender"}),!a.read_at&&(0,b.jsx)("span",{className:"ml-0.5 size-2 rounded-full bg-[#006FFE]"})]})})}),(0,b.jsx)("p",{className:"text-muted-foreground text-nowrap text-xs font-normal opacity-70 transition-opacity group-hover:opacity-100 dark:text-[#8C8C8C]",children:a.created_at?new Date(a.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center gap-2",children:[(0,b.jsx)("p",{className:"mt-1 line-clamp-1 min-w-0 overflow-hidden text-sm text-[#8C8C8C] flex-1",children:a.subject||"No subject"}),(0,b.jsxs)("div",{className:"flex items-center gap-1 shrink-0",children:[a.customer?.id&&(0,b.jsxs)(z.default,{href:`/dashboard/customers/${a.customer.id}`,onClick:a=>a.stopPropagation(),className:"px-1.5 py-0.5 rounded text-[10px] bg-primary/10 text-primary hover:bg-primary/20 transition-colors flex items-center gap-0.5",title:`View ${(0,S.getCustomerDisplayName)(a.customer)} profile`,children:[(0,b.jsx)(x.User,{className:"h-2.5 w-2.5"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:(0,S.getCustomerDisplayName)(a.customer)})]}),"draft"===a.status&&(0,b.jsx)("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-muted text-muted-foreground",children:"Draft"}),"failed"===a.status&&(0,b.jsxs)(ae.Tooltip,{children:[(0,b.jsx)(ae.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-destructive/10 text-destructive cursor-help flex items-center gap-0.5",children:[(0,b.jsx)(c.AlertTriangle,{className:"h-2.5 w-2.5"}),"Failed"]})}),(0,b.jsxs)(ae.TooltipContent,{children:[(0,b.jsx)("p",{className:"font-medium",children:"Email failed to send"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Click email to retry or view details"})]})]}),"outbound"===a.direction&&"draft"!==a.status&&"failed"!==a.status&&(0,b.jsx)("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-blue-500/10 text-blue-600",children:"Sent"})]})]})]})})]})]})},a.id)})}):(0,b.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,b.jsx)("div",{className:"text-center",children:au?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading emails..."})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:aE?"No emails found":"No emails yet"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:aE?"Try adjusting your search terms":"Emails will appear here when received"})]})})})})})})})]})}),aN?(0,b.jsx)("div",{className:(0,R.cn)("bg-card mb-1 shadow-sm flex flex-col min-w-0 overflow-hidden","w-full h-full","md:rounded-tl-2xl md:flex-1",bd?"flex":"hidden md:flex"),children:(0,b.jsx)(V.EmailFullComposer,{companyId:Q,onClose:()=>aO(!1),onSent:()=>{aO(!1),aZ(!0)},className:"h-full"})}):ay?(0,b.jsx)("div",{className:(0,R.cn)("bg-card mb-1 shadow-sm flex flex-col min-w-0 overflow-hidden","w-full h-full","md:rounded-tl-2xl md:flex-1",bd?"flex":"hidden md:flex"),children:(0,b.jsx)("div",{className:"relative flex-1 min-h-0 flex flex-col",children:(0,b.jsxs)("div",{className:"bg-card relative flex flex-col overflow-hidden transition-all duration-300 h-full flex-1 min-h-0",children:[(0,b.jsxs)("div",{className:"sticky top-0 z-15 flex shrink-0 items-center justify-between gap-1.5 p-2 pb-0 transition-colors bg-card",children:[(0,b.jsxs)("div",{className:"flex flex-1 items-center gap-2",children:[(0,b.jsxs)(P.Button,{variant:"ghost",size:"sm",onClick:()=>{az(null),aB(null),aJ.current=null;let a=new URLSearchParams;al&&"inbox"!==al&&a.set("folder",al),ah.push(`/dashboard/communication/email?${a.toString()}`,{scroll:!1})},className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"Back to list",children:[(0,b.jsx)(e.ArrowLeft,{className:"h-5 w-5 md:hidden text-muted-foreground"}),(0,b.jsx)(y.X,{className:"h-4 w-4 hidden md:block text-muted-foreground"})]}),(0,b.jsx)(aa.Separator,{orientation:"vertical",className:"h-4 bg-border/60 hidden md:block"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsxs)(P.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-auto md:px-2",onClick:()=>aM("reply-all"),title:"Reply all",children:[(0,b.jsx)(s.ReplyAll,{className:"h-5 w-5 md:h-4 md:w-4 md:mr-1.5 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm leading-none font-medium hidden md:inline",children:"Reply all"})]}),(0,b.jsxs)(ab.Sheet,{open:aP,onOpenChange:aQ,children:[(0,b.jsx)(ab.SheetTrigger,{asChild:!0,children:(0,b.jsx)(P.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8 hidden md:flex",title:"Notes",children:(0,b.jsx)(v.StickyNote,{className:"h-4 w-4 text-muted-foreground"})})}),(0,b.jsxs)(ab.SheetContent,{children:[(0,b.jsxs)(ab.SheetHeader,{children:[(0,b.jsx)(ab.SheetTitle,{children:"Email Notes"}),(0,b.jsx)(ab.SheetDescription,{children:"Add private notes about this email."})]}),(0,b.jsxs)("div",{className:"py-4",children:[(0,b.jsx)(ad.Textarea,{placeholder:"Add your notes here...",value:aR,onChange:a=>aS(a.target.value),className:"min-h-[200px] resize-none"}),(0,b.jsxs)("div",{className:"mt-4 flex justify-end gap-2",children:[(0,b.jsx)(P.Button,{variant:"outline",size:"sm",onClick:()=>aQ(!1),children:"Cancel"}),(0,b.jsx)(P.Button,{size:"sm",onClick:()=>{C.toast.success("Notes saved"),aQ(!1)},children:"Save Notes"})]})]})]})]}),(0,b.jsx)(P.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8 group/star",title:ay?.tags?.includes("starred")?"Unstar":"Star",onClick:()=>ay&&a7(ay.id),children:(0,b.jsx)(u.Star,{className:(0,R.cn)("h-5 w-5 md:h-4 md:w-4 transition-colors group-hover/star:text-yellow-500",ay?.tags?.includes("starred")?"fill-yellow-500 text-yellow-500":"text-muted-foreground")})}),(0,b.jsx)(P.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8 hidden md:flex group/spam",title:ay?.category==="spam"?"Not spam":"Spam",onClick:()=>ay&&a6(ay.id),children:(0,b.jsx)(j.Flag,{className:(0,R.cn)("h-4 w-4 transition-colors group-hover/spam:text-orange-500",ay?.category==="spam"?"fill-orange-500 text-orange-500":"text-muted-foreground")})}),(0,b.jsx)(P.Button,{variant:"destructive",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"Archive",onClick:()=>ay&&a4(ay.id),children:(0,b.jsx)(d.Archive,{className:"h-5 w-5 md:h-4 md:w-4"})}),(0,b.jsxs)(Z.DropdownMenu,{children:[(0,b.jsx)(Z.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(P.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"More",children:(0,b.jsx)(m.MoreHorizontal,{className:"h-5 w-5 md:h-4 md:w-4 text-muted-foreground"})})}),(0,b.jsxs)(Z.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,b.jsxs)(Z.DropdownMenuItem,{onClick:()=>ay&&a6(ay.id),className:"md:hidden",children:[(0,b.jsx)(j.Flag,{className:"h-4 w-4 mr-2"}),ay?.category==="spam"?"Not spam":"Mark as spam"]}),(0,b.jsxs)(Z.DropdownMenuItem,{onClick:()=>aQ(!0),className:"md:hidden",children:[(0,b.jsx)(v.StickyNote,{className:"h-4 w-4 mr-2"}),"Notes"]}),(0,b.jsx)(Z.DropdownMenuSeparator,{className:"md:hidden"}),(0,b.jsxs)(Z.DropdownMenuItem,{onClick:a8,children:[(0,b.jsx)(p.Printer,{className:"h-4 w-4 mr-2"}),"Print"]}),(0,b.jsxs)(Z.DropdownMenuItem,{onClick:a9,children:[(0,b.jsx)(h.Download,{className:"h-4 w-4 mr-2"}),"Download as .eml"]}),(0,b.jsx)(Z.DropdownMenuSeparator,{}),(0,b.jsxs)(Z.DropdownMenuItem,{onClick:()=>ay&&ba(ay.id),className:"text-destructive focus:text-destructive",children:[(0,b.jsx)(w.Trash2,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]}),(0,b.jsx)("div",{className:"flex min-h-0 flex-1 flex-col overflow-hidden",children:(0,b.jsxs)("div",{className:"relative overflow-hidden flex-1 h-full min-h-0 flex flex-col",children:[(0,b.jsx)(ae.TooltipProvider,{delayDuration:100,children:(0,b.jsxs)("div",{className:"border-b border-border/50 px-2 py-4 space-y-3",children:[(0,b.jsx)("h1",{className:"text-base font-semibold text-foreground",children:ay.subject||"No Subject"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(Y.Avatar,{className:"h-9 w-9 shrink-0 rounded-md cursor-pointer",children:(0,b.jsx)(Y.AvatarFallback,{className:"bg-muted text-muted-foreground font-semibold text-sm rounded-md",children:ay.from_address?.[0]?.toUpperCase()||"U"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"font-semibold text-sm text-foreground",children:ay.from_name||ay.from_address||"Unknown"}),!ay.read_at&&(0,b.jsx)("div",{className:"h-2 w-2 rounded-full bg-primary"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,b.jsxs)("span",{children:["to"," ",ay.to_address?.split("@")[0]||"you"]}),(0,b.jsx)(T,{customer:ay.customer,fallbackName:ay.from_name||void 0,fallbackEmail:ay.from_address||void 0,size:"sm"})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:new Date(ay.created_at).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})})})]}),"outbound"===ay.direction&&(0,b.jsx)("div",{className:"flex flex-col gap-2 pt-2",children:(0,b.jsxs)("div",{className:"flex items-center gap-1 flex-wrap",children:[(0,b.jsxs)(ae.Tooltip,{children:[(0,b.jsx)(ae.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:(0,R.cn)("flex items-center gap-1.5 px-2 py-1 rounded-full text-xs",ay.sent_at?"bg-blue-500/10 text-blue-600":"bg-muted text-muted-foreground"),children:[(0,b.jsx)(t.Send,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:"Sent"})]})}),(0,b.jsx)(ae.TooltipContent,{children:(0,b.jsx)("p",{children:ay.sent_at?`Sent ${new Date(ay.sent_at).toLocaleString()}`:"Not sent yet"})})]}),ay.sent_at&&(0,b.jsx)(g.ChevronRight,{className:"h-3 w-3 text-muted-foreground"}),ay.sent_at&&(0,b.jsxs)(ae.Tooltip,{children:[(0,b.jsx)(ae.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:(0,R.cn)("flex items-center gap-1.5 px-2 py-1 rounded-full text-xs",ay.delivered_at?"bg-green-500/10 text-green-600":"bg-muted text-muted-foreground"),children:[(0,b.jsx)(f.CheckCheck,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:"Delivered"})]})}),(0,b.jsx)(ae.TooltipContent,{children:(0,b.jsx)("p",{children:ay.delivered_at?`Delivered ${new Date(ay.delivered_at).toLocaleString()}`:"Waiting..."})})]}),ay.delivered_at&&(0,b.jsx)(g.ChevronRight,{className:"h-3 w-3 text-muted-foreground"}),ay.delivered_at&&(0,b.jsxs)(ae.Tooltip,{children:[(0,b.jsx)(ae.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:(0,R.cn)("flex items-center gap-1.5 px-2 py-1 rounded-full text-xs",ay.opened_at?"bg-purple-500/10 text-purple-600":"bg-muted/50 text-muted-foreground/70"),children:[(0,b.jsx)(i.Eye,{className:"h-3 w-3"}),(0,b.jsxs)("span",{children:["Opened",ay.open_count&&ay.open_count>1?` (${ay.open_count})`:""]}),(0,b.jsx)(c.AlertTriangle,{className:"h-3 w-3 text-amber-500"})]})}),(0,b.jsxs)(ae.TooltipContent,{children:[(0,b.jsx)("p",{children:ay.opened_at?`Opened ${new Date(ay.opened_at).toLocaleString()}`:"Not opened"}),(0,b.jsx)("p",{className:"text-xs text-amber-500 mt-1",children:"⚠️ Unreliable metric"})]})]}),ay.delivered_at&&(0,b.jsx)(g.ChevronRight,{className:"h-3 w-3 text-muted-foreground"}),ay.delivered_at&&(0,b.jsxs)(ae.Tooltip,{children:[(0,b.jsx)(ae.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:(0,R.cn)("flex items-center gap-1.5 px-2 py-1 rounded-full text-xs",ay.clicked_at?"bg-amber-500/10 text-amber-600":"bg-muted text-muted-foreground"),children:[(0,b.jsx)(n.default,{className:"h-3 w-3"}),(0,b.jsxs)("span",{children:["Clicked",ay.click_count&&ay.click_count>1?` (${ay.click_count})`:""]})]})}),(0,b.jsx)(ae.TooltipContent,{children:(0,b.jsx)("p",{children:ay.clicked_at?`Clicked ${new Date(ay.clicked_at).toLocaleString()}`:"No clicks"})})]})]})})]})}),(0,b.jsxs)("div",{className:"flex-1 overflow-hidden flex flex-col min-h-0",children:[(0,b.jsx)("div",{className:"flex-1 overflow-y-auto px-2 py-4",children:aC?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(l.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading email content..."})]})}):(0,b.jsx)(U.EmailContent,{html:aA?.html||ay.body_html||null,text:aA?.text||ay.body||null,attachments:null})}),(0,b.jsx)("div",{className:"px-2 py-4 pb-safe",children:aL?(0,b.jsx)(W.EmailReplyComposer,{mode:aL,selectedEmail:ay,companyId:Q,onClose:()=>aM(null),onSent:()=>{aM(null),aZ(!0)}}):"failed"===ay.status?(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsx)(P.Button,{variant:"default",size:"sm",className:"h-11 px-4 flex-1 md:flex-none md:h-9",onClick:()=>bb(ay.id),disabled:aV,children:aV?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Loader2,{className:"h-5 w-5 md:h-4 md:w-4 mr-2 animate-spin"}),"Sending..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.RefreshCw,{className:"h-5 w-5 md:h-4 md:w-4 mr-2"}),"Retry Send"]})}),ay.failure_reason&&(0,b.jsxs)("div",{className:"w-full flex items-start gap-2 p-3 rounded-lg bg-destructive/10 border border-destructive/20",children:[(0,b.jsx)(c.AlertTriangle,{className:"h-4 w-4 text-destructive shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-destructive",children:"Failed to send"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5",children:ay.failure_reason})]})]})]}):(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsxs)(P.Button,{variant:"default",size:"sm",className:"h-11 px-4 flex-1 md:flex-none md:h-9",onClick:()=>aM("reply"),children:[(0,b.jsx)(r.Reply,{className:"h-5 w-5 md:h-4 md:w-4 mr-2"}),"Reply"]}),(0,b.jsxs)(P.Button,{variant:"outline",size:"sm",className:"h-11 px-3 flex-1 md:flex-none md:h-9 md:px-4",onClick:()=>aM("reply-all"),children:[(0,b.jsx)(s.ReplyAll,{className:"h-5 w-5 md:h-4 md:w-4 mr-2"}),(0,b.jsx)("span",{className:"hidden xs:inline",children:"Reply All"}),(0,b.jsx)("span",{className:"xs:hidden",children:"All"})]}),(0,b.jsxs)(P.Button,{variant:"outline",size:"sm",className:"h-11 px-3 flex-1 md:flex-none md:h-9 md:px-4",onClick:()=>aM("forward"),children:[(0,b.jsx)(k.Forward,{className:"h-5 w-5 md:h-4 md:w-4 mr-2"}),"Forward"]})]})})]})]})})]})})}):null]}),(0,b.jsx)(X.AlertDialog,{open:aT,onOpenChange:aU,children:(0,b.jsxs)(X.AlertDialogContent,{children:[(0,b.jsxs)(X.AlertDialogHeader,{children:[(0,b.jsxs)(X.AlertDialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(c.AlertTriangle,{className:"h-5 w-5 text-destructive"}),"Archive All"," ",al?al.charAt(0).toUpperCase()+al.slice(1):"Inbox"," ","Emails"]}),(0,b.jsxs)(X.AlertDialogDescription,{children:["This will archive ",(0,b.jsx)("strong",{children:as?.emails?.length||0})," ","email",1!==(as?.emails?.length||0)?"s":""," from your"," ",(0,b.jsx)("strong",{children:al||"inbox"})," folder. This action can be undone by viewing the Archive folder."]})]}),(0,b.jsxs)(X.AlertDialogFooter,{children:[(0,b.jsx)(X.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(X.AlertDialogAction,{onClick:a5,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Archive All"})]})]})})]})}a.s(["EmailPageClient",()=>ah],116381)}];

//# sourceMappingURL=apps_web_src_components_communication_email-page-client_tsx_83120bf2._.js.map