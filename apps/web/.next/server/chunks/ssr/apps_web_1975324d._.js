module.exports=[580739,a=>{"use strict";var b=a.i(504348),c=a.i(402239),d=a.i(766734),e=a.i(357098),f=a.i(130236),g=a.i(60847);function h({companyName:a,contactName:h,verificationTypes:w,dashboardUrl:x,messagingUrl:y,previewText:z="Your business messaging is now fully enabled!"}){let A=w.includes("toll-free"),B=w.includes("10dlc");return(0,b.jsxs)(g.BaseLayout,{previewText:z,children:[(0,b.jsx)(f.Heading,{level:1,children:"ðŸŽ‰ Your Messaging is Live!"}),(0,b.jsxs)(c.Text,{style:i,children:["Hi ",h,","]}),(0,b.jsxs)(c.Text,{style:i,children:["Excellent news! Your business messaging verification for"," ",(0,b.jsx)("strong",{children:a})," has been approved. You can now send SMS and MMS messages to your customers."]}),(0,b.jsxs)(e.Card,{style:j,children:[(0,b.jsx)("div",{style:k,children:"âœ…"}),(0,b.jsx)(f.Heading,{level:3,style:l,children:"All Systems Ready"}),(0,b.jsxs)(c.Text,{style:m,children:[A&&B&&(0,b.jsx)(b.Fragment,{children:"Both your toll-free and regular (10DLC) numbers are now approved and ready to send messages."}),A&&!B&&(0,b.jsx)(b.Fragment,{children:"Your toll-free numbers have been approved and are ready to send messages."}),!A&&B&&(0,b.jsx)(b.Fragment,{children:"Your 10DLC (regular) numbers have been approved and are ready to send messages."})]})]}),(0,b.jsx)(f.Heading,{level:3,children:"What You Can Do Now"}),(0,b.jsxs)("ul",{style:n,children:[(0,b.jsxs)("li",{style:o,children:[(0,b.jsx)("strong",{children:"Send SMS/MMS:"})," Text your customers with appointment reminders, estimates, invoices, and updates"]}),(0,b.jsxs)("li",{style:o,children:[(0,b.jsx)("strong",{children:"Two-Way Messaging:"})," Receive and respond to customer texts directly in your dashboard"]}),(0,b.jsxs)("li",{style:o,children:[(0,b.jsx)("strong",{children:"Automated Messages:"})," Set up automatic text notifications for jobs, appointments, and payments"]}),(0,b.jsxs)("li",{style:o,children:[(0,b.jsx)("strong",{children:"Rich Media:"})," Send photos, documents, and other attachments via MMS"]}),A&&(0,b.jsxs)("li",{style:o,children:[(0,b.jsx)("strong",{children:"RCS Messaging:"})," Support for read receipts and rich messaging features on compatible devices"]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(f.Heading,{level:3,children:"Quick Start Guide"}),(0,b.jsxs)(c.Text,{style:p,children:[(0,b.jsx)("strong",{children:"1. Set Up Message Templates"}),(0,b.jsx)("br",{}),"Create reusable templates for common messages like appointment confirmations and reminders."]}),(0,b.jsxs)(c.Text,{style:p,children:[(0,b.jsx)("strong",{children:"2. Configure Notifications"}),(0,b.jsx)("br",{}),"Enable automatic text notifications for job updates, invoice payments, and more."]}),(0,b.jsxs)(c.Text,{style:p,children:[(0,b.jsx)("strong",{children:"3. Start Messaging"}),(0,b.jsx)("br",{}),"Send your first text message! Try texting a test appointment reminder or estimate notification."]})]}),(0,b.jsx)("div",{style:q,children:(0,b.jsx)(d.Button,{href:y,children:"Open Messaging Dashboard"})}),(0,b.jsx)("div",{style:r,children:(0,b.jsx)("a",{href:x,style:s,children:"Back to Main Dashboard â†’"})}),(0,b.jsxs)(c.Text,{style:t,children:[(0,b.jsx)("strong",{children:"Need help getting started?"})," Check out our"," ",(0,b.jsx)("a",{href:"https://thorbis.com/docs/messaging",style:v,children:"messaging guide"})," ","or contact support at"," ",(0,b.jsx)("a",{href:"mailto:support@thorbis.com",style:v,children:"support@thorbis.com"})]}),(0,b.jsx)(c.Text,{style:u,children:"Your approval was issued by The Campaign Registry and is valid for all US carriers. Keep sending great messages! ðŸ“±"})]})}let i={color:"#374151",fontSize:"16px",lineHeight:"24px",margin:"0 0 16px 0"},j={backgroundColor:"#f0fdf4",border:"1px solid #86efac",borderRadius:"8px",padding:"24px",margin:"24px 0",textAlign:"center"},k={fontSize:"48px",marginBottom:"12px"},l={color:"#166534",fontSize:"20px",fontWeight:"600",margin:"0 0 8px 0"},m={color:"#15803d",fontSize:"16px",lineHeight:"24px",margin:"0"},n={color:"#374151",fontSize:"16px",lineHeight:"24px",margin:"16px 0 24px 24px",padding:"0"},o={margin:"0 0 12px 0"},p={color:"#6b7280",fontSize:"15px",lineHeight:"22px",margin:"0 0 16px 0"},q={margin:"32px 0 16px 0",textAlign:"center"},r={margin:"0 0 32px 0",textAlign:"center"},s={color:"hsl(217 91% 60%)",fontSize:"16px",textDecoration:"none",fontWeight:"500"},t={color:"#374151",fontSize:"16px",lineHeight:"24px",margin:"24px 0 0 0",padding:"16px",backgroundColor:"#f9fafb",borderRadius:"8px",textAlign:"center"},u={color:"#9ca3af",fontSize:"13px",lineHeight:"18px",margin:"24px 0 0 0",textAlign:"center",fontStyle:"italic"},v={color:"hsl(217 91% 60%)",textDecoration:"underline"};a.s(["default",()=>h])},910119,a=>{"use strict";var b=a.i(504348),c=a.i(402239),d=a.i(766734),e=a.i(357098),f=a.i(130236),g=a.i(60847);function h({companyName:a,contactName:h,hasTollFreeNumbers:v,has10DLCNumbers:w,tollFreeCount:x=0,dlcCount:y=0,dashboardUrl:z,previewText:A="Your messaging verification has been submitted successfully"}){return(0,b.jsxs)(g.BaseLayout,{previewText:A,children:[(0,b.jsx)(f.Heading,{level:1,children:"Verification Submitted Successfully!"}),(0,b.jsxs)(c.Text,{style:i,children:["Hi ",h,","]}),(0,b.jsxs)(c.Text,{style:i,children:["Great news! We've successfully submitted your business messaging verification for ",(0,b.jsx)("strong",{children:a}),". Here's what happens next:"]}),(0,b.jsxs)("div",{style:j,children:[w&&(0,b.jsxs)(e.Card,{style:k,children:[(0,b.jsx)("div",{style:m,children:"âœ…"}),(0,b.jsx)(f.Heading,{level:3,style:n,children:"10DLC Registration Complete"}),(0,b.jsxs)(c.Text,{style:o,children:[(0,b.jsxs)("strong",{children:[y," regular number",1!==y?"s":""]})," ","enabled for SMS immediately. You can start sending text messages right away!"]})]}),v&&(0,b.jsxs)(e.Card,{style:l,children:[(0,b.jsx)("div",{style:m,children:"â°"}),(0,b.jsx)(f.Heading,{level:3,style:n,children:"Toll-Free Verification Pending"}),(0,b.jsxs)(c.Text,{style:o,children:[(0,b.jsxs)("strong",{children:[x," toll-free number",1!==x?"s":""]})," ","submitted for verification. Approval typically takes"," ",(0,b.jsx)("strong",{children:"5-7 business days"}),"."]})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(f.Heading,{level:3,children:"What to Expect"}),(0,b.jsxs)("ul",{style:p,children:[w&&(0,b.jsxs)("li",{style:q,children:[(0,b.jsx)("strong",{children:"Regular Numbers (10DLC):"})," Ready to use! Start sending SMS/MMS to your customers right away."]}),v&&(0,b.jsxs)("li",{style:q,children:[(0,b.jsx)("strong",{children:"Toll-Free Numbers:"})," Under review by our carrier partners. We'll email you when they're approved (usually within 5-7 business days)."]}),(0,b.jsxs)("li",{style:q,children:[(0,b.jsx)("strong",{children:"No Action Required:"})," We're handling everything automatically. You can continue setting up your account."]}),(0,b.jsxs)("li",{style:q,children:[(0,b.jsx)("strong",{children:"Notification:"})," You'll receive another email once your toll-free verification is complete."]})]})]}),(0,b.jsx)("div",{style:r,children:(0,b.jsx)(d.Button,{href:z,children:"Go to Dashboard"})}),(0,b.jsxs)(c.Text,{style:s,children:[(0,b.jsx)("strong",{children:"Need help?"})," If you have any questions about the verification process, our support team is here to help at"," ",(0,b.jsx)("a",{href:"mailto:support@thorbis.com",style:u,children:"support@thorbis.com"})]}),(0,b.jsx)(c.Text,{style:t,children:"This is a federal requirement enforced by The Campaign Registry and US carriers to prevent spam and ensure legitimate business messaging."})]})}let i={color:"#374151",fontSize:"16px",lineHeight:"24px",margin:"0 0 16px 0"},j={margin:"32px 0",display:"grid",gap:"16px"},k={backgroundColor:"#f0fdf4",border:"1px solid #86efac",borderRadius:"8px",padding:"24px"},l={backgroundColor:"#fffbeb",border:"1px solid #fde047",borderRadius:"8px",padding:"24px"},m={fontSize:"32px",marginBottom:"8px"},n={color:"#374151",fontSize:"18px",fontWeight:"600",margin:"0 0 8px 0"},o={color:"#6b7280",fontSize:"14px",lineHeight:"20px",margin:"0"},p={color:"#374151",fontSize:"16px",lineHeight:"24px",margin:"16px 0 0 24px",padding:"0"},q={margin:"0 0 12px 0"},r={margin:"32px 0",textAlign:"center"},s={color:"#374151",fontSize:"16px",lineHeight:"24px",margin:"24px 0 0 0",padding:"16px",backgroundColor:"#f9fafb",borderRadius:"8px",textAlign:"center"},t={color:"#9ca3af",fontSize:"13px",lineHeight:"18px",margin:"24px 0 0 0",textAlign:"center",fontStyle:"italic"},u={color:"hsl(217 91% 60%)",textDecoration:"underline"};a.s(["default",()=>h])},765839,a=>a.a(async(b,c)=>{try{var d=a.i(780195),e=a.i(136874);a.i(580739);var f=a.i(910119),g=a.i(198114),h=a.i(463556),i=a.i(869251),j=a.i(395731),k=b([g]);async function l(a,b,c){try{let d=await (0,e.createClient)(),{data:j,error:k}=await d.from("companies").select("name").eq("id",a).single();if(k||!j)return{success:!1,error:`Company not found: ${k?.message}`};let{data:l,error:m}=await d.from("company_memberships").select("full_name").eq("company_id",a).eq("role","owner").single(),n=l?.full_name||"there",o=`${i.emailConfig.appUrl}/dashboard`,p=(0,f.default)({companyName:j.name,contactName:n,hasTollFreeNumbers:c.hasTollFreeNumbers,has10DLCNumbers:c.has10DLCNumbers,tollFreeCount:c.tollFreeCount||0,dlcCount:c.dlcCount||0,dashboardUrl:o});return await (0,g.sendEmail)({to:b,subject:`Messaging Verification Submitted - ${j.name}`,template:p,templateType:h.EmailTemplate.VERIFICATION_SUBMITTED,companyId:a,tags:[{name:"type",value:"onboarding"},{name:"verification",value:"submitted"}]})}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to send verification submitted email"}}}[g]=k.then?(await k)():k,(0,j.ensureServerEntryExports)([l]),(0,d.registerServerReference)(l,"70f58c5ba46ef02b620d7dc87bae8fc83f6d480755",null),a.s(["sendVerificationSubmittedEmail",()=>l]),c()}catch(a){c(a)}},!1),718566,a=>{"use strict";var b=a.i(188351);async function c(){try{let a=await (0,b.telnyxRequest)("/account/verifications",{method:"GET"});if(a.success&&a.data){let{verifications:b}=a.data,c=b.identity_verification?.status==="verified",d=b.business_verification?.status==="verified",e=[],f=0;return c||(e.push("Complete Level 1 verification (ID, payment method, contact info)"),f=Math.max(f,2)),d||(e.push("Complete Level 2 verification (EIN letter, business license, proof of address)"),f=Math.max(f,5)),{success:!0,data:{currentLevel:d?"level_2":c?"level_1":"none",isLevel1Complete:c,isLevel2Complete:d,canCreate10DLC:d,requirementsRemaining:e,estimatedCompletionDays:e.length>0?f:void 0}}}let c=await (0,b.telnyxRequest)("/10dlc/brand",{method:"GET"});if(c.success)return{success:!0,data:{currentLevel:"level_2",isLevel1Complete:!0,isLevel2Complete:!0,canCreate10DLC:!0,requirementsRemaining:[]}};if(c.error?.includes("403")||c.error?.includes("verification"))return{success:!0,data:{currentLevel:"level_1",isLevel1Complete:!0,isLevel2Complete:!1,canCreate10DLC:!1,requirementsRemaining:["Complete Level 2 verification (EIN letter, business license, proof of address)"],estimatedCompletionDays:5}};return{success:!0,data:{currentLevel:"none",isLevel1Complete:!1,isLevel2Complete:!1,canCreate10DLC:!1,requirementsRemaining:["Complete Level 1 verification (ID, payment method, contact info)","Complete Level 2 verification (EIN letter, business license, proof of address)"],estimatedCompletionDays:7}}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to check verification status"}}}function d(a){return{level1:{required:"none"===a,items:["Valid government-issued ID (Driver's License, Passport, etc.)","Payment method (Credit card or bank account)","Phone number verification","Email verification","Business address confirmation"]},level2:{required:"none"===a||"level_1"===a,items:["IRS EIN Confirmation Letter (CP 575 or 147C)","Business License or Articles of Incorporation","Proof of Business Address (Utility bill, lease agreement)","Government-issued ID for business representative","Tax documents (W-9 or recent tax return)"]}}}function e(a){let b=[];return a.isLevel1Complete||b.push({step:"Complete Level 1 Verification",action:"Visit Telnyx Portal â†’ Account â†’ Public Profile and complete identity verification",url:"https://portal.telnyx.com/#/app/account/public-profile"}),!a.isLevel2Complete&&a.isLevel1Complete&&b.push({step:"Complete Level 2 Verification",action:"Visit Telnyx Portal â†’ Account â†’ Verifications and upload business documents",url:"https://portal.telnyx.com/#/app/account/verifications"}),a.canCreate10DLC&&b.push({step:"Create 10DLC Brand & Campaign",action:"Run automated setup to create 10DLC brand and campaign (fully automated)",url:"/test-telnyx-setup"}),b}a.s(["checkAccountVerificationStatus",()=>c,"getNextSteps",()=>e,"getVerificationRequirements",()=>d])},970552,a=>a.a(async(b,c)=>{try{var d=a.i(780195),e=a.i(765839),f=a.i(136874),g=a.i(933427),h=a.i(718566),i=a.i(494218),j=a.i(395731),k=b([e]);async function l(a){let b=[],c=await (0,f.createClient)();if(!c)return{success:!1,error:"Failed to create Supabase client",log:b};try{let d;b.push("Fetching company data...");let{data:e,error:f}=await c.from("companies").select(`
				id,
				name,
				ein,
				website,
				industry,
				address,
				city,
				state,
				zip_code,
				phone,
				email,
				support_email,
				support_phone
			`).eq("id",a).single();if(f||!e)return{success:!1,error:`Company not found: ${f?.message}`,log:b};if(!e.ein)return{success:!1,error:"Company EIN is required for 10DLC registration. Please add the company's Tax ID.",log:b};if(!e.address||!e.city||!e.state||!e.zip_code)return{success:!1,error:"Company address is incomplete. Please add full address, city, state, and ZIP code.",log:b};let h=e.email||e.support_email,j=e.phone||e.support_phone;if(!h||!j)return{success:!1,error:"Company contact email and phone are required for 10DLC registration.",log:b};b.push("Verifying company email domain...");let k=await (0,g.createServiceSupabaseClient)();if(!k)return{success:!1,error:"Database service client failed",log:b};let{data:l}=await k.from("company_email_domains").select("*").eq("company_id",a).eq("status","verified").single();if(!l)return{success:!1,error:"Company email domain must be verified before 10DLC registration. TCR (The Campaign Registry) requires a verified business email domain with proper SPF/DKIM/DMARC records. Please complete email domain setup in the onboarding steps.",log:b};let n=l.subdomain?`${l.subdomain}.${l.domain_name}`:l.domain_name;b.push(`Email domain verified: ${n}`);let o=(d=j.replace(/\D/g,""),10===d.length?`+1${d}`:(11===d.length&&d.startsWith("1"),`+${d}`));b.push("Checking existing 10DLC registration...");let{data:p}=await c.from("company_telnyx_settings").select("ten_dlc_brand_id, ten_dlc_campaign_id").eq("company_id",a).single();if(p?.ten_dlc_brand_id&&p?.ten_dlc_campaign_id)return b.push("Company already has 10DLC registration"),{success:!0,brandId:p.ten_dlc_brand_id,campaignId:p.ten_dlc_campaign_id,log:b};b.push("Creating 10DLC brand with Telnyx...");let q={entityType:"PRIVATE_PROFIT",displayName:e.name||"Unknown Company",companyName:e.name||"Unknown Company",firstName:"Business",lastName:"Owner",ein:e.ein,phone:o,street:e.address||"",city:e.city||"",state:e.state||"",postalCode:e.zip_code||"",country:"US",email:h,website:e.website,vertical:function(a){if(!a)return"PROFESSIONAL";let b=a.toLowerCase();return b.includes("healthcare")||b.includes("medical")?"HEALTHCARE":b.includes("finance")||b.includes("banking")?"FINANCIAL":b.includes("insurance")?"INSURANCE":b.includes("real estate")?"REAL_ESTATE":b.includes("retail")||b.includes("ecommerce")?"RETAIL":b.includes("hospitality")||b.includes("restaurant")||b.includes("food")||b.includes("hotel")?"HOSPITALITY":b.includes("education")?"EDUCATION":b.includes("technology")||b.includes("software")?"TECHNOLOGY":b.includes("nonprofit")||b.includes("charity")||b.includes("ngo")?"NGO":b.includes("construction")||b.includes("plumbing")||b.includes("hvac")||b.includes("electrical")||b.includes("contractor")?"CONSTRUCTION":b.includes("legal")||b.includes("law")?"LEGAL":b.includes("manufacturing")?"MANUFACTURING":b.includes("transportation")||b.includes("logistics")?"TRANSPORTATION":b.includes("energy")||b.includes("utilities")?"ENERGY":b.includes("agriculture")||b.includes("farming")?"AGRICULTURE":b.includes("entertainment")||b.includes("media")?"ENTERTAINMENT":"PROFESSIONAL"}(e.industry),businessContactEmail:h,isReseller:!0},r=await (0,i.createTenDlcBrand)(q);if(!r.success||!r.data?.brandId)return{success:!1,error:`Failed to create 10DLC brand: ${r.error}`,log:b};let s=r.data.brandId;b.push(`Brand created: ${s}`),b.push("Waiting for brand approval...");let t=await m(()=>(0,i.getTenDlcBrand)(s),60);if(!t.approved){if(b.push(`Brand approval failed: ${t.failureReason||"Unknown reason"}`),t.failureReason?.toLowerCase().includes("email"))return{success:!1,error:`Email validation failed: ${t.failureReason}. TCR requires a verified business email domain (not personal/free providers). Options: 1) Use toll-free numbers (bypasses TCR), 2) Set up Google Workspace/Microsoft 365, 3) See /TELNYX_10DLC_EMAIL_REQUIREMENTS.md`,brandId:s,log:b};return await c.from("company_telnyx_settings").update({ten_dlc_brand_id:s}).eq("company_id",a),{success:!1,error:t.failureReason||"Brand created but approval pending. Please check back in a few minutes.",brandId:s,log:b}}b.push("Brand approved"),b.push("Creating 10DLC campaign...");let u={brandId:s,usecase:"MIXED",description:`Business messaging for ${e.name}`,messageFlow:"Customers opt-in when providing phone number. Messages sent for appointments, invoices, and general updates.",helpMessage:"Reply HELP for assistance or call us.",helpKeywords:"HELP",optinKeywords:"START YES SUBSCRIBE",optinMessage:"You are now subscribed to messages from "+e.name+". Reply STOP to unsubscribe.",optoutKeywords:"STOP END UNSUBSCRIBE CANCEL QUIT",optoutMessage:"You have been unsubscribed from "+e.name+" messages. Reply START to resubscribe.",sample1:"Your appointment is confirmed for tomorrow at 2 PM.",sample2:"Thank you for your payment. Receipt: #12345",sample3:"Reminder: Service scheduled for next week.",autoRenewal:!0,termsAndConditions:!0,termsAndConditionsLink:e.website?`${e.website}/terms`:"https://stratos.thorbis.com/terms",subscriberHelp:!0,subscriberOptin:!0,subscriberOptout:!0},v=await (0,i.createTenDlcCampaign)(u);if(!v.success||!v.data?.campaignId)return{success:!1,error:`Failed to create 10DLC campaign: ${v.error}`,brandId:s,log:b};let w=v.data.campaignId;b.push(`Campaign created: ${w}`),b.push("Waiting for campaign approval...");let x=await m(()=>(0,i.getTenDlcCampaign)(w),60);if(!x.approved)return b.push(`Campaign approval failed: ${x.failureReason||"Unknown reason"}`),await c.from("company_telnyx_settings").update({ten_dlc_brand_id:s,ten_dlc_campaign_id:w}).eq("company_id",a),{success:!1,error:x.failureReason||"Campaign created but approval pending. Please check back in a few minutes.",brandId:s,campaignId:w,log:b};b.push("Campaign approved"),b.push("Attaching phone numbers to campaign...");let{data:y}=await c.from("phone_numbers").select("phone_number").eq("company_id",a).eq("status","active"),z=0;for(let a of y||[]){let c=await (0,i.attachNumberToCampaign)(w,a.phone_number);c.success?z++:b.push(`Failed to attach ${a.phone_number}: ${c.error}`)}return b.push(`Attached ${z} phone numbers to campaign`),b.push("Updating company Telnyx settings..."),await c.from("company_telnyx_settings").update({ten_dlc_brand_id:s,ten_dlc_campaign_id:w}).eq("company_id",a),{success:!0,brandId:s,campaignId:w,log:b}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error",log:b}}}async function m(a,b){let c=Date.now();for(;Date.now()-c<1e3*b;){let b=await a();if(!b.success||!b.data)return{approved:!1,failureReason:"Failed to fetch status"};let c=b.data.status.toLowerCase();if("approved"===c||"active"===c)return{approved:!0};if("rejected"===c||"failed"===c||"registration_failed"===c){let a=b.data.failureReasons?.[0]?.description||`Registration ${c}`;return{approved:!1,failureReason:a}}await new Promise(a=>setTimeout(a,5e3))}return{approved:!1,failureReason:"Timeout waiting for approval"}}async function n(){try{let a=await (0,h.checkAccountVerificationStatus)();if(!a.success)return{success:!1,error:a.error||"Failed to check verification status"};let b=a.data,c=(0,h.getNextSteps)(b),d=(0,h.getVerificationRequirements)(b.currentLevel);return{success:!0,data:{...b,nextSteps:c,requirements:d}}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to check verification status"}}}async function o(a){let b=await (0,f.createClient)(),c=[];if(!b)return{success:!1,error:"Failed to create Supabase client",log:c};try{let d,f,g,h,{data:i,error:j}=await b.from("companies").select(`
				id,
				name,
				ein,
				website,
				industry,
				address,
				city,
				state,
				zip_code,
				phone,
				email,
				support_email,
				support_phone
			`).eq("id",a).single();if(j||!i)return c.push("Company lookup failed"),{success:!1,error:`Company not found: ${j?.message}`,log:c};if(c.push(`Company loaded: ${i.name} (${i.id})`),!i.ein)return c.push("Missing EIN"),{success:!1,error:"Company EIN is required for messaging verification. Please add your Tax ID in Step 1.",log:c};if(!i.address||!i.city||!i.state||!i.zip_code)return c.push("Incomplete address"),{success:!1,error:"Company address is incomplete. Please complete all address fields in Step 1.",log:c};let k=(a=>{if(!a)return null;let b=a.replace(/\D/g,"");return b?10===b.length?`+1${b}`:11===b.length&&b.startsWith("1")?`+${b}`:a.startsWith("+")?a:`+${b}`:null})(i.phone||i.support_phone);if(!k)return c.push("Missing company phone"),{success:!1,error:"Company phone number is required for verification.",log:c};let{data:m,error:n}=await b.from("phone_numbers").select("phone_number, number_type").eq("company_id",a).eq("status","active");if(n||!m||0===m.length)return c.push("No phone numbers found for company"),{success:!1,error:"No phone numbers found. Please add a phone number before enabling messaging.",log:c};let o=m.filter(a=>"toll-free"===a.number_type),p=m.filter(a=>"local"===a.number_type);c.push(`Detected toll-free numbers: ${o.length}, 10DLC numbers: ${p.length}`),0===o.length&&p.length;let q=i.email||i.support_email||null;if(!q)return{success:!1,error:"A primary email is required for toll-free verification.",log:c};let{data:r}=await b.from("company_memberships").select("user_id, user_profiles!inner(first_name, last_name)").eq("company_id",a).eq("role","owner").eq("status","active").single(),s=r?.user_profiles,t=s?.first_name||"Admin",u=s?.last_name||"User";if(o.length>0){c.push("Preparing toll-free verification payload");let e=i.website||`https://${i.name.toLowerCase().replace(/\s+/g,"")}.com`,f=`${e.replace(/\/$/,"")}/opt-in`,g=`${i.name} sends timely service notifications, scheduling updates, and customer support follow-ups for ${i.industry||"field service"} operations.`,h=i.ein.replace(/[^\d]/g,""),j={businessName:i.name,corporateWebsite:e,businessAddr1:i.address,businessCity:i.city,businessState:i.state,businessZip:i.zip_code,businessContactFirstName:t,businessContactLastName:u,businessContactEmail:q,businessContactPhone:k,phoneNumbers:o.map(a=>({phoneNumber:a.phone_number})),useCase:"Customer Support",useCaseSummary:`${i.industry} business communications including appointment reminders, service notifications, and customer support`,productionMessageContent:`Hi! This is ${i.name}. Your appointment is scheduled for tomorrow at 10 AM. Reply STOP to opt out.`,messageVolume:"10000",optInWorkflow:"Customers opt-in during service booking and account creation",optInWorkflowImageURLs:[{url:f||"https://dummyimage.com/600x400/cccccc/000000&text=Opt-In",description:"Opt-in form screenshot"}],optInKeywords:"YES,START",optOutKeywords:"STOP,UNSUBSCRIBE",optOutMessage:`You have opted out of ${i.name} messages. Reply START to opt in again.`,helpKeywords:"HELP,INFO",businessRegistrationNumber:h,businessRegistrationType:"EIN",businessRegistrationCountry:"US",entityType:"PRIVATE_PROFIT",additionalInformation:g,helpMessageResponse:`For help, reply HELP or call ${k}.`,optInConfirmationResponse:`Thanks for subscribing to ${i.name} updates.`};c.push("Submitting toll-free verification to Telnyx");let l=await submitTollFreeVerification(j);if(!l.success||!l.data)return c.push(`Toll-free verification failed: ${l.error||"unknown"}`),{success:!1,error:`Toll-free verification failed: ${l.error}`,log:c};d=l.data.id,c.push(`Toll-free verification request created: ${d}`),await b.from("company_telnyx_settings").upsert({company_id:a,toll_free_verification_request_id:d,toll_free_verification_status:"pending",toll_free_verification_submitted_at:new Date().toISOString()})}if(p.length>0){c.push("Attempting 10DLC registration");let b=await l(a);if(b.success)f=b.brandId,g=b.campaignId,c.push(`10DLC registration completed: brand=${f}, campaign=${g}`);else if(b.error?.includes("403")||b.error?.includes("verifications required")){if(h="10DLC requires Level 2 verification (see /TELNYX_PLATFORM_SETUP.md). Toll-free verification will proceed.",console.warn(h),c.push(h),0===o.length)return{success:!1,error:"Platform setup required: Your Telnyx account needs Level 2 verification to enable 10DLC registration for local numbers. Alternative: Add toll-free numbers which work immediately without Level 2 verification. See /TELNYX_PLATFORM_SETUP.md for details.",requiresPlatformSetup:!0,log:c}}else if(h=`10DLC registration failed: ${b.error}`,console.error(h),c.push(h),0===o.length)return{success:!1,error:h,log:c}}if(i.email)try{await (0,e.sendVerificationSubmittedEmail)(a,i.email,{hasTollFreeNumbers:o.length>0,has10DLCNumbers:p.length>0,tollFreeCount:o.length,dlcCount:p.length}),c.push("Verification submitted email sent")}catch(a){console.error("Failed to send verification email:",a),c.push(`Failed to send verification email: ${a instanceof Error?a.message:a}`)}let v=[];return d&&v.push(`âœ… Toll-free verification submitted (${o.length} number${o.length>1?"s":""}) - Approval in 5-7 business days`),f&&g&&v.push(`âœ… 10DLC registration completed (${p.length} number${p.length>1?"s":""}) - Active immediately`),h&&v.push(`âš ï¸ ${h}`),c.push(...v),{success:!0,tollFreeRequestId:d,brandId:f,campaignId:g,message:v.join(". "),log:c}}catch(a){return c.push(`Unhandled verification error: ${a instanceof Error?a.message:a}`),{success:!1,error:a instanceof Error?a.message:"Failed to submit verification",log:c}}}[e]=k.then?(await k)():k,(0,j.ensureServerEntryExports)([l,n,o]),(0,d.registerServerReference)(l,"40ae25402a089e45aa071d979e8cc6ad136205cc98",null),(0,d.registerServerReference)(n,"007505a78985e53e083a498c97761ed8a463d3d379",null),(0,d.registerServerReference)(o,"4087f0badccd6aaf6a28b640ab4bbc513f0832d105",null),a.s(["checkTelnyxVerificationStatus",()=>n,"registerCompanyFor10DLC",()=>l,"submitAutomatedVerification",()=>o]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=apps_web_1975324d._.js.map