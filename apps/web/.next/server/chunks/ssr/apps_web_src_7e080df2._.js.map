{"version":3,"sources":["../../../../../../apps/web/src/actions/data%3A887b35%20%3Ctext/javascript%3E","../../../../../../apps/web/src/components/layout/app-header-client.tsx","../../../../../../apps/web/src/hooks/use-dialer-shortcut.ts","../../../../../../apps/web/src/components/layout/help-dropdown.tsx","../../../../../../apps/web/src/components/layout/notifications-dropdown.tsx","../../../../../../apps/web/src/components/layout/phone-dropdown.tsx","../../../../../../apps/web/src/hooks/use-dialer-customers.ts","../../../../../../apps/web/src/lib/telnyx/web-credentials-client.ts","../../../../../../apps/web/src/components/layout/quick-add-dropdown.tsx","../../../../../../apps/web/src/actions/data%3A4d0715%20%3Ctext/javascript%3E","../../../../../../apps/web/src/actions/data%3Ae2abe5%20%3Ctext/javascript%3E","../../../../../../apps/web/src/actions/data%3Aeb71da%20%3Ctext/javascript%3E","../../../../../../apps/web/src/components/layout/user-menu.tsx","../../../../../../apps/web/src/components/ai/pending-actions-indicator.tsx","../../../../../../apps/web/src/actions/data%3A88b5ba%20%3Ctext/javascript%3E","../../../../../../apps/web/src/actions/data%3A5a9ae2%20%3Ctext/javascript%3E","../../../../../../apps/web/src/components/layout/app-header-error-boundary.tsx","../../../../../../apps/web/src/components/layout/incoming-call-notification-wrapper.tsx","../../../../../../apps/web/src/components/layout/mobile-bottom-tabs-wrapper.tsx","../../../../../../apps/web/src/components/layout/mobile-bottom-tabs.tsx","../../../../../../apps/web/src/components/layout/notifications-initializer.tsx","../../../../../../apps/web/src/lib/stores/communication-notifications-store.ts","../../../../../../apps/web/src/components/support/support-session-provider.tsx","../../../../../../apps/web/src/actions/data%3Aefa999%20%3Ctext/javascript%3E","../../../../../../apps/web/src/actions/data%3A125657%20%3Ctext/javascript%3E","../../../../../../apps/web/src/components/support/session-approval-modal.tsx","../../../../../../apps/web/src/actions/data%3A56bf0d%20%3Ctext/javascript%3E","../../../../../../apps/web/src/actions/data%3A29c883%20%3Ctext/javascript%3E","../../../../../../apps/web/src/components/support/active-session-banner.tsx","../../../../../../apps/web/src/actions/data%3A87f6eb%20%3Ctext/javascript%3E","../../../../../../apps/web/src/components/support/support-action-notifier.tsx"],"sourcesContent":["/* __next_internal_action_entry_do_not_use__ [{\"00ebc03a4ffc993aea7ec2e541686105c2bace2437\":\"getTotalUnreadCountAction\"},\"apps/web/src/actions/email-actions.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var getTotalUnreadCountAction=/*#__PURE__*/createServerReference(\"00ebc03a4ffc993aea7ec2e541686105c2bace2437\",callServer,void 0,findSourceMapURL,\"getTotalUnreadCountAction\");","\"use client\";\n\nimport { GalleryVerticalEnd, HelpCircle, Tv } from \"lucide-react\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport { useDialerShortcut } from \"@/hooks/use-dialer-shortcut\";\nimport type { UserProfile } from \"@/lib/auth/user-data\";\nimport { HelpDropdown } from \"./help-dropdown\";\nimport { NotificationsDropdown } from \"./notifications-dropdown\";\nimport { PhoneDropdown } from \"./phone-dropdown\";\nimport { QuickAddDropdown } from \"./quick-add-dropdown\";\nimport { UserMenu } from \"./user-menu\";\nimport { getTotalUnreadCountAction } from \"@/actions/email-actions\";\nimport { PendingActionsIndicator } from \"@/components/ai/pending-actions-indicator\";\n\n/**\n * AppHeaderClient - Client Component (Minimal Interactivity Only)\n *\n * Performance optimizations:\n * - ONLY client-side code (mobile menu state, active nav detection)\n * - NO data fetching (userProfile passed from server component)\n * - NO loading states (data already available)\n * - Smaller JavaScript bundle\n *\n * Client-side features:\n * - Mobile menu open/close state\n * - Active navigation highlighting with usePathname\n * - Click outside to close mobile menu\n */\n\ntype AppHeaderClientProps = {\n\tuserProfile: UserProfile;\n\tcompanies: Array<{\n\t\tid: string;\n\t\tname: string;\n\t\tplan: string;\n\t\tonboardingComplete?: boolean;\n\t\thasPayment?: boolean;\n\t}>;\n\tactiveCompanyId?: string | null;\n\tcompanyPhones?: Array<{\n\t\tid: string;\n\t\tnumber: string;\n\t\tlabel?: string;\n\t}>;\n\thasPhoneNumbers?: boolean;\n\thasPayrixAccount?: boolean;\n\tpayrixStatus?: string | null;\n\tsubHeader?: React.ReactNode;\n};\n\ntype NavItemStatus = \"beta\" | \"new\" | \"updated\" | \"coming-soon\" | null;\n\ntype NavItem = {\n\tlabel: string;\n\thref: string;\n\tstatus?: NavItemStatus;\n\tisSpecial?: boolean; // For Ask Thorbis gradient style\n};\n\ntype NavItemWithMobile = NavItem & {\n\tmobileIcon?: string;\n\tmobileIconBg?: string;\n\tmobileIconColor?: string;\n};\n\nconst navigationItems: NavItemWithMobile[] = [\n\t{\n\t\tlabel: \"Ask Thorbis\",\n\t\thref: \"/dashboard/ai\",\n\t\tstatus: \"beta\",\n\t\tisSpecial: true,\n\t\tmobileIcon: \"AI\",\n\t\tmobileIconBg: \"bg-primary/10\",\n\t\tmobileIconColor: \"text-primary\",\n\t},\n\t{\n\t\tlabel: \"Today\",\n\t\thref: \"/dashboard\",\n\t\tmobileIcon: \"T\",\n\t\tmobileIconBg: \"bg-primary/10\",\n\t\tmobileIconColor: \"text-primary\",\n\t},\n\t{\n\t\tlabel: \"Schedule\",\n\t\thref: \"/dashboard/schedule\",\n\t\tmobileIcon: \"S\",\n\t\tmobileIconBg: \"bg-accent/10\",\n\t\tmobileIconColor: \"text-accent-foreground\",\n\t},\n\t{\n\t\tlabel: \"Communication\",\n\t\thref: \"/dashboard/communication\",\n\t\tmobileIcon: \"C\",\n\t\tmobileIconBg: \"bg-success/10\",\n\t\tmobileIconColor: \"text-success\",\n\t},\n\t{\n\t\tlabel: \"Work\",\n\t\thref: \"/dashboard/work\",\n\t\tstatus: \"beta\",\n\t\tmobileIcon: \"W\",\n\t\tmobileIconBg: \"bg-teal-500/10\",\n\t\tmobileIconColor: \"text-teal-600\",\n\t},\n\t{\n\t\tlabel: \"Finances\",\n\t\thref: \"/dashboard/finance\",\n\t\tstatus: \"coming-soon\",\n\t\tmobileIcon: \"F\",\n\t\tmobileIconBg: \"bg-emerald-500/10\",\n\t\tmobileIconColor: \"text-emerald-600\",\n\t},\n\t{\n\t\tlabel: \"Reporting\",\n\t\thref: \"/dashboard/reporting\",\n\t\tstatus: \"coming-soon\",\n\t\tmobileIcon: \"R\",\n\t\tmobileIconBg: \"bg-primary/10\",\n\t\tmobileIconColor: \"text-primary\",\n\t},\n\t{\n\t\tlabel: \"Marketing\",\n\t\thref: \"/dashboard/marketing\",\n\t\tstatus: \"coming-soon\",\n\t\tmobileIcon: \"M\",\n\t\tmobileIconBg: \"bg-accent/10\",\n\t\tmobileIconColor: \"text-accent-foreground\",\n\t},\n\t{\n\t\tlabel: \"Training\",\n\t\thref: \"/dashboard/training\",\n\t\tstatus: \"coming-soon\",\n\t\tmobileIcon: \"T\",\n\t\tmobileIconBg: \"bg-accent/10\",\n\t\tmobileIconColor: \"text-accent-foreground\",\n\t},\n];\n\n// Default logo for all companies\nconst defaultLogo = GalleryVerticalEnd;\n\nfunction StatusIndicator({ status }: { status?: NavItemStatus }) {\n\tif (!status) {\n\t\treturn null;\n\t}\n\n\t// For beta and coming-soon, show badge\n\tif (status === \"beta\") {\n\t\treturn (\n\t\t\t<span className=\"absolute -top-1.5 right-0 rounded bg-blue-500 px-1 py-0.5 text-[0.5rem] leading-none font-semibold tracking-wide text-white uppercase shadow-sm\">\n\t\t\t\tBeta\n\t\t\t</span>\n\t\t);\n\t}\n\n\tif (status === \"coming-soon\") {\n\t\treturn (\n\t\t\t<span className=\"absolute -top-1.5 right-0 rounded bg-purple-500 px-1 py-0.5 text-[0.5rem] leading-none font-semibold tracking-wide whitespace-nowrap text-white uppercase shadow-sm\">\n\t\t\t\tSoon\n\t\t\t</span>\n\t\t);\n\t}\n\n\t// Badge for \"new\" and \"updated\"\n\tif (status === \"new\") {\n\t\treturn (\n\t\t\t<span className=\"absolute -top-1.5 right-0 rounded bg-green-500 px-1 py-0.5 text-[0.5rem] leading-none font-semibold tracking-wide text-white uppercase shadow-sm\">\n\t\t\t\tNew\n\t\t\t</span>\n\t\t);\n\t}\n\n\treturn (\n\t\t<span\n\t\t\tclassName=\"absolute -top-1 right-0 size-2 rounded-full bg-blue-500 shadow-sm\"\n\t\t\ttitle=\"Updated\"\n\t\t/>\n\t);\n}\n\nfunction MobileStatusBadge({ status }: { status?: NavItemStatus }) {\n\tif (!status) {\n\t\treturn null;\n\t}\n\n\tconst styles = {\n\t\tbeta: \"bg-blue-500 text-white shadow-sm\",\n\t\tnew: \"bg-green-500 text-white shadow-sm\",\n\t\tupdated: \"bg-purple-500 text-white shadow-sm\",\n\t\t\"coming-soon\": \"bg-purple-500 text-white shadow-sm\",\n\t};\n\n\tconst labels = {\n\t\tbeta: \"Beta\",\n\t\tnew: \"New\",\n\t\tupdated: \"Updated\",\n\t\t\"coming-soon\": \"Soon\",\n\t};\n\n\treturn (\n\t\t<span\n\t\t\tclassName={`inline-flex items-center rounded-full px-2 py-0.5 text-[0.65rem] font-semibold tracking-wide uppercase ${styles[status]}`}\n\t\t>\n\t\t\t{labels[status]}\n\t\t</span>\n\t);\n}\n\nfunction formatBadgeCount(count: number): string {\n\tif (count <= 9) {\n\t\treturn count.toString();\n\t}\n\tif (count <= 99) {\n\t\treturn \"99+\";\n\t}\n\tif (count <= 999) {\n\t\treturn \"999+\";\n\t}\n\treturn \"1K+\";\n}\n\nfunction UnreadBadge({ count }: { count: number }) {\n\tif (count === 0) {\n\t\treturn null;\n\t}\n\treturn (\n\t\t<span className=\"absolute -top-1.5 right-0 rounded bg-red-500 px-1 py-0.5 text-[0.5rem] leading-none font-semibold tracking-wide text-white shadow-sm whitespace-nowrap\">\n\t\t\t{formatBadgeCount(count)}\n\t\t</span>\n\t);\n}\n\nexport function AppHeaderClient({\n\tuserProfile,\n\tcompanies,\n\tactiveCompanyId,\n\tcustomers = [],\n\tcompanyPhones = [],\n\thasPhoneNumbers = false,\n\thasPayrixAccount = false,\n\tpayrixStatus = null,\n\tsubHeader: _subHeader, // Ignore the server-passed subHeader\n}: AppHeaderClientProps) {\n\tconst pathname = usePathname();\n\n\t// Hide header completely on TV display route (not settings)\n\t// Check this early to avoid hooks issues\n\tconst isTVRoute = pathname === \"/dashboard/tv\";\n\n\t// Enable global keyboard shortcut for dialer (Ctrl+Shift+D or Cmd+Shift+D)\n\tuseDialerShortcut();\n\n\tconst [unreadCount, setUnreadCount] = useState(0);\n\n\t// Fetch unread count on mount, when pathname changes, and periodically\n\tuseEffect(() => {\n\t\tconst fetchUnreadCount = async () => {\n\t\t\ttry {\n\t\t\t\tconst result = await getTotalUnreadCountAction();\n\t\t\t\tif (result.success && result.count !== undefined) {\n\t\t\t\t\tsetUnreadCount(result.count);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Failed to fetch unread count:\", error);\n\t\t\t}\n\t\t};\n\n\t\t// Fetch immediately\n\t\tfetchUnreadCount();\n\n\t\t// Refresh every 30 seconds\n\t\tconst interval = setInterval(fetchUnreadCount, 30000);\n\n\t\treturn () => clearInterval(interval);\n\t}, [pathname]); // Refresh when pathname changes (e.g., navigating to/from communication page)\n\n\t// Return null for TV route AFTER all hooks have been called\n\tif (isTVRoute) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<header className=\"safe-top bg-header-bg sticky top-0 z-50 w-full\">\n\t\t\t\t<div className=\"flex h-14 items-center gap-2 px-4 md:px-6\">\n\n\t\t\t\t{/* Logo */}\n\t\t\t\t<Link\n\t\t\t\t\tclassName=\"hover:border-primary/20 hover:bg-primary/10 hover:text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:border-destructive aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 dark:hover:bg-accent/50 flex shrink-0 items-center justify-center gap-2 rounded-md text-sm font-medium whitespace-nowrap transition-all outline-none focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 size-10 md:size-8\"\n\t\t\t\t\tdata-slot=\"button\"\n\t\t\t\t\thref=\"/\"\n\t\t\t\t>\n\t\t\t\t\t<Image\n\t\t\t\t\t\talt=\"Thorbis\"\n\t\t\t\t\t\tclassName=\"size-5\"\n\t\t\t\t\t\theight={20}\n\t\t\t\t\t\tsrc=\"/ThorbisLogo.webp\"\n\t\t\t\t\t\twidth={20}\n\t\t\t\t\t/>\n\t\t\t\t\t<span className=\"sr-only\">Thorbis</span>\n\t\t\t\t</Link>\n\n\t\t\t\t{/* Main Navigation - Desktop only, mobile uses bottom tabs */}\n\t\t\t\t<nav className=\"hidden items-center gap-0.5 ml-2 lg:flex\">\n\t\t\t\t\t{navigationItems.map((item) => {\n\t\t\t\t\t\tconst isActive =\n\t\t\t\t\t\t\titem.href === \"/dashboard\"\n\t\t\t\t\t\t\t\t? pathname === \"/dashboard\"\n\t\t\t\t\t\t\t\t: pathname?.startsWith(item.href);\n\n\t\t\t\t\t\tif (item.isSpecial) {\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<div className=\"relative\" key={item.href}>\n\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\tclassName={`focus-visible:ring-ring/50 relative inline-flex h-8 shrink-0 items-center justify-center gap-1.5 rounded-md px-3 text-sm font-medium whitespace-nowrap transition-all duration-150 outline-none focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 ${\n\t\t\t\t\t\t\t\t\t\t\tisActive\n\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-primary/15 text-primary dark:bg-primary/25 shadow-sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground hover:bg-muted/70 hover:text-foreground\"\n\t\t\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t\t\t\tdata-slot=\"button\"\n\t\t\t\t\t\t\t\t\t\thref={item.href}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{item.label}\n\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t<StatusIndicator status={item.status} />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div className=\"relative\" key={item.href}>\n\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\tclassName={`focus-visible:ring-ring/50 relative inline-flex h-8 shrink-0 items-center justify-center gap-1.5 rounded-md px-3 text-sm font-medium whitespace-nowrap transition-all duration-150 outline-none focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 ${\n\t\t\t\t\t\t\t\t\t\tisActive\n\t\t\t\t\t\t\t\t\t\t\t? \"bg-primary/15 text-primary dark:bg-primary/25 shadow-sm\"\n\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground hover:bg-muted/70 hover:text-foreground\"\n\t\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t\t\tdata-slot=\"button\"\n\t\t\t\t\t\t\t\t\thref={item.href}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{item.label}\n\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t<StatusIndicator status={item.status} />\n\t\t\t\t\t\t\t\t{item.href === \"/dashboard/communication\" && (\n\t\t\t\t\t\t\t\t\t<UnreadBadge count={unreadCount} />\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n\t\t\t\t\t})}\n\t\t\t\t</nav>\n\n\t\t\t\t{/* Right side controls */}\n\t\t\t\t<div className=\"ml-auto flex items-center gap-2 overflow-visible md:flex-1 md:justify-end\">\n\t\t\t\t\t{/* Quick Add Menu */}\n\t\t\t\t\t<QuickAddDropdown />\n\n\t\t\t\t\t{/* Phone/Calls */}\n\t\t\t\t\t<PhoneDropdown\n\t\t\t\t\t\tcompanyId={activeCompanyId || \"\"}\n\t\t\t\t\t\tcompanyPhones={companyPhones}\n\t\t\t\t\t/>\n\n\t\t\t\t\t{/* TV Display */}\n\t\t\t\t\t<Link href=\"/dashboard/tv\" title=\"TV Display\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclassName=\"hover-gradient hover:border-primary/20 hover:bg-primary/10 hover:text-primary focus-visible:ring-ring/50 flex items-center justify-center rounded-md border border-transparent transition-all outline-none focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 size-10 md:size-8\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Tv className=\"size-4\" />\n\t\t\t\t\t\t\t<span className=\"sr-only\">TV Display</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Link>\n\n\t\t\t\t\t{/* AI Pending Actions (Owner Approval) */}\n\t\t\t\t\t<PendingActionsIndicator />\n\n\t\t\t\t\t{/* Notifications */}\n\t\t\t\t\t<NotificationsDropdown\n\t\t\t\t\t\thasPhoneNumbers={hasPhoneNumbers}\n\t\t\t\t\t\thasPayrixAccount={hasPayrixAccount}\n\t\t\t\t\t\tpayrixStatus={payrixStatus}\n\t\t\t\t\t/>\n\n\t\t\t\t\t{/* Help */}\n\t\t\t\t\t<HelpDropdown />\n\n\t\t\t\t\t{/* User Menu - Data passed from server, no loading state needed */}\n\t\t\t\t\t{/* Deduplicate companies by ID to prevent duplicates */}\n\t\t\t\t\t<UserMenu\n\t\t\t\t\t\tactiveCompanyId={activeCompanyId}\n\t\t\t\t\t\tteams={Array.from(\n\t\t\t\t\t\t\tnew Map(\n\t\t\t\t\t\t\t\tcompanies.map((company) => [\n\t\t\t\t\t\t\t\t\tcompany.id,\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tid: company.id,\n\t\t\t\t\t\t\t\t\t\tname: company.name,\n\t\t\t\t\t\t\t\t\t\tlogo: company.logo,\n\t\t\t\t\t\t\t\t\t\tplan: company.plan,\n\t\t\t\t\t\t\t\t\t\tonboardingComplete: company.onboardingComplete,\n\t\t\t\t\t\t\t\t\t\thasPayment: company.hasPayment,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t).values(),\n\t\t\t\t\t\t)}\n\t\t\t\t\t\tuser={{\n\t\t\t\t\t\t\tname: userProfile.name,\n\t\t\t\t\t\t\temail: userProfile.email,\n\t\t\t\t\t\t\tavatar: userProfile.avatar,\n\t\t\t\t\t\t\tstatus: userProfile.status,\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</header>\n\t</>\n\t);\n}\n","\"use client\";\n\nimport { useEffect } from \"react\";\nimport { useDialerStore } from \"@/lib/stores/dialer-store\";\n\n/**\n * Global keyboard shortcut hook for the phone dialer\n *\n * Listens for Ctrl+Shift+D (or Cmd+Shift+D on Mac) to toggle the dialer\n *\n * Usage: Call this hook once in a layout component\n */\nexport function useDialerShortcut() {\n\tconst openDialer = useDialerStore((state) => state.openDialer);\n\tconst closeDialer = useDialerStore((state) => state.closeDialer);\n\tconst isOpen = useDialerStore((state) => state.isOpen);\n\n\tuseEffect(() => {\n\t\tconst handleKeyDown = (event: KeyboardEvent) => {\n\t\t\t// Check for Ctrl+Shift+D (Windows/Linux) or Cmd+Shift+D (Mac)\n\t\t\tif (\n\t\t\t\t(event.ctrlKey || event.metaKey) &&\n\t\t\t\tevent.shiftKey &&\n\t\t\t\tevent.key === \"D\"\n\t\t\t) {\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\t// Toggle dialer\n\t\t\t\tif (isOpen) {\n\t\t\t\t\tcloseDialer();\n\t\t\t\t} else {\n\t\t\t\t\topenDialer();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\twindow.addEventListener(\"keydown\", handleKeyDown);\n\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", handleKeyDown);\n\t\t};\n\t}, [openDialer, closeDialer, isOpen]);\n}\n","\"use client\";\n\nimport {\n\tBookOpen,\n\tExternalLink,\n\tHelpCircle,\n\tLifeBuoy,\n\tMessageCircle,\n\tVideo,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useEffect, useRef, useState } from \"react\";\n\ntype HelpItem = {\n\tlabel: string;\n\tdescription: string;\n\thref: string;\n\ticon: typeof BookOpen;\n\texternal?: boolean;\n};\n\nconst helpItems: HelpItem[] = [\n\t{\n\t\tlabel: \"Documentation\",\n\t\tdescription: \"Guides and tutorials for all features\",\n\t\thref: \"/docs\",\n\t\ticon: BookOpen,\n\t},\n\t{\n\t\tlabel: \"Video Tutorials\",\n\t\tdescription: \"Step-by-step video guides\",\n\t\thref: \"/docs/videos\",\n\t\ticon: Video,\n\t},\n\t{\n\t\tlabel: \"Support Center\",\n\t\tdescription: \"Get help from our support team\",\n\t\thref: \"/support\",\n\t\ticon: LifeBuoy,\n\t},\n\t{\n\t\tlabel: \"Contact Support\",\n\t\tdescription: \"Chat with our support team\",\n\t\thref: \"/support/contact\",\n\t\ticon: MessageCircle,\n\t},\n\t{\n\t\tlabel: \"What's New\",\n\t\tdescription: \"Latest features and updates\",\n\t\thref: \"/changelog\",\n\t\ticon: HelpCircle,\n\t},\n];\n\nexport function HelpDropdown() {\n\tconst [isOpen, setIsOpen] = useState(false);\n\tconst dropdownRef = useRef<HTMLDivElement>(null);\n\n\tuseEffect(() => {\n\t\tconst handleClickOutside = (event: MouseEvent) => {\n\t\t\tif (\n\t\t\t\tdropdownRef.current &&\n\t\t\t\t!dropdownRef.current.contains(event.target as Node)\n\t\t\t) {\n\t\t\t\tsetIsOpen(false);\n\t\t\t}\n\t\t};\n\n\t\tif (isOpen) {\n\t\t\tdocument.addEventListener(\"mousedown\", handleClickOutside);\n\t\t}\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"mousedown\", handleClickOutside);\n\t\t};\n\t}, [isOpen]);\n\n\treturn (\n\t\t<div className=\"relative\" ref={dropdownRef}>\n\t\t\t<button\n\t\t\t\tclassName=\"hover-gradient hover:border-primary/20 hover:bg-primary/10 hover:text-primary focus-visible:ring-ring/50 flex h-8 w-8 items-center justify-center rounded-md border border-transparent transition-all outline-none focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50\"\n\t\t\t\tonClick={() => setIsOpen(!isOpen)}\n\t\t\t\ttitle=\"Help\"\n\t\t\t\ttype=\"button\"\n\t\t\t>\n\t\t\t\t<HelpCircle className=\"size-4\" />\n\t\t\t\t<span className=\"sr-only\">Help</span>\n\t\t\t</button>\n\n\t\t\t{isOpen && (\n\t\t\t\t<div className=\"bg-popover text-popover-foreground absolute top-full right-0 z-50 mt-2 w-80 rounded-lg border p-2 shadow-lg\">\n\t\t\t\t\t<div className=\"mb-2 border-b px-3 py-2\">\n\t\t\t\t\t\t<h3 className=\"text-sm font-semibold\">Help &amp; Support</h3>\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\tFind answers and get assistance\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"space-y-1\">\n\t\t\t\t\t\t{helpItems.map((item) => {\n\t\t\t\t\t\t\tconst Icon = item.icon;\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\tclassName=\"hover:bg-accent flex items-start gap-3 rounded-md px-3 py-2.5 transition-colors\"\n\t\t\t\t\t\t\t\t\thref={item.href}\n\t\t\t\t\t\t\t\t\tkey={item.label}\n\t\t\t\t\t\t\t\t\tonClick={() => setIsOpen(false)}\n\t\t\t\t\t\t\t\t\trel={item.external ? \"noopener noreferrer\" : undefined}\n\t\t\t\t\t\t\t\t\ttarget={item.external ? \"_blank\" : undefined}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Icon className=\"text-muted-foreground mt-0.5 size-4 shrink-0\" />\n\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-medium\">{item.label}</p>\n\t\t\t\t\t\t\t\t\t\t\t{item.external && (\n\t\t\t\t\t\t\t\t\t\t\t\t<ExternalLink className=\"text-muted-foreground size-3\" />\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{item.description}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"mt-2 border-t pt-2\">\n\t\t\t\t\t\t<div className=\"bg-accent/50 rounded-md px-3 py-2\">\n\t\t\t\t\t\t\t<p className=\"text-xs font-medium\">Need more help?</p>\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\tEmail us at{\" \"}\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\tclassName=\"text-primary hover:underline\"\n\t\t\t\t\t\t\t\t\thref=\"mailto:support@thorbis.com\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tsupport@thorbis.com\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","\"use client\";\n\n/**\n * NotificationsDropdown - Client Component\n *\n * Client-side features:\n * - Interactive dropdown with notifications\n * - Real-time updates via Zustand store and Supabase Realtime\n * - Optimistic updates for better UX\n * - Mark as read/delete functionality\n */\n\nimport {\n\tAlertCircle,\n\tBell,\n\tCheck,\n\tCheckCheck,\n\tCheckCircle2,\n\tClock,\n\tCreditCard,\n\tDollarSign,\n\tLoader2,\n\tMessageSquare,\n\tPhone,\n\tSettings,\n\tTrash2,\n\tUserPlus,\n\tWrench,\n\tX,\n\tXCircle,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useEffect, useRef, useState } from \"react\";\nimport {\n\tdeleteNotification as deleteNotificationAction,\n\tmarkAllAsRead as markAllAsReadAction,\n\tmarkAsRead as markAsReadAction,\n} from \"@/actions/notifications\";\nimport type { NotificationType } from \"@/lib/stores/notifications-store\";\nimport { useNotificationsStore } from \"@/lib/stores/notifications-store\";\nimport { useSyncStore } from \"@/lib/stores/sync-store\";\nimport { createClient } from \"@/lib/supabase/client\";\n\n// Time constants in milliseconds\nconst MS_PER_SECOND = 1000;\nconst MS_PER_MINUTE = 60 * MS_PER_SECOND;\nconst MS_PER_HOUR = 60 * MS_PER_MINUTE;\n\nconst notificationIcons: Record<NotificationType, typeof Bell> = {\n\tmessage: MessageSquare,\n\talert: AlertCircle,\n\tpayment: DollarSign,\n\tjob: Wrench,\n\tteam: UserPlus,\n\tsystem: Settings,\n};\n\nconst notificationColors: Record<NotificationType, string> = {\n\tmessage: \"text-primary\",\n\talert: \"text-warning\",\n\tpayment: \"text-success\",\n\tjob: \"text-accent-foreground\",\n\tteam: \"text-cyan-500\",\n\tsystem: \"text-muted-foreground\",\n};\n\n// Display constants\nconst ONE_MINUTE = 60;\nconst ONE_HOUR = 24;\nconst ONE_WEEK = 7;\n\nfunction formatBadgeCount(count: number): string {\n\tif (count <= 9) {\n\t\treturn count.toString();\n\t}\n\tif (count <= 99) {\n\t\treturn \"99+\";\n\t}\n\tif (count <= 999) {\n\t\treturn \"999+\";\n\t}\n\treturn \"1K+\";\n}\n\nfunction formatTimestamp(date: Date): string {\n\tconst now = new Date();\n\tconst diffMs = now.getTime() - date.getTime();\n\tconst diffMins = Math.floor(diffMs / MS_PER_MINUTE);\n\tconst diffHours = Math.floor(diffMs / MS_PER_HOUR);\n\tconst diffDays = Math.floor(diffMs / (MS_PER_HOUR * 24));\n\n\tif (diffMins < 1) {\n\t\treturn \"Just now\";\n\t}\n\tif (diffMins < ONE_MINUTE) {\n\t\treturn `${diffMins}m ago`;\n\t}\n\tif (diffHours < ONE_HOUR) {\n\t\treturn `${diffHours}h ago`;\n\t}\n\tif (diffDays < ONE_WEEK) {\n\t\treturn `${diffDays}d ago`;\n\t}\n\n\treturn date.toLocaleDateString();\n}\n\nfunction NotificationBadge({ count }: { count: number }) {\n\tif (count === 0) {\n\t\treturn null;\n\t}\n\treturn (\n\t\t<span className=\"bg-destructive absolute -top-1 -right-1 flex h-[18px] min-w-[18px] items-center justify-center rounded-full px-1.5 text-[0.625rem] leading-none font-bold text-white\">\n\t\t\t{formatBadgeCount(count)}\n\t\t</span>\n\t);\n}\n\nfunction EmptyState() {\n\treturn (\n\t\t<div className=\"flex flex-col items-center justify-center py-12 text-center\">\n\t\t\t<Bell className=\"text-muted-foreground/30 mb-3 size-12\" />\n\t\t\t<p className=\"text-muted-foreground text-sm font-medium\">\n\t\t\t\tAll caught up!\n\t\t\t</p>\n\t\t\t<p className=\"text-muted-foreground text-xs\">No new notifications</p>\n\t\t</div>\n\t);\n}\n\ntype NotificationsDropdownProps = {\n\thasPhoneNumbers?: boolean;\n\thasPayrixAccount?: boolean;\n\tpayrixStatus?: string | null;\n};\n\nexport function NotificationsDropdown({\n\thasPhoneNumbers = false,\n\thasPayrixAccount = false,\n\tpayrixStatus = null,\n}: NotificationsDropdownProps = {}) {\n\tconst [isOpen, setIsOpen] = useState(false);\n\tconst dropdownRef = useRef<HTMLDivElement>(null);\n\n\t// Get notifications from Zustand store\n\tconst notifications = useNotificationsStore((state) => state.notifications);\n\tconst unreadCount = useNotificationsStore((state) => state.unreadCount);\n\tconst setNotifications = useNotificationsStore(\n\t\t(state) => state.setNotifications,\n\t);\n\tconst optimisticMarkAsRead = useNotificationsStore(\n\t\t(state) => state.optimisticMarkAsRead,\n\t);\n\tconst optimisticMarkAllAsRead = useNotificationsStore(\n\t\t(state) => state.optimisticMarkAllAsRead,\n\t);\n\tconst optimisticDelete = useNotificationsStore(\n\t\t(state) => state.optimisticDelete,\n\t);\n\tconst subscribe = useNotificationsStore((state) => state.subscribe);\n\tconst unsubscribe = useNotificationsStore((state) => state.unsubscribe);\n\n\t// Get sync operations from sync store\n\tconst operations = useSyncStore((state) => state.operations ?? []);\n\tconst offlineQueue = useSyncStore((state) => state.offlineQueue ?? []);\n\tconst clearCompleted = useSyncStore((state) => state.clearCompleted);\n\n\t// Filter for active operations\n\tconst activeOperations = operations.filter(\n\t\t(op) => op.status === \"in_progress\",\n\t);\n\tconst recentOperations = operations.filter(\n\t\t(op) => op.status === \"completed\" || op.status === \"failed\",\n\t);\n\n\tconst hasSyncActivity =\n\t\tactiveOperations.length > 0 || offlineQueue.length > 0;\n\tconst syncBadgeCount = activeOperations.length + offlineQueue.length;\n\tconst totalBadgeCount = unreadCount + syncBadgeCount;\n\n\t// Load notifications and set up realtime subscription on mount\n\tconst hasInitializedRef = useRef(false);\n\n\tuseEffect(() => {\n\t\tif (!isOpen || hasInitializedRef.current) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet cancelled = false;\n\n\t\tasync function initialize() {\n\t\t\ttry {\n\t\t\t\tconst supabase = createClient();\n\n\t\t\t\tif (!supabase) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst {\n\t\t\t\t\tdata: { user },\n\t\t\t\t} = await supabase.auth.getUser();\n\n\t\t\t\tif (!user) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst { data, error } = await supabase\n\t\t\t\t\t.from(\"notifications\")\n\t\t\t\t\t.select(\"*\")\n\t\t\t\t\t.eq(\"user_id\", user.id)\n\t\t\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t\t\t.range(0, 49);\n\n\t\t\t\tif (!cancelled && !error && data) {\n\t\t\t\t\tsetNotifications(data);\n\t\t\t\t}\n\n\t\t\t\tif (!cancelled) {\n\t\t\t\t\tawait subscribe(user.id);\n\t\t\t\t\thasInitializedRef.current = true;\n\t\t\t\t}\n\t\t\t} catch (_error) {\n\t\t\t\t// Ignore initialization errors - component can retry later\n\t\t\t}\n\t\t}\n\n\t\tinitialize();\n\n\t\treturn () => {\n\t\t\tcancelled = true;\n\t\t};\n\t}, [isOpen, setNotifications, subscribe]);\n\n\tuseEffect(() => {\n\t\treturn () => {\n\t\t\tunsubscribe();\n\t\t};\n\t}, [unsubscribe]);\n\n\t// Handle click outside to close dropdown\n\tuseEffect(() => {\n\t\tconst handleClickOutside = (event: MouseEvent) => {\n\t\t\tif (\n\t\t\t\tdropdownRef.current &&\n\t\t\t\t!dropdownRef.current.contains(event.target as Node)\n\t\t\t) {\n\t\t\t\tsetIsOpen(false);\n\t\t\t}\n\t\t};\n\n\t\tif (isOpen) {\n\t\t\tdocument.addEventListener(\"mousedown\", handleClickOutside);\n\t\t}\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"mousedown\", handleClickOutside);\n\t\t};\n\t}, [isOpen]);\n\n\t// Mark notification as read with optimistic update\n\tconst markAsRead = async (id: string) => {\n\t\t// Optimistic update\n\t\toptimisticMarkAsRead(id);\n\n\t\t// Server action\n\t\tconst result = await markAsReadAction(id);\n\t\tif (!result.success) {\n\t\t\t// Optimistic update already applied - log error but don't block UI\n\t\t\tconsole.error(\"Failed to mark notification as read:\", result.error);\n\t\t}\n\t};\n\n\t// Mark all notifications as read with optimistic update\n\tconst markAllAsRead = async () => {\n\t\t// Optimistic update\n\t\toptimisticMarkAllAsRead();\n\n\t\t// Server action\n\t\tconst result = await markAllAsReadAction();\n\t\tif (!result.success) {\n\t\t\t// Optimistic update already applied - log error but don't block UI\n\t\t\tconsole.error(\"Failed to mark all notifications as read:\", result.error);\n\t\t}\n\t};\n\n\t// Delete notification with optimistic update\n\tconst deleteNotification = async (id: string) => {\n\t\t// Optimistic update\n\t\toptimisticDelete(id);\n\n\t\t// Server action\n\t\tconst result = await deleteNotificationAction(id);\n\t\tif (!result.success) {\n\t\t\t// Optimistic update already applied - log error but don't block UI\n\t\t\tconsole.error(\"Failed to delete notification:\", result.error);\n\t\t}\n\t};\n\n\treturn (\n\t\t<div className=\"relative overflow-visible\" ref={dropdownRef}>\n\t\t\t<button\n\t\t\t\tclassName=\"hover-gradient hover:border-primary/20 hover:bg-primary/10 hover:text-primary focus-visible:ring-ring/50 relative flex h-8 w-8 items-center justify-center rounded-md border border-transparent transition-all outline-none focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50\"\n\t\t\t\tonClick={() => setIsOpen(!isOpen)}\n\t\t\t\ttitle={\n\t\t\t\t\thasSyncActivity ? \"Notifications & Sync Status\" : \"Notifications\"\n\t\t\t\t}\n\t\t\t\ttype=\"button\"\n\t\t\t>\n\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t<Bell className=\"size-4\" />\n\t\t\t\t\t{hasSyncActivity && (\n\t\t\t\t\t\t<Loader2 className=\"text-primary absolute -top-1 -right-1 size-2.5 animate-spin\" />\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t\t<NotificationBadge count={totalBadgeCount} />\n\t\t\t\t<span className=\"sr-only\">\n\t\t\t\t\tNotifications {unreadCount > 0 && `(${unreadCount} unread)`}\n\t\t\t\t\t{hasSyncActivity && ` • ${syncBadgeCount} syncing`}\n\t\t\t\t</span>\n\t\t\t</button>\n\n\t\t\t{isOpen && (\n\t\t\t\t<div className=\"bg-popover text-popover-foreground absolute top-full right-0 z-50 mt-2 flex w-[380px] max-w-[calc(100vw-2rem)] flex-col rounded-lg border shadow-lg\">\n\t\t\t\t\t{/* Header */}\n\t\t\t\t\t<div className=\"flex items-center justify-between border-b px-4 py-2.5\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<h3 className=\"text-sm font-semibold\">\n\t\t\t\t\t\t\t\t{hasSyncActivity ? \"Sync & Notifications\" : \"Notifications\"}\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t{(unreadCount > 0 || hasSyncActivity) && (\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t{hasSyncActivity && `${syncBadgeCount} syncing`}\n\t\t\t\t\t\t\t\t\t{hasSyncActivity && unreadCount > 0 && \" • \"}\n\t\t\t\t\t\t\t\t\t{unreadCount > 0 && `${unreadCount} unread`}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t{unreadCount > 0 && (\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclassName=\"hover:bg-accent flex h-7 w-7 items-center justify-center rounded-md transition-colors\"\n\t\t\t\t\t\t\t\t\tonClick={markAllAsRead}\n\t\t\t\t\t\t\t\t\ttitle=\"Mark all as read\"\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<CheckCheck className=\"size-3.5\" />\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclassName=\"hover:bg-accent flex h-7 w-7 items-center justify-center rounded-md transition-colors\"\n\t\t\t\t\t\t\t\tonClick={() => setIsOpen(false)}\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<X className=\"size-3.5\" />\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Sync Operations */}\n\t\t\t\t\t{(activeOperations.length > 0 ||\n\t\t\t\t\t\tofflineQueue.length > 0 ||\n\t\t\t\t\t\trecentOperations.length > 0) && (\n\t\t\t\t\t\t<div className=\"border-b\">\n\t\t\t\t\t\t\t{/* Active Operations */}\n\t\t\t\t\t\t\t{activeOperations.length > 0 && (\n\t\t\t\t\t\t\t\t<div className=\"space-y-1 px-4 py-3\">\n\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mb-2 text-xs font-medium tracking-wider uppercase\">\n\t\t\t\t\t\t\t\t\t\tActive\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t{activeOperations.map((op) => (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"bg-primary/5 flex items-start gap-2 rounded-md p-2\"\n\t\t\t\t\t\t\t\t\t\t\tkey={op.id}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"text-primary mt-0.5 size-3.5 shrink-0 animate-spin\" />\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm leading-tight font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{op.title}\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t{op.description && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{op.description}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t{op.total && op.total > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"mt-1 space-y-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"bg-muted h-1 overflow-hidden rounded-full\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"bg-primary h-full transition-all\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidth: `${((op.current ?? 0) / op.total) * 100}%`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-[0.625rem]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{op.current ?? 0} / {op.total}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t{/* Offline Queue */}\n\t\t\t\t\t\t\t{offlineQueue.length > 0 && (\n\t\t\t\t\t\t\t\t<div className=\"space-y-1 px-4 py-3\">\n\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mb-2 flex items-center gap-1.5 text-xs font-medium tracking-wider uppercase\">\n\t\t\t\t\t\t\t\t\t\t<span className=\"size-1.5 animate-pulse rounded-full bg-orange-500\" />\n\t\t\t\t\t\t\t\t\t\tQueued (Offline)\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t{offlineQueue.map((op) => (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-start gap-2 rounded-md bg-orange-50 p-2 dark:bg-orange-950/20\"\n\t\t\t\t\t\t\t\t\t\t\tkey={op.id}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Clock className=\"mt-0.5 size-3.5 shrink-0 text-orange-500\" />\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm leading-tight font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{op.action}\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"mt-0.5 text-[0.625rem] text-orange-600 dark:text-orange-400\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tWill sync when online\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t{/* Recent Operations */}\n\t\t\t\t\t\t\t{recentOperations.length > 0 && (\n\t\t\t\t\t\t\t\t<div className=\"space-y-1 px-4 py-3\">\n\t\t\t\t\t\t\t\t\t<div className=\"mb-2 flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs font-medium tracking-wider uppercase\">\n\t\t\t\t\t\t\t\t\t\t\tRecent\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-muted-foreground hover:text-foreground text-xs\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={clearCompleted}\n\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\tClear\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{recentOperations.map((op) => (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName={`flex items-start gap-2 rounded-md p-2 ${\n\t\t\t\t\t\t\t\t\t\t\t\top.status === \"completed\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-green-50 dark:bg-green-950/20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-red-50 dark:bg-red-950/20\"\n\t\t\t\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t\t\t\t\tkey={op.id}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{op.status === \"completed\" ? (\n\t\t\t\t\t\t\t\t\t\t\t\t<CheckCircle2 className=\"mt-0.5 size-3.5 shrink-0 text-green-600 dark:text-green-400\" />\n\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t<XCircle className=\"mt-0.5 size-3.5 shrink-0 text-red-600 dark:text-red-400\" />\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm leading-tight font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{op.title}\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t{op.error && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-red-600 dark:text-red-400\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{op.error}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Notifications List */}\n\t\t\t\t\t<div className=\"max-h-[450px] overflow-y-auto\">\n\t\t\t\t\t\t{/* System Notification - Phone Numbers Setup Missing */}\n\t\t\t\t\t\t{!hasPhoneNumbers && (\n\t\t\t\t\t\t\t<div className=\"border-b\">\n\t\t\t\t\t\t\t\t<div className=\"group bg-warning/10 hover:bg-warning/15 relative px-4 py-3 transition-colors\">\n\t\t\t\t\t\t\t\t\t{/* Warning indicator */}\n\t\t\t\t\t\t\t\t\t<div className=\"bg-warning absolute top-0 left-0 h-full w-0.5\" />\n\n\t\t\t\t\t\t\t\t\t<div className=\"flex gap-3\">\n\t\t\t\t\t\t\t\t\t\t{/* Icon */}\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-warning mt-0.5 shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<Phone className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t{/* Content */}\n\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1 space-y-1\">\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm leading-snug font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\tPhone System Not Configured\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs leading-relaxed\">\n\t\t\t\t\t\t\t\t\t\t\t\tYou cannot use calling, texting, or communication\n\t\t\t\t\t\t\t\t\t\t\t\tfeatures without setting up phone numbers. Complete the\n\t\t\t\t\t\t\t\t\t\t\t\tsetup to enable phone system capabilities.\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\n\t\t\t\t\t\t\t\t\t\t\t{/* Footer */}\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2 pt-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground flex items-center gap-1 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertCircle className=\"size-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tSystem Alert\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t{/* Actions */}\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"bg-warning/20 text-warning hover:bg-warning/30 rounded px-2 py-1 text-xs font-medium transition-colors\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thref=\"/welcome?step=3\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setIsOpen(false)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tComplete Setup\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{/* System Notification - Payrix Setup Missing */}\n\t\t\t\t\t\t{!hasPayrixAccount && (\n\t\t\t\t\t\t\t<div className=\"border-b\">\n\t\t\t\t\t\t\t\t<div className=\"group bg-warning/10 hover:bg-warning/15 relative px-4 py-3 transition-colors\">\n\t\t\t\t\t\t\t\t\t{/* Warning indicator */}\n\t\t\t\t\t\t\t\t\t<div className=\"bg-warning absolute top-0 left-0 h-full w-0.5\" />\n\n\t\t\t\t\t\t\t\t\t<div className=\"flex gap-3\">\n\t\t\t\t\t\t\t\t\t\t{/* Icon */}\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-warning mt-0.5 shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<CreditCard className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t{/* Content */}\n\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1 space-y-1\">\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm leading-snug font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\tPayment Processing Not Configured\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs leading-relaxed\">\n\t\t\t\t\t\t\t\t\t\t\t\tYou cannot collect payments from customers without\n\t\t\t\t\t\t\t\t\t\t\t\tsetting up your merchant account. Complete the setup to\n\t\t\t\t\t\t\t\t\t\t\t\tstart accepting payments on invoices and estimates.\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\n\t\t\t\t\t\t\t\t\t\t\t{/* Footer */}\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2 pt-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground flex items-center gap-1 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertCircle className=\"size-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\tSystem Alert\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t{/* Actions */}\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"bg-warning/20 text-warning hover:bg-warning/30 rounded px-2 py-1 text-xs font-medium transition-colors\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thref=\"/welcome?step=5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setIsOpen(false)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tComplete Setup\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{notifications.length === 0 &&\n\t\t\t\t\t\thasPhoneNumbers &&\n\t\t\t\t\t\thasPayrixAccount ? (\n\t\t\t\t\t\t\t<EmptyState />\n\t\t\t\t\t\t) : notifications.length > 0 ? (\n\t\t\t\t\t\t\t<div className=\"divide-y\">\n\t\t\t\t\t\t\t\t{notifications.map((notification) => {\n\t\t\t\t\t\t\t\t\tconst Icon = notificationIcons[notification.type];\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName={`group hover:bg-accent/50 relative px-4 py-3 transition-colors ${\n\t\t\t\t\t\t\t\t\t\t\t\tnotification.read ? \"\" : \"bg-primary/5\"\n\t\t\t\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t\t\t\t\tkey={notification.id}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{/* Unread indicator */}\n\t\t\t\t\t\t\t\t\t\t\t{!notification.read && (\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"bg-primary absolute top-0 left-0 h-full w-0.5\" />\n\t\t\t\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t{/* Icon */}\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={`mt-0.5 shrink-0 ${notificationColors[notification.type]}`}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Icon className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t{/* Content */}\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1 space-y-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm leading-snug font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{notification.title}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs leading-relaxed\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{notification.message}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Footer */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2 pt-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground flex items-center gap-1 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Clock className=\"size-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatTimestamp(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnew Date(notification.created_at),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Actions */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{notification.action_url && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-primary hover:bg-primary/10 rounded px-2 py-1 text-xs font-medium transition-colors\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thref={notification.action_url}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmarkAsRead(notification.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsOpen(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{notification.action_label || \"View\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{!notification.read && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"hover:bg-accent flex h-6 w-6 items-center justify-center rounded transition-colors\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => markAsRead(notification.id)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Mark as read\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Check className=\"size-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"hover:bg-destructive/10 hover:text-destructive flex h-6 w-6 items-center justify-center rounded transition-colors\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdeleteNotification(notification.id)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Delete\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"size-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) : null}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Footer */}\n\t\t\t\t\t{notifications.length > 0 && (\n\t\t\t\t\t\t<div className=\"border-t px-4 py-2\">\n\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\tclassName=\"text-primary hover:bg-accent flex items-center justify-center rounded-md py-1.5 text-xs font-medium transition-colors\"\n\t\t\t\t\t\t\t\thref=\"/dashboard/notifications\"\n\t\t\t\t\t\t\t\tonClick={() => setIsOpen(false)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tView all notifications\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","\"use client\";\n\n/**\n * PhoneDropdown - Enterprise Phone Dialer\n *\n * Full-featured dialer with:\n * - WebRTC primary mode (browser audio)\n * - Call Control API fallback (opens call window)\n * - Connection status monitoring\n * - Automatic reconnection\n * - Customer search\n *\n * References:\n * - https://developers.telnyx.com/docs/voice/webrtc/js-sdk/quickstart\n * - https://developers.telnyx.com/docs/voice/webrtc/js-sdk/error-handling\n */\n\nimport type { Call as TelnyxCall } from \"@telnyx/webrtc\";\nimport {\n\tAlertCircle,\n\tCheck,\n\tChevronDown,\n\tClock,\n\tExternalLink,\n\tHeadphones,\n\tLoader2,\n\tMessageSquare,\n\tMic,\n\tMicOff,\n\tPause,\n\tPhone,\n\tPhoneCall,\n\tPhoneIncoming,\n\tPhoneMissed,\n\tPhoneOff,\n\tPhoneOutgoing,\n\tPlay,\n\tRefreshCw,\n\tServer,\n\tUser,\n\tWifi,\n\tWifiOff,\n\tX,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useCallback, useEffect, useMemo, useRef, useState, useTransition } from \"react\";\nimport { makeCall } from \"@/actions/telnyx\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tCommand,\n\tCommandEmpty,\n\tCommandGroup,\n\tCommandInput,\n\tCommandItem,\n\tCommandList,\n} from \"@/components/ui/command\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { useDialerCustomers } from \"@/hooks/use-dialer-customers\";\nimport { useTelnyxWebRTC, type WebRTCCall, type CallState } from \"@/hooks/use-telnyx-webrtc\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useDialerStore } from \"@/lib/stores/dialer-store\";\nimport { useUIStore } from \"@/lib/stores/ui-store\";\nimport { fetchWebRTCCredentialsOnce, resetWebRTCCredentialsCache } from \"@/lib/telnyx/web-credentials-client\";\nimport { cn } from \"@/lib/utils\";\n\ntype Customer = {\n\tid: string;\n\tfirst_name: string | null;\n\tlast_name: string | null;\n\tdisplay_name: string | null;\n\temail: string | null;\n\tphone: string | null;\n\tsecondary_phone?: string | null;\n\tcompany_name?: string | null;\n};\n\ntype CompanyPhone = {\n\tid: string;\n\tnumber: string;\n\tlabel?: string;\n};\n\ntype PhoneDropdownProps = {\n\tcompanyId: string;\n\tcompanyPhones?: CompanyPhone[];\n\tincomingCallsCount?: number;\n};\n\ntype ConnectionStatus = \"disconnected\" | \"connecting\" | \"connected\" | \"error\";\ntype CallMode = \"webrtc\" | \"api\";\n\n// Constants\nconst WEBRTC_CONNECTION_TIMEOUT = 15000; // 15 seconds\nconst WEBRTC_RETRY_DELAY = 3000; // 3 seconds\n\n// Helper functions\nconst cleanValue = (v?: string | null) => (v ?? \"\").trim();\n\nconst getCustomerName = (c: Customer) => {\n\tif (c.display_name?.trim()) return c.display_name.trim();\n\tconst name = [c.first_name, c.last_name].map(cleanValue).filter(Boolean).join(\" \");\n\treturn name || c.email?.trim() || \"Unknown\";\n};\n\nconst formatPhone = (phone: string) => {\n\tconst d = phone.replace(/\\D/g, \"\");\n\tif (d.length === 11 && d[0] === \"1\") {\n\t\treturn `+1 (${d.slice(1, 4)}) ${d.slice(4, 7)}-${d.slice(7)}`;\n\t}\n\tif (d.length === 10) {\n\t\treturn `(${d.slice(0, 3)}) ${d.slice(3, 6)}-${d.slice(6)}`;\n\t}\n\treturn phone;\n};\n\n/**\n * Connection Status Badge\n */\nfunction ConnectionStatusBadge({\n\tstatus,\n\tmode,\n\tonRetry,\n\tclassName,\n}: {\n\tstatus: ConnectionStatus;\n\tmode: CallMode;\n\tonRetry?: () => void;\n\tclassName?: string;\n}) {\n\tif (mode === \"api\") {\n\t\treturn (\n\t\t\t<Badge variant=\"outline\" className={cn(\"gap-1 text-[10px]\", className)}>\n\t\t\t\t<Server className=\"h-3 w-3\" />\n\t\t\t\tAPI Mode\n\t\t\t</Badge>\n\t\t);\n\t}\n\n\tconst statusConfig: Record<ConnectionStatus, {\n\t\ticon: typeof WifiOff;\n\t\tlabel: string;\n\t\tvariant: \"outline\" | \"destructive\";\n\t\tclassName: string;\n\t\tanimate?: boolean;\n\t}> = {\n\t\tdisconnected: {\n\t\t\ticon: WifiOff,\n\t\t\tlabel: \"Disconnected\",\n\t\t\tvariant: \"outline\",\n\t\t\tclassName: \"text-muted-foreground\",\n\t\t},\n\t\tconnecting: {\n\t\t\ticon: Loader2,\n\t\t\tlabel: \"Connecting...\",\n\t\t\tvariant: \"outline\",\n\t\t\tclassName: \"text-warning\",\n\t\t\tanimate: true,\n\t\t},\n\t\tconnected: {\n\t\t\ticon: Wifi,\n\t\t\tlabel: \"WebRTC Ready\",\n\t\t\tvariant: \"outline\",\n\t\t\tclassName: \"text-success border-success/30\",\n\t\t},\n\t\terror: {\n\t\t\ticon: AlertCircle,\n\t\t\tlabel: \"Connection Error\",\n\t\t\tvariant: \"destructive\",\n\t\t\tclassName: \"\",\n\t\t},\n\t};\n\n\tconst config = statusConfig[status];\n\tconst Icon = config.icon;\n\n\treturn (\n\t\t<div className={cn(\"flex items-center gap-1\", className)}>\n\t\t\t<Badge variant={config.variant} className={cn(\"gap-1 text-[10px]\", config.className)}>\n\t\t\t\t<Icon className={cn(\"h-3 w-3\", config.animate === true && \"animate-spin\")} />\n\t\t\t\t{config.label}\n\t\t\t</Badge>\n\t\t\t{(status === \"error\" || status === \"disconnected\") && onRetry && (\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\tclassName=\"h-5 w-5\"\n\t\t\t\t\tonClick={onRetry}\n\t\t\t\t>\n\t\t\t\t\t<RefreshCw className=\"h-3 w-3\" />\n\t\t\t\t</Button>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n\n/**\n * Active Call Card - Shows when a call is in progress\n */\nfunction ActiveCallCard({\n\tcall,\n\tonMute,\n\tonHold,\n\tonEnd,\n\tclassName,\n}: {\n\tcall: WebRTCCall;\n\tonMute: () => void;\n\tonHold: () => void;\n\tonEnd: () => void;\n\tclassName?: string;\n}) {\n\tconst [duration, setDuration] = useState(0);\n\n\t// Update duration timer\n\tuseEffect(() => {\n\t\tif (call.state !== \"active\") {\n\t\t\tsetDuration(0);\n\t\t\treturn;\n\t\t}\n\n\t\tconst startTime = call.startTime?.getTime() || Date.now();\n\t\tconst interval = setInterval(() => {\n\t\t\tsetDuration(Math.floor((Date.now() - startTime) / 1000));\n\t\t}, 1000);\n\n\t\treturn () => clearInterval(interval);\n\t}, [call.state, call.startTime]);\n\n\tconst formatDuration = (seconds: number) => {\n\t\tconst mins = Math.floor(seconds / 60);\n\t\tconst secs = seconds % 60;\n\t\treturn `${mins}:${secs.toString().padStart(2, \"0\")}`;\n\t};\n\n\tconst stateConfig: Record<CallState, { label: string; color: string; icon: typeof Phone }> = {\n\t\tidle: { label: \"Idle\", color: \"text-muted-foreground\", icon: Phone },\n\t\tconnecting: { label: \"Connecting...\", color: \"text-warning\", icon: PhoneOutgoing },\n\t\tringing: { label: \"Ringing...\", color: \"text-primary\", icon: PhoneOutgoing },\n\t\tactive: { label: \"Active\", color: \"text-success\", icon: PhoneCall },\n\t\theld: { label: \"On Hold\", color: \"text-warning\", icon: Pause },\n\t\tended: { label: \"Call Ended\", color: \"text-muted-foreground\", icon: PhoneOff },\n\t};\n\n\tconst config = stateConfig[call.state];\n\tconst StateIcon = config.icon;\n\n\treturn (\n\t\t<div className={cn(\"rounded-lg border bg-card p-3\", className)}>\n\t\t\t{/* Call info header */}\n\t\t\t<div className=\"mb-3 flex items-center justify-between\">\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<div className={cn(\"rounded-full bg-primary/10 p-2\", config.color)}>\n\t\t\t\t\t\t<StateIcon className=\"h-4 w-4\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p className=\"text-sm font-medium\">\n\t\t\t\t\t\t\t{call.remoteName || formatPhone(call.remoteNumber)}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p className={cn(\"text-xs\", config.color)}>{config.label}</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t{call.state === \"active\" && (\n\t\t\t\t\t<Badge variant=\"outline\" className=\"text-xs tabular-nums\">\n\t\t\t\t\t\t{formatDuration(duration)}\n\t\t\t\t\t</Badge>\n\t\t\t\t)}\n\t\t\t</div>\n\n\t\t\t{/* Call controls */}\n\t\t\t{(call.state === \"active\" || call.state === \"held\") && (\n\t\t\t\t<div className=\"flex items-center justify-center gap-2\">\n\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant={call.isMuted ? \"destructive\" : \"outline\"}\n\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\tclassName=\"h-9 w-9 rounded-full\"\n\t\t\t\t\t\t\t\tonClick={onMute}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{call.isMuted ? (\n\t\t\t\t\t\t\t\t\t<MicOff className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<Mic className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t<TooltipContent>{call.isMuted ? \"Unmute\" : \"Mute\"}</TooltipContent>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant={call.isHeld ? \"secondary\" : \"outline\"}\n\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\tclassName=\"h-9 w-9 rounded-full\"\n\t\t\t\t\t\t\t\tonClick={onHold}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{call.isHeld ? (\n\t\t\t\t\t\t\t\t\t<Play className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<Pause className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t<TooltipContent>{call.isHeld ? \"Resume\" : \"Hold\"}</TooltipContent>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\tclassName=\"h-9 w-9 rounded-full\"\n\t\t\t\t\t\t\t\tonClick={onEnd}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<PhoneOff className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t<TooltipContent>End Call</TooltipContent>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{/* Connecting/Ringing state */}\n\t\t\t{(call.state === \"connecting\" || call.state === \"ringing\") && (\n\t\t\t\t<div className=\"flex items-center justify-center gap-2\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\tclassName=\"gap-2\"\n\t\t\t\t\t\tonClick={onEnd}\n\t\t\t\t\t>\n\t\t\t\t\t\t<PhoneOff className=\"h-4 w-4\" />\n\t\t\t\t\t\tCancel\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n\nexport function PhoneDropdown({\n\tcompanyId,\n\tcompanyPhones = [],\n\tincomingCallsCount,\n}: PhoneDropdownProps) {\n\tconst { toast } = useToast();\n\tconst [mounted, setMounted] = useState(false);\n\tconst [isPending, startTransition] = useTransition();\n\n\t// Dropdown & customer state\n\tconst [open, setOpen] = useState(false);\n\tconst { customers, isLoading: customersLoading } = useDialerCustomers(open);\n\tconst dialerStore = useDialerStore();\n\n\t// Form state\n\tconst [toNumber, setToNumber] = useState(\"\");\n\tconst [fromNumber, setFromNumber] = useState(companyPhones[0]?.number || \"\");\n\tconst [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(null);\n\tconst [customerSearchOpen, setCustomerSearchOpen] = useState(false);\n\tconst [customerSearchQuery, setCustomerSearchQuery] = useState(\"\");\n\n\t// WebRTC state\n\tconst [callMode, setCallMode] = useState<CallMode>(\"webrtc\");\n\tconst [webrtcCredentials, setWebrtcCredentials] = useState<{\n\t\tusername: string;\n\t\tpassword: string;\n\t} | null>(null);\n\tconst [connectionStatus, setConnectionStatus] = useState<ConnectionStatus>(\"disconnected\");\n\tconst [connectionError, setConnectionError] = useState<string | null>(null);\n\tconst connectionTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\tconst retryCountRef = useRef(0);\n\tconst maxRetries = 3;\n\n\t// Audio element for WebRTC\n\tconst audioRef = useRef<HTMLAudioElement | null>(null);\n\n\t// Call state from UI store\n\tconst callStatus = useUIStore((s) => s.call.status);\n\tconst caller = useUIStore((s) => s.call.caller);\n\tconst hasIncomingCall = callStatus === \"incoming\";\n\tconst displayCount = incomingCallsCount ?? (hasIncomingCall ? 1 : 0);\n\n\t// WebRTC hook\n\tconst webrtc = useTelnyxWebRTC({\n\t\tusername: webrtcCredentials?.username || \"\",\n\t\tpassword: webrtcCredentials?.password || \"\",\n\t\tautoConnect: false,\n\t\tdebug: process.env.NODE_ENV === \"development\",\n\t\tonIncomingCall: (call) => {\n\t\t\ttoast.info(`Incoming call from ${call.remoteName || call.remoteNumber}`);\n\t\t},\n\t\tonCallEnded: () => {\n\t\t\ttoast.info(\"Call ended\");\n\t\t},\n\t});\n\n\t// Mount\n\tuseEffect(() => {\n\t\tsetMounted(true);\n\t\t// Create audio element for WebRTC\n\t\tif (typeof window !== \"undefined\" && !audioRef.current) {\n\t\t\tconst audio = document.createElement(\"audio\");\n\t\t\taudio.id = \"telnyx-remote-audio\";\n\t\t\taudio.autoplay = true;\n\t\t\taudio.style.display = \"none\";\n\t\t\tdocument.body.appendChild(audio);\n\t\t\taudioRef.current = audio;\n\t\t}\n\n\t\treturn () => {\n\t\t\tif (audioRef.current) {\n\t\t\t\taudioRef.current.remove();\n\t\t\t\taudioRef.current = null;\n\t\t\t}\n\t\t};\n\t}, []);\n\n\t// Sync from number\n\tuseEffect(() => {\n\t\tif (!fromNumber && companyPhones.length > 0) {\n\t\t\tsetFromNumber(companyPhones[0].number);\n\t\t}\n\t}, [companyPhones, fromNumber]);\n\n\t// Sync dialer store\n\tuseEffect(() => setOpen(dialerStore.isOpen), [dialerStore.isOpen]);\n\tuseEffect(() => setToNumber(dialerStore.phoneNumber), [dialerStore.phoneNumber]);\n\tuseEffect(() => {\n\t\tif (dialerStore.customerId && customers.length > 0) {\n\t\t\tconst c = customers.find((x) => x.id === dialerStore.customerId);\n\t\t\tif (c && c.id !== selectedCustomer?.id) setSelectedCustomer(c);\n\t\t}\n\t}, [dialerStore.customerId, customers, selectedCustomer?.id]);\n\n\t// Fetch WebRTC credentials on mount\n\tuseEffect(() => {\n\t\tif (!mounted) return;\n\n\t\tconst fetchCredentials = async () => {\n\t\t\ttry {\n\t\t\t\tconst result = await fetchWebRTCCredentialsOnce();\n\t\t\t\tif (result.success && result.credential) {\n\t\t\t\t\tsetWebrtcCredentials({\n\t\t\t\t\t\tusername: result.credential.username,\n\t\t\t\t\t\tpassword: result.credential.password,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn(\"Failed to get WebRTC credentials, using API mode\");\n\t\t\t\t\tsetCallMode(\"api\");\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Failed to fetch WebRTC credentials:\", error);\n\t\t\t\tsetCallMode(\"api\");\n\t\t\t}\n\t\t};\n\n\t\tfetchCredentials();\n\t}, [mounted]);\n\n\t// Connect WebRTC when credentials are available\n\tuseEffect(() => {\n\t\tif (!webrtcCredentials || callMode !== \"webrtc\") return;\n\n\t\tconst connectWebRTC = async () => {\n\t\t\t// Clear any existing timeout\n\t\t\tif (connectionTimeoutRef.current) {\n\t\t\t\tclearTimeout(connectionTimeoutRef.current);\n\t\t\t}\n\n\t\t\tsetConnectionStatus(\"connecting\");\n\t\t\tsetConnectionError(null);\n\n\t\t\t// Set connection timeout\n\t\t\tconnectionTimeoutRef.current = setTimeout(() => {\n\t\t\t\tif (connectionStatus === \"connecting\") {\n\t\t\t\t\tsetConnectionStatus(\"error\");\n\t\t\t\t\tsetConnectionError(\"Connection timeout - WebRTC may require Level 2 verification\");\n\n\t\t\t\t\t// Auto-fallback to API mode after timeout\n\t\t\t\t\tif (retryCountRef.current >= maxRetries) {\n\t\t\t\t\t\ttoast.warning(\"WebRTC unavailable, switching to API mode\");\n\t\t\t\t\t\tsetCallMode(\"api\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, WEBRTC_CONNECTION_TIMEOUT);\n\n\t\t\ttry {\n\t\t\t\tawait webrtc.connect();\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"WebRTC connection error:\", error);\n\t\t\t\tsetConnectionStatus(\"error\");\n\t\t\t\tsetConnectionError(error instanceof Error ? error.message : \"Connection failed\");\n\t\t\t}\n\t\t};\n\n\t\tconnectWebRTC();\n\n\t\treturn () => {\n\t\t\tif (connectionTimeoutRef.current) {\n\t\t\t\tclearTimeout(connectionTimeoutRef.current);\n\t\t\t}\n\t\t};\n\t}, [webrtcCredentials, callMode]);\n\n\t// Sync WebRTC connection state\n\tuseEffect(() => {\n\t\tif (webrtc.isConnected) {\n\t\t\tif (connectionTimeoutRef.current) {\n\t\t\t\tclearTimeout(connectionTimeoutRef.current);\n\t\t\t}\n\t\t\tsetConnectionStatus(\"connected\");\n\t\t\tsetConnectionError(null);\n\t\t\tretryCountRef.current = 0;\n\t\t} else if (webrtc.connectionError) {\n\t\t\tsetConnectionStatus(\"error\");\n\t\t\tsetConnectionError(webrtc.connectionError);\n\t\t} else if (webrtc.isConnecting) {\n\t\t\tsetConnectionStatus(\"connecting\");\n\t\t}\n\t}, [webrtc.isConnected, webrtc.isConnecting, webrtc.connectionError]);\n\n\t// Handlers\n\tconst handleOpenChange = useCallback((newOpen: boolean) => {\n\t\tsetOpen(newOpen);\n\t\tif (newOpen) {\n\t\t\tdialerStore.openDialer();\n\t\t} else {\n\t\t\tdialerStore.closeDialer();\n\t\t\tsetToNumber(\"\");\n\t\t\tsetSelectedCustomer(null);\n\t\t\tsetCustomerSearchQuery(\"\");\n\t\t}\n\t}, [dialerStore]);\n\n\tconst handleCustomerSelect = useCallback((c: Customer | null) => {\n\t\tsetSelectedCustomer(c);\n\t\tif (c?.phone) setToNumber(c.phone);\n\t\tsetCustomerSearchQuery(\"\");\n\t\tsetCustomerSearchOpen(false);\n\t}, []);\n\n\tconst handleRetryConnection = useCallback(() => {\n\t\tretryCountRef.current += 1;\n\n\t\tif (retryCountRef.current > maxRetries) {\n\t\t\ttoast.warning(\"Max retries reached, switching to API mode\");\n\t\t\tsetCallMode(\"api\");\n\t\t\treturn;\n\t\t}\n\n\t\t// Reset credentials cache and refetch\n\t\tresetWebRTCCredentialsCache();\n\t\tsetWebrtcCredentials(null);\n\t\tsetConnectionStatus(\"disconnected\");\n\t\tsetConnectionError(null);\n\n\t\t// Refetch credentials\n\t\tfetchWebRTCCredentialsOnce().then((result) => {\n\t\t\tif (result.success && result.credential) {\n\t\t\t\tsetWebrtcCredentials({\n\t\t\t\t\tusername: result.credential.username,\n\t\t\t\t\tpassword: result.credential.password,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}, [toast]);\n\n\tconst handleModeToggle = useCallback((checked: boolean) => {\n\t\tsetCallMode(checked ? \"webrtc\" : \"api\");\n\t}, []);\n\n\t// Filter customers\n\tconst filteredCustomers = useMemo(() => {\n\t\tconst q = customerSearchQuery.trim().toLowerCase();\n\t\tif (!q) return customers.slice(0, 50);\n\n\t\tconst qDigits = q.replace(/\\D/g, \"\");\n\t\treturn customers.filter((c) => {\n\t\t\tconst searchable = [\n\t\t\t\tc.first_name, c.last_name, c.display_name,\n\t\t\t\tc.email, c.phone, c.secondary_phone, c.company_name,\n\t\t\t].map((v) => cleanValue(v).toLowerCase());\n\n\t\t\tif (searchable.some((s) => s.includes(q))) return true;\n\t\t\tif (qDigits) {\n\t\t\t\tconst phones = [c.phone, c.secondary_phone]\n\t\t\t\t\t.map((p) => cleanValue(p).replace(/\\D/g, \"\"))\n\t\t\t\t\t.filter(Boolean);\n\t\t\t\tif (phones.some((p) => p.includes(qDigits))) return true;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t}, [customers, customerSearchQuery]);\n\n\t// Make call via API (used for fallback and API mode)\n\tconst handleAPICall = useCallback(async () => {\n\t\tif (isPending) return;\n\n\t\tif (!companyId) {\n\t\t\ttoast.error(\"No company selected. Please select a company first.\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst to = toNumber.replace(/\\D/g, \"\");\n\t\tif (!to) {\n\t\t\ttoast.error(\"Please enter a valid phone number\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (!fromNumber) {\n\t\t\ttoast.error(\"Please select a company phone number\");\n\t\t\treturn;\n\t\t}\n\n\t\tstartTransition(async () => {\n\t\t\ttry {\n\t\t\t\tconst result = await makeCall({\n\t\t\t\t\tto,\n\t\t\t\t\tfrom: fromNumber,\n\t\t\t\t\tcompanyId,\n\t\t\t\t\tcustomerId: selectedCustomer?.id,\n\t\t\t\t});\n\n\t\t\t\tif (!result.success) {\n\t\t\t\t\ttoast.error(result.error || \"Failed to start call\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\ttoast.success(\n\t\t\t\t\tselectedCustomer\n\t\t\t\t\t\t? `Calling ${getCustomerName(selectedCustomer)}`\n\t\t\t\t\t\t: `Calling ${formatPhone(toNumber)}`\n\t\t\t\t);\n\n\t\t\t\t// Open call window\n\t\t\t\tconst params = new URLSearchParams({\n\t\t\t\t\tcallControlId: result.callControlId || \"\",\n\t\t\t\t\tcompanyId,\n\t\t\t\t\tto,\n\t\t\t\t\tfrom: fromNumber,\n\t\t\t\t\tdirection: \"outbound\",\n\t\t\t\t\t...(selectedCustomer?.id && { customerId: selectedCustomer.id }),\n\t\t\t\t});\n\n\t\t\t\twindow.open(`/call?${params}`, \"_blank\", \"noopener,noreferrer\");\n\n\t\t\t\t// Reset\n\t\t\t\thandleOpenChange(false);\n\t\t\t} catch {\n\t\t\t\ttoast.error(\"Failed to start call. Please try again.\");\n\t\t\t}\n\t\t});\n\t}, [companyId, toNumber, fromNumber, selectedCustomer, isPending, toast, handleOpenChange]);\n\n\t// Make call via WebRTC (primary mode)\n\tconst handleWebRTCCall = useCallback(async () => {\n\t\tconst to = toNumber.replace(/\\D/g, \"\");\n\t\tif (!to) {\n\t\t\ttoast.error(\"Please enter a valid phone number\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (!webrtc.isConnected) {\n\t\t\ttoast.error(\"WebRTC not connected. Trying API mode...\");\n\t\t\thandleAPICall();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!fromNumber) {\n\t\t\ttoast.error(\"Please select a company phone number\");\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tawait webrtc.makeCall(to, fromNumber);\n\t\t\ttoast.success(\n\t\t\t\tselectedCustomer\n\t\t\t\t\t? `Calling ${getCustomerName(selectedCustomer)}`\n\t\t\t\t\t: `Calling ${formatPhone(toNumber)}`\n\t\t\t);\n\t\t} catch (error) {\n\t\t\tconsole.error(\"WebRTC call error:\", error);\n\t\t\ttoast.error(\"Failed to start call via WebRTC\");\n\n\t\t\t// Fallback to API\n\t\t\ttoast.info(\"Falling back to API mode...\");\n\t\t\thandleAPICall();\n\t\t}\n\t}, [toNumber, fromNumber, selectedCustomer, webrtc, toast, handleAPICall]);\n\n\t// Start call based on mode\n\tconst handleStartCall = useCallback(() => {\n\t\tif (callMode === \"webrtc\" && webrtc.isConnected) {\n\t\t\thandleWebRTCCall();\n\t\t} else {\n\t\t\thandleAPICall();\n\t\t}\n\t}, [callMode, webrtc.isConnected, handleWebRTCCall, handleAPICall]);\n\n\t// Handle WebRTC call controls\n\tconst handleMuteToggle = useCallback(async () => {\n\t\ttry {\n\t\t\tif (webrtc.currentCall?.isMuted) {\n\t\t\t\tawait webrtc.unmuteCall();\n\t\t\t} else {\n\t\t\t\tawait webrtc.muteCall();\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Mute toggle error:\", error);\n\t\t}\n\t}, [webrtc]);\n\n\tconst handleHoldToggle = useCallback(async () => {\n\t\ttry {\n\t\t\tif (webrtc.currentCall?.isHeld) {\n\t\t\t\tawait webrtc.unholdCall();\n\t\t\t} else {\n\t\t\t\tawait webrtc.holdCall();\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Hold toggle error:\", error);\n\t\t}\n\t}, [webrtc]);\n\n\tconst handleEndCall = useCallback(async () => {\n\t\ttry {\n\t\t\tawait webrtc.endCall();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"End call error:\", error);\n\t\t}\n\t}, [webrtc]);\n\n\tconst canCall = Boolean(toNumber.trim() && fromNumber && companyPhones.length > 0);\n\tconst isWebRTCReady = callMode === \"webrtc\" && connectionStatus === \"connected\";\n\tconst hasActiveCall = webrtc.currentCall && webrtc.currentCall.state !== \"idle\" && webrtc.currentCall.state !== \"ended\";\n\n\t// SSR placeholder\n\tif (!mounted) {\n\t\treturn (\n\t\t\t<button\n\t\t\t\tclassName=\"flex h-8 w-8 items-center justify-center rounded-md border border-transparent opacity-50\"\n\t\t\t\tdisabled\n\t\t\t\ttype=\"button\"\n\t\t\t>\n\t\t\t\t<Phone className=\"h-4 w-4\" />\n\t\t\t</button>\n\t\t);\n\t}\n\n\treturn (\n\t\t<TooltipProvider delayDuration={200}>\n\t\t\t<DropdownMenu open={open} onOpenChange={handleOpenChange}>\n\t\t\t\t<Tooltip>\n\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\"relative flex h-8 w-8 items-center justify-center rounded-md\",\n\t\t\t\t\t\t\t\t\t\"border border-transparent transition-all\",\n\t\t\t\t\t\t\t\t\t\"hover:border-primary/20 hover:bg-primary/10 hover:text-primary\",\n\t\t\t\t\t\t\t\t\t\"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring/50\",\n\t\t\t\t\t\t\t\t\thasIncomingCall && \"animate-pulse text-primary\",\n\t\t\t\t\t\t\t\t\thasActiveCall && \"text-success\"\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{hasActiveCall ? (\n\t\t\t\t\t\t\t\t\t<PhoneCall className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t) : hasIncomingCall ? (\n\t\t\t\t\t\t\t\t\t<PhoneIncoming className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<Phone className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{displayCount > 0 && (\n\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"absolute -right-1 -top-1 flex h-5 w-5 items-center justify-center rounded-full p-0 text-[10px]\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{displayCount > 9 ? \"9+\" : displayCount}\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t<TooltipContent side=\"bottom\">\n\t\t\t\t\t\t{hasActiveCall ? \"Call in Progress\" : hasIncomingCall ? \"Incoming Call\" : \"Make a Call\"}\n\t\t\t\t\t</TooltipContent>\n\t\t\t\t</Tooltip>\n\n\t\t\t\t<DropdownMenuContent align=\"end\" className=\"w-80 p-0\">\n\t\t\t\t\t<div className=\"space-y-3 p-4\">\n\t\t\t\t\t\t{/* Header */}\n\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t\t\t\t<div className=\"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary/10\">\n\t\t\t\t\t\t\t\t\t<PhoneCall className=\"h-5 w-5 text-primary\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t<h3 className=\"text-sm font-semibold\">Make a Call</h3>\n\t\t\t\t\t\t\t\t\t<ConnectionStatusBadge\n\t\t\t\t\t\t\t\t\t\tstatus={connectionStatus}\n\t\t\t\t\t\t\t\t\t\tmode={callMode}\n\t\t\t\t\t\t\t\t\t\tonRetry={handleRetryConnection}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* Mode toggle */}\n\t\t\t\t\t\t<div className=\"flex items-center justify-between rounded-lg border bg-muted/30 p-2\">\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<Server className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground\">API Mode</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\tchecked={callMode === \"webrtc\"}\n\t\t\t\t\t\t\t\tonCheckedChange={handleModeToggle}\n\t\t\t\t\t\t\t\tdisabled={!webrtcCredentials}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground\">Browser Audio</span>\n\t\t\t\t\t\t\t\t<Headphones className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* Active call card */}\n\t\t\t\t\t\t{hasActiveCall && webrtc.currentCall && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<ActiveCallCard\n\t\t\t\t\t\t\t\t\tcall={webrtc.currentCall}\n\t\t\t\t\t\t\t\t\tonMute={handleMuteToggle}\n\t\t\t\t\t\t\t\t\tonHold={handleHoldToggle}\n\t\t\t\t\t\t\t\t\tonEnd={handleEndCall}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{/* Incoming call alert */}\n\t\t\t\t\t\t{hasIncomingCall && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-3 rounded-lg border border-destructive/30 bg-destructive/10 p-3\">\n\t\t\t\t\t\t\t\t\t<PhoneIncoming className=\"h-5 w-5 shrink-0 animate-pulse text-destructive\" />\n\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-semibold text-destructive\">Incoming Call</p>\n\t\t\t\t\t\t\t\t\t\t<p className=\"truncate text-xs text-destructive/80\">\n\t\t\t\t\t\t\t\t\t\t\t{caller?.name || caller?.number || \"Unknown\"}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{/* Connection error message */}\n\t\t\t\t\t\t{connectionError && callMode === \"webrtc\" && (\n\t\t\t\t\t\t\t<div className=\"rounded-lg border border-warning/30 bg-warning/10 p-2\">\n\t\t\t\t\t\t\t\t<p className=\"text-xs text-warning\">{connectionError}</p>\n\t\t\t\t\t\t\t\t<p className=\"mt-1 text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\tCalls will use API mode (opens in new window)\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{/* Customer search */}\n\t\t\t\t\t\t{!hasActiveCall && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<div className=\"space-y-1.5\">\n\t\t\t\t\t\t\t\t\t<label className=\"text-xs font-medium text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tCustomer (optional)\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t<Popover open={customerSearchOpen} onOpenChange={setCustomerSearchOpen}>\n\t\t\t\t\t\t\t\t\t\t<PopoverTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-9 w-full justify-start gap-2 px-3 font-normal\"\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={customersLoading}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<User className=\"h-4 w-4 shrink-0 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"min-w-0 flex-1 truncate text-left\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCustomer ? getCustomerName(selectedCustomer) : \"Search...\"}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t{selectedCustomer && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<X\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-4 w-4 shrink-0 text-muted-foreground hover:text-foreground\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleCustomerSelect(null);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</PopoverTrigger>\n\t\t\t\t\t\t\t\t\t\t<PopoverContent align=\"start\" className=\"w-80 p-0\" sideOffset={4}>\n\t\t\t\t\t\t\t\t\t\t\t<Command shouldFilter={false}>\n\t\t\t\t\t\t\t\t\t\t\t\t<CommandInput\n\t\t\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Name, phone, or email...\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={customerSearchQuery}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonValueChange={setCustomerSearchQuery}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t<CommandList className=\"max-h-[200px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<CommandEmpty className=\"py-4 text-center text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tNo customers found\n\t\t\t\t\t\t\t\t\t\t\t\t\t</CommandEmpty>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<CommandGroup>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{filteredCustomers.map((c) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<CommandItem\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={c.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={c.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonSelect={() => handleCustomerSelect(c)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex cursor-pointer items-center gap-2 px-3 py-2\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"truncate text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{getCustomerName(c)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{c.phone && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"truncate text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatPhone(c.phone)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedCustomer?.id === c.id && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Check className=\"h-4 w-4 shrink-0 text-primary\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</CommandItem>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</CommandGroup>\n\t\t\t\t\t\t\t\t\t\t\t\t</CommandList>\n\t\t\t\t\t\t\t\t\t\t\t</Command>\n\t\t\t\t\t\t\t\t\t\t</PopoverContent>\n\t\t\t\t\t\t\t\t\t</Popover>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{/* Phone number */}\n\t\t\t\t\t\t\t\t<div className=\"space-y-1.5\">\n\t\t\t\t\t\t\t\t\t<label htmlFor=\"phone-to\" className=\"text-xs font-medium text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tPhone Number\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\tid=\"phone-to\"\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"(555) 123-4567\"\n\t\t\t\t\t\t\t\t\t\tvalue={toNumber}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setToNumber(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-9\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{/* From number */}\n\t\t\t\t\t\t\t\t<div className=\"space-y-1.5\">\n\t\t\t\t\t\t\t\t\t<label htmlFor=\"phone-from\" className=\"text-xs font-medium text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tYour Company Line\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t<Select value={fromNumber} onValueChange={setFromNumber}>\n\t\t\t\t\t\t\t\t\t\t<SelectTrigger id=\"phone-from\" className=\"h-9\">\n\t\t\t\t\t\t\t\t\t\t\t<SelectValue placeholder=\"Select line...\" />\n\t\t\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t\t\t{companyPhones.map((p) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<SelectItem key={p.id} value={p.number}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{p.label || formatPhone(p.number)}\n\t\t\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t\t\t\t{companyPhones.length === 0 && (\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\tNo phone numbers configured\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{/* Call button */}\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName=\"w-full gap-2\"\n\t\t\t\t\t\t\t\t\tdisabled={!canCall || isPending}\n\t\t\t\t\t\t\t\t\tonClick={handleStartCall}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{isPending ? (\n\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"h-4 w-4 animate-spin\" />\n\t\t\t\t\t\t\t\t\t\t\tStarting...\n\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t) : isWebRTCReady ? (\n\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t<Headphones className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t\tCall (Browser Audio)\n\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t<PhoneOutgoing className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t\tCall (Opens Window)\n\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{/* Quick links */}\n\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\thref=\"/dashboard/communication?filter=calls\"\n\t\t\t\t\t\t\t\tonClick={() => handleOpenChange(false)}\n\t\t\t\t\t\t\t\tclassName=\"flex flex-1 items-center justify-center gap-1.5 rounded-md px-2 py-1.5 text-xs font-medium text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Clock className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\tHistory\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\thref=\"/dashboard/communication\"\n\t\t\t\t\t\t\t\tonClick={() => handleOpenChange(false)}\n\t\t\t\t\t\t\t\tclassName=\"flex flex-1 items-center justify-center gap-1.5 rounded-md px-2 py-1.5 text-xs font-medium text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<MessageSquare className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\tMessages\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</DropdownMenuContent>\n\t\t\t</DropdownMenu>\n\t\t</TooltipProvider>\n\t);\n}\n","/**\n * Dialer Customers Hook - Client-Side Lazy Loading\n *\n * PERFORMANCE CRITICAL:\n * Previously, AppHeader fetched ALL customers on EVERY page load (~400-800ms).\n * Now customers are only fetched when the dialer is opened.\n *\n * Features:\n * - Lazy load on first dialer open\n * - 5-minute cache in memory\n * - No server-side overhead on page loads\n *\n * Expected savings: 400-800ms per page load\n */\n\nimport { useEffect, useState } from \"react\";\n\ntype DialerCustomer = {\n\tid: string;\n\tfirst_name: string | null;\n\tlast_name: string | null;\n\tdisplay_name: string | null;\n\temail: string | null;\n\tphone: string | null;\n\tcompany_name: string | null;\n\tsecondary_phone?: string | null;\n\taddress: string | null;\n\taddress2: string | null;\n\tcity: string | null;\n\tstate: string | null;\n\tzip_code: string | null;\n};\n\n// In-memory cache with 5-minute TTL\nlet cachedCustomers: DialerCustomer[] | null = null;\nlet cacheTimestamp = 0;\nconst CACHE_TTL = 5 * 60 * 1000; // 5 minutes\n\nexport function useDialerCustomers(shouldFetch = false) {\n\tconst [customers, setCustomers] = useState<DialerCustomer[]>([]);\n\tconst [isLoading, setIsLoading] = useState(false);\n\tconst [error, setError] = useState<string | null>(null);\n\n\tuseEffect(() => {\n\t\t// Only fetch if explicitly requested (e.g., dialer opened)\n\t\tif (!shouldFetch) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Serve from cache when available\n\t\tconst now = Date.now();\n\t\tif (cachedCustomers && now - cacheTimestamp < CACHE_TTL) {\n\t\t\tsetCustomers(cachedCustomers);\n\t\t\treturn;\n\t\t}\n\n\t\tconst controller = new AbortController();\n\t\tconst fetchCustomers = async () => {\n\t\t\tsetIsLoading(true);\n\t\t\tsetError(null);\n\n\t\t\ttry {\n\t\t\t\tconst response = await fetch(\"/api/dialer/customers\", {\n\t\t\t\t\tsignal: controller.signal,\n\t\t\t\t\tcache: \"no-store\",\n\t\t\t\t});\n\n\t\t\t\tif (!response.ok) {\n\t\t\t\t\tconst payload = await response.json().catch(() => ({}));\n\t\t\t\t\tthrow new Error(payload.error || \"Failed to load customers\");\n\t\t\t\t}\n\n\t\t\t\tconst payload = (await response.json()) as {\n\t\t\t\t\tcustomers: DialerCustomer[];\n\t\t\t\t};\n\t\t\t\tcachedCustomers = payload.customers;\n\t\t\t\tcacheTimestamp = Date.now();\n\t\t\t\tsetCustomers(payload.customers);\n\t\t\t} catch (err) {\n\t\t\t\tif (controller.signal.aborted) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tsetError(\n\t\t\t\t\terr instanceof Error ? err.message : \"Failed to load customers\",\n\t\t\t\t);\n\t\t\t} finally {\n\t\t\t\tif (!controller.signal.aborted) {\n\t\t\t\t\tsetIsLoading(false);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tfetchCustomers();\n\n\t\treturn () => {\n\t\t\tcontroller.abort();\n\t\t};\n\t}, [shouldFetch]);\n\n\treturn { customers, isLoading, error };\n}\n\n// Helper to invalidate cache (call after creating/updating customers)\nfunction invalidateDialerCustomersCache() {\n\tcachedCustomers = null;\n\tcacheTimestamp = 0;\n}\n","\"use client\";\n\nimport { getWebRTCCredentials } from \"@/actions/telnyx\";\n\ntype WebRTCCredentialsResult = Awaited<ReturnType<typeof getWebRTCCredentials>>;\ntype Credential = NonNullable<WebRTCCredentialsResult[\"credential\"]>;\n\nconst STORAGE_KEY = \"telnyx-webrtc-credential\";\n// Refresh 5 minutes before expiration (Telnyx recommended buffer)\n// This prevents credential expiry during active calls\nconst EXPIRY_BUFFER_MS = 5 * 60 * 1000;\n\nlet credentialsPromise: Promise<WebRTCCredentialsResult> | null = null;\n\nfunction getExpiresAtMs(expiresAt: Credential[\"expires_at\"]): number | null {\n\tif (typeof expiresAt === \"number\") {\n\t\treturn expiresAt;\n\t}\n\tif (typeof expiresAt === \"string\") {\n\t\tconst parsed = Date.parse(expiresAt);\n\t\treturn Number.isNaN(parsed) ? null : parsed;\n\t}\n\treturn null;\n}\n\nfunction loadFromStorage(): Credential | null {\n\tif (typeof window === \"undefined\") {\n\t\treturn null;\n\t}\n\n\ttry {\n\t\tconst raw = window.localStorage.getItem(STORAGE_KEY);\n\t\tif (!raw) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst parsed = JSON.parse(raw) as { credential?: Credential } | null;\n\t\tif (!parsed?.credential) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst expiresAtMs = getExpiresAtMs(parsed.credential.expires_at);\n\t\tif (!expiresAtMs || expiresAtMs - EXPIRY_BUFFER_MS <= Date.now()) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn parsed.credential;\n\t} catch {\n\t\treturn null;\n\t}\n}\n\nfunction persistCredential(credential: Credential) {\n\tif (typeof window === \"undefined\") {\n\t\treturn;\n\t}\n\n\ttry {\n\t\twindow.localStorage.setItem(\n\t\t\tSTORAGE_KEY,\n\t\t\tJSON.stringify({\n\t\t\t\tcredential,\n\t\t\t}),\n\t\t);\n\t} catch {\n\t\t// Ignore storage errors (e.g., Safari private mode)\n\t}\n}\n\nfunction createPromise() {\n\tconst cached = loadFromStorage();\n\tif (cached) {\n\t\tconsole.log(\"🔑 Using cached WebRTC credentials:\", {\n\t\t\tusername: cached.username,\n\t\t\texpiresAt: new Date(cached.expires_at).toISOString(),\n\t\t\tisExpired: cached.expires_at <= Date.now(),\n\t\t});\n\t\tconst cachedResult: WebRTCCredentialsResult = {\n\t\t\tsuccess: true,\n\t\t\tcredential: cached,\n\t\t};\n\t\tconst promise = Promise.resolve(cachedResult);\n\t\tcredentialsPromise = promise;\n\t\treturn promise;\n\t}\n\n\tconsole.log(\"🔑 Fetching WebRTC credentials from server...\");\n\tconst promise = getWebRTCCredentials()\n\t\t.then((result) => {\n\t\t\tconsole.log(\"🔑 WebRTC credentials response:\", result);\n\t\t\tif (result?.success && result.credential) {\n\t\t\t\tconsole.log(\"🔑 Persisting new credentials to localStorage\");\n\t\t\t\tpersistCredential(result.credential);\n\t\t\t} else {\n\t\t\t\tconsole.warn(\"🔑 Failed to get credentials, clearing cache\");\n\t\t\t\tcredentialsPromise = null;\n\t\t\t}\n\t\t\treturn result;\n\t\t})\n\t\t.catch((error) => {\n\t\t\tconsole.error(\"🔑 WebRTC credentials fetch error:\", error);\n\t\t\tcredentialsPromise = null;\n\t\t\tthrow error;\n\t\t});\n\n\tcredentialsPromise = promise;\n\treturn promise;\n}\n\nexport function fetchWebRTCCredentialsOnce() {\n\treturn credentialsPromise ?? createPromise();\n}\n\nexport function resetWebRTCCredentialsCache() {\n\tcredentialsPromise = null;\n\tif (typeof window !== \"undefined\") {\n\t\ttry {\n\t\t\twindow.localStorage.removeItem(STORAGE_KEY);\n\t\t} catch {\n\t\t\t// Ignore storage removal errors\n\t\t}\n\t}\n}\n","\"use client\";\n\n/**\n * QuickAddDropdown - Client Component\n *\n * Quick access dropdown menu for creating new records across the application.\n * Provides one-click access to common creation actions from the main header.\n *\n * Client-side features:\n * - Dropdown menu with grouped actions by category\n * - Keyboard shortcuts display for power users\n * - Icon-based visual hierarchy\n * - Accessible with screen reader support\n *\n * Performance:\n * - Uses shadcn/ui DropdownMenu (Radix UI primitives)\n * - No data fetching - purely navigation-based\n * - Minimal bundle impact (~2KB)\n * - Client-only rendering to prevent hydration mismatch\n */\n\nimport {\n\tBriefcase,\n\tCalendar,\n\tDollarSign,\n\tFileSignature,\n\tFileSpreadsheet,\n\tFileText,\n\tPlus,\n\tTag,\n\tUserPlus,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useEffect, useState } from \"react\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuGroup,\n\tDropdownMenuItem,\n\tDropdownMenuLabel,\n\tDropdownMenuSeparator,\n\tDropdownMenuShortcut,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\n\ntype QuickAddAction = {\n\tlabel: string;\n\thref: string;\n\ticon: typeof Plus;\n\tshortcut?: string;\n\tdescription?: string;\n};\n\nconst quickAddActions: Record<string, QuickAddAction[]> = {\n\tWork: [\n\t\t{\n\t\t\tlabel: \"New Job\",\n\t\t\thref: \"/dashboard/work/new\",\n\t\t\ticon: Briefcase,\n\t\t\tshortcut: \"⌘J\",\n\t\t\tdescription: \"Create a new work order\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"New Invoice\",\n\t\t\thref: \"/dashboard/work/invoices/new\",\n\t\t\ticon: FileText,\n\t\t\tshortcut: \"⌘I\",\n\t\t\tdescription: \"Generate an invoice\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"New Estimate\",\n\t\t\thref: \"/dashboard/work/estimates/new\",\n\t\t\ticon: FileSpreadsheet,\n\t\t\tshortcut: \"⌘E\",\n\t\t\tdescription: \"Create a quote\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"New Contract\",\n\t\t\thref: \"/dashboard/work/contracts/new\",\n\t\t\ticon: FileSignature,\n\t\t\tdescription: \"Draft a service contract\",\n\t\t},\n\t],\n\tCustomers: [\n\t\t{\n\t\t\tlabel: \"New Customer\",\n\t\t\thref: \"/dashboard/customers/new\",\n\t\t\ticon: UserPlus,\n\t\t\tshortcut: \"⌘K\",\n\t\t\tdescription: \"Add a customer\",\n\t\t},\n\t],\n\tFinance: [\n\t\t{\n\t\t\tlabel: \"Record Payment\",\n\t\t\thref: \"/dashboard/finance/payments/new\",\n\t\t\ticon: DollarSign,\n\t\t\tdescription: \"Log a payment\",\n\t\t},\n\t],\n\tOther: [\n\t\t{\n\t\t\tlabel: \"Schedule Job\",\n\t\t\thref: \"/dashboard/schedule/new\",\n\t\t\ticon: Calendar,\n\t\t\tdescription: \"Add to schedule\",\n\t\t},\n\t\t{\n\t\t\tlabel: \"Price Book Item\",\n\t\t\thref: \"/dashboard/work/pricebook/new\",\n\t\t\ticon: Tag,\n\t\t\tdescription: \"Add inventory item\",\n\t\t},\n\t],\n};\n\nexport function QuickAddDropdown() {\n\tconst [mounted, setMounted] = useState(false);\n\n\t// Only render on client to prevent hydration mismatch with Radix UI IDs\n\tuseEffect(() => {\n\t\tsetMounted(true);\n\t}, []);\n\n\tif (!mounted) {\n\t\t// Render placeholder button during SSR that matches client button dimensions\n\t\treturn (\n\t\t\t<button\n\t\t\t\tclassName=\"hover-gradient hover:border-primary/20 hover:bg-primary/10 hover:text-primary focus-visible:ring-ring/50 flex h-8 w-8 items-center justify-center rounded-md border border-transparent transition-all outline-none focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50\"\n\t\t\t\tdisabled\n\t\t\t\ttitle=\"Quick Add\"\n\t\t\t\ttype=\"button\"\n\t\t\t>\n\t\t\t\t<Plus className=\"size-4\" />\n\t\t\t\t<span className=\"sr-only\">Quick Add Menu</span>\n\t\t\t</button>\n\t\t);\n\t}\n\n\treturn (\n\t\t<DropdownMenu>\n\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t<button\n\t\t\t\t\tclassName=\"hover-gradient hover:border-primary/20 hover:bg-primary/10 hover:text-primary focus-visible:ring-ring/50 flex h-8 w-8 items-center justify-center rounded-md border border-transparent transition-all outline-none focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50\"\n\t\t\t\t\ttitle=\"Quick Add\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t>\n\t\t\t\t\t<Plus className=\"size-4\" />\n\t\t\t\t\t<span className=\"sr-only\">Quick Add Menu</span>\n\t\t\t\t</button>\n\t\t\t</DropdownMenuTrigger>\n\t\t\t<DropdownMenuContent align=\"end\" className=\"w-64 rounded-lg\">\n\t\t\t\t<DropdownMenuLabel className=\"font-semibold\">\n\t\t\t\t\tQuick Add\n\t\t\t\t</DropdownMenuLabel>\n\t\t\t\t<DropdownMenuSeparator />\n\n\t\t\t\t{Object.entries(quickAddActions).map(([category, actions], index) => (\n\t\t\t\t\t<div key={category}>\n\t\t\t\t\t\t{index > 0 && <DropdownMenuSeparator />}\n\t\t\t\t\t\t<DropdownMenuLabel className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t{category}\n\t\t\t\t\t\t</DropdownMenuLabel>\n\t\t\t\t\t\t<DropdownMenuGroup>\n\t\t\t\t\t\t\t{actions.map((action) => {\n\t\t\t\t\t\t\t\tconst Icon = action.icon;\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<DropdownMenuItem asChild key={action.href}>\n\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center gap-2\"\n\t\t\t\t\t\t\t\t\t\t\thref={action.href}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Icon className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-1 flex-col\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm\">{action.label}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t{action.description && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{action.description}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{action.shortcut && (\n\t\t\t\t\t\t\t\t\t\t\t\t<DropdownMenuShortcut>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{action.shortcut}\n\t\t\t\t\t\t\t\t\t\t\t\t</DropdownMenuShortcut>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t</DropdownMenuGroup>\n\t\t\t\t\t</div>\n\t\t\t\t))}\n\t\t\t</DropdownMenuContent>\n\t\t</DropdownMenu>\n\t);\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"0043ae510c3322ea499beb9e1bb77d06afb4ef19bd\":\"signOut\"},\"apps/web/src/actions/auth.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var signOut=/*#__PURE__*/createServerReference(\"0043ae510c3322ea499beb9e1bb77d06afb4ef19bd\",callServer,void 0,findSourceMapURL,\"signOut\");","/* __next_internal_action_entry_do_not_use__ [{\"4097c3c574342661f9a3c8244961d001234449f36f\":\"switchCompany\"},\"apps/web/src/actions/company-context.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var switchCompany=/*#__PURE__*/createServerReference(\"4097c3c574342661f9a3c8244961d001234449f36f\",callServer,void 0,findSourceMapURL,\"switchCompany\");","/* __next_internal_action_entry_do_not_use__ [{\"4081009dd4dff14ff4ece62648bad23a83f2f9f63c\":\"updateUserStatus\"},\"apps/web/src/actions/user-status.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var updateUserStatus=/*#__PURE__*/createServerReference(\"4081009dd4dff14ff4ece62648bad23a83f2f9f63c\",callServer,void 0,findSourceMapURL,\"updateUserStatus\");","\"use client\";\n\nimport { signOut } from \"@/actions/auth\";\nimport { switchCompany } from \"@/actions/company-context\";\nimport { type UserStatus, updateUserStatus } from \"@/actions/user-status\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { cn } from \"@/lib/utils\";\nimport {\n    Building2,\n    Check,\n    ChevronRight,\n    CreditCard,\n    HelpCircle,\n    Keyboard,\n    LogOut,\n    Monitor,\n    Moon,\n    Plus,\n    Settings,\n    Sun,\n    User,\n} from \"lucide-react\";\nimport { useTheme } from \"next-themes\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport { useEffect, useState } from \"react\";\n\ntype UserMenuProps = {\n\tuser: {\n\t\tname: string;\n\t\temail: string;\n\t\tavatar: string;\n\t\tstatus?: UserStatus;\n\t};\n\tteams: {\n\t\tid: string;\n\t\tname: string;\n\t\tlogo?: string | null;\n\t\tplan: string;\n\t\tonboardingComplete?: boolean;\n\t\thasPayment?: boolean;\n\t}[];\n\tactiveCompanyId?: string | null;\n};\n\nconst STATUS_CONFIG: Record<\n\tUserStatus,\n\t{ label: string; color: string; description: string }\n> = {\n\tonline: {\n\t\tlabel: \"Online\",\n\t\tcolor: \"bg-green-500\",\n\t\tdescription: \"Available for work\",\n\t},\n\tavailable: {\n\t\tlabel: \"Away\",\n\t\tcolor: \"bg-yellow-500\",\n\t\tdescription: \"Temporarily unavailable\",\n\t},\n\tbusy: {\n\t\tlabel: \"Do not disturb\",\n\t\tcolor: \"bg-red-500\",\n\t\tdescription: \"Only urgent matters\",\n\t},\n\toffline: {\n\t\tlabel: \"Offline\",\n\t\tcolor: \"bg-gray-400\",\n\t\tdescription: \"Appear offline\",\n\t},\n};\n\nexport function UserMenu({ user, teams, activeCompanyId }: UserMenuProps) {\n\tconst { theme, setTheme } = useTheme();\n\tconst [mounted, setMounted] = useState(false);\n\tconst [userStatus, setUserStatus] = useState<UserStatus>(\n\t\tuser.status || \"online\"\n\t);\n\tconst [isUpdatingStatus, setIsUpdatingStatus] = useState(false);\n\tconst [isOpen, setIsOpen] = useState(false);\n\n\tconst initialActiveTeam =\n\t\tteams.find((t) => t.id === activeCompanyId) || teams[0];\n\tconst [activeTeam, setActiveTeam] = useState(initialActiveTeam);\n\n\tuseEffect(() => {\n\t\tsetMounted(true);\n\t}, []);\n\n\tconst handleCompanySwitch = async (team: (typeof teams)[0]) => {\n\t\tif (activeTeam?.id === team.id) return;\n\t\tconst result = await switchCompany(team.id);\n\t\tif (result.success) {\n\t\t\tsetActiveTeam(team);\n\t\t}\n\t};\n\n\tconst handleLogout = async () => {\n\t\tawait signOut();\n\t};\n\n\tconst handleStatusChange = async (status: UserStatus) => {\n\t\tsetIsUpdatingStatus(true);\n\t\ttry {\n\t\t\tconst result = await updateUserStatus(status);\n\t\t\tif (result.success) {\n\t\t\t\tsetUserStatus(status);\n\t\t\t}\n\t\t} finally {\n\t\t\tsetIsUpdatingStatus(false);\n\t\t}\n\t};\n\n\tconst getCurrentTheme = () => {\n\t\tif (!mounted) return \"system\";\n\t\treturn theme === \"light\" ? \"light\" : theme === \"dark\" ? \"dark\" : \"system\";\n\t};\n\n\tconst getInitials = (name?: string, email?: string) => {\n\t\tif (name) {\n\t\t\treturn name\n\t\t\t\t.split(\" \")\n\t\t\t\t.map((n) => n[0])\n\t\t\t\t.join(\"\")\n\t\t\t\t.toUpperCase()\n\t\t\t\t.slice(0, 2);\n\t\t}\n\t\treturn email?.substring(0, 2).toUpperCase() || \"U\";\n\t};\n\n\tconst statusConfig = STATUS_CONFIG[userStatus];\n\n\treturn (\n\t\t<DropdownMenu open={isOpen} onOpenChange={setIsOpen}>\n\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t<button\n\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\"flex h-8 items-center gap-2 rounded-lg px-2 transition-all duration-150\",\n\t\t\t\t\t\t\"hover:bg-accent/80 focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n\t\t\t\t\t\t\"outline-none disabled:pointer-events-none disabled:opacity-50\",\n\t\t\t\t\t\tisOpen && \"bg-accent\"\n\t\t\t\t\t)}\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t>\n\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t<Avatar className=\"size-6 rounded-md ring-1 ring-border/50\">\n\t\t\t\t\t\t\t<AvatarImage alt={user.name || user.email} src={user.avatar} />\n\t\t\t\t\t\t\t<AvatarFallback className=\"rounded-md text-[10px] font-medium bg-muted\">\n\t\t\t\t\t\t\t\t{getInitials(user.name, user.email)}\n\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\"absolute -bottom-0.5 -right-0.5 size-2.5 rounded-full ring-2 ring-background\",\n\t\t\t\t\t\t\t\tstatusConfig.color\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span className=\"hidden text-sm font-medium md:inline-block truncate max-w-28\">\n\t\t\t\t\t\t{user.name?.split(\" \")[0] || user.email?.split(\"@\")[0] || \"User\"}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span className=\"sr-only\">Open user menu</span>\n\t\t\t\t</button>\n\t\t\t</DropdownMenuTrigger>\n\n\t\t\t<DropdownMenuContent\n\t\t\t\talign=\"end\"\n\t\t\t\tsideOffset={8}\n\t\t\t\tclassName=\"w-80 p-0 overflow-hidden\"\n\t\t\t>\n\t\t\t\t{/* Profile Header */}\n\t\t\t\t<div className=\"bg-muted/30 border-b border-border/50 p-4\">\n\t\t\t\t\t<div className=\"flex items-start gap-3\">\n\t\t\t\t\t\t<div className=\"relative shrink-0\">\n\t\t\t\t\t\t\t<Avatar className=\"size-11 rounded-xl ring-2 ring-background shadow-sm\">\n\t\t\t\t\t\t\t\t<AvatarImage alt={user.name || user.email} src={user.avatar} />\n\t\t\t\t\t\t\t\t<AvatarFallback className=\"rounded-xl text-sm font-semibold bg-primary/10 text-primary\">\n\t\t\t\t\t\t\t\t\t{getInitials(user.name, user.email)}\n\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\"absolute -bottom-0.5 -right-0.5 size-3 rounded-full ring-2 ring-background\",\n\t\t\t\t\t\t\t\t\tstatusConfig.color\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex-1 min-w-0 space-y-0.5\">\n\t\t\t\t\t\t\t<p className=\"text-sm font-semibold truncate\">\n\t\t\t\t\t\t\t\t{user.name || user.email?.split(\"@\")[0] || \"User\"}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground truncate\">\n\t\t\t\t\t\t\t\t{user.email}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t{activeTeam && (\n\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground truncate flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t<Building2 className=\"size-3\" />\n\t\t\t\t\t\t\t\t\t{activeTeam.name}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Status Section */}\n\t\t\t\t<div className=\"p-2 border-b border-border/50\">\n\t\t\t\t\t<p className=\"text-[11px] font-medium text-muted-foreground uppercase tracking-wider px-2 py-1.5\">\n\t\t\t\t\t\tSet Status\n\t\t\t\t\t</p>\n\t\t\t\t\t<div className=\"space-y-0.5\">\n\t\t\t\t\t\t{(\n\t\t\t\t\t\t\tObject.entries(STATUS_CONFIG) as [\n\t\t\t\t\t\t\t\tUserStatus,\n\t\t\t\t\t\t\t\t(typeof STATUS_CONFIG)[UserStatus],\n\t\t\t\t\t\t\t][]\n\t\t\t\t\t\t).map(([status, config]) => (\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tkey={status}\n\t\t\t\t\t\t\t\tdisabled={isUpdatingStatus}\n\t\t\t\t\t\t\t\tonClick={() => handleStatusChange(status)}\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\"flex w-full items-center gap-3 rounded-md px-2 py-2 text-sm transition-colors\",\n\t\t\t\t\t\t\t\t\t\"hover:bg-accent disabled:opacity-50\",\n\t\t\t\t\t\t\t\t\tuserStatus === status && \"bg-accent\"\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclassName={cn(\"size-2.5 rounded-full shrink-0\", config.color)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<div className=\"flex-1 text-left\">\n\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">{config.label}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{userStatus === status && (\n\t\t\t\t\t\t\t\t\t<Check className=\"size-4 text-primary shrink-0\" />\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Workspace Section */}\n\t\t\t\t<div className=\"p-2 border-b border-border/50\">\n\t\t\t\t\t<div className=\"flex items-center justify-between px-2 py-1.5\">\n\t\t\t\t\t\t<p className=\"text-[11px] font-medium text-muted-foreground uppercase tracking-wider\">\n\t\t\t\t\t\t\tWorkspaces\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\thref=\"/dashboard/welcome?new=true\"\n\t\t\t\t\t\t\tclassName=\"text-[11px] font-medium text-primary hover:underline flex items-center gap-0.5\"\n\t\t\t\t\t\t\tonClick={() => setIsOpen(false)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Plus className=\"size-3\" />\n\t\t\t\t\t\t\tAdd\n\t\t\t\t\t\t</Link>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"max-h-36 overflow-y-auto space-y-0.5\">\n\t\t\t\t\t\t{teams.map((team) => {\n\t\t\t\t\t\t\tconst isActive = activeTeam?.id === team.id;\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tkey={team.id}\n\t\t\t\t\t\t\t\t\tonClick={() => handleCompanySwitch(team)}\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"flex w-full items-center gap-3 rounded-md px-2 py-2 transition-colors\",\n\t\t\t\t\t\t\t\t\t\t\"hover:bg-accent\",\n\t\t\t\t\t\t\t\t\t\tisActive && \"bg-accent\"\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div className=\"flex size-8 items-center justify-center rounded-lg bg-muted shrink-0\">\n\t\t\t\t\t\t\t\t\t\t{team.logo ? (\n\t\t\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\t\t\tsrc={team.logo}\n\t\t\t\t\t\t\t\t\t\t\t\talt={team.name}\n\t\t\t\t\t\t\t\t\t\t\t\twidth={20}\n\t\t\t\t\t\t\t\t\t\t\t\theight={20}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"size-5 object-contain\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<Building2 className=\"size-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0 text-left\">\n\t\t\t\t\t\t\t\t\t\t<p\n\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\"text-sm truncate\",\n\t\t\t\t\t\t\t\t\t\t\t\tisActive && \"font-medium\"\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{team.name}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t\t{team.onboardingComplete === false ? (\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-[10px] text-amber-600 dark:text-amber-400\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tSetup required\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-[10px] text-muted-foreground capitalize\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{team.plan}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{isActive && (\n\t\t\t\t\t\t\t\t\t\t<div className=\"size-1.5 rounded-full bg-primary shrink-0\" />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Navigation Links */}\n\t\t\t\t<div className=\"p-2 border-b border-border/50\">\n\t\t\t\t\t<NavItem\n\t\t\t\t\t\thref=\"/dashboard/settings/profile/personal\"\n\t\t\t\t\t\ticon={User}\n\t\t\t\t\t\tlabel=\"Profile & Account\"\n\t\t\t\t\t\tshortcut=\"⇧⌘P\"\n\t\t\t\t\t\tonClick={() => setIsOpen(false)}\n\t\t\t\t\t/>\n\t\t\t\t\t<NavItem\n\t\t\t\t\t\thref=\"/dashboard/settings/billing\"\n\t\t\t\t\t\ticon={CreditCard}\n\t\t\t\t\t\tlabel=\"Plans & Billing\"\n\t\t\t\t\t\tonClick={() => setIsOpen(false)}\n\t\t\t\t\t/>\n\t\t\t\t\t<NavItem\n\t\t\t\t\t\thref=\"/dashboard/settings\"\n\t\t\t\t\t\ticon={Settings}\n\t\t\t\t\t\tlabel=\"Settings\"\n\t\t\t\t\t\tshortcut=\"⌘,\"\n\t\t\t\t\t\tonClick={() => setIsOpen(false)}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Theme & Preferences */}\n\t\t\t\t<div className=\"p-2 border-b border-border/50\">\n\t\t\t\t\t<p className=\"text-[11px] font-medium text-muted-foreground uppercase tracking-wider px-2 py-1.5\">\n\t\t\t\t\t\tAppearance\n\t\t\t\t\t</p>\n\t\t\t\t\t<div className=\"px-2 py-1\">\n\t\t\t\t\t\t<div className=\"flex items-center gap-1 p-0.5 rounded-lg bg-muted/50\">\n\t\t\t\t\t\t\t{[\n\t\t\t\t\t\t\t\t{ value: \"light\", icon: Sun, label: \"Light\" },\n\t\t\t\t\t\t\t\t{ value: \"dark\", icon: Moon, label: \"Dark\" },\n\t\t\t\t\t\t\t\t{ value: \"system\", icon: Monitor, label: \"System\" },\n\t\t\t\t\t\t\t].map((option) => {\n\t\t\t\t\t\t\t\tconst Icon = option.icon;\n\t\t\t\t\t\t\t\tconst isSelected = getCurrentTheme() === option.value;\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tkey={option.value}\n\t\t\t\t\t\t\t\t\t\tdisabled={!mounted}\n\t\t\t\t\t\t\t\t\t\tonClick={() => setTheme(option.value)}\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"flex flex-1 items-center justify-center gap-1.5 rounded-md px-3 py-1.5 text-xs font-medium transition-all\",\n\t\t\t\t\t\t\t\t\t\t\tisSelected\n\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-background text-foreground shadow-sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground hover:text-foreground\"\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Icon className=\"size-3.5\" />\n\t\t\t\t\t\t\t\t\t\t{option.label}\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Help & Support */}\n\t\t\t\t<div className=\"p-2 border-b border-border/50\">\n\t\t\t\t\t<NavItem\n\t\t\t\t\t\thref=\"/help\"\n\t\t\t\t\t\ticon={HelpCircle}\n\t\t\t\t\t\tlabel=\"Help & Support\"\n\t\t\t\t\t\texternal\n\t\t\t\t\t\tonClick={() => setIsOpen(false)}\n\t\t\t\t\t/>\n\t\t\t\t\t<NavItem\n\t\t\t\t\t\thref=\"/dashboard/settings/shortcuts\"\n\t\t\t\t\t\ticon={Keyboard}\n\t\t\t\t\t\tlabel=\"Keyboard Shortcuts\"\n\t\t\t\t\t\tshortcut=\"⌘/\"\n\t\t\t\t\t\tonClick={() => setIsOpen(false)}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Sign Out */}\n\t\t\t\t<div className=\"p-2\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tonClick={handleLogout}\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"flex w-full items-center gap-3 rounded-md px-2 py-2 text-sm transition-colors\",\n\t\t\t\t\t\t\t\"text-muted-foreground hover:bg-destructive/10 hover:text-destructive\"\n\t\t\t\t\t\t)}\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<LogOut className=\"size-4\" />\n\t\t\t\t\t\t<span>Sign out</span>\n\t\t\t\t\t\t<kbd className=\"ml-auto hidden sm:inline-flex h-5 items-center rounded border border-border/50 bg-muted/50 px-1.5 font-mono text-[10px] text-muted-foreground\">\n\t\t\t\t\t\t\t⇧⌘Q\n\t\t\t\t\t\t</kbd>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</DropdownMenuContent>\n\t\t</DropdownMenu>\n\t);\n}\n\nfunction NavItem({\n\thref,\n\ticon: Icon,\n\tlabel,\n\tshortcut,\n\texternal,\n\tonClick,\n}: {\n\thref: string;\n\ticon: React.ElementType;\n\tlabel: string;\n\tshortcut?: string;\n\texternal?: boolean;\n\tonClick?: () => void;\n}) {\n\treturn (\n\t\t<Link\n\t\t\thref={href}\n\t\t\tonClick={onClick}\n\t\t\tclassName={cn(\n\t\t\t\t\"flex items-center gap-3 rounded-md px-2 py-2 text-sm transition-colors\",\n\t\t\t\t\"text-foreground/80 hover:bg-accent hover:text-foreground\"\n\t\t\t)}\n\t\t\t{...(external && { target: \"_blank\", rel: \"noopener noreferrer\" })}\n\t\t>\n\t\t\t<Icon className=\"size-4 text-muted-foreground\" />\n\t\t\t<span className=\"flex-1\">{label}</span>\n\t\t\t{shortcut && (\n\t\t\t\t<kbd className=\"hidden sm:inline-flex h-5 items-center rounded border border-border/50 bg-muted/50 px-1.5 font-mono text-[10px] text-muted-foreground\">\n\t\t\t\t\t{shortcut}\n\t\t\t\t</kbd>\n\t\t\t)}\n\t\t\t{external && <ChevronRight className=\"size-3.5 text-muted-foreground\" />}\n\t\t</Link>\n\t);\n}\n","\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n\tShield,\n\tAlertTriangle,\n\tBell,\n\tClock,\n\tMail,\n\tDollarSign,\n\tCalendar,\n\tUser,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport {\n\tgetCompanyPendingActions,\n\tcheckIsCompanyOwner,\n\ttype PendingAction,\n} from \"@/actions/ai-approval\";\n\ninterface PendingActionsIndicatorProps {\n\tclassName?: string;\n\tshowPopover?: boolean;\n\tonActionClick?: (action: PendingAction) => void;\n}\n\nconst riskLevelColors = {\n\tlow: \"bg-blue-500\",\n\tmedium: \"bg-yellow-500\",\n\thigh: \"bg-orange-500\",\n\tcritical: \"bg-red-500\",\n};\n\nconst actionTypeIcons: Record<string, typeof Mail> = {\n\tsend_communication: Mail,\n\tfinancial: DollarSign,\n\tscheduling: Calendar,\n\tcustomer: User,\n};\n\nfunction getActionIcon(actionType: string) {\n\treturn actionTypeIcons[actionType] || AlertTriangle;\n}\n\nfunction formatTimeRemaining(expiresAt: string): string {\n\tconst now = new Date();\n\tconst expires = new Date(expiresAt);\n\tconst diff = expires.getTime() - now.getTime();\n\n\tif (diff <= 0) return \"Expired\";\n\n\tconst hours = Math.floor(diff / (1000 * 60 * 60));\n\tconst minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n\n\tif (hours > 0) return `${hours}h ${minutes}m`;\n\treturn `${minutes}m`;\n}\n\nexport function PendingActionsIndicator({\n\tclassName,\n\tshowPopover = true,\n\tonActionClick,\n}: PendingActionsIndicatorProps) {\n\tconst [pendingActions, setPendingActions] = useState<PendingAction[]>([]);\n\tconst [isOwner, setIsOwner] = useState(false);\n\tconst [isLoading, setIsLoading] = useState(true);\n\n\t// Fetch pending actions\n\tuseEffect(() => {\n\t\tconst fetchData = async () => {\n\t\t\tsetIsLoading(true);\n\t\t\ttry {\n\t\t\t\tconst [ownerResult, actionsResult] = await Promise.all([\n\t\t\t\t\tcheckIsCompanyOwner(),\n\t\t\t\t\tgetCompanyPendingActions({ status: \"pending\", limit: 10 }),\n\t\t\t\t]);\n\n\t\t\t\tif (ownerResult.success && ownerResult.data) {\n\t\t\t\t\tsetIsOwner(ownerResult.data);\n\t\t\t\t}\n\n\t\t\t\tif (actionsResult.success && actionsResult.data) {\n\t\t\t\t\tsetPendingActions(actionsResult.data);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Failed to fetch pending actions:\", error);\n\t\t\t} finally {\n\t\t\t\tsetIsLoading(false);\n\t\t\t}\n\t\t};\n\n\t\tfetchData();\n\n\t\t// Poll every 30 seconds\n\t\tconst interval = setInterval(fetchData, 30000);\n\t\treturn () => clearInterval(interval);\n\t}, []);\n\n\t// Don't show if not owner or no pending actions\n\tif (!isOwner || pendingActions.length === 0) {\n\t\treturn null;\n\t}\n\n\tconst criticalCount = pendingActions.filter((a) => a.riskLevel === \"critical\").length;\n\tconst highCount = pendingActions.filter((a) => a.riskLevel === \"high\").length;\n\n\tconst indicatorContent = (\n\t\t<div className={cn(\"relative inline-flex\", className)}>\n\t\t\t<Button\n\t\t\t\tvariant=\"ghost\"\n\t\t\t\tsize=\"icon\"\n\t\t\t\tclassName=\"relative h-9 w-9\"\n\t\t\t>\n\t\t\t\t<Shield className=\"h-5 w-5\" />\n\t\t\t\t<span\n\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\"absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full text-[10px] font-bold text-white\",\n\t\t\t\t\t\tcriticalCount > 0\n\t\t\t\t\t\t\t? \"bg-red-500\"\n\t\t\t\t\t\t\t: highCount > 0\n\t\t\t\t\t\t\t\t? \"bg-orange-500\"\n\t\t\t\t\t\t\t\t: \"bg-yellow-500\"\n\t\t\t\t\t)}\n\t\t\t\t>\n\t\t\t\t\t{pendingActions.length}\n\t\t\t\t</span>\n\t\t\t</Button>\n\t\t</div>\n\t);\n\n\tif (!showPopover) {\n\t\treturn indicatorContent;\n\t}\n\n\treturn (\n\t\t<Popover>\n\t\t\t<PopoverTrigger asChild>{indicatorContent}</PopoverTrigger>\n\t\t\t<PopoverContent className=\"w-80 p-0\" align=\"end\">\n\t\t\t\t<div className=\"flex items-center justify-between p-3 border-b\">\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Shield className=\"h-4 w-4 text-primary\" />\n\t\t\t\t\t\t<span className=\"font-semibold text-sm\">Pending Approvals</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<Badge variant=\"secondary\">{pendingActions.length}</Badge>\n\t\t\t\t</div>\n\n\t\t\t\t<ScrollArea className=\"max-h-[300px]\">\n\t\t\t\t\t<div className=\"divide-y\">\n\t\t\t\t\t\t{pendingActions.map((action) => {\n\t\t\t\t\t\t\tconst ActionIcon = getActionIcon(action.actionType);\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tkey={action.id}\n\t\t\t\t\t\t\t\t\tclassName=\"w-full p-3 text-left hover:bg-muted/50 transition-colors\"\n\t\t\t\t\t\t\t\t\tonClick={() => onActionClick?.(action)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-start gap-3\">\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\"rounded-full p-1.5\",\n\t\t\t\t\t\t\t\t\t\t\t\triskLevelColors[action.riskLevel] + \"/10\"\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<ActionIcon\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"h-4 w-4\",\n\t\t\t\t\t\t\t\t\t\t\t\t\triskLevelColors[action.riskLevel].replace(\"bg-\", \"text-\")\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-medium truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t{action.toolName\n\t\t\t\t\t\t\t\t\t\t\t\t\t.replace(/([A-Z])/g, \" $1\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t.replace(/^./, (s) => s.toUpperCase())}\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t{action.affectedEntityType.replace(/_/g, \" \")}\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 mt-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"text-[10px] px-1.5 py-0\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\triskLevelColors[action.riskLevel].replace(\"bg-\", \"border-\"),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\triskLevelColors[action.riskLevel].replace(\"bg-\", \"text-\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{action.riskLevel}\n\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"flex items-center gap-1 text-[10px] text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Clock className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t{formatTimeRemaining(action.expiresAt)}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})}\n\t\t\t\t\t</div>\n\t\t\t\t</ScrollArea>\n\n\t\t\t\t{pendingActions.length > 0 && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<Separator />\n\t\t\t\t\t\t<div className=\"p-2\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\tclassName=\"w-full text-xs\"\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t// Navigate to AI settings or pending actions page\n\t\t\t\t\t\t\t\t\twindow.location.href = \"/dashboard/settings/ai\";\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tView All Pending Actions\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</PopoverContent>\n\t\t</Popover>\n\t);\n}\n\n/**\n * Simple badge indicator for use in navigation items\n */\nexport function PendingActionsBadge({ className }: { className?: string }) {\n\tconst [count, setCount] = useState(0);\n\tconst [isOwner, setIsOwner] = useState(false);\n\n\tuseEffect(() => {\n\t\tconst fetchData = async () => {\n\t\t\ttry {\n\t\t\t\tconst [ownerResult, actionsResult] = await Promise.all([\n\t\t\t\t\tcheckIsCompanyOwner(),\n\t\t\t\t\tgetCompanyPendingActions({ status: \"pending\", limit: 100 }),\n\t\t\t\t]);\n\n\t\t\t\tif (ownerResult.success && ownerResult.data) {\n\t\t\t\t\tsetIsOwner(ownerResult.data);\n\t\t\t\t}\n\n\t\t\t\tif (actionsResult.success && actionsResult.data) {\n\t\t\t\t\tsetCount(actionsResult.data.length);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Failed to fetch pending action count:\", error);\n\t\t\t}\n\t\t};\n\n\t\tfetchData();\n\t\tconst interval = setInterval(fetchData, 30000);\n\t\treturn () => clearInterval(interval);\n\t}, []);\n\n\tif (!isOwner || count === 0) return null;\n\n\treturn (\n\t\t<Badge\n\t\t\tvariant=\"destructive\"\n\t\t\tclassName={cn(\"ml-auto h-5 min-w-5 px-1.5 text-[10px]\", className)}\n\t\t>\n\t\t\t{count}\n\t\t</Badge>\n\t);\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"40e9589cb639f2902eb841bedc1247d966486d6fd7\":\"getCompanyPendingActions\"},\"apps/web/src/actions/ai-approval.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var getCompanyPendingActions=/*#__PURE__*/createServerReference(\"40e9589cb639f2902eb841bedc1247d966486d6fd7\",callServer,void 0,findSourceMapURL,\"getCompanyPendingActions\");","/* __next_internal_action_entry_do_not_use__ [{\"001be5cf82b793f19f6a7d010c91c14577fa7a130d\":\"checkIsCompanyOwner\"},\"apps/web/src/actions/ai-approval.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var checkIsCompanyOwner=/*#__PURE__*/createServerReference(\"001be5cf82b793f19f6a7d010c91c14577fa7a130d\",callServer,void 0,findSourceMapURL,\"checkIsCompanyOwner\");","\"use client\";\n\n/**\n * AppHeaderErrorBoundary - Error boundary for AppHeader\n *\n * Catches runtime errors in AppHeader and displays a fallback UI\n * that matches the header design, preventing the entire page from crashing.\n *\n * Features:\n * - Catches all errors in AppHeader component tree\n * - Displays user-friendly error message\n * - Provides retry button to attempt recovery\n * - Logs errors for monitoring\n * - Matches header styling for visual consistency\n */\n\nimport { AlertCircle, RefreshCw } from \"lucide-react\";\nimport { Component, type ReactNode } from \"react\";\nimport { Button } from \"@/components/ui/button\";\n\ntype ErrorBoundaryProps = {\n\tchildren: ReactNode;\n};\n\ntype ErrorBoundaryState = {\n\thasError: boolean;\n\terror: Error | null;\n};\n\nexport class AppHeaderErrorBoundary extends Component<\n\tErrorBoundaryProps,\n\tErrorBoundaryState\n> {\n\tconstructor(props: ErrorBoundaryProps) {\n\t\tsuper(props);\n\t\tthis.state = { hasError: false, error: null };\n\t}\n\n\tstatic getDerivedStateFromError(error: Error): ErrorBoundaryState {\n\t\treturn { hasError: true, error };\n\t}\n\n\tcomponentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n\t\t// Log error to monitoring service (e.g., Sentry)\n\t\tconsole.error(\"AppHeader Error:\", error, errorInfo);\n\t}\n\n\thandleReset = () => {\n\t\tthis.setState({ hasError: false, error: null });\n\t\t// Force page reload to attempt recovery\n\t\twindow.location.reload();\n\t};\n\n\trender() {\n\t\tif (this.state.hasError) {\n\t\t\treturn <HeaderErrorFallback onReset={this.handleReset} />;\n\t\t}\n\n\t\treturn this.props.children;\n\t}\n}\n\n/**\n * HeaderErrorFallback - Error state UI for AppHeader\n *\n * Displays when AppHeader encounters a runtime error.\n * Styled to match the header design for visual consistency.\n */\nfunction HeaderErrorFallback({ onReset }: { onReset: () => void }) {\n\treturn (\n\t\t<header className=\"border-border/40 bg-background/95 supports-[backdrop-filter]:bg-background/60 sticky top-0 z-50 w-full border-b backdrop-blur\">\n\t\t\t<div className=\"flex h-14 items-center justify-between px-4\">\n\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t<div className=\"bg-destructive/10 flex h-8 w-8 items-center justify-center rounded-md\">\n\t\t\t\t\t\t<AlertCircle className=\"text-destructive h-4 w-4\" aria-hidden=\"true\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex flex-col\">\n\t\t\t\t\t\t<span className=\"text-sm font-medium\">\n\t\t\t\t\t\t\tUnable to load header\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs hidden sm:inline\">\n\t\t\t\t\t\t\tAn error occurred while loading the navigation\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tonClick={onReset}\n\t\t\t\t\tclassName=\"gap-2\"\n\t\t\t\t\taria-label=\"Retry loading header\"\n\t\t\t\t>\n\t\t\t\t\t<RefreshCw className=\"h-3.5 w-3.5\" aria-hidden=\"true\" />\n\t\t\t\t\t<span className=\"hidden sm:inline\">Retry</span>\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</header>\n\t);\n}\n","\"use client\";\n\n/**\n * Incoming Call Notification Wrapper\n *\n * Performance optimization wrapper that lazy-loads the heavy IncomingCallNotification component.\n *\n * Benefits:\n * - Reduces initial page load by ~700KB+ (component + dependencies)\n * - Only loads when needed (when checking for active calls)\n * - Improves Time to Interactive (TTI) significantly\n * - Does not block initial page render\n *\n * This wrapper checks for active calls and only loads the full component when needed.\n */\n\nimport dynamic from \"next/dynamic\";\nimport { Suspense } from \"react\";\n\n// Lazy load the heavy IncomingCallNotification component\n// Client-only because it uses browser APIs and WebRTC\nconst IncomingCallNotification = dynamic(\n\t() =>\n\t\timport(\"@/components/layout/incoming-call-notification\").then(\n\t\t\t(mod) => mod.IncomingCallNotification,\n\t\t),\n\t{\n\t\tloading: () => null, // No loading UI needed, it's invisible until there's a call\n\t\tssr: false, // Prevent server rendering to avoid hydration mismatches\n\t},\n);\n\n/**\n * Wrapper component that lazy-loads the incoming call notification\n */\nexport function IncomingCallNotificationWrapper() {\n\treturn (\n\t\t<Suspense fallback={null}>\n\t\t\t<IncomingCallNotification />\n\t\t</Suspense>\n\t);\n}\n","\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { usePathname } from \"next/navigation\";\nimport { getTotalUnreadCountAction } from \"@/actions/email-actions\";\nimport { MobileBottomTabs } from \"./mobile-bottom-tabs\";\n\n/**\n * MobileBottomTabsWrapper - Client Component\n *\n * Fetches unread count and passes it to MobileBottomTabs.\n * Separate wrapper to keep the main component clean.\n */\nexport function MobileBottomTabsWrapper() {\n\tconst pathname = usePathname();\n\tconst [unreadCount, setUnreadCount] = useState(0);\n\n\t// Fetch unread count on mount, when pathname changes, and periodically\n\tuseEffect(() => {\n\t\tconst fetchUnreadCount = async () => {\n\t\t\ttry {\n\t\t\t\tconst result = await getTotalUnreadCountAction();\n\t\t\t\tif (result.success && result.count !== undefined) {\n\t\t\t\t\tsetUnreadCount(result.count);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Failed to fetch unread count:\", error);\n\t\t\t}\n\t\t};\n\n\t\t// Fetch immediately\n\t\tfetchUnreadCount();\n\n\t\t// Refresh every 30 seconds\n\t\tconst interval = setInterval(fetchUnreadCount, 30000);\n\n\t\treturn () => clearInterval(interval);\n\t}, [pathname]);\n\n\treturn <MobileBottomTabs unreadCount={unreadCount} />;\n}\n","\"use client\";\n\nimport {\n\tCalendar,\n\tHome,\n\tMessageSquare,\n\tMoreHorizontal,\n\tBriefcase,\n\tX,\n\tSparkles,\n\tDollarSign,\n\tBarChart3,\n\tMegaphone,\n\tGraduationCap,\n\tSettings,\n\tHelpCircle,\n\tChevronRight,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport * as Dialog from \"@radix-ui/react-dialog\";\n\ntype NavItemStatus = \"beta\" | \"new\" | \"updated\" | \"coming-soon\" | null;\n\ntype MoreNavItem = {\n\tlabel: string;\n\thref: string;\n\ticon: React.ElementType;\n\tstatus?: NavItemStatus;\n\ticonBg: string;\n\ticonColor: string;\n\tdescription?: string;\n};\n\nconst moreNavigationItems: MoreNavItem[] = [\n\t{\n\t\tlabel: \"Ask Thorbis\",\n\t\thref: \"/dashboard/ai\",\n\t\ticon: Sparkles,\n\t\tstatus: \"beta\",\n\t\ticonBg: \"bg-primary/10\",\n\t\ticonColor: \"text-primary\",\n\t\tdescription: \"AI-powered assistant\",\n\t},\n\t{\n\t\tlabel: \"Finances\",\n\t\thref: \"/dashboard/finance\",\n\t\ticon: DollarSign,\n\t\tstatus: \"coming-soon\",\n\t\ticonBg: \"bg-emerald-500/10\",\n\t\ticonColor: \"text-emerald-600\",\n\t\tdescription: \"Financial management\",\n\t},\n\t{\n\t\tlabel: \"Reporting\",\n\t\thref: \"/dashboard/reporting\",\n\t\ticon: BarChart3,\n\t\tstatus: \"coming-soon\",\n\t\ticonBg: \"bg-primary/10\",\n\t\ticonColor: \"text-primary\",\n\t\tdescription: \"Analytics and reports\",\n\t},\n\t{\n\t\tlabel: \"Marketing\",\n\t\thref: \"/dashboard/marketing\",\n\t\ticon: Megaphone,\n\t\tstatus: \"coming-soon\",\n\t\ticonBg: \"bg-accent/10\",\n\t\ticonColor: \"text-accent-foreground\",\n\t\tdescription: \"Marketing campaigns\",\n\t},\n\t{\n\t\tlabel: \"Training\",\n\t\thref: \"/dashboard/training\",\n\t\ticon: GraduationCap,\n\t\tstatus: \"coming-soon\",\n\t\ticonBg: \"bg-accent/10\",\n\t\ticonColor: \"text-accent-foreground\",\n\t\tdescription: \"Learning center\",\n\t},\n\t{\n\t\tlabel: \"Settings\",\n\t\thref: \"/dashboard/settings\",\n\t\ticon: Settings,\n\t\ticonBg: \"bg-muted/50\",\n\t\ticonColor: \"text-muted-foreground\",\n\t\tdescription: \"App preferences\",\n\t},\n\t{\n\t\tlabel: \"Help\",\n\t\thref: \"/help\",\n\t\ticon: HelpCircle,\n\t\ticonBg: \"bg-muted/50\",\n\t\ticonColor: \"text-muted-foreground\",\n\t\tdescription: \"Get support\",\n\t},\n];\n\nfunction StatusBadge({ status }: { status?: NavItemStatus }) {\n\tif (!status) {\n\t\treturn null;\n\t}\n\n\tconst styles = {\n\t\tbeta: \"bg-blue-500 text-white\",\n\t\tnew: \"bg-green-500 text-white\",\n\t\tupdated: \"bg-purple-500 text-white\",\n\t\t\"coming-soon\": \"bg-purple-500 text-white\",\n\t};\n\n\tconst labels = {\n\t\tbeta: \"Beta\",\n\t\tnew: \"New\",\n\t\tupdated: \"Updated\",\n\t\t\"coming-soon\": \"Soon\",\n\t};\n\n\treturn (\n\t\t<span\n\t\t\tclassName={`inline-flex items-center rounded-full px-2 py-0.5 text-[0.65rem] font-semibold tracking-wide uppercase ${styles[status]}`}\n\t\t>\n\t\t\t{labels[status]}\n\t\t</span>\n\t);\n}\n\nfunction formatBadgeCount(count: number): string {\n\tif (count <= 9) {\n\t\treturn count.toString();\n\t}\n\tif (count <= 99) {\n\t\treturn \"99+\";\n\t}\n\tif (count <= 999) {\n\t\treturn \"999+\";\n\t}\n\treturn \"1K+\";\n}\n\ntype MobileBottomTabsProps = {\n\tunreadCount?: number;\n};\n\nexport function MobileBottomTabs({ unreadCount = 0 }: MobileBottomTabsProps) {\n\tconst pathname = usePathname();\n\tconst [isMoreOpen, setIsMoreOpen] = useState(false);\n\n\t// Hide bottom tabs on TV route and welcome route\n\tconst isTVRoute = pathname === \"/dashboard/tv\";\n\tconst isWelcomeRoute = pathname === \"/welcome\";\n\n\t// Don't render on TV or welcome routes\n\tif (isTVRoute || isWelcomeRoute) {\n\t\treturn null;\n\t}\n\n\t// Define primary tabs (always visible at bottom)\n\t// Use mobile-optimized dashboard pages for Work and Communication tabs\n\tconst tabs = [\n\t\t{\n\t\t\tlabel: \"Today\",\n\t\t\thref: \"/dashboard\",\n\t\t\ticon: Home,\n\t\t},\n\t\t{\n\t\t\tlabel: \"Messages\",\n\t\t\thref: \"/dashboard/communication/mobile\",\n\t\t\ticon: MessageSquare,\n\t\t\tbadge: unreadCount,\n\t\t},\n\t\t{\n\t\t\tlabel: \"Work\",\n\t\t\thref: \"/dashboard/work/mobile\",\n\t\t\ticon: Briefcase,\n\t\t},\n\t\t{\n\t\t\tlabel: \"Schedule\",\n\t\t\thref: \"/dashboard/schedule\",\n\t\t\ticon: Calendar,\n\t\t},\n\t\t{\n\t\t\tlabel: \"More\",\n\t\t\ticon: MoreHorizontal,\n\t\t\tonClick: () => setIsMoreOpen(true),\n\t\t},\n\t];\n\n\treturn (\n\t\t<>\n\t\t\t{/* Mobile Bottom Tab Bar - iOS/Android style */}\n\t\t\t<nav className=\"safe-bottom bg-background fixed bottom-0 left-0 right-0 z-40 border-t border-border lg:hidden\">\n\t\t\t\t<div className=\"grid h-16 grid-cols-5\">\n\t\t\t\t\t{tabs.map((tab) => {\n\t\t\t\t\t\t// Determine if tab is active\n\t\t\t\t\t\tlet isActive = false;\n\t\t\t\t\t\tif (tab.href) {\n\t\t\t\t\t\t\tif (tab.href === \"/dashboard\") {\n\t\t\t\t\t\t\t\t// Today tab - exact match only\n\t\t\t\t\t\t\t\tisActive = pathname === \"/dashboard\";\n\t\t\t\t\t\t\t} else if (tab.href === \"/dashboard/communication/mobile\") {\n\t\t\t\t\t\t\t\t// Communication tab - match /dashboard/communication/* (including /mobile)\n\t\t\t\t\t\t\t\tisActive = pathname?.startsWith(\"/dashboard/communication\");\n\t\t\t\t\t\t\t} else if (tab.href === \"/dashboard/work/mobile\") {\n\t\t\t\t\t\t\t\t// Work tab - match /dashboard/work/* (including /mobile) or /dashboard/customers\n\t\t\t\t\t\t\t\tisActive =\n\t\t\t\t\t\t\t\t\tpathname?.startsWith(\"/dashboard/work\") ||\n\t\t\t\t\t\t\t\t\tpathname?.startsWith(\"/dashboard/customers\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Other tabs - standard prefix match\n\t\t\t\t\t\t\t\tisActive = pathname?.startsWith(tab.href);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst Icon = tab.icon;\n\n\t\t\t\t\t\t// If tab has onClick (More button), render as button\n\t\t\t\t\t\tif (tab.onClick) {\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclassName={`flex flex-col items-center justify-center gap-1 transition-colors ${\n\t\t\t\t\t\t\t\t\t\tisMoreOpen\n\t\t\t\t\t\t\t\t\t\t\t? \"text-primary\"\n\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground hover:text-foreground active:text-primary\"\n\t\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t\t\tkey={tab.label}\n\t\t\t\t\t\t\t\t\tonClick={tab.onClick}\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\taria-label=\"Open more menu\"\n\t\t\t\t\t\t\t\t\taria-expanded={isMoreOpen}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t\t\t<Icon className=\"h-6 w-6\" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<span className=\"text-[0.65rem] font-medium leading-tight\">{tab.label}</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Regular tab with link\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\tclassName={`flex flex-col items-center justify-center gap-1 transition-colors ${\n\t\t\t\t\t\t\t\t\tisActive\n\t\t\t\t\t\t\t\t\t\t? \"text-primary\"\n\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground hover:text-foreground active:text-primary\"\n\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t\thref={tab.href!}\n\t\t\t\t\t\t\t\tkey={tab.label}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t\t<Icon className=\"h-6 w-6\" />\n\t\t\t\t\t\t\t\t\t{typeof tab.badge === 'number' && tab.badge > 0 && (\n\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"absolute top-0 right-0 flex h-2 w-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75\"></span>\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"relative inline-flex rounded-full h-2 w-2 bg-red-500\"></span>\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"sr-only\">{tab.badge} unread {tab.badge === 1 ? 'message' : 'messages'}</span>\n\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t{isActive && (\n\t\t\t\t\t\t\t\t\t\t<div className=\"absolute -bottom-1.5 left-1/2 h-1 w-1 -translate-x-1/2 rounded-full bg-primary\" />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span className=\"text-[0.65rem] font-medium leading-tight\">{tab.label}</span>\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t);\n\t\t\t\t\t})}\n\t\t\t\t</div>\n\t\t\t</nav>\n\n\t\t\t{/* More Menu - Full Screen Overlay with Dialog (includes focus trap) */}\n\t\t\t<Dialog.Root open={isMoreOpen} onOpenChange={setIsMoreOpen}>\n\t\t\t\t<Dialog.Portal>\n\t\t\t\t\t<Dialog.Overlay className=\"fixed inset-0 z-50 bg-background/95 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 lg:hidden\" />\n\t\t\t\t\t<Dialog.Content className=\"fixed inset-0 z-50 flex flex-col bg-background lg:hidden data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\">\n\t\t\t\t\t\t{/* Header with Close Button */}\n\t\t\t\t\t\t<div className=\"sticky top-0 z-10 bg-background/95 backdrop-blur-sm border-b border-border\">\n\t\t\t\t\t\t\t<div className=\"flex items-center justify-between px-4 h-14\">\n\t\t\t\t\t\t\t\t<Dialog.Title className=\"text-lg font-bold tracking-tight\">\n\t\t\t\t\t\t\t\t\tMore\n\t\t\t\t\t\t\t\t</Dialog.Title>\n\t\t\t\t\t\t\t\t<Dialog.Close\n\t\t\t\t\t\t\t\t\tclassName=\"flex h-10 w-10 items-center justify-center rounded-full hover:bg-accent/80 transition-colors active:scale-95\"\n\t\t\t\t\t\t\t\t\taria-label=\"Close menu\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<X className=\"h-6 w-6\" />\n\t\t\t\t\t\t\t\t</Dialog.Close>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* Scrollable Content */}\n\t\t\t\t\t\t<div className=\"h-[calc(100vh-3.5rem)] overflow-y-auto px-4 py-6\">\n\t\t\t\t\t\t\t<div className=\"space-y-3 pb-safe\">\n\t\t\t\t\t\t\t\t{moreNavigationItems.map((item) => {\n\t\t\t\t\t\t\t\t\tconst isActive = pathname?.startsWith(item.href);\n\t\t\t\t\t\t\t\t\tconst Icon = item.icon;\n\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\tclassName={`group flex items-center gap-4 rounded-2xl border-2 p-5 transition-all duration-200 active:scale-[0.98] ${\n\t\t\t\t\t\t\t\t\t\t\t\tisActive\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"border-primary/40 bg-primary/10 text-primary shadow-lg shadow-primary/20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"border-border bg-card text-card-foreground hover:border-primary/30 hover:bg-primary/5 hover:shadow-md\"\n\t\t\t\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t\t\t\t\thref={item.href}\n\t\t\t\t\t\t\t\t\t\t\tkey={item.href}\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => setIsMoreOpen(false)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`flex h-14 w-14 shrink-0 items-center justify-center rounded-xl transition-all duration-200 ${item.iconBg} ${\n\t\t\t\t\t\t\t\t\t\t\t\t\tisActive ? \"scale-105\" : \"group-hover:scale-105\"\n\t\t\t\t\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Icon className={`h-7 w-7 ${item.iconColor}`} />\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 mb-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold text-base\">{item.label}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{item.status && <StatusBadge status={item.status} />}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t{item.description && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-sm leading-snug\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{item.description}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<ChevronRight\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`h-5 w-5 text-muted-foreground/50 transition-all ${\n\t\t\t\t\t\t\t\t\t\t\t\t\tisActive ? \"text-primary\" : \"group-hover:translate-x-1\"\n\t\t\t\t\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Dialog.Content>\n\t\t\t\t</Dialog.Portal>\n\t\t\t</Dialog.Root>\n\t\t</>\n\t);\n}\n","\"use client\";\n\n/**\n * NotificationsInitializer\n *\n * Ensures realtime notifications and desktop permissions are ready globally.\n * - Subscribes to the notifications store as soon as the dashboard mounts\n * - Requests desktop notification permission once per browser\n * - Keeps communication toasts (SMS, calls, voicemail) in sync with desktop alerts\n */\n\nimport { useEffect, useRef } from \"react\";\nimport { useCommunicationNotificationsStore } from \"@/lib/stores/communication-notifications-store\";\nimport { useNotificationsStore } from \"@/lib/stores/notifications-store\";\nimport { createClient } from \"@/lib/supabase/client\";\n\nconst DESKTOP_PROMPT_KEY = \"communication_desktop_prompted\";\n\nexport function NotificationsInitializer() {\n\tconst subscribe = useNotificationsStore((state) => state.subscribe);\n\tconst unsubscribe = useNotificationsStore((state) => state.unsubscribe);\n\n\tconst requestDesktopPermission = useCommunicationNotificationsStore(\n\t\t(state) => state.requestDesktopNotificationPermission,\n\t);\n\tconst desktopNotificationsEnabled = useCommunicationNotificationsStore(\n\t\t(state) => state.desktopNotificationsEnabled,\n\t);\n\tconst setDesktopNotificationsEnabled = useCommunicationNotificationsStore(\n\t\t(state) => state.setDesktopNotificationsEnabled,\n\t);\n\n\tconst hasSubscribedRef = useRef(false);\n\n\t// Start realtime notifications subscription immediately\n\tuseEffect(() => {\n\t\tif (hasSubscribedRef.current) {\n\t\t\treturn;\n\t\t}\n\t\thasSubscribedRef.current = true;\n\n\t\tlet cancelled = false;\n\t\tconst supabase = createClient();\n\n\t\t(async () => {\n\t\t\tif (!supabase) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst {\n\t\t\t\tdata: { user },\n\t\t\t} = await supabase.auth.getUser();\n\n\t\t\tif (!user || cancelled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait subscribe(user.id);\n\t\t})();\n\n\t\treturn () => {\n\t\t\tcancelled = true;\n\t\t\tunsubscribe();\n\t\t};\n\t}, [subscribe, unsubscribe]);\n\n\t// Ask for desktop notification permission once\n\tuseEffect(() => {\n\t\tif (typeof window === \"undefined\" || !(\"Notification\" in window)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst alreadyPrompted =\n\t\t\twindow.localStorage.getItem(DESKTOP_PROMPT_KEY) === \"true\";\n\n\t\tconst finalizePrompt = (granted: boolean) => {\n\t\t\twindow.localStorage.setItem(DESKTOP_PROMPT_KEY, \"true\");\n\t\t\tif (!granted && desktopNotificationsEnabled) {\n\t\t\t\tsetDesktopNotificationsEnabled(false);\n\t\t\t}\n\t\t};\n\n\t\t// Permission already decided\n\t\tif (Notification.permission === \"granted\") {\n\t\t\tif (!alreadyPrompted) {\n\t\t\t\twindow.localStorage.setItem(DESKTOP_PROMPT_KEY, \"true\");\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (Notification.permission === \"denied\") {\n\t\t\tif (!alreadyPrompted) {\n\t\t\t\twindow.localStorage.setItem(DESKTOP_PROMPT_KEY, \"true\");\n\t\t\t}\n\t\t\tif (desktopNotificationsEnabled) {\n\t\t\t\tsetDesktopNotificationsEnabled(false);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// Only prompt once while permission is \"default\"\n\t\tif (alreadyPrompted) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timer = window.setTimeout(() => {\n\t\t\trequestDesktopPermission()\n\t\t\t\t.then((granted) => finalizePrompt(granted))\n\t\t\t\t.catch(() => finalizePrompt(false));\n\t\t}, 1500);\n\n\t\treturn () => window.clearTimeout(timer);\n\t}, [\n\t\tdesktopNotificationsEnabled,\n\t\trequestDesktopPermission,\n\t\tsetDesktopNotificationsEnabled,\n\t]);\n\n\treturn null;\n}\n","/**\n * Communication Notifications Store - Zustand State Management\n *\n * Handles real-time toast notifications for:\n * - Phone calls (incoming, missed, completed)\n * - Voicemails (new messages)\n * - Text messages/SMS (incoming)\n * - Emails (incoming)\n *\n * Performance optimizations:\n * - Lightweight state management with Zustand\n * - Automatic toast display on new communications\n * - Integrated with existing notifications system\n * - Sound and desktop notification support\n */\n\nimport { toast } from \"sonner\";\nimport { create } from \"zustand\";\nimport { devtools } from \"zustand/middleware\";\nimport {\n\tCOMMUNICATION_MARK_AS_READ_EVENT,\n\ttype CommunicationMarkAsReadDetail,\n} from \"./notification-events\";\nimport type { Notification } from \"./notifications-types\";\n\n// =====================================================================================\n// Types\n// =====================================================================================\n\nexport type CommunicationType = \"call\" | \"sms\" | \"email\" | \"voicemail\";\n\nexport type CommunicationToastOptions = {\n\tid?: string;\n\tduration?: number;\n\tcloseButton?: boolean;\n\tdismissible?: boolean;\n\taction?: {\n\t\tlabel: string;\n\t\tonClick: () => void;\n\t};\n};\n\ntype CommunicationNotificationsState = {\n\t// State\n\ttoastQueue: string[]; // Track active toast IDs\n\tsoundEnabled: boolean;\n\tdesktopNotificationsEnabled: boolean;\n\ttoastDuration: number;\n\n\t// Actions\n\tshowCommunicationToast: (\n\t\tnotification: Notification,\n\t\toptions?: CommunicationToastOptions,\n\t) => string | number;\n\tshowCallToast: (\n\t\tcustomerName: string,\n\t\tphoneNumber: string,\n\t\tstatus: \"incoming\" | \"missed\" | \"completed\",\n\t\tmetadata?: Record<string, any>,\n\t) => void;\n\tshowVoicemailToast: (\n\t\tcustomerName: string,\n\t\tphoneNumber: string,\n\t\tduration?: number,\n\t) => void;\n\tshowSMSToast: (\n\t\tcustomerName: string,\n\t\tphoneNumber: string,\n\t\tmessage: string,\n\t) => void;\n\tshowEmailToast: (\n\t\tcustomerName: string,\n\t\tfromAddress: string,\n\t\tsubject: string,\n\t) => void;\n\tdismissToast: (id: string | number) => void;\n\tdismissAllToasts: () => void;\n\n\t// Settings\n\tsetSoundEnabled: (enabled: boolean) => void;\n\tsetDesktopNotificationsEnabled: (enabled: boolean) => void;\n\tsetToastDuration: (duration: number) => void;\n\n\t// Utility\n\tplayNotificationSound: () => void;\n\trequestDesktopNotificationPermission: () => Promise<boolean>;\n\tshowDesktopNotification: (\n\t\ttitle: string,\n\t\tbody: string,\n\t\tdata?: Record<string, any>,\n\t) => void;\n};\n\n// Initial state (load from localStorage if available)\nconst loadSettings = () => {\n\tif (typeof window === \"undefined\") {\n\t\treturn {\n\t\t\tsoundEnabled: true,\n\t\t\tdesktopNotificationsEnabled: true,\n\t\t\ttoastDuration: 5000,\n\t\t};\n\t}\n\n\treturn {\n\t\tsoundEnabled:\n\t\t\tlocalStorage.getItem(\"communication_sound_enabled\") !== \"false\",\n\t\tdesktopNotificationsEnabled:\n\t\t\tlocalStorage.getItem(\"communication_desktop_enabled\") !== \"false\",\n\t\ttoastDuration: Number.parseInt(\n\t\t\tlocalStorage.getItem(\"communication_toast_duration\") || \"5000\",\n\t\t\t10,\n\t\t),\n\t};\n};\n\n// =====================================================================================\n// Zustand Store\n// =====================================================================================\n\nexport const useCommunicationNotificationsStore =\n\tcreate<CommunicationNotificationsState>()(\n\t\tdevtools(\n\t\t\t(set, get) => ({\n\t\t\t\t...loadSettings(),\n\t\t\t\ttoastQueue: [],\n\n\t\t\t\t// ===============================================================================\n\t\t\t\t// Toast Display\n\t\t\t\t// ===============================================================================\n\n\t\t\t\tshowCommunicationToast: (notification, options = {}) => {\n\t\t\t\t\tconst { metadata } = notification;\n\t\t\t\t\tconst communicationType = metadata?.communication_type as\n\t\t\t\t\t\t| CommunicationType\n\t\t\t\t\t\t| undefined;\n\n\t\t\t\t\t// Determine toast appearance based on communication type\n\t\t\t\t\tlet icon = \"📩\"; // Default\n\t\t\t\t\tlet _toastType: \"info\" | \"success\" | \"error\" = \"info\";\n\n\t\t\t\t\tswitch (communicationType) {\n\t\t\t\t\t\tcase \"call\":\n\t\t\t\t\t\t\ticon = \"📞\";\n\t\t\t\t\t\t\tif (notification.priority === \"high\") {\n\t\t\t\t\t\t\t\ticon = \"📵\"; // Missed call\n\t\t\t\t\t\t\t\t_toastType = \"error\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"sms\":\n\t\t\t\t\t\t\ticon = \"💬\";\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"email\":\n\t\t\t\t\t\t\ticon = \"📧\";\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"voicemail\":\n\t\t\t\t\t\t\ticon = \"🎙️\";\n\t\t\t\t\t\t\tif (notification.priority === \"urgent\") {\n\t\t\t\t\t\t\t\t_toastType = \"error\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Play sound if enabled\n\t\t\t\t\tconst { soundEnabled } = get();\n\t\t\t\t\tif (soundEnabled) {\n\t\t\t\t\t\tget().playNotificationSound();\n\t\t\t\t\t}\n\n\t\t\t\t\t// Show desktop notification if enabled\n\t\t\t\t\tconst { desktopNotificationsEnabled } = get();\n\t\t\t\t\tif (desktopNotificationsEnabled) {\n\t\t\t\t\t\tget().showDesktopNotification(\n\t\t\t\t\t\t\tnotification.title,\n\t\t\t\t\t\t\tnotification.message,\n\t\t\t\t\t\t\tmetadata ?? undefined,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Create toast with custom styling\n\t\t\t\t\tconst toastId = toast(notification.title, {\n\t\t\t\t\t\tdescription: notification.message,\n\t\t\t\t\t\tduration: options.duration || get().toastDuration,\n\t\t\t\t\t\ticon,\n\t\t\t\t\t\tcloseButton: options.closeButton ?? true,\n\t\t\t\t\t\tdismissible: options.dismissible ?? true,\n\t\t\t\t\t\taction: notification.action_url\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tlabel: notification.action_label || \"View\",\n\t\t\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\t\t\tif (typeof window !== \"undefined\") {\n\t\t\t\t\t\t\t\t\t\t\tconst detail: CommunicationMarkAsReadDetail = {\n\t\t\t\t\t\t\t\t\t\t\t\tnotificationId: notification.id,\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\twindow.dispatchEvent(\n\t\t\t\t\t\t\t\t\t\t\t\tnew CustomEvent(COMMUNICATION_MARK_AS_READ_EVENT, {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdetail,\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (notification.action_url) {\n\t\t\t\t\t\t\t\t\t\t\twindow.location.href = notification.action_url;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: options.action,\n\t\t\t\t\t\tclassName:\n\t\t\t\t\t\t\tnotification.priority === \"urgent\"\n\t\t\t\t\t\t\t\t? \"border-destructive bg-destructive/10\"\n\t\t\t\t\t\t\t\t: \"\",\n\t\t\t\t\t});\n\n\t\t\t\t\t// Track toast ID\n\t\t\t\t\tset((state) => ({\n\t\t\t\t\t\ttoastQueue: [...state.toastQueue, String(toastId)],\n\t\t\t\t\t}));\n\n\t\t\t\t\treturn toastId;\n\t\t\t\t},\n\n\t\t\t\tshowCallToast: (customerName, phoneNumber, status, metadata = {}) => {\n\t\t\t\t\tlet title = \"\";\n\t\t\t\t\tlet message = \"\";\n\t\t\t\t\tlet _priority: \"low\" | \"medium\" | \"high\" = \"medium\";\n\t\t\t\t\tlet icon = \"📞\";\n\n\t\t\t\t\tswitch (status) {\n\t\t\t\t\t\tcase \"incoming\":\n\t\t\t\t\t\t\ttitle = `Incoming call from ${customerName}`;\n\t\t\t\t\t\t\tmessage = phoneNumber;\n\t\t\t\t\t\t\t_priority = \"high\";\n\t\t\t\t\t\t\ticon = \"📞\";\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"missed\":\n\t\t\t\t\t\t\ttitle = `Missed call from ${customerName}`;\n\t\t\t\t\t\t\tmessage = phoneNumber;\n\t\t\t\t\t\t\t_priority = \"high\";\n\t\t\t\t\t\t\ticon = \"📵\";\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"completed\":\n\t\t\t\t\t\t\ttitle = `Call with ${customerName}`;\n\t\t\t\t\t\t\tmessage = `Duration: ${metadata.duration || \"Unknown\"}`;\n\t\t\t\t\t\t\t_priority = \"low\";\n\t\t\t\t\t\t\ticon = \"✅\";\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst toastId = toast(title, {\n\t\t\t\t\t\tdescription: message,\n\t\t\t\t\t\ticon,\n\t\t\t\t\t\tduration: get().toastDuration,\n\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\taction: {\n\t\t\t\t\t\t\tlabel: \"View\",\n\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\twindow.location.href =\n\t\t\t\t\t\t\t\t\t\"/dashboard/customers/communication?filter=calls\";\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tclassName: status === \"missed\" ? \"border-destructive\" : \"\",\n\t\t\t\t\t});\n\n\t\t\t\t\tif (get().soundEnabled) {\n\t\t\t\t\t\tget().playNotificationSound();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (get().desktopNotificationsEnabled) {\n\t\t\t\t\t\tget().showDesktopNotification(title, message, {\n\t\t\t\t\t\t\tstatus,\n\t\t\t\t\t\t\t...metadata,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn toastId;\n\t\t\t\t},\n\n\t\t\t\tshowVoicemailToast: (customerName, phoneNumber, duration) => {\n\t\t\t\t\tconst title = `New voicemail from ${customerName}`;\n\t\t\t\t\tconst message = duration\n\t\t\t\t\t\t? `${phoneNumber} • ${duration}s`\n\t\t\t\t\t\t: phoneNumber;\n\n\t\t\t\t\tconst toastId = toast(title, {\n\t\t\t\t\t\tdescription: message,\n\t\t\t\t\t\ticon: \"🎙️\",\n\t\t\t\t\t\tduration: get().toastDuration,\n\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\taction: {\n\t\t\t\t\t\t\tlabel: \"Listen\",\n\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\twindow.location.href =\n\t\t\t\t\t\t\t\t\t\"/dashboard/customers/communication?filter=voicemails\";\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tif (get().soundEnabled) {\n\t\t\t\t\t\tget().playNotificationSound();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (get().desktopNotificationsEnabled) {\n\t\t\t\t\t\tget().showDesktopNotification(title, message, {\n\t\t\t\t\t\t\ttype: \"voicemail\",\n\t\t\t\t\t\t\tduration,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn toastId;\n\t\t\t\t},\n\n\t\t\t\tshowSMSToast: (customerName, phoneNumber, message) => {\n\t\t\t\t\tconst title = `Text from ${customerName}`;\n\t\t\t\t\tconst preview =\n\t\t\t\t\t\tmessage.length > 100 ? `${message.substring(0, 100)}...` : message;\n\n\t\t\t\t\tconst toastId = toast(title, {\n\t\t\t\t\t\tdescription: preview,\n\t\t\t\t\t\ticon: \"💬\",\n\t\t\t\t\t\tduration: get().toastDuration,\n\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\taction: {\n\t\t\t\t\t\t\tlabel: \"Reply\",\n\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\twindow.location.href =\n\t\t\t\t\t\t\t\t\t\"/dashboard/customers/communication?filter=sms\";\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tif (get().soundEnabled) {\n\t\t\t\t\t\tget().playNotificationSound();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (get().desktopNotificationsEnabled) {\n\t\t\t\t\t\tget().showDesktopNotification(title, preview, {\n\t\t\t\t\t\t\ttype: \"sms\",\n\t\t\t\t\t\t\tfrom: phoneNumber,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn toastId;\n\t\t\t\t},\n\n\t\t\t\tshowEmailToast: (customerName, fromAddress, subject) => {\n\t\t\t\t\tconst title = `Email from ${customerName}`;\n\t\t\t\t\tconst message = subject || \"No subject\";\n\n\t\t\t\t\tconst toastId = toast(title, {\n\t\t\t\t\t\tdescription: message,\n\t\t\t\t\t\ticon: \"📧\",\n\t\t\t\t\t\tduration: get().toastDuration,\n\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\taction: {\n\t\t\t\t\t\t\tlabel: \"View\",\n\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\twindow.location.href =\n\t\t\t\t\t\t\t\t\t\"/dashboard/customers/communication?filter=emails\";\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tif (get().soundEnabled) {\n\t\t\t\t\t\tget().playNotificationSound();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (get().desktopNotificationsEnabled) {\n\t\t\t\t\t\tget().showDesktopNotification(title, message, {\n\t\t\t\t\t\t\ttype: \"email\",\n\t\t\t\t\t\t\tfrom: fromAddress,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn toastId;\n\t\t\t\t},\n\n\t\t\t\tdismissToast: (id) => {\n\t\t\t\t\ttoast.dismiss(id);\n\t\t\t\t\tset((state) => ({\n\t\t\t\t\t\ttoastQueue: state.toastQueue.filter(\n\t\t\t\t\t\t\t(toastId) => toastId !== String(id),\n\t\t\t\t\t\t),\n\t\t\t\t\t}));\n\t\t\t\t},\n\n\t\t\t\tdismissAllToasts: () => {\n\t\t\t\t\ttoast.dismiss();\n\t\t\t\t\tset({ toastQueue: [] });\n\t\t\t\t},\n\n\t\t\t\t// ===============================================================================\n\t\t\t\t// Settings\n\t\t\t\t// ===============================================================================\n\n\t\t\t\tsetSoundEnabled: (enabled) => {\n\t\t\t\t\tset({ soundEnabled: enabled });\n\t\t\t\t\tif (typeof window !== \"undefined\") {\n\t\t\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t\t\t\"communication_sound_enabled\",\n\t\t\t\t\t\t\tenabled.toString(),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tsetDesktopNotificationsEnabled: (enabled) => {\n\t\t\t\t\tset({ desktopNotificationsEnabled: enabled });\n\t\t\t\t\tif (typeof window !== \"undefined\") {\n\t\t\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t\t\t\"communication_desktop_enabled\",\n\t\t\t\t\t\t\tenabled.toString(),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Request permission if enabling\n\t\t\t\t\tif (enabled) {\n\t\t\t\t\t\tget().requestDesktopNotificationPermission();\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tsetToastDuration: (duration) => {\n\t\t\t\t\tset({ toastDuration: duration });\n\t\t\t\t\tif (typeof window !== \"undefined\") {\n\t\t\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t\t\t\"communication_toast_duration\",\n\t\t\t\t\t\t\tduration.toString(),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// ===============================================================================\n\t\t\t\t// Utility\n\t\t\t\t// ===============================================================================\n\n\t\t\t\tplayNotificationSound: () => {\n\t\t\t\t\tif (typeof window === \"undefined\") {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Create audio element for notification sound\n\t\t\t\t\t\tconst audio = new Audio(\"/sounds/notification.mp3\");\n\t\t\t\t\t\taudio.volume = 0.4;\n\t\t\t\t\t\taudio.play().catch((_error) => {});\n\t\t\t\t\t} catch (_error) {}\n\t\t\t\t},\n\n\t\t\t\trequestDesktopNotificationPermission: async () => {\n\t\t\t\t\tif (typeof window === \"undefined\" || !(\"Notification\" in window)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Notification.permission === \"granted\") {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Notification.permission !== \"denied\") {\n\t\t\t\t\t\tconst permission = await Notification.requestPermission();\n\t\t\t\t\t\treturn permission === \"granted\";\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\n\t\t\t\tshowDesktopNotification: (title, body, data = {}) => {\n\t\t\t\t\tif (typeof window === \"undefined\" || !(\"Notification\" in window)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Notification.permission !== \"granted\") {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst notification = new Notification(title, {\n\t\t\t\t\t\t\tbody,\n\t\t\t\t\t\t\ticon: \"/icon-192x192.svg\",\n\t\t\t\t\t\t\tbadge: \"/icon-192x192.svg\",\n\t\t\t\t\t\t\ttag: `communication-${data.type || \"general\"}`,\n\t\t\t\t\t\t\tdata,\n\t\t\t\t\t\t\trequireInteraction:\n\t\t\t\t\t\t\t\tdata.type === \"call\" && data.status === \"incoming\",\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Handle notification click\n\t\t\t\t\t\tnotification.onclick = () => {\n\t\t\t\t\t\t\twindow.focus();\n\t\t\t\t\t\t\tif (data.action_url) {\n\t\t\t\t\t\t\t\twindow.location.href = data.action_url;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tnotification.close();\n\t\t\t\t\t\t};\n\t\t\t\t\t} catch (_error) {}\n\t\t\t\t},\n\t\t\t}),\n\t\t\t{ name: \"CommunicationNotificationsStore\" },\n\t\t),\n\t);\n","\"use client\";\n\n/**\n * Support Session Provider\n *\n * Polls for pending/active support sessions and displays:\n * - Approval modal for pending sessions\n * - Active session banner when support is viewing\n *\n * Uses polling initially, can be upgraded to Supabase Realtime for production.\n */\n\nimport { useState, useEffect } from \"react\";\nimport { getPendingSupportSessions, getActiveSupportSessions } from \"@/actions/support-sessions\";\nimport { SessionApprovalModal } from \"./session-approval-modal\";\nimport { ActiveSessionBanner } from \"./active-session-banner\";\nimport { SupportActionNotifier } from \"./support-action-notifier\";\n\ninterface SupportSession {\n\tid: string;\n\tadmin_user_id: string;\n\tticket_id: string | null;\n\treason: string;\n\trequested_at: string;\n\trequested_permissions: string[];\n\tapproved_at?: string;\n\texpires_at?: string;\n\tadmin_name?: string;\n\tadmin_email?: string;\n}\n\nconst POLL_INTERVAL = 10000; // 10 seconds\n\nexport function SupportSessionProvider({ children }: { children: React.ReactNode }) {\n\tconst [pendingSessions, setPendingSessions] = useState<SupportSession[]>([]);\n\tconst [activeSessions, setActiveSessions] = useState<SupportSession[]>([]);\n\tconst [showApprovalModal, setShowApprovalModal] = useState(false);\n\tconst [currentSessionIndex, setCurrentSessionIndex] = useState(0);\n\n\t// Fetch pending and active sessions\n\tconst fetchSessions = async () => {\n\t\ttry {\n\t\t\t// Fetch pending sessions\n\t\t\tconst pendingResult = await getPendingSupportSessions();\n\t\t\tif (pendingResult.success && pendingResult.sessions) {\n\t\t\t\tsetPendingSessions(pendingResult.sessions);\n\n\t\t\t\t// Show modal if there are pending sessions and it's not already shown\n\t\t\t\tif (pendingResult.sessions.length > 0 && !showApprovalModal) {\n\t\t\t\t\tsetShowApprovalModal(true);\n\t\t\t\t\tsetCurrentSessionIndex(0);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Fetch active sessions\n\t\t\tconst activeResult = await getActiveSupportSessions();\n\t\t\tif (activeResult.success && activeResult.sessions) {\n\t\t\t\tsetActiveSessions(activeResult.sessions);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error fetching support sessions:\", error);\n\t\t}\n\t};\n\n\t// Poll for sessions\n\tuseEffect(() => {\n\t\t// Initial fetch\n\t\tfetchSessions();\n\n\t\t// Set up polling\n\t\tconst interval = setInterval(fetchSessions, POLL_INTERVAL);\n\n\t\treturn () => clearInterval(interval);\n\t}, []);\n\n\t// Handle approval/rejection\n\tconst handleSessionApproved = () => {\n\t\t// Refresh sessions\n\t\tfetchSessions();\n\n\t\t// Show next pending session if any\n\t\tif (currentSessionIndex < pendingSessions.length - 1) {\n\t\t\tsetCurrentSessionIndex(currentSessionIndex + 1);\n\t\t} else {\n\t\t\tsetShowApprovalModal(false);\n\t\t}\n\t};\n\n\tconst handleSessionRejected = () => {\n\t\t// Refresh sessions\n\t\tfetchSessions();\n\n\t\t// Show next pending session if any\n\t\tif (currentSessionIndex < pendingSessions.length - 1) {\n\t\t\tsetCurrentSessionIndex(currentSessionIndex + 1);\n\t\t} else {\n\t\t\tsetShowApprovalModal(false);\n\t\t}\n\t};\n\n\tconst handleSessionEnded = () => {\n\t\t// Refresh sessions to remove ended session\n\t\tfetchSessions();\n\t};\n\n\tconst currentPendingSession = pendingSessions[currentSessionIndex] || null;\n\tconst currentActiveSession = activeSessions[0] || null; // Show first active session\n\n\treturn (\n\t\t<>\n\t\t\t{/* Active Session Banner */}\n\t\t\t{currentActiveSession && <ActiveSessionBanner session={currentActiveSession as any} onSessionEnded={handleSessionEnded} />}\n\n\t\t\t{/* Session Approval Modal */}\n\t\t\t<SessionApprovalModal session={currentPendingSession} open={showApprovalModal} onOpenChange={setShowApprovalModal} onApproved={handleSessionApproved} onRejected={handleSessionRejected} />\n\n\t\t\t{/* Support Action Notifier - shows toast when support takes actions */}\n\t\t\t<SupportActionNotifier />\n\n\t\t\t{/* Add padding to content if active session banner is shown */}\n\t\t\t<div className={currentActiveSession ? \"pt-12\" : \"\"}>{children}</div>\n\t\t</>\n\t);\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"000f90f949d6a2f5484d061d5a738a59a8c846aeaa\":\"getPendingSupportSessions\"},\"apps/web/src/actions/support-sessions.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var getPendingSupportSessions=/*#__PURE__*/createServerReference(\"000f90f949d6a2f5484d061d5a738a59a8c846aeaa\",callServer,void 0,findSourceMapURL,\"getPendingSupportSessions\");","/* __next_internal_action_entry_do_not_use__ [{\"00665c1bbcd52d612d5bb4bf3be5e7fc75554132e6\":\"getActiveSupportSessions\"},\"apps/web/src/actions/support-sessions.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var getActiveSupportSessions=/*#__PURE__*/createServerReference(\"00665c1bbcd52d612d5bb4bf3be5e7fc75554132e6\",callServer,void 0,findSourceMapURL,\"getActiveSupportSessions\");","\"use client\";\n\n/**\n * Support Session Approval Modal\n *\n * Modal that appears when support requests access to the company account.\n * Customer can approve (with duration) or deny the request.\n */\n\nimport { useState } from \"react\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Shield, Clock, User, Ticket, AlertCircle } from \"lucide-react\";\nimport { approveSupportSessionRequest, rejectSupportSessionRequest } from \"@/actions/support-sessions\";\nimport { toast } from \"sonner\";\n\ninterface SupportSession {\n\tid: string;\n\tadmin_user_id: string;\n\tticket_id: string | null;\n\treason: string;\n\trequested_at: string;\n\trequested_permissions: string[];\n\tadmin_name?: string;\n\tadmin_email?: string;\n}\n\ninterface SessionApprovalModalProps {\n\tsession: SupportSession | null;\n\topen: boolean;\n\tonOpenChange: (open: boolean) => void;\n\tonApproved?: () => void;\n\tonRejected?: () => void;\n}\n\nexport function SessionApprovalModal({ session, open, onOpenChange, onApproved, onRejected }: SessionApprovalModalProps) {\n\tconst [isApproving, setIsApproving] = useState(false);\n\tconst [isRejecting, setIsRejecting] = useState(false);\n\tconst [duration, setDuration] = useState(\"60\"); // minutes\n\n\tif (!session) return null;\n\n\tconst handleApprove = async () => {\n\t\tsetIsApproving(true);\n\t\ttry {\n\t\t\tconst result = await approveSupportSessionRequest(session.id, parseInt(duration));\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Support access approved\", {\n\t\t\t\t\tdescription: `Access granted for ${duration} minutes`,\n\t\t\t\t});\n\t\t\t\tonOpenChange(false);\n\t\t\t\tonApproved?.();\n\t\t\t} else {\n\t\t\t\ttoast.error(\"Failed to approve access\", {\n\t\t\t\t\tdescription: result.error || \"Please try again\",\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (error) {\n\t\t\ttoast.error(\"Error approving access\");\n\t\t\tconsole.error(error);\n\t\t} finally {\n\t\t\tsetIsApproving(false);\n\t\t}\n\t};\n\n\tconst handleReject = async () => {\n\t\tsetIsRejecting(true);\n\t\ttry {\n\t\t\tconst result = await rejectSupportSessionRequest(session.id, \"Declined by customer\");\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Support access denied\");\n\t\t\t\tonOpenChange(false);\n\t\t\t\tonRejected?.();\n\t\t\t} else {\n\t\t\t\ttoast.error(\"Failed to deny access\", {\n\t\t\t\t\tdescription: result.error || \"Please try again\",\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (error) {\n\t\t\ttoast.error(\"Error denying access\");\n\t\t\tconsole.error(error);\n\t\t} finally {\n\t\t\tsetIsRejecting(false);\n\t\t}\n\t};\n\n\t// Format permissions for display\n\tconst permissionLabels: Record<string, string> = {\n\t\tview: \"View your account data\",\n\t\tedit_jobs: \"Modify jobs\",\n\t\tedit_invoices: \"Modify invoices\",\n\t\tedit_payments: \"Manage payments\",\n\t\trefund: \"Issue refunds\",\n\t\tedit_team: \"Manage team members\",\n\t\treset_password: \"Reset passwords\",\n\t\tedit_company: \"Update company settings\",\n\t};\n\n\treturn (\n\t\t<Dialog open={open} onOpenChange={onOpenChange}>\n\t\t\t<DialogContent className=\"sm:max-w-[500px]\">\n\t\t\t\t<DialogHeader>\n\t\t\t\t\t<div className=\"flex items-center gap-2 mb-2\">\n\t\t\t\t\t\t<div className=\"rounded-full bg-orange-100 dark:bg-orange-900/20 p-2\">\n\t\t\t\t\t\t\t<Shield className=\"h-5 w-5 text-orange-600\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<DialogTitle>Support Access Request</DialogTitle>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogDescription>A support team member is requesting access to your account to assist you.</DialogDescription>\n\t\t\t\t</DialogHeader>\n\n\t\t\t\t<div className=\"space-y-4 py-4\">\n\t\t\t\t\t{/* Admin Info */}\n\t\t\t\t\t<div className=\"rounded-lg border bg-muted/50 p-4 space-y-3\">\n\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<User className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t<span className=\"text-sm font-medium\">Support Representative</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">{session.admin_name || session.admin_email || session.admin_user_id}</p>\n\n\t\t\t\t\t\t{session.ticket_id && (\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 pt-2 border-t\">\n\t\t\t\t\t\t\t\t<Ticket className=\"h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t<span className=\"text-sm\">\n\t\t\t\t\t\t\t\t\tTicket: <span className=\"font-mono\">{session.ticket_id}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Reason */}\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<label className=\"text-sm font-medium\">Reason for Access</label>\n\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground rounded-md border p-3 bg-muted/30\">{session.reason}</p>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Permissions */}\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<label className=\"text-sm font-medium\">Requested Permissions</label>\n\t\t\t\t\t\t<div className=\"space-y-1\">\n\t\t\t\t\t\t\t{session.requested_permissions.map((permission) => (\n\t\t\t\t\t\t\t\t<div key={permission} className=\"flex items-center gap-2 text-sm\">\n\t\t\t\t\t\t\t\t\t<div className=\"h-1.5 w-1.5 rounded-full bg-orange-500\" />\n\t\t\t\t\t\t\t\t\t<span>{permissionLabels[permission] || permission}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Duration Selector */}\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<label className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Clock className=\"h-4 w-4\" />\n\t\t\t\t\t\t\tAccess Duration\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<Select value={duration} onValueChange={setDuration}>\n\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t<SelectItem value=\"30\">30 minutes</SelectItem>\n\t\t\t\t\t\t\t\t<SelectItem value=\"60\">1 hour (recommended)</SelectItem>\n\t\t\t\t\t\t\t\t<SelectItem value=\"120\">2 hours</SelectItem>\n\t\t\t\t\t\t\t\t<SelectItem value=\"240\">4 hours</SelectItem>\n\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Support access will automatically expire after this time.</p>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Security Notice */}\n\t\t\t\t\t<div className=\"rounded-lg border border-orange-200 dark:border-orange-800 bg-orange-50 dark:bg-orange-950/20 p-3 space-y-1\">\n\t\t\t\t\t\t<div className=\"flex items-start gap-2\">\n\t\t\t\t\t\t\t<AlertCircle className=\"h-4 w-4 text-orange-600 mt-0.5 flex-shrink-0\" />\n\t\t\t\t\t\t\t<div className=\"space-y-1\">\n\t\t\t\t\t\t\t\t<p className=\"text-xs font-medium text-orange-900 dark:text-orange-100\">Security Notice</p>\n\t\t\t\t\t\t\t\t<p className=\"text-xs text-orange-800 dark:text-orange-200\">All actions taken by support will be logged and visible in your account audit trail.</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<DialogFooter className=\"flex-col sm:flex-row gap-2\">\n\t\t\t\t\t<Button type=\"button\" variant=\"outline\" onClick={handleReject} disabled={isApproving || isRejecting} className=\"w-full sm:w-auto\">\n\t\t\t\t\t\t{isRejecting ? \"Denying...\" : \"Deny Access\"}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button type=\"button\" onClick={handleApprove} disabled={isApproving || isRejecting} className=\"w-full sm:w-auto bg-orange-600 hover:bg-orange-700\">\n\t\t\t\t\t\t{isApproving ? \"Approving...\" : `Approve for ${duration === \"60\" ? \"1 hour\" : duration === \"30\" ? \"30 min\" : duration === \"120\" ? \"2 hours\" : \"4 hours\"}`}\n\t\t\t\t\t</Button>\n\t\t\t\t</DialogFooter>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"602e89ae7ace85fc30cd3b4b1dd865d517c0cb1cd5\":\"approveSupportSessionRequest\"},\"apps/web/src/actions/support-sessions.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var approveSupportSessionRequest=/*#__PURE__*/createServerReference(\"602e89ae7ace85fc30cd3b4b1dd865d517c0cb1cd5\",callServer,void 0,findSourceMapURL,\"approveSupportSessionRequest\");","/* __next_internal_action_entry_do_not_use__ [{\"60886af124323873afd4d5b64bb4143abbcba2c154\":\"rejectSupportSessionRequest\"},\"apps/web/src/actions/support-sessions.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var rejectSupportSessionRequest=/*#__PURE__*/createServerReference(\"60886af124323873afd4d5b64bb4143abbcba2c154\",callServer,void 0,findSourceMapURL,\"rejectSupportSessionRequest\");","\"use client\";\n\n/**\n * Active Support Session Banner\n *\n * Displays at the top of the page when support is viewing the account.\n * Shows who's viewing, time remaining, and option to end access.\n */\n\nimport { useState, useEffect } from \"react\";\nimport { Shield, X, Clock, ExternalLink } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { endActiveSupportSession } from \"@/actions/support-sessions\";\nimport { toast } from \"sonner\";\nimport Link from \"next/link\";\n\ninterface ActiveSession {\n\tid: string;\n\tadmin_user_id: string;\n\tticket_id: string | null;\n\treason: string;\n\tapproved_at: string;\n\texpires_at: string;\n\tadmin_name?: string;\n\tadmin_email?: string;\n}\n\ninterface ActiveSessionBannerProps {\n\tsession: ActiveSession;\n\tonSessionEnded?: () => void;\n}\n\nexport function ActiveSessionBanner({ session, onSessionEnded }: ActiveSessionBannerProps) {\n\tconst [timeRemaining, setTimeRemaining] = useState(\"\");\n\tconst [isEnding, setIsEnding] = useState(false);\n\tconst [isExpired, setIsExpired] = useState(false);\n\n\t// Calculate time remaining\n\tuseEffect(() => {\n\t\tconst updateTimer = () => {\n\t\t\tconst now = new Date();\n\t\t\tconst expiresAt = new Date(session.expires_at);\n\t\t\tconst diff = expiresAt.getTime() - now.getTime();\n\n\t\t\tif (diff <= 0) {\n\t\t\t\tsetTimeRemaining(\"Expired\");\n\t\t\t\tsetIsExpired(true);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst minutes = Math.floor(diff / 1000 / 60);\n\t\t\tconst seconds = Math.floor((diff / 1000) % 60);\n\n\t\t\tif (minutes > 0) {\n\t\t\t\tsetTimeRemaining(`${minutes}:${seconds.toString().padStart(2, \"0\")}`);\n\t\t\t} else {\n\t\t\t\tsetTimeRemaining(`${seconds}s`);\n\t\t\t}\n\t\t};\n\n\t\tupdateTimer();\n\t\tconst interval = setInterval(updateTimer, 1000);\n\n\t\treturn () => clearInterval(interval);\n\t}, [session.expires_at]);\n\n\tconst handleEndSession = async () => {\n\t\tif (!confirm(\"Are you sure you want to end support access?\")) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsEnding(true);\n\t\ttry {\n\t\t\tconst result = await endActiveSupportSession(session.id);\n\n\t\t\tif (result.success) {\n\t\t\t\ttoast.success(\"Support access ended\");\n\t\t\t\tonSessionEnded?.();\n\t\t\t} else {\n\t\t\t\ttoast.error(\"Failed to end access\", {\n\t\t\t\t\tdescription: result.error,\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (error) {\n\t\t\ttoast.error(\"Error ending support access\");\n\t\t\tconsole.error(error);\n\t\t} finally {\n\t\t\tsetIsEnding(false);\n\t\t}\n\t};\n\n\t// Don't show if expired\n\tif (isExpired) {\n\t\treturn null;\n\t}\n\n\t// Get timer color based on time remaining\n\tconst getTimerColor = () => {\n\t\tconst now = new Date();\n\t\tconst expiresAt = new Date(session.expires_at);\n\t\tconst minutesLeft = (expiresAt.getTime() - now.getTime()) / 1000 / 60;\n\n\t\tif (minutesLeft <= 5) return \"text-red-600 dark:text-red-400\";\n\t\tif (minutesLeft <= 10) return \"text-yellow-600 dark:text-yellow-400\";\n\t\treturn \"text-green-600 dark:text-green-400\";\n\t};\n\n\treturn (\n\t\t<div className=\"fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-orange-500 to-orange-600 dark:from-orange-600 dark:to-orange-700 text-white shadow-lg\">\n\t\t\t<div className=\"container mx-auto px-4 py-2\">\n\t\t\t\t<div className=\"flex items-center justify-between gap-4\">\n\t\t\t\t\t{/* Left: Support viewing info */}\n\t\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t\t<div className=\"rounded-full bg-white/20 p-1.5\">\n\t\t\t\t\t\t\t<Shield className=\"h-4 w-4\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-sm\">\n\t\t\t\t\t\t\t<span className=\"font-medium\">Support Access Active</span>\n\t\t\t\t\t\t\t<span className=\"opacity-90\">•</span>\n\t\t\t\t\t\t\t<span className=\"opacity-90\">{session.admin_name || session.admin_email || \"Support Team\"}</span>\n\t\t\t\t\t\t\t{session.ticket_id && (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<span className=\"opacity-90\">•</span>\n\t\t\t\t\t\t\t\t\t<span className=\"opacity-90\">Ticket: {session.ticket_id}</span>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Right: Timer and actions */}\n\t\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t\t{/* Timer */}\n\t\t\t\t\t\t<div className=\"flex items-center gap-1.5 text-sm\">\n\t\t\t\t\t\t\t<Clock className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t<span className={`font-mono font-medium ${getTimerColor()}`}>{timeRemaining}</span>\n\t\t\t\t\t\t\t<span className=\"opacity-90 text-xs\">remaining</span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* View Activity Link */}\n\t\t\t\t\t\t<Link href=\"/dashboard/settings/support-activity\" className=\"hidden sm:flex\">\n\t\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" className=\"h-7 gap-1.5 text-white hover:bg-white/20\">\n\t\t\t\t\t\t\t\t<ExternalLink className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t<span className=\"text-xs\">View Activity</span>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</Link>\n\n\t\t\t\t\t\t{/* End Access Button */}\n\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" onClick={handleEndSession} disabled={isEnding} className=\"h-7 gap-1.5 text-white hover:bg-white/20 border border-white/30\">\n\t\t\t\t\t\t\t<X className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t<span className=\"text-xs\">{isEnding ? \"Ending...\" : \"End Access\"}</span>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"40369e8ea4eced7bdaef8203d369469ee7b630db8c\":\"endActiveSupportSession\"},\"apps/web/src/actions/support-sessions.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var endActiveSupportSession=/*#__PURE__*/createServerReference(\"40369e8ea4eced7bdaef8203d369469ee7b630db8c\",callServer,void 0,findSourceMapURL,\"endActiveSupportSession\");","\"use client\";\n\n/**\n * Support Action Notifier\n *\n * Polls for new support actions during active sessions and shows toast notifications.\n * Keeps customers informed of what support is doing in real-time.\n */\n\nimport { useEffect, useRef } from \"react\";\nimport { toast } from \"sonner\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { Edit, DollarSign, Users, FileText, Briefcase, Shield } from \"lucide-react\";\n\ninterface SupportAction {\n\tid: string;\n\taction: string;\n\tresource_type: string;\n\tresource_id: string;\n\treason: string | null;\n\tcreated_at: string;\n\tsession_id: string;\n}\n\nconst POLL_INTERVAL = 10000; // 10 seconds\n\nexport function SupportActionNotifier() {\n\tconst lastCheckedRef = useRef<string | null>(null);\n\tconst isCheckingRef = useRef(false);\n\n\tuseEffect(() => {\n\t\tconst checkForNewActions = async () => {\n\t\t\t// Prevent concurrent checks\n\t\t\tif (isCheckingRef.current) return;\n\t\t\tisCheckingRef.current = true;\n\n\t\t\ttry {\n\t\t\t\tconst supabase = createClient();\n\n\t\t\t\t// Get current user's company\n\t\t\t\tconst {\n\t\t\t\t\tdata: { user },\n\t\t\t\t} = await supabase.auth.getUser();\n\t\t\t\tif (!user) return;\n\n\t\t\t\tconst { data: teamMember } = await supabase.from(\"team_members\").select(\"company_id\").eq(\"user_id\", user.id).single();\n\t\t\t\tif (!teamMember) return;\n\n\t\t\t\t// Get active sessions for this company\n\t\t\t\tconst { data: activeSessions } = await supabase.from(\"support_sessions\").select(\"id\").eq(\"company_id\", teamMember.company_id).eq(\"status\", \"active\");\n\n\t\t\t\tif (!activeSessions || activeSessions.length === 0) return;\n\n\t\t\t\tconst sessionIds = activeSessions.map((s) => s.id);\n\n\t\t\t\t// Query for new actions since last check\n\t\t\t\tlet query = supabase.from(\"support_session_actions\").select(\"id, action, resource_type, resource_id, reason, created_at, session_id\").in(\"session_id\", sessionIds).order(\"created_at\", { ascending: false }).limit(10);\n\n\t\t\t\t// If we've checked before, only get actions after the last check\n\t\t\t\tif (lastCheckedRef.current) {\n\t\t\t\t\tquery = query.gt(\"created_at\", lastCheckedRef.current);\n\t\t\t\t}\n\n\t\t\t\tconst { data: newActions } = await query;\n\n\t\t\t\tif (newActions && newActions.length > 0) {\n\t\t\t\t\t// Update last checked timestamp\n\t\t\t\t\tlastCheckedRef.current = newActions[0].created_at;\n\n\t\t\t\t\t// Show toast for each new action (most recent first)\n\t\t\t\t\tnewActions.reverse().forEach((action) => {\n\t\t\t\t\t\tshowActionNotification(action);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Error checking for support actions:\", error);\n\t\t\t} finally {\n\t\t\t\tisCheckingRef.current = false;\n\t\t\t}\n\t\t};\n\n\t\t// Initial check\n\t\tcheckForNewActions();\n\n\t\t// Set up polling\n\t\tconst interval = setInterval(checkForNewActions, POLL_INTERVAL);\n\n\t\treturn () => clearInterval(interval);\n\t}, []);\n\n\treturn null; // This component doesn't render anything\n}\n\nfunction showActionNotification(action: SupportAction) {\n\tconst icon = getActionIcon(action.resource_type);\n\tconst message = getActionMessage(action);\n\n\ttoast.info(message, {\n\t\tdescription: action.reason || \"Support action performed\",\n\t\ticon: icon,\n\t\tduration: 8000, // 8 seconds\n\t\taction: {\n\t\t\tlabel: \"View Activity\",\n\t\t\tonClick: () => {\n\t\t\t\twindow.location.href = \"/dashboard/settings/support-activity\";\n\t\t\t},\n\t\t},\n\t});\n}\n\nfunction getActionIcon(resourceType: string) {\n\tswitch (resourceType) {\n\t\tcase \"payment\":\n\t\t\treturn <DollarSign className=\"h-4 w-4\" />;\n\t\tcase \"invoice\":\n\t\t\treturn <FileText className=\"h-4 w-4\" />;\n\t\tcase \"job\":\n\t\t\treturn <Briefcase className=\"h-4 w-4\" />;\n\t\tcase \"team\":\n\t\t\treturn <Users className=\"h-4 w-4\" />;\n\t\tdefault:\n\t\t\treturn <Shield className=\"h-4 w-4\" />;\n\t}\n}\n\nfunction getActionMessage(action: SupportAction): string {\n\tconst resourceLabel = action.resource_type.charAt(0).toUpperCase() + action.resource_type.slice(1);\n\tconst actionLabel = action.action.replace(/_/g, \" \").toLowerCase();\n\tconst resourceId = action.resource_id.slice(0, 8);\n\n\treturn `Support ${actionLabel} on ${resourceLabel} (${resourceId}...)`;\n}\n"],"names":[],"mappings":"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"}