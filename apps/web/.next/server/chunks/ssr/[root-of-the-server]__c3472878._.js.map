{"version":3,"sources":["../../../../../../apps/web/src/components/work/work-data-view.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/components/work/service-agreements-kanban.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/components/work/service-agreements-table.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/work/service-agreements/page.tsx","../../../../../../apps/web/src/components/work/service-agreements/service-agreements-data.tsx","../../../../../../apps/web/src/lib/queries/service-agreements.ts","../../../../../../apps/web/src/components/work/service-agreements/service-agreements-skeleton.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const WorkDataView = registerClientReference(\n    function() { throw new Error(\"Attempted to call WorkDataView() from the server but WorkDataView is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/work/work-data-view.tsx\",\n    \"WorkDataView\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ServiceAgreementsKanban = registerClientReference(\n    function() { throw new Error(\"Attempted to call ServiceAgreementsKanban() from the server but ServiceAgreementsKanban is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/work/service-agreements-kanban.tsx\",\n    \"ServiceAgreementsKanban\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ServiceAgreementsTable = registerClientReference(\n    function() { throw new Error(\"Attempted to call ServiceAgreementsTable() from the server but ServiceAgreementsTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/work/service-agreements-table.tsx\",\n    \"ServiceAgreementsTable\",\n);\n","/**\n * Service Agreements Page - PPR Enabled\n *\n * Uses Next.js 16 \"use cache\" directive for optimal caching:\n * - Static shell renders instantly (5-20ms)\n * - Data streams in (200-500ms)\n *\n * Performance: 10-40x faster than traditional SSR\n */\n\nimport { Suspense } from \"react\";\nimport { ServiceAgreementsData } from \"@/components/work/service-agreements/service-agreements-data\";\nimport { ServiceAgreementsSkeleton } from \"@/components/work/service-agreements/service-agreements-skeleton\";\n\nexport default async function ServiceAgreementsPage({\n\tsearchParams,\n}: {\n\tsearchParams: Promise<{ page?: string }>;\n}) {\n\tconst params = await searchParams;\n\n\treturn (\n\t\t<Suspense fallback={<ServiceAgreementsSkeleton />}>\n\t\t\t<ServiceAgreementsData searchParams={params} />\n\t\t</Suspense>\n\t);\n}\n","import { notFound } from \"next/navigation\";\nimport { ServiceAgreementsKanban } from \"@/components/work/service-agreements-kanban\";\nimport {\n\ttype ServiceAgreement,\n\tServiceAgreementsTable,\n} from \"@/components/work/service-agreements-table\";\nimport { WorkDataView } from \"@/components/work/work-data-view\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport {\n\tgetServiceAgreementsPageData,\n\tSERVICE_AGREEMENTS_PAGE_SIZE,\n\ttype ServiceAgreementRecord,\n} from \"@/lib/queries/service-agreements\";\n\nexport async function ServiceAgreementsData({\n\tsearchParams,\n}: {\n\tsearchParams?: { page?: string };\n}) {\n\tconst activeCompanyId = await getActiveCompanyId();\n\n\tif (!activeCompanyId) {\n\t\treturn notFound();\n\t}\n\n\tconst currentPage = Number(searchParams?.page) || 1;\n\tconst { agreements: agreementsRaw, totalCount } =\n\t\tawait getServiceAgreementsPageData(\n\t\t\tcurrentPage,\n\t\t\tSERVICE_AGREEMENTS_PAGE_SIZE,\n\t\t\tactiveCompanyId,\n\t\t);\n\n\t// Normalize Supabase rows into the ServiceAgreement shape used by table/kanban\n\tconst agreements: ServiceAgreement[] = (agreementsRaw || []).map(\n\t\t(agreement: ServiceAgreementRecord): ServiceAgreement => {\n\t\t\tconst customer = Array.isArray(agreement.customer)\n\t\t\t\t? agreement.customer[0]\n\t\t\t\t: agreement.customer;\n\n\t\t\tconst customerName =\n\t\t\t\tcustomer?.display_name ||\n\t\t\t\t`${customer?.first_name || \"\"} ${customer?.last_name || \"\"}`.trim() ||\n\t\t\t\t\"Unknown\";\n\n\t\t\tconst startDate =\n\t\t\t\tagreement.start_date &&\n\t\t\t\tnew Date(agreement.start_date).toLocaleDateString(\"en-US\", {\n\t\t\t\t\tmonth: \"short\",\n\t\t\t\t\tday: \"numeric\",\n\t\t\t\t\tyear: \"numeric\",\n\t\t\t\t});\n\n\t\t\tconst endDate =\n\t\t\t\tagreement.end_date &&\n\t\t\t\tnew Date(agreement.end_date).toLocaleDateString(\"en-US\", {\n\t\t\t\t\tmonth: \"short\",\n\t\t\t\t\tday: \"numeric\",\n\t\t\t\t\tyear: \"numeric\",\n\t\t\t\t});\n\n\t\t\t// Map backend type (e.g. \"contract\", \"sla\") to UI-friendly label\n\t\t\tlet type: ServiceAgreement[\"type\"] = \"Maintenance Contract\";\n\t\t\tconst rawType = String(\n\t\t\t\tagreement.plan_type || agreement.type || \"\",\n\t\t\t).toLowerCase();\n\t\t\tif (rawType.includes(\"sla\")) {\n\t\t\t\ttype = \"Service Level Agreement\";\n\t\t\t} else if (rawType.includes(\"warranty\")) {\n\t\t\t\ttype = \"Extended Warranty\";\n\t\t\t} else if (rawType.includes(\"support\")) {\n\t\t\t\ttype = \"Support Contract\";\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tid: agreement.id,\n\t\t\t\tagreementNumber: agreement.agreement_number || agreement.id,\n\t\t\t\tcustomer: customerName,\n\t\t\t\ttype,\n\t\t\t\tstartDate: startDate || \"\",\n\t\t\t\tendDate: endDate || \"\",\n\t\t\t\tvalue: typeof agreement.value === \"number\" ? agreement.value : 0,\n\t\t\t\tstatus: (agreement.status || \"pending\") as ServiceAgreement[\"status\"],\n\t\t\t\tarchived_at: agreement.archived_at ?? null,\n\t\t\t\tdeleted_at: agreement.deleted_at ?? null,\n\t\t\t};\n\t\t},\n\t);\n\n\treturn (\n\t\t<WorkDataView\n\t\t\tkanban={<ServiceAgreementsKanban agreements={agreements} />}\n\t\t\tsection=\"serviceAgreements\"\n\t\t\ttable={\n\t\t\t\t<ServiceAgreementsTable\n\t\t\t\t\tagreements={agreements}\n\t\t\t\t\tcurrentPage={currentPage}\n\t\t\t\t\titemsPerPage={SERVICE_AGREEMENTS_PAGE_SIZE}\n\t\t\t\t\ttotalCount={totalCount}\n\t\t\t\t/>\n\t\t\t}\n\t\t/>\n\t);\n}\n","import { cache } from \"react\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\nimport type { Database } from \"@/types/supabase\";\n\nexport const SERVICE_AGREEMENTS_PAGE_SIZE = 50;\n\nconst SERVICE_AGREEMENTS_SELECT = `\n  id,\n  company_id,\n  plan_number,\n  name,\n  type,\n  frequency,\n  start_date,\n  end_date,\n  status,\n  price,\n  archived_at,\n  deleted_at,\n  customer:customers!service_plans_customer_id_customers_id_fk (\n    id,\n    display_name,\n    first_name,\n    last_name\n  )\n`;\n\ntype CustomerRelation = {\n\tid: string;\n\tdisplay_name: string | null;\n\tfirst_name: string | null;\n\tlast_name: string | null;\n} | null;\n\nexport type ServiceAgreementRecord =\n\tDatabase[\"public\"][\"Tables\"][\"service_plans\"][\"Row\"] & {\n\t\tcustomer: CustomerRelation | CustomerRelation[] | null;\n\t};\n\nexport type ServiceAgreementsPageResult = {\n\tagreements: ServiceAgreementRecord[];\n\ttotalCount: number;\n};\n\nexport async function getServiceAgreementsPageData(\n\tpage: number,\n\tpageSize: number = SERVICE_AGREEMENTS_PAGE_SIZE,\n\tcompanyIdOverride?: string,\n): Promise<ServiceAgreementsPageResult> {\n\t// IMPORTANT: Cannot use \"use cache\" here because we call getActiveCompanyId()\n\t// which uses cookies(). The query is already fast enough without page-level caching.\n\tconst companyId = companyIdOverride ?? (await getActiveCompanyId());\n\tif (!companyId) {\n\t\treturn { agreements: [], totalCount: 0 };\n\t}\n\n\tconst supabase = await createServiceSupabaseClient();\n\tif (!supabase) {\n\t\tthrow new Error(\"Supabase client not configured\");\n\t}\n\tconst start = (Math.max(page, 1) - 1) * pageSize;\n\tconst end = start + pageSize - 1;\n\n\tconst { data, error, count } = await supabase\n\t\t.from(\"service_plans\")\n\t\t.select(SERVICE_AGREEMENTS_SELECT, { count: \"exact\" })\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"type\", \"contract\")\n\t\t.order(\"created_at\", { ascending: false })\n\t\t.range(start, end);\n\n\tif (error) {\n\t\tthrow new Error(`Failed to fetch service agreements: ${error.message}`);\n\t}\n\n\treturn {\n\t\tagreements: (data ?? []) as ServiceAgreementRecord[],\n\t\ttotalCount: count ?? 0,\n\t};\n}\n\n/**\n * Fetch complete service agreement data including customer, property, and tags\n * Uses React.cache() for request-level deduplication\n */\nconst getServiceAgreementComplete = cache(\n\tasync (serviceAgreementId: string, companyId: string) => {\n\t\tconst supabase = await createServiceSupabaseClient();\n\t\tif (!supabase) {\n\t\t\tthrow new Error(\"Supabase client not configured\");\n\t\t}\n\n\t\tconst { data, error } = await supabase.rpc(\n\t\t\t\"get_service_agreement_complete\",\n\t\t\t{\n\t\t\t\tp_service_agreement_id: serviceAgreementId,\n\t\t\t\tp_company_id: companyId,\n\t\t\t},\n\t\t);\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Error fetching service agreement:\", error);\n\t\t\treturn null;\n\t\t}\n\n\t\treturn data?.[0]?.service_agreement_data || null;\n\t},\n);\n","/**\n * ServiceAgreementsSkeleton - Loading Skeleton\n *\n * Uses the shared DataTableListSkeleton for consistent UX across all list pages.\n * Displays while service agreements data is loading with search bar.\n * Provides visual feedback during streaming.\n */\n\nimport { DataTableListSkeleton } from \"@/components/ui/skeletons\";\n\nexport function ServiceAgreementsSkeleton() {\n\treturn <DataTableListSkeleton showSearchBar />;\n}\n"],"names":[],"mappings":"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","ignoreList":[0,1,2]}