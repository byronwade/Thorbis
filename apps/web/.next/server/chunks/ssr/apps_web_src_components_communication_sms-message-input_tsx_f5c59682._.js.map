{"version":3,"sources":["../../../../../../apps/web/src/components/communication/sms-message-input.tsx"],"sourcesContent":["/**\n * SMS Message Input Component\n *\n * iPhone-style message input with consolidated attachment menu,\n * inline emoji picker, and SMS segment counter\n */\n\n\"use client\";\n\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { cn } from \"@/lib/utils\";\nimport {\n\tArrowUp,\n\tCamera,\n\tFileText,\n\tImageIcon,\n\tLoader2,\n\tMessageSquareText,\n\tPlus,\n\tSmile,\n\tX,\n} from \"lucide-react\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\n\n// =============================================================================\n// QUICK REPLY TEMPLATES - Builder Functions with Smart Defaults\n// =============================================================================\n\ntype TemplateContext = {\n\tcustomerFirstName?: string;\n\tcustomerName?: string;\n\tcompanyName?: string;\n\tcompanyPhone?: string;\n\ttechnicianName?: string;\n\tappointmentDate?: string;\n\tappointmentTime?: string;\n\tinvoiceNumber?: string;\n\tamount?: string;\n};\n\ntype SmsTemplate = {\n\tid: string;\n\tlabel: string;\n\tpreview: string;\n\tbuild: (ctx: TemplateContext) => string;\n};\n\nconst SMS_TEMPLATES: SmsTemplate[] = [\n\t{\n\t\tid: \"appointment-reminder\",\n\t\tlabel: \"Appointment Reminder\",\n\t\tpreview: \"Reminder about upcoming appointment\",\n\t\tbuild: (ctx) => {\n\t\t\tconst name = ctx.customerFirstName || \"there\";\n\t\t\tconst dateTime = ctx.appointmentDate && ctx.appointmentTime\n\t\t\t\t? `on ${ctx.appointmentDate} at ${ctx.appointmentTime}`\n\t\t\t\t: ctx.appointmentDate\n\t\t\t\t\t? `on ${ctx.appointmentDate}`\n\t\t\t\t\t: \"for your upcoming appointment\";\n\t\t\treturn `Hi ${name}, this is a reminder about your appointment ${dateTime}. Reply CONFIRM to confirm or call us to reschedule.`;\n\t\t},\n\t},\n\t{\n\t\tid: \"on-the-way\",\n\t\tlabel: \"On The Way\",\n\t\tpreview: \"Technician en route notification\",\n\t\tbuild: (ctx) => {\n\t\t\tconst name = ctx.customerFirstName || \"there\";\n\t\t\tconst tech = ctx.technicianName || \"Our technician\";\n\t\t\treturn `Hi ${name}, ${tech} is on the way and should arrive shortly.`;\n\t\t},\n\t},\n\t{\n\t\tid: \"running-late\",\n\t\tlabel: \"Running Late\",\n\t\tpreview: \"Apology for delay\",\n\t\tbuild: (ctx) => {\n\t\t\tconst name = ctx.customerFirstName || \"there\";\n\t\t\treturn `Hi ${name}, we apologize but our technician is running a bit behind schedule. We'll update you when they're on the way.`;\n\t\t},\n\t},\n\t{\n\t\tid: \"job-complete\",\n\t\tlabel: \"Job Complete\",\n\t\tpreview: \"Work completed notification\",\n\t\tbuild: (ctx) => {\n\t\t\tconst name = ctx.customerFirstName || \"there\";\n\t\t\tconst company = ctx.companyName ? `choosing ${ctx.companyName}` : \"your business\";\n\t\t\treturn `Hi ${name}, the work has been completed. If you have any questions, please don't hesitate to reach out. Thank you for ${company}!`;\n\t\t},\n\t},\n\t{\n\t\tid: \"payment-reminder\",\n\t\tlabel: \"Payment Reminder\",\n\t\tpreview: \"Friendly payment reminder\",\n\t\tbuild: (ctx) => {\n\t\t\tconst name = ctx.customerFirstName || \"there\";\n\t\t\tconst invoiceInfo = ctx.invoiceNumber && ctx.amount\n\t\t\t\t? `invoice #${ctx.invoiceNumber} for $${ctx.amount}`\n\t\t\t\t: ctx.invoiceNumber\n\t\t\t\t\t? `invoice #${ctx.invoiceNumber}`\n\t\t\t\t\t: \"your outstanding invoice\";\n\t\t\treturn `Hi ${name}, this is a friendly reminder that ${invoiceInfo} is due. Please let us know if you have any questions.`;\n\t\t},\n\t},\n\t{\n\t\tid: \"follow-up\",\n\t\tlabel: \"Follow Up\",\n\t\tpreview: \"Service follow-up request\",\n\t\tbuild: (ctx) => {\n\t\t\tconst name = ctx.customerFirstName || \"there\";\n\t\t\treturn `Hi ${name}, just following up on our recent service. Is everything working well? We'd love to hear your feedback!`;\n\t\t},\n\t},\n\t{\n\t\tid: \"thank-you\",\n\t\tlabel: \"Thank You\",\n\t\tpreview: \"Thank you message\",\n\t\tbuild: (ctx) => {\n\t\t\tconst company = ctx.companyName ? `choosing ${ctx.companyName}` : \"your business\";\n\t\t\treturn `Thank you for ${company}! We appreciate your trust in us. If you have a moment, we'd love a review!`;\n\t\t},\n\t},\n\t{\n\t\tid: \"reschedule\",\n\t\tlabel: \"Reschedule Request\",\n\t\tpreview: \"Reschedule appointment request\",\n\t\tbuild: (ctx) => {\n\t\t\tconst name = ctx.customerFirstName || \"there\";\n\t\t\tconst contact = ctx.companyPhone ? `, or call us at ${ctx.companyPhone}` : \"\";\n\t\t\treturn `Hi ${name}, we need to reschedule your appointment. Please reply with a date and time that works for you${contact}.`;\n\t\t},\n\t},\n];\n\ntype Attachment = {\n\tid: string;\n\tfile: File;\n\tpreview?: string;\n\ttype: \"image\" | \"file\";\n};\n\ntype SmsMessageInputProps = {\n\tvalue: string;\n\tonChange: (value: string) => void;\n\tonSend: () => void;\n\tonAttach?: (files: File[]) => void;\n\tsending?: boolean;\n\tdisabled?: boolean;\n\tplaceholder?: string;\n\tshowSegmentCounter?: boolean;\n\t// Customer context (required for templates/merge fields to show)\n\tcustomerName?: string;\n\tcustomerFirstName?: string;\n\tcustomerId?: string;\n\t// Additional context for templates/AI\n\tjobType?: string;\n\tcompanyName?: string;\n\tcompanyPhone?: string;\n\ttechnicianName?: string;\n\tappointmentDate?: string;\n\tappointmentTime?: string;\n\tinvoiceNumber?: string;\n\tamount?: string;\n\t// AI autocomplete\n\tenableAiSuggestions?: boolean;\n};\n\n// SMS segment calculation (GSM-7 vs Unicode)\nconst SMS_SEGMENT_LENGTH_GSM = 160;\nconst SMS_SEGMENT_LENGTH_UNICODE = 70;\nconst SMS_CONCAT_LENGTH_GSM = 153; // When concatenated, headers take space\nconst SMS_CONCAT_LENGTH_UNICODE = 67;\n\nfunction isGSM7(text: string): boolean {\n\t// GSM-7 character set (basic Latin, numbers, common symbols)\n\tconst gsm7Regex =\n\t\t/^[@Â£$Â¥Ã¨Ã©Ã¹Ã¬Ã²Ã‡\\nÃ˜Ã¸\\rÃ…Ã¥Î”_Î¦Î“Î›Î©Î Î¨Î£Î˜Îž\\x1B !\"#Â¤%&'()*+,\\-./0-9:;<=>?Â¡A-ZÃ„Ã–Ã‘Ü§Â¿a-zÃ¤Ã¶Ã±Ã¼Ã ]*$/;\n\treturn gsm7Regex.test(text);\n}\n\nfunction calculateSegments(text: string): {\n\tsegments: number;\n\tcharsPerSegment: number;\n\tisUnicode: boolean;\n} {\n\tif (!text) return { segments: 0, charsPerSegment: 160, isUnicode: false };\n\n\tconst isUnicode = !isGSM7(text);\n\tconst singleLimit = isUnicode\n\t\t? SMS_SEGMENT_LENGTH_UNICODE\n\t\t: SMS_SEGMENT_LENGTH_GSM;\n\tconst concatLimit = isUnicode\n\t\t? SMS_CONCAT_LENGTH_UNICODE\n\t\t: SMS_CONCAT_LENGTH_GSM;\n\n\tif (text.length <= singleLimit) {\n\t\treturn { segments: 1, charsPerSegment: singleLimit, isUnicode };\n\t}\n\n\tconst segments = Math.ceil(text.length / concatLimit);\n\treturn { segments, charsPerSegment: concatLimit, isUnicode };\n}\n\n// Common emojis (iPhone Messages style)\nconst EMOJI_CATEGORIES = [\n\t{\n\t\tname: \"Frequently Used\",\n\t\temojis: [\n\t\t\t\"ðŸ˜€\",\n\t\t\t\"ðŸ˜‚\",\n\t\t\t\"ðŸ˜\",\n\t\t\t\"ðŸ¥°\",\n\t\t\t\"ðŸ˜˜\",\n\t\t\t\"ðŸ˜Š\",\n\t\t\t\"ðŸ˜‰\",\n\t\t\t\"ðŸ˜Ž\",\n\t\t\t\"ðŸ¤”\",\n\t\t\t\"ðŸ˜\",\n\t\t\t\"ðŸ˜’\",\n\t\t\t\"ðŸ™„\",\n\t\t\t\"ðŸ˜®\",\n\t\t\t\"ðŸ¤—\",\n\t\t\t\"ðŸ˜´\",\n\t\t\t\"ðŸ˜‹\",\n\t\t\t\"ðŸ˜\",\n\t\t\t\"ðŸ¤¤\",\n\t\t\t\"ðŸ˜ª\",\n\t\t\t\"ðŸ˜µ\",\n\t\t],\n\t},\n\t{\n\t\tname: \"Smileys & People\",\n\t\temojis: [\n\t\t\t\"ðŸ˜€\",\n\t\t\t\"ðŸ˜ƒ\",\n\t\t\t\"ðŸ˜„\",\n\t\t\t\"ðŸ˜\",\n\t\t\t\"ðŸ˜†\",\n\t\t\t\"ðŸ˜…\",\n\t\t\t\"ðŸ¤£\",\n\t\t\t\"ðŸ˜‚\",\n\t\t\t\"ðŸ™‚\",\n\t\t\t\"ðŸ™ƒ\",\n\t\t\t\"ðŸ˜‰\",\n\t\t\t\"ðŸ˜Š\",\n\t\t\t\"ðŸ˜‡\",\n\t\t\t\"ðŸ¥°\",\n\t\t\t\"ðŸ˜\",\n\t\t\t\"ðŸ¤©\",\n\t\t\t\"ðŸ˜˜\",\n\t\t\t\"ðŸ˜—\",\n\t\t\t\"ðŸ˜š\",\n\t\t\t\"ðŸ˜™\",\n\t\t\t\"ðŸ˜‹\",\n\t\t\t\"ðŸ˜›\",\n\t\t\t\"ðŸ˜œ\",\n\t\t\t\"ðŸ¤ª\",\n\t\t\t\"ðŸ˜\",\n\t\t\t\"ðŸ¤‘\",\n\t\t\t\"ðŸ¤—\",\n\t\t\t\"ðŸ¤­\",\n\t\t\t\"ðŸ¤«\",\n\t\t\t\"ðŸ¤”\",\n\t\t],\n\t},\n\t{\n\t\tname: \"Gestures\",\n\t\temojis: [\n\t\t\t\"ðŸ‘‹\",\n\t\t\t\"ðŸ¤š\",\n\t\t\t\"ðŸ–\",\n\t\t\t\"âœ‹\",\n\t\t\t\"ðŸ––\",\n\t\t\t\"ðŸ‘Œ\",\n\t\t\t\"ðŸ¤Œ\",\n\t\t\t\"ðŸ¤\",\n\t\t\t\"âœŒï¸\",\n\t\t\t\"ðŸ¤ž\",\n\t\t\t\"ðŸ¤Ÿ\",\n\t\t\t\"ðŸ¤˜\",\n\t\t\t\"ðŸ¤™\",\n\t\t\t\"ðŸ‘ˆ\",\n\t\t\t\"ðŸ‘‰\",\n\t\t\t\"ðŸ‘†\",\n\t\t\t\"ðŸ–•\",\n\t\t\t\"ðŸ‘‡\",\n\t\t\t\"â˜ï¸\",\n\t\t\t\"ðŸ‘\",\n\t\t],\n\t},\n\t{\n\t\tname: \"Objects\",\n\t\temojis: [\n\t\t\t\"ðŸ“±\",\n\t\t\t\"ðŸ’»\",\n\t\t\t\"âŒš\",\n\t\t\t\"ðŸ–¥\",\n\t\t\t\"âŒ¨ï¸\",\n\t\t\t\"ðŸ–±\",\n\t\t\t\"ðŸ–²\",\n\t\t\t\"ðŸ•¹\",\n\t\t\t\"ðŸ—œ\",\n\t\t\t\"ðŸ’¾\",\n\t\t\t\"ðŸ’¿\",\n\t\t\t\"ðŸ“€\",\n\t\t\t\"ðŸ“·\",\n\t\t\t\"ðŸ“¸\",\n\t\t\t\"ðŸ“¹\",\n\t\t\t\"ðŸŽ¥\",\n\t\t\t\"ðŸ“½\",\n\t\t\t\"ðŸŽž\",\n\t\t\t\"ðŸ“ž\",\n\t\t\t\"â˜Žï¸\",\n\t\t],\n\t},\n\t{\n\t\tname: \"Symbols\",\n\t\temojis: [\n\t\t\t\"â¤ï¸\",\n\t\t\t\"ðŸ§¡\",\n\t\t\t\"ðŸ’›\",\n\t\t\t\"ðŸ’š\",\n\t\t\t\"ðŸ’™\",\n\t\t\t\"ðŸ’œ\",\n\t\t\t\"ðŸ–¤\",\n\t\t\t\"ðŸ¤\",\n\t\t\t\"ðŸ¤Ž\",\n\t\t\t\"ðŸ’”\",\n\t\t\t\"â£ï¸\",\n\t\t\t\"ðŸ’•\",\n\t\t\t\"ðŸ’ž\",\n\t\t\t\"ðŸ’“\",\n\t\t\t\"ðŸ’—\",\n\t\t\t\"ðŸ’–\",\n\t\t\t\"ðŸ’˜\",\n\t\t\t\"ðŸ’\",\n\t\t\t\"ðŸ’Ÿ\",\n\t\t\t\"â˜®ï¸\",\n\t\t],\n\t},\n];\n\nexport function SmsMessageInput({\n\tvalue,\n\tonChange,\n\tonSend,\n\tonAttach,\n\tsending = false,\n\tdisabled = false,\n\tplaceholder = \"Text Message\",\n\tshowSegmentCounter = true,\n\tcustomerName,\n\tcustomerFirstName,\n\tcustomerId: _customerId, // Available for future AI context\n\tjobType,\n\tcompanyName,\n\tcompanyPhone,\n\ttechnicianName,\n\tappointmentDate,\n\tappointmentTime,\n\tinvoiceNumber,\n\tamount,\n\tenableAiSuggestions = false,\n}: SmsMessageInputProps) {\n\tconst [attachments, setAttachments] = useState<Attachment[]>([]);\n\tconst [showEmojiPicker, setShowEmojiPicker] = useState(false);\n\tconst [isFocused, setIsFocused] = useState(false);\n\tconst [aiSuggestion, setAiSuggestion] = useState<string>(\"\");\n\tconst [isLoadingSuggestion, setIsLoadingSuggestion] = useState(false);\n\tconst inputRef = useRef<HTMLDivElement>(null);\n\tconst fileInputRef = useRef<HTMLInputElement>(null);\n\tconst imageInputRef = useRef<HTMLInputElement>(null);\n\tconst suggestionTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n\t// Calculate SMS segments\n\tconst segmentInfo = calculateSegments(value);\n\tconst showCounter =\n\t\tshowSegmentCounter && value.length > 0 && (isFocused || value.length > 100);\n\n\t// Fetch AI suggestion (debounced)\n\tconst fetchAiSuggestion = useCallback(\n\t\tasync (text: string) => {\n\t\t\tif (!enableAiSuggestions || text.length < 3) {\n\t\t\t\tsetAiSuggestion(\"\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetIsLoadingSuggestion(true);\n\t\t\ttry {\n\t\t\t\tconst response = await fetch(\"/api/ai/chat\", {\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tmessages: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\trole: \"system\",\n\t\t\t\t\t\t\t\tcontent: `You are an SMS autocomplete assistant for a field service company. Complete the user's SMS message naturally and professionally.\nContext: ${customerName ? `Customer: ${customerName}` : \"\"} ${jobType ? `Job type: ${jobType}` : \"\"} ${companyName ? `Company: ${companyName}` : \"\"}\nIMPORTANT: Only return the completion text (what comes AFTER what the user typed). Keep it short (under 100 chars). No quotes or explanations.`,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\trole: \"user\",\n\t\t\t\t\t\t\t\tcontent: `Complete this SMS message: \"${text}\"`,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t\tmodel: \"claude-3-5-haiku-20241022\",\n\t\t\t\t\t\tmaxTokens: 100,\n\t\t\t\t\t}),\n\t\t\t\t});\n\n\t\t\t\tif (response.ok) {\n\t\t\t\t\tconst data = await response.json();\n\t\t\t\t\tconst suggestion = data.content || data.message || \"\";\n\t\t\t\t\t// Only show suggestion if it's a reasonable completion\n\t\t\t\t\tif (suggestion && suggestion.length > 0 && suggestion.length < 150) {\n\t\t\t\t\t\tsetAiSuggestion(suggestion.trim());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetAiSuggestion(\"\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"AI suggestion error:\", error);\n\t\t\t\tsetAiSuggestion(\"\");\n\t\t\t} finally {\n\t\t\t\tsetIsLoadingSuggestion(false);\n\t\t\t}\n\t\t},\n\t\t[enableAiSuggestions, customerName, jobType, companyName]\n\t);\n\n\t// Debounced AI suggestion effect\n\tuseEffect(() => {\n\t\t// Clear any pending timeout\n\t\tif (suggestionTimeoutRef.current) {\n\t\t\tclearTimeout(suggestionTimeoutRef.current);\n\t\t}\n\n\t\t// Clear suggestion if value changed (user is typing)\n\t\tsetAiSuggestion(\"\");\n\n\t\t// Don't fetch if disabled or text is too short\n\t\tif (!enableAiSuggestions || value.length < 5 || !isFocused) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Debounce the API call (500ms)\n\t\tsuggestionTimeoutRef.current = setTimeout(() => {\n\t\t\tfetchAiSuggestion(value);\n\t\t}, 500);\n\n\t\treturn () => {\n\t\t\tif (suggestionTimeoutRef.current) {\n\t\t\t\tclearTimeout(suggestionTimeoutRef.current);\n\t\t\t}\n\t\t};\n\t}, [value, enableAiSuggestions, isFocused, fetchAiSuggestion]);\n\n\t// Sync contenteditable with value prop (for external updates like clearing after send)\n\tuseEffect(() => {\n\t\tif (inputRef.current && inputRef.current.textContent !== value) {\n\t\t\tinputRef.current.textContent = value;\n\t\t}\n\t}, [value]);\n\n\tconst handleEmojiSelect = useCallback(\n\t\t(emoji: string) => {\n\t\t\tconst emojiWithSpace = emoji + \" \";\n\t\t\tconst input = inputRef.current;\n\t\t\tif (input) {\n\t\t\t\t// Insert emoji at cursor position or append\n\t\t\t\tconst selection = window.getSelection();\n\t\t\t\tif (selection && selection.rangeCount > 0) {\n\t\t\t\t\tconst range = selection.getRangeAt(0);\n\t\t\t\t\tif (input.contains(range.commonAncestorContainer)) {\n\t\t\t\t\t\trange.deleteContents();\n\t\t\t\t\t\tconst textNode = document.createTextNode(emojiWithSpace);\n\t\t\t\t\t\trange.insertNode(textNode);\n\n\t\t\t\t\t\t// Move cursor to end of inserted text\n\t\t\t\t\t\tconst newRange = document.createRange();\n\t\t\t\t\t\tnewRange.setStartAfter(textNode);\n\t\t\t\t\t\tnewRange.setEndAfter(textNode);\n\t\t\t\t\t\tselection.removeAllRanges();\n\t\t\t\t\t\tselection.addRange(newRange);\n\n\t\t\t\t\t\tonChange(input.textContent || \"\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tonChange(value + emojiWithSpace);\n\t\t\t\t\t\t// Move cursor to end after state update\n\t\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\t\tif (input) {\n\t\t\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t\t\t\tconst range = document.createRange();\n\t\t\t\t\t\t\t\trange.selectNodeContents(input);\n\t\t\t\t\t\t\t\trange.collapse(false);\n\t\t\t\t\t\t\t\tconst sel = window.getSelection();\n\t\t\t\t\t\t\t\tsel?.removeAllRanges();\n\t\t\t\t\t\t\t\tsel?.addRange(range);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tonChange(value + emojiWithSpace);\n\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\tif (input) {\n\t\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t\t\tconst range = document.createRange();\n\t\t\t\t\t\t\trange.selectNodeContents(input);\n\t\t\t\t\t\t\trange.collapse(false);\n\t\t\t\t\t\t\tconst sel = window.getSelection();\n\t\t\t\t\t\t\tsel?.removeAllRanges();\n\t\t\t\t\t\t\tsel?.addRange(range);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tinput.focus();\n\t\t\t} else {\n\t\t\t\tonChange(value + emojiWithSpace);\n\t\t\t}\n\t\t\tsetShowEmojiPicker(false);\n\t\t},\n\t\t[value, onChange]\n\t);\n\n\tconst handleFileSelect = useCallback(\n\t\t(files: FileList | null) => {\n\t\t\tif (!files || files.length === 0) return;\n\n\t\t\tconst newAttachments: Attachment[] = Array.from(files).map((file) => {\n\t\t\t\tconst attachment: Attachment = {\n\t\t\t\t\tid: `${Date.now()}-${Math.random()}`,\n\t\t\t\t\tfile,\n\t\t\t\t\ttype: file.type.startsWith(\"image/\") ? \"image\" : \"file\",\n\t\t\t\t};\n\n\t\t\t\t// Create preview for images\n\t\t\t\tif (attachment.type === \"image\") {\n\t\t\t\t\tattachment.preview = URL.createObjectURL(file);\n\t\t\t\t}\n\n\t\t\t\treturn attachment;\n\t\t\t});\n\n\t\t\tsetAttachments((prev) => [...prev, ...newAttachments]);\n\t\t\tif (onAttach) {\n\t\t\t\tonAttach(Array.from(files));\n\t\t\t}\n\t\t},\n\t\t[onAttach]\n\t);\n\n\tconst handleRemoveAttachment = useCallback((id: string) => {\n\t\tsetAttachments((prev) => {\n\t\t\tconst attachment = prev.find((a) => a.id === id);\n\t\t\tif (attachment?.preview) {\n\t\t\t\tURL.revokeObjectURL(attachment.preview);\n\t\t\t}\n\t\t\treturn prev.filter((a) => a.id !== id);\n\t\t});\n\t}, []);\n\n\tconst handleSend = useCallback(() => {\n\t\tif ((!value.trim() && attachments.length === 0) || sending || disabled)\n\t\t\treturn;\n\t\tonSend();\n\t\t// Clear attachments after sending\n\t\tattachments.forEach((att) => {\n\t\t\tif (att.preview) {\n\t\t\t\tURL.revokeObjectURL(att.preview);\n\t\t\t}\n\t\t});\n\t\tsetAttachments([]);\n\t}, [value, attachments, sending, disabled, onSend]);\n\n\tconst handleKeyDown = useCallback(\n\t\t(e: React.KeyboardEvent<HTMLDivElement>) => {\n\t\t\t// Tab to accept AI suggestion\n\t\t\tif (e.key === \"Tab\" && aiSuggestion) {\n\t\t\t\te.preventDefault();\n\t\t\t\tonChange(value + aiSuggestion);\n\t\t\t\tsetAiSuggestion(\"\");\n\t\t\t\t// Update the contenteditable\n\t\t\t\tif (inputRef.current) {\n\t\t\t\t\tinputRef.current.textContent = value + aiSuggestion;\n\t\t\t\t\t// Move cursor to end\n\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\tif (inputRef.current) {\n\t\t\t\t\t\t\tinputRef.current.focus();\n\t\t\t\t\t\t\tconst range = document.createRange();\n\t\t\t\t\t\t\trange.selectNodeContents(inputRef.current);\n\t\t\t\t\t\t\trange.collapse(false);\n\t\t\t\t\t\t\tconst sel = window.getSelection();\n\t\t\t\t\t\t\tsel?.removeAllRanges();\n\t\t\t\t\t\t\tsel?.addRange(range);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Escape to dismiss suggestion\n\t\t\tif (e.key === \"Escape\" && aiSuggestion) {\n\t\t\t\te.preventDefault();\n\t\t\t\tsetAiSuggestion(\"\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Enter to send, Shift+Enter for new line\n\t\t\tif (e.key === \"Enter\" && !e.shiftKey) {\n\t\t\t\te.preventDefault();\n\t\t\t\thandleSend();\n\t\t\t}\n\t\t\t// Cmd/Ctrl+Enter also sends\n\t\t\tif (e.key === \"Enter\" && (e.metaKey || e.ctrlKey)) {\n\t\t\t\te.preventDefault();\n\t\t\t\thandleSend();\n\t\t\t}\n\t\t},\n\t\t[handleSend, aiSuggestion, value, onChange]\n\t);\n\n\t// Handle paste - strip formatting and insert plain text\n\tconst handlePaste = useCallback(\n\t\t(e: React.ClipboardEvent<HTMLDivElement>) => {\n\t\t\te.preventDefault();\n\t\t\tconst text = e.clipboardData.getData(\"text/plain\");\n\t\t\tconst selection = window.getSelection();\n\t\t\tif (selection && selection.rangeCount > 0) {\n\t\t\t\tconst range = selection.getRangeAt(0);\n\t\t\t\trange.deleteContents();\n\t\t\t\tconst textNode = document.createTextNode(text);\n\t\t\t\trange.insertNode(textNode);\n\n\t\t\t\t// Move cursor to end of pasted text\n\t\t\t\tconst newRange = document.createRange();\n\t\t\t\tnewRange.setStartAfter(textNode);\n\t\t\t\tnewRange.setEndAfter(textNode);\n\t\t\t\tselection.removeAllRanges();\n\t\t\t\tselection.addRange(newRange);\n\n\t\t\t\tonChange(inputRef.current?.textContent || \"\");\n\t\t\t}\n\t\t},\n\t\t[onChange]\n\t);\n\n\t// Insert text at cursor position (for templates and merge fields)\n\tconst insertText = useCallback(\n\t\t(text: string, replace: boolean = false) => {\n\t\t\tconst input = inputRef.current;\n\t\t\tif (!input) {\n\t\t\t\tonChange(replace ? text : value + text);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (replace) {\n\t\t\t\t// Replace entire content\n\t\t\t\tonChange(text);\n\t\t\t\tinput.textContent = text;\n\t\t\t\t// Move cursor to end\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tinput.focus();\n\t\t\t\t\tconst range = document.createRange();\n\t\t\t\t\trange.selectNodeContents(input);\n\t\t\t\t\trange.collapse(false);\n\t\t\t\t\tconst sel = window.getSelection();\n\t\t\t\t\tsel?.removeAllRanges();\n\t\t\t\t\tsel?.addRange(range);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Insert at cursor position\n\t\t\t\tconst selection = window.getSelection();\n\t\t\t\tif (selection && selection.rangeCount > 0) {\n\t\t\t\t\tconst range = selection.getRangeAt(0);\n\t\t\t\t\tif (input.contains(range.commonAncestorContainer)) {\n\t\t\t\t\t\trange.deleteContents();\n\t\t\t\t\t\tconst textNode = document.createTextNode(text);\n\t\t\t\t\t\trange.insertNode(textNode);\n\n\t\t\t\t\t\tconst newRange = document.createRange();\n\t\t\t\t\t\tnewRange.setStartAfter(textNode);\n\t\t\t\t\t\tnewRange.setEndAfter(textNode);\n\t\t\t\t\t\tselection.removeAllRanges();\n\t\t\t\t\t\tselection.addRange(newRange);\n\n\t\t\t\t\t\tonChange(input.textContent || \"\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tonChange(value + text);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tonChange(value + text);\n\t\t\t\t}\n\t\t\t\tinput.focus();\n\t\t\t}\n\t\t},\n\t\t[value, onChange]\n\t);\n\n\t// Apply template with smart defaults - no more brackets!\n\tconst handleTemplateSelect = useCallback(\n\t\t(template: SmsTemplate) => {\n\t\t\t// Build template context from available props\n\t\t\tconst ctx: TemplateContext = {\n\t\t\t\tcustomerFirstName: customerFirstName || customerName?.split(\" \")[0],\n\t\t\t\tcustomerName,\n\t\t\t\tcompanyName,\n\t\t\t\tcompanyPhone,\n\t\t\t\ttechnicianName,\n\t\t\t\tappointmentDate,\n\t\t\t\tappointmentTime,\n\t\t\t\tinvoiceNumber,\n\t\t\t\tamount,\n\t\t\t};\n\n\t\t\t// Build the message with smart defaults\n\t\t\tconst text = template.build(ctx);\n\t\t\tinsertText(text, true);\n\t\t},\n\t\t[insertText, customerFirstName, customerName, companyName, companyPhone, technicianName, appointmentDate, appointmentTime, invoiceNumber, amount]\n\t);\n\n\treturn (\n\t\t<div className=\"bg-card border-t border-border/50\">\n\t\t\t{/* Segment Counter - Shows when typing */}\n\t\t\t{showCounter && (\n\t\t\t\t<div className=\"flex items-center justify-end gap-2 px-3 pt-2 pb-1\">\n\t\t\t\t\t<span className=\"text-[10px] text-muted-foreground\">\n\t\t\t\t\t\t{value.length} chars\n\t\t\t\t\t</span>\n\t\t\t\t\t<span className=\"text-[10px] text-muted-foreground\">Â·</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"text-[10px] font-medium\",\n\t\t\t\t\t\t\tsegmentInfo.segments > 1\n\t\t\t\t\t\t\t\t? \"text-amber-500\"\n\t\t\t\t\t\t\t\t: \"text-muted-foreground\"\n\t\t\t\t\t\t)}\n\t\t\t\t\t>\n\t\t\t\t\t\t{segmentInfo.segments} segment{segmentInfo.segments !== 1 ? \"s\" : \"\"}\n\t\t\t\t\t</span>\n\t\t\t\t\t{segmentInfo.isUnicode && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<span className=\"text-[10px] text-muted-foreground\">Â·</span>\n\t\t\t\t\t\t\t<span className=\"text-[10px] text-amber-500\">Unicode</span>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{/* Attachment Previews */}\n\t\t\t{attachments.length > 0 && (\n\t\t\t\t<div className=\"px-3 pt-2\">\n\t\t\t\t\t<ScrollArea className=\"w-full\">\n\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t{attachments.map((attachment) => (\n\t\t\t\t\t\t\t\t<div key={attachment.id} className=\"group relative shrink-0\">\n\t\t\t\t\t\t\t\t\t{attachment.type === \"image\" && attachment.preview ? (\n\t\t\t\t\t\t\t\t\t\t<div className=\"relative size-16 overflow-hidden rounded-xl border border-border\">\n\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\tsrc={attachment.preview}\n\t\t\t\t\t\t\t\t\t\t\t\talt={attachment.file.name}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"size-full object-cover\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"absolute right-0.5 top-0.5 size-5 rounded-full bg-black/60 p-0 opacity-0 transition-opacity hover:bg-black/80 group-hover:opacity-100\"\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleRemoveAttachment(attachment.id)}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<X className=\"size-3 text-white\" />\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<div className=\"relative flex size-16 items-center justify-center rounded-xl border border-border bg-muted\">\n\t\t\t\t\t\t\t\t\t\t\t<FileText className=\"size-5 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"absolute right-0.5 top-0.5 size-5 rounded-full bg-black/60 p-0 opacity-0 transition-opacity hover:bg-black/80 group-hover:opacity-100\"\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleRemoveAttachment(attachment.id)}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<X className=\"size-3 text-white\" />\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"absolute bottom-1 left-1 right-1 truncate text-[8px] text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t{attachment.file.name}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</ScrollArea>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{/* Input Area - iPhone style */}\n\t\t\t<div className=\"flex items-end gap-1.5 p-2 pb-safe\">\n\t\t\t\t{/* Plus Button - Attachment Menu */}\n\t\t\t\t<DropdownMenu>\n\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\tclassName=\"mb-0.5 size-10 md:size-8 shrink-0 rounded-full hover:bg-muted\"\n\t\t\t\t\t\t\tdisabled={disabled}\n\t\t\t\t\t\t\ttitle=\"Add attachment\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Plus className=\"size-6 md:size-5 text-muted-foreground\" />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t<DropdownMenuContent align=\"start\" side=\"top\" className=\"w-48\">\n\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\tonClick={() => imageInputRef.current?.click()}\n\t\t\t\t\t\t\tclassName=\"gap-2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Camera className=\"size-4\" />\n\t\t\t\t\t\t\t<span>Camera</span>\n\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t// Create temp input for photos only\n\t\t\t\t\t\t\t\tconst input = document.createElement(\"input\");\n\t\t\t\t\t\t\t\tinput.type = \"file\";\n\t\t\t\t\t\t\t\tinput.accept = \"image/*\";\n\t\t\t\t\t\t\t\tinput.multiple = true;\n\t\t\t\t\t\t\t\tinput.onchange = (e) =>\n\t\t\t\t\t\t\t\t\thandleFileSelect((e.target as HTMLInputElement).files);\n\t\t\t\t\t\t\t\tinput.click();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tclassName=\"gap-2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<ImageIcon className=\"size-4\" />\n\t\t\t\t\t\t\t<span>Photo Library</span>\n\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\tonClick={() => fileInputRef.current?.click()}\n\t\t\t\t\t\t\tclassName=\"gap-2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<FileText className=\"size-4\" />\n\t\t\t\t\t\t\t<span>Document</span>\n\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t</DropdownMenu>\n\n\t\t\t\t{/* Templates Button - Always available, auto-fills with smart defaults */}\n\t\t\t\t<DropdownMenu>\n\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\tclassName=\"mb-0.5 size-10 md:size-8 shrink-0 rounded-full hover:bg-muted\"\n\t\t\t\t\t\t\tdisabled={disabled}\n\t\t\t\t\t\t\ttitle=\"Quick replies\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<MessageSquareText className=\"size-5 md:size-4 text-muted-foreground\" />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t<DropdownMenuContent align=\"start\" side=\"top\" className=\"w-56\">\n\t\t\t\t\t\t<div className=\"px-2 py-1.5 text-xs font-semibold text-muted-foreground\">\n\t\t\t\t\t\t\tQuick Replies\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{SMS_TEMPLATES.map((template) => (\n\t\t\t\t\t\t\t<DropdownMenuItem\n\t\t\t\t\t\t\t\tkey={template.id}\n\t\t\t\t\t\t\t\tonClick={() => handleTemplateSelect(template)}\n\t\t\t\t\t\t\t\tclassName=\"flex-col items-start gap-0.5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span className=\"font-medium\">{template.label}</span>\n\t\t\t\t\t\t\t\t<span className=\"line-clamp-1 text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t{template.preview}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t</DropdownMenu>\n\n\n\t\t\t\t{/* Hidden file inputs */}\n\t\t\t\t<input\n\t\t\t\t\tref={fileInputRef}\n\t\t\t\t\ttype=\"file\"\n\t\t\t\t\tmultiple\n\t\t\t\t\taccept=\"*/*\"\n\t\t\t\t\tclassName=\"hidden\"\n\t\t\t\t\tonChange={(e) => handleFileSelect(e.target.files)}\n\t\t\t\t/>\n\t\t\t\t<input\n\t\t\t\t\tref={imageInputRef}\n\t\t\t\t\ttype=\"file\"\n\t\t\t\t\taccept=\"image/*\"\n\t\t\t\t\tcapture=\"environment\"\n\t\t\t\t\tclassName=\"hidden\"\n\t\t\t\t\tonChange={(e) => handleFileSelect(e.target.files)}\n\t\t\t\t/>\n\n\t\t\t\t{/* Text Input with Emoji and Send inside - iPhone style */}\n\t\t\t\t<div className=\"relative min-w-0 flex-1\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\"flex w-full items-center overflow-y-auto rounded-[18px] border border-border bg-muted/50 pl-3 pr-1 py-1 transition-colors\",\n\t\t\t\t\t\t\t\"min-h-[44px] md:min-h-[36px] max-h-[120px]\", // Taller on mobile for touch targets\n\t\t\t\t\t\t\t\"focus-within:border-primary/30 focus-within:bg-background focus-within:ring-1 focus-within:ring-primary/20\",\n\t\t\t\t\t\t\t(disabled || sending) && \"cursor-not-allowed opacity-50\"\n\t\t\t\t\t\t)}\n\t\t\t\t\t\tonClick={() => inputRef.current?.focus()}\n\t\t\t\t\t>\n\t\t\t\t\t\t{/* Input with ghost text suggestion */}\n\t\t\t\t\t\t<div className=\"relative min-w-0 flex-1\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tref={inputRef}\n\t\t\t\t\t\t\t\tcontentEditable={!disabled && !sending}\n\t\t\t\t\t\t\t\tsuppressContentEditableWarning\n\t\t\t\t\t\t\t\tspellCheck\n\t\t\t\t\t\t\t\tonInput={(e) => {\n\t\t\t\t\t\t\t\t\tconst text = e.currentTarget.textContent || \"\";\n\t\t\t\t\t\t\t\t\tonChange(text);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonKeyDown={handleKeyDown}\n\t\t\t\t\t\t\t\tonPaste={handlePaste}\n\t\t\t\t\t\t\t\tonFocus={() => setIsFocused(true)}\n\t\t\t\t\t\t\t\tonBlur={() => setIsFocused(false)}\n\t\t\t\t\t\t\t\tdata-placeholder={placeholder}\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\"w-full min-w-0 whitespace-pre-wrap break-words py-1 leading-5 outline-none\",\n\t\t\t\t\t\t\t\t\t\"text-base md:text-sm\", // 16px on mobile to prevent iOS zoom\n\t\t\t\t\t\t\t\t\t\"empty:before:pointer-events-none empty:before:text-muted-foreground/60 empty:before:content-[attr(data-placeholder)]\",\n\t\t\t\t\t\t\t\t\t(disabled || sending) && \"pointer-events-none\"\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/* AI Ghost Text Suggestion */}\n\t\t\t\t\t\t\t{aiSuggestion && value && (\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclassName=\"pointer-events-none absolute inset-0 flex items-center overflow-hidden py-1 text-sm leading-5\"\n\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{/* Invisible text to match position */}\n\t\t\t\t\t\t\t\t\t<span className=\"invisible whitespace-pre-wrap\">{value}</span>\n\t\t\t\t\t\t\t\t\t{/* Ghost suggestion */}\n\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground/40\">{aiSuggestion}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{/* Tab hint */}\n\t\t\t\t\t\t\t{aiSuggestion && (\n\t\t\t\t\t\t\t\t<div className=\"absolute -top-5 right-0 flex items-center gap-1 text-[10px] text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t<kbd className=\"rounded border border-border bg-muted px-1 py-0.5 font-mono text-[9px]\">\n\t\t\t\t\t\t\t\t\t\tTab\n\t\t\t\t\t\t\t\t\t</kbd>\n\t\t\t\t\t\t\t\t\t<span>to accept</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* Right side buttons container */}\n\t\t\t\t\t\t<div className=\"flex shrink-0 items-center gap-0.5 pl-1\">\n\t\t\t\t\t\t\t{/* Emoji Button */}\n\t\t\t\t\t\t\t<Popover open={showEmojiPicker} onOpenChange={setShowEmojiPicker}>\n\t\t\t\t\t\t\t\t<PopoverTrigger asChild>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"flex size-9 md:size-7 items-center justify-center rounded-full transition-colors\",\n\t\t\t\t\t\t\t\t\t\t\t\"hover:bg-muted/80\",\n\t\t\t\t\t\t\t\t\t\t\tshowEmojiPicker && \"bg-muted\"\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\tdisabled={disabled}\n\t\t\t\t\t\t\t\t\t\ttitle=\"Add emoji\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Smile className=\"size-5 md:size-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</PopoverTrigger>\n\t\t\t\t\t\t\t\t<PopoverContent side=\"top\" align=\"end\" className=\"w-[300px] p-0\">\n\t\t\t\t\t\t\t\t\t<ScrollArea className=\"h-[280px]\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"p-2\">\n\t\t\t\t\t\t\t\t\t\t\t{EMOJI_CATEGORIES.map((category, idx) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<div key={category.name} className={idx > 0 ? \"mt-3\" : \"\"}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<h4 className=\"mb-1.5 px-1 text-[10px] font-semibold uppercase tracking-wider text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{category.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-8 gap-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{category.emojis.map((emoji, emojiIdx) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={`${emoji}-${emojiIdx}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex size-8 items-center justify-center rounded-lg text-lg transition-colors hover:bg-muted\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleEmojiSelect(emoji)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{emoji}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</ScrollArea>\n\t\t\t\t\t\t\t\t</PopoverContent>\n\t\t\t\t\t\t\t</Popover>\n\n\t\t\t\t\t\t\t{/* Send Button */}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tonClick={handleSend}\n\t\t\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\t\t\t(!value.trim() && attachments.length === 0) || sending || disabled\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\"flex size-9 md:size-7 items-center justify-center rounded-full transition-all duration-200\",\n\t\t\t\t\t\t\t\t\tvalue.trim() || attachments.length > 0\n\t\t\t\t\t\t\t\t\t\t? \"bg-primary hover:bg-primary/90 scale-100 active:scale-95\"\n\t\t\t\t\t\t\t\t\t\t: \"bg-muted/50 scale-90\"\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{sending ? (\n\t\t\t\t\t\t\t\t\t<Loader2 className={cn(\n\t\t\t\t\t\t\t\t\t\t\"size-5 md:size-4 animate-spin\",\n\t\t\t\t\t\t\t\t\t\tvalue.trim() || attachments.length > 0 ? \"text-primary-foreground\" : \"text-muted-foreground\"\n\t\t\t\t\t\t\t\t\t)} />\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<ArrowUp className={cn(\n\t\t\t\t\t\t\t\t\t\t\"size-5 md:size-4\",\n\t\t\t\t\t\t\t\t\t\tvalue.trim() || attachments.length > 0 ? \"text-primary-foreground\" : \"text-muted-foreground\"\n\t\t\t\t\t\t\t\t\t)} />\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n"],"names":[],"mappings":"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CA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,AACF,EACA,CACC,KAAM,WACN,OAAQ,CACP,KACA,KACA,KACA,IACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,AACF,EACA,CACC,KAAM,UACN,OAAQ,CACP,KACA,KACA,IACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,AACF,EACA,CACC,KAAM,UACN,OAAQ,CACP,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,AACF,EACA,CAEM,SAAS,EAAgB,OAC/B,CAAK,UACL,CAAQ,CACR,QAAM,UACN,CAAQ,SACR,GAAU,CAAK,CACf,YAAW,CAAK,aAChB,EAAc,cAAc,oBAC5B,GAAqB,CAAI,cACzB,CAAY,mBACZ,CAAiB,CACjB,WAAY,CAAW,SACvB,CAAO,aACP,CAAW,cACX,CAAY,gBACZ,CAAc,iBACd,CAAe,iBACf,CAAe,CACf,eAAa,QACb,CAAM,qBACN,GAAsB,CAAK,CACL,EACtB,GAAM,CAAC,EAAa,EAAe,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAe,EAAE,EACzD,CAAC,EAAiB,EAAmB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjD,CAAC,EAAW,EAAa,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACrC,CAAC,EAAc,EAAgB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAS,IACnD,CAAC,EAAqB,EAAuB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACzD,EAAW,CAAA,EAAA,EAAA,MAAA,AAAM,EAAiB,MAClC,EAAe,CAAA,EAAA,EAAA,MAAA,AAAM,EAAmB,MACxC,EAAgB,CAAA,EAAA,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"}