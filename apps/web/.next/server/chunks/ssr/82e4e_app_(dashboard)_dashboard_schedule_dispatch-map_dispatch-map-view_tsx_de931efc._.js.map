{"version":3,"sources":["../../../../../../apps/web/src/app/%28dashboard%29/dashboard/schedule/dispatch-map/dispatch-map-view.tsx","../../../../../../apps/web/src/lib/services/google-routes-service.ts","../../../../../../apps/web/src/lib/services/google-weather-service.ts","../../../../../../apps/web/src/components/schedule/quick-appointment-dialog.tsx","../../../../../../apps/web/src/lib/utils/find-nearby-entities.ts"],"sourcesContent":["\"use client\";\n\n/**\n * Uber-Style Dispatch Map View\n *\n * Full-screen map interface for real-time fleet dispatch with:\n * - Technician GPS tracking with animated markers\n * - Job locations with status indicators\n * - Route visualization between stops\n * - Floating collapsible technician sidebar\n * - Bottom drawer for selection details\n * - Real-time updates via Supabase\n */\n\nimport React, { Component, useCallback, useEffect, useMemo, useRef, useState } from \"react\";\n\n// ============================================================================\n// Map Error Boundary - Catches errors without DOM reconciliation issues\n// ============================================================================\n\ninterface MapErrorBoundaryState {\n\thasError: boolean;\n\terror: Error | null;\n}\n\nclass MapErrorBoundary extends Component<\n\t{ children: React.ReactNode; fallback?: React.ReactNode },\n\tMapErrorBoundaryState\n> {\n\tconstructor(props: { children: React.ReactNode; fallback?: React.ReactNode }) {\n\t\tsuper(props);\n\t\tthis.state = { hasError: false, error: null };\n\t}\n\n\tstatic getDerivedStateFromError(error: Error): MapErrorBoundaryState {\n\t\treturn { hasError: true, error };\n\t}\n\n\tcomponentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n\t\tconsole.error(\"Map error caught:\", error, errorInfo);\n\t}\n\n\trender() {\n\t\tif (this.state.hasError) {\n\t\t\treturn (\n\t\t\t\tthis.props.fallback || (\n\t\t\t\t\t<div className=\"flex h-full w-full items-center justify-center bg-muted\">\n\t\t\t\t\t\t<div className=\"text-center max-w-md p-6\">\n\t\t\t\t\t\t\t<div className=\"mx-auto h-12 w-12 text-amber-500 mb-4\">⚠️</div>\n\t\t\t\t\t\t\t<h3 className=\"text-lg font-semibold mb-2\">Map Error</h3>\n\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground mb-4\">\n\t\t\t\t\t\t\t\t{this.state.error?.message || \"An error occurred while loading the map.\"}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tonClick={() => this.setState({ hasError: false, error: null })}\n\t\t\t\t\t\t\t\tclassName=\"px-4 py-2 bg-primary text-primary-foreground rounded-md text-sm\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tTry Again\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\treturn this.props.children;\n\t}\n}\nimport { useRouter } from \"next/navigation\";\nimport {\n\tAlertCircle,\n\tAlertTriangle,\n\tBattery,\n\tBatteryLow,\n\tBatteryMedium,\n\tChevronDown,\n\tChevronLeft,\n\tChevronRight,\n\tClock,\n\tCloudRain,\n\tLocate,\n\tMapPin,\n\tNavigation,\n\tPhone,\n\tPlus,\n\tRefreshCw,\n\tRoute,\n\tSearch,\n\tSignal,\n\tSun,\n\tThermometer,\n\tUser,\n\tUsers,\n\tX,\n\tZap,\n} from \"lucide-react\";\nimport { googleRoutesService, type Route as GoogleRoute } from \"@/lib/services/google-routes-service\";\nimport { googleWeatherService } from \"@/lib/services/google-weather-service\";\nimport { cn } from \"@/lib/utils\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport {\n\tQuickAppointmentDialog,\n\ttype MapClickLocation,\n\ttype TechnicianOption,\n} from \"@/components/schedule/quick-appointment-dialog\";\nimport { type CustomerOption } from \"@/components/customers/customer-autocomplete\";\nimport {\n\tfindNearbyEntities,\n\treverseGeocode,\n} from \"@/lib/utils/find-nearby-entities\";\n\n// ============================================================================\n// Google Maps Script Loader\n// ============================================================================\n\nlet isMapScriptLoaded = false;\nlet isMapScriptLoading = false;\nconst mapLoadCallbacks: (() => void)[] = [];\n\nfunction loadGoogleMapsScript(apiKey: string): Promise<void> {\n\treturn new Promise((resolve, reject) => {\n\t\tif (isMapScriptLoaded || window.google?.maps) {\n\t\t\tisMapScriptLoaded = true;\n\t\t\tresolve();\n\t\t\treturn;\n\t\t}\n\n\t\tif (isMapScriptLoading) {\n\t\t\tmapLoadCallbacks.push(resolve);\n\t\t\treturn;\n\t\t}\n\n\t\tconst existingScript = document.querySelector(\n\t\t\t'script[src*=\"maps.googleapis.com\"]'\n\t\t);\n\n\t\tif (existingScript) {\n\t\t\tisMapScriptLoading = true;\n\t\t\texistingScript.addEventListener(\"load\", () => {\n\t\t\t\tisMapScriptLoaded = true;\n\t\t\t\tisMapScriptLoading = false;\n\t\t\t\tresolve();\n\t\t\t\tmapLoadCallbacks.forEach((cb) => cb());\n\t\t\t\tmapLoadCallbacks.length = 0;\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tisMapScriptLoading = true;\n\t\tconst script = document.createElement(\"script\");\n\t\tscript.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=marker`;\n\t\tscript.async = true;\n\t\tscript.defer = true;\n\n\t\tscript.onload = () => {\n\t\t\tisMapScriptLoaded = true;\n\t\t\tisMapScriptLoading = false;\n\t\t\tresolve();\n\t\t\tmapLoadCallbacks.forEach((cb) => cb());\n\t\t\tmapLoadCallbacks.length = 0;\n\t\t};\n\n\t\tscript.onerror = () => {\n\t\t\tisMapScriptLoading = false;\n\t\t\treject(new Error(\"Failed to load Google Maps\"));\n\t\t};\n\n\t\tdocument.head.appendChild(script);\n\t});\n}\n\n// ============================================================================\n// Types\n// ============================================================================\n\ntype Technician = {\n\tid: string;\n\tname: string;\n\temail?: string;\n\tphone?: string;\n\tavatar?: string;\n\trole: string;\n\tstatus: string;\n};\n\ntype GPSLocation = {\n\tid: string;\n\ttechnician_id: string;\n\tlat: number;\n\tlng: number;\n\taccuracy?: number;\n\theading?: number;\n\tspeed?: number;\n\tbattery_level?: number;\n\tstatus?: string;\n\tupdated_at: string;\n\tcompany_id: string;\n};\n\ntype Customer = {\n\tid: string;\n\tdisplay_name: string;\n\tphone?: string;\n\taddress?: string;\n\tcity?: string;\n\tstate?: string;\n\tzip_code?: string;\n\tlat?: number;\n\tlon?: number;\n};\n\ntype Property = {\n\tid: string;\n\taddress?: string;\n\tcity?: string;\n\tstate?: string;\n\tzip_code?: string;\n\tlat?: number;\n\tlon?: number;\n};\n\ntype Job = {\n\tid: string;\n\ttitle: string;\n\tjob_type?: string;\n\tpriority?: string;\n\tstatus: string;\n\ttotal_amount?: number;\n\tcustomer?: Customer;\n\tproperty?: Property;\n};\n\ntype Appointment = {\n\tid: string;\n\tscheduled_start: string;\n\tscheduled_end?: string;\n\tstatus: string;\n\tassigned_technician_ids?: string[];\n\tjob?: Job;\n};\n\ntype DispatchMapViewProps = {\n\ttechnicians: Technician[];\n\tgpsLocations: GPSLocation[];\n\tappointments: Appointment[];\n\tunassignedJobs: Job[];\n\tcompanyId: string;\n\tdefaultCenter?: { address: string };\n};\n\ntype TechnicianWithLocation = Technician & {\n\tgpsLocation?: GPSLocation;\n\tappointments: Appointment[];\n\tcurrentJob?: Job;\n\tnextJob?: Job;\n\t// Route optimization data\n\tetaToNextJob?: {\n\t\tdurationMinutes: number;\n\t\tdistanceKm: number;\n\t\tarrivalTime: string;\n\t};\n\toptimizedRoute?: GoogleRoute;\n};\n\ntype WeatherData = {\n\ttemperature: number;\n\tcondition: string;\n\ticon: string;\n\talerts: Array<{ headline: string; severity: string }>;\n};\n\n// ============================================================================\n// Status Colors\n// ============================================================================\n\nconst TECH_STATUS_COLORS: Record<string, { bg: string; text: string; border: string }> = {\n\tavailable: { bg: \"bg-emerald-500\", text: \"text-emerald-500\", border: \"border-emerald-500\" },\n\tactive: { bg: \"bg-emerald-500\", text: \"text-emerald-500\", border: \"border-emerald-500\" },\n\t\"on-job\": { bg: \"bg-blue-500\", text: \"text-blue-500\", border: \"border-blue-500\" },\n\t\"in-transit\": { bg: \"bg-amber-500\", text: \"text-amber-500\", border: \"border-amber-500\" },\n\t\"on-break\": { bg: \"bg-orange-500\", text: \"text-orange-500\", border: \"border-orange-500\" },\n\toffline: { bg: \"bg-gray-400\", text: \"text-gray-400\", border: \"border-gray-400\" },\n\tinactive: { bg: \"bg-gray-400\", text: \"text-gray-400\", border: \"border-gray-400\" },\n};\n\nconst JOB_STATUS_COLORS: Record<string, string> = {\n\tpending: \"#f59e0b\",\n\tscheduled: \"#3b82f6\",\n\tdispatched: \"#8b5cf6\",\n\t\"in-progress\": \"#10b981\",\n\tcompleted: \"#6b7280\",\n\tcancelled: \"#ef4444\",\n};\n\nconst PRIORITY_COLORS: Record<string, { bg: string; text: string }> = {\n\temergency: { bg: \"bg-red-500/20\", text: \"text-red-500\" },\n\thigh: { bg: \"bg-orange-500/20\", text: \"text-orange-500\" },\n\tnormal: { bg: \"bg-blue-500/20\", text: \"text-blue-500\" },\n\tlow: { bg: \"bg-gray-500/20\", text: \"text-gray-500\" },\n};\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nfunction getInitials(name: string): string {\n\tif (!name) return \"??\";\n\treturn name\n\t\t.split(\" \")\n\t\t.map((n) => n[0])\n\t\t.join(\"\")\n\t\t.toUpperCase()\n\t\t.slice(0, 2);\n}\n\nfunction formatLocationAge(date: Date | string): string {\n\tconst now = new Date();\n\tconst then = typeof date === \"string\" ? new Date(date) : date;\n\tconst diffMs = now.getTime() - then.getTime();\n\tconst diffMins = Math.floor(diffMs / 60000);\n\n\tif (diffMins < 1) return \"Just now\";\n\tif (diffMins === 1) return \"1 min ago\";\n\tif (diffMins < 60) return `${diffMins} mins ago`;\n\n\tconst diffHours = Math.floor(diffMins / 60);\n\tif (diffHours === 1) return \"1 hour ago\";\n\tif (diffHours < 24) return `${diffHours} hours ago`;\n\n\treturn \"Over a day ago\";\n}\n\nfunction getJobAddress(job: Job): string {\n\tconst property = job.property;\n\tconst customer = job.customer;\n\n\tif (property?.address) {\n\t\treturn `${property.address}, ${property.city || \"\"} ${property.state || \"\"}`.trim();\n\t}\n\tif (customer?.address) {\n\t\treturn `${customer.address}, ${customer.city || \"\"} ${customer.state || \"\"}`.trim();\n\t}\n\treturn \"No address\";\n}\n\nfunction getJobCoordinates(job: Job): { lat: number; lng: number } | null {\n\tif (job.property?.lat && job.property?.lon) {\n\t\treturn { lat: job.property.lat, lng: job.property.lon };\n\t}\n\tif (job.customer?.lat && job.customer?.lon) {\n\t\treturn { lat: job.customer.lat, lng: job.customer.lon };\n\t}\n\treturn null;\n}\n\n// ============================================================================\n// Technician Sidebar Item Component\n// ============================================================================\n\nfunction TechnicianListItem({\n\ttech,\n\tisSelected,\n\tonClick,\n}: {\n\ttech: TechnicianWithLocation;\n\tisSelected: boolean;\n\tonClick: () => void;\n}) {\n\tconst statusColor = TECH_STATUS_COLORS[tech.status] || TECH_STATUS_COLORS.offline;\n\tconst hasGps = !!tech.gpsLocation;\n\tconst batteryLevel = tech.gpsLocation?.battery_level;\n\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\n\t\t\t\t\"flex items-center gap-3 p-3 cursor-pointer transition-all\",\n\t\t\t\t\"hover:bg-accent/50 border-b border-border/50\",\n\t\t\t\tisSelected && \"bg-accent\"\n\t\t\t)}\n\t\t\tonClick={onClick}\n\t\t>\n\t\t\t{/* Avatar with status indicator */}\n\t\t\t<div className=\"relative\">\n\t\t\t\t<Avatar className=\"h-10 w-10\">\n\t\t\t\t\t<AvatarImage src={tech.avatar || undefined} />\n\t\t\t\t\t<AvatarFallback className=\"bg-muted text-sm\">\n\t\t\t\t\t\t{getInitials(tech.name)}\n\t\t\t\t\t</AvatarFallback>\n\t\t\t\t</Avatar>\n\t\t\t\t<div\n\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\"absolute -bottom-0.5 -right-0.5 h-3.5 w-3.5 rounded-full border-2 border-background\",\n\t\t\t\t\t\tstatusColor.bg\n\t\t\t\t\t)}\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t{/* Info */}\n\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<span className=\"font-medium text-sm truncate\">{tech.name}</span>\n\t\t\t\t\t{hasGps && (\n\t\t\t\t\t\t<Signal className=\"h-3 w-3 text-emerald-500 flex-shrink-0\" />\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n\t\t\t\t\t{tech.currentJob ? (\n\t\t\t\t\t\t<span className=\"truncate\">{tech.currentJob.title}</span>\n\t\t\t\t\t) : tech.nextJob ? (\n\t\t\t\t\t\t<span className=\"truncate\">Next: {tech.nextJob.title}</span>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<span>No jobs scheduled</span>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t\t{/* ETA to next job */}\n\t\t\t\t{tech.etaToNextJob && tech.nextJob && (\n\t\t\t\t\t<div className=\"flex items-center gap-1 text-xs text-blue-500 mt-0.5\">\n\t\t\t\t\t\t<Navigation className=\"h-3 w-3\" />\n\t\t\t\t\t\t<span>{tech.etaToNextJob.durationMinutes} min ({tech.etaToNextJob.distanceKm.toFixed(1)} km)</span>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\n\t\t\t{/* Right side indicators */}\n\t\t\t<div className=\"flex flex-col items-end gap-1\">\n\t\t\t\t<Badge\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\tclassName={cn(\"text-[10px] px-1.5 py-0\", statusColor.border, statusColor.text)}\n\t\t\t\t>\n\t\t\t\t\t{tech.status === \"on-job\" ? \"On Job\" : tech.status}\n\t\t\t\t</Badge>\n\t\t\t\t{batteryLevel !== undefined && batteryLevel !== null && (\n\t\t\t\t\t<div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n\t\t\t\t\t\t{batteryLevel < 20 ? (\n\t\t\t\t\t\t\t<BatteryLow className=\"h-3 w-3 text-red-500\" />\n\t\t\t\t\t\t) : batteryLevel < 50 ? (\n\t\t\t\t\t\t\t<BatteryMedium className=\"h-3 w-3 text-amber-500\" />\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<Battery className=\"h-3 w-3 text-emerald-500\" />\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t<span>{Math.round(batteryLevel)}%</span>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n// ============================================================================\n// Bottom Detail Drawer Component\n// ============================================================================\n\nfunction DetailDrawer({\n\ttech,\n\tonClose,\n\tonNavigate,\n}: {\n\ttech: TechnicianWithLocation | null;\n\tonClose: () => void;\n\tonNavigate: () => void;\n}) {\n\tif (!tech) return null;\n\n\tconst statusColor = TECH_STATUS_COLORS[tech.status] || TECH_STATUS_COLORS.offline;\n\n\treturn (\n\t\t<div className=\"absolute bottom-0 left-0 right-0 z-20 bg-background border-t shadow-lg animate-in slide-in-from-bottom duration-300\">\n\t\t\t<div className=\"max-w-4xl mx-auto p-4\">\n\t\t\t\t{/* Header */}\n\t\t\t\t<div className=\"flex items-start justify-between mb-4\">\n\t\t\t\t\t<div className=\"flex items-center gap-4\">\n\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t<Avatar className=\"h-14 w-14\">\n\t\t\t\t\t\t\t\t<AvatarImage src={tech.avatar || undefined} />\n\t\t\t\t\t\t\t\t<AvatarFallback className=\"text-lg\">\n\t\t\t\t\t\t\t\t\t{getInitials(tech.name)}\n\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\"absolute -bottom-1 -right-1 h-4 w-4 rounded-full border-2 border-background\",\n\t\t\t\t\t\t\t\t\tstatusColor.bg\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<h3 className=\"text-lg font-semibold\">{tech.name}</h3>\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-3 text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t<span className=\"capitalize\">{tech.role?.replace(/_/g, \" \")}</span>\n\t\t\t\t\t\t\t\t{tech.gpsLocation && (\n\t\t\t\t\t\t\t\t\t<span className=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t<Signal className=\"h-3 w-3 text-emerald-500\" />\n\t\t\t\t\t\t\t\t\t\t{formatLocationAge(tech.gpsLocation.updated_at)}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Button variant=\"outline\" size=\"sm\" onClick={onNavigate}>\n\t\t\t\t\t\t\t<User className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\tView Schedule\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t{tech.phone && (\n\t\t\t\t\t\t\t<Button variant=\"outline\" size=\"sm\" asChild>\n\t\t\t\t\t\t\t\t<a href={`tel:${tech.phone}`}>\n\t\t\t\t\t\t\t\t\t<Phone className=\"h-4 w-4 mr-2\" />\n\t\t\t\t\t\t\t\t\tCall\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t<Button variant=\"ghost\" size=\"icon\" onClick={onClose}>\n\t\t\t\t\t\t\t<X className=\"h-4 w-4\" />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Today's Schedule */}\n\t\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n\t\t\t\t\t{/* Stats */}\n\t\t\t\t\t<Card className=\"bg-muted/30\">\n\t\t\t\t\t\t<CardContent className=\"p-4\">\n\t\t\t\t\t\t\t<div className=\"text-sm text-muted-foreground mb-1\">Today&apos;s Jobs</div>\n\t\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{tech.appointments.length}</div>\n\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t{tech.appointments.filter((a) => a.status === \"completed\").length} completed\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</CardContent>\n\t\t\t\t\t</Card>\n\n\t\t\t\t\t{/* Current/Next Job */}\n\t\t\t\t\t<Card className=\"md:col-span-2 bg-muted/30\">\n\t\t\t\t\t\t<CardContent className=\"p-4\">\n\t\t\t\t\t\t\t{tech.currentJob ? (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t<Zap className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\tCurrent Job\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"font-medium\">{tech.currentJob.title}</div>\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm text-muted-foreground flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t<MapPin className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t{getJobAddress(tech.currentJob)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t) : tech.nextJob ? (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\n\t\t\t\t\t\t\t\t\t\t<Clock className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\tNext Job\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"font-medium\">{tech.nextJob.title}</div>\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm text-muted-foreground flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t<MapPin className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t{getJobAddress(tech.nextJob)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground\">No upcoming jobs scheduled</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</CardContent>\n\t\t\t\t\t</Card>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n// ============================================================================\n// Unassigned Jobs Panel Component\n// ============================================================================\n\nfunction UnassignedJobsPanel({\n\tjobs,\n\tisOpen,\n\tonToggle,\n\tonJobSelect,\n}: {\n\tjobs: Job[];\n\tisOpen: boolean;\n\tonToggle: () => void;\n\tonJobSelect: (job: Job) => void;\n}) {\n\tif (jobs.length === 0) return null;\n\n\treturn (\n\t\t<div className=\"absolute top-4 right-4 z-10\">\n\t\t\t<Card className={cn(\"transition-all duration-300\", isOpen ? \"w-80\" : \"w-auto\")}>\n\t\t\t\t<CardHeader\n\t\t\t\t\tclassName=\"p-3 cursor-pointer hover:bg-accent/50\"\n\t\t\t\t\tonClick={onToggle}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<AlertCircle className=\"h-4 w-4 text-amber-500\" />\n\t\t\t\t\t\t\t<span className=\"text-sm font-medium\">Unassigned ({jobs.length})</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<ChevronDown\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\"h-4 w-4 transition-transform\",\n\t\t\t\t\t\t\t\tisOpen && \"rotate-180\"\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t{isOpen && (\n\t\t\t\t\t<CardContent className=\"p-0\">\n\t\t\t\t\t\t<ScrollArea className=\"max-h-64\">\n\t\t\t\t\t\t\t{jobs.slice(0, 10).map((job) => {\n\t\t\t\t\t\t\t\tconst priorityColor = PRIORITY_COLORS[job.priority || \"normal\"];\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tkey={job.id}\n\t\t\t\t\t\t\t\t\t\tclassName=\"p-3 border-t cursor-pointer hover:bg-accent/50\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => onJobSelect(job)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-start justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-medium text-sm truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{job.title}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-muted-foreground truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{job.customer?.display_name}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{job.priority && (\n\t\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\"text-[10px]\", priorityColor?.bg, priorityColor?.text)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{job.priority}\n\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t</ScrollArea>\n\t\t\t\t\t</CardContent>\n\t\t\t\t)}\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\nfunction DispatchMapViewInner({\n\ttechnicians,\n\tgpsLocations,\n\tappointments,\n\tunassignedJobs,\n\tcompanyId,\n}: DispatchMapViewProps) {\n\tconst router = useRouter();\n\tconst mapContainerRef = useRef<HTMLDivElement>(null);\n\tconst mapInstanceRef = useRef<google.maps.Map | null>(null);\n\tconst markersRef = useRef<Map<string, google.maps.marker.AdvancedMarkerElement>>(new Map());\n\tconst polylinesRef = useRef<Map<string, google.maps.Polyline>>(new Map());\n\tconst mapClickHandlerRef = useRef<((event: google.maps.MapMouseEvent) => void) | null>(null);\n\n\tconst [isMapLoaded, setIsMapLoaded] = useState(false);\n\tconst [mapError, setMapError] = useState<string | null>(null);\n\tconst [sidebarOpen, setSidebarOpen] = useState(true);\n\tconst [selectedTechId, setSelectedTechId] = useState<string | null>(null);\n\tconst [selectedJob, setSelectedJob] = useState<Job | null>(null);\n\tconst [showUnassigned, setShowUnassigned] = useState(false);\n\tconst [searchQuery, setSearchQuery] = useState(\"\");\n\tconst [liveLocations, setLiveLocations] = useState<Map<string, GPSLocation>>(\n\t\tnew Map(gpsLocations.map((loc) => [loc.technician_id, loc]))\n\t);\n\n\t// Quick appointment dialog state\n\tconst [showQuickAppointment, setShowQuickAppointment] = useState(false);\n\tconst [clickedLocation, setClickedLocation] = useState<MapClickLocation | null>(null);\n\tconst [nearbyCustomers, setNearbyCustomers] = useState<CustomerOption[]>([]);\n\n\t// Weather and ETA state\n\tconst [weather, setWeather] = useState<WeatherData | null>(null);\n\tconst [technicianETAs, setTechnicianETAs] = useState<Map<string, { durationMinutes: number; distanceKm: number; arrivalTime: string }>>(new Map());\n\tconst [isOptimizingRoutes, setIsOptimizingRoutes] = useState(false);\n\n\tconst apiKey = process.env.NEXT_PUBLIC_GOOGLE_PLACES_API_KEY;\n\n\t// Transform technicians to TechnicianOption format for dialog\n\tconst technicianOptions: TechnicianOption[] = useMemo(\n\t\t() =>\n\t\t\ttechnicians.map((tech) => ({\n\t\t\t\tid: tech.id,\n\t\t\t\tname: tech.name,\n\t\t\t\tavatar: tech.avatar,\n\t\t\t})),\n\t\t[technicians]\n\t);\n\n\t// Handle map click for quick appointment creation\n\tconst handleMapClick = useCallback(\n\t\tasync (event: google.maps.MapMouseEvent) => {\n\t\t\tif (!event.latLng) return;\n\n\t\t\tconst lat = event.latLng.lat();\n\t\t\tconst lng = event.latLng.lng();\n\n\t\t\t// Try to reverse geocode the location\n\t\t\tconst address = await reverseGeocode({ lat, lng });\n\n\t\t\tsetClickedLocation({\n\t\t\t\tlat,\n\t\t\t\tlng,\n\t\t\t\taddress: address || undefined,\n\t\t\t});\n\n\t\t\t// Find nearby customers from unassigned jobs\n\t\t\tconst customersWithLocation: Array<CustomerOption & { lat?: number; lng?: number }> = [];\n\t\t\tfor (const job of unassignedJobs) {\n\t\t\t\tif (job.customer) {\n\t\t\t\t\tconst coords =\n\t\t\t\t\t\tjob.property?.lat && job.property?.lon\n\t\t\t\t\t\t\t? { lat: job.property.lat, lng: job.property.lon }\n\t\t\t\t\t\t\t: job.customer?.lat && job.customer?.lon\n\t\t\t\t\t\t\t\t? { lat: job.customer.lat, lng: job.customer.lon }\n\t\t\t\t\t\t\t\t: null;\n\n\t\t\t\t\tif (coords) {\n\t\t\t\t\t\tcustomersWithLocation.push({\n\t\t\t\t\t\t\tid: job.customer.id,\n\t\t\t\t\t\t\tdisplay_name: job.customer.display_name,\n\t\t\t\t\t\t\tphone: job.customer.phone || undefined,\n\t\t\t\t\t\t\tlat: coords.lat,\n\t\t\t\t\t\t\tlng: coords.lng,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Find nearby customers within 5 miles\n\t\t\tconst nearby = findNearbyEntities({ lat, lng }, customersWithLocation, 5);\n\n\t\t\t// Deduplicate and take top 5\n\t\t\tconst uniqueCustomers = new Map<string, CustomerOption>();\n\t\t\tfor (const customer of nearby) {\n\t\t\t\tif (!uniqueCustomers.has(customer.id)) {\n\t\t\t\t\tuniqueCustomers.set(customer.id, {\n\t\t\t\t\t\tid: customer.id,\n\t\t\t\t\t\tdisplay_name: customer.display_name,\n\t\t\t\t\t\tphone: customer.phone,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tsetNearbyCustomers(Array.from(uniqueCustomers.values()).slice(0, 5));\n\n\t\t\t// Open the dialog\n\t\t\tsetShowQuickAppointment(true);\n\t\t},\n\t\t[unassignedJobs]\n\t);\n\n\t// Keep the ref in sync with the latest handler\n\tuseEffect(() => {\n\t\tmapClickHandlerRef.current = handleMapClick;\n\t}, [handleMapClick]);\n\n\t// Merge technicians with GPS locations and appointments\n\tconst techniciansWithData = useMemo<TechnicianWithLocation[]>(() => {\n\t\treturn technicians.map((tech) => {\n\t\t\tconst gpsLocation = liveLocations.get(tech.id);\n\t\t\tconst techAppointments = appointments.filter((apt) =>\n\t\t\t\tapt.assigned_technician_ids?.includes(tech.id)\n\t\t\t);\n\n\t\t\t// Sort by scheduled start\n\t\t\ttechAppointments.sort(\n\t\t\t\t(a, b) =>\n\t\t\t\t\tnew Date(a.scheduled_start).getTime() - new Date(b.scheduled_start).getTime()\n\t\t\t);\n\n\t\t\t// Find current job (in-progress) and next job\n\t\t\tconst currentApt = techAppointments.find(\n\t\t\t\t(apt) => apt.status === \"in-progress\" || apt.status === \"arrived\"\n\t\t\t);\n\t\t\tconst nextApt = techAppointments.find(\n\t\t\t\t(apt) => apt.status === \"scheduled\" || apt.status === \"dispatched\"\n\t\t\t);\n\n\t\t\t// Get ETA for this technician\n\t\t\tconst etaToNextJob = technicianETAs.get(tech.id);\n\n\t\t\treturn {\n\t\t\t\t...tech,\n\t\t\t\tgpsLocation,\n\t\t\t\tappointments: techAppointments,\n\t\t\t\tcurrentJob: currentApt?.job,\n\t\t\t\tnextJob: nextApt?.job,\n\t\t\t\tetaToNextJob,\n\t\t\t};\n\t\t});\n\t}, [technicians, liveLocations, appointments, technicianETAs]);\n\n\t// Filter technicians by search\n\tconst filteredTechnicians = useMemo(() => {\n\t\tif (!searchQuery.trim()) return techniciansWithData;\n\t\tconst query = searchQuery.toLowerCase();\n\t\treturn techniciansWithData.filter(\n\t\t\t(tech) =>\n\t\t\t\ttech.name?.toLowerCase().includes(query) ||\n\t\t\t\ttech.currentJob?.title?.toLowerCase().includes(query) ||\n\t\t\t\ttech.nextJob?.title?.toLowerCase().includes(query)\n\t\t);\n\t}, [techniciansWithData, searchQuery]);\n\n\t// Get selected technician\n\tconst selectedTech = useMemo(\n\t\t() => techniciansWithData.find((t) => t.id === selectedTechId) || null,\n\t\t[techniciansWithData, selectedTechId]\n\t);\n\n\t// Initialize Google Maps\n\tuseEffect(() => {\n\t\tif (!apiKey) {\n\t\t\tsetMapError(\"Google Maps API key not configured\");\n\t\t\treturn;\n\t\t}\n\n\t\tlet isMounted = true;\n\n\t\tconst initMap = async () => {\n\t\t\ttry {\n\t\t\t\tawait loadGoogleMapsScript(apiKey);\n\n\t\t\t\tif (!isMounted || !mapContainerRef.current) return;\n\n\t\t\t\tconst { Map } = (await google.maps.importLibrary(\"maps\")) as google.maps.MapsLibrary;\n\n\t\t\t\t// Default center (San Francisco)\n\t\t\t\tconst center = { lat: 37.7749, lng: -122.4194 };\n\n\t\t\t\tconst map = new Map(mapContainerRef.current, {\n\t\t\t\t\tcenter,\n\t\t\t\t\tzoom: 11,\n\t\t\t\t\tmapId: \"dispatch-map\",\n\t\t\t\t\tdisableDefaultUI: true,\n\t\t\t\t\tzoomControl: true,\n\t\t\t\t\tfullscreenControl: true,\n\t\t\t\t\tstyles: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfeatureType: \"poi\",\n\t\t\t\t\t\t\telementType: \"labels\",\n\t\t\t\t\t\t\tstylers: [{ visibility: \"off\" }],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t});\n\n\t\t\t\tmapInstanceRef.current = map;\n\t\t\t\tsetIsMapLoaded(true);\n\n\t\t\t\t// Add click listener for quick appointment creation\n\t\t\t\t// Using ref indirection so the listener doesn't need to be recreated when handler changes\n\t\t\t\tmap.addListener(\"click\", (event: google.maps.MapMouseEvent) => {\n\t\t\t\t\tif (mapClickHandlerRef.current) {\n\t\t\t\t\t\tmapClickHandlerRef.current(event);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tif (isMounted) {\n\t\t\t\t\tsetMapError(error instanceof Error ? error.message : \"Failed to load map\");\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tinitMap();\n\n\t\treturn () => {\n\t\t\tisMounted = false;\n\t\t\t// Clean up markers\n\t\t\tfor (const marker of markersRef.current.values()) {\n\t\t\t\ttry {\n\t\t\t\t\tmarker.map = null;\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// Ignore cleanup errors\n\t\t\t\t}\n\t\t\t}\n\t\t\tmarkersRef.current.clear();\n\t\t\t// Clean up polylines\n\t\t\tfor (const polyline of polylinesRef.current.values()) {\n\t\t\t\ttry {\n\t\t\t\t\tpolyline.setMap(null);\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// Ignore cleanup errors\n\t\t\t\t}\n\t\t\t}\n\t\t\tpolylinesRef.current.clear();\n\t\t\t// Clear map instance\n\t\t\tmapInstanceRef.current = null;\n\t\t\t// Clear the container to prevent React DOM issues\n\t\t\tif (mapContainerRef.current) {\n\t\t\t\tmapContainerRef.current.innerHTML = \"\";\n\t\t\t}\n\t\t};\n\t}, [apiKey]);\n\n\t// Update markers\n\tuseEffect(() => {\n\t\tif (!mapInstanceRef.current || !isMapLoaded) return;\n\n\t\tconst updateMarkers = async () => {\n\t\t\ttry {\n\t\t\t\tconst { AdvancedMarkerElement } = (await google.maps.importLibrary(\n\t\t\t\t\t\"marker\"\n\t\t\t\t)) as google.maps.MarkerLibrary;\n\n\t\t\t\tconst map = mapInstanceRef.current;\n\t\t\t\tif (!map) return;\n\n\t\t\t\tconst currentMarkerIds = new Set<string>();\n\n\t\t\t\t// Add technician markers\n\t\t\t\tfor (const tech of techniciansWithData) {\n\t\t\t\t\tconst gps = tech.gpsLocation;\n\t\t\t\t\tif (!gps) continue;\n\n\t\t\t\t\tconst markerId = `tech-${tech.id}`;\n\t\t\t\t\tcurrentMarkerIds.add(markerId);\n\n\t\t\t\t\tconst position = { lat: Number(gps.lat), lng: Number(gps.lng) };\n\t\t\t\t\tconst statusColor = TECH_STATUS_COLORS[tech.status] || TECH_STATUS_COLORS.offline;\n\n\t\t\t\t\tlet marker = markersRef.current.get(markerId);\n\n\t\t\t\t\tif (!marker) {\n\t\t\t\t\t\t// Create custom marker element\n\t\t\t\t\t\tconst markerEl = document.createElement(\"div\");\n\t\t\t\t\t\tmarkerEl.className = \"relative cursor-pointer\";\n\t\t\t\t\t\tmarkerEl.innerHTML = `\n\t\t\t\t\t\t\t<div class=\"relative\">\n\t\t\t\t\t\t\t\t<div class=\"w-10 h-10 rounded-full bg-white shadow-lg border-2 ${statusColor.border.replace(\"border-\", \"border-\")} flex items-center justify-center overflow-hidden\">\n\t\t\t\t\t\t\t\t\t${\n\t\t\t\t\t\t\t\t\t\ttech.avatar\n\t\t\t\t\t\t\t\t\t\t\t? `<img src=\"${tech.avatar}\" class=\"w-full h-full object-cover\" />`\n\t\t\t\t\t\t\t\t\t\t\t: `<span class=\"text-sm font-medium text-gray-700\">${getInitials(tech.name)}</span>`\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"absolute -bottom-1 -right-1 w-4 h-4 rounded-full ${statusColor.bg} border-2 border-white\"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`;\n\n\t\t\t\t\t\tmarker = new AdvancedMarkerElement({\n\t\t\t\t\t\t\tmap,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\tcontent: markerEl,\n\t\t\t\t\t\t\ttitle: tech.name,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tmarker.addListener(\"click\", () => {\n\t\t\t\t\t\t\tsetSelectedTechId(tech.id);\n\t\t\t\t\t\t\tsetSelectedJob(null);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tmarkersRef.current.set(markerId, marker);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmarker.position = position;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Add job markers for appointments\n\t\t\t\tfor (const apt of appointments) {\n\t\t\t\t\tif (!apt.job) continue;\n\t\t\t\t\tconst coords = getJobCoordinates(apt.job);\n\t\t\t\t\tif (!coords) continue;\n\n\t\t\t\t\tconst markerId = `job-${apt.job.id}`;\n\t\t\t\t\tcurrentMarkerIds.add(markerId);\n\n\t\t\t\t\tconst color = JOB_STATUS_COLORS[apt.status] || JOB_STATUS_COLORS.pending;\n\n\t\t\t\t\tlet marker = markersRef.current.get(markerId);\n\n\t\t\t\t\tif (!marker) {\n\t\t\t\t\t\tconst markerEl = document.createElement(\"div\");\n\t\t\t\t\t\tmarkerEl.className = \"cursor-pointer\";\n\t\t\t\t\t\tmarkerEl.innerHTML = `\n\t\t\t\t\t\t\t<div class=\"w-6 h-6 rounded-full shadow-md flex items-center justify-center\" style=\"background-color: ${color}\">\n\t\t\t\t\t\t\t\t<svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" stroke-width=\"2\">\n\t\t\t\t\t\t\t\t\t<path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\"/>\n\t\t\t\t\t\t\t\t\t<circle cx=\"12\" cy=\"10\" r=\"3\"/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`;\n\n\t\t\t\t\t\tmarker = new AdvancedMarkerElement({\n\t\t\t\t\t\t\tmap,\n\t\t\t\t\t\t\tposition: coords,\n\t\t\t\t\t\t\tcontent: markerEl,\n\t\t\t\t\t\t\ttitle: apt.job.title,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tmarker.addListener(\"click\", () => {\n\t\t\t\t\t\t\tsetSelectedJob(apt.job!);\n\t\t\t\t\t\t\tsetSelectedTechId(null);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tmarkersRef.current.set(markerId, marker);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Remove old markers\n\t\t\t\tfor (const [id, marker] of markersRef.current) {\n\t\t\t\t\tif (!currentMarkerIds.has(id)) {\n\t\t\t\t\t\tmarker.map = null;\n\t\t\t\t\t\tmarkersRef.current.delete(id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Error updating markers:\", error);\n\t\t\t}\n\t\t};\n\n\t\tupdateMarkers();\n\t}, [techniciansWithData, appointments, isMapLoaded]);\n\n\t// Draw route polylines for each technician\n\tuseEffect(() => {\n\t\tif (!mapInstanceRef.current || !isMapLoaded) return;\n\n\t\tconst map = mapInstanceRef.current;\n\t\tconst colors = [\"#3b82f6\", \"#10b981\", \"#f59e0b\", \"#8b5cf6\", \"#ef4444\", \"#ec4899\"];\n\n\t\t// Clear existing polylines\n\t\tfor (const polyline of polylinesRef.current.values()) {\n\t\t\tpolyline.setMap(null);\n\t\t}\n\t\tpolylinesRef.current.clear();\n\n\t\t// Draw routes for each technician\n\t\ttechniciansWithData.forEach((tech, index) => {\n\t\t\tif (!tech.gpsLocation || tech.appointments.length === 0) return;\n\n\t\t\tconst path: google.maps.LatLngLiteral[] = [];\n\n\t\t\t// Start from technician's current location\n\t\t\tpath.push({ lat: Number(tech.gpsLocation.lat), lng: Number(tech.gpsLocation.lng) });\n\n\t\t\t// Add each job location\n\t\t\tfor (const apt of tech.appointments) {\n\t\t\t\tif (!apt.job) continue;\n\t\t\t\tconst coords = getJobCoordinates(apt.job);\n\t\t\t\tif (coords) {\n\t\t\t\t\tpath.push(coords);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (path.length < 2) return;\n\n\t\t\tconst polyline = new google.maps.Polyline({\n\t\t\t\tpath,\n\t\t\t\tgeodesic: true,\n\t\t\t\tstrokeColor: colors[index % colors.length],\n\t\t\t\tstrokeOpacity: 0.7,\n\t\t\t\tstrokeWeight: 3,\n\t\t\t\tmap,\n\t\t\t});\n\n\t\t\tpolylinesRef.current.set(`route-${tech.id}`, polyline);\n\t\t});\n\t}, [techniciansWithData, isMapLoaded]);\n\n\t// Subscribe to real-time GPS updates\n\tuseEffect(() => {\n\t\tconst supabase = createClient();\n\n\t\tconst channel = supabase\n\t\t\t.channel(\"dispatch-gps-updates\")\n\t\t\t.on(\n\t\t\t\t\"postgres_changes\",\n\t\t\t\t{\n\t\t\t\t\tevent: \"*\",\n\t\t\t\t\tschema: \"public\",\n\t\t\t\t\ttable: \"technician_locations\",\n\t\t\t\t\tfilter: `company_id=eq.${companyId}`,\n\t\t\t\t},\n\t\t\t\t(payload) => {\n\t\t\t\t\tif (payload.new && typeof payload.new === \"object\") {\n\t\t\t\t\t\tconst data = payload.new as GPSLocation;\n\t\t\t\t\t\tsetLiveLocations((prev) => {\n\t\t\t\t\t\t\tconst next = new Map(prev);\n\t\t\t\t\t\t\tnext.set(data.technician_id, data);\n\t\t\t\t\t\t\treturn next;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t\t.subscribe();\n\n\t\treturn () => {\n\t\t\tsupabase.removeChannel(channel);\n\t\t};\n\t}, [companyId]);\n\n\t// Fetch weather for the map center\n\tuseEffect(() => {\n\t\tconst fetchWeather = async () => {\n\t\t\t// Get first technician with GPS as reference point\n\t\t\tconst firstTechWithGps = techniciansWithData.find(t => t.gpsLocation);\n\t\t\tif (!firstTechWithGps?.gpsLocation) return;\n\n\t\t\ttry {\n\t\t\t\tconst weatherData = await googleWeatherService.getWeatherData(\n\t\t\t\t\tfirstTechWithGps.gpsLocation.lat,\n\t\t\t\t\tfirstTechWithGps.gpsLocation.lng\n\t\t\t\t);\n\t\t\t\tif (weatherData) {\n\t\t\t\t\tsetWeather({\n\t\t\t\t\t\ttemperature: weatherData.current.temperature,\n\t\t\t\t\t\tcondition: weatherData.current.conditions,\n\t\t\t\t\t\ticon: weatherData.current.icon,\n\t\t\t\t\t\talerts: weatherData.alerts,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Error fetching weather:\", error);\n\t\t\t}\n\t\t};\n\n\t\tfetchWeather();\n\t\t// Refresh weather every 10 minutes\n\t\tconst interval = setInterval(fetchWeather, 10 * 60 * 1000);\n\t\treturn () => clearInterval(interval);\n\t}, [techniciansWithData]);\n\n\t// Fetch ETAs for technicians with GPS to their next job\n\tuseEffect(() => {\n\t\tconst fetchETAs = async () => {\n\t\t\tconst etaPromises: Promise<void>[] = [];\n\t\t\tconst newETAs = new Map<string, { durationMinutes: number; distanceKm: number; arrivalTime: string }>();\n\n\t\t\tfor (const tech of techniciansWithData) {\n\t\t\t\tif (!tech.gpsLocation || !tech.nextJob) continue;\n\n\t\t\t\tconst jobCoords = getJobCoordinates(tech.nextJob);\n\t\t\t\tif (!jobCoords) continue;\n\n\t\t\t\tconst promise = (async () => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst eta = await googleRoutesService.getETA(\n\t\t\t\t\t\t\t{ lat: tech.gpsLocation!.lat, lon: tech.gpsLocation!.lng },\n\t\t\t\t\t\t\t{ lat: jobCoords.lat, lon: jobCoords.lng }\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (eta) {\n\t\t\t\t\t\t\tnewETAs.set(tech.id, {\n\t\t\t\t\t\t\t\tdurationMinutes: eta.durationMinutes,\n\t\t\t\t\t\t\t\tdistanceKm: eta.distanceKm,\n\t\t\t\t\t\t\t\tarrivalTime: eta.arrivalTime,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error(`Error fetching ETA for tech ${tech.id}:`, error);\n\t\t\t\t\t}\n\t\t\t\t})();\n\t\t\t\tetaPromises.push(promise);\n\t\t\t}\n\n\t\t\tawait Promise.all(etaPromises);\n\t\t\tif (newETAs.size > 0) {\n\t\t\t\tsetTechnicianETAs(newETAs);\n\t\t\t}\n\t\t};\n\n\t\t// Only fetch if we have technicians with GPS\n\t\tif (techniciansWithData.some(t => t.gpsLocation && t.nextJob)) {\n\t\t\tfetchETAs();\n\t\t\t// Refresh ETAs every 2 minutes\n\t\t\tconst interval = setInterval(fetchETAs, 2 * 60 * 1000);\n\t\t\treturn () => clearInterval(interval);\n\t\t}\n\t}, [techniciansWithData]);\n\n\t// Optimize all routes for technicians\n\tconst handleOptimizeRoutes = useCallback(async () => {\n\t\tsetIsOptimizingRoutes(true);\n\t\ttry {\n\t\t\tconst map = mapInstanceRef.current;\n\t\t\tif (!map) return;\n\n\t\t\t// Clear existing polylines\n\t\t\tfor (const polyline of polylinesRef.current.values()) {\n\t\t\t\tpolyline.setMap(null);\n\t\t\t}\n\t\t\tpolylinesRef.current.clear();\n\n\t\t\tconst colors = [\"#3b82f6\", \"#10b981\", \"#f59e0b\", \"#8b5cf6\", \"#ef4444\", \"#ec4899\"];\n\n\t\t\t// Get optimized routes for each technician\n\t\t\tfor (let i = 0; i < techniciansWithData.length; i++) {\n\t\t\t\tconst tech = techniciansWithData[i];\n\t\t\t\tif (!tech.gpsLocation || tech.appointments.length === 0) continue;\n\n\t\t\t\t// Build stops array\n\t\t\t\tconst stops: Array<{ lat: number; lon: number; address?: string; jobId?: string }> = [\n\t\t\t\t\t{ lat: tech.gpsLocation.lat, lon: tech.gpsLocation.lng },\n\t\t\t\t];\n\n\t\t\t\tfor (const apt of tech.appointments) {\n\t\t\t\t\tif (!apt.job) continue;\n\t\t\t\t\tconst coords = getJobCoordinates(apt.job);\n\t\t\t\t\tif (coords) {\n\t\t\t\t\t\tstops.push({\n\t\t\t\t\t\t\tlat: coords.lat,\n\t\t\t\t\t\t\tlon: coords.lng,\n\t\t\t\t\t\t\taddress: getJobAddress(apt.job),\n\t\t\t\t\t\t\tjobId: apt.job.id,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (stops.length < 2) continue;\n\n\t\t\t\ttry {\n\t\t\t\t\t// Get optimized multi-stop route from Google\n\t\t\t\t\tconst optimizedRoute = await googleRoutesService.getMultiStopRoute(stops, true);\n\t\t\t\t\tif (optimizedRoute && optimizedRoute.polyline) {\n\t\t\t\t\t\t// Decode the polyline and draw it\n\t\t\t\t\t\tconst decodedPath = google.maps.geometry?.encoding?.decodePath(optimizedRoute.polyline);\n\t\t\t\t\t\tif (decodedPath) {\n\t\t\t\t\t\t\tconst polyline = new google.maps.Polyline({\n\t\t\t\t\t\t\t\tpath: decodedPath,\n\t\t\t\t\t\t\t\tgeodesic: true,\n\t\t\t\t\t\t\t\tstrokeColor: colors[i % colors.length],\n\t\t\t\t\t\t\t\tstrokeOpacity: 0.8,\n\t\t\t\t\t\t\t\tstrokeWeight: 4,\n\t\t\t\t\t\t\t\tmap,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tpolylinesRef.current.set(`route-${tech.id}`, polyline);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(`Error optimizing route for tech ${tech.id}:`, error);\n\t\t\t\t\t// Fall back to straight lines\n\t\t\t\t\tconst path = stops.map(s => ({ lat: s.lat, lng: s.lon }));\n\t\t\t\t\tconst polyline = new google.maps.Polyline({\n\t\t\t\t\t\tpath,\n\t\t\t\t\t\tgeodesic: true,\n\t\t\t\t\t\tstrokeColor: colors[i % colors.length],\n\t\t\t\t\t\tstrokeOpacity: 0.7,\n\t\t\t\t\t\tstrokeWeight: 3,\n\t\t\t\t\t\tmap,\n\t\t\t\t\t});\n\t\t\t\t\tpolylinesRef.current.set(`route-${tech.id}`, polyline);\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error optimizing routes:\", error);\n\t\t} finally {\n\t\t\tsetIsOptimizingRoutes(false);\n\t\t}\n\t}, [techniciansWithData]);\n\n\t// Fit bounds to all markers\n\tconst handleFitBounds = useCallback(() => {\n\t\tif (!mapInstanceRef.current) return;\n\n\t\tconst bounds = new google.maps.LatLngBounds();\n\t\tlet hasPoints = false;\n\n\t\tfor (const tech of techniciansWithData) {\n\t\t\tif (tech.gpsLocation) {\n\t\t\t\tbounds.extend({ lat: Number(tech.gpsLocation.lat), lng: Number(tech.gpsLocation.lng) });\n\t\t\t\thasPoints = true;\n\t\t\t}\n\t\t}\n\n\t\tfor (const apt of appointments) {\n\t\t\tif (apt.job) {\n\t\t\t\tconst coords = getJobCoordinates(apt.job);\n\t\t\t\tif (coords) {\n\t\t\t\t\tbounds.extend(coords);\n\t\t\t\t\thasPoints = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (hasPoints) {\n\t\t\tmapInstanceRef.current.fitBounds(bounds, 50);\n\t\t}\n\t}, [techniciansWithData, appointments]);\n\n\t// Center on selected technician\n\tuseEffect(() => {\n\t\tif (!mapInstanceRef.current || !selectedTech?.gpsLocation) return;\n\t\tmapInstanceRef.current.panTo({\n\t\t\tlat: Number(selectedTech.gpsLocation.lat),\n\t\t\tlng: Number(selectedTech.gpsLocation.lng),\n\t\t});\n\t\tmapInstanceRef.current.setZoom(15);\n\t}, [selectedTech]);\n\n\t// Count technicians with GPS\n\tconst techsWithGps = techniciansWithData.filter((t) => t.gpsLocation).length;\n\n\treturn (\n\t\t<div className=\"relative h-full w-full overflow-hidden\">\n\t\t\t{/* Floating Sidebar */}\n\t\t\t<div\n\t\t\t\tclassName={cn(\n\t\t\t\t\t\"absolute top-4 left-4 bottom-4 z-10 transition-all duration-300\",\n\t\t\t\t\tsidebarOpen ? \"w-80\" : \"w-12\"\n\t\t\t\t)}\n\t\t\t>\n\t\t\t\t<Card className=\"h-full flex flex-col overflow-hidden\">\n\t\t\t\t\t{/* Sidebar Header */}\n\t\t\t\t\t<CardHeader className=\"p-3 border-b flex-shrink-0\">\n\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t{sidebarOpen ? (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t<Users className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">Technicians</span>\n\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{technicians.length}\n\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 w-8\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => setSidebarOpen(false)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<ChevronLeft className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\t\tclassName=\"h-8 w-8\"\n\t\t\t\t\t\t\t\t\tonClick={() => setSidebarOpen(true)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<ChevronRight className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardHeader>\n\n\t\t\t\t\t{sidebarOpen && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{/* Search */}\n\t\t\t\t\t\t\t<div className=\"p-3 border-b\">\n\t\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t\t<Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Search technicians...\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"pl-9\"\n\t\t\t\t\t\t\t\t\t\tvalue={searchQuery}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setSearchQuery(e.target.value)}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Technician List */}\n\t\t\t\t\t\t\t<ScrollArea className=\"flex-1\">\n\t\t\t\t\t\t\t\t{filteredTechnicians.length > 0 ? (\n\t\t\t\t\t\t\t\t\tfilteredTechnicians.map((tech) => (\n\t\t\t\t\t\t\t\t\t\t<TechnicianListItem\n\t\t\t\t\t\t\t\t\t\t\tkey={tech.id}\n\t\t\t\t\t\t\t\t\t\t\ttech={tech}\n\t\t\t\t\t\t\t\t\t\t\tisSelected={selectedTechId === tech.id}\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tsetSelectedTechId(tech.id);\n\t\t\t\t\t\t\t\t\t\t\t\tsetSelectedJob(null);\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t))\n\t\t\t\t\t\t\t\t) : technicians.length === 0 ? (\n\t\t\t\t\t\t\t\t\t<div className=\"p-4 text-center\">\n\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-8 w-8 mx-auto mb-2 text-amber-500\" />\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-medium\">No technicians found</p>\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground mt-1\">\n\t\t\t\t\t\t\t\t\t\t\tAdd technicians to your team to see them here\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<div className=\"p-4 text-center text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tNo results for &quot;{searchQuery}&quot;\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</ScrollArea>\n\n\t\t\t\t\t\t\t{/* Live Status */}\n\t\t\t\t\t\t\t<div className=\"p-3 border-t bg-muted/30\">\n\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between text-xs\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"h-2 w-2 rounded-full bg-emerald-500 animate-pulse\" />\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">Live GPS Tracking</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t{techsWithGps}/{technicians.length} active\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</Card>\n\t\t\t</div>\n\n\t\t\t{/* Weather Widget */}\n\t\t\t{weather && (\n\t\t\t\t<div className=\"absolute top-4 left-[21rem] z-10\">\n\t\t\t\t\t<Card className=\"p-3 bg-background/95 backdrop-blur shadow-lg\">\n\t\t\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t\t\t{weather.condition.toLowerCase().includes(\"rain\") || weather.condition.toLowerCase().includes(\"storm\") ? (\n\t\t\t\t\t\t\t\t<CloudRain className=\"h-5 w-5 text-blue-500\" />\n\t\t\t\t\t\t\t) : weather.condition.toLowerCase().includes(\"cloud\") ? (\n\t\t\t\t\t\t\t\t<CloudRain className=\"h-5 w-5 text-gray-500\" />\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<Sun className=\"h-5 w-5 text-amber-500\" />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<span className=\"font-semibold\">{Math.round(weather.temperature)}°F</span>\n\t\t\t\t\t\t\t\t\t<span className=\"text-sm text-muted-foreground\">{weather.condition}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{weather.alerts.length > 0 && (\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1 text-xs text-amber-600\">\n\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-3 w-3\" />\n\t\t\t\t\t\t\t\t\t\t<span>{weather.alerts[0].headline}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Card>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{/* Map Controls */}\n\t\t\t<div className=\"absolute bottom-4 right-4 z-10 flex flex-col gap-2\">\n\t\t\t\t<TooltipProvider>\n\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\tclassName=\"shadow-lg\"\n\t\t\t\t\t\t\t\tonClick={handleOptimizeRoutes}\n\t\t\t\t\t\t\t\tdisabled={isOptimizingRoutes}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{isOptimizingRoutes ? (\n\t\t\t\t\t\t\t\t\t<RefreshCw className=\"h-4 w-4 animate-spin\" />\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<Route className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t<TooltipContent side=\"left\">\n\t\t\t\t\t\t\t<p className=\"font-medium\">Optimize Routes</p>\n\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Get optimal routes for all technicians</p>\n\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\tclassName=\"shadow-lg\"\n\t\t\t\t\t\t\t\tonClick={() => setShowQuickAppointment(true)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Plus className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t<TooltipContent side=\"left\">\n\t\t\t\t\t\t\t<p className=\"font-medium\">Quick Appointment</p>\n\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Or click anywhere on map</p>\n\t\t\t\t\t\t</TooltipContent>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t\t<Tooltip>\n\t\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\t\t\tclassName=\"shadow-lg\"\n\t\t\t\t\t\t\t\tonClick={handleFitBounds}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Locate className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t\t<TooltipContent side=\"left\">Fit all markers</TooltipContent>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</TooltipProvider>\n\t\t\t</div>\n\n\t\t\t{/* Unassigned Jobs Panel */}\n\t\t\t<UnassignedJobsPanel\n\t\t\t\tjobs={unassignedJobs}\n\t\t\t\tisOpen={showUnassigned}\n\t\t\t\tonToggle={() => setShowUnassigned(!showUnassigned)}\n\t\t\t\tonJobSelect={(job) => {\n\t\t\t\t\tsetSelectedJob(job);\n\t\t\t\t\tsetSelectedTechId(null);\n\t\t\t\t\tconst coords = getJobCoordinates(job);\n\t\t\t\t\tif (coords && mapInstanceRef.current) {\n\t\t\t\t\t\tmapInstanceRef.current.panTo(coords);\n\t\t\t\t\t\tmapInstanceRef.current.setZoom(15);\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t/>\n\n\t\t\t{/* Map Container - Wrapper isolates Google Maps DOM from React reconciliation */}\n\t\t\t<div className=\"h-full w-full bg-muted relative\">\n\t\t\t\t{/* Google Maps renders here - suppressHydrationWarning prevents React from trying to reconcile Google's DOM changes */}\n\t\t\t\t<div\n\t\t\t\t\tref={mapContainerRef}\n\t\t\t\t\tclassName=\"absolute inset-0\"\n\t\t\t\t\tsuppressHydrationWarning\n\t\t\t\t/>\n\t\t\t\t{/* Overlay for loading/error states */}\n\t\t\t\t{!isMapLoaded && !mapError && (\n\t\t\t\t\t<div className=\"absolute inset-0 flex items-center justify-center bg-muted z-10\">\n\t\t\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t\t\t<RefreshCw className=\"mx-auto h-8 w-8 animate-spin text-muted-foreground\" />\n\t\t\t\t\t\t\t<p className=\"mt-2 text-sm text-muted-foreground\">Loading map...</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t\t{mapError && (\n\t\t\t\t\t<div className=\"absolute inset-0 flex items-center justify-center bg-muted z-10\">\n\t\t\t\t\t\t<div className=\"text-center max-w-md\">\n\t\t\t\t\t\t\t<AlertTriangle className=\"mx-auto h-12 w-12 text-amber-500 mb-4\" />\n\t\t\t\t\t\t\t<h3 className=\"text-lg font-semibold mb-2\">Map Unavailable</h3>\n\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground mb-4\">{mapError}</p>\n\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\tPlease ensure the Google Maps API key is configured in your environment variables.\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\n\t\t\t{/* Bottom Detail Drawer */}\n\t\t\t<DetailDrawer\n\t\t\t\ttech={selectedTech}\n\t\t\t\tonClose={() => setSelectedTechId(null)}\n\t\t\t\tonNavigate={() => {\n\t\t\t\t\tif (selectedTech) {\n\t\t\t\t\t\trouter.push(`/dashboard/schedule/technician/${selectedTech.id}`);\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t/>\n\n\t\t\t{/* Quick Appointment Dialog - triggered by map click */}\n\t\t\t<QuickAppointmentDialog\n\t\t\t\topen={showQuickAppointment}\n\t\t\t\tonOpenChange={setShowQuickAppointment}\n\t\t\t\tlocation={clickedLocation}\n\t\t\t\ttechnicians={technicianOptions}\n\t\t\t\tnearbyCustomers={nearbyCustomers}\n\t\t\t\tonSuccess={(appointmentId) => {\n\t\t\t\t\t// Could optionally center map on new appointment or show toast\n\t\t\t\t\tconsole.log(\"Appointment created:\", appointmentId);\n\t\t\t\t}}\n\t\t\t\tonCreateCustomer={() => {\n\t\t\t\t\t// Open customer creation flow - navigate to customer creation page\n\t\t\t\t\trouter.push(\"/dashboard/customers/new\");\n\t\t\t\t}}\n\t\t\t/>\n\t\t</div>\n\t);\n}\n\n// ============================================================================\n// Export with Error Boundary Wrapper\n// ============================================================================\n\nexport function DispatchMapView(props: DispatchMapViewProps) {\n\treturn (\n\t\t<MapErrorBoundary>\n\t\t\t<DispatchMapViewInner {...props} />\n\t\t</MapErrorBoundary>\n\t);\n}\n","/**\n * Google Routes Service\n *\n * Provides routing, distance matrix, and ETA calculations using Google Routes API\n * - Real-time traffic-aware routing\n * - Multi-destination distance matrix\n * - Polyline encoding for map display\n * - ETA calculations with traffic\n *\n * API: Google Routes API (requires API key with Routes API enabled)\n * Docs: https://developers.google.com/maps/documentation/routes\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst LatLngSchema = z.object({\n\tlat: z.number(),\n\tlng: z.number(),\n});\n\nconst RouteSchema = z.object({\n\tdistance: z.number(), // meters\n\tduration: z.number(), // seconds (without traffic)\n\tdurationInTraffic: z.number(), // seconds (with traffic)\n\tfrom: LatLngSchema,\n\tto: LatLngSchema,\n\tpolyline: z.string().optional(), // Encoded polyline for map display\n\tsummary: z.string().optional(), // Route summary (e.g., \"via I-95 N\")\n\twarnings: z.array(z.string()).optional(),\n\ttrafficDelay: z.number(), // Additional seconds due to traffic\n});\n\nconst RouteMatrixElementSchema = z.object({\n\toriginIndex: z.number(),\n\tdestinationIndex: z.number(),\n\tdistance: z.number(), // meters\n\tduration: z.number(), // seconds\n\tdurationInTraffic: z.number(), // seconds with traffic\n\tstatus: z.enum([\"OK\", \"NOT_FOUND\", \"ZERO_RESULTS\"]),\n});\n\nconst RouteMatrixSchema = z.object({\n\telements: z.array(RouteMatrixElementSchema),\n\toriginAddresses: z.array(z.string()).optional(),\n\tdestinationAddresses: z.array(z.string()).optional(),\n});\n\nconst OptimizedRouteSchema = z.object({\n\ttotalDistance: z.number(), // meters\n\ttotalDuration: z.number(), // seconds\n\ttotalDurationInTraffic: z.number(), // seconds with traffic\n\toptimizedOrder: z.array(z.number()), // Original indices in optimized order\n\tlegs: z.array(\n\t\tz.object({\n\t\t\tfrom: LatLngSchema,\n\t\t\tto: LatLngSchema,\n\t\t\tdistance: z.number(),\n\t\t\tduration: z.number(),\n\t\t\tdurationInTraffic: z.number(),\n\t\t\tpolyline: z.string().optional(),\n\t\t}),\n\t),\n\tpolyline: z.string().optional(), // Full route polyline\n});\n\nexport type LatLng = z.infer<typeof LatLngSchema>;\nexport type Route = z.infer<typeof RouteSchema>;\nexport type RouteMatrixElement = z.infer<typeof RouteMatrixElementSchema>;\nexport type RouteMatrix = z.infer<typeof RouteMatrixSchema>;\nexport type OptimizedRoute = z.infer<typeof OptimizedRouteSchema>;\n\n// ============================================================================\n// Cache Configuration\n// ============================================================================\n\nconst CACHE_TTL = 5 * 60 * 1000; // 5 minutes for route calculations\nconst MATRIX_CACHE_TTL = 10 * 60 * 1000; // 10 minutes for matrix calculations\n\n// ============================================================================\n// Google Routes Service\n// ============================================================================\n\nclass GoogleRoutesService {\n\tprivate readonly apiKey: string | undefined;\n\tprivate readonly routeCache: Map<string, { data: Route; timestamp: number }> =\n\t\tnew Map();\n\tprivate readonly matrixCache: Map<\n\t\tstring,\n\t\t{ data: RouteMatrix; timestamp: number }\n\t> = new Map();\n\n\tconstructor() {\n\t\t// Use unified GOOGLE_API_KEY for all Google services\n\t\tthis.apiKey =\n\t\t\tprocess.env.GOOGLE_API_KEY ||\n\t\t\tprocess.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY ||\n\t\t\tprocess.env.GOOGLE_MAPS_API_KEY;\n\t}\n\n\t/**\n\t * Check if service is available\n\t */\n\tisAvailable(): boolean {\n\t\treturn !!this.apiKey;\n\t}\n\n\t/**\n\t * Calculate route between two points with real-time traffic\n\t */\n\tasync getRoute(from: LatLng, to: LatLng): Promise<Route | null> {\n\t\tif (!this.apiKey) {\n\t\t\tconsole.warn(\"Google Routes Service: No API key configured\");\n\t\t\treturn this.getFallbackRoute(from, to);\n\t\t}\n\n\t\tconst cacheKey = `route:${from.lat.toFixed(5)},${from.lng.toFixed(5)}-${to.lat.toFixed(5)},${to.lng.toFixed(5)}`;\n\t\tconst cached = this.routeCache.get(cacheKey);\n\t\tif (cached && Date.now() - cached.timestamp < CACHE_TTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\t// Use Google Directions API with traffic\n\t\t\tconst url = new URL(\n\t\t\t\t\"https://maps.googleapis.com/maps/api/directions/json\",\n\t\t\t);\n\t\t\turl.searchParams.set(\"origin\", `${from.lat},${from.lng}`);\n\t\t\turl.searchParams.set(\"destination\", `${to.lat},${to.lng}`);\n\t\t\turl.searchParams.set(\"departure_time\", \"now\");\n\t\t\turl.searchParams.set(\"traffic_model\", \"best_guess\");\n\t\t\turl.searchParams.set(\"key\", this.apiKey);\n\n\t\t\tconst response = await fetch(url.toString(), {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t`Google Routes API error: ${response.status} ${response.statusText}`,\n\t\t\t\t);\n\t\t\t\treturn this.getFallbackRoute(from, to);\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\n\t\t\tif (data.status !== \"OK\" || !data.routes?.[0]) {\n\t\t\t\tconsole.warn(`Google Routes API returned status: ${data.status}`);\n\t\t\t\treturn this.getFallbackRoute(from, to);\n\t\t\t}\n\n\t\t\tconst googleRoute = data.routes[0];\n\t\t\tconst leg = googleRoute.legs[0];\n\n\t\t\tconst duration = leg.duration?.value || 0;\n\t\t\tconst durationInTraffic = leg.duration_in_traffic?.value || duration;\n\n\t\t\tconst route: Route = {\n\t\t\t\tdistance: leg.distance?.value || 0,\n\t\t\t\tduration,\n\t\t\t\tdurationInTraffic,\n\t\t\t\tfrom,\n\t\t\t\tto,\n\t\t\t\tpolyline: googleRoute.overview_polyline?.points,\n\t\t\t\tsummary: googleRoute.summary,\n\t\t\t\twarnings: googleRoute.warnings || [],\n\t\t\t\ttrafficDelay: Math.max(0, durationInTraffic - duration),\n\t\t\t};\n\n\t\t\tconst validated = RouteSchema.parse(route);\n\t\t\tthis.routeCache.set(cacheKey, { data: validated, timestamp: Date.now() });\n\n\t\t\t// Clean up old cache entries\n\t\t\tthis.cleanCache(this.routeCache, CACHE_TTL);\n\n\t\t\treturn validated;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Google Routes Service error:\", error);\n\t\t\treturn this.getFallbackRoute(from, to);\n\t\t}\n\t}\n\n\t/**\n\t * Calculate routes from multiple origins to multiple destinations (matrix)\n\t * More efficient than individual route requests when dealing with many points\n\t */\n\tasync getRouteMatrix(\n\t\torigins: LatLng[],\n\t\tdestinations: LatLng[],\n\t): Promise<RouteMatrix | null> {\n\t\tif (!this.apiKey) {\n\t\t\tconsole.warn(\"Google Routes Service: No API key configured for matrix\");\n\t\t\treturn null;\n\t\t}\n\n\t\tif (origins.length === 0 || destinations.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Limit to avoid API limits (max 25 origins or 25 destinations)\n\t\tconst limitedOrigins = origins.slice(0, 25);\n\t\tconst limitedDestinations = destinations.slice(0, 25);\n\n\t\tconst cacheKey = `matrix:${limitedOrigins.map((o) => `${o.lat.toFixed(4)},${o.lng.toFixed(4)}`).join(\"|\")}-${limitedDestinations.map((d) => `${d.lat.toFixed(4)},${d.lng.toFixed(4)}`).join(\"|\")}`;\n\n\t\tconst cached = this.matrixCache.get(cacheKey);\n\t\tif (cached && Date.now() - cached.timestamp < MATRIX_CACHE_TTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\tconst url = new URL(\n\t\t\t\t\"https://maps.googleapis.com/maps/api/distancematrix/json\",\n\t\t\t);\n\t\t\turl.searchParams.set(\n\t\t\t\t\"origins\",\n\t\t\t\tlimitedOrigins.map((o) => `${o.lat},${o.lng}`).join(\"|\"),\n\t\t\t);\n\t\t\turl.searchParams.set(\n\t\t\t\t\"destinations\",\n\t\t\t\tlimitedDestinations.map((d) => `${d.lat},${d.lng}`).join(\"|\"),\n\t\t\t);\n\t\t\turl.searchParams.set(\"departure_time\", \"now\");\n\t\t\turl.searchParams.set(\"traffic_model\", \"best_guess\");\n\t\t\turl.searchParams.set(\"key\", this.apiKey);\n\n\t\t\tconst response = await fetch(url.toString(), {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t`Google Distance Matrix API error: ${response.status} ${response.statusText}`,\n\t\t\t\t);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\n\t\t\tif (data.status !== \"OK\") {\n\t\t\t\tconsole.warn(`Google Distance Matrix API status: ${data.status}`);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst elements: RouteMatrixElement[] = [];\n\n\t\t\tfor (let i = 0; i < data.rows.length; i++) {\n\t\t\t\tfor (let j = 0; j < data.rows[i].elements.length; j++) {\n\t\t\t\t\tconst element = data.rows[i].elements[j];\n\t\t\t\t\tconst duration = element.duration?.value || 0;\n\t\t\t\t\tconst durationInTraffic = element.duration_in_traffic?.value || duration;\n\n\t\t\t\t\telements.push({\n\t\t\t\t\t\toriginIndex: i,\n\t\t\t\t\t\tdestinationIndex: j,\n\t\t\t\t\t\tdistance: element.distance?.value || 0,\n\t\t\t\t\t\tduration,\n\t\t\t\t\t\tdurationInTraffic,\n\t\t\t\t\t\tstatus:\n\t\t\t\t\t\t\telement.status === \"OK\"\n\t\t\t\t\t\t\t\t? \"OK\"\n\t\t\t\t\t\t\t\t: element.status === \"ZERO_RESULTS\"\n\t\t\t\t\t\t\t\t\t? \"ZERO_RESULTS\"\n\t\t\t\t\t\t\t\t\t: \"NOT_FOUND\",\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst matrix: RouteMatrix = {\n\t\t\t\telements,\n\t\t\t\toriginAddresses: data.origin_addresses,\n\t\t\t\tdestinationAddresses: data.destination_addresses,\n\t\t\t};\n\n\t\t\tconst validated = RouteMatrixSchema.parse(matrix);\n\t\t\tthis.matrixCache.set(cacheKey, {\n\t\t\t\tdata: validated,\n\t\t\t\ttimestamp: Date.now(),\n\t\t\t});\n\n\t\t\t// Clean up old cache entries\n\t\t\tthis.cleanCache(this.matrixCache, MATRIX_CACHE_TTL);\n\n\t\t\treturn validated;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Google Distance Matrix error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get ETA from one location to another with traffic\n\t */\n\tasync getETA(from: LatLng, to: LatLng): Promise<{\n\t\teta: Date;\n\t\tdurationMinutes: number;\n\t\tdurationText: string;\n\t\ttrafficDelayMinutes: number;\n\t} | null> {\n\t\tconst route = await this.getRoute(from, to);\n\t\tif (!route) return null;\n\n\t\tconst now = new Date();\n\t\tconst eta = new Date(now.getTime() + route.durationInTraffic * 1000);\n\t\tconst durationMinutes = Math.ceil(route.durationInTraffic / 60);\n\t\tconst trafficDelayMinutes = Math.ceil(route.trafficDelay / 60);\n\n\t\treturn {\n\t\t\teta,\n\t\t\tdurationMinutes,\n\t\t\tdurationText: this.formatDuration(route.durationInTraffic),\n\t\t\ttrafficDelayMinutes,\n\t\t};\n\t}\n\n\t/**\n\t * Get optimal technician assignment based on current location and traffic\n\t * Returns technicians sorted by ETA to the job location\n\t */\n\tasync rankTechniciansByETA(\n\t\ttechnicianLocations: Array<{ id: string; location: LatLng; name?: string }>,\n\t\tjobLocation: LatLng,\n\t): Promise<\n\t\tArray<{\n\t\t\tid: string;\n\t\t\tname?: string;\n\t\t\tetaMinutes: number;\n\t\t\tdistanceKm: number;\n\t\t\ttrafficDelayMinutes: number;\n\t\t}>\n\t> {\n\t\tif (technicianLocations.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\t// Use matrix API for efficiency\n\t\tconst origins = technicianLocations.map((t) => t.location);\n\t\tconst destinations = [jobLocation];\n\n\t\tconst matrix = await this.getRouteMatrix(origins, destinations);\n\n\t\tif (!matrix) {\n\t\t\t// Fallback: use individual routes\n\t\t\tconst results = await Promise.all(\n\t\t\t\ttechnicianLocations.map(async (tech) => {\n\t\t\t\t\tconst route = await this.getRoute(tech.location, jobLocation);\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: tech.id,\n\t\t\t\t\t\tname: tech.name,\n\t\t\t\t\t\tetaMinutes: route\n\t\t\t\t\t\t\t? Math.ceil(route.durationInTraffic / 60)\n\t\t\t\t\t\t\t: Number.POSITIVE_INFINITY,\n\t\t\t\t\t\tdistanceKm: route ? route.distance / 1000 : 0,\n\t\t\t\t\t\ttrafficDelayMinutes: route\n\t\t\t\t\t\t\t? Math.ceil(route.trafficDelay / 60)\n\t\t\t\t\t\t\t: 0,\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\treturn results.sort((a, b) => a.etaMinutes - b.etaMinutes);\n\t\t}\n\n\t\t// Process matrix results\n\t\tconst results = technicianLocations.map((tech, index) => {\n\t\t\tconst element = matrix.elements.find(\n\t\t\t\t(e) => e.originIndex === index && e.destinationIndex === 0,\n\t\t\t);\n\n\t\t\tif (!element || element.status !== \"OK\") {\n\t\t\t\treturn {\n\t\t\t\t\tid: tech.id,\n\t\t\t\t\tname: tech.name,\n\t\t\t\t\tetaMinutes: Number.POSITIVE_INFINITY,\n\t\t\t\t\tdistanceKm: 0,\n\t\t\t\t\ttrafficDelayMinutes: 0,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tid: tech.id,\n\t\t\t\tname: tech.name,\n\t\t\t\tetaMinutes: Math.ceil(element.durationInTraffic / 60),\n\t\t\t\tdistanceKm: element.distance / 1000,\n\t\t\t\ttrafficDelayMinutes: Math.ceil(\n\t\t\t\t\t(element.durationInTraffic - element.duration) / 60,\n\t\t\t\t),\n\t\t\t};\n\t\t});\n\n\t\treturn results.sort((a, b) => a.etaMinutes - b.etaMinutes);\n\t}\n\n\t/**\n\t * Calculate optimal route visiting multiple stops (simple greedy nearest neighbor)\n\t * For more complex optimization, use RouteOptimizationService\n\t */\n\tasync getMultiStopRoute(\n\t\torigin: LatLng,\n\t\tstops: LatLng[],\n\t\treturnToOrigin = false,\n\t): Promise<OptimizedRoute | null> {\n\t\tif (stops.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (stops.length === 1) {\n\t\t\tconst route = await this.getRoute(origin, stops[0]);\n\t\t\tif (!route) return null;\n\n\t\t\treturn {\n\t\t\t\ttotalDistance: route.distance,\n\t\t\t\ttotalDuration: route.duration,\n\t\t\t\ttotalDurationInTraffic: route.durationInTraffic,\n\t\t\t\toptimizedOrder: [0],\n\t\t\t\tlegs: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfrom: origin,\n\t\t\t\t\t\tto: stops[0],\n\t\t\t\t\t\tdistance: route.distance,\n\t\t\t\t\t\tduration: route.duration,\n\t\t\t\t\t\tdurationInTraffic: route.durationInTraffic,\n\t\t\t\t\t\tpolyline: route.polyline,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tpolyline: route.polyline,\n\t\t\t};\n\t\t}\n\n\t\t// Get distance matrix from origin to all stops\n\t\tconst allPoints = [origin, ...stops];\n\t\tconst matrix = await this.getRouteMatrix(allPoints, allPoints);\n\n\t\tif (!matrix) {\n\t\t\t// Fallback: sequential route\n\t\t\treturn this.getSequentialRoute(origin, stops, returnToOrigin);\n\t\t}\n\n\t\t// Greedy nearest neighbor algorithm\n\t\tconst visited = new Set<number>();\n\t\tconst order: number[] = [];\n\t\tlet currentIndex = 0; // Start at origin\n\n\t\twhile (order.length < stops.length) {\n\t\t\tlet nearestIndex = -1;\n\t\t\tlet nearestDuration = Number.POSITIVE_INFINITY;\n\n\t\t\tfor (let i = 1; i <= stops.length; i++) {\n\t\t\t\tif (visited.has(i)) continue;\n\n\t\t\t\tconst element = matrix.elements.find(\n\t\t\t\t\t(e) => e.originIndex === currentIndex && e.destinationIndex === i,\n\t\t\t\t);\n\n\t\t\t\tif (element && element.status === \"OK\") {\n\t\t\t\t\tif (element.durationInTraffic < nearestDuration) {\n\t\t\t\t\t\tnearestDuration = element.durationInTraffic;\n\t\t\t\t\t\tnearestIndex = i;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (nearestIndex === -1) break;\n\n\t\t\tvisited.add(nearestIndex);\n\t\t\torder.push(nearestIndex - 1); // Convert back to stops index (0-based)\n\t\t\tcurrentIndex = nearestIndex;\n\t\t}\n\n\t\t// Build the optimized route\n\t\tconst legs: OptimizedRoute[\"legs\"] = [];\n\t\tlet totalDistance = 0;\n\t\tlet totalDuration = 0;\n\t\tlet totalDurationInTraffic = 0;\n\t\tlet currentPoint = origin;\n\n\t\tfor (const stopIndex of order) {\n\t\t\tconst targetPoint = stops[stopIndex];\n\t\t\tconst route = await this.getRoute(currentPoint, targetPoint);\n\n\t\t\tif (route) {\n\t\t\t\tlegs.push({\n\t\t\t\t\tfrom: currentPoint,\n\t\t\t\t\tto: targetPoint,\n\t\t\t\t\tdistance: route.distance,\n\t\t\t\t\tduration: route.duration,\n\t\t\t\t\tdurationInTraffic: route.durationInTraffic,\n\t\t\t\t\tpolyline: route.polyline,\n\t\t\t\t});\n\t\t\t\ttotalDistance += route.distance;\n\t\t\t\ttotalDuration += route.duration;\n\t\t\t\ttotalDurationInTraffic += route.durationInTraffic;\n\t\t\t}\n\n\t\t\tcurrentPoint = targetPoint;\n\t\t}\n\n\t\t// Optionally add return leg\n\t\tif (returnToOrigin && legs.length > 0) {\n\t\t\tconst returnRoute = await this.getRoute(currentPoint, origin);\n\t\t\tif (returnRoute) {\n\t\t\t\tlegs.push({\n\t\t\t\t\tfrom: currentPoint,\n\t\t\t\t\tto: origin,\n\t\t\t\t\tdistance: returnRoute.distance,\n\t\t\t\t\tduration: returnRoute.duration,\n\t\t\t\t\tdurationInTraffic: returnRoute.durationInTraffic,\n\t\t\t\t\tpolyline: returnRoute.polyline,\n\t\t\t\t});\n\t\t\t\ttotalDistance += returnRoute.distance;\n\t\t\t\ttotalDuration += returnRoute.duration;\n\t\t\t\ttotalDurationInTraffic += returnRoute.durationInTraffic;\n\t\t\t}\n\t\t}\n\n\t\treturn OptimizedRouteSchema.parse({\n\t\t\ttotalDistance,\n\t\t\ttotalDuration,\n\t\t\ttotalDurationInTraffic,\n\t\t\toptimizedOrder: order,\n\t\t\tlegs,\n\t\t});\n\t}\n\n\t/**\n\t * Sequential route (fallback when matrix unavailable)\n\t */\n\tprivate async getSequentialRoute(\n\t\torigin: LatLng,\n\t\tstops: LatLng[],\n\t\treturnToOrigin: boolean,\n\t): Promise<OptimizedRoute | null> {\n\t\tconst legs: OptimizedRoute[\"legs\"] = [];\n\t\tlet totalDistance = 0;\n\t\tlet totalDuration = 0;\n\t\tlet totalDurationInTraffic = 0;\n\t\tlet currentPoint = origin;\n\n\t\tfor (let i = 0; i < stops.length; i++) {\n\t\t\tconst route = await this.getRoute(currentPoint, stops[i]);\n\t\t\tif (route) {\n\t\t\t\tlegs.push({\n\t\t\t\t\tfrom: currentPoint,\n\t\t\t\t\tto: stops[i],\n\t\t\t\t\tdistance: route.distance,\n\t\t\t\t\tduration: route.duration,\n\t\t\t\t\tdurationInTraffic: route.durationInTraffic,\n\t\t\t\t\tpolyline: route.polyline,\n\t\t\t\t});\n\t\t\t\ttotalDistance += route.distance;\n\t\t\t\ttotalDuration += route.duration;\n\t\t\t\ttotalDurationInTraffic += route.durationInTraffic;\n\t\t\t}\n\t\t\tcurrentPoint = stops[i];\n\t\t}\n\n\t\tif (returnToOrigin) {\n\t\t\tconst returnRoute = await this.getRoute(currentPoint, origin);\n\t\t\tif (returnRoute) {\n\t\t\t\tlegs.push({\n\t\t\t\t\tfrom: currentPoint,\n\t\t\t\t\tto: origin,\n\t\t\t\t\tdistance: returnRoute.distance,\n\t\t\t\t\tduration: returnRoute.duration,\n\t\t\t\t\tdurationInTraffic: returnRoute.durationInTraffic,\n\t\t\t\t\tpolyline: returnRoute.polyline,\n\t\t\t\t});\n\t\t\t\ttotalDistance += returnRoute.distance;\n\t\t\t\ttotalDuration += returnRoute.duration;\n\t\t\t\ttotalDurationInTraffic += returnRoute.durationInTraffic;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\ttotalDistance,\n\t\t\ttotalDuration,\n\t\t\ttotalDurationInTraffic,\n\t\t\toptimizedOrder: stops.map((_, i) => i),\n\t\t\tlegs,\n\t\t};\n\t}\n\n\t/**\n\t * Fallback route using Haversine distance (when API unavailable)\n\t */\n\tprivate getFallbackRoute(from: LatLng, to: LatLng): Route {\n\t\tconst distance = this.calculateHaversineDistance(from, to);\n\t\t// Estimate duration: 40 km/h average city speed\n\t\tconst duration = Math.round((distance / 40000) * 3600);\n\n\t\treturn {\n\t\t\tdistance: Math.round(distance),\n\t\t\tduration,\n\t\t\tdurationInTraffic: duration, // No traffic data available\n\t\t\tfrom,\n\t\t\tto,\n\t\t\ttrafficDelay: 0,\n\t\t\twarnings: [\"Using estimated route - Google API unavailable\"],\n\t\t};\n\t}\n\n\t/**\n\t * Calculate Haversine distance between two points (meters)\n\t */\n\tprivate calculateHaversineDistance(from: LatLng, to: LatLng): number {\n\t\tconst R = 6371e3; // Earth radius in meters\n\t\tconst φ1 = (from.lat * Math.PI) / 180;\n\t\tconst φ2 = (to.lat * Math.PI) / 180;\n\t\tconst Δφ = ((to.lat - from.lat) * Math.PI) / 180;\n\t\tconst Δλ = ((to.lng - from.lng) * Math.PI) / 180;\n\n\t\tconst a =\n\t\t\tMath.sin(Δφ / 2) * Math.sin(Δφ / 2) +\n\t\t\tMath.cos(φ1) * Math.cos(φ2) * Math.sin(Δλ / 2) * Math.sin(Δλ / 2);\n\t\tconst c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n\t\treturn R * c;\n\t}\n\n\t/**\n\t * Format duration in human-readable form\n\t */\n\tformatDuration(seconds: number): string {\n\t\tif (seconds < 60) {\n\t\t\treturn `${Math.round(seconds)} sec`;\n\t\t}\n\t\tif (seconds < 3600) {\n\t\t\treturn `${Math.round(seconds / 60)} min`;\n\t\t}\n\t\tconst hours = Math.floor(seconds / 3600);\n\t\tconst mins = Math.round((seconds % 3600) / 60);\n\t\treturn `${hours}h ${mins}min`;\n\t}\n\n\t/**\n\t * Format distance in human-readable form\n\t */\n\tformatDistance(meters: number): string {\n\t\tif (meters < 1000) {\n\t\t\treturn `${Math.round(meters)} m`;\n\t\t}\n\t\tconst km = meters / 1000;\n\t\tconst miles = km * 0.621371;\n\t\treturn `${miles.toFixed(1)} mi`;\n\t}\n\n\t/**\n\t * Clean up old cache entries\n\t */\n\tprivate cleanCache(\n\t\tcache: Map<string, { data: unknown; timestamp: number }>,\n\t\tttl: number,\n\t): void {\n\t\tconst now = Date.now();\n\t\tfor (const [key, value] of cache.entries()) {\n\t\t\tif (now - value.timestamp > ttl * 2) {\n\t\t\t\tcache.delete(key);\n\t\t\t}\n\t\t}\n\n\t\t// Keep cache size reasonable\n\t\tif (cache.size > 500) {\n\t\t\tconst entries = Array.from(cache.entries());\n\t\t\tentries.sort((a, b) => b[1].timestamp - a[1].timestamp);\n\t\t\tcache.clear();\n\t\t\tfor (const [key, value] of entries.slice(0, 250)) {\n\t\t\t\tcache.set(key, value);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Clear all caches\n\t */\n\tclearCache(): void {\n\t\tthis.routeCache.clear();\n\t\tthis.matrixCache.clear();\n\t}\n}\n\n// Singleton instance\nexport const googleRoutesService = new GoogleRoutesService();\n","/**\n * Google Weather Service\n *\n * Provides weather data using Google Weather API\n * - Current conditions\n * - Hourly forecast (48 hours)\n * - Daily forecast (10 days)\n * - Weather alerts\n * - Solar radiation data (for HVAC/Solar industries)\n *\n * API: Google Weather API\n * Docs: https://developers.google.com/maps/documentation/weather\n *\n * Fallback: Uses existing NWS service for US locations\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Thorbis-FMS/1.0 (support@thorbis.app)\";\n\n// ============================================================================\n// Types and Schemas\n// ============================================================================\n\nconst WeatherConditionSchema = z.object({\n\tcode: z.string(), // Weather condition code (e.g., \"CLEAR\", \"RAIN\", \"SNOW\")\n\tdescription: z.string(), // Human-readable description\n\ticon: z.string(), // Icon URL or code\n});\n\nconst CurrentWeatherSchema = z.object({\n\ttemperature: z.number(), // Celsius\n\ttemperatureFeelsLike: z.number(), // Celsius\n\thumidity: z.number(), // Percentage\n\tpressure: z.number(), // hPa\n\twindSpeed: z.number(), // m/s\n\twindDirection: z.number(), // Degrees\n\twindGust: z.number().optional(), // m/s\n\tvisibility: z.number().optional(), // meters\n\tuvIndex: z.number().optional(),\n\tcloudCover: z.number().optional(), // Percentage\n\tprecipitation: z.number().optional(), // mm in last hour\n\tcondition: WeatherConditionSchema,\n\tobservationTime: z.string(), // ISO timestamp\n});\n\nconst HourlyForecastSchema = z.object({\n\ttime: z.string(), // ISO timestamp\n\ttemperature: z.number(),\n\ttemperatureFeelsLike: z.number(),\n\thumidity: z.number(),\n\twindSpeed: z.number(),\n\twindDirection: z.number(),\n\tprecipitationProbability: z.number(), // Percentage\n\tprecipitationAmount: z.number().optional(), // mm\n\tcondition: WeatherConditionSchema,\n\tuvIndex: z.number().optional(),\n\tsolarRadiation: z.number().optional(), // W/m² (for solar calculations)\n});\n\nconst DailyForecastSchema = z.object({\n\tdate: z.string(), // YYYY-MM-DD\n\ttemperatureHigh: z.number(),\n\ttemperatureLow: z.number(),\n\thumidity: z.number(),\n\twindSpeed: z.number(),\n\twindDirection: z.number(),\n\tprecipitationProbability: z.number(),\n\tprecipitationAmount: z.number().optional(),\n\tcondition: WeatherConditionSchema,\n\tuvIndexMax: z.number().optional(),\n\tsunrise: z.string().optional(),\n\tsunset: z.string().optional(),\n\tmoonPhase: z.string().optional(),\n\tsolarRadiation: z.number().optional(), // Daily average W/m²\n});\n\nconst WeatherAlertSchema = z.object({\n\tevent: z.string(),\n\theadline: z.string(),\n\tdescription: z.string(),\n\tseverity: z.enum([\"Extreme\", \"Severe\", \"Moderate\", \"Minor\", \"Unknown\"]),\n\turgency: z.enum([\"Immediate\", \"Expected\", \"Future\", \"Past\", \"Unknown\"]),\n\tstart: z.string().optional(),\n\tend: z.string().optional(),\n\tinstruction: z.string().optional(),\n\tsource: z.string().optional(),\n});\n\nconst WeatherDataSchema = z.object({\n\tlocation: z.object({\n\t\tlat: z.number(),\n\t\tlng: z.number(),\n\t\tname: z.string().optional(),\n\t\ttimezone: z.string().optional(),\n\t}),\n\tcurrent: CurrentWeatherSchema.optional(),\n\thourly: z.array(HourlyForecastSchema).optional(),\n\tdaily: z.array(DailyForecastSchema).optional(),\n\talerts: z.array(WeatherAlertSchema),\n\tsource: z.enum([\"google\", \"nws\", \"openmeteo\"]),\n\tenrichedAt: z.string(),\n});\n\nexport type WeatherCondition = z.infer<typeof WeatherConditionSchema>;\nexport type CurrentWeather = z.infer<typeof CurrentWeatherSchema>;\nexport type HourlyForecast = z.infer<typeof HourlyForecastSchema>;\nexport type DailyForecast = z.infer<typeof DailyForecastSchema>;\nexport type WeatherAlert = z.infer<typeof WeatherAlertSchema>;\nexport type WeatherData = z.infer<typeof WeatherDataSchema>;\n\n// ============================================================================\n// Cache Configuration\n// ============================================================================\n\nconst CACHE_TTL = 30 * 60 * 1000; // 30 minutes\n\n// ============================================================================\n// Google Weather Service\n// ============================================================================\n\nclass GoogleWeatherService {\n\tprivate readonly apiKey: string | undefined;\n\tprivate readonly cache: Map<\n\t\tstring,\n\t\t{ data: WeatherData; timestamp: number }\n\t> = new Map();\n\n\tconstructor() {\n\t\t// Use unified GOOGLE_API_KEY for all Google services\n\t\tthis.apiKey =\n\t\t\tprocess.env.GOOGLE_API_KEY ||\n\t\t\tprocess.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY ||\n\t\t\tprocess.env.GOOGLE_MAPS_API_KEY;\n\t}\n\n\t/**\n\t * Check if service is available\n\t */\n\tisAvailable(): boolean {\n\t\treturn !!this.apiKey;\n\t}\n\n\t/**\n\t * Get complete weather data for a location\n\t * Uses Open-Meteo API (free, no API key required) as primary source\n\t * since Google Weather API requires special access\n\t */\n\tasync getWeatherData(lat: number, lng: number): Promise<WeatherData | null> {\n\t\tconst cacheKey = `weather:${lat.toFixed(4)},${lng.toFixed(4)}`;\n\t\tconst cached = this.cache.get(cacheKey);\n\t\tif (cached && Date.now() - cached.timestamp < CACHE_TTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\t// Use Open-Meteo API (free, reliable, global coverage)\n\t\t\tconst weather = await this.fetchFromOpenMeteo(lat, lng);\n\t\t\tif (weather) {\n\t\t\t\tthis.cache.set(cacheKey, { data: weather, timestamp: Date.now() });\n\t\t\t\tthis.cleanCache();\n\t\t\t\treturn weather;\n\t\t\t}\n\n\t\t\t// Fallback to NWS for US locations\n\t\t\tif (this.isUSLocation(lat, lng)) {\n\t\t\t\tconst nwsWeather = await this.fetchFromNWS(lat, lng);\n\t\t\t\tif (nwsWeather) {\n\t\t\t\t\tthis.cache.set(cacheKey, {\n\t\t\t\t\t\tdata: nwsWeather,\n\t\t\t\t\t\ttimestamp: Date.now(),\n\t\t\t\t\t});\n\t\t\t\t\treturn nwsWeather;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Weather service error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Fetch weather from Open-Meteo (free, global coverage)\n\t */\n\tprivate async fetchFromOpenMeteo(\n\t\tlat: number,\n\t\tlng: number,\n\t): Promise<WeatherData | null> {\n\t\ttry {\n\t\t\tconst url = new URL(\"https://api.open-meteo.com/v1/forecast\");\n\t\t\turl.searchParams.set(\"latitude\", lat.toString());\n\t\t\turl.searchParams.set(\"longitude\", lng.toString());\n\t\t\turl.searchParams.set(\n\t\t\t\t\"current\",\n\t\t\t\t\"temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,cloud_cover,pressure_msl,wind_speed_10m,wind_direction_10m,wind_gusts_10m,uv_index\",\n\t\t\t);\n\t\t\turl.searchParams.set(\n\t\t\t\t\"hourly\",\n\t\t\t\t\"temperature_2m,relative_humidity_2m,apparent_temperature,precipitation_probability,precipitation,weather_code,wind_speed_10m,wind_direction_10m,uv_index,direct_radiation\",\n\t\t\t);\n\t\t\turl.searchParams.set(\n\t\t\t\t\"daily\",\n\t\t\t\t\"weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,precipitation_probability_max,wind_speed_10m_max,wind_direction_10m_dominant,uv_index_max,sunrise,sunset\",\n\t\t\t);\n\t\t\turl.searchParams.set(\"timezone\", \"auto\");\n\t\t\turl.searchParams.set(\"forecast_days\", \"10\");\n\n\t\t\tconst response = await fetch(url.toString(), {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.error(`Open-Meteo API error: ${response.status}`);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\n\t\t\t// Parse current weather\n\t\t\tconst current: CurrentWeather = {\n\t\t\t\ttemperature: data.current.temperature_2m,\n\t\t\t\ttemperatureFeelsLike: data.current.apparent_temperature,\n\t\t\t\thumidity: data.current.relative_humidity_2m,\n\t\t\t\tpressure: data.current.pressure_msl,\n\t\t\t\twindSpeed: data.current.wind_speed_10m / 3.6, // km/h to m/s\n\t\t\t\twindDirection: data.current.wind_direction_10m,\n\t\t\t\twindGust: data.current.wind_gusts_10m\n\t\t\t\t\t? data.current.wind_gusts_10m / 3.6\n\t\t\t\t\t: undefined,\n\t\t\t\tuvIndex: data.current.uv_index,\n\t\t\t\tcloudCover: data.current.cloud_cover,\n\t\t\t\tprecipitation: data.current.precipitation,\n\t\t\t\tcondition: this.getConditionFromCode(data.current.weather_code),\n\t\t\t\tobservationTime: data.current.time,\n\t\t\t};\n\n\t\t\t// Parse hourly forecast (next 48 hours)\n\t\t\tconst hourly: HourlyForecast[] = [];\n\t\t\tconst hourlyLen = Math.min(48, data.hourly.time.length);\n\t\t\tfor (let i = 0; i < hourlyLen; i++) {\n\t\t\t\thourly.push({\n\t\t\t\t\ttime: data.hourly.time[i],\n\t\t\t\t\ttemperature: data.hourly.temperature_2m[i],\n\t\t\t\t\ttemperatureFeelsLike: data.hourly.apparent_temperature[i],\n\t\t\t\t\thumidity: data.hourly.relative_humidity_2m[i],\n\t\t\t\t\twindSpeed: data.hourly.wind_speed_10m[i] / 3.6,\n\t\t\t\t\twindDirection: data.hourly.wind_direction_10m[i],\n\t\t\t\t\tprecipitationProbability: data.hourly.precipitation_probability[i],\n\t\t\t\t\tprecipitationAmount: data.hourly.precipitation[i],\n\t\t\t\t\tcondition: this.getConditionFromCode(data.hourly.weather_code[i]),\n\t\t\t\t\tuvIndex: data.hourly.uv_index[i],\n\t\t\t\t\tsolarRadiation: data.hourly.direct_radiation?.[i],\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Parse daily forecast\n\t\t\tconst daily: DailyForecast[] = [];\n\t\t\tfor (let i = 0; i < data.daily.time.length; i++) {\n\t\t\t\tdaily.push({\n\t\t\t\t\tdate: data.daily.time[i],\n\t\t\t\t\ttemperatureHigh: data.daily.temperature_2m_max[i],\n\t\t\t\t\ttemperatureLow: data.daily.temperature_2m_min[i],\n\t\t\t\t\thumidity: 0, // Not available in daily\n\t\t\t\t\twindSpeed: data.daily.wind_speed_10m_max[i] / 3.6,\n\t\t\t\t\twindDirection: data.daily.wind_direction_10m_dominant[i],\n\t\t\t\t\tprecipitationProbability: data.daily.precipitation_probability_max[i],\n\t\t\t\t\tprecipitationAmount: data.daily.precipitation_sum[i],\n\t\t\t\t\tcondition: this.getConditionFromCode(data.daily.weather_code[i]),\n\t\t\t\t\tuvIndexMax: data.daily.uv_index_max[i],\n\t\t\t\t\tsunrise: data.daily.sunrise[i],\n\t\t\t\t\tsunset: data.daily.sunset[i],\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tlocation: {\n\t\t\t\t\tlat,\n\t\t\t\t\tlng,\n\t\t\t\t\ttimezone: data.timezone,\n\t\t\t\t},\n\t\t\t\tcurrent,\n\t\t\t\thourly,\n\t\t\t\tdaily,\n\t\t\t\talerts: [], // Open-Meteo doesn't provide alerts\n\t\t\t\tsource: \"openmeteo\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Open-Meteo fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Fetch weather from NWS (US only, free)\n\t */\n\tprivate async fetchFromNWS(\n\t\tlat: number,\n\t\tlng: number,\n\t): Promise<WeatherData | null> {\n\t\ttry {\n\t\t\t// Get grid point\n\t\t\tconst pointsRes = await fetch(\n\t\t\t\t`https://api.weather.gov/points/${lat.toFixed(4)},${lng.toFixed(4)}`,\n\t\t\t\t{\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"User-Agent\": USER_AGENT,\n\t\t\t\t\t\tAccept: \"application/geo+json\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tif (!pointsRes.ok) return null;\n\n\t\t\tconst pointsData = await pointsRes.json();\n\t\t\tconst props = pointsData.properties;\n\n\t\t\t// Fetch forecast and alerts in parallel\n\t\t\tconst [forecastRes, alertsRes] = await Promise.all([\n\t\t\t\tfetch(props.forecast, {\n\t\t\t\t\theaders: { \"User-Agent\": USER_AGENT, Accept: \"application/geo+json\" },\n\t\t\t\t}),\n\t\t\t\tfetch(`https://api.weather.gov/alerts/active?point=${lat},${lng}`, {\n\t\t\t\t\theaders: { \"User-Agent\": USER_AGENT, Accept: \"application/geo+json\" },\n\t\t\t\t}),\n\t\t\t]);\n\n\t\t\tconst forecastData = forecastRes.ok ? await forecastRes.json() : null;\n\t\t\tconst alertsData = alertsRes.ok ? await alertsRes.json() : null;\n\n\t\t\t// Parse alerts\n\t\t\tconst alerts: WeatherAlert[] = (alertsData?.features || []).map(\n\t\t\t\t(f: any) => ({\n\t\t\t\t\tevent: f.properties.event || \"Unknown\",\n\t\t\t\t\theadline: f.properties.headline || \"\",\n\t\t\t\t\tdescription: f.properties.description || \"\",\n\t\t\t\t\tseverity: this.mapNWSSeverity(f.properties.severity),\n\t\t\t\t\turgency: this.mapNWSUrgency(f.properties.urgency),\n\t\t\t\t\tstart: f.properties.onset,\n\t\t\t\t\tend: f.properties.expires,\n\t\t\t\t\tinstruction: f.properties.instruction,\n\t\t\t\t\tsource: \"NWS\",\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\t// Parse daily forecast from periods\n\t\t\tconst daily: DailyForecast[] = [];\n\t\t\tif (forecastData?.properties?.periods) {\n\t\t\t\tconst periods = forecastData.properties.periods;\n\t\t\t\tfor (let i = 0; i < periods.length; i += 2) {\n\t\t\t\t\tconst dayPeriod = periods[i];\n\t\t\t\t\tconst nightPeriod = periods[i + 1];\n\n\t\t\t\t\tdaily.push({\n\t\t\t\t\t\tdate: dayPeriod.startTime.split(\"T\")[0],\n\t\t\t\t\t\ttemperatureHigh: dayPeriod.isDaytime\n\t\t\t\t\t\t\t? dayPeriod.temperature\n\t\t\t\t\t\t\t: nightPeriod?.temperature || dayPeriod.temperature,\n\t\t\t\t\t\ttemperatureLow: nightPeriod?.temperature || dayPeriod.temperature,\n\t\t\t\t\t\thumidity: 0,\n\t\t\t\t\t\twindSpeed: this.parseWindSpeed(dayPeriod.windSpeed),\n\t\t\t\t\t\twindDirection: this.parseWindDirection(dayPeriod.windDirection),\n\t\t\t\t\t\tprecipitationProbability: 0,\n\t\t\t\t\t\tcondition: this.mapNWSCondition(dayPeriod.shortForecast),\n\t\t\t\t\t\tuvIndexMax: undefined,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tlocation: {\n\t\t\t\t\tlat,\n\t\t\t\t\tlng,\n\t\t\t\t\tname: props.relativeLocation?.properties?.city,\n\t\t\t\t\ttimezone: props.timeZone,\n\t\t\t\t},\n\t\t\t\tdaily,\n\t\t\t\talerts,\n\t\t\t\tsource: \"nws\",\n\t\t\t\tenrichedAt: new Date().toISOString(),\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tconsole.error(\"NWS fetch error:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get weather condition from WMO code\n\t */\n\tprivate getConditionFromCode(code: number): WeatherCondition {\n\t\tconst conditions: Record<\n\t\t\tnumber,\n\t\t\t{ code: string; description: string; icon: string }\n\t\t> = {\n\t\t\t0: { code: \"CLEAR\", description: \"Clear sky\", icon: \"01d\" },\n\t\t\t1: { code: \"MOSTLY_CLEAR\", description: \"Mostly clear\", icon: \"02d\" },\n\t\t\t2: { code: \"PARTLY_CLOUDY\", description: \"Partly cloudy\", icon: \"03d\" },\n\t\t\t3: { code: \"OVERCAST\", description: \"Overcast\", icon: \"04d\" },\n\t\t\t45: { code: \"FOG\", description: \"Foggy\", icon: \"50d\" },\n\t\t\t48: { code: \"FOG\", description: \"Freezing fog\", icon: \"50d\" },\n\t\t\t51: { code: \"DRIZZLE\", description: \"Light drizzle\", icon: \"09d\" },\n\t\t\t53: { code: \"DRIZZLE\", description: \"Moderate drizzle\", icon: \"09d\" },\n\t\t\t55: { code: \"DRIZZLE\", description: \"Dense drizzle\", icon: \"09d\" },\n\t\t\t56: { code: \"FREEZING_DRIZZLE\", description: \"Freezing drizzle\", icon: \"09d\" },\n\t\t\t57: { code: \"FREEZING_DRIZZLE\", description: \"Dense freezing drizzle\", icon: \"09d\" },\n\t\t\t61: { code: \"RAIN\", description: \"Light rain\", icon: \"10d\" },\n\t\t\t63: { code: \"RAIN\", description: \"Moderate rain\", icon: \"10d\" },\n\t\t\t65: { code: \"RAIN\", description: \"Heavy rain\", icon: \"10d\" },\n\t\t\t66: { code: \"FREEZING_RAIN\", description: \"Freezing rain\", icon: \"13d\" },\n\t\t\t67: { code: \"FREEZING_RAIN\", description: \"Heavy freezing rain\", icon: \"13d\" },\n\t\t\t71: { code: \"SNOW\", description: \"Light snow\", icon: \"13d\" },\n\t\t\t73: { code: \"SNOW\", description: \"Moderate snow\", icon: \"13d\" },\n\t\t\t75: { code: \"SNOW\", description: \"Heavy snow\", icon: \"13d\" },\n\t\t\t77: { code: \"SNOW_GRAINS\", description: \"Snow grains\", icon: \"13d\" },\n\t\t\t80: { code: \"RAIN_SHOWERS\", description: \"Light rain showers\", icon: \"09d\" },\n\t\t\t81: { code: \"RAIN_SHOWERS\", description: \"Moderate rain showers\", icon: \"09d\" },\n\t\t\t82: { code: \"RAIN_SHOWERS\", description: \"Heavy rain showers\", icon: \"09d\" },\n\t\t\t85: { code: \"SNOW_SHOWERS\", description: \"Light snow showers\", icon: \"13d\" },\n\t\t\t86: { code: \"SNOW_SHOWERS\", description: \"Heavy snow showers\", icon: \"13d\" },\n\t\t\t95: { code: \"THUNDERSTORM\", description: \"Thunderstorm\", icon: \"11d\" },\n\t\t\t96: { code: \"THUNDERSTORM\", description: \"Thunderstorm with hail\", icon: \"11d\" },\n\t\t\t99: { code: \"THUNDERSTORM\", description: \"Severe thunderstorm\", icon: \"11d\" },\n\t\t};\n\n\t\treturn (\n\t\t\tconditions[code] || {\n\t\t\t\tcode: \"UNKNOWN\",\n\t\t\t\tdescription: \"Unknown\",\n\t\t\t\ticon: \"03d\",\n\t\t\t}\n\t\t);\n\t}\n\n\t/**\n\t * Map NWS condition text to WeatherCondition\n\t */\n\tprivate mapNWSCondition(forecast: string): WeatherCondition {\n\t\tconst lower = forecast.toLowerCase();\n\t\tif (lower.includes(\"thunder\")) {\n\t\t\treturn {\n\t\t\t\tcode: \"THUNDERSTORM\",\n\t\t\t\tdescription: forecast,\n\t\t\t\ticon: \"11d\",\n\t\t\t};\n\t\t}\n\t\tif (lower.includes(\"snow\")) {\n\t\t\treturn { code: \"SNOW\", description: forecast, icon: \"13d\" };\n\t\t}\n\t\tif (lower.includes(\"rain\") || lower.includes(\"showers\")) {\n\t\t\treturn { code: \"RAIN\", description: forecast, icon: \"10d\" };\n\t\t}\n\t\tif (lower.includes(\"cloudy\") || lower.includes(\"overcast\")) {\n\t\t\treturn { code: \"CLOUDY\", description: forecast, icon: \"04d\" };\n\t\t}\n\t\tif (lower.includes(\"partly\")) {\n\t\t\treturn {\n\t\t\t\tcode: \"PARTLY_CLOUDY\",\n\t\t\t\tdescription: forecast,\n\t\t\t\ticon: \"03d\",\n\t\t\t};\n\t\t}\n\t\tif (lower.includes(\"clear\") || lower.includes(\"sunny\")) {\n\t\t\treturn { code: \"CLEAR\", description: forecast, icon: \"01d\" };\n\t\t}\n\t\treturn { code: \"UNKNOWN\", description: forecast, icon: \"03d\" };\n\t}\n\n\tprivate mapNWSSeverity(severity: string): WeatherAlert[\"severity\"] {\n\t\tswitch (severity?.toLowerCase()) {\n\t\t\tcase \"extreme\":\n\t\t\t\treturn \"Extreme\";\n\t\t\tcase \"severe\":\n\t\t\t\treturn \"Severe\";\n\t\t\tcase \"moderate\":\n\t\t\t\treturn \"Moderate\";\n\t\t\tcase \"minor\":\n\t\t\t\treturn \"Minor\";\n\t\t\tdefault:\n\t\t\t\treturn \"Unknown\";\n\t\t}\n\t}\n\n\tprivate mapNWSUrgency(urgency: string): WeatherAlert[\"urgency\"] {\n\t\tswitch (urgency?.toLowerCase()) {\n\t\t\tcase \"immediate\":\n\t\t\t\treturn \"Immediate\";\n\t\t\tcase \"expected\":\n\t\t\t\treturn \"Expected\";\n\t\t\tcase \"future\":\n\t\t\t\treturn \"Future\";\n\t\t\tcase \"past\":\n\t\t\t\treturn \"Past\";\n\t\t\tdefault:\n\t\t\t\treturn \"Unknown\";\n\t\t}\n\t}\n\n\tprivate parseWindSpeed(windStr: string): number {\n\t\t// \"10 to 15 mph\" -> 12.5 mph -> m/s\n\t\tconst match = windStr.match(/(\\d+)\\s*(?:to\\s*(\\d+))?\\s*mph/i);\n\t\tif (match) {\n\t\t\tconst low = parseInt(match[1]);\n\t\t\tconst high = match[2] ? parseInt(match[2]) : low;\n\t\t\tconst mph = (low + high) / 2;\n\t\t\treturn mph * 0.44704; // Convert to m/s\n\t\t}\n\t\treturn 0;\n\t}\n\n\tprivate parseWindDirection(dir: string): number {\n\t\tconst directions: Record<string, number> = {\n\t\t\tN: 0, NNE: 22.5, NE: 45, ENE: 67.5,\n\t\t\tE: 90, ESE: 112.5, SE: 135, SSE: 157.5,\n\t\t\tS: 180, SSW: 202.5, SW: 225, WSW: 247.5,\n\t\t\tW: 270, WNW: 292.5, NW: 315, NNW: 337.5,\n\t\t};\n\t\treturn directions[dir.toUpperCase()] || 0;\n\t}\n\n\tprivate isUSLocation(lat: number, lng: number): boolean {\n\t\t// Rough bounds for continental US + Alaska + Hawaii\n\t\treturn (\n\t\t\t(lat >= 24.5 && lat <= 49.5 && lng >= -125 && lng <= -66.9) || // Continental\n\t\t\t(lat >= 51 && lat <= 71.5 && lng >= -180 && lng <= -130) || // Alaska\n\t\t\t(lat >= 18.5 && lat <= 22.5 && lng >= -161 && lng <= -154) // Hawaii\n\t\t);\n\t}\n\n\t/**\n\t * Check if weather is suitable for outdoor work\n\t */\n\tisSuitableForOutdoorWork(weather: WeatherData): {\n\t\tsuitable: boolean;\n\t\treason?: string;\n\t\tseverity: \"none\" | \"low\" | \"medium\" | \"high\";\n\t} {\n\t\t// Check for severe alerts\n\t\tconst severeAlerts = weather.alerts.filter(\n\t\t\t(a) => a.severity === \"Extreme\" || a.severity === \"Severe\",\n\t\t);\n\t\tif (severeAlerts.length > 0) {\n\t\t\treturn {\n\t\t\t\tsuitable: false,\n\t\t\t\treason: severeAlerts[0].headline || severeAlerts[0].event,\n\t\t\t\tseverity: \"high\",\n\t\t\t};\n\t\t}\n\n\t\t// Check current conditions\n\t\tif (weather.current) {\n\t\t\tconst { condition, temperature, windSpeed } = weather.current;\n\n\t\t\t// Check for dangerous conditions\n\t\t\tif (\n\t\t\t\tcondition.code === \"THUNDERSTORM\" ||\n\t\t\t\tcondition.code.includes(\"FREEZING\")\n\t\t\t) {\n\t\t\t\treturn {\n\t\t\t\t\tsuitable: false,\n\t\t\t\t\treason: condition.description,\n\t\t\t\t\tseverity: \"high\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Check temperature (in Celsius)\n\t\t\tif (temperature < -10) {\n\t\t\t\treturn {\n\t\t\t\t\tsuitable: false,\n\t\t\t\t\treason: \"Extreme cold (-10°C or below)\",\n\t\t\t\t\tseverity: \"high\",\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (temperature > 40) {\n\t\t\t\treturn {\n\t\t\t\t\tsuitable: false,\n\t\t\t\t\treason: \"Extreme heat (40°C or above)\",\n\t\t\t\t\tseverity: \"high\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Check wind\n\t\t\tif (windSpeed > 20) {\n\t\t\t\t// ~45 mph\n\t\t\t\treturn {\n\t\t\t\t\tsuitable: false,\n\t\t\t\t\treason: \"High winds\",\n\t\t\t\t\tseverity: \"medium\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Moderate concerns\n\t\t\tif (condition.code === \"RAIN\" || condition.code === \"SNOW\") {\n\t\t\t\treturn {\n\t\t\t\t\tsuitable: true,\n\t\t\t\t\treason: condition.description,\n\t\t\t\t\tseverity: \"medium\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (temperature < 0 || temperature > 35) {\n\t\t\t\treturn {\n\t\t\t\t\tsuitable: true,\n\t\t\t\t\treason: `Temperature: ${Math.round(temperature)}°C`,\n\t\t\t\t\tseverity: \"low\",\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\treturn { suitable: true, severity: \"none\" };\n\t}\n\n\t/**\n\t * Get weather summary for display\n\t */\n\tgetWeatherSummary(weather: WeatherData): {\n\t\ttemperature: string;\n\t\tcondition: string;\n\t\ticon: string;\n\t\tfeelsLike: string;\n\t\thumidity: string;\n\t\twind: string;\n\t\talerts: number;\n\t\tsuitableForWork: boolean;\n\t} {\n\t\tconst current = weather.current;\n\t\tconst workSuitability = this.isSuitableForOutdoorWork(weather);\n\n\t\treturn {\n\t\t\ttemperature: current\n\t\t\t\t? `${Math.round(current.temperature)}°C / ${Math.round(current.temperature * 1.8 + 32)}°F`\n\t\t\t\t: \"N/A\",\n\t\t\tcondition: current?.condition.description || \"Unknown\",\n\t\t\ticon: current?.condition.icon || \"03d\",\n\t\t\tfeelsLike: current\n\t\t\t\t? `${Math.round(current.temperatureFeelsLike)}°C`\n\t\t\t\t: \"N/A\",\n\t\t\thumidity: current ? `${Math.round(current.humidity)}%` : \"N/A\",\n\t\t\twind: current\n\t\t\t\t? `${Math.round(current.windSpeed * 2.237)} mph`\n\t\t\t\t: \"N/A\", // m/s to mph\n\t\t\talerts: weather.alerts.length,\n\t\t\tsuitableForWork: workSuitability.suitable,\n\t\t};\n\t}\n\n\t/**\n\t * Clean up old cache entries\n\t */\n\tprivate cleanCache(): void {\n\t\tconst now = Date.now();\n\t\tfor (const [key, value] of this.cache.entries()) {\n\t\t\tif (now - value.timestamp > CACHE_TTL * 2) {\n\t\t\t\tthis.cache.delete(key);\n\t\t\t}\n\t\t}\n\n\t\tif (this.cache.size > 100) {\n\t\t\tconst entries = Array.from(this.cache.entries());\n\t\t\tentries.sort((a, b) => b[1].timestamp - a[1].timestamp);\n\t\t\tthis.cache.clear();\n\t\t\tfor (const [key, value] of entries.slice(0, 50)) {\n\t\t\t\tthis.cache.set(key, value);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Clear cache\n\t */\n\tclearCache(): void {\n\t\tthis.cache.clear();\n\t}\n}\n\n// Singleton instance\nexport const googleWeatherService = new GoogleWeatherService();\n","\"use client\";\n\n/**\n * QuickAppointmentDialog Component\n *\n * A streamlined dialog for quickly creating appointments from the dispatch map.\n * Triggered by clicking on the map canvas.\n *\n * Features:\n * - Pre-fills location from map click coordinates\n * - Customer autocomplete with nearby customer suggestions\n * - Technician assignment\n * - Date/time picker with smart defaults\n * - Job type/priority selection\n */\n\nimport { createAppointment } from \"@/actions/appointments\";\nimport { CustomerAutocomplete, type CustomerOption } from \"@/components/customers/customer-autocomplete\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDialog,\n\tDialogContent,\n\tDialogDescription,\n\tDialogFooter,\n\tDialogHeader,\n\tDialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { cn } from \"@/lib/utils\";\nimport {\n\tAlertTriangle,\n\tCalendar,\n\tClock,\n\tLoader2,\n\tMapPin,\n\tUser,\n\tWrench,\n} from \"lucide-react\";\nimport { useCallback, useEffect, useState, useTransition } from \"react\";\nimport { format } from \"date-fns\";\n\n// Job types matching the backend schema\n// Valid types: service_call, installation, maintenance, inspection, repair, estimate, follow_up, winterization, emergency\nconst JOB_TYPES = [\n\t{ value: \"emergency\", label: \"Emergency / Urgent\", color: \"text-red-500\" },\n\t{ value: \"follow_up\", label: \"Callback / Follow Up\", color: \"text-orange-500\" },\n\t{ value: \"maintenance\", label: \"Maintenance / Recurring\", color: \"text-purple-500\" },\n\t{ value: \"installation\", label: \"Install / New Work\", color: \"text-green-500\" },\n\t{ value: \"service_call\", label: \"Service Call\", color: \"text-blue-500\" },\n\t{ value: \"inspection\", label: \"Inspection\", color: \"text-slate-500\" },\n\t{ value: \"estimate\", label: \"Estimate\", color: \"text-amber-500\" },\n\t{ value: \"repair\", label: \"Repair\", color: \"text-cyan-500\" },\n\t{ value: \"winterization\", label: \"Winterization\", color: \"text-indigo-500\" },\n] as const;\n\nconst PRIORITIES = [\n\t{ value: \"low\", label: \"Low\", color: \"text-slate-500\" },\n\t{ value: \"normal\", label: \"Normal\", color: \"text-blue-500\" },\n\t{ value: \"high\", label: \"High\", color: \"text-orange-500\" },\n\t{ value: \"urgent\", label: \"Urgent\", color: \"text-red-500\" },\n] as const;\n\nconst DURATIONS = [\n\t{ value: 30, label: \"30 min\" },\n\t{ value: 60, label: \"1 hour\" },\n\t{ value: 90, label: \"1.5 hours\" },\n\t{ value: 120, label: \"2 hours\" },\n\t{ value: 180, label: \"3 hours\" },\n\t{ value: 240, label: \"4 hours\" },\n\t{ value: 480, label: \"Full day\" },\n] as const;\n\nexport type MapClickLocation = {\n\tlat: number;\n\tlng: number;\n\taddress?: string;\n};\n\nexport type TechnicianOption = {\n\tid: string;\n\tname: string;\n\tavatar?: string;\n};\n\ninterface QuickAppointmentDialogProps {\n\topen: boolean;\n\tonOpenChange: (open: boolean) => void;\n\tlocation?: MapClickLocation | null;\n\ttechnicians?: TechnicianOption[];\n\tnearbyCustomers?: CustomerOption[];\n\tonSuccess?: (appointmentId: string) => void;\n\tonCreateCustomer?: () => void;\n\t/** Pre-select a technician (e.g., from timeline double-click) */\n\tdefaultTechnicianId?: string;\n\t/** Pre-fill date/time (e.g., from timeline double-click) */\n\tdefaultDateTime?: Date;\n\t/** Pre-fill duration in minutes (e.g., from timeline drag-to-create) */\n\tdefaultDuration?: number;\n}\n\nexport function QuickAppointmentDialog({\n\topen,\n\tonOpenChange,\n\tlocation,\n\ttechnicians = [],\n\tnearbyCustomers = [],\n\tonSuccess,\n\tonCreateCustomer,\n\tdefaultTechnicianId,\n\tdefaultDateTime,\n\tdefaultDuration,\n}: QuickAppointmentDialogProps) {\n\tconst [isPending, startTransition] = useTransition();\n\tconst [error, setError] = useState<string | null>(null);\n\n\t// Form state\n\tconst [selectedCustomer, setSelectedCustomer] = useState<CustomerOption | null>(null);\n\tconst [customerId, setCustomerId] = useState<string | null>(null);\n\tconst [title, setTitle] = useState(\"\");\n\tconst [jobType, setJobType] = useState<string>(\"service_call\");\n\tconst [priority, setPriority] = useState<string>(\"normal\");\n\tconst [technicianId, setTechnicianId] = useState<string>(\"\");\n\tconst [duration, setDuration] = useState<number>(60);\n\tconst [notes, setNotes] = useState(\"\");\n\n\t// Apply defaults when dialog opens\n\tuseEffect(() => {\n\t\tif (open) {\n\t\t\tif (defaultTechnicianId) {\n\t\t\t\tsetTechnicianId(defaultTechnicianId);\n\t\t\t}\n\t\t\tif (defaultDateTime) {\n\t\t\t\t// Ensure the time is not in the past (server rejects past appointments)\n\t\t\t\tconst now = new Date();\n\t\t\t\tlet adjustedTime = defaultDateTime;\n\t\t\t\tif (defaultDateTime < now) {\n\t\t\t\t\t// Move to the same time slot tomorrow, or next available hour if today\n\t\t\t\t\tadjustedTime = new Date();\n\t\t\t\t\tadjustedTime.setMinutes(0, 0, 0);\n\t\t\t\t\tadjustedTime.setHours(adjustedTime.getHours() + 1);\n\t\t\t\t}\n\t\t\t\tsetScheduledStart(format(adjustedTime, \"yyyy-MM-dd'T'HH:mm\"));\n\t\t\t}\n\t\t\tif (defaultDuration) {\n\t\t\t\t// Snap to nearest valid duration option\n\t\t\t\tconst validDurations = [30, 60, 90, 120, 180, 240, 480];\n\t\t\t\tconst closest = validDurations.reduce((prev, curr) =>\n\t\t\t\t\tMath.abs(curr - defaultDuration) < Math.abs(prev - defaultDuration) ? curr : prev\n\t\t\t\t);\n\t\t\t\tsetDuration(closest);\n\t\t\t}\n\t\t}\n\t}, [open, defaultTechnicianId, defaultDateTime, defaultDuration]);\n\n\t// Date/time - default to next available slot (next hour)\n\tconst getDefaultDateTime = () => {\n\t\tconst now = new Date();\n\t\tnow.setMinutes(0, 0, 0);\n\t\tnow.setHours(now.getHours() + 1);\n\t\treturn now.toISOString().slice(0, 16);\n\t};\n\tconst [scheduledStart, setScheduledStart] = useState(getDefaultDateTime());\n\n\t// Calculate end time based on duration\n\tconst getScheduledEnd = useCallback(() => {\n\t\tconst start = new Date(scheduledStart);\n\t\tstart.setMinutes(start.getMinutes() + duration);\n\t\treturn start.toISOString();\n\t}, [scheduledStart, duration]);\n\n\t// Handle customer selection\n\tconst handleCustomerChange = (id: string | null, customer: CustomerOption | null) => {\n\t\tsetCustomerId(id);\n\t\tsetSelectedCustomer(customer);\n\t\t// Auto-fill title if empty\n\t\tif (customer && !title) {\n\t\t\tconst customerName = customer.display_name ||\n\t\t\t\t`${customer.first_name || \"\"} ${customer.last_name || \"\"}`.trim() ||\n\t\t\t\tcustomer.company_name || \"Customer\";\n\t\t\tsetTitle(`Service call - ${customerName}`);\n\t\t}\n\t};\n\n\t// Reset form\n\tconst resetForm = useCallback(() => {\n\t\tsetSelectedCustomer(null);\n\t\tsetCustomerId(null);\n\t\tsetTitle(\"\");\n\t\tsetJobType(\"service_call\");\n\t\tsetPriority(\"normal\");\n\t\tsetTechnicianId(\"\");\n\t\tsetDuration(60);\n\t\tsetNotes(\"\");\n\t\tsetScheduledStart(getDefaultDateTime());\n\t\tsetError(null);\n\t}, []);\n\n\t// Handle close\n\tconst handleOpenChange = (newOpen: boolean) => {\n\t\tif (!newOpen) {\n\t\t\tresetForm();\n\t\t}\n\t\tonOpenChange(newOpen);\n\t};\n\n\t// Handle form submission\n\tconst handleSubmit = async (e: React.FormEvent) => {\n\t\te.preventDefault();\n\t\tsetError(null);\n\n\t\tif (!customerId) {\n\t\t\tsetError(\"Please select a customer\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (!title.trim()) {\n\t\t\tsetError(\"Please enter a title\");\n\t\t\treturn;\n\t\t}\n\n\t\tstartTransition(async () => {\n\t\t\ttry {\n\t\t\t\tconst formData = new FormData();\n\t\t\t\tformData.set(\"customerId\", customerId);\n\t\t\t\tformData.set(\"title\", title.trim());\n\t\t\t\tformData.set(\"scheduledStart\", new Date(scheduledStart).toISOString());\n\t\t\t\tformData.set(\"scheduledEnd\", getScheduledEnd());\n\t\t\t\tformData.set(\"type\", jobType);\n\t\t\t\tformData.set(\"priority\", priority);\n\t\t\t\tformData.set(\"category\", \"job_appointment\");\n\n\t\t\t\tif (technicianId && technicianId !== \"unassigned\") {\n\t\t\t\t\tformData.set(\"assignedTo\", technicianId);\n\t\t\t\t}\n\n\t\t\t\tif (notes.trim()) {\n\t\t\t\t\tformData.set(\"notes\", notes.trim());\n\t\t\t\t}\n\n\t\t\t\t// Add location info to notes if available\n\t\t\t\tif (location?.address) {\n\t\t\t\t\tconst existingNotes = notes.trim();\n\t\t\t\t\tconst locationNote = `Location: ${location.address}`;\n\t\t\t\t\tformData.set(\"notes\", existingNotes ? `${existingNotes}\\n\\n${locationNote}` : locationNote);\n\t\t\t\t}\n\n\t\t\t\tconst result = await createAppointment(formData);\n\n\t\t\t\tif (result.success && result.data) {\n\t\t\t\t\tonSuccess?.(result.data);\n\t\t\t\t\thandleOpenChange(false);\n\t\t\t\t} else {\n\t\t\t\t\tsetError(result.error || \"Failed to create appointment\");\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"Failed to create appointment:\", err);\n\t\t\t\tsetError(\"An unexpected error occurred\");\n\t\t\t}\n\t\t});\n\t};\n\n\treturn (\n\t\t<Dialog open={open} onOpenChange={handleOpenChange}>\n\t\t\t<DialogContent className=\"sm:max-w-[500px]\">\n\t\t\t\t<DialogHeader>\n\t\t\t\t\t<DialogTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Calendar className=\"h-5 w-5 text-primary\" />\n\t\t\t\t\t\tQuick Appointment\n\t\t\t\t\t</DialogTitle>\n\t\t\t\t\t<DialogDescription>\n\t\t\t\t\t\t{location?.address ? (\n\t\t\t\t\t\t\t<span className=\"flex items-center gap-1 text-sm\">\n\t\t\t\t\t\t\t\t<MapPin className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t{location.address}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\"Create a new appointment from the dispatch map\"\n\t\t\t\t\t\t)}\n\t\t\t\t\t</DialogDescription>\n\t\t\t\t</DialogHeader>\n\n\t\t\t\t<form onSubmit={handleSubmit} className=\"space-y-4\">\n\t\t\t\t\t{/* Customer Selection */}\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<Label htmlFor=\"customer\">Customer *</Label>\n\t\t\t\t\t\t<CustomerAutocomplete\n\t\t\t\t\t\t\tvalue={customerId}\n\t\t\t\t\t\t\tonChange={handleCustomerChange}\n\t\t\t\t\t\t\tplaceholder=\"Search or select customer...\"\n\t\t\t\t\t\t\tshowCreateNew\n\t\t\t\t\t\t\tonCreateNew={onCreateCustomer}\n\t\t\t\t\t\t\tshowRecent\n\t\t\t\t\t\t\trecentCustomers={nearbyCustomers}\n\t\t\t\t\t\t\terror={error?.includes(\"customer\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Title */}\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<Label htmlFor=\"title\">Title *</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\tid=\"title\"\n\t\t\t\t\t\t\tvalue={title}\n\t\t\t\t\t\t\tonChange={(e) => setTitle(e.target.value)}\n\t\t\t\t\t\t\tplaceholder=\"e.g., AC Repair, Plumbing Inspection\"\n\t\t\t\t\t\t\tclassName={cn(error?.includes(\"title\") && \"border-destructive\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Job Type & Priority */}\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label htmlFor=\"jobType\">Job Type</Label>\n\t\t\t\t\t\t\t<Select value={jobType} onValueChange={setJobType}>\n\t\t\t\t\t\t\t\t<SelectTrigger id=\"jobType\">\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{JOB_TYPES.map((type) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={type.value} value={type.value}>\n\t\t\t\t\t\t\t\t\t\t\t<span className={cn(\"flex items-center gap-2\", type.color)}>\n\t\t\t\t\t\t\t\t\t\t\t\t<Wrench className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t{type.label}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label htmlFor=\"priority\">Priority</Label>\n\t\t\t\t\t\t\t<Select value={priority} onValueChange={setPriority}>\n\t\t\t\t\t\t\t\t<SelectTrigger id=\"priority\">\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{PRIORITIES.map((p) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={p.value} value={p.value}>\n\t\t\t\t\t\t\t\t\t\t\t<span className={cn(\"flex items-center gap-2\", p.color)}>\n\t\t\t\t\t\t\t\t\t\t\t\t{p.value === \"urgent\" && <AlertTriangle className=\"h-3.5 w-3.5\" />}\n\t\t\t\t\t\t\t\t\t\t\t\t{p.label}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Date/Time & Duration */}\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label htmlFor=\"scheduledStart\">Date & Time</Label>\n\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t<Clock className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tid=\"scheduledStart\"\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={scheduledStart}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setScheduledStart(e.target.value)}\n\t\t\t\t\t\t\t\t\tclassName=\"pl-9\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label htmlFor=\"duration\">Duration</Label>\n\t\t\t\t\t\t\t<Select value={duration.toString()} onValueChange={(v) => setDuration(Number(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger id=\"duration\">\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{DURATIONS.map((d) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={d.value} value={d.value.toString()}>\n\t\t\t\t\t\t\t\t\t\t\t{d.label}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Technician Assignment */}\n\t\t\t\t\t{technicians.length > 0 && (\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label htmlFor=\"technician\">Assign Technician</Label>\n\t\t\t\t\t\t\t<Select value={technicianId} onValueChange={setTechnicianId}>\n\t\t\t\t\t\t\t\t<SelectTrigger id=\"technician\">\n\t\t\t\t\t\t\t\t\t<SelectValue placeholder=\"Select technician (optional)\" />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"unassigned\">Unassigned</SelectItem>\n\t\t\t\t\t\t\t\t\t{technicians.map((tech) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={tech.id} value={tech.id}>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<User className=\"h-3.5 w-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t{tech.name}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Notes */}\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<Label htmlFor=\"notes\">Notes</Label>\n\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\tid=\"notes\"\n\t\t\t\t\t\t\tvalue={notes}\n\t\t\t\t\t\t\tonChange={(e) => setNotes(e.target.value)}\n\t\t\t\t\t\t\tplaceholder=\"Additional notes or instructions...\"\n\t\t\t\t\t\t\trows={2}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Error Display */}\n\t\t\t\t\t{error && (\n\t\t\t\t\t\t<div className=\"rounded-md bg-destructive/10 p-3 text-sm text-destructive\">\n\t\t\t\t\t\t\t{error}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\tonClick={() => handleOpenChange(false)}\n\t\t\t\t\t\t\tdisabled={isPending}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button type=\"submit\" disabled={isPending || !customerId}>\n\t\t\t\t\t\t\t{isPending ? (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n\t\t\t\t\t\t\t\t\tCreating...\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\"Create Appointment\"\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</form>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n","/**\n * Find Nearby Entities Utility\n *\n * Calculates distance between coordinates and finds nearby customers,\n * properties, or jobs based on proximity to a clicked map location.\n */\n\nexport type Coordinates = {\n\tlat: number;\n\tlng: number;\n};\n\nexport type EntityWithLocation = {\n\tid: string;\n\tlat?: number | null;\n\tlng?: number | null;\n\tlon?: number | null; // Some entities use 'lon' instead of 'lng'\n};\n\n/**\n * Calculate distance between two points using Haversine formula\n * Returns distance in miles\n */\nexport function calculateDistance(\n\tpoint1: Coordinates,\n\tpoint2: Coordinates\n): number {\n\tconst R = 3959; // Earth's radius in miles\n\tconst dLat = toRadians(point2.lat - point1.lat);\n\tconst dLng = toRadians(point2.lng - point1.lng);\n\n\tconst a =\n\t\tMath.sin(dLat / 2) * Math.sin(dLat / 2) +\n\t\tMath.cos(toRadians(point1.lat)) *\n\t\t\tMath.cos(toRadians(point2.lat)) *\n\t\t\tMath.sin(dLng / 2) *\n\t\t\tMath.sin(dLng / 2);\n\n\tconst c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\treturn R * c;\n}\n\nfunction toRadians(degrees: number): number {\n\treturn degrees * (Math.PI / 180);\n}\n\n/**\n * Find entities within a specified radius of a location\n */\nexport function findNearbyEntities<T extends EntityWithLocation>(\n\tlocation: Coordinates,\n\tentities: T[],\n\tradiusMiles: number = 5\n): Array<T & { distance: number }> {\n\tconst nearby: Array<T & { distance: number }> = [];\n\n\tfor (const entity of entities) {\n\t\t// Handle both 'lng' and 'lon' coordinate naming\n\t\tconst entityLng = entity.lng ?? entity.lon;\n\n\t\tif (entity.lat == null || entityLng == null) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst distance = calculateDistance(location, {\n\t\t\tlat: entity.lat,\n\t\t\tlng: entityLng,\n\t\t});\n\n\t\tif (distance <= radiusMiles) {\n\t\t\tnearby.push({\n\t\t\t\t...entity,\n\t\t\t\tdistance,\n\t\t\t});\n\t\t}\n\t}\n\n\t// Sort by distance (closest first)\n\treturn nearby.sort((a, b) => a.distance - b.distance);\n}\n\n/**\n * Find the closest entity to a location\n */\nexport function findClosestEntity<T extends EntityWithLocation>(\n\tlocation: Coordinates,\n\tentities: T[]\n): (T & { distance: number }) | null {\n\tconst nearby = findNearbyEntities(location, entities, Infinity);\n\treturn nearby[0] || null;\n}\n\n/**\n * Group entities by distance ranges\n */\nexport function groupByDistance<T extends EntityWithLocation>(\n\tlocation: Coordinates,\n\tentities: T[]\n): {\n\tveryClose: Array<T & { distance: number }>; // < 0.5 miles\n\tclose: Array<T & { distance: number }>; // 0.5 - 2 miles\n\tnearby: Array<T & { distance: number }>; // 2 - 5 miles\n\tfar: Array<T & { distance: number }>; // > 5 miles\n} {\n\tconst results = {\n\t\tveryClose: [] as Array<T & { distance: number }>,\n\t\tclose: [] as Array<T & { distance: number }>,\n\t\tnearby: [] as Array<T & { distance: number }>,\n\t\tfar: [] as Array<T & { distance: number }>,\n\t};\n\n\tfor (const entity of entities) {\n\t\tconst entityLng = entity.lng ?? entity.lon;\n\n\t\tif (entity.lat == null || entityLng == null) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst distance = calculateDistance(location, {\n\t\t\tlat: entity.lat,\n\t\t\tlng: entityLng,\n\t\t});\n\n\t\tconst enriched = { ...entity, distance };\n\n\t\tif (distance < 0.5) {\n\t\t\tresults.veryClose.push(enriched);\n\t\t} else if (distance < 2) {\n\t\t\tresults.close.push(enriched);\n\t\t} else if (distance < 5) {\n\t\t\tresults.nearby.push(enriched);\n\t\t} else {\n\t\t\tresults.far.push(enriched);\n\t\t}\n\t}\n\n\t// Sort each group by distance\n\tresults.veryClose.sort((a, b) => a.distance - b.distance);\n\tresults.close.sort((a, b) => a.distance - b.distance);\n\tresults.nearby.sort((a, b) => a.distance - b.distance);\n\tresults.far.sort((a, b) => a.distance - b.distance);\n\n\treturn results;\n}\n\n/**\n * Format distance for display\n */\nexport function formatDistance(miles: number): string {\n\tif (miles < 0.1) {\n\t\tconst feet = Math.round(miles * 5280);\n\t\treturn `${feet} ft`;\n\t}\n\tif (miles < 1) {\n\t\treturn `${(miles * 5280).toFixed(0)} ft`;\n\t}\n\treturn `${miles.toFixed(1)} mi`;\n}\n\n/**\n * Reverse geocode coordinates to get address\n * Uses Google Maps Geocoding API if available\n */\nexport async function reverseGeocode(\n\tlocation: Coordinates\n): Promise<string | null> {\n\t// Check if Google Maps API is loaded\n\tif (typeof google === \"undefined\" || !google.maps) {\n\t\treturn null;\n\t}\n\n\treturn new Promise((resolve) => {\n\t\tconst geocoder = new google.maps.Geocoder();\n\n\t\tgeocoder.geocode(\n\t\t\t{\n\t\t\t\tlocation: {\n\t\t\t\t\tlat: location.lat,\n\t\t\t\t\tlng: location.lng,\n\t\t\t\t},\n\t\t\t},\n\t\t\t(results, status) => {\n\t\t\t\tif (status === google.maps.GeocoderStatus.OK && results?.[0]) {\n\t\t\t\t\tresolve(results[0].formatted_address);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(null);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t});\n}\n"],"names":[],"mappings":"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"}