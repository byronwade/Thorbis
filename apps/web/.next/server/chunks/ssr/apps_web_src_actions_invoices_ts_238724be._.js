module.exports=[977235,a=>a.a(async(b,c)=>{try{var d=a.i(780195),e=a.i(218188),f=a.i(146057);a.i(467361);var g=a.i(445074),h=a.i(818944),i=a.i(974406),j=a.i(136874),k=a.i(873212),l=a.i(395731),m=b([k]);[k]=m.then?(await m)():m;let p=f.z.object({description:f.z.string().min(1,"Description is required"),quantity:f.z.number().min(.01,"Quantity must be greater than 0"),unitPrice:f.z.number().min(0,"Price must be positive"),total:f.z.number().min(0,"Total must be positive")});async function n(a){return(0,i.withErrorHandling)(async()=>{let b=await (0,j.createClient)();if(!b)throw new h.ActionError("Database connection failed",h.ERROR_CODES.DB_CONNECTION_ERROR);let{data:{user:c}}=await b.auth.getUser();(0,i.assertAuthenticated)(c?.id);let d=await (0,g.getActiveCompanyId)();if(!d)throw new h.ActionError("You must be part of a company",h.ERROR_CODES.AUTH_FORBIDDEN,403);let{data:f}=await b.from("invoices").select("company_id, status").eq("id",a).single();if((0,i.assertExists)(f,"Invoice"),f.company_id!==d)throw new h.ActionError(h.ERROR_MESSAGES.forbidden("invoice"),h.ERROR_CODES.AUTH_FORBIDDEN,403);if("paid"===f.status)throw new h.ActionError("This invoice has been paid and cannot be archived. Paid invoices must be kept for tax and legal compliance.",h.ERROR_CODES.OPERATION_NOT_ALLOWED);let k=new Date().toISOString(),l=new Date(Date.now()+7776e6).toISOString(),{error:m}=await b.from("invoices").update({deleted_at:k,deleted_by:c.id,archived_at:k,permanent_delete_scheduled_at:l}).eq("id",a);if(m)throw new h.ActionError(h.ERROR_MESSAGES.operationFailed("archive invoice"),h.ERROR_CODES.DB_QUERY_ERROR);(0,e.revalidatePath)("/dashboard/work/invoices"),(0,e.revalidatePath)("/dashboard/settings/archive")})}async function o(a){return(0,i.withErrorHandling)(async()=>{let b=await (0,j.createClient)();(0,i.assertSupabase)(b);let{data:c,error:d}=await b.from("invoices").select("id, job_id").eq("id",a).single();if(d||!c)throw new h.ActionError("Invoice not found",h.ERROR_CODES.DB_RECORD_NOT_FOUND);let f=c.job_id,{error:g}=await b.from("invoices").update({job_id:null}).eq("id",a);if(g)throw new h.ActionError("Failed to unlink invoice from job",h.ERROR_CODES.DB_QUERY_ERROR);(0,e.revalidatePath)(`/dashboard/work/invoices/${a}`),f&&(0,e.revalidatePath)(`/dashboard/work/${f}`),(0,e.revalidatePath)("/dashboard/work/invoices")})}f.z.object({customerId:f.z.string().uuid("Invalid customer ID"),jobId:f.z.string().uuid("Invalid job ID").optional(),title:f.z.string().min(1,"Invoice title is required"),description:f.z.string().optional(),lineItems:f.z.array(p).min(1,"At least one line item is required"),taxRate:f.z.number().min(0).max(100).default(0),discountAmount:f.z.number().min(0).default(0),dueDays:f.z.number().min(0).default(30),terms:f.z.string().optional(),notes:f.z.string().optional()}),f.z.object({title:f.z.string().min(1,"Invoice title is required").optional(),description:f.z.string().optional(),lineItems:f.z.array(p).optional(),taxRate:f.z.number().min(0).max(100).optional(),discountAmount:f.z.number().min(0).optional(),dueDays:f.z.number().min(0).optional(),terms:f.z.string().optional(),notes:f.z.string().optional()}),f.z.object({amount:f.z.number().min(.01,"Payment amount must be greater than 0"),method:f.z.enum(["cash","check","card","bank_transfer","other"]),reference:f.z.string().optional(),notes:f.z.string().optional()}),(0,l.ensureServerEntryExports)([n,o]),(0,d.registerServerReference)(n,"4040183412a317fcfc6e30ea0018dc23ca1dd4ca1b",null),(0,d.registerServerReference)(o,"403a81dea3436d2f9aa1f3bd091b670f166ecf43f5",null),a.s(["archiveInvoice",()=>n,"unlinkInvoiceFromJob",()=>o]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=apps_web_src_actions_invoices_ts_238724be._.js.map