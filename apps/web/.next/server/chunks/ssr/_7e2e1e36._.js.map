{"version":3,"sources":["../../../../../../packages/auth/src/permissions.ts","../../../../../../apps/web/src/lib/auth/permissions.ts","../../../../../../apps/web/src/actions/roles.ts","../../../../../../apps/web/src/actions/kb.ts","../../../../../../apps/web/.next-internal/server/app/%28marketing%29/kb/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["/**\n * Permission System - Server-Side Utilities\n *\n * Provides type-safe permission checking for role-based access control (RBAC).\n * Uses database functions for secure, centralized permission logic.\n *\n * Performance optimizations:\n * - Database functions are cached by Postgres\n * - Single query permission checks\n * - Prepared statements for security\n *\n * @example\n * ```typescript\n * // Check if user can delete jobs\n * const canDelete = await hasPermission(supabase, userId, \"delete_jobs\", companyId);\n *\n * // Check if user has manager role\n * const isManager = await hasRole(supabase, userId, \"manager\", companyId);\n *\n * // Get user's role\n * const role = await getUserRole(supabase, userId, companyId);\n * ```\n */\n\nimport type { SupabaseClient } from \"@supabase/supabase-js\";\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * User roles in the system\n * Matches the user_role ENUM in database\n */\nexport type UserRole =\n\t| \"owner\"\n\t| \"admin\"\n\t| \"manager\"\n\t| \"dispatcher\"\n\t| \"technician\"\n\t| \"csr\";\n\n/**\n * Permission keys for fine-grained access control\n */\nexport type Permission =\n\t// Manager permissions\n\t| \"view_reports\"\n\t| \"manage_team\"\n\t| \"approve_estimates\"\n\t| \"handle_escalations\"\n\t// Dispatcher permissions\n\t| \"dispatch_jobs\"\n\t| \"manage_schedule\"\n\t| \"view_tech_locations\"\n\t// Technician permissions\n\t| \"update_job_status\"\n\t| \"create_invoices\"\n\t| \"upload_photos\"\n\t// CSR permissions\n\t| \"create_jobs\"\n\t| \"schedule_appointments\"\n\t| \"send_communications\"\n\t// View permissions\n\t| \"view_customers\"\n\t| \"view_jobs\"\n\t| \"view_schedule\"\n\t// Delete permissions\n\t| \"delete_jobs\"\n\t| \"delete_customers\"\n\t| \"delete_team_members\";\n\n/**\n * Role configuration with permissions and metadata\n */\nexport type RoleConfig = {\n\tid: UserRole;\n\tlabel: string;\n\tdescription: string;\n\tpermissions: Permission[];\n\tdashboardFeatures: string[];\n};\n\n// ============================================================================\n// Role Definitions\n// ============================================================================\n\n/**\n * Complete role configurations with their permissions\n * Used for UI display and permission reference\n */\nconst ROLES: Record<UserRole, RoleConfig> = {\n\towner: {\n\t\tid: \"owner\",\n\t\tlabel: \"Owner\",\n\t\tdescription:\n\t\t\t\"Full system access with focus on business financials and growth\",\n\t\tpermissions: [\n\t\t\t\"view_reports\",\n\t\t\t\"manage_team\",\n\t\t\t\"approve_estimates\",\n\t\t\t\"handle_escalations\",\n\t\t\t\"dispatch_jobs\",\n\t\t\t\"manage_schedule\",\n\t\t\t\"view_tech_locations\",\n\t\t\t\"update_job_status\",\n\t\t\t\"create_invoices\",\n\t\t\t\"upload_photos\",\n\t\t\t\"create_jobs\",\n\t\t\t\"schedule_appointments\",\n\t\t\t\"send_communications\",\n\t\t\t\"view_customers\",\n\t\t\t\"view_jobs\",\n\t\t\t\"view_schedule\",\n\t\t\t\"delete_jobs\",\n\t\t\t\"delete_customers\",\n\t\t\t\"delete_team_members\",\n\t\t],\n\t\tdashboardFeatures: [\n\t\t\t\"financial-overview\",\n\t\t\t\"profit-margins\",\n\t\t\t\"cash-flow\",\n\t\t\t\"business-growth\",\n\t\t\t\"payroll-overview\",\n\t\t\t\"all-reports\",\n\t\t],\n\t},\n\tadmin: {\n\t\tid: \"admin\",\n\t\tlabel: \"Admin\",\n\t\tdescription: \"System administration and configuration\",\n\t\tpermissions: [\n\t\t\t\"view_reports\",\n\t\t\t\"manage_team\",\n\t\t\t\"approve_estimates\",\n\t\t\t\"handle_escalations\",\n\t\t\t\"dispatch_jobs\",\n\t\t\t\"manage_schedule\",\n\t\t\t\"view_tech_locations\",\n\t\t\t\"update_job_status\",\n\t\t\t\"create_invoices\",\n\t\t\t\"upload_photos\",\n\t\t\t\"create_jobs\",\n\t\t\t\"schedule_appointments\",\n\t\t\t\"send_communications\",\n\t\t\t\"view_customers\",\n\t\t\t\"view_jobs\",\n\t\t\t\"view_schedule\",\n\t\t\t\"delete_jobs\",\n\t\t\t\"delete_customers\",\n\t\t],\n\t\tdashboardFeatures: [\n\t\t\t\"system-settings\",\n\t\t\t\"user-management\",\n\t\t\t\"integrations\",\n\t\t\t\"audit-logs\",\n\t\t],\n\t},\n\tmanager: {\n\t\tid: \"manager\",\n\t\tlabel: \"Manager\",\n\t\tdescription:\n\t\t\t\"Oversee team performance, customer satisfaction, and operations\",\n\t\tpermissions: [\n\t\t\t\"view_reports\",\n\t\t\t\"manage_team\",\n\t\t\t\"approve_estimates\",\n\t\t\t\"handle_escalations\",\n\t\t\t\"dispatch_jobs\",\n\t\t\t\"manage_schedule\",\n\t\t\t\"view_tech_locations\",\n\t\t\t\"update_job_status\",\n\t\t\t\"create_invoices\",\n\t\t\t\"upload_photos\",\n\t\t\t\"create_jobs\",\n\t\t\t\"schedule_appointments\",\n\t\t\t\"send_communications\",\n\t\t\t\"view_customers\",\n\t\t\t\"view_jobs\",\n\t\t\t\"view_schedule\",\n\t\t\t\"delete_jobs\",\n\t\t],\n\t\tdashboardFeatures: [\n\t\t\t\"team-performance\",\n\t\t\t\"customer-satisfaction\",\n\t\t\t\"callback-queue\",\n\t\t\t\"review-alerts\",\n\t\t\t\"kpi-tracking\",\n\t\t\t\"inventory-management\",\n\t\t],\n\t},\n\tdispatcher: {\n\t\tid: \"dispatcher\",\n\t\tlabel: \"Dispatcher\",\n\t\tdescription:\n\t\t\t\"Manage technician schedules, job assignments, and real-time operations\",\n\t\tpermissions: [\n\t\t\t\"view_reports\",\n\t\t\t\"dispatch_jobs\",\n\t\t\t\"manage_schedule\",\n\t\t\t\"view_tech_locations\",\n\t\t\t\"update_job_status\",\n\t\t\t\"create_jobs\",\n\t\t\t\"schedule_appointments\",\n\t\t\t\"send_communications\",\n\t\t\t\"view_customers\",\n\t\t\t\"view_jobs\",\n\t\t\t\"view_schedule\",\n\t\t],\n\t\tdashboardFeatures: [\n\t\t\t\"dispatch-map\",\n\t\t\t\"technician-locations\",\n\t\t\t\"unassigned-jobs\",\n\t\t\t\"emergency-queue\",\n\t\t\t\"quick-dispatch\",\n\t\t\t\"tech-status\",\n\t\t],\n\t},\n\ttechnician: {\n\t\tid: \"technician\",\n\t\tlabel: \"Technician\",\n\t\tdescription:\n\t\t\t\"View assigned jobs, update job status, and track personal performance\",\n\t\tpermissions: [\n\t\t\t\"update_job_status\",\n\t\t\t\"create_invoices\",\n\t\t\t\"upload_photos\",\n\t\t\t\"view_customers\",\n\t\t\t\"view_jobs\",\n\t\t\t\"view_schedule\",\n\t\t],\n\t\tdashboardFeatures: [\n\t\t\t\"my-schedule\",\n\t\t\t\"active-job\",\n\t\t\t\"my-earnings\",\n\t\t\t\"my-performance\",\n\t\t\t\"parts-inventory\",\n\t\t\t\"time-tracking\",\n\t\t],\n\t},\n\tcsr: {\n\t\tid: \"csr\",\n\t\tlabel: \"Customer Service Rep\",\n\t\tdescription:\n\t\t\t\"Handle customer calls, schedule appointments, and manage customer relationships\",\n\t\tpermissions: [\n\t\t\t\"create_jobs\",\n\t\t\t\"schedule_appointments\",\n\t\t\t\"send_communications\",\n\t\t\t\"create_invoices\",\n\t\t\t\"view_customers\",\n\t\t\t\"view_jobs\",\n\t\t\t\"view_schedule\",\n\t\t],\n\t\tdashboardFeatures: [\n\t\t\t\"call-queue\",\n\t\t\t\"booking-calendar\",\n\t\t\t\"customer-search\",\n\t\t\t\"follow-up-queue\",\n\t\t\t\"estimate-pipeline\",\n\t\t\t\"call-scripts\",\n\t\t],\n\t},\n};\n\n// ============================================================================\n// Permission Check Functions\n// ============================================================================\n\n/**\n * Check if user has a specific role in a company\n *\n * @param supabase - Supabase client\n * @param userId - User ID to check\n * @param role - Role to check for\n * @param companyId - Company ID\n * @returns true if user has the role\n *\n * @example\n * ```typescript\n * const isManager = await hasRole(supabase, userId, \"manager\", companyId);\n * if (!isManager) {\n *   throw new Error(\"Access denied: Manager role required\");\n * }\n * ```\n */\nexport async function hasRole(\n\tsupabase: SupabaseClient,\n\tuserId: string,\n\trole: UserRole,\n\tcompanyId: string,\n): Promise<boolean> {\n\tconst { data, error } = await supabase.rpc(\"has_role\", {\n\t\tuser_uuid: userId,\n\t\trequired_role: role,\n\t\tcompany_uuid: companyId,\n\t});\n\n\tif (error) {\n\t\treturn false;\n\t}\n\n\treturn data === true;\n}\n\n/**\n * Check if user has ANY of the specified roles\n *\n * @param supabase - Supabase client\n * @param userId - User ID to check\n * @param roles - Array of roles to check\n * @param companyId - Company ID\n * @returns true if user has any of the roles\n *\n * @example\n * ```typescript\n * const canManage = await hasAnyRole(\n *   supabase,\n *   userId,\n *   [\"owner\", \"manager\", \"admin\"],\n *   companyId\n * );\n * ```\n */\nasync function hasAnyRole(\n\tsupabase: SupabaseClient,\n\tuserId: string,\n\troles: UserRole[],\n\tcompanyId: string,\n): Promise<boolean> {\n\tconst { data, error } = await supabase.rpc(\"has_any_role\", {\n\t\tuser_uuid: userId,\n\t\trequired_roles: roles,\n\t\tcompany_uuid: companyId,\n\t});\n\n\tif (error) {\n\t\treturn false;\n\t}\n\n\treturn data === true;\n}\n\n/**\n * Get user's role in a company\n *\n * @param supabase - Supabase client\n * @param userId - User ID\n * @param companyId - Company ID\n * @returns User's role or null if not found\n *\n * @example\n * ```typescript\n * const role = await getUserRole(supabase, userId, companyId);\n * console.log(`User role: ${role}`); // \"manager\"\n * ```\n */\nexport async function getUserRole(\n\tsupabase: SupabaseClient,\n\tuserId: string,\n\tcompanyId: string,\n): Promise<UserRole | null> {\n\tconst { data, error } = await supabase.rpc(\"get_user_role\", {\n\t\tuser_uuid: userId,\n\t\tcompany_uuid: companyId,\n\t});\n\n\tif (error) {\n\t\treturn null;\n\t}\n\n\treturn data as UserRole | null;\n}\n\n/**\n * Check if user has a specific permission\n *\n * @param supabase - Supabase client\n * @param userId - User ID to check\n * @param permission - Permission key to check\n * @param companyId - Company ID\n * @returns true if user has the permission\n *\n * @example\n * ```typescript\n * const canDelete = await hasPermission(supabase, userId, \"delete_jobs\", companyId);\n * if (!canDelete) {\n *   return { error: \"You don't have permission to delete jobs\" };\n * }\n * ```\n */\nexport async function hasPermission(\n\tsupabase: SupabaseClient,\n\tuserId: string,\n\tpermission: Permission,\n\tcompanyId: string,\n): Promise<boolean> {\n\tconst { data, error } = await supabase.rpc(\"has_permission\", {\n\t\tuser_uuid: userId,\n\t\tpermission_key: permission,\n\t\tcompany_uuid: companyId,\n\t});\n\n\tif (error) {\n\t\treturn false;\n\t}\n\n\treturn data === true;\n}\n\n/**\n * Check if user is the company owner\n *\n * @param supabase - Supabase client\n * @param userId - User ID to check\n * @param companyId - Company ID\n * @returns true if user is the owner\n *\n * @example\n * ```typescript\n * const isOwner = await isCompanyOwner(supabase, userId, companyId);\n * if (!isOwner) {\n *   throw new Error(\"Only company owner can perform this action\");\n * }\n * ```\n */\nexport async function isCompanyOwner(\n\tsupabase: SupabaseClient,\n\tuserId: string,\n\tcompanyId: string,\n): Promise<boolean> {\n\tconst { data, error } = await supabase.rpc(\"is_company_owner\", {\n\t\tuser_uuid: userId,\n\t\tcompany_uuid: companyId,\n\t});\n\n\tif (error) {\n\t\treturn false;\n\t}\n\n\treturn data === true;\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/**\n * Get all permissions for a role\n *\n * @param role - Role to get permissions for\n * @returns Array of permission keys\n *\n * @example\n * ```typescript\n * const managerPerms = getRolePermissions(\"manager\");\n * console.log(managerPerms); // [\"view_reports\", \"manage_team\", ...]\n * ```\n */\nfunction getRolePermissions(role: UserRole): Permission[] {\n\treturn ROLES[role]?.permissions || [];\n}\n\n/**\n * Check if a role has a specific permission (client-side check only)\n *\n * @param role - Role to check\n * @param permission - Permission to check for\n * @returns true if role has the permission\n *\n * @example\n * ```typescript\n * const canDelete = roleHasPermission(\"manager\", \"delete_jobs\");\n * ```\n */\nfunction roleHasPermission(\n\trole: UserRole,\n\tpermission: Permission,\n): boolean {\n\treturn ROLES[role]?.permissions.includes(permission);\n}\n\n/**\n * Get role configuration\n *\n * @param role - Role to get config for\n * @returns Role configuration\n *\n * @example\n * ```typescript\n * const config = getRoleConfig(\"manager\");\n * console.log(config.label); // \"Manager\"\n * ```\n */\nfunction getRoleConfig(role: UserRole): RoleConfig {\n\treturn ROLES[role];\n}\n","// Re-export from @stratos/auth package for backwards compatibility\nexport * from \"@stratos/auth/permissions\";\n","/**\n * Role Actions - Server Actions\n *\n * Server-side actions for role management and permission checks.\n * Uses Supabase RLS and database functions for security.\n */\n\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { z } from \"zod\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport {\n\tgetUserRole,\n\thasPermission,\n\thasRole,\n\tisCompanyOwner,\n\ttype Permission,\n\ttype UserRole,\n} from \"@/lib/auth/permissions\";\nimport { withErrorHandling } from \"@/lib/errors/with-error-handling\";\nimport { createClient } from \"@/lib/supabase/server\";\n\n// ============================================================================\n// Validation Schemas\n// ============================================================================\n\nconst updateRoleSchema = z.object({\n\tteamMemberId: z.string().uuid(),\n\tnewRole: z.enum([\n\t\t\"owner\",\n\t\t\"admin\",\n\t\t\"manager\",\n\t\t\"dispatcher\",\n\t\t\"technician\",\n\t\t\"csr\",\n\t]),\n\treason: z.string().optional(),\n});\n\nconst updatePermissionsSchema = z.object({\n\tteamMemberId: z.string().uuid(),\n\tpermissions: z.record(z.string(), z.boolean()),\n});\n\n// ============================================================================\n// Query Actions\n// ============================================================================\n\n/**\n * Get current user's role in active company\n *\n * @returns User's role or null\n *\n * @example\n * ```typescript\n * const role = await getCurrentUserRole();\n * if (role.success && role.data === \"manager\") {\n *   // Show manager dashboard\n * }\n * ```\n */\nexport async function getCurrentUserRole() {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new Error(\"Database connection not available\");\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tif (!user) {\n\t\t\tthrow new Error(\"Not authenticated\");\n\t\t}\n\n\t\tconst companyId = await getActiveCompanyId();\n\t\tif (!companyId) {\n\t\t\tthrow new Error(\"No active company\");\n\t\t}\n\n\t\tconst role = await getUserRole(supabase, user.id, companyId);\n\n\t\treturn role;\n\t});\n}\n\n/**\n * Check if current user has a specific permission\n *\n * @param permission - Permission to check\n * @returns true if user has permission\n *\n * @example\n * ```typescript\n * const result = await checkPermission(\"delete_jobs\");\n * if (!result.success || !result.data) {\n *   return { error: \"Access denied\" };\n * }\n * ```\n */\nasync function checkPermission(permission: Permission) {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new Error(\"Database connection not available\");\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tif (!user) {\n\t\t\tthrow new Error(\"Not authenticated\");\n\t\t}\n\n\t\tconst companyId = await getActiveCompanyId();\n\t\tif (!companyId) {\n\t\t\tthrow new Error(\"No active company\");\n\t\t}\n\n\t\tconst hasPerm = await hasPermission(\n\t\t\tsupabase,\n\t\t\tuser.id,\n\t\t\tpermission,\n\t\t\tcompanyId,\n\t\t);\n\n\t\treturn hasPerm;\n\t});\n}\n\n/**\n * Check if current user has a specific role\n *\n * @param role - Role to check\n * @returns true if user has role\n *\n * @example\n * ```typescript\n * const result = await checkRole(\"manager\");\n * if (!result.success || !result.data) {\n *   redirect(\"/dashboard\");\n * }\n * ```\n */\nasync function checkRole(role: UserRole) {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new Error(\"Database connection not available\");\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tif (!user) {\n\t\t\tthrow new Error(\"Not authenticated\");\n\t\t}\n\n\t\tconst companyId = await getActiveCompanyId();\n\t\tif (!companyId) {\n\t\t\tthrow new Error(\"No active company\");\n\t\t}\n\n\t\tconst hasRoleResult = await hasRole(supabase, user.id, role, companyId);\n\n\t\treturn hasRoleResult;\n\t});\n}\n\n/**\n * Check if current user is company owner\n *\n * @returns true if user is owner\n */\nasync function checkIsOwner() {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new Error(\"Database connection not available\");\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tif (!user) {\n\t\t\tthrow new Error(\"Not authenticated\");\n\t\t}\n\n\t\tconst companyId = await getActiveCompanyId();\n\t\tif (!companyId) {\n\t\t\tthrow new Error(\"No active company\");\n\t\t}\n\n\t\tconst isOwner = await isCompanyOwner(supabase, user.id, companyId);\n\n\t\treturn isOwner;\n\t});\n}\n\n// ============================================================================\n// Mutation Actions\n// ============================================================================\n\n/**\n * Update team member's role\n * Only owners and admins can change roles\n *\n * @param input - Team member ID, new role, and optional reason\n * @returns Updated team member\n *\n * @example\n * ```typescript\n * const result = await updateTeamMemberRole({\n *   teamMemberId: \"123...\",\n *   newRole: \"manager\",\n *   reason: \"Promoted to management\"\n * });\n * ```\n */\nasync function updateTeamMemberRole(\n\tinput: z.infer<typeof updateRoleSchema>,\n) {\n\treturn withErrorHandling(async () => {\n\t\t// Validate input\n\t\tconst validated = updateRoleSchema.parse(input);\n\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new Error(\"Database connection not available\");\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tif (!user) {\n\t\t\tthrow new Error(\"Not authenticated\");\n\t\t}\n\n\t\tconst companyId = await getActiveCompanyId();\n\t\tif (!companyId) {\n\t\t\tthrow new Error(\"No active company\");\n\t\t}\n\n\t\t// Check permission - only owners and admins can change roles\n\t\tconst canManageRoles =\n\t\t\t(await isCompanyOwner(supabase, user.id, companyId)) ||\n\t\t\t(await hasRole(supabase, user.id, \"admin\", companyId));\n\n\t\tif (!canManageRoles) {\n\t\t\tthrow new Error(\"Only owners and admins can change roles\");\n\t\t}\n\n\t\t// Get current role for audit log\n\t\tconst { data: currentMember } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\"role\")\n\t\t\t.eq(\"id\", validated.teamMemberId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (!currentMember) {\n\t\t\tthrow new Error(\"Team member not found\");\n\t\t}\n\n\t\t// Update role\n\t\tconst { data: updatedMember, error } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.update({ role: validated.newRole })\n\t\t\t.eq(\"id\", validated.teamMemberId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) {\n\t\t\tthrow new Error(error.message);\n\t\t}\n\n\t\t// Log role change\n\t\tawait supabase.from(\"role_change_log\").insert({\n\t\t\tteam_member_id: validated.teamMemberId,\n\t\t\tchanged_by: user.id,\n\t\t\told_role: currentMember.role,\n\t\t\tnew_role: validated.newRole,\n\t\t\treason: validated.reason,\n\t\t});\n\n\t\trevalidatePath(\"/dashboard/settings/team\");\n\t\trevalidatePath(`/dashboard/settings/team/${validated.teamMemberId}`);\n\n\t\treturn updatedMember;\n\t});\n}\n\n/**\n * Update team member's custom permissions\n * Only owners and admins can change permissions\n *\n * @param input - Team member ID and permissions object\n * @returns Updated team member\n *\n * @example\n * ```typescript\n * const result = await updateTeamMemberPermissions({\n *   teamMemberId: \"123...\",\n *   permissions: {\n *     \"delete_jobs\": true,\n *     \"approve_estimates\": true\n *   }\n * });\n * ```\n */\nasync function updateTeamMemberPermissions(\n\tinput: z.infer<typeof updatePermissionsSchema>,\n) {\n\treturn withErrorHandling(async () => {\n\t\t// Validate input\n\t\tconst validated = updatePermissionsSchema.parse(input);\n\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new Error(\"Database connection not available\");\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tif (!user) {\n\t\t\tthrow new Error(\"Not authenticated\");\n\t\t}\n\n\t\tconst companyId = await getActiveCompanyId();\n\t\tif (!companyId) {\n\t\t\tthrow new Error(\"No active company\");\n\t\t}\n\n\t\t// Check permission\n\t\tconst canManagePermissions =\n\t\t\t(await isCompanyOwner(supabase, user.id, companyId)) ||\n\t\t\t(await hasRole(supabase, user.id, \"admin\", companyId));\n\n\t\tif (!canManagePermissions) {\n\t\t\tthrow new Error(\"Only owners and admins can change permissions\");\n\t\t}\n\n\t\t// Update permissions\n\t\tconst { data: updatedMember, error } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.update({ permissions: validated.permissions })\n\t\t\t.eq(\"id\", validated.teamMemberId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) {\n\t\t\tthrow new Error(error.message);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/settings/team\");\n\t\trevalidatePath(`/dashboard/settings/team/${validated.teamMemberId}`);\n\n\t\treturn updatedMember;\n\t});\n}\n\n/**\n * Get team members with their roles\n *\n * @returns List of team members with roles\n */\nasync function getTeamMembersWithRoles() {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new Error(\"Database connection not available\");\n\t\t}\n\n\t\tconst companyId = await getActiveCompanyId();\n\t\tif (!companyId) {\n\t\t\tthrow new Error(\"No active company\");\n\t\t}\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\n\t\t\t\t`\n        *,\n        users (\n          id,\n          name,\n          email,\n          avatar\n        )\n      `,\n\t\t\t)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.order(\"created_at\", { ascending: false });\n\n\t\tif (error) {\n\t\t\tthrow new Error(error.message);\n\t\t}\n\n\t\treturn data;\n\t});\n}\n\n// ============================================================================\n// Owner Protection Actions\n// ============================================================================\n\n/**\n * Transfer company ownership to another team member\n * Requires password verification and extensive validation\n *\n * @param input - Transfer details including new owner, password, and reason\n * @returns Transfer ID for audit\n *\n * @example\n * ```typescript\n * const result = await transferOwnership({\n *   newOwnerId: \"user-uuid\",\n *   password: \"current-password\",\n *   reason: \"Retiring from business\"\n * });\n * ```\n */\nasync function transferOwnership(input: {\n\tnewOwnerId: string;\n\tpassword: string;\n\treason?: string;\n\tipAddress?: string;\n\tuserAgent?: string;\n}) {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new Error(\"Database connection not available\");\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tif (!user) {\n\t\t\tthrow new Error(\"Not authenticated\");\n\t\t}\n\n\t\tconst companyId = await getActiveCompanyId();\n\t\tif (!companyId) {\n\t\t\tthrow new Error(\"No active company\");\n\t\t}\n\n\t\t// Verify user is current owner\n\t\tconst isOwner = await isCompanyOwner(supabase, user.id, companyId);\n\t\tif (!isOwner) {\n\t\t\tthrow new Error(\"Only the current owner can transfer ownership\");\n\t\t}\n\n\t\t// Verify password\n\t\tconst { error: signInError } = await supabase.auth.signInWithPassword({\n\t\t\temail: user.email || \"\",\n\t\t\tpassword: input.password,\n\t\t});\n\n\t\tif (signInError) {\n\t\t\tthrow new Error(\"Password verification failed\");\n\t\t}\n\n\t\t// Call database function to transfer ownership\n\t\tconst { data: transferId, error } = await supabase.rpc(\n\t\t\t\"transfer_company_ownership\",\n\t\t\t{\n\t\t\t\tp_company_id: companyId,\n\t\t\t\tp_current_owner_id: user.id,\n\t\t\t\tp_new_owner_id: input.newOwnerId,\n\t\t\t\tp_reason: input.reason,\n\t\t\t\tp_ip_address: input.ipAddress,\n\t\t\t\tp_user_agent: input.userAgent,\n\t\t\t},\n\t\t);\n\n\t\tif (error) {\n\t\t\tthrow new Error(error.message || \"Failed to transfer ownership\");\n\t\t}\n\n\t\t// Revalidate all relevant paths\n\t\trevalidatePath(\"/dashboard/settings/team\");\n\t\trevalidatePath(\"/dashboard\");\n\n\t\treturn transferId;\n\t});\n}\n\n/**\n * Get ownership transfer history for the company\n * Shows audit trail of all ownership changes\n *\n * @returns List of ownership transfers\n */\nasync function getOwnershipTransferHistory() {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new Error(\"Database connection not available\");\n\t\t}\n\n\t\tconst companyId = await getActiveCompanyId();\n\t\tif (!companyId) {\n\t\t\tthrow new Error(\"No active company\");\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tif (!user) {\n\t\t\tthrow new Error(\"Not authenticated\");\n\t\t}\n\n\t\t// Only owners and admins can view transfer history\n\t\tconst canView =\n\t\t\t(await isCompanyOwner(supabase, user.id, companyId)) ||\n\t\t\t(await hasRole(supabase, user.id, \"admin\", companyId));\n\n\t\tif (!canView) {\n\t\t\tthrow new Error(\"Only owners and admins can view transfer history\");\n\t\t}\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"ownership_transfers\")\n\t\t\t.select(\n\t\t\t\t`\n        *,\n        previous_owner:users!ownership_transfers_previous_owner_id_fkey(id, name, email),\n        new_owner:users!ownership_transfers_new_owner_id_fkey(id, name, email),\n        initiated_by_user:users!ownership_transfers_initiated_by_fkey(id, name, email)\n      `,\n\t\t\t)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.order(\"created_at\", { ascending: false });\n\n\t\tif (error) {\n\t\t\tthrow new Error(error.message);\n\t\t}\n\n\t\treturn data;\n\t});\n}\n\n/**\n * Check if a team member can be deleted\n * Prevents deletion of company owner\n *\n * @param teamMemberId - Team member to check\n * @returns Object with canDelete boolean and reason if not allowed\n */\nexport async function canDeleteTeamMember(teamMemberId: string) {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new Error(\"Database connection not available\");\n\t\t}\n\n\t\tconst companyId = await getActiveCompanyId();\n\t\tif (!companyId) {\n\t\t\tthrow new Error(\"No active company\");\n\t\t}\n\n\t\t// Get team member details\n\t\tconst { data: teamMember, error } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\"user_id, role\")\n\t\t\t.eq(\"id\", teamMemberId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (error || !teamMember) {\n\t\t\tthrow new Error(\"Team member not found\");\n\t\t}\n\n\t\t// Check if user is company owner\n\t\tconst { data: company } = await supabase\n\t\t\t.from(\"companies\")\n\t\t\t.select(\"owner_id\")\n\t\t\t.eq(\"id\", companyId)\n\t\t\t.single();\n\n\t\tif (company && company.owner_id === teamMember.user_id) {\n\t\t\treturn {\n\t\t\t\tcanDelete: false,\n\t\t\t\treason:\n\t\t\t\t\t\"Cannot delete company owner. Transfer ownership first before removing this team member.\",\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tcanDelete: true,\n\t\t};\n\t});\n}\n","/**\n * Knowledge Base Server Actions\n *\n * Server-side operations for the knowledge base including:\n * - Fetching articles with filtering and pagination\n * - Full-text search using PostgreSQL tsvector\n * - Category and tag management\n * - Article view tracking\n * - Feedback submission\n *\n * Performance optimizations:\n * - Server-side data fetching\n * - Efficient database queries with proper indexes\n * - RLS policies for public read access\n * - Full-text search with ranking\n */\n\n\"use server\";\n\nimport { createClient as createSupabaseClient } from \"@supabase/supabase-js\";\nimport type {\n\tKBArticleWithRelations,\n\tKBCategoryWithChildren,\n\tKBFeedbackSubmission,\n\tKBSearchFilters,\n} from \"@/lib/kb/types\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport type { Database } from \"@/types/supabase\";\n\n// Constants\nconst DEFAULT_ARTICLES_LIMIT = 20;\nconst SEARCH_QUERY_SPLIT_REGEX = /\\s+/;\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\nconst publicSupabase =\n\tsupabaseUrl && supabaseAnonKey\n\t\t? createSupabaseClient<Database>(supabaseUrl, supabaseAnonKey, {\n\t\t\t\tauth: {\n\t\t\t\t\tpersistSession: false,\n\t\t\t\t\tautoRefreshToken: false,\n\t\t\t\t},\n\t\t\t})\n\t\t: null;\n\ntype RawCategory = Database[\"public\"][\"Tables\"][\"kb_categories\"][\"Row\"];\ntype RawArticle = Database[\"public\"][\"Tables\"][\"kb_articles\"][\"Row\"] & {\n\tcategory?: RawCategory;\n\ttags?: Array<{ tag: Database[\"public\"][\"Tables\"][\"kb_tags\"][\"Row\"] }>;\n};\ntype RawArticleTag = { tag: Database[\"public\"][\"Tables\"][\"kb_tags\"][\"Row\"] };\n\nfunction normalizeCategory(raw: RawCategory): KBCategoryWithChildren {\n\treturn {\n\t\t...raw,\n\t\tdescription: raw?.description ?? undefined,\n\t\ticon: raw?.icon ?? undefined,\n\t};\n}\n\nfunction normalizeArticle(raw: RawArticle): KBArticleWithRelations {\n\treturn {\n\t\t...raw,\n\t\texcerpt: raw?.excerpt ?? undefined,\n\t\tfeatured_image: raw?.featured_image ?? undefined,\n\t\tauthor: raw?.author ?? undefined,\n\t\tpublished_at: raw?.published_at ?? undefined,\n\t\tupdated_at: raw?.updated_at ?? undefined,\n\t\tmetaTitle: raw?.metaTitle ?? undefined,\n\t\tmetaDescription: raw?.metaDescription ?? undefined,\n\t\tkeywords: raw?.keywords ?? undefined,\n\t\ttags: raw?.tags?.map((at: RawArticleTag) => at.tag) ?? [],\n\t\tcategory: raw?.category ? normalizeCategory(raw.category) : raw?.category,\n\t};\n}\n\n// ============================================================================\n// GET ARTICLES\n// ============================================================================\n\n/**\n * Get all published articles with optional filters\n */\nexport async function getKBArticles(filters?: KBSearchFilters): Promise<{\n\tsuccess: boolean;\n\terror?: string;\n\tarticles?: KBArticleWithRelations[];\n\ttotal?: number;\n}> {\n\ttry {\n\t\tconst supabase = publicSupabase;\n\n\t\tif (!supabase) {\n\t\t\treturn { success: false, error: \"Supabase configuration is missing\" };\n\t\t}\n\n\t\tlet query = supabase\n\t\t\t.from(\"kb_articles\")\n\t\t\t.select(\n\t\t\t\t`\n        *,\n        category:kb_categories(*),\n        tags:kb_article_tags(\n          tag:kb_tags(*)\n        )\n      `,\n\t\t\t\t{ count: \"exact\" },\n\t\t\t)\n\t\t\t.eq(\"published\", true)\n\t\t\t.order(\"published_at\", { ascending: false });\n\n\t\t// Apply filters\n\t\tif (filters?.category) {\n\t\t\tquery = query.eq(\"category.slug\", filters.category);\n\t\t}\n\n\t\tif (filters?.featured !== undefined) {\n\t\t\tquery = query.eq(\"featured\", filters.featured);\n\t\t}\n\n\t\t// Limit and offset\n\t\tconst limit = filters?.limit || DEFAULT_ARTICLES_LIMIT;\n\t\tconst offset = filters?.offset || 0;\n\t\tquery = query.range(offset, offset + limit - 1);\n\n\t\tconst { data, error, count } = await query;\n\n\t\tif (error) {\n\t\t\treturn { success: false, error: error.message };\n\t\t}\n\n\t\tconst articles: KBArticleWithRelations[] =\n\t\t\tdata?.map((article: RawArticle) => normalizeArticle(article)) ?? [];\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tarticles,\n\t\t\ttotal: count || 0,\n\t\t};\n\t} catch (error) {\n\t\tif (error instanceof Error) {\n\t\t\treturn { success: false, error: error.message };\n\t\t}\n\t\treturn { success: false, error: \"Failed to fetch articles\" };\n\t}\n}\n\n/**\n * Get single article by slug and category\n */\nexport async function getKBArticle(\n\tcategorySlug: string,\n\tarticleSlug: string,\n): Promise<{\n\tsuccess: boolean;\n\terror?: string;\n\tarticle?: KBArticleWithRelations;\n}> {\n\ttry {\n\t\tconst supabase = publicSupabase;\n\n\t\tif (!supabase) {\n\t\t\treturn { success: false, error: \"Supabase configuration is missing\" };\n\t\t}\n\n\t\t// First get the category\n\t\tconst { data: category, error: categoryError } = await supabase\n\t\t\t.from(\"kb_categories\")\n\t\t\t.select(\"id\")\n\t\t\t.eq(\"slug\", categorySlug)\n\t\t\t.eq(\"is_active\", true)\n\t\t\t.single();\n\n\t\tif (categoryError || !category) {\n\t\t\treturn { success: false, error: \"Category not found\" };\n\t\t}\n\n\t\t// Get the article\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"kb_articles\")\n\t\t\t.select(\n\t\t\t\t`\n        *,\n        category:kb_categories(*),\n        tags:kb_article_tags(\n          tag:kb_tags(*)\n        )\n      `,\n\t\t\t)\n\t\t\t.eq(\"category_id\", category.id)\n\t\t\t.eq(\"slug\", articleSlug)\n\t\t\t.eq(\"published\", true)\n\t\t\t.single();\n\n\t\tif (error) {\n\t\t\treturn { success: false, error: error.message };\n\t\t}\n\n\t\tif (!data) {\n\t\t\treturn { success: false, error: \"Article not found\" };\n\t\t}\n\n\t\t// Transform data\n\t\tconst article = normalizeArticle(data);\n\n\t\treturn { success: true, article };\n\t} catch (error) {\n\t\tif (error instanceof Error) {\n\t\t\treturn { success: false, error: error.message };\n\t\t}\n\t\treturn { success: false, error: \"Failed to fetch article\" };\n\t}\n}\n\n// ============================================================================\n// GET CATEGORIES\n// ============================================================================\n\n/**\n * Get all active categories with children\n */\nexport async function getKBCategories(): Promise<{\n\tsuccess: boolean;\n\terror?: string;\n\tcategories?: KBCategoryWithChildren[];\n}> {\n\ttry {\n\t\tconst supabase = publicSupabase;\n\n\t\tif (!supabase) {\n\t\t\treturn { success: false, error: \"Supabase configuration is missing\" };\n\t\t}\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"kb_categories\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"is_active\", true)\n\t\t\t.order(\"order\", { ascending: true })\n\t\t\t.order(\"title\", { ascending: true });\n\n\t\tif (error) {\n\t\t\treturn { success: false, error: error.message };\n\t\t}\n\n\t\t// Build hierarchical structure\n\t\tconst categoryMap = new Map<string, KBCategoryWithChildren>();\n\t\tconst rootCategories: KBCategoryWithChildren[] = [];\n\n\t\t// First pass: create all categories\n\t\tif (data) {\n\t\t\tfor (const cat of data) {\n\t\t\t\tcategoryMap.set(cat.id, {\n\t\t\t\t\t...normalizeCategory(cat),\n\t\t\t\t\tchildren: [] as KBCategoryWithChildren[],\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Second pass: build hierarchy\n\t\tif (data) {\n\t\t\tfor (const cat of data) {\n\t\t\t\tconst category = categoryMap.get(cat.id);\n\t\t\t\tif (!category) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (cat.parent_id) {\n\t\t\t\t\tconst parent = categoryMap.get(cat.parent_id);\n\t\t\t\t\tif (parent) {\n\t\t\t\t\t\tparent.children = parent.children || [];\n\t\t\t\t\t\tparent.children.push(category);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\trootCategories.push(category);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn { success: true, categories: rootCategories };\n\t} catch (error) {\n\t\tif (error instanceof Error) {\n\t\t\treturn { success: false, error: error.message };\n\t\t}\n\t\treturn { success: false, error: \"Failed to fetch categories\" };\n\t}\n}\n\n// ============================================================================\n// SEARCH\n// ============================================================================\n\n/**\n * Search articles using full-text search\n */\nexport async function searchKBArticles(\n\tquery: string,\n\tfilters?: Omit<KBSearchFilters, \"query\">,\n): Promise<{\n\tsuccess: boolean;\n\terror?: string;\n\tarticles?: KBArticleWithRelations[];\n\ttotal?: number;\n}> {\n\ttry {\n\t\tconst supabase = publicSupabase;\n\n\t\tif (!supabase) {\n\t\t\treturn { success: false, error: \"Supabase configuration is missing\" };\n\t\t}\n\n\t\tif (!query || query.trim().length === 0) {\n\t\t\treturn { success: true, articles: [], total: 0 };\n\t\t}\n\n\t\t// Use PostgreSQL full-text search\n\t\t// Convert query to tsquery format\n\t\tconst searchQuery = query\n\t\t\t.split(SEARCH_QUERY_SPLIT_REGEX)\n\t\t\t.map((term) => `${term}:*`)\n\t\t\t.join(\" & \");\n\n\t\t// Direct query using text search\n\t\tconst limit = filters?.limit || DEFAULT_ARTICLES_LIMIT;\n\t\tconst offset = filters?.offset || 0;\n\n\t\tconst { data, error, count } = await supabase\n\t\t\t.from(\"kb_articles\")\n\t\t\t.select(\n\t\t\t\t`\n        *,\n        category:kb_categories(*),\n        tags:kb_article_tags(\n          tag:kb_tags(*)\n        )\n      `,\n\t\t\t\t{ count: \"exact\" },\n\t\t\t)\n\t\t\t.eq(\"published\", true)\n\t\t\t.textSearch(\"search_vector\", searchQuery, {\n\t\t\t\ttype: \"websearch\",\n\t\t\t\tconfig: \"english\",\n\t\t\t})\n\t\t\t.order(\"view_count\", { ascending: false })\n\t\t\t.limit(limit)\n\t\t\t.range(offset, offset + limit - 1);\n\n\t\tif (error) {\n\t\t\treturn { success: false, error: error.message };\n\t\t}\n\n\t\t// Transform data\n\t\tconst articles: KBArticleWithRelations[] =\n\t\t\tdata?.map((article: RawArticle) => normalizeArticle(article)) ?? [];\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tarticles,\n\t\t\ttotal: count || 0,\n\t\t};\n\t} catch (error) {\n\t\tif (error instanceof Error) {\n\t\t\treturn { success: false, error: error.message };\n\t\t}\n\t\treturn { success: false, error: \"Failed to search articles\" };\n\t}\n}\n\n// ============================================================================\n// RELATED ARTICLES\n// ============================================================================\n\n/**\n * Get related articles for an article\n */\nexport async function getKBRelatedArticles(\n\tarticleId: string,\n\tlimit = 5,\n): Promise<{\n\tsuccess: boolean;\n\terror?: string;\n\tarticles?: KBArticleWithRelations[];\n}> {\n\ttry {\n\t\tconst supabase = publicSupabase;\n\n\t\tif (!supabase) {\n\t\t\treturn { success: false, error: \"Supabase configuration is missing\" };\n\t\t}\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"kb_article_related\")\n\t\t\t.select(\n\t\t\t\t`\n        related_article:kb_articles!kb_article_related_related_article_id_fkey(\n          *,\n          category:kb_categories(*),\n          tags:kb_article_tags(\n            tag:kb_tags(*)\n          )\n        )\n      `,\n\t\t\t)\n\t\t\t.eq(\"article_id\", articleId)\n\t\t\t.eq(\"related_article.published\", true)\n\t\t\t.order(\"order\", { ascending: true })\n\t\t\t.limit(limit);\n\n\t\tif (error) {\n\t\t\treturn { success: false, error: error.message };\n\t\t}\n\n\t\tconst articles: KBArticleWithRelations[] =\n\t\t\tdata?.map((rel: any) => normalizeArticle(rel.related_article)) ?? [];\n\n\t\treturn { success: true, articles };\n\t} catch (error) {\n\t\tif (error instanceof Error) {\n\t\t\treturn { success: false, error: error.message };\n\t\t}\n\t\treturn { success: false, error: \"Failed to fetch related articles\" };\n\t}\n}\n\n// ============================================================================\n// VIEW TRACKING\n// ============================================================================\n\n/**\n * Increment article view count\n */\nexport async function incrementArticleViews(\n\tarticleId: string,\n): Promise<{ success: boolean; error?: string }> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tif (!supabase) {\n\t\t\treturn { success: false, error: \"Database connection not available\" };\n\t\t}\n\n\t\tconst { error } = await supabase.rpc(\"increment_kb_article_views\", {\n\t\t\tarticle_id: articleId,\n\t\t});\n\n\t\t// Fallback if RPC doesn't exist - get current count and increment\n\t\tif (error) {\n\t\t\tconst { data: article } = await supabase\n\t\t\t\t.from(\"kb_articles\")\n\t\t\t\t.select(\"view_count\")\n\t\t\t\t.eq(\"id\", articleId)\n\t\t\t\t.single();\n\n\t\t\tif (article) {\n\t\t\t\tconst { error: updateError } = await supabase\n\t\t\t\t\t.from(\"kb_articles\")\n\t\t\t\t\t.update({ view_count: (article.view_count || 0) + 1 })\n\t\t\t\t\t.eq(\"id\", articleId);\n\n\t\t\t\tif (updateError) {\n\t\t\t\t\treturn { success: false, error: updateError.message };\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tif (error instanceof Error) {\n\t\t\treturn { success: false, error: error.message };\n\t\t}\n\t\treturn { success: false, error: \"Failed to increment views\" };\n\t}\n}\n\n// ============================================================================\n// FEEDBACK\n// ============================================================================\n\n/**\n * Submit feedback for an article\n */\nexport async function submitKBFeedback(\n\tfeedback: KBFeedbackSubmission,\n): Promise<{ success: boolean; error?: string }> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tif (!supabase) {\n\t\t\treturn { success: false, error: \"Database connection not available\" };\n\t\t}\n\n\t\tconst { error } = await supabase.from(\"kb_feedback\").insert({\n\t\t\tarticle_id: feedback.articleId,\n\t\t\thelpful: feedback.helpful,\n\t\t\tcomment: feedback.comment,\n\t\t\tuser_email: feedback.userEmail,\n\t\t});\n\n\t\tif (error) {\n\t\t\treturn { success: false, error: error.message };\n\t\t}\n\n\t\t// Update helpful/not helpful counts\n\t\tif (feedback.helpful !== undefined) {\n\t\t\tconst { data: article } = await supabase\n\t\t\t\t.from(\"kb_articles\")\n\t\t\t\t.select(\"helpful_count, not_helpful_count\")\n\t\t\t\t.eq(\"id\", feedback.articleId)\n\t\t\t\t.single();\n\n\t\t\tif (article) {\n\t\t\t\tconst countField =\n\t\t\t\t\tfeedback.helpful === true ? \"helpful_count\" : \"not_helpful_count\";\n\t\t\t\tconst newCount = (article[countField] || 0) + 1;\n\n\t\t\t\tawait supabase\n\t\t\t\t\t.from(\"kb_articles\")\n\t\t\t\t\t.update({ [countField]: newCount })\n\t\t\t\t\t.eq(\"id\", feedback.articleId);\n\t\t\t}\n\t\t}\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tif (error instanceof Error) {\n\t\t\treturn { success: false, error: error.message };\n\t\t}\n\t\treturn { success: false, error: \"Failed to submit feedback\" };\n\t}\n}\n","export {getCurrentUserRole as '001f005176797ef23488068124fb9a744915a477de'} from 'ACTIONS_MODULE0'\nexport {canDeleteTeamMember as '406f6624261c6dd1a908026fa1408a3f6d507b6e7d'} from 'ACTIONS_MODULE0'\nexport {getKBCategories as '00c1e90eff34225b6dd95f5f2f2a91828868b9fcfb'} from 'ACTIONS_MODULE1'\nexport {submitKBFeedback as '404ca2dce3a3b5558a45a363300d09bf2965522750'} from 'ACTIONS_MODULE1'\nexport {getKBArticles as '4070bed0ecc25d050b4520c0f696340ebb01e5390b'} from 'ACTIONS_MODULE1'\nexport {incrementArticleViews as '40f0ec73569584e2e98c0966c6b8ceab6dc0c1f682'} from 'ACTIONS_MODULE1'\nexport {searchKBArticles as '60301b0c2049c37f7b265049269699f6d4a7a33d92'} from 'ACTIONS_MODULE1'\nexport {getKBRelatedArticles as '605a67c4b75156644201622753ea0654e68cee60ae'} from 'ACTIONS_MODULE1'\nexport {getKBArticle as '60e4942793029c05824ec40bb94739dc0c0daa1438'} from 'ACTIONS_MODULE1'\nexport {searchKBArticles as '60301b0c2049c37f7b265049269699f6d4a7a33d92'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":"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"}