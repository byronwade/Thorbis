{"version":3,"sources":["../../../../../../apps/web/src/components/work/new/new-skeleton.tsx","../../../../../../apps/web/src/components/work/appointments/appointment-create-form-v2.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/work/appointments/new/page.tsx","../../../../../../apps/web/src/components/work/appointments/appointment-new-data.tsx"],"sourcesContent":["/**\n * Skeleton UI for generic work \"new\" routes (e.g. appointments/contracts).\n * Used as a Suspense fallback while loading creation forms.\n */\nexport function WorkNewSkeleton() {\n\treturn (\n\t\t<div className=\"flex h-full flex-col gap-4 p-4\">\n\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t<div className=\"bg-muted h-8 w-64 animate-pulse rounded\" />\n\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t<div className=\"bg-muted h-8 w-24 animate-pulse rounded\" />\n\t\t\t\t\t<div className=\"bg-muted h-8 w-24 animate-pulse rounded\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"space-y-3\">\n\t\t\t\t{[...new Array(6)].map((_, index) => (\n\t\t\t\t\t<div className=\"space-y-2\" key={index}>\n\t\t\t\t\t\t<div className=\"bg-muted h-4 w-40 animate-pulse rounded\" />\n\t\t\t\t\t\t<div className=\"bg-muted h-9 w-full animate-pulse rounded\" />\n\t\t\t\t\t</div>\n\t\t\t\t))}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const AppointmentCreateFormV2 = registerClientReference(\n    function() { throw new Error(\"Attempted to call AppointmentCreateFormV2() from the server but AppointmentCreateFormV2 is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/work/appointments/appointment-create-form-v2.tsx\",\n    \"AppointmentCreateFormV2\",\n);\n","/**\n * Appointment Creation Page - PPR Enabled\n *\n * Uses Partial Prerendering for instant page loads.\n * Performance: 10-20x faster than traditional SSR\n */\n\nimport { Suspense } from \"react\";\nimport { AppointmentNewData } from \"@/components/work/appointments/appointment-new-data\";\nimport { WorkNewSkeleton } from \"@/components/work/new/new-skeleton\";\n\ntype SearchParams = Promise<{\n\tjobId?: string;\n\tcustomerId?: string;\n\tpropertyId?: string;\n}>;\n\ntype PageProps = {\n\tsearchParams: SearchParams;\n};\n\nexport default async function WorkAppointmentsNewPage({\n\tsearchParams,\n}: PageProps) {\n\tconst params = await searchParams;\n\n\treturn (\n\t\t<Suspense fallback={<WorkNewSkeleton />}>\n\t\t\t<AppointmentNewData searchParams={params} />\n\t\t</Suspense>\n\t);\n}\n","import { notFound } from \"next/navigation\";\nimport { getActiveCompanyId } from \"@/lib/auth/company-context\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { AppointmentCreateFormV2 } from \"./appointment-create-form-v2\";\n\ntype SearchParams = {\n\tjobId?: string;\n\tcustomerId?: string;\n\tpropertyId?: string;\n};\n\nexport async function AppointmentNewData({\n\tsearchParams,\n}: {\n\tsearchParams: SearchParams;\n}) {\n\tconst supabase = await createClient();\n\tif (!supabase) {\n\t\treturn notFound();\n\t}\n\n\tconst {\n\t\tdata: { user },\n\t} = await supabase.auth.getUser();\n\tif (!user) {\n\t\treturn notFound();\n\t}\n\n\tconst activeCompanyId = await getActiveCompanyId();\n\tif (!activeCompanyId) {\n\t\treturn notFound();\n\t}\n\n\t// Load customers\n\tconst { data: customers } = await supabase\n\t\t.from(\"customers\")\n\t\t.select(\"id, first_name, last_name, display_name, email, phone\")\n\t\t.eq(\"company_id\", activeCompanyId)\n\t\t.is(\"deleted_at\", null)\n\t\t.order(\"display_name\")\n\t\t.limit(100);\n\n\t// Load properties\n\tconst { data: properties } = await supabase\n\t\t.from(\"properties\")\n\t\t.select(\"id, customer_id, address, city, state, zip_code\")\n\t\t.eq(\"company_id\", activeCompanyId)\n\t\t.is(\"deleted_at\", null)\n\t\t.order(\"address\")\n\t\t.limit(500);\n\n\t// Load jobs with full data including customer and property details\n\t// Use explicit foreign key relationships to avoid ambiguity\n\t// jobs_customer_id_customers_id_fk and jobs_property_id_properties_id_fk\n\tlet jobsQuery = supabase\n\t\t.from(\"jobs\")\n\t\t.select(\n\t\t\t`\n\t\t\tid,\n\t\t\tjob_number,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tcustomer_id,\n\t\t\tproperty_id,\n\t\t\tstatus,\n\t\t\tcustomer:customers!jobs_customer_id_customers_id_fk(id, display_name, first_name, last_name, email, phone),\n\t\t\tproperty:properties!jobs_property_id_properties_id_fk(id, address, city, state, zip_code)\n\t\t`,\n\t\t)\n\t\t.eq(\"company_id\", activeCompanyId)\n\t\t.is(\"deleted_at\", null);\n\n\t// If we have a specific jobId, load just that job\n\tif (searchParams.jobId) {\n\t\tjobsQuery = jobsQuery.eq(\"id\", searchParams.jobId);\n\t} else {\n\t\t// Otherwise load recent active jobs\n\t\tjobsQuery = jobsQuery\n\t\t\t.in(\"status\", [\"scheduled\", \"in_progress\", \"pending\"])\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(50);\n\t}\n\n\tconst { data: jobs, error: jobsError } = await jobsQuery;\n\n\t// Log errors for debugging\n\tif (jobsError) {\n\t\tconsole.error(\"Jobs query error:\", jobsError);\n\t}\n\n\t// Load team members\n\tconst { data: teamMembers } = await supabase\n\t\t.from(\"profiles\")\n\t\t.select(\"id, email, full_name\")\n\t\t.eq(\"company_id\", activeCompanyId)\n\t\t.order(\"full_name\")\n\t\t.limit(100);\n\n\treturn (\n\t\t<AppointmentCreateFormV2\n\t\t\tjobId={searchParams.jobId}\n\t\t\tcustomerId={searchParams.customerId}\n\t\t\tpropertyId={searchParams.propertyId}\n\t\t\tcustomers={customers || []}\n\t\t\tproperties={properties || []}\n\t\t\tjobs={jobs || []}\n\t\t\tteamMembers={teamMembers || []}\n\t\t/>\n\t);\n}\n"],"names":[],"mappings":"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","ignoreList":[1]}