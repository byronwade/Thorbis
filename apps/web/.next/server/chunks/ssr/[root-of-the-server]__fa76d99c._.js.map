{"version":3,"sources":["../../../../../../apps/web/src/components/pricebook/category-navigation-sync.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/components/pricebook/drill-down-view.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/work/pricebook/c/%5B...slug%5D/page.tsx","../../../../../../apps/web/src/lib/pricebook/category-tree-server.ts","../../../../../../apps/web/src/lib/pricebook/category-tree-shared.ts"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const CategoryNavigationSync = registerClientReference(\n    function() { throw new Error(\"Attempted to call CategoryNavigationSync() from the server but CategoryNavigationSync is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/pricebook/category-navigation-sync.tsx\",\n    \"CategoryNavigationSync\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const DrillDownView = registerClientReference(\n    function() { throw new Error(\"Attempted to call DrillDownView() from the server but DrillDownView is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/components/pricebook/drill-down-view.tsx\",\n    \"DrillDownView\",\n);\n","/**\n * Price Book Category Drill-Down Page - Server Component\n *\n * URL Structure:\n * - /pricebook/c/hvac → HVAC category\n * - /pricebook/c/hvac/heating → HVAC > Heating\n * - /pricebook/c/hvac/heating/furnaces → HVAC > Heating > Furnaces\n *\n * Performance optimizations:\n * - Server Component by default\n * - URL-based navigation (shareable/bookmarkable)\n * - Syncs with Zustand store for UI consistency\n */\n\nimport { notFound } from \"next/navigation\";\nimport { Suspense } from \"react\";\nimport { CategoryNavigationSync } from \"@/components/pricebook/category-navigation-sync\";\nimport { DrillDownView } from \"@/components/pricebook/drill-down-view\";\nimport { getCategoryTree } from \"@/lib/pricebook/category-tree-server\";\nimport { getCategoriesAtPath } from \"@/lib/pricebook/category-tree-shared\";\nimport { createClient } from \"@/lib/supabase/server\";\n\nexport default async function CategoryPage({\n\tparams,\n}: {\n\tparams: Promise<{ slug: string[] }>;\n}) {\n\tconst { slug } = await params;\n\n\treturn (\n\t\t<Suspense\n\t\t\tfallback={\n\t\t\t\t<div className=\"flex h-full items-center justify-center p-4\">\n\t\t\t\t\t<div className=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\tLoading price book category...\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t}\n\t\t>\n\t\t\t<CategoryPageContent slug={slug} />\n\t\t</Suspense>\n\t);\n}\n\nasync function CategoryPageContent({ slug }: { slug: string[] }) {\n\tconst supabase = await createClient();\n\n\tif (!supabase) {\n\t\treturn notFound();\n\t}\n\n\t// Decode URL segments to category names\n\tconst categoryPath = slug.map((segment) =>\n\t\tsegment\n\t\t\t.split(\"-\")\n\t\t\t.map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n\t\t\t.join(\" \"),\n\t);\n\n\t// Build the category path string (e.g., \"HVAC > Heating > Furnaces\")\n\tconst categoryPathString = categoryPath.join(\" › \");\n\n\t// Validate category exists in database\n\tconst { data: category, error: categoryError } = await supabase\n\t\t.from(\"price_book_categories\")\n\t\t.select(\"id\")\n\t\t.eq(\"path\", categoryPathString)\n\t\t.eq(\"is_active\", true)\n\t\t.single();\n\n\tif (categoryError || !category) {\n\t\tnotFound();\n\t}\n\n\t// Fetch price book items for this category\n\tconst { data: items, error: itemsError } = await supabase\n\t\t.from(\"price_book_items\")\n\t\t.select(\"*\")\n\t\t.eq(\"category_id\", category.id)\n\t\t.eq(\"is_active\", true)\n\t\t.order(\"name\", { ascending: true });\n\n\tif (itemsError) {\n\t\tthrow new Error(`Failed to load price book items: ${itemsError.message}`);\n\t}\n\n\t// Fetch full category tree and get subcategories at current path\n\tconst fullTree = await getCategoryTree();\n\tconst subcategories = getCategoriesAtPath(fullTree, categoryPath);\n\n\treturn (\n\t\t<>\n\t\t\t{/* Client component to sync URL with Zustand store */}\n\t\t\t<CategoryNavigationSync categoryPath={categoryPath} />\n\n\t\t\t{/* Server component renders content with subcategories */}\n\t\t\t<DrillDownView\n\t\t\t\tcategories={subcategories}\n\t\t\t\titems={items || []}\n\t\t\t\titemsPerPage={50}\n\t\t\t/>\n\t\t</>\n\t);\n}\n","/**\n * Server-Side Category Tree Functions\n *\n * Functions for fetching and building category trees on the server.\n * Uses server-side Supabase client with session management.\n */\n\nimport { createClient as createServerClient } from \"@/lib/supabase/server\";\nimport {\n\tbuildCategoryTree,\n\ttype DatabaseCategory,\n} from \"./category-tree-shared\";\n\n/**\n * Fetch all categories for the current user's company (server-side)\n */\nasync function fetchCategoriesServer(): Promise<DatabaseCategory[]> {\n\tconst supabase = await createServerClient();\n\n\tif (!supabase) {\n\t\treturn [];\n\t}\n\n\tconst { data: categories, error } = await supabase\n\t\t.from(\"price_book_categories\")\n\t\t.select(\n\t\t\t\"id, name, slug, parent_id, path, level, sort_order, item_count, descendant_item_count\",\n\t\t)\n\t\t.eq(\"is_active\", true)\n\t\t.order(\"level\", { ascending: true })\n\t\t.order(\"sort_order\", { ascending: true });\n\n\tif (error) {\n\t\treturn [];\n\t}\n\n\treturn categories || [];\n}\n\n/**\n * Fetch and build complete category tree (server-side)\n */\nexport async function getCategoryTree() {\n\tconst categories = await fetchCategoriesServer();\n\treturn buildCategoryTree(categories);\n}\n","/**\n * Shared Category Tree Utilities\n *\n * Pure utility functions for building and navigating category trees.\n * Can be imported by both server and client code.\n */\n\nimport type { CategoryNode } from \"@/components/pricebook/drill-down-view\";\n\nexport type DatabaseCategory = {\n\tid: string;\n\tname: string;\n\tslug: string;\n\tparent_id: string | null;\n\tpath: string;\n\tlevel: number;\n\tsort_order: number;\n\titem_count: number;\n\tdescendant_item_count: number;\n};\n\n/**\n * Build hierarchical category tree from flat list\n */\nexport function buildCategoryTree(\n\tcategories: DatabaseCategory[],\n): CategoryNode[] {\n\t// Create a map for quick lookup\n\tconst categoryMap = new Map<\n\t\tstring,\n\t\tCategoryNode & { parent_id: string | null }\n\t>();\n\n\t// First pass: Create all nodes\n\tcategories.forEach((cat) => {\n\t\tcategoryMap.set(cat.id, {\n\t\t\tname: cat.name,\n\t\t\tcount: cat.descendant_item_count, // Use descendant count for tree display\n\t\t\timageUrl: undefined, // Could be added to schema later\n\t\t\tchildren: [],\n\t\t\tparent_id: cat.parent_id,\n\t\t});\n\t});\n\n\t// Second pass: Build tree structure\n\tconst rootNodes: CategoryNode[] = [];\n\n\tcategoryMap.forEach((node, _id) => {\n\t\tif (node.parent_id === null) {\n\t\t\t// Root level category\n\t\t\tconst { parent_id, ...cleanNode } = node;\n\t\t\trootNodes.push(cleanNode);\n\t\t} else {\n\t\t\t// Child category - add to parent's children\n\t\t\tconst parent = categoryMap.get(node.parent_id);\n\t\t\tif (parent?.children) {\n\t\t\t\tconst { parent_id, ...cleanNode } = node;\n\t\t\t\tparent.children.push(cleanNode);\n\t\t\t}\n\t\t}\n\t});\n\n\treturn rootNodes;\n}\n\n/**\n * Get categories at a specific path level\n * Example: [\"HVAC\", \"Heating\"] returns children of HVAC > Heating\n */\nexport function getCategoriesAtPath(\n\ttree: CategoryNode[],\n\tpath: string[],\n): CategoryNode[] {\n\tlet current = tree;\n\n\tfor (const segment of path) {\n\t\tconst found = current.find((cat) => cat.name === segment);\n\t\tif (!found?.children) {\n\t\t\treturn [];\n\t\t}\n\t\tcurrent = found.children;\n\t}\n\n\treturn current;\n}\n"],"names":[],"mappings":"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","ignoreList":[0,1]}