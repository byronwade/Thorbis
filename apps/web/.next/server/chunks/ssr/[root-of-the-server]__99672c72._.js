module.exports=[193695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},997868,a=>{a.n(a.i(884849))},592581,a=>{a.n(a.i(596565))},134005,a=>{a.n(a.i(977930))},565165,a=>{a.n(a.i(728209))},147941,a=>{a.n(a.i(484103))},304434,a=>{a.n(a.i(632684))},407521,a=>{a.n(a.i(693094))},797797,a=>{a.n(a.i(977207))},290022,a=>{a.n(a.i(362735))},729157,a=>{a.n(a.i(470009))},712363,a=>{a.n(a.i(279732))},208120,a=>{a.n(a.i(52860))},863056,a=>{a.n(a.i(77721))},468729,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call WorkDataView() from the server but WorkDataView is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/work-data-view.tsx <module evaluation>","WorkDataView");a.s(["WorkDataView",0,b])},750692,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call WorkDataView() from the server but WorkDataView is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/work-data-view.tsx","WorkDataView");a.s(["WorkDataView",0,b])},310669,a=>{"use strict";a.i(468729);var b=a.i(750692);a.n(b)},66645,a=>{a.n(a.i(914802))},774453,a=>{a.n(a.i(964200))},139692,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call MaintenancePlansKanban() from the server but MaintenancePlansKanban is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/maintenance-plans-kanban.tsx <module evaluation>","MaintenancePlansKanban");a.s(["MaintenancePlansKanban",0,b])},436528,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call MaintenancePlansKanban() from the server but MaintenancePlansKanban is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/maintenance-plans-kanban.tsx","MaintenancePlansKanban");a.s(["MaintenancePlansKanban",0,b])},880597,a=>{"use strict";a.i(139692);var b=a.i(436528);a.n(b)},903933,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call MaintenancePlansTable() from the server but MaintenancePlansTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/maintenance-plans-table.tsx <module evaluation>","MaintenancePlansTable");a.s(["MaintenancePlansTable",0,b])},60096,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call MaintenancePlansTable() from the server but MaintenancePlansTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/maintenance-plans-table.tsx","MaintenancePlansTable");a.s(["MaintenancePlansTable",0,b])},769976,a=>{"use strict";a.i(903933);var b=a.i(60096);a.n(b)},342464,a=>{"use strict";var b=a.i(504348),c=a.i(429969);a.i(692167);var d=a.i(852596),e=a.i(880597),f=a.i(769976),g=a.i(310669);a.i(467361);var h=a.i(445074);a.i(262820);var i=a.i(883385),j=a.i(933427);let k=`
  id,
  company_id,
  plan_number,
  name,
  frequency,
  next_service_date,
  amount,
  status,
  customer:customers!maintenance_plans_customer_id_fkey (
    id,
    display_name,
    first_name,
    last_name
  )
`;async function l(a,b=50,c){let d=c??await (0,h.getActiveCompanyId)();if(!d)return{plans:[],totalCount:0};let e=await (0,j.createServiceSupabaseClient)();if(!e)throw Error("Supabase client not configured");let f=(Math.max(a,1)-1)*b,{data:g,error:i,count:m}=await e.from("maintenance_plans").select(k,{count:"exact"}).eq("company_id",d).order("created_at",{ascending:!1}).range(f,f+b-1);if(i)throw Error(`Failed to fetch maintenance plans: ${i.message}`);return{plans:g??[],totalCount:m??0}}(0,c.cache)(async(a,b)=>{let c=await (0,j.createServiceSupabaseClient)();if(!c)throw Error("Supabase client not configured");let{data:d,error:e}=await c.rpc("get_maintenance_plan_complete",{p_maintenance_plan_id:a,p_company_id:b});return e?(console.error("Error fetching maintenance plan:",e),null):d?.[0]?.maintenance_plan_data||null});let m={monthly:"Monthly",quarterly:"Quarterly","bi-annual":"Bi-Annual",biannual:"Bi-Annual",annual:"Annual"},n=["active","pending","paused","cancelled"];async function o({searchParams:a}){let[c,j]=await Promise.all([(0,i.getCurrentUser)(),(0,h.getActiveCompanyId)()]);if(!c||!j)return(0,d.notFound)();let k=Number(a?.page)||1,{plans:o,totalCount:p}=await l(k,50,j),q=(o||[]).map(a=>{var b;let c,d=(b=a.customer)?Array.isArray(b)?b[0]??null:b:null,e=d?.display_name||`${d?.first_name??""} ${d?.last_name??""}`.trim()||"Unknown",f=m[a.frequency?.toLowerCase()??"monthly"]??"Monthly",g=(a.status??"").toLowerCase(),h=n.includes(g)?g:"pending";return{id:a.id,planName:a.name||a.plan_number||a.id,customer:e,serviceType:a.service_type||a.name||"Service plan",frequency:f,nextVisit:(c=a.next_service_date)?new Date(c).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",monthlyFee:"number"==typeof a.amount?a.amount:0,status:h,archived_at:a.archived_at??null,deleted_at:a.deleted_at??null}});return(0,b.jsx)(g.WorkDataView,{kanban:(0,b.jsx)(e.MaintenancePlansKanban,{plans:q}),section:"maintenancePlans",table:(0,b.jsx)(f.MaintenancePlansTable,{currentPage:k,itemsPerPage:50,plans:q,totalCount:p})})}a.i(250202);var p=a.i(709027);function q(){return(0,b.jsx)(p.DataTableListSkeleton,{showSearchBar:!0})}async function r({searchParams:a}){let d=await a;return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(q,{}),children:(0,b.jsx)(o,{searchParams:d})})}a.s(["default",()=>r],342464)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__99672c72._.js.map