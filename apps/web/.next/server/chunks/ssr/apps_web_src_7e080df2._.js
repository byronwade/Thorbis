module.exports=[318801,a=>{"use strict";var b=a.i(169021),c=(0,b.createServerReference)("00ebc03a4ffc993aea7ec2e541686105c2bace2437",b.callServer,void 0,b.findSourceMapURL,"getTotalUnreadCountAction");a.s(["getTotalUnreadCountAction",()=>c])},133291,a=>{"use strict";var b=a.i(861467),c=a.i(557081),c=c,d=a.i(750799),d=d,e=a.i(75618),f=a.i(145679),g=a.i(337241),h=a.i(783281),i=a.i(112135),j=a.i(377521),k=a.i(984270),l=a.i(352770),m=a.i(297021),m=m,n=a.i(769652),o=a.i(629367);let p=[{label:"Documentation",description:"Guides and tutorials for all features",href:"/docs",icon:j.BookOpen},{label:"Video Tutorials",description:"Step-by-step video guides",href:"/docs/videos",icon:o.Video},{label:"Support Center",description:"Get help from our support team",href:"/support",icon:m.default},{label:"Contact Support",description:"Chat with our support team",href:"/support/contact",icon:n.MessageCircle},{label:"What's New",description:"Latest features and updates",href:"/changelog",icon:l.HelpCircle}];function q(){let[a,c]=(0,h.useState)(!1),d=(0,h.useRef)(null);return(0,h.useEffect)(()=>{let b=a=>{d.current&&!d.current.contains(a.target)&&c(!1)};return a&&document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b)}},[a]),(0,b.jsxs)("div",{className:"relative",ref:d,children:[(0,b.jsxs)("button",{className:"hover-gradient hover:border-primary/20 hover:bg-primary/10 hover:text-primary focus-visible:ring-ring/50 flex h-8 w-8 items-center justify-center rounded-md border border-transparent transition-all outline-none focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50",onClick:()=>c(!a),title:"Help",type:"button",children:[(0,b.jsx)(l.HelpCircle,{className:"size-4"}),(0,b.jsx)("span",{className:"sr-only",children:"Help"})]}),a&&(0,b.jsxs)("div",{className:"bg-popover text-popover-foreground absolute top-full right-0 z-50 mt-2 w-80 rounded-lg border p-2 shadow-lg",children:[(0,b.jsxs)("div",{className:"mb-2 border-b px-3 py-2",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold",children:"Help & Support"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Find answers and get assistance"})]}),(0,b.jsx)("div",{className:"space-y-1",children:p.map(a=>{let d=a.icon;return(0,b.jsxs)(f.default,{className:"hover:bg-accent flex items-start gap-3 rounded-md px-3 py-2.5 transition-colors",href:a.href,onClick:()=>c(!1),rel:a.external?"noopener noreferrer":void 0,target:a.external?"_blank":void 0,children:[(0,b.jsx)(d,{className:"text-muted-foreground mt-0.5 size-4 shrink-0"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:a.label}),a.external&&(0,b.jsx)(k.ExternalLink,{className:"text-muted-foreground size-3"})]}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:a.description})]})]},a.label)})}),(0,b.jsx)("div",{className:"mt-2 border-t pt-2",children:(0,b.jsxs)("div",{className:"bg-accent/50 rounded-md px-3 py-2",children:[(0,b.jsx)("p",{className:"text-xs font-medium",children:"Need more help?"}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Email us at"," ",(0,b.jsx)("a",{className:"text-primary hover:underline",href:"mailto:support@thorbis.com",children:"support@thorbis.com"})]})]})})]})]})}var r=a.i(97997),s=a.i(359974),t=a.i(638446),u=a.i(541087),v=a.i(96250),w=a.i(624126),x=a.i(527936),y=a.i(274956),z=a.i(198803),A=a.i(128952),B=a.i(898062),C=a.i(127634),D=a.i(339632),E=a.i(774776),F=a.i(362841),G=a.i(300298),H=a.i(240716),I=a.i(261706),J=a.i(568354),K=a.i(134953),L=a.i(903599),M=a.i(337107),N=a.i(132440);let O={message:A.MessageSquare,alert:r.AlertCircle,payment:y.DollarSign,job:F.Wrench,team:E.UserPlus,system:C.Settings},P={message:"text-primary",alert:"text-warning",payment:"text-success",job:"text-accent-foreground",team:"text-cyan-500",system:"text-muted-foreground"};function Q({count:a}){return 0===a?null:(0,b.jsx)("span",{className:"bg-destructive absolute -top-1 -right-1 flex h-[18px] min-w-[18px] items-center justify-center rounded-full px-1.5 text-[0.625rem] leading-none font-bold text-white",children:a<=9?a.toString():a<=99?"99+":a<=999?"999+":"1K+"})}function R(){return(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,b.jsx)(s.Bell,{className:"text-muted-foreground/30 mb-3 size-12"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm font-medium",children:"All caught up!"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"No new notifications"})]})}function S({hasPhoneNumbers:a=!1,hasPayrixAccount:c=!1,payrixStatus:d=null}={}){let[e,g]=(0,h.useState)(!1),i=(0,h.useRef)(null),j=(0,L.useNotificationsStore)(a=>a.notifications),k=(0,L.useNotificationsStore)(a=>a.unreadCount),l=(0,L.useNotificationsStore)(a=>a.setNotifications),m=(0,L.useNotificationsStore)(a=>a.optimisticMarkAsRead),n=(0,L.useNotificationsStore)(a=>a.optimisticMarkAllAsRead),o=(0,L.useNotificationsStore)(a=>a.optimisticDelete),p=(0,L.useNotificationsStore)(a=>a.subscribe),q=(0,L.useNotificationsStore)(a=>a.unsubscribe),y=(0,M.useSyncStore)(a=>a.operations??[]),A=(0,M.useSyncStore)(a=>a.offlineQueue??[]),C=(0,M.useSyncStore)(a=>a.clearCompleted),E=y.filter(a=>"in_progress"===a.status),F=y.filter(a=>"completed"===a.status||"failed"===a.status),T=E.length>0||A.length>0,U=E.length+A.length,V=(0,h.useRef)(!1);(0,h.useEffect)(()=>{if(!e||V.current)return;let a=!1;return async function(){try{let b=(0,N.createClient)();if(!b)return;let{data:{user:c}}=await b.auth.getUser();if(!c)return;let{data:d,error:e}=await b.from("notifications").select("*").eq("user_id",c.id).order("created_at",{ascending:!1}).range(0,49);a||e||!d||l(d),a||(await p(c.id),V.current=!0)}catch(a){}}(),()=>{a=!0}},[e,l,p]),(0,h.useEffect)(()=>()=>{q()},[q]),(0,h.useEffect)(()=>{let a=a=>{i.current&&!i.current.contains(a.target)&&g(!1)};return e&&document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[e]);let W=async a=>{m(a);let b=await (0,K.markAsRead)(a);b.success||console.error("Failed to mark notification as read:",b.error)},X=async()=>{n();let a=await (0,J.markAllAsRead)();a.success||console.error("Failed to mark all notifications as read:",a.error)},Y=async a=>{o(a);let b=await (0,I.deleteNotification)(a);b.success||console.error("Failed to delete notification:",b.error)};return(0,b.jsxs)("div",{className:"relative overflow-visible",ref:i,children:[(0,b.jsxs)("button",{className:"hover-gradient hover:border-primary/20 hover:bg-primary/10 hover:text-primary focus-visible:ring-ring/50 relative flex h-8 w-8 items-center justify-center rounded-md border border-transparent transition-all outline-none focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50",onClick:()=>g(!e),title:T?"Notifications & Sync Status":"Notifications",type:"button",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(s.Bell,{className:"size-4"}),T&&(0,b.jsx)(z.Loader2,{className:"text-primary absolute -top-1 -right-1 size-2.5 animate-spin"})]}),(0,b.jsx)(Q,{count:k+U}),(0,b.jsxs)("span",{className:"sr-only",children:["Notifications ",k>0&&`(${k} unread)`,T&&` â€¢ ${U} syncing`]})]}),e&&(0,b.jsxs)("div",{className:"bg-popover text-popover-foreground absolute top-full right-0 z-50 mt-2 flex w-[380px] max-w-[calc(100vw-2rem)] flex-col rounded-lg border shadow-lg",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between border-b px-4 py-2.5",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-semibold",children:T?"Sync & Notifications":"Notifications"}),(k>0||T)&&(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:[T&&`${U} syncing`,T&&k>0&&" â€¢ ",k>0&&`${k} unread`]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[k>0&&(0,b.jsx)("button",{className:"hover:bg-accent flex h-7 w-7 items-center justify-center rounded-md transition-colors",onClick:X,title:"Mark all as read",type:"button",children:(0,b.jsx)(u.CheckCheck,{className:"size-3.5"})}),(0,b.jsx)("button",{className:"hover:bg-accent flex h-7 w-7 items-center justify-center rounded-md transition-colors",onClick:()=>g(!1),type:"button",children:(0,b.jsx)(G.X,{className:"size-3.5"})})]})]}),(E.length>0||A.length>0||F.length>0)&&(0,b.jsxs)("div",{className:"border-b",children:[E.length>0&&(0,b.jsxs)("div",{className:"space-y-1 px-4 py-3",children:[(0,b.jsx)("p",{className:"text-muted-foreground mb-2 text-xs font-medium tracking-wider uppercase",children:"Active"}),E.map(a=>(0,b.jsxs)("div",{className:"bg-primary/5 flex items-start gap-2 rounded-md p-2",children:[(0,b.jsx)(z.Loader2,{className:"text-primary mt-0.5 size-3.5 shrink-0 animate-spin"}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"text-sm leading-tight font-medium",children:a.title}),a.description&&(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:a.description}),a.total&&a.total>0&&(0,b.jsxs)("div",{className:"mt-1 space-y-0.5",children:[(0,b.jsx)("div",{className:"bg-muted h-1 overflow-hidden rounded-full",children:(0,b.jsx)("div",{className:"bg-primary h-full transition-all",style:{width:`${(a.current??0)/a.total*100}%`}})}),(0,b.jsxs)("p",{className:"text-muted-foreground text-[0.625rem]",children:[a.current??0," / ",a.total]})]})]})]},a.id))]}),A.length>0&&(0,b.jsxs)("div",{className:"space-y-1 px-4 py-3",children:[(0,b.jsxs)("p",{className:"text-muted-foreground mb-2 flex items-center gap-1.5 text-xs font-medium tracking-wider uppercase",children:[(0,b.jsx)("span",{className:"size-1.5 animate-pulse rounded-full bg-orange-500"}),"Queued (Offline)"]}),A.map(a=>(0,b.jsxs)("div",{className:"flex items-start gap-2 rounded-md bg-orange-50 p-2 dark:bg-orange-950/20",children:[(0,b.jsx)(w.Clock,{className:"mt-0.5 size-3.5 shrink-0 text-orange-500"}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"text-sm leading-tight font-medium",children:a.action}),(0,b.jsx)("p",{className:"mt-0.5 text-[0.625rem] text-orange-600 dark:text-orange-400",children:"Will sync when online"})]})]},a.id))]}),F.length>0&&(0,b.jsxs)("div",{className:"space-y-1 px-4 py-3",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,b.jsx)("p",{className:"text-muted-foreground text-xs font-medium tracking-wider uppercase",children:"Recent"}),(0,b.jsx)("button",{className:"text-muted-foreground hover:text-foreground text-xs",onClick:C,type:"button",children:"Clear"})]}),F.map(a=>(0,b.jsxs)("div",{className:`flex items-start gap-2 rounded-md p-2 ${"completed"===a.status?"bg-green-50 dark:bg-green-950/20":"bg-red-50 dark:bg-red-950/20"}`,children:["completed"===a.status?(0,b.jsx)(v.CheckCircle2,{className:"mt-0.5 size-3.5 shrink-0 text-green-600 dark:text-green-400"}):(0,b.jsx)(H.XCircle,{className:"mt-0.5 size-3.5 shrink-0 text-red-600 dark:text-red-400"}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"text-sm leading-tight font-medium",children:a.title}),a.error&&(0,b.jsx)("p",{className:"text-xs text-red-600 dark:text-red-400",children:a.error})]})]},a.id))]})]}),(0,b.jsxs)("div",{className:"max-h-[450px] overflow-y-auto",children:[!a&&(0,b.jsx)("div",{className:"border-b",children:(0,b.jsxs)("div",{className:"group bg-warning/10 hover:bg-warning/15 relative px-4 py-3 transition-colors",children:[(0,b.jsx)("div",{className:"bg-warning absolute top-0 left-0 h-full w-0.5"}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("div",{className:"text-warning mt-0.5 shrink-0",children:(0,b.jsx)(B.Phone,{className:"size-4"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1 space-y-1",children:[(0,b.jsx)("p",{className:"text-sm leading-snug font-medium",children:"Phone System Not Configured"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs leading-relaxed",children:"You cannot use calling, texting, or communication features without setting up phone numbers. Complete the setup to enable phone system capabilities."}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2 pt-1",children:[(0,b.jsxs)("div",{className:"text-muted-foreground flex items-center gap-1 text-xs",children:[(0,b.jsx)(r.AlertCircle,{className:"size-3"}),"System Alert"]}),(0,b.jsx)("div",{className:"flex items-center gap-1",children:(0,b.jsx)(f.default,{className:"bg-warning/20 text-warning hover:bg-warning/30 rounded px-2 py-1 text-xs font-medium transition-colors",href:"/welcome?step=3",onClick:()=>g(!1),children:"Complete Setup"})})]})]})]})]})}),!c&&(0,b.jsx)("div",{className:"border-b",children:(0,b.jsxs)("div",{className:"group bg-warning/10 hover:bg-warning/15 relative px-4 py-3 transition-colors",children:[(0,b.jsx)("div",{className:"bg-warning absolute top-0 left-0 h-full w-0.5"}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("div",{className:"text-warning mt-0.5 shrink-0",children:(0,b.jsx)(x.CreditCard,{className:"size-4"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1 space-y-1",children:[(0,b.jsx)("p",{className:"text-sm leading-snug font-medium",children:"Payment Processing Not Configured"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs leading-relaxed",children:"You cannot collect payments from customers without setting up your merchant account. Complete the setup to start accepting payments on invoices and estimates."}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2 pt-1",children:[(0,b.jsxs)("div",{className:"text-muted-foreground flex items-center gap-1 text-xs",children:[(0,b.jsx)(r.AlertCircle,{className:"size-3"}),"System Alert"]}),(0,b.jsx)("div",{className:"flex items-center gap-1",children:(0,b.jsx)(f.default,{className:"bg-warning/20 text-warning hover:bg-warning/30 rounded px-2 py-1 text-xs font-medium transition-colors",href:"/welcome?step=5",onClick:()=>g(!1),children:"Complete Setup"})})]})]})]})]})}),0===j.length&&a&&c?(0,b.jsx)(R,{}):j.length>0?(0,b.jsx)("div",{className:"divide-y",children:j.map(a=>{var c;let d,e,h,i,j=O[a.type];return(0,b.jsxs)("div",{className:`group hover:bg-accent/50 relative px-4 py-3 transition-colors ${a.read?"":"bg-primary/5"}`,children:[!a.read&&(0,b.jsx)("div",{className:"bg-primary absolute top-0 left-0 h-full w-0.5"}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("div",{className:`mt-0.5 shrink-0 ${P[a.type]}`,children:(0,b.jsx)(j,{className:"size-4"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1 space-y-1",children:[(0,b.jsx)("p",{className:"text-sm leading-snug font-medium",children:a.title}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs leading-relaxed",children:a.message}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2 pt-1",children:[(0,b.jsxs)("div",{className:"text-muted-foreground flex items-center gap-1 text-xs",children:[(0,b.jsx)(w.Clock,{className:"size-3"}),(c=new Date(a.created_at),e=Math.floor((d=new Date().getTime()-c.getTime())/6e4),h=Math.floor(d/36e5),i=Math.floor(d/864e5),e<1?"Just now":e<60?`${e}m ago`:h<24?`${h}h ago`:i<7?`${i}d ago`:c.toLocaleDateString())]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[a.action_url&&(0,b.jsx)(f.default,{className:"text-primary hover:bg-primary/10 rounded px-2 py-1 text-xs font-medium transition-colors",href:a.action_url,onClick:()=>{W(a.id),g(!1)},children:a.action_label||"View"}),!a.read&&(0,b.jsx)("button",{className:"hover:bg-accent flex h-6 w-6 items-center justify-center rounded transition-colors",onClick:()=>W(a.id),title:"Mark as read",type:"button",children:(0,b.jsx)(t.Check,{className:"size-3"})}),(0,b.jsx)("button",{className:"hover:bg-destructive/10 hover:text-destructive flex h-6 w-6 items-center justify-center rounded transition-colors",onClick:()=>Y(a.id),title:"Delete",type:"button",children:(0,b.jsx)(D.Trash2,{className:"size-3"})})]})]})]})]})]},a.id)})}):null]}),j.length>0&&(0,b.jsx)("div",{className:"border-t px-4 py-2",children:(0,b.jsx)(f.default,{className:"text-primary hover:bg-accent flex items-center justify-center rounded-md py-1.5 text-xs font-medium transition-colors",href:"/dashboard/notifications",onClick:()=>g(!1),children:"View all notifications"})})]})]})}var T=a.i(770788),U=a.i(558228),V=a.i(274647),W=a.i(781157),X=a.i(999113),Y=a.i(543829),Z=a.i(976804),$=a.i(412048),_=a.i(334838),aa=a.i(246840),ab=a.i(683594),ab=ab,ac=a.i(320091),ad=a.i(585092),ae=a.i(794759),af=a.i(477903);a.i(288007);var ag=a.i(986990);a.i(445255);var ah=a.i(18170);a.i(421695);var ai=a.i(736786);a.i(956852);var aj=a.i(90125);a.i(839984);var ak=a.i(372712);a.i(297229);var al=a.i(489904);a.i(40744);var am=a.i(419573);a.i(650756);var an=a.i(560450);a.i(928414);var ao=a.i(745250);let ap=null,aq=0;var ar=a.i(685078),as=a.i(251048),at=a.i(571135),au=a.i(702859);let av=null;function aw(){let a;return av??(av=a=(0,au.getWebRTCCredentials)().then(a=>{if(a?.success&&a.credential)a.credential;else console.warn("ðŸ”‘ Failed to get credentials, clearing cache"),av=null;return a}).catch(a=>{throw console.error("ðŸ”‘ WebRTC credentials fetch error:",a),av=null,a}),a)}var ax=a.i(700760);let ay=a=>(a??"").trim(),az=a=>a.display_name?.trim()?a.display_name.trim():[a.first_name,a.last_name].map(ay).filter(Boolean).join(" ")||a.email?.trim()||"Unknown",aA=a=>{let b=a.replace(/\D/g,"");return 11===b.length&&"1"===b[0]?`+1 (${b.slice(1,4)}) ${b.slice(4,7)}-${b.slice(7)}`:10===b.length?`(${b.slice(0,3)}) ${b.slice(3,6)}-${b.slice(6)}`:a};function aB({status:a,mode:c,onRetry:d,className:e}){if("api"===c)return(0,b.jsxs)(ag.Badge,{variant:"outline",className:(0,ax.cn)("gap-1 text-[10px]",e),children:[(0,b.jsx)(ab.default,{className:"h-3 w-3"}),"API Mode"]});let f={disconnected:{icon:ae.WifiOff,label:"Disconnected",variant:"outline",className:"text-muted-foreground"},connecting:{icon:z.Loader2,label:"Connecting...",variant:"outline",className:"text-warning",animate:!0},connected:{icon:ad.Wifi,label:"WebRTC Ready",variant:"outline",className:"text-success border-success/30"},error:{icon:r.AlertCircle,label:"Connection Error",variant:"destructive",className:""}}[a],g=f.icon;return(0,b.jsxs)("div",{className:(0,ax.cn)("flex items-center gap-1",e),children:[(0,b.jsxs)(ag.Badge,{variant:f.variant,className:(0,ax.cn)("gap-1 text-[10px]",f.className),children:[(0,b.jsx)(g,{className:(0,ax.cn)("h-3 w-3",!0===f.animate&&"animate-spin")}),f.label]}),("error"===a||"disconnected"===a)&&d&&(0,b.jsx)(ah.Button,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:d,children:(0,b.jsx)(aa.RefreshCw,{className:"h-3 w-3"})})]})}function aC({call:a,onMute:c,onHold:d,onEnd:e,className:f}){let g,[i,j]=(0,h.useState)(0);(0,h.useEffect)(()=>{if("active"!==a.state)return void j(0);let b=a.startTime?.getTime()||Date.now(),c=setInterval(()=>{j(Math.floor((Date.now()-b)/1e3))},1e3);return()=>clearInterval(c)},[a.state,a.startTime]);let k={idle:{label:"Idle",color:"text-muted-foreground",icon:B.Phone},connecting:{label:"Connecting...",color:"text-warning",icon:$.PhoneOutgoing},ringing:{label:"Ringing...",color:"text-primary",icon:$.PhoneOutgoing},active:{label:"Active",color:"text-success",icon:X.PhoneCall},held:{label:"On Hold",color:"text-warning",icon:W.Pause},ended:{label:"Call Ended",color:"text-muted-foreground",icon:Z.PhoneOff}}[a.state],l=k.icon;return(0,b.jsxs)("div",{className:(0,ax.cn)("rounded-lg border bg-card p-3",f),children:[(0,b.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:(0,ax.cn)("rounded-full bg-primary/10 p-2",k.color),children:(0,b.jsx)(l,{className:"h-4 w-4"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:a.remoteName||aA(a.remoteNumber)}),(0,b.jsx)("p",{className:(0,ax.cn)("text-xs",k.color),children:k.label})]})]}),"active"===a.state&&(0,b.jsx)(ag.Badge,{variant:"outline",className:"text-xs tabular-nums",children:(g=Math.floor(i/60),`${g}:${(i%60).toString().padStart(2,"0")}`)})]}),("active"===a.state||"held"===a.state)&&(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,b.jsxs)(ao.Tooltip,{children:[(0,b.jsx)(ao.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(ah.Button,{variant:a.isMuted?"destructive":"outline",size:"icon",className:"h-9 w-9 rounded-full",onClick:c,children:a.isMuted?(0,b.jsx)(V.MicOff,{className:"h-4 w-4"}):(0,b.jsx)(U.Mic,{className:"h-4 w-4"})})}),(0,b.jsx)(ao.TooltipContent,{children:a.isMuted?"Unmute":"Mute"})]}),(0,b.jsxs)(ao.Tooltip,{children:[(0,b.jsx)(ao.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(ah.Button,{variant:a.isHeld?"secondary":"outline",size:"icon",className:"h-9 w-9 rounded-full",onClick:d,children:a.isHeld?(0,b.jsx)(_.Play,{className:"h-4 w-4"}):(0,b.jsx)(W.Pause,{className:"h-4 w-4"})})}),(0,b.jsx)(ao.TooltipContent,{children:a.isHeld?"Resume":"Hold"})]}),(0,b.jsxs)(ao.Tooltip,{children:[(0,b.jsx)(ao.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(ah.Button,{variant:"destructive",size:"icon",className:"h-9 w-9 rounded-full",onClick:e,children:(0,b.jsx)(Z.PhoneOff,{className:"h-4 w-4"})})}),(0,b.jsx)(ao.TooltipContent,{children:"End Call"})]})]}),("connecting"===a.state||"ringing"===a.state)&&(0,b.jsx)("div",{className:"flex items-center justify-center gap-2",children:(0,b.jsxs)(ah.Button,{variant:"destructive",size:"sm",className:"gap-2",onClick:e,children:[(0,b.jsx)(Z.PhoneOff,{className:"h-4 w-4"}),"Cancel"]})})]})}function aD({companyId:a,companyPhones:c=[],incomingCallsCount:d}){let{toast:e}=(0,as.useToast)(),[g,j]=(0,h.useState)(!1),[k,l]=(0,h.useTransition)(),[m,n]=(0,h.useState)(!1),{customers:o,isLoading:p}=function(a=!1){let[b,c]=(0,h.useState)([]),[d,e]=(0,h.useState)(!1),[f,g]=(0,h.useState)(null);return(0,h.useEffect)(()=>{if(!a)return;let b=Date.now();if(ap&&b-aq<3e5)return void c(ap);let d=new AbortController;return(async()=>{e(!0),g(null);try{let a=await fetch("/api/dialer/customers",{signal:d.signal,cache:"no-store"});if(!a.ok){let b=await a.json().catch(()=>({}));throw Error(b.error||"Failed to load customers")}let b=await a.json();ap=b.customers,aq=Date.now(),c(b.customers)}catch(a){if(d.signal.aborted)return;g(a instanceof Error?a.message:"Failed to load customers")}finally{d.signal.aborted||e(!1)}})(),()=>{d.abort()}},[a]),{customers:b,isLoading:d,error:f}}(m),q=(0,i.useDialerStore)(),[r,s]=(0,h.useState)(""),[u,v]=(0,h.useState)(c[0]?.number||""),[x,y]=(0,h.useState)(null),[C,D]=(0,h.useState)(!1),[E,F]=(0,h.useState)(""),[H,I]=(0,h.useState)("webrtc"),[J,K]=(0,h.useState)(null),[L,M]=(0,h.useState)("disconnected"),[N,O]=(0,h.useState)(null),P=(0,h.useRef)(null),Q=(0,h.useRef)(0),R=(0,h.useRef)(null),S=(0,at.useUIStore)(a=>a.call.status),U=(0,at.useUIStore)(a=>a.call.caller),V="incoming"===S,W=d??+!!V,Z=(0,ar.useTelnyxWebRTC)({username:J?.username||"",password:J?.password||"",autoConnect:!1,debug:!1,onIncomingCall:a=>{e.info(`Incoming call from ${a.remoteName||a.remoteNumber}`)},onCallEnded:()=>{e.info("Call ended")}});(0,h.useEffect)(()=>(j(!0),()=>{R.current&&(R.current.remove(),R.current=null)}),[]),(0,h.useEffect)(()=>{!u&&c.length>0&&v(c[0].number)},[c,u]),(0,h.useEffect)(()=>n(q.isOpen),[q.isOpen]),(0,h.useEffect)(()=>s(q.phoneNumber),[q.phoneNumber]),(0,h.useEffect)(()=>{if(q.customerId&&o.length>0){let a=o.find(a=>a.id===q.customerId);a&&a.id!==x?.id&&y(a)}},[q.customerId,o,x?.id]),(0,h.useEffect)(()=>{g&&(async()=>{try{let a=await aw();a.success&&a.credential?K({username:a.credential.username,password:a.credential.password}):(console.warn("Failed to get WebRTC credentials, using API mode"),I("api"))}catch(a){console.error("Failed to fetch WebRTC credentials:",a),I("api")}})()},[g]),(0,h.useEffect)(()=>{if(J&&"webrtc"===H)return(async()=>{P.current&&clearTimeout(P.current),M("connecting"),O(null),P.current=setTimeout(()=>{"connecting"===L&&(M("error"),O("Connection timeout - WebRTC may require Level 2 verification"),Q.current>=3&&(e.warning("WebRTC unavailable, switching to API mode"),I("api")))},15e3);try{await Z.connect()}catch(a){console.error("WebRTC connection error:",a),M("error"),O(a instanceof Error?a.message:"Connection failed")}})(),()=>{P.current&&clearTimeout(P.current)}},[J,H]),(0,h.useEffect)(()=>{Z.isConnected?(P.current&&clearTimeout(P.current),M("connected"),O(null),Q.current=0):Z.connectionError?(M("error"),O(Z.connectionError)):Z.isConnecting&&M("connecting")},[Z.isConnected,Z.isConnecting,Z.connectionError]);let _=(0,h.useCallback)(a=>{n(a),a?q.openDialer():(q.closeDialer(),s(""),y(null),F(""))},[q]),aa=(0,h.useCallback)(a=>{y(a),a?.phone&&s(a.phone),F(""),D(!1)},[]),ad=(0,h.useCallback)(()=>{if(Q.current+=1,Q.current>3){e.warning("Max retries reached, switching to API mode"),I("api");return}av=null,K(null),M("disconnected"),O(null),aw().then(a=>{a.success&&a.credential&&K({username:a.credential.username,password:a.credential.password})})},[e]),ae=(0,h.useCallback)(a=>{I(a?"webrtc":"api")},[]),au=(0,h.useMemo)(()=>{let a=E.trim().toLowerCase();if(!a)return o.slice(0,50);let b=a.replace(/\D/g,"");return o.filter(c=>!!([c.first_name,c.last_name,c.display_name,c.email,c.phone,c.secondary_phone,c.company_name].map(a=>ay(a).toLowerCase()).some(b=>b.includes(a))||b&&[c.phone,c.secondary_phone].map(a=>ay(a).replace(/\D/g,"")).filter(Boolean).some(a=>a.includes(b)))||!1)},[o,E]),aD=(0,h.useCallback)(async()=>{if(k)return;if(!a)return void e.error("No company selected. Please select a company first.");let b=r.replace(/\D/g,"");b?u?l(async()=>{try{let c=await (0,af.makeCall)({to:b,from:u,companyId:a,customerId:x?.id});if(!c.success)return void e.error(c.error||"Failed to start call");e.success(x?`Calling ${az(x)}`:`Calling ${aA(r)}`);let d=new URLSearchParams({callControlId:c.callControlId||"",companyId:a,to:b,from:u,direction:"outbound",...x?.id&&{customerId:x.id}});window.open(`/call?${d}`,"_blank","noopener,noreferrer"),_(!1)}catch{e.error("Failed to start call. Please try again.")}}):e.error("Please select a company phone number"):e.error("Please enter a valid phone number")},[a,r,u,x,k,e,_]),aE=(0,h.useCallback)(async()=>{let a=r.replace(/\D/g,"");if(!a)return void e.error("Please enter a valid phone number");if(!Z.isConnected){e.error("WebRTC not connected. Trying API mode..."),aD();return}if(!u)return void e.error("Please select a company phone number");try{await Z.makeCall(a,u),e.success(x?`Calling ${az(x)}`:`Calling ${aA(r)}`)}catch(a){console.error("WebRTC call error:",a),e.error("Failed to start call via WebRTC"),e.info("Falling back to API mode..."),aD()}},[r,u,x,Z,e,aD]),aF=(0,h.useCallback)(()=>{"webrtc"===H&&Z.isConnected?aE():aD()},[H,Z.isConnected,aE,aD]),aG=(0,h.useCallback)(async()=>{try{Z.currentCall?.isMuted?await Z.unmuteCall():await Z.muteCall()}catch(a){console.error("Mute toggle error:",a)}},[Z]),aH=(0,h.useCallback)(async()=>{try{Z.currentCall?.isHeld?await Z.unholdCall():await Z.holdCall()}catch(a){console.error("Hold toggle error:",a)}},[Z]),aI=(0,h.useCallback)(async()=>{try{await Z.endCall()}catch(a){console.error("End call error:",a)}},[Z]),aJ=!!(r.trim()&&u&&c.length>0),aK="webrtc"===H&&"connected"===L,aL=Z.currentCall&&"idle"!==Z.currentCall.state&&"ended"!==Z.currentCall.state;return g?(0,b.jsx)(ao.TooltipProvider,{delayDuration:200,children:(0,b.jsxs)(aj.DropdownMenu,{open:m,onOpenChange:_,children:[(0,b.jsxs)(ao.Tooltip,{children:[(0,b.jsx)(ao.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(aj.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)("button",{className:(0,ax.cn)("relative flex h-8 w-8 items-center justify-center rounded-md","border border-transparent transition-all","hover:border-primary/20 hover:bg-primary/10 hover:text-primary","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring/50",V&&"animate-pulse text-primary",aL&&"text-success"),type:"button",children:[aL?(0,b.jsx)(X.PhoneCall,{className:"h-4 w-4"}):V?(0,b.jsx)(Y.PhoneIncoming,{className:"h-4 w-4"}):(0,b.jsx)(B.Phone,{className:"h-4 w-4"}),W>0&&(0,b.jsx)(ag.Badge,{variant:"destructive",className:"absolute -right-1 -top-1 flex h-5 w-5 items-center justify-center rounded-full p-0 text-[10px]",children:W>9?"9+":W})]})})}),(0,b.jsx)(ao.TooltipContent,{side:"bottom",children:aL?"Call in Progress":V?"Incoming Call":"Make a Call"})]}),(0,b.jsx)(aj.DropdownMenuContent,{align:"end",className:"w-80 p-0",children:(0,b.jsxs)("div",{className:"space-y-3 p-4",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary/10",children:(0,b.jsx)(X.PhoneCall,{className:"h-5 w-5 text-primary"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold",children:"Make a Call"}),(0,b.jsx)(aB,{status:L,mode:H,onRetry:ad})]})]})}),(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(ab.default,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"API Mode"})]}),(0,b.jsx)(an.Switch,{checked:"webrtc"===H,onCheckedChange:ae,disabled:!J}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Browser Audio"}),(0,b.jsx)(T.Headphones,{className:"h-4 w-4 text-muted-foreground"})]})]}),aL&&Z.currentCall&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aC,{call:Z.currentCall,onMute:aG,onHold:aH,onEnd:aI}),(0,b.jsx)(aj.DropdownMenuSeparator,{})]}),V&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 rounded-lg border border-destructive/30 bg-destructive/10 p-3",children:[(0,b.jsx)(Y.PhoneIncoming,{className:"h-5 w-5 shrink-0 animate-pulse text-destructive"}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-destructive",children:"Incoming Call"}),(0,b.jsx)("p",{className:"truncate text-xs text-destructive/80",children:U?.name||U?.number||"Unknown"})]})]}),(0,b.jsx)(aj.DropdownMenuSeparator,{})]}),N&&"webrtc"===H&&(0,b.jsxs)("div",{className:"rounded-lg border border-warning/30 bg-warning/10 p-2",children:[(0,b.jsx)("p",{className:"text-xs text-warning",children:N}),(0,b.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:"Calls will use API mode (opens in new window)"})]}),!aL&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)("label",{className:"text-xs font-medium text-muted-foreground",children:"Customer (optional)"}),(0,b.jsxs)(al.Popover,{open:C,onOpenChange:D,children:[(0,b.jsx)(al.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(ah.Button,{variant:"outline",className:"h-9 w-full justify-start gap-2 px-3 font-normal",disabled:p,children:[(0,b.jsx)(ac.User,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),(0,b.jsx)("span",{className:"min-w-0 flex-1 truncate text-left",children:x?az(x):"Search..."}),x&&(0,b.jsx)(G.X,{className:"h-4 w-4 shrink-0 text-muted-foreground hover:text-foreground",onClick:a=>{a.stopPropagation(),aa(null)}})]})}),(0,b.jsx)(al.PopoverContent,{align:"start",className:"w-80 p-0",sideOffset:4,children:(0,b.jsxs)(ai.Command,{shouldFilter:!1,children:[(0,b.jsx)(ai.CommandInput,{placeholder:"Name, phone, or email...",value:E,onValueChange:F}),(0,b.jsxs)(ai.CommandList,{className:"max-h-[200px]",children:[(0,b.jsx)(ai.CommandEmpty,{className:"py-4 text-center text-sm text-muted-foreground",children:"No customers found"}),(0,b.jsx)(ai.CommandGroup,{children:au.map(a=>(0,b.jsxs)(ai.CommandItem,{value:a.id,onSelect:()=>aa(a),className:"flex cursor-pointer items-center gap-2 px-3 py-2",children:[(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"truncate text-sm font-medium",children:az(a)}),a.phone&&(0,b.jsx)("p",{className:"truncate text-xs text-muted-foreground",children:aA(a.phone)})]}),x?.id===a.id&&(0,b.jsx)(t.Check,{className:"h-4 w-4 shrink-0 text-primary"})]},a.id))})]})]})})]})]}),(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)("label",{htmlFor:"phone-to",className:"text-xs font-medium text-muted-foreground",children:"Phone Number"}),(0,b.jsx)(ak.Input,{id:"phone-to",placeholder:"(555) 123-4567",value:r,onChange:a=>s(a.target.value),className:"h-9"})]}),(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)("label",{htmlFor:"phone-from",className:"text-xs font-medium text-muted-foreground",children:"Your Company Line"}),(0,b.jsxs)(am.Select,{value:u,onValueChange:v,children:[(0,b.jsx)(am.SelectTrigger,{id:"phone-from",className:"h-9",children:(0,b.jsx)(am.SelectValue,{placeholder:"Select line..."})}),(0,b.jsx)(am.SelectContent,{children:c.map(a=>(0,b.jsx)(am.SelectItem,{value:a.number,children:a.label||aA(a.number)},a.id))})]}),0===c.length&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"No phone numbers configured"})]}),(0,b.jsx)(ah.Button,{className:"w-full gap-2",disabled:!aJ||k,onClick:aF,children:k?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(z.Loader2,{className:"h-4 w-4 animate-spin"}),"Starting..."]}):aK?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(T.Headphones,{className:"h-4 w-4"}),"Call (Browser Audio)"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)($.PhoneOutgoing,{className:"h-4 w-4"}),"Call (Opens Window)"]})})]}),(0,b.jsx)(aj.DropdownMenuSeparator,{}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(f.default,{href:"/dashboard/communication?filter=calls",onClick:()=>_(!1),className:"flex flex-1 items-center justify-center gap-1.5 rounded-md px-2 py-1.5 text-xs font-medium text-muted-foreground transition-colors hover:bg-muted hover:text-foreground",children:[(0,b.jsx)(w.Clock,{className:"h-3.5 w-3.5"}),"History"]}),(0,b.jsxs)(f.default,{href:"/dashboard/communication",onClick:()=>_(!1),className:"flex flex-1 items-center justify-center gap-1.5 rounded-md px-2 py-1.5 text-xs font-medium text-muted-foreground transition-colors hover:bg-muted hover:text-foreground",children:[(0,b.jsx)(A.MessageSquare,{className:"h-3.5 w-3.5"}),"Messages"]})]})]})})]})}):(0,b.jsx)("button",{className:"flex h-8 w-8 items-center justify-center rounded-md border border-transparent opacity-50",disabled:!0,type:"button",children:(0,b.jsx)(B.Phone,{className:"h-4 w-4"})})}var aE=a.i(48199),aF=a.i(587969),aG=a.i(430243),aH=a.i(271758),aI=a.i(319895),aJ=a.i(638727),aK=a.i(414379);let aL={Work:[{label:"New Job",href:"/dashboard/work/new",icon:aE.Briefcase,shortcut:"âŒ˜J",description:"Create a new work order"},{label:"New Invoice",href:"/dashboard/work/invoices/new",icon:aI.FileText,shortcut:"âŒ˜I",description:"Generate an invoice"},{label:"New Estimate",href:"/dashboard/work/estimates/new",icon:aH.FileSpreadsheet,shortcut:"âŒ˜E",description:"Create a quote"},{label:"New Contract",href:"/dashboard/work/contracts/new",icon:aG.FileSignature,description:"Draft a service contract"}],Customers:[{label:"New Customer",href:"/dashboard/customers/new",icon:E.UserPlus,shortcut:"âŒ˜K",description:"Add a customer"}],Finance:[{label:"Record Payment",href:"/dashboard/finance/payments/new",icon:y.DollarSign,description:"Log a payment"}],Other:[{label:"Schedule Job",href:"/dashboard/schedule/new",icon:aF.Calendar,description:"Add to schedule"},{label:"Price Book Item",href:"/dashboard/work/pricebook/new",icon:aK.Tag,description:"Add inventory item"}]};function aM(){let[a,c]=(0,h.useState)(!1);return((0,h.useEffect)(()=>{c(!0)},[]),a)?(0,b.jsxs)(aj.DropdownMenu,{children:[(0,b.jsx)(aj.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)("button",{className:"hover-gradient hover:border-primary/20 hover:bg-primary/10 hover:text-primary focus-visible:ring-ring/50 flex h-8 w-8 items-center justify-center rounded-md border border-transparent transition-all outline-none focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50",title:"Quick Add",type:"button",children:[(0,b.jsx)(aJ.Plus,{className:"size-4"}),(0,b.jsx)("span",{className:"sr-only",children:"Quick Add Menu"})]})}),(0,b.jsxs)(aj.DropdownMenuContent,{align:"end",className:"w-64 rounded-lg",children:[(0,b.jsx)(aj.DropdownMenuLabel,{className:"font-semibold",children:"Quick Add"}),(0,b.jsx)(aj.DropdownMenuSeparator,{}),Object.entries(aL).map(([a,c],d)=>(0,b.jsxs)("div",{children:[d>0&&(0,b.jsx)(aj.DropdownMenuSeparator,{}),(0,b.jsx)(aj.DropdownMenuLabel,{className:"text-muted-foreground text-xs",children:a}),(0,b.jsx)(aj.DropdownMenuGroup,{children:c.map(a=>{let c=a.icon;return(0,b.jsx)(aj.DropdownMenuItem,{asChild:!0,children:(0,b.jsxs)(f.default,{className:"flex items-center gap-2",href:a.href,children:[(0,b.jsx)(c,{className:"size-4"}),(0,b.jsxs)("div",{className:"flex flex-1 flex-col",children:[(0,b.jsx)("span",{className:"text-sm",children:a.label}),a.description&&(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:a.description})]}),a.shortcut&&(0,b.jsx)(aj.DropdownMenuShortcut,{children:a.shortcut})]})},a.href)})})]},a))]})]}):(0,b.jsxs)("button",{className:"hover-gradient hover:border-primary/20 hover:bg-primary/10 hover:text-primary focus-visible:ring-ring/50 flex h-8 w-8 items-center justify-center rounded-md border border-transparent transition-all outline-none focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50",disabled:!0,title:"Quick Add",type:"button",children:[(0,b.jsx)(aJ.Plus,{className:"size-4"}),(0,b.jsx)("span",{className:"sr-only",children:"Quick Add Menu"})]})}var aN=a.i(169021),aO=(0,aN.createServerReference)("0043ae510c3322ea499beb9e1bb77d06afb4ef19bd",aN.callServer,void 0,aN.findSourceMapURL,"signOut"),aP=(0,aN.createServerReference)("4097c3c574342661f9a3c8244961d001234449f36f",aN.callServer,void 0,aN.findSourceMapURL,"switchCompany"),aQ=(0,aN.createServerReference)("4081009dd4dff14ff4ece62648bad23a83f2f9f63c",aN.callServer,void 0,aN.findSourceMapURL,"updateUserStatus");a.i(516775);var aR=a.i(560272),aS=a.i(263758),aT=a.i(337850),aU=a.i(138382),aV=a.i(165392),aV=aV,aW=a.i(984313),aX=a.i(763564),aY=a.i(870693),aZ=a.i(861698);let a$={online:{label:"Online",color:"bg-green-500",description:"Available for work"},available:{label:"Away",color:"bg-yellow-500",description:"Temporarily unavailable"},busy:{label:"Do not disturb",color:"bg-red-500",description:"Only urgent matters"},offline:{label:"Offline",color:"bg-gray-400",description:"Appear offline"}};function a_({user:a,teams:c,activeCompanyId:d}){let{theme:g,setTheme:i}=(0,aZ.useTheme)(),[j,k]=(0,h.useState)(!1),[m,n]=(0,h.useState)(a.status||"online"),[o,p]=(0,h.useState)(!1),[q,r]=(0,h.useState)(!1),s=c.find(a=>a.id===d)||c[0],[u,v]=(0,h.useState)(s);(0,h.useEffect)(()=>{k(!0)},[]);let w=async a=>{u?.id===a.id||(await aP(a.id)).success&&v(a)},y=async()=>{await aO()},z=async a=>{p(!0);try{(await aQ(a)).success&&n(a)}finally{p(!1)}},A=(a,b)=>a?a.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2):b?.substring(0,2).toUpperCase()||"U",B=a$[m];return(0,b.jsxs)(aj.DropdownMenu,{open:q,onOpenChange:r,children:[(0,b.jsx)(aj.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)("button",{className:(0,ax.cn)("flex h-8 items-center gap-2 rounded-lg px-2 transition-all duration-150","hover:bg-accent/80 focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","outline-none disabled:pointer-events-none disabled:opacity-50",q&&"bg-accent"),type:"button",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)(aR.Avatar,{className:"size-6 rounded-md ring-1 ring-border/50",children:[(0,b.jsx)(aR.AvatarImage,{alt:a.name||a.email,src:a.avatar}),(0,b.jsx)(aR.AvatarFallback,{className:"rounded-md text-[10px] font-medium bg-muted",children:A(a.name,a.email)})]}),(0,b.jsx)("div",{className:(0,ax.cn)("absolute -bottom-0.5 -right-0.5 size-2.5 rounded-full ring-2 ring-background",B.color)})]}),(0,b.jsx)("span",{className:"hidden text-sm font-medium md:inline-block truncate max-w-28",children:a.name?.split(" ")[0]||a.email?.split("@")[0]||"User"}),(0,b.jsx)("span",{className:"sr-only",children:"Open user menu"})]})}),(0,b.jsxs)(aj.DropdownMenuContent,{align:"end",sideOffset:8,className:"w-80 p-0 overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-muted/30 border-b border-border/50 p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsxs)("div",{className:"relative shrink-0",children:[(0,b.jsxs)(aR.Avatar,{className:"size-11 rounded-xl ring-2 ring-background shadow-sm",children:[(0,b.jsx)(aR.AvatarImage,{alt:a.name||a.email,src:a.avatar}),(0,b.jsx)(aR.AvatarFallback,{className:"rounded-xl text-sm font-semibold bg-primary/10 text-primary",children:A(a.name,a.email)})]}),(0,b.jsx)("div",{className:(0,ax.cn)("absolute -bottom-0.5 -right-0.5 size-3 rounded-full ring-2 ring-background",B.color)})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0 space-y-0.5",children:[(0,b.jsx)("p",{className:"text-sm font-semibold truncate",children:a.name||a.email?.split("@")[0]||"User"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:a.email}),u&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground truncate flex items-center gap-1",children:[(0,b.jsx)(aS.Building2,{className:"size-3"}),u.name]})]})]})}),(0,b.jsxs)("div",{className:"p-2 border-b border-border/50",children:[(0,b.jsx)("p",{className:"text-[11px] font-medium text-muted-foreground uppercase tracking-wider px-2 py-1.5",children:"Set Status"}),(0,b.jsx)("div",{className:"space-y-0.5",children:Object.entries(a$).map(([a,c])=>(0,b.jsxs)("button",{disabled:o,onClick:()=>z(a),className:(0,ax.cn)("flex w-full items-center gap-3 rounded-md px-2 py-2 text-sm transition-colors","hover:bg-accent disabled:opacity-50",m===a&&"bg-accent"),type:"button",children:[(0,b.jsx)("div",{className:(0,ax.cn)("size-2.5 rounded-full shrink-0",c.color)}),(0,b.jsx)("div",{className:"flex-1 text-left",children:(0,b.jsx)("span",{className:"font-medium",children:c.label})}),m===a&&(0,b.jsx)(t.Check,{className:"size-4 text-primary shrink-0"})]},a))})]}),(0,b.jsxs)("div",{className:"p-2 border-b border-border/50",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-2 py-1.5",children:[(0,b.jsx)("p",{className:"text-[11px] font-medium text-muted-foreground uppercase tracking-wider",children:"Workspaces"}),(0,b.jsxs)(f.default,{href:"/dashboard/welcome?new=true",className:"text-[11px] font-medium text-primary hover:underline flex items-center gap-0.5",onClick:()=>r(!1),children:[(0,b.jsx)(aJ.Plus,{className:"size-3"}),"Add"]})]}),(0,b.jsx)("div",{className:"max-h-36 overflow-y-auto space-y-0.5",children:c.map(a=>{let c=u?.id===a.id;return(0,b.jsxs)("button",{onClick:()=>w(a),className:(0,ax.cn)("flex w-full items-center gap-3 rounded-md px-2 py-2 transition-colors","hover:bg-accent",c&&"bg-accent"),type:"button",children:[(0,b.jsx)("div",{className:"flex size-8 items-center justify-center rounded-lg bg-muted shrink-0",children:a.logo?(0,b.jsx)(e.default,{src:a.logo,alt:a.name,width:20,height:20,className:"size-5 object-contain"}):(0,b.jsx)(aS.Building2,{className:"size-4 text-muted-foreground"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0 text-left",children:[(0,b.jsx)("p",{className:(0,ax.cn)("text-sm truncate",c&&"font-medium"),children:a.name}),(0,b.jsx)("div",{className:"flex items-center gap-1.5",children:!1===a.onboardingComplete?(0,b.jsx)("span",{className:"text-[10px] text-amber-600 dark:text-amber-400",children:"Setup required"}):(0,b.jsx)("span",{className:"text-[10px] text-muted-foreground capitalize",children:a.plan})})]}),c&&(0,b.jsx)("div",{className:"size-1.5 rounded-full bg-primary shrink-0"})]},a.id)})})]}),(0,b.jsxs)("div",{className:"p-2 border-b border-border/50",children:[(0,b.jsx)(a0,{href:"/dashboard/settings/profile/personal",icon:ac.User,label:"Profile & Account",shortcut:"â‡§âŒ˜P",onClick:()=>r(!1)}),(0,b.jsx)(a0,{href:"/dashboard/settings/billing",icon:x.CreditCard,label:"Plans & Billing",onClick:()=>r(!1)}),(0,b.jsx)(a0,{href:"/dashboard/settings",icon:C.Settings,label:"Settings",shortcut:"âŒ˜,",onClick:()=>r(!1)})]}),(0,b.jsxs)("div",{className:"p-2 border-b border-border/50",children:[(0,b.jsx)("p",{className:"text-[11px] font-medium text-muted-foreground uppercase tracking-wider px-2 py-1.5",children:"Appearance"}),(0,b.jsx)("div",{className:"px-2 py-1",children:(0,b.jsx)("div",{className:"flex items-center gap-1 p-0.5 rounded-lg bg-muted/50",children:[{value:"light",icon:aY.Sun,label:"Light"},{value:"dark",icon:aX.Moon,label:"Dark"},{value:"system",icon:aW.Monitor,label:"System"}].map(a=>{let c=a.icon,d=(j?"light"===g?"light":"dark"===g?"dark":"system":"system")===a.value;return(0,b.jsxs)("button",{disabled:!j,onClick:()=>i(a.value),className:(0,ax.cn)("flex flex-1 items-center justify-center gap-1.5 rounded-md px-3 py-1.5 text-xs font-medium transition-all",d?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),type:"button",children:[(0,b.jsx)(c,{className:"size-3.5"}),a.label]},a.value)})})})]}),(0,b.jsxs)("div",{className:"p-2 border-b border-border/50",children:[(0,b.jsx)(a0,{href:"/help",icon:l.HelpCircle,label:"Help & Support",external:!0,onClick:()=>r(!1)}),(0,b.jsx)(a0,{href:"/dashboard/settings/shortcuts",icon:aU.Keyboard,label:"Keyboard Shortcuts",shortcut:"âŒ˜/",onClick:()=>r(!1)})]}),(0,b.jsx)("div",{className:"p-2",children:(0,b.jsxs)("button",{onClick:y,className:(0,ax.cn)("flex w-full items-center gap-3 rounded-md px-2 py-2 text-sm transition-colors","text-muted-foreground hover:bg-destructive/10 hover:text-destructive"),type:"button",children:[(0,b.jsx)(aV.default,{className:"size-4"}),(0,b.jsx)("span",{children:"Sign out"}),(0,b.jsx)("kbd",{className:"ml-auto hidden sm:inline-flex h-5 items-center rounded border border-border/50 bg-muted/50 px-1.5 font-mono text-[10px] text-muted-foreground",children:"â‡§âŒ˜Q"})]})})]})]})}function a0({href:a,icon:c,label:d,shortcut:e,external:g,onClick:h}){return(0,b.jsxs)(f.default,{href:a,onClick:h,className:(0,ax.cn)("flex items-center gap-3 rounded-md px-2 py-2 text-sm transition-colors","text-foreground/80 hover:bg-accent hover:text-foreground"),...g&&{target:"_blank",rel:"noopener noreferrer"},children:[(0,b.jsx)(c,{className:"size-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"flex-1",children:d}),e&&(0,b.jsx)("kbd",{className:"hidden sm:inline-flex h-5 items-center rounded border border-border/50 bg-muted/50 px-1.5 font-mono text-[10px] text-muted-foreground",children:e}),g&&(0,b.jsx)(aT.ChevronRight,{className:"size-3.5 text-muted-foreground"})]})}var a1=a.i(318801);a.i(413309);var a2=a.i(54210);a.i(146697);var a3=a.i(778737),a4=a.i(352424),a5=a.i(916680),a6=a.i(789815),a7=(0,aN.createServerReference)("40e9589cb639f2902eb841bedc1247d966486d6fd7",aN.callServer,void 0,aN.findSourceMapURL,"getCompanyPendingActions"),a8=(0,aN.createServerReference)("001be5cf82b793f19f6a7d010c91c14577fa7a130d",aN.callServer,void 0,aN.findSourceMapURL,"checkIsCompanyOwner");let a9={low:"bg-blue-500",medium:"bg-yellow-500",high:"bg-orange-500",critical:"bg-red-500"},ba={send_communication:a6.Mail,financial:y.DollarSign,scheduling:aF.Calendar,customer:ac.User};function bb({className:a,showPopover:c=!0,onActionClick:d}){let[e,f]=(0,h.useState)([]),[g,i]=(0,h.useState)(!1),[j,k]=(0,h.useState)(!0);if((0,h.useEffect)(()=>{let a=async()=>{k(!0);try{let[a,b]=await Promise.all([a8(),a7({status:"pending",limit:10})]);a.success&&a.data&&i(a.data),b.success&&b.data&&f(b.data)}catch(a){console.error("Failed to fetch pending actions:",a)}finally{k(!1)}};a();let b=setInterval(a,3e4);return()=>clearInterval(b)},[]),!g||0===e.length)return null;let l=e.filter(a=>"critical"===a.riskLevel).length,m=e.filter(a=>"high"===a.riskLevel).length,n=(0,b.jsx)("div",{className:(0,ax.cn)("relative inline-flex",a),children:(0,b.jsxs)(ah.Button,{variant:"ghost",size:"icon",className:"relative h-9 w-9",children:[(0,b.jsx)(a4.Shield,{className:"h-5 w-5"}),(0,b.jsx)("span",{className:(0,ax.cn)("absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full text-[10px] font-bold text-white",l>0?"bg-red-500":m>0?"bg-orange-500":"bg-yellow-500"),children:e.length})]})});return c?(0,b.jsxs)(al.Popover,{children:[(0,b.jsx)(al.PopoverTrigger,{asChild:!0,children:n}),(0,b.jsxs)(al.PopoverContent,{className:"w-80 p-0",align:"end",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border-b",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(a4.Shield,{className:"h-4 w-4 text-primary"}),(0,b.jsx)("span",{className:"font-semibold text-sm",children:"Pending Approvals"})]}),(0,b.jsx)(ag.Badge,{variant:"secondary",children:e.length})]}),(0,b.jsx)(a2.ScrollArea,{className:"max-h-[300px]",children:(0,b.jsx)("div",{className:"divide-y",children:e.map(a=>{let c=ba[a.actionType]||a5.AlertTriangle;return(0,b.jsx)("button",{className:"w-full p-3 text-left hover:bg-muted/50 transition-colors",onClick:()=>d?.(a),children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:(0,ax.cn)("rounded-full p-1.5",a9[a.riskLevel]+"/10"),children:(0,b.jsx)(c,{className:(0,ax.cn)("h-4 w-4",a9[a.riskLevel].replace("bg-","text-"))})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium truncate",children:a.toolName.replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase())}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:a.affectedEntityType.replace(/_/g," ")}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,b.jsx)(ag.Badge,{variant:"outline",className:(0,ax.cn)("text-[10px] px-1.5 py-0",a9[a.riskLevel].replace("bg-","border-"),a9[a.riskLevel].replace("bg-","text-")),children:a.riskLevel}),(0,b.jsxs)("span",{className:"flex items-center gap-1 text-[10px] text-muted-foreground",children:[(0,b.jsx)(w.Clock,{className:"h-3 w-3"}),function(a){let b=new Date,c=new Date(a).getTime()-b.getTime();if(c<=0)return"Expired";let d=Math.floor(c/36e5),e=Math.floor(c%36e5/6e4);return d>0?`${d}h ${e}m`:`${e}m`}(a.expiresAt)]})]})]})]})},a.id)})})}),e.length>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(a3.Separator,{}),(0,b.jsx)("div",{className:"p-2",children:(0,b.jsx)(ah.Button,{variant:"ghost",size:"sm",className:"w-full text-xs",onClick:()=>{window.location.href="/dashboard/settings/ai"},children:"View All Pending Actions"})})]})]})]}):n}let bc=[{label:"Ask Thorbis",href:"/dashboard/ai",status:"beta",isSpecial:!0,mobileIcon:"AI",mobileIconBg:"bg-primary/10",mobileIconColor:"text-primary"},{label:"Today",href:"/dashboard",mobileIcon:"T",mobileIconBg:"bg-primary/10",mobileIconColor:"text-primary"},{label:"Schedule",href:"/dashboard/schedule",mobileIcon:"S",mobileIconBg:"bg-accent/10",mobileIconColor:"text-accent-foreground"},{label:"Communication",href:"/dashboard/communication",mobileIcon:"C",mobileIconBg:"bg-success/10",mobileIconColor:"text-success"},{label:"Work",href:"/dashboard/work",status:"beta",mobileIcon:"W",mobileIconBg:"bg-teal-500/10",mobileIconColor:"text-teal-600"},{label:"Finances",href:"/dashboard/finance",status:"coming-soon",mobileIcon:"F",mobileIconBg:"bg-emerald-500/10",mobileIconColor:"text-emerald-600"},{label:"Reporting",href:"/dashboard/reporting",status:"coming-soon",mobileIcon:"R",mobileIconBg:"bg-primary/10",mobileIconColor:"text-primary"},{label:"Marketing",href:"/dashboard/marketing",status:"coming-soon",mobileIcon:"M",mobileIconBg:"bg-accent/10",mobileIconColor:"text-accent-foreground"},{label:"Training",href:"/dashboard/training",status:"coming-soon",mobileIcon:"T",mobileIconBg:"bg-accent/10",mobileIconColor:"text-accent-foreground"}];function bd({status:a}){return a?"beta"===a?(0,b.jsx)("span",{className:"absolute -top-1.5 right-0 rounded bg-blue-500 px-1 py-0.5 text-[0.5rem] leading-none font-semibold tracking-wide text-white uppercase shadow-sm",children:"Beta"}):"coming-soon"===a?(0,b.jsx)("span",{className:"absolute -top-1.5 right-0 rounded bg-purple-500 px-1 py-0.5 text-[0.5rem] leading-none font-semibold tracking-wide whitespace-nowrap text-white uppercase shadow-sm",children:"Soon"}):"new"===a?(0,b.jsx)("span",{className:"absolute -top-1.5 right-0 rounded bg-green-500 px-1 py-0.5 text-[0.5rem] leading-none font-semibold tracking-wide text-white uppercase shadow-sm",children:"New"}):(0,b.jsx)("span",{className:"absolute -top-1 right-0 size-2 rounded-full bg-blue-500 shadow-sm",title:"Updated"}):null}function be({count:a}){return 0===a?null:(0,b.jsx)("span",{className:"absolute -top-1.5 right-0 rounded bg-red-500 px-1 py-0.5 text-[0.5rem] leading-none font-semibold tracking-wide text-white shadow-sm whitespace-nowrap",children:a<=9?a.toString():a<=99?"99+":a<=999?"999+":"1K+"})}function bf({userProfile:a,companies:c,activeCompanyId:j,customers:k=[],companyPhones:l=[],hasPhoneNumbers:m=!1,hasPayrixAccount:n=!1,payrixStatus:o=null,subHeader:p}){let r,s,t,u=(0,g.usePathname)(),v="/dashboard/tv"===u;r=(0,i.useDialerStore)(a=>a.openDialer),s=(0,i.useDialerStore)(a=>a.closeDialer),t=(0,i.useDialerStore)(a=>a.isOpen),(0,h.useEffect)(()=>{let a=a=>{(a.ctrlKey||a.metaKey)&&a.shiftKey&&"D"===a.key&&(a.preventDefault(),t?s():r())};return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[r,s,t]);let[w,x]=(0,h.useState)(0);return((0,h.useEffect)(()=>{let a=async()=>{try{let a=await (0,a1.getTotalUnreadCountAction)();a.success&&void 0!==a.count&&x(a.count)}catch(a){console.error("Failed to fetch unread count:",a)}};a();let b=setInterval(a,3e4);return()=>clearInterval(b)},[u]),v)?null:(0,b.jsx)(b.Fragment,{children:(0,b.jsx)("header",{className:"safe-top bg-header-bg sticky top-0 z-50 w-full",children:(0,b.jsxs)("div",{className:"flex h-14 items-center gap-2 px-4 md:px-6",children:[(0,b.jsxs)(f.default,{className:"hover:border-primary/20 hover:bg-primary/10 hover:text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:border-destructive aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 dark:hover:bg-accent/50 flex shrink-0 items-center justify-center gap-2 rounded-md text-sm font-medium whitespace-nowrap transition-all outline-none focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 size-10 md:size-8","data-slot":"button",href:"/",children:[(0,b.jsx)(e.default,{alt:"Thorbis",className:"size-5",height:20,src:"/ThorbisLogo.webp",width:20}),(0,b.jsx)("span",{className:"sr-only",children:"Thorbis"})]}),(0,b.jsx)("nav",{className:"hidden items-center gap-0.5 ml-2 lg:flex",children:bc.map(a=>{let c="/dashboard"===a.href?"/dashboard"===u:u?.startsWith(a.href);return a.isSpecial?(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(f.default,{className:`focus-visible:ring-ring/50 relative inline-flex h-8 shrink-0 items-center justify-center gap-1.5 rounded-md px-3 text-sm font-medium whitespace-nowrap transition-all duration-150 outline-none focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 ${c?"bg-primary/15 text-primary dark:bg-primary/25 shadow-sm":"text-muted-foreground hover:bg-muted/70 hover:text-foreground"}`,"data-slot":"button",href:a.href,children:a.label}),(0,b.jsx)(bd,{status:a.status})]},a.href):(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(f.default,{className:`focus-visible:ring-ring/50 relative inline-flex h-8 shrink-0 items-center justify-center gap-1.5 rounded-md px-3 text-sm font-medium whitespace-nowrap transition-all duration-150 outline-none focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 ${c?"bg-primary/15 text-primary dark:bg-primary/25 shadow-sm":"text-muted-foreground hover:bg-muted/70 hover:text-foreground"}`,"data-slot":"button",href:a.href,children:a.label}),(0,b.jsx)(bd,{status:a.status}),"/dashboard/communication"===a.href&&(0,b.jsx)(be,{count:w})]},a.href)})}),(0,b.jsxs)("div",{className:"ml-auto flex items-center gap-2 overflow-visible md:flex-1 md:justify-end",children:[(0,b.jsx)(aM,{}),(0,b.jsx)(aD,{companyId:j||"",companyPhones:l}),(0,b.jsx)(f.default,{href:"/dashboard/tv",title:"TV Display",children:(0,b.jsxs)("button",{className:"hover-gradient hover:border-primary/20 hover:bg-primary/10 hover:text-primary focus-visible:ring-ring/50 flex items-center justify-center rounded-md border border-transparent transition-all outline-none focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 size-10 md:size-8",type:"button",children:[(0,b.jsx)(d.default,{className:"size-4"}),(0,b.jsx)("span",{className:"sr-only",children:"TV Display"})]})}),(0,b.jsx)(bb,{}),(0,b.jsx)(S,{hasPhoneNumbers:m,hasPayrixAccount:n,payrixStatus:o}),(0,b.jsx)(q,{}),(0,b.jsx)(a_,{activeCompanyId:j,teams:Array.from(new Map(c.map(a=>[a.id,{id:a.id,name:a.name,logo:a.logo,plan:a.plan,onboardingComplete:a.onboardingComplete,hasPayment:a.hasPayment}])).values()),user:{name:a.name,email:a.email,avatar:a.avatar,status:a.status}})]})]})})})}c.default,a.s(["AppHeaderClient",()=>bf],133291)},911051,a=>{"use strict";var b=a.i(861467),c=a.i(97997),d=a.i(246840),e=a.i(783281);a.i(445255);var f=a.i(18170);class g extends e.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,b){console.error("AppHeader Error:",a,b)}handleReset=()=>{this.setState({hasError:!1,error:null}),window.location.reload()};render(){return this.state.hasError?(0,b.jsx)(h,{onReset:this.handleReset}):this.props.children}}function h({onReset:a}){return(0,b.jsx)("header",{className:"border-border/40 bg-background/95 supports-[backdrop-filter]:bg-background/60 sticky top-0 z-50 w-full border-b backdrop-blur",children:(0,b.jsxs)("div",{className:"flex h-14 items-center justify-between px-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"bg-destructive/10 flex h-8 w-8 items-center justify-center rounded-md",children:(0,b.jsx)(c.AlertCircle,{className:"text-destructive h-4 w-4","aria-hidden":"true"})}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:"Unable to load header"}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs hidden sm:inline",children:"An error occurred while loading the navigation"})]})]}),(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:a,className:"gap-2","aria-label":"Retry loading header",children:[(0,b.jsx)(d.RefreshCw,{className:"h-3.5 w-3.5","aria-hidden":"true"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Retry"})]})]})})}a.s(["AppHeaderErrorBoundary",()=>g])},20164,a=>{"use strict";var b=a.i(861467),c=a.i(226559),d=a.i(783281);let e=(0,c.default)(async()=>{},{loadableGenerated:{modules:[809423]},loading:()=>null,ssr:!1});function f(){return(0,b.jsx)(d.Suspense,{fallback:null,children:(0,b.jsx)(e,{})})}a.s(["IncomingCallNotificationWrapper",()=>f])},184057,a=>{"use strict";var b=a.i(861467),c=a.i(783281),d=a.i(337241),e=a.i(318801),f=a.i(587969),g=a.i(396919),h=a.i(128952),i=a.i(94436),j=a.i(48199),k=a.i(300298),l=a.i(283753),m=a.i(274956),n=a.i(556253),o=a.i(200063),p=a.i(60095),q=a.i(127634),r=a.i(352770),s=a.i(337850),t=a.i(145679),u=a.i(131448);let v=[{label:"Ask Thorbis",href:"/dashboard/ai",icon:l.Sparkles,status:"beta",iconBg:"bg-primary/10",iconColor:"text-primary",description:"AI-powered assistant"},{label:"Finances",href:"/dashboard/finance",icon:m.DollarSign,status:"coming-soon",iconBg:"bg-emerald-500/10",iconColor:"text-emerald-600",description:"Financial management"},{label:"Reporting",href:"/dashboard/reporting",icon:n.BarChart3,status:"coming-soon",iconBg:"bg-primary/10",iconColor:"text-primary",description:"Analytics and reports"},{label:"Marketing",href:"/dashboard/marketing",icon:o.Megaphone,status:"coming-soon",iconBg:"bg-accent/10",iconColor:"text-accent-foreground",description:"Marketing campaigns"},{label:"Training",href:"/dashboard/training",icon:p.GraduationCap,status:"coming-soon",iconBg:"bg-accent/10",iconColor:"text-accent-foreground",description:"Learning center"},{label:"Settings",href:"/dashboard/settings",icon:q.Settings,iconBg:"bg-muted/50",iconColor:"text-muted-foreground",description:"App preferences"},{label:"Help",href:"/help",icon:r.HelpCircle,iconBg:"bg-muted/50",iconColor:"text-muted-foreground",description:"Get support"}];function w({status:a}){return a?(0,b.jsx)("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[0.65rem] font-semibold tracking-wide uppercase ${{beta:"bg-blue-500 text-white",new:"bg-green-500 text-white",updated:"bg-purple-500 text-white","coming-soon":"bg-purple-500 text-white"}[a]}`,children:{beta:"Beta",new:"New",updated:"Updated","coming-soon":"Soon"}[a]}):null}function x({unreadCount:a=0}){let e=(0,d.usePathname)(),[l,m]=(0,c.useState)(!1),n="/dashboard/tv"===e,o="/welcome"===e;if(n||o)return null;let p=[{label:"Today",href:"/dashboard",icon:g.Home},{label:"Messages",href:"/dashboard/communication/mobile",icon:h.MessageSquare,badge:a},{label:"Work",href:"/dashboard/work/mobile",icon:j.Briefcase},{label:"Schedule",href:"/dashboard/schedule",icon:f.Calendar},{label:"More",icon:i.MoreHorizontal,onClick:()=>m(!0)}];return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("nav",{className:"safe-bottom bg-background fixed bottom-0 left-0 right-0 z-40 border-t border-border lg:hidden",children:(0,b.jsx)("div",{className:"grid h-16 grid-cols-5",children:p.map(a=>{let c=!1;a.href&&(c="/dashboard"===a.href?"/dashboard"===e:"/dashboard/communication/mobile"===a.href?e?.startsWith("/dashboard/communication"):"/dashboard/work/mobile"===a.href?e?.startsWith("/dashboard/work")||e?.startsWith("/dashboard/customers"):e?.startsWith(a.href));let d=a.icon;return a.onClick?(0,b.jsxs)("button",{className:`flex flex-col items-center justify-center gap-1 transition-colors ${l?"text-primary":"text-muted-foreground hover:text-foreground active:text-primary"}`,onClick:a.onClick,type:"button","aria-label":"Open more menu","aria-expanded":l,children:[(0,b.jsx)("div",{className:"relative",children:(0,b.jsx)(d,{className:"h-6 w-6"})}),(0,b.jsx)("span",{className:"text-[0.65rem] font-medium leading-tight",children:a.label})]},a.label):(0,b.jsxs)(t.default,{className:`flex flex-col items-center justify-center gap-1 transition-colors ${c?"text-primary":"text-muted-foreground hover:text-foreground active:text-primary"}`,href:a.href,children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(d,{className:"h-6 w-6"}),"number"==typeof a.badge&&a.badge>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("span",{className:"absolute top-0 right-0 flex h-2 w-2",children:[(0,b.jsx)("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),(0,b.jsx)("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-red-500"})]}),(0,b.jsxs)("span",{className:"sr-only",children:[a.badge," unread ",1===a.badge?"message":"messages"]})]}),c&&(0,b.jsx)("div",{className:"absolute -bottom-1.5 left-1/2 h-1 w-1 -translate-x-1/2 rounded-full bg-primary"})]}),(0,b.jsx)("span",{className:"text-[0.65rem] font-medium leading-tight",children:a.label})]},a.label)})})}),(0,b.jsx)(u.Root,{open:l,onOpenChange:m,children:(0,b.jsxs)(u.Portal,{children:[(0,b.jsx)(u.Overlay,{className:"fixed inset-0 z-50 bg-background/95 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 lg:hidden"}),(0,b.jsxs)(u.Content,{className:"fixed inset-0 z-50 flex flex-col bg-background lg:hidden data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",children:[(0,b.jsx)("div",{className:"sticky top-0 z-10 bg-background/95 backdrop-blur-sm border-b border-border",children:(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 h-14",children:[(0,b.jsx)(u.Title,{className:"text-lg font-bold tracking-tight",children:"More"}),(0,b.jsx)(u.Close,{className:"flex h-10 w-10 items-center justify-center rounded-full hover:bg-accent/80 transition-colors active:scale-95","aria-label":"Close menu",children:(0,b.jsx)(k.X,{className:"h-6 w-6"})})]})}),(0,b.jsx)("div",{className:"h-[calc(100vh-3.5rem)] overflow-y-auto px-4 py-6",children:(0,b.jsx)("div",{className:"space-y-3 pb-safe",children:v.map(a=>{let c=e?.startsWith(a.href),d=a.icon;return(0,b.jsxs)(t.default,{className:`group flex items-center gap-4 rounded-2xl border-2 p-5 transition-all duration-200 active:scale-[0.98] ${c?"border-primary/40 bg-primary/10 text-primary shadow-lg shadow-primary/20":"border-border bg-card text-card-foreground hover:border-primary/30 hover:bg-primary/5 hover:shadow-md"}`,href:a.href,onClick:()=>m(!1),children:[(0,b.jsx)("div",{className:`flex h-14 w-14 shrink-0 items-center justify-center rounded-xl transition-all duration-200 ${a.iconBg} ${c?"scale-105":"group-hover:scale-105"}`,children:(0,b.jsx)(d,{className:`h-7 w-7 ${a.iconColor}`})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("span",{className:"font-semibold text-base",children:a.label}),a.status&&(0,b.jsx)(w,{status:a.status})]}),a.description&&(0,b.jsx)("p",{className:"text-muted-foreground text-sm leading-snug",children:a.description})]}),(0,b.jsx)(s.ChevronRight,{className:`h-5 w-5 text-muted-foreground/50 transition-all ${c?"text-primary":"group-hover:translate-x-1"}`})]},a.href)})})})]})]})})]})}function y(){let a=(0,d.usePathname)(),[f,g]=(0,c.useState)(0);return(0,c.useEffect)(()=>{let a=async()=>{try{let a=await (0,e.getTotalUnreadCountAction)();a.success&&void 0!==a.count&&g(a.count)}catch(a){console.error("Failed to fetch unread count:",a)}};a();let b=setInterval(a,3e4);return()=>clearInterval(b)},[a]),(0,b.jsx)(x,{unreadCount:f})}a.s(["MobileBottomTabsWrapper",()=>y],184057)},112559,a=>{"use strict";var b=a.i(783281),c=a.i(156916),d=a.i(527228),e=a.i(140596);a.i(495976);let f=(0,d.create)()((0,e.devtools)((a,b)=>({soundEnabled:!0,desktopNotificationsEnabled:!0,toastDuration:5e3,toastQueue:[],showCommunicationToast:(d,e={})=>{let{metadata:f}=d,g=f?.communication_type,h="ðŸ“©";switch(g){case"call":h="ðŸ“ž","high"===d.priority&&(h="ðŸ“µ");break;case"sms":h="ðŸ’¬";break;case"email":h="ðŸ“§";break;case"voicemail":h="ðŸŽ™ï¸",d.priority}let{soundEnabled:i}=b();i&&b().playNotificationSound();let{desktopNotificationsEnabled:j}=b();j&&b().showDesktopNotification(d.title,d.message,f??void 0);let k=(0,c.toast)(d.title,{description:d.message,duration:e.duration||b().toastDuration,icon:h,closeButton:e.closeButton??!0,dismissible:e.dismissible??!0,action:d.action_url?{label:d.action_label||"View",onClick:()=>{d.action_url&&(window.location.href=d.action_url)}}:e.action,className:"urgent"===d.priority?"border-destructive bg-destructive/10":""});return a(a=>({toastQueue:[...a.toastQueue,String(k)]})),k},showCallToast:(a,d,e,f={})=>{let g="",h="",i="ðŸ“ž";switch(e){case"incoming":g=`Incoming call from ${a}`,h=d,i="ðŸ“ž";break;case"missed":g=`Missed call from ${a}`,h=d,i="ðŸ“µ";break;case"completed":g=`Call with ${a}`,h=`Duration: ${f.duration||"Unknown"}`,i="âœ…"}let j=(0,c.toast)(g,{description:h,icon:i,duration:b().toastDuration,closeButton:!0,action:{label:"View",onClick:()=>{window.location.href="/dashboard/customers/communication?filter=calls"}},className:"missed"===e?"border-destructive":""});return b().soundEnabled&&b().playNotificationSound(),b().desktopNotificationsEnabled&&b().showDesktopNotification(g,h,{status:e,...f}),j},showVoicemailToast:(a,d,e)=>{let f=`New voicemail from ${a}`,g=e?`${d} â€¢ ${e}s`:d,h=(0,c.toast)(f,{description:g,icon:"ðŸŽ™ï¸",duration:b().toastDuration,closeButton:!0,action:{label:"Listen",onClick:()=>{window.location.href="/dashboard/customers/communication?filter=voicemails"}}});return b().soundEnabled&&b().playNotificationSound(),b().desktopNotificationsEnabled&&b().showDesktopNotification(f,g,{type:"voicemail",duration:e}),h},showSMSToast:(a,d,e)=>{let f=`Text from ${a}`,g=e.length>100?`${e.substring(0,100)}...`:e,h=(0,c.toast)(f,{description:g,icon:"ðŸ’¬",duration:b().toastDuration,closeButton:!0,action:{label:"Reply",onClick:()=>{window.location.href="/dashboard/customers/communication?filter=sms"}}});return b().soundEnabled&&b().playNotificationSound(),b().desktopNotificationsEnabled&&b().showDesktopNotification(f,g,{type:"sms",from:d}),h},showEmailToast:(a,d,e)=>{let f=`Email from ${a}`,g=e||"No subject",h=(0,c.toast)(f,{description:g,icon:"ðŸ“§",duration:b().toastDuration,closeButton:!0,action:{label:"View",onClick:()=>{window.location.href="/dashboard/customers/communication?filter=emails"}}});return b().soundEnabled&&b().playNotificationSound(),b().desktopNotificationsEnabled&&b().showDesktopNotification(f,g,{type:"email",from:d}),h},dismissToast:b=>{c.toast.dismiss(b),a(a=>({toastQueue:a.toastQueue.filter(a=>a!==String(b))}))},dismissAllToasts:()=>{c.toast.dismiss(),a({toastQueue:[]})},setSoundEnabled:b=>{a({soundEnabled:b})},setDesktopNotificationsEnabled:c=>{a({desktopNotificationsEnabled:c}),c&&b().requestDesktopNotificationPermission()},setToastDuration:b=>{a({toastDuration:b})},playNotificationSound:()=>{},requestDesktopNotificationPermission:async()=>!1,showDesktopNotification:(a,b,c={})=>{}}),{name:"CommunicationNotificationsStore"}));var g=a.i(903599),h=a.i(132440);function i(){let a=(0,g.useNotificationsStore)(a=>a.subscribe),c=(0,g.useNotificationsStore)(a=>a.unsubscribe),d=f(a=>a.requestDesktopNotificationPermission),e=f(a=>a.desktopNotificationsEnabled),i=f(a=>a.setDesktopNotificationsEnabled),j=(0,b.useRef)(!1);return(0,b.useEffect)(()=>{if(j.current)return;j.current=!0;let b=!1,d=(0,h.createClient)();return(async()=>{if(!d)return;let{data:{user:c}}=await d.auth.getUser();c&&!b&&await a(c.id)})(),()=>{b=!0,c()}},[a,c]),(0,b.useEffect)(()=>{},[e,d,i]),null}a.s(["NotificationsInitializer",()=>i],112559)},369453,a=>{"use strict";var b=a.i(861467),c=a.i(783281),d=a.i(169021),e=(0,d.createServerReference)("000f90f949d6a2f5484d061d5a738a59a8c846aeaa",d.callServer,void 0,d.findSourceMapURL,"getPendingSupportSessions"),f=(0,d.createServerReference)("00665c1bbcd52d612d5bb4bf3be5e7fc75554132e6",d.callServer,void 0,d.findSourceMapURL,"getActiveSupportSessions");a.i(19256);var g=a.i(417132);a.i(445255);var h=a.i(18170);a.i(40744);var i=a.i(419573),j=a.i(352424),k=a.i(624126),l=a.i(320091),m=a.i(748634),m=m,n=a.i(97997),o=(0,d.createServerReference)("602e89ae7ace85fc30cd3b4b1dd865d517c0cb1cd5",d.callServer,void 0,d.findSourceMapURL,"approveSupportSessionRequest"),p=(0,d.createServerReference)("60886af124323873afd4d5b64bb4143abbcba2c154",d.callServer,void 0,d.findSourceMapURL,"rejectSupportSessionRequest"),q=a.i(156916);function r({session:a,open:d,onOpenChange:e,onApproved:f,onRejected:r}){let[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)("60");if(!a)return null;let y=async()=>{t(!0);try{let b=await o(a.id,parseInt(w));b.success?(q.toast.success("Support access approved",{description:`Access granted for ${w} minutes`}),e(!1),f?.()):q.toast.error("Failed to approve access",{description:b.error||"Please try again"})}catch(a){q.toast.error("Error approving access"),console.error(a)}finally{t(!1)}},z=async()=>{v(!0);try{let b=await p(a.id,"Declined by customer");b.success?(q.toast.success("Support access denied"),e(!1),r?.()):q.toast.error("Failed to deny access",{description:b.error||"Please try again"})}catch(a){q.toast.error("Error denying access"),console.error(a)}finally{v(!1)}},A={view:"View your account data",edit_jobs:"Modify jobs",edit_invoices:"Modify invoices",edit_payments:"Manage payments",refund:"Issue refunds",edit_team:"Manage team members",reset_password:"Reset passwords",edit_company:"Update company settings"};return(0,b.jsx)(g.Dialog,{open:d,onOpenChange:e,children:(0,b.jsxs)(g.DialogContent,{className:"sm:max-w-[500px]",children:[(0,b.jsxs)(g.DialogHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)("div",{className:"rounded-full bg-orange-100 dark:bg-orange-900/20 p-2",children:(0,b.jsx)(j.Shield,{className:"h-5 w-5 text-orange-600"})}),(0,b.jsx)(g.DialogTitle,{children:"Support Access Request"})]}),(0,b.jsx)(g.DialogDescription,{children:"A support team member is requesting access to your account to assist you."})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"rounded-lg border bg-muted/50 p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.User,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Support Representative"})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.admin_name||a.admin_email||a.admin_user_id}),a.ticket_id&&(0,b.jsxs)("div",{className:"flex items-center gap-2 pt-2 border-t",children:[(0,b.jsx)(m.default,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("span",{className:"text-sm",children:["Ticket: ",(0,b.jsx)("span",{className:"font-mono",children:a.ticket_id})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Reason for Access"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground rounded-md border p-3 bg-muted/30",children:a.reason})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Requested Permissions"}),(0,b.jsx)("div",{className:"space-y-1",children:a.requested_permissions.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-orange-500"}),(0,b.jsx)("span",{children:A[a]||a})]},a))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("label",{className:"text-sm font-medium flex items-center gap-2",children:[(0,b.jsx)(k.Clock,{className:"h-4 w-4"}),"Access Duration"]}),(0,b.jsxs)(i.Select,{value:w,onValueChange:x,children:[(0,b.jsx)(i.SelectTrigger,{children:(0,b.jsx)(i.SelectValue,{})}),(0,b.jsxs)(i.SelectContent,{children:[(0,b.jsx)(i.SelectItem,{value:"30",children:"30 minutes"}),(0,b.jsx)(i.SelectItem,{value:"60",children:"1 hour (recommended)"}),(0,b.jsx)(i.SelectItem,{value:"120",children:"2 hours"}),(0,b.jsx)(i.SelectItem,{value:"240",children:"4 hours"})]})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Support access will automatically expire after this time."})]}),(0,b.jsx)("div",{className:"rounded-lg border border-orange-200 dark:border-orange-800 bg-orange-50 dark:bg-orange-950/20 p-3 space-y-1",children:(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(n.AlertCircle,{className:"h-4 w-4 text-orange-600 mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-orange-900 dark:text-orange-100",children:"Security Notice"}),(0,b.jsx)("p",{className:"text-xs text-orange-800 dark:text-orange-200",children:"All actions taken by support will be logged and visible in your account audit trail."})]})]})})]}),(0,b.jsxs)(g.DialogFooter,{className:"flex-col sm:flex-row gap-2",children:[(0,b.jsx)(h.Button,{type:"button",variant:"outline",onClick:z,disabled:s||u,className:"w-full sm:w-auto",children:u?"Denying...":"Deny Access"}),(0,b.jsx)(h.Button,{type:"button",onClick:y,disabled:s||u,className:"w-full sm:w-auto bg-orange-600 hover:bg-orange-700",children:s?"Approving...":`Approve for ${"60"===w?"1 hour":"30"===w?"30 min":"120"===w?"2 hours":"4 hours"}`})]})]})})}var s=a.i(300298),t=a.i(984270),u=(0,d.createServerReference)("40369e8ea4eced7bdaef8203d369469ee7b630db8c",d.callServer,void 0,d.findSourceMapURL,"endActiveSupportSession"),v=a.i(145679);function w({session:a,onSessionEnded:d}){let e,f,[g,i]=(0,c.useState)(""),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let b=()=>{let b=new Date,c=new Date(a.expires_at).getTime()-b.getTime();if(c<=0){i("Expired"),o(!0);return}let d=Math.floor(c/1e3/60),e=Math.floor(c/1e3%60);d>0?i(`${d}:${e.toString().padStart(2,"0")}`):i(`${e}s`)};b();let c=setInterval(b,1e3);return()=>clearInterval(c)},[a.expires_at]);let p=async()=>{if(confirm("Are you sure you want to end support access?")){m(!0);try{let b=await u(a.id);b.success?(q.toast.success("Support access ended"),d?.()):q.toast.error("Failed to end access",{description:b.error})}catch(a){q.toast.error("Error ending support access"),console.error(a)}finally{m(!1)}}};return n?null:(0,b.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-orange-500 to-orange-600 dark:from-orange-600 dark:to-orange-700 text-white shadow-lg",children:(0,b.jsx)("div",{className:"container mx-auto px-4 py-2",children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"rounded-full bg-white/20 p-1.5",children:(0,b.jsx)(j.Shield,{className:"h-4 w-4"})}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("span",{className:"font-medium",children:"Support Access Active"}),(0,b.jsx)("span",{className:"opacity-90",children:"â€¢"}),(0,b.jsx)("span",{className:"opacity-90",children:a.admin_name||a.admin_email||"Support Team"}),a.ticket_id&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"opacity-90",children:"â€¢"}),(0,b.jsxs)("span",{className:"opacity-90",children:["Ticket: ",a.ticket_id]})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1.5 text-sm",children:[(0,b.jsx)(k.Clock,{className:"h-3.5 w-3.5"}),(0,b.jsx)("span",{className:`font-mono font-medium ${(e=new Date,(f=(new Date(a.expires_at).getTime()-e.getTime())/1e3/60)<=5?"text-red-600 dark:text-red-400":f<=10?"text-yellow-600 dark:text-yellow-400":"text-green-600 dark:text-green-400")}`,children:g}),(0,b.jsx)("span",{className:"opacity-90 text-xs",children:"remaining"})]}),(0,b.jsx)(v.default,{href:"/dashboard/settings/support-activity",className:"hidden sm:flex",children:(0,b.jsxs)(h.Button,{variant:"ghost",size:"sm",className:"h-7 gap-1.5 text-white hover:bg-white/20",children:[(0,b.jsx)(t.ExternalLink,{className:"h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"text-xs",children:"View Activity"})]})}),(0,b.jsxs)(h.Button,{variant:"ghost",size:"sm",onClick:p,disabled:l,className:"h-7 gap-1.5 text-white hover:bg-white/20 border border-white/30",children:[(0,b.jsx)(s.X,{className:"h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"text-xs",children:l?"Ending...":"End Access"})]})]})]})})})}var x=a.i(132440),y=a.i(274956),z=a.i(101482),A=a.i(319895),B=a.i(48199);function C(){let a=(0,c.useRef)(null),d=(0,c.useRef)(!1);return(0,c.useEffect)(()=>{let c=async()=>{if(!d.current){d.current=!0;try{let c=(0,x.createClient)(),{data:{user:d}}=await c.auth.getUser();if(!d)return;let{data:e}=await c.from("team_members").select("company_id").eq("user_id",d.id).single();if(!e)return;let{data:f}=await c.from("support_sessions").select("id").eq("company_id",e.company_id).eq("status","active");if(!f||0===f.length)return;let g=f.map(a=>a.id),h=c.from("support_session_actions").select("id, action, resource_type, resource_id, reason, created_at, session_id").in("session_id",g).order("created_at",{ascending:!1}).limit(10);a.current&&(h=h.gt("created_at",a.current));let{data:i}=await h;i&&i.length>0&&(a.current=i[0].created_at,i.reverse().forEach(a=>{var c,d;let e,f,g,h,i;c=a,h=function(a){switch(a){case"payment":return(0,b.jsx)(y.DollarSign,{className:"h-4 w-4"});case"invoice":return(0,b.jsx)(A.FileText,{className:"h-4 w-4"});case"job":return(0,b.jsx)(B.Briefcase,{className:"h-4 w-4"});case"team":return(0,b.jsx)(z.Users,{className:"h-4 w-4"});default:return(0,b.jsx)(j.Shield,{className:"h-4 w-4"})}}(c.resource_type),i=(e=(d=c).resource_type.charAt(0).toUpperCase()+d.resource_type.slice(1),f=d.action.replace(/_/g," ").toLowerCase(),g=d.resource_id.slice(0,8),`Support ${f} on ${e} (${g}...)`),q.toast.info(i,{description:c.reason||"Support action performed",icon:h,duration:8e3,action:{label:"View Activity",onClick:()=>{window.location.href="/dashboard/settings/support-activity"}}})}))}catch(a){console.error("Error checking for support actions:",a)}finally{d.current=!1}}};c();let e=setInterval(c,1e4);return()=>clearInterval(e)},[]),null}function D({children:a}){let[d,g]=(0,c.useState)([]),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(0),n=async()=>{try{let a=await e();a.success&&a.sessions&&(g(a.sessions),a.sessions.length>0&&!j&&(k(!0),m(0)));let b=await f();b.success&&b.sessions&&i(b.sessions)}catch(a){console.error("Error fetching support sessions:",a)}};(0,c.useEffect)(()=>{n();let a=setInterval(n,1e4);return()=>clearInterval(a)},[]);let o=d[l]||null,p=h[0]||null;return(0,b.jsxs)(b.Fragment,{children:[p&&(0,b.jsx)(w,{session:p,onSessionEnded:()=>{n()}}),(0,b.jsx)(r,{session:o,open:j,onOpenChange:k,onApproved:()=>{n(),l<d.length-1?m(l+1):k(!1)},onRejected:()=>{n(),l<d.length-1?m(l+1):k(!1)}}),(0,b.jsx)(C,{}),(0,b.jsx)("div",{className:p?"pt-12":"",children:a})]})}a.s(["SupportSessionProvider",()=>D],369453)}];

//# sourceMappingURL=apps_web_src_7e080df2._.js.map