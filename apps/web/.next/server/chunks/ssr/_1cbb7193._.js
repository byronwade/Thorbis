module.exports=[311487,a=>{"use strict";async function b(a,b,c,d){let{data:e,error:f}=await a.rpc("has_role",{user_uuid:b,required_role:c,company_uuid:d});return!f&&!0===e}async function c(a,b,c){let{data:d,error:e}=await a.rpc("get_user_role",{user_uuid:b,company_uuid:c});return e?null:d}async function d(a,b,c,d){let{data:e,error:f}=await a.rpc("has_permission",{user_uuid:b,permission_key:c,company_uuid:d});return!f&&!0===e}async function e(a,b,c){let{data:d,error:e}=await a.rpc("is_company_owner",{user_uuid:b,company_uuid:c});return!e&&!0===d}a.s(["getUserRole",()=>c,"hasPermission",()=>d,"hasRole",()=>b,"isCompanyOwner",()=>e])},997053,a=>{"use strict";a.i(311487),a.s([])},288344,a=>{"use strict";var b=a.i(780195);a.i(218188);var c=a.i(146057);a.i(467361);var d=a.i(445074);a.i(997053);var e=a.i(311487),f=a.i(974406),g=a.i(136874),h=a.i(395731);async function i(){return(0,f.withErrorHandling)(async()=>{let a=await (0,g.createClient)();if(!a)throw Error("Database connection not available");let{data:{user:b}}=await a.auth.getUser();if(!b)throw Error("Not authenticated");let c=await (0,d.getActiveCompanyId)();if(!c)throw Error("No active company");return await (0,e.getUserRole)(a,b.id,c)})}async function j(a){return(0,f.withErrorHandling)(async()=>{let b=await (0,g.createClient)();if(!b)throw Error("Database connection not available");let c=await (0,d.getActiveCompanyId)();if(!c)throw Error("No active company");let{data:e,error:f}=await b.from("company_memberships").select("user_id, role").eq("id",a).eq("company_id",c).single();if(f||!e)throw Error("Team member not found");let{data:h}=await b.from("companies").select("owner_id").eq("id",c).single();return h&&h.owner_id===e.user_id?{canDelete:!1,reason:"Cannot delete company owner. Transfer ownership first before removing this team member."}:{canDelete:!0}})}c.z.object({teamMemberId:c.z.string().uuid(),newRole:c.z.enum(["owner","admin","manager","dispatcher","technician","csr"]),reason:c.z.string().optional()}),c.z.object({teamMemberId:c.z.string().uuid(),permissions:c.z.record(c.z.string(),c.z.boolean())}),(0,h.ensureServerEntryExports)([i,j]),(0,b.registerServerReference)(i,"001f005176797ef23488068124fb9a744915a477de",null),(0,b.registerServerReference)(j,"406f6624261c6dd1a908026fa1408a3f6d507b6e7d",null),a.s(["canDeleteTeamMember",()=>j,"getCurrentUserRole",()=>i])},518216,a=>{"use strict";class b{requests;maxRequests;windowMs;constructor(a,b){this.requests=new Map,this.maxRequests=a,this.windowMs=b,setInterval(()=>this.cleanup(),6e4)}async limit(a){let b=Date.now(),c=this.requests.get(a);return(c||(c={count:0,resetAt:b+this.windowMs,requests:[]},this.requests.set(a,c)),c.requests=c.requests.filter(a=>a>b-this.windowMs),c.requests.length>=this.maxRequests)?{success:!1,limit:this.maxRequests,remaining:0,reset:Math.min(...c.requests)+this.windowMs}:(c.requests.push(b),c.count=c.requests.length,{success:!0,limit:this.maxRequests,remaining:this.maxRequests-c.count,reset:b+this.windowMs})}cleanup(){let a=Date.now();for(let[b,c]of this.requests.entries())c.requests=c.requests.filter(b=>b>a-this.windowMs),0===c.requests.length&&this.requests.delete(b)}reset(a){this.requests.delete(a)}clear(){this.requests.clear()}}let c=new b(5,9e5),d=new b(100,6e4),e=new b(3,36e5),f={limit:a=>d.limit(a),reset:a=>d.reset(a)};class g extends Error{limit;remaining;reset;constructor(a,b,c,d){super(a),this.limit=b,this.remaining=c,this.reset=d,this.name="RateLimitError"}}async function h(a,b=f){let{success:c,limit:d,remaining:e,reset:i}=await b.limit(a);if(!c){let a=new Date(i);throw new g(`Too many requests. Please try again after ${a.toLocaleTimeString()}.`,d,e,i)}}a.s(["RateLimitError",()=>g,"authRateLimiter",0,{limit:a=>c.limit(a),reset:a=>c.reset(a)},"checkRateLimit",()=>h,"passwordResetRateLimiter",0,{limit:a=>e.limit(a),reset:a=>e.reset(a)}])}];

//# sourceMappingURL=_1cbb7193._.js.map