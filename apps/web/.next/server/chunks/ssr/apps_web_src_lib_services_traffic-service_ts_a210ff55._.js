module.exports=[46443,a=>{"use strict";var b=a.i(146057);let c=b.z.object({type:b.z.enum(["crash","construction","road_closed","police","congestion","other"]),severity:b.z.enum(["minor","moderate","major"]),description:b.z.string(),location:b.z.object({lat:b.z.number(),lon:b.z.number(),address:b.z.string().optional()}),distance:b.z.number(),affectsRoute:b.z.boolean(),startTime:b.z.string().optional(),endTime:b.z.string().optional(),enrichedAt:b.z.string()}),d=b.z.object({incidents:b.z.array(c),totalIncidents:b.z.number(),nearbyIncidents:b.z.number(),routeAffectingIncidents:b.z.number(),dataSource:b.z.string(),enrichedAt:b.z.string()}),e=new class{async getTrafficIncidents(a,b,c,e){try{let f="AIzaSyCVKN0pddG230vvjT0EMP9sSIR31j1q2t0",g=[];if(c&&e){let d=await this.getRouteIncidents(c,e,a,b,f);g.push(...d)}let h=await this.getNearbyIncidents(a,b,f);g.push(...h);let i=g.filter(a=>a.distance<=5).length,j=g.filter(a=>a.affectsRoute).length,k={incidents:g,totalIncidents:g.length,nearbyIncidents:i,routeAffectingIncidents:j,dataSource:"google-maps",enrichedAt:new Date().toISOString()};return d.parse(k)}catch(a){return null}}async getRouteIncidents(a,b,c,d,e){try{let f=new URL("https://maps.googleapis.com/maps/api/directions/json");f.searchParams.set("origin",`${a},${b}`),f.searchParams.set("destination",`${c},${d}`),f.searchParams.set("departure_time","now"),f.searchParams.set("traffic_model","best_guess"),f.searchParams.set("key",e);let g=await fetch(f.toString());if(!g.ok)return[];let h=await g.json();if("OK"!==h.status||!h.routes?.[0])return[];let i=h.routes[0],j=[];if(i.warnings)for(let a of i.warnings)j.push({type:this.categorizeWarning(a),severity:"moderate",description:a,location:{lat:c,lon:d},distance:0,affectsRoute:!0,enrichedAt:new Date().toISOString()});let k=i.legs[0];if(k.duration_in_traffic&&k.duration){let a=k.duration_in_traffic.value-k.duration.value,b=Math.floor(a/60);b>10&&j.push({type:"congestion",severity:b>30?"major":"moderate",description:`Heavy traffic causing ${b} minute delay`,location:{lat:c,lon:d},distance:0,affectsRoute:!0,enrichedAt:new Date().toISOString()})}return j}catch(a){return[]}}async getNearbyIncidents(a,b,c){return[]}categorizeWarning(a){let b=a.toLowerCase();return b.includes("construction")||b.includes("work")?"construction":b.includes("closed")||b.includes("closure")?"road_closed":b.includes("accident")||b.includes("crash")?"crash":"other"}};a.s(["trafficService",0,e])}];

//# sourceMappingURL=apps_web_src_lib_services_traffic-service_ts_a210ff55._.js.map