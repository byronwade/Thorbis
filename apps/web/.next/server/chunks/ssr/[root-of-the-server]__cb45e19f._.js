module.exports=[193695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},997868,a=>{a.n(a.i(884849))},592581,a=>{a.n(a.i(596565))},134005,a=>{a.n(a.i(977930))},565165,a=>{a.n(a.i(728209))},147941,a=>{a.n(a.i(484103))},304434,a=>{a.n(a.i(632684))},407521,a=>{a.n(a.i(693094))},797797,a=>{a.n(a.i(977207))},290022,a=>{a.n(a.i(362735))},729157,a=>{a.n(a.i(470009))},712363,a=>{a.n(a.i(279732))},208120,a=>{a.n(a.i(52860))},863056,a=>{a.n(a.i(77721))},468729,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call WorkDataView() from the server but WorkDataView is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/work-data-view.tsx <module evaluation>","WorkDataView");a.s(["WorkDataView",0,b])},750692,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call WorkDataView() from the server but WorkDataView is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/work-data-view.tsx","WorkDataView");a.s(["WorkDataView",0,b])},310669,a=>{"use strict";a.i(468729);var b=a.i(750692);a.n(b)},89336,a=>{a.n(a.i(587779))},403917,a=>{a.n(a.i(936356))},817753,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call AppointmentsKanban() from the server but AppointmentsKanban is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/appointments-kanban.tsx <module evaluation>","AppointmentsKanban");a.s(["AppointmentsKanban",0,b])},901024,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call AppointmentsKanban() from the server but AppointmentsKanban is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/appointments-kanban.tsx","AppointmentsKanban");a.s(["AppointmentsKanban",0,b])},90959,a=>{"use strict";a.i(817753);var b=a.i(901024);a.n(b)},412725,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call AppointmentsTable() from the server but AppointmentsTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/appointments-table.tsx <module evaluation>","AppointmentsTable");a.s(["AppointmentsTable",0,b])},325589,a=>{"use strict";let b=(0,a.i(742210).registerClientReference)(function(){throw Error("Attempted to call AppointmentsTable() from the server but AppointmentsTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/work/appointments-table.tsx","AppointmentsTable");a.s(["AppointmentsTable",0,b])},185018,a=>{"use strict";a.i(412725);var b=a.i(325589);a.n(b)},546279,a=>{"use strict";var b=a.i(504348),c=a.i(429969);a.i(692167);var d=a.i(852596),e=a.i(90959),f=a.i(185018),g=a.i(310669);a.i(467361);var h=a.i(445074),i=a.i(933427);let j=`
  id,
  company_id,
  customer_id,
  property_id,
  job_id,
  assigned_to,
  title,
  description,
  status,
  start_time,
  end_time,
  archived_at,
  deleted_at,
  type,
  created_at,
  updated_at,
  customer:customers!appointments_customer_id_customers_id_fk (
    id,
    first_name,
    last_name,
    display_name
  ),
  assigned_user:users!appointments_assigned_to_users_id_fk (
    id,
    name,
    email
  )
`;async function k(a,b=50,c="",d){let e=d??await (0,h.getActiveCompanyId)();if(!e)return{appointments:[],totalCount:0};let f=await (0,i.createServiceSupabaseClient)();if(!f)throw Error("Supabase client not configured");let g=(Math.max(a,1)-1)*b,l=f.from("appointments").select(j,{count:"exact"}).eq("company_id",e).eq("type","appointment").is("deleted_at",null).order("start_time",{ascending:!1}).range(g,g+b-1),m=c.trim();if(m){let a=m.replace(/,/g,"\\,"),b=`%${a}%`;l=l.or(`title.ilike.${b},description.ilike.${b},status.ilike.${b}`)}let{data:n,error:o,count:p}=await l;if(o)throw Error(`Failed to load appointments: ${o.message}`);return{appointments:n??[],totalCount:p??0}}async function l({searchParams:a}){let c=await (0,h.getActiveCompanyId)();if(!c)return(0,d.notFound)();let i=Number(a?.page)||1,j=a?.search??"",{appointments:l,totalCount:m}=await k(i,50,j,c),n=l.map(a=>{let b=Array.isArray(a.customer)?a.customer[0]:a.customer,c=Array.isArray(a.assigned_user)?a.assigned_user[0]:a.assigned_user;return{id:a.id,title:a.title||a.id||"Untitled Appointment",description:a.description,start_time:a.start_time,end_time:a.end_time??a.start_time,status:a.status||"scheduled",customer:b??null,assigned_user:c??null,job_id:a.job_id,archived_at:a.archived_at??null,deleted_at:a.deleted_at??null}});return(0,b.jsx)(g.WorkDataView,{kanban:(0,b.jsx)(e.AppointmentsKanban,{appointments:n}),section:"appointments",table:(0,b.jsx)(f.AppointmentsTable,{appointments:n,itemsPerPage:50,totalCount:m,currentPage:i,initialSearchQuery:j})})}function m(){return(0,b.jsxs)("div",{className:"flex h-full flex-col gap-4 p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"bg-muted h-8 w-48 animate-pulse rounded"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("div",{className:"bg-muted h-8 w-24 animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-8 w-24 animate-pulse rounded"})]})]}),(0,b.jsx)("div",{className:"space-y-2",children:[...Array(10)].map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"bg-muted h-12 w-12 animate-pulse rounded"}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)("div",{className:"bg-muted h-4 w-3/4 animate-pulse rounded"}),(0,b.jsx)("div",{className:"bg-muted h-3 w-1/2 animate-pulse rounded"})]}),(0,b.jsx)("div",{className:"bg-muted h-8 w-20 animate-pulse rounded"})]},c))})]})}async function n({searchParams:a}){let d=await a;return(0,b.jsx)("div",{className:"flex h-full flex-col",children:(0,b.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(m,{}),children:(0,b.jsx)(l,{searchParams:d})})})})}(0,c.cache)(async a=>{let b=a??await (0,h.getActiveCompanyId)();if(!b)return null;let c=await (0,i.createServiceSupabaseClient)();if(!c)throw Error("Supabase client not configured");let{data:d,error:e}=await c.from("appointments").select("status, archived_at, deleted_at").eq("company_id",b).eq("type","appointment").limit(5e4);if(e)throw Error(`Failed to fetch appointment stats: ${e.message}`);let f={total:0,scheduled:0,confirmed:0,in_progress:0,completed:0,cancelled:0};for(let a of d??[]){if(a.archived_at||a.deleted_at)continue;f.total++;let b=(a.status||"").toLowerCase();"scheduled"===b?f.scheduled++:"confirmed"===b?f.confirmed++:"in_progress"===b?f.in_progress++:"completed"===b?f.completed++:"cancelled"===b&&f.cancelled++}return f}),(0,c.cache)(async(a,b,c,d=50)=>{let e=a??await (0,h.getActiveCompanyId)();if(!e)return[];let f=await (0,i.createServiceSupabaseClient)();if(!f)throw Error("Supabase client not configured");let{data:g,error:j}=await f.rpc("get_appointments_with_details",{p_company_id:e,p_start_time:b||null,p_end_time:c||null,p_limit:d});return j?(console.error("Error fetching appointments via RPC:",j),[]):g||[]}),(0,c.cache)(async(a,b)=>{let c=await (0,i.createServiceSupabaseClient)();if(!c)throw Error("Supabase client not configured");let{data:d,error:e}=await c.rpc("get_appointment_complete",{p_appointment_id:a,p_company_id:b});return e?(console.error("Error fetching appointment:",e),null):d?.[0]?.appointment_data||null}),a.s(["default",()=>n],546279)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__cb45e19f._.js.map