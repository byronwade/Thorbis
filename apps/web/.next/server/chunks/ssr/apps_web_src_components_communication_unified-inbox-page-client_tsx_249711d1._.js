module.exports=[546623,a=>{"use strict";var b=a.i(861467),c=a.i(367301),d=a.i(97997),e=a.i(916680),f=a.i(452168),g=a.i(805034),h=a.i(48199),i=a.i(541087),j=a.i(624126),k=a.i(187056),l=a.i(558520),m=a.i(190121),n=a.i(198803),o=a.i(789815),p=a.i(128952),q=a.i(94436),r=a.i(744789),s=a.i(21220),t=a.i(898062),u=a.i(638727),v=a.i(530762),w=a.i(246840),x=a.i(521995),y=a.i(27878),z=a.i(171768),A=a.i(334044),B=a.i(339632),C=a.i(320091),D=a.i(774776),E=a.i(268344),F=a.i(300298),G=a.i(145679),H=a.i(337241),I=a.i(783281),J=a.i(156916),K=a.i(315405),L=a.i(593576),M=a.i(759815),N=a.i(936035),O=a.i(737096),P=a.i(336137),Q=a.i(607401),R=a.i(355986),S=a.i(10994),T=a.i(916682),U=a.i(767514),V=a.i(175427),W=a.i(638446),X=a.i(4229),Y=a.i(824124),Z=a.i(748083),$=a.i(877938);a.i(288007);var _=a.i(986990);a.i(445255);var aa=a.i(18170);a.i(380934);var ab=a.i(347421);a.i(146697);var ac=a.i(778737),ad=a.i(700760);function ae({communication:a,companyId:c,onLinked:e}){let[f,g]=(0,I.useState)([]),[i,j]=(0,I.useState)(!0),[k,l]=(0,I.useState)(null),[m,n]=(0,I.useState)(new Set);if((0,I.useEffect)(()=>{!async function(){if(c){j(!0);try{let b=await (0,$.getAutoLinkSuggestionsAction)({communicationId:a.id,companyId:c});b.success&&b.suggestions&&g(b.suggestions)}catch(a){console.error("Failed to fetch suggestions:",a)}finally{j(!1)}}}()},[a.id,c]),a.customerId||a.jobId||a.propertyId)return null;let o=f.filter(a=>!m.has(a.id));if(i)return(0,b.jsx)(ab.Card,{className:"border-blue-200 bg-blue-50/50 dark:border-blue-900 dark:bg-blue-950/20",children:(0,b.jsx)(ab.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(X.Link2,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),(0,b.jsx)(ab.CardTitle,{className:"text-sm font-semibold",children:"Looking for matches..."})]})})});if(0===o.length)return null;let p=async b=>{l(b.id);try{(await (0,Z.autoLinkCommunicationAction)({communicationId:a.id,customerId:"customer"===b.type?b.id:void 0,jobId:"job"===b.type?b.id:void 0,propertyId:"property"===b.type?b.id:void 0,linkConfidence:b.confidence,linkMethod:b.matchMethod})).success&&(g(a=>a.filter(a=>a.id!==b.id)),e?.())}catch(a){console.error("Failed to link communication:",a)}finally{l(null)}};return(0,b.jsxs)(ab.Card,{className:"border-blue-200 bg-blue-50/50 dark:border-blue-900 dark:bg-blue-950/20",children:[(0,b.jsxs)(ab.CardHeader,{className:"pb-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(X.Link2,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),(0,b.jsx)(ab.CardTitle,{className:"text-sm font-semibold",children:"Suggested Matches"})]}),(0,b.jsxs)(ab.CardDescription,{className:"text-xs",children:["We found ",o.length," potential"," ",1===o.length?"match":"matches"," for this communication"]})]}),(0,b.jsx)(ab.CardContent,{className:"space-y-2 pt-0",children:o.map((a,c)=>{var e;let f=(a=>{switch(a){case"customer":return{icon:C.User,color:"text-blue-500",bg:"bg-blue-500/10",label:"Customer"};case"job":return{icon:h.Briefcase,color:"text-purple-500",bg:"bg-purple-500/10",label:"Job"};case"property":return{icon:Y.MapPin,color:"text-green-500",bg:"bg-green-500/10",label:"Property"}}})(a.type),g=f.icon,i=k===a.id;return(0,b.jsxs)("div",{children:[c>0&&(0,b.jsx)(ac.Separator,{className:"my-2"}),(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:(0,ad.cn)("rounded-full p-2",f.bg),children:(0,b.jsx)(g,{className:(0,ad.cn)("h-4 w-4",f.color)})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0 space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("p",{className:"font-medium text-sm truncate",children:a.name}),(0,b.jsx)(_.Badge,{variant:"outline",className:"text-xs shrink-0",children:f.label})]}),a.subtitle&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:a.subtitle}),(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(e=a.confidence)>=.9?(0,b.jsxs)(_.Badge,{variant:"default",className:"gap-1",children:[(0,b.jsx)(W.Check,{className:"h-3 w-3"}),Math.round(100*e),"% match"]}):e>=.7?(0,b.jsxs)(_.Badge,{variant:"secondary",className:"gap-1",children:[Math.round(100*e),"% match"]}):(0,b.jsxs)(_.Badge,{variant:"outline",className:"gap-1",children:[(0,b.jsx)(d.AlertCircle,{className:"h-3 w-3"}),Math.round(100*e),"% match"]}),a.matchDetails&&(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:a.matchDetails})]})]}),(0,b.jsxs)("div",{className:"flex gap-1 shrink-0",children:[(0,b.jsxs)(aa.Button,{size:"sm",variant:"default",onClick:()=>p(a),disabled:i,className:"h-8 gap-1",children:[(0,b.jsx)(W.Check,{className:"h-3 w-3"}),"Link"]}),(0,b.jsx)(aa.Button,{size:"sm",variant:"ghost",onClick:()=>{var b;return b=a.id,void n(a=>new Set([...a,b]))},disabled:i,className:"h-8 w-8 p-0",children:(0,b.jsx)(F.X,{className:"h-3 w-3"})})]})]})]},a.id)})})]})}var af=a.i(717924),af=af,ag=a.i(565308),ah=a.i(587969),ai=a.i(766153),aj=a.i(990782),ak=a.i(984270),al=a.i(884483),al=al,am=a.i(976804),an=a.i(350291),ao=a.i(781157),ap=a.i(334838),aq=a.i(74609),aq=aq;a.i(956852);var ar=a.i(90125);a.i(585886);var as=a.i(644243);function at(a){if(!isFinite(a)||isNaN(a))return"0:00";let b=Math.floor(a/60),c=Math.floor(a%60);return`${b}:${c.toString().padStart(2,"0")}`}function au({src:a,title:c,className:d,compact:e=!1,onPlay:f,onPause:g,onEnded:h}){let i=(0,I.useRef)(null),[j,l]=(0,I.useState)(!1),[m,o]=(0,I.useState)(!0),[p,q]=(0,I.useState)(0),[r,s]=(0,I.useState)(0),[t,u]=(0,I.useState)(1),[v,w]=(0,I.useState)(1),[x,y]=(0,I.useState)(!1),[z,A]=(0,I.useState)(null);(0,I.useEffect)(()=>{let a=i.current;if(!a)return;let b=()=>{s(a.duration),o(!1)},c=()=>{q(a.currentTime)},d=()=>{l(!1),q(0),h?.()},e=()=>{l(!0),f?.()},j=()=>{l(!1),g?.()},k=()=>{A("Failed to load audio"),o(!1)},m=()=>{o(!0)},n=()=>{o(!1)};return a.addEventListener("loadedmetadata",b),a.addEventListener("timeupdate",c),a.addEventListener("ended",d),a.addEventListener("play",e),a.addEventListener("pause",j),a.addEventListener("error",k),a.addEventListener("waiting",m),a.addEventListener("canplay",n),()=>{a.removeEventListener("loadedmetadata",b),a.removeEventListener("timeupdate",c),a.removeEventListener("ended",d),a.removeEventListener("play",e),a.removeEventListener("pause",j),a.removeEventListener("error",k),a.removeEventListener("waiting",m),a.removeEventListener("canplay",n)}},[f,g,h]),(0,I.useEffect)(()=>{i.current&&(i.current.playbackRate=t)},[t]),(0,I.useEffect)(()=>{i.current&&(i.current.volume=x?0:v)},[v,x]);let B=(0,I.useCallback)(()=>{let a=i.current;a&&(j?a.pause():a.play().catch(()=>{A("Failed to play audio")}))},[j]),C=(0,I.useCallback)(a=>{let b=i.current;b&&a[0]&&(b.currentTime=a[0],q(a[0]))},[]),D=(0,I.useCallback)(a=>{(a[0]||0===a[0])&&(w(a[0]),y(0===a[0]))},[]),E=(0,I.useCallback)(()=>{y(a=>!a)},[]),F=(0,I.useCallback)(()=>{let b=document.createElement("a");b.href=a,b.download=c||"recording.mp3",document.body.appendChild(b),b.click(),document.body.removeChild(b)},[a,c]);return z?(0,b.jsx)("div",{className:(0,ad.cn)("flex items-center gap-2 rounded-lg border border-destructive/50 bg-destructive/10 p-3 text-sm text-destructive",d),children:(0,b.jsx)("span",{children:z})}):e?(0,b.jsxs)("div",{className:(0,ad.cn)("flex items-center gap-2",d),children:[(0,b.jsx)("audio",{ref:i,src:a,preload:"metadata"}),(0,b.jsx)(aa.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:B,disabled:m,children:m?(0,b.jsx)(n.Loader2,{className:"h-4 w-4 animate-spin"}):j?(0,b.jsx)(ao.Pause,{className:"h-4 w-4"}):(0,b.jsx)(ap.Play,{className:"h-4 w-4"})}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:[at(p)," / ",at(r)]})]}):(0,b.jsxs)("div",{className:(0,ad.cn)("rounded-lg border bg-card p-4 shadow-sm",d),children:[(0,b.jsx)("audio",{ref:i,src:a,preload:"metadata"}),c&&(0,b.jsx)("div",{className:"mb-3 text-sm font-medium text-foreground",children:c}),(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)(as.Slider,{value:[p],min:0,max:r||100,step:.1,onValueChange:C,className:"cursor-pointer",disabled:m}),(0,b.jsxs)("div",{className:"mt-1 flex justify-between text-xs text-muted-foreground",children:[(0,b.jsx)("span",{children:at(p)}),(0,b.jsx)("span",{children:at(r)})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aa.Button,{variant:"default",size:"icon",className:"h-10 w-10",onClick:B,disabled:m,children:m?(0,b.jsx)(n.Loader2,{className:"h-5 w-5 animate-spin"}):j?(0,b.jsx)(ao.Pause,{className:"h-5 w-5"}):(0,b.jsx)(ap.Play,{className:"h-5 w-5 ml-0.5"})}),(0,b.jsxs)(ar.DropdownMenu,{children:[(0,b.jsx)(ar.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(aa.Button,{variant:"outline",size:"sm",className:"w-14",children:[t,"x"]})}),(0,b.jsx)(ar.DropdownMenuContent,{align:"start",children:[.5,.75,1,1.25,1.5,2].map(a=>(0,b.jsxs)(ar.DropdownMenuItem,{onClick:()=>u(a),className:(0,ad.cn)(t===a&&"bg-accent"),children:[a,"x"]},a))})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"hidden items-center gap-2 sm:flex",children:[(0,b.jsx)(aa.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:E,children:x||0===v?(0,b.jsx)(aq.default,{className:"h-4 w-4"}):(0,b.jsx)(an.Volume2,{className:"h-4 w-4"})}),(0,b.jsx)(as.Slider,{value:[x?0:v],min:0,max:1,step:.1,onValueChange:D,className:"w-20"})]}),(0,b.jsx)(aa.Button,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:F,title:"Download recording",children:(0,b.jsx)(k.Download,{className:"h-4 w-4"})})]})]})]})}a.i(919381);var av=a.i(662143);a.i(413309);var aw=a.i(54210);function ax(a){if(!a)return"0:00";let b=Math.floor(a/60);return`${b}:${(a%60).toString().padStart(2,"0")}`}function ay({communication:a,onSendText:c,onCallBack:d,onTransfer:e}){let[f,g]=(0,I.useState)(!0),h="inbound"===a.direction,i=h?a.fromAddress:a.toAddress,k=a.fromName||a.customer?.firstName?`${a.customer?.firstName||""} ${a.customer?.lastName||""}`.trim():null,l=function(a){let{status:b,hangupCause:c,hangupSource:d,callDuration:e,answeringMachineDetected:f}=a;return f?{label:"Voicemail",icon:an.Volume2,color:"text-orange-500",description:"Call went to voicemail"}:"no_answer"===c||"missed"===b?{label:"Missed",icon:am.PhoneOff,color:"text-red-500",description:"Call was not answered"}:e&&e>0?{label:"Completed",icon:t.Phone,color:"text-green-500",description:`Call lasted ${ax(e)}`}:"in_progress"===b?{label:"In Progress",icon:t.Phone,color:"text-blue-500",description:"Call is currently active"}:{label:"Call",icon:t.Phone,color:"text-muted-foreground",description:b||"Unknown status"}}(a),m=l.icon;return(0,b.jsx)(aw.ScrollArea,{className:"h-full",children:(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:(0,ad.cn)("flex h-12 w-12 items-center justify-center rounded-full",h?"bg-blue-500/10":"bg-green-500/10"),children:h?(0,b.jsx)(af.default,{className:"h-6 w-6 text-blue-500"}):(0,b.jsx)(ag.ArrowUpRight,{className:"h-6 w-6 text-green-500"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-lg font-semibold",children:h?"Incoming Call":"Outgoing Call"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-muted-foreground",children:[(0,b.jsx)(m,{className:(0,ad.cn)("h-4 w-4",l.color)}),(0,b.jsx)("span",{className:"text-sm",children:l.description})]})]})]}),(0,b.jsx)(_.Badge,{variant:"outline",className:l.color,children:l.label})]}),(0,b.jsx)(ac.Separator,{}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wide",children:"Contact"}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-muted",children:(0,b.jsx)(C.User,{className:"h-5 w-5 text-muted-foreground"})}),(0,b.jsx)("div",{className:"flex-1",children:k?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"font-medium",children:k}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:i})]}):(0,b.jsx)("div",{className:"font-medium",children:i||"Unknown"})}),a.customerId&&(0,b.jsxs)(G.default,{href:`/dashboard/customers/${a.customerId}`,className:"text-sm text-primary hover:underline flex items-center gap-1",children:["View Profile",(0,b.jsx)(ak.ExternalLink,{className:"h-3 w-3"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wide",children:"Call Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.Clock,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Duration"}),(0,b.jsx)("div",{className:"font-medium",children:ax(a.callDuration)})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(ah.Calendar,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Date & Time"}),(0,b.jsx)("div",{className:"font-medium",children:new Date(a.createdAt).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})})]})]})]}),a.callSentiment&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Sentiment:"}),function(a){if(!a)return null;let c=a.toLowerCase(),d="secondary",e=a;return c.includes("positive")||c.includes("happy")?(d="default",e="Positive"):c.includes("negative")||c.includes("angry")||c.includes("frustrated")?(d="destructive",e="Negative"):c.includes("neutral")&&(d="secondary",e="Neutral"),(0,b.jsx)(_.Badge,{variant:d,children:e})}(a.callSentiment)]})]}),a.callRecordingUrl&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wide",children:"Recording"}),(0,b.jsx)(au,{src:a.callRecordingUrl,title:"Call Recording"})]}),a.callTranscript&&(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)(av.Collapsible,{open:f,onOpenChange:g,children:[(0,b.jsx)(av.CollapsibleTrigger,{asChild:!0,children:(0,b.jsxs)("button",{type:"button",className:"flex items-center justify-between w-full group",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wide",children:"Transcription"}),f?(0,b.jsx)(aj.ChevronUp,{className:"h-4 w-4 text-muted-foreground group-hover:text-foreground transition-colors"}):(0,b.jsx)(ai.ChevronDown,{className:"h-4 w-4 text-muted-foreground group-hover:text-foreground transition-colors"})]})}),(0,b.jsx)(av.CollapsibleContent,{children:(0,b.jsx)("div",{className:"mt-4 rounded-lg border bg-muted/50 p-4",children:(0,b.jsx)("p",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:a.callTranscript})})})]})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wide",children:"Actions"}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[i&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(aa.Button,{variant:"outline",size:"sm",onClick:()=>d?.(i),children:[(0,b.jsx)(t.Phone,{className:"h-4 w-4 mr-2"}),"Call Back"]}),(0,b.jsxs)(aa.Button,{variant:"outline",size:"sm",onClick:()=>c?.(i),children:[(0,b.jsx)(p.MessageSquare,{className:"h-4 w-4 mr-2"}),"Send Text"]})]}),(0,b.jsxs)(aa.Button,{variant:"outline",size:"sm",onClick:()=>e?.(a.id),children:[(0,b.jsx)(al.default,{className:"h-4 w-4 mr-2"}),"Transfer"]})]})]}),(a.hangupCause||a.twilioCallSid)&&(0,b.jsxs)(av.Collapsible,{children:[(0,b.jsx)(av.CollapsibleTrigger,{asChild:!0,children:(0,b.jsxs)("button",{type:"button",className:"flex items-center gap-2 text-xs text-muted-foreground hover:text-foreground transition-colors",children:[(0,b.jsx)(ai.ChevronDown,{className:"h-3 w-3"}),"Technical Details"]})}),(0,b.jsx)(av.CollapsibleContent,{children:(0,b.jsxs)("div",{className:"mt-2 rounded-lg border bg-muted/50 p-3 text-xs space-y-1",children:[a.hangupCause&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Hangup Cause:"})," ",a.hangupCause]}),a.hangupSource&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Hangup Source:"})," ",a.hangupSource]}),a.twilioCallSid&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Call SID:"})," ",(0,b.jsx)("code",{className:"text-[10px]",children:a.twilioCallSid})]})]})})]})]})})}var az=a.i(301784),aA=a.i(809007),aB=a.i(807833),aC=a.i(604),aD=a.i(90083),aE=a.i(50900),aF=a.i(101482);a.i(516775);var aG=a.i(560272);a.i(19256);var aH=a.i(417132);a.i(839984);var aI=a.i(372712);a.i(458393);var aJ=a.i(82012);a.i(605919);var aK=a.i(229614);a.i(40744);var aL=a.i(419573);a.i(897346);var aM=a.i(75892);function aN({open:c,onOpenChange:d,communication:e,companyId:f,currentTeamMemberId:g,onTransferComplete:h}){let[i,j]=(0,I.useTransition)(),[k,l]=(0,I.useState)([]),[m,q]=(0,I.useState)(!1),[r,s]=(0,I.useState)(""),[u,v]=(0,I.useState)(null),[w,x]=(0,I.useState)(""),[y,z]=(0,I.useState)("normal"),[A,B]=(0,I.useState)("all");(0,I.useEffect)(()=>{c&&D()},[c]);let D=(0,I.useCallback)(async()=>{q(!0);try{let{getTeamMembersPageData:b}=await a.A(374100),c=(await b(1,100,"",f,"active")).teamMembers.filter(a=>a.id!==g);l(c)}catch(a){console.error("Failed to fetch team members:",a),J.toast.error("Failed to load team members")}finally{q(!1)}},[f,g]),F=k.filter(a=>{let b=a.user?.full_name||a.user?.email||"",c=""===r||b.toLowerCase().includes(r.toLowerCase())||(a.job_title?.toLowerCase().includes(r.toLowerCase())??!1),d="all"===A||a.role===A;return c&&d}),G=Array.from(new Set(k.map(a=>a.role).filter(Boolean))),H=(0,I.useCallback)(async()=>{if(!u)return void J.toast.error("Please select a team member");let b=k.find(a=>a.id===u);b&&j(async()=>{try{let{transferCommunicationAction:c}=await a.A(457901).catch(()=>({transferCommunicationAction:null}));if(c){let a=await c({communicationId:e.id,toTeamMemberId:u,notes:w,priority:y});a.success?(J.toast.success(`Transferred to ${b.user?.full_name||b.user?.email||"team member"}`),h?.(b),d(!1),K()):J.toast.error(a.error||"Failed to transfer")}else J.toast.success(`Transferred to ${b.user?.full_name||b.user?.email||"team member"}`),h?.(b),d(!1),K()}catch(a){console.error("Failed to transfer:",a),J.toast.error("Failed to transfer communication")}})},[u,k,e.id,w,y,h,d]),K=()=>{v(null),x(""),z("normal"),s(""),B("all")};return(0,b.jsx)(aH.Dialog,{open:c,onOpenChange:d,children:(0,b.jsxs)(aH.DialogContent,{className:"sm:max-w-[500px]",children:[(0,b.jsxs)(aH.DialogHeader,{children:[(0,b.jsxs)(aH.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(aF.Users,{className:"h-5 w-5"}),"Transfer Communication"]}),(0,b.jsxs)(aH.DialogDescription,{children:["Transfer this ",e.type," to another team member for follow-up."]})]}),(0,b.jsx)("div",{className:"rounded-lg border bg-muted/50 p-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:(0,ad.cn)("flex h-10 w-10 items-center justify-center rounded-full",(()=>{switch(e.type){case"email":return"bg-blue-500/10";case"sms":return"bg-green-500/10";case"call":return"bg-purple-500/10";case"voicemail":return"bg-orange-500/10";default:return"bg-muted"}})()),children:(()=>{switch(e.type){case"email":default:return(0,b.jsx)(o.Mail,{className:"h-4 w-4"});case"sms":return(0,b.jsx)(p.MessageSquare,{className:"h-4 w-4"});case"call":return(0,b.jsx)(t.Phone,{className:"h-4 w-4"});case"voicemail":return(0,b.jsx)(E.Voicemail,{className:"h-4 w-4"})}})()}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium truncate",children:e.subject||e.fromAddress||e.toAddress||"Unknown"}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(()=>{switch(e.type){case"email":return"Email";case"sms":return"SMS Message";case"call":return"Phone Call";case"voicemail":return"Voicemail";default:return"Communication"}})(),e.callDuration&&(0,b.jsxs)(b.Fragment,{children:[" · ",Math.floor(e.callDuration/60),":",(e.callDuration%60).toString().padStart(2,"0")]}),"email"===e.type&&e.fromAddress&&(0,b.jsxs)(b.Fragment,{children:[" · From: ",e.fromAddress]})]})]}),(0,b.jsx)(aD.ArrowRight,{className:"h-4 w-4 text-muted-foreground"})]})}),(0,b.jsx)(ac.Separator,{}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(aE.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,b.jsx)(aI.Input,{placeholder:"Search team members...",value:r,onChange:a=>s(a.target.value),className:"pl-9"})]}),(0,b.jsxs)(aL.Select,{value:A,onValueChange:B,children:[(0,b.jsx)(aL.SelectTrigger,{className:"w-[130px]",children:(0,b.jsx)(aL.SelectValue,{placeholder:"All roles"})}),(0,b.jsxs)(aL.SelectContent,{children:[(0,b.jsx)(aL.SelectItem,{value:"all",children:"All roles"}),G.map(a=>(0,b.jsx)(aL.SelectItem,{value:a,children:a},a))]})]})]}),(0,b.jsx)(aw.ScrollArea,{className:"h-[200px] rounded-lg border",children:m?(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsx)(n.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):0===F.length?(0,b.jsx)("div",{className:"flex items-center justify-center h-full text-center p-4",children:(0,b.jsxs)("div",{children:[(0,b.jsx)(C.User,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:r||"all"!==A?"No team members found":"No other team members available"})]})}):(0,b.jsx)(aK.RadioGroup,{value:u||"",onValueChange:v,className:"p-2 space-y-1",children:F.map(a=>{let c=a.user?.full_name||a.user?.email||"Unknown Member",d=c.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2);return(0,b.jsxs)("label",{htmlFor:a.id,className:(0,ad.cn)("flex items-center gap-3 rounded-lg p-2 cursor-pointer transition-colors",u===a.id?"bg-primary/10 border border-primary":"hover:bg-accent border border-transparent"),children:[(0,b.jsx)(aK.RadioGroupItem,{value:a.id,id:a.id,className:"sr-only"}),(0,b.jsx)(aG.Avatar,{className:"h-8 w-8",children:(0,b.jsx)(aG.AvatarFallback,{className:"text-xs",children:d})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium truncate",children:c}),a.job_title&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:a.job_title})]}),a.role&&(0,b.jsx)(_.Badge,{variant:"outline",className:(0,ad.cn)("text-xs",(a=>{switch(a){case"owner":case"admin":return"bg-purple-500/10 text-purple-600";case"manager":return"bg-blue-500/10 text-blue-600";case"technician":return"bg-green-500/10 text-green-600";case"dispatcher":return"bg-orange-500/10 text-orange-600";case"csr":return"bg-cyan-500/10 text-cyan-600";default:return"bg-muted text-muted-foreground"}})(a.role)),children:a.role})]},a.id)})})})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(aJ.Label,{children:"Priority"}),(0,b.jsx)("div",{className:"flex gap-2",children:["normal","high","urgent"].map(a=>(0,b.jsx)(aa.Button,{type:"button",variant:y===a?"default":"outline",size:"sm",onClick:()=>z(a),className:(0,ad.cn)("flex-1 capitalize",y===a&&"urgent"===a&&"bg-red-600 hover:bg-red-700",y===a&&"high"===a&&"bg-orange-500 hover:bg-orange-600"),children:a},a))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(aJ.Label,{htmlFor:"transfer-notes",children:["Notes for recipient"," ",(0,b.jsx)("span",{className:"text-muted-foreground font-normal",children:"(optional)"})]}),(0,b.jsx)(aM.Textarea,{id:"transfer-notes",placeholder:"Add context about this transfer...",value:w,onChange:a=>x(a.target.value),className:"resize-none",rows:3})]})]}),(0,b.jsxs)(aH.DialogFooter,{children:[(0,b.jsx)(aa.Button,{variant:"outline",onClick:()=>{d(!1),K()},children:"Cancel"}),(0,b.jsx)(aa.Button,{onClick:H,disabled:!u||i,children:i?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Transferring..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aD.ArrowRight,{className:"h-4 w-4 mr-2"}),"Transfer"]})})]})]})})}var aO=a.i(556790),aO=aO,al=al;a.i(245561);var aP=a.i(453607);function aQ(a){if(!a)return"0:00";let b=Math.floor(a/60);return`${b}:${(a%60).toString().padStart(2,"0")}`}function aR(a){return new Date(a).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function aS({communication:a,isRead:c=!1,transcriptionConfidence:e,isUrgent:f=!1,onMarkAsRead:g,onSendText:h,onCallBack:i,onTransfer:k,onDelete:l}){var m;let n,q,r,s,u,[v,w]=(0,I.useState)(c),x=a.fromAddress,y=a.fromName||(a.customer?.firstName?`${a.customer.firstName} ${a.customer.lastName||""}`.trim():null);return(0,b.jsx)(aw.ScrollArea,{className:"h-full",children:(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-orange-500/10",children:(0,b.jsx)(E.Voicemail,{className:"h-6 w-6 text-orange-500"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"Voicemail"}),f&&(0,b.jsxs)(_.Badge,{variant:"destructive",className:"gap-1",children:[(0,b.jsx)(d.AlertCircle,{className:"h-3 w-3"}),"Urgent"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-muted-foreground",children:[(0,b.jsx)(j.Clock,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"text-sm",children:(n=new Date(m=a.createdAt),r=Math.floor((q=new Date().getTime()-n.getTime())/6e4),s=Math.floor(q/36e5),u=Math.floor(q/864e5),r<1?"Just now":r<60?`${r}m ago`:s<24?`${s}h ago`:u<7?`${u}d ago`:aR(m))})]})]})]}),(0,b.jsx)(aa.Button,{variant:"ghost",size:"sm",onClick:()=>{let b=!v;w(b),g?.(a.id,b)},className:"gap-2",children:v?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aO.default,{className:"h-4 w-4"}),"Mark Unread"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(o.Mail,{className:"h-4 w-4"}),"Mark Read"]})})]}),(0,b.jsx)(ac.Separator,{}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wide",children:"From"}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-muted",children:(0,b.jsx)(C.User,{className:"h-5 w-5 text-muted-foreground"})}),(0,b.jsx)("div",{className:"flex-1",children:y?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"font-medium",children:y}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:x})]}):(0,b.jsx)("div",{className:"font-medium",children:x||"Unknown Caller"})}),a.customerId&&(0,b.jsxs)(G.default,{href:`/dashboard/customers/${a.customerId}`,className:"text-sm text-primary hover:underline flex items-center gap-1",children:["View Profile",(0,b.jsx)(ak.ExternalLink,{className:"h-3 w-3"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("h3",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wide",children:["Message (",aQ(a.callDuration),")"]}),a.callRecordingUrl?(0,b.jsx)(au,{src:a.callRecordingUrl,title:"Voicemail Message"}):(0,b.jsxs)("div",{className:"rounded-lg border border-dashed bg-muted/50 p-6 text-center",children:[(0,b.jsx)(E.Voicemail,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No audio available"})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wide",children:"Transcription"}),void 0!==e&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Confidence: ",Math.round(100*e),"%"]}),(0,b.jsx)(aP.Progress,{value:100*e,className:"w-16 h-1.5"})]})]}),a.callTranscript?(0,b.jsx)("div",{className:"rounded-lg border bg-card p-4",children:(0,b.jsx)("p",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:a.callTranscript})}):(0,b.jsxs)("div",{className:"rounded-lg border border-dashed bg-muted/50 p-4 text-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Transcription not available"}),a.callRecordingUrl&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Transcription may still be processing..."})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wide",children:"Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.Clock,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Duration"}),(0,b.jsx)("div",{className:"font-medium",children:aQ(a.callDuration)})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(ah.Calendar,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Received"}),(0,b.jsx)("div",{className:"font-medium",children:aR(a.createdAt)})]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wide",children:"Actions"}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[x&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(aa.Button,{variant:"default",size:"sm",onClick:()=>i?.(x),children:[(0,b.jsx)(t.Phone,{className:"h-4 w-4 mr-2"}),"Call Back"]}),(0,b.jsxs)(aa.Button,{variant:"outline",size:"sm",onClick:()=>h?.(x),children:[(0,b.jsx)(p.MessageSquare,{className:"h-4 w-4 mr-2"}),"Send Text"]})]}),(0,b.jsxs)(aa.Button,{variant:"outline",size:"sm",onClick:()=>k?.(a.id),children:[(0,b.jsx)(al.default,{className:"h-4 w-4 mr-2"}),"Transfer"]})]})]}),(0,b.jsx)("div",{className:"pt-2",children:(0,b.jsx)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:v?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(W.Check,{className:"h-3 w-3 text-green-500"}),"Marked as read"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"h-2 w-2 rounded-full bg-blue-500"}),"Unread"]})})})]})})}a.i(799390);var aT=a.i(985943),aU=a.i(127487);a.i(928414);var aV=a.i(745250);function aW(a,b){let c=b||("inbound"===a.direction?"from":"to");if(a.customer){let b=a.customer.firstName?`${a.customer.firstName} ${a.customer.lastName||""}`.trim():null;if(b)return b}return"from"===c&&a.fromName?a.fromName:"to"===c&&a.toName?a.toName:("from"===c?a.fromAddress:a.toAddress)||("from"===c?"Unknown sender":"Unknown recipient")}function aX({initialCommunications:W,initialCounts:X,companyId:Y,teamMemberId:Z,selectedId:$,activeType:ab,activeFolder:af,activeCategory:ag}){let ah=(0,H.useRouter)(),ai=(0,H.useSearchParams)(),{toggleSidebar:aj}=(0,aU.useSidebar)(),[ak,al]=(0,I.useTransition)(),am=ai?.get("id")||$,[an,ao]=(0,I.useState)(W),[ap,aq]=(0,I.useState)(!1),[as,at]=(0,I.useState)(null),[au,av]=(0,I.useState)(()=>$&&W&&W.find(a=>a.id===$)||null),[ax,aD]=(0,I.useState)(""),[aE,aF]=(0,I.useState)(""),[aH,aJ]=(0,I.useState)(ab||"all"),[aK,aL]=(0,I.useState)(!1),[aO,aP]=(0,I.useState)(""),[aQ,aR]=(0,I.useState)(!1),[aX,aY]=(0,I.useState)(!1),[aZ,a$]=(0,I.useState)(null),[a_,a0]=(0,I.useState)(null),[a1,a2]=(0,I.useState)(!1),[a3,a4]=(0,I.useState)(!1),[a5,a6]=(0,I.useState)([]),[a7,a8]=(0,I.useState)(!1),[a9,ba]=(0,I.useState)(""),[bb,bc]=(0,I.useState)(!1),[bd,be]=(0,I.useState)([]),[bf,bg]=(0,I.useState)(null),[bh,bi]=(0,I.useState)(new Set),[bj,bk]=(0,I.useState)(!1),bl=(0,I.useRef)(null),bm=(0,I.useRef)(au),bn=(0,I.useRef)(ap);bn.current=ap;let bo=(0,I.useRef)(null);(0,I.useEffect)(()=>{if(ai?.get("compose")==="true"&&!aX){aY(!0),av(null),a0(null),bm.current=null;let a=new URLSearchParams(ai?.toString()||"");a.delete("compose");let b=a.toString()?`/dashboard/communication?${a.toString()}`:"/dashboard/communication";ah.replace(b)}},[ai,ah,aX]),(0,I.useEffect)(()=>{let a=a=>{let b=a.target;"INPUT"!==b.tagName&&"TEXTAREA"!==b.tagName&&!b.isContentEditable&&("c"!==a.key||a.metaKey||a.ctrlKey||a.altKey||aX||(a.preventDefault(),window.dispatchEvent(new CustomEvent("open-unified-compose"))))};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[aX]),(0,I.useEffect)(()=>{(0,R.getCompanyContextAction)().then(a=>{a.success&&a.context&&bg(a.context)})},[]),(0,I.useEffect)(()=>{if(am&&an){let a=an.find(a=>a.id===am);if(a&&(av(a),aP(a.internalNotes||""),bm.current=a,"email"===a.type&&(a.body?a0({html:null,text:a.body||null}):(a2(!0),(0,M.fetchEmailContentAction)(a.id).then(a=>{a.success&&a0({html:a.html||null,text:a.text||null})}).finally(()=>a2(!1)))),"sms"===a.type)){let b="inbound"===a.direction?a.fromAddress:a.toAddress;b&&bq(b)}}else av(null),bm.current=null,a0(null),a6([])},[am,an]),(0,I.useEffect)(()=>(bl.current&&clearTimeout(bl.current),bl.current=setTimeout(()=>{aD(aE)},300),()=>{bl.current&&clearTimeout(bl.current)}),[aE]);let bp=(0,I.useCallback)(async(b=!1)=>{aq(!0),at(null),al(async()=>{try{let{getCommunicationsAction:b}=await a.A(457901),c=await b({teamMemberId:Z,companyId:Y,type:"all"!==aH?aH:void 0,limit:100,offset:0});if(c.success&&c.data){ao(c.data);let a=bm.current;if(a){let b=c.data.find(b=>b.id===a.id);b&&(av(b),bm.current=b)}}}catch(b){console.error("Failed to fetch communications:",b);let a=b instanceof Error?b.message:"Failed to load communications";at(a),J.toast.error("Failed to load communications",{description:a})}finally{aq(!1)}})},[Z,Y,aH]),bq=(0,I.useCallback)(async a=>{if(a){a8(!0);try{let b=await (0,S.getSmsConversationAction)(a);b.success&&b.messages&&(a6(b.messages),b.messages.filter(a=>!a.read_at&&"inbound"===a.direction).length>0&&(a6(a=>a.map(a=>a.read_at||"inbound"!==a.direction?a:{...a,read_at:new Date().toISOString()})),(0,U.markSmsConversationAsReadAction)(a).then(a=>{a.success&&window.dispatchEvent(new CustomEvent("sms-read"))}).catch(()=>{})),setTimeout(()=>{bo.current&&(bo.current.scrollTop=bo.current.scrollHeight)},100))}catch(a){J.toast.error("Failed to load conversation")}finally{a8(!1)}}},[]);(0,I.useEffect)(()=>{let a=ab||"all";a!==aH&&aJ(a)},[ab]),(0,I.useEffect)(()=>{bp()},[aH]),(0,I.useEffect)(()=>{ax&&bp()},[ax]),(0,I.useEffect)(()=>{let a=setInterval(()=>{bn.current||aX||bp()},3e4),b=()=>{setTimeout(()=>bp(),1e3)};return window.addEventListener("email-received",b),window.addEventListener("email-sent",b),window.addEventListener("sms-read",b),window.addEventListener("communication-updated",b),()=>{clearInterval(a),window.removeEventListener("email-received",b),window.removeEventListener("email-sent",b),window.removeEventListener("sms-read",b),window.removeEventListener("communication-updated",b)}},[bp,aX]);let br=(0,I.useCallback)(a=>{av(a),aP(a.internalNotes||""),bm.current=a,a$(null),a6([]);let b=new URLSearchParams(ai?.toString()||"");if(b.set("id",a.id),ah.push(`/dashboard/communication?${b.toString()}`,{scroll:!1}),("unread"===a.status||"new"===a.status)&&("email"===a.type?(0,N.markEmailAsReadAction)({emailId:a.id}).catch(a=>{console.error("Failed to mark as read:",a)}):"sms"===a.type&&(0,T.markSmsAsReadAction)({smsId:a.id}).catch(a=>{console.error("Failed to mark as read:",a)}),ao(b=>b.map(b=>b.id===a.id?{...b,status:"read"}:b)),window.dispatchEvent(new CustomEvent("communication-updated"))),"email"===a.type&&(a.body?a0({html:null,text:a.body||null}):(a2(!0),(0,M.fetchEmailContentAction)(a.id).then(a=>{a.success&&a0({html:a.html||null,text:a.text||null})}).finally(()=>a2(!1)))),"sms"===a.type){let b="inbound"===a.direction?a.fromAddress:a.toAddress;b&&bq(b)}},[ah,ai,bq]),bs=(0,I.useCallback)(async()=>{if(au){aR(!0);try{let{saveInternalNotesAction:b}=await a.A(457901),c=await b({communicationId:au.id,notes:aO});c.success?(J.toast.success("Notes saved"),ao(a=>a.map(a=>a.id===au.id?{...a,internalNotes:aO,internalNotesUpdatedAt:new Date().toISOString(),internalNotesUpdatedBy:Z}:a)),aL(!1)):J.toast.error(c.error||"Failed to save notes")}catch(a){console.error("Failed to save notes:",a),J.toast.error("Failed to save notes")}finally{aR(!1)}}},[au,aO,Z]),bt=(0,I.useCallback)(async a=>{try{let b=await (0,K.archiveEmailAction)(a);b.success?(J.toast.success("Archived"),ao(b=>b.filter(b=>b.id!==a)),au?.id===a&&(av(null),a0(null)),window.dispatchEvent(new CustomEvent("email-archived"))):J.toast.error(b.error||"Failed to archive")}catch(a){console.error("Failed to archive:",a),J.toast.error("Failed to archive")}},[au]),bu=(0,I.useCallback)(async a=>{try{let b=await (0,Q.toggleStarCommunicationAction)(a);b.success?(J.toast.success("Updated"),bi(c=>{let d=new Set(c);return b.isStarred?d.add(a):d.delete(a),d})):J.toast.error(b.error||"Failed to update")}catch(a){console.error("Failed to star:",a),J.toast.error("Failed to update")}},[]),bv=(0,I.useCallback)(async a=>{try{(await (0,P.toggleSpamEmailAction)(a)).success?(J.toast.success("Updated spam status"),window.dispatchEvent(new CustomEvent("email-spam-toggled")),bp()):J.toast.error("Failed to update spam status")}catch{J.toast.error("Failed to update spam status")}},[bp]),bw=(0,I.useCallback)(async a=>{try{let b=await (0,L.bulkDeleteEmailsAction)([a]);b.success?(J.toast.success("Deleted"),ao(b=>b.filter(b=>b.id!==a)),au?.id===a&&(av(null),a0(null))):J.toast.error(b.error||"Failed to delete")}catch(a){console.error("Failed to delete:",a),J.toast.error("Failed to delete")}},[au]),bx=(0,I.useCallback)(async a=>{if(a){a4(!0);try{let b=await (0,O.retryFailedEmailAction)(a);b.success?(J.toast.success("Email sent successfully!"),bp()):J.toast.error("Failed to send email",{description:b.error||"Please try again later"})}catch(a){console.error("Failed to retry email:",a),J.toast.error("Failed to send email")}finally{a4(!1)}}},[bp]),by=(0,I.useCallback)(()=>{if(!au)return;let a=`
			<!DOCTYPE html>
			<html>
			<head>
				<title>${au.subject||"Email"}</title>
				<style>
					body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
					.header { border-bottom: 1px solid #e5e7eb; padding-bottom: 20px; margin-bottom: 20px; }
					.subject { font-size: 24px; font-weight: 600; margin-bottom: 12px; }
					.meta { color: #6b7280; font-size: 14px; }
					.meta-row { margin-bottom: 4px; }
					.body { line-height: 1.6; }
				</style>
			</head>
			<body>
				<div class="header">
					<div class="subject">${au.subject||"No Subject"}</div>
					<div class="meta">
						<div class="meta-row"><strong>From:</strong> ${au.fromAddress||"Unknown"}</div>
						<div class="meta-row"><strong>To:</strong> ${au.toAddress||"Unknown"}</div>
						<div class="meta-row"><strong>Date:</strong> ${new Date(au.createdAt).toLocaleString()}</div>
					</div>
				</div>
				<div class="body">
					${a_?.html||a_?.text||au.body||"No content"}
				</div>
			</body>
			</html>
		`,b=window.open("","_blank");b&&(b.document.write(a),b.document.close(),b.focus(),setTimeout(()=>b.print(),250))},[au,a_]),bz=(0,I.useCallback)(()=>{if(!au)return;let a=`----=_Part_${Date.now()}_${Math.random().toString(36).slice(2)}`,b=new Date(au.createdAt).toUTCString(),c=new Blob([`MIME-Version: 1.0
Date: ${b}
Subject: ${au.subject||"No Subject"}
From: ${au.fromAddress||"Unknown"}
To: ${au.toAddress||"Unknown"}
Content-Type: multipart/alternative; boundary="${a}"

--${a}
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 7bit

${a_?.text||au.body||"No content"}

--${a}
Content-Type: text/html; charset="UTF-8"
Content-Transfer-Encoding: 7bit

${a_?.html||`<p>${au.body||"No content"}</p>`}

--${a}--
`],{type:"message/rfc822"}),d=URL.createObjectURL(c),e=document.createElement("a");e.href=d;let f=(au.subject||"email").replace(/[^a-z0-9\s-]/gi,"_").replace(/\s+/g,"_").slice(0,50)||"email";e.download=`${f}.eml`,document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(d),J.toast.success("Email downloaded")},[au,a_]),bA=(0,I.useCallback)(a=>{be(b=>[...b,...a])},[]),bB=(0,I.useCallback)(async()=>{if(!a9.trim()&&0===bd.length||!au||bb)return;let b="inbound"===au.direction?au.fromAddress:au.toAddress;if(!b)return void J.toast.error("Cannot determine recipient phone number");bc(!0);try{if(bd.length>0){let{uploadSmsAttachments:c}=await a.A(928738),d=await c(bd);if(!d.success||!d.urls){J.toast.error(d.error||"Failed to upload attachments"),bc(!1);return}let{sendMMSMessage:e}=await a.A(317583),f=await e({to:b,from:"",text:a9.trim()||void 0,mediaUrls:d.urls,customerId:au.customerId||void 0});f.success?(ba(""),be([]),J.toast.success("Message with attachments sent"),bq(b),bp()):J.toast.error(f.error||"Failed to send message")}else{let a=await (0,V.sendTextMessage)({to:b,from:"",text:a9.trim(),customerId:au.customerId||void 0});a.success?(ba(""),J.toast.success("Message sent"),bq(b),bp()):J.toast.error(a.error||"Failed to send message")}}catch(a){J.toast.error("Failed to send message",{description:a instanceof Error?a.message:"Unknown error"})}finally{bc(!1)}},[a9,bd,au,bb,bq,bp]),bC=an.filter(a=>{if("all"!==aH&&a.type!==aH)return!1;if(ax){let b=ax.toLowerCase(),c=a.subject?.toLowerCase().includes(b),d=a.body?.toLowerCase().includes(b),e=a.fromAddress?.toLowerCase().includes(b),f=a.toAddress?.toLowerCase().includes(b),g=a.customer?.firstName?.toLowerCase().includes(b)||a.customer?.lastName?.toLowerCase().includes(b);return c||d||e||f||g}return!0}),bD=!au&&!aX,bE=au||aX;return(0,b.jsxs)("div",{className:"flex h-full w-full flex-col overflow-hidden bg-sidebar",children:[(0,b.jsxs)("div",{className:"flex flex-1 overflow-hidden min-h-0 md:gap-2",children:[(0,b.jsx)("div",{className:(0,ad.cn)("bg-card mb-1 shadow-sm flex flex-col overflow-hidden","w-full h-full","md:w-[400px] lg:w-[480px] md:rounded-tr-2xl",bD?"flex":"hidden md:flex"),children:(0,b.jsxs)("div",{className:"w-full h-full flex flex-col",children:[(0,b.jsx)("div",{className:"sticky top-0 z-15 flex flex-col gap-2 p-2 pb-0 transition-colors bg-card",children:(0,b.jsx)("div",{className:"grid grid-cols-12 gap-2 mt-1",children:(0,b.jsxs)("div",{className:"col-span-12 flex gap-2",children:[(0,b.jsx)(aa.Button,{variant:"ghost",size:"sm",onClick:aj,className:"h-10 w-10 p-0 md:h-8 md:w-8 shrink-0",title:"Toggle sidebar",children:(0,b.jsx)(r.PanelLeft,{className:"h-5 w-5 md:h-4 md:w-4 text-muted-foreground"})}),(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(aI.Input,{type:"search",placeholder:"Search communications...",value:aE,onChange:a=>aF(a.target.value),className:"h-10 md:h-8 pl-9 pr-20 text-base md:text-sm border-input bg-white dark:bg-[#141414] dark:border-none"}),(0,b.jsx)("svg",{width:"10",height:"10",viewBox:"0 0 10 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"absolute left-3 top-1/2 -translate-y-1/2 fill-[#71717A] dark:fill-[#6F6F6F]",children:(0,b.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.81038 7.0756C6.18079 7.54011 5.40248 7.81466 4.56004 7.81466C2.46451 7.81466 0.765747 6.11589 0.765747 4.02037C0.765747 1.92484 2.46451 0.226074 4.56004 0.226074C6.65557 0.226074 8.35433 1.92484 8.35433 4.02037C8.35433 4.8628 8.07978 5.64112 7.61527 6.27071L9.70535 8.36078C9.92761 8.58305 9.92761 8.94341 9.70535 9.16568C9.48308 9.38794 9.12272 9.38794 8.90046 9.16568L6.81038 7.0756ZM7.21604 4.02037C7.21604 5.48724 6.02691 6.67637 4.56004 6.67637C3.09317 6.67637 1.90403 5.48724 1.90403 4.02037C1.90403 2.5535 3.09317 1.36436 4.56004 1.36436C6.02691 1.36436 7.21604 2.5535 7.21604 4.02037Z"})}),aE&&(0,b.jsx)("button",{onClick:()=>aF(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:(0,b.jsx)(F.X,{className:"h-3 w-3"})})]}),(0,b.jsx)(aa.Button,{variant:"ghost",size:"sm",onClick:()=>bp(!0),disabled:ap,className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"Refresh",children:(0,b.jsx)(w.RefreshCw,{className:`h-5 w-5 md:h-4 md:w-4 text-muted-foreground ${ap?"animate-spin":""}`})})]})})}),(0,b.jsx)("div",{className:(0,ad.cn)("bg-[#006FFE] relative z-5 h-0.5 w-full transition-opacity",ap?"opacity-100 animate-pulse":"opacity-0")}),(0,b.jsx)("div",{className:"relative z-1 flex-1 overflow-hidden pt-0 min-h-0",children:(0,b.jsx)("div",{className:"hide-link-indicator flex h-full w-full",children:(0,b.jsx)("div",{className:"flex flex-1 flex-col",children:(0,b.jsx)(aw.ScrollArea,{className:"scrollbar-none flex-1 overflow-x-hidden h-full",children:as&&(!an||0===an.length)?(0,b.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(e.AlertTriangle,{className:"h-8 w-8 text-destructive mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-sm text-destructive mb-2 font-medium",children:"Failed to load communications"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-4",children:as}),(0,b.jsx)(aa.Button,{variant:"outline",size:"sm",onClick:()=>bp(),children:"Try Again"})]})}):bC.length?(0,b.jsx)("div",{className:"min-h-[200px] px-2",children:bC.map(a=>{let c=au?.id===a.id,d="unread"===a.status||"new"===a.status,g=(a=>{switch(a){case"email":return{icon:o.Mail,color:"text-blue-500",bg:"bg-blue-500/10"};case"sms":return{icon:p.MessageSquare,color:"text-green-500",bg:"bg-green-500/10"};case"call":return{icon:t.Phone,color:"text-purple-500",bg:"bg-purple-500/10"};case"voicemail":return{icon:E.Voicemail,color:"text-orange-500",bg:"bg-orange-500/10"};default:return{icon:o.Mail,color:"text-gray-500",bg:"bg-gray-500/10"}}})(a.type),i=g.icon;return(0,b.jsx)("div",{className:"select-none md:my-1",children:(0,b.jsxs)("div",{className:(0,ad.cn)("hover:bg-accent group flex cursor-pointer flex-col items-start rounded-lg py-2 text-left text-sm transition-all hover:opacity-100 relative",c?"bg-accent opacity-100":"",d?"opacity-100":"opacity-60"),onClick:()=>br(a),children:[(0,b.jsxs)("div",{className:"dark:bg-panelDark absolute right-2 z-25 flex -translate-y-1/2 items-center gap-1 rounded-xl border bg-white p-1 opacity-0 shadow-sm group-hover:opacity-100 top-[-1] transition-opacity duration-200",onClick:a=>a.stopPropagation(),children:[(0,b.jsx)(aa.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 overflow-visible p-0 hover:bg-accent group/star",onClick:b=>{b.stopPropagation(),bu(a.id)},title:"Star",children:(0,b.jsx)(z.Star,{className:(0,ad.cn)("h-4 w-4 transition-colors group-hover/star:text-yellow-500",bh.has(a.id)?"fill-yellow-500 text-yellow-500":"text-muted-foreground")})}),(0,b.jsx)(aa.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:bg-accent group/archive",onClick:b=>{b.stopPropagation(),bt(a.id)},title:"Archive",children:(0,b.jsx)(f.Archive,{className:"h-4 w-4 text-muted-foreground transition-colors group-hover/archive:text-blue-500"})})]}),(0,b.jsxs)("div",{className:"relative flex w-full items-center justify-between gap-4 px-2",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(aG.Avatar,{className:"h-8 w-8 shrink-0 rounded-full border",children:(0,b.jsx)(aG.AvatarFallback,{className:"bg-white dark:bg-[#373737] text-[#9F9F9D] font-bold text-xs",children:aW(a)[0]?.toUpperCase()||"?"})}),(0,b.jsx)("div",{className:(0,ad.cn)("absolute -bottom-1 -right-1 rounded-full p-0.5 border border-white dark:border-[#1C1C1C]",g.bg),children:(0,b.jsx)(i,{className:(0,ad.cn)("h-2.5 w-2.5",g.color)})})]}),(0,b.jsx)("div",{className:"flex w-full justify-between",children:(0,b.jsxs)("div",{className:"w-full",children:[(0,b.jsxs)("div",{className:"flex w-full flex-row items-center justify-between",children:[(0,b.jsx)("div",{className:"flex flex-row items-center gap-[4px]",children:(0,b.jsx)("span",{className:"font-bold text-md flex items-baseline gap-1 group-hover:opacity-100",children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("span",{className:"line-clamp-1 overflow-hidden text-sm",children:aW(a)}),d&&(0,b.jsx)("span",{className:"ml-0.5 size-2 rounded-full bg-[#006FFE]"})]})})}),(0,b.jsx)("p",{className:"text-muted-foreground text-nowrap text-xs font-normal opacity-70 transition-opacity group-hover:opacity-100 dark:text-[#8C8C8C]",children:a.createdAt?new Date(a.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center gap-2",children:[(0,b.jsx)("p",{className:"mt-1 line-clamp-1 min-w-0 overflow-hidden text-sm text-[#8C8C8C] flex-1",children:a.subject||a.body||"No content"}),(0,b.jsxs)("div",{className:"flex items-center gap-1 shrink-0",children:[a.customerId&&(0,b.jsx)(G.default,{href:`/dashboard/customers/${a.customerId}`,onClick:a=>a.stopPropagation(),className:"px-1.5 py-0.5 rounded text-[10px] bg-primary/10 text-primary hover:bg-primary/20 transition-colors flex items-center gap-0.5",title:"View customer profile",children:(0,b.jsx)(C.User,{className:"h-2.5 w-2.5"})}),a.jobId&&(0,b.jsx)("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-purple-500/10 text-purple-600 flex items-center gap-0.5",children:(0,b.jsx)(h.Briefcase,{className:"h-2.5 w-2.5"})}),a.internalNotes&&(0,b.jsx)("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-muted text-muted-foreground flex items-center gap-0.5",children:(0,b.jsx)(A.StickyNote,{className:"h-2.5 w-2.5"})}),"failed"===a.status&&(0,b.jsx)("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-destructive/10 text-destructive flex items-center gap-0.5",children:(0,b.jsx)(e.AlertTriangle,{className:"h-2.5 w-2.5"})})]})]})]})})]})]})},a.id)})}):(0,b.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No communications found"}),ax&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Try adjusting your search"})]})})})})})})]})}),aX?(0,b.jsx)("div",{className:(0,ad.cn)("bg-card mb-1 shadow-sm flex flex-col min-w-0 overflow-hidden","w-full h-full","md:rounded-tl-2xl md:flex-1",bE?"flex":"hidden md:flex"),children:(0,b.jsx)(aA.EmailFullComposer,{companyId:Y,onClose:()=>aY(!1),onSent:()=>{aY(!1),bp()},className:"h-full"})}):au?(0,b.jsx)("div",{className:(0,ad.cn)("bg-card mb-1 shadow-sm flex flex-col min-w-0 overflow-hidden","w-full h-full","md:rounded-tl-2xl md:flex-1",bE?"flex":"hidden md:flex"),children:(0,b.jsx)("div",{className:"relative flex-1 min-h-0 flex flex-col",children:(0,b.jsxs)("div",{className:"bg-card relative flex flex-col overflow-hidden transition-all duration-300 h-full flex-1 min-h-0",children:[(0,b.jsxs)("div",{className:"sticky top-0 z-15 flex shrink-0 items-center justify-between gap-1.5 p-2 pb-0 transition-colors bg-card",children:[(0,b.jsxs)("div",{className:"flex flex-1 items-center gap-2",children:[(0,b.jsxs)(aa.Button,{variant:"ghost",size:"sm",onClick:()=>{av(null),bm.current=null,a0(null),a6([]),a$(null),ah.push("/dashboard/communication",{scroll:!1})},className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"Back to list",children:[(0,b.jsx)(g.ArrowLeft,{className:"h-5 w-5 md:hidden text-muted-foreground"}),(0,b.jsx)(F.X,{className:"h-4 w-4 hidden md:block text-muted-foreground"})]}),(0,b.jsx)(ac.Separator,{orientation:"vertical",className:"h-4 bg-border/60 hidden md:block"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:["email"===au.type&&(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(aa.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-auto md:px-2",onClick:()=>a$("reply-all"),title:"Reply all",children:[(0,b.jsx)(y.ReplyAll,{className:"h-5 w-5 md:h-4 md:w-4 md:mr-1.5 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm leading-none font-medium hidden md:inline",children:"Reply all"})]})}),(0,b.jsxs)(aT.Sheet,{open:aK,onOpenChange:aL,children:[(0,b.jsx)(aT.SheetTrigger,{asChild:!0,children:(0,b.jsx)(aa.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8 hidden md:flex",title:"Internal notes",children:(0,b.jsx)(A.StickyNote,{className:"h-4 w-4 text-muted-foreground"})})}),(0,b.jsxs)(aT.SheetContent,{children:[(0,b.jsxs)(aT.SheetHeader,{children:[(0,b.jsx)(aT.SheetTitle,{children:"Internal Notes"}),(0,b.jsx)(aT.SheetDescription,{children:"Private team notes - not visible to customer"})]}),(0,b.jsxs)("div",{className:"py-4",children:[(0,b.jsx)(aM.Textarea,{placeholder:"Add your notes here...",value:aO,onChange:a=>aP(a.target.value),className:"min-h-[200px] resize-none"}),au.internalNotesUpdatedAt&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Last updated"," ",(0,c.formatDistanceToNow)(new Date(au.internalNotesUpdatedAt),{addSuffix:!0})]}),(0,b.jsxs)("div",{className:"mt-4 flex justify-end gap-2",children:[(0,b.jsx)(aa.Button,{variant:"outline",size:"sm",onClick:()=>aL(!1),children:"Cancel"}),(0,b.jsx)(aa.Button,{size:"sm",onClick:bs,disabled:aQ,children:aQ?"Saving...":"Save Notes"})]})]})]})]}),(0,b.jsx)(aa.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8 group/star",title:"Star",onClick:()=>bu(au.id),children:(0,b.jsx)(z.Star,{className:(0,ad.cn)("h-5 w-5 md:h-4 md:w-4 transition-colors group-hover/star:text-yellow-500",bh.has(au.id)?"fill-yellow-500 text-yellow-500":"text-muted-foreground")})}),"email"===au.type&&(0,b.jsx)(aa.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8 hidden md:flex group/spam",title:"Toggle spam",onClick:()=>bv(au.id),children:(0,b.jsx)(l.Flag,{className:"h-4 w-4 text-muted-foreground transition-colors group-hover/spam:text-orange-500"})}),(0,b.jsx)(aa.Button,{variant:"destructive",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"Archive",onClick:()=>bt(au.id),children:(0,b.jsx)(f.Archive,{className:"h-5 w-5 md:h-4 md:w-4"})}),(0,b.jsxs)(ar.DropdownMenu,{children:[(0,b.jsx)(ar.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(aa.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"More",children:(0,b.jsx)(q.MoreHorizontal,{className:"h-5 w-5 md:h-4 md:w-4 text-muted-foreground"})})}),(0,b.jsxs)(ar.DropdownMenuContent,{align:"end",className:"w-48",children:["email"===au.type&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(ar.DropdownMenuItem,{onClick:()=>bv(au.id),className:"md:hidden",children:[(0,b.jsx)(l.Flag,{className:"h-4 w-4 mr-2"}),"Toggle spam"]}),(0,b.jsxs)(ar.DropdownMenuItem,{onClick:by,children:[(0,b.jsx)(v.Printer,{className:"h-4 w-4 mr-2"}),"Print"]}),(0,b.jsxs)(ar.DropdownMenuItem,{onClick:bz,children:[(0,b.jsx)(k.Download,{className:"h-4 w-4 mr-2"}),"Download as .eml"]}),(0,b.jsx)(ar.DropdownMenuSeparator,{})]}),(0,b.jsxs)(ar.DropdownMenuItem,{onClick:()=>aL(!0),className:"md:hidden",children:[(0,b.jsx)(A.StickyNote,{className:"h-4 w-4 mr-2"}),"Notes"]}),(0,b.jsxs)(ar.DropdownMenuItem,{onClick:()=>bk(!0),children:[(0,b.jsx)(D.UserPlus,{className:"h-4 w-4 mr-2"}),"Assign to Team Member"]}),(0,b.jsx)(ar.DropdownMenuSeparator,{}),(0,b.jsxs)(ar.DropdownMenuItem,{onClick:()=>bw(au.id),className:"text-destructive focus:text-destructive",children:[(0,b.jsx)(B.Trash2,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]}),(0,b.jsx)("div",{className:"flex min-h-0 flex-1 flex-col overflow-hidden",children:(0,b.jsx)("div",{className:"relative overflow-hidden flex-1 h-full min-h-0 flex flex-col",children:(0,b.jsxs)(aV.TooltipProvider,{delayDuration:100,children:[(0,b.jsxs)("div",{className:"border-b border-border/50 px-2 py-4 space-y-3",children:[(0,b.jsx)("h1",{className:"text-base font-semibold text-foreground",children:au.subject||("sms"===au.type?"Text Message":"No Subject")}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(aG.Avatar,{className:"h-9 w-9 shrink-0 rounded-md cursor-pointer",children:(0,b.jsx)(aG.AvatarFallback,{className:"bg-muted text-muted-foreground font-semibold text-sm rounded-md",children:aW(au)[0]?.toUpperCase()||"?"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"font-semibold text-sm text-foreground",children:aW(au)}),("unread"===au.status||"new"===au.status)&&(0,b.jsx)("div",{className:"h-2 w-2 rounded-full bg-primary"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,b.jsx)("span",{children:"inbound"===au.direction?au.fromAddress||"unknown":au.toAddress||"unknown"}),au.customerId&&(0,b.jsxs)(_.Badge,{variant:"outline",className:"gap-1",children:[(0,b.jsx)(C.User,{className:"h-2.5 w-2.5"}),"Customer"]}),au.assignedTo&&(0,b.jsxs)(_.Badge,{variant:"outline",className:"gap-1 cursor-pointer hover:bg-accent",onClick:()=>bk(!0),children:[(0,b.jsx)(D.UserPlus,{className:"h-2.5 w-2.5"}),au.assignedTeamMember?`${au.assignedTeamMember.firstName} ${au.assignedTeamMember.lastName}`.trim():"Assigned"]})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:new Date(au.createdAt).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})})})]}),"email"===au.type&&"outbound"===au.direction&&(0,b.jsx)("div",{className:"flex flex-col gap-2 pt-2",children:(0,b.jsx)("div",{className:"flex items-center gap-1 flex-wrap",children:(0,b.jsxs)("div",{className:(0,ad.cn)("flex items-center gap-1.5 px-2 py-1 rounded-full text-xs","sent"===au.status||"delivered"===au.status?"bg-green-500/10 text-green-600":"failed"===au.status?"bg-red-500/10 text-red-600":"bg-muted text-muted-foreground"),children:["sent"===au.status||"delivered"===au.status?(0,b.jsx)(i.CheckCheck,{className:"h-3 w-3"}):"failed"===au.status?(0,b.jsx)(d.AlertCircle,{className:"h-3 w-3"}):(0,b.jsx)(j.Clock,{className:"h-3 w-3"}),(0,b.jsx)("span",{className:"capitalize",children:au.status})]})})})]}),(0,b.jsx)("div",{className:"px-2 py-2",children:(0,b.jsx)(ae,{communication:au,companyId:Y,onLinked:()=>{bp()}})}),"email"===au.type?(0,b.jsxs)("div",{className:"flex-1 overflow-hidden flex flex-col min-h-0",children:[(0,b.jsx)("div",{className:"flex-1 overflow-y-auto px-2 py-4",children:a1?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(n.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading email content..."})]})}):(0,b.jsx)(az.EmailContent,{html:a_?.html||null,text:a_?.text||au.body||null,attachments:null})}),(0,b.jsx)("div",{className:"px-2 py-4 pb-safe",children:aZ?(0,b.jsx)(aB.EmailReplyComposer,{mode:aZ,selectedEmail:{id:au.id,from_address:au.fromAddress||"",from_name:null,to_address:au.toAddress||"",subject:au.subject||"",body:a_?.text||au.body||"",body_html:a_?.html||null},companyId:Y,onClose:()=>a$(null),onSent:()=>{a$(null),bp()}}):"failed"===au.status?(0,b.jsx)("div",{className:"flex items-center gap-2 flex-wrap",children:(0,b.jsx)(aa.Button,{variant:"default",size:"sm",className:"h-11 px-4 flex-1 md:flex-none md:h-9",onClick:()=>bx(au.id),disabled:a3,children:a3?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.Loader2,{className:"h-5 w-5 md:h-4 md:w-4 mr-2 animate-spin"}),"Sending..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.RefreshCw,{className:"h-5 w-5 md:h-4 md:w-4 mr-2"}),"Retry Send"]})})}):(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsxs)(aa.Button,{variant:"default",size:"sm",className:"h-11 px-4 flex-1 md:flex-none md:h-9",onClick:()=>a$("reply"),children:[(0,b.jsx)(x.Reply,{className:"h-5 w-5 md:h-4 md:w-4 mr-2"}),"Reply"]}),(0,b.jsxs)(aa.Button,{variant:"outline",size:"sm",className:"h-11 px-3 flex-1 md:flex-none md:h-9 md:px-4",onClick:()=>a$("reply-all"),children:[(0,b.jsx)(y.ReplyAll,{className:"h-5 w-5 md:h-4 md:w-4 mr-2"}),(0,b.jsx)("span",{className:"hidden xs:inline",children:"Reply All"}),(0,b.jsx)("span",{className:"xs:hidden",children:"All"})]}),(0,b.jsxs)(aa.Button,{variant:"outline",size:"sm",className:"h-11 px-3 flex-1 md:flex-none md:h-9 md:px-4",onClick:()=>a$("forward"),children:[(0,b.jsx)(m.Forward,{className:"h-5 w-5 md:h-4 md:w-4 mr-2"}),"Forward"]})]})})]}):"sms"===au.type?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{ref:bo,className:"flex-1 overflow-y-auto bg-card px-4 py-4",children:a7?(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsx)(n.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):0===a5.length?(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(p.MessageSquare,{className:"h-12 w-12 text-muted-foreground opacity-50 mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No messages yet"})]})}):(0,b.jsx)("div",{className:"space-y-2",children:a5.map((a,c)=>{let d,e,f="outbound"===a.direction,g=0===c||new Date(a.created_at).getTime()-new Date(a5[c-1].created_at).getTime()>3e5;return(0,b.jsxs)("div",{className:"flex flex-col",children:[g&&(0,b.jsx)("div",{className:"flex justify-center my-2",children:(0,b.jsx)("span",{className:"text-xs text-muted-foreground bg-muted/50 px-2 py-1 rounded-full",children:(d=new Date(a.created_at),e=new Date,d.toDateString()===e.toDateString()?d.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):d.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}))})}),(0,b.jsxs)("div",{className:(0,ad.cn)("flex flex-col",f?"items-end":"items-start"),children:[(0,b.jsxs)("div",{className:(0,ad.cn)("max-w-[75%] rounded-2xl px-4 py-2 shadow-sm",f?"bg-primary text-primary-foreground rounded-tr-sm":"bg-muted text-foreground rounded-tl-sm"),children:[a.provider_metadata&&"object"==typeof a.provider_metadata&&"attachments"in a.provider_metadata&&Array.isArray(a.provider_metadata.attachments)&&a.provider_metadata.attachments.length>0&&(0,b.jsx)("div",{className:"mb-2 space-y-2",children:a.provider_metadata.attachments.map((a,c)=>{let d="image"===a.type||a.url&&/\.(jpg|jpeg|png|gif|webp)$/i.test(a.url);return(0,b.jsx)("div",{className:"rounded-lg overflow-hidden",children:d?(0,b.jsx)("img",{src:a.url,alt:a.filename||"Image",className:"max-w-full max-h-64 object-contain rounded-lg",loading:"lazy"}):(0,b.jsxs)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:(0,ad.cn)("flex items-center gap-2 p-2 rounded-lg hover:opacity-80 transition-opacity",f?"bg-primary-foreground/20":"bg-background/20"),children:[(0,b.jsx)(s.Paperclip,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"text-xs truncate",children:a.filename||"Attachment"})]})},c)})}),a.body&&(0,b.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:a.body}),!a.body&&(!a.provider_metadata||"object"!=typeof a.provider_metadata||!("attachments"in a.provider_metadata)||!Array.isArray(a.provider_metadata.attachments)||0===a.provider_metadata.attachments.length)&&(0,b.jsx)("p",{className:"text-sm opacity-70 italic",children:"No message content"})]}),(0,b.jsx)("span",{className:(0,ad.cn)("text-xs text-muted-foreground mt-0.5",f?"text-right":"text-left"),children:new Date(a.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},a.id)})})}),(0,b.jsx)(aC.SmsMessageInput,{value:a9,onChange:ba,onSend:bB,onAttach:bA,sending:bb,disabled:!au,placeholder:"Text Message",customerId:au?.customerId||void 0,customerName:void 0,customerFirstName:void 0,companyName:bf?.companyName,companyPhone:bf?.companyPhone,enableAiSuggestions:!!au?.customerId})]}):"call"===au.type?(0,b.jsx)(ay,{communication:au,onSendText:a=>{let b=an.find(b=>"sms"===b.type&&(b.fromAddress===a||b.toAddress===a));b?br(b):J.toast.info(`Start new conversation with ${a}`)},onCallBack:a=>{window.open(`tel:${a}`,"_self")},onTransfer:()=>{bk(!0)}}):"voicemail"===au.type?(0,b.jsx)(aS,{communication:au,isRead:"read"===au.status,onMarkAsRead:(a,b)=>{ao(c=>c.map(c=>c.id===a?{...c,status:b?"read":"unread"}:c))},onSendText:a=>{let b=an.find(b=>"sms"===b.type&&(b.fromAddress===a||b.toAddress===a));b?br(b):J.toast.info(`Start new conversation with ${a}`)},onCallBack:a=>{window.open(`tel:${a}`,"_self")},onTransfer:()=>{bk(!0)}}):(0,b.jsx)(aw.ScrollArea,{className:"flex-1 px-2 py-4",children:(0,b.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,b.jsx)("p",{className:"whitespace-pre-wrap",children:au.body||"No content"})})})]})})})]})})}):(0,b.jsxs)("div",{className:(0,ad.cn)("bg-card mb-1 shadow-sm hidden md:flex md:flex-col md:items-center md:justify-center md:rounded-tl-2xl md:flex-1"),children:[(0,b.jsx)(o.Mail,{className:"h-16 w-16 text-muted-foreground mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"No communication selected"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Select a communication from the list to view details"}),(0,b.jsxs)(aa.Button,{onClick:()=>{window.dispatchEvent(new CustomEvent("open-unified-compose"))},className:"h-11 px-5",children:[(0,b.jsx)(u.Plus,{className:"h-4 w-4 mr-2"}),"New Message"]})]})]}),au&&(0,b.jsx)(aN,{open:bj,onOpenChange:bk,communication:au,companyId:Y,currentTeamMemberId:Z,onTransferComplete:()=>{bp()}})]})}a.s(["UnifiedInboxPageClient",()=>aX],546623)}];

//# sourceMappingURL=apps_web_src_components_communication_unified-inbox-page-client_tsx_249711d1._.js.map