module.exports=[558228,274647,976804,685078,a=>{"use strict";var b=a.i(903196);a.s(["Mic",()=>b.default],558228);var c=a.i(698417);a.s(["MicOff",()=>c.default],274647);var d=a.i(37395);function e(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]])}return c}function f(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})}a.s(["PhoneOff",()=>d.default],976804),"function"==typeof SuppressedError&&SuppressedError;for(var g="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),h=new Uint8Array(16),i=[],j=0;j<256;++j)i[j]=(j+256).toString(16).substr(1);function k(a,b,c){var d,e=b&&c||0;"string"==typeof a&&(b="binary"===a?Array(16):null,a=null);var f=(a=a||{}).random||(a.rng||function(){if(!g)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return g(h)})();if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,b)for(var j=0;j<16;++j)b[e+j]=f[j];return b||(d=0,""+i[f[d++]]+i[f[d++]]+i[f[d++]]+i[f[d++]]+"-"+i[f[d++]]+i[f[d++]]+"-"+i[f[d++]]+i[f[d++]]+"-"+i[f[d++]]+i[f[d++]]+"-"+i[f[d++]]+i[f[d++]]+i[f[d++]]+i[f[d++]]+i[f[d++]]+i[f[d++]])}let l="wss://rtc.telnyx.com",m={urls:"stun:stun.l.google.com:19302"},n={urls:"stun:stun.telnyx.com:3478"},o={urls:"turn:turn.telnyx.com:3478?transport=tcp",username:"testuser",credential:"testpassword"};(aG=aQ||(aQ={})).SocketOpen="telnyx.socket.open",aG.SocketClose="telnyx.socket.close",aG.SocketError="telnyx.socket.error",aG.SocketMessage="telnyx.socket.message",aG.SpeedTest="telnyx.internal.speedtest",aG.Ready="telnyx.ready",aG.Error="telnyx.error",aG.Notification="telnyx.notification",aG.StatsFrame="telnyx.stats.frame",aG.StatsReport="telnyx.stats.report",aG.Messages="telnyx.messages",aG.Calls="telnyx.calls",aG.MediaError="telnyx.rtc.mediaError",aG.PeerConnectionFailureError="telnyx.rtc.peerConnectionFailureError";var p="undefined"!=typeof globalThis?globalThis:a.g;function q(a,b){return a(b={exports:{}},b.exports),b.exports}let r=q(function(a){var b;b=function(){var a=function(){},b="undefined",c=["trace","debug","info","warn","error"];function d(a,b){var c=a[b];if("function"==typeof c.bind)return c.bind(a);try{return Function.prototype.bind.call(c,a)}catch(b){return function(){return Function.prototype.apply.apply(c,[a,arguments])}}}function e(b,d){for(var e=0;e<c.length;e++){var f=c[e];this[f]=e<b?a:this.methodFactory(f,b,d)}this.log=this.debug}function f(a,c,d){return function(){typeof console!==b&&(e.call(this,c,d),this[a].apply(this,arguments))}}function g(c,e,g){var h;return"debug"===(h=c)&&(h="log"),typeof console!==b&&(void 0!==console[h]?d(console,h):void 0!==console.log?d(console,"log"):a)||f.apply(this,arguments)}function h(a,d,f){var h,i=this;d=null==d?"WARN":d;function j(){}i.name=a,i.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},i.methodFactory=f||g,i.getLevel=function(){return h},i.setLevel=function(d,f){if("string"==typeof d&&void 0!==i.levels[d.toUpperCase()]&&(d=i.levels[d.toUpperCase()]),!("number"==typeof d&&d>=0&&d<=i.levels.SILENT))throw"log.setLevel() called with invalid level: "+d;if(h=d,!1!==f&&(c[d]||"silent").toUpperCase(),e.call(i,d,a),typeof console===b&&d<i.levels.SILENT)return"No console available for logging"},i.setDefaultLevel=function(a){d=a,j()||i.setLevel(a,!1)},i.resetLevel=function(){i.setLevel(d,!1)},i.enableAll=function(a){i.setLevel(i.levels.TRACE,a)},i.disableAll=function(a){i.setLevel(i.levels.SILENT,a)};var k=j();null==k&&(k=d),i.setLevel(k,!1)}var i=new h,j={};return i.getLogger=function(a){if("symbol"!=typeof a&&"string"!=typeof a||""===a)throw TypeError("You must supply a name when creating a logger.");var b=j[a];return b||(b=j[a]=new h(a,i.getLevel(),i.methodFactory)),b},i.noConflict=function(){return i},i.getLoggers=function(){return j},i.default=i,i},a.exports?a.exports=b():p.log=b()}).getLogger("telnyx"),s=r.methodFactory;r.methodFactory=(a,b,c)=>{let d=s(a,b,c);return function(){let a=[(new Date).toISOString().replace("T"," ").replace("Z",""),"-"];for(let b=0;b<arguments.length;b++)a.push(arguments[b]);d.apply(void 0,a)}},r.setLevel(r.getLevel());let t=a=>{let[b,c,d,e,f,g]=a,h={};try{h=JSON.parse(f.replace(/ID"/g,'Id"'))}catch(a){r.warn("Verto LA invalid media JSON string:",f)}return{participantId:Number(b),participantNumber:c,participantName:d,codec:e,media:h,participantData:g}},u=a=>{if("string"!=typeof a)return a;try{return JSON.parse(a)}catch(b){return a}},v=a=>a instanceof Function||"function"==typeof a,w=a=>"object"==typeof document&&"getElementById"in document?"string"==typeof a?document.getElementById(a)||null:"function"==typeof a?a():a instanceof HTMLMediaElement?a:null:null,x=/^(ws|wss):\/\//,y=(a,b=null)=>{let{result:c={},error:d}=a;if(d)return{error:d};let{result:e=null}=c;if(null===e)return null!==b&&(c.node_id=b),{result:c};let{code:f=null,node_id:g=null,result:h=null}=e;return f&&"200"!==f?{error:e}:h?y(h,g):{result:e}},z=(a,b)=>Math.floor(Math.random()*(b-a+1)+a),A=({login:a,passwd:b,password:c,login_token:d})=>!!(a&&(b||c)||d),B=({anonymous_login:a})=>!!a&&!!a.target_id&&!!a.target_type,C=a=>{var b,c,d,e,f,g;let h="",i="";return(null==(c=null==(b=null==a?void 0:a.result)?void 0:b.params)?void 0:c.state)&&(h=null==(e=null==(d=null==a?void 0:a.result)?void 0:d.params)?void 0:e.state),(null==(f=null==a?void 0:a.params)?void 0:f.state)&&(i=null==(g=null==a?void 0:a.params)?void 0:g.state),h||i};function D({debounceTime:a}){let b,c;return{promise:new Promise((d,e)=>{b=a?E(d,a):d,c=e}),resolve:b,reject:c}}let E=(a,b)=>{let c;return(...d)=>{clearTimeout(c),c=window.setTimeout(()=>{a(...d)},b)}},F="telnyx-voice-sdk-id";function G(){return sessionStorage.getItem(F)}(aH=aR||(aR={})).Offer="offer",aH.Answer="answer",(aI=aS||(aS={})).Inbound="inbound",aI.Outbound="outbound",(aJ=aT||(aT={})).Invite="telnyx_rtc.invite",aJ.Attach="telnyx_rtc.attach",aJ.Answer="telnyx_rtc.answer",aJ.Info="telnyx_rtc.info",aJ.Candidate="telnyx_rtc.candidate",aJ.EndOfCandidates="telnyx_rtc.endOfCandidates",aJ.Display="telnyx_rtc.display",aJ.Media="telnyx_rtc.media",aJ.Event="telnyx_rtc.event",aJ.Bye="telnyx_rtc.bye",aJ.Punt="telnyx_rtc.punt",aJ.Broadcast="telnyx_rtc.broadcast",aJ.Subscribe="telnyx_rtc.subscribe",aJ.Unsubscribe="telnyx_rtc.unsubscribe",aJ.ClientReady="telnyx_rtc.clientReady",aJ.Modify="telnyx_rtc.modify",aJ.Ringing="telnyx_rtc.ringing",aJ.GatewayState="telnyx_rtc.gatewayState",aJ.Ping="telnyx_rtc.ping",aJ.Pong="telnyx_rtc.pong";let H={generic:"event",[aT.Display]:"participantData",[aT.Attach]:"participantData",conferenceUpdate:"conferenceUpdate",callUpdate:"callUpdate",vertoClientReady:"vertoClientReady",userMediaError:"userMediaError",peerConnectionFailureError:"peerConnectionFailureError"},I={destinationNumber:"",remoteCallerName:"Outbound Call",remoteCallerNumber:"",callerName:"",callerNumber:"",audio:!0,useStereo:!1,debug:!1,debugOutput:"socket",attach:!1,screenShare:!1,userVariables:{},mediaSettings:{useSdpASBandwidthKbps:!1,sdpASBandwidthKbps:0}};(aK=aU||(aU={}))[aK.New=0]="New",aK[aK.Requesting=1]="Requesting",aK[aK.Trying=2]="Trying",aK[aK.Recovering=3]="Recovering",aK[aK.Ringing=4]="Ringing",aK[aK.Answering=5]="Answering",aK[aK.Early=6]="Early",aK[aK.Active=7]="Active",aK[aK.Held=8]="Held",aK[aK.Hangup=9]="Hangup",aK[aK.Destroy=10]="Destroy",aK[aK.Purge=11]="Purge",(aL=aV||(aV={})).Participant="participant",aL.Moderator="moderator",(aM=aW||(aW={})).Join="join",aM.Leave="leave",aM.Bootstrap="bootstrap",aM.Add="add",aM.Modify="modify",aM.Delete="delete",aM.Clear="clear",aM.ChatMessage="chatMessage",aM.LayerInfo="layerInfo",aM.LogoInfo="logoInfo",aM.LayoutInfo="layoutInfo",aM.LayoutList="layoutList",aM.ModCmdResponse="modCommandResponse",(aN=aX||(aX={})).Video="videoinput",aN.AudioIn="audioinput",aN.AudioOut="audiooutput",(aO=aY||(aY={})).REGED="REGED",aO.UNREGED="UNREGED",aO.NOREG="NOREG",aO.FAILED="FAILED",aO.FAIL_WAIT="FAIL_WAIT",aO.REGISTER="REGISTER",aO.TRYING="TRYING",aO.EXPIRED="EXPIRED",aO.UNREGISTER="UNREGISTER";let J="GLOBAL",K={},L=(a,b)=>`${a}|${b}`,M=(a,b,c=J)=>{let d=L(a,c);d in K||(K[d]=[]),K[d].push(b)},N=(a,b,c=J)=>{let d=function(e){O(a,d,c),b(e)};return d.prototype.targetRef=b,M(a,d,c)},O=(a,b,c=J)=>{if(!((a,b=J)=>L(a,b)in K)(a,c))return!1;let d=L(a,c);if(v(b))for(let a=K[d].length-1;a>=0;a--){let c=K[d][a];(b===c||c.prototype&&b===c.prototype.targetRef)&&K[d].splice(a,1)}else K[d]=[];return 0===K[d].length&&delete K[d],!0},P=(a,b,c=J,d=!0)=>{let e=d&&c!==J;if(!((a,b=J)=>L(a,b)in K)(a,c))return e&&P(a,b),!1;let f=L(a,c),g=K[f].length;if(!g)return e&&P(a,b),!1;for(let a=g-1;a>=0;a--)K[f][a](b);return e&&P(a,b),!0},Q=a=>{let b=L(a,"");Object.keys(K).filter(a=>0===a.indexOf(b)).forEach(a=>delete K[a])},R="undefined"!=typeof WebSocket?WebSocket:null;class S{constructor(a){this.session=a,this.previousGatewayState="",this._wsClient=null,this._host=l,this._timers={},this._hasTrickleIceCanaryBeenUsed=!1,this._trickleIceCanaryEnabled=!1,this.upDur=null,this.downDur=null;const{host:b,env:c,region:d,trickleIce:e}=a.options;c&&(this._host="development"===c?"wss://rtcdev.telnyx.com":l),b&&(this._host=(a=>`${x.test(a)?"":"wss://"}${a}`)(b)),d&&(this._host=this._host.replace(/rtc(dev)?/,`${d}.rtc$1`)),e&&(this._trickleIceCanaryEnabled=!0)}get connected(){return this._wsClient&&1===this._wsClient.readyState}get connecting(){return this._wsClient&&0===this._wsClient.readyState}get closing(){return this._wsClient&&2===this._wsClient.readyState}get closed(){return this._wsClient&&3===this._wsClient.readyState}get isAlive(){return this.connecting||this.connected}get isDead(){return this.closing||this.closed}connect(){let a=new URL(this._host),b=G();this.session.options.rtcIp&&this.session.options.rtcPort&&(b=null,this._trickleIceCanaryEnabled=!1,a.searchParams.set("rtc_ip",this.session.options.rtcIp),a.searchParams.set("rtc_port",this.session.options.rtcPort.toString())),b&&a.searchParams.set("voice_sdk_id",b),this._trickleIceCanaryEnabled&&(a.searchParams.set("canary","true"),b&&!this._hasTrickleIceCanaryBeenUsed&&(a.searchParams.delete("voice_sdk_id"),r.debug("first trickle ice canary connection. Refreshing voice_sdk_id")),this.session.options.trickleIce=!0,this._hasTrickleIceCanaryBeenUsed=!0),this._wsClient=new R(a.toString()),this._wsClient.onopen=a=>P(aQ.SocketOpen,a,this.session.uuid),this._wsClient.onclose=a=>P(aQ.SocketClose,a,this.session.uuid),this._wsClient.onerror=a=>P(aQ.SocketError,{error:a,sessionId:this.session.sessionid},this.session.uuid),this._wsClient.onmessage=a=>{var b,c,d;let e=u(a.data);if("string"!=typeof e){if(e.voice_sdk_id&&(d=e.voice_sdk_id,sessionStorage.setItem(F,d)),this._unsetTimer(e.id),r.debug("RECV: \n",JSON.stringify(e,null,2),"\n"),aY[`${null==(c=null==(b=null==e?void 0:e.result)?void 0:b.params)?void 0:c.state}`]||!P(e.id,e)){let a=C(e);P(aQ.SocketMessage,e,this.session.uuid),a&&(this.previousGatewayState=a)}}else this._handleStringResponse(e)}}sendRawText(a){this._wsClient.send(a)}send(a){let{request:b}=a,c=new Promise((a,c)=>{if(b.hasOwnProperty("result"))return a();N(b.id,b=>{let{result:d,error:e}=y(b);return e?c(e):a(d)})});return r.debug("SEND: \n",JSON.stringify(b,null,2),"\n"),this._wsClient.send(JSON.stringify(b)),c}close(){this._wsClient&&(v(this._wsClient._beginClose)?this._wsClient._beginClose():this._wsClient.close()),this._wsClient=null}_unsetTimer(a){clearTimeout(this._timers[a]),delete this._timers[a]}_handleStringResponse(a){if(/^#SP/.test(a))switch(a[3]){case"U":this.upDur=parseInt(a.substring(4));break;case"D":this.downDur=parseInt(a.substring(4)),P(aQ.SpeedTest,{upDur:this.upDur,downDur:this.downDur},this.session.uuid)}else r.warn("Unknown message from socket",a)}}class T{buildRequest(a){this.request=Object.assign({jsonrpc:"2.0",id:k()},a)}}let U={id:"callID",destinationNumber:"destination_number",remoteCallerName:"remote_caller_id_name",remoteCallerNumber:"remote_caller_id_number",callerName:"caller_id_name",callerNumber:"caller_id_number",customHeaders:"custom_headers"};class V extends T{constructor(a={}){if(super(),a.hasOwnProperty("dialogParams")){const b=e(a.dialogParams,["remoteSdp","localStream","remoteStream","onNotification","camId","micId","speakerId"]);for(const a in U)a&&b.hasOwnProperty(a)&&(b[U[a]]=b[a],delete b[a]);a.dialogParams=b}this.buildRequest({method:this.toString(),params:a})}}class W extends V{constructor(a){super(),this.method=aT.GatewayState,this.buildRequest({method:this.method,voice_sdk_id:a,params:{}})}}class X{constructor(a){this.pendingRequestId=null,this.onSocketMessage=a=>f(this,void 0,void 0,function*(){a.id===this.pendingRequestId&&this.gatewayStateTask.resolve(C(a))}),this.getIsRegistered=()=>f(this,void 0,void 0,function*(){let a=new W(G());this.pendingRequestId=a.request.id,this.gatewayStateTask=D({}),this.session.execute(a);let b=yield this.gatewayStateTask.promise;return!!b&&[aY.REGISTER,aY.REGED].includes(b)}),this.session=a,this.gatewayStateTask=D({}),this.session.on("telnyx.socket.message",this.onSocketMessage)}}class Y extends V{constructor(a){super(),this.method=aT.Ping,this.buildRequest({method:this.method,voice_sdk_id:a,params:{}})}}class Z{constructor(a){if(this.options=a,this.uuid=k(),this.sessionid="",this.subscriptions={},this.signature=null,this.relayProtocol=null,this.contexts=[],this.timeoutErrorCode=-32e3,this.invalidMethodErrorCode=-32601,this.authenticationRequiredErrorCode=-32e3,this.connection=null,this._jwtAuth=!1,this._autoReconnect=!0,this._idle=!1,this._executeQueue=[],!this.validateOptions())throw Error("Invalid init options");this._onSocketOpen=this._onSocketOpen.bind(this),this.onNetworkClose=this.onNetworkClose.bind(this),this._onSocketMessage=this._onSocketMessage.bind(this),this._handleLoginError=this._handleLoginError.bind(this),this._attachListeners(),this.connection=new S(this),this.registerAgent=new X(this)}get __logger(){return r}get connected(){return this.connection&&this.connection.connected}getIsRegistered(){return f(this,void 0,void 0,function*(){return this.registerAgent.getIsRegistered()})}get reconnectDelay(){return 1e3*z(2,6)}execute(a){return this._idle?new Promise(b=>this._executeQueue.push({resolve:b,msg:a})):this.connected?this.connection.send(a):new Promise(b=>{this._executeQueue.push({resolve:b,msg:a}),this.connect()})}executeRaw(a){this._idle?this._executeQueue.push({msg:a}):this.connection.sendRawText(a)}validateOptions(){return A(this.options)||B(this.options)}broadcast(a){}disconnect(){return f(this,void 0,void 0,function*(){clearTimeout(this._reconnectTimeout),this.subscriptions={},this._autoReconnect=!1,this.relayProtocol=null,this._closeConnection(),yield sessionStorage.removeItem(this.signature),this._executeQueue=[],this._detachListeners()})}on(a,b){return M(a,b,this.uuid),this}off(a,b){return O(a,b,this.uuid),this}connect(){return f(this,void 0,void 0,function*(){this.connection||(this.connection=new S(this)),this._attachListeners(),this.connection.isAlive||this.connection.connect()})}_handleLoginError(a){P(aQ.Error,{error:a,sessionId:this.sessionid},this.uuid)}_onSocketOpen(){return f(this,void 0,void 0,function*(){this.options.keepConnectionAliveOnSocketClose&&this._emptyExecuteQueues()})}onNetworkClose(){for(let a in this.relayProtocol&&Q(this.relayProtocol),this.subscriptions)Q(a);this.subscriptions={},this.contexts=[],clearTimeout(this._keepAliveTimeout),this._autoReconnect&&(this._reconnectTimeout=setTimeout(()=>this.connect(),this.reconnectDelay))}_onSocketMessage(a){}_removeSubscription(a,b){this._existsSubscription(a,b)&&(b?(delete this.subscriptions[a][b],O(a,null,b)):(delete this.subscriptions[a],Q(a)))}_addSubscription(a,b=null,c){this._existsSubscription(a,c)||(this._existsSubscription(a)||(this.subscriptions[a]={}),this.subscriptions[a][c]={},v(b)&&M(a,b,c))}_existsSubscription(a,b){return!(!this.subscriptions.hasOwnProperty(a)||!(!b||b&&this.subscriptions[a].hasOwnProperty(b)))}_attachListeners(){this._detachListeners(),this.on(aQ.SocketOpen,this._onSocketOpen),this.on(aQ.SocketClose,this.onNetworkClose),this.on(aQ.SocketError,this.onNetworkClose),this.on(aQ.SocketMessage,this._onSocketMessage)}_detachListeners(){this.off(aQ.SocketOpen,this._onSocketOpen),this.off(aQ.SocketClose,this.onNetworkClose),this.off(aQ.SocketError,this.onNetworkClose),this.off(aQ.SocketMessage,this._onSocketMessage)}_emptyExecuteQueues(){this._executeQueue.forEach(({resolve:a,msg:b})=>{"string"==typeof b?this.executeRaw(b):a(this.execute(b))})}_closeConnection(){this._idle=!0,clearTimeout(this._keepAliveTimeout),this.connection&&this.connection.close()}_resetKeepAlive(){!1===this._pong&&(r.warn("No ping/pong received, forcing PING ACK to keep alive"),this.execute(new Y(G()))),clearTimeout(this._keepAliveTimeout),this._triggerKeepAliveTimeoutCheck()}_triggerKeepAliveTimeoutCheck(){this._pong=!1,this._keepAliveTimeout=setTimeout(()=>this._resetKeepAlive(),35e3)}setPingReceived(){r.debug("Ping received"),this._pong=!0}static on(a,b){M(a,b)}static off(a){O(a)}static uuid(){return k()}clearConnection(){this.connection=null}hasAutoReconnect(){return this._autoReconnect}}let $=(a,b)=>{let c=w(a);null!==c&&(c.getAttribute("autoplay")||c.setAttribute("autoplay","autoplay"),c.getAttribute("playsinline")||c.setAttribute("playsinline","playsinline"),c.srcObject=b)},_=(a,b)=>f(void 0,void 0,void 0,function*(){let c=w(a);if(null===c)return r.info("No HTMLMediaElement to attach the speakerId"),!1;if("string"!=typeof b)return r.info(`Invalid speaker deviceId: '${b}'`),!1;try{return yield c.setSinkId(b),!0}catch(a){return!1}}),aa=a=>{a&&"live"===a.readyState&&a.stop()},ab=a=>{let b;(b=a)&&b instanceof MediaStream&&a.getTracks().forEach(aa),a=null},ac=a=>f(void 0,void 0,void 0,function*(){r.info("RTCService.getUserMedia",a);let{audio:b}=a;if(!b)return null;try{return yield navigator.mediaDevices.getUserMedia(a)}catch(a){throw r.error("getUserMedia error: ",a),a}}),ad=(a=null,b=!1)=>f(void 0,void 0,void 0,function*(){let c=[],d=yield navigator.mediaDevices.getUserMedia(((a=null)=>({audio:!a||a===aX.AudioIn||a===aX.AudioOut,video:!a||a===aX.Video}))(a)).catch(a=>(console.error(a),null));if(d){if(ab(d),c=yield navigator.mediaDevices.enumerateDevices(),a&&(c=c.filter(b=>b.kind===a)),!0===b)return c;let e=[];c=c.filter(a=>{if(!a.groupId)return!0;let b=`${a.kind}-${a.groupId}`;return!e.includes(b)&&(e.push(b),!0)})}return c}),ae=[[320,240],[640,360],[640,480],[1280,720],[1920,1080]],af=(a,b,c)=>f(void 0,void 0,void 0,function*(){let d=yield ad(c,!0);for(let c=0;c<d.length;c++){let{deviceId:e,label:f}=d[c];if(a===e||b===f)return e}return null}),ag=(a,b)=>{if(!a)return!1;let{subscribed:c,alreadySubscribed:d}=ah(a);return c.includes(b)||d.includes(b)},ah=a=>{let b={subscribed:[],alreadySubscribed:[],unauthorized:[],unsubscribed:[],notSubscribed:[]};return Object.keys(b).forEach(c=>{b[c]=a[`${c}Channels`]||[]}),b},ai=(a,b=null,c=null)=>{if(!(a&&a instanceof MediaStream))return null;let d=[];switch(b){case"audio":d=a.getAudioTracks();break;case"video":d=a.getVideoTracks();break;default:d=a.getTracks()}d.forEach(a=>{switch(c){case"on":case!0:a.enabled=!0;break;case"off":case!1:a.enabled=!1;break;default:a.enabled=!a.enabled}})},aj=a=>{ai(a,"audio",!0)},ak=a=>{ai(a,"audio",!1)},al=a=>{ai(a,"audio",null)};function am(a,b){let c=document.getElementById(b);if(c)return c;if(a&&b){let c=document.createElement("audio");return c.id=b,c.loop=!0,c.src=a,c.preload="auto",c.load(),document.body.appendChild(c),c}return null}function an(a){a&&(a._playFulfilled=!1,a._promise=a.play(),a._promise.then(()=>{a._playFulfilled=!0}).catch(b=>{console.error("playAudio",b),a._playFulfilled=!0}))}function ao(a){a&&(a._playFulfilled?(a.pause(),a.currentTime=0):a._promise&&a._promise.then?a._promise.then(()=>{a.pause(),a.currentTime=0}):setTimeout(()=>{a.pause(),a.currentTime=0},1e3))}(aP=aZ||(aZ={})).not_supported="not supported",aP.full="full",aP.partial="partial";var ap="2.25.2";class aq extends V{constructor(a,b,c,d,e={},f){super(),this.method="login";const g={login:a,passwd:b,login_token:c,userVariables:e,reconnection:f,loginParams:{},"User-Agent":{sdkVersion:ap,data:navigator.userAgent}};d&&(g.sessid=d),this.buildRequest({method:this.method,params:g})}}class ar extends V{constructor(a,b){super(),this.buildRequest({id:a,result:{method:b}})}}class as extends V{toString(){return aT.Invite}}class at extends V{toString(){return aT.Answer}}class au extends V{toString(){return aT.Attach}}class av extends V{toString(){return aT.Bye}}class aw extends V{toString(){return aT.Candidate}}class ax extends V{toString(){return aT.EndOfCandidates}}class ay extends V{toString(){return aT.Modify}}class az extends V{toString(){return aT.Info}}class aA extends V{toString(){return aT.Broadcast}}class aB extends V{toString(){return aT.Subscribe}}class aC extends V{toString(){return aT.Unsubscribe}}class aD extends T{constructor(a,b){super(),this.method="ai_conversation",this.buildRequest({method:this.method,params:{type:"conversation.item.create",previous_item_id:null,item:{id:k(),type:"message",role:"user",content:[{type:"input_text",text:a},...null==b?void 0:b.map(a=>({type:"image_url",image_url:{url:a}}))]}}})}}let aE=(a,b)=>{let{contentType:c,canvasType:d,callID:e,canvasInfo:f=null,currentLayerIdx:g=-1}=b;f&&"mcu-personal-canvas"!==d&&delete f.memberID;let h={type:H.conferenceUpdate,call:a.calls[e],canvasInfo:aF(f),currentLayerIdx:g};switch(c){case"layer-info":{let b=Object.assign({action:aW.LayerInfo},h);P(aQ.Notification,b,a.uuid);break}case"layout-info":{let b=Object.assign({action:aW.LayoutInfo},h);P(aQ.Notification,b,a.uuid)}}},aF=a=>u(JSON.stringify(a).replace(/memberID/g,"participantId").replace(/ID"/g,'Id"').replace(/POS"/g,'Pos"'));var aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a$=q(function(a,b){function c(){}function d(){d.init.call(this)}function e(a){return void 0===a._maxListeners?d.defaultMaxListeners:a._maxListeners}function f(a,b,d,f){var g,h,i;if("function"!=typeof d)throw TypeError('"listener" argument must be a function');if((h=a._events)?(h.newListener&&(a.emit("newListener",b,d.listener?d.listener:d),h=a._events),i=h[b]):(h=a._events=new c,a._eventsCount=0),i){if("function"==typeof i?i=h[b]=f?[d,i]:[i,d]:f?i.unshift(d):i.push(d),!i.warned&&(g=e(a))&&0<g&&i.length>g){i.warned=!0;var j=Error("Possible EventEmitter memory leak detected. "+i.length+" "+b+" listeners added. Use emitter.setMaxListeners() to increase limit");j.name="MaxListenersExceededWarning",j.emitter=a,j.type=b,j.count=i.length,"function"==typeof console.warn?console.warn(j):console.log(j)}}else i=h[b]=d,++a._eventsCount;return a}function g(a,b,c){function d(){a.removeListener(b,d),e||(e=!0,c.apply(a,arguments))}var e=!1;return d.listener=c,d}function h(a){var b=this._events;if(b){var c=b[a];if("function"==typeof c)return 1;if(c)return c.length}return 0}function i(a,b){for(var c=Array(b);b--;)c[b]=a[b];return c}Object.defineProperty(b,"__esModule",{value:!0}),c.prototype=Object.create(null),d.EventEmitter=d,d.usingDomains=!1,d.prototype.domain=void 0,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.init=function(){this.domain=null,!d.usingDomains||!j.active||this instanceof j.Domain||(this.domain=j.active),this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new c,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(a){if("number"!=typeof a||0>a||isNaN(a))throw TypeError('"n" argument must be a positive number');return this._maxListeners=a,this},d.prototype.getMaxListeners=function(){return e(this)},d.prototype.emit=function(a){var b,c,d,e,f,g,h,j="error"===a;if(g=this._events)j=j&&null==g.error;else if(!j)return!1;if(h=this.domain,j){if(b=arguments[1],!h){if(b instanceof Error)throw b;var k=Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}return b||(b=Error('Uncaught, unspecified "error" event')),b.domainEmitter=this,b.domain=h,b.domainThrown=!1,h.emit("error",b),!1}if(!(c=g[a]))return!1;var l="function"==typeof c;switch(d=arguments.length){case 1:!function(a,b,c){if(b)a.call(c);else for(var d=a.length,e=i(a,d),f=0;f<d;++f)e[f].call(c)}(c,l,this);break;case 2:!function(a,b,c,d){if(b)a.call(c,d);else for(var e=a.length,f=i(a,e),g=0;g<e;++g)f[g].call(c,d)}(c,l,this,arguments[1]);break;case 3:!function(a,b,c,d,e){if(b)a.call(c,d,e);else for(var f=a.length,g=i(a,f),h=0;h<f;++h)g[h].call(c,d,e)}(c,l,this,arguments[1],arguments[2]);break;case 4:!function(a,b,c,d,e,f){if(b)a.call(c,d,e,f);else for(var g=a.length,h=i(a,g),j=0;j<g;++j)h[j].call(c,d,e,f)}(c,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(e=Array(d-1),f=1;f<d;f++)e[f-1]=arguments[f];!function(a,b,c,d){if(b)a.apply(c,d);else for(var e=a.length,f=i(a,e),g=0;g<e;++g)f[g].apply(c,d)}(c,l,this,e)}return!0},d.prototype.addListener=function(a,b){return f(this,a,b,!1)},d.prototype.on=d.prototype.addListener,d.prototype.prependListener=function(a,b){return f(this,a,b,!0)},d.prototype.once=function(a,b){if("function"!=typeof b)throw TypeError('"listener" argument must be a function');return this.on(a,g(this,a,b)),this},d.prototype.prependOnceListener=function(a,b){if("function"!=typeof b)throw TypeError('"listener" argument must be a function');return this.prependListener(a,g(this,a,b)),this},d.prototype.removeListener=function(a,b){var d,e,f,g,h;if("function"!=typeof b)throw TypeError('"listener" argument must be a function');if(!(e=this._events)||!(d=e[a]))return this;if(d===b||d.listener&&d.listener===b)0==--this._eventsCount?this._events=new c:(delete e[a],e.removeListener&&this.emit("removeListener",a,d.listener||b));else if("function"!=typeof d){for(f=-1,g=d.length;0<g--;)if(d[g]===b||d[g].listener&&d[g].listener===b){h=d[g].listener,f=g;break}if(0>f)return this;if(1===d.length){if(d[0]=void 0,0==--this._eventsCount)return this._events=new c,this;delete e[a]}else{for(var i=d,j=f,k=j,l=k+1,m=i.length;l<m;k+=1,l+=1)i[k]=i[l];i.pop()}e.removeListener&&this.emit("removeListener",a,h||b)}return this},d.prototype.removeAllListeners=function(a){var b,d;if(!(d=this._events))return this;if(!d.removeListener)return 0==arguments.length?(this._events=new c,this._eventsCount=0):d[a]&&(0==--this._eventsCount?this._events=new c:delete d[a]),this;if(0==arguments.length){for(var e,f=Object.keys(d),g=0;g<f.length;++g)"removeListener"!==(e=f[g])&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events=new c,this._eventsCount=0,this}if("function"==typeof(b=d[a]))this.removeListener(a,b);else if(b)do this.removeListener(a,b[b.length-1]);while(b[0])return this},d.prototype.listeners=function(a){var b,c=this._events;return c&&(b=c[a])?"function"==typeof b?[b.listener||b]:function(a){for(var b=Array(a.length),c=0;c<b.length;++c)b[c]=a[c].listener||a[c];return b}(b):[]},d.listenerCount=function(a,b){return"function"==typeof a.listenerCount?a.listenerCount(b):h.call(a,b)},d.prototype.listenerCount=h,d.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]};for(var j,k,l=new Uint8Array(16),m=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,n=[],o=0;256>o;++o)n.push((o+256).toString(16).substr(1));function p(a,b){if(!a||!b)return{};let c={...a};if(c.localCandidateId){let a=b.get(c.localCandidateId);c.local={...a}}if(c.remoteCandidateId){let a=b.get(c.remoteCandidateId);c.remote={...a}}return c}function q(a,b,c){let d,e;return 8*(d=a[c],e=b?b[c]:null,null===d||null===e?null:(d-e)/(a.timestamp-b.timestamp)*1e3)}let r,s={},t=[];b.WebRTCStats=class extends d{constructor(a){throw super(),this.monitoringSetInterval=0,this.connectionMonitoringSetInterval=0,this.connectionMonitoringInterval=1e3,this.remote=!0,this.peersToMonitor={},this.timeline=[],this.statsToMonitor=["inbound-rtp","outbound-rtp","remote-inbound-rtp","remote-outbound-rtp","peer-connection","data-channel","stream","track","sender","receiver","transport","candidate-pair","local-candidate","remote-candidate"],Error("WebRTCStats only works in browser")}async addPeer(a,b){return console.warn("The addPeer() method has been deprecated, please use addConnection()"),this.addConnection({peerId:a,pc:b})}async addConnection(a){var b,c;let{pc:d,peerId:e}=a,{connectionId:f,remote:g}=a;if(g="boolean"==typeof g?g:this.remote,!(d&&d instanceof RTCPeerConnection))throw Error("Missing argument 'pc' or is not of instance RTCPeerConnection");if(!e)throw Error("Missing argument peerId");if(this.isEdge)throw Error("Can't monitor peers in Edge at this time.");if(this.peersToMonitor[e]){if(f&&f in this.peersToMonitor[e])throw Error(`We are already monitoring connection with id ${f}.`);for(let a in this.peersToMonitor[e]){let b=this.peersToMonitor[e][a];if(b.pc===d)throw Error(`We are already monitoring peer with id ${e}.`);"closed"===b.pc.connectionState&&this.removeConnection({pc:b.pc})}}let h=d.getConfiguration();return h.iceServers&&h.iceServers.forEach(function(a){delete a.credential}),f||((c=(b=b||{}).random||(b.rng||function(){if(!k&&!(k="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return k(l)})())[6]=64|15&c[6],c[8]=128|63&c[8],f=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=(n[a[b+0]]+n[a[b+1]]+n[a[b+2]]+n[a[b+3]]+"-"+n[a[b+4]]+n[a[b+5]]+"-"+n[a[b+6]]+n[a[b+7]]+"-"+n[a[b+8]]+n[a[b+9]]+"-"+n[a[b+10]]+n[a[b+11]]+n[a[b+12]]+n[a[b+13]]+n[a[b+14]]+n[a[b+15]]).toLowerCase();if(!("string"==typeof c&&m.test(c)))throw TypeError("Stringified UUID is invalid");return c}(c)),this.emitEvent({event:"addConnection",tag:"peer",peerId:e,connectionId:f,data:{options:a,peerConfiguration:h}}),this.monitorPeer({peerId:e,connectionId:f,pc:d,remote:g}),{connectionId:f}}getTimeline(a){return this.timeline=this.timeline.sort((a,b)=>a.timestamp.getTime()-b.timestamp.getTime()),a?this.timeline.filter(b=>b.tag===a):this.timeline}get logger(){let a=a=>{let b=["none","error","warn","info","debug"];return b.slice(0,b.indexOf(this.logLevel)+1).indexOf(a)>-1};return{error(...b){this.debug&&a("error")&&console.error("[webrtc-stats][error] ",...b)},warn(...b){this.debug&&a("warn")&&console.warn("[webrtc-stats][warn] ",...b)},info(...b){this.debug&&a("info")&&console.log("[webrtc-stats][info] ",...b)},debug(...b){this.debug&&a("debug")&&console.debug("[webrtc-stats][debug] ",...b)}}}removeConnection(a){let b,{connectionId:c,pc:d}=a;if(!d&&!c)throw Error("Missing arguments. You need to either send pc or a connectionId.");if(c){if("string"!=typeof c)throw Error("connectionId must be a string.");for(let a in this.peersToMonitor)c in this.peersToMonitor[a]&&(d=this.peersToMonitor[a][c].pc,b=a)}else if(d){if(!(d instanceof RTCPeerConnection))throw Error("pc must be an instance of RTCPeerConnection.");for(let a in this.peersToMonitor)for(let e in this.peersToMonitor[a])this.peersToMonitor[a][e].pc===d&&(c=e,b=a)}if(!d||!c)throw Error("Could not find the desired connection.");return this.removePeerConnectionEventListeners(c,d),delete this.peersToMonitor[b][c],0===Object.values(this.peersToMonitor[b]).length&&delete this.peersToMonitor[b],{connectionId:c}}removeAllPeers(){for(let a in this.peersToMonitor)this.removePeer(a)}removePeer(a){if(this.logger.info(`Removing PeerConnection with id ${a}.`),this.peersToMonitor[a]){for(let b in this.peersToMonitor[a]){let c=this.peersToMonitor[a][b].pc;this.removePeerConnectionEventListeners(b,c)}delete this.peersToMonitor[a]}}destroy(){this.removeAllPeers(),t.forEach(a=>{this.removeTrackEventListeners(a)}),t=[],this.shouldWrapGetUserMedia&&r&&(navigator.mediaDevices.getUserMedia=r)}monitorPeer(a){let{peerId:b,connectionId:c,pc:d,remote:e}=a;if(!d)return void this.logger.warn("Did not receive pc argument when calling monitorPeer()");let f={pc:d,connectionId:c,stream:null,stats:{parsed:null,raw:null},options:{remote:e}};if(this.peersToMonitor[b]){if(c in this.peersToMonitor[b])return void this.logger.warn(`Already watching connection with ID ${c}`);this.peersToMonitor[b][c]=f}else this.peersToMonitor[b]={[c]:f};this.addPeerConnectionEventListeners(b,c,d),1===this.numberOfMonitoredPeers&&(this.startStatsMonitoring(),this.startConnectionStateMonitoring())}startStatsMonitoring(){this.monitoringSetInterval||(this.monitoringSetInterval=window.setInterval(()=>{this.numberOfMonitoredPeers||this.stopStatsMonitoring(),this.getStats().then(a=>{a.forEach(a=>{this.emitEvent(a)})})},this._getStatsInterval))}stopStatsMonitoring(){this.monitoringSetInterval&&(window.clearInterval(this.monitoringSetInterval),this.monitoringSetInterval=0)}async getStats(a=null){this.logger.info(a?`Getting stats from peer ${a}`:"Getting stats from all peers");let b={};if(a){if(!this.peersToMonitor[a])throw Error(`Cannot get stats. Peer with id ${a} does not exist`);b[a]=this.peersToMonitor[a]}else b=this.peersToMonitor;let c=[];for(let a in b)for(let d in b[a]){let e=b[a][d],f=e.pc;if(f&&!this.checkIfConnectionIsClosed(a,d,f))try{let b=this.getTimestamp(),g=f.getStats(null);if(g){let f=await g,h=this.getTimestamp(),i=function(a){if(!a.entries)return a;let b={};return a.forEach(function(a,c){b[c]=a}),b}(f),j={remote:e.options.remote},k=function(a,b,c={}){var d;if(!a)return null;let e={audio:{inbound:[],outbound:[]},video:{inbound:[],outbound:[]},connection:{inbound:[],outbound:[]}};for(let b of(c.remote&&(e.remote={audio:{inbound:[],outbound:[]},video:{inbound:[],outbound:[]}}),a.values()))switch(b.type){case"outbound-rtp":{let c=b.mediaType||b.kind,d={},f={};if(!["audio","video"].includes(c))continue;if(b.codecId){let c=a.get(b.codecId);c&&(d.clockRate=c.clockRate,d.mimeType=c.mimeType,d.payloadType=c.payloadType)}f=a.get(b.mediaSourceId)||a.get(b.trackId)||{},e[c].outbound.push({...b,...d,track:{...f}});break}case"inbound-rtp":{let c=b.mediaType||b.kind,d={},f={};if(!["audio","video"].includes(c))if(b.id.includes("Video"))c="video";else{if(!b.id.includes("Audio"))continue;c="audio"}if(b.codecId){let c=a.get(b.codecId);c&&(f.clockRate=c.clockRate,f.mimeType=c.mimeType,f.payloadType=c.payloadType)}if(!e.connection.id&&b.transportId){let c=a.get(b.transportId);if(c&&c.selectedCandidatePairId){let b=a.get(c.selectedCandidatePairId);e.connection=p(b,a)}}d=a.get(b.mediaSourceId)||a.get(b.trackId)||{},e[c].inbound.push({...b,...f,track:{...d}});break}case"peer-connection":e.connection.dataChannelsClosed=b.dataChannelsClosed,e.connection.dataChannelsOpened=b.dataChannelsOpened;break;case"remote-inbound-rtp":{if(!c.remote)break;let d=b.mediaType||b.kind,f={};if(!["audio","video"].includes(d))if(b.id.includes("Video"))d="video";else{if(!b.id.includes("Audio"))continue;d="audio"}if(b.codecId){let c=a.get(b.codecId);c&&(f.clockRate=c.clockRate,f.mimeType=c.mimeType,f.payloadType=c.payloadType)}if(!e.connection.id&&b.transportId){let c=a.get(b.transportId);if(c&&c.selectedCandidatePairId){let b=a.get(c.selectedCandidatePairId);e.connection=p(b,a)}}e.remote[d].inbound.push({...b,...f});break}case"remote-outbound-rtp":{if(!c.remote)break;let d=b.mediaType||b.kind,f={};if(!["audio","video"].includes(d))continue;if(b.codecId){let c=a.get(b.codecId);c&&(f.clockRate=c.clockRate,f.mimeType=c.mimeType,f.payloadType=c.payloadType)}e.remote[d].outbound.push({...b,...f})}}if(!e.connection.id)for(let b of a.values())"candidate-pair"===b.type&&b.nominated&&"succeeded"===b.state&&(e.connection=p(b,a));return d=e,b&&(d.audio.inbound.map(a=>{let c=b.audio.inbound.find(b=>b.id===a.id);a.bitrate=q(a,c,"bytesReceived"),a.packetRate=q(a,c,"packetsReceived")}),d.audio.outbound.map(a=>{let c=b.audio.outbound.find(b=>b.id===a.id);a.bitrate=q(a,c,"bytesSent"),a.packetRate=q(a,c,"packetsSent")}),d.video.inbound.map(a=>{let c=b.video.inbound.find(b=>b.id===a.id);a.bitrate=q(a,c,"bytesReceived"),a.packetRate=q(a,c,"packetsReceived")}),d.video.outbound.map(a=>{let c=b.video.outbound.find(b=>b.id===a.id);a.bitrate=q(a,c,"bytesSent"),a.packetRate=q(a,c,"packetsSent")})),e=d}(f,e.stats.parsed,j),l={event:"stats",tag:"stats",peerId:a,connectionId:d,timeTaken:h-b,data:k};!0===this.rawStats&&(l.rawStats=f),!0===this.statsObject&&(l.statsObject=i),!0===this.filteredStats&&(l.filteredStats=this.filteroutStats(i)),c.push(l),e.stats.parsed=k}else this.logger.error(`PeerConnection from peer ${a} did not return any stats data`)}catch(a){this.logger.error(a)}}return c}startConnectionStateMonitoring(){this.connectionMonitoringSetInterval=window.setInterval(()=>{for(let a in this.numberOfMonitoredPeers||this.stopConnectionStateMonitoring(),this.peersToMonitor)for(let b in this.peersToMonitor[a]){let c=this.peersToMonitor[a][b].pc;this.checkIfConnectionIsClosed(a,b,c)}},this.connectionMonitoringInterval)}checkIfConnectionIsClosed(a,b,c){let d=this.isConnectionClosed(c);if(d){this.removeConnection({pc:c});let d="closed"===c.connectionState?"onconnectionstatechange":"oniceconnectionstatechange";this.emitEvent({event:d,peerId:a,connectionId:b,tag:"connection",data:"closed"})}return d}isConnectionClosed(a){return"closed"===a.connectionState||"closed"===a.iceConnectionState}stopConnectionStateMonitoring(){this.connectionMonitoringSetInterval&&(window.clearInterval(this.connectionMonitoringSetInterval),this.connectionMonitoringSetInterval=0)}wrapGetUserMedia(){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return void this.logger.warn("'navigator.mediaDevices.getUserMedia' is not available in browser. Will not wrap getUserMedia.");this.logger.info("Wrapping getUsermedia functions."),r=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);let a=this.parseGetUserMedia.bind(this);navigator.mediaDevices.getUserMedia=(function(){return a({constraints:arguments[0]}),r.apply(navigator.mediaDevices,arguments).then(b=>(a({stream:b}),b),b=>(a({error:b}),Promise.reject(b)))}).bind(navigator.mediaDevices)}filteroutStats(a={}){let b={...a};for(let a in b){var c=b[a];this.statsToMonitor.includes(c.type)||delete b[a]}return b}get peerConnectionListeners(){return{icecandidate:(a,b,c,d)=>{this.logger.debug("[pc-event] icecandidate | peerId: ${peerId}",d),this.emitEvent({event:"onicecandidate",tag:"connection",peerId:a,connectionId:b,data:d.candidate})},track:(a,b,c,d)=>{this.logger.debug(`[pc-event] track | peerId: ${a}`,d);let e=d.track,f=d.streams[0];a in this.peersToMonitor&&b in this.peersToMonitor[a]&&(this.peersToMonitor[a][b].stream=f),this.addTrackEventListeners(e,b),this.emitEvent({event:"ontrack",tag:"track",peerId:a,connectionId:b,data:{stream:f?this.getStreamDetails(f):null,track:e?this.getMediaTrackDetails(e):null,title:d.track.kind+":"+d.track.id+" "+d.streams.map(function(a){return"stream:"+a.id})}})},signalingstatechange:(a,b,c)=>{this.logger.debug(`[pc-event] signalingstatechange | peerId: ${a}`),this.emitEvent({event:"onsignalingstatechange",tag:"connection",peerId:a,connectionId:b,data:{signalingState:c.signalingState,localDescription:c.localDescription,remoteDescription:c.remoteDescription}})},iceconnectionstatechange:(a,b,c)=>{this.logger.debug(`[pc-event] iceconnectionstatechange | peerId: ${a}`),this.emitEvent({event:"oniceconnectionstatechange",tag:"connection",peerId:a,connectionId:b,data:c.iceConnectionState})},icegatheringstatechange:(a,b,c)=>{this.logger.debug(`[pc-event] icegatheringstatechange | peerId: ${a}`),this.emitEvent({event:"onicegatheringstatechange",tag:"connection",peerId:a,connectionId:b,data:c.iceGatheringState})},icecandidateerror:(a,b,c,d)=>{this.logger.debug(`[pc-event] icecandidateerror | peerId: ${a}`),this.emitEvent({event:"onicecandidateerror",tag:"connection",peerId:a,connectionId:b,error:{errorCode:d.errorCode}})},connectionstatechange:(a,b,c)=>{this.logger.debug(`[pc-event] connectionstatechange | peerId: ${a}`),this.emitEvent({event:"onconnectionstatechange",tag:"connection",peerId:a,connectionId:b,data:c.connectionState})},negotiationneeded:(a,b,c)=>{this.logger.debug(`[pc-event] negotiationneeded | peerId: ${a}`),this.emitEvent({event:"onnegotiationneeded",tag:"connection",peerId:a,connectionId:b})},datachannel:(a,b,c,d)=>{this.logger.debug(`[pc-event] datachannel | peerId: ${a}`,d),this.emitEvent({event:"ondatachannel",tag:"datachannel",peerId:a,connectionId:b,data:d.channel})}}}addPeerConnectionEventListeners(a,b,c){this.logger.debug(`Adding event listeners for peer ${a} and connection ${b}.`),s[b]={},Object.keys(this.peerConnectionListeners).forEach(d=>{s[b][d]=this.peerConnectionListeners[d].bind(this,a,b,c),c.addEventListener(d,s[b][d],!1)})}parseGetUserMedia(a){try{let b={event:"getUserMedia",tag:"getUserMedia",data:{...a}};a.stream&&(b.data.details=this.parseStream(a.stream),a.stream.getTracks().map(a=>{this.addTrackEventListeners(a),t.push(a)})),this.emitEvent(b)}catch(a){}}parseStream(a){let b={audio:[],video:[]};return a.getTracks().forEach(a=>{b[a.kind].push(this.getMediaTrackDetails(a))}),b}getMediaTrackDetails(a){return{enabled:a.enabled,id:a.id,contentHint:a.contentHint,kind:a.kind,label:a.label,muted:a.muted,readyState:a.readyState,constructorName:a.constructor.name,capabilities:a.getCapabilities?a.getCapabilities():{},constraints:a.getConstraints?a.getConstraints():{},settings:a.getSettings?a.getSettings():{},_track:a}}getStreamDetails(a){return{active:a.active,id:a.id,_stream:a}}getTrackEventObject(a){return{mute:b=>{this.emitEvent({event:"mute",tag:"track",connectionId:a,data:{event:b}})},unmute:b=>{this.emitEvent({event:"unmute",tag:"track",connectionId:a,data:{event:b}})},overconstrained:b=>{this.emitEvent({event:"overconstrained",tag:"track",connectionId:a,data:{event:b}})},ended:b=>{this.emitEvent({event:"ended",tag:"track",connectionId:a,data:{event:b}}),this.removeTrackEventListeners(b.target)}}}addTrackEventListeners(a,b){s[a.id]={};let c=this.getTrackEventObject(b);Object.keys(c).forEach(b=>{s[a.id][b]=c[b].bind(this),a.addEventListener(b,s[a.id][b])}),s[a.id].readyState=setInterval(()=>{if("ended"===a.readyState){let b=new CustomEvent("ended",{detail:{check:"readyState"}});a.dispatchEvent(b)}},1e3)}removeTrackEventListeners(a){a.id in s&&(Object.keys(this.getTrackEventObject()).forEach(b=>{a.removeEventListener(b,s[a.id][b])}),clearInterval(s[a.id].readyState),delete s[a.id])}addToTimeline(a){this.timeline.push(a),this.emit("timeline",a)}emitEvent(a){let b={...a,timestamp:new Date};this.addToTimeline(b),b.tag&&this.emit(b.tag,b)}set getStatsInterval(a){if(!Number.isInteger(a))throw Error(`getStatsInterval should be an integer, got: ${a}`);this._getStatsInterval=a,this.monitoringSetInterval&&(this.stopStatsMonitoring(),this.startStatsMonitoring())}get numberOfMonitoredPeers(){return Object.keys(this.peersToMonitor).length}removePeerConnectionEventListeners(a,b){a in s&&(Object.keys(this.peerConnectionListeners).forEach(c=>{b.removeEventListener(c,s[a][c],!1)}),delete s[a]),b.getSenders().forEach(a=>{a.track&&this.removeTrackEventListeners(a.track)}),b.getReceivers().forEach(a=>{a.track&&this.removeTrackEventListeners(a.track)})}getTimestamp(){return Date.now()}wrapGetDisplayMedia(){let a=this;if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia){let b=navigator.mediaDevices.getDisplayMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getDisplayMedia=(function(){return a.debug("navigator.mediaDevices.getDisplayMedia",null,arguments[0]),b.apply(navigator.mediaDevices,arguments).then(function(a){return a},function(b){return a.debug("navigator.mediaDevices.getDisplayMediaOnFailure",null,b.name),Promise.reject(b)})}).bind(navigator.mediaDevices)}}}});a$&&a$.__esModule&&Object.prototype.hasOwnProperty.call(a$,"default")&&a$.default;var a_=a$.WebRTCStats;class a0 extends T{constructor(a){super(),this.buildRequest({type:"debug_report_start",debug_report_id:a,debug_report_version:1})}}class a1 extends T{constructor(a){super(),this.buildRequest({type:"debug_report_stop",debug_report_id:a,debug_report_version:1})}}class a2 extends T{constructor(a,b){super(),this.buildRequest({type:"debug_report_data",debug_report_id:a,debug_report_version:1,debug_report_data:b})}}class a3{constructor(a,b,c,d,e){this.type=a,this.options=b,this.onSdpReadyTwice=null,this.statsReporter=null,this._negotiating=!1,this._prevConnectionState=null,this._restartedIceOnConnectionStateFailed=!1,this.handleConnectionStateChange=a=>f(this,void 0,void 0,function*(){let{connectionState:a}=this.instance;if(console.log(`[${(new Date).toISOString()}] Connection State changed: ${this._prevConnectionState} -> ${a}`),"failed"===a||"disconnected"===a){let b=()=>f(this,void 0,void 0,function*(){this._isOffer()&&!this._restartedIceOnConnectionStateFailed?(this.instance.restartIce(),r.debug(`Peer Connection ${a}. Restarting ICE gathering.`),"failed"===a&&(this._restartedIceOnConnectionStateFailed=!0,r.debug("ICE has been restarted on connection state failed.")),this._isTrickleIce()?yield this.startTrickleIceNegotiation():this.startNegotiation()):this._restartedIceOnConnectionStateFailed&&(r.debug("Peer Connection failed again after ICE restart. Closing unrecoverable call."),P(aQ.PeerConnectionFailureError,{error:Error(`Peer Connection failed twice. previous state: ${this._prevConnectionState}, current state: ${a}`),sessionId:this._session.sessionid},this.options.id)),window.removeEventListener("online",b)});navigator.onLine?b():window.addEventListener("online",b)}"connected"===this._prevConnectionState&&"disconnected"===a&&(yield this._resetJitterBuffer()),"disconnected"===this._prevConnectionState&&"connected"===a&&(yield this._resetJitterBuffer()),this._prevConnectionState=a,this._isTrickleIce()&&("connecting"===a&&performance.mark("peer-connection-connecting"),"connected"===a&&(performance.mark("peer-connection-connected"),console.group("Performance Metrics"),console.table(this.trickleIcePerformanceMetrics),console.groupEnd(),performance.clearMarks()))}),this._handleIceConnectionStateChange=a=>{console.log(`[${(new Date).toISOString()}] ICE Connection State`,this.instance.iceConnectionState)},this._handleIceGatheringStateChange=a=>{console.log(`[${(new Date).toISOString()}] ICE Gathering State`,this.instance.iceGatheringState)},this._setAudioCodec=a=>{if(this.options.preferred_codecs&&0!==this.options.preferred_codecs.length)return a.setCodecPreferences?a.setCodecPreferences(this.options.preferred_codecs):void 0},r.info("New Peer with type:",this.type,"Options:",this.options),this._constraints={offerToReceiveAudio:!0},this._sdpReady=this._sdpReady.bind(this),this.handleSignalingStateChangeEvent=this.handleSignalingStateChangeEvent.bind(this),this.handleNegotiationNeededEvent=this.handleNegotiationNeededEvent.bind(this),this.handleTrackEvent=this.handleTrackEvent.bind(this),this.createPeerConnection=this.createPeerConnection.bind(this),this._session=c,this._trickleIceSdpFn=d,this._registerPeerEvents=e}get isOffer(){return this.type===aR.Offer}get isAnswer(){return this.type===aR.Answer}get isDebugEnabled(){return this.options.debug||this._session.options.debug}get debugOutput(){return this.options.debugOutput||this._session.options.debugOutput}get keepConnectionAliveOnSocketClose(){return this.options.keepConnectionAliveOnSocketClose||this._session.options.keepConnectionAliveOnSocketClose}startNegotiation(){performance.mark("ice-gathering-start"),this._negotiating=!0,this._isOffer()?this._createOffer():this._createAnswer()}startTrickleIceNegotiation(){return f(this,void 0,void 0,function*(){performance.mark("ice-gathering-start"),this._negotiating=!0,this._isOffer()?yield this._createOffer().then(this._trickleIceSdpFn.bind(this)):yield this._createAnswer().then(this._trickleIceSdpFn.bind(this))})}_logTransceivers(){r.info("Number of transceivers:",this.instance.getTransceivers().length),this.instance.getTransceivers().forEach((a,b)=>{r.info(`>> Transceiver [${b}]:`,a.mid,a.direction,a.stopped),r.info(`>> Sender Params [${b}]:`,JSON.stringify(a.sender.getParameters(),null,2))})}get trickleIcePerformanceMetrics(){let a=performance.measure("new-call","new-call-start","new-call-end"),b=performance.measure("peer-creation","peer-creation-start","peer-creation-end"),c=performance.measure("ice-gathering","ice-gathering-start","ice-gathering-end"),d=performance.measure("sdp-send","sdp-send-start","sdp-send-end"),e=performance.measure("invite-send","new-call-start","sdp-send-start"),f=performance.measure("total-duration","peer-creation-start","sdp-send-end"),g=a=>`${a.toFixed(2)}ms`;return{"New Call":{duration:g(a.duration)},"Peer Creation":{duration:g(b.duration)},"ICE Gathering":{duration:g(c.duration)},[this._isOffer()?"Invite Send":"Answer Send"]:{duration:g(e.duration)},"SDP Send":{duration:g(d.duration)},"Total Duration":{duration:g(f.duration)}}}handleSignalingStateChangeEvent(a){switch(r.info("signalingState:",this.instance.signalingState),this.instance.signalingState){case"stable":this._negotiating=!1;break;case"closed":this.instance=null;break;default:this._negotiating=!0}}handleNegotiationNeededEvent(){r.info("Negotiation needed event"),"stable"!==this.instance.signalingState||this._negotiating?r.debug("Skipping negotiation, state:",this.instance.signalingState,"negotiating:",this._negotiating):this._isTrickleIce()?this.startTrickleIceNegotiation():this.startNegotiation()}handleTrackEvent(a){let{streams:[b]}=a,{remoteElement:c,screenShare:d}=this.options,{remoteStream:e}=this.options;e=b,!1===d&&$(c,e)}createPeerConnection(){return f(this,void 0,void 0,function*(){var a;this.instance=(a=this._config(),new window.RTCPeerConnection(a)),this.instance.onsignalingstatechange=this.handleSignalingStateChangeEvent,this.instance.onnegotiationneeded=this.handleNegotiationNeededEvent,this.instance.ontrack=this.handleTrackEvent,this.instance.addEventListener("connectionstatechange",this.handleConnectionStateChange),this.instance.addEventListener("iceconnectionstatechange",this._handleIceConnectionStateChange),this.instance.addEventListener("icegatheringstatechange",this._handleIceGatheringStateChange),this.instance.addEventListener("addstream",a=>{this.options.remoteStream=a.stream}),this._registerPeerEvents(this.instance),this._prevConnectionState=this.instance.connectionState,this.isAnswer&&(yield this._setRemoteDescription({sdp:this.options.remoteSdp,type:aR.Offer})),this.options.localStream=yield this._retrieveLocalStream().catch(a=>(P(aQ.MediaError,a,this.options.id),null)),performance.mark("peer-creation-end")})}init(){var a;return f(this,void 0,void 0,function*(){yield this.createPeerConnection(),yield null==(a=this.statsReporter)?void 0:a.start(this.instance,this._session.sessionid,this._session.sessionid);let{localElement:b,localStream:c=null,screenShare:d=!1}=this.options;if(c&&c instanceof MediaStream){let a=c.getAudioTracks();if(r.info("Local audio tracks: ",a),"object"==typeof this.options.audio&&a.forEach(a=>{r.info("Local audio tracks constraints: ",a.getConstraints())}),this.isOffer&&"function"==typeof this.instance.addTransceiver){let b={direction:"sendrecv",streams:[c]};a.forEach(a=>{this.options.userVariables.microphoneLabel=a.label;let c=this.instance.addTransceiver(a,b);this._setAudioCodec(c)})}else"function"==typeof this.instance.addTrack?(a.forEach(a=>{this.options.userVariables.microphoneLabel=a.label,this.instance.addTrack(a,c)}),this.instance.getTransceivers().forEach(a=>this._setAudioCodec(a))):this.instance.addStream(c);!1===d&&$(b,c)}this.isOffer?this.options.negotiateAudio&&this._checkMediaToNegotiate("audio"):this._isTrickleIce()||this.startNegotiation(),this._isTrickleIce()&&this.startTrickleIceNegotiation(),this._logTransceivers(),this.isDebugEnabled&&(this.statsReporter=function(a){let b=k(),c=new a_({getStatsInterval:1e3,rawStats:!1,statsObject:!0,filteredStats:!1,remote:!0,debug:!1,logLevel:"warn"}),d=c=>f(this,void 0,void 0,function*(){"stats"===c.event&&P(aQ.StatsFrame,function({data:a}){var b,c,d,e,f,g,h,i;let{audio:j,remote:k}=a,{audio:l}=k,m=null!=(c=null==(b=l.inbound[0])?void 0:b.jitter)?c:1/0,n=null!=(e=null==(d=l.inbound[0])?void 0:d.roundTripTime)?e:1/0,o=null!=(g=null==(f=j.inbound[0])?void 0:f.packetsReceived)?g:-1,p=function(a){let{packetsLost:b,packetsReceived:c,jitter:d,rtt:e}=a,f=93.2-function(a){let{jitter:b,rtt:c}=a,d=b+c/2;return .024*d+.11*(d-177.3)*(d>177.3)}({rtt:e,jitter:d})-function(a){let{packetsLost:b,packetsReceived:c}=a;return 20*Math.log(1+b/(c+b)*100)}({packetsLost:b,packetsReceived:c})+0;return Math.min(Math.max(1+.035*f+7e-6*f*(f-60)*(100-f),1),5)}({jitter:1e3*m,rtt:1e3*n,packetsLost:null!=(i=null==(h=j.inbound[0])?void 0:h.packetsLost)?i:-1,packetsReceived:o});return{jitter:m,rtt:n,mos:p,quality:isNaN(p)?null:p>4.2?"excellent":p>=4.1&&p<=4.2?"good":p>=3.7&&p<=4?"fair":p>=3.1&&p<=3.6?"poor":"bad",inboundAudio:j.inbound[0],outboundAudio:j.outbound[0],remoteInboundAudio:l.inbound[0],remoteOutboundAudio:l.outbound[0]}}(c),a.uuid),yield a.execute(new a2(b,c))});return{start:(e,g,h)=>f(this,void 0,void 0,function*(){yield a.execute(new a0(b)),c.on("timeline",d),yield new Promise(a=>setTimeout(a,500)),c.addConnection({pc:e,peerId:g,connectionId:h})}),stop:d=>f(this,void 0,void 0,function*(){var e;let f,g,h,i=c.getTimeline();P(aQ.StatsReport,i,a.uuid),"file"===d&&(e=`webrtc-stats-${b}-${Date.now()}`,f=new Blob([JSON.stringify(i)],{type:"application/json"}),g=URL.createObjectURL(f),(h=document.createElement("a")).href=g,h.download=`${e}.json`,h.click(),URL.revokeObjectURL(g)),yield a.execute(new a1(b)),c.removeAllPeers(),c.destroy()})}}(this._session))})}_getSenderByKind(a){return this.instance.getSenders().find(({track:b})=>b&&b.kind===a)}_checkMediaToNegotiate(a){if(!this._getSenderByKind(a)){let b=this.instance.addTransceiver(a);r.info("Add transceiver",a,b)}}_createOffer(){return f(this,void 0,void 0,function*(){if(this._isOffer()){this._constraints.offerToReceiveAudio=!!this.options.audio,r.info("_createOffer - this._constraints",this._constraints);try{let a=yield this.instance.createOffer(this._constraints);return yield this._setLocalDescription(a),this._isTrickleIce()||this._sdpReady(),a}catch(a){r.error("Peer _createOffer error:",a)}}})}_setRemoteDescription(a){return f(this,void 0,void 0,function*(){r.debug("Setting remote description",a),yield this.instance.setRemoteDescription(a)})}_createAnswer(){return f(this,void 0,void 0,function*(){if(this._isAnswer()){if("stable"!==this.instance.signalingState&&"have-remote-offer"!==this.instance.signalingState)return r.debug("Skipping negotiation, state:",this.instance.signalingState),console.log("  - But the signaling state isn't stable, so triggering rollback"),void(yield Promise.all([this.instance.setLocalDescription({type:"rollback"}),this.instance.setRemoteDescription({sdp:this.options.remoteSdp,type:aR.Offer})]));this._logTransceivers();try{let a=yield this.instance.createAnswer();return yield this._setLocalDescription(a),a}catch(a){r.error("Peer _createAnswer error:",a)}}})}_setLocalDescription(a){return f(this,void 0,void 0,function*(){yield this.instance.setLocalDescription(a)})}_sdpReady(){v(this.onSdpReadyTwice)&&this.onSdpReadyTwice(this.instance.localDescription)}_retrieveLocalStream(){return f(this,void 0,void 0,function*(){var a;let b;return(b=this.options.localStream)&&b instanceof MediaStream?this.options.localStream:ac((yield(a=this.options,f(void 0,void 0,void 0,function*(){let{audio:b=!0,micId:c}=a,{micLabel:d=""}=a;return c&&(c=yield af(c,d,aX.AudioIn).catch(a=>null))&&("boolean"==typeof b&&(b={}),b.deviceId={exact:c}),{audio:b}}))))})}_resetJitterBuffer(){return f(this,void 0,void 0,function*(){try{let a=this.instance.getReceivers().find(a=>a.track&&"audio"===a.track.kind);a&&"jitterBufferTarget"in a&&(a.jitterBufferTarget=20,r.debug("[jitter] target set to",a.jitterBufferTarget,"ms"))}catch(a){r.error("Peer _resetJitterBuffer error:",a)}})}_isOffer(){return this.type===aR.Offer}_isAnswer(){return this.type===aR.Answer}_isTrickleIce(){return!0===this.options.trickleIce}_config(){let{prefetchIceCandidates:a,forceRelayCandidate:b}=this.options,c={bundlePolicy:"balanced",iceCandidatePoolSize:10*!!a,iceServers:[m,o],iceTransportPolicy:b?"relay":"all"};return r.info("RTC config",c),c}close(){var a;return f(this,void 0,void 0,function*(){yield null==(a=this.statsReporter)?void 0:a.stop(this.debugOutput),this.instance&&(this.instance.close(),this.instance=null)})}}class a4{constructor(a,b){this.session=a,this.id="",this.state=aU[aU.New],this.prevState="",this.channels=[],this.role=aV.Participant,this.extension=null,this._state=aU.New,this._prevState=aU.New,this.gotAnswer=!1,this.gotEarly=!1,this._lastSerno=0,this._targetNodeId=null,this._iceTimeout=null,this._iceDone=!1,this._statsBindings=[],this._statsIntervalId=null,this._pendingIceCandidates=[],this._isRemoteDescriptionSet=!1,this._checkConferenceSerno=a=>{let b=a<0||!this._lastSerno||this._lastSerno&&a===this._lastSerno+1;return b&&a>=0&&(this._lastSerno=a),b},this._doStats=()=>{this.peer&&this.peer.instance&&0!==this._statsBindings.length&&this.peer.instance.getStats().then(a=>{a.forEach(a=>{this._statsBindings.forEach(b=>{if(b.callback){if(b.constraints){for(var c in b.constraints)if(b.constraints.hasOwnProperty(c)&&b.constraints[c]!==a[c])return}b.callback(a)}})})})};const{iceServers:c,speaker:d,micId:e,micLabel:f,camId:g,camLabel:h,localElement:i,remoteElement:j,options:k,mediaConstraints:{audio:l},ringtoneFile:m,ringbackFile:n}=a;this.options=Object.assign({},I,{audio:l,iceServers:c,localElement:i,remoteElement:j,micId:e,micLabel:f,camId:g,camLabel:h,speakerId:d,ringtoneFile:m,ringbackFile:n,debug:k.debug,debugOutput:k.debugOutput,trickleIce:k.trickleIce,prefetchIceCandidates:k.prefetchIceCandidates,keepConnectionAliveOnSocketClose:k.keepConnectionAliveOnSocketClose},b),this._onMediaError=this._onMediaError.bind(this),this._onPeerConnectionFailureError=this._onPeerConnectionFailureError.bind(this),this._onTrickleIceSdp=this._onTrickleIceSdp.bind(this),this._registerPeerEvents=this._registerPeerEvents.bind(this),this._registerTrickleIcePeerEvents=this._registerTrickleIcePeerEvents.bind(this),this._init(),this.options&&(this._ringtone=am(this.options.ringtoneFile,"_ringtone"),this._ringback=am(this.options.ringbackFile,"_ringback"))}get performanceMetrics(){let a=performance.measure("peer-creation","peer-creation-start","peer-creation-end"),b=performance.measure("ice-gathering","ice-gathering-start","ice-gathering-end"),c=performance.measure("sdp-send","sdp-send-start","sdp-send-end"),d=performance.measure("total-duration","peer-creation-start","sdp-send-end"),e=a=>`${a.toFixed(2)}ms`;return{"Peer Creation":{duration:e(a.duration)},"ICE Gathering":{duration:e(b.duration)},"SDP Send":{duration:e(c.duration)},"Total Duration":{duration:e(d.duration)}}}get nodeId(){return this._targetNodeId}set nodeId(a){this._targetNodeId=a}get telnyxIDs(){return{telnyxCallControlId:this.options.telnyxCallControlId,telnyxSessionId:this.options.telnyxSessionId,telnyxLegId:this.options.telnyxLegId}}get localStream(){return this.options.localStream}get remoteStream(){return this.options.remoteStream}get memberChannel(){return`conference-member.${this.id}`}invite(){return f(this,void 0,void 0,function*(){this.direction=aS.Outbound,this.options.trickleIce&&this._resetTrickleIceCandidateState(),performance.mark("peer-creation-start"),this.peer=new a3(aR.Offer,this.options,this.session,this._onTrickleIceSdp,this.options.trickleIce?this._registerTrickleIcePeerEvents:this._registerPeerEvents),yield this.peer.init()})}answer(a={}){var b;return f(this,void 0,void 0,function*(){performance.mark("new-call-start"),this.stopRingtone(),this.direction=aS.Inbound,(null==(b=null==a?void 0:a.customHeaders)?void 0:b.length)>0&&(this.options=Object.assign(Object.assign({},this.options),{customHeaders:a.customHeaders})),this.options.trickleIce&&this._resetTrickleIceCandidateState(),performance.mark("peer-creation-start"),this.peer=new a3(aR.Answer,this.options,this.session,this._onTrickleIceSdp,this.options.trickleIce?this._registerTrickleIcePeerEvents:this._registerPeerEvents),yield this.peer.init(),performance.mark("new-call-end")})}playRingtone(){an(this._ringtone)}stopRingtone(){ao(this._ringtone)}playRingback(){an(this._ringback)}stopRingback(){ao(this._ringback)}hangup(a,b){var c,d,e;let f=a||{};this.cause=f.cause||"NORMAL_CLEARING",this.causeCode=f.causeCode||16,this.sipCode=f.sipCode||null,this.sipReason=f.sipReason||null,this.sipCallId=f.sip_call_id||null,this.options.customHeaders=[...null!=(c=this.options.customHeaders)?c:[],...null!=(e=null==(d=null==f?void 0:f.dialogParams)?void 0:d.customHeaders)?e:[]],this.setState(aU.Hangup);let g=()=>{var a;return null==(a=this.peer)||a.close(),this.setState(aU.Destroy)};if(this.stopRingtone(),this.stopRingback(),!1!==b){let a=new av({sipCode:this.sipCode,sip_call_id:this.sipCallId,sessid:this.session.sessionid,dialogParams:this.options,cause:"USER_BUSY",causeCode:17});this._execute(a).catch(a=>{r.error("telnyx_rtc.bye failed!",a),P(aQ.Error,{error:a,sessionId:this.session.sessionid},this.session.uuid)}).then(g.bind(this))}else g()}hold(){let a=new ay({sessid:this.session.sessionid,action:"hold",dialogParams:this.options});return this._execute(a).then(this._handleChangeHoldStateSuccess.bind(this)).catch(this._handleChangeHoldStateError.bind(this))}unhold(){let a=new ay({sessid:this.session.sessionid,action:"unhold",dialogParams:this.options});return this._execute(a).then(this._handleChangeHoldStateSuccess.bind(this)).catch(this._handleChangeHoldStateError.bind(this))}toggleHold(){let a=new ay({sessid:this.session.sessionid,action:"toggleHold",dialogParams:this.options});return this._execute(a).then(this._handleChangeHoldStateSuccess.bind(this)).catch(this._handleChangeHoldStateError.bind(this))}dtmf(a){let b=new az({sessid:this.session.sessionid,dtmf:a,dialogParams:this.options});this._execute(b)}message(a,b){let c={from:this.session.options.login,to:a,body:b},d=new az({sessid:this.session.sessionid,msg:c,dialogParams:this.options});this._execute(d)}muteAudio(){ak(this.options.localStream)}unmuteAudio(){aj(this.options.localStream)}toggleAudioMute(){al(this.options.localStream)}setAudioInDevice(a){return f(this,void 0,void 0,function*(){let{instance:b}=this.peer,c=b.getSenders().find(({track:{kind:a}})=>"audio"===a);if(c){let b,d=yield(b={audio:{deviceId:{exact:a}}},navigator.mediaDevices.getUserMedia(b)),e=d.getAudioTracks()[0];c.replaceTrack(e),this.options.micId=a;let{localStream:f}=this.options;f.getAudioTracks().forEach(a=>a.stop()),f.getVideoTracks().forEach(a=>d.addTrack(a)),this.options.localStream=d}})}muteVideo(){ai(this.options.localStream,"video",!1)}unmuteVideo(){ai(this.options.localStream,"video",!0)}toggleVideoMute(){ai(this.options.localStream,"video",null)}setVideoDevice(a){return f(this,void 0,void 0,function*(){let{instance:b}=this.peer,c=b.getSenders().find(({track:{kind:a}})=>"video"===a);if(c){let b,d=yield(b={video:{deviceId:{exact:a}}},navigator.mediaDevices.getUserMedia(b)),e=d.getVideoTracks()[0];c.replaceTrack(e);let{localElement:f,localStream:g}=this.options;$(f,d),this.options.camId=a,g.getAudioTracks().forEach(a=>d.addTrack(a)),g.getVideoTracks().forEach(a=>a.stop()),this.options.localStream=d}})}deaf(){ak(this.options.remoteStream)}undeaf(){aj(this.options.remoteStream)}toggleDeaf(){al(this.options.remoteStream)}setBandwidthEncodingsMaxBps(a,b){return f(this,void 0,void 0,function*(){if(!this||!this.peer)return void r.error("Could not set bandwidth (reason: no peer connection). Dynamic bandwidth can only be set when there is a call running - is there any call running?)");let{instance:c}=this.peer,d=c.getSenders();if(!d)return void r.error("Could not set bandwidth (reason: no senders). Dynamic bandwidth can only be set when there is a call running - is there any call running?)");let e=d.find(({track:{kind:a}})=>a===b);if(e){let c=e.getParameters();c.encodings||(c.encodings=[{rid:"h"}]),r.info("Parameters: ",c),r.info("Setting max ","audio"===b?"audio":"video"," bandwidth to: ",a," [bps]"),c.encodings[0].maxBitrate=a,yield e.setParameters(c).then(()=>{r.info("audio"===b?"New audio":"New video"," bandwidth settings in use: ",e.getParameters())}).catch(a=>console.error(a))}else r.error("Could not set bandwidth (reason: no "+b+" sender). Dynamic bandwidth can only be set when there is a call running - is there any call running?)")})}setAudioBandwidthEncodingsMaxBps(a){this.setBandwidthEncodingsMaxBps(a,"audio")}setVideoBandwidthEncodingsMaxBps(a){this.setBandwidthEncodingsMaxBps(a,"video")}getStats(a,b){!a||(this._statsBindings.push({callback:a,constraints:b}),this._statsIntervalId||this._startStats(2e3))}setState(a){switch(this._prevState=this._state,this._state=a,this.state=aU[this._state].toLowerCase(),this.prevState=aU[this._prevState].toLowerCase(),r.info(`Call ${this.id} state change from ${this.prevState} to ${this.state}`),this._dispatchNotification({type:H.callUpdate,call:this}),a){case aU.Purge:this.hangup({cause:"PURGE",causeCode:"01"},!1);break;case aU.Active:setTimeout(()=>{let{remoteElement:a,speakerId:b}=this.options;a&&b&&_(a,b)},0);break;case aU.Destroy:this._finalize()}}handleMessage(a){let{method:b,params:c}=a;switch(b){case aT.Answer:if(this.gotAnswer=!0,this._state>=aU.Active)return;this._state>=aU.Early&&this.setState(aU.Active),this.gotEarly||this._onRemoteSdp(c.sdp),this.stopRingback(),this.stopRingtone();break;case aT.Media:if(this._state>=aU.Early)return;this.gotEarly=!0,this._onRemoteSdp(c.sdp);break;case aT.Display:case aT.Attach:{let{display_name:a,display_number:d,display_direction:e}=c;this.extension=d;let f=e===aS.Inbound?aS.Outbound:aS.Inbound,g={type:H[b],call:this,displayName:a,displayNumber:d,displayDirection:f};P(aQ.Notification,g,this.id)||P(aQ.Notification,g,this.session.uuid);break}case aT.Candidate:this._addIceCandidate(c);break;case aT.Info:case aT.Event:{let a=Object.assign(Object.assign({},c),{type:H.generic,call:this});P(aQ.Notification,a,this.id)||P(aQ.Notification,a,this.session.uuid);break}case aT.Ringing:this.playRingback(),c.telnyx_call_control_id&&(this.options.telnyxCallControlId=c.telnyx_call_control_id),c.telnyx_session_id&&(this.options.telnyxSessionId=c.telnyx_session_id),c.telnyx_leg_id&&(this.options.telnyxLegId=c.telnyx_leg_id);break;case aT.Bye:let d=c.client_state||c.clientState;d&&(this.options.clientState=d),this.stopRingback(),this.stopRingtone(),this.hangup(c,!1)}}handleConferenceUpdate(a,b){return f(this,void 0,void 0,function*(){if(!this._checkConferenceSerno(a.wireSerno)&&a.name!==b.laName)return r.error("ConferenceUpdate invalid wireSerno or packet name:",a),"INVALID_PACKET";let{action:c,data:d,hashKey:e=String(this._lastSerno),arrIndex:f}=a;switch(c){case"bootObj":{this._lastSerno=0;let{chatChannel:a,infoChannel:c,modChannel:e,laName:f,conferenceMemberID:g,role:h}=b;this._dispatchConferenceUpdate({action:aW.Join,conferenceName:f,participantId:Number(g),role:h}),a&&(yield this._subscribeConferenceChat(a)),c&&(yield this._subscribeConferenceInfo(c));let i=[];for(let a in d)i.push(Object.assign({callId:d[a][0],index:Number(a)},t(d[a][1])));this._dispatchConferenceUpdate({action:aW.Bootstrap,participants:i});break}case"add":this._dispatchConferenceUpdate(Object.assign({action:aW.Add,callId:e,index:f},t(d)));break;case"modify":this._dispatchConferenceUpdate(Object.assign({action:aW.Modify,callId:e,index:f},t(d)));break;case"del":this._dispatchConferenceUpdate(Object.assign({action:aW.Delete,callId:e,index:f},t(d)));break;case"clear":this._dispatchConferenceUpdate({action:aW.Clear});break;default:this._dispatchConferenceUpdate({action:c,data:d,callId:e,index:f})}})}_addChannel(a){this.channels.includes(a)||this.channels.push(a);let b=this.session.relayProtocol;this.session._existsSubscription(b,a)&&(this.session.subscriptions[b][a]=Object.assign(Object.assign({},this.session.subscriptions[b][a]),{callId:this.id}))}_subscribeConferenceChat(a){return f(this,void 0,void 0,function*(){let b={nodeId:this.nodeId,channels:[a],handler:a=>{let{direction:b,from:c,fromDisplay:d,message:e,type:f}=a.data;this._dispatchConferenceUpdate({action:aW.ChatMessage,direction:b,participantNumber:c,participantName:d,messageText:e,messageType:f,messageId:a.eventSerno})}};ag((yield this.session.vertoSubscribe(b).catch(a=>{r.error("ConfChat subscription error:",a)})),a)&&(this._addChannel(a),Object.defineProperties(this,{sendChatMessage:{configurable:!0,value:(b,c)=>{this.session.vertoBroadcast({nodeId:this.nodeId,channel:a,data:{action:"send",message:b,type:c}})}}}))})}_subscribeConferenceInfo(a){return f(this,void 0,void 0,function*(){let b={nodeId:this.nodeId,channels:[a],handler:a=>{let{eventData:b}=a;"layout-info"===b.contentType?(b.callID=this.id,aE(this.session,b)):r.error("Conference-Info unknown contentType",a)}};ag((yield this.session.vertoSubscribe(b).catch(a=>{r.error("ConfInfo subscription error:",a)})),a)&&this._addChannel(a)})}_confControl(a,b={}){let c=Object.assign({application:"conf-control",callID:this.id,value:null},b);this.session.vertoBroadcast({nodeId:this.nodeId,channel:a,data:c})}_handleChangeHoldStateSuccess(a){return"active"===a.holdState?this.setState(aU.Active):this.setState(aU.Held),!0}_handleChangeHoldStateError(a){return r.error(`Failed to ${a.action} on call ${this.id}`),!1}_onRemoteSdp(a){return f(this,void 0,void 0,function*(){let b=new RTCSessionDescription({sdp:a,type:aR.Answer});yield this.peer.instance.setRemoteDescription(b).then(()=>{this.options.trickleIce&&(this._isRemoteDescriptionSet=!0,this._flushPendingTrickleIceCandidates()),this.gotEarly&&this.setState(aU.Early),this.gotAnswer&&this.setState(aU.Active)}).catch(a=>{r.error("Call setRemoteDescription Error: ",a),this.hangup()})})}_requestAnotherLocalDescription(){v(this.peer.onSdpReadyTwice)?P(aQ.Error,{error:Error("SDP without candidates for the second time!"),sessionId:this.session.sessionid},this.session.uuid):(Object.defineProperty(this.peer,"onSdpReadyTwice",{value:this._onIceSdp.bind(this)}),this._iceDone=!1,this.peer.startNegotiation())}_onIceSdp(a){var b,c;this._iceTimeout&&clearTimeout(this._iceTimeout),this._iceTimeout=null,this._iceDone=!0;let{sdp:d,type:e}=a;if(-1===d.indexOf("candidate"))return r.info("No candidate - retry \n"),void this._requestAnotherLocalDescription();null==(c=null==(b=this.peer)?void 0:b.instance)||c.removeEventListener("icecandidate",this._onIce),performance.mark("ice-gathering-end");let f=null,g={sessid:this.session.sessionid,sdp:d,dialogParams:this.options,"User-Agent":`Web-${ap}`};switch(e){case aR.Offer:this.setState(aU.Requesting),f=new as(g);break;case aR.Answer:this.setState(aU.Answering),f=!0===this.options.attach?new au(g):new at(g);break;default:return r.error(`${this.id} - Unknown local SDP type:`,a),this.hangup({},!1)}performance.mark("sdp-send-start"),this._execute(f).then(a=>{let{node_id:b=null}=a;this._targetNodeId=b,e===aR.Offer?this.setState(aU.Trying):this.setState(aU.Active)}).catch(a=>{r.error(`${this.id} - Sending ${e} error:`,a),this.hangup()}).finally(()=>{performance.mark("sdp-send-end"),console.group("Performance Metrics"),console.table(this.performanceMetrics),console.groupEnd(),performance.clearMarks()})}_onTrickleIceSdp(a){if(!a)return r.error("No SDP data provided"),this.hangup({},!1);let{sdp:b,type:c}=a,d=null,e={sessid:this.session.sessionid,sdp:b,dialogParams:this.options,trickle:!0,"User-Agent":`Web-${ap}`};switch(c){case aR.Offer:this.setState(aU.Requesting),d=new as(e);break;case aR.Answer:this.setState(aU.Answering),d=!0===this.options.attach?new au(e):new at(e);break;default:return r.error(`${this.id} - Unknown local SDP type:`,a),this.hangup({},!1)}performance.mark("sdp-send-start"),this._execute(d).then(a=>{let{node_id:b=null}=a;this._targetNodeId=b,c===aR.Offer?this.setState(aU.Trying):this.setState(aU.Active)}).catch(a=>{r.error(`${this.id} - Sending ${c} error:`,a),this.hangup()}).finally(()=>{performance.mark("sdp-send-end")})}_onIce(a){let{instance:b}=this.peer;null===this._iceTimeout&&(this._iceTimeout=setTimeout(()=>this._onIceSdp(b.localDescription),1e3)),a.candidate?r.debug("RTCPeer Candidate:",a.candidate):this._onIceSdp(b.localDescription)}_onTrickleIce(a){a.candidate&&a.candidate.candidate?(r.debug("RTCPeer Candidate:",a.candidate),this._sendIceCandidate(a.candidate)):this._sendEndOfCandidates()}_sendIceCandidate(a){let b=new aw({sessid:this.session.sessionid,candidate:a.candidate,sdpMLineIndex:a.sdpMLineIndex,sdpMid:a.sdpMid,dialogParams:this.options});this._execute(b)}_addIceCandidate(a){this._isRemoteDescriptionSet?this._addIceCandidateToPeer(a):(r.debug("Remote description not set. Queued ICE candidate.",a),this._pendingIceCandidates.push(a))}_addIceCandidateToPeer(a){Promise.resolve(this.peer.instance.addIceCandidate(a)).then(()=>{r.debug("Successfully added ICE candidate:",a)}).catch(b=>{r.error("Failed to add ICE candidate:",b,a)})}_sendEndOfCandidates(){let a=new ax({sessid:this.session.sessionid,endOfCandidates:!0,dialogParams:this.options});this._execute(a),performance.mark("ice-gathering-end")}_resetTrickleIceCandidateState(){this._pendingIceCandidates=[],this._isRemoteDescriptionSet=!1}_flushPendingTrickleIceCandidates(){if(!this._pendingIceCandidates.length)return;let a=[...this._pendingIceCandidates];this._pendingIceCandidates=[],a.forEach(a=>{this._addIceCandidateToPeer(a)})}_registerPeerEvents(a){this._iceDone=!1,a.onicecandidate=a=>{this._iceDone||this._onIce(a)},a.addEventListener("addstream",a=>{this.options.remoteStream=a.stream}),a.addEventListener("track",a=>{this.options.remoteStream=a.streams[0];let{remoteElement:b,remoteStream:c,screenShare:d}=this.options;!1===d&&$(b,c)})}_registerTrickleIcePeerEvents(a){a.onicecandidate=a=>{this._onTrickleIce(a)},a.onicegatheringstatechange=b=>{r.debug("ICE gathering state changed:",a.iceGatheringState),"complete"===a.iceGatheringState&&r.debug("Finished gathering candidates")},a.onicecandidateerror=a=>{r.debug("ICE candidate error:",a)},a.addEventListener("addstream",a=>{this.options.remoteStream=a.stream}),a.addEventListener("track",a=>{this.options.remoteStream=a.streams[0];let{remoteElement:b,remoteStream:c,screenShare:d}=this.options;!1===d&&$(b,c)})}_onMediaError(a){this._dispatchNotification({type:H.userMediaError,error:a}),this.hangup({},!1)}_onPeerConnectionFailureError(a){this._dispatchNotification({type:H.peerConnectionFailureError,error:a}),this.hangup({},!1)}_dispatchConferenceUpdate(a){this._dispatchNotification(Object.assign({type:H.conferenceUpdate,call:this},a))}_dispatchNotification(a){!0!==this.options.screenShare&&(P(aQ.Notification,a,this.id,!1)||P(aQ.Notification,a,this.session.uuid))}_execute(a){return this.nodeId&&(a.targetNodeId=this.nodeId),this.session.execute(a)}_init(){let{id:a,userVariables:b,remoteCallerNumber:c,onNotification:d}=this.options;this.options.id=a?a.toString():k(),this.id=this.options.id,b&&0!==Object.keys(b).length||(this.options.userVariables=this.session.options.userVariables||{}),c||(this.options.remoteCallerNumber=this.options.destinationNumber),this.session.calls[this.id]=this,M(aQ.MediaError,this._onMediaError,this.id),M(aQ.PeerConnectionFailureError,this._onPeerConnectionFailureError,this.id),v(d)&&M(aQ.Notification,d.bind(this),this.id),this.setState(aU.New),r.info("New Call with Options:",this.options)}_finalize(){this._stopStats(),this.peer&&this.peer.instance&&(this.peer.instance.close(),this.peer=null);let{remoteStream:a,localStream:b}=this.options;ab(a),ab(b),O(aQ.MediaError,null,this.id),O(aQ.PeerConnectionFailureError,null,this.id),this.session.calls[this.id]=null,delete this.session.calls[this.id]}_startStats(a){this._statsIntervalId=setInterval(this._doStats,a),r.info("Stats started")}_stopStats(){this._statsIntervalId&&(clearInterval(this._statsIntervalId),this._statsIntervalId=null),r.info("Stats stopped")}}a4.setStateTelnyx=a=>{if(a){switch(a._state){case aU.Requesting:case aU.Recovering:case aU.Trying:case aU.Early:a.state="connecting";break;case aU.Active:a.state="active";break;case aU.Held:a.state="held";break;case aU.Hangup:case aU.Destroy:a.state="done";break;case aU.Answering:a.state="ringing";break;case aU.New:a.state="new"}return a}};class a5 extends a4{constructor(){super(...arguments),this._statsInterval=null,this.sendConversationMessage=(a,b)=>this.session.execute(new aD(a,b))}hangup(a={},b=!0){this.screenShare instanceof a5&&this.screenShare.hangup(a,b),super.hangup(a,b)}startScreenShare(a){return f(this,void 0,void 0,function*(){var b;let c=yield(b={video:!0},navigator.mediaDevices.getDisplayMedia(b));c.getTracks().forEach(a=>{a.addEventListener("ended",()=>{this.screenShare&&this.screenShare.hangup()})});let{remoteCallerName:d,remoteCallerNumber:e,callerName:f,callerNumber:g}=this.options,h=Object.assign({screenShare:!0,localStream:c,destinationNumber:`${this.extension}-screen`,remoteCallerName:d,remoteCallerNumber:`${e}-screen`,callerName:`${f} (Screen)`,callerNumber:`${g} (Screen)`},a);return this.screenShare=new a5(this.session,h),this.screenShare.invite(),this.screenShare})}stopScreenShare(){this.screenShare instanceof a5&&this.screenShare.hangup()}setAudioOutDevice(a){return f(this,void 0,void 0,function*(){this.options.speakerId=a;let{remoteElement:b,speakerId:c}=this.options;return!(!b||!c)&&_(b,c)})}_finalize(){this._stats(!1),super._finalize()}_stats(a=!0){if(!1===a)return clearInterval(this._statsInterval);r.setLevel(2),this._statsInterval=window.setInterval(()=>f(this,void 0,void 0,function*(){let a=yield this.peer.instance.getStats(null),b="",c=["certificate","codec","peer-connection","stream","local-candidate","remote-candidate"],d=["id","type","timestamp"];a.forEach(a=>{c.includes(a.type)||(b+=`
${a.type}
`,Object.keys(a).forEach(c=>{d.includes(c)||(b+=`	${c}: ${a[c]}
`)}))}),r.info(b)}),2e3)}}class a6 extends Z{constructor(a){super(a),this.calls={},this.autoRecoverCalls=!0,this._iceServers=[],this._localElement=null,this._remoteElement=null,this._jwtAuth=!0,this._audioConstraints=!0,this._speaker=null,this._onlineHandler=null,this._offlineHandler=null,this._wasOffline=!1,this.iceServers=a.iceServers,this.ringtoneFile=a.ringtoneFile,this.ringbackFile=a.ringbackFile,this._setupNetworkListeners()}get reconnectDelay(){return 1e3}getIsRegistered(){let a=Object.create(null,{getIsRegistered:{get:()=>super.getIsRegistered}});return f(this,void 0,void 0,function*(){return a.getIsRegistered.call(this)})}connect(){let a=Object.create(null,{connect:{get:()=>super.connect}});return f(this,void 0,void 0,function*(){a.connect.call(this)})}checkPermissions(a=!0,b=!0){return f(this,void 0,void 0,function*(){try{let c=yield ac({audio:a,video:b});return ab(c),!0}catch(a){return!1}})}logout(){this.disconnect()}disconnect(){let a=Object.create(null,{disconnect:{get:()=>super.disconnect}});return f(this,void 0,void 0,function*(){Object.keys(this.calls).forEach(a=>this.calls[a].setState(aU.Purge)),this.calls={},this._cleanupNetworkListeners(),yield a.disconnect.call(this)})}handleLoginError(a){super._handleLoginError(a)}speedTest(a){return new Promise((b,c)=>{if(N(aQ.SpeedTest,c=>{let{upDur:d,downDur:e}=c,f=e?8*a/(e/1e3)/1024:0;b({upDur:d,downDur:e,upKps:(d?8*a/(d/1e3)/1024:0).toFixed(0),downKps:f.toFixed(0)})},this.uuid),!(a=Number(a)))return c(`Invalid parameter 'bytes': ${a}`);this.executeRaw(`#SPU ${a}`);let d=a/1024;a%1024&&d++;let e=".".repeat(1024);for(let a=0;a<d;a++)this.executeRaw(`#SPB ${e}`);this.executeRaw("#SPE")})}getDevices(){return ad().catch(a=>(P(aQ.MediaError,a,this.uuid),[]))}getVideoDevices(){return ad(aX.Video).catch(a=>(P(aQ.MediaError,a,this.uuid),[]))}getAudioInDevices(){return ad(aX.AudioIn).catch(a=>(P(aQ.MediaError,a,this.uuid),[]))}getAudioOutDevices(){return ad(aX.AudioOut).catch(a=>(console.error("getAudioOutDevices",a),P(aQ.MediaError,a,this.uuid),[]))}validateDeviceId(a,b,c){return af(a,b,c)}getDeviceResolutions(a){return f(this,void 0,void 0,function*(){try{return yield f(void 0,void 0,void 0,function*(){let b=[],c=yield ac({video:{deviceId:{exact:a}}}),d=c.getVideoTracks()[0];for(let a=0;a<ae.length;a++){let[c,e]=ae[a];(yield d.applyConstraints({width:{exact:c},height:{exact:e}}).then(()=>!0).catch(()=>!1))&&b.push({resolution:`${c}x${e}`,width:c,height:e})}return ab(c),b})}catch(a){throw a}})}get mediaConstraints(){return{audio:this._audioConstraints}}setAudioSettings(a){return f(this,void 0,void 0,function*(){let b;if(!a)throw Error("You need to provide the settings object");let{micId:c,micLabel:d}=a,g=e(a,["micId","micLabel"]);return b=navigator.mediaDevices.getSupportedConstraints(),Object.keys(g).map(a=>{b.hasOwnProperty(a)&&null!==g[a]&&void 0!==g[a]||delete g[a]}),this._audioConstraints=yield f(void 0,void 0,void 0,function*(){let{deviceId:a}=g;if(void 0===a&&(c||d)){let a=yield af(c,d,"audioinput").catch(a=>null);a&&(g.deviceId={exact:a})}return g}),this.micId=c,this.micLabel=d,this._audioConstraints})}disableMicrophone(){this._audioConstraints=!1}enableMicrophone(){this._audioConstraints=!0}set iceServers(a){let b={urls:["stun:stun.l.google.com:19302"]};this._iceServers="boolean"==typeof a?a?[b]:[]:a||[o,n,b]}get iceServers(){return this._iceServers}set speaker(a){this._speaker=a}get speaker(){return this._speaker}set localElement(a){this._localElement=w(a)}get localElement(){return this._localElement}set remoteElement(a){this._remoteElement=w(a)}get remoteElement(){return this._remoteElement}vertoBroadcast({nodeId:a,channel:b="",data:c}){if(!b)throw Error(`Invalid channel for broadcast: ${b}`);let d=new aA({sessid:this.sessionid,eventChannel:b,data:c});a&&(d.targetNodeId=a),this.execute(d).catch(a=>a)}vertoSubscribe({nodeId:a,channels:b=[],handler:c}){return f(this,void 0,void 0,function*(){if(!(b=b.filter(a=>a&&!this._existsSubscription(this.relayProtocol,a))).length)return{};let d=new aB({sessid:this.sessionid,eventChannel:b});a&&(d.targetNodeId=a);let e=yield this.execute(d),{unauthorized:f=[],subscribed:g=[]}=ah(e);return f.length&&f.forEach(a=>this._removeSubscription(this.relayProtocol,a)),g.forEach(a=>this._addSubscription(this.relayProtocol,c,a)),e})}vertoUnsubscribe({nodeId:a,channels:b=[]}){return f(this,void 0,void 0,function*(){if(!(b=b.filter(a=>a&&this._existsSubscription(this.relayProtocol,a))).length)return{};let c=new aC({sessid:this.sessionid,eventChannel:b});a&&(c.targetNodeId=a);let d=yield this.execute(c),{unsubscribed:e=[],notSubscribed:f=[]}=ah(d);return e.forEach(a=>this._removeSubscription(this.relayProtocol,a)),f.forEach(a=>this._removeSubscription(this.relayProtocol,a)),d})}_setupNetworkListeners(){}_cleanupNetworkListeners(){}static telnyxStateCall(a){return a5.setStateTelnyx(a)}}class a7{constructor(a,b){this.code=b,this.message=a}}class a8 extends V{constructor(a){super(),this.method="anonymous_login";const{target_type:b,target_id:c,target_version_id:d,userVariables:e,sessionId:f,reconnection:g}=a,h={target_type:b,target_id:c,userVariables:e,reconnection:g,"User-Agent":{sdkVersion:ap,data:navigator.userAgent}};f&&(h.sessid=f),d&&(h.target_version_id=d),this.buildRequest({method:this.method,params:h})}}class a9{constructor(a){this.session=a,this.handleLogin=()=>f(this,void 0,void 0,function*(){let{login:a,password:b,passwd:c,login_token:d,userVariables:e}=this.session.options,f=new aq(a,b||c,d,this.session.sessionid,e,!!G()),g=yield this.session.execute(f).catch(this.session.handleLoginError);g&&(this.session.sessionid=g.sessid)}),this.handleAnonymousLogin=()=>f(this,void 0,void 0,function*(){let{anonymous_login:a}=this.session.options,b=new a8({target_id:a.target_id,target_type:a.target_type,target_version_id:a.target_version_id,sessionId:this.session.sessionid,userVariables:this.session.options.userVariables,reconnection:!!G()}),c=yield this.session.execute(b).catch(this.session.handleLoginError);c&&(this.session.sessionid=c.sessid)})}_ack(a,b){let c=new ar(a,b);this.nodeId&&(c.targetNodeId=this.nodeId),this.session.execute(c)}reconnectDelay(){return 1e3*z(2,6)}handleMessage(a){var b;let{session:c}=this,{id:d,method:e,params:g={},voice_sdk_id:h}=a,i=null==g?void 0:g.callID,j=null==g?void 0:g.eventChannel,k=null==g?void 0:g.eventType,l=e===aT.Attach,m=!1;if("channelPvtData"===k)return this._handlePvtEvent(g.pvtData);if(i&&c.calls.hasOwnProperty(i)){if(!l)return c.calls[i].handleMessage(a),void this._ack(d,e);(m=(c.calls[i].options.keepConnectionAliveOnSocketClose||c.options.keepConnectionAliveOnSocketClose)&&!!(null==(b=this.session.calls[i].peer)?void 0:b.instance))?r.info(`[${(new Date).toISOString()}][${i}] re-attaching call due to ATTACH`):(r.debug(`Session Options: ${c.options}`),r.debug(`Call: ${c.calls[i]}`),r.info(`[${(new Date).toISOString()}][${i}] Hanging up the call due to ATTACH`),c.calls[i].hangup({},!1))}let n=()=>{var a,b,d,e,f,h;let j={id:i,remoteSdp:g.sdp,destinationNumber:g.callee_id_number,remoteCallerName:g.caller_id_name,remoteCallerNumber:g.caller_id_number,callerName:g.callee_id_name,callerNumber:g.callee_id_number,attach:l,mediaSettings:g.mediaSettings,debug:null!=(a=c.options.debug)&&a,debugOutput:null!=(b=c.options.debugOutput)?b:"socket",trickleIce:null!=(d=c.options.trickleIce)&&d,prefetchIceCandidates:null!=(e=c.options.prefetchIceCandidates)&&e,forceRelayCandidate:null!=(f=c.options.forceRelayCandidate)&&f,keepConnectionAliveOnSocketClose:null!=(h=c.options.keepConnectionAliveOnSocketClose)&&h};g.telnyx_call_control_id&&(j.telnyxCallControlId=g.telnyx_call_control_id),g.telnyx_session_id&&(j.telnyxSessionId=g.telnyx_session_id),g.telnyx_leg_id&&(j.telnyxLegId=g.telnyx_leg_id),g.client_state&&(j.clientState=g.client_state),g.dialogParams&&g.dialogParams.custom_headers&&g.dialogParams.custom_headers.length&&(j.customHeaders=g.dialogParams.custom_headers);let k=new a5(c,j);return k.nodeId=this.nodeId,k},o=new W(h),p=new Y(h);switch(e){case aT.Ping:this.session.setPingReceived(),this.session.execute(p).then(()=>{a9.receivedAuthenticationRequired=0}).catch(a=>f(this,void 0,void 0,function*(){a.code===this.session.authenticationRequiredErrorCode&&(a9.receivedAuthenticationRequired+=1,a9.receivedAuthenticationRequired>1&&this.session.hasAutoReconnect()&&(r.warn("Ping failed twice with Authentication Required. Re-logging in..."),A(this.session.options)?this.handleLogin():B(this.session.options)&&this.handleAnonymousLogin()))}));break;case aT.Punt:if(m)return void r.info(`[${(new Date).toISOString()}][${i}] Ignoring PUNT due to keepConnectionAliveOnSocketClose`);c.disconnect();break;case aT.Invite:{let a=n();a.playRingtone(),a.setState(aU.Ringing),a.direction=aS.Inbound,this._ack(d,e);break}case aT.Attach:{if(m)return void this.session.execute(new au({sessid:this.session.sessionid,sdp:this.session.calls[i].peer.instance.localDescription.sdp,dialogParams:this.session.calls[i].options,"User-Agent":`Web-${ap}`}));r.info(`[${(new Date).toISOString()}][${i}] Re-creating call instance.`);let b=n();this.session.autoRecoverCalls?b.answer():b.setState(aU.Recovering),b.handleMessage(a);break}case aT.Event:case"webrtc.event":if(!j)return void r.error("Verto received an unknown event:",g);let q=c.relayProtocol,s=j.split(".")[0];c._existsSubscription(q,j)?P(q,g,j):j===c.sessionid?this._handleSessionEvent(g.eventData):c._existsSubscription(q,s)?P(q,g,s):c.calls.hasOwnProperty(j)?c.calls[j].handleMessage(a):P(aQ.Notification,g,c.uuid);break;case aT.Info:g.type=H.generic,P(aQ.Notification,g,c.uuid);break;case aT.ClientReady:this.session.execute(o);break;default:{let b=C(a);if(b){switch(b){case aY.REGISTER:case aY.REGED:c.connection.previousGatewayState!==aY.REGED&&c.connection.previousGatewayState!==aY.REGISTER&&(this.session._triggerKeepAliveTimeoutCheck(),a9.retriedRegister=0,g.type=H.vertoClientReady,P(aQ.Ready,g,c.uuid),c.options.trickleIce&&(r.debug("Trickle ICE is enabled. Checking Gateway support"),this.session.execute(new aw({candidate:""})).catch(a=>{a.code===this.session.invalidMethodErrorCode?(console.warn("Trickle ICE is not supported by the server, disabling it."),r.debug("Trickle ICE check error:",JSON.stringify(a,null,2)),c.options.trickleIce=!1):r.debug("Trickle ICE check:",JSON.stringify(a,null,2))})));break;case aY.UNREGED:case aY.NOREG:if(a9.retriedRegister+=1,5===a9.retriedRegister){a9.retriedRegister=0,P(aQ.Error,{error:new a7("Fail to register the user, the server tried 5 times","UNREGED|NOREG"),sessionId:c.sessionid},c.uuid);break}setTimeout(()=>{this.session.execute(o)},this.reconnectDelay());break;case aY.FAILED:case aY.FAIL_WAIT:if(c.connection.previousGatewayState!==aY.FAILED&&c.connection.previousGatewayState!==aY.FAIL_WAIT){if(!this.session.hasAutoReconnect()){a9.retriedConnect=0,P(aQ.Error,{error:new a7("Fail to connect the server, the server tried 5 times","FAILED|FAIL_WAIT"),sessionId:c.sessionid},c.uuid);break}if(a9.retriedConnect+=1,5===a9.retriedConnect){a9.retriedConnect=0,P(aQ.Error,{error:Error("Connection Retry Failed"),sessionId:c.sessionid},c.uuid);break}setTimeout(()=>{this.session.disconnect().then(()=>{this.session.clearConnection(),this.session.connect()})},this.reconnectDelay())}break;default:r.warn("GatewayState message unknown method:",a)}break}r.debug("Verto message unknown method:",a)}}}_retrieveCallId(a,b){let c=Object.keys(this.session.calls);if("bootObj"!==a.action)return c.find(a=>this.session.calls[a].channels.includes(b));{let b=a.data.find(a=>c.includes(a[0]));if(b instanceof Array)return b[0]}}_handlePvtEvent(a){return f(this,void 0,void 0,function*(){let{session:b}=this,c=b.relayProtocol,{action:d,laChannel:e,laName:f,chatChannel:g,infoChannel:h,modChannel:i,conferenceMemberID:j,role:k,callID:l}=a;switch(d){case"conference-liveArray-join":{let c=()=>{b.vertoBroadcast({nodeId:this.nodeId,channel:e,data:{liveArray:{command:"bootstrap",context:e,name:f}}})},d={nodeId:this.nodeId,channels:[e],handler:({data:d})=>{let g=l||this._retrieveCallId(d,e);if(g&&b.calls.hasOwnProperty(g)){let h=b.calls[g];h._addChannel(e),h.extension=f,h.handleConferenceUpdate(d,a).then(a=>{"INVALID_PACKET"===a&&c()})}}};ag((yield b.vertoSubscribe(d).catch(a=>{r.error("liveArray subscription error:",a)})),e)&&c();break}case"conference-liveArray-part":{let a=null;if(e&&b._existsSubscription(c,e)){let{callId:d=null}=b.subscriptions[c][e];if(a=b.calls[d]||null,null!==d){let c={type:H.conferenceUpdate,action:aW.Leave,conferenceName:f,participantId:Number(j),role:k};P(aQ.Notification,c,d,!1)||P(aQ.Notification,c,b.uuid),null===a&&O(aQ.Notification,null,d)}}let d=[e,g,h,i];b.vertoUnsubscribe({nodeId:this.nodeId,channels:d}).then(({unsubscribedChannels:b=[]})=>{a&&(a.channels=a.channels.filter(a=>!b.includes(a)))}).catch(a=>{r.error("liveArray unsubscribe error:",a)})}}})}_handleSessionEvent(a){switch(a.contentType){case"layout-info":case"layer-info":aE(this.session,a);break;case"logo-info":{let b={type:H.conferenceUpdate,action:aW.LogoInfo,logo:a.logoURL};P(aQ.Notification,b,this.session.uuid)}}}}a9.retriedConnect=0,a9.retriedRegister=0,a9.receivedAuthenticationRequired=0;class ba extends a6{constructor(a){super(a),this.relayProtocol="verto-protocol",this.timeoutErrorCode=-329990,this.handleLoginOnSocketOpen=()=>f(this,void 0,void 0,function*(){this._idle=!1;let{login:a,password:b,passwd:c,login_token:d,userVariables:e,autoReconnect:f=!0}=this.options,g=new aq(a,b||c,d,this.sessionid,e,!!G()),h=yield this.execute(g).catch(this._handleLoginError);h&&(this._autoReconnect=f,this.sessionid=h.sessid)}),this.handleAnonymousLoginOnSocketOpen=()=>f(this,void 0,void 0,function*(){this._idle=!1;let{anonymous_login:a}=this.options,b=new a8({target_id:a.target_id,target_type:a.target_type,target_version_id:a.target_version_id,sessionId:this.sessionid,userVariables:this.options.userVariables,reconnection:!!G()}),c=yield this.execute(b).catch(this._handleLoginError);c&&(this.sessionid=c.sessid)}),window.addEventListener("beforeunload",a=>{this.calls&&Object.keys(this.calls).forEach(a=>{this.calls[a]&&(r.info(`Hanging up call due to page unload: ${a}`),this.calls[a].hangup({},!0))})})}validateOptions(){return A(this.options)||B(this.options)}newCall(a){if(!this.validateCallOptions(a))throw Error("Verto.newCall() error: destinationNumber is required.");performance.mark("new-call-start");let b=new a5(this,a);return b.invite(),performance.mark("new-call-end"),b}broadcast(a){return this.vertoBroadcast(a)}subscribe(a){return this.vertoSubscribe(a)}unsubscribe(a){return this.vertoUnsubscribe(a)}validateCallOptions(a){return!!B(this.options)||!!a.destinationNumber}_onSocketOpen(){return f(this,void 0,void 0,function*(){return A(this.options)?this.handleLoginOnSocketOpen():B(this.options)?this.handleAnonymousLoginOnSocketOpen():void 0})}_onSocketMessage(a){new a9(this).handleMessage(a)}}class bb extends ba{constructor(a){super(a),console.log(`SDK version: ${ap}`)}newCall(a){return super.newCall(a)}static webRTCInfo(){return function(){try{let{browserInfo:a,name:b,version:c,supportAudio:d,supportVideo:e}=function(){if(!window||!window.navigator||!window.navigator.userAgent)throw Error("You should use @telnyx/webrtc in a web browser such as Chrome|Firefox|Safari");if(navigator.userAgent.match(/chrom(e|ium)/gim)&&!navigator.userAgent.match(/OPR\/[0-9]{2}/gi)&&!navigator.userAgent.match(/edg/gim)){let a=navigator.userAgent.match(/chrom(e|ium)\/[0-9]+\./gim)[0].split("/"),b=a[0],c=parseInt(a[1],10);return{browserInfo:navigator.userAgent,name:b,version:c,supportAudio:!0,supportVideo:!0}}if(navigator.userAgent.match(/firefox/gim)&&!navigator.userAgent.match(/OPR\/[0-9]{2}/gi)&&!navigator.userAgent.match(/edg/gim)){let a=navigator.userAgent.match(/firefox\/[0-9]+\./gim)[0].split("/"),b=a[0],c=parseInt(a[1],10);return{browserInfo:navigator.userAgent,name:b,version:c,supportAudio:!0,supportVideo:!1}}if(navigator.userAgent.match(/safari/gim)&&!navigator.userAgent.match(/OPR\/[0-9]{2}/gi)&&!navigator.userAgent.match(/edg/gim)){let a=navigator.userAgent.match(/safari/gim)[0],b=navigator.userAgent.match(/version\/[0-9]+\./gim)[0].split("/"),c=parseInt(b[1],10);return{browserInfo:navigator.userAgent,name:a,version:c,supportAudio:!0,supportVideo:!0}}if(navigator.userAgent.match(/edg/gim)&&!navigator.userAgent.match(/OPR\/[0-9]{2}/gi)){let a=navigator.userAgent.match(/edg\/[0-9]+\./gim)[0].split("/"),b=a[0],c=parseInt(a[1],10);return{browserInfo:navigator.userAgent,name:b,version:c,supportAudio:!0,supportVideo:!0}}throw Error("This browser does not support @telnyx/webrtc. To see browser support list: `TelnyxRTC.webRTCSupportedBrowserList()`")}(),f=window.RTCPeerConnection,g=window.RTCSessionDescription,h=window.RTCIceCandidate,i=window.navigator&&window.navigator.mediaDevices,j=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;return{browserInfo:a,browserName:b,browserVersion:c,supportWebRTC:!!(f&&g&&h&&i&&j),supportWebRTCAudio:d,supportWebRTCVideo:e,supportRTCPeerConnection:!!f,supportSessionDescription:!!g,supportIceCandidate:!!h,supportMediaDevices:!!i,supportGetUserMedia:!!ac}}catch(a){return a.message}}()}static webRTCSupportedBrowserList(){return[{operationSystem:"Android",supported:[{browserName:"Chrome",features:["audio"],supported:aZ.full},{browserName:"Firefox",features:["audio"],supported:aZ.partial},{browserName:"Safari",supported:aZ.not_supported},{browserName:"Edge",supported:aZ.not_supported}]},{operationSystem:"iOS",supported:[{browserName:"Chrome",supported:aZ.not_supported},{browserName:"Firefox",supported:aZ.not_supported},{browserName:"Safari",features:["video","audio"],supported:aZ.full},{browserName:"Edge",supported:aZ.not_supported}]},{operationSystem:"Linux",supported:[{browserName:"Chrome",features:["video","audio"],supported:aZ.full},{browserName:"Firefox",features:["audio"],supported:aZ.partial},{browserName:"Safari",supported:aZ.not_supported},{browserName:"Edge",supported:aZ.not_supported}]},{operationSystem:"MacOS",supported:[{browserName:"Chrome",features:["video","audio"],supported:aZ.full},{browserName:"Firefox",features:["audio"],supported:aZ.partial},{browserName:"Safari",features:["video","audio"],supported:aZ.full},{browserName:"Edge",features:["audio"],supported:aZ.partial}]},{operationSystem:"Windows",supported:[{browserName:"Chrome",features:["video","audio"],supported:aZ.full},{browserName:"Firefox",features:["audio"],supported:aZ.partial},{browserName:"Safari",supported:aZ.not_supported},{browserName:"Edge",features:["audio"],supported:aZ.partial}]}]}}var bc=a.i(783281);function bd(a){let[b,c]=(0,bc.useState)(!1),[d,e]=(0,bc.useState)(!1),[f,g]=(0,bc.useState)(!1),[h,i]=(0,bc.useState)(null),[j,k]=(0,bc.useState)(0),[l,m]=(0,bc.useState)(null),[n,o]=(0,bc.useState)([]),p=(0,bc.useRef)(null),q=(0,bc.useRef)(null),r=(0,bc.useRef)(a),s=(0,bc.useRef)(null),t=(0,bc.useRef)(!0);(0,bc.useEffect)(()=>{r.current=a},[a]);let u=(0,bc.useCallback)(a=>{let b=Math.min(1e3*Math.pow(2,a),3e4),c=.3*b*Math.random();return Math.round(b+c)},[]),v=(0,bc.useCallback)(()=>{s.current&&clearTimeout(s.current),k(a=>{let b=a+1;if(b>5)return console.error(` WebRTC: Max reconnection attempts (5) reached`),g(!1),i("Connection lost. Max reconnection attempts (5) exceeded."),a;let d=u(b-1);return g(!0),s.current=setTimeout(async()=>{if(p.current){try{p.current.disconnect()}catch{}p.current=null}try{let a=r.current;if(a.username&&a.password){let b=new bb({login:a.username,password:a.password,debug:a.debug});b.on("telnyx.ready",()=>{c(!0),e(!1),g(!1),i(null),k(0)}),b.on("telnyx.error",a=>{console.error(" WebRTC: Reconnection error:",a),v()}),b.on("telnyx.socket.error",()=>{t.current&&v()}),b.on("telnyx.socket.close",()=>{c(!1),t.current&&v()}),p.current=b,await b.connect()}}catch(a){console.error(" WebRTC: Reconnection attempt failed:",a)}},d),b})},[u]),w=(0,bc.useCallback)(async()=>{if(k(0),t.current=!0,p.current){try{p.current.disconnect()}catch{}p.current=null}s.current&&(clearTimeout(s.current),s.current=null),g(!1);let a=r.current;if(a.username&&a.password){e(!0),i(null);try{let a=x();a&&await a.connect()}catch(a){console.error(" WebRTC: Manual reconnection failed:",a),i(a instanceof Error?a.message:"Reconnection failed"),e(!1)}}},[]),x=(0,bc.useCallback)(()=>{if(p.current)return p.current;let a=r.current;if(!(a.username&&a.password))return console.error(" WebRTC: Missing credentials, cannot initialize"),null;let b=new bb({login:a.username,password:a.password,ringtoneFile:void 0,ringbackFile:void 0,debug:a.debug});return b.on("telnyx.ready",()=>{c(!0),e(!1),g(!1),i(null),k(0)}),b.on("telnyx.error",a=>{console.error(" WebRTC: telnyx.error event:",a);let b=a?.error?.message||a?.message||a?.description||"Connection error";console.error(" WebRTC: Error message:",b),i(b),e(!1)}),b.on("telnyx.socket.error",a=>{console.error(" WebRTC: telnyx.socket.error event:",a),i("Socket connection failed"),e(!1),c(!1),t.current&&v()}),b.on("telnyx.socket.close",a=>{console.warn(" WebRTC: telnyx.socket.close event:",a),c(!1),t.current&&v()}),b.on("telnyx.notification",a=>{if("callUpdate"!==a.type)return;let b=a.call;if(!b)return void console.warn(" WebRTC: callUpdate notification with undefined call");let c=function(a){switch(a){case"new":case"requesting":return"connecting";case"trying":case"recovering":case"ringing":return"ringing";case"active":return"active";case"held":return"held";case"hangup":case"destroy":return"ended";default:return"idle"}}(b.state),d={id:b.id||"unknown",state:c,direction:"inbound"===b.direction?"inbound":"outbound",remoteNumber:b.remoteNumber||b.to||"Unknown",remoteName:b.remoteName,localNumber:b.localNumber||"",startTime:"active"===c?new Date:void 0,duration:0,isMuted:!1,isHeld:"held"===b.state,isRecording:!1};m(d),q.current=b,"inbound"===b.direction&&"ringing"===b.state&&r.current.onIncomingCall?.(d),("destroy"===b.state||"hangup"===b.state)&&(r.current.onCallEnded?.(d),m(null),q.current=null)}),p.current=b,b},[]),y=(0,bc.useCallback)(async()=>{try{e(!0),i(null);let a=x();if(!a){console.warn(" WebRTC: No credentials available, aborting connection"),e(!1);return}await a.connect()}catch(a){console.error(" WebRTC: Connection error in connect():",a),i(a instanceof Error?a.message:"Connection failed"),e(!1)}},[x]),z=(0,bc.useCallback)(()=>{t.current=!1,s.current&&(clearTimeout(s.current),s.current=null),p.current&&(p.current.disconnect(),p.current=null),c(!1),e(!1),g(!1),k(0),m(null),q.current=null},[]),A=(0,bc.useCallback)(async(a,c)=>{let d=a=>{let b=a.replace(/\D/g,"");return 10===b.length?`+1${b}`:11===b.length&&b.startsWith("1")||b.length>10&&!a.startsWith("+")?`+${b}`:a.startsWith("+")?a:`+${b}`},e=d(a),f=c?d(c):void 0;if(!(p.current&&b))throw console.error(" WebRTC makeCall: Not connected to Telnyx"),Error("Not connected to Telnyx");try{let b=await p.current.newCall({destinationNumber:e,callerNumber:f});q.current=b;let d={id:b.id,state:"connecting",direction:"outbound",remoteNumber:a,localNumber:c||"",duration:0,isMuted:!1,isHeld:!1,isRecording:!1};return m(d),b}catch(a){throw console.error(" WebRTC makeCall error:",a),a}},[b]),B=(0,bc.useCallback)(async()=>{if(!q.current)throw Error("No active call to answer");await q.current.answer()},[]),C=(0,bc.useCallback)(async()=>{if(!q.current)throw Error("No active call to end");await q.current.hangup(),m(null),q.current=null},[]),D=(0,bc.useCallback)(async()=>{if(!q.current)throw Error("No active call to mute");await q.current.muteAudio(),m(a=>a?{...a,isMuted:!0}:null)},[]),E=(0,bc.useCallback)(async()=>{if(!q.current)throw Error("No active call to unmute");await q.current.unmuteAudio(),m(a=>a?{...a,isMuted:!1}:null)},[]),F=(0,bc.useCallback)(async()=>{if(!q.current)throw Error("No active call to hold");await q.current.hold(),m(a=>a?{...a,isHeld:!0}:null)},[]),G=(0,bc.useCallback)(async()=>{if(!q.current)throw Error("No active call to unhold");await q.current.unhold(),m(a=>a?{...a,isHeld:!1}:null)},[]),H=(0,bc.useCallback)(async a=>{if(!q.current)throw Error("No active call");await q.current.dtmf(a)},[]),I=(0,bc.useCallback)(async a=>{if(!q.current)throw Error("No active call");await q.current.setAudioOutDevice(a)},[]),J=(0,bc.useCallback)(async()=>{if("undefined"!=typeof navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)try{let a=(await navigator.mediaDevices.enumerateDevices()).filter(a=>"audiooutput"===a.kind);o(a)}catch{}},[]);return(0,bc.useEffect)(()=>{if("undefined"==typeof navigator||!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return()=>{};J();let a=()=>{J()};return navigator.mediaDevices.addEventListener("devicechange",a),()=>{navigator.mediaDevices&&navigator.mediaDevices.removeEventListener("devicechange",a)}},[J]),(0,bc.useEffect)(()=>(r.current.autoConnect&&y(),()=>{z()}),[y,z]),{isConnected:b,isConnecting:d,isReconnecting:f,connectionError:h,reconnectAttempts:j,currentCall:l,makeCall:A,answerCall:B,endCall:C,muteCall:D,unmuteCall:E,holdCall:F,unholdCall:G,sendDTMF:H,connect:y,disconnect:z,reconnect:w,audioDevices:n,setAudioDevice:I}}a.s(["useTelnyxWebRTC",()=>bd],685078)}];

//# sourceMappingURL=f56e1_lucide-react_dist_esm_icons_mic_9039da9d.js.map