module.exports=[471104,a=>{"use strict";var b=a.i(861467),c=a.i(452168),d=a.i(263758),e=a.i(587969),f=a.i(527936),g=a.i(187056),h=a.i(319895),i=a.i(789815),j=a.i(824124),k=a.i(383413),l=a.i(949747),m=a.i(898062),n=a.i(638727),o=a.i(530762),p=a.i(757844),q=a.i(232553),r=a.i(102420),s=a.i(966183),t=a.i(283753),u=a.i(688014),v=a.i(320091),w=a.i(24872),x=a.i(362841),y=a.i(145679),z=a.i(337241),A=a.i(783281),B=a.i(761447),C=a.i(94436),D=a.i(156916),E=a.i(169021),F=(0,E.createServerReference)("40295f87d7cac83dfc3c1e3626ca045351b8684bcf",E.callServer,void 0,E.findSourceMapURL,"sendEstimateEmail"),G=(0,E.createServerReference)("401d437f15534a88ca15a64f6eb984496a9be06f5a",E.callServer,void 0,E.findSourceMapURL,"sendInvoiceEmail"),H=a.i(97997),I=a.i(916680),J=a.i(638446),K=a.i(198803),L=(0,E.createServerReference)("40c95bcd163662f3ce8b4f9c35b5e60fd93c079978",E.callServer,void 0,E.findSourceMapURL,"processInvoicePayment"),M=(0,E.createServerReference)("0025397304fc442a5fd90eb659fe2d0732fecdbdaf",E.callServer,void 0,E.findSourceMapURL,"getPaymentMethods");a.i(857463);var N=a.i(161367);a.i(288007);var O=a.i(986990);a.i(445255);var P=a.i(18170);a.i(19256);var Q=a.i(417132);function R({open:a,onOpenChange:c,invoiceId:d,invoiceNumber:e,amount:g,onSuccess:h}){let[i,j]=(0,A.useState)(!0),[k,l]=(0,A.useState)(!1),[m,n]=(0,A.useState)(null),[o,p]=(0,A.useState)(!1),[q,r]=(0,A.useState)(null);(0,A.useEffect)(()=>{a&&s()},[a,s]);let s=async()=>{j(!0),n(null);let a=await M();if(!(a.success&&a.paymentMethods)){n(a.error||"Failed to load payment methods"),j(!1);return}let b=a.paymentMethods.find(a=>a.is_default)??a.paymentMethods[0];b?r({id:b.id,card_brand:b.brand,card_last4:b.last4,card_exp_month:b.exp_month,card_exp_year:b.exp_year,nickname:b.display_name,is_default:b.is_default}):n("No payment methods found. Please add a payment method first."),j(!1)},t=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a/100),u=async()=>{if(!q)return void n("No payment method available");l(!0),n(null);let a=await L({invoiceId:d,paymentMethodId:q.id,channel:"online"});l(!1),a.success?(p(!0),setTimeout(()=>{h?.(),c(!1),p(!1)},1500)):n(a.error||"Payment failed")};return i?(0,b.jsx)(Q.Dialog,{onOpenChange:c,open:a,children:(0,b.jsx)(Q.DialogContent,{className:"sm:max-w-[450px]",children:(0,b.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,b.jsx)(K.Loader2,{className:"text-muted-foreground size-8 animate-spin"})})})}):o?(0,b.jsx)(Q.Dialog,{onOpenChange:c,open:a,children:(0,b.jsxs)(Q.DialogContent,{className:"sm:max-w-[450px]",children:[(0,b.jsx)(Q.DialogHeader,{children:(0,b.jsx)(Q.DialogTitle,{children:"Payment Successful"})}),(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,b.jsx)("div",{className:"bg-success/10 mb-4 flex size-16 items-center justify-center rounded-full",children:(0,b.jsx)(J.Check,{className:"text-success size-8"})}),(0,b.jsx)("h3",{className:"mb-2 text-lg font-semibold",children:"Payment Successful!"}),(0,b.jsxs)("p",{className:"text-muted-foreground text-center text-sm",children:[t(g)," paid for invoice ",e]})]})]})}):(0,b.jsx)(Q.Dialog,{onOpenChange:c,open:a,children:(0,b.jsxs)(Q.DialogContent,{className:"sm:max-w-[450px]",children:[(0,b.jsxs)(Q.DialogHeader,{children:[(0,b.jsx)(Q.DialogTitle,{children:"Confirm Payment"}),(0,b.jsxs)(Q.DialogDescription,{children:["Quick payment for ",e]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"bg-muted/30 rounded-lg border p-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm",children:"Amount to Pay:"}),(0,b.jsx)("span",{className:"text-xl font-bold",children:t(g)})]})}),q?(0,b.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,b.jsx)("p",{className:"text-muted-foreground mb-2 text-xs",children:"Payment Method:"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("span",{className:"text-2xl",children:"üí≥"}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"text-sm font-medium",children:[q.card_brand.toUpperCase()," ‚Ä¢‚Ä¢‚Ä¢‚Ä¢"," ",q.card_last4]}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Expires"," ",String(q.card_exp_month).padStart(2,"0"),"/",q.card_exp_year,q.nickname&&` ‚Ä¢ ${q.nickname}`]})]}),q.is_default&&(0,b.jsx)(O.Badge,{className:"ml-auto text-xs",variant:"secondary",children:"Default"})]})]}):(0,b.jsxs)(N.Alert,{variant:"destructive",children:[(0,b.jsx)(I.AlertTriangle,{className:"size-4"}),(0,b.jsx)(N.AlertDescription,{children:"No payment method available. Please add a payment method in the Billing Information section."})]}),(0,b.jsxs)(N.Alert,{children:[(0,b.jsx)(H.AlertCircle,{className:"size-4"}),(0,b.jsxs)(N.AlertDescription,{className:"text-sm",children:["This will charge ",t(g)," to your"," ",q?.card_brand.toUpperCase()," card ending in"," ",q?.card_last4,"."]})]}),m&&(0,b.jsxs)(N.Alert,{variant:"destructive",children:[(0,b.jsx)(H.AlertCircle,{className:"size-4"}),(0,b.jsx)(N.AlertDescription,{children:m})]})]}),(0,b.jsxs)(Q.DialogFooter,{children:[(0,b.jsx)(P.Button,{disabled:k,onClick:()=>c(!1),variant:"outline",children:"Cancel"}),(0,b.jsx)(P.Button,{disabled:k||!q,onClick:u,children:k?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(K.Loader2,{className:"mr-2 size-4 animate-spin"}),"Processing..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.CreditCard,{className:"mr-2 size-4"}),"Confirm & Pay"]})})]})]})})}a.i(956852);var S=a.i(90125),T=a.i(380340),U=a.i(858707);function V({invoices:a,onUpdate:c}){let[d,e]=(0,A.useState)(null),[g,j]=(0,A.useState)(null),k=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(a/100),l=async a=>{j(a);let b=await G(a);j(null),b.success?(D.toast.success(b.message||"Invoice sent successfully"),c?.()):D.toast.error(b.error||"Failed to send invoice")},m=async a=>{j(a);let b=await F(a);j(null),b.success?(D.toast.success(b.message||"Estimate sent successfully"),c?.()):D.toast.error(b.error||"Failed to send estimate")},n=a=>(0,b.jsx)(O.Badge,{className:"text-xs",variant:{paid:"default",pending:"secondary",draft:"outline",overdue:"destructive"}[a]||"outline",children:a}),o=(0,A.useMemo)(()=>[{key:"invoice_number",header:"Invoice #",width:"w-32",shrink:!0,render:a=>(0,b.jsx)(y.default,{className:"text-foreground text-xs leading-tight font-medium hover:underline",href:`/dashboard/work/invoices/${a.id}`,onClick:a=>a.stopPropagation(),children:a.invoice_number})},{key:"title",header:"Title",render:a=>(0,b.jsx)(y.default,{className:"text-foreground text-xs leading-tight font-medium hover:underline",href:`/dashboard/work/invoices/${a.id}`,onClick:a=>a.stopPropagation(),children:a.title||"‚Äî"})},{key:"status",header:"Status",width:"w-24",shrink:!0,render:a=>n(a.status)},{key:"total_amount",header:"Amount",width:"w-32",shrink:!0,align:"right",render:a=>(0,b.jsx)("span",{className:"font-medium",children:k(a.total_amount)})},{key:"balance_amount",header:"Balance",width:"w-32",shrink:!0,align:"right",render:a=>a.balance_amount>0?(0,b.jsx)("span",{className:"text-destructive font-medium",children:k(a.balance_amount)}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"Paid"})},{key:"due_date",header:"Due Date",width:"w-28",shrink:!0,hideOnMobile:!0,render:a=>(0,b.jsx)("span",{className:"text-xs",children:a.due_date?new Date(a.due_date).toLocaleDateString():"‚Äî"})},{key:"actions",header:"",width:"w-12",shrink:!0,align:"right",render:a=>{let c="paid"!==a.status&&a.balance_amount>0;return(0,b.jsxs)(S.DropdownMenu,{children:[(0,b.jsx)(S.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(P.Button,{className:"size-8 p-0",size:"sm",variant:"ghost",children:(0,b.jsx)(C.MoreHorizontal,{className:"size-4"})})}),(0,b.jsxs)(S.DropdownMenuContent,{align:"end",className:"w-48",children:[c&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(S.DropdownMenuItem,{className:"cursor-pointer",onClick:()=>e(a),children:[(0,b.jsx)(f.CreditCard,{className:"mr-2 size-4"}),"Quick Pay"]}),(0,b.jsx)(S.DropdownMenuSeparator,{})]}),(0,b.jsxs)(S.DropdownMenuItem,{className:"cursor-pointer",disabled:g===a.id,onClick:()=>l(a.id),children:[(0,b.jsx)(i.Mail,{className:"mr-2 size-4"}),"Send Invoice"]}),(0,b.jsxs)(S.DropdownMenuItem,{className:"cursor-pointer",disabled:g===a.id,onClick:()=>m(a.id),children:[(0,b.jsx)(h.FileText,{className:"mr-2 size-4"}),"Send as Estimate"]})]})]})}}],[g,k,n,m,l]);return(0,b.jsxs)(b.Fragment,{children:[d&&(0,b.jsx)(R,{amount:d.balance_amount,invoiceId:d.id,invoiceNumber:d.invoice_number,onOpenChange:a=>!a&&e(null),onSuccess:()=>{e(null),c?.()},open:!!d}),(0,b.jsx)(T.FullWidthDataTable,{...U.TablePresets.fullList(),columns:o,data:a,emptyIcon:(0,b.jsx)(h.FileText,{className:"text-muted-foreground/50 size-12"}),emptyMessage:"No invoices found",getItemId:a=>a.id,searchFilter:(a,b)=>{let c=b.toLowerCase();return a.invoice_number?.toLowerCase().includes(c)||a.title?.toLowerCase().includes(c)||a.status?.toLowerCase().includes(c)},searchPlaceholder:"Search invoices..."})]})}var W=a.i(339632);a.i(156120);var X=a.i(335798);function Y({id:a,type:c="card",card_brand:d,card_last4:e,card_exp_month:f,card_exp_year:g,cardholder_name:h,bank_name:i,account_type:j,is_default:k,nickname:l,is_verified:m,onSetDefault:n,onRemove:o,disabled:p=!1}){return(0,b.jsxs)("div",{className:"group relative",children:[(0,b.jsx)(X.CreditCardVisual,{accountType:j,bankName:i,brand:d,cardholderName:h,expMonth:f,expYear:g,isDefault:k,isVerified:m,last4:e,nickname:l,type:c}),(0,b.jsxs)("div",{className:"mt-3 flex items-center justify-between gap-2 opacity-0 transition-opacity group-hover:opacity-100",children:[(0,b.jsx)("div",{className:"flex gap-2",children:!k&&n&&(0,b.jsx)(P.Button,{className:"h-8 text-xs",disabled:p,onClick:a=>{a.stopPropagation(),n()},size:"sm",variant:"outline",children:"Set as Default"})}),o&&(0,b.jsxs)(P.Button,{className:"text-destructive hover:bg-destructive hover:text-destructive-foreground h-8",disabled:p,onClick:a=>{a.stopPropagation(),confirm(`Remove this ${"card"===c?"card":"account"}?`)&&o()},size:"sm",variant:"outline",children:[(0,b.jsx)(W.Trash2,{className:"mr-1.5 size-3.5"}),"Remove"]})]})]})}var Z=a.i(984270),$=a.i(293567),$=$,_=a.i(396919),aa=a.i(860442),ab=(0,E.createServerReference)("40c4dabc91a1b3abfcb02e70294b84f9e59c59d1e8",E.callServer,void 0,E.findSourceMapURL,"archiveProperty");a.i(400355);var ac=a.i(694340);a.i(799390);var ad=a.i(985943),ae=a.i(572863),af=a.i(624126),ag=a.i(896080),ah=a.i(129486),ah=ah,ai=a.i(332284),aj=a.i(278932),ak=a.i(699756),al=a.i(171768),am=a.i(566314),an=a.i(748915),an=an;a.i(380934);var ao=a.i(347421);a.i(146697);var ap=a.i(778737);a.i(928414);var aq=a.i(745250),ar=a.i(924230);a.i(129112);var as=a.i(256003);let at=!1,au=!1,av=[];function aw({address:a,lat:c,lon:d,nearbySuppliers:e=[]}){let[f,g]=(0,A.useState)(!1),[h,i]=(0,A.useState)(!0),[k,l]=(0,A.useState)(null),m=(0,A.useRef)(null),n=(0,A.useRef)(null),o=(0,A.useRef)(null),p=(0,A.useRef)(null),q="AIzaSyCVKN0pddG230vvjT0EMP9sSIR31j1q2t0";(0,A.useEffect)(()=>{if(o.current)return void i(!1);let a=!0,b=null,c=0,d=()=>{if(a){if(!m.current){if(++c>=50){l("Failed to initialize map"),i(!1);return}b=setTimeout(d,100);return}new Promise((a,b)=>{if(at||window.google?.maps){at=!0,a();return}if(au)return void av.push(a);let c=document.querySelector('script[src*="maps.googleapis.com"]');if(c){au=!0,c.addEventListener("load",()=>{at=!0,au=!1,a(),av.forEach(a=>a()),av.length=0});return}au=!0;let d=document.createElement("script");d.src=`https://maps.googleapis.com/maps/api/js?key=${q}&libraries=marker`,d.async=!0,d.defer=!0,d.onload=()=>{at=!0,au=!1,a(),av.forEach(a=>a()),av.length=0},d.onerror=()=>{au=!1,b(Error("Failed to load Google Maps"))},document.head.appendChild(d)}).then(()=>{a&&m.current&&!o.current&&r(m.current,!1)}).catch(b=>{a&&l("Failed to load Google Maps")}).finally(()=>{a&&i(!1)})}};return d(),()=>{a=!1,b&&clearTimeout(b)}},[q,r]),(0,A.useEffect)(()=>{f&&n.current&&!p.current&&r(n.current,!0)},[f,r]);let r=(b,f)=>{if(!window.google?.maps)return;let g=new google.maps.Map(b,{center:{lat:c,lng:d},zoom:f?13:12,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:f});new google.maps.Marker({position:{lat:c,lng:d},map:g,title:a.full,icon:{path:google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#ef4444",fillOpacity:1,strokeColor:"#f3f7fd",strokeWeight:2},label:{text:"üìç",fontSize:"18px"}});let h=new google.maps.LatLngBounds;for(let a of(h.extend({lat:c,lng:d}),e)){let b=new google.maps.Marker({position:{lat:a.lat,lng:a.lon},map:g,title:a.name,icon:{path:google.maps.SymbolPath.CIRCLE,scale:6,fillColor:"#3b82f6",fillOpacity:.8,strokeColor:"#f3f7fd",strokeWeight:2}}),c=new google.maps.InfoWindow({content:`
          <div style="padding: 8px;">
            <div style="font-weight: 600; margin-bottom: 4px;">${a.name}</div>
            <div style="font-size: 12px; color: #666;">
              ${(a.distance/1e3).toFixed(1)} km away
            </div>
          </div>
        `});b.addListener("click",()=>{c.open(g,b)}),h.extend({lat:a.lat,lng:a.lon})}e.length>0&&g.fitBounds(h),f?p.current=g:o.current=g};return k?(0,b.jsxs)("div",{className:"border-muted text-muted-foreground flex items-center gap-2 rounded-lg border p-4 text-sm",children:[(0,b.jsx)(j.MapPin,{className:"h-4 w-4"}),(0,b.jsxs)("span",{children:["Map unavailable: ",k]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"group bg-card relative overflow-hidden rounded-lg border",children:(0,b.jsxs)("div",{className:"relative h-[180px] w-full",children:[(0,b.jsx)("div",{className:"h-full w-full",ref:m}),h&&(0,b.jsx)(as.Skeleton,{className:"absolute inset-0 h-full w-full"}),(0,b.jsx)("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent p-3",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"mb-1 flex items-center gap-2",children:[(0,b.jsx)(j.MapPin,{className:"h-4 w-4 text-white"}),(0,b.jsx)("span",{className:"text-sm font-semibold text-white",children:"Service Location"}),e.length>0&&(0,b.jsxs)(O.Badge,{className:"bg-primary/80 h-5 text-[10px] text-white",variant:"secondary",children:[(0,b.jsx)(am.Store,{className:"mr-1 h-3 w-3"}),e.length," suppliers"]})]}),(0,b.jsx)("p",{className:"text-xs text-white/90",children:a.street}),(0,b.jsxs)("p",{className:"text-xs text-white/80",children:[a.city,", ",a.state," ",a.zipCode]})]}),(0,b.jsx)(P.Button,{className:"bg-card/90 hover:bg-card h-8 w-8",onClick:()=>g(!0),size:"icon",variant:"ghost",children:(0,b.jsx)(ar.Maximize2,{className:"text-foreground h-4 w-4"})})]})})]})}),(0,b.jsx)(Q.Dialog,{onOpenChange:g,open:f,children:(0,b.jsxs)(Q.DialogContent,{className:"max-w-4xl p-0",children:[(0,b.jsxs)(Q.DialogHeader,{className:"border-b p-4",children:[(0,b.jsxs)(Q.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(j.MapPin,{className:"text-primary h-5 w-5"}),"Service Location Map"]}),(0,b.jsxs)("div",{className:"text-muted-foreground mt-2 text-sm",children:[(0,b.jsx)("p",{className:"text-foreground font-medium",children:a.street}),(0,b.jsxs)("p",{children:[a.city,", ",a.state," ",a.zipCode]})]})]}),(0,b.jsx)("div",{className:"h-[600px] w-full",ref:n}),(0,b.jsx)("div",{className:"border-t p-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-6 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"bg-destructive flex h-6 w-6 items-center justify-center rounded-full",children:(0,b.jsx)(j.MapPin,{className:"h-4 w-4 text-white"})}),(0,b.jsx)("span",{children:"Service Location"})]}),e.length>0&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"bg-primary flex h-6 w-6 items-center justify-center rounded-full",children:(0,b.jsx)(am.Store,{className:"h-4 w-4 text-white"})}),(0,b.jsxs)("span",{children:["Nearby Suppliers (",e.length,")"]})]})]})})]})})]})}function ax({enrichmentData:a}){let c;if(!a)return(0,b.jsx)(ao.Card,{children:(0,b.jsx)(ao.CardContent,{className:"flex items-center justify-center py-8",children:(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No operational intelligence available"})})});if("failed"===a.enrichmentStatus)return(0,b.jsx)(ao.Card,{children:(0,b.jsx)(ao.CardContent,{className:"py-6",children:(0,b.jsxs)(N.Alert,{variant:"destructive",children:[(0,b.jsx)(I.AlertTriangle,{className:"h-4 w-4"}),(0,b.jsx)(N.AlertDescription,{children:"Failed to load operational intelligence. Please try again."})]})})});let{propertyData:e,buildingData:f,weather:g,waterQuality:h,locationIntelligence:i,nearbySuppliers:k,streetView:l,googlePlaces:n,timeZone:o,recommendations:p}=a;return(0,b.jsxs)("div",{className:"space-y-6",children:[(p.shouldReschedule||g?.hasActiveAlerts||p.upsellOpportunities.length>0)&&(0,b.jsxs)("div",{className:"space-y-3",children:[p.shouldReschedule&&(0,b.jsxs)(N.Alert,{variant:"destructive",children:[(0,b.jsx)(I.AlertTriangle,{className:"h-4 w-4"}),(0,b.jsx)(N.AlertDescription,{className:"font-medium",children:p.rescheduleReason})]}),g?.hasActiveAlerts&&g.alerts?.[0]&&(0,b.jsxs)(N.Alert,{children:[(0,b.jsx)(ag.CloudRain,{className:"h-4 w-4"}),(0,b.jsxs)(N.AlertDescription,{children:[(0,b.jsxs)("span",{className:"font-medium",children:[g.alerts[0].event,": "]}),g.alerts[0].headline]})]}),p.upsellOpportunities.length>0&&(0,b.jsxs)(N.Alert,{className:"border-emerald-200 bg-emerald-50 dark:border-emerald-900 dark:bg-emerald-950",children:[(0,b.jsx)(u.TrendingUp,{className:"h-4 w-4 text-emerald-600 dark:text-emerald-400"}),(0,b.jsx)(N.AlertDescription,{className:"text-emerald-900 dark:text-emerald-100",children:p.upsellOpportunities[0]})]})]}),a.location&&(0,b.jsx)(aw,{address:{street:a.location.address?.split(",")[0]||"",city:a.location.address?.split(",")[1]?.trim()||"",state:a.location.address?.split(",")[2]?.trim().split(" ")[0]||"",zipCode:a.location.address?.split(",")[2]?.trim().split(" ").slice(1).join(" ")||"",full:a.location.address||""},lat:a.location.lat||0,lon:a.location.lon||0,nearbySuppliers:k}),(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[g?.forecast?.periods?.[0]&&(0,b.jsxs)(ao.Card,{children:[(0,b.jsx)(ao.CardHeader,{className:"pb-3",children:(0,b.jsxs)(ao.CardTitle,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,b.jsx)(an.default,{className:"text-muted-foreground h-4 w-4"}),"Weather"]})}),(0,b.jsxs)(ao.CardContent,{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,b.jsxs)("span",{className:"text-3xl font-semibold",children:[g.forecast.periods[0].temperature,"¬∞"]}),(0,b.jsx)("span",{className:"text-muted-foreground text-sm",children:g.forecast.periods[0].windSpeed})]}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm leading-relaxed",children:g.forecast.periods[0].detailedForecast})]})]}),e&&(e.characteristics?.yearBuilt||e.characteristics?.squareFeet||e.assessment?.assessedValue||e.market?.lastSoldPrice)&&(0,b.jsxs)(ao.Card,{children:[(0,b.jsx)(ao.CardHeader,{className:"pb-3",children:(0,b.jsxs)(ao.CardTitle,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,b.jsx)(d.Building2,{className:"text-muted-foreground h-4 w-4"}),"Property"]})}),(0,b.jsxs)(ao.CardContent,{className:"space-y-2",children:[e.characteristics?.squareFeet&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Size"}),(0,b.jsxs)("span",{className:"font-medium",children:[e.characteristics.squareFeet.toLocaleString()," ","sq ft"]})]}),e.characteristics?.yearBuilt&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Built"}),(0,b.jsx)("span",{className:"font-medium",children:e.characteristics.yearBuilt})]}),e.assessment?.assessedValue&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Assessed"}),(0,b.jsxs)("span",{className:"font-medium",children:["$",(e.assessment.assessedValue/100).toLocaleString()]})]}),e.market?.lastSoldPrice&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Last Sold"}),(0,b.jsxs)("span",{className:"font-medium",children:["$",(e.market.lastSoldPrice/100).toLocaleString()]})]})]})]}),f&&(f.footprint?.area||f.height||f.levels||f.buildingType)&&(0,b.jsxs)(ao.Card,{children:[(0,b.jsx)(ao.CardHeader,{className:"pb-3",children:(0,b.jsxs)(ao.CardTitle,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,b.jsx)(d.Building2,{className:"text-muted-foreground h-4 w-4"}),"Building"]})}),(0,b.jsxs)(ao.CardContent,{className:"space-y-2",children:[f.buildingType&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Type"}),(0,b.jsx)("span",{className:"font-medium",children:f.buildingType})]}),f.footprint?.area&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Footprint"}),(0,b.jsxs)("span",{className:"font-medium",children:[Math.round(10.764*f.footprint.area).toLocaleString()," ","sq ft"]})]}),f.height&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Height"}),(0,b.jsxs)("span",{className:"font-medium",children:[Math.round(3.281*f.height)," ft"]})]}),f.levels&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Floors"}),(0,b.jsx)("span",{className:"font-medium",children:f.levels})]})]})]}),h&&(0,b.jsxs)(ao.Card,{children:[(0,b.jsx)(ao.CardHeader,{className:"pb-3",children:(0,b.jsxs)(ao.CardTitle,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,b.jsx)(ah.default,{className:"text-muted-foreground h-4 w-4"}),"Water Quality"]})}),(0,b.jsxs)(ao.CardContent,{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground text-sm",children:"Hardness"}),(0,b.jsx)(O.Badge,{variant:"outline",children:h.classification})]}),h.recommendations.shouldOfferSoftener&&(0,b.jsx)("p",{className:"text-muted-foreground text-sm leading-relaxed",children:h.recommendations.reason})]})]}),i?.county?.countyName&&(0,b.jsxs)(ao.Card,{children:[(0,b.jsx)(ao.CardHeader,{className:"pb-3",children:(0,b.jsxs)(ao.CardTitle,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,b.jsx)(j.MapPin,{className:"text-muted-foreground h-4 w-4"}),"Location"]})}),(0,b.jsxs)(ao.CardContent,{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"County"}),(0,b.jsx)("span",{className:"font-medium",children:i.county.countyName})]}),i.floodZone&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Flood Zone"}),(0,b.jsx)(O.Badge,{variant:"high"===i.floodZone.riskLevel?"destructive":"secondary",children:i.floodZone.zone})]})]})]}),o&&(0,b.jsxs)(ao.Card,{children:[(0,b.jsx)(ao.CardHeader,{className:"pb-3",children:(0,b.jsxs)(ao.CardTitle,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,b.jsx)(af.Clock,{className:"text-muted-foreground h-4 w-4"}),"Time Zone"]})}),(0,b.jsx)(ao.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Zone"}),(0,b.jsx)("span",{className:"font-medium",children:o.timeZoneName})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Offset"}),(0,b.jsxs)(O.Badge,{variant:"secondary",children:["UTC",o.totalOffsetHours>=0?"+":"",o.totalOffsetHours]})]}),o.isDST&&(0,b.jsx)(O.Badge,{className:"text-xs",variant:"outline",children:"Daylight Saving Time"})]})})]}),!n&&k&&k.length>0&&(0,b.jsxs)(ao.Card,{className:"sm:col-span-2",children:[(0,b.jsx)(ao.CardHeader,{className:"pb-3",children:(0,b.jsxs)(ao.CardTitle,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,b.jsx)(am.Store,{className:"text-muted-foreground h-4 w-4"}),"Nearby Suppliers"]})}),(0,b.jsx)(ao.CardContent,{children:(0,b.jsx)("div",{className:"space-y-2",children:k.slice(0,3).map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"truncate text-sm font-medium",children:a.name}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:a.distance?`${(a.distance/1e3).toFixed(1)} km`:"‚Äî"})]}),(0,b.jsx)(P.Button,{asChild:!0,size:"sm",variant:"ghost",children:(0,b.jsx)("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${a.lat},${a.lon}`,rel:"noopener noreferrer",target:"_blank",children:(0,b.jsx)(ak.Navigation,{className:"h-4 w-4"})})})]},`${a.name}-${a.lat}-${a.lon}`))})})]})]}),l?.available&&l.mainView&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ap.Separator,{}),(0,b.jsxs)(ao.Card,{children:[(0,b.jsx)(ao.CardHeader,{children:(0,b.jsxs)(ao.CardTitle,{className:"flex items-center gap-2 text-base",children:[(0,b.jsx)(ae.Camera,{className:"text-primary h-5 w-5"}),"Property Street View"]})}),(0,b.jsxs)(ao.CardContent,{className:"space-y-4",children:[(0,b.jsx)("div",{className:"overflow-hidden rounded-lg border",children:(0,b.jsx)("img",{alt:"Property street view",className:"h-auto w-full",height:"400",loading:"lazy",src:l.mainView,width:"600"})}),l.alternateViews&&l.alternateViews.length>0&&(0,b.jsx)("div",{className:"grid grid-cols-3 gap-2",children:l.alternateViews.map(a=>(0,b.jsx)("div",{className:"overflow-hidden rounded-md border",children:(0,b.jsx)("img",{alt:"Property from alternate angle",className:"h-auto w-full",height:"400",loading:"lazy",src:a,width:"600"})},`view-${a.substring(0,30)}`))}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Street view images provided by Google Maps"})]})]})]}),n&&n.places.length>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ap.Separator,{}),(0,b.jsxs)(ao.Card,{children:[(0,b.jsx)(ao.CardHeader,{children:(0,b.jsxs)(ao.CardTitle,{className:"flex items-center justify-between text-base",children:[(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(am.Store,{className:"text-primary h-5 w-5"}),"Nearby Suppliers"]}),(0,b.jsxs)(O.Badge,{variant:"secondary",children:[n.totalResults," found"]})]})}),(0,b.jsx)(ao.CardContent,{children:(0,b.jsx)("div",{className:"space-y-4",children:n.places.slice(0,3).map(a=>(0,b.jsxs)("div",{className:"flex gap-4 rounded-lg border p-4",children:[a.photoUrl&&(0,b.jsx)("div",{className:"h-20 w-20 flex-shrink-0 overflow-hidden rounded-md",children:(0,b.jsx)("img",{alt:a.name,className:"h-full w-full object-cover",height:"80",loading:"lazy",src:a.photoUrl,width:"80"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1 space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("h4",{className:"truncate text-sm font-semibold",children:a.name}),(0,b.jsx)("p",{className:"text-muted-foreground truncate text-xs",children:a.vicinity})]}),(0,b.jsxs)(O.Badge,{className:"flex-shrink-0 text-xs",variant:"outline",children:[(a.distance/1e3).toFixed(1)," km"]})]}),a.rating&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(al.Star,{className:"text-warning h-3 w-3 fill-yellow-400"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:a.rating.toFixed(1)})]}),a.userRatingsTotal&&(0,b.jsxs)("span",{className:"text-muted-foreground text-xs",children:["(",a.userRatingsTotal.toLocaleString()," ","reviews)"]}),void 0!==a.openNow&&(0,b.jsx)(O.Badge,{className:"text-xs",variant:a.openNow?"default":"secondary",children:a.openNow?"Open":"Closed"})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsx)(P.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,b.jsxs)("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${a.lat},${a.lon}`,rel:"noopener noreferrer",target:"_blank",children:[(0,b.jsx)(ak.Navigation,{className:"mr-1 h-3 w-3"}),"Directions"]})}),a.phoneNumber&&(0,b.jsx)(P.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,b.jsxs)("a",{href:`tel:${a.phoneNumber}`,children:[(0,b.jsx)(m.Phone,{className:"mr-1 h-3 w-3"}),"Call"]})}),a.website&&(0,b.jsx)(P.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,b.jsxs)("a",{href:a.website,rel:"noopener noreferrer",target:"_blank",children:[(0,b.jsx)(ai.Globe,{className:"mr-1 h-3 w-3"}),"Website"]})}),(0,b.jsx)(P.Button,{asChild:!0,size:"sm",variant:"ghost",children:(0,b.jsxs)("a",{href:`https://www.google.com/maps/place/?q=place_id:${a.placeId}`,rel:"noopener noreferrer",target:"_blank",children:[(0,b.jsx)(Z.ExternalLink,{className:"mr-1 h-3 w-3"}),"View on Maps"]})})]})]})]},a.placeId))})})]})]}),a.sources&&a.sources.length>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ap.Separator,{}),(0,b.jsx)(aq.TooltipProvider,{children:(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"Data sources:"}),a.sources.map(a=>(0,b.jsxs)(aq.Tooltip,{children:[(0,b.jsx)(aq.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(O.Badge,{className:"cursor-help",variant:"secondary",children:a.toUpperCase()})}),(0,b.jsx)(aq.TooltipContent,{children:(0,b.jsx)("p",{className:"max-w-xs text-xs",children:{nominatim:"OpenStreetMap Nominatim - Free geocoding service for address lookup",none:"No data sources available - check API configurations",nws:"National Weather Service - Free weather forecasts and alerts",fcc:"FCC Census Block API - Free location and county information",fema:"FEMA NFHL - Free flood zone and risk data",overpass:"OpenStreetMap Overpass API - Free nearby points of interest","usgs-elevation":"USGS Elevation API - Free terrain elevation data","osm-walkability":"OpenStreetMap - Calculated walkability score based on amenities","osm-schools":"OpenStreetMap - Nearby schools and education facilities","google-places":"Google Places API - Business info with reviews and ratings","google-streetview":"Google Street View - Property photos from street level","google-timezone":"Google Time Zone API - Automatic timezone detection",census:"US Census Bureau - Demographics and population statistics",airnow:"AirNow EPA - Air quality index and pollutant data",usgs:"USGS Water Services - Water quality and hardness data",osm:"OpenStreetMap - Building footprints and characteristics",rentcast:"RentCast API - Property details, taxes, and market data",attom:"Attom Data - Comprehensive property information"}[a.toLowerCase()]||`${a} - Data enrichment service`})})]},a))]})}),a.sources.includes("none")&&!a.propertyData&&(0,b.jsxs)(N.Alert,{children:[(0,b.jsx)(aj.Info,{className:"h-4 w-4"}),(0,b.jsxs)(N.AlertDescription,{className:"text-sm",children:[(0,b.jsx)("strong",{children:"Tip:"})," Add a RentCast API key for property details (50 free requests/month)"]})]}),a.sources.includes("none")&&a.propertyData&&(0,b.jsxs)(N.Alert,{variant:"default",children:[(0,b.jsx)(aj.Info,{className:"h-4 w-4"}),(0,b.jsxs)(N.AlertDescription,{className:"text-sm",children:[(0,b.jsx)("strong",{children:"Note:"})," Property data not available for this rural location in RentCast database"]})]}),a.sources.some(a=>["google-streetview","google-places","google-timezone"].includes(a))&&(c=[],(l?.available&&c.push("Street View photos"),n?.places?.length&&c.push("supplier details"),o&&c.push("timezone data"),0===c.length)?null:(0,b.jsxs)(N.Alert,{className:"border-success bg-success dark:border-success dark:bg-success",children:[(0,b.jsx)(ae.Camera,{className:"text-success dark:text-success h-4 w-4"}),(0,b.jsxs)(N.AlertDescription,{className:"text-sm",children:[(0,b.jsx)("strong",{children:"Google Maps:"})," ",c.join(", ")," ","available (100% FREE - 25k+ requests/month)"]})]}))]})]})}var ay=a.i(792268),az=a.i(563432),aA=a.i(700760);function aB({properties:a,itemsPerPage:e=10,customerId:f}){let g=(0,z.useRouter)(),h=(0,az.useArchiveStore)(a=>a.filters.properties),i=a.filter(a=>{let b=!!(a.archived_at||a.deleted_at);return"active"===h?!b:"archived"!==h||b}),[j,k]=(0,A.useState)(null),[l,m]=(0,A.useState)({x:0,y:0}),[o,p]=(0,A.useState)(!1),[q,r]=(0,A.useState)(new Set),s=a=>{m({x:a.clientX,y:a.clientY})},u=()=>{k(null)},v=[{label:"Archive Properties",icon:(0,b.jsx)(c.Archive,{className:"size-4"}),variant:"destructive",onClick:a=>{r(a),p(!0)}},{label:"Move to Another Customer",icon:(0,b.jsx)(aa.UserX,{className:"size-4"}),variant:"ghost",onClick:async a=>{alert(`Move ${a.size} properties to another customer (coming soon)`)}}],w=[{key:"address",header:"Address",width:"flex-1",sortable:!0,render:a=>{let c=function(a){switch(a){case"commercial":return d.Building2;case"industrial":return $.default;default:return _.Home}}(a.type);return(0,b.jsxs)("div",{className:"flex min-w-0 items-center gap-2",onMouseEnter:b=>{k(a),m({x:b.clientX,y:b.clientY})},onMouseLeave:u,onMouseMove:s,children:[(0,b.jsx)(c,{className:"text-muted-foreground size-4 shrink-0"}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"truncate leading-tight font-medium",children:a.name||a.address}),(0,b.jsxs)("p",{className:"text-muted-foreground truncate text-xs leading-tight",children:[a.city,", ",a.state," ",a.zip_code]})]})]})}},{key:"type",header:"Type",sortable:!0,width:"w-32",shrink:!0,render:a=>{var c;let d;return c=a.type,d={residential:"bg-success text-success dark:bg-success dark:text-success",commercial:"bg-primary text-primary dark:bg-primary dark:text-primary",industrial:"bg-accent text-accent-foreground dark:bg-accent dark:text-accent-foreground"},(0,b.jsx)(O.Badge,{className:(0,aA.cn)("text-xs",d[c||"residential"]||d.residential),children:c?c.charAt(0).toUpperCase()+c.slice(1):"Residential"})}},{key:"size",header:"Size",width:"w-32",shrink:!0,sortable:!0,align:"right",render:a=>{let c=a.square_footage||a.enrichment?.details?.squareFootage,d=a.enrichment?.details?.bedrooms,e=a.enrichment?.details?.bathrooms;return(0,b.jsxs)("div",{className:"text-xs",children:[(0,b.jsx)("p",{className:"font-medium",children:c?c.toLocaleString():"‚Äî"}),d&&e&&(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:[d,"bd / ",e,"ba"]}),!c&&a.year_built&&(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Built ",a.year_built]})]})}},{key:"value",header:"Value",width:"w-36",shrink:!0,sortable:!0,align:"right",hideOnMobile:!0,render:a=>{let c=a.enrichment?.ownership?.marketValue,d=a.enrichment?.taxes?.annualAmount;return(0,b.jsx)("div",{className:"text-xs",children:c?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-success dark:text-success font-semibold",children:(0,ay.formatCurrency)(c)}),d&&(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Tax: ",(0,ay.formatCurrency)(d)]})]}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"No data"})})}},{key:"actions",header:"",width:"w-36",shrink:!0,align:"right",render:a=>(0,b.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[a.operationalIntelligence&&(0,b.jsxs)(ad.Sheet,{children:[(0,b.jsx)(ad.SheetTrigger,{asChild:!0,children:(0,b.jsxs)(P.Button,{className:"h-7 gap-1 px-2 text-xs",onClick:a=>a.stopPropagation(),size:"sm",variant:"ghost",children:[(0,b.jsx)(t.Sparkles,{className:"size-3"}),"Intel"]})}),(0,b.jsxs)(ad.SheetContent,{className:"w-full overflow-y-auto sm:max-w-2xl",children:[(0,b.jsxs)(ad.SheetHeader,{children:[(0,b.jsxs)(ad.SheetTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(t.Sparkles,{className:"text-primary size-5"}),"Operational Intelligence"]}),(0,b.jsxs)(ad.SheetDescription,{children:["Live data for ",a.address,", ",a.city]})]}),(0,b.jsx)("div",{className:"mt-6",children:(0,b.jsx)(ax,{enrichmentData:a.operationalIntelligence})})]})]}),(0,b.jsxs)(y.default,{className:"text-primary inline-flex items-center gap-1 text-xs hover:underline",href:`/dashboard/customers/${a.customer_id}#property-${a.id}`,onClick:a=>a.stopPropagation(),children:["View",(0,b.jsx)(Z.ExternalLink,{className:"size-3"})]})]})}];return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(T.FullWidthDataTable,{...U.TablePresets.fullList(),bulkActions:v,columns:w,data:i,emptyAction:(0,b.jsxs)(P.Button,{onClick:()=>window.location.href=`/dashboard/work/properties/new?customerId=${f||a[0]?.customer_id||""}`,size:"sm",children:[(0,b.jsx)(n.Plus,{className:"mr-2 size-4"}),"Add Property"]}),emptyIcon:(0,b.jsx)(d.Building2,{className:"text-muted-foreground h-8 w-8"}),emptyMessage:"No properties found",entity:"properties",getItemId:a=>a.id,isArchived:a=>!!(a.archived_at||a.deleted_at),searchFilter:(a,b)=>{let c=b.toLowerCase();return(a.name?.toLowerCase()||"").includes(c)||a.address.toLowerCase().includes(c)||a.city.toLowerCase().includes(c)||a.state.toLowerCase().includes(c)||a.zip_code.toLowerCase().includes(c)||(a.type?.toLowerCase()||"").includes(c)},searchPlaceholder:"Search properties...",showArchived:"active"!==h,showRefresh:!1}),j&&(0,b.jsxs)("div",{className:"border-primary bg-background pointer-events-none fixed z-50 overflow-hidden rounded-lg border-2 shadow-2xl",style:{left:l.x+20,top:l.y-150,width:"400px",height:"300px"},children:[(0,b.jsx)("iframe",{frameBorder:"0",height:"100%",loading:"lazy",src:`https://www.google.com/maps/embed/v1/place?key=AIzaSyCVKN0pddG230vvjT0EMP9sSIR31j1q2t0&q=${encodeURIComponent(j.address+", "+j.city+", "+j.state+" "+j.zip_code)}&zoom=14`,style:{border:0},title:`Map of ${j.address}`,width:"100%"}),(0,b.jsxs)("div",{className:"bg-background/95 absolute right-0 bottom-0 left-0 border-t p-2 backdrop-blur",children:[(0,b.jsx)("p",{className:"truncate text-xs font-medium",children:j.address}),(0,b.jsxs)("p",{className:"text-muted-foreground truncate text-xs",children:[j.city,", ",j.state]})]})]}),(0,b.jsx)(ac.AlertDialog,{onOpenChange:p,open:o,children:(0,b.jsxs)(ac.AlertDialogContent,{children:[(0,b.jsxs)(ac.AlertDialogHeader,{children:[(0,b.jsxs)(ac.AlertDialogTitle,{children:["Archive ",q.size," ",1===q.size?"Property":"Properties","?"]}),(0,b.jsxs)(ac.AlertDialogDescription,{children:[q.size," ",1===q.size?"property":"properties"," will be archived and can be restored within 90 days."]})]}),(0,b.jsxs)(ac.AlertDialogFooter,{children:[(0,b.jsx)(ac.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(ac.AlertDialogAction,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:async()=>{let a=Array.from(q),b=0;for(let c of a)(await ab(c)).success&&b++;b>0&&g.refresh()},children:"Archive"})]})]})})]})}var aC=a.i(836994),aD=a.i(770735),aE=a.i(949729);a.i(516775);var aF=a.i(560272);a.i(839984);var aG=a.i(372712);a.i(458393);var aH=a.i(82012),aI=a.i(382281),aJ=a.i(493667);a.i(897346);var aK=a.i(75892);a.i(476036);var aL=a.i(930514),aM=a.i(794388),aN=a.i(151183),aO=a.i(251048),aP=a.i(637708);function aQ({customerData:a,metrics:C}){let D=(0,z.useRouter)(),{toast:E}=(0,aO.useToast)(),F=(0,z.usePathname)(),[G,H]=(0,A.useState)(a.customer),[I,J]=(0,A.useState)(!1),[K,L]=(0,A.useState)(!1),M=(0,aP.useToolbarActionsStore)(a=>a.setActions),{customer:N,properties:Q=[],jobs:R=[],invoices:T=[],estimates:U=[],appointments:W=[],contracts:X=[],payments:Z=[],maintenancePlans:$=[],serviceAgreements:_=[],activities:aa=[],equipment:ab=[],attachments:ac=[],paymentMethods:ad=[],enrichmentData:ae}=a,af=(0,A.useMemo)(()=>N?.customer_tags?N.customer_tags.map(a=>({id:a.id,name:a.name,slug:a.slug,color:a.color,category:a.category,icon:a.icon})):[],[N?.customer_tags]),ag=(0,A.useMemo)(()=>({1:()=>{let a=document.querySelector('[data-section-id="customer-info"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},2:()=>{let a=document.querySelector('[data-section-id="properties"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},3:()=>{let a=document.querySelector('[data-section-id="jobs"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},4:()=>{let a=document.querySelector('[data-section-id="invoices"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},5:()=>{let a=document.querySelector('[data-section-id="equipment"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},6:()=>{let a=document.querySelector('[data-section-id="payment-methods"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},7:()=>{let a=document.querySelector('[data-section-id="estimates"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},8:()=>{let a=document.querySelector('[data-section-id="appointments"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},9:()=>{let a=document.querySelector('[data-section-id="contracts"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}}}),[]);(0,aN.useSectionShortcuts)(ag);let ah=(a,b)=>{H(c=>({...c,[a]:b})),J(!0)},ai=(G?.status||N?.status||"active")?.toLowerCase(),aj=(0,A.useMemo)(()=>{let a=G?.display_name||G?.company_name||N?.display_name||N?.company_name;if(a&&a.trim().length>0)return a.trim();let b=[G?.first_name||N?.first_name,G?.last_name||N?.last_name].filter(Boolean).join(" ").trim();return b.length>0?b:G?.email||N?.email||"Unnamed Customer"},[N,G]),ak=(0,A.useMemo)(()=>{let a=N?.customer_number??N?.account_number??N?.reference_id??N?.external_id;return a?`#${a}`:N?.id?`#${N.id.slice(0,8).toUpperCase()}`:"#CUSTOMER"},[N]),al=G?.email||N?.email||null,am=G?.phone||G?.mobile_phone||N?.phone||N?.mobile_phone||null,an=(0,A.useMemo)(()=>Q.length>0?Q[0]:null,[Q]),ao=G?.created_at??N?.created_at??N?.createdAt??null,aq=C?.outstandingBalance??N?.outstanding_balance??N?.outstandingBalance??0,ar=G?.membership_tier??G?.membership??G?.plan??N?.membership_tier??N?.membership??N?.plan??null,as=G?.portal_enabled??N?.portal_enabled??N?.portalEnabled??!1,at=async()=>{L(!0);try{E.success("Customer updated successfully"),J(!1)}catch(a){E.error("Failed to update customer")}finally{L(!1)}},au=()=>{H(N),J(!1)},av=[(0,b.jsx)(O.Badge,{className:"font-mono",variant:"outline",children:ak},"identifier"),(0,b.jsx)(aJ.CustomerStatusBadge,{status:ai||"active"}),ar?(0,b.jsx)(O.Badge,{variant:"secondary",children:ar},"membership"):null,as?(0,b.jsxs)(O.Badge,{className:"gap-1 text-xs",variant:"outline",children:[(0,b.jsx)(t.Sparkles,{className:"h-3.5 w-3.5"})," Portal Enabled"]},"portal"):null].filter(Boolean),aw=[{key:"new-job",label:"New Job",icon:n.Plus,onClick:()=>D.push(`/dashboard/work/new?customerId=${N.id}`)},{key:"new-invoice",label:"New Invoice",icon:h.FileText,variant:"secondary",onClick:()=>D.push(`/dashboard/work/invoices/new?customerId=${N.id}`)},{key:"schedule-appointment",label:"Schedule Appointment",icon:e.Calendar,variant:"secondary",onClick:()=>D.push(`/dashboard/schedule/new?customerId=${N.id}`)},{key:"add-property",label:"Add Property",icon:d.Building2,variant:"outline",onClick:()=>D.push(`/dashboard/work/properties/new?customerId=${N.id}`)}],ax=()=>aw.map(a=>{let{key:c,label:d,icon:e,onClick:f}=a,g="variant"in a?a.variant:void 0;return(0,b.jsxs)(P.Button,{onClick:f,size:"sm",variant:g??"default",children:[(0,b.jsx)(e,{className:"mr-2 h-4 w-4"}),d]},c)}),az=(0,A.useCallback)(()=>I?(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsxs)(P.Button,{disabled:K,onClick:at,size:"sm",children:[(0,b.jsx)(q.Save,{className:"mr-2 h-4 w-4"}),K?"Saving...":"Save Changes"]}),(0,b.jsx)(P.Button,{onClick:au,size:"sm",variant:"outline",children:"Cancel"})]}):(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[ax(),(0,b.jsx)(ap.Separator,{className:"h-6",orientation:"vertical"}),(0,b.jsxs)(S.DropdownMenu,{children:[(0,b.jsx)(S.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(P.Button,{className:"h-8 w-8",size:"icon",variant:"outline",children:[(0,b.jsx)(k.MoreVertical,{className:"size-4"}),(0,b.jsx)("span",{className:"sr-only",children:"More actions"})]})}),(0,b.jsxs)(S.DropdownMenuContent,{align:"end",className:"w-56",children:[(0,b.jsx)(S.DropdownMenuLabel,{className:"text-muted-foreground text-xs font-medium tracking-wide uppercase",children:"Actions"}),(0,b.jsx)(S.DropdownMenuSeparator,{}),(0,b.jsxs)(S.DropdownMenuItem,{onClick:()=>D.push(`/dashboard/customers/${N.id}/edit`),children:[(0,b.jsx)(w.UserCog,{className:"mr-2 size-3.5"}),"Edit Full Profile"]}),(0,b.jsx)(S.DropdownMenuSeparator,{}),(0,b.jsxs)(S.DropdownMenuItem,{onClick:()=>{},children:[(0,b.jsx)(g.Download,{className:"mr-2 size-3.5"}),"Export Customer Data"]}),(0,b.jsxs)(S.DropdownMenuItem,{onClick:()=>{},children:[(0,b.jsx)(o.Printer,{className:"mr-2 size-3.5"}),"Print Customer Profile"]}),(0,b.jsxs)(S.DropdownMenuItem,{onClick:()=>{},children:[(0,b.jsx)(r.Share2,{className:"mr-2 size-3.5"}),"Share Customer Link"]}),(0,b.jsx)(S.DropdownMenuSeparator,{}),(0,b.jsxs)(S.DropdownMenuItem,{onClick:()=>{},children:[(0,b.jsx)(v.User,{className:"mr-2 size-3.5"}),"Merge with Another Customer"]}),(0,b.jsx)(S.DropdownMenuSeparator,{}),(0,b.jsxs)(S.DropdownMenuItem,{className:"text-destructive focus:text-destructive",onClick:()=>{},children:[(0,b.jsx)(c.Archive,{className:"mr-2 size-3.5"}),"Archive Customer"]})]})]})]}),[I,K,at,au,ax,D,N.id]);(0,A.useEffect)(()=>{F&&M(F,az())},[F,M,az]);let aQ=[{label:"Outstanding Balance",icon:(0,b.jsx)(f.CreditCard,{className:"h-3.5 w-3.5"}),value:(0,ay.formatCurrencyFromDollars)(aq,{decimals:0}),helperText:"Open invoices"},{label:"Lifetime Revenue",icon:(0,b.jsx)(u.TrendingUp,{className:"h-3.5 w-3.5"}),value:(0,ay.formatCurrencyFromDollars)(C?.totalRevenue??0,{decimals:0})},{label:"Jobs",icon:(0,b.jsx)(x.Wrench,{className:"h-3.5 w-3.5"}),value:C?.totalJobs??R.length,helperText:"All time"},{label:"Properties",icon:(0,b.jsx)(d.Building2,{className:"h-3.5 w-3.5"}),value:C?.totalProperties??Q.length}],aR=(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,b.jsx)(e.Calendar,{className:"h-4 w-4"}),ao?`Customer since ${(0,ay.formatDate)(ao,"short")}`:"Customer since ‚Äî"]}),an?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{"aria-hidden":"true",children:"‚Ä¢"}),(0,b.jsxs)(y.default,{className:"text-muted-foreground hover:text-foreground inline-flex items-center gap-1 transition-colors",href:`/dashboard/work/properties/${an.id}`,children:[(0,b.jsx)(j.MapPin,{className:"h-4 w-4"}),an.name||an.address]})]}):null]}),aS=aj.split(" ").map(a=>a?.[0]).filter(Boolean).join("").slice(0,2).toUpperCase(),aT={title:aj,subtitle:aR,badges:av,metadata:aQ,leadingVisual:(0,b.jsxs)(aF.Avatar,{className:"h-12 w-12",children:[(0,b.jsx)(aF.AvatarImage,{alt:aj,src:N?.avatar_url??void 0}),(0,b.jsx)(aF.AvatarFallback,{children:aS||"CU"})]})},aU=[{key:"primary-email",icon:i.Mail,label:"Primary Email",value:al??"Not provided",href:al?`mailto:${al}`:void 0},{key:"primary-phone",icon:m.Phone,label:"Primary Phone",value:am??"Not provided",href:am?`tel:${am}`:void 0},{key:"portal",icon:t.Sparkles,label:"Portal Access",value:as?"Enabled":"Disabled"},{key:"membership",icon:s.ShieldCheck,label:"Membership",value:ar??"Standard"}],aV=[{key:"outstanding",icon:h.FileText,label:"Outstanding",value:(0,ay.formatCurrencyFromDollars)(aq,{decimals:0})},{key:"jobs",icon:u.TrendingUp,label:"Total Jobs",value:C?.totalJobs??R.length},{key:"properties",icon:d.Building2,label:"Properties",value:C?.totalProperties??Q.length},{key:"lifetime-revenue",icon:p.Receipt,label:"Lifetime Revenue",value:(0,ay.formatCurrencyFromDollars)(C?.totalRevenue??0,{decimals:0})}],aW=(0,b.jsx)(aD.DetailPageSurface,{padding:"lg",variant:"muted",children:(0,b.jsxs)("div",{className:"flex flex-col gap-4 md:gap-6",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,b.jsx)(aH.Label,{className:"text-muted-foreground text-xs font-medium uppercase",children:"Display Name"}),(0,b.jsx)(aG.Input,{className:(0,aA.cn)("border-border/40 bg-background focus-visible:ring-primary/50 h-11 md:h-12 rounded-lg border px-3 md:px-4 text-lg md:text-xl font-semibold shadow-none focus-visible:ring-2 sm:text-2xl"),onChange:a=>(a=>{if(G?.company_name||N?.company_name)return void ah("company_name",a);if(G?.display_name||N?.display_name)return void ah("display_name",a);let b=a.trim();if(!b){ah("first_name",""),ah("last_name","");return}let c=b.split(/\s+/);1===c.length?(ah("first_name",c[0]),ah("last_name","")):(ah("first_name",c.slice(0,-1).join(" ")),ah("last_name",c.at(-1)))})(a.target.value),placeholder:"Enter customer name...",value:aj}),(0,b.jsx)("p",{className:"text-muted-foreground text-[0.7rem] md:text-xs",children:"Update how this customer appears across Thorbis. Changes are saved when you select Save changes."})]}),(0,b.jsx)("div",{className:"grid gap-2 md:gap-3 grid-cols-1 sm:grid-cols-2",children:aU.map(({key:a,icon:c,label:d,value:e,href:f})=>(0,b.jsx)("div",{className:"border-border/40 bg-background rounded-lg border px-3 py-2.5 md:py-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 md:gap-3",children:[(0,b.jsx)(c,{className:"text-muted-foreground h-3.5 w-3.5 md:h-4 md:w-4 shrink-0"}),(0,b.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,b.jsx)("span",{className:"text-muted-foreground text-[0.65rem] md:text-xs font-medium uppercase",children:d}),f?(0,b.jsx)("a",{className:"text-xs md:text-sm font-semibold hover:underline truncate",href:f,children:e}):(0,b.jsx)("span",{className:"text-xs md:text-sm font-semibold truncate",children:e})]})]})},a))}),(0,b.jsx)("div",{className:"grid gap-2 md:gap-3 grid-cols-2 lg:grid-cols-4",children:aV.map(({key:a,icon:c,label:d,value:e})=>(0,b.jsx)("div",{className:"border-border/40 bg-background rounded-lg border px-3 py-2.5 md:py-3",children:(0,b.jsxs)("div",{className:"flex flex-col gap-1.5 md:gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(c,{className:"text-muted-foreground h-3.5 w-3.5 md:h-4 md:w-4 shrink-0"}),(0,b.jsx)("span",{className:"text-muted-foreground text-[0.65rem] md:text-xs font-medium uppercase leading-none",children:d})]}),(0,b.jsx)("span",{className:"text-sm md:text-base font-semibold truncate",children:e})]})},a))})]})}),aX=(0,A.useMemo)(()=>[{id:"customer-info",title:"Customer Information",icon:(0,b.jsx)(v.User,{className:"size-4"}),defaultOpen:!0,content:(0,b.jsx)(aL.UnifiedAccordionContent,{children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(aI.StandardFormRow,{cols:2,children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(aI.StandardFormField,{label:"First Name",htmlFor:"first_name",children:(0,b.jsx)(aG.Input,{id:"first_name",onChange:a=>ah("first_name",a.target.value),value:G.first_name||""})}),(0,b.jsx)(aI.StandardFormField,{label:"Last Name",htmlFor:"last_name",children:(0,b.jsx)(aG.Input,{id:"last_name",onChange:a=>ah("last_name",a.target.value),value:G.last_name||""})}),(0,b.jsx)(aI.StandardFormField,{label:"Company Name",htmlFor:"company_name",children:(0,b.jsx)(aG.Input,{id:"company_name",onChange:a=>ah("company_name",a.target.value),value:G.company_name||""})})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(aI.StandardFormField,{label:"Email",htmlFor:"email",children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(aG.Input,{id:"email",onChange:a=>ah("email",a.target.value),type:"email",value:G.email||""}),N.email&&(0,b.jsx)(P.Button,{asChild:!0,size:"icon",variant:"outline",children:(0,b.jsx)("a",{href:`mailto:${N.email}`,children:(0,b.jsx)(i.Mail,{className:"size-4"})})})]})}),(0,b.jsx)(aI.StandardFormField,{label:"Phone",htmlFor:"phone",children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(aG.Input,{id:"phone",onChange:a=>ah("phone",a.target.value),type:"tel",value:G.phone||""}),N.phone&&(0,b.jsx)(P.Button,{asChild:!0,size:"icon",variant:"outline",children:(0,b.jsx)("a",{href:`tel:${N.phone}`,children:(0,b.jsx)(m.Phone,{className:"size-4"})})})]})}),(0,b.jsx)(aI.StandardFormField,{label:"Mobile Phone",htmlFor:"mobile_phone",children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(aG.Input,{id:"mobile_phone",onChange:a=>ah("mobile_phone",a.target.value),type:"tel",value:G.mobile_phone||""}),N.mobile_phone&&(0,b.jsx)(P.Button,{asChild:!0,size:"icon",variant:"outline",children:(0,b.jsx)("a",{href:`tel:${N.mobile_phone}`,children:(0,b.jsx)(m.Phone,{className:"size-4"})})})]})})]})]}),(0,b.jsxs)(aI.StandardFormRow,{cols:2,children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(aI.StandardFormField,{label:"Address",htmlFor:"address",children:(0,b.jsx)(aK.Textarea,{id:"address",onChange:a=>ah("address",a.target.value),rows:3,value:G.address||""})}),(0,b.jsxs)(aI.StandardFormRow,{cols:2,children:[(0,b.jsx)(aI.StandardFormField,{label:"City",htmlFor:"city",children:(0,b.jsx)(aG.Input,{id:"city",onChange:a=>ah("city",a.target.value),value:G.city||""})}),(0,b.jsx)(aI.StandardFormField,{label:"State",htmlFor:"state",children:(0,b.jsx)(aG.Input,{id:"state",onChange:a=>ah("state",a.target.value),value:G.state||""})}),(0,b.jsx)(aI.StandardFormField,{label:"Postal Code",htmlFor:"postal_code",children:(0,b.jsx)(aG.Input,{id:"postal_code",onChange:a=>ah("postal_code",a.target.value),value:G.postal_code||""})}),(0,b.jsx)(aI.StandardFormField,{label:"Country",htmlFor:"country",children:(0,b.jsx)(aG.Input,{id:"country",onChange:a=>ah("country",a.target.value),value:G.country||""})})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(aI.StandardFormField,{label:"Tags",htmlFor:"tags",description:"Comma separated tags",children:(0,b.jsx)(aG.Input,{id:"tags",onChange:a=>ah("tags",a.target.value.split(",").map(a=>a.trim())),placeholder:"Comma separated tags",value:(G.tags||[]).join(", ")})}),(0,b.jsx)(aI.StandardFormField,{label:"Notes",htmlFor:"notes",description:"Internal notes about this customer",children:(0,b.jsx)(aK.Textarea,{id:"notes",onChange:a=>ah("notes",a.target.value),placeholder:"Internal notes about this customer",rows:4,value:G.notes||""})})]})]})]})})},{id:"properties",title:"Properties",icon:(0,b.jsx)(d.Building2,{className:"size-4"}),count:Q.length,actions:(0,b.jsxs)(P.Button,{onClick:()=>D.push(`/dashboard/work/properties/new?customerId=${N.id}`),size:"sm",variant:"outline",children:[(0,b.jsx)(n.Plus,{className:"mr-2 h-4 w-4"})," Add Property"]}),content:(0,b.jsxs)(aL.UnifiedAccordionContent,{className:"p-0",children:[(0,b.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Manage service locations for this customer."}),(0,b.jsx)(aB,{customerId:N.id,itemsPerPage:10,properties:Q})]})},{id:"jobs",title:"Jobs",icon:(0,b.jsx)(x.Wrench,{className:"size-4"}),count:R.length,actions:(0,b.jsxs)(P.Button,{onClick:()=>D.push(`/dashboard/work/new?customerId=${N.id}`),size:"sm",variant:"outline",children:[(0,b.jsx)(n.Plus,{className:"mr-2 h-4 w-4"})," New Job"]}),content:(0,b.jsxs)(aL.UnifiedAccordionContent,{className:"p-0",children:[(0,b.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Recent jobs associated with this customer."}),(0,b.jsx)(aM.JobsTable,{itemsPerPage:10,jobs:R})]})},{id:"invoices",title:"Invoices",icon:(0,b.jsx)(p.Receipt,{className:"size-4"}),actions:(0,b.jsxs)(P.Button,{onClick:()=>D.push(`/dashboard/work/invoices/new?customerId=${N.id}`),size:"sm",variant:"outline",children:[(0,b.jsx)(n.Plus,{className:"mr-2 h-4 w-4"})," New Invoice"]}),content:(0,b.jsxs)(aL.UnifiedAccordionContent,{className:"p-0",children:[(0,b.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Billing history and outstanding invoices."}),(0,b.jsx)(V,{invoices:T||[],onUpdate:()=>{}})]})},{id:"equipment",title:"Equipment",icon:(0,b.jsx)(l.Package,{className:"size-4"}),actions:(0,b.jsxs)(P.Button,{onClick:()=>{},size:"sm",variant:"outline",children:[(0,b.jsx)(n.Plus,{className:"mr-2 h-4 w-4"})," Add Equipment"]}),content:(0,b.jsx)(aL.UnifiedAccordionContent,{children:ab.length>0?(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:ab.map(a=>(0,b.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"bg-primary/10 rounded-md p-2",children:(0,b.jsx)(x.Wrench,{className:"text-primary h-4 w-4"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.name}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:a.type||a.category||"Equipment"})]})]}),(0,b.jsxs)("div",{className:"mt-3 space-y-1 text-sm",children:[a.serial_number&&(0,b.jsxs)("p",{className:"text-muted-foreground",children:["Serial: ",a.serial_number]}),a.manufacturer&&(0,b.jsxs)("p",{className:"text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(d.Building2,{className:"h-4 w-4"}),a.manufacturer]}),a.install_date&&(0,b.jsxs)("p",{className:"text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(e.Calendar,{className:"h-4 w-4"}),"Installed ",(0,ay.formatDate)(a.install_date,"short")]})]})]},a.id))}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center rounded-lg border border-dashed p-6 text-center",children:[(0,b.jsx)(l.Package,{className:"text-muted-foreground h-6 w-6"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No equipment on record for this customer yet."})]})})},{id:"payment-methods",title:"Payment Methods",icon:(0,b.jsx)(f.CreditCard,{className:"size-4"}),count:ad.length,actions:(0,b.jsxs)(P.Button,{onClick:()=>{},size:"sm",variant:"outline",children:[(0,b.jsx)(n.Plus,{className:"mr-2 h-4 w-4"})," Add Payment Method"]}),content:(0,b.jsx)(aL.UnifiedAccordionContent,{children:ad.length>0?(0,b.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:ad.map(a=>{let c="ach"===a.type||"bank"===a.type?a.type:"card";return(0,b.jsx)(Y,{account_type:a.account_type,bank_name:a.bank_name,card_brand:a.brand||a.card_brand,card_exp_month:a.exp_month||a.card_exp_month,card_exp_year:a.exp_year||a.card_exp_year,card_last4:a.last4||a.card_last_four||a.card_last4,cardholder_name:a.cardholder_name||a.name,id:a.id,is_default:a.is_default,is_verified:a.is_verified,nickname:a.nickname,onRemove:()=>{},onSetDefault:()=>{},type:c},a.id)})}):(0,b.jsxs)("div",{className:"bg-muted/30 flex flex-col items-center justify-center rounded-lg border border-dashed py-12 text-center",children:[(0,b.jsx)(f.CreditCard,{className:"text-muted-foreground/50 mb-3 size-12"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm font-medium",children:"No payment methods on file"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1 text-xs",children:"Add a card or bank account for quick invoicing"})]})})},{id:"estimates",title:"Estimates",icon:(0,b.jsx)(h.FileText,{className:"size-4"}),count:U.length,actions:(0,b.jsxs)(P.Button,{onClick:()=>D.push(`/dashboard/work/estimates/new?customerId=${N.id}`),size:"sm",variant:"outline",children:[(0,b.jsx)(n.Plus,{className:"mr-2 h-4 w-4"})," New Estimate"]}),content:(0,b.jsxs)(aL.UnifiedAccordionContent,{className:"p-0",children:[(0,b.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Estimates and quotes provided to this customer."}),U.length>0?(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-muted/50 border-b",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Estimate #"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Date"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Total"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Status"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Actions"})]})}),(0,b.jsx)("tbody",{children:U.map(a=>(0,b.jsxs)("tr",{className:"hover:bg-muted/30 border-b",children:[(0,b.jsxs)("td",{className:"px-6 py-4 text-sm",children:["#",a.estimate_number||a.id.slice(0,8)]}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,ay.formatDate)(a.created_at,"short")}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm font-medium",children:(0,ay.formatCurrencyFromDollars)(a.total_amount/100)}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,b.jsx)(O.Badge,{variant:"outline",children:a.status||"draft"})}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,b.jsx)(y.default,{className:"text-primary hover:underline",href:`/dashboard/work/estimates/${a.id}`,children:"View"})})]},a.id))})]})}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[(0,b.jsx)(h.FileText,{className:"text-muted-foreground h-8 w-8"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No estimates for this customer yet."})]})]})},{id:"appointments",title:"Appointments",icon:(0,b.jsx)(e.Calendar,{className:"size-4"}),count:W.length,actions:(0,b.jsxs)(P.Button,{onClick:()=>D.push(`/dashboard/schedule?customerId=${N.id}`),size:"sm",variant:"outline",children:[(0,b.jsx)(n.Plus,{className:"mr-2 h-4 w-4"})," Schedule Appointment"]}),content:(0,b.jsxs)(aL.UnifiedAccordionContent,{className:"p-0",children:[(0,b.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Scheduled appointments and service visits for this customer."}),W.length>0?(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-muted/50 border-b",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Date & Time"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Type"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Property"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Job"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Status"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Actions"})]})}),(0,b.jsx)("tbody",{children:W.map(a=>(0,b.jsxs)("tr",{className:"hover:bg-muted/30 border-b",children:[(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:new Date(a.scheduled_start).toLocaleString()}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:a.type||"Service"}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:a.property?.name||a.property?.address||"-"}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:a.job?.job_number?`#${a.job.job_number}`:"-"}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,b.jsx)(O.Badge,{variant:"outline",children:a.status||"scheduled"})}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,b.jsx)(y.default,{className:"text-primary hover:underline",href:`/dashboard/appointments/${a.id}`,children:"View"})})]},a.id))})]})}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[(0,b.jsx)(e.Calendar,{className:"text-muted-foreground h-8 w-8"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No appointments scheduled for this customer."})]})]})},{id:"contracts",title:"Contracts",icon:(0,b.jsx)(h.FileText,{className:"size-4"}),count:X.length,content:(0,b.jsxs)(aL.UnifiedAccordionContent,{className:"p-0",children:[(0,b.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Service contracts and agreements signed by this customer."}),X.length>0?(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-muted/50 border-b",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Contract #"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Date"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Related To"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Status"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Actions"})]})}),(0,b.jsx)("tbody",{children:X.map(a=>(0,b.jsxs)("tr",{className:"hover:bg-muted/30 border-b",children:[(0,b.jsxs)("td",{className:"px-6 py-4 text-sm",children:["#",a.contract_number||a.id.slice(0,8)]}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,ay.formatDate)(a.created_at,"short")}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:a.job?`Job #${a.job.job_number}`:a.estimate?`Est #${a.estimate.estimate_number}`:a.invoice?`Inv #${a.invoice.invoice_number}`:"-"}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,b.jsx)(O.Badge,{variant:"outline",children:a.status||"draft"})}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,b.jsx)(y.default,{className:"text-primary hover:underline",href:`/dashboard/work/contracts/${a.id}`,children:"View"})})]},a.id))})]})}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[(0,b.jsx)(h.FileText,{className:"text-muted-foreground h-8 w-8"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No contracts for this customer."})]})]})},{id:"payments",title:"Payments",icon:(0,b.jsx)(f.CreditCard,{className:"size-4"}),count:Z.length,content:(0,b.jsxs)(aL.UnifiedAccordionContent,{className:"p-0",children:[(0,b.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Payment history and transactions from this customer."}),Z.length>0?(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-muted/50 border-b",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Payment #"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Date"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Amount"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Method"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Invoice"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Status"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Actions"})]})}),(0,b.jsx)("tbody",{children:Z.map(a=>(0,b.jsxs)("tr",{className:"hover:bg-muted/30 border-b",children:[(0,b.jsxs)("td",{className:"px-6 py-4 text-sm",children:["#",a.payment_number||a.id.slice(0,8)]}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,ay.formatDate)(a.created_at,"short")}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm font-medium",children:(0,ay.formatCurrencyFromDollars)(a.amount/100)}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm capitalize",children:a.payment_method?.replace("_"," ")||"-"}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:a.invoice?`#${a.invoice.invoice_number}`:"-"}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,b.jsx)(O.Badge,{variant:"completed"===a.status?"default":"outline",children:a.status})}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,b.jsx)(y.default,{className:"text-primary hover:underline",href:`/dashboard/work/payments/${a.id}`,children:"View"})})]},a.id))})]})}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[(0,b.jsx)(f.CreditCard,{className:"text-muted-foreground h-8 w-8"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No payment history for this customer."})]})]})},{id:"maintenance-plans",title:"Maintenance Plans",icon:(0,b.jsx)(s.ShieldCheck,{className:"size-4"}),count:$.length,content:(0,b.jsxs)(aL.UnifiedAccordionContent,{className:"p-0",children:[(0,b.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Recurring maintenance plans for this customer's equipment."}),$.length>0?(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-muted/50 border-b",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Plan Name"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Property"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Frequency"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Status"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Actions"})]})}),(0,b.jsx)("tbody",{children:$.map(a=>(0,b.jsxs)("tr",{className:"hover:bg-muted/30 border-b",children:[(0,b.jsx)("td",{className:"px-6 py-4 text-sm font-medium",children:a.name||`Plan ${a.id.slice(0,8)}`}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:a.property?.name||a.property?.address||"-"}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm capitalize",children:a.frequency||"Monthly"}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,b.jsx)(O.Badge,{variant:"outline",children:a.status||"active"})}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,b.jsx)(y.default,{className:"text-primary hover:underline",href:`/dashboard/work/maintenance-plans/${a.id}`,children:"View"})})]},a.id))})]})}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[(0,b.jsx)(s.ShieldCheck,{className:"text-muted-foreground h-8 w-8"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No maintenance plans for this customer."})]})]})},{id:"service-agreements",title:"Service Agreements",icon:(0,b.jsx)(h.FileText,{className:"size-4"}),count:_.length,content:(0,b.jsxs)(aL.UnifiedAccordionContent,{className:"p-0",children:[(0,b.jsx)("div",{className:"text-muted-foreground border-b px-6 py-4 text-sm",children:"Long-term service agreements and ongoing contracts."}),_.length>0?(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-muted/50 border-b",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Agreement #"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Property"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Start Date"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"End Date"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Status"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium",children:"Actions"})]})}),(0,b.jsx)("tbody",{children:_.map(a=>(0,b.jsxs)("tr",{className:"hover:bg-muted/30 border-b",children:[(0,b.jsxs)("td",{className:"px-6 py-4 text-sm",children:["#",a.id.slice(0,8)]}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:a.property?.name||a.property?.address||"-"}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:a.start_date?(0,ay.formatDate)(a.start_date,"short"):"-"}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:a.end_date?(0,ay.formatDate)(a.end_date,"short"):"-"}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,b.jsx)(O.Badge,{variant:"outline",children:a.status||"active"})}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,b.jsx)(y.default,{className:"text-primary hover:underline",href:`/dashboard/work/service-agreements/${a.id}`,children:"View"})})]},a.id))})]})}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[(0,b.jsx)(h.FileText,{className:"text-muted-foreground h-8 w-8"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"No service agreements for this customer."})]})]})}],[N.id,N.email,N.mobile_phone,N.phone,ab,U,W,X,Z,$,_,ah,R,G,ad,Q,D,T]),aY=(0,A.useMemo)(()=>{let a=[];if(an&&a.push({id:`property-${an.id}`,type:"property",title:an.name||an.address,subtitle:`${an.city||""}, ${an.state||""}`,href:`/dashboard/work/properties/${an.id}`}),R.length>0){let b=R[0];a.push({id:`job-${b.id}`,type:"job",title:b.title||`Job #${b.job_number}`,subtitle:b.status,href:`/dashboard/work/${b.id}`,badge:b.status?{label:b.status,variant:"outline"}:void 0})}return a},[R,an]),aZ=(0,b.jsx)("div",{className:"w-full px-2 sm:px-0",children:(0,b.jsx)("div",{className:"bg-muted/50 mx-auto max-w-7xl rounded-md shadow-sm",children:(0,b.jsxs)("div",{className:"flex flex-col gap-3 p-4 sm:p-6",children:[(0,b.jsx)("span",{className:"text-muted-foreground text-xs font-medium",children:"Tags:"}),(0,b.jsx)(aE.EntityTags,{entityId:N.id,entityType:"customer",onUpdateTags:async(a,b)=>{(await (0,B.updateEntityTags)("customer",a,b)).success&&D.refresh()},tags:af})]})})});return(0,b.jsx)(aC.DetailPageContentLayout,{activities:aa,attachments:ac,beforeContent:aW,customHeader:aZ,customSections:aX,defaultOpenSection:"customer-info",enableReordering:!0,header:aT,notes:[],relatedItems:aY,showStandardSections:{notes:!1},storageKey:"customer-details"})}a.s(["CustomerPageContent",()=>aQ],471104)}];

//# sourceMappingURL=apps_web_src_components_customers_customer-page-content_tsx_4a113b09._.js.map