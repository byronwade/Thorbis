{"version":3,"sources":["../../../../../../apps/web/src/components/ui/skeleton.tsx","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/schedule/technician/%5Bid%5D/technician-day-view.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/schedule/technician/%5Bid%5D/page.tsx","../../../../../../apps/web/src/app/%28dashboard%29/dashboard/schedule/technician/%5Bid%5D/technician-day-view-skeleton.tsx"],"sourcesContent":["// Re-export from @stratos/ui package\nexport * from \"@stratos/ui\";\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const TechnicianDayView = registerClientReference(\n    function() { throw new Error(\"Attempted to call TechnicianDayView() from the server but TechnicianDayView is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/src/app/(dashboard)/dashboard/schedule/technician/[id]/technician-day-view.tsx\",\n    \"TechnicianDayView\",\n);\n","import { getActiveCompanyId } from \"@stratos/auth/company-context\";\nimport { notFound } from \"next/navigation\";\nimport { Suspense } from \"react\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { TechnicianDayView } from \"./technician-day-view\";\nimport { TechnicianDayViewSkeleton } from \"./technician-day-view-skeleton\";\n\nexport async function generateMetadata({\n\tparams,\n}: {\n\tparams: Promise<{ id: string }>;\n}) {\n\tconst { id } = await params;\n\tconst supabase = await createClient();\n\n\tconst { data: technician } = await supabase\n\t\t.from(\"team_members\")\n\t\t.select(`\n\t\t\tinvited_name,\n\t\t\tuser:users (name)\n\t\t`)\n\t\t.eq(\"id\", id)\n\t\t.single();\n\n\tconst name = technician?.user?.name || technician?.invited_name;\n\n\treturn {\n\t\ttitle: name ? `${name} - Today's Schedule` : \"Technician Schedule\",\n\t\tdescription: \"View technician's daily schedule, route, and performance\",\n\t};\n}\n\nasync function TechnicianData({ technicianId }: { technicianId: string }) {\n\tconst supabase = await createClient();\n\tconst companyId = await getActiveCompanyId();\n\n\tif (!companyId) {\n\t\tnotFound();\n\t}\n\n\t// Get technician details with user info\n\tconst { data: technicianData, error: techError } = await supabase\n\t\t.from(\"team_members\")\n\t\t.select(\n\t\t\t`\n\t\t\tid,\n\t\t\tinvited_name,\n\t\t\temail,\n\t\t\tphone,\n\t\t\trole,\n\t\t\tstatus,\n\t\t\tjob_title,\n\t\t\tdepartment,\n\t\t\tjoined_at,\n\t\t\tuser:users (\n\t\t\t\tname,\n\t\t\t\tavatar,\n\t\t\t\tphone,\n\t\t\t\tbio\n\t\t\t)\n\t\t`,\n\t\t)\n\t\t.eq(\"id\", technicianId)\n\t\t.eq(\"company_id\", companyId)\n\t\t.single();\n\n\tif (techError || !technicianData) {\n\t\tnotFound();\n\t}\n\n\t// Transform to expected format\n\tconst technician = {\n\t\tid: technicianData.id,\n\t\tname: technicianData.user?.name || technicianData.invited_name || \"Unknown\",\n\t\temail: technicianData.email,\n\t\tphone: technicianData.phone || technicianData.user?.phone,\n\t\tavatar: technicianData.user?.avatar,\n\t\trole: technicianData.role,\n\t\tstatus: technicianData.status,\n\t\tjob_title: technicianData.job_title,\n\t\tdepartment: technicianData.department,\n\t\tjoined_at: technicianData.joined_at,\n\t\tbio: technicianData.user?.bio,\n\t};\n\n\t// Get today's date range\n\tconst today = new Date();\n\ttoday.setHours(0, 0, 0, 0);\n\tconst tomorrow = new Date(today);\n\ttomorrow.setDate(tomorrow.getDate() + 1);\n\n\t// Get today's appointments for this technician\n\tconst { data: appointments } = await supabase\n\t\t.from(\"appointments\")\n\t\t.select(\n\t\t\t`\n\t\t\tid,\n\t\t\tscheduled_start,\n\t\t\tscheduled_end,\n\t\t\tstatus,\n\t\t\tnotes,\n\t\t\tjob:jobs (\n\t\t\t\tid,\n\t\t\t\ttitle,\n\t\t\t\tdescription,\n\t\t\t\tjob_type,\n\t\t\t\tpriority,\n\t\t\t\tstatus,\n\t\t\t\ttotal_amount,\n\t\t\t\tcustomer:customers (\n\t\t\t\t\tid,\n\t\t\t\t\tdisplay_name,\n\t\t\t\t\tphone,\n\t\t\t\t\temail,\n\t\t\t\t\taddress,\n\t\t\t\t\tcity,\n\t\t\t\t\tstate,\n\t\t\t\t\tzip_code,\n\t\t\t\t\tlat,\n\t\t\t\t\tlon\n\t\t\t\t),\n\t\t\t\tproperty:properties (\n\t\t\t\t\tid,\n\t\t\t\t\taddress,\n\t\t\t\t\tcity,\n\t\t\t\t\tstate,\n\t\t\t\t\tzip_code,\n\t\t\t\t\tlat,\n\t\t\t\t\tlon\n\t\t\t\t)\n\t\t\t)\n\t\t`,\n\t\t)\n\t\t.eq(\"company_id\", companyId)\n\t\t.contains(\"assigned_technician_ids\", [technicianId])\n\t\t.gte(\"scheduled_start\", today.toISOString())\n\t\t.lt(\"scheduled_start\", tomorrow.toISOString())\n\t\t.order(\"scheduled_start\", { ascending: true });\n\n\t// Get unassigned jobs for nearby suggestions\n\tconst { data: unassignedJobs } = await supabase\n\t\t.from(\"jobs\")\n\t\t.select(\n\t\t\t`\n\t\t\tid,\n\t\t\ttitle,\n\t\t\tjob_type,\n\t\t\tpriority,\n\t\t\tstatus,\n\t\t\ttotal_amount,\n\t\t\tcustomer:customers (\n\t\t\t\tid,\n\t\t\t\tdisplay_name,\n\t\t\t\taddress,\n\t\t\t\tcity,\n\t\t\t\tstate,\n\t\t\t\tlat,\n\t\t\t\tlon\n\t\t\t),\n\t\t\tproperty:properties (\n\t\t\t\tid,\n\t\t\t\taddress,\n\t\t\t\tcity,\n\t\t\t\tstate,\n\t\t\t\tlat,\n\t\t\t\tlon\n\t\t\t)\n\t\t`,\n\t\t)\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"status\", \"pending\")\n\t\t.is(\"archived_at\", null)\n\t\t.limit(20);\n\n\t// Get technician's GPS location\n\tconst { data: gpsLocation } = await supabase\n\t\t.from(\"technician_locations\")\n\t\t.select(\"*\")\n\t\t.eq(\"technician_id\", technicianId)\n\t\t.single();\n\n\t// Get performance stats for this technician (last 30 days)\n\tconst thirtyDaysAgo = new Date();\n\tthirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\n\tconst { data: recentAppointments } = await supabase\n\t\t.from(\"appointments\")\n\t\t.select(\"id, status, scheduled_start, actual_start, actual_end\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.contains(\"assigned_technician_ids\", [technicianId])\n\t\t.gte(\"scheduled_start\", thirtyDaysAgo.toISOString())\n\t\t.lt(\"scheduled_start\", tomorrow.toISOString());\n\n\t// Calculate stats\n\tconst completedCount =\n\t\trecentAppointments?.filter(\n\t\t\t(a) => a.status === \"completed\" || a.status === \"closed\",\n\t\t).length || 0;\n\tconst totalCount = recentAppointments?.length || 0;\n\n\t// Get today's stats\n\tconst todayAppointments = appointments || [];\n\tconst todayCompleted = todayAppointments.filter(\n\t\t(a) => a.status === \"completed\" || a.status === \"closed\",\n\t).length;\n\tconst todayTotal = todayAppointments.length;\n\n\tconst stats = {\n\t\ttodayCompleted,\n\t\ttodayTotal,\n\t\ttodayRemaining: todayTotal - todayCompleted,\n\t\tmonthCompleted: completedCount,\n\t\tmonthTotal: totalCount,\n\t\tcompletionRate: totalCount > 0 ? (completedCount / totalCount) * 100 : 0,\n\t};\n\n\treturn (\n\t\t<TechnicianDayView\n\t\t\ttechnician={technician}\n\t\t\tappointments={appointments || []}\n\t\t\tunassignedJobs={unassignedJobs || []}\n\t\t\tgpsLocation={gpsLocation}\n\t\t\tstats={stats}\n\t\t\tcompanyId={companyId}\n\t\t/>\n\t);\n}\n\nexport default async function TechnicianDetailPage({\n\tparams,\n}: {\n\tparams: Promise<{ id: string }>;\n}) {\n\tconst { id } = await params;\n\n\treturn (\n\t\t<Suspense fallback={<TechnicianDayViewSkeleton />}>\n\t\t\t<TechnicianData technicianId={id} />\n\t\t</Suspense>\n\t);\n}\n","import { Skeleton } from \"@/components/ui/skeleton\";\n\nexport function TechnicianDayViewSkeleton() {\n\treturn (\n\t\t<div className=\"flex h-full flex-col\">\n\t\t\t{/* Header */}\n\t\t\t<div className=\"border-b bg-card px-6 py-4\">\n\t\t\t\t<div className=\"flex items-center gap-4\">\n\t\t\t\t\t<Skeleton className=\"h-16 w-16 rounded-full\" />\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<Skeleton className=\"h-6 w-48\" />\n\t\t\t\t\t\t<Skeleton className=\"h-4 w-32\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"ml-auto flex gap-2\">\n\t\t\t\t\t\t<Skeleton className=\"h-9 w-24\" />\n\t\t\t\t\t\t<Skeleton className=\"h-9 w-24\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Stats row */}\n\t\t\t<div className=\"border-b bg-muted/30 px-6 py-3\">\n\t\t\t\t<div className=\"flex gap-6\">\n\t\t\t\t\t{[...Array(5)].map((_, i) => (\n\t\t\t\t\t\t<div key={i} className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Skeleton className=\"h-8 w-8 rounded\" />\n\t\t\t\t\t\t\t<div className=\"space-y-1\">\n\t\t\t\t\t\t\t\t<Skeleton className=\"h-3 w-16\" />\n\t\t\t\t\t\t\t\t<Skeleton className=\"h-5 w-12\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Main content */}\n\t\t\t<div className=\"flex flex-1 overflow-hidden\">\n\t\t\t\t{/* Timeline/Route section */}\n\t\t\t\t<div className=\"flex-1 border-r p-6\">\n\t\t\t\t\t<Skeleton className=\"mb-4 h-6 w-32\" />\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t{[...Array(4)].map((_, i) => (\n\t\t\t\t\t\t\t<div key={i} className=\"flex gap-4\">\n\t\t\t\t\t\t\t\t<Skeleton className=\"h-12 w-12 rounded-full\" />\n\t\t\t\t\t\t\t\t<div className=\"flex-1 space-y-2\">\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-5 w-48\" />\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-4 w-64\" />\n\t\t\t\t\t\t\t\t\t<Skeleton className=\"h-4 w-32\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Map section */}\n\t\t\t\t<div className=\"w-[500px] p-6\">\n\t\t\t\t\t<Skeleton className=\"mb-4 h-6 w-24\" />\n\t\t\t\t\t<Skeleton className=\"h-[400px] w-full rounded-lg\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n"],"names":[],"mappings":"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","ignoreList":[1]}