module.exports=[188351,a=>{"use strict";a.i(907279);var b,c=a.i(538271),d=a.i(140621);let e={default:{maxTokens:100,refillRate:100/60,refillInterval:1e3},sms:{maxTokens:60,refillRate:1,refillInterval:1e3},voice:{maxTokens:30,refillRate:.5,refillInterval:1e3},lookup:{maxTokens:200,refillRate:200/60,refillInterval:1e3},webhook:{maxTokens:1e3,refillRate:100,refillInterval:1e3}};class f{buckets=new Map;processingQueue=new Map;getBucket(a,b){return this.buckets.has(a)||this.buckets.set(a,{tokens:b.maxTokens,lastRefill:Date.now(),queue:[]}),this.buckets.get(a)}refillTokens(a,b){let c=Date.now(),d=Math.floor((c-a.lastRefill)/b.refillInterval);if(d>0){let e=d*b.refillRate;a.tokens=Math.min(b.maxTokens,a.tokens+e),a.lastRefill=c}}async processQueue(a,b){if(this.processingQueue.get(a))return;this.processingQueue.set(a,!0);let c=this.getBucket(a,b);for(;c.queue.length>0;)if(this.refillTokens(c,b),c.tokens>=1){let a=c.queue.shift();if(a){c.tokens-=1;let b=Date.now()-a.requestedAt;a.resolve({allowed:!0,remainingTokens:c.tokens,waitTime:b})}}else{let a=b.refillInterval/b.refillRate;await (0,d.sleep)(Math.ceil(a))}this.processingQueue.set(a,!1)}tryAcquire(a,b=e.default){let c=this.getBucket(a,b);return(this.refillTokens(c,b),c.tokens>=1)?(c.tokens-=1,{allowed:!0,remainingTokens:c.tokens}):{allowed:!1,remainingTokens:0,retryAfterMs:Math.ceil(b.refillInterval/b.refillRate)}}async acquire(a,b=e.default,c=3e4){let d=this.tryAcquire(a,b);if(d.allowed)return d;let f=this.getBucket(a,b);return new Promise((d,e)=>{let g=Date.now(),h=setTimeout(()=>{let a=f.queue.findIndex(a=>a.requestedAt===g);-1!==a&&f.queue.splice(a,1),d({allowed:!1,remainingTokens:0,retryAfterMs:c})},c);f.queue.push({resolve:a=>{clearTimeout(h),d(a)},requestedAt:g}),this.processQueue(a,b)})}getStatus(a,b=e.default){let c=this.getBucket(a,b);return this.refillTokens(c,b),{tokens:Math.floor(c.tokens),maxTokens:b.maxTokens,queueLength:c.queue.length,utilizationPercent:Math.round((b.maxTokens-c.tokens)/b.maxTokens*100)}}reset(a){this.buckets.delete(a)}resetAll(){this.buckets.clear()}}let g=new f,h=new Map;async function i(a="default",b,c=3e4){let d=e[a]||e.default,j=`global:${a}`,k=await g.acquire(j,d,c);if(!k.allowed)return k;if(b){let e=(h.has(b)||h.set(b,new f),h.get(b)),g=await e.acquire(a,d,c);return g.allowed?{...g,waitTime:Math.max(k.waitTime||0,g.waitTime||0)}:g}return k}(b={}).NETWORK_ERROR="TELNYX_NETWORK_ERROR",b.TIMEOUT="TELNYX_TIMEOUT",b.CONNECTION_REFUSED="TELNYX_CONNECTION_REFUSED",b.INVALID_API_KEY="TELNYX_INVALID_API_KEY",b.UNAUTHORIZED="TELNYX_UNAUTHORIZED",b.FORBIDDEN="TELNYX_FORBIDDEN",b.RATE_LIMIT_EXCEEDED="TELNYX_RATE_LIMIT_EXCEEDED",b.INVALID_PHONE_NUMBER="TELNYX_INVALID_PHONE_NUMBER",b.INVALID_REQUEST="TELNYX_INVALID_REQUEST",b.MISSING_REQUIRED_FIELD="TELNYX_MISSING_REQUIRED_FIELD",b.NOT_FOUND="TELNYX_NOT_FOUND",b.RESOURCE_CONFLICT="TELNYX_RESOURCE_CONFLICT",b.PROVIDER_ERROR="TELNYX_PROVIDER_ERROR",b.CARRIER_ERROR="TELNYX_CARRIER_ERROR",b.DELIVERY_FAILED="TELNYX_DELIVERY_FAILED",b.CALL_REJECTED="TELNYX_CALL_REJECTED",b.CALL_BUSY="TELNYX_CALL_BUSY",b.CALL_NO_ANSWER="TELNYX_CALL_NO_ANSWER",b.CALL_FAILED="TELNYX_CALL_FAILED",b.SMS_DELIVERY_FAILED="TELNYX_SMS_DELIVERY_FAILED",b.SMS_BLOCKED="TELNYX_SMS_BLOCKED",b.SMS_SPAM_DETECTED="TELNYX_SMS_SPAM_DETECTED",b.WEBHOOK_VALIDATION_FAILED="TELNYX_WEBHOOK_VALIDATION_FAILED",b.WEBHOOK_SIGNATURE_INVALID="TELNYX_WEBHOOK_SIGNATURE_INVALID",b.WEBHOOK_TIMESTAMP_INVALID="TELNYX_WEBHOOK_TIMESTAMP_INVALID",b.WEBHOOK_REPLAY_DETECTED="TELNYX_WEBHOOK_REPLAY_DETECTED",b.CIRCUIT_BREAKER_OPEN="TELNYX_CIRCUIT_BREAKER_OPEN",b.UNKNOWN_ERROR="TELNYX_UNKNOWN_ERROR",b.INTERNAL_ERROR="TELNYX_INTERNAL_ERROR";class j extends Error{code;metadata;timestamp;retryable;retryAfterMs;constructor(a,b="TELNYX_UNKNOWN_ERROR",c={}){super(a),this.name="TelnyxError",this.code=b,this.metadata=c,this.timestamp=new Date,this.retryable=c.retryable??this.isRetryableCode(b),this.retryAfterMs=c.retryAfterMs,Error.captureStackTrace&&Error.captureStackTrace(this,j)}isRetryableCode(a){return["TELNYX_NETWORK_ERROR","TELNYX_TIMEOUT","TELNYX_CONNECTION_REFUSED","TELNYX_RATE_LIMIT_EXCEEDED","TELNYX_PROVIDER_ERROR","TELNYX_INTERNAL_ERROR"].includes(a)}toJSON(){return{name:this.name,message:this.message,code:this.code,metadata:this.metadata,timestamp:this.timestamp.toISOString(),retryable:this.retryable,retryAfterMs:this.retryAfterMs,stack:this.stack}}toUserMessage(){switch(this.code){case"TELNYX_INVALID_PHONE_NUMBER":return"The phone number provided is invalid. Please check and try again.";case"TELNYX_RATE_LIMIT_EXCEEDED":return"Too many requests. Please wait a moment and try again.";case"TELNYX_CALL_BUSY":return"The number is busy. Please try again later.";case"TELNYX_CALL_NO_ANSWER":return"No answer. The call was not picked up.";case"TELNYX_SMS_BLOCKED":return"Message could not be delivered. The recipient may have blocked messages.";case"TELNYX_UNAUTHORIZED":case"TELNYX_INVALID_API_KEY":return"Authentication failed. Please contact support.";case"TELNYX_NETWORK_ERROR":case"TELNYX_TIMEOUT":return"Connection issue. Please try again.";default:return"An error occurred. Please try again or contact support."}}}class k extends j{constructor(a,b={}){super(a,"TELNYX_NETWORK_ERROR",{...b,retryable:!0}),this.name="TelnyxNetworkError"}}class l extends j{timeoutMs;constructor(a,b,c={}){super(a,"TELNYX_TIMEOUT",{...c,retryable:!0}),this.name="TelnyxTimeoutError",this.timeoutMs=b}}class m extends j{constructor(a,b,c={}){super(a,"TELNYX_RATE_LIMIT_EXCEEDED",{...c,retryable:!0,retryAfterMs:b}),this.name="TelnyxRateLimitError"}}class n extends j{constructor(a,b={}){super(a,403===b.statusCode?"TELNYX_FORBIDDEN":"TELNYX_UNAUTHORIZED",{...b,retryable:!1}),this.name="TelnyxAuthError"}}class o extends j{field;validationDetails;constructor(a,b={}){super(a,"TELNYX_INVALID_REQUEST",{...b,retryable:!1}),this.name="TelnyxValidationError",this.field=b.field,this.validationDetails=b.validationDetails}}let p=new class{requests=[];operations={smsSent:0,smsDelivered:0,smsFailed:0,callsInitiated:0,callsCompleted:0,callsFailed:0,webhooksReceived:0,webhooksProcessed:0,webhooksFailed:0};retentionMs=36e5;maxEntries=1e4;cleanupInterval;constructor(){this.startCleanup()}startCleanup(){this.cleanupInterval=setInterval(()=>{this.cleanup()},6e4),this.cleanupInterval.unref&&this.cleanupInterval.unref()}cleanup(){let a=Date.now()-this.retentionMs,b=this.requests.length;this.requests=this.requests.filter(b=>b.timestamp.getTime()>a),this.requests.length>this.maxEntries&&(this.requests=this.requests.slice(-this.maxEntries));let d=b-this.requests.length;d>0&&c.telnyxLogger.debug("Metrics cleanup",{removed:d})}recordRequest(a){this.requests.push(a),a.latencyMs>2e3&&c.telnyxLogger.warn("Slow request detected",{endpoint:a.endpoint,latencyMs:a.latencyMs,correlationId:a.correlationId})}recordSmsSent(a){this.operations.smsSent++,!a&&this.operations.smsFailed++}recordSmsDelivered(){this.operations.smsDelivered++}recordCallInitiated(a){this.operations.callsInitiated++,!a&&this.operations.callsFailed++}recordCallCompleted(){this.operations.callsCompleted++}recordWebhook(a){this.operations.webhooksReceived++,a?this.operations.webhooksProcessed++:this.operations.webhooksFailed++}getAggregatedMetrics(a=3e5){let b=Date.now()-a,c=this.requests.filter(a=>a.timestamp.getTime()>b),d=c.filter(a=>a.success).length,e=c.length-d,f=c.map(a=>a.latencyMs).sort((a,b)=>a-b),g=(a,b)=>{if(0===a.length)return 0;let c=Math.ceil(b/100*a.length)-1;return a[Math.max(0,c)]},h={};for(let a of c)h[a.endpoint]||(h[a.endpoint]={count:0,errors:0,totalLatency:0}),h[a.endpoint].count++,h[a.endpoint].totalLatency+=a.latencyMs,!a.success&&h[a.endpoint].errors++;let i={};for(let a of c)i[a.statusCode]=(i[a.statusCode]||0)+1;return{totalRequests:c.length,successfulRequests:d,failedRequests:e,errorRate:c.length>0?e/c.length:0,latency:{p50:g(f,50),p95:g(f,95),p99:g(f,99),avg:f.length>0?f.reduce((a,b)=>a+b,0)/f.length:0,min:f[0]||0,max:f[f.length-1]||0},byEndpoint:Object.fromEntries(Object.entries(h).map(([a,b])=>[a,{count:b.count,errors:b.errors,avgLatency:b.totalLatency/b.count}])),byStatusCode:i}}getOperationMetrics(){return{...this.operations}}getHealthScore(a=3e5){let b=this.getAggregatedMetrics(a);return 0===b.totalRequests?100:Math.round(.5*Math.max(0,100-1e3*b.errorRate)+.3*Math.max(0,100-b.latency.p95/3e3*100)+.2*Math.max(0,100-1e3*(Object.entries(b.byStatusCode).filter(([a])=>parseInt(a)>=500).reduce((a,[,b])=>a+b,0)/b.totalRequests)))}reset(){this.requests=[],this.operations={smsSent:0,smsDelivered:0,smsFailed:0,callsInitiated:0,callsCompleted:0,callsFailed:0,webhooksReceived:0,webhooksProcessed:0,webhooksFailed:0}}stop(){this.cleanupInterval&&clearInterval(this.cleanupInterval)}},q={default:3e4,sms:1e4,voice:3e4,lookup:5e3,webhook:2e3,balance:5e3};async function r(a,b={}){let e,{method:f="GET",body:g,timeout:h,timeoutType:s="default",rateLimitEndpoint:t="default",companyId:u,correlationId:v=(0,d.generateCorrelationId)(),skipRetry:w=!1,skipRateLimit:x=!1,retryOptions:y={}}=b,z=process.env.TELNYX_API_KEY;if(!z)return{success:!1,error:"TELNYX_API_KEY is not configured",errorCode:"CONFIG_ERROR",correlationId:v};let A=/^https?:\/\//i.test(a),B=A||a.startsWith("/")?a:`/${a}`,C=A?B:B.startsWith("/public/")?`https://api.telnyx.com${B}`:`https://api.telnyx.com/v2${B}`,D=h||q[s];c.telnyxLogger.debug("API request started",{correlationId:v,endpoint:a,method:f,companyId:u});let E=(e=Date.now(),{end:(b,c)=>{p.recordRequest({endpoint:a,method:f,statusCode:b,latencyMs:Date.now()-e,success:c,timestamp:new Date,companyId:u,correlationId:v})}}),F=async()=>{let b=Date.now(),d=new AbortController,e=setTimeout(()=>d.abort(),D);try{let h=await fetch(C,{method:f,headers:{Authorization:`Bearer ${z}`,"Content-Type":"application/json","X-Correlation-ID":v},body:g?JSON.stringify(g):void 0,signal:d.signal,keepalive:!0});clearTimeout(e);let i=Date.now()-b,k=await h.json().catch(()=>({}));if(!h.ok){E.end(h.status,!1);let b=function(a,b,c={}){let d=b?.errors?.[0]?.detail||b?.error||b?.message||"Unknown error",e=b?.errors?.[0]?.code,f={...c,statusCode:a,telnyxErrorCode:e,telnyxErrorDetail:d};switch(a){case 400:return new o(d,f);case 401:return new n("Invalid API key or unauthorized",f);case 403:return new n("Access forbidden",f);case 404:return new j("Resource not found","TELNYX_NOT_FOUND",{...f,retryable:!1});case 409:return new j("Resource conflict","TELNYX_RESOURCE_CONFLICT",{...f,retryable:!1});case 429:return new m("Rate limit exceeded",1e3*parseInt(b?.retry_after||"60",10),f);case 500:case 502:case 503:case 504:return new j("Telnyx service error","TELNYX_PROVIDER_ERROR",{...f,retryable:!0});default:return new j(d,"TELNYX_UNKNOWN_ERROR",f)}}(h.status,k,{correlationId:v,endpoint:a,method:f,companyId:u});if(c.telnyxLogger.warn("API request failed",{correlationId:v,endpoint:a,statusCode:h.status,error:b.message,latencyMs:i}),b.retryable)throw b;return{success:!1,error:b.message,errorCode:b.code,correlationId:v,latencyMs:i}}E.end(h.status,!0);let l=k?.data||k;return c.telnyxLogger.debug("API request completed",{correlationId:v,endpoint:a,statusCode:h.status,latencyMs:i}),{success:!0,data:l,correlationId:v,latencyMs:i}}catch(h){clearTimeout(e);let d=Date.now()-b;if(h instanceof Error&&"AbortError"===h.name){E.end(0,!1);let b=new l(`Request timed out after ${D}ms`,D,{correlationId:v,endpoint:a,method:f});throw c.telnyxLogger.error("API request timed out",{correlationId:v,endpoint:a,timeoutMs:D,latencyMs:d}),b}if(h instanceof j)throw h;E.end(0,!1);let g=function(a,b={}){if(a instanceof j)return a;let c=a instanceof Error?a:Error(String(a)),d=c.code,e={...b,originalError:c};return"AbortError"===c.name||c.message.includes("timeout")?new l("Request timed out",b.timeout||3e4,e):"ECONNRESET"===d||"ECONNREFUSED"===d||"ENOTFOUND"===d||"ENETUNREACH"===d||c.message.includes("fetch failed")||c.message.includes("network")?new k(`Network error: ${c.message}`,e):new j(c.message,"TELNYX_UNKNOWN_ERROR",e)}(h,{correlationId:v,endpoint:a,method:f});throw c.telnyxLogger.error("API request error",{correlationId:v,endpoint:a,error:g.message,latencyMs:d}),g}};try{let b=F;if(!w){let e=b;b=()=>(0,d.withRetry)(e,{endpoint:a,correlationId:v,config:y.config,onRetry:(b,d,e)=>{c.telnyxLogger.info("Retrying request",{correlationId:v,endpoint:a,attempt:b,delayMs:e,error:d.message})}})}if(!x){let a=b;b=()=>(function(a,b={}){let{endpoint:d="default",companyId:e,maxWaitMs:f=3e4,correlationId:g}=b;return new Promise(async(b,h)=>{try{let j=await i(d,e,f);if(!j.allowed){let a=Error(`Rate limit exceeded. Retry after ${j.retryAfterMs}ms`);a.code="RATE_LIMIT_EXCEEDED",a.retryAfterMs=j.retryAfterMs,h(a);return}j.waitTime&&j.waitTime>100&&c.telnyxLogger.debug("Request waited for rate limit",{endpoint:d,companyId:e,waitTime:j.waitTime,correlationId:g});let k=await a();b(k)}catch(a){h(a)}})})(a,{endpoint:t,companyId:u,correlationId:v})}return await b()}catch(a){if(a instanceof j)return{success:!1,error:a.message,errorCode:a.code,correlationId:v};return{success:!1,error:a instanceof Error?a.message:"Unknown error",correlationId:v}}}a.s(["telnyxRequest",()=>r],188351)},494218,a=>{"use strict";a.i(907279);var b=a.i(188351);async function c(a){return(0,b.telnyxRequest)("/10dlc/brand",{method:"POST",body:a})}async function d(a){return(0,b.telnyxRequest)(`/10dlc/brand/${a}`)}async function e(a){return(0,b.telnyxRequest)("/10dlc/campaignBuilder",{method:"POST",body:a})}async function f(a){return(0,b.telnyxRequest)(`/10dlc/campaign/${a}`)}async function g(a,c){return(0,b.telnyxRequest)(`/10dlc/campaigns/${a}/phone_numbers`,{method:"POST",body:{phone_numbers:[{phone_number:c}]}})}a.s(["attachNumberToCampaign",()=>g,"createTenDlcBrand",()=>c,"createTenDlcCampaign",()=>e,"getTenDlcBrand",()=>d,"getTenDlcCampaign",()=>f])}];

//# sourceMappingURL=apps_web_src_lib_telnyx_28266a4b._.js.map