{"version":3,"sources":["../../../../../../apps/web/src/actions/settings/customers.ts"],"sourcesContent":["/**\n * Customer Settings Server Actions\n *\n * Handles customer preferences, custom fields, loyalty, privacy, portal, and intake settings\n */\n\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { z } from \"zod\";\nimport {\n\tActionError,\n\tERROR_CODES,\n\tERROR_MESSAGES,\n} from \"@/lib/errors/action-error\";\nimport {\n\ttype ActionResult,\n\tassertAuthenticated,\n\twithErrorHandling,\n} from \"@/lib/errors/with-error-handling\";\nimport { createClient } from \"@/lib/supabase/server\";\n\n// ============================================================================\n// HELPER FUNCTIONS\n// ============================================================================\n\nasync function getCompanyId(supabase: any, userId: string): Promise<string> {\n\tconst { data: teamMember } = await supabase\n\t\t.from(\"company_memberships\")\n\t\t.select(\"company_id\")\n\t\t.eq(\"user_id\", userId)\n\t\t.eq(\"status\", \"active\")\n\t\t.single();\n\n\tif (!teamMember?.company_id) {\n\t\tthrow new ActionError(\n\t\t\t\"You must be part of a company\",\n\t\t\tERROR_CODES.AUTH_FORBIDDEN,\n\t\t\t403,\n\t\t);\n\t}\n\n\treturn teamMember.company_id;\n}\n\n// ============================================================================\n// CUSTOMER PREFERENCE SETTINGS\n// ============================================================================\n\nconst customerPreferenceSchema = z.object({\n\tdefaultContactMethod: z\n\t\t.enum([\"email\", \"sms\", \"phone\", \"app\"])\n\t\t.default(\"email\"),\n\tallowMarketingEmails: z.boolean().default(true),\n\tallowMarketingSms: z.boolean().default(false),\n\trequestFeedback: z.boolean().default(true),\n\tfeedbackDelayHours: z.coerce.number().default(24),\n\tsendAppointmentReminders: z.boolean().default(true),\n\treminderHoursBefore: z.coerce.number().default(24),\n\trequireServiceAddress: z.boolean().default(true),\n\tautoTagCustomers: z.boolean().default(false),\n});\n\nasync function updateCustomerPreferences(\n\tformData: FormData,\n): Promise<ActionResult<void>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst data = customerPreferenceSchema.parse({\n\t\t\tdefaultContactMethod: formData.get(\"defaultContactMethod\") || \"email\",\n\t\t\tallowMarketingEmails: formData.get(\"allowMarketingEmails\") !== \"false\",\n\t\t\tallowMarketingSms: formData.get(\"allowMarketingSms\") === \"true\",\n\t\t\trequestFeedback: formData.get(\"requestFeedback\") !== \"false\",\n\t\t\tfeedbackDelayHours: formData.get(\"feedbackDelayHours\") || \"24\",\n\t\t\tsendAppointmentReminders:\n\t\t\t\tformData.get(\"sendAppointmentReminders\") !== \"false\",\n\t\t\treminderHoursBefore: formData.get(\"reminderHoursBefore\") || \"24\",\n\t\t\trequireServiceAddress: formData.get(\"requireServiceAddress\") !== \"false\",\n\t\t\tautoTagCustomers: formData.get(\"autoTagCustomers\") === \"true\",\n\t\t});\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"customer_preference_settings\")\n\t\t\t.upsert({\n\t\t\t\tcompany_id: companyId,\n\t\t\t\tdefault_contact_method: data.defaultContactMethod,\n\t\t\t\tallow_marketing_emails: data.allowMarketingEmails,\n\t\t\t\tallow_marketing_sms: data.allowMarketingSms,\n\t\t\t\trequest_feedback: data.requestFeedback,\n\t\t\t\tfeedback_delay_hours: data.feedbackDelayHours,\n\t\t\t\tsend_appointment_reminders: data.sendAppointmentReminders,\n\t\t\t\treminder_hours_before: data.reminderHoursBefore,\n\t\t\t\trequire_service_address: data.requireServiceAddress,\n\t\t\t\tauto_tag_customers: data.autoTagCustomers,\n\t\t\t});\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"update customer preferences\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/settings/customers/preferences\");\n\t});\n}\n\nasync function getCustomerPreferences(): Promise<ActionResult<any>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"customer_preference_settings\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (error && error.code !== \"PGRST116\") {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"fetch customer preferences\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\treturn data || null;\n\t});\n}\n\n// ============================================================================\n// CUSTOM FIELDS\n// ============================================================================\n\nconst customFieldSchema = z.object({\n\tfieldName: z.string().min(1, \"Field name is required\"),\n\tfieldKey: z.string().min(1, \"Field key is required\"),\n\tfieldType: z.enum([\n\t\t\"text\",\n\t\t\"number\",\n\t\t\"date\",\n\t\t\"boolean\",\n\t\t\"select\",\n\t\t\"multi_select\",\n\t\t\"textarea\",\n\t]),\n\tfieldOptions: z.string().optional(), // JSON string\n\tisRequired: z.boolean().default(false),\n\tshowInList: z.boolean().default(false),\n\tdisplayOrder: z.coerce.number().default(0),\n\tisActive: z.boolean().default(true),\n});\n\nexport async function createCustomField(\n\tformData: FormData,\n): Promise<ActionResult<string>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst data = customFieldSchema.parse({\n\t\t\tfieldName: formData.get(\"fieldName\"),\n\t\t\tfieldKey: formData.get(\"fieldKey\"),\n\t\t\tfieldType: formData.get(\"fieldType\"),\n\t\t\tfieldOptions: formData.get(\"fieldOptions\") || undefined,\n\t\t\tisRequired: formData.get(\"isRequired\") === \"true\",\n\t\t\tshowInList: formData.get(\"showInList\") === \"true\",\n\t\t\tdisplayOrder: formData.get(\"displayOrder\") || \"0\",\n\t\t\tisActive: formData.get(\"isActive\") !== \"false\",\n\t\t});\n\n\t\t// Parse field options if provided\n\t\tlet fieldOptionsJson: unknown = null;\n\t\tif (data.fieldOptions) {\n\t\t\ttry {\n\t\t\t\tfieldOptionsJson = JSON.parse(data.fieldOptions);\n\t\t\t} catch (_e) {\n\t\t\t\tthrow new ActionError(\n\t\t\t\t\t\"Invalid field options JSON\",\n\t\t\t\t\tERROR_CODES.VALIDATION_FAILED,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tconst { data: newField, error } = await supabase\n\t\t\t.from(\"customer_custom_fields\")\n\t\t\t.insert({\n\t\t\t\tcompany_id: companyId,\n\t\t\t\tfield_name: data.fieldName,\n\t\t\t\tfield_key: data.fieldKey,\n\t\t\t\tfield_type: data.fieldType,\n\t\t\t\tfield_options: fieldOptionsJson,\n\t\t\t\tis_required: data.isRequired,\n\t\t\t\tshow_in_list: data.showInList,\n\t\t\t\tdisplay_order: data.displayOrder,\n\t\t\t\tis_active: data.isActive,\n\t\t\t})\n\t\t\t.select(\"id\")\n\t\t\t.single();\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"create custom field\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/settings/customers/custom-fields\");\n\t\treturn newField.id;\n\t});\n}\n\nexport async function updateCustomField(\n\tfieldId: string,\n\tformData: FormData,\n): Promise<ActionResult<void>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst data = customFieldSchema.parse({\n\t\t\tfieldName: formData.get(\"fieldName\"),\n\t\t\tfieldKey: formData.get(\"fieldKey\"),\n\t\t\tfieldType: formData.get(\"fieldType\"),\n\t\t\tfieldOptions: formData.get(\"fieldOptions\") || undefined,\n\t\t\tisRequired: formData.get(\"isRequired\") === \"true\",\n\t\t\tshowInList: formData.get(\"showInList\") === \"true\",\n\t\t\tdisplayOrder: formData.get(\"displayOrder\") || \"0\",\n\t\t\tisActive: formData.get(\"isActive\") !== \"false\",\n\t\t});\n\n\t\tlet fieldOptionsJson: unknown = null;\n\t\tif (data.fieldOptions) {\n\t\t\ttry {\n\t\t\t\tfieldOptionsJson = JSON.parse(data.fieldOptions);\n\t\t\t} catch (_e) {\n\t\t\t\tthrow new ActionError(\n\t\t\t\t\t\"Invalid field options JSON\",\n\t\t\t\t\tERROR_CODES.VALIDATION_FAILED,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"customer_custom_fields\")\n\t\t\t.update({\n\t\t\t\tfield_name: data.fieldName,\n\t\t\t\tfield_key: data.fieldKey,\n\t\t\t\tfield_type: data.fieldType,\n\t\t\t\tfield_options: fieldOptionsJson,\n\t\t\t\tis_required: data.isRequired,\n\t\t\t\tshow_in_list: data.showInList,\n\t\t\t\tdisplay_order: data.displayOrder,\n\t\t\t\tis_active: data.isActive,\n\t\t\t})\n\t\t\t.eq(\"id\", fieldId)\n\t\t\t.eq(\"company_id\", companyId);\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"update custom field\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/settings/customers/custom-fields\");\n\t});\n}\n\nexport async function deleteCustomField(\n\tfieldId: string,\n): Promise<ActionResult<void>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"customer_custom_fields\")\n\t\t\t.delete()\n\t\t\t.eq(\"id\", fieldId)\n\t\t\t.eq(\"company_id\", companyId);\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"delete custom field\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/settings/customers/custom-fields\");\n\t});\n}\n\nexport async function getCustomFields(): Promise<ActionResult<any[]>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"customer_custom_fields\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.order(\"display_order\", { ascending: true })\n\t\t\t.limit(100);\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"fetch custom fields\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\treturn data || [];\n\t});\n}\n\n// ============================================================================\n// LOYALTY PROGRAM SETTINGS\n// ============================================================================\n\nconst loyaltySettingsSchema = z.object({\n\tloyaltyEnabled: z.boolean().default(false),\n\tprogramName: z.string().default(\"Loyalty Rewards\"),\n\tpointsPerDollarSpent: z.coerce.number().default(1.0),\n\tpointsPerReferral: z.coerce.number().default(100),\n\tpointsExpiryDays: z.coerce.number().optional(),\n\trewardTiers: z.string().optional(), // JSON string\n\tautoApplyRewards: z.boolean().default(false),\n\tnotifyOnPointsEarned: z.boolean().default(true),\n});\n\nasync function updateLoyaltySettings(\n\tformData: FormData,\n): Promise<ActionResult<void>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst data = loyaltySettingsSchema.parse({\n\t\t\tloyaltyEnabled: formData.get(\"loyaltyEnabled\") === \"true\",\n\t\t\tprogramName: formData.get(\"programName\") || \"Loyalty Rewards\",\n\t\t\tpointsPerDollarSpent: formData.get(\"pointsPerDollarSpent\") || \"1.0\",\n\t\t\tpointsPerReferral: formData.get(\"pointsPerReferral\") || \"100\",\n\t\t\tpointsExpiryDays: formData.get(\"pointsExpiryDays\") || undefined,\n\t\t\trewardTiers: formData.get(\"rewardTiers\") || undefined,\n\t\t\tautoApplyRewards: formData.get(\"autoApplyRewards\") === \"true\",\n\t\t\tnotifyOnPointsEarned: formData.get(\"notifyOnPointsEarned\") !== \"false\",\n\t\t});\n\n\t\tlet rewardTiersJson: unknown[] = [];\n\t\tif (data.rewardTiers) {\n\t\t\ttry {\n\t\t\t\trewardTiersJson = JSON.parse(data.rewardTiers);\n\t\t\t} catch (_e) {\n\t\t\t\tthrow new ActionError(\n\t\t\t\t\t\"Invalid reward tiers JSON\",\n\t\t\t\t\tERROR_CODES.VALIDATION_FAILED,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tconst { error } = await supabase.from(\"customer_loyalty_settings\").upsert({\n\t\t\tcompany_id: companyId,\n\t\t\tloyalty_enabled: data.loyaltyEnabled,\n\t\t\tprogram_name: data.programName,\n\t\t\tpoints_per_dollar_spent: data.pointsPerDollarSpent,\n\t\t\tpoints_per_referral: data.pointsPerReferral,\n\t\t\tpoints_expiry_days: data.pointsExpiryDays,\n\t\t\treward_tiers: rewardTiersJson,\n\t\t\tauto_apply_rewards: data.autoApplyRewards,\n\t\t\tnotify_on_points_earned: data.notifyOnPointsEarned,\n\t\t});\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"update loyalty settings\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/settings/customers/loyalty\");\n\t});\n}\n\nasync function getLoyaltySettings(): Promise<ActionResult<any>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"customer_loyalty_settings\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (error && error.code !== \"PGRST116\") {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"fetch loyalty settings\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\treturn data || null;\n\t});\n}\n\n// ============================================================================\n// PRIVACY SETTINGS\n// ============================================================================\n\nconst privacySettingsSchema = z.object({\n\tdataRetentionYears: z.coerce.number().default(7),\n\tautoDeleteInactiveCustomers: z.boolean().default(false),\n\tinactiveThresholdYears: z.coerce.number().default(3),\n\trequireMarketingConsent: z.boolean().default(true),\n\trequireDataProcessingConsent: z.boolean().default(true),\n\tprivacyPolicyUrl: z.string().url().optional().or(z.literal(\"\")),\n\ttermsOfServiceUrl: z.string().url().optional().or(z.literal(\"\")),\n\tenableRightToDeletion: z.boolean().default(true),\n\tenableDataExport: z.boolean().default(true),\n});\n\nasync function updatePrivacySettings(\n\tformData: FormData,\n): Promise<ActionResult<void>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst data = privacySettingsSchema.parse({\n\t\t\tdataRetentionYears: formData.get(\"dataRetentionYears\") || \"7\",\n\t\t\tautoDeleteInactiveCustomers:\n\t\t\t\tformData.get(\"autoDeleteInactiveCustomers\") === \"true\",\n\t\t\tinactiveThresholdYears: formData.get(\"inactiveThresholdYears\") || \"3\",\n\t\t\trequireMarketingConsent:\n\t\t\t\tformData.get(\"requireMarketingConsent\") !== \"false\",\n\t\t\trequireDataProcessingConsent:\n\t\t\t\tformData.get(\"requireDataProcessingConsent\") !== \"false\",\n\t\t\tprivacyPolicyUrl: formData.get(\"privacyPolicyUrl\") || undefined,\n\t\t\ttermsOfServiceUrl: formData.get(\"termsOfServiceUrl\") || undefined,\n\t\t\tenableRightToDeletion: formData.get(\"enableRightToDeletion\") !== \"false\",\n\t\t\tenableDataExport: formData.get(\"enableDataExport\") !== \"false\",\n\t\t});\n\n\t\tconst { error } = await supabase.from(\"customer_privacy_settings\").upsert({\n\t\t\tcompany_id: companyId,\n\t\t\tdata_retention_years: data.dataRetentionYears,\n\t\t\tauto_delete_inactive_customers: data.autoDeleteInactiveCustomers,\n\t\t\tinactive_threshold_years: data.inactiveThresholdYears,\n\t\t\trequire_marketing_consent: data.requireMarketingConsent,\n\t\t\trequire_data_processing_consent: data.requireDataProcessingConsent,\n\t\t\tprivacy_policy_url: data.privacyPolicyUrl,\n\t\t\tterms_of_service_url: data.termsOfServiceUrl,\n\t\t\tenable_right_to_deletion: data.enableRightToDeletion,\n\t\t\tenable_data_export: data.enableDataExport,\n\t\t});\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"update privacy settings\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/settings/customers/privacy\");\n\t});\n}\n\nasync function getPrivacySettings(): Promise<ActionResult<any>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"customer_privacy_settings\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (error && error.code !== \"PGRST116\") {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"fetch privacy settings\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\treturn data || null;\n\t});\n}\n\n// ============================================================================\n// CUSTOMER PORTAL SETTINGS\n// ============================================================================\n\nconst portalSettingsSchema = z.object({\n\tportalEnabled: z.boolean().default(false),\n\trequireAccountApproval: z.boolean().default(false),\n\tallowBooking: z.boolean().default(true),\n\tallowInvoicePayment: z.boolean().default(true),\n\tallowEstimateApproval: z.boolean().default(true),\n\tshowServiceHistory: z.boolean().default(true),\n\tshowInvoices: z.boolean().default(true),\n\tshowEstimates: z.boolean().default(true),\n\tallowMessaging: z.boolean().default(true),\n\tportalLogoUrl: z.string().optional(),\n\tprimaryColor: z\n\t\t.string()\n\t\t.regex(/^#[0-9A-F]{6}$/i)\n\t\t.default(\"#3b82f6\"),\n\twelcomeMessage: z.string().optional(),\n\tnotifyOnNewInvoice: z.boolean().default(true),\n\tnotifyOnNewEstimate: z.boolean().default(true),\n\tnotifyOnAppointment: z.boolean().default(true),\n});\n\nasync function updatePortalSettings(\n\tformData: FormData,\n): Promise<ActionResult<void>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst data = portalSettingsSchema.parse({\n\t\t\tportalEnabled: formData.get(\"portalEnabled\") === \"true\",\n\t\t\trequireAccountApproval: formData.get(\"requireAccountApproval\") === \"true\",\n\t\t\tallowBooking: formData.get(\"allowBooking\") !== \"false\",\n\t\t\tallowInvoicePayment: formData.get(\"allowInvoicePayment\") !== \"false\",\n\t\t\tallowEstimateApproval: formData.get(\"allowEstimateApproval\") !== \"false\",\n\t\t\tshowServiceHistory: formData.get(\"showServiceHistory\") !== \"false\",\n\t\t\tshowInvoices: formData.get(\"showInvoices\") !== \"false\",\n\t\t\tshowEstimates: formData.get(\"showEstimates\") !== \"false\",\n\t\t\tallowMessaging: formData.get(\"allowMessaging\") !== \"false\",\n\t\t\tportalLogoUrl: formData.get(\"portalLogoUrl\") || undefined,\n\t\t\tprimaryColor: formData.get(\"primaryColor\") || \"#3b82f6\",\n\t\t\twelcomeMessage: formData.get(\"welcomeMessage\") || undefined,\n\t\t\tnotifyOnNewInvoice: formData.get(\"notifyOnNewInvoice\") !== \"false\",\n\t\t\tnotifyOnNewEstimate: formData.get(\"notifyOnNewEstimate\") !== \"false\",\n\t\t\tnotifyOnAppointment: formData.get(\"notifyOnAppointment\") !== \"false\",\n\t\t});\n\n\t\tconst { error } = await supabase.from(\"customer_portal_settings\").upsert({\n\t\t\tcompany_id: companyId,\n\t\t\tportal_enabled: data.portalEnabled,\n\t\t\trequire_account_approval: data.requireAccountApproval,\n\t\t\tallow_booking: data.allowBooking,\n\t\t\tallow_invoice_payment: data.allowInvoicePayment,\n\t\t\tallow_estimate_approval: data.allowEstimateApproval,\n\t\t\tshow_service_history: data.showServiceHistory,\n\t\t\tshow_invoices: data.showInvoices,\n\t\t\tshow_estimates: data.showEstimates,\n\t\t\tallow_messaging: data.allowMessaging,\n\t\t\tportal_logo_url: data.portalLogoUrl,\n\t\t\tprimary_color: data.primaryColor,\n\t\t\twelcome_message: data.welcomeMessage,\n\t\t\tnotify_on_new_invoice: data.notifyOnNewInvoice,\n\t\t\tnotify_on_new_estimate: data.notifyOnNewEstimate,\n\t\t\tnotify_on_appointment: data.notifyOnAppointment,\n\t\t});\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"update portal settings\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/settings/customer-portal\");\n\t});\n}\n\nasync function getPortalSettings(): Promise<ActionResult<any>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"customer_portal_settings\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (error && error.code !== \"PGRST116\") {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"fetch portal settings\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\treturn data || null;\n\t});\n}\n\n// ============================================================================\n// CUSTOMER INTAKE SETTINGS\n// ============================================================================\n\nconst intakeSettingsSchema = z.object({\n\trequirePhone: z.boolean().default(true),\n\trequireEmail: z.boolean().default(true),\n\trequireAddress: z.boolean().default(true),\n\trequirePropertyType: z.boolean().default(false),\n\tcustomQuestions: z.string().optional(), // JSON string\n\ttrackLeadSource: z.boolean().default(true),\n\trequireLeadSource: z.boolean().default(false),\n\tautoAssignTechnician: z.boolean().default(false),\n\tautoCreateJob: z.boolean().default(false),\n\tsendWelcomeEmail: z.boolean().default(true),\n\twelcomeEmailTemplateId: z.string().optional(),\n});\n\nasync function updateIntakeSettings(\n\tformData: FormData,\n): Promise<ActionResult<void>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst data = intakeSettingsSchema.parse({\n\t\t\trequirePhone: formData.get(\"requirePhone\") !== \"false\",\n\t\t\trequireEmail: formData.get(\"requireEmail\") !== \"false\",\n\t\t\trequireAddress: formData.get(\"requireAddress\") !== \"false\",\n\t\t\trequirePropertyType: formData.get(\"requirePropertyType\") === \"true\",\n\t\t\tcustomQuestions: formData.get(\"customQuestions\") || undefined,\n\t\t\ttrackLeadSource: formData.get(\"trackLeadSource\") !== \"false\",\n\t\t\trequireLeadSource: formData.get(\"requireLeadSource\") === \"true\",\n\t\t\tautoAssignTechnician: formData.get(\"autoAssignTechnician\") === \"true\",\n\t\t\tautoCreateJob: formData.get(\"autoCreateJob\") === \"true\",\n\t\t\tsendWelcomeEmail: formData.get(\"sendWelcomeEmail\") !== \"false\",\n\t\t\twelcomeEmailTemplateId:\n\t\t\t\tformData.get(\"welcomeEmailTemplateId\") || undefined,\n\t\t});\n\n\t\tlet customQuestionsJson = [];\n\t\tif (data.customQuestions) {\n\t\t\ttry {\n\t\t\t\tcustomQuestionsJson = JSON.parse(data.customQuestions);\n\t\t\t} catch (_e) {\n\t\t\t\tthrow new ActionError(\n\t\t\t\t\t\"Invalid custom questions JSON\",\n\t\t\t\t\tERROR_CODES.VALIDATION_FAILED,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tconst { error } = await supabase.from(\"customer_intake_settings\").upsert({\n\t\t\tcompany_id: companyId,\n\t\t\trequire_phone: data.requirePhone,\n\t\t\trequire_email: data.requireEmail,\n\t\t\trequire_address: data.requireAddress,\n\t\t\trequire_property_type: data.requirePropertyType,\n\t\t\tcustom_questions: customQuestionsJson,\n\t\t\ttrack_lead_source: data.trackLeadSource,\n\t\t\trequire_lead_source: data.requireLeadSource,\n\t\t\tauto_assign_technician: data.autoAssignTechnician,\n\t\t\tauto_create_job: data.autoCreateJob,\n\t\t\tsend_welcome_email: data.sendWelcomeEmail,\n\t\t\twelcome_email_template_id: data.welcomeEmailTemplateId,\n\t\t});\n\n\t\tif (error) {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"update intake settings\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/settings/customer-intake\");\n\t});\n}\n\nasync function getIntakeSettings(): Promise<ActionResult<any>> {\n\treturn withErrorHandling(async () => {\n\t\tconst supabase = await createClient();\n\t\tif (!supabase) {\n\t\t\tthrow new ActionError(\n\t\t\t\t\"Database connection failed\",\n\t\t\t\tERROR_CODES.DB_CONNECTION_ERROR,\n\t\t\t);\n\t\t}\n\n\t\tconst {\n\t\t\tdata: { user },\n\t\t} = await supabase.auth.getUser();\n\t\tassertAuthenticated(user?.id);\n\n\t\tconst companyId = await getCompanyId(supabase, user.id);\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"customer_intake_settings\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (error && error.code !== \"PGRST116\") {\n\t\t\tthrow new ActionError(\n\t\t\t\tERROR_MESSAGES.operationFailed(\"fetch intake settings\"),\n\t\t\t\tERROR_CODES.DB_QUERY_ERROR,\n\t\t\t);\n\t\t}\n\n\t\treturn data || null;\n\t});\n}\n"],"names":[],"mappings":"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"}