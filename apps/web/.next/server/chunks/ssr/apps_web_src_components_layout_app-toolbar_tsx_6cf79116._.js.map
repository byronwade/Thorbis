{"version":3,"sources":["../../../../../../apps/web/src/components/layout/app-toolbar.tsx","../../../../../../apps/web/src/components/layout/toolbar-client-actions.tsx","../../../../../../apps/web/src/components/ui/toolbar-stats.tsx","../../../../../../apps/web/src/components/layout/toolbar-client-stats.tsx","../../../../../../apps/web/src/components/layout/offline-indicator.tsx","../../../../../../apps/web/src/lib/offline/indexed-db.ts","../../../../../../apps/web/src/lib/offline/sync-queue.ts","../../../../../../apps/web/src/lib/offline/network-status.ts","../../../../../../apps/web/src/components/ui/toolbar-stats-button.tsx"],"sourcesContent":["\"use client\";\n\n/**\n * AppToolbar - Redesigned Responsive Toolbar\n *\n * Modern, intelligent toolbar with:\n * - Responsive design (desktop → tablet → mobile)\n * - Smart action grouping with dropdowns\n * - Context-aware buttons\n * - Mobile-first hamburger menu\n * - Keyboard shortcuts\n */\n\nimport {\n\tChevronDown,\n\tDownload,\n\tFilter,\n\tMenu,\n\tMoreVertical,\n\tPlus,\n\tSearch,\n\tSettings,\n\tUpload,\n\tX,\n} from \"lucide-react\";\nimport type { ReactNode } from \"react\";\nimport { isValidElement, useState } from \"react\";\nimport { ToolbarClientActions } from \"@/components/layout/toolbar-client-actions\";\nimport { ToolbarClientStats } from \"@/components/layout/toolbar-client-stats\";\nimport { OfflineIndicator } from \"@/components/layout/offline-indicator\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuItem,\n\tDropdownMenuLabel,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n\tSheet,\n\tSheetContent,\n\tSheetHeader,\n\tSheetTitle,\n\tSheetTrigger,\n} from \"@/components/ui/sheet\";\nimport { SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { ToolbarStatsButton } from \"@/components/ui/toolbar-stats-button\";\nimport { ToolbarStatsInline } from \"@/components/ui/toolbar-stats-inline\";\nimport type { ToolbarConfig } from \"@/lib/layout/unified-layout-config\";\n\ntype AppToolbarProps = {\n\tpathname?: string;\n\tconfig: ToolbarConfig;\n\tshowLeftSidebar?: boolean;\n\tshowRightSidebar?: boolean;\n\tscope?: \"layout\" | \"page\";\n};\n\nexport function AppToolbar({\n\tpathname,\n\tconfig,\n\tshowLeftSidebar = true,\n\tshowRightSidebar = false,\n\tscope = \"page\",\n}: AppToolbarProps) {\n\tconst safePathname = pathname || \"/dashboard\";\n\tconst [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\n\n\t// Check if stats is a ReactNode component or StatCard[] array\n\tconst isStatsReactNode = config.stats && isValidElement(config.stats);\n\tconst isStatsArray = config.stats && Array.isArray(config.stats);\n\n\t// Determine stats display mode\n\tconst statsMode =\n\t\tconfig.statsMode || (config.showInlineStats ? \"inline\" : \"hidden\");\n\n\t// Determine sections presence\n\tconst hasTitle = Boolean(config.title || config.subtitle);\n\tconst hasStats = Boolean(config.stats && statsMode !== \"hidden\");\n\tconst hasSearch = Boolean(config.search);\n\tconst hasPagination = Boolean(config.pagination);\n\tconst hasActions = Boolean(config.actions);\n\n\t// Parse actions into structured groups\n\tconst actionGroups = parseActions(config.actions);\n\n\t// If hideOnMobile is true, don't render on mobile\n\tif (config.hideOnMobile) {\n\t\treturn (\n\t\t\t<header\n\t\t\t\tclassName=\"bg-background/80 sticky top-0 z-40 hidden w-full shrink-0 backdrop-blur-xl supports-[backdrop-filter]:bg-background/60 md:flex\"\n\t\t\t\tdata-app-toolbar\n\t\t\t\tdata-app-toolbar-scope={scope}\n\t\t\t>\n\t\t\t\t{/* Desktop/Tablet Layout */}\n\t\t\t\t<div className=\"flex h-14 w-full items-center gap-3 px-6\">\n\t\t\t\t{/* Left Section: Navigation + Context */}\n\t\t\t\t<div className=\"flex items-center gap-3 min-w-0 flex-1\">\n\t\t\t\t\t{/* Navigation */}\n\t\t\t\t\t<div className=\"flex shrink-0 items-center gap-2\">\n\t\t\t\t\t\t{showLeftSidebar && <SidebarTrigger className=\"-ml-1\" />}\n\t\t\t\t\t\t{config.back && (\n\t\t\t\t\t\t\t<div className=\"flex items-center\">{config.back}</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Context (Title/Breadcrumbs) */}\n\t\t\t\t\t{!config.breadcrumbs && hasTitle && (\n\t\t\t\t\t\t<div className=\"flex min-w-0 shrink-0 flex-col\">\n\t\t\t\t\t\t\t{config.title && (\n\t\t\t\t\t\t\t\t<div className=\"flex items-baseline gap-2\">\n\t\t\t\t\t\t\t\t\t{typeof config.title === \"string\" ? (\n\t\t\t\t\t\t\t\t\t\t<h1 className=\"truncate text-sm font-semibold lg:text-base\">\n\t\t\t\t\t\t\t\t\t\t\t{config.title}\n\t\t\t\t\t\t\t\t\t\t</h1>\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-semibold lg:text-base\">\n\t\t\t\t\t\t\t\t\t\t\t{config.title}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{config.subtitle && (\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground truncate text-xs\">\n\t\t\t\t\t\t\t\t\t{config.subtitle}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t{config.breadcrumbs && (\n\t\t\t\t\t\t<div className=\"flex min-w-0 items-center\">\n\t\t\t\t\t\t\t{config.breadcrumbs}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Inline Stats (Desktop only) */}\n\t\t\t\t\t{hasStats && statsMode === \"inline\" && (\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"hidden items-center xl:flex\"\n\t\t\t\t\t\t\tdata-toolbar-default-stats={safePathname}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div className=\"bg-border/40 mx-3 h-5 w-px\" />\n\t\t\t\t\t\t\t{isStatsReactNode && config.stats}\n\t\t\t\t\t\t\t{isStatsArray && config.stats.length > 0 && (\n\t\t\t\t\t\t\t\t<ToolbarStatsInline stats={config.stats} />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{/* Right Section: Actions + Controls */}\n\t\t\t\t<div className=\"flex shrink-0 items-center gap-2\">\n\t\t\t\t\t{/* Search */}\n\t\t\t\t\t{hasSearch && (\n\t\t\t\t\t\t<div className=\"flex items-center max-w-md\">{config.search}</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Stats Button (when not inline) */}\n\t\t\t\t\t{hasStats && statsMode === \"button\" && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{isStatsArray && config.stats.length > 0 && (\n\t\t\t\t\t\t\t\t<ToolbarStatsButton stats={config.stats} />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{isStatsReactNode && config.stats}\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\n\t\t\t\t\t<ToolbarClientStats pathname={safePathname} />\n\n\t\t\t\t\t{/* Pagination */}\n\t\t\t\t\t{hasPagination && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<div className=\"bg-border/40 h-5 w-px\" />\n\t\t\t\t\t\t\t{config.pagination}\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Primary Actions */}\n\t\t\t\t\t{actionGroups.primary.length > 0 && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{!config.hideActionSeparator && <div className=\"bg-border/40 h-5 w-px\" />}\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-1.5\">\n\t\t\t\t\t\t\t\t{actionGroups.primary.map((action, idx) => (\n\t\t\t\t\t\t\t\t\t<div key={idx}>{action}</div>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Secondary Actions Dropdown */}\n\t\t\t\t\t{actionGroups.secondary.length > 0 && (\n\t\t\t\t\t\t<DropdownMenu>\n\t\t\t\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n\t\t\t\t\t\t\t\t\t<MoreVertical className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t<span className=\"sr-only\">More actions</span>\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t\t\t\t<DropdownMenuContent align=\"end\" className=\"w-56\">\n\t\t\t\t\t\t\t\t<DropdownMenuLabel>Actions</DropdownMenuLabel>\n\t\t\t\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t\t\t\t{actionGroups.secondary.map((action, idx) => (\n\t\t\t\t\t\t\t\t\t<DropdownMenuItem key={idx} asChild>\n\t\t\t\t\t\t\t\t\t\t{action}\n\t\t\t\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</DropdownMenuContent>\n\t\t\t\t\t\t</DropdownMenu>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Dynamic Actions */}\n\t\t\t\t\t<ToolbarClientActions pathname={safePathname} />\n\n\t\t\t\t\t{/* Offline Indicator */}\n\t\t\t\t\t<OfflineIndicator />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t</header>\n\t\t);\n\t}\n\n\treturn (\n\t\t<header\n\t\t\tclassName=\"bg-background/80 sticky top-0 z-40 flex w-full shrink-0 backdrop-blur-xl supports-[backdrop-filter]:bg-background/60\"\n\t\t\tdata-app-toolbar\n\t\t\tdata-app-toolbar-scope={scope}\n\t\t>\n\t\t\t{/* Desktop/Tablet Layout */}\n\t\t\t<div className=\"hidden md:flex h-14 w-full items-center gap-3 px-6\">\n\t\t\t\t{/* Left: Sidebar + Title */}\n\t\t\t\t<div className=\"flex items-center gap-2 min-w-0 flex-1\">\n\t\t\t\t\t{showLeftSidebar && <SidebarTrigger className=\"-ml-1\" />}\n\n\t\t\t\t\t{config.back && (\n\t\t\t\t\t\t<div className=\"flex items-center\">{config.back}</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{hasTitle && typeof config.title === \"string\" && (\n\t\t\t\t\t\t<h1 className=\"truncate text-sm font-semibold\">{config.title}</h1>\n\t\t\t\t\t)}\n\t\t\t\t\t{hasTitle && typeof config.title !== \"string\" && (\n\t\t\t\t\t\t<div className=\"text-sm font-semibold truncate\">{config.title}</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{/* Right: Search Icon + Mobile Menu */}\n\t\t\t\t<div className=\"flex shrink-0 items-center gap-1\">\n\t\t\t\t\t{hasSearch && (\n\t\t\t\t\t\t<Sheet>\n\t\t\t\t\t\t\t<SheetTrigger asChild>\n\t\t\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n\t\t\t\t\t\t\t\t\t<Search className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t<span className=\"sr-only\">Search</span>\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</SheetTrigger>\n\t\t\t\t\t\t\t<SheetContent side=\"top\" className=\"h-[200px]\">\n\t\t\t\t\t\t\t\t<SheetHeader>\n\t\t\t\t\t\t\t\t\t<SheetTitle>Search</SheetTitle>\n\t\t\t\t\t\t\t\t</SheetHeader>\n\t\t\t\t\t\t\t\t<div className=\"mt-4\">{config.search}</div>\n\t\t\t\t\t\t\t</SheetContent>\n\t\t\t\t\t\t</Sheet>\n\t\t\t\t\t)}\n\n\t\t\t\t\t<OfflineIndicator />\n\n\t\t\t\t\t{/* Mobile Menu */}\n\t\t\t\t\t<Sheet open={isMobileMenuOpen} onOpenChange={setIsMobileMenuOpen}>\n\t\t\t\t\t\t<SheetTrigger asChild>\n\t\t\t\t\t\t\t<Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n\t\t\t\t\t\t\t\t<Menu className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t<span className=\"sr-only\">Menu</span>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</SheetTrigger>\n\t\t\t\t\t\t<SheetContent side=\"right\" className=\"w-[300px] sm:w-[400px]\">\n\t\t\t\t\t\t\t<SheetHeader>\n\t\t\t\t\t\t\t\t<SheetTitle className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t<span>Actions</span>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 w-8 p-0\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => setIsMobileMenuOpen(false)}\n\t\t\t\t\t\t\t\t\t\taria-label=\"Close menu\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<X className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t<span className=\"sr-only\">Close menu</span>\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</SheetTitle>\n\t\t\t\t\t\t\t</SheetHeader>\n\n\t\t\t\t\t\t\t<div className=\"mt-6 space-y-4\">\n\t\t\t\t\t\t\t\t{/* Stats */}\n\t\t\t\t\t\t\t\t{hasStats && isStatsArray && config.stats.length > 0 && (\n\t\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-medium text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\tStatistics\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t<div className=\"grid gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t{config.stats.map((stat, idx) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={idx}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"rounded-lg border p-3 space-y-1\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{stat.label}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-baseline gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-2xl font-bold\">{stat.value}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{stat.icon && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{stat.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t{/* Actions */}\n\t\t\t\t\t\t\t\t{(actionGroups.primary.length > 0 ||\n\t\t\t\t\t\t\t\t\tactionGroups.secondary.length > 0) && (\n\t\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-medium text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\tActions\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t<div className=\"grid gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t{[...actionGroups.primary, ...actionGroups.secondary].map(\n\t\t\t\t\t\t\t\t\t\t\t\t(action, idx) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={idx}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setIsMobileMenuOpen(false)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{action}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t\t\t{/* Pagination */}\n\t\t\t\t\t\t\t\t{hasPagination && (\n\t\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm font-medium text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\tNavigation\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center\">\n\t\t\t\t\t\t\t\t\t\t\t{config.pagination}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</SheetContent>\n\t\t\t\t\t</Sheet>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</header>\n\t);\n}\n\n/**\n * Parse actions into primary (always visible) and secondary (dropdown) groups\n */\nfunction parseActions(actions: ReactNode): {\n\tprimary: ReactNode[];\n\tsecondary: ReactNode[];\n} {\n\tif (!actions) {\n\t\treturn { primary: [], secondary: [] };\n\t}\n\n\t// If actions is a single element, treat as primary\n\tif (!Array.isArray(actions)) {\n\t\treturn { primary: [actions], secondary: [] };\n\t}\n\n\t// Split array: first 2 are primary, rest are secondary\n\treturn {\n\t\tprimary: actions.slice(0, 2),\n\t\tsecondary: actions.slice(2),\n\t};\n}\n","\"use client\";\n\nimport { useEffect } from \"react\";\nimport { useToolbarActionsStore } from \"@/lib/stores/toolbar-actions-store\";\n\ntype ToolbarClientActionsProps = {\n\tpathname: string;\n};\n\nexport function ToolbarClientActions({ pathname }: ToolbarClientActionsProps) {\n\tconst actions = useToolbarActionsStore((state) => state.actions[pathname]);\n\n\tuseEffect(() => {\n\t\tif (actions) {\n\t\t\tdocument\n\t\t\t\t.querySelector(\n\t\t\t\t\t`[data-toolbar-default-actions=\"${CSS.escape(pathname)}\"]`,\n\t\t\t\t)\n\t\t\t\t?.setAttribute(\"hidden\", \"true\");\n\t\t}\n\t}, [pathname, actions]);\n\n\tif (!actions) {\n\t\treturn null;\n\t}\n\n\treturn <>{actions}</>;\n}\n","// Re-export from @stratos/ui package\nexport * from \"@stratos/ui\";\n","\"use client\";\n\nimport { useEffect } from \"react\";\nimport { ToolbarStats } from \"@/components/ui/toolbar-stats\";\nimport { useToolbarStatsStore } from \"@/lib/stores/toolbar-stats-store\";\n\ntype ToolbarClientStatsProps = {\n\tpathname: string;\n};\n\nexport function ToolbarClientStats({ pathname }: ToolbarClientStatsProps) {\n\tconst stats = useToolbarStatsStore((state) => state.stats[pathname]);\n\n\tuseEffect(() => {\n\t\tif (stats && stats.length > 0) {\n\t\t\tdocument\n\t\t\t\t.querySelector(`[data-toolbar-default-stats=\"${CSS.escape(pathname)}\"]`)\n\t\t\t\t?.setAttribute(\"hidden\", \"true\");\n\t\t}\n\t}, [pathname, stats]);\n\n\tif (!stats || stats.length === 0) {\n\t\treturn null;\n\t}\n\n\treturn <ToolbarStats stats={stats} />;\n}\n","/**\n * Offline Indicator Component\n *\n * Displays network status and pending sync operations in the AppToolbar.\n * Critical for field workers to understand offline mode and sync status.\n *\n * States:\n * - Online with no pending: Hidden\n * - Offline: Shows \"Offline Mode\"\n * - Pending operations: Shows count and sync status\n * - Syncing: Shows spinner\n */\n\n\"use client\";\n\nimport { AlertCircle, CheckCircle2, RefreshCw, WifiOff } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\nimport { useNetworkStatus } from \"@/lib/offline/network-status\";\nimport { cn } from \"@/lib/utils\";\n\nexport function OfflineIndicator() {\n\tconst { isOnline, pendingOperations, isSyncing, lastSync } =\n\t\tuseNetworkStatus();\n\tconst [isMounted, setIsMounted] = useState(false);\n\n\t// Wait for client-side mount to avoid hydration mismatch\n\tuseEffect(() => {\n\t\tsetIsMounted(true);\n\t}, []);\n\n\t// Don't render anything on server to avoid hydration mismatch\n\tif (!isMounted) {\n\t\treturn null;\n\t}\n\n\t// Don't show anything if online and no pending operations\n\tif (isOnline && pendingOperations === 0 && !isSyncing) {\n\t\treturn null;\n\t}\n\n\t// Offline mode\n\tif (!isOnline) {\n\t\treturn (\n\t\t\t<div className=\"bg-warning/10 text-warning dark:text-warning flex items-center gap-2 rounded-md px-3 py-1 text-sm\">\n\t\t\t\t<WifiOff className=\"size-4\" />\n\t\t\t\t<span className=\"hidden sm:inline\">Offline Mode</span>\n\t\t\t\t{pendingOperations > 0 && (\n\t\t\t\t\t<span className=\"bg-warning/20 rounded-full px-2 py-0.5 text-xs font-medium\">\n\t\t\t\t\t\t{pendingOperations}\n\t\t\t\t\t</span>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t}\n\n\t// Syncing\n\tif (isSyncing) {\n\t\treturn (\n\t\t\t<div className=\"bg-primary/10 text-primary dark:text-primary flex items-center gap-2 rounded-md px-3 py-1 text-sm\">\n\t\t\t\t<RefreshCw className=\"size-4 animate-spin\" />\n\t\t\t\t<span className=\"hidden sm:inline\">Syncing...</span>\n\t\t\t\t{pendingOperations > 0 && (\n\t\t\t\t\t<span className=\"bg-primary/20 rounded-full px-2 py-0.5 text-xs font-medium\">\n\t\t\t\t\t\t{pendingOperations}\n\t\t\t\t\t</span>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t}\n\n\t// Pending operations (online but not syncing)\n\tif (pendingOperations > 0) {\n\t\treturn (\n\t\t\t<div className=\"bg-warning/10 text-warning dark:text-warning flex items-center gap-2 rounded-md px-3 py-1 text-sm\">\n\t\t\t\t<AlertCircle className=\"size-4\" />\n\t\t\t\t<span className=\"hidden sm:inline\">{pendingOperations} pending</span>\n\t\t\t\t<span className=\"sm:hidden\">{pendingOperations}</span>\n\t\t\t</div>\n\t\t);\n\t}\n\n\t// Recently synced (show for 5 seconds)\n\tif (lastSync && Date.now() - lastSync.getTime() < 5000) {\n\t\treturn (\n\t\t\t<div className=\"bg-success/10 text-success dark:text-success flex items-center gap-2 rounded-md px-3 py-1 text-sm\">\n\t\t\t\t<CheckCircle2 className=\"size-4\" />\n\t\t\t\t<span className=\"hidden sm:inline\">Synced</span>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn null;\n}\n\n/**\n * Detailed sync status for settings/debug pages\n */\nfunction SyncStatusDetail() {\n\tconst { isOnline, pendingOperations, isSyncing, lastSync } =\n\t\tuseNetworkStatus();\n\tconst [isMounted, setIsMounted] = useState(false);\n\n\t// Wait for client-side mount to avoid hydration mismatch\n\tuseEffect(() => {\n\t\tsetIsMounted(true);\n\t}, []);\n\n\t// Show loading state on server\n\tif (!isMounted) {\n\t\treturn (\n\t\t\t<div className=\"space-y-3\">\n\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t<span className=\"text-muted-foreground text-sm\">Network Status</span>\n\t\t\t\t\t<span className=\"text-muted-foreground text-sm\">Loading...</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className=\"space-y-3\">\n\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t<span className=\"text-muted-foreground text-sm\">Network Status</span>\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t{isOnline ? (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<div className=\"bg-success size-2 rounded-full\" />\n\t\t\t\t\t\t\t<span className=\"text-sm font-medium\">Online</span>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<div className=\"bg-warning size-2 rounded-full\" />\n\t\t\t\t\t\t\t<span className=\"text-sm font-medium\">Offline</span>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t<span className=\"text-muted-foreground text-sm\">\n\t\t\t\t\tPending Operations\n\t\t\t\t</span>\n\t\t\t\t<span className=\"text-sm font-medium\">\n\t\t\t\t\t{pendingOperations === 0 ? \"None\" : `${pendingOperations}`}\n\t\t\t\t</span>\n\t\t\t</div>\n\n\t\t\t{isSyncing && (\n\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t<span className=\"text-muted-foreground text-sm\">Sync Status</span>\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<RefreshCw className=\"text-primary size-4 animate-spin\" />\n\t\t\t\t\t\t<span className=\"text-sm font-medium\">Syncing...</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{lastSync && (\n\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t<span className=\"text-muted-foreground text-sm\">Last Sync</span>\n\t\t\t\t\t<span className=\"text-sm font-medium\">\n\t\t\t\t\t\t{new Date(lastSync).toLocaleTimeString()}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n\n/**\n * Badge variant for compact display\n */\nfunction OfflineBadge() {\n\tconst { isOnline, pendingOperations } = useNetworkStatus();\n\tconst [isMounted, setIsMounted] = useState(false);\n\n\t// Wait for client-side mount to avoid hydration mismatch\n\tuseEffect(() => {\n\t\tsetIsMounted(true);\n\t}, []);\n\n\t// Don't render anything on server to avoid hydration mismatch\n\tif (!isMounted) {\n\t\treturn null;\n\t}\n\n\tif (isOnline && pendingOperations === 0) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tclassName={cn(\n\t\t\t\t\"flex size-6 items-center justify-center rounded-full text-xs font-bold\",\n\t\t\t\tisOnline ? \"bg-warning text-white\" : \"bg-warning text-white\",\n\t\t\t)}\n\t\t>\n\t\t\t{pendingOperations > 0 ? (\n\t\t\t\tpendingOperations\n\t\t\t) : (\n\t\t\t\t<WifiOff className=\"size-3\" />\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","/**\n * IndexedDB Wrapper for Offline Storage\n *\n * Provides a type-safe interface for storing and retrieving data offline.\n * Critical for field workers with spotty internet connections.\n *\n * Database: thorbis-offline\n * Version: 2 (Updated with comprehensive offline support)\n *\n * Stores:\n * - jobs: Offline job records\n * - invoices: Offline invoice records\n * - customers: Full customer records (not just cache)\n * - communications: Email/SMS/phone history\n * - payments: Payment transactions\n * - equipment: Equipment/asset tracking\n * - schedules: Appointments and scheduling\n * - tags: Tag management system\n * - attachments: File attachments metadata\n * - sync-queue: Pending sync operations\n */\n\nconst DB_NAME = \"thorbis-offline\";\nconst DB_VERSION = 2;\n\n// Type definitions\nexport type OfflineJob = {\n\tid: string;\n\tcustomer_id: string;\n\tstatus: string;\n\tscheduled_date: string;\n\tnotes: string;\n\tcreated_at: number;\n\tupdated_at: number;\n\tsynced: boolean;\n};\n\nexport type OfflineInvoice = {\n\tid: string;\n\tcustomer_id: string;\n\tamount: number;\n\tstatus: string;\n\tline_items: any[];\n\tcreated_at: number;\n\tupdated_at: number;\n\tsynced: boolean;\n};\n\nexport type OfflineCustomer = {\n\tid: string;\n\tcompany_id: string;\n\tuser_id?: string | null;\n\ttype: string;\n\tfirst_name: string;\n\tlast_name: string;\n\tcompany_name?: string | null;\n\temail?: string | null;\n\tphone?: string | null;\n\taddress?: string | null;\n\tcity?: string | null;\n\tstate?: string | null;\n\tzip?: string | null;\n\tstatus: string;\n\ttotal_revenue?: number;\n\ttotal_jobs?: number;\n\toutstanding_balance?: number;\n\tportal_enabled: boolean;\n\tcreated_at: number;\n\tupdated_at: number;\n\tsynced: boolean;\n\tdeleted_at?: number | null;\n};\n\nexport type OfflineCommunication = {\n\tid: string;\n\tcompany_id: string;\n\tcustomer_id?: string | null;\n\tjob_id?: string | null;\n\tuser_id?: string | null;\n\ttype: string; // 'email' | 'sms' | 'phone' | 'chat' | 'note'\n\tdirection: string; // 'inbound' | 'outbound'\n\tstatus: string;\n\tsubject?: string | null;\n\tbody?: string | null;\n\tfrom_email?: string | null;\n\tto_email?: string | null;\n\tfrom_phone?: string | null;\n\tto_phone?: string | null;\n\tthread_id?: string | null;\n\tparent_id?: string | null;\n\tread_at?: number | null;\n\tcall_duration?: number | null;\n\tcreated_at: number;\n\tupdated_at: number;\n\tsynced: boolean;\n\tdeleted_at?: number | null;\n};\n\nexport type OfflinePayment = {\n\tid: string;\n\tcompany_id: string;\n\tcustomer_id: string;\n\tinvoice_id?: string | null;\n\tjob_id?: string | null;\n\tpayment_number: string;\n\tamount: number; // In cents\n\tpayment_method: string;\n\tpayment_type: string;\n\tstatus: string;\n\tcard_brand?: string | null;\n\tcard_last4?: string | null;\n\trefunded_amount: number;\n\tis_reconciled: boolean;\n\tprocessed_at?: number | null;\n\tcreated_at: number;\n\tupdated_at: number;\n\tsynced: boolean;\n\tdeleted_at?: number | null;\n};\n\nexport type OfflineEquipment = {\n\tid: string;\n\tcompany_id: string;\n\tcustomer_id: string;\n\tproperty_id?: string | null;\n\tequipment_number: string;\n\ttype: string;\n\tmanufacturer?: string | null;\n\tmodel?: string | null;\n\tserial_number?: string | null;\n\tinstall_date?: number | null;\n\twarranty_expiration?: number | null;\n\tis_under_warranty: boolean;\n\tstatus: string;\n\tnext_service_due?: number | null;\n\tcreated_at: number;\n\tupdated_at: number;\n\tsynced: boolean;\n\tdeleted_at?: number | null;\n};\n\nexport type OfflineSchedule = {\n\tid: string;\n\tcompany_id: string;\n\tcustomer_id?: string | null;\n\tjob_id?: string | null;\n\tassigned_to?: string | null;\n\ttype: string;\n\ttitle: string;\n\tstart_time: number;\n\tend_time: number;\n\tduration: number;\n\tstatus: string;\n\tis_recurring: boolean;\n\treminder_sent: boolean;\n\tcreated_at: number;\n\tupdated_at: number;\n\tsynced: boolean;\n\tdeleted_at?: number | null;\n};\n\nexport type OfflineTag = {\n\tid: string;\n\tcompany_id: string;\n\tname: string;\n\tslug: string;\n\tcategory?: string | null;\n\tcolor?: string | null;\n\tusage_count: number;\n\tis_system: boolean;\n\tcreated_at: number;\n\tupdated_at: number;\n\tsynced: boolean;\n};\n\nexport type OfflineAttachment = {\n\tid: string;\n\tcompany_id: string;\n\tentity_type: string; // 'job' | 'customer' | 'invoice' | 'equipment' | etc.\n\tentity_id: string;\n\tfile_name: string;\n\tfile_size: number;\n\tmime_type: string;\n\tstorage_url: string;\n\tis_image: boolean;\n\tis_document: boolean;\n\tthumbnail_url?: string | null;\n\tcreated_at: number;\n\tupdated_at: number;\n\tsynced: boolean;\n\tdeleted_at?: number | null;\n};\n\nexport type SyncOperation = {\n\tid: string;\n\toperation: \"INSERT\" | \"UPDATE\" | \"DELETE\";\n\ttable: string;\n\tdata: any;\n\ttimestamp: number;\n\tretry_count: number;\n\terror?: string;\n};\n\nexport type StoreName =\n\t| \"jobs\"\n\t| \"invoices\"\n\t| \"customers\"\n\t| \"communications\"\n\t| \"payments\"\n\t| \"equipment\"\n\t| \"schedules\"\n\t| \"tags\"\n\t| \"attachments\"\n\t| \"sync-queue\";\n\n/**\n * Initialize IndexedDB database and create object stores\n */\nfunction openDatabase(): Promise<IDBDatabase> {\n\t// SSR guard - IndexedDB only exists in browser\n\tif (typeof window === \"undefined\" || typeof indexedDB === \"undefined\") {\n\t\treturn Promise.reject(\n\t\t\tnew Error(\"IndexedDB not available (server-side rendering)\"),\n\t\t);\n\t}\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst request = indexedDB.open(DB_NAME, DB_VERSION);\n\n\t\trequest.onerror = () => {\n\t\t\treject(new Error(\"Failed to open IndexedDB\"));\n\t\t};\n\n\t\trequest.onsuccess = () => {\n\t\t\tresolve(request.result);\n\t\t};\n\n\t\trequest.onupgradeneeded = (event) => {\n\t\t\tconst db = (event.target as IDBOpenDBRequest).result;\n\t\t\tconst oldVersion = event.oldVersion;\n\n\t\t\t// Create object stores if they don't exist\n\t\t\tif (!db.objectStoreNames.contains(\"jobs\")) {\n\t\t\t\tconst jobsStore = db.createObjectStore(\"jobs\", { keyPath: \"id\" });\n\t\t\t\tjobsStore.createIndex(\"synced\", \"synced\", { unique: false });\n\t\t\t\tjobsStore.createIndex(\"updated_at\", \"updated_at\", { unique: false });\n\t\t\t\tjobsStore.createIndex(\"company_id\", \"company_id\", { unique: false });\n\t\t\t}\n\n\t\t\tif (!db.objectStoreNames.contains(\"invoices\")) {\n\t\t\t\tconst invoicesStore = db.createObjectStore(\"invoices\", {\n\t\t\t\t\tkeyPath: \"id\",\n\t\t\t\t});\n\t\t\t\tinvoicesStore.createIndex(\"synced\", \"synced\", { unique: false });\n\t\t\t\tinvoicesStore.createIndex(\"updated_at\", \"updated_at\", {\n\t\t\t\t\tunique: false,\n\t\t\t\t});\n\t\t\t\tinvoicesStore.createIndex(\"company_id\", \"company_id\", {\n\t\t\t\t\tunique: false,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!db.objectStoreNames.contains(\"customers\")) {\n\t\t\t\tconst customersStore = db.createObjectStore(\"customers\", {\n\t\t\t\t\tkeyPath: \"id\",\n\t\t\t\t});\n\t\t\t\tcustomersStore.createIndex(\"synced\", \"synced\", { unique: false });\n\t\t\t\tcustomersStore.createIndex(\"updated_at\", \"updated_at\", {\n\t\t\t\t\tunique: false,\n\t\t\t\t});\n\t\t\t\tcustomersStore.createIndex(\"company_id\", \"company_id\", {\n\t\t\t\t\tunique: false,\n\t\t\t\t});\n\t\t\t\tcustomersStore.createIndex(\"email\", \"email\", { unique: false });\n\t\t\t\tcustomersStore.createIndex(\"phone\", \"phone\", { unique: false });\n\t\t\t\tcustomersStore.createIndex(\"status\", \"status\", { unique: false });\n\t\t\t} else if (oldVersion < 2) {\n\t\t\t\t// Migrate existing customers store from v1 to v2\n\t\t\t\tconst transaction = (event.target as IDBOpenDBRequest).transaction!;\n\t\t\t\tconst customersStore = transaction.objectStore(\"customers\");\n\n\t\t\t\t// Add new indexes if they don't exist\n\t\t\t\tif (!customersStore.indexNames.contains(\"synced\")) {\n\t\t\t\t\tcustomersStore.createIndex(\"synced\", \"synced\", { unique: false });\n\t\t\t\t}\n\t\t\t\tif (!customersStore.indexNames.contains(\"company_id\")) {\n\t\t\t\t\tcustomersStore.createIndex(\"company_id\", \"company_id\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (!customersStore.indexNames.contains(\"status\")) {\n\t\t\t\t\tcustomersStore.createIndex(\"status\", \"status\", { unique: false });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Version 2: Add new object stores\n\t\t\tif (oldVersion < 2) {\n\t\t\t\t// Communications store\n\t\t\t\tif (!db.objectStoreNames.contains(\"communications\")) {\n\t\t\t\t\tconst communicationsStore = db.createObjectStore(\"communications\", {\n\t\t\t\t\t\tkeyPath: \"id\",\n\t\t\t\t\t});\n\t\t\t\t\tcommunicationsStore.createIndex(\"synced\", \"synced\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tcommunicationsStore.createIndex(\"updated_at\", \"updated_at\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tcommunicationsStore.createIndex(\"company_id\", \"company_id\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tcommunicationsStore.createIndex(\"customer_id\", \"customer_id\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tcommunicationsStore.createIndex(\"type\", \"type\", { unique: false });\n\t\t\t\t\tcommunicationsStore.createIndex(\"thread_id\", \"thread_id\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tcommunicationsStore.createIndex(\"created_at\", \"created_at\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Payments store\n\t\t\t\tif (!db.objectStoreNames.contains(\"payments\")) {\n\t\t\t\t\tconst paymentsStore = db.createObjectStore(\"payments\", {\n\t\t\t\t\t\tkeyPath: \"id\",\n\t\t\t\t\t});\n\t\t\t\t\tpaymentsStore.createIndex(\"synced\", \"synced\", { unique: false });\n\t\t\t\t\tpaymentsStore.createIndex(\"updated_at\", \"updated_at\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tpaymentsStore.createIndex(\"company_id\", \"company_id\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tpaymentsStore.createIndex(\"customer_id\", \"customer_id\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tpaymentsStore.createIndex(\"invoice_id\", \"invoice_id\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tpaymentsStore.createIndex(\"payment_number\", \"payment_number\", {\n\t\t\t\t\t\tunique: true,\n\t\t\t\t\t});\n\t\t\t\t\tpaymentsStore.createIndex(\"status\", \"status\", { unique: false });\n\t\t\t\t}\n\n\t\t\t\t// Equipment store\n\t\t\t\tif (!db.objectStoreNames.contains(\"equipment\")) {\n\t\t\t\t\tconst equipmentStore = db.createObjectStore(\"equipment\", {\n\t\t\t\t\t\tkeyPath: \"id\",\n\t\t\t\t\t});\n\t\t\t\t\tequipmentStore.createIndex(\"synced\", \"synced\", { unique: false });\n\t\t\t\t\tequipmentStore.createIndex(\"updated_at\", \"updated_at\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tequipmentStore.createIndex(\"company_id\", \"company_id\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tequipmentStore.createIndex(\"customer_id\", \"customer_id\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tequipmentStore.createIndex(\"equipment_number\", \"equipment_number\", {\n\t\t\t\t\t\tunique: true,\n\t\t\t\t\t});\n\t\t\t\t\tequipmentStore.createIndex(\"type\", \"type\", { unique: false });\n\t\t\t\t\tequipmentStore.createIndex(\"status\", \"status\", { unique: false });\n\t\t\t\t}\n\n\t\t\t\t// Appointments store (IndexedDB store name kept as \"schedules\" for backwards compatibility)\n\t\t\t\tif (!db.objectStoreNames.contains(\"schedules\")) {\n\t\t\t\t\tconst schedulesStore = db.createObjectStore(\"schedules\", {\n\t\t\t\t\t\tkeyPath: \"id\",\n\t\t\t\t\t});\n\t\t\t\t\tschedulesStore.createIndex(\"synced\", \"synced\", { unique: false });\n\t\t\t\t\tschedulesStore.createIndex(\"updated_at\", \"updated_at\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tschedulesStore.createIndex(\"company_id\", \"company_id\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tschedulesStore.createIndex(\"customer_id\", \"customer_id\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tschedulesStore.createIndex(\"job_id\", \"job_id\", { unique: false });\n\t\t\t\t\tschedulesStore.createIndex(\"assigned_to\", \"assigned_to\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tschedulesStore.createIndex(\"start_time\", \"start_time\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tschedulesStore.createIndex(\"status\", \"status\", { unique: false });\n\t\t\t\t}\n\n\t\t\t\t// Tags store\n\t\t\t\tif (!db.objectStoreNames.contains(\"tags\")) {\n\t\t\t\t\tconst tagsStore = db.createObjectStore(\"tags\", { keyPath: \"id\" });\n\t\t\t\t\ttagsStore.createIndex(\"synced\", \"synced\", { unique: false });\n\t\t\t\t\ttagsStore.createIndex(\"updated_at\", \"updated_at\", { unique: false });\n\t\t\t\t\ttagsStore.createIndex(\"company_id\", \"company_id\", { unique: false });\n\t\t\t\t\ttagsStore.createIndex(\"slug\", \"slug\", { unique: false });\n\t\t\t\t\ttagsStore.createIndex(\"category\", \"category\", { unique: false });\n\t\t\t\t}\n\n\t\t\t\t// Attachments store\n\t\t\t\tif (!db.objectStoreNames.contains(\"attachments\")) {\n\t\t\t\t\tconst attachmentsStore = db.createObjectStore(\"attachments\", {\n\t\t\t\t\t\tkeyPath: \"id\",\n\t\t\t\t\t});\n\t\t\t\t\tattachmentsStore.createIndex(\"synced\", \"synced\", { unique: false });\n\t\t\t\t\tattachmentsStore.createIndex(\"updated_at\", \"updated_at\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tattachmentsStore.createIndex(\"company_id\", \"company_id\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tattachmentsStore.createIndex(\"entity_type\", \"entity_type\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\tattachmentsStore.createIndex(\"entity_id\", \"entity_id\", {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t\t// Composite index for entity_type + entity_id\n\t\t\t\t\tattachmentsStore.createIndex(\"entity\", [\"entity_type\", \"entity_id\"], {\n\t\t\t\t\t\tunique: false,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!db.objectStoreNames.contains(\"sync-queue\")) {\n\t\t\t\tconst syncQueueStore = db.createObjectStore(\"sync-queue\", {\n\t\t\t\t\tkeyPath: \"id\",\n\t\t\t\t});\n\t\t\t\tsyncQueueStore.createIndex(\"timestamp\", \"timestamp\", { unique: false });\n\t\t\t\tsyncQueueStore.createIndex(\"retry_count\", \"retry_count\", {\n\t\t\t\t\tunique: false,\n\t\t\t\t});\n\t\t\t\tsyncQueueStore.createIndex(\"table\", \"table\", { unique: false });\n\t\t\t}\n\t\t};\n\t});\n}\n\n/**\n * Add a record to a store\n */\nexport async function addRecord<T>(\n\tstoreName: StoreName,\n\trecord: T,\n): Promise<void> {\n\tconst db = await openDatabase();\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst transaction = db.transaction([storeName], \"readwrite\");\n\t\tconst store = transaction.objectStore(storeName);\n\t\tconst request = store.add(record);\n\n\t\trequest.onsuccess = () => {\n\t\t\tdb.close();\n\t\t\tresolve();\n\t\t};\n\n\t\trequest.onerror = () => {\n\t\t\tdb.close();\n\t\t\treject(new Error(`Failed to add record to ${storeName}`));\n\t\t};\n\t});\n}\n\n/**\n * Update a record in a store\n */\nexport async function updateRecord<T>(\n\tstoreName: StoreName,\n\trecord: T,\n): Promise<void> {\n\tconst db = await openDatabase();\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst transaction = db.transaction([storeName], \"readwrite\");\n\t\tconst store = transaction.objectStore(storeName);\n\t\tconst request = store.put(record);\n\n\t\trequest.onsuccess = () => {\n\t\t\tdb.close();\n\t\t\tresolve();\n\t\t};\n\n\t\trequest.onerror = () => {\n\t\t\tdb.close();\n\t\t\treject(new Error(`Failed to update record in ${storeName}`));\n\t\t};\n\t});\n}\n\n/**\n * Get a record by ID\n */\nexport async function getRecord<T>(\n\tstoreName: StoreName,\n\tid: string,\n): Promise<T | null> {\n\tconst db = await openDatabase();\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst transaction = db.transaction([storeName], \"readonly\");\n\t\tconst store = transaction.objectStore(storeName);\n\t\tconst request = store.get(id);\n\n\t\trequest.onsuccess = () => {\n\t\t\tdb.close();\n\t\t\tresolve(request.result || null);\n\t\t};\n\n\t\trequest.onerror = () => {\n\t\t\tdb.close();\n\t\t\treject(new Error(`Failed to get record from ${storeName}`));\n\t\t};\n\t});\n}\n\n/**\n * Get all records from a store\n */\nexport async function getAllRecords<T>(storeName: StoreName): Promise<T[]> {\n\tconst db = await openDatabase();\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst transaction = db.transaction([storeName], \"readonly\");\n\t\tconst store = transaction.objectStore(storeName);\n\t\tconst request = store.getAll();\n\n\t\trequest.onsuccess = () => {\n\t\t\tdb.close();\n\t\t\tresolve(request.result || []);\n\t\t};\n\n\t\trequest.onerror = () => {\n\t\t\tdb.close();\n\t\t\treject(new Error(`Failed to get all records from ${storeName}`));\n\t\t};\n\t});\n}\n\n/**\n * Get records by index\n */\nasync function getRecordsByIndex<T>(\n\tstoreName: StoreName,\n\tindexName: string,\n\tvalue: any,\n): Promise<T[]> {\n\tconst db = await openDatabase();\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst transaction = db.transaction([storeName], \"readonly\");\n\t\tconst store = transaction.objectStore(storeName);\n\t\tconst index = store.index(indexName);\n\t\tconst request = index.getAll(value);\n\n\t\trequest.onsuccess = () => {\n\t\t\tdb.close();\n\t\t\tresolve(request.result || []);\n\t\t};\n\n\t\trequest.onerror = () => {\n\t\t\tdb.close();\n\t\t\treject(new Error(`Failed to get records by index from ${storeName}`));\n\t\t};\n\t});\n}\n\n/**\n * Delete a record by ID\n */\nexport async function deleteRecord(\n\tstoreName: StoreName,\n\tid: string,\n): Promise<void> {\n\tconst db = await openDatabase();\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst transaction = db.transaction([storeName], \"readwrite\");\n\t\tconst store = transaction.objectStore(storeName);\n\t\tconst request = store.delete(id);\n\n\t\trequest.onsuccess = () => {\n\t\t\tdb.close();\n\t\t\tresolve();\n\t\t};\n\n\t\trequest.onerror = () => {\n\t\t\tdb.close();\n\t\t\treject(new Error(`Failed to delete record from ${storeName}`));\n\t\t};\n\t});\n}\n\n/**\n * Clear all records from a store\n */\nasync function clearStore(storeName: StoreName): Promise<void> {\n\tconst db = await openDatabase();\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst transaction = db.transaction([storeName], \"readwrite\");\n\t\tconst store = transaction.objectStore(storeName);\n\t\tconst request = store.clear();\n\n\t\trequest.onsuccess = () => {\n\t\t\tdb.close();\n\t\t\tresolve();\n\t\t};\n\n\t\trequest.onerror = () => {\n\t\t\tdb.close();\n\t\t\treject(new Error(`Failed to clear store ${storeName}`));\n\t\t};\n\t});\n}\n\n/**\n * Count records in a store\n */\nexport async function countRecords(storeName: StoreName): Promise<number> {\n\tconst db = await openDatabase();\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst transaction = db.transaction([storeName], \"readonly\");\n\t\tconst store = transaction.objectStore(storeName);\n\t\tconst request = store.count();\n\n\t\trequest.onsuccess = () => {\n\t\t\tdb.close();\n\t\t\tresolve(request.result || 0);\n\t\t};\n\n\t\trequest.onerror = () => {\n\t\t\tdb.close();\n\t\t\treject(new Error(`Failed to count records in ${storeName}`));\n\t\t};\n\t});\n}\n\n/**\n * Generate a temporary ID for offline records\n */\nexport function generateTempId(): string {\n\treturn `temp_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\n/**\n * Check if an ID is a temporary offline ID\n */\nexport function isTempId(id: string): boolean {\n\treturn id.startsWith(\"temp_\");\n}\n\n/**\n * Get unsynced records from a store\n */\nasync function getUnsyncedRecords<T extends { synced: boolean }>(\n\tstoreName: StoreName,\n): Promise<T[]> {\n\treturn getRecordsByIndex<T>(storeName, \"synced\", false);\n}\n\n/**\n * Clear old cached data (older than 7 days) from all stores\n * Removes synced records that are stale to free up storage space\n */\nasync function clearOldCache(): Promise<void> {\n\tconst sevenDaysAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;\n\tconst db = await openDatabase();\n\n\tconst storesToClear = [\n\t\t\"customers\",\n\t\t\"communications\",\n\t\t\"payments\",\n\t\t\"equipment\",\n\t\t\"schedules\",\n\t\t\"tags\",\n\t\t\"attachments\",\n\t];\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst transaction = db.transaction(storesToClear, \"readwrite\");\n\t\tlet completedStores = 0;\n\n\t\tconst checkComplete = () => {\n\t\t\tcompletedStores++;\n\t\t\tif (completedStores === storesToClear.length) {\n\t\t\t\tdb.close();\n\t\t\t\tresolve();\n\t\t\t}\n\t\t};\n\n\t\tstoresToClear.forEach((storeName) => {\n\t\t\tconst store = transaction.objectStore(storeName);\n\t\t\tconst index = store.index(\"updated_at\");\n\t\t\tconst range = IDBKeyRange.upperBound(sevenDaysAgo);\n\t\t\tconst request = index.openCursor(range);\n\n\t\t\trequest.onsuccess = (event) => {\n\t\t\t\tconst cursor = (event.target as IDBRequest).result;\n\t\t\t\tif (cursor) {\n\t\t\t\t\t// Only delete if synced (don't delete unsynced offline records)\n\t\t\t\t\tconst record = cursor.value;\n\t\t\t\t\tif (record.synced === true) {\n\t\t\t\t\t\tcursor.delete();\n\t\t\t\t\t}\n\t\t\t\t\tcursor.continue();\n\t\t\t\t} else {\n\t\t\t\t\tcheckComplete();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\trequest.onerror = () => {\n\t\t\t\tdb.close();\n\t\t\t\treject(new Error(`Failed to clear old cache from ${storeName}`));\n\t\t\t};\n\t\t});\n\t});\n}\n","/**\n * Sync Queue System\n *\n * Queues offline operations and syncs them to Supabase when online.\n * Handles retries, conflicts, and temporary ID mapping.\n *\n * Flow:\n * 1. User performs action offline (create job, update invoice)\n * 2. Operation added to IndexedDB sync-queue\n * 3. When online, process queue operations sequentially\n * 4. Update local records with server IDs\n * 5. Handle conflicts (last-write-wins)\n */\n\n\"use client\";\n\nimport { createClient } from \"@/lib/supabase/client\";\nimport {\n\taddRecord,\n\tdeleteRecord,\n\tgenerateTempId,\n\tgetAllRecords,\n\tgetRecord,\n\tisTempId,\n\ttype StoreName,\n\ttype SyncOperation,\n\tupdateRecord,\n} from \"./indexed-db\";\n\nconst MAX_RETRIES = 3;\n\n/**\n * Add an operation to the sync queue\n */\nasync function addToSyncQueue(\n\toperation: \"INSERT\" | \"UPDATE\" | \"DELETE\",\n\ttable: string,\n\tdata: any,\n): Promise<string> {\n\tconst id = generateTempId();\n\tconst syncOp: SyncOperation = {\n\t\tid,\n\t\toperation,\n\t\ttable,\n\t\tdata,\n\t\ttimestamp: Date.now(),\n\t\tretry_count: 0,\n\t};\n\n\tawait addRecord(\"sync-queue\", syncOp);\n\treturn id;\n}\n\n/**\n * Process all pending sync operations\n */\nexport async function processSyncQueue(): Promise<{\n\tsuccess: number;\n\tfailed: number;\n\terrors: Array<{ operation: SyncOperation; error: string }>;\n}> {\n\tconst operations = await getAllRecords<SyncOperation>(\"sync-queue\");\n\n\tif (operations.length === 0) {\n\t\treturn { success: 0, failed: 0, errors: [] };\n\t}\n\n\tconst supabase = createClient();\n\tlet successCount = 0;\n\tlet failedCount = 0;\n\tconst errors: Array<{ operation: SyncOperation; error: string }> = [];\n\n\t// Process operations sequentially to maintain order\n\tfor (const operation of operations) {\n\t\ttry {\n\t\t\tawait processSingleOperation(supabase, operation);\n\t\t\tawait deleteRecord(\"sync-queue\", operation.id);\n\t\t\tsuccessCount++;\n\t\t} catch (error) {\n\t\t\tconst errorMessage =\n\t\t\t\terror instanceof Error ? error.message : \"Unknown error\";\n\n\t\t\t// Increment retry count\n\t\t\tconst updatedOp = {\n\t\t\t\t...operation,\n\t\t\t\tretry_count: operation.retry_count + 1,\n\t\t\t\terror: errorMessage,\n\t\t\t};\n\n\t\t\tif (updatedOp.retry_count >= MAX_RETRIES) {\n\t\t\t\tawait updateRecord(\"sync-queue\", updatedOp);\n\t\t\t\tfailedCount++;\n\t\t\t\terrors.push({ operation, error: errorMessage });\n\t\t\t} else {\n\t\t\t\t// Update retry count and try again later\n\t\t\t\tawait updateRecord(\"sync-queue\", updatedOp);\n\t\t\t\tfailedCount++;\n\t\t\t}\n\t\t}\n\t}\n\treturn { success: successCount, failed: failedCount, errors };\n}\n\n/**\n * Process a single sync operation\n */\nasync function processSingleOperation(\n\tsupabase: any,\n\toperation: SyncOperation,\n): Promise<void> {\n\tconst { operation: op, table, data } = operation;\n\n\tswitch (op) {\n\t\tcase \"INSERT\": {\n\t\t\tconst { id: tempId, ...insertData } = data;\n\t\t\tconst { data: result, error } = await supabase\n\t\t\t\t.from(table)\n\t\t\t\t.insert(insertData)\n\t\t\t\t.select()\n\t\t\t\t.single();\n\n\t\t\tif (error) {\n\t\t\t\tthrow new Error(error.message);\n\t\t\t}\n\n\t\t\t// Update local record with server ID\n\t\t\tif (isTempId(tempId)) {\n\t\t\t\tconst storeName = getStoreNameFromTable(table);\n\t\t\t\tif (storeName) {\n\t\t\t\t\tawait deleteRecord(storeName, tempId);\n\t\t\t\t\tawait addRecord(storeName, { ...result, synced: true });\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"UPDATE\": {\n\t\t\tconst { id, ...updateData } = data;\n\t\t\tconst { error } = await supabase\n\t\t\t\t.from(table)\n\t\t\t\t.update(updateData)\n\t\t\t\t.eq(\"id\", id);\n\n\t\t\tif (error) {\n\t\t\t\tthrow new Error(error.message);\n\t\t\t}\n\n\t\t\t// Update local record sync status\n\t\t\tconst storeName = getStoreNameFromTable(table);\n\t\t\tif (storeName) {\n\t\t\t\tconst localRecord = await getRecord(storeName, id);\n\t\t\t\tif (localRecord) {\n\t\t\t\t\tawait updateRecord(storeName, {\n\t\t\t\t\t\t...localRecord,\n\t\t\t\t\t\t...updateData,\n\t\t\t\t\t\tsynced: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"DELETE\": {\n\t\t\tconst { id } = data;\n\t\t\tconst { error } = await supabase.from(table).delete().eq(\"id\", id);\n\n\t\t\tif (error) {\n\t\t\t\tthrow new Error(error.message);\n\t\t\t}\n\n\t\t\t// Remove from local storage\n\t\t\tconst storeName = getStoreNameFromTable(table);\n\t\t\tif (storeName) {\n\t\t\t\tawait deleteRecord(storeName, id);\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\n\t\tdefault:\n\t\t\tthrow new Error(`Unknown operation: ${op}`);\n\t}\n}\n\n/**\n * Map Supabase table name to IndexedDB store name\n */\nfunction getStoreNameFromTable(table: string): StoreName | null {\n\tconst tableToStore: Record<string, StoreName> = {\n\t\tjobs: \"jobs\",\n\t\tinvoices: \"invoices\",\n\t\tcustomers: \"customers\",\n\t\tcommunications: \"communications\",\n\t\tpayments: \"payments\",\n\t\tequipment: \"equipment\",\n\t\tschedules: \"appointments\",\n\t\ttags: \"tags\",\n\t\tattachments: \"attachments\",\n\t};\n\treturn tableToStore[table] || null;\n}\n\n/**\n * Clear failed operations from queue (manual intervention)\n */\nasync function clearFailedOperations(): Promise<void> {\n\tconst operations = await getAllRecords<SyncOperation>(\"sync-queue\");\n\tconst failedOps = operations.filter((op) => op.retry_count >= MAX_RETRIES);\n\n\tfor (const op of failedOps) {\n\t\tawait deleteRecord(\"sync-queue\", op.id);\n\t}\n}\n\n/**\n * Get failed operations for manual review\n */\nasync function getFailedOperations(): Promise<SyncOperation[]> {\n\tconst operations = await getAllRecords<SyncOperation>(\"sync-queue\");\n\treturn operations.filter((op) => op.retry_count >= MAX_RETRIES);\n}\n\n/**\n * Retry a specific failed operation\n */\nasync function retryOperation(operationId: string): Promise<boolean> {\n\tconst operation = await getRecord<SyncOperation>(\"sync-queue\", operationId);\n\tif (!operation) {\n\t\treturn false;\n\t}\n\n\tconst supabase = await createClient();\n\n\ttry {\n\t\tawait processSingleOperation(supabase, operation);\n\t\tawait deleteRecord(\"sync-queue\", operationId);\n\t\treturn true;\n\t} catch (error) {\n\t\tconst _errorMessage =\n\t\t\terror instanceof Error ? error.message : \"Unknown error\";\n\t\treturn false;\n\t}\n}\n","/**\n * Network Status Detection Hook\n *\n * Monitors online/offline state and triggers sync when connection is restored.\n * Critical for field workers with spotty internet connections.\n *\n * Usage:\n * ```typescript\n * const { isOnline, pendingOperations } = useNetworkStatus();\n * ```\n */\n\n\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { countRecords } from \"./indexed-db\";\nimport { processSyncQueue } from \"./sync-queue\";\n\nexport type NetworkStatus = {\n\tisOnline: boolean;\n\tpendingOperations: number;\n\tlastSync: Date | null;\n\tisSyncing: boolean;\n};\n\n/**\n * Hook to monitor network status and pending sync operations\n */\nexport function useNetworkStatus(): NetworkStatus {\n\tconst [isOnline, setIsOnline] = useState(\n\t\ttypeof navigator !== \"undefined\" ? navigator.onLine : true,\n\t);\n\tconst [pendingOperations, setPendingOperations] = useState(0);\n\tconst [lastSync, setLastSync] = useState<Date | null>(null);\n\tconst [isSyncing, setIsSyncing] = useState(false);\n\n\t// Update pending operations count\n\tconst updatePendingCount = async () => {\n\t\t// SSR guard - only run in browser\n\t\tif (typeof window === \"undefined\") {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst count = await countRecords(\"sync-queue\");\n\t\t\tsetPendingOperations(count);\n\t\t} catch (_error) {}\n\t};\n\n\t// Use ref to prevent concurrent sync operations (CRITICAL FIX)\n\tconst isSyncingRef = useRef(false);\n\n\tuseEffect(() => {\n\t\t// SSR guard - only run in browser\n\t\tif (typeof window === \"undefined\") {\n\t\t\treturn;\n\t\t}\n\n\t\t// Initial pending count\n\t\tupdatePendingCount();\n\n\t\t// Poll for pending operations every 10 seconds\n\t\tconst interval = setInterval(() => {\n\t\t\t// Don't update count if sync is in progress to avoid race conditions\n\t\t\tif (!isSyncingRef.current) {\n\t\t\t\tupdatePendingCount();\n\t\t\t}\n\t\t}, 10_000);\n\n\t\tconst handleOnline = async () => {\n\t\t\t// Guard: prevent concurrent sync operations\n\t\t\tif (isSyncingRef.current) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetIsOnline(true);\n\t\t\tisSyncingRef.current = true;\n\n\t\t\t// Trigger sync queue processing\n\t\t\ttry {\n\t\t\t\tsetIsSyncing(true);\n\t\t\t\tawait processSyncQueue();\n\t\t\t\tsetLastSync(new Date());\n\t\t\t\tawait updatePendingCount();\n\t\t\t} catch (_error) {\n\t\t\t} finally {\n\t\t\t\tsetIsSyncing(false);\n\t\t\t\tisSyncingRef.current = false;\n\t\t\t}\n\t\t};\n\n\t\tconst handleOffline = () => {\n\t\t\tsetIsOnline(false);\n\t\t};\n\n\t\t// Listen for visibility change (page becomes visible after being hidden)\n\t\tconst handleVisibilityChange = async () => {\n\t\t\t// Guard: prevent concurrent sync operations\n\t\t\tif (\n\t\t\t\tdocument.visibilityState === \"visible\" &&\n\t\t\t\tnavigator.onLine &&\n\t\t\t\t!isSyncingRef.current\n\t\t\t) {\n\t\t\t\tisSyncingRef.current = true;\n\n\t\t\t\t// Trigger sync when user returns to the tab\n\t\t\t\ttry {\n\t\t\t\t\tsetIsSyncing(true);\n\t\t\t\t\tawait processSyncQueue();\n\t\t\t\t\tsetLastSync(new Date());\n\t\t\t\t\tawait updatePendingCount();\n\t\t\t\t} catch (_error) {\n\t\t\t\t} finally {\n\t\t\t\t\tsetIsSyncing(false);\n\t\t\t\t\tisSyncingRef.current = false;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Listen for online/offline events\n\t\twindow.addEventListener(\"online\", handleOnline);\n\t\twindow.addEventListener(\"offline\", handleOffline);\n\t\tdocument.addEventListener(\"visibilitychange\", handleVisibilityChange);\n\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"online\", handleOnline);\n\t\t\twindow.removeEventListener(\"offline\", handleOffline);\n\t\t\tdocument.removeEventListener(\"visibilitychange\", handleVisibilityChange);\n\t\t\tclearInterval(interval);\n\t\t};\n\t}, [\n\t\t// Initial pending count\n\t\tupdatePendingCount,\n\t]);\n\n\treturn {\n\t\tisOnline,\n\t\tpendingOperations,\n\t\tlastSync,\n\t\tisSyncing,\n\t};\n}\n\n/**\n * Get current online status (synchronous)\n */\nfunction isOnline(): boolean {\n\treturn typeof navigator !== \"undefined\" ? navigator.onLine : true;\n}\n\n/**\n * Wait for network connection\n */\nfunction waitForOnline(): Promise<void> {\n\treturn new Promise((resolve) => {\n\t\tif (navigator.onLine) {\n\t\t\tresolve();\n\t\t} else {\n\t\t\tconst handler = () => {\n\t\t\t\twindow.removeEventListener(\"online\", handler);\n\t\t\t\tresolve();\n\t\t\t};\n\t\t\twindow.addEventListener(\"online\", handler);\n\t\t}\n\t});\n}\n\n/**\n * Execute a function when online\n */\nasync function executeWhenOnline<T>(fn: () => Promise<T>): Promise<T> {\n\tif (!navigator.onLine) {\n\t\tawait waitForOnline();\n\t}\n\treturn fn();\n}\n","\"use client\";\n\nimport { BarChart3 } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Button, Popover, PopoverContent, PopoverTrigger, cn } from \"@stratos/ui\";\nimport type { StatCard } from \"@/lib/layout/unified-layout-config\";\n\ntype ToolbarStatsButtonProps = {\n\tstats: StatCard[];\n\t/** Primary stat to show in badge (defaults to first stat) */\n\tprimaryStatIndex?: number;\n\t/** Compact mode - only show icon without badge */\n\tcompact?: boolean;\n};\n\n/**\n * ToolbarStatsButton - Compact stats display with popover\n *\n * Ultra-compact alternative to inline stats that saves toolbar space.\n * Shows a small button with optional badge, expands to full stats on click.\n *\n * Features:\n * - Minimalistic design (icon + optional badge)\n * - Hover preview of primary stat\n * - Click to expand full stats in popover\n * - Responsive (auto-hides badge on mobile)\n *\n * Example:\n * ```tsx\n * <ToolbarStatsButton stats={[\n *   { label: \"Total\", value: \"124\", trend: { value: 12, direction: \"up\" } },\n *   { label: \"Active\", value: \"89\" },\n *   { label: \"Pending\", value: \"35\" }\n * ]} />\n * ```\n */\nexport function ToolbarStatsButton({\n\tstats,\n\tprimaryStatIndex = 0,\n\tcompact = false,\n}: ToolbarStatsButtonProps) {\n\tconst [open, setOpen] = useState(false);\n\n\tif (!stats || stats.length === 0) {\n\t\treturn null;\n\t}\n\n\tconst primaryStat = stats[primaryStatIndex];\n\tconst hasTrend = Boolean(primaryStat?.trend);\n\n\treturn (\n\t\t<Popover open={open} onOpenChange={setOpen}>\n\t\t\t<PopoverTrigger asChild>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\"h-8 gap-1.5 px-2 transition-all duration-200\",\n\t\t\t\t\t\t\"hover:bg-primary/10 hover:text-primary\",\n\t\t\t\t\t\t\"data-[state=open]:bg-primary/10 data-[state=open]:text-primary\",\n\t\t\t\t\t)}\n\t\t\t\t\ttitle={`${primaryStat?.label}: ${primaryStat?.value}`}\n\t\t\t\t>\n\t\t\t\t\t<BarChart3 className=\"h-4 w-4\" />\n\t\t\t\t\t{!compact && primaryStat && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<span className=\"hidden text-xs font-medium tabular-nums sm:inline\">\n\t\t\t\t\t\t\t\t{primaryStat.value}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t{hasTrend && primaryStat.trend && (\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"hidden text-xs font-medium tabular-nums lg:inline\",\n\t\t\t\t\t\t\t\t\t\tprimaryStat.trend.direction === \"up\"\n\t\t\t\t\t\t\t\t\t\t\t? \"text-success\"\n\t\t\t\t\t\t\t\t\t\t\t: primaryStat.trend.direction === \"down\"\n\t\t\t\t\t\t\t\t\t\t\t\t? \"text-destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t: \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{primaryStat.trend.direction === \"up\" && \"+\"}\n\t\t\t\t\t\t\t\t\t{primaryStat.trend.value}\n\t\t\t\t\t\t\t\t\t{primaryStat.trend.suffix || \"%\"}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</Button>\n\t\t\t</PopoverTrigger>\n\t\t\t<PopoverContent className=\"w-80 p-4\" align=\"start\" sideOffset={8}>\n\t\t\t\t<div className=\"space-y-3\">\n\t\t\t\t\t<div className=\"flex items-center justify-between border-b pb-2\">\n\t\t\t\t\t\t<h4 className=\"text-sm font-semibold\">Statistics</h4>\n\t\t\t\t\t\t<span className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t{stats.length} {stats.length === 1 ? \"metric\" : \"metrics\"}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div className=\"grid gap-3\">\n\t\t\t\t\t\t{stats.map((stat, index) => (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\"rounded-lg border p-3 transition-colors\",\n\t\t\t\t\t\t\t\t\tindex === primaryStatIndex\n\t\t\t\t\t\t\t\t\t\t? \"border-primary/50 bg-primary/5\"\n\t\t\t\t\t\t\t\t\t\t: \"border-border/50 hover:border-border\",\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"flex items-start justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground truncate text-xs font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t{stat.label}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t<p className=\"mt-1 truncate text-lg font-semibold tabular-nums\">\n\t\t\t\t\t\t\t\t\t\t\t{stat.value}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{stat.trend && (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\"flex shrink-0 items-center gap-1 rounded-md px-2 py-1 text-xs font-medium\",\n\t\t\t\t\t\t\t\t\t\t\t\tstat.trend.direction === \"up\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-success/10 text-success\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: stat.trend.direction === \"down\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-destructive/10 text-destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"bg-muted text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t\t{stat.trend.direction === \"up\" && \"↑\"}\n\t\t\t\t\t\t\t\t\t\t\t\t{stat.trend.direction === \"down\" && \"↓\"}\n\t\t\t\t\t\t\t\t\t\t\t\t{stat.trend.direction === \"neutral\" && \"→\"}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"tabular-nums\">\n\t\t\t\t\t\t\t\t\t\t\t\t{stat.trend.value}\n\t\t\t\t\t\t\t\t\t\t\t\t{stat.trend.suffix || \"%\"}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{stat.description && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground mt-2 text-xs leading-relaxed\">\n\t\t\t\t\t\t\t\t\t\t{stat.description}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</PopoverContent>\n\t\t</Popover>\n\t);\n}\n"],"names":[],"mappings":"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"}