module.exports=[722819,a=>{"use strict";var b=a.i(861467),c=a.i(97997),d=a.i(60222),e=a.i(128952),f=a.i(337241),g=a.i(783281),h=a.i(169021),i=(0,h.createServerReference)("600f2001e85494de7547a5213c6143dced69476baf",h.callServer,void 0,h.findSourceMapURL,"getCustomerCallData"),j=(0,h.createServerReference)("60e51c1544e88202aee90bf80bbe297c22b52e59cc",h.callServer,void 0,h.findSourceMapURL,"getCustomerCallDataById"),k=a.i(706544),l=a.i(587488),m=a.i(138382),n=a.i(558228),o=a.i(274647),p=a.i(781157),q=a.i(976804),r=a.i(334838),s=a.i(841269),t=a.i(186910),t=t,u=a.i(864199),v=a.i(629367),w=a.i(550501),w=w,x=a.i(585092),y=a.i(794759),z=a.i(300298);a.i(516775);var A=a.i(560272);a.i(288007);var B=a.i(986990);a.i(445255);var C=a.i(18170);a.i(928414);var D=a.i(745250),E=a.i(700760);function F({callId:a,isActive:c,isMuted:d,isOnHold:e,isRecording:f,videoStatus:h,connectionQuality:i,callDuration:j,holdStartTime:F,recordingStartTime:G,customerData:H,callerName:I,callerNumber:J,onMuteToggle:K,onHoldToggle:L,onRecordToggle:M,onVideoToggle:N,onTransfer:O,onEndCall:P,onClose:Q,onShowShortcuts:R}){let[S,T]=(0,g.useState)(!1),[U,V]=(0,g.useState)(0);(0,g.useEffect)(()=>{if(!e||!F)return void V(0);let a=setInterval(()=>{V(Math.floor((Date.now()-F)/1e3))},1e3);return()=>clearInterval(a)},[e,F]);let[W,X]=(0,g.useState)(0);(0,g.useEffect)(()=>{if(!f||!G)return void X(0);let a=setInterval(()=>{X(Math.floor((Date.now()-G)/1e3))},1e3);return()=>clearInterval(a)},[f,G]);let Y=a=>{let b=Math.floor(a/60);return`${b}:${(a%60).toString().padStart(2,"0")}`},Z=H?.customer&&"object"==typeof H.customer&&"avatar_url"in H.customer?H.customer.avatar_url??void 0:void 0;return(0,b.jsx)(D.TooltipProvider,{delayDuration:300,children:(0,b.jsxs)("div",{className:"relative",children:[d&&(0,b.jsxs)("div",{className:"bg-destructive/10 border-destructive/30 flex items-center justify-center gap-2 border-b px-4 py-2",children:[(0,b.jsx)(o.MicOff,{className:"text-destructive h-4 w-4 animate-pulse"}),(0,b.jsx)("span",{className:"text-destructive text-sm font-medium",children:"You are muted"}),(0,b.jsx)("span",{className:"text-destructive/70 text-xs",children:"Press M to unmute"})]}),e&&(0,b.jsxs)("div",{className:"bg-warning/10 border-warning/30 flex items-center justify-center gap-2 border-b px-4 py-2",children:[(0,b.jsx)(u.Timer,{className:"text-warning h-4 w-4"}),(0,b.jsx)("span",{className:"text-warning text-sm font-medium",children:"Call on hold"}),(0,b.jsx)(B.Badge,{variant:"outline",className:"text-warning border-warning/50 font-mono text-xs",children:Y(U)}),(0,b.jsx)("span",{className:"text-warning/70 text-xs",children:"Press H to resume"})]}),(0,b.jsxs)("div",{className:"bg-card/50 flex items-center justify-between px-6 py-3 backdrop-blur-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)(A.Avatar,{className:"h-11 w-11",children:[(0,b.jsx)(A.AvatarImage,{src:Z}),(0,b.jsx)(A.AvatarFallback,{className:(0,E.cn)("text-base font-semibold transition-all",c?"bg-emerald-500/20 text-emerald-600 ring-2 ring-emerald-500/30":"bg-muted text-muted-foreground"),children:I&&"Unknown Caller"!==I?I.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2):"?"})]}),c&&(0,b.jsx)("div",{className:"ring-background absolute -top-0.5 -right-0.5 h-3 w-3 rounded-full bg-emerald-500 ring-2"})]}),(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-foreground text-sm font-semibold",children:I}),c&&(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)("span",{className:"text-muted-foreground font-mono text-xs tabular-nums",children:j}),f&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(l.Circle,{className:"size-2 animate-pulse fill-red-500 text-red-500"}),(0,b.jsxs)("span",{className:"text-destructive font-mono text-xs",children:["REC ",Y(W)]})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-muted-foreground font-mono text-xs",children:J}),H?.isKnownCustomer&&(0,b.jsx)(B.Badge,{className:"h-4 px-1.5 text-[10px]",variant:"outline",children:"Customer"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,b.jsxs)(D.Tooltip,{children:[(0,b.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(C.Button,{className:(0,E.cn)("h-10 w-10 rounded-full transition-all hover:scale-105",d&&"ring-destructive/50 ring-2 ring-offset-2",!d&&"hover:bg-muted"),onClick:K,size:"icon",variant:d?"destructive":"ghost",children:d?(0,b.jsx)(o.MicOff,{className:"size-4 animate-pulse"}):(0,b.jsx)(n.Mic,{className:"size-4"})})}),(0,b.jsxs)(D.TooltipContent,{side:"bottom",children:[(0,b.jsx)("p",{children:d?"Unmute":"Mute"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press M"})]})]}),(0,b.jsxs)(D.Tooltip,{children:[(0,b.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(C.Button,{className:(0,E.cn)("h-10 w-10 rounded-full transition-all hover:scale-105",e&&"ring-warning/50 ring-2 ring-offset-2",!e&&"hover:bg-muted"),onClick:L,size:"icon",variant:e?"secondary":"ghost",children:e?(0,b.jsx)(r.Play,{className:"size-4"}):(0,b.jsx)(p.Pause,{className:"size-4"})})}),(0,b.jsxs)(D.TooltipContent,{side:"bottom",children:[(0,b.jsx)("p",{children:e?"Resume":"Hold"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press H"})]})]}),(0,b.jsxs)(D.Tooltip,{children:[(0,b.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(C.Button,{className:(0,E.cn)("h-10 w-10 rounded-full transition-all hover:scale-105",f&&"ring-destructive/50 ring-2 ring-offset-2",!f&&"hover:bg-muted"),onClick:M,size:"icon",variant:f?"destructive":"ghost",children:f?(0,b.jsx)(l.Circle,{className:"size-4 animate-pulse fill-current"}):(0,b.jsx)(t.default,{className:"size-4"})})}),(0,b.jsxs)(D.TooltipContent,{side:"bottom",children:[(0,b.jsx)("p",{children:f?"Stop Recording":"Record"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press R"})]})]}),(0,b.jsx)("div",{className:"bg-border mx-2 h-6 w-px"}),(0,b.jsxs)(D.Tooltip,{children:[(0,b.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(C.Button,{className:(0,E.cn)("h-10 w-10 rounded-full transition-all hover:scale-105","off"===h&&"hover:bg-muted"),onClick:N,size:"icon",variant:"connected"===h?"default":"ghost",children:"connected"===h?(0,b.jsx)(v.Video,{className:"size-4"}):(0,b.jsx)(w.default,{className:"size-4"})})}),(0,b.jsx)(D.TooltipContent,{side:"bottom",children:(0,b.jsx)("p",{children:"connected"===h?"End Video":"Start Video"})})]}),(0,b.jsxs)(D.Tooltip,{children:[(0,b.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(C.Button,{className:"hover:bg-muted h-10 w-10 rounded-full transition-all hover:scale-105",onClick:O,size:"icon",variant:"ghost",children:(0,b.jsx)(k.ArrowRightLeft,{className:"size-4"})})}),(0,b.jsxs)(D.TooltipContent,{side:"bottom",children:[(0,b.jsx)("p",{children:"Transfer Call"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press T"})]})]}),(0,b.jsx)("div",{className:"bg-border mx-2 h-6 w-px"}),(0,b.jsxs)(D.Tooltip,{children:[(0,b.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(C.Button,{className:"text-destructive-foreground h-12 w-12 rounded-full transition-all hover:scale-105",onClick:P,size:"icon",variant:"destructive",children:(0,b.jsx)(q.PhoneOff,{className:"size-5"})})}),(0,b.jsxs)(D.TooltipContent,{side:"bottom",children:[(0,b.jsx)("p",{children:"End Call"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press Shift+E"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsxs)(B.Badge,{className:"font-mono text-[10px]",title:"unknown"===i?"Monitoring connection quality...":void 0,variant:(()=>{switch(i){case"excellent":return"default";case"good":return"secondary";case"poor":return"destructive";default:return"outline"}})(),children:[(()=>{switch(i){case"excellent":return(0,b.jsx)(s.Signal,{className:"text-success h-3 w-3"});case"good":return(0,b.jsx)(x.Wifi,{className:"text-warning h-3 w-3"});case"poor":return(0,b.jsx)(y.WifiOff,{className:"text-destructive h-3 w-3"});default:return(0,b.jsx)(s.Signal,{className:"text-muted-foreground h-3 w-3"})}})(),(0,b.jsx)("span",{className:"ml-1 capitalize",children:i})]}),R&&(0,b.jsxs)(D.Tooltip,{children:[(0,b.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(C.Button,{className:"h-8 w-8",onClick:R,size:"icon",variant:"ghost",children:(0,b.jsx)(m.Keyboard,{className:"h-4 w-4"})})}),(0,b.jsxs)(D.TooltipContent,{side:"bottom",children:[(0,b.jsx)("p",{children:"Keyboard Shortcuts"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press ?"})]})]}),(0,b.jsx)(C.Button,{className:"h-8 w-8",onClick:Q,size:"icon",variant:"ghost",children:(0,b.jsx)(z.X,{className:"h-4 w-4"})})]})]})]})})}var G=a.i(48199),H=a.i(263758),I=a.i(587969),J=a.i(952251),J=J,K=a.i(319895),L=a.i(332284),M=a.i(396919),N=a.i(480298),O=a.i(409946),O=O,P=a.i(789815),Q=a.i(824124),R=a.i(898062),S=a.i(638727),T=a.i(232553),U=a.i(984547),U=U,V=a.i(320091),W=a.i(362841);a.i(839984);var X=a.i(372712);a.i(458393);var Y=a.i(82012);a.i(413309);var Z=a.i(54210),$=a.i(382281);a.i(897346);var _=a.i(75892);a.i(476036);var aa=a.i(930514);let ab=[{id:"greeting",text:"Greet customer warmly and smile while speaking",enabled:!0,order:1},{id:"verify",text:"Verify customer name, phone, and service address",enabled:!0,order:2},{id:"availability",text:"Ask about preferred appointment times and availability",enabled:!0,order:3},{id:"confirm",text:"Confirm all details before ending the call",enabled:!0,order:4}];var ac=a.i(235841),ac=ac,ad=a.i(304030),ad=ad,ae=a.i(527936),af=a.i(105996),ag=a.i(813704),ag=ag,ah=a.i(171768),ai=a.i(624038);let aj={past_due:{icon:ae.CreditCard,bgColor:"bg-destructive/10 dark:bg-destructive/20",borderColor:"border-destructive/50",textColor:"text-destructive",iconColor:"text-destructive"},vip:{icon:af.Crown,bgColor:"bg-amber-500/10 dark:bg-amber-500/20",borderColor:"border-amber-500/50",textColor:"text-amber-600 dark:text-amber-400",iconColor:"text-amber-500"},at_risk:{icon:ai.TrendingDown,bgColor:"bg-orange-500/10 dark:bg-orange-500/20",borderColor:"border-orange-500/50",textColor:"text-orange-600 dark:text-orange-400",iconColor:"text-orange-500"},complaint:{icon:ag.default,bgColor:"bg-warning/10 dark:bg-warning/20",borderColor:"border-warning/50",textColor:"text-warning",iconColor:"text-warning"},blocked:{icon:ad.default,bgColor:"bg-destructive/15 dark:bg-destructive/25",borderColor:"border-destructive",textColor:"text-destructive",iconColor:"text-destructive"},new_customer:{icon:ah.Star,bgColor:"bg-primary/10 dark:bg-primary/20",borderColor:"border-primary/50",textColor:"text-primary",iconColor:"text-primary"},high_value:{icon:ac.default,bgColor:"bg-success/10 dark:bg-success/20",borderColor:"border-success/50",textColor:"text-success",iconColor:"text-success"}};function ak({customerData:a,stats:c,onTakePayment:d,onViewHistory:e,onViewComplaints:f,className:h}){let[i,j]=(0,g.useState)(new Set),k=[];if(!a||!c)return null;let{customer:l}=a;if(c.openInvoices>0){let b=a.invoices.filter(a=>"unpaid"===a.status||"overdue"===a.status).reduce((a,b)=>a+(b.total_amount||0),0);if(b>0){let e=a.invoices.some(a=>"overdue"===a.status);k.push({id:"past_due",type:"past_due",title:e?"Past Due Balance":"Outstanding Balance",description:`${c.openInvoices} unpaid invoice${c.openInvoices>1?"s":""}`,amount:b,action:d?{label:"Take Payment",onClick:d}:void 0})}}let m=l?.tags?.includes("VIP")||l?.tags?.includes("vip")||l?.priority_level==="high";m&&k.push({id:"vip",type:"vip",title:"VIP Customer",description:"Priority service â€¢ Extended support",dismissible:!0}),c.totalRevenue>1e4&&!m&&k.push({id:"high_value",type:"high_value",title:"High Value Customer",description:`Lifetime value: ${al(c.totalRevenue)}`,dismissible:!0}),l?.created_at&&new Date(l.created_at)>new Date(Date.now()-2592e6)&&0===c.totalRevenue&&k.push({id:"new_customer",type:"new_customer",title:"New Customer",description:"First interaction â€¢ Make a great impression!",dismissible:!0});let n=a.jobs.filter(a=>"cancelled"===a.status).length;n>=2&&k.push({id:"at_risk",type:"at_risk",title:"At-Risk Customer",description:`${n} cancelled jobs â€¢ Consider retention offer`,action:e?{label:"View History",onClick:e}:void 0}),(l?.notes?.toLowerCase().includes("complaint")||l?.notes?.toLowerCase().includes("unhappy")||l?.notes?.toLowerCase().includes("frustrated"))&&k.push({id:"complaint",type:"complaint",title:"Recent Complaint",description:"Customer had a previous issue â€¢ Handle with care",action:f?{label:"View Details",onClick:f}:void 0}),(l?.status==="blocked"||l?.tags?.includes("problem")||l?.tags?.includes("do-not-service"))&&k.push({id:"blocked",type:"blocked",title:"Service Restricted",description:"Check with manager before scheduling"});let o=k.filter(a=>!i.has(a.id));return 0===o.length?null:(0,b.jsx)("div",{className:(0,E.cn)("space-y-2",h),children:o.map(a=>{let c=aj[a.type],d=c.icon;return(0,b.jsx)("div",{className:(0,E.cn)("relative overflow-hidden rounded-lg border p-3 transition-all",c.bgColor,c.borderColor),children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:(0,E.cn)("mt-0.5 flex h-8 w-8 shrink-0 items-center justify-center rounded-full",c.bgColor),children:(0,b.jsx)(d,{className:(0,E.cn)("h-4 w-4",c.iconColor)})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h4",{className:(0,E.cn)("text-sm font-semibold",c.textColor),children:a.title}),void 0!==a.amount&&(0,b.jsx)(B.Badge,{className:(0,E.cn)("font-mono text-xs",c.textColor),variant:"outline",children:al(a.amount)})]}),(0,b.jsx)("p",{className:(0,E.cn)("mt-0.5 text-xs opacity-80",c.textColor),children:a.description}),a.action&&(0,b.jsx)(C.Button,{className:(0,E.cn)("mt-2 h-7 text-xs",c.textColor),onClick:a.action.onClick,size:"sm",variant:"outline",children:a.action.label})]}),a.dismissible&&(0,b.jsx)(C.Button,{className:(0,E.cn)("h-6 w-6 shrink-0 opacity-60 hover:opacity-100",c.textColor),onClick:()=>{var b;return b=a.id,void j(a=>new Set([...a,b]))},size:"icon",variant:"ghost",children:(0,b.jsx)(z.X,{className:"h-3 w-3"})})]})},a.id)})})}function al(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(a)}var am=a.i(698540),an=a.i(624126);function ao({stats:a,openBalance:c=0,lastVisitDate:d,className:e}){var f,g;let h=a=>a>=1e3?`$${(a/1e3).toFixed(1)}k`:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),i=(f=a.totalRevenue)>=1e4?"text-success":f>=5e3?"text-primary":f>=1e3?"text-foreground":"text-muted-foreground",j=c>0;return(0,b.jsx)(D.TooltipProvider,{delayDuration:200,children:(0,b.jsx)("div",{className:(0,E.cn)("bg-card/80 sticky top-0 z-10 border-b backdrop-blur-sm",e),children:(0,b.jsxs)("div",{className:"grid grid-cols-5 divide-x",children:[(0,b.jsxs)(D.Tooltip,{children:[(0,b.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(am.Banknote,{className:(0,E.cn)("h-3.5 w-3.5",i)}),(0,b.jsx)("span",{className:(0,E.cn)("text-xs font-bold",i),children:h(a.totalRevenue)})]}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Revenue"})]})}),(0,b.jsxs)(D.TooltipContent,{children:[(0,b.jsx)("p",{children:"Total Lifetime Revenue"}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:[(g=a.totalRevenue)>=1e4?"High Value":g>=5e3?"Good":g>=1e3?"Average":g>0?"New":"No History"," customer"]})]})]}),(0,b.jsxs)(D.Tooltip,{children:[(0,b.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:(0,E.cn)("flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50",j&&"bg-destructive/5"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(ae.CreditCard,{className:(0,E.cn)("h-3.5 w-3.5",j?"text-destructive":"text-muted-foreground")}),(0,b.jsx)("span",{className:(0,E.cn)("text-xs font-bold",j?"text-destructive":"text-muted-foreground"),children:j?h(c):"$0"})]}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px]",children:j?"Due":"Balance"})]})}),(0,b.jsxs)(D.TooltipContent,{children:[(0,b.jsx)("p",{children:j?"Outstanding Balance":"No Balance Due"}),j&&(0,b.jsxs)("p",{className:"text-destructive text-xs",children:[a.openInvoices," unpaid invoice",1!==a.openInvoices?"s":""]})]})]}),(0,b.jsxs)(D.Tooltip,{children:[(0,b.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(G.Briefcase,{className:(0,E.cn)("h-3.5 w-3.5",a.activeJobs>0?"text-primary":"text-muted-foreground")}),(0,b.jsx)("span",{className:(0,E.cn)("text-xs font-bold",a.activeJobs>0?"text-primary":"text-muted-foreground"),children:a.activeJobs})]}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Active"})]})}),(0,b.jsxs)(D.TooltipContent,{children:[(0,b.jsx)("p",{children:"Active Jobs"}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:[a.totalJobs," total jobs"]})]})]}),(0,b.jsxs)(D.Tooltip,{children:[(0,b.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(an.Clock,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"text-foreground text-xs font-bold",children:(a=>{if(!a)return"Never";let b=new Date(a),c=Math.floor((new Date().getTime()-b.getTime())/864e5);return 0===c?"Today":1===c?"Yesterday":c<7?`${c} days ago`:c<30?`${Math.floor(c/7)} weeks ago`:c<365?`${Math.floor(c/30)} months ago`:b.toLocaleDateString("en-US",{month:"short",year:"numeric"})})(d??null)})]}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Last Visit"})]})}),(0,b.jsxs)(D.TooltipContent,{children:[(0,b.jsx)("p",{children:"Last Service Visit"}),d&&(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:new Date(d).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]})]}),(0,b.jsxs)(D.Tooltip,{children:[(0,b.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(V.User,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"text-foreground text-xs font-bold",children:(()=>{if(!a.customerSince)return"New";let b=new Date(a.customerSince),c=(new Date().getTime()-b.getTime())/31536e6;if(c<1){let a=Math.floor(12*c);return a<=1?"< 1 mo":`${a} mo`}return`${Math.floor(c)}y`})()})]}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Member"})]})}),(0,b.jsxs)(D.TooltipContent,{children:[(0,b.jsx)("p",{children:"Customer Since"}),a.customerSince&&(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:new Date(a.customerSince).toLocaleDateString("en-US",{month:"long",year:"numeric"})})]})]})]})})})}var ap=a.i(766153),aq=a.i(990782),ar=a.i(283753),as=a.i(916680);let at={resolved:"bg-success/10 text-success border-success/30",callback_scheduled:"bg-warning/10 text-warning border-warning/30",escalated:"bg-orange-500/10 text-orange-500 border-orange-500/30",voicemail_left:"bg-muted text-muted-foreground border-muted",transferred:"bg-muted text-muted-foreground border-muted",customer_hung_up:"bg-muted text-muted-foreground border-muted",appointment_booked:"bg-primary/10 text-primary border-primary/30",quote_provided:"bg-primary/10 text-primary border-primary/30",payment_taken:"bg-success/10 text-success border-success/30",other:"bg-muted text-muted-foreground border-muted"},au={positive:"ðŸ˜Š",neutral:"ðŸ˜",negative:"ðŸ˜ "};function av({lastCall:a,recentCalls:c=[],onViewAllCalls:d,className:f}){let h,i,j,[k,l]=(0,g.useState)(!1);if(!a)return(0,b.jsx)("div",{className:(0,E.cn)("border-primary/20 bg-primary/5 rounded-xl border p-4",f),children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"bg-primary/10 rounded-full p-2",children:(0,b.jsx)(R.Phone,{className:"text-primary h-4 w-4"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"First Call"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1 text-xs",children:"This is the first call with this customer. No previous call history available."})]})]})});let m=a=>{let b=Math.floor(a/60),c=a%60;return 0===b?`${c}s`:`${b}m ${c}s`},n=at[a.disposition]||at.other;return(0,b.jsxs)("div",{className:(0,E.cn)("bg-muted/30 overflow-hidden rounded-xl border transition-all",f),children:[(0,b.jsxs)("button",{className:"flex w-full items-center justify-between p-4 text-left transition-colors hover:bg-muted/50",onClick:()=>l(!k),type:"button",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"bg-muted rounded-full p-2",children:(0,b.jsx)(R.Phone,{className:"text-muted-foreground h-4 w-4"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Previous Call"}),a.sentiment&&(0,b.jsx)("span",{title:`Customer was ${a.sentiment}`,children:au[a.sentiment]})]}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:[(h=new Date(a.date),0===(j=Math.floor(((i=new Date).getTime()-h.getTime())/864e5))?`Today at ${h.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:1===j?`Yesterday at ${h.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:j<7?`${j} days ago`:h.toLocaleDateString("en-US",{month:"short",day:"numeric",year:h.getFullYear()!==i.getFullYear()?"numeric":void 0}))," â€¢ ",m(a.duration)]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(B.Badge,{className:(0,E.cn)("text-xs",n),variant:"outline",children:a.disposition.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}),k?(0,b.jsx)(aq.ChevronUp,{className:"text-muted-foreground h-4 w-4"}):(0,b.jsx)(ap.ChevronDown,{className:"text-muted-foreground h-4 w-4"})]})]}),k&&(0,b.jsxs)("div",{className:"border-t p-4 pt-3",children:[(0,b.jsxs)("div",{className:"mb-3 grid grid-cols-3 gap-2",children:[(0,b.jsxs)("div",{className:"bg-card rounded-lg p-2 text-center",children:[(0,b.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,b.jsx)(V.User,{className:"text-muted-foreground h-3 w-3"}),(0,b.jsx)("span",{className:"text-xs font-medium",children:a.csrName})]}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Handled by"})]}),(0,b.jsxs)("div",{className:"bg-card rounded-lg p-2 text-center",children:[(0,b.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,b.jsx)(an.Clock,{className:"text-muted-foreground h-3 w-3"}),(0,b.jsx)("span",{className:"text-xs font-medium",children:m(a.duration)})]}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Duration"})]}),(0,b.jsxs)("div",{className:"bg-card rounded-lg p-2 text-center",children:[(0,b.jsx)("div",{className:"flex items-center justify-center gap-1",children:a.issueResolved?(0,b.jsx)("span",{className:"text-success text-xs font-medium",children:"Yes"}):(0,b.jsx)("span",{className:"text-warning text-xs font-medium",children:"No"})}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Resolved"})]})]}),a.topics&&a.topics.length>0&&(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsxs)("div",{className:"mb-1.5 flex items-center gap-1",children:[(0,b.jsx)(ar.Sparkles,{className:"text-primary h-3 w-3"}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs font-medium",children:"Topics Discussed"})]}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:a.topics.map((a,c)=>(0,b.jsx)(B.Badge,{className:"text-[10px]",variant:"secondary",children:a},c))})]}),a.notes&&(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsxs)("div",{className:"mb-1.5 flex items-center gap-1",children:[(0,b.jsx)(K.FileText,{className:"text-muted-foreground h-3 w-3"}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs font-medium",children:"Notes"})]}),(0,b.jsx)("p",{className:"bg-card rounded-lg border p-2 text-xs",children:a.notes})]}),a.followUpScheduled&&!a.issueResolved&&(0,b.jsxs)("div",{className:"bg-warning/10 border-warning/30 flex items-start gap-2 rounded-lg border p-2",children:[(0,b.jsx)(as.AlertTriangle,{className:"text-warning mt-0.5 h-3.5 w-3.5 shrink-0"}),(0,b.jsx)("p",{className:"text-warning text-xs",children:"Follow-up was scheduled for this customer. Check if issue was resolved."})]}),d&&c.length>0&&(0,b.jsxs)(C.Button,{className:"mt-3 w-full gap-1 text-xs",onClick:d,size:"sm",variant:"outline",children:[(0,b.jsx)(e.MessageSquare,{className:"h-3 w-3"}),"View All ",c.length+1," Calls"]})]})]})}function aw({onCreateJob:a,onScheduleAppointment:c,onSendSMS:d,onSendEmail:f,onTakePayment:g,onAddNote:h,onAISuggestion:i,customerEmail:j,customerPhone:k,hasOutstandingBalance:l,outstandingAmount:m,className:n,layout:o="grid"}){let p=[{id:"job",label:"New Job",shortLabel:"Job",icon:(0,b.jsx)(G.Briefcase,{className:"h-4 w-4"}),shortcut:"J",variant:"default",onClick:a,description:"Create a new job for this customer"},{id:"appointment",label:"Schedule",icon:(0,b.jsx)(I.Calendar,{className:"h-4 w-4"}),shortcut:"A",variant:"outline",onClick:c,description:"Schedule an appointment"},{id:"sms",label:"SMS",icon:(0,b.jsx)(e.MessageSquare,{className:"h-4 w-4"}),shortcut:"S",variant:"outline",onClick:d,disabled:!k,description:k?"Send SMS to customer":"No phone number available"},{id:"email",label:"Email",icon:(0,b.jsx)(P.Mail,{className:"h-4 w-4"}),shortcut:"E",variant:"outline",onClick:f,disabled:!j,description:j?"Send email to customer":"No email address available"},{id:"note",label:"Note",icon:(0,b.jsx)(K.FileText,{className:"h-4 w-4"}),shortcut:"N",variant:"outline",onClick:h,description:"Add a note to this call"}];return g&&l&&p.push({id:"payment",label:"Payment",icon:(0,b.jsx)(ae.CreditCard,{className:"h-4 w-4"}),variant:"secondary",onClick:g,badge:m?`$${m.toLocaleString()}`:"Due",description:"Take payment for outstanding balance"}),(0,b.jsx)(D.TooltipProvider,{delayDuration:300,children:(0,b.jsxs)("div",{className:(0,E.cn)("space-y-3",n),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("h4",{className:"text-muted-foreground flex items-center gap-2 text-xs font-semibold tracking-wide uppercase",children:[(0,b.jsx)(S.Plus,{className:"h-3 w-3"}),"Quick Actions"]}),i&&(0,b.jsxs)(C.Button,{className:"h-6 gap-1 px-2 text-xs",onClick:i,size:"sm",variant:"ghost",children:[(0,b.jsx)(ar.Sparkles,{className:"h-3 w-3"}),"AI Suggest"]})]}),(0,b.jsx)("div",{className:{horizontal:"flex flex-wrap items-center gap-2",vertical:"flex flex-col gap-2",grid:"grid grid-cols-3 gap-2"}[o],children:p.map(a=>(0,b.jsxs)(D.Tooltip,{children:[(0,b.jsx)(D.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)(C.Button,{className:(0,E.cn)("relative h-10 gap-2 text-sm","grid"===o&&"w-full flex-col h-auto py-3","vertical"===o&&"w-full justify-start"),disabled:a.disabled,onClick:a.onClick,size:"sm",variant:a.variant||"outline",children:[a.icon,(0,b.jsx)("span",{className:(0,E.cn)("grid"===o&&"text-xs"),children:"horizontal"===o&&a.shortLabel||a.label}),a.badge&&(0,b.jsx)(B.Badge,{className:"absolute -top-1 -right-1 h-5 px-1.5 text-[10px]",variant:"destructive",children:a.badge})]})}),(0,b.jsxs)(D.TooltipContent,{side:"bottom",children:[(0,b.jsx)("p",{children:a.description||a.label}),a.shortcut&&(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Press ",a.shortcut]})]})]},a.id))}),(0,b.jsx)("p",{className:"text-muted-foreground/60 text-center text-[10px]",children:"Press ? to see all shortcuts"})]})})}function ax({customerData:a,isLoading:d,onCreateJob:e,onScheduleAppointment:f,onSendSMS:h,onSendEmail:i,onTakePayment:j,onAddNote:k,previousCall:l}){let m=ab.filter(a=>a.enabled).sort((a,b)=>a.order-b.order),n=a?.invoices.filter(a=>"unpaid"===a.status||"overdue"===a.status).reduce((a,b)=>a+(b.total_amount||0),0)||0,o=a?.jobs.filter(a=>"completed"===a.status).sort((a,b)=>{let c=a.completed_at||a.updated_at||"";return new Date(b.completed_at||b.updated_at||"").getTime()-new Date(c).getTime()})[0]?.completed_at||null;if(d)return(0,b.jsx)("div",{className:"flex h-full items-center justify-center p-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"border-primary mx-auto mb-4 h-12 w-12 animate-spin rounded-full border-4 border-t-transparent"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Loading customer data..."})]})});if(!a)return(0,b.jsx)("div",{className:"flex h-full items-center justify-center p-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(c.AlertCircle,{className:"text-muted-foreground mx-auto mb-4 h-12 w-12"}),(0,b.jsx)("p",{className:"text-foreground font-medium",children:"No customer data"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1 text-sm",children:"Customer information will appear here"})]})});let{customer:p,stats:q,jobs:r,invoices:s,estimates:t,appointments:u,properties:v,equipment:w}=a,x=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a),y=a=>a?new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"N/A",[A,D]=(0,g.useState)(p?.phone?[p.phone]:[""]),[E,F]=(0,g.useState)(p?.email?[p.email]:[""]),ac=async()=>{},ad=[{id:"overview",title:"Customer Overview",icon:(0,b.jsx)(V.User,{className:"h-4 w-4"}),actions:(0,b.jsxs)(C.Button,{className:"h-8 gap-1.5 px-3",onClick:ac,size:"sm",variant:"default",children:[(0,b.jsx)(T.Save,{className:"h-3.5 w-3.5"}),"Save"]}),content:(0,b.jsxs)("div",{className:"space-y-6 p-6",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Basic Information"}),(0,b.jsxs)($.StandardFormRow,{cols:2,children:[(0,b.jsx)($.StandardFormField,{label:"First Name",htmlFor:"firstName",children:(0,b.jsx)(X.Input,{defaultValue:p?.first_name||"",id:"firstName",placeholder:"Enter first name"})}),(0,b.jsx)($.StandardFormField,{label:"Last Name",htmlFor:"lastName",children:(0,b.jsx)(X.Input,{defaultValue:p?.last_name||"",id:"lastName",placeholder:"Enter last name"})})]}),(0,b.jsx)($.StandardFormField,{label:"Company",htmlFor:"company",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(H.Building2,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,b.jsx)(X.Input,{className:"pl-9",defaultValue:p?.company_name||"",id:"company",placeholder:"Enter company name"})]})})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Contact Information"})}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(Y.Label,{children:"Email Addresses"}),E.map((a,c)=>(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(P.Mail,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,b.jsx)(X.Input,{className:"pl-9",onChange:a=>{var b;let d;return b=a.target.value,void((d=[...E])[c]=b,F(d))},placeholder:"email@example.com",type:"email",value:a})]}),E.length>1&&(0,b.jsx)(C.Button,{className:"h-9 w-9",onClick:()=>{F(E.filter((a,b)=>b!==c))},size:"icon",variant:"ghost",children:(0,b.jsx)(z.X,{className:"h-4 w-4"})})]},c)),(0,b.jsxs)(C.Button,{className:"w-full",onClick:()=>F([...E,""]),size:"sm",variant:"outline",children:[(0,b.jsx)(S.Plus,{className:"mr-2 h-4 w-4"}),"Add Email"]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(Y.Label,{children:"Phone Numbers"}),A.map((a,c)=>(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(R.Phone,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,b.jsx)(X.Input,{className:"pl-9",onChange:a=>{var b;let d;return b=a.target.value,void((d=[...A])[c]=b,D(d))},placeholder:"(555) 123-4567",type:"tel",value:a})]}),A.length>1&&(0,b.jsx)(C.Button,{className:"h-9 w-9",onClick:()=>{D(A.filter((a,b)=>b!==c))},size:"icon",variant:"ghost",children:(0,b.jsx)(z.X,{className:"h-4 w-4"})})]},c)),(0,b.jsxs)(C.Button,{className:"w-full",onClick:()=>D([...A,""]),size:"sm",variant:"outline",children:[(0,b.jsx)(S.Plus,{className:"mr-2 h-4 w-4"}),"Add Phone"]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Address"}),(0,b.jsx)($.StandardFormField,{label:"Street Address",htmlFor:"address",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(Q.MapPin,{className:"text-muted-foreground absolute top-3 left-3 h-4 w-4"}),(0,b.jsx)(_.Textarea,{className:"min-h-[60px] pl-9",defaultValue:p?.address||"",id:"address",placeholder:"123 Main Street"})]})}),(0,b.jsxs)($.StandardFormRow,{cols:3,children:[(0,b.jsx)($.StandardFormField,{label:"City",htmlFor:"city",children:(0,b.jsx)(X.Input,{defaultValue:p?.city||"",id:"city",placeholder:"City"})}),(0,b.jsx)($.StandardFormField,{label:"State",htmlFor:"state",children:(0,b.jsx)(X.Input,{defaultValue:p?.state||"",id:"state",placeholder:"State"})}),(0,b.jsx)($.StandardFormField,{label:"ZIP Code",htmlFor:"zipCode",children:(0,b.jsx)(X.Input,{defaultValue:p?.zip_code||"",id:"zipCode",placeholder:"12345"})})]})]}),p&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Enrichment Data"}),(0,b.jsx)($.StandardFormField,{label:"Website",htmlFor:"website",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(L.Globe,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,b.jsx)(X.Input,{className:"pl-9",defaultValue:"",id:"website",placeholder:"https://example.com",type:"url"})]})}),(0,b.jsxs)($.StandardFormRow,{cols:3,children:[(0,b.jsx)($.StandardFormField,{label:"LinkedIn",htmlFor:"linkedin",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(O.default,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,b.jsx)(X.Input,{className:"pl-9",defaultValue:"",id:"linkedin",placeholder:"Profile URL"})]})}),(0,b.jsx)($.StandardFormField,{label:"Twitter",htmlFor:"twitter",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(U.default,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,b.jsx)(X.Input,{className:"pl-9",defaultValue:"",id:"twitter",placeholder:"@username"})]})}),(0,b.jsx)($.StandardFormField,{label:"Facebook",htmlFor:"facebook",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(J.default,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,b.jsx)(X.Input,{className:"pl-9",defaultValue:"",id:"facebook",placeholder:"Profile URL"})]})})]})]})]})},{id:"jobs",title:"Jobs",icon:(0,b.jsx)(G.Briefcase,{className:"h-4 w-4"}),count:r.length,actions:(0,b.jsxs)(C.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,b.jsx)(S.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Link Job"]}),content:r.length>0?(0,b.jsx)("div",{className:"space-y-2 p-6",children:r.map(a=>(0,b.jsxs)("div",{className:"bg-muted/30 rounded-lg border p-3 text-sm",children:[(0,b.jsxs)("div",{className:"mb-1 flex items-start justify-between",children:[(0,b.jsx)("span",{className:"font-medium",children:a.title||"Untitled Job"}),(0,b.jsx)(B.Badge,{className:"text-xs",variant:"outline",children:a.status})]}),(0,b.jsxs)("p",{className:"text-muted-foreground font-mono text-xs",children:["#",a.job_number]}),a.financial?.total_amount&&(0,b.jsx)("p",{className:"mt-1 text-xs",children:x(a.financial.total_amount)})]},a.id))}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 py-12 text-center",children:[(0,b.jsx)(G.Briefcase,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No jobs found"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"This customer has no jobs yet"})]})},{id:"invoices",title:"Invoices",icon:(0,b.jsx)(K.FileText,{className:"h-4 w-4"}),count:s.length,actions:(0,b.jsxs)(C.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,b.jsx)(S.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Link Invoice"]}),content:s.length>0?(0,b.jsx)("div",{className:"space-y-2 p-6",children:s.map(a=>(0,b.jsxs)("div",{className:"bg-muted/30 rounded-lg border p-3 text-sm",children:[(0,b.jsxs)("div",{className:"mb-1 flex items-start justify-between",children:[(0,b.jsxs)("span",{className:"font-medium",children:["Invoice #",a.invoice_number]}),(0,b.jsx)(B.Badge,{className:"text-xs",variant:"paid"===a.status?"default":"unpaid"===a.status?"destructive":"outline",children:a.status})]}),(0,b.jsx)("p",{className:"font-semibold",children:x(a.total_amount||0)}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Due: ",y(a.due_date)]})]},a.id))}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 py-12 text-center",children:[(0,b.jsx)(K.FileText,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No invoices found"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"This customer has no invoices yet"})]})},{id:"appointments",title:"Appointments",icon:(0,b.jsx)(I.Calendar,{className:"h-4 w-4"}),count:u.length,actions:(0,b.jsxs)(C.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,b.jsx)(S.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Schedule"]}),content:u.length>0?(0,b.jsx)("div",{className:"space-y-2 p-6",children:u.map(a=>{let c=a.scheduled_start??a.scheduled_for??a.start_time??a.scheduled_at??null;return(0,b.jsxs)("div",{className:"bg-muted/30 rounded-lg border p-3 text-sm",children:[(0,b.jsxs)("div",{className:"mb-1 flex items-start justify-between",children:[(0,b.jsx)("span",{className:"font-medium",children:a.title||"Appointment"}),(0,b.jsx)(B.Badge,{className:"text-xs",variant:"outline",children:a.status})]}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:c?y(c):"Date to be scheduled"})]},a.id)})}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 py-12 text-center",children:[(0,b.jsx)(I.Calendar,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No appointments"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"No scheduled appointments for this customer"})]})},{id:"properties",title:"Properties",icon:(0,b.jsx)(M.Home,{className:"h-4 w-4"}),count:v.length,actions:(0,b.jsxs)(C.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,b.jsx)(S.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Link Property"]}),content:v.length>0?(0,b.jsx)("div",{className:"space-y-2 p-6",children:v.map(a=>(0,b.jsx)("div",{className:"bg-muted/30 rounded-lg border p-3 text-sm",children:(0,b.jsxs)("div",{className:"mb-1 flex items-start gap-2",children:[(0,b.jsx)(Q.MapPin,{className:"text-muted-foreground mt-0.5 h-4 w-4 shrink-0"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium",children:a.name||"Property"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:a.address})]})]})},a.id))}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 py-12 text-center",children:[(0,b.jsx)(M.Home,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No properties"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"No properties associated with this customer"})]})},{id:"equipment",title:"Equipment",icon:(0,b.jsx)(W.Wrench,{className:"h-4 w-4"}),count:w.length,actions:(0,b.jsxs)(C.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,b.jsx)(S.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Add Equipment"]}),content:w.length>0?(0,b.jsx)("div",{className:"space-y-2 p-6",children:w.map(a=>(0,b.jsxs)("div",{className:"bg-muted/30 rounded-lg border p-3 text-sm",children:[(0,b.jsx)("p",{className:"font-medium",children:a.name||"Equipment"}),a.model&&(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Model: ",a.model]}),a.serial_number&&(0,b.jsxs)("p",{className:"text-muted-foreground font-mono text-xs",children:["S/N: ",a.serial_number]})]},a.id))}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 py-12 text-center",children:[(0,b.jsx)(W.Wrench,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No equipment"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"No equipment associated with this customer"})]})},{id:"notes",title:"Notes",icon:(0,b.jsx)(K.FileText,{className:"h-4 w-4"}),count:+!!p?.notes,actions:(0,b.jsxs)(C.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,b.jsx)(S.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Add Note"]}),content:(0,b.jsx)("div",{className:"space-y-4 p-6",children:p?.notes?(0,b.jsx)("div",{className:"space-y-3",children:(0,b.jsxs)("div",{className:"bg-muted/30 rounded-lg border p-4",children:[(0,b.jsx)("div",{className:"mb-2 flex items-start justify-between",children:(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)("p",{className:"text-sm",children:p.notes})})}),(0,b.jsxs)("div",{className:"text-muted-foreground flex items-center gap-2 text-xs",children:[(0,b.jsx)(V.User,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:"System"}),(0,b.jsx)("span",{children:"â€¢"}),(0,b.jsx)("span",{children:y(p.created_at||new Date().toISOString())})]})]})}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,b.jsx)(K.FileText,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No notes yet"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Add notes about this customer"}),(0,b.jsxs)(C.Button,{className:"mt-4",onClick:()=>{},size:"sm",variant:"outline",children:[(0,b.jsx)(S.Plus,{className:"mr-2 h-4 w-4"}),"Add Note"]})]})})}];return(0,b.jsxs)("div",{className:"flex h-full flex-col",children:[p&&q&&(0,b.jsx)(ao,{stats:q,openBalance:n,lastVisitDate:o}),(0,b.jsx)(Z.ScrollArea,{className:"flex-1",children:(0,b.jsxs)("div",{className:"flex flex-col gap-4 p-4",children:[a&&q&&(0,b.jsx)(ak,{customerData:a,stats:q,onTakePayment:j}),(0,b.jsx)(av,{lastCall:l??null}),(0,b.jsx)("section",{className:"border-border/60 bg-card overflow-hidden rounded-xl border p-4 shadow-sm",children:(0,b.jsx)(aw,{onCreateJob:e||(()=>{}),onScheduleAppointment:f||(()=>{}),onSendSMS:h||(()=>{}),onSendEmail:i||(()=>{}),onTakePayment:j,onAddNote:k||(()=>{}),customerEmail:p?.email,customerPhone:p?.phone,hasOutstandingBalance:n>0,outstandingAmount:n,layout:"grid"})}),m.length>0&&(0,b.jsx)("section",{className:"border-primary/20 bg-primary/5 overflow-hidden rounded-xl border shadow-sm",children:(0,b.jsxs)("div",{className:"flex items-start gap-3 p-4",children:[(0,b.jsx)("div",{className:"bg-primary/10 rounded-full p-2",children:(0,b.jsx)(N.Lightbulb,{className:"text-primary h-4 w-4"})}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)("h3",{className:"text-foreground text-sm font-semibold",children:"Call Reminders"}),(0,b.jsx)("ul",{className:"text-muted-foreground space-y-1.5 text-xs",children:m.map(a=>(0,b.jsxs)("li",{className:"flex items-start gap-2",children:[(0,b.jsx)("span",{className:"text-primary mt-0.5",children:"â€¢"}),(0,b.jsx)("span",{children:a.text})]},a.id))})]})]})}),p&&(0,b.jsx)("section",{className:"border-border/60 bg-card overflow-hidden rounded-xl border p-4 shadow-sm",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h4",{className:"text-muted-foreground text-xs font-semibold tracking-wide uppercase",children:"Customer Tags"}),(0,b.jsxs)(C.Button,{className:"h-6 px-2 text-xs",onClick:()=>{},size:"sm",variant:"ghost",children:[(0,b.jsx)(S.Plus,{className:"mr-1 h-3 w-3"}),"Add"]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-1.5",children:[(0,b.jsx)(B.Badge,{className:"text-xs",variant:"secondary",children:"VIP"}),(0,b.jsx)(B.Badge,{className:"text-xs",variant:"secondary",children:"Recurring"}),(0,b.jsxs)(B.Badge,{className:"hover:bg-muted cursor-pointer text-xs",variant:"outline",children:[(0,b.jsx)(S.Plus,{className:"mr-1 h-3 w-3"}),"Add Tag"]})]})]})}),(0,b.jsx)("section",{className:"border-border/60 bg-card overflow-hidden rounded-xl border shadow-sm",children:(0,b.jsx)("div",{className:"flex flex-col gap-4 p-0",children:(0,b.jsx)(aa.UnifiedAccordion,{defaultOpenSection:null,enableReordering:!1,sections:ad,storageKey:"call-window-customer-sidebar"})})})]})})]})}var ay=a.i(779184),az=a.i(337850),aA=a.i(198803),aB=a.i(101482),aC=(0,h.createServerReference)("60d61fe4e8976bdfeff5cf3386134c7b4b7b4f4bd0",h.callServer,void 0,h.findSourceMapURL,"getTechnicianSchedules");function aD({appointments:a,workingHours:c,technicianColor:d,currentTime:e=new Date}){let f,{start:g,end:h}=c,i=h-g,j=a=>new Date(a).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),k=Array.from({length:i+1},(a,b)=>g+b),l=(f=e.getHours()+e.getMinutes()/60)<g?0:f>h?100:(f-g)/i*100;return(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"bg-muted/20 relative h-24 rounded-lg border p-2",children:[(0,b.jsx)("div",{className:"absolute inset-x-2 top-1 flex justify-between",children:k.map(a=>(0,b.jsx)("div",{className:"flex flex-col items-center",children:(0,b.jsxs)("span",{className:"text-muted-foreground text-[9px]",children:[a>12?a-12:0===a?12:a,a>=12?"p":"a"]})},a))}),(0,b.jsxs)("div",{className:"bg-card relative mt-6 h-12 rounded border",children:[a.map(a=>{let c,e,f,h,k,l=(c=new Date(a.scheduled_start),e=new Date(a.scheduled_end),f=c.getHours()+c.getMinutes()/60,h=e.getHours()+e.getMinutes()/60,k=(f-g)/i*100,{left:`${Math.max(0,k)}%`,width:`${Math.min(100-Math.max(0,k),(h-f)/i*100)}%`}),m=(a=>{switch(a){case"in_progress":return"bg-warning/80 border-warning";case"completed":return"bg-success/80 border-success";case"cancelled":return"bg-destructive/80 border-destructive";default:return`${d}/80 border-${d.replace("bg-","")}`}})(a.status);return(0,b.jsx)("div",{className:(0,E.cn)("absolute top-1 h-10 rounded border-2 p-1 transition-all hover:z-10 hover:scale-105",m,"in_progress"===a.status&&"animate-pulse"),style:l,title:`${a.customer_name} â€¢ ${j(a.scheduled_start)} - ${j(a.scheduled_end)}`,children:(0,b.jsxs)("div",{className:"flex h-full flex-col justify-center overflow-hidden px-1",children:[(0,b.jsx)("p",{className:"truncate text-[10px] leading-tight font-medium text-white",children:a.customer_name}),a.assigned_technicians.length>1&&(0,b.jsxs)("div",{className:"flex items-center gap-0.5 text-white/80",children:[(0,b.jsx)(aB.Users,{className:"h-2.5 w-2.5"}),(0,b.jsx)("span",{className:"text-[8px]",children:a.assigned_technicians.length})]})]})},a.id)}),l>0&&l<100&&(0,b.jsx)("div",{className:"absolute top-0 h-full w-0.5 bg-blue-500 shadow-lg",style:{left:`${l}%`},children:(0,b.jsx)("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2",children:(0,b.jsxs)("div",{className:"flex items-center gap-1 rounded bg-blue-500 px-1.5 py-0.5 text-white shadow-lg",children:[(0,b.jsx)(an.Clock,{className:"h-2.5 w-2.5"}),(0,b.jsx)("span",{className:"text-[9px] font-medium",children:e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})})]})})})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-[10px]",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("div",{className:(0,E.cn)("h-2 w-2 rounded",d)}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Scheduled"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("div",{className:"bg-warning h-2 w-2 rounded"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"In Progress"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("div",{className:"bg-success h-2 w-2 rounded"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Completed"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("div",{className:"h-2 w-2 rounded border-2 border-blue-500 bg-blue-500"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Current Time"})]})]})]})}function aE({className:a,companyId:d}){let e,h=(0,f.useRouter)(),[i,j]=(0,g.useState)(new Date),[k,l]=(0,g.useState)(null),[m,n]=(0,g.useState)([]),[o,p]=(0,g.useState)(!0),[q,r]=(0,g.useState)(null),[s,t]=(0,g.useState)(new Date);if((0,g.useEffect)(()=>{let a=setInterval(()=>{t(new Date)},6e4);return()=>clearInterval(a)},[]),(0,g.useEffect)(()=>{!async function(){if(!d){r("No company ID provided"),p(!1);return}p(!0),r(null);try{let a=await aC(i,d);n(a)}catch(a){r("Failed to load schedules")}finally{p(!1)}}()},[i,d]),o)return(0,b.jsx)("div",{className:(0,E.cn)("flex h-full items-center justify-center",a),children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(aA.Loader2,{className:"text-primary mx-auto mb-4 h-8 w-8 animate-spin"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Loading schedules..."})]})});if(q)return(0,b.jsx)("div",{className:(0,E.cn)("flex h-full items-center justify-center",a),children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(c.AlertCircle,{className:"text-destructive mx-auto mb-4 h-8 w-8"}),(0,b.jsx)("p",{className:"text-sm font-medium",children:q}),(0,b.jsx)(C.Button,{className:"mt-4",onClick:()=>h.refresh(),size:"sm",variant:"outline",children:"Retry"})]})});let u=a=>new Date(a).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),v=a=>{let b=new Date(i);b.setDate(b.getDate()+a),j(b)},w=k?m.filter(a=>a.id===k):m,x=m.reduce((a,b)=>a+b.appointments.length,0),y=w.map(a=>({id:a.id,title:a.name,icon:(0,b.jsxs)(A.Avatar,{className:"h-5 w-5",children:[(0,b.jsx)(A.AvatarImage,{src:a.avatar_url}),(0,b.jsx)(A.AvatarFallback,{className:(0,E.cn)("text-[10px] text-white",a.color),children:a.name.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2)})]}),count:a.appointments.length,actions:(0,b.jsx)(B.Badge,{className:"text-[10px]",variant:"secondary",children:a.role.replace("_"," ")}),content:(0,b.jsxs)("div",{className:"space-y-4 p-4",children:[(0,b.jsx)(aD,{appointments:a.appointments,currentTime:s,technicianColor:a.color,workingHours:a.working_hours}),a.appointments.length>0?(0,b.jsx)("div",{className:"space-y-3",children:a.appointments.map(a=>(0,b.jsxs)("div",{className:"bg-card hover:bg-muted/50 rounded-lg border p-4 transition-colors",children:[(0,b.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(an.Clock,{className:"text-muted-foreground h-4 w-4"}),(0,b.jsxs)("span",{className:"text-sm font-semibold",children:[u(a.scheduled_start)," -"," ",u(a.scheduled_end)]}),(0,b.jsxs)(B.Badge,{className:"text-[10px]",variant:"secondary",children:[a.duration_hours,"h window"]})]}),(a=>{switch(a){case"completed":return(0,b.jsx)(B.Badge,{className:"border-success/50 bg-success/10 text-success text-[10px]",variant:"outline",children:"Completed"});case"in_progress":return(0,b.jsx)(B.Badge,{className:"border-warning/50 bg-warning/10 text-warning text-[10px]",variant:"outline",children:"In Progress"});case"cancelled":return(0,b.jsx)(B.Badge,{className:"border-destructive/50 bg-destructive/10 text-destructive text-[10px]",variant:"outline",children:"Cancelled"});default:return(0,b.jsx)(B.Badge,{className:"text-[10px]",variant:"outline",children:"Scheduled"})}})(a.status)]}),(0,b.jsxs)("div",{className:"mb-3 space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(V.User,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:a.customer_name})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(Q.MapPin,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,b.jsxs)("span",{className:"text-muted-foreground text-xs",children:[a.address,", ",a.city,","," ",a.state]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(B.Badge,{className:"text-xs",variant:"outline",children:a.job_type}),(0,b.jsxs)("span",{className:"text-muted-foreground font-mono text-xs",children:["#",a.job_number]})]})]}),a.assigned_technicians.length>1&&(0,b.jsx)("div",{className:"border-t pt-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aB.Users,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"Team:"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:a.assigned_technicians.map(a=>(0,b.jsxs)(B.Badge,{className:"text-[10px]",variant:a.is_lead?"default":"secondary",children:[a.name,a.is_lead&&" (Lead)"]},a.id))})]})})]},a.id))}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,b.jsx)(I.Calendar,{className:"text-muted-foreground mb-3 h-10 w-10"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No appointments today"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"This technician is available"})]})]})}));return(0,b.jsxs)("div",{className:(0,E.cn)("flex h-full flex-col",a),children:[(0,b.jsxs)("div",{className:"bg-card/50 space-y-3 border-b p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(C.Button,{className:"h-8 w-8",onClick:()=>v(-1),size:"icon",variant:"ghost",children:(0,b.jsx)(ay.ChevronLeft,{className:"h-4 w-4"})}),(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(I.Calendar,{className:"text-muted-foreground h-4 w-4"}),(0,b.jsx)("span",{className:"text-sm font-semibold",children:i.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]}),(e=new Date,i.getDate()===e.getDate()&&i.getMonth()===e.getMonth()&&i.getFullYear()===e.getFullYear()&&(0,b.jsx)(B.Badge,{className:"mt-1 text-[10px]",variant:"secondary",children:"Today"}))]}),(0,b.jsx)(C.Button,{className:"h-8 w-8",onClick:()=>v(1),size:"icon",variant:"ghost",children:(0,b.jsx)(az.ChevronRight,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsxs)("div",{className:"bg-muted/30 flex items-center gap-2 rounded-lg border px-3 py-1.5",children:[(0,b.jsx)(aB.Users,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,b.jsxs)("span",{className:"text-muted-foreground text-xs",children:[w.length," Techs"]}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"â€¢"}),(0,b.jsxs)("span",{className:"text-xs font-medium",children:[x," Appointments"]})]}),(0,b.jsx)(C.Button,{className:"h-7 gap-1.5 px-2 text-xs",onClick:()=>l(null),size:"sm",variant:"outline",children:k?"Show All":"All Techs"})]})]}),(0,b.jsx)(Z.ScrollArea,{className:"flex-1",children:(0,b.jsx)("div",{className:"p-4",children:(0,b.jsx)("section",{className:"border-border/60 bg-card overflow-hidden rounded-xl border shadow-sm",children:(0,b.jsx)("div",{className:"flex flex-col gap-4 p-0",children:(0,b.jsx)(aa.UnifiedAccordion,{defaultOpenSection:y[0]?.id,enableReordering:!1,sections:y,storageKey:"csr-schedule-technicians"})})})})}),(0,b.jsx)("div",{className:"bg-card/50 border-t p-3",children:(0,b.jsxs)(C.Button,{className:"w-full gap-2 text-xs",onClick:()=>{},size:"sm",variant:"default",children:[(0,b.jsx)(S.Plus,{className:"h-3.5 w-3.5"}),"Book New Appointment"]})})]})}var aF=a.i(96250);a.i(21368);var aG=a.i(341903);a.i(19256);var aH=a.i(417132);a.i(40744);var aI=a.i(419573);let aJ=[{value:"resolved",label:"Issue Resolved",icon:(0,b.jsx)(aF.CheckCircle2,{className:"h-4 w-4"}),color:"text-success"},{value:"appointment_booked",label:"Appointment Booked",icon:(0,b.jsx)(I.Calendar,{className:"h-4 w-4"}),color:"text-primary"},{value:"quote_provided",label:"Quote Provided",icon:(0,b.jsx)(K.FileText,{className:"h-4 w-4"}),color:"text-primary"},{value:"payment_taken",label:"Payment Taken",icon:(0,b.jsx)(aF.CheckCircle2,{className:"h-4 w-4"}),color:"text-success"},{value:"callback_scheduled",label:"Callback Scheduled",icon:(0,b.jsx)(R.Phone,{className:"h-4 w-4"}),color:"text-warning"},{value:"escalated",label:"Escalated to Manager",icon:(0,b.jsx)(as.AlertTriangle,{className:"h-4 w-4"}),color:"text-orange-500"},{value:"transferred",label:"Transferred",icon:(0,b.jsx)(R.Phone,{className:"h-4 w-4"}),color:"text-muted-foreground"},{value:"voicemail_left",label:"Left Voicemail",icon:(0,b.jsx)(e.MessageSquare,{className:"h-4 w-4"}),color:"text-muted-foreground"},{value:"customer_hung_up",label:"Customer Hung Up",icon:(0,b.jsx)(q.PhoneOff,{className:"h-4 w-4"}),color:"text-muted-foreground"},{value:"wrong_number",label:"Wrong Number",icon:(0,b.jsx)(z.X,{className:"h-4 w-4"}),color:"text-muted-foreground"},{value:"spam",label:"Spam/Unwanted",icon:(0,b.jsx)(as.AlertTriangle,{className:"h-4 w-4"}),color:"text-destructive"},{value:"other",label:"Other",icon:(0,b.jsx)(K.FileText,{className:"h-4 w-4"}),color:"text-muted-foreground"}],aK=[{value:"callback",label:"Callback",icon:(0,b.jsx)(R.Phone,{className:"h-4 w-4"})},{value:"email",label:"Email",icon:(0,b.jsx)(P.Mail,{className:"h-4 w-4"})},{value:"sms",label:"SMS",icon:(0,b.jsx)(e.MessageSquare,{className:"h-4 w-4"})},{value:"appointment",label:"Appointment",icon:(0,b.jsx)(I.Calendar,{className:"h-4 w-4"})}];function aL({open:a,onOpenChange:c,onComplete:d,onCancel:e,callDuration:f,customerName:h,customerEmail:i,existingNotes:j="",isSubmitting:k=!1}){let l,[m,n]=(0,g.useState)(""),[o,p]=(0,g.useState)(j),[r,s]=(0,g.useState)(!1),[t,u]=(0,g.useState)("callback"),[v,w]=(0,g.useState)(!1),[x,y]=(0,g.useState)(!1),z=f>120,A=""!==m&&(!z||o.trim().length>0),D=(0,g.useCallback)(()=>{A&&m&&d({disposition:m,notes:o.trim(),followUp:{enabled:r,type:t},sendConfirmation:v,createJob:x})},[A,m,o,r,t,v,x,d]);return(0,g.useEffect)(()=>{a&&(n(""),p(j),s(!1),u("callback"),w(!1),y(!1))},[a,j]),(0,g.useEffect)(()=>{let b=b=>{a&&"Enter"===b.key&&(b.ctrlKey||b.metaKey)&&A&&(b.preventDefault(),D())};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[a,A,D]),(0,b.jsx)(aH.Dialog,{onOpenChange:c,open:a,children:(0,b.jsxs)(aH.DialogContent,{className:"max-w-lg",children:[(0,b.jsxs)(aH.DialogHeader,{children:[(0,b.jsxs)(aH.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(q.PhoneOff,{className:"text-destructive h-5 w-5"}),"Wrap Up Call"]}),(0,b.jsxs)(aH.DialogDescription,{className:"flex items-center gap-4",children:[(0,b.jsx)("span",{children:"Complete this form before ending the call with"}),(0,b.jsx)(B.Badge,{variant:"outline",children:h})]})]}),(0,b.jsxs)("div",{className:"bg-muted/50 flex items-center justify-between rounded-lg border p-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(an.Clock,{className:"text-muted-foreground h-4 w-4"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Call Duration"})]}),(0,b.jsx)(B.Badge,{variant:"secondary",className:"font-mono",children:(l=Math.floor(f/60),`${l}:${(f%60).toString().padStart(2,"0")}`)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(Y.Label,{className:"flex items-center gap-1",children:["Call Disposition",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsxs)(aI.Select,{value:m,onValueChange:a=>n(a),children:[(0,b.jsx)(aI.SelectTrigger,{className:(0,E.cn)(!m&&"border-destructive/50"),children:(0,b.jsx)(aI.SelectValue,{placeholder:"Select outcome..."})}),(0,b.jsx)(aI.SelectContent,{children:aJ.map(a=>(0,b.jsx)(aI.SelectItem,{value:a.value,children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:a.color,children:a.icon}),(0,b.jsx)("span",{children:a.label})]})},a.value))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(Y.Label,{className:"flex items-center gap-1",children:["Call Notes",z&&(0,b.jsx)("span",{className:"text-destructive",children:"*"}),!z&&(0,b.jsx)("span",{className:"text-muted-foreground text-xs ml-1",children:"(optional for short calls)"})]}),(0,b.jsx)(_.Textarea,{className:(0,E.cn)("min-h-[100px] resize-none",z&&!o.trim()&&"border-destructive/50"),placeholder:"Summarize the call, customer's issue, and resolution...",value:o,onChange:a=>p(a.target.value)}),z&&!o.trim()&&(0,b.jsxs)("p",{className:"text-destructive text-xs flex items-center gap-1",children:[(0,b.jsx)(as.AlertTriangle,{className:"h-3 w-3"}),"Notes required for calls over 2 minutes"]})]}),(0,b.jsxs)("div",{className:"space-y-3 rounded-lg border p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aG.Checkbox,{id:"followUp",checked:r,onCheckedChange:a=>s(a)}),(0,b.jsx)(Y.Label,{htmlFor:"followUp",className:"text-sm font-medium cursor-pointer",children:"Schedule Follow-up"})]}),r&&(0,b.jsxs)(aI.Select,{value:t,onValueChange:a=>u(a),children:[(0,b.jsx)(aI.SelectTrigger,{className:"w-[140px] h-8",children:(0,b.jsx)(aI.SelectValue,{})}),(0,b.jsx)(aI.SelectContent,{children:aK.map(a=>(0,b.jsx)(aI.SelectItem,{value:a.value,children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[a.icon,(0,b.jsx)("span",{children:a.label})]})},a.value))})]})]}),i&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aG.Checkbox,{id:"sendConfirmation",checked:v,onCheckedChange:a=>w(a)}),(0,b.jsxs)(Y.Label,{htmlFor:"sendConfirmation",className:"text-sm cursor-pointer flex items-center gap-1",children:[(0,b.jsx)(P.Mail,{className:"h-3.5 w-3.5"}),"Send confirmation email"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aG.Checkbox,{id:"createJob",checked:x,onCheckedChange:a=>y(a)}),(0,b.jsxs)(Y.Label,{htmlFor:"createJob",className:"text-sm cursor-pointer flex items-center gap-1",children:[(0,b.jsx)(S.Plus,{className:"h-3.5 w-3.5"}),"Create job from this call"]})]})]}),(0,b.jsxs)(aH.DialogFooter,{className:"gap-2 sm:gap-0",children:[(0,b.jsx)(C.Button,{variant:"outline",onClick:e,disabled:k,children:"Continue Call"}),(0,b.jsx)(C.Button,{variant:"destructive",onClick:D,disabled:!A||k,className:"gap-2",children:k?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aA.Loader2,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.PhoneOff,{className:"h-4 w-4"}),"End Call"]})})]}),(0,b.jsxs)("p",{className:"text-muted-foreground text-center text-xs",children:["Press"," ",(0,b.jsx)("kbd",{className:"bg-muted rounded px-1.5 py-0.5 font-mono",children:"Ctrl+Enter"})," ","to complete"]})]})})}var t=t;let aM=[{title:"Call Controls",shortcuts:[{keys:["M"],description:"Toggle mute/unmute",icon:(0,b.jsx)(n.Mic,{className:"h-3.5 w-3.5"})},{keys:["H"],description:"Toggle hold/resume",icon:(0,b.jsx)(p.Pause,{className:"h-3.5 w-3.5"})},{keys:["R"],description:"Toggle recording",icon:(0,b.jsx)(t.default,{className:"h-3.5 w-3.5"})},{keys:["T"],description:"Transfer call",icon:(0,b.jsx)(R.Phone,{className:"h-3.5 w-3.5"})},{keys:["Shift","E"],description:"End call",icon:(0,b.jsx)(q.PhoneOff,{className:"h-3.5 w-3.5"}),destructive:!0}]},{title:"Quick Actions",shortcuts:[{keys:["J"],description:"Create new job",icon:(0,b.jsx)(S.Plus,{className:"h-3.5 w-3.5"})},{keys:["A"],description:"Schedule appointment",icon:(0,b.jsx)(I.Calendar,{className:"h-3.5 w-3.5"})},{keys:["N"],description:"Focus notes field",icon:(0,b.jsx)(K.FileText,{className:"h-3.5 w-3.5"})},{keys:["S"],description:"Send SMS to customer"},{keys:["E"],description:"Send email to customer"}]},{title:"Navigation",shortcuts:[{keys:["1"],description:"View transcript panel"},{keys:["2"],description:"View schedule panel"},{keys:["Tab"],description:"Cycle through sections"},{keys:["Esc"],description:"Close dialogs/minimize"}]},{title:"General",shortcuts:[{keys:["?"],description:"Show this help panel",icon:(0,b.jsx)(m.Keyboard,{className:"h-3.5 w-3.5"})},{keys:["Ctrl","S"],description:"Save notes"},{keys:["Ctrl","C"],description:"Copy selected text"}]}];function aN({open:a,onOpenChange:c}){return(0,g.useEffect)(()=>{let b=b=>{"Escape"===b.key&&a&&c(!1)};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[a,c]),(0,b.jsx)(aH.Dialog,{onOpenChange:c,open:a,children:(0,b.jsxs)(aH.DialogContent,{className:"max-h-[85vh] max-w-2xl overflow-y-auto",children:[(0,b.jsxs)(aH.DialogHeader,{children:[(0,b.jsxs)(aH.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(m.Keyboard,{className:"h-5 w-5"}),"Keyboard Shortcuts"]}),(0,b.jsxs)(aH.DialogDescription,{children:["Use these shortcuts for faster call handling. Press"," ",(0,b.jsx)("kbd",{className:"bg-muted rounded px-1.5 py-0.5 font-mono text-xs",children:"?"})," ","anytime to show this panel."]})]}),(0,b.jsx)("div",{className:"mt-4 grid grid-cols-2 gap-6",children:aM.map(a=>(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold",children:a.title}),(0,b.jsx)("div",{className:"space-y-2",children:a.shortcuts.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-lg border p-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[a.icon&&(0,b.jsx)("span",{className:(0,E.cn)("text-muted-foreground",a.destructive&&"text-destructive"),children:a.icon}),(0,b.jsx)("span",{className:(0,E.cn)("text-sm",a.destructive&&"text-destructive"),children:a.description})]}),(0,b.jsx)("div",{className:"flex items-center gap-1",children:a.keys.map((c,d)=>(0,b.jsxs)("span",{children:[(0,b.jsx)("kbd",{className:(0,E.cn)("bg-muted inline-flex min-w-[24px] items-center justify-center rounded px-1.5 py-0.5 font-mono text-xs",a.destructive&&"bg-destructive/10 text-destructive"),children:c}),d<a.keys.length-1&&(0,b.jsx)("span",{className:"text-muted-foreground mx-0.5 text-xs",children:"+"})]},d))})]},c))})]},a.title))}),(0,b.jsx)("div",{className:"bg-muted/50 mt-6 rounded-lg border p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"bg-primary/10 rounded-full p-2",children:(0,b.jsx)(m.Keyboard,{className:"text-primary h-4 w-4"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-sm font-medium",children:"Pro Tips"}),(0,b.jsxs)("ul",{className:"text-muted-foreground mt-1 space-y-1 text-xs",children:[(0,b.jsx)("li",{children:"â€¢ Shortcuts only work when the call window is focused"}),(0,b.jsxs)("li",{children:["â€¢ Use"," ",(0,b.jsx)("kbd",{className:"bg-muted rounded px-1 font-mono",children:"Shift+E"})," ","for end call to prevent accidental hangups"]}),(0,b.jsxs)("li",{children:["â€¢ Press"," ",(0,b.jsx)("kbd",{className:"bg-muted rounded px-1 font-mono",children:"N"})," to quickly add notes during a call"]}),(0,b.jsx)("li",{children:"â€¢ The mute indicator turns red when you're muted"})]})]})]})})]})})}var aO=a.i(90083),aP=a.i(546949),aP=aP;a.i(246840);var aQ=a.i(273765),aR=a.i(24872);a.i(821278).Zap,I.Calendar,ae.CreditCard,aP.default,aR.UserCog,e.MessageSquare,R.Phone,G.Briefcase,aQ.ThumbsDown,aF.CheckCircle2;var aS=a.i(74342),aS=aS,aT=a.i(139956),aT=aT,aU=a.i(13378),aV=a.i(688014);aU.Smile,aT.default,aS.default,aV.TrendingUp,aO.ArrowRight,ai.TrendingDown,a.i(638446);var aW=a.i(988253),aX=a.i(274956),aY=a.i(414379);R.Phone,P.Mail,Q.MapPin,V.User,I.Calendar,an.Clock,aX.DollarSign,W.Wrench,aY.Tag,aY.Tag,a.i(903935),a.i(560857),a.i(956852),a.i(90125),a.i(129112);var aZ=a.i(256003);function a$({className:a}){return(0,b.jsx)("div",{className:(0,E.cn)("bg-card/80 sticky top-0 z-10 border-b backdrop-blur-sm",a),children:(0,b.jsx)("div",{className:"grid grid-cols-5 divide-x",children:Array.from({length:5}).map((a,c)=>(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center gap-1.5 p-3",children:[(0,b.jsx)(aZ.Skeleton,{className:"h-4 w-12"}),(0,b.jsx)(aZ.Skeleton,{className:"h-3 w-8"})]},c))})})}function a_({className:a}){return(0,b.jsx)("div",{className:(0,E.cn)("space-y-2",a),children:(0,b.jsxs)("div",{className:"flex items-start gap-3 rounded-lg border bg-muted/20 p-3",children:[(0,b.jsx)(aZ.Skeleton,{className:"h-8 w-8 rounded-full"}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)(aZ.Skeleton,{className:"h-4 w-32"}),(0,b.jsx)(aZ.Skeleton,{className:"h-3 w-48"})]})]})})}function a0({className:a}){return(0,b.jsxs)("div",{className:(0,E.cn)("space-y-3",a),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(aZ.Skeleton,{className:"h-4 w-24"}),(0,b.jsx)(aZ.Skeleton,{className:"h-6 w-16"})]}),(0,b.jsx)("div",{className:"grid grid-cols-3 gap-2",children:Array.from({length:6}).map((a,c)=>(0,b.jsx)(aZ.Skeleton,{className:"h-16 rounded-lg"},c))})]})}function a1({className:a}){return(0,b.jsx)("div",{className:(0,E.cn)("rounded-xl border bg-muted/30 p-4",a),children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(aZ.Skeleton,{className:"h-10 w-10 rounded-full"}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)(aZ.Skeleton,{className:"h-4 w-24"}),(0,b.jsx)(aZ.Skeleton,{className:"h-3 w-32"})]}),(0,b.jsx)(aZ.Skeleton,{className:"h-5 w-16 rounded-full"})]})})}function a2({className:a}){return(0,b.jsxs)("div",{className:(0,E.cn)("rounded-xl border bg-card",a),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aZ.Skeleton,{className:"h-4 w-4"}),(0,b.jsx)(aZ.Skeleton,{className:"h-4 w-28"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aZ.Skeleton,{className:"h-8 w-8 rounded"}),(0,b.jsx)(aZ.Skeleton,{className:"h-8 w-8 rounded"})]})]}),(0,b.jsx)("div",{className:"border-b p-3",children:(0,b.jsx)(aZ.Skeleton,{className:"h-9 w-full rounded"})}),(0,b.jsx)("div",{className:"space-y-3 p-4",children:Array.from({length:4}).map((a,c)=>(0,b.jsxs)("div",{className:(0,E.cn)("rounded-lg border p-3",c%2==0?"ml-0 mr-8":"ml-8 mr-0"),children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,b.jsx)(aZ.Skeleton,{className:"h-3 w-12"}),(0,b.jsx)(aZ.Skeleton,{className:"h-3 w-16"})]}),(0,b.jsx)(aZ.Skeleton,{className:"h-4 w-full"}),(0,b.jsx)(aZ.Skeleton,{className:"mt-1 h-4 w-3/4"})]},c))})]})}function a3({className:a}){return(0,b.jsxs)("div",{className:(0,E.cn)("flex h-full flex-col",a),children:[(0,b.jsx)(a$,{}),(0,b.jsxs)("div",{className:"flex-1 space-y-4 overflow-hidden p-4",children:[(0,b.jsx)(a_,{}),(0,b.jsx)(a1,{}),(0,b.jsx)("div",{className:"rounded-xl border bg-card p-4",children:(0,b.jsx)(a0,{})}),(0,b.jsx)("div",{className:"rounded-xl border bg-card p-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(aZ.Skeleton,{className:"h-4 w-24"}),(0,b.jsxs)("div",{className:"flex gap-1.5",children:[(0,b.jsx)(aZ.Skeleton,{className:"h-6 w-12 rounded-full"}),(0,b.jsx)(aZ.Skeleton,{className:"h-6 w-16 rounded-full"}),(0,b.jsx)(aZ.Skeleton,{className:"h-6 w-14 rounded-full"})]})]})})]})]})}function a4(){return(0,b.jsxs)("div",{className:"flex h-screen flex-col bg-background",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between border-b px-6 py-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(aZ.Skeleton,{className:"h-11 w-11 rounded-full"}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(aZ.Skeleton,{className:"h-4 w-32"}),(0,b.jsx)(aZ.Skeleton,{className:"h-3 w-24"})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:Array.from({length:6}).map((a,c)=>(0,b.jsx)(aZ.Skeleton,{className:"h-10 w-10 rounded-full"},c))}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aZ.Skeleton,{className:"h-6 w-20 rounded-full"}),(0,b.jsx)(aZ.Skeleton,{className:"h-8 w-8 rounded"})]})]}),(0,b.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,b.jsx)("div",{className:"flex w-[35%] flex-col border-r",children:(0,b.jsx)(a2,{className:"flex-1"})}),(0,b.jsx)("div",{className:"w-[65%]",children:(0,b.jsx)(a3,{className:"h-full"})})]})]})}var a5=a.i(909637),a6=a.i(187056),a7=a.i(50900),a8=a.i(527228),a9=a.i(140596);let ba={entries:[],isRecording:!1,currentSpeaker:null,searchQuery:"",filteredEntries:[]},bb=(0,a8.create)()((0,a9.devtools)((a,b)=>({...ba,addEntry:b=>{let c={...b,id:`transcript-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),isAnalyzing:!1};a(a=>{let b=[...a.entries,c];return{entries:b,filteredEntries:a.searchQuery?b.filter(b=>b.text.toLowerCase().includes(a.searchQuery.toLowerCase())):b}})},updateEntry:(b,c)=>{a(a=>{let d=a.entries.map(a=>a.id===b?{...a,...c}:a);return{entries:d,filteredEntries:a.searchQuery?d.filter(b=>b.text.toLowerCase().includes(a.searchQuery.toLowerCase())):d}})},markAsAnalyzing:a=>{b().updateEntry(a,{isAnalyzing:!0})},markAsAnalyzed:(a,c)=>{b().updateEntry(a,{isAnalyzing:!1,aiExtracted:c})},setCurrentSpeaker:b=>a({currentSpeaker:b}),setSearchQuery:b=>{a(a=>({searchQuery:b,filteredEntries:b?a.entries.filter(a=>a.text.toLowerCase().includes(b.toLowerCase())):a.entries}))},startRecording:()=>a({isRecording:!0}),stopRecording:()=>a({isRecording:!1}),clearTranscript:()=>a(ba),exportTranscript:()=>{let{entries:a}=b();return JSON.stringify(a.map(a=>({speaker:a.speaker,text:a.text,timestamp:new Date(a.timestamp).toISOString(),aiExtracted:a.aiExtracted})),null,2)},getFullTranscript:()=>{let{entries:a}=b();return a.map(a=>{let b=new Date(a.timestamp).toLocaleTimeString(),c="csr"===a.speaker?"CSR":"Customer";return`[${b}] ${c}: ${a.text}`}).join("\n")}}),{name:"TranscriptStore"}));function bc(){let a=bb(a=>a.filteredEntries.length>0?a.filteredEntries:a.entries),c=bb(a=>a.searchQuery),d=bb(a=>a.setSearchQuery),f=bb(a=>a.isRecording),h=bb(a=>a.exportTranscript),i=bb(a=>a.getFullTranscript),[j,k]=(0,g.useState)(!0),l=(0,g.useRef)(null);(0,g.useEffect)(()=>{j&&l.current&&(l.current.scrollTop=l.current.scrollHeight)},[j]);let m=async()=>{let a=i();await navigator.clipboard.writeText(a)},n=[{id:"transcript",title:"Live Transcript",icon:(0,b.jsx)(e.MessageSquare,{className:"h-4 w-4"}),count:a.length,actions:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[f&&(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)("div",{className:"bg-destructive size-2 animate-pulse rounded-full"}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"Recording"})]}),(0,b.jsx)(C.Button,{className:"h-8 px-2",onClick:m,size:"sm",title:"Copy transcript",variant:"ghost",children:(0,b.jsx)(aW.Copy,{className:"size-3.5"})}),(0,b.jsx)(C.Button,{className:"h-8 px-2",onClick:()=>{let a=new Blob([h()],{type:"application/json"}),b=URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download=`transcript-${new Date().toISOString()}.json`,c.click(),URL.revokeObjectURL(b)},size:"sm",title:"Export transcript",variant:"ghost",children:(0,b.jsx)(a6.Download,{className:"size-3.5"})})]}),content:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("div",{className:"border-border border-b p-3",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(a7.Search,{className:"text-muted-foreground absolute top-1/2 left-3 size-4 -translate-y-1/2"}),(0,b.jsx)(X.Input,{className:"bg-card h-9 pl-9 text-sm",onChange:a=>d(a.target.value),placeholder:"Search transcript...",type:"text",value:c})]})}),(0,b.jsx)("div",{className:"h-[calc(100vh-28rem)] space-y-3 overflow-y-auto p-4",onScroll:()=>{if(l.current){let{scrollTop:a,scrollHeight:b,clientHeight:c}=l.current;k(b-a-c<50)}},ref:l,children:0===a.length?(0,b.jsxs)("div",{className:"flex h-full flex-col items-center justify-center text-center",children:[(0,b.jsx)("div",{className:"bg-foreground rounded-full p-4",children:(0,b.jsx)(ar.Sparkles,{className:"text-muted-foreground size-8"})}),(0,b.jsx)("p",{className:"text-muted-foreground mt-4 text-sm font-medium",children:"No transcript yet"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1 text-xs",children:"Transcript will appear here during the call"})]}):a.map(a=>(0,b.jsxs)("div",{className:`rounded-lg p-3 ${"csr"===a.speaker?"border-primary/30 bg-primary/20 border":"border-border/50 bg-foreground/50 border"}`,children:[(0,b.jsxs)("div",{className:"mb-1.5 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:`text-xs font-semibold ${"csr"===a.speaker?"text-primary":"text-muted-foreground"}`,children:"csr"===a.speaker?"CSR":"Customer"}),a.isAnalyzing&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("div",{className:"bg-warning size-1 animate-pulse rounded-full"}),(0,b.jsx)("span",{className:"text-warning text-xxs",children:"AI Analyzing..."})]})]}),(0,b.jsx)("span",{className:"text-muted-foreground font-mono text-xxs",children:new Date(a.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm leading-relaxed",children:a.text}),a.aiExtracted&&(0,b.jsxs)("div",{className:"border-border mt-2 space-y-1 border-t pt-2",children:[a.aiExtracted.customerInfo&&(0,b.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.aiExtracted.customerInfo.name&&(0,b.jsxs)("span",{className:"bg-success/30 text-success rounded px-2 py-0.5 text-xxs",children:["Name: ",a.aiExtracted.customerInfo.name]}),a.aiExtracted.customerInfo.email&&(0,b.jsxs)("span",{className:"bg-success/30 text-success rounded px-2 py-0.5 text-xxs",children:["Email: ",a.aiExtracted.customerInfo.email]})]}),a.aiExtracted.issueCategories&&a.aiExtracted.issueCategories.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:a.aiExtracted.issueCategories.map(a=>(0,b.jsx)("span",{className:"bg-warning/30 text-warning rounded px-2 py-0.5 text-xxs",children:a},a))}),a.aiExtracted.sentiment&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsxs)("span",{className:`rounded px-2 py-0.5 text-xxs ${"positive"===a.aiExtracted.sentiment?"bg-success/30 text-success":"negative"===a.aiExtracted.sentiment?"bg-destructive/30 text-destructive":"bg-foreground/30 text-muted-foreground"}`,children:["Sentiment: ",a.aiExtracted.sentiment]}),void 0!==a.aiExtracted.confidence&&(0,b.jsxs)("span",{className:"text-muted-foreground font-mono text-xxs",children:[Math.round(a.aiExtracted.confidence),"%"]})]})]})]},a.id))}),!j&&a.length>0&&(0,b.jsx)("div",{className:"border-border bg-card border-t p-2 text-center",children:(0,b.jsx)("button",{className:"text-primary hover:text-primary text-xs",onClick:()=>k(!0),type:"button",children:"â†“ New messages below â€¢ Click to auto-scroll"})})]})}];return(0,b.jsx)(Z.ScrollArea,{className:"h-full",children:(0,b.jsx)("div",{className:"flex flex-col gap-4 p-4",children:(0,b.jsx)("section",{className:"border-border/60 bg-card overflow-hidden rounded-xl border shadow-sm",children:(0,b.jsx)("div",{className:"flex flex-col gap-4 p-0",children:(0,b.jsx)(aa.UnifiedAccordion,{defaultOpenSection:"transcript",enableReordering:!1,sections:n,storageKey:"call-window-transcript-panel"})})})})})}async function bd(a){try{let b=a._peer?.connection;if(!(b&&b instanceof RTCPeerConnection))return null;let c=await b.getStats(),d={packetLoss:0,jitter:0,rtt:0,audioLevel:0};return c.forEach(a=>{if("inbound-rtp"===a.type&&"audio"===a.kind){let b=a.packetsLost||0,c=a.packetsReceived||1;d.packetLoss=b/(b+c)*100,d.jitter=1e3*(a.jitter||0)}"candidate-pair"===a.type&&"succeeded"===a.state&&(d.rtt=a.currentRoundTripTime?1e3*a.currentRoundTripTime:0),"media-source"===a.type&&"audio"===a.kind&&(d.audioLevel=a.audioLevel||0)}),d}catch(a){return null}}var be=a.i(685078);a.i(685272);var bf=a.i(571135);function bg(a){if(!window.opener||window.opener.closed)return!1;try{return window.opener.postMessage(a,window.location.origin),!0}catch(a){return!1}}function bh(){let h,k=(0,f.useSearchParams)(),l=k?.get("callId")||null,m=k?.get("customerId"),n=k?.get("direction"),{call:o,answerCall:p,endCall:q,toggleMute:r,toggleHold:s,toggleRecording:t,requestVideo:u,endVideo:v,setCustomerData:w,setCallMetadata:x,setTelnyxCallState:y}=(0,bf.useUIStore)(),{clearTranscript:z}=bb(),{quality:A,metrics:B}=function({call:a,updateInterval:b=2e3}){let[c,d]=(0,g.useState)("unknown"),[e,f]=(0,g.useState)(null),[h,i]=(0,g.useState)(!1),j=(0,g.useCallback)(async()=>{if(!a){d("unknown"),f(null);return}let b=await bd(a);b&&(f(b),d(function(a){let{packetLoss:b,jitter:c,rtt:d}=a;return b<1&&c<30&&d<150?"excellent":b<3&&c<50&&d<300?"good":"poor"}(b)))},[a]);return(0,g.useEffect)(()=>{if(!a){i(!1),d("unknown"),f(null);return}i(!0),j();let c=setInterval(j,b);return()=>{clearInterval(c),i(!1)}},[a,b,j]),{quality:c,metrics:e,isMonitoring:h}}({call:(0,be.useTelnyxWebRTC)({username:"bcw1995gmailcommidzvmln",password:"Jp5FMRf*nG6yhBOdvTkajkVyZcbK*SN%",autoConnect:!1}).currentCall,updateInterval:2e3}),[D,E]=(0,g.useState)(!1),[G,H]=(0,g.useState)(!1),[I,J]=(0,g.useState)(0),[K,L]=(0,g.useState)(!1),[M,N]=(0,g.useState)(k?.get("companyId")??null),[O,P]=(0,g.useState)("schedule"),[Q,R]=(0,g.useState)(!1),[S,T]=(0,g.useState)(!1),[U,V]=(0,g.useState)(),[W,X]=(0,g.useState)(),[Y,Z]=(0,g.useState)(""),$=(0,g.useRef)(null),_=(0,g.useCallback)(()=>{},[]),aa=(0,g.useCallback)(()=>{P("schedule")},[]),ab=(0,g.useCallback)(()=>{},[]),ac=(0,g.useCallback)(()=>{},[]),ad=(0,g.useCallback)(()=>{},[]),ae=(0,g.useCallback)(()=>{},[]);(0,g.useEffect)(()=>{l&&(bg({type:"CALL_POP_OUT_READY",callId:l,timestamp:Date.now()}),E(!0),n&&x({callControlId:l,callSessionId:l,direction:n}))},[l,n,x]),(0,g.useEffect)(()=>{l&&(async()=>{H(!0);try{let b,c=M??k?.get("companyId")??null;if(c&&!M&&N(c),!c)try{let{createClient:b}=await a.A(926807),d=b();if(!d)return;let{data:{user:e},error:f}=await d.auth.getUser();if(f)return void console.error("Call window: Failed to get user:",f.message);if(e){let{data:a,error:b}=await d.from("company_memberships").select("company_id, status, joined_at").eq("user_id",e.id).eq("status","active").order("joined_at",{ascending:!1});if(b)return void console.error("Call window: Failed to fetch team memberships:",b.message);if(Array.isArray(a)&&a.length>0){a.length;let b=a[0];b?.company_id&&(c=b.company_id,N(b.company_id))}}}catch(a){}if(!c)return void H(!1);if(m)b=await j(m,c);else{let a=o.caller?.number||k?.get("from");a&&(b=await i(a,c))}b?.success&&b.data&&w(b.data)}catch(a){}finally{H(!1)}})()},[l,m,o.caller?.number,k,w,M]),(0,g.useEffect)(()=>{if("active"!==o.status||!o.startTime)return;let a=setInterval(()=>{J(Math.floor((Date.now()-o.startTime)/1e3))},1e3);return()=>clearInterval(a)},[o.status,o.startTime]),(0,g.useEffect)(()=>{let a=a=>{var b;if(a.origin!==window.location.origin||!("object"==typeof(b=a.data)&&null!==b&&"string"==typeof b.type&&"string"==typeof b.callId&&["CALL_STATE_INIT","CALL_STATE_SYNC","CALL_POP_OUT_READY","CALL_POP_OUT_CLOSED","CALL_ACTION","TRANSCRIPT_ENTRY","TRANSCRIPT_UPDATE","AI_EXTRACTION_UPDATE","FORM_DATA_UPDATE","REQUEST_FORM_DATA","FORM_DATA_SYNC","CUSTOMER_DATA_UPDATE"].includes(b.type)))return;let c=a.data;switch(c.type){case"CALL_STATE_SYNC":c.callData;break;case"CALL_ACTION":"end"===c.action?(q(),z()):"mute"===c.action?r():"unmute"===c.action&&r();break;case"TRANSCRIPT_UPDATE":break;case"CUSTOMER_DATA_UPDATE":c.customerData&&w(c.customerData)}};return window.addEventListener("message",a),()=>window.removeEventListener("message",a)},[q,r,z,w]);let af=(0,g.useCallback)(a=>{if(l)switch(a){case"mute":case"unmute":r(),bg({type:"CALL_ACTION",callId:l,action:o.isMuted?"unmute":"mute",timestamp:Date.now()});break;case"hold":case"unhold":o.isOnHold?V(void 0):V(Date.now()),s(),bg({type:"CALL_ACTION",callId:l,action:o.isOnHold?"unhold":"hold",timestamp:Date.now()});break;case"record_start":case"record_stop":o.isRecording?X(void 0):X(Date.now()),t(),bg({type:"CALL_ACTION",callId:l,action:o.isRecording?"record_stop":"record_start",timestamp:Date.now()});break;case"end":T(!0);break;case"force_end":q(),z(),bg({type:"CALL_ACTION",callId:l,action:"end",timestamp:Date.now()}),setTimeout(()=>window.close(),500)}},[l,o.isMuted,o.isOnHold,o.isRecording,r,s,t,q,z]),ag=(0,g.useCallback)(a=>{Z(a.notes),af("force_end"),T(!1)},[af]),ah=(0,g.useCallback)(()=>{T(!1)},[]),ai=(0,g.useCallback)(()=>{l&&("off"===o.videoStatus?(u(),bg({type:"CALL_ACTION",callId:l,action:"video_on",timestamp:Date.now()})):(v(),bg({type:"CALL_ACTION",callId:l,action:"video_off",timestamp:Date.now()})))},[l,o.videoStatus,u,v]),aj=(0,g.useCallback)(()=>{L(!0)},[]),ak=(0,g.useCallback)(()=>{window.close()},[]);if(!function(a,b={}){let{enabled:c=!0,onShortcutTriggered:d}=b;(0,g.useRef)(!1);let e=(0,g.useCallback)(()=>{let a=document.activeElement;if(!a)return!1;let b=a.tagName.toLowerCase(),c="true"===a.getAttribute("contenteditable");return"input"===b||"textarea"===b||c},[]),f=(0,g.useCallback)(b=>{if(!c)return;if(e()){"Escape"===b.key&&(b.preventDefault(),a.onEscape?.(),d?.("escape"));return}let f=b.key.toLowerCase(),g=b.ctrlKey||b.metaKey,h=b.shiftKey;if(!b.altKey){if(g)return;if(h&&"e"===f){b.preventDefault(),a.onEndCall?.(),d?.("end_call");return}switch(f){case"m":b.preventDefault(),a.onToggleMute?.(),d?.("toggle_mute");break;case"h":b.preventDefault(),a.onToggleHold?.(),d?.("toggle_hold");break;case"r":b.preventDefault(),a.onToggleRecording?.(),d?.("toggle_recording");break;case"t":b.preventDefault(),a.onTransfer?.(),d?.("transfer");break;case"j":b.preventDefault(),a.onCreateJob?.(),d?.("create_job");break;case"a":b.preventDefault(),a.onScheduleAppointment?.(),d?.("schedule_appointment");break;case"n":b.preventDefault(),a.onFocusNotes?.(),d?.("focus_notes");break;case"s":b.preventDefault(),a.onSendSMS?.(),d?.("send_sms");break;case"e":h||(b.preventDefault(),a.onSendEmail?.(),d?.("send_email"));break;case"1":b.preventDefault(),a.onViewTranscript?.(),d?.("view_transcript");break;case"2":b.preventDefault(),a.onViewSchedule?.(),d?.("view_schedule");break;case"?":case"/":b.preventDefault(),a.onShowHelp?.(),d?.("show_help");break;case"escape":b.preventDefault(),a.onEscape?.(),d?.("escape")}}},[c,e,a,d]);(0,g.useEffect)(()=>(window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)),[f])}({onToggleMute:()=>af(o.isMuted?"unmute":"mute"),onToggleHold:()=>af(o.isOnHold?"unhold":"hold"),onToggleRecording:()=>af(o.isRecording?"record_stop":"record_start"),onEndCall:()=>af("end"),onCreateJob:_,onScheduleAppointment:aa,onSendSMS:ab,onSendEmail:ac,onFocusNotes:ae,onShowHelp:()=>R(!0),onViewTranscript:()=>P("transcript"),onViewSchedule:()=>P("schedule"),onEscape:()=>{Q&&R(!1),S&&T(!1)}},{enabled:"active"===o.status}),!l)return(0,b.jsx)("div",{className:"bg-background flex h-screen items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(c.AlertCircle,{className:"text-destructive mx-auto mb-4 h-12 w-12"}),(0,b.jsx)("h1",{className:"mb-2 text-2xl font-bold",children:"Invalid Call"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"No call ID provided"})]})});let al="active"===o.status,am=o.customerData,an=am?.customer?.first_name&&am?.customer?.last_name?`${am.customer.first_name} ${am.customer.last_name}`.trim():am?.customer?.first_name?am.customer.first_name:o.caller?.name||"Unknown Caller",ao=am?.customer?.phone||o.caller?.number||"No number";return(0,b.jsxs)("div",{className:"bg-background flex h-screen flex-col",children:[(0,b.jsx)(a5.SkipLink,{}),(0,b.jsx)(F,{callDuration:(h=Math.floor(I/60),`${h}:${(I%60).toString().padStart(2,"0")}`),callerName:an,callerNumber:ao,callId:l,connectionQuality:A||"unknown",customerData:am,isActive:al,isMuted:o.isMuted,isOnHold:o.isOnHold,isRecording:o.isRecording,holdStartTime:U,recordingStartTime:W,onClose:ak,onEndCall:()=>af("end"),onHoldToggle:()=>af(o.isOnHold?"unhold":"hold"),onMuteToggle:()=>af(o.isMuted?"unmute":"mute"),onRecordToggle:()=>af(o.isRecording?"record_stop":"record_start"),onTransfer:aj,onVideoToggle:ai,onShowShortcuts:()=>R(!0),videoStatus:o.videoStatus}),(0,b.jsxs)("main",{id:"main-content",ref:$,className:"flex flex-1 overflow-hidden",role:"main","aria-label":"Call window main content",children:[(0,b.jsxs)("section",{className:"bg-muted/20 flex w-[35%] flex-col","aria-label":"transcript"===O?"Call transcript":"Schedule view",children:[(0,b.jsxs)("div",{className:"bg-card/50 flex border-b",role:"tablist","aria-label":"View selection",children:[(0,b.jsxs)(C.Button,{className:"flex-1 rounded-none border-r",onClick:()=>P("transcript"),size:"sm",variant:"transcript"===O?"secondary":"ghost",role:"tab","aria-selected":"transcript"===O,"aria-controls":"left-panel-content",children:[(0,b.jsx)(e.MessageSquare,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),"Transcript",(0,b.jsx)("span",{className:"sr-only",children:"(Press T)"})]}),(0,b.jsxs)(C.Button,{className:"flex-1 rounded-none",onClick:()=>P("schedule"),size:"sm",variant:"schedule"===O?"secondary":"ghost",role:"tab","aria-selected":"schedule"===O,"aria-controls":"left-panel-content",children:[(0,b.jsx)(d.CalendarDays,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),"Schedule",(0,b.jsx)("span",{className:"sr-only",children:"(Press S)"})]})]}),(0,b.jsx)("div",{id:"left-panel-content",className:"flex-1 overflow-hidden",role:"tabpanel","aria-label":"transcript"===O?"Call transcript panel":"Schedule panel",children:"transcript"===O?(0,b.jsx)(bc,{}):(0,b.jsx)(aE,{companyId:M||void 0})})]}),(0,b.jsx)("section",{className:"flex-1 overflow-hidden","aria-label":"Customer information",children:(0,b.jsx)(ax,{customerData:am,isLoading:G,onCreateJob:_,onScheduleAppointment:aa,onSendSMS:ab,onSendEmail:ac,onTakePayment:ad,onAddNote:ae})})]}),(0,b.jsx)(aN,{open:Q,onOpenChange:R}),(0,b.jsx)(aL,{open:S,onOpenChange:T,onComplete:ag,onCancel:ah,callDuration:I,customerName:an,existingNotes:Y})]})}function bi(){return(0,b.jsx)(g.Suspense,{fallback:(0,b.jsx)(a4,{}),children:(0,b.jsx)(bh,{})})}a.s(["default",()=>bi],722819)}];

//# sourceMappingURL=apps_web_src_app_call_page_tsx_888022b1._.js.map