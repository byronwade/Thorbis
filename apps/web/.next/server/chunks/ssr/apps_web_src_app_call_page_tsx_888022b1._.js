module.exports=[722819,a=>{"use strict";var b=a.i(861467),c=a.i(97997),d=a.i(60222),e=a.i(128952),f=a.i(337241),g=a.i(783281),h=a.i(169021),i=(0,h.createServerReference)("600aec4d862a1092375481562663476815d4fc6606",h.callServer,void 0,h.findSourceMapURL,"getCustomerCallData"),j=(0,h.createServerReference)("60ab5acd48e5f648920f2716b9a4f2af0daf20ef2e",h.callServer,void 0,h.findSourceMapURL,"getCustomerCallDataById"),k=a.i(90083),l=a.i(546949),l=l,m=a.i(48199),n=a.i(587969),o=a.i(96250),p=a.i(527936),q=a.i(480298),r=a.i(198803),s=a.i(898062);a.i(246840);var t=a.i(283753),u=a.i(273765),v=a.i(24872),w=a.i(300298),x=a.i(821278);a.i(288007);var y=a.i(986990);a.i(445255);var z=a.i(18170);a.i(928414);var A=a.i(745250),B=a.i(700760);x.Zap,n.Calendar,p.CreditCard,l.default,v.UserCog,e.MessageSquare,s.Phone,m.Briefcase,u.ThumbsDown,o.CheckCircle2;var C=a.i(706544),D=a.i(587488),E=a.i(138382),F=a.i(903196),F=F,G=a.i(698417),G=G,H=a.i(781157),I=a.i(976804),J=a.i(334838),K=a.i(841269),L=a.i(186910),L=L,M=a.i(864199),N=a.i(629367),O=a.i(550501),O=O,P=a.i(585092),Q=a.i(794759);a.i(516775);var R=a.i(560272);function S({callId:a,isActive:c,isMuted:d,isOnHold:e,isRecording:f,videoStatus:h,connectionQuality:i,callDuration:j,holdStartTime:k,recordingStartTime:l,customerData:m,callerName:n,callerNumber:o,onMuteToggle:p,onHoldToggle:q,onRecordToggle:r,onVideoToggle:s,onTransfer:t,onEndCall:u,onClose:v,onShowShortcuts:x}){let[S,T]=(0,g.useState)(!1),[U,V]=(0,g.useState)(0);(0,g.useEffect)(()=>{if(!e||!k)return void V(0);let a=setInterval(()=>{V(Math.floor((Date.now()-k)/1e3))},1e3);return()=>clearInterval(a)},[e,k]);let[W,X]=(0,g.useState)(0);(0,g.useEffect)(()=>{if(!f||!l)return void X(0);let a=setInterval(()=>{X(Math.floor((Date.now()-l)/1e3))},1e3);return()=>clearInterval(a)},[f,l]);let Y=a=>{let b=Math.floor(a/60);return`${b}:${(a%60).toString().padStart(2,"0")}`},Z=m?.customer&&"object"==typeof m.customer&&"avatar_url"in m.customer?m.customer.avatar_url??void 0:void 0;return(0,b.jsx)(A.TooltipProvider,{delayDuration:300,children:(0,b.jsxs)("div",{className:"relative",children:[d&&(0,b.jsxs)("div",{className:"bg-destructive/10 border-destructive/30 flex items-center justify-center gap-2 border-b px-4 py-2",children:[(0,b.jsx)(G.default,{className:"text-destructive h-4 w-4 animate-pulse"}),(0,b.jsx)("span",{className:"text-destructive text-sm font-medium",children:"You are muted"}),(0,b.jsx)("span",{className:"text-destructive/70 text-xs",children:"Press M to unmute"})]}),e&&(0,b.jsxs)("div",{className:"bg-warning/10 border-warning/30 flex items-center justify-center gap-2 border-b px-4 py-2",children:[(0,b.jsx)(M.Timer,{className:"text-warning h-4 w-4"}),(0,b.jsx)("span",{className:"text-warning text-sm font-medium",children:"Call on hold"}),(0,b.jsx)(y.Badge,{variant:"outline",className:"text-warning border-warning/50 font-mono text-xs",children:Y(U)}),(0,b.jsx)("span",{className:"text-warning/70 text-xs",children:"Press H to resume"})]}),(0,b.jsxs)("div",{className:"bg-card/50 flex items-center justify-between px-6 py-3 backdrop-blur-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)(R.Avatar,{className:"h-11 w-11",children:[(0,b.jsx)(R.AvatarImage,{src:Z}),(0,b.jsx)(R.AvatarFallback,{className:(0,B.cn)("text-base font-semibold transition-all",c?"bg-emerald-500/20 text-emerald-600 ring-2 ring-emerald-500/30":"bg-muted text-muted-foreground"),children:n&&"Unknown Caller"!==n?n.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2):"?"})]}),c&&(0,b.jsx)("div",{className:"ring-background absolute -top-0.5 -right-0.5 h-3 w-3 rounded-full bg-emerald-500 ring-2"})]}),(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-foreground text-sm font-semibold",children:n}),c&&(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)("span",{className:"text-muted-foreground font-mono text-xs tabular-nums",children:j}),f&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(D.Circle,{className:"size-2 animate-pulse fill-red-500 text-red-500"}),(0,b.jsxs)("span",{className:"text-destructive font-mono text-xs",children:["REC ",Y(W)]})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-muted-foreground font-mono text-xs",children:o}),m?.isKnownCustomer&&(0,b.jsx)(y.Badge,{className:"h-4 px-1.5 text-[10px]",variant:"outline",children:"Customer"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(z.Button,{className:(0,B.cn)("h-10 w-10 rounded-full transition-all hover:scale-105",d&&"ring-destructive/50 ring-2 ring-offset-2",!d&&"hover:bg-muted"),onClick:p,size:"icon",variant:d?"destructive":"ghost",children:d?(0,b.jsx)(G.default,{className:"size-4 animate-pulse"}):(0,b.jsx)(F.default,{className:"size-4"})})}),(0,b.jsxs)(A.TooltipContent,{side:"bottom",children:[(0,b.jsx)("p",{children:d?"Unmute":"Mute"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press M"})]})]}),(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(z.Button,{className:(0,B.cn)("h-10 w-10 rounded-full transition-all hover:scale-105",e&&"ring-warning/50 ring-2 ring-offset-2",!e&&"hover:bg-muted"),onClick:q,size:"icon",variant:e?"secondary":"ghost",children:e?(0,b.jsx)(J.Play,{className:"size-4"}):(0,b.jsx)(H.Pause,{className:"size-4"})})}),(0,b.jsxs)(A.TooltipContent,{side:"bottom",children:[(0,b.jsx)("p",{children:e?"Resume":"Hold"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press H"})]})]}),(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(z.Button,{className:(0,B.cn)("h-10 w-10 rounded-full transition-all hover:scale-105",f&&"ring-destructive/50 ring-2 ring-offset-2",!f&&"hover:bg-muted"),onClick:r,size:"icon",variant:f?"destructive":"ghost",children:f?(0,b.jsx)(D.Circle,{className:"size-4 animate-pulse fill-current"}):(0,b.jsx)(L.default,{className:"size-4"})})}),(0,b.jsxs)(A.TooltipContent,{side:"bottom",children:[(0,b.jsx)("p",{children:f?"Stop Recording":"Record"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press R"})]})]}),(0,b.jsx)("div",{className:"bg-border mx-2 h-6 w-px"}),(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(z.Button,{className:(0,B.cn)("h-10 w-10 rounded-full transition-all hover:scale-105","off"===h&&"hover:bg-muted"),onClick:s,size:"icon",variant:"connected"===h?"default":"ghost",children:"connected"===h?(0,b.jsx)(N.Video,{className:"size-4"}):(0,b.jsx)(O.default,{className:"size-4"})})}),(0,b.jsx)(A.TooltipContent,{side:"bottom",children:(0,b.jsx)("p",{children:"connected"===h?"End Video":"Start Video"})})]}),(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(z.Button,{className:"hover:bg-muted h-10 w-10 rounded-full transition-all hover:scale-105",onClick:t,size:"icon",variant:"ghost",children:(0,b.jsx)(C.ArrowRightLeft,{className:"size-4"})})}),(0,b.jsxs)(A.TooltipContent,{side:"bottom",children:[(0,b.jsx)("p",{children:"Transfer Call"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press T"})]})]}),(0,b.jsx)("div",{className:"bg-border mx-2 h-6 w-px"}),(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(z.Button,{className:"text-destructive-foreground h-12 w-12 rounded-full transition-all hover:scale-105",onClick:u,size:"icon",variant:"destructive",children:(0,b.jsx)(I.PhoneOff,{className:"size-5"})})}),(0,b.jsxs)(A.TooltipContent,{side:"bottom",children:[(0,b.jsx)("p",{children:"End Call"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press Shift+E"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsxs)(y.Badge,{className:"font-mono text-[10px]",title:"unknown"===i?"Monitoring connection quality...":void 0,variant:(()=>{switch(i){case"excellent":return"default";case"good":return"secondary";case"poor":return"destructive";default:return"outline"}})(),children:[(()=>{switch(i){case"excellent":return(0,b.jsx)(K.Signal,{className:"text-success h-3 w-3"});case"good":return(0,b.jsx)(P.Wifi,{className:"text-warning h-3 w-3"});case"poor":return(0,b.jsx)(Q.WifiOff,{className:"text-destructive h-3 w-3"});default:return(0,b.jsx)(K.Signal,{className:"text-muted-foreground h-3 w-3"})}})(),(0,b.jsx)("span",{className:"ml-1 capitalize",children:i})]}),x&&(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(z.Button,{className:"h-8 w-8",onClick:x,size:"icon",variant:"ghost",children:(0,b.jsx)(E.Keyboard,{className:"h-4 w-4"})})}),(0,b.jsxs)(A.TooltipContent,{side:"bottom",children:[(0,b.jsx)("p",{children:"Keyboard Shortcuts"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Press ?"})]})]}),(0,b.jsx)(z.Button,{className:"h-8 w-8",onClick:v,size:"icon",variant:"ghost",children:(0,b.jsx)(w.X,{className:"h-4 w-4"})})]})]})]})})}var T=a.i(916680),U=a.i(624126),V=a.i(319895),W=a.i(789815),X=a.i(638727);a.i(21368);var Y=a.i(341903);a.i(19256);var Z=a.i(417132);a.i(458393);var $=a.i(82012);a.i(40744);var _=a.i(419573);a.i(897346);var aa=a.i(75892);let ab=[{value:"resolved",label:"Issue Resolved",icon:(0,b.jsx)(o.CheckCircle2,{className:"h-4 w-4"}),color:"text-success"},{value:"appointment_booked",label:"Appointment Booked",icon:(0,b.jsx)(n.Calendar,{className:"h-4 w-4"}),color:"text-primary"},{value:"quote_provided",label:"Quote Provided",icon:(0,b.jsx)(V.FileText,{className:"h-4 w-4"}),color:"text-primary"},{value:"payment_taken",label:"Payment Taken",icon:(0,b.jsx)(o.CheckCircle2,{className:"h-4 w-4"}),color:"text-success"},{value:"callback_scheduled",label:"Callback Scheduled",icon:(0,b.jsx)(s.Phone,{className:"h-4 w-4"}),color:"text-warning"},{value:"escalated",label:"Escalated to Manager",icon:(0,b.jsx)(T.AlertTriangle,{className:"h-4 w-4"}),color:"text-orange-500"},{value:"transferred",label:"Transferred",icon:(0,b.jsx)(s.Phone,{className:"h-4 w-4"}),color:"text-muted-foreground"},{value:"voicemail_left",label:"Left Voicemail",icon:(0,b.jsx)(e.MessageSquare,{className:"h-4 w-4"}),color:"text-muted-foreground"},{value:"customer_hung_up",label:"Customer Hung Up",icon:(0,b.jsx)(I.PhoneOff,{className:"h-4 w-4"}),color:"text-muted-foreground"},{value:"wrong_number",label:"Wrong Number",icon:(0,b.jsx)(w.X,{className:"h-4 w-4"}),color:"text-muted-foreground"},{value:"spam",label:"Spam/Unwanted",icon:(0,b.jsx)(T.AlertTriangle,{className:"h-4 w-4"}),color:"text-destructive"},{value:"other",label:"Other",icon:(0,b.jsx)(V.FileText,{className:"h-4 w-4"}),color:"text-muted-foreground"}],ac=[{value:"callback",label:"Callback",icon:(0,b.jsx)(s.Phone,{className:"h-4 w-4"})},{value:"email",label:"Email",icon:(0,b.jsx)(W.Mail,{className:"h-4 w-4"})},{value:"sms",label:"SMS",icon:(0,b.jsx)(e.MessageSquare,{className:"h-4 w-4"})},{value:"appointment",label:"Appointment",icon:(0,b.jsx)(n.Calendar,{className:"h-4 w-4"})}];function ad({open:a,onOpenChange:c,onComplete:d,onCancel:e,callDuration:f,customerName:h,customerEmail:i,existingNotes:j="",isSubmitting:k=!1}){let l,[m,n]=(0,g.useState)(""),[o,p]=(0,g.useState)(j),[q,s]=(0,g.useState)(!1),[t,u]=(0,g.useState)("callback"),[v,w]=(0,g.useState)(!1),[x,A]=(0,g.useState)(!1),C=f>120,D=""!==m&&(!C||o.trim().length>0),E=(0,g.useCallback)(()=>{D&&m&&d({disposition:m,notes:o.trim(),followUp:{enabled:q,type:t},sendConfirmation:v,createJob:x})},[D,m,o,q,t,v,x,d]);return(0,g.useEffect)(()=>{a&&(n(""),p(j),s(!1),u("callback"),w(!1),A(!1))},[a,j]),(0,g.useEffect)(()=>{let b=b=>{a&&"Enter"===b.key&&(b.ctrlKey||b.metaKey)&&D&&(b.preventDefault(),E())};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[a,D,E]),(0,b.jsx)(Z.Dialog,{onOpenChange:c,open:a,children:(0,b.jsxs)(Z.DialogContent,{className:"max-w-lg",children:[(0,b.jsxs)(Z.DialogHeader,{children:[(0,b.jsxs)(Z.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(I.PhoneOff,{className:"text-destructive h-5 w-5"}),"Wrap Up Call"]}),(0,b.jsxs)(Z.DialogDescription,{className:"flex items-center gap-4",children:[(0,b.jsx)("span",{children:"Complete this form before ending the call with"}),(0,b.jsx)(y.Badge,{variant:"outline",children:h})]})]}),(0,b.jsxs)("div",{className:"bg-muted/50 flex items-center justify-between rounded-lg border p-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(U.Clock,{className:"text-muted-foreground h-4 w-4"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Call Duration"})]}),(0,b.jsx)(y.Badge,{variant:"secondary",className:"font-mono",children:(l=Math.floor(f/60),`${l}:${(f%60).toString().padStart(2,"0")}`)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)($.Label,{className:"flex items-center gap-1",children:["Call Disposition",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsxs)(_.Select,{value:m,onValueChange:a=>n(a),children:[(0,b.jsx)(_.SelectTrigger,{className:(0,B.cn)(!m&&"border-destructive/50"),children:(0,b.jsx)(_.SelectValue,{placeholder:"Select outcome..."})}),(0,b.jsx)(_.SelectContent,{children:ab.map(a=>(0,b.jsx)(_.SelectItem,{value:a.value,children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:a.color,children:a.icon}),(0,b.jsx)("span",{children:a.label})]})},a.value))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)($.Label,{className:"flex items-center gap-1",children:["Call Notes",C&&(0,b.jsx)("span",{className:"text-destructive",children:"*"}),!C&&(0,b.jsx)("span",{className:"text-muted-foreground text-xs ml-1",children:"(optional for short calls)"})]}),(0,b.jsx)(aa.Textarea,{className:(0,B.cn)("min-h-[100px] resize-none",C&&!o.trim()&&"border-destructive/50"),placeholder:"Summarize the call, customer's issue, and resolution...",value:o,onChange:a=>p(a.target.value)}),C&&!o.trim()&&(0,b.jsxs)("p",{className:"text-destructive text-xs flex items-center gap-1",children:[(0,b.jsx)(T.AlertTriangle,{className:"h-3 w-3"}),"Notes required for calls over 2 minutes"]})]}),(0,b.jsxs)("div",{className:"space-y-3 rounded-lg border p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(Y.Checkbox,{id:"followUp",checked:q,onCheckedChange:a=>s(a)}),(0,b.jsx)($.Label,{htmlFor:"followUp",className:"text-sm font-medium cursor-pointer",children:"Schedule Follow-up"})]}),q&&(0,b.jsxs)(_.Select,{value:t,onValueChange:a=>u(a),children:[(0,b.jsx)(_.SelectTrigger,{className:"w-[140px] h-8",children:(0,b.jsx)(_.SelectValue,{})}),(0,b.jsx)(_.SelectContent,{children:ac.map(a=>(0,b.jsx)(_.SelectItem,{value:a.value,children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[a.icon,(0,b.jsx)("span",{children:a.label})]})},a.value))})]})]}),i&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(Y.Checkbox,{id:"sendConfirmation",checked:v,onCheckedChange:a=>w(a)}),(0,b.jsxs)($.Label,{htmlFor:"sendConfirmation",className:"text-sm cursor-pointer flex items-center gap-1",children:[(0,b.jsx)(W.Mail,{className:"h-3.5 w-3.5"}),"Send confirmation email"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(Y.Checkbox,{id:"createJob",checked:x,onCheckedChange:a=>A(a)}),(0,b.jsxs)($.Label,{htmlFor:"createJob",className:"text-sm cursor-pointer flex items-center gap-1",children:[(0,b.jsx)(X.Plus,{className:"h-3.5 w-3.5"}),"Create job from this call"]})]})]}),(0,b.jsxs)(Z.DialogFooter,{className:"gap-2 sm:gap-0",children:[(0,b.jsx)(z.Button,{variant:"outline",onClick:e,disabled:k,children:"Continue Call"}),(0,b.jsx)(z.Button,{variant:"destructive",onClick:E,disabled:!D||k,className:"gap-2",children:k?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(I.PhoneOff,{className:"h-4 w-4"}),"End Call"]})})]}),(0,b.jsxs)("p",{className:"text-muted-foreground text-center text-xs",children:["Press"," ",(0,b.jsx)("kbd",{className:"bg-muted rounded px-1.5 py-0.5 font-mono",children:"Ctrl+Enter"})," ","to complete"]})]})})}var ae=a.i(779184),af=a.i(337850),ag=a.i(824124),ah=a.i(320091),ai=a.i(101482),aj=(0,h.createServerReference)("60511658698c30ee3531ab0584097180a2476606a7",h.callServer,void 0,h.findSourceMapURL,"getTechnicianSchedules");a.i(413309);var ak=a.i(54210);a.i(476036);var al=a.i(930514);function am({appointments:a,workingHours:c,technicianColor:d,currentTime:e=new Date}){let f,{start:g,end:h}=c,i=h-g,j=a=>new Date(a).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),k=Array.from({length:i+1},(a,b)=>g+b),l=(f=e.getHours()+e.getMinutes()/60)<g?0:f>h?100:(f-g)/i*100;return(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"bg-muted/20 relative h-24 rounded-lg border p-2",children:[(0,b.jsx)("div",{className:"absolute inset-x-2 top-1 flex justify-between",children:k.map(a=>(0,b.jsx)("div",{className:"flex flex-col items-center",children:(0,b.jsxs)("span",{className:"text-muted-foreground text-[9px]",children:[a>12?a-12:0===a?12:a,a>=12?"p":"a"]})},a))}),(0,b.jsxs)("div",{className:"bg-card relative mt-6 h-12 rounded border",children:[a.map(a=>{let c,e,f,h,k,l=(c=new Date(a.scheduled_start),e=new Date(a.scheduled_end),f=c.getHours()+c.getMinutes()/60,h=e.getHours()+e.getMinutes()/60,k=(f-g)/i*100,{left:`${Math.max(0,k)}%`,width:`${Math.min(100-Math.max(0,k),(h-f)/i*100)}%`}),m=(a=>{switch(a){case"in_progress":return"bg-warning/80 border-warning";case"completed":return"bg-success/80 border-success";case"cancelled":return"bg-destructive/80 border-destructive";default:return`${d}/80 border-${d.replace("bg-","")}`}})(a.status);return(0,b.jsx)("div",{className:(0,B.cn)("absolute top-1 h-10 rounded border-2 p-1 transition-all hover:z-10 hover:scale-105",m,"in_progress"===a.status&&"animate-pulse"),style:l,title:`${a.customer_name} â€¢ ${j(a.scheduled_start)} - ${j(a.scheduled_end)}`,children:(0,b.jsxs)("div",{className:"flex h-full flex-col justify-center overflow-hidden px-1",children:[(0,b.jsx)("p",{className:"truncate text-[10px] leading-tight font-medium text-white",children:a.customer_name}),a.assigned_technicians.length>1&&(0,b.jsxs)("div",{className:"flex items-center gap-0.5 text-white/80",children:[(0,b.jsx)(ai.Users,{className:"h-2.5 w-2.5"}),(0,b.jsx)("span",{className:"text-[8px]",children:a.assigned_technicians.length})]})]})},a.id)}),l>0&&l<100&&(0,b.jsx)("div",{className:"absolute top-0 h-full w-0.5 bg-blue-500 shadow-lg",style:{left:`${l}%`},children:(0,b.jsx)("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2",children:(0,b.jsxs)("div",{className:"flex items-center gap-1 rounded bg-blue-500 px-1.5 py-0.5 text-white shadow-lg",children:[(0,b.jsx)(U.Clock,{className:"h-2.5 w-2.5"}),(0,b.jsx)("span",{className:"text-[9px] font-medium",children:e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})})]})})})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-[10px]",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("div",{className:(0,B.cn)("h-2 w-2 rounded",d)}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Scheduled"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("div",{className:"bg-warning h-2 w-2 rounded"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"In Progress"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("div",{className:"bg-success h-2 w-2 rounded"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Completed"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("div",{className:"h-2 w-2 rounded border-2 border-blue-500 bg-blue-500"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Current Time"})]})]})]})}function an({className:a,companyId:d}){let e,h=(0,f.useRouter)(),[i,j]=(0,g.useState)(new Date),[k,l]=(0,g.useState)(null),[m,o]=(0,g.useState)([]),[p,q]=(0,g.useState)(!0),[s,t]=(0,g.useState)(null),[u,v]=(0,g.useState)(new Date);if((0,g.useEffect)(()=>{let a=setInterval(()=>{v(new Date)},6e4);return()=>clearInterval(a)},[]),(0,g.useEffect)(()=>{!async function(){if(!d){t("No company ID provided"),q(!1);return}q(!0),t(null);try{let a=await aj(i,d);o(a)}catch(a){t("Failed to load schedules")}finally{q(!1)}}()},[i,d]),p)return(0,b.jsx)("div",{className:(0,B.cn)("flex h-full items-center justify-center",a),children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(r.Loader2,{className:"text-primary mx-auto mb-4 h-8 w-8 animate-spin"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Loading schedules..."})]})});if(s)return(0,b.jsx)("div",{className:(0,B.cn)("flex h-full items-center justify-center",a),children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(c.AlertCircle,{className:"text-destructive mx-auto mb-4 h-8 w-8"}),(0,b.jsx)("p",{className:"text-sm font-medium",children:s}),(0,b.jsx)(z.Button,{className:"mt-4",onClick:()=>h.refresh(),size:"sm",variant:"outline",children:"Retry"})]})});let w=a=>new Date(a).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),x=a=>{let b=new Date(i);b.setDate(b.getDate()+a),j(b)},A=k?m.filter(a=>a.id===k):m,C=m.reduce((a,b)=>a+b.appointments.length,0),D=A.map(a=>({id:a.id,title:a.name,icon:(0,b.jsxs)(R.Avatar,{className:"h-5 w-5",children:[(0,b.jsx)(R.AvatarImage,{src:a.avatar_url}),(0,b.jsx)(R.AvatarFallback,{className:(0,B.cn)("text-[10px] text-white",a.color),children:a.name.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2)})]}),count:a.appointments.length,actions:(0,b.jsx)(y.Badge,{className:"text-[10px]",variant:"secondary",children:a.role.replace("_"," ")}),content:(0,b.jsxs)("div",{className:"space-y-4 p-4",children:[(0,b.jsx)(am,{appointments:a.appointments,currentTime:u,technicianColor:a.color,workingHours:a.working_hours}),a.appointments.length>0?(0,b.jsx)("div",{className:"space-y-3",children:a.appointments.map(a=>(0,b.jsxs)("div",{className:"bg-card hover:bg-muted/50 rounded-lg border p-4 transition-colors",children:[(0,b.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(U.Clock,{className:"text-muted-foreground h-4 w-4"}),(0,b.jsxs)("span",{className:"text-sm font-semibold",children:[w(a.scheduled_start)," -"," ",w(a.scheduled_end)]}),(0,b.jsxs)(y.Badge,{className:"text-[10px]",variant:"secondary",children:[a.duration_hours,"h window"]})]}),(a=>{switch(a){case"completed":return(0,b.jsx)(y.Badge,{className:"border-success/50 bg-success/10 text-success text-[10px]",variant:"outline",children:"Completed"});case"in_progress":return(0,b.jsx)(y.Badge,{className:"border-warning/50 bg-warning/10 text-warning text-[10px]",variant:"outline",children:"In Progress"});case"cancelled":return(0,b.jsx)(y.Badge,{className:"border-destructive/50 bg-destructive/10 text-destructive text-[10px]",variant:"outline",children:"Cancelled"});default:return(0,b.jsx)(y.Badge,{className:"text-[10px]",variant:"outline",children:"Scheduled"})}})(a.status)]}),(0,b.jsxs)("div",{className:"mb-3 space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(ah.User,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:a.customer_name})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(ag.MapPin,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,b.jsxs)("span",{className:"text-muted-foreground text-xs",children:[a.address,", ",a.city,","," ",a.state]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(y.Badge,{className:"text-xs",variant:"outline",children:a.job_type}),(0,b.jsxs)("span",{className:"text-muted-foreground font-mono text-xs",children:["#",a.job_number]})]})]}),a.assigned_technicians.length>1&&(0,b.jsx)("div",{className:"border-t pt-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(ai.Users,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"Team:"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:a.assigned_technicians.map(a=>(0,b.jsxs)(y.Badge,{className:"text-[10px]",variant:a.is_lead?"default":"secondary",children:[a.name,a.is_lead&&" (Lead)"]},a.id))})]})})]},a.id))}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,b.jsx)(n.Calendar,{className:"text-muted-foreground mb-3 h-10 w-10"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No appointments today"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"This technician is available"})]})]})}));return(0,b.jsxs)("div",{className:(0,B.cn)("flex h-full flex-col",a),children:[(0,b.jsxs)("div",{className:"bg-card/50 space-y-3 border-b p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(z.Button,{className:"h-8 w-8",onClick:()=>x(-1),size:"icon",variant:"ghost",children:(0,b.jsx)(ae.ChevronLeft,{className:"h-4 w-4"})}),(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(n.Calendar,{className:"text-muted-foreground h-4 w-4"}),(0,b.jsx)("span",{className:"text-sm font-semibold",children:i.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]}),(e=new Date,i.getDate()===e.getDate()&&i.getMonth()===e.getMonth()&&i.getFullYear()===e.getFullYear()&&(0,b.jsx)(y.Badge,{className:"mt-1 text-[10px]",variant:"secondary",children:"Today"}))]}),(0,b.jsx)(z.Button,{className:"h-8 w-8",onClick:()=>x(1),size:"icon",variant:"ghost",children:(0,b.jsx)(af.ChevronRight,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsxs)("div",{className:"bg-muted/30 flex items-center gap-2 rounded-lg border px-3 py-1.5",children:[(0,b.jsx)(ai.Users,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,b.jsxs)("span",{className:"text-muted-foreground text-xs",children:[A.length," Techs"]}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"â€¢"}),(0,b.jsxs)("span",{className:"text-xs font-medium",children:[C," Appointments"]})]}),(0,b.jsx)(z.Button,{className:"h-7 gap-1.5 px-2 text-xs",onClick:()=>l(null),size:"sm",variant:"outline",children:k?"Show All":"All Techs"})]})]}),(0,b.jsx)(ak.ScrollArea,{className:"flex-1",children:(0,b.jsx)("div",{className:"p-4",children:(0,b.jsx)("section",{className:"border-border/60 bg-card overflow-hidden rounded-xl border shadow-sm",children:(0,b.jsx)("div",{className:"flex flex-col gap-4 p-0",children:(0,b.jsx)(al.UnifiedAccordion,{defaultOpenSection:D[0]?.id,enableReordering:!1,sections:D,storageKey:"csr-schedule-technicians"})})})})}),(0,b.jsx)("div",{className:"bg-card/50 border-t p-3",children:(0,b.jsxs)(z.Button,{className:"w-full gap-2 text-xs",onClick:()=>{},size:"sm",variant:"default",children:[(0,b.jsx)(X.Plus,{className:"h-3.5 w-3.5"}),"Book New Appointment"]})})]})}var ao=a.i(235841),ao=ao,ap=a.i(573587),aq=a.i(105996),ar=a.i(813704),ar=ar,as=a.i(171768),at=a.i(624038);let au={past_due:{icon:p.CreditCard,bgColor:"bg-destructive/10 dark:bg-destructive/20",borderColor:"border-destructive/50",textColor:"text-destructive",iconColor:"text-destructive"},vip:{icon:aq.Crown,bgColor:"bg-amber-500/10 dark:bg-amber-500/20",borderColor:"border-amber-500/50",textColor:"text-amber-600 dark:text-amber-400",iconColor:"text-amber-500"},at_risk:{icon:at.TrendingDown,bgColor:"bg-orange-500/10 dark:bg-orange-500/20",borderColor:"border-orange-500/50",textColor:"text-orange-600 dark:text-orange-400",iconColor:"text-orange-500"},complaint:{icon:ar.default,bgColor:"bg-warning/10 dark:bg-warning/20",borderColor:"border-warning/50",textColor:"text-warning",iconColor:"text-warning"},blocked:{icon:ap.Ban,bgColor:"bg-destructive/15 dark:bg-destructive/25",borderColor:"border-destructive",textColor:"text-destructive",iconColor:"text-destructive"},new_customer:{icon:as.Star,bgColor:"bg-primary/10 dark:bg-primary/20",borderColor:"border-primary/50",textColor:"text-primary",iconColor:"text-primary"},high_value:{icon:ao.default,bgColor:"bg-success/10 dark:bg-success/20",borderColor:"border-success/50",textColor:"text-success",iconColor:"text-success"}};function av({customerData:a,stats:c,onTakePayment:d,onViewHistory:e,onViewComplaints:f,className:h}){let[i,j]=(0,g.useState)(new Set),k=[];if(!a||!c)return null;let{customer:l}=a;if(c.openInvoices>0){let b=a.invoices.filter(a=>"unpaid"===a.status||"overdue"===a.status).reduce((a,b)=>a+(b.total_amount||0),0);if(b>0){let e=a.invoices.some(a=>"overdue"===a.status);k.push({id:"past_due",type:"past_due",title:e?"Past Due Balance":"Outstanding Balance",description:`${c.openInvoices} unpaid invoice${c.openInvoices>1?"s":""}`,amount:b,action:d?{label:"Take Payment",onClick:d}:void 0})}}let m=l?.tags?.includes("VIP")||l?.tags?.includes("vip")||l?.priority_level==="high";m&&k.push({id:"vip",type:"vip",title:"VIP Customer",description:"Priority service â€¢ Extended support",dismissible:!0}),c.totalRevenue>1e4&&!m&&k.push({id:"high_value",type:"high_value",title:"High Value Customer",description:`Lifetime value: ${aw(c.totalRevenue)}`,dismissible:!0}),l?.created_at&&new Date(l.created_at)>new Date(Date.now()-2592e6)&&0===c.totalRevenue&&k.push({id:"new_customer",type:"new_customer",title:"New Customer",description:"First interaction â€¢ Make a great impression!",dismissible:!0});let n=a.jobs.filter(a=>"cancelled"===a.status).length;n>=2&&k.push({id:"at_risk",type:"at_risk",title:"At-Risk Customer",description:`${n} cancelled jobs â€¢ Consider retention offer`,action:e?{label:"View History",onClick:e}:void 0}),(l?.notes?.toLowerCase().includes("complaint")||l?.notes?.toLowerCase().includes("unhappy")||l?.notes?.toLowerCase().includes("frustrated"))&&k.push({id:"complaint",type:"complaint",title:"Recent Complaint",description:"Customer had a previous issue â€¢ Handle with care",action:f?{label:"View Details",onClick:f}:void 0}),(l?.status==="blocked"||l?.tags?.includes("problem")||l?.tags?.includes("do-not-service"))&&k.push({id:"blocked",type:"blocked",title:"Service Restricted",description:"Check with manager before scheduling"});let o=k.filter(a=>!i.has(a.id));return 0===o.length?null:(0,b.jsx)("div",{className:(0,B.cn)("space-y-2",h),children:o.map(a=>{let c=au[a.type],d=c.icon;return(0,b.jsx)("div",{className:(0,B.cn)("relative overflow-hidden rounded-lg border p-3 transition-all",c.bgColor,c.borderColor),children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:(0,B.cn)("mt-0.5 flex h-8 w-8 shrink-0 items-center justify-center rounded-full",c.bgColor),children:(0,b.jsx)(d,{className:(0,B.cn)("h-4 w-4",c.iconColor)})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h4",{className:(0,B.cn)("text-sm font-semibold",c.textColor),children:a.title}),void 0!==a.amount&&(0,b.jsx)(y.Badge,{className:(0,B.cn)("font-mono text-xs",c.textColor),variant:"outline",children:aw(a.amount)})]}),(0,b.jsx)("p",{className:(0,B.cn)("mt-0.5 text-xs opacity-80",c.textColor),children:a.description}),a.action&&(0,b.jsx)(z.Button,{className:(0,B.cn)("mt-2 h-7 text-xs",c.textColor),onClick:a.action.onClick,size:"sm",variant:"outline",children:a.action.label})]}),a.dismissible&&(0,b.jsx)(z.Button,{className:(0,B.cn)("h-6 w-6 shrink-0 opacity-60 hover:opacity-100",c.textColor),onClick:()=>{var b;return b=a.id,void j(a=>new Set([...a,b]))},size:"icon",variant:"ghost",children:(0,b.jsx)(w.X,{className:"h-3 w-3"})})]})},a.id)})})}function aw(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(a)}var ax=a.i(263758),ay=a.i(952251),ay=ay,az=a.i(332284),aA=a.i(396919),aB=a.i(409946),aB=aB,aC=a.i(232553),aD=a.i(984547),aD=aD,aE=a.i(362841);a.i(839984);var aF=a.i(372712),aG=a.i(382281);let aH=[{id:"greeting",text:"Greet customer warmly and smile while speaking",enabled:!0,order:1},{id:"verify",text:"Verify customer name, phone, and service address",enabled:!0,order:2},{id:"availability",text:"Ask about preferred appointment times and availability",enabled:!0,order:3},{id:"confirm",text:"Confirm all details before ending the call",enabled:!0,order:4}];var aI=a.i(698540),aJ=a.i(321807),aK=a.i(688014),aL=a.i(253520);function aM({stats:a,openBalance:c=0,hasOverdueInvoices:d=!1,className:e}){var f,g,h;let i,j=(f=a.totalRevenue)>=25e3?{name:"VIP",icon:(0,b.jsx)(aq.Crown,{className:"h-3 w-3"}),color:"text-amber-500",bgColor:"bg-amber-500/10",borderColor:"border-amber-500/30"}:f>=1e4?{name:"Premium",icon:(0,b.jsx)(as.Star,{className:"h-3 w-3"}),color:"text-purple-500",bgColor:"bg-purple-500/10",borderColor:"border-purple-500/30"}:f>=5e3?{name:"Valued",icon:(0,b.jsx)(aJ.Award,{className:"h-3 w-3"}),color:"text-blue-500",bgColor:"bg-blue-500/10",borderColor:"border-blue-500/30"}:f>=1e3?{name:"Regular",icon:(0,b.jsx)(ah.User,{className:"h-3 w-3"}),color:"text-slate-500",bgColor:"bg-slate-500/10",borderColor:"border-slate-500/30"}:{name:"New",icon:(0,b.jsx)(t.Sparkles,{className:"h-3 w-3"}),color:"text-emerald-500",bgColor:"bg-emerald-500/10",borderColor:"border-emerald-500/30"},k=d?{status:"urgent",label:"Overdue",icon:(0,b.jsx)(T.AlertTriangle,{className:"h-3 w-3"}),color:"text-red-500",bgColor:"bg-red-500/10"}:c>0?{status:"attention",label:"Balance Due",icon:(0,b.jsx)(U.Clock,{className:"h-3 w-3"}),color:"text-amber-500",bgColor:"bg-amber-500/10"}:{status:"good",label:"Good Standing",icon:(0,b.jsx)(aL.CheckCircle,{className:"h-3 w-3"}),color:"text-emerald-500",bgColor:"bg-emerald-500/10"},l=(g=a.totalJobs,i=(h=a.customerSince)?(Date.now()-new Date(h).getTime())/31536e6:0,g>=20||g>=10&&i>=2?{name:"Loyal",description:"Long-term repeat customer",icon:(0,b.jsx)(aK.TrendingUp,{className:"h-3 w-3"}),color:"text-emerald-500"}:g>=5||g>=3&&i>=1?{name:"Active",description:"Regular customer",icon:(0,b.jsx)(aK.TrendingUp,{className:"h-3 w-3"}),color:"text-blue-500"}:g>=2?{name:"Returning",description:"Repeat customer",icon:(0,b.jsx)(aK.TrendingUp,{className:"h-3 w-3"}),color:"text-slate-500"}:{name:"First-Time",description:"New customer",icon:(0,b.jsx)(t.Sparkles,{className:"h-3 w-3"}),color:"text-purple-500"});return(0,b.jsx)(A.TooltipProvider,{delayDuration:200,children:(0,b.jsxs)("div",{className:(0,B.cn)("flex items-center gap-1.5",e),children:[(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)(y.Badge,{variant:"outline",className:(0,B.cn)("gap-1 border px-2 py-0.5 text-[10px] font-semibold",j.bgColor,j.borderColor,j.color),children:[j.icon,j.name]})}),(0,b.jsxs)(A.TooltipContent,{side:"bottom",children:[(0,b.jsxs)("p",{className:"font-medium",children:[j.name," Customer"]}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Lifetime value: $",a.totalRevenue.toLocaleString()]})]})]}),(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:(0,B.cn)("flex items-center gap-1 rounded-full px-2 py-0.5",k.bgColor),children:[(0,b.jsx)("span",{className:k.color,children:k.icon}),(0,b.jsx)("span",{className:(0,B.cn)("text-[10px] font-medium",k.color),children:k.label})]})}),(0,b.jsxs)(A.TooltipContent,{side:"bottom",children:[(0,b.jsx)("p",{className:"font-medium",children:"Payment Status"}),c>0?(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Outstanding: $",c.toLocaleString(),d&&" (includes overdue)"]}):(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"No outstanding balance"})]})]}),(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsx)("span",{className:(0,B.cn)("text-[10px]",l.color),children:l.icon})}),(0,b.jsxs)(A.TooltipContent,{side:"bottom",children:[(0,b.jsxs)("p",{className:"font-medium",children:[l.name," Customer"]}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:l.description}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:[a.totalJobs," total jobs"]})]})]})]})})}function aN({stats:a,openBalance:c=0,lastVisitDate:d,hasOverdueInvoices:e=!1,showStatusIndicator:f=!0,className:g}){var h,i;let j=a=>a>=1e3?`$${(a/1e3).toFixed(1)}k`:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),k=(h=a.totalRevenue)>=1e4?"text-success":h>=5e3?"text-primary":h>=1e3?"text-foreground":"text-muted-foreground",l=c>0;return(0,b.jsx)(A.TooltipProvider,{delayDuration:200,children:(0,b.jsxs)("div",{className:(0,B.cn)("bg-card/80 sticky top-0 z-10 border-b backdrop-blur-sm",g),children:[f&&(0,b.jsx)("div",{className:"flex items-center justify-center gap-2 border-b px-3 py-2",children:(0,b.jsx)(aM,{stats:a,openBalance:c,hasOverdueInvoices:e})}),(0,b.jsxs)("div",{className:"grid grid-cols-5 divide-x",children:[(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(aI.Banknote,{className:(0,B.cn)("h-3.5 w-3.5",k)}),(0,b.jsx)("span",{className:(0,B.cn)("text-xs font-bold",k),children:j(a.totalRevenue)})]}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Revenue"})]})}),(0,b.jsxs)(A.TooltipContent,{children:[(0,b.jsx)("p",{children:"Total Lifetime Revenue"}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:[(i=a.totalRevenue)>=1e4?"High Value":i>=5e3?"Good":i>=1e3?"Average":i>0?"New":"No History"," customer"]})]})]}),(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:(0,B.cn)("flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50",l&&"bg-destructive/5"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(p.CreditCard,{className:(0,B.cn)("h-3.5 w-3.5",l?"text-destructive":"text-muted-foreground")}),(0,b.jsx)("span",{className:(0,B.cn)("text-xs font-bold",l?"text-destructive":"text-muted-foreground"),children:l?j(c):"$0"})]}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px]",children:l?"Due":"Balance"})]})}),(0,b.jsxs)(A.TooltipContent,{children:[(0,b.jsx)("p",{children:l?"Outstanding Balance":"No Balance Due"}),l&&(0,b.jsxs)("p",{className:"text-destructive text-xs",children:[a.openInvoices," unpaid invoice",1!==a.openInvoices?"s":""]})]})]}),(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(m.Briefcase,{className:(0,B.cn)("h-3.5 w-3.5",a.activeJobs>0?"text-primary":"text-muted-foreground")}),(0,b.jsx)("span",{className:(0,B.cn)("text-xs font-bold",a.activeJobs>0?"text-primary":"text-muted-foreground"),children:a.activeJobs})]}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Active"})]})}),(0,b.jsxs)(A.TooltipContent,{children:[(0,b.jsx)("p",{children:"Active Jobs"}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:[a.totalJobs," total jobs"]})]})]}),(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(U.Clock,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"text-foreground text-xs font-bold",children:(a=>{if(!a)return"Never";let b=new Date(a),c=Math.floor((new Date().getTime()-b.getTime())/864e5);return 0===c?"Today":1===c?"Yesterday":c<7?`${c} days ago`:c<30?`${Math.floor(c/7)} weeks ago`:c<365?`${Math.floor(c/30)} months ago`:b.toLocaleDateString("en-US",{month:"short",year:"numeric"})})(d??null)})]}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Last Visit"})]})}),(0,b.jsxs)(A.TooltipContent,{children:[(0,b.jsx)("p",{children:"Last Service Visit"}),d&&(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:new Date(d).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]})]}),(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-3 transition-colors hover:bg-muted/50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(ah.User,{className:"text-muted-foreground h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"text-foreground text-xs font-bold",children:(()=>{if(!a.customerSince)return"New";let b=new Date(a.customerSince),c=(new Date().getTime()-b.getTime())/31536e6;if(c<1){let a=Math.floor(12*c);return a<=1?"< 1 mo":`${a} mo`}return`${Math.floor(c)}y`})()})]}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Member"})]})}),(0,b.jsxs)(A.TooltipContent,{children:[(0,b.jsx)("p",{children:"Customer Since"}),a.customerSince&&(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:new Date(a.customerSince).toLocaleDateString("en-US",{month:"long",year:"numeric"})})]})]})]})]})})}var aO=a.i(766153),aP=a.i(990782);let aQ={resolved:"bg-success/10 text-success border-success/30",callback_scheduled:"bg-warning/10 text-warning border-warning/30",escalated:"bg-orange-500/10 text-orange-500 border-orange-500/30",voicemail_left:"bg-muted text-muted-foreground border-muted",transferred:"bg-muted text-muted-foreground border-muted",customer_hung_up:"bg-muted text-muted-foreground border-muted",appointment_booked:"bg-primary/10 text-primary border-primary/30",quote_provided:"bg-primary/10 text-primary border-primary/30",payment_taken:"bg-success/10 text-success border-success/30",other:"bg-muted text-muted-foreground border-muted"},aR={positive:"ðŸ˜Š",neutral:"ðŸ˜",negative:"ðŸ˜ "};function aS({lastCall:a,recentCalls:c=[],onViewAllCalls:d,className:f}){let h,i,j,[k,l]=(0,g.useState)(!1);if(!a)return(0,b.jsx)("div",{className:(0,B.cn)("border-primary/20 bg-primary/5 rounded-xl border p-4",f),children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"bg-primary/10 rounded-full p-2",children:(0,b.jsx)(s.Phone,{className:"text-primary h-4 w-4"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"First Call"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1 text-xs",children:"This is the first call with this customer. No previous call history available."})]})]})});let m=a=>{let b=Math.floor(a/60),c=a%60;return 0===b?`${c}s`:`${b}m ${c}s`},n=aQ[a.disposition]||aQ.other;return(0,b.jsxs)("div",{className:(0,B.cn)("bg-muted/30 overflow-hidden rounded-xl border transition-all",f),children:[(0,b.jsxs)("button",{className:"flex w-full items-center justify-between p-4 text-left transition-colors hover:bg-muted/50",onClick:()=>l(!k),type:"button",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"bg-muted rounded-full p-2",children:(0,b.jsx)(s.Phone,{className:"text-muted-foreground h-4 w-4"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Previous Call"}),a.sentiment&&(0,b.jsx)("span",{title:`Customer was ${a.sentiment}`,children:aR[a.sentiment]})]}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:[(h=new Date(a.date),0===(j=Math.floor(((i=new Date).getTime()-h.getTime())/864e5))?`Today at ${h.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:1===j?`Yesterday at ${h.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:j<7?`${j} days ago`:h.toLocaleDateString("en-US",{month:"short",day:"numeric",year:h.getFullYear()!==i.getFullYear()?"numeric":void 0}))," â€¢ ",m(a.duration)]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(y.Badge,{className:(0,B.cn)("text-xs",n),variant:"outline",children:a.disposition.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}),k?(0,b.jsx)(aP.ChevronUp,{className:"text-muted-foreground h-4 w-4"}):(0,b.jsx)(aO.ChevronDown,{className:"text-muted-foreground h-4 w-4"})]})]}),k&&(0,b.jsxs)("div",{className:"border-t p-4 pt-3",children:[(0,b.jsxs)("div",{className:"mb-3 grid grid-cols-3 gap-2",children:[(0,b.jsxs)("div",{className:"bg-card rounded-lg p-2 text-center",children:[(0,b.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,b.jsx)(ah.User,{className:"text-muted-foreground h-3 w-3"}),(0,b.jsx)("span",{className:"text-xs font-medium",children:a.csrName})]}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Handled by"})]}),(0,b.jsxs)("div",{className:"bg-card rounded-lg p-2 text-center",children:[(0,b.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,b.jsx)(U.Clock,{className:"text-muted-foreground h-3 w-3"}),(0,b.jsx)("span",{className:"text-xs font-medium",children:m(a.duration)})]}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Duration"})]}),(0,b.jsxs)("div",{className:"bg-card rounded-lg p-2 text-center",children:[(0,b.jsx)("div",{className:"flex items-center justify-center gap-1",children:a.issueResolved?(0,b.jsx)("span",{className:"text-success text-xs font-medium",children:"Yes"}):(0,b.jsx)("span",{className:"text-warning text-xs font-medium",children:"No"})}),(0,b.jsx)("span",{className:"text-muted-foreground text-[10px]",children:"Resolved"})]})]}),a.topics&&a.topics.length>0&&(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsxs)("div",{className:"mb-1.5 flex items-center gap-1",children:[(0,b.jsx)(t.Sparkles,{className:"text-primary h-3 w-3"}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs font-medium",children:"Topics Discussed"})]}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:a.topics.map((a,c)=>(0,b.jsx)(y.Badge,{className:"text-[10px]",variant:"secondary",children:a},c))})]}),a.notes&&(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsxs)("div",{className:"mb-1.5 flex items-center gap-1",children:[(0,b.jsx)(V.FileText,{className:"text-muted-foreground h-3 w-3"}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs font-medium",children:"Notes"})]}),(0,b.jsx)("p",{className:"bg-card rounded-lg border p-2 text-xs",children:a.notes})]}),a.followUpScheduled&&!a.issueResolved&&(0,b.jsxs)("div",{className:"bg-warning/10 border-warning/30 flex items-start gap-2 rounded-lg border p-2",children:[(0,b.jsx)(T.AlertTriangle,{className:"text-warning mt-0.5 h-3.5 w-3.5 shrink-0"}),(0,b.jsx)("p",{className:"text-warning text-xs",children:"Follow-up was scheduled for this customer. Check if issue was resolved."})]}),d&&c.length>0&&(0,b.jsxs)(z.Button,{className:"mt-3 w-full gap-1 text-xs",onClick:d,size:"sm",variant:"outline",children:[(0,b.jsx)(e.MessageSquare,{className:"h-3 w-3"}),"View All ",c.length+1," Calls"]})]})]})}function aT({onCreateJob:a,onScheduleAppointment:c,onSendSMS:d,onSendEmail:f,onTakePayment:g,onAddNote:h,onAISuggestion:i,customerEmail:j,customerPhone:k,hasOutstandingBalance:l,outstandingAmount:o,className:q,layout:r="grid"}){let s=[{id:"job",label:"New Job",shortLabel:"Job",icon:(0,b.jsx)(m.Briefcase,{className:"h-4 w-4"}),shortcut:"J",variant:"default",onClick:a,description:"Create a new job for this customer"},{id:"appointment",label:"Schedule",icon:(0,b.jsx)(n.Calendar,{className:"h-4 w-4"}),shortcut:"A",variant:"outline",onClick:c,description:"Schedule an appointment"},{id:"sms",label:"SMS",icon:(0,b.jsx)(e.MessageSquare,{className:"h-4 w-4"}),shortcut:"S",variant:"outline",onClick:d,disabled:!k,description:k?"Send SMS to customer":"No phone number available"},{id:"email",label:"Email",icon:(0,b.jsx)(W.Mail,{className:"h-4 w-4"}),shortcut:"E",variant:"outline",onClick:f,disabled:!j,description:j?"Send email to customer":"No email address available"},{id:"note",label:"Note",icon:(0,b.jsx)(V.FileText,{className:"h-4 w-4"}),shortcut:"N",variant:"outline",onClick:h,description:"Add a note to this call"}];return g&&l&&s.push({id:"payment",label:"Payment",icon:(0,b.jsx)(p.CreditCard,{className:"h-4 w-4"}),variant:"secondary",onClick:g,badge:o?`$${o.toLocaleString()}`:"Due",description:"Take payment for outstanding balance"}),(0,b.jsx)(A.TooltipProvider,{delayDuration:300,children:(0,b.jsxs)("div",{className:(0,B.cn)("space-y-3",q),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("h4",{className:"text-muted-foreground flex items-center gap-2 text-xs font-semibold tracking-wide uppercase",children:[(0,b.jsx)(X.Plus,{className:"h-3 w-3"}),"Quick Actions"]}),i&&(0,b.jsxs)(z.Button,{className:"h-6 gap-1 px-2 text-xs",onClick:i,size:"sm",variant:"ghost",children:[(0,b.jsx)(t.Sparkles,{className:"h-3 w-3"}),"AI Suggest"]})]}),(0,b.jsx)("div",{className:{horizontal:"flex flex-wrap items-center gap-2",vertical:"flex flex-col gap-2",grid:"grid grid-cols-3 gap-2"}[r],children:s.map(a=>(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)(z.Button,{className:(0,B.cn)("relative h-10 gap-2 text-sm","grid"===r&&"w-full flex-col h-auto py-3","vertical"===r&&"w-full justify-start"),disabled:a.disabled,onClick:a.onClick,size:"sm",variant:a.variant||"outline",children:[a.icon,(0,b.jsx)("span",{className:(0,B.cn)("grid"===r&&"text-xs"),children:"horizontal"===r&&a.shortLabel||a.label}),a.badge&&(0,b.jsx)(y.Badge,{className:"absolute -top-1 -right-1 h-5 px-1.5 text-[10px]",variant:"destructive",children:a.badge})]})}),(0,b.jsxs)(A.TooltipContent,{side:"bottom",children:[(0,b.jsx)("p",{children:a.description||a.label}),a.shortcut&&(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Press ",a.shortcut]})]})]},a.id))}),(0,b.jsx)("p",{className:"text-muted-foreground/60 text-center text-[10px]",children:"Press ? to see all shortcuts"})]})})}var aU=a.i(367301),aV=a.i(984270),aW=a.i(268344),aX=a.i(145679);function aY({communications:a,customerId:c,maxItems:d=3,showViewAll:f=!0,className:g}){let h=a.slice(0,d);return 0===h.length?(0,b.jsxs)("div",{className:(0,B.cn)("space-y-2",g),children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsx)("h4",{className:"text-muted-foreground text-xs font-semibold tracking-wide uppercase",children:"Recent Activity"})}),(0,b.jsx)("p",{className:"text-muted-foreground py-4 text-center text-xs",children:"No recent communications"})]}):(0,b.jsxs)("div",{className:(0,B.cn)("space-y-2",g),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h4",{className:"text-muted-foreground text-xs font-semibold tracking-wide uppercase",children:"Recent Activity"}),f&&c&&(0,b.jsx)(z.Button,{variant:"ghost",size:"sm",className:"h-6 gap-1 px-2 text-xs",asChild:!0,children:(0,b.jsxs)(aX.default,{href:`/dashboard/communication?customerId=${c}`,children:["View All",(0,b.jsx)(aV.ExternalLink,{className:"h-3 w-3"})]})})]}),(0,b.jsx)("div",{className:"space-y-1.5",children:h.map(a=>{let c=(a=>{switch(a){case"email":return{icon:W.Mail,color:"text-blue-500",bg:"bg-blue-500/10",label:"Email"};case"sms":return{icon:e.MessageSquare,color:"text-green-500",bg:"bg-green-500/10",label:"SMS"};case"call":return{icon:s.Phone,color:"text-purple-500",bg:"bg-purple-500/10",label:"Call"};case"voicemail":return{icon:aW.Voicemail,color:"text-orange-500",bg:"bg-orange-500/10",label:"Voicemail"};default:return{icon:W.Mail,color:"text-slate-500",bg:"bg-slate-500/10",label:"Message"}}})(a.type),d=c.icon;return(0,b.jsxs)(aX.default,{href:`/dashboard/communication?id=${a.id}`,className:(0,B.cn)("group flex items-start gap-2 rounded-lg border p-2 transition-colors","hover:bg-accent/50"),children:[(0,b.jsx)("div",{className:(0,B.cn)("mt-0.5 rounded-full p-1.5",c.bg),children:(0,b.jsx)(d,{className:(0,B.cn)("h-3 w-3",c.color)})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)("span",{className:"text-muted-foreground text-[10px] uppercase",children:c.label}),(0,b.jsx)("span",{className:"text-muted-foreground/50 text-[10px]",children:"inbound"===a.direction?"received":"sent"})]}),(0,b.jsx)("p",{className:"text-foreground line-clamp-1 text-xs font-medium",children:(a=>{if(a.subject)return a.subject;if(a.body){let b=a.body.replace(/<[^>]*>/g,"").trim();return b.length>60?b.substring(0,60)+"...":b}switch(a.type){case"call":return"inbound"===a.direction?"Incoming call":"Outgoing call";case"sms":return"Text message";case"voicemail":return"Voicemail";default:return"No preview"}})(a)}),(0,b.jsx)("p",{className:"text-muted-foreground text-[10px]",children:(0,aU.formatDistanceToNow)(new Date(a.created_at),{addSuffix:!0})})]}),(0,b.jsx)(af.ChevronRight,{className:"text-muted-foreground mt-2 h-3 w-3 opacity-0 transition-opacity group-hover:opacity-100"})]},a.id)})}),a.length>d&&(0,b.jsxs)("p",{className:"text-muted-foreground/60 text-center text-[10px]",children:["+",a.length-d," more communications"]})]})}var aZ=a.i(739044);let a$=[{id:"on-the-way",label:"On The Way",shortLabel:"OTW",icon:"truck",preview:"Tech en route notification",build:a=>{let b=a.customerFirstName||"there",c=a.technicianName||"Our technician";return`Hi ${b}, ${c} is on the way and should arrive shortly.`}},{id:"running-late",label:"Running Late",shortLabel:"Late",icon:"clock",preview:"Delay notification",build:a=>{let b=a.customerFirstName||"there";return`Hi ${b}, we apologize but our technician is running a bit behind schedule. We'll update you when they're on the way.`}},{id:"confirm-appointment",label:"Confirm Appt",shortLabel:"Confirm",icon:"calendar",preview:"Appointment confirmation",build:a=>{let b=a.customerFirstName||"there",c=a.appointmentDate&&a.appointmentTime?`for ${a.appointmentDate} at ${a.appointmentTime}`:"for your scheduled time";return`Hi ${b}, this is a confirmation of your appointment ${c}. Reply YES to confirm.`}},{id:"job-complete",label:"Job Complete",shortLabel:"Done",icon:"check",preview:"Work completed",build:a=>{let b=a.customerFirstName||"there",c=a.companyName?`choosing ${a.companyName}`:"your business";return`Hi ${b}, the work has been completed. Thank you for ${c}!`}},{id:"payment-link",label:"Payment Link",shortLabel:"Pay",icon:"dollar",preview:"Send payment reminder",build:a=>{let b=a.customerFirstName||"there",c=a.amount?` for $${a.amount}`:"";return`Hi ${b}, your invoice${c} is ready. Pay securely here: [PAYMENT_LINK]`}},{id:"thank-you",label:"Thank You",shortLabel:"Thanks",icon:"heart",preview:"Thank you message",build:a=>{let b=a.companyName?`choosing ${a.companyName}`:"your business";return`Thank you for ${b}! We appreciate your trust in us.`}}],a_={clock:"â±ï¸",truck:"ðŸšš",check:"âœ…",dollar:"ðŸ’µ",calendar:"ðŸ“…",heart:"â¤ï¸",alert:"âš ï¸"};function a0({customerPhone:a,customerFirstName:c,customerName:d,companyName:f,companyPhone:h,technicianName:i,appointmentDate:j,appointmentTime:k,invoiceNumber:l,amount:m,onSendSms:n,disabled:o=!1,className:p}){let[q,s]=(0,g.useState)(null),[t,u]=(0,g.useState)(""),[v,x]=(0,g.useState)(!1),[C,D]=(0,g.useState)(null),E={customerFirstName:c||d?.split(" ")[0],customerName:d,companyName:f,companyPhone:h,technicianName:i,appointmentDate:j,appointmentTime:k,invoiceNumber:l,amount:m},F=(0,g.useCallback)(a=>{let b=a.build(E);s(a),u(b)},[E]),G=(0,g.useCallback)(async()=>{if(t.trim()&&a&&n){x(!0);try{await n(t,a),D(q?.id||null),s(null),u(""),setTimeout(()=>D(null),3e3)}catch(a){console.error("Failed to send SMS:",a)}finally{x(!1)}}},[t,a,n,q]),H=(0,g.useCallback)(()=>{s(null),u("")},[]);return a?(0,b.jsx)(A.TooltipProvider,{children:(0,b.jsxs)("div",{className:(0,B.cn)("space-y-2",p),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("h4",{className:"text-muted-foreground flex items-center gap-1.5 text-xs font-semibold tracking-wide uppercase",children:[(0,b.jsx)(e.MessageSquare,{className:"h-3 w-3"}),"Quick SMS"]}),(0,b.jsx)("span",{className:"text-muted-foreground/60 text-[10px]",children:"Click to preview"})]}),(0,b.jsxs)(ak.ScrollArea,{className:"w-full whitespace-nowrap",children:[(0,b.jsx)("div",{className:"flex gap-1.5 pb-2",children:a$.map(a=>{let c=C===a.id;return(0,b.jsxs)(A.Tooltip,{children:[(0,b.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)(z.Button,{variant:c?"default":"outline",size:"sm",className:(0,B.cn)("h-8 shrink-0 gap-1.5 px-3 text-xs transition-all",c&&"bg-green-500 hover:bg-green-500"),onClick:()=>F(a),disabled:o||v,children:[(0,b.jsx)("span",{className:"text-sm",children:c?"âœ“":a_[a.icon]}),(0,b.jsx)("span",{children:a.shortLabel})]})}),(0,b.jsxs)(A.TooltipContent,{side:"bottom",children:[(0,b.jsx)("p",{className:"font-medium",children:a.label}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:a.preview})]})]},a.id)})}),(0,b.jsx)(ak.ScrollBar,{orientation:"horizontal",className:"h-1.5"})]}),(0,b.jsx)(Z.Dialog,{open:!!q,onOpenChange:H,children:(0,b.jsxs)(Z.DialogContent,{className:"sm:max-w-md",children:[(0,b.jsxs)(Z.DialogHeader,{children:[(0,b.jsxs)(Z.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-lg",children:q?a_[q.icon]:""}),q?.label]}),(0,b.jsx)(Z.DialogDescription,{children:"Review and edit the message before sending"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(y.Badge,{variant:"secondary",className:"text-xs",children:["To: ",d||a]}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:a})]}),(0,b.jsx)(aa.Textarea,{value:t,onChange:a=>u(a.target.value),rows:4,className:"resize-none",placeholder:"Type your message..."}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-muted-foreground text-xs",children:[t.length," characters"]}),(0,b.jsxs)("span",{className:(0,B.cn)("text-xs",t.length>160?"text-amber-500":"text-muted-foreground"),children:[Math.ceil(t.length/160)||1," SMS segment",t.length>160?"s":""]})]})]}),(0,b.jsxs)(Z.DialogFooter,{className:"gap-2 sm:gap-0",children:[(0,b.jsxs)(z.Button,{variant:"outline",onClick:H,children:[(0,b.jsx)(w.X,{className:"mr-2 h-4 w-4"}),"Cancel"]}),(0,b.jsx)(z.Button,{onClick:G,disabled:!t.trim()||v,children:v?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Sending..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aZ.Send,{className:"mr-2 h-4 w-4"}),"Send SMS"]})})]})]})})]})}):null}function a1({customerData:a,isLoading:d,onCreateJob:e,onScheduleAppointment:f,onSendSMS:h,onSendEmail:i,onTakePayment:j,onAddNote:k,onSendSmsMessage:l,previousCall:o}){let p=aH.filter(a=>a.enabled).sort((a,b)=>a.order-b.order),r=a?.invoices.filter(a=>"unpaid"===a.status||"overdue"===a.status).reduce((a,b)=>a+(b.total_amount||0),0)||0,t=a?.invoices.some(a=>"overdue"===a.status)||!1,u=a?.jobs.filter(a=>"completed"===a.status).sort((a,b)=>{let c=a.completed_at||a.updated_at||"";return new Date(b.completed_at||b.updated_at||"").getTime()-new Date(c).getTime()})[0]?.completed_at||null;if(d)return(0,b.jsx)("div",{className:"flex h-full items-center justify-center p-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"border-primary mx-auto mb-4 h-12 w-12 animate-spin rounded-full border-4 border-t-transparent"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Loading customer data..."})]})});if(!a)return(0,b.jsx)("div",{className:"flex h-full items-center justify-center p-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(c.AlertCircle,{className:"text-muted-foreground mx-auto mb-4 h-12 w-12"}),(0,b.jsx)("p",{className:"text-foreground font-medium",children:"No customer data"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1 text-sm",children:"Customer information will appear here"})]})});let{customer:v,stats:x,jobs:A,invoices:B,estimates:C,appointments:D,properties:E,equipment:F,recentCommunications:G}=a,H=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a),I=a=>a?new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"N/A",[J,K]=(0,g.useState)(v?.phone?[v.phone]:[""]),[L,M]=(0,g.useState)(v?.email?[v.email]:[""]),N=async()=>{},O=[{id:"overview",title:"Customer Overview",icon:(0,b.jsx)(ah.User,{className:"h-4 w-4"}),actions:(0,b.jsxs)(z.Button,{className:"h-8 gap-1.5 px-3",onClick:N,size:"sm",variant:"default",children:[(0,b.jsx)(aC.Save,{className:"h-3.5 w-3.5"}),"Save"]}),content:(0,b.jsxs)("div",{className:"space-y-6 p-6",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Basic Information"}),(0,b.jsxs)(aG.StandardFormRow,{cols:2,children:[(0,b.jsx)(aG.StandardFormField,{label:"First Name",htmlFor:"firstName",children:(0,b.jsx)(aF.Input,{defaultValue:v?.first_name||"",id:"firstName",placeholder:"Enter first name"})}),(0,b.jsx)(aG.StandardFormField,{label:"Last Name",htmlFor:"lastName",children:(0,b.jsx)(aF.Input,{defaultValue:v?.last_name||"",id:"lastName",placeholder:"Enter last name"})})]}),(0,b.jsx)(aG.StandardFormField,{label:"Company",htmlFor:"company",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(ax.Building2,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,b.jsx)(aF.Input,{className:"pl-9",defaultValue:v?.company_name||"",id:"company",placeholder:"Enter company name"})]})})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Contact Information"})}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)($.Label,{children:"Email Addresses"}),L.map((a,c)=>(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(W.Mail,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,b.jsx)(aF.Input,{className:"pl-9",onChange:a=>{var b;let d;return b=a.target.value,void((d=[...L])[c]=b,M(d))},placeholder:"email@example.com",type:"email",value:a})]}),L.length>1&&(0,b.jsx)(z.Button,{className:"h-9 w-9",onClick:()=>{M(L.filter((a,b)=>b!==c))},size:"icon",variant:"ghost",children:(0,b.jsx)(w.X,{className:"h-4 w-4"})})]},c)),(0,b.jsxs)(z.Button,{className:"w-full",onClick:()=>M([...L,""]),size:"sm",variant:"outline",children:[(0,b.jsx)(X.Plus,{className:"mr-2 h-4 w-4"}),"Add Email"]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)($.Label,{children:"Phone Numbers"}),J.map((a,c)=>(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(s.Phone,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,b.jsx)(aF.Input,{className:"pl-9",onChange:a=>{var b;let d;return b=a.target.value,void((d=[...J])[c]=b,K(d))},placeholder:"(555) 123-4567",type:"tel",value:a})]}),J.length>1&&(0,b.jsx)(z.Button,{className:"h-9 w-9",onClick:()=>{K(J.filter((a,b)=>b!==c))},size:"icon",variant:"ghost",children:(0,b.jsx)(w.X,{className:"h-4 w-4"})})]},c)),(0,b.jsxs)(z.Button,{className:"w-full",onClick:()=>K([...J,""]),size:"sm",variant:"outline",children:[(0,b.jsx)(X.Plus,{className:"mr-2 h-4 w-4"}),"Add Phone"]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Address"}),(0,b.jsx)(aG.StandardFormField,{label:"Street Address",htmlFor:"address",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(ag.MapPin,{className:"text-muted-foreground absolute top-3 left-3 h-4 w-4"}),(0,b.jsx)(aa.Textarea,{className:"min-h-[60px] pl-9",defaultValue:v?.address||"",id:"address",placeholder:"123 Main Street"})]})}),(0,b.jsxs)(aG.StandardFormRow,{cols:3,children:[(0,b.jsx)(aG.StandardFormField,{label:"City",htmlFor:"city",children:(0,b.jsx)(aF.Input,{defaultValue:v?.city||"",id:"city",placeholder:"City"})}),(0,b.jsx)(aG.StandardFormField,{label:"State",htmlFor:"state",children:(0,b.jsx)(aF.Input,{defaultValue:v?.state||"",id:"state",placeholder:"State"})}),(0,b.jsx)(aG.StandardFormField,{label:"ZIP Code",htmlFor:"zipCode",children:(0,b.jsx)(aF.Input,{defaultValue:v?.zip_code||"",id:"zipCode",placeholder:"12345"})})]})]}),v&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Enrichment Data"}),(0,b.jsx)(aG.StandardFormField,{label:"Website",htmlFor:"website",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(az.Globe,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,b.jsx)(aF.Input,{className:"pl-9",defaultValue:"",id:"website",placeholder:"https://example.com",type:"url"})]})}),(0,b.jsxs)(aG.StandardFormRow,{cols:3,children:[(0,b.jsx)(aG.StandardFormField,{label:"LinkedIn",htmlFor:"linkedin",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(aB.default,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,b.jsx)(aF.Input,{className:"pl-9",defaultValue:"",id:"linkedin",placeholder:"Profile URL"})]})}),(0,b.jsx)(aG.StandardFormField,{label:"Twitter",htmlFor:"twitter",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(aD.default,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,b.jsx)(aF.Input,{className:"pl-9",defaultValue:"",id:"twitter",placeholder:"@username"})]})}),(0,b.jsx)(aG.StandardFormField,{label:"Facebook",htmlFor:"facebook",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(ay.default,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),(0,b.jsx)(aF.Input,{className:"pl-9",defaultValue:"",id:"facebook",placeholder:"Profile URL"})]})})]})]})]})},{id:"jobs",title:"Jobs",icon:(0,b.jsx)(m.Briefcase,{className:"h-4 w-4"}),count:A.length,actions:(0,b.jsxs)(z.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,b.jsx)(X.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Link Job"]}),content:A.length>0?(0,b.jsx)("div",{className:"space-y-2 p-6",children:A.map(a=>(0,b.jsxs)("div",{className:"bg-muted/30 rounded-lg border p-3 text-sm",children:[(0,b.jsxs)("div",{className:"mb-1 flex items-start justify-between",children:[(0,b.jsx)("span",{className:"font-medium",children:a.title||"Untitled Job"}),(0,b.jsx)(y.Badge,{className:"text-xs",variant:"outline",children:a.status})]}),(0,b.jsxs)("p",{className:"text-muted-foreground font-mono text-xs",children:["#",a.job_number]}),a.financial?.total_amount&&(0,b.jsx)("p",{className:"mt-1 text-xs",children:H(a.financial.total_amount)})]},a.id))}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 py-12 text-center",children:[(0,b.jsx)(m.Briefcase,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No jobs found"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"This customer has no jobs yet"})]})},{id:"invoices",title:"Invoices",icon:(0,b.jsx)(V.FileText,{className:"h-4 w-4"}),count:B.length,actions:(0,b.jsxs)(z.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,b.jsx)(X.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Link Invoice"]}),content:B.length>0?(0,b.jsx)("div",{className:"space-y-2 p-6",children:B.map(a=>(0,b.jsxs)("div",{className:"bg-muted/30 rounded-lg border p-3 text-sm",children:[(0,b.jsxs)("div",{className:"mb-1 flex items-start justify-between",children:[(0,b.jsxs)("span",{className:"font-medium",children:["Invoice #",a.invoice_number]}),(0,b.jsx)(y.Badge,{className:"text-xs",variant:"paid"===a.status?"default":"unpaid"===a.status?"destructive":"outline",children:a.status})]}),(0,b.jsx)("p",{className:"font-semibold",children:H(a.total_amount||0)}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Due: ",I(a.due_date)]})]},a.id))}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 py-12 text-center",children:[(0,b.jsx)(V.FileText,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No invoices found"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"This customer has no invoices yet"})]})},{id:"appointments",title:"Appointments",icon:(0,b.jsx)(n.Calendar,{className:"h-4 w-4"}),count:D.length,actions:(0,b.jsxs)(z.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,b.jsx)(X.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Schedule"]}),content:D.length>0?(0,b.jsx)("div",{className:"space-y-2 p-6",children:D.map(a=>{let c=a.scheduled_start??a.scheduled_for??a.start_time??a.scheduled_at??null;return(0,b.jsxs)("div",{className:"bg-muted/30 rounded-lg border p-3 text-sm",children:[(0,b.jsxs)("div",{className:"mb-1 flex items-start justify-between",children:[(0,b.jsx)("span",{className:"font-medium",children:a.title||"Appointment"}),(0,b.jsx)(y.Badge,{className:"text-xs",variant:"outline",children:a.status})]}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:c?I(c):"Date to be scheduled"})]},a.id)})}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 py-12 text-center",children:[(0,b.jsx)(n.Calendar,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No appointments"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"No scheduled appointments for this customer"})]})},{id:"properties",title:"Properties",icon:(0,b.jsx)(aA.Home,{className:"h-4 w-4"}),count:E.length,actions:(0,b.jsxs)(z.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,b.jsx)(X.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Link Property"]}),content:E.length>0?(0,b.jsx)("div",{className:"space-y-2 p-6",children:E.map(a=>(0,b.jsx)("div",{className:"bg-muted/30 rounded-lg border p-3 text-sm",children:(0,b.jsxs)("div",{className:"mb-1 flex items-start gap-2",children:[(0,b.jsx)(ag.MapPin,{className:"text-muted-foreground mt-0.5 h-4 w-4 shrink-0"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium",children:a.name||"Property"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:a.address})]})]})},a.id))}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 py-12 text-center",children:[(0,b.jsx)(aA.Home,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No properties"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"No properties associated with this customer"})]})},{id:"equipment",title:"Equipment",icon:(0,b.jsx)(aE.Wrench,{className:"h-4 w-4"}),count:F.length,actions:(0,b.jsxs)(z.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,b.jsx)(X.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Add Equipment"]}),content:F.length>0?(0,b.jsx)("div",{className:"space-y-2 p-6",children:F.map(a=>(0,b.jsxs)("div",{className:"bg-muted/30 rounded-lg border p-3 text-sm",children:[(0,b.jsx)("p",{className:"font-medium",children:a.name||"Equipment"}),a.model&&(0,b.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Model: ",a.model]}),a.serial_number&&(0,b.jsxs)("p",{className:"text-muted-foreground font-mono text-xs",children:["S/N: ",a.serial_number]})]},a.id))}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 py-12 text-center",children:[(0,b.jsx)(aE.Wrench,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No equipment"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"No equipment associated with this customer"})]})},{id:"notes",title:"Notes",icon:(0,b.jsx)(V.FileText,{className:"h-4 w-4"}),count:+!!v?.notes,actions:(0,b.jsxs)(z.Button,{className:"h-8 gap-1.5 px-3",onClick:()=>{},size:"sm",variant:"outline",children:[(0,b.jsx)(X.Plus,{className:"mr-2 h-3.5 w-3.5"}),"Add Note"]}),content:(0,b.jsx)("div",{className:"space-y-4 p-6",children:v?.notes?(0,b.jsx)("div",{className:"space-y-3",children:(0,b.jsxs)("div",{className:"bg-muted/30 rounded-lg border p-4",children:[(0,b.jsx)("div",{className:"mb-2 flex items-start justify-between",children:(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)("p",{className:"text-sm",children:v.notes})})}),(0,b.jsxs)("div",{className:"text-muted-foreground flex items-center gap-2 text-xs",children:[(0,b.jsx)(ah.User,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:"System"}),(0,b.jsx)("span",{children:"â€¢"}),(0,b.jsx)("span",{children:I(v.created_at||new Date().toISOString())})]})]})}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,b.jsx)(V.FileText,{className:"text-muted-foreground mb-4 h-12 w-12"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No notes yet"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Add notes about this customer"}),(0,b.jsxs)(z.Button,{className:"mt-4",onClick:()=>{},size:"sm",variant:"outline",children:[(0,b.jsx)(X.Plus,{className:"mr-2 h-4 w-4"}),"Add Note"]})]})})}];return(0,b.jsxs)("div",{className:"flex h-full flex-col",children:[v&&x&&(0,b.jsx)(aN,{stats:x,openBalance:r,lastVisitDate:u,hasOverdueInvoices:t,showStatusIndicator:!0}),(0,b.jsx)(ak.ScrollArea,{className:"flex-1",children:(0,b.jsxs)("div",{className:"flex flex-col gap-4 p-4",children:[a&&x&&(0,b.jsx)(av,{customerData:a,stats:x,onTakePayment:j}),(0,b.jsx)(aS,{lastCall:o??null}),(0,b.jsx)("section",{className:"border-border/60 bg-card overflow-hidden rounded-xl border p-4 shadow-sm",children:(0,b.jsx)(aT,{onCreateJob:e||(()=>{}),onScheduleAppointment:f||(()=>{}),onSendSMS:h||(()=>{}),onSendEmail:i||(()=>{}),onTakePayment:j,onAddNote:k||(()=>{}),customerEmail:v?.email,customerPhone:v?.phone,hasOutstandingBalance:r>0,outstandingAmount:r,layout:"grid"})}),v?.phone&&(0,b.jsx)("section",{className:"border-border/60 bg-card overflow-hidden rounded-xl border p-4 shadow-sm",children:(0,b.jsx)(a0,{customerPhone:v.phone,customerFirstName:v.first_name||void 0,customerName:v.first_name&&v.last_name?`${v.first_name} ${v.last_name}`:v.first_name||void 0,companyName:v.company_name||void 0,onSendSms:l,disabled:!l})}),G&&G.length>0&&(0,b.jsx)("section",{className:"border-border/60 bg-card overflow-hidden rounded-xl border p-4 shadow-sm",children:(0,b.jsx)(aY,{communications:G,customerId:v?.id,maxItems:3,showViewAll:!0})}),p.length>0&&(0,b.jsx)("section",{className:"border-primary/20 bg-primary/5 overflow-hidden rounded-xl border shadow-sm",children:(0,b.jsxs)("div",{className:"flex items-start gap-3 p-4",children:[(0,b.jsx)("div",{className:"bg-primary/10 rounded-full p-2",children:(0,b.jsx)(q.Lightbulb,{className:"text-primary h-4 w-4"})}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)("h3",{className:"text-foreground text-sm font-semibold",children:"Call Reminders"}),(0,b.jsx)("ul",{className:"text-muted-foreground space-y-1.5 text-xs",children:p.map(a=>(0,b.jsxs)("li",{className:"flex items-start gap-2",children:[(0,b.jsx)("span",{className:"text-primary mt-0.5",children:"â€¢"}),(0,b.jsx)("span",{children:a.text})]},a.id))})]})]})}),v&&(0,b.jsx)("section",{className:"border-border/60 bg-card overflow-hidden rounded-xl border p-4 shadow-sm",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h4",{className:"text-muted-foreground text-xs font-semibold tracking-wide uppercase",children:"Customer Tags"}),(0,b.jsxs)(z.Button,{className:"h-6 px-2 text-xs",onClick:()=>{},size:"sm",variant:"ghost",children:[(0,b.jsx)(X.Plus,{className:"mr-1 h-3 w-3"}),"Add"]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-1.5",children:[(0,b.jsx)(y.Badge,{className:"text-xs",variant:"secondary",children:"VIP"}),(0,b.jsx)(y.Badge,{className:"text-xs",variant:"secondary",children:"Recurring"}),(0,b.jsxs)(y.Badge,{className:"hover:bg-muted cursor-pointer text-xs",variant:"outline",children:[(0,b.jsx)(X.Plus,{className:"mr-1 h-3 w-3"}),"Add Tag"]})]})]})}),(0,b.jsx)("section",{className:"border-border/60 bg-card overflow-hidden rounded-xl border shadow-sm",children:(0,b.jsx)("div",{className:"flex flex-col gap-4 p-0",children:(0,b.jsx)(al.UnifiedAccordion,{defaultOpenSection:null,enableReordering:!1,sections:O,storageKey:"call-window-customer-sidebar"})})})]})})]})}a.i(638446);var a2=a.i(988253),a3=a.i(274956),a4=a.i(414379);s.Phone,W.Mail,ag.MapPin,ah.User,n.Calendar,U.Clock,a3.DollarSign,aE.Wrench,a4.Tag,a4.Tag;var F=F,L=L;let a5=[{title:"Call Controls",shortcuts:[{keys:["M"],description:"Toggle mute/unmute",icon:(0,b.jsx)(F.default,{className:"h-3.5 w-3.5"})},{keys:["H"],description:"Toggle hold/resume",icon:(0,b.jsx)(H.Pause,{className:"h-3.5 w-3.5"})},{keys:["R"],description:"Toggle recording",icon:(0,b.jsx)(L.default,{className:"h-3.5 w-3.5"})},{keys:["T"],description:"Transfer call",icon:(0,b.jsx)(s.Phone,{className:"h-3.5 w-3.5"})},{keys:["Shift","E"],description:"End call",icon:(0,b.jsx)(I.PhoneOff,{className:"h-3.5 w-3.5"}),destructive:!0}]},{title:"Quick Actions",shortcuts:[{keys:["J"],description:"Create new job",icon:(0,b.jsx)(X.Plus,{className:"h-3.5 w-3.5"})},{keys:["A"],description:"Schedule appointment",icon:(0,b.jsx)(n.Calendar,{className:"h-3.5 w-3.5"})},{keys:["N"],description:"Focus notes field",icon:(0,b.jsx)(V.FileText,{className:"h-3.5 w-3.5"})},{keys:["S"],description:"Send SMS to customer"},{keys:["E"],description:"Send email to customer"}]},{title:"Navigation",shortcuts:[{keys:["1"],description:"View transcript panel"},{keys:["2"],description:"View schedule panel"},{keys:["Tab"],description:"Cycle through sections"},{keys:["Esc"],description:"Close dialogs/minimize"}]},{title:"General",shortcuts:[{keys:["?"],description:"Show this help panel",icon:(0,b.jsx)(E.Keyboard,{className:"h-3.5 w-3.5"})},{keys:["Ctrl","S"],description:"Save notes"},{keys:["Ctrl","C"],description:"Copy selected text"}]}];function a6({open:a,onOpenChange:c}){return(0,g.useEffect)(()=>{let b=b=>{"Escape"===b.key&&a&&c(!1)};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[a,c]),(0,b.jsx)(Z.Dialog,{onOpenChange:c,open:a,children:(0,b.jsxs)(Z.DialogContent,{className:"max-h-[85vh] max-w-2xl overflow-y-auto",children:[(0,b.jsxs)(Z.DialogHeader,{children:[(0,b.jsxs)(Z.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(E.Keyboard,{className:"h-5 w-5"}),"Keyboard Shortcuts"]}),(0,b.jsxs)(Z.DialogDescription,{children:["Use these shortcuts for faster call handling. Press"," ",(0,b.jsx)("kbd",{className:"bg-muted rounded px-1.5 py-0.5 font-mono text-xs",children:"?"})," ","anytime to show this panel."]})]}),(0,b.jsx)("div",{className:"mt-4 grid grid-cols-2 gap-6",children:a5.map(a=>(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold",children:a.title}),(0,b.jsx)("div",{className:"space-y-2",children:a.shortcuts.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-lg border p-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[a.icon&&(0,b.jsx)("span",{className:(0,B.cn)("text-muted-foreground",a.destructive&&"text-destructive"),children:a.icon}),(0,b.jsx)("span",{className:(0,B.cn)("text-sm",a.destructive&&"text-destructive"),children:a.description})]}),(0,b.jsx)("div",{className:"flex items-center gap-1",children:a.keys.map((c,d)=>(0,b.jsxs)("span",{children:[(0,b.jsx)("kbd",{className:(0,B.cn)("bg-muted inline-flex min-w-[24px] items-center justify-center rounded px-1.5 py-0.5 font-mono text-xs",a.destructive&&"bg-destructive/10 text-destructive"),children:c}),d<a.keys.length-1&&(0,b.jsx)("span",{className:"text-muted-foreground mx-0.5 text-xs",children:"+"})]},d))})]},c))})]},a.title))}),(0,b.jsx)("div",{className:"bg-muted/50 mt-6 rounded-lg border p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"bg-primary/10 rounded-full p-2",children:(0,b.jsx)(E.Keyboard,{className:"text-primary h-4 w-4"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-sm font-medium",children:"Pro Tips"}),(0,b.jsxs)("ul",{className:"text-muted-foreground mt-1 space-y-1 text-xs",children:[(0,b.jsx)("li",{children:"â€¢ Shortcuts only work when the call window is focused"}),(0,b.jsxs)("li",{children:["â€¢ Use"," ",(0,b.jsx)("kbd",{className:"bg-muted rounded px-1 font-mono",children:"Shift+E"})," ","for end call to prevent accidental hangups"]}),(0,b.jsxs)("li",{children:["â€¢ Press"," ",(0,b.jsx)("kbd",{className:"bg-muted rounded px-1 font-mono",children:"N"})," to quickly add notes during a call"]}),(0,b.jsx)("li",{children:"â€¢ The mute indicator turns red when you're muted"})]})]})]})})]})})}var a7=a.i(74342),a7=a7,a8=a.i(139956),a8=a8;a.i(13378).Smile,a8.default,a7.default,aK.TrendingUp,k.ArrowRight,at.TrendingDown,a.i(903935),a.i(560857),a.i(956852),a.i(90125),a.i(129112);var a9=a.i(256003);function ba({className:a}){return(0,b.jsx)("div",{className:(0,B.cn)("bg-card/80 sticky top-0 z-10 border-b backdrop-blur-sm",a),children:(0,b.jsx)("div",{className:"grid grid-cols-5 divide-x",children:Array.from({length:5}).map((a,c)=>(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center gap-1.5 p-3",children:[(0,b.jsx)(a9.Skeleton,{className:"h-4 w-12"}),(0,b.jsx)(a9.Skeleton,{className:"h-3 w-8"})]},c))})})}function bb({className:a}){return(0,b.jsx)("div",{className:(0,B.cn)("space-y-2",a),children:(0,b.jsxs)("div",{className:"flex items-start gap-3 rounded-lg border bg-muted/20 p-3",children:[(0,b.jsx)(a9.Skeleton,{className:"h-8 w-8 rounded-full"}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)(a9.Skeleton,{className:"h-4 w-32"}),(0,b.jsx)(a9.Skeleton,{className:"h-3 w-48"})]})]})})}function bc({className:a}){return(0,b.jsxs)("div",{className:(0,B.cn)("space-y-3",a),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(a9.Skeleton,{className:"h-4 w-24"}),(0,b.jsx)(a9.Skeleton,{className:"h-6 w-16"})]}),(0,b.jsx)("div",{className:"grid grid-cols-3 gap-2",children:Array.from({length:6}).map((a,c)=>(0,b.jsx)(a9.Skeleton,{className:"h-16 rounded-lg"},c))})]})}function bd({className:a}){return(0,b.jsx)("div",{className:(0,B.cn)("rounded-xl border bg-muted/30 p-4",a),children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(a9.Skeleton,{className:"h-10 w-10 rounded-full"}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)(a9.Skeleton,{className:"h-4 w-24"}),(0,b.jsx)(a9.Skeleton,{className:"h-3 w-32"})]}),(0,b.jsx)(a9.Skeleton,{className:"h-5 w-16 rounded-full"})]})})}function be({className:a}){return(0,b.jsxs)("div",{className:(0,B.cn)("rounded-xl border bg-card",a),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(a9.Skeleton,{className:"h-4 w-4"}),(0,b.jsx)(a9.Skeleton,{className:"h-4 w-28"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(a9.Skeleton,{className:"h-8 w-8 rounded"}),(0,b.jsx)(a9.Skeleton,{className:"h-8 w-8 rounded"})]})]}),(0,b.jsx)("div",{className:"border-b p-3",children:(0,b.jsx)(a9.Skeleton,{className:"h-9 w-full rounded"})}),(0,b.jsx)("div",{className:"space-y-3 p-4",children:Array.from({length:4}).map((a,c)=>(0,b.jsxs)("div",{className:(0,B.cn)("rounded-lg border p-3",c%2==0?"ml-0 mr-8":"ml-8 mr-0"),children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,b.jsx)(a9.Skeleton,{className:"h-3 w-12"}),(0,b.jsx)(a9.Skeleton,{className:"h-3 w-16"})]}),(0,b.jsx)(a9.Skeleton,{className:"h-4 w-full"}),(0,b.jsx)(a9.Skeleton,{className:"mt-1 h-4 w-3/4"})]},c))})]})}function bf({className:a}){return(0,b.jsxs)("div",{className:(0,B.cn)("flex h-full flex-col",a),children:[(0,b.jsx)(ba,{}),(0,b.jsxs)("div",{className:"flex-1 space-y-4 overflow-hidden p-4",children:[(0,b.jsx)(bb,{}),(0,b.jsx)(bd,{}),(0,b.jsx)("div",{className:"rounded-xl border bg-card p-4",children:(0,b.jsx)(bc,{})}),(0,b.jsx)("div",{className:"rounded-xl border bg-card p-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(a9.Skeleton,{className:"h-4 w-24"}),(0,b.jsxs)("div",{className:"flex gap-1.5",children:[(0,b.jsx)(a9.Skeleton,{className:"h-6 w-12 rounded-full"}),(0,b.jsx)(a9.Skeleton,{className:"h-6 w-16 rounded-full"}),(0,b.jsx)(a9.Skeleton,{className:"h-6 w-14 rounded-full"})]})]})})]})]})}function bg(){return(0,b.jsxs)("div",{className:"flex h-screen flex-col bg-background",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between border-b px-6 py-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(a9.Skeleton,{className:"h-11 w-11 rounded-full"}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(a9.Skeleton,{className:"h-4 w-32"}),(0,b.jsx)(a9.Skeleton,{className:"h-3 w-24"})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:Array.from({length:6}).map((a,c)=>(0,b.jsx)(a9.Skeleton,{className:"h-10 w-10 rounded-full"},c))}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(a9.Skeleton,{className:"h-6 w-20 rounded-full"}),(0,b.jsx)(a9.Skeleton,{className:"h-8 w-8 rounded"})]})]}),(0,b.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,b.jsx)("div",{className:"flex w-[35%] flex-col border-r",children:(0,b.jsx)(be,{className:"flex-1"})}),(0,b.jsx)("div",{className:"w-[65%]",children:(0,b.jsx)(bf,{className:"h-full"})})]})]})}var bh=a.i(187056),bi=a.i(50900),bj=a.i(527228),bk=a.i(140596);let bl={entries:[],isRecording:!1,currentSpeaker:null,searchQuery:"",filteredEntries:[]},bm=(0,bj.create)()((0,bk.devtools)((a,b)=>({...bl,addEntry:b=>{let c={...b,id:`transcript-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),isAnalyzing:!1};a(a=>{let b=[...a.entries,c];return{entries:b,filteredEntries:a.searchQuery?b.filter(b=>b.text.toLowerCase().includes(a.searchQuery.toLowerCase())):b}})},updateEntry:(b,c)=>{a(a=>{let d=a.entries.map(a=>a.id===b?{...a,...c}:a);return{entries:d,filteredEntries:a.searchQuery?d.filter(b=>b.text.toLowerCase().includes(a.searchQuery.toLowerCase())):d}})},markAsAnalyzing:a=>{b().updateEntry(a,{isAnalyzing:!0})},markAsAnalyzed:(a,c)=>{b().updateEntry(a,{isAnalyzing:!1,aiExtracted:c})},setCurrentSpeaker:b=>a({currentSpeaker:b}),setSearchQuery:b=>{a(a=>({searchQuery:b,filteredEntries:b?a.entries.filter(a=>a.text.toLowerCase().includes(b.toLowerCase())):a.entries}))},startRecording:()=>a({isRecording:!0}),stopRecording:()=>a({isRecording:!1}),clearTranscript:()=>a(bl),exportTranscript:()=>{let{entries:a}=b();return JSON.stringify(a.map(a=>({speaker:a.speaker,text:a.text,timestamp:new Date(a.timestamp).toISOString(),aiExtracted:a.aiExtracted})),null,2)},getFullTranscript:()=>{let{entries:a}=b();return a.map(a=>{let b=new Date(a.timestamp).toLocaleTimeString(),c="csr"===a.speaker?"CSR":"Customer";return`[${b}] ${c}: ${a.text}`}).join("\n")}}),{name:"TranscriptStore"}));function bn(){let a=bm(a=>a.filteredEntries.length>0?a.filteredEntries:a.entries),c=bm(a=>a.searchQuery),d=bm(a=>a.setSearchQuery),f=bm(a=>a.isRecording),h=bm(a=>a.exportTranscript),i=bm(a=>a.getFullTranscript),[j,k]=(0,g.useState)(!0),l=(0,g.useRef)(null);(0,g.useEffect)(()=>{j&&l.current&&(l.current.scrollTop=l.current.scrollHeight)},[j]);let m=async()=>{let a=i();await navigator.clipboard.writeText(a)},n=[{id:"transcript",title:"Live Transcript",icon:(0,b.jsx)(e.MessageSquare,{className:"h-4 w-4"}),count:a.length,actions:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[f&&(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)("div",{className:"bg-destructive size-2 animate-pulse rounded-full"}),(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"Recording"})]}),(0,b.jsx)(z.Button,{className:"h-8 px-2",onClick:m,size:"sm",title:"Copy transcript",variant:"ghost",children:(0,b.jsx)(a2.Copy,{className:"size-3.5"})}),(0,b.jsx)(z.Button,{className:"h-8 px-2",onClick:()=>{let a=new Blob([h()],{type:"application/json"}),b=URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download=`transcript-${new Date().toISOString()}.json`,c.click(),URL.revokeObjectURL(b)},size:"sm",title:"Export transcript",variant:"ghost",children:(0,b.jsx)(bh.Download,{className:"size-3.5"})})]}),content:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("div",{className:"border-border border-b p-3",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(bi.Search,{className:"text-muted-foreground absolute top-1/2 left-3 size-4 -translate-y-1/2"}),(0,b.jsx)(aF.Input,{className:"bg-card h-9 pl-9 text-sm",onChange:a=>d(a.target.value),placeholder:"Search transcript...",type:"text",value:c})]})}),(0,b.jsx)("div",{className:"h-[calc(100vh-28rem)] space-y-3 overflow-y-auto p-4",onScroll:()=>{if(l.current){let{scrollTop:a,scrollHeight:b,clientHeight:c}=l.current;k(b-a-c<50)}},ref:l,children:0===a.length?(0,b.jsxs)("div",{className:"flex h-full flex-col items-center justify-center text-center",children:[(0,b.jsx)("div",{className:"bg-foreground rounded-full p-4",children:(0,b.jsx)(t.Sparkles,{className:"text-muted-foreground size-8"})}),(0,b.jsx)("p",{className:"text-muted-foreground mt-4 text-sm font-medium",children:"No transcript yet"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1 text-xs",children:"Transcript will appear here during the call"})]}):a.map(a=>(0,b.jsxs)("div",{className:`rounded-lg p-3 ${"csr"===a.speaker?"border-primary/30 bg-primary/20 border":"border-border/50 bg-foreground/50 border"}`,children:[(0,b.jsxs)("div",{className:"mb-1.5 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:`text-xs font-semibold ${"csr"===a.speaker?"text-primary":"text-muted-foreground"}`,children:"csr"===a.speaker?"CSR":"Customer"}),a.isAnalyzing&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("div",{className:"bg-warning size-1 animate-pulse rounded-full"}),(0,b.jsx)("span",{className:"text-warning text-xxs",children:"AI Analyzing..."})]})]}),(0,b.jsx)("span",{className:"text-muted-foreground font-mono text-xxs",children:new Date(a.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm leading-relaxed",children:a.text}),a.aiExtracted&&(0,b.jsxs)("div",{className:"border-border mt-2 space-y-1 border-t pt-2",children:[a.aiExtracted.customerInfo&&(0,b.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.aiExtracted.customerInfo.name&&(0,b.jsxs)("span",{className:"bg-success/30 text-success rounded px-2 py-0.5 text-xxs",children:["Name: ",a.aiExtracted.customerInfo.name]}),a.aiExtracted.customerInfo.email&&(0,b.jsxs)("span",{className:"bg-success/30 text-success rounded px-2 py-0.5 text-xxs",children:["Email: ",a.aiExtracted.customerInfo.email]})]}),a.aiExtracted.issueCategories&&a.aiExtracted.issueCategories.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:a.aiExtracted.issueCategories.map(a=>(0,b.jsx)("span",{className:"bg-warning/30 text-warning rounded px-2 py-0.5 text-xxs",children:a},a))}),a.aiExtracted.sentiment&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsxs)("span",{className:`rounded px-2 py-0.5 text-xxs ${"positive"===a.aiExtracted.sentiment?"bg-success/30 text-success":"negative"===a.aiExtracted.sentiment?"bg-destructive/30 text-destructive":"bg-foreground/30 text-muted-foreground"}`,children:["Sentiment: ",a.aiExtracted.sentiment]}),void 0!==a.aiExtracted.confidence&&(0,b.jsxs)("span",{className:"text-muted-foreground font-mono text-xxs",children:[Math.round(a.aiExtracted.confidence),"%"]})]})]})]},a.id))}),!j&&a.length>0&&(0,b.jsx)("div",{className:"border-border bg-card border-t p-2 text-center",children:(0,b.jsx)("button",{className:"text-primary hover:text-primary text-xs",onClick:()=>k(!0),type:"button",children:"â†“ New messages below â€¢ Click to auto-scroll"})})]})}];return(0,b.jsx)(ak.ScrollArea,{className:"h-full",children:(0,b.jsx)("div",{className:"flex flex-col gap-4 p-4",children:(0,b.jsx)("section",{className:"border-border/60 bg-card overflow-hidden rounded-xl border shadow-sm",children:(0,b.jsx)("div",{className:"flex flex-col gap-4 p-0",children:(0,b.jsx)(al.UnifiedAccordion,{defaultOpenSection:"transcript",enableReordering:!1,sections:n,storageKey:"call-window-transcript-panel"})})})})})}var bo=a.i(909637);async function bp(a){try{let b=a._mediaHandler?._peerConnection;if(!(b&&b instanceof RTCPeerConnection))return null;let c=await b.getStats(),d={packetLoss:0,jitter:0,rtt:0,audioLevel:0};return c.forEach(a=>{if("inbound-rtp"===a.type&&"audio"===a.kind){let b=a.packetsLost||0,c=a.packetsReceived||1;d.packetLoss=b/(b+c)*100,d.jitter=1e3*(a.jitter||0)}"candidate-pair"===a.type&&"succeeded"===a.state&&(d.rtt=a.currentRoundTripTime?1e3*a.currentRoundTripTime:0),"media-source"===a.type&&"audio"===a.kind&&(d.audioLevel=a.audioLevel||0)}),d}catch(a){return null}}a.i(685272);var bq=a.i(571135);function br(a){if(!window.opener||window.opener.closed)return!1;try{return window.opener.postMessage(a,window.location.origin),!0}catch(a){return!1}}function bs(){let h,k=(0,f.useSearchParams)(),l=k?.get("callId")||null,m=k?.get("customerId"),n=k?.get("direction"),{call:o,answerCall:p,endCall:q,toggleMute:r,toggleHold:s,toggleRecording:t,requestVideo:u,endVideo:v,setCustomerData:w,setCallMetadata:x,setTwilioCallState:y}=(0,bq.useUIStore)(),{clearTranscript:A}=bm(),{quality:B,metrics:C}=function({call:a,updateInterval:b=2e3}){let[c,d]=(0,g.useState)("unknown"),[e,f]=(0,g.useState)(null),[h,i]=(0,g.useState)(!1),j=(0,g.useCallback)(async()=>{if(!a){d("unknown"),f(null);return}let b=await bp(a);b&&(f(b),d(function(a){let{packetLoss:b,jitter:c,rtt:d}=a;return b<1&&c<30&&d<150?"excellent":b<3&&c<50&&d<300?"good":"poor"}(b)))},[a]);return(0,g.useEffect)(()=>{if(!a){i(!1),d("unknown"),f(null);return}i(!0),j();let c=setInterval(j,b);return()=>{clearInterval(c),i(!1)}},[a,b,j]),{quality:c,metrics:e,isMonitoring:h}}({call:function(b){let[c,d]=(0,g.useState)(!1),[e,f]=(0,g.useState)(!1),[h,i]=(0,g.useState)(!1),[j,k]=(0,g.useState)(null),[l,m]=(0,g.useState)(0),[n,o]=(0,g.useState)(null),[p,q]=(0,g.useState)([]),r=(0,g.useRef)(null),s=(0,g.useRef)(null),t=(0,g.useRef)(b),u=(0,g.useRef)(null),v=(0,g.useRef)(!0);(0,g.useEffect)(()=>{t.current=b},[b]);let w=(0,g.useCallback)((a,...b)=>{t.current.debug},[]),x=(0,g.useCallback)((a,...b)=>{console.error(`[Twilio] ${a}`,...b)},[]),y=(0,g.useCallback)((a,...b)=>{t.current.debug&&console.warn(`[Twilio] ${a}`,...b)},[]),z=(0,g.useCallback)(a=>{let b=Math.min(1e3*2**a,3e4),c=.3*b*Math.random();return Math.round(b+c)},[]),A=(0,g.useCallback)(()=>{u.current&&clearTimeout(u.current),m(b=>{let c=b+1;if(c>5)return x("Max reconnection attempts (5) reached"),i(!1),k("Connection lost. Max reconnection attempts (5) exceeded."),b;let e=z(c-1);return w(`Scheduling reconnection attempt ${c}/5 in ${e}ms`),i(!0),u.current=setTimeout(async()=>{if(w(`Attempting reconnection ${c}/5`),r.current){try{r.current.destroy()}catch{}r.current=null}try{let b=t.current;if(b.accessToken){let{Device:c}=await a.A(310412),e=new c(b.accessToken,{logLevel:+!!b.debug,codecPreferences:["opus","pcmu"]});e.on("registered",()=>{w("Reconnection successful"),d(!0),f(!1),i(!1),k(null),m(0)}),e.on("error",a=>{x("Reconnection error:",a),A()}),e.on("unregistered",()=>{d(!1),v.current&&A()}),r.current=e,await e.register()}}catch(a){x("Reconnection attempt failed:",a)}},e),c})},[z]),B=(0,g.useCallback)(async()=>{if(w("Manual reconnection requested"),m(0),v.current=!0,r.current){try{r.current.destroy()}catch{}r.current=null}if(u.current&&(clearTimeout(u.current),u.current=null),i(!1),t.current.accessToken){f(!0),k(null);try{let a=await C();a&&await a.register()}catch(a){x("Manual reconnection failed:",a),k(a instanceof Error?a.message:"Reconnection failed"),f(!1)}}},[]),C=(0,g.useCallback)(async()=>{if(r.current)return w("Reusing existing device instance"),r.current;let b=t.current,c=!!b.accessToken;if(w("Initializing device with token:",{hasToken:c,debug:b.debug}),!c)return x("Missing access token, cannot initialize"),null;try{let{Device:c}=await a.A(310412);w("Creating new Device instance...");let e=new c(b.accessToken,{logLevel:+!!b.debug,codecPreferences:["opus","pcmu"]});return e.on("registered",()=>{w("Registered - Connection successful"),d(!0),f(!1),i(!1),k(null),m(0)}),e.on("error",a=>{x("Device error:",a);let b=a?.message||a?.description||"Connection error";k(b),f(!1)}),e.on("unregistered",()=>{y("Unregistered event"),d(!1),v.current&&A()}),e.on("incoming",a=>{if(w("Incoming call notification"),!a)return void y("Incoming notification with undefined call");let b={id:a.parameters?.CallSid||"unknown",state:"ringing",direction:"inbound",remoteNumber:a.parameters?.From||"Unknown",localNumber:a.parameters?.To||"",startTime:void 0,duration:0,isMuted:!1,isHeld:!1,isRecording:!1};o(b),s.current=a,D(a),t.current.onIncomingCall?.(b)}),r.current=e,e}catch(a){return x("Failed to initialize device:",a),null}},[A]),D=(0,g.useCallback)(a=>{a.on("accept",()=>{w("Call accepted"),o(a=>a?{...a,state:"active",startTime:new Date}:null)}),a.on("disconnect",()=>{w("Call disconnected"),n&&t.current.onCallEnded?.({...n,state:"ended"}),o(null),s.current=null}),a.on("cancel",()=>{w("Call cancelled"),o(null),s.current=null}),a.on("reject",()=>{w("Call rejected"),o(null),s.current=null}),a.on("error",a=>{x("Call error:",a)})},[n]),E=(0,g.useCallback)(async()=>{try{w("Starting connection..."),f(!0),k(null);let a=await C();if(!a){y("No access token available, aborting connection"),f(!1);return}w("Device initialized, calling register()..."),await a.register(),w("device.register() completed")}catch(a){x("Connection error in connect():",a),k(a instanceof Error?a.message:"Connection failed"),f(!1)}},[C]),F=(0,g.useCallback)(()=>{v.current=!1,u.current&&(clearTimeout(u.current),u.current=null),r.current&&(r.current.destroy(),r.current=null),d(!1),f(!1),i(!1),m(0),o(null),s.current=null},[]),G=(0,g.useCallback)(async(a,b)=>{let d=a=>{let b=a.replace(/\D/g,"");return 10===b.length?`+1${b}`:11===b.length&&b.startsWith("1")||b.length>10&&!a.startsWith("+")?`+${b}`:a.startsWith("+")?a:`+${b}`},e=d(a),f=b?d(b):void 0;if(w("makeCall:",{destination:a,normalizedDestination:e,callerIdNumber:b,normalizedCallerId:f,isConnected:c,hasDevice:!!r.current}),!(r.current&&c))throw x("makeCall: Not connected to Twilio"),Error("Not connected to Twilio");try{w("Calling connect()...");let c=await r.current.connect({params:{To:e,From:f}});w("connect() returned:",{callSid:c?.parameters?.CallSid}),s.current=c;let d={id:c.parameters?.CallSid||"unknown",state:"connecting",direction:"outbound",remoteNumber:a,localNumber:b||"",duration:0,isMuted:!1,isHeld:!1,isRecording:!1};return o(d),D(c),c}catch(a){throw x("makeCall error:",a),a}},[c,D]),H=(0,g.useCallback)(async()=>{if(!s.current)throw Error("No active call to answer");await s.current.accept()},[]),I=(0,g.useCallback)(async()=>{if(!s.current)throw Error("No active call to end");await s.current.disconnect(),o(null),s.current=null},[]),J=(0,g.useCallback)(async()=>{if(!s.current)throw Error("No active call to mute");s.current.mute(!0),o(a=>a?{...a,isMuted:!0}:null)},[]),K=(0,g.useCallback)(async()=>{if(!s.current)throw Error("No active call to unmute");s.current.mute(!1),o(a=>a?{...a,isMuted:!1}:null)},[]),L=(0,g.useCallback)(async()=>{if(!s.current)throw Error("No active call to hold");s.current.mute(!0),o(a=>a?{...a,isHeld:!0,isMuted:!0}:null),y("Hold is simulated via mute - use server-side control for real hold")},[]),M=(0,g.useCallback)(async()=>{if(!s.current)throw Error("No active call to unhold");s.current.mute(!1),o(a=>a?{...a,isHeld:!1,isMuted:!1}:null)},[]),N=(0,g.useCallback)(async a=>{if(!s.current)throw Error("No active call");s.current.sendDigits(a)},[]),O=(0,g.useCallback)(async a=>{if(!r.current)throw Error("No device initialized");await r.current.audio?.speakerDevices?.set(a)},[]),P=(0,g.useCallback)(async()=>{if("undefined"!=typeof navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)try{let a=(await navigator.mediaDevices.enumerateDevices()).filter(a=>"audiooutput"===a.kind);q(a)}catch{}},[]);return(0,g.useEffect)(()=>{if("undefined"==typeof navigator||!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return()=>{};P();let a=()=>{P()};return navigator.mediaDevices.addEventListener("devicechange",a),()=>{navigator.mediaDevices&&navigator.mediaDevices.removeEventListener("devicechange",a)}},[P]),(0,g.useEffect)(()=>(t.current.autoConnect&&E(),()=>{F()}),[E,F]),{isConnected:c,isConnecting:e,isReconnecting:h,connectionError:j,reconnectAttempts:l,currentCall:n,makeCall:G,answerCall:H,endCall:I,muteCall:J,unmuteCall:K,holdCall:L,unholdCall:M,sendDTMF:N,connect:E,disconnect:F,reconnect:B,audioDevices:p,setAudioDevice:O}}({accessToken:process.env.NEXT_PUBLIC_TWILIO_ACCESS_TOKEN||"",autoConnect:!1}).currentCall,updateInterval:2e3}),[D,E]=(0,g.useState)(!1),[F,G]=(0,g.useState)(!1),[H,I]=(0,g.useState)(0),[J,K]=(0,g.useState)(!1),[L,M]=(0,g.useState)(k?.get("companyId")??null),[N,O]=(0,g.useState)("schedule"),[P,Q]=(0,g.useState)(!1),[R,T]=(0,g.useState)(!1),[U,V]=(0,g.useState)(),[W,X]=(0,g.useState)(),[Y,Z]=(0,g.useState)(""),$=(0,g.useRef)(null),_=(0,g.useCallback)(()=>{},[]),aa=(0,g.useCallback)(()=>{O("schedule")},[]),ab=(0,g.useCallback)(()=>{},[]),ac=(0,g.useCallback)(()=>{},[]),ae=(0,g.useCallback)(()=>{},[]),af=(0,g.useCallback)(()=>{},[]);(0,g.useEffect)(()=>{l&&(br({type:"CALL_POP_OUT_READY",callId:l,timestamp:Date.now()}),E(!0),n&&x({callControlId:l,callSessionId:l,direction:n}))},[l,n,x]),(0,g.useEffect)(()=>{l&&(async()=>{G(!0);try{let b,c=L??k?.get("companyId")??null;if(c&&!L&&M(c),!c)try{let{createClient:b}=await a.A(926807),d=b();if(!d)return;let{data:{user:e},error:f}=await d.auth.getUser();if(f)return void console.error("Call window: Failed to get user:",f.message);if(e){let{data:a,error:b}=await d.from("company_memberships").select("company_id, status, joined_at").eq("user_id",e.id).eq("status","active").order("joined_at",{ascending:!1});if(b)return void console.error("Call window: Failed to fetch team memberships:",b.message);if(Array.isArray(a)&&a.length>0){a.length;let b=a[0];b?.company_id&&(c=b.company_id,M(b.company_id))}}}catch(a){}if(!c)return void G(!1);if(m)b=await j(m,c);else{let a=o.caller?.number||k?.get("from");a&&(b=await i(a,c))}b?.success&&b.data&&w(b.data)}catch(a){}finally{G(!1)}})()},[l,m,o.caller?.number,k,w,L]),(0,g.useEffect)(()=>{if("active"!==o.status||!o.startTime)return;let a=setInterval(()=>{I(Math.floor((Date.now()-o.startTime)/1e3))},1e3);return()=>clearInterval(a)},[o.status,o.startTime]),(0,g.useEffect)(()=>{let a=a=>{var b;if(a.origin!==window.location.origin||!("object"==typeof(b=a.data)&&null!==b&&"string"==typeof b.type&&"string"==typeof b.callId&&["CALL_STATE_INIT","CALL_STATE_SYNC","CALL_POP_OUT_READY","CALL_POP_OUT_CLOSED","CALL_ACTION","TRANSCRIPT_ENTRY","TRANSCRIPT_UPDATE","AI_EXTRACTION_UPDATE","FORM_DATA_UPDATE","REQUEST_FORM_DATA","FORM_DATA_SYNC","CUSTOMER_DATA_UPDATE"].includes(b.type)))return;let c=a.data;switch(c.type){case"CALL_STATE_SYNC":c.callData;break;case"CALL_ACTION":"end"===c.action?(q(),A()):"mute"===c.action?r():"unmute"===c.action&&r();break;case"TRANSCRIPT_UPDATE":break;case"CUSTOMER_DATA_UPDATE":c.customerData&&w(c.customerData)}};return window.addEventListener("message",a),()=>window.removeEventListener("message",a)},[q,r,A,w]);let ag=(0,g.useCallback)(a=>{if(l)switch(a){case"mute":case"unmute":r(),br({type:"CALL_ACTION",callId:l,action:o.isMuted?"unmute":"mute",timestamp:Date.now()});break;case"hold":case"unhold":o.isOnHold?V(void 0):V(Date.now()),s(),br({type:"CALL_ACTION",callId:l,action:o.isOnHold?"unhold":"hold",timestamp:Date.now()});break;case"record_start":case"record_stop":o.isRecording?X(void 0):X(Date.now()),t(),br({type:"CALL_ACTION",callId:l,action:o.isRecording?"record_stop":"record_start",timestamp:Date.now()});break;case"end":T(!0);break;case"force_end":q(),A(),br({type:"CALL_ACTION",callId:l,action:"end",timestamp:Date.now()}),setTimeout(()=>window.close(),500)}},[l,o.isMuted,o.isOnHold,o.isRecording,r,s,t,q,A]),ah=(0,g.useCallback)(a=>{Z(a.notes),ag("force_end"),T(!1)},[ag]),ai=(0,g.useCallback)(()=>{T(!1)},[]),aj=(0,g.useCallback)(()=>{l&&("off"===o.videoStatus?(u(),br({type:"CALL_ACTION",callId:l,action:"video_on",timestamp:Date.now()})):(v(),br({type:"CALL_ACTION",callId:l,action:"video_off",timestamp:Date.now()})))},[l,o.videoStatus,u,v]),ak=(0,g.useCallback)(()=>{K(!0)},[]),al=(0,g.useCallback)(()=>{window.close()},[]);if(!function(a,b={}){let{enabled:c=!0,onShortcutTriggered:d}=b;(0,g.useRef)(!1);let e=(0,g.useCallback)(()=>{let a=document.activeElement;if(!a)return!1;let b=a.tagName.toLowerCase(),c="true"===a.getAttribute("contenteditable");return"input"===b||"textarea"===b||c},[]),f=(0,g.useCallback)(b=>{if(!c)return;if(e()){"Escape"===b.key&&(b.preventDefault(),a.onEscape?.(),d?.("escape"));return}let f=b.key.toLowerCase(),g=b.ctrlKey||b.metaKey,h=b.shiftKey;if(!b.altKey){if(g)return;if(h&&"e"===f){b.preventDefault(),a.onEndCall?.(),d?.("end_call");return}switch(f){case"m":b.preventDefault(),a.onToggleMute?.(),d?.("toggle_mute");break;case"h":b.preventDefault(),a.onToggleHold?.(),d?.("toggle_hold");break;case"r":b.preventDefault(),a.onToggleRecording?.(),d?.("toggle_recording");break;case"t":b.preventDefault(),a.onTransfer?.(),d?.("transfer");break;case"j":b.preventDefault(),a.onCreateJob?.(),d?.("create_job");break;case"a":b.preventDefault(),a.onScheduleAppointment?.(),d?.("schedule_appointment");break;case"n":b.preventDefault(),a.onFocusNotes?.(),d?.("focus_notes");break;case"s":b.preventDefault(),a.onSendSMS?.(),d?.("send_sms");break;case"e":h||(b.preventDefault(),a.onSendEmail?.(),d?.("send_email"));break;case"1":b.preventDefault(),a.onViewTranscript?.(),d?.("view_transcript");break;case"2":b.preventDefault(),a.onViewSchedule?.(),d?.("view_schedule");break;case"?":case"/":b.preventDefault(),a.onShowHelp?.(),d?.("show_help");break;case"escape":b.preventDefault(),a.onEscape?.(),d?.("escape")}}},[c,e,a,d]);(0,g.useEffect)(()=>(window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)),[f])}({onToggleMute:()=>ag(o.isMuted?"unmute":"mute"),onToggleHold:()=>ag(o.isOnHold?"unhold":"hold"),onToggleRecording:()=>ag(o.isRecording?"record_stop":"record_start"),onEndCall:()=>ag("end"),onCreateJob:_,onScheduleAppointment:aa,onSendSMS:ab,onSendEmail:ac,onFocusNotes:af,onShowHelp:()=>Q(!0),onViewTranscript:()=>O("transcript"),onViewSchedule:()=>O("schedule"),onEscape:()=>{P&&Q(!1),R&&T(!1)}},{enabled:"active"===o.status}),!l)return(0,b.jsx)("div",{className:"bg-background flex h-screen items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(c.AlertCircle,{className:"text-destructive mx-auto mb-4 h-12 w-12"}),(0,b.jsx)("h1",{className:"mb-2 text-2xl font-bold",children:"Invalid Call"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"No call ID provided"})]})});let am="active"===o.status,ao=o.customerData,ap=ao?.customer?.first_name&&ao?.customer?.last_name?`${ao.customer.first_name} ${ao.customer.last_name}`.trim():ao?.customer?.first_name?ao.customer.first_name:o.caller?.name||"Unknown Caller",aq=ao?.customer?.phone||o.caller?.number||"No number";return(0,b.jsxs)("div",{className:"bg-background flex h-screen flex-col",children:[(0,b.jsx)(bo.SkipLink,{}),(0,b.jsx)(S,{callDuration:(h=Math.floor(H/60),`${h}:${(H%60).toString().padStart(2,"0")}`),callerName:ap,callerNumber:aq,callId:l,connectionQuality:B||"unknown",customerData:ao,isActive:am,isMuted:o.isMuted,isOnHold:o.isOnHold,isRecording:o.isRecording,holdStartTime:U,recordingStartTime:W,onClose:al,onEndCall:()=>ag("end"),onHoldToggle:()=>ag(o.isOnHold?"unhold":"hold"),onMuteToggle:()=>ag(o.isMuted?"unmute":"mute"),onRecordToggle:()=>ag(o.isRecording?"record_stop":"record_start"),onTransfer:ak,onVideoToggle:aj,onShowShortcuts:()=>Q(!0),videoStatus:o.videoStatus}),(0,b.jsxs)("main",{id:"main-content",ref:$,className:"flex flex-1 overflow-hidden",role:"main","aria-label":"Call window main content",children:[(0,b.jsxs)("section",{className:"bg-muted/20 flex w-[35%] flex-col","aria-label":"transcript"===N?"Call transcript":"Schedule view",children:[(0,b.jsxs)("div",{className:"bg-card/50 flex border-b",role:"tablist","aria-label":"View selection",children:[(0,b.jsxs)(z.Button,{className:"flex-1 rounded-none border-r",onClick:()=>O("transcript"),size:"sm",variant:"transcript"===N?"secondary":"ghost",role:"tab","aria-selected":"transcript"===N,"aria-controls":"left-panel-content",children:[(0,b.jsx)(e.MessageSquare,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),"Transcript",(0,b.jsx)("span",{className:"sr-only",children:"(Press T)"})]}),(0,b.jsxs)(z.Button,{className:"flex-1 rounded-none",onClick:()=>O("schedule"),size:"sm",variant:"schedule"===N?"secondary":"ghost",role:"tab","aria-selected":"schedule"===N,"aria-controls":"left-panel-content",children:[(0,b.jsx)(d.CalendarDays,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),"Schedule",(0,b.jsx)("span",{className:"sr-only",children:"(Press S)"})]})]}),(0,b.jsx)("div",{id:"left-panel-content",className:"flex-1 overflow-hidden",role:"tabpanel","aria-label":"transcript"===N?"Call transcript panel":"Schedule panel",children:"transcript"===N?(0,b.jsx)(bn,{}):(0,b.jsx)(an,{companyId:L||void 0})})]}),(0,b.jsx)("section",{className:"flex-1 overflow-hidden","aria-label":"Customer information",children:(0,b.jsx)(a1,{customerData:ao,isLoading:F,onCreateJob:_,onScheduleAppointment:aa,onSendSMS:ab,onSendEmail:ac,onTakePayment:ae,onAddNote:af})})]}),(0,b.jsx)(a6,{open:P,onOpenChange:Q}),(0,b.jsx)(ad,{open:R,onOpenChange:T,onComplete:ah,onCancel:ai,callDuration:H,customerName:ap,existingNotes:Y})]})}function bt(){return(0,b.jsx)(g.Suspense,{fallback:(0,b.jsx)(bg,{}),children:(0,b.jsx)(bs,{})})}a.s(["default",()=>bt],722819)}];

//# sourceMappingURL=apps_web_src_app_call_page_tsx_888022b1._.js.map