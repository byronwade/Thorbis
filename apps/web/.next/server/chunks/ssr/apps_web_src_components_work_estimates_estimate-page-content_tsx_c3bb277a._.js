module.exports=[122180,a=>{"use strict";var b=a.i(861467),c=a.i(587969),d=a.i(874544),e=a.i(319895),f=a.i(10348),g=a.i(949747),h=a.i(757844),i=a.i(688014),j=a.i(320091),k=a.i(145679),l=a.i(337241),m=a.i(783281),n=a.i(156916),o=a.i(761447),p=a.i(856218),q=a.i(836994),r=a.i(949729);a.i(288007);var s=a.i(986990);a.i(445255);var t=a.i(18170);a.i(19256);var u=a.i(417132);a.i(458393);var v=a.i(82012);a.i(897618);var w=a.i(709929);a.i(476036);var x=a.i(930514);a.i(319168);var y=a.i(196935),z=a.i(151183);function A(a){return null==a?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a/100)}function B({entityData:a}){var B;let C,D=(0,l.useRouter)(),[E,F]=(0,m.useState)(null),[G,H]=(0,m.useState)(!1),{estimate:I,customer:J,job:K,invoice:L,contract:M,notes:N=[],activities:O=[],attachments:P=[]}=a,Q=(0,m.useMemo)(()=>I?.estimate_tags?I.estimate_tags.map(a=>({id:a.id,name:a.name,slug:a.slug,color:a.color,category:a.category,icon:a.icon})):[],[I?.estimate_tags]),R=(0,m.useMemo)(()=>({1:()=>{let a=document.querySelector('[data-section-id="workflow-timeline"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},2:()=>{let a=document.querySelector('[data-section-id="estimate-details"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},3:()=>{let a=document.querySelector('[data-section-id="line-items"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},4:()=>{let a=document.querySelector('[data-section-id="customer"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},5:()=>{let a=document.querySelector('[data-section-id="job"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}},9:()=>{let a=document.querySelector('[data-section-id="tags"]');if(a){a.scrollIntoView({behavior:"smooth",block:"start"});let b=a.querySelector("[data-accordion-trigger]");b&&"closed"===b.getAttribute("data-state")&&b.click()}}}),[]);(0,z.useSectionShortcuts)(R);let S=async()=>{if(E){H(!0);try{let a=await (0,p.unlinkJobFromEstimate)(I.id);a.success?(n.toast.success("Job unlinked from estimate"),F(null),D.refresh()):n.toast.error(a.error||"Failed to unlink job")}catch(a){n.toast.error("Failed to unlink job")}finally{H(!1)}}},T=I.line_items?"string"==typeof I.line_items?JSON.parse(I.line_items):I.line_items:[],U=[(B=I.status||"draft",C=({draft:{className:"bg-muted text-foreground dark:bg-foreground/20 dark:text-muted-foreground",label:"Draft"},sent:{className:"bg-primary text-primary dark:bg-primary/20 dark:text-primary",label:"Sent"},viewed:{className:"bg-accent text-accent-foreground dark:bg-accent/20 dark:text-accent-foreground",label:"Viewed"},accepted:{className:"bg-success text-white",label:"Accepted"},declined:{className:"bg-destructive text-white",label:"Declined"},expired:{className:"bg-warning text-white",label:"Expired"}})[B]||{className:"bg-muted text-foreground",label:B},(0,b.jsx)(s.Badge,{className:C.className,variant:"outline",children:C.label},"status"))],V=(0,b.jsx)("div",{className:"w-full px-2 sm:px-0",children:(0,b.jsx)("div",{className:"bg-muted/50 rounded-md shadow-sm",children:(0,b.jsxs)("div",{className:"flex flex-col gap-4 p-4 sm:p-6",children:[(0,b.jsx)("div",{className:"flex flex-col gap-6 sm:flex-row sm:items-start sm:justify-between",children:(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:U}),(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold sm:text-3xl",children:I.title||`Estimate ${I.estimate_number||I.id.slice(0,8)}`}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm sm:text-base",children:A(I.total_amount)})]})]})}),J&&(0,b.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:(0,b.jsxs)(k.default,{className:"border-border/60 bg-background hover:border-primary/50 hover:bg-primary/5 inline-flex items-center gap-2 rounded-full border px-4 py-2 text-sm font-medium transition-colors",href:`/dashboard/customers/${J.id}`,children:[(0,b.jsx)(j.User,{className:"size-4"}),J.display_name||`${J.first_name||""} ${J.last_name||""}`.trim()||"Unknown Customer"]})}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[I.valid_until&&(0,b.jsxs)("div",{className:"bg-muted inline-flex items-center gap-2 rounded-full px-3 py-1 text-sm",children:[(0,b.jsx)(c.Calendar,{className:"text-muted-foreground size-4"}),(0,b.jsxs)("span",{className:"font-medium",children:["Valid until"," ",new Date(I.valid_until).toLocaleDateString()]})]}),K&&(0,b.jsxs)(k.default,{className:"bg-muted hover:bg-muted/80 inline-flex items-center gap-2 rounded-full px-3 py-1 text-sm transition-colors",href:`/dashboard/work/${K.id}`,children:[(0,b.jsx)(e.FileText,{className:"text-muted-foreground size-4"}),(0,b.jsxs)("span",{className:"font-medium",children:["Job #",K.job_number]})]})]})]})})}),W=(0,m.useMemo)(()=>{let a=[];if(M||L){let c=[{id:"estimate",label:"Estimate Created",status:"completed",date:I.created_at,href:`/dashboard/work/estimates/${I.id}`,description:"accepted"===I.status?"Accepted by customer":void 0},{id:"contract",label:"Contract Generated",status:M?"completed":"pending",date:M?.created_at,href:M?`/dashboard/work/contracts/${M.id}`:void 0,description:M?.status==="signed"?"Signed":M?"Pending signature":void 0},{id:"invoice",label:"Invoice Created",status:L?"completed":"pending",date:L?.created_at,href:L?`/dashboard/work/invoices/${L.id}`:void 0,description:L?.status==="paid"?"Paid in full":L?`Status: ${L.status}`:void 0},{id:"payment",label:"Payment Received",status:L?.status==="paid"?"completed":L?"current":"pending",date:L?.paid_at,description:L?.paid_at?"Completed":L?`Balance: ${A(L.balance_amount)}`:void 0}];a.push({id:"workflow-timeline",title:"Sales Workflow",icon:(0,b.jsx)(i.TrendingUp,{className:"size-4"}),defaultOpen:!0,content:(0,b.jsx)(x.UnifiedAccordionContent,{children:(0,b.jsx)(y.WorkflowTimeline,{stages:c})})})}return a.push({id:"line-items",title:"Line Items",icon:(0,b.jsx)(e.FileText,{className:"size-4"}),count:T.length,defaultOpen:!(M||L),content:(0,b.jsx)(x.UnifiedAccordionContent,{children:T.length>0?(0,b.jsx)("div",{className:"-mx-4 overflow-x-auto sm:mx-0",children:(0,b.jsxs)(w.Table,{children:[(0,b.jsx)(w.TableHeader,{children:(0,b.jsxs)(w.TableRow,{children:[(0,b.jsx)(w.TableHead,{children:"Description"}),(0,b.jsx)(w.TableHead,{className:"text-right",children:"Quantity"}),(0,b.jsx)(w.TableHead,{className:"text-right",children:"Unit Price"}),(0,b.jsx)(w.TableHead,{className:"text-right",children:"Total"})]})}),(0,b.jsxs)(w.TableBody,{children:[T.map((a,c)=>(0,b.jsxs)(w.TableRow,{children:[(0,b.jsx)(w.TableCell,{className:"font-medium",children:a.description||a.name||"Item"}),(0,b.jsx)(w.TableCell,{className:"text-right",children:a.quantity||1}),(0,b.jsx)(w.TableCell,{className:"text-right",children:A(a.unit_price||a.unitPrice||a.price||0)}),(0,b.jsx)(w.TableCell,{className:"text-right font-semibold",children:A((a.quantity||1)*(a.unit_price||a.unitPrice||a.price||0))})]},c)),(0,b.jsxs)(w.TableRow,{className:"bg-muted/50 border-t-2",children:[(0,b.jsx)(w.TableCell,{className:"text-right font-semibold",colSpan:3,children:"Subtotal"}),(0,b.jsx)(w.TableCell,{className:"text-right font-semibold",children:A(I.subtotal||0)})]}),I.tax_amount>0&&(0,b.jsxs)(w.TableRow,{children:[(0,b.jsxs)(w.TableCell,{className:"text-right",colSpan:3,children:["Tax (",I.tax_rate||0,"%)"]}),(0,b.jsx)(w.TableCell,{className:"text-right",children:A(I.tax_amount||0)})]}),I.discount_amount>0&&(0,b.jsxs)(w.TableRow,{children:[(0,b.jsx)(w.TableCell,{className:"text-right",colSpan:3,children:"Discount"}),(0,b.jsxs)(w.TableCell,{className:"text-right",children:["-",A(I.discount_amount||0)]})]}),(0,b.jsxs)(w.TableRow,{className:"bg-muted/50 border-t-2",children:[(0,b.jsx)(w.TableCell,{className:"text-right text-lg font-bold",colSpan:3,children:"Total"}),(0,b.jsx)(w.TableCell,{className:"text-right text-lg font-bold",children:A(I.total_amount||0)})]})]})]})}):(0,b.jsx)("div",{className:"flex h-64 items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(e.FileText,{className:"text-muted-foreground/50 mx-auto size-12"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-4 text-sm",children:"No line items yet"})]})})})}),I.terms&&a.push({id:"terms",title:"Terms & Conditions",icon:(0,b.jsx)(d.FileCheck,{className:"size-4"}),content:(0,b.jsx)(x.UnifiedAccordionContent,{children:(0,b.jsx)("div",{className:"space-y-3",children:(0,b.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:I.terms})})})}),I.valid_until&&a.push({id:"validity",title:"Validity",icon:(0,b.jsx)(c.Calendar,{className:"size-4"}),content:(0,b.jsx)(x.UnifiedAccordionContent,{children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(v.Label,{children:"Valid Until"}),(0,b.jsx)("p",{className:"text-sm",children:new Date(I.valid_until).toLocaleDateString()})]}),"accepted"===I.status&&I.accepted_at&&(0,b.jsxs)("div",{children:[(0,b.jsx)(v.Label,{children:"Accepted At"}),(0,b.jsx)("p",{className:"text-sm",children:new Date(I.accepted_at).toLocaleString()})]}),"declined"===I.status&&I.declined_at&&(0,b.jsxs)("div",{children:[(0,b.jsx)(v.Label,{children:"Declined At"}),(0,b.jsx)("p",{className:"text-sm",children:new Date(I.declined_at).toLocaleString()}),I.decline_reason&&(0,b.jsxs)("div",{className:"mt-2",children:[(0,b.jsx)(v.Label,{children:"Decline Reason"}),(0,b.jsx)("p",{className:"text-sm",children:I.decline_reason})]})]})]})})}),J&&a.push({id:"customer-details",title:"Customer Details",icon:(0,b.jsx)(j.User,{className:"size-4"}),content:(0,b.jsx)(x.UnifiedAccordionContent,{children:(0,b.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[(0,b.jsxs)("div",{className:"grid flex-1 gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(v.Label,{children:"Name"}),(0,b.jsx)("p",{className:"text-sm",children:J.display_name||`${J.first_name||""} ${J.last_name||""}`.trim()||"Unknown"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(v.Label,{children:"Email"}),(0,b.jsx)("p",{className:"text-sm",children:J.email||"N/A"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(v.Label,{children:"Phone"}),(0,b.jsx)("p",{className:"text-sm",children:J.phone||"N/A"})]})]}),(0,b.jsx)(t.Button,{asChild:!0,size:"sm",variant:"ghost",children:(0,b.jsx)(k.default,{href:`/dashboard/customers/${J.id}`,children:"View Full Profile"})})]})})}),K&&a.push({id:"job-details",title:"Related Job",icon:(0,b.jsx)(e.FileText,{className:"size-4"}),content:(0,b.jsx)(x.UnifiedAccordionContent,{children:(0,b.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[(0,b.jsxs)("div",{className:"grid flex-1 gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(v.Label,{children:"Job Number"}),(0,b.jsxs)("p",{className:"text-sm",children:["#",K.job_number||K.id.slice(0,8)]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(v.Label,{children:"Title"}),(0,b.jsx)("p",{className:"text-sm",children:K.title||"N/A"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(t.Button,{asChild:!0,size:"sm",variant:"ghost",children:(0,b.jsx)(k.default,{href:`/dashboard/work/${K.id}`,children:"View Job"})}),(0,b.jsxs)(t.Button,{onClick:()=>F(K.id),size:"sm",variant:"outline",children:[(0,b.jsx)(f.Link2Off,{className:"mr-2 size-4"}),"Unlink"]})]})]})})}),L&&a.push({id:"invoice-details",title:"Related Invoice",icon:(0,b.jsx)(h.Receipt,{className:"size-4"}),content:(0,b.jsx)(x.UnifiedAccordionContent,{children:(0,b.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[(0,b.jsxs)("div",{className:"grid flex-1 gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(v.Label,{children:"Invoice Number"}),(0,b.jsxs)("p",{className:"text-sm",children:["#",L.invoice_number||L.id.slice(0,8)]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(v.Label,{children:"Invoice Amount"}),(0,b.jsx)("p",{className:"text-sm",children:A(L.total_amount)})]})]}),(0,b.jsx)(t.Button,{asChild:!0,size:"sm",variant:"ghost",children:(0,b.jsx)(k.default,{href:`/dashboard/work/invoices/${L.id}`,children:"View Invoice"})})]})})}),a.push({id:"tags",title:"Tags",icon:(0,b.jsx)(g.Package,{className:"size-4"}),content:(0,b.jsx)(x.UnifiedAccordionContent,{children:(0,b.jsx)("div",{className:"w-full",children:(0,b.jsx)("div",{className:"bg-muted/50 rounded-md",children:(0,b.jsxs)("div",{className:"flex flex-col gap-3 p-4",children:[(0,b.jsx)("span",{className:"text-muted-foreground text-xs font-medium",children:"Organize estimates with tags:"}),(0,b.jsx)(r.EntityTags,{entityId:I.id,entityType:"estimate",onUpdateTags:async(a,b)=>{let c=await (0,o.updateEntityTags)("estimate",a,b);c.success?D.refresh():n.toast.error(c.error||"Failed to update tags")},tags:Q})]})})})})}),a},[I,J,K,L,M,T,Q,D]),X=(0,m.useMemo)(()=>{let a=[];return J&&a.push({id:`customer-${J.id}`,type:"customer",title:J.display_name||`${J.first_name||""} ${J.last_name||""}`.trim()||"Unknown Customer",subtitle:J.email||J.phone||void 0,href:`/dashboard/customers/${J.id}`}),K&&a.push({id:`job-${K.id}`,type:"job",title:K.title||`Job #${K.job_number||K.id.slice(0,8)}`,subtitle:K.status,href:`/dashboard/work/${K.id}`,badge:K.status?{label:K.status,variant:"outline"}:void 0}),L&&a.push({id:`invoice-${L.id}`,type:"invoice",title:`Invoice #${L.invoice_number||L.id.slice(0,8)}`,subtitle:A(L.total_amount),href:`/dashboard/work/invoices/${L.id}`,badge:L.status?{label:L.status,variant:"outline"}:void 0}),a},[J,K,L]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.DetailPageContentLayout,{activities:O,attachments:P,customHeader:V,customSections:W,defaultOpenSection:"line-items",notes:N,relatedItems:X,showStandardSections:{activities:!0,notes:!0,attachments:!0,relatedItems:!0}}),(0,b.jsx)(u.Dialog,{onOpenChange:a=>!a&&F(null),open:null!==E,children:(0,b.jsxs)(u.DialogContent,{children:[(0,b.jsxs)(u.DialogHeader,{children:[(0,b.jsx)(u.DialogTitle,{children:"Unlink Job from Estimate?"}),(0,b.jsx)(u.DialogDescription,{children:"This will remove the job association from this estimate. The estimate will remain in the system but will no longer appear on the job's page."})]}),(0,b.jsxs)(u.DialogFooter,{children:[(0,b.jsx)(t.Button,{disabled:G,onClick:()=>F(null),variant:"outline",children:"Cancel"}),(0,b.jsx)(t.Button,{disabled:G,onClick:S,variant:"destructive",children:G?"Unlinking...":"Unlink Job"})]})]})})]})}a.s(["EstimatePageContent",()=>B])}];

//# sourceMappingURL=apps_web_src_components_work_estimates_estimate-page-content_tsx_c3bb277a._.js.map