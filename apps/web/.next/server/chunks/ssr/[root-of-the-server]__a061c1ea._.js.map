{"version":3,"sources":["../../../../../../apps/web/src/app/test-telnyx-config/page.tsx"],"sourcesContent":["import { createClient } from \"@/lib/supabase/server\";\n\n// Force dynamic rendering - this is a test/debug page with database queries\nexport const dynamic = \"force-dynamic\";\n\nconst TEST_COMPANY_ID = \"2b88a305-0ecd-4bff-9898-b166cc7937c4\";\n\nexport default async function TestTelnyxConfig() {\n\tconst supabase = await createClient();\n\n\t// Get company Telnyx settings\n\tconst { data: settings } = await supabase\n\t\t.from(\"company_telnyx_settings\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", TEST_COMPANY_ID)\n\t\t.single();\n\n\t// Get phone number\n\tconst { data: phoneNumber } = await supabase\n\t\t.from(\"phone_numbers\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", TEST_COMPANY_ID)\n\t\t.eq(\"status\", \"active\")\n\t\t.single();\n\n\t// Check environment variables (server-side only)\n\tconst env = {\n\t\thasTelnyxApiKey: !!process.env.TELNYX_API_KEY,\n\t\thasPublicSiteUrl: !!process.env.NEXT_PUBLIC_SITE_URL,\n\t\thasSiteUrl: !!process.env.SITE_URL,\n\t\tsiteUrl: process.env.NEXT_PUBLIC_SITE_URL || process.env.SITE_URL,\n\t\thasMessagingProfileId: !!(\n\t\t\tprocess.env.TELNYX_DEFAULT_MESSAGING_PROFILE_ID ||\n\t\t\tprocess.env.NEXT_PUBLIC_TELNYX_MESSAGING_PROFILE_ID\n\t\t),\n\t\thasConnectionId: !!(\n\t\t\tprocess.env.TELNYX_DEFAULT_CONNECTION_ID ||\n\t\t\tprocess.env.NEXT_PUBLIC_TELNYX_CONNECTION_ID\n\t\t),\n\t};\n\n\tconst allChecks = [\n\t\t{\n\t\t\tname: \"TELNYX_API_KEY\",\n\t\t\tstatus: env.hasTelnyxApiKey,\n\t\t\tmessage: env.hasTelnyxApiKey ? \"✅ Configured\" : \"❌ Missing\",\n\t\t},\n\t\t{\n\t\t\tname: \"Site URL (NEXT_PUBLIC_SITE_URL or SITE_URL)\",\n\t\t\tstatus: env.hasPublicSiteUrl || env.hasSiteUrl,\n\t\t\tmessage: env.siteUrl || \"❌ Missing\",\n\t\t},\n\t\t{\n\t\t\tname: \"Company Telnyx Settings\",\n\t\t\tstatus: !!settings,\n\t\t\tmessage: settings ? `✅ Found (${settings.status})` : \"❌ Missing\",\n\t\t},\n\t\t{\n\t\t\tname: \"Messaging Profile ID\",\n\t\t\tstatus: !!settings?.messaging_profile_id,\n\t\t\tmessage: settings?.messaging_profile_id || \"❌ Missing\",\n\t\t},\n\t\t{\n\t\t\tname: \"Call Control Application ID\",\n\t\t\tstatus: !!settings?.call_control_application_id,\n\t\t\tmessage: settings?.call_control_application_id || \"❌ Missing\",\n\t\t},\n\t\t{\n\t\t\tname: \"Default Outbound Number\",\n\t\t\tstatus: !!settings?.default_outbound_number,\n\t\t\tmessage: settings?.default_outbound_number || \"❌ Missing\",\n\t\t},\n\t\t{\n\t\t\tname: \"Phone Number in Database\",\n\t\t\tstatus: !!phoneNumber,\n\t\t\tmessage: phoneNumber?.phone_number || \"❌ Missing\",\n\t\t},\n\t\t{\n\t\t\tname: \"Phone Number Status\",\n\t\t\tstatus: phoneNumber?.status === \"active\",\n\t\t\tmessage: phoneNumber?.status || \"❌ Unknown\",\n\t\t},\n\t\t{\n\t\t\tname: \"Phone Number Features\",\n\t\t\tstatus:\n\t\t\t\tArray.isArray(phoneNumber?.features) && phoneNumber.features.length > 0,\n\t\t\tmessage: phoneNumber?.features?.join(\", \") || \"❌ None\",\n\t\t},\n\t\t{\n\t\t\tname: \"Telnyx Phone Number ID\",\n\t\t\tstatus: !!phoneNumber?.telnyx_phone_number_id,\n\t\t\tmessage: phoneNumber?.telnyx_phone_number_id || \"❌ Missing\",\n\t\t},\n\t\t{\n\t\t\tname: \"Telnyx Messaging Profile ID (Phone)\",\n\t\t\tstatus: !!phoneNumber?.telnyx_messaging_profile_id,\n\t\t\tmessage: phoneNumber?.telnyx_messaging_profile_id || \"❌ Missing\",\n\t\t},\n\t\t{\n\t\t\tname: \"Telnyx Connection ID (Phone)\",\n\t\t\tstatus: !!phoneNumber?.telnyx_connection_id,\n\t\t\tmessage: phoneNumber?.telnyx_connection_id || \"❌ Missing\",\n\t\t},\n\t];\n\n\tconst allPassing = allChecks.every((check) => check.status);\n\n\treturn (\n\t\t<div className=\"min-h-screen bg-background p-8\">\n\t\t\t<div className=\"max-w-4xl mx-auto\">\n\t\t\t\t<h1 className=\"text-4xl font-bold mb-2 text-foreground\">\n\t\t\t\t\tTelnyx Configuration Check\n\t\t\t\t</h1>\n\t\t\t\t<p className=\"text-muted-foreground mb-8\">\n\t\t\t\t\tCompany: Test Plumbing Company\n\t\t\t\t</p>\n\n\t\t\t\t<div\n\t\t\t\t\tclassName={`p-6 rounded-lg mb-8 border-2 ${allPassing ? \"bg-green-500/10 border-green-500\" : \"bg-red-500/10 border-red-500\"}`}\n\t\t\t\t>\n\t\t\t\t\t<h2 className=\"text-2xl font-bold mb-2 text-foreground\">\n\t\t\t\t\t\t{allPassing ? \"✅ All Checks Passed\" : \"❌ Some Checks Failed\"}\n\t\t\t\t\t</h2>\n\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t{allPassing\n\t\t\t\t\t\t\t? \"Telnyx is properly configured and ready to use.\"\n\t\t\t\t\t\t\t: \"Some configuration is missing or incorrect. See details below.\"}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"space-y-3\">\n\t\t\t\t\t{allChecks.map((check, i) => (\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\t\tclassName={`p-4 rounded-lg border ${check.status ? \"bg-green-500/5 border-green-500/20\" : \"bg-red-500/5 border-red-500/20\"}`}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t<h3 className=\"font-semibold text-foreground\">{check.name}</h3>\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclassName={`text-sm font-mono px-3 py-1 rounded ${check.status ? \"bg-green-500/20 text-green-500\" : \"bg-red-500/20 text-red-500\"}`}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{check.status ? \"PASS\" : \"FAIL\"}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<p className=\"text-sm mt-2 font-mono text-muted-foreground\">\n\t\t\t\t\t\t\t\t{check.message}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"mt-8 p-6 bg-muted/50 rounded-lg border border-border\">\n\t\t\t\t\t<h2 className=\"font-bold text-lg mb-4 text-foreground\">Raw Data</h2>\n\n\t\t\t\t\t<details className=\"mb-4 group\">\n\t\t\t\t\t\t<summary className=\"cursor-pointer font-semibold mb-2 text-foreground hover:text-primary transition-colors\">\n\t\t\t\t\t\t\tCompany Telnyx Settings\n\t\t\t\t\t\t</summary>\n\t\t\t\t\t\t<pre className=\"p-4 bg-background rounded-lg border border-border text-xs overflow-auto text-foreground\">\n\t\t\t\t\t\t\t{JSON.stringify(settings, null, 2)}\n\t\t\t\t\t\t</pre>\n\t\t\t\t\t</details>\n\n\t\t\t\t\t<details className=\"group\">\n\t\t\t\t\t\t<summary className=\"cursor-pointer font-semibold mb-2 text-foreground hover:text-primary transition-colors\">\n\t\t\t\t\t\t\tPhone Number Record\n\t\t\t\t\t\t</summary>\n\t\t\t\t\t\t<pre className=\"p-4 bg-background rounded-lg border border-border text-xs overflow-auto text-foreground\">\n\t\t\t\t\t\t\t{JSON.stringify(phoneNumber, null, 2)}\n\t\t\t\t\t\t</pre>\n\t\t\t\t\t</details>\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"mt-6 p-6 bg-primary/10 border border-primary/20 rounded-lg\">\n\t\t\t\t\t<h3 className=\"font-semibold mb-3 text-foreground text-lg\">\n\t\t\t\t\t\tNext Steps\n\t\t\t\t\t</h3>\n\t\t\t\t\t<ul className=\"space-y-2 text-sm text-foreground\">\n\t\t\t\t\t\t<li className=\"flex items-start gap-2\">\n\t\t\t\t\t\t\t<span className=\"text-primary\">•</span>\n\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\tIf all checks pass, try sending an SMS at{\" \"}\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\thref=\"/test-telnyx-send\"\n\t\t\t\t\t\t\t\t\tclassName=\"text-primary underline hover:text-primary/80 transition-colors font-semibold\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t/test-telnyx-send\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li className=\"flex items-start gap-2\">\n\t\t\t\t\t\t\t<span className=\"text-primary\">•</span>\n\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\tIf any checks fail, review the error messages and fix the\n\t\t\t\t\t\t\t\tconfiguration\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li className=\"flex items-start gap-2\">\n\t\t\t\t\t\t\t<span className=\"text-primary\">•</span>\n\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\tCheck your environment variables in{\" \"}\n\t\t\t\t\t\t\t\t<code className=\"px-2 py-0.5 bg-muted rounded text-xs\">\n\t\t\t\t\t\t\t\t\t.env.local\n\t\t\t\t\t\t\t\t</code>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li className=\"flex items-start gap-2\">\n\t\t\t\t\t\t\t<span className=\"text-primary\">•</span>\n\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\tVerify Telnyx account settings at{\" \"}\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\thref=\"https://portal.telnyx.com\"\n\t\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\t\t\t\tclassName=\"text-primary underline hover:text-primary/80 transition-colors font-semibold\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tportal.telnyx.com\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n"],"names":[],"mappings":"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"}