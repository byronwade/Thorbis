module.exports=[480315,a=>{"use strict";var b=a.i(861467),c=a.i(736398),d=a.i(769739),e=a.i(16555);function f(a,b,f){let g=(0,e.differenceInMilliseconds)(a,b)/d.millisecondsInMinute;return(0,c.getRoundingMethod)(f?.roundingMethod)(g)}var g=a.i(773608),h=a.i(483465),i=a.i(150035),j=a.i(805034),k=a.i(653095),l=a.i(204922),m=a.i(587969),n=a.i(21118),o=a.i(96250),p=a.i(624126),q=a.i(274956),r=a.i(984270),s=a.i(824124),t=a.i(699756),u=a.i(898062),v=a.i(638727),w=a.i(246840),x=a.i(739044),y=a.i(841269),z=a.i(159957),A=a.i(688014),B=a.i(976803),C=a.i(320091),D=a.i(362841),E=a.i(821278),F=a.i(145679),G=a.i(337241),H=a.i(783281);a.i(516775);var I=a.i(560272);a.i(288007);var J=a.i(986990);a.i(445255);var K=a.i(18170);a.i(380934);var L=a.i(347421);a.i(245561);var M=a.i(453607);a.i(413309);var N=a.i(54210),O=a.i(132440),P=a.i(700760);let Q={emergency:{icon:E.Zap,color:"text-red-500"},repair:{icon:D.Wrench,color:"text-orange-500"},installation:{icon:z.Target,color:"text-green-500"},maintenance:{icon:w.RefreshCw,color:"text-blue-500"},inspection:{icon:o.CheckCircle2,color:"text-cyan-500"},service:{icon:D.Wrench,color:"text-slate-500"}},R={scheduled:{label:"Scheduled",color:"bg-blue-500"},dispatched:{label:"Dispatched",color:"bg-sky-500"},"en-route":{label:"En Route",color:"bg-amber-500"},arrived:{label:"Arrived",color:"bg-emerald-500"},"in-progress":{label:"In Progress",color:"bg-violet-500"},completed:{label:"Completed",color:"bg-green-500"},closed:{label:"Closed",color:"bg-slate-500"},cancelled:{label:"Cancelled",color:"bg-red-500"}};function S(a){return a?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(a/100):"$0"}function T(a,b,c,d){if(!a||!b||!c||!d)return null;let e=(c-a)*Math.PI/180,f=(d-b)*Math.PI/180,g=Math.sin(e/2)*Math.sin(e/2)+Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(f/2)*Math.sin(f/2);return Math.round(2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g))*6371/40*60)}function U(a){return a?.property?.lat&&a?.property?.lon?{lat:a.property.lat,lng:a.property.lon}:a?.customer?.lat&&a?.customer?.lon?{lat:a.customer.lat,lng:a.customer.lon}:{}}function V({technician:a,appointments:c,unassignedJobs:d,gpsLocation:e,stats:o,companyId:E}){let V=(0,G.useRouter)(),[W,X]=(0,H.useState)(!1),[Y,Z]=(0,H.useState)(new Date),[$,_]=(0,H.useState)(e);(0,H.useEffect)(()=>{let a=setInterval(()=>Z(new Date),6e4);return()=>clearInterval(a)},[]),(0,H.useEffect)(()=>{let b=(0,O.createClient)(),c=b.channel(`technician-gps-${a.id}`).on("postgres_changes",{event:"*",schema:"public",table:"technician_locations",filter:`technician_id=eq.${a.id}`},a=>{a.new&&_(a.new)}).subscribe();return()=>{b.removeChannel(c)}},[a.id]);let aa=(0,H.useMemo)(()=>{let a=[],b=$?.lat,d=$?.lng;for(let e=0;e<c.length;e++){let f=c[e],g=new Date(f.scheduled_start),j=new Date(f.scheduled_end),k=U(f.job),l=T(b,d,k.lat,k.lng),m=(0,h.isAfter)(Y,j),n=(0,h.isAfter)(Y,g)&&(0,i.isBefore)(Y,j),o=!m&&!n&&(0===e||a[e-1]?.isPast||a[e-1]?.isCurrent);a.push({appointment:f,driveTimeFromPrev:l,distanceFromPrev:null,isNext:o,isPast:m,isCurrent:n}),k.lat&&k.lng&&(b=k.lat,d=k.lng)}return a},[c,$,Y]),ab=(0,H.useMemo)(()=>c.reduce((a,b)=>{let c=new Date(b.scheduled_start);return a+f(new Date(b.scheduled_end),c)},0),[c]),ac=(0,H.useMemo)(()=>$?d.map(a=>{let b=U(a);return{job:a,driveTime:T($.lat,$.lng,b.lat,b.lng)}}).filter(a=>null!==a.driveTime&&a.driveTime<45).sort((a,b)=>(a.driveTime||999)-(b.driveTime||999)).slice(0,5):[],[d,$]),ad=(0,H.useCallback)(()=>{X(!0),V.refresh(),setTimeout(()=>X(!1),1e3)},[V]),ae=Math.min(100,Math.round(ab/480*100));return(0,b.jsxs)("div",{className:"flex h-full flex-col bg-background",children:[(0,b.jsx)("div",{className:"border-b bg-card px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(K.Button,{variant:"ghost",size:"icon",onClick:()=>V.back(),className:"shrink-0",children:(0,b.jsx)(j.ArrowLeft,{className:"h-5 w-5"})}),(0,b.jsxs)(I.Avatar,{className:"h-14 w-14 border-2 border-primary/20",children:[a.avatar&&(0,b.jsx)(I.AvatarImage,{src:a.avatar,alt:a.name}),(0,b.jsx)(I.AvatarFallback,{className:"bg-primary/10 text-lg font-semibold text-primary",children:a.name.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2)})]}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h1",{className:"text-xl font-bold truncate",children:a.name}),(0,b.jsx)(J.Badge,{variant:"secondary",className:(0,P.cn)("shrink-0","available"===a.status&&"bg-green-100 text-green-700","busy"===a.status&&"bg-amber-100 text-amber-700","offline"===a.status&&"bg-slate-100 text-slate-700"),children:a.status||"Available"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[(0,b.jsx)("span",{children:a.role||"Technician"}),a.phone&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{children:"•"}),(0,b.jsxs)("a",{href:`tel:${a.phone}`,className:"flex items-center gap-1 hover:text-foreground",children:[(0,b.jsx)(u.Phone,{className:"h-3 w-3"}),a.phone]})]})]})]}),$&&(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-lg border bg-muted/30 px-3 py-2",children:[(0,b.jsx)(y.Signal,{className:"h-4 w-4 text-green-500"}),(0,b.jsxs)("div",{className:"text-xs",children:[(0,b.jsx)("div",{className:"font-medium",children:"GPS Active"}),(0,b.jsxs)("div",{className:"text-muted-foreground",children:["Updated ",(0,g.format)(new Date($.updated_at),"h:mm a")]})]}),void 0!==$.battery_level&&(0,b.jsxs)("div",{className:"flex items-center gap-1 border-l pl-2",children:[$.battery_level<.2?(0,b.jsx)(l.BatteryLow,{className:"h-4 w-4 text-red-500"}):(0,b.jsx)(k.Battery,{className:"h-4 w-4 text-green-500"}),(0,b.jsxs)("span",{className:"text-xs font-medium",children:[Math.round(100*$.battery_level),"%"]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(K.Button,{variant:"outline",size:"sm",onClick:ad,children:[(0,b.jsx)(w.RefreshCw,{className:(0,P.cn)("mr-2 h-4 w-4",W&&"animate-spin")}),"Refresh"]}),(0,b.jsxs)(K.Button,{size:"sm",children:[(0,b.jsx)(x.Send,{className:"mr-2 h-4 w-4"}),"Message"]})]})]})}),(0,b.jsx)("div",{className:"border-b bg-muted/30 px-6 py-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-8",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10",children:(0,b.jsx)(z.Target,{className:"h-5 w-5 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Today"}),(0,b.jsxs)("div",{className:"font-semibold",children:[o.todayCompleted,"/",o.todayTotal," Jobs"]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-blue-500/10",children:(0,b.jsx)(p.Clock,{className:"h-5 w-5 text-blue-500"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Utilization"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"font-semibold",children:[ae,"%"]}),(0,b.jsx)(M.Progress,{value:ae,className:"h-2 w-20"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-violet-500/10",children:(0,b.jsx)(m.Calendar,{className:"h-5 w-5 text-violet-500"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Time Booked"}),(0,b.jsxs)("div",{className:"font-semibold",children:[Math.floor(ab/60),"h"," ",ab%60,"m"]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-green-500/10",children:(0,b.jsx)(A.TrendingUp,{className:"h-5 w-5 text-green-500"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"This Month"}),(0,b.jsxs)("div",{className:"font-semibold",children:[o.monthCompleted," Jobs (",o.completionRate.toFixed(0),"%)"]})]})]}),(a.job_title||a.department)&&(0,b.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[a.job_title&&(0,b.jsx)(J.Badge,{variant:"secondary",className:"text-xs",children:a.job_title}),a.department&&(0,b.jsx)(J.Badge,{variant:"outline",className:"text-xs",children:a.department})]})]})}),(0,b.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,b.jsx)("div",{className:"flex-1 overflow-hidden border-r",children:(0,b.jsxs)("div",{className:"flex h-full flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between border-b px-6 py-3",children:[(0,b.jsxs)("h2",{className:"font-semibold",children:["Today's Route (",c.length," stops)"]}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:(0,g.format)(Y,"EEEE, MMMM d")})]}),(0,b.jsx)(N.ScrollArea,{className:"flex-1",children:(0,b.jsx)("div",{className:"p-6",children:0===aa.length?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,b.jsx)(m.Calendar,{className:"mb-4 h-12 w-12 text-muted-foreground/50"}),(0,b.jsx)("h3",{className:"text-lg font-medium",children:"No Jobs Scheduled"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"This technician has no appointments today"})]}):(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute left-6 top-0 bottom-0 w-0.5 bg-border"}),aa.map((a,c)=>{var d,e,h,i;let j,k=a.appointment,l=k.job,m=l?.customer,o=l?.property,p=new Date(k.scheduled_start),u=new Date(k.scheduled_end),v=f(u,p),w=Q[l?.job_type||"service"]||Q.service,x=R[k.status]||R.scheduled,y=w.icon;return(0,b.jsxs)("div",{className:"relative mb-6",children:[null!==a.driveTimeFromPrev&&c>0&&(0,b.jsxs)("div",{className:"mb-3 ml-12 flex items-center gap-2 text-xs text-muted-foreground",children:[(0,b.jsx)(n.Car,{className:"h-3 w-3"}),(0,b.jsxs)("span",{children:["~",a.driveTimeFromPrev," min drive"]})]}),(0,b.jsx)("div",{className:(0,P.cn)("absolute left-4 top-4 h-5 w-5 rounded-full border-2 border-background",a.isCurrent&&"bg-primary ring-4 ring-primary/20",a.isNext&&"bg-amber-500",a.isPast&&"bg-green-500",!a.isCurrent&&!a.isNext&&!a.isPast&&"bg-muted-foreground/30")}),(0,b.jsxs)("div",{className:(0,P.cn)("ml-12 rounded-lg border bg-card p-4 transition-all",a.isCurrent&&"border-primary/50 bg-primary/5 ring-2 ring-primary/20",a.isNext&&"border-amber-500/50 bg-amber-500/5"),children:[(0,b.jsxs)("div",{className:"mb-3 flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:(0,P.cn)("flex h-8 w-8 items-center justify-center rounded-lg",w.color.replace("text-","bg-")+"/10"),children:(0,b.jsx)(y,{className:(0,P.cn)("h-4 w-4",w.color)})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"font-semibold",children:[(0,g.format)(p,"h:mm a")," -"," ",(0,g.format)(u,"h:mm a")]}),(0,b.jsxs)(J.Badge,{variant:"secondary",className:"text-xs",children:[v," min"]})]}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground capitalize",children:l?.job_type?.replace("_"," ")||"Service"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:(0,P.cn)("h-2 w-2 rounded-full",x.color)}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:x.label})]})]}),(0,b.jsx)("h4",{className:"mb-2 font-medium",children:l?.title||"Service Call"}),(0,b.jsxs)("div",{className:"mb-3 space-y-1 text-sm",children:[m&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(C.User,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{children:m.display_name}),m.phone&&(0,b.jsx)("a",{href:`tel:${m.phone}`,className:"ml-auto text-xs text-primary hover:underline",children:m.phone})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,b.jsx)(s.MapPin,{className:"h-4 w-4 shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:(d=o?.address||m?.address,e=o?.city||m?.city,0===(j=[d,e,h=o?.state||m?.state,i=o?.zip_code||m?.zip_code].filter(Boolean)).length?"No address":j.length<=2?j.join(", "):`${d}, ${e}, ${h} ${i}`)})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between border-t pt-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[l?.total_amount&&(0,b.jsxs)("div",{className:"flex items-center gap-1 text-green-600",children:[(0,b.jsx)(q.DollarSign,{className:"h-4 w-4"}),S(l.total_amount)]}),l?.priority==="high"&&(0,b.jsx)(J.Badge,{variant:"destructive",className:"text-xs",children:"High Priority"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(K.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,b.jsxs)(F.default,{href:`/dashboard/work/jobs/${l?.id}`,children:[(0,b.jsx)(r.ExternalLink,{className:"mr-1 h-3 w-3"}),"View Job"]})}),(a.isCurrent||a.isNext)&&(0,b.jsxs)(K.Button,{size:"sm",children:[(0,b.jsx)(t.Navigation,{className:"mr-1 h-3 w-3"}),"Navigate"]})]})]})]})]},k.id)})]})})})]})}),(0,b.jsxs)("div",{className:"flex w-[450px] flex-col",children:[(0,b.jsxs)("div",{className:"border-b p-4",children:[(0,b.jsx)("h3",{className:"mb-3 font-semibold",children:"Route Map"}),(0,b.jsx)("div",{className:"flex h-[280px] items-center justify-center rounded-lg border bg-muted/30",children:(0,b.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,b.jsx)(s.MapPin,{className:"mx-auto mb-2 h-8 w-8"}),(0,b.jsx)("p",{className:"text-sm",children:"Map integration coming soon"}),$&&(0,b.jsxs)("p",{className:"mt-1 text-xs",children:["GPS: ",$.lat.toFixed(4),", ",$.lng.toFixed(4)]})]})})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Nearby Unassigned"}),(0,b.jsx)(J.Badge,{variant:"secondary",children:ac.length})]}),(0,b.jsx)(N.ScrollArea,{className:"h-full",children:(0,b.jsx)("div",{className:"p-4 space-y-3",children:0===ac.length?(0,b.jsxs)("div",{className:"py-8 text-center text-muted-foreground",children:[(0,b.jsx)(B.Truck,{className:"mx-auto mb-2 h-8 w-8 opacity-50"}),(0,b.jsx)("p",{className:"text-sm",children:"No nearby jobs available"})]}):ac.map(({job:a,driveTime:c})=>(0,b.jsx)(L.Card,{className:"p-3",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded bg-muted",children:(0,b.jsx)(D.Wrench,{className:"h-4 w-4 text-muted-foreground"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("h4",{className:"truncate text-sm font-medium",children:a.title}),(0,b.jsx)("p",{className:"truncate text-xs text-muted-foreground",children:a.customer?.display_name}),(0,b.jsxs)("div",{className:"mt-1 flex items-center gap-2 text-xs text-muted-foreground",children:[(0,b.jsx)(n.Car,{className:"h-3 w-3"}),(0,b.jsxs)("span",{children:["~",c," min"]}),a.total_amount&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{children:"•"}),(0,b.jsx)("span",{className:"text-green-600",children:S(a.total_amount)})]})]})]}),(0,b.jsxs)(K.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(v.Plus,{className:"mr-1 h-3 w-3"}),"Add"]})]})},a.id))})})]})]})]})]})}a.s(["TechnicianDayView",()=>V],480315)}];

//# sourceMappingURL=35d4f_%28dashboard%29_dashboard_schedule_technician_%5Bid%5D_technician-day-view_tsx_28c88f8e._.js.map