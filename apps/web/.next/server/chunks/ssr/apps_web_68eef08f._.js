module.exports=[398906,a=>{"use strict";var b=a.i(780195),c=a.i(136874);a.i(467361);var d=a.i(445074);a.i(262820);var e=a.i(883385),f=a.i(933427),g=a.i(254799);async function h(a,b){let c=(0,f.createServiceSupabaseClient)(),d=b?.since||new Date(Date.now()-864e5),e=c.from("ai_audit_log").select("id, action, entity_type, entity_id, user_id, tool_name, severity, reversed, created_at").eq("company_id",a).in("severity",["high","critical"]).gte("created_at",d.toISOString()).order("created_at",{ascending:!1}).limit(b?.limit||100);b?.includeReversed||(e=e.eq("reversed",!1));let{data:g,error:h}=await e;return h?(console.error("Failed to get high severity audit entries:",h),[]):(g||[]).map(a=>({id:a.id,action:a.action,entityType:a.entity_type,entityId:a.entity_id,userId:a.user_id,toolName:a.tool_name,severity:a.severity,reversed:a.reversed,createdAt:a.created_at}))}async function i(a,b){let c=(0,f.createServiceSupabaseClient)(),d=g.default.randomUUID(),{data:e,error:h}=await c.from("ai_audit_log").select("*").eq("id",b.auditLogId).eq("company_id",a).single();if(h||!e)throw Error("Audit log entry not found");if(!e.is_reversible)throw Error("This action is not reversible");if(e.reversed)throw Error("This action has already been reversed");let{error:i}=await c.from("ai_audit_reversal").insert({id:d,company_id:a,audit_log_id:b.auditLogId,reversed_by:b.reversedBy,reversal_reason:b.reason,reversal_method:b.reversalMethod,original_action:e.action,original_entity_type:e.entity_type,original_entity_id:e.entity_id,restored_state:e.before_state,partial_fields:b.partialFields,created_at:new Date().toISOString()});if(i)throw console.error("Failed to record reversal:",i),i;let{error:j}=await c.from("ai_audit_log").update({reversed:!0,reversed_at:new Date().toISOString(),reversed_by:b.reversedBy,reversal_id:d}).eq("id",b.auditLogId).eq("company_id",a);return j&&console.error("Failed to update audit log:",j),d}async function j(a,b){let c=(0,f.createServiceSupabaseClient)(),{data:d,error:e}=await c.from("ai_audit_log").select("action, severity, entity_type, tool_name, reversed").eq("company_id",a).gte("created_at",b.start.toISOString()).lte("created_at",b.end.toISOString());if(e||!d)return{totalActions:0,byAction:{},bySeverity:{},byEntityType:{},reversalRate:0,criticalActionsCount:0,topTools:[]};let g={},h={},i={},j={},k=0,l=0;for(let a of d)g[a.action]=(g[a.action]||0)+1,h[a.severity]=(h[a.severity]||0)+1,i[a.entity_type]=(i[a.entity_type]||0)+1,a.tool_name&&(j[a.tool_name]=(j[a.tool_name]||0)+1),a.reversed&&k++,"critical"===a.severity&&l++;let m=Object.entries(j).map(([a,b])=>({tool:a,count:b})).sort((a,b)=>b.count-a.count).slice(0,10);return{totalActions:d.length,byAction:g,bySeverity:h,byEntityType:i,reversalRate:d.length>0?k/d.length*100:0,criticalActionsCount:l,topTools:m}}async function k(a,b,c){let d=(0,f.createServiceSupabaseClient)(),e=c?.limit||50,g=d.from("ai_action_snapshots").select("id, message_id, entity_type, entity_id, operation, changed_fields, is_reverted, created_at").eq("company_id",a).eq("chat_id",b).order("created_at",{ascending:!1}).limit(e);c?.includeReverted||(g=g.eq("is_reverted",!1));let{data:h,error:i}=await g;return i?(console.error("Failed to get revertable actions:",i),[]):(h||[]).map(a=>({id:a.id,messageId:a.message_id,entityType:a.entity_type,entityId:a.entity_id,operation:a.operation,changedFields:a.changed_fields||[],isReverted:a.is_reverted,createdAt:a.created_at}))}async function l(a,b,c,d,e){let g=(0,f.createServiceSupabaseClient)(),{data:h,error:j}=await g.from("ai_action_snapshots").select("*").eq("id",b).eq("company_id",a).single();if(j||!h)return{success:!1,revertedEntities:[],failedEntities:[{entityType:"unknown",entityId:"unknown",error:"Snapshot not found"}]};if(h.is_reverted)return{success:!1,revertedEntities:[],failedEntities:[{entityType:h.entity_type,entityId:h.entity_id,error:"Already reverted"}]};try{let f=h.before_state,j=h.changed_fields;if(e?.partialFields&&e.partialFields.length>0){for(let a of(f={...h.after_state},e.partialFields))a in h.before_state&&(f[a]=h.before_state[a]);j=e.partialFields}if("create"===h.operation){let{error:b}=await g.from(h.entity_type).update({deleted_at:new Date().toISOString()}).eq("id",h.entity_id).eq("company_id",a);if(b)throw b}else if("delete"===h.operation){let{error:b}=await g.from(h.entity_type).update({...f,deleted_at:null}).eq("id",h.entity_id).eq("company_id",a);if(b)throw b}else{let{error:b}=await g.from(h.entity_type).update(f).eq("id",h.entity_id).eq("company_id",a);if(b)throw b}await g.from("ai_action_snapshots").update({is_reverted:!0,reverted_at:new Date().toISOString(),reverted_by:c,revert_reason:d,partial_revert_fields:e?.partialFields}).eq("id",b).eq("company_id",a);let k=await i(a,{auditLogId:b,reason:d,reversedBy:c,reversalMethod:e?.partialFields?"partial":"automatic",partialFields:e?.partialFields}).catch(()=>void 0);return{success:!0,revertedEntities:[{entityType:h.entity_type,entityId:h.entity_id,revertedFields:j}],failedEntities:[],reversalId:k}}catch(a){return console.error("Failed to revert snapshot:",a),{success:!1,revertedEntities:[],failedEntities:[{entityType:h.entity_type,entityId:h.entity_id,error:a instanceof Error?a.message:"Unknown error"}]}}}async function m(a,b){let c=(0,f.createServiceSupabaseClient)(),{data:d,error:e}=await c.from("ai_action_snapshots").select("*").eq("id",b).eq("company_id",a).single();if(e||!d)return{entityType:"unknown",entityId:"unknown",operation:"unknown",currentState:null,willRestoreTo:{},changedFields:[],canRevert:!1,reason:"Snapshot not found"};if(d.is_reverted)return{entityType:d.entity_type,entityId:d.entity_id,operation:d.operation,currentState:d.after_state,willRestoreTo:d.before_state,changedFields:d.changed_fields,canRevert:!1,reason:"Already reverted"};let{data:g,error:h}=await c.from(d.entity_type).select("*").eq("id",d.entity_id).eq("company_id",a).single();return{entityType:d.entity_type,entityId:d.entity_id,operation:d.operation,currentState:h?null:g,willRestoreTo:d.before_state,changedFields:d.changed_fields,canRevert:!h,reason:h?"Entity not found in database":void 0}}var n=a.i(218188);async function o(a){try{let b=await (0,d.getActiveCompany)();if(!b?.id)return{entries:[],total:0,error:"Not authenticated"};let e=await (0,c.createClient)();if(!e)return{entries:[],total:0,error:"Database connection failed"};let f=a?.limit||50,g=a?.offset||0,h=e.from("ai_audit_log").select("id, action, entity_type, entity_id, tool_name, severity, is_reversible, reversed, created_at, user_id, chat_id, before_state, after_state, changed_fields",{count:"exact"}).eq("company_id",b.id).order("created_at",{ascending:!1});a?.severityFilter&&a.severityFilter.length>0&&(h=h.in("severity",a.severityFilter)),a?.actionFilter&&a.actionFilter.length>0&&(h=h.in("action",a.actionFilter)),a?.dateFrom&&(h=h.gte("created_at",a.dateFrom)),a?.dateTo&&(h=h.lte("created_at",a.dateTo));let{data:i,error:j,count:k}=await h.range(g,g+f-1);if(j)return console.error("Failed to fetch activity log:",j),{entries:[],total:0,error:j.message};return{entries:(i||[]).map(a=>({id:a.id,action:a.action,entityType:a.entity_type,entityId:a.entity_id,toolName:a.tool_name,severity:a.severity,isReversible:a.is_reversible,reversed:a.reversed,createdAt:a.created_at,userId:a.user_id,chatId:a.chat_id,beforeState:a.before_state,afterState:a.after_state,changedFields:a.changed_fields||[]})),total:k||0}}catch(a){return console.error("Error fetching activity log:",a),{entries:[],total:0,error:"Failed to fetch activity log"}}}async function p(a){try{let b=await (0,d.getActiveCompany)();if(!b?.id)return{stats:null,error:"Not authenticated"};let c=new Date(a?.start?a.start:Date.now()-6048e5),e=a?.end?new Date(a.end):new Date;return{stats:await j(b.id,{start:c,end:e})}}catch(a){return console.error("Error fetching activity stats:",a),{stats:null,error:"Failed to fetch activity stats"}}}async function q(){try{let a=await (0,d.getActiveCompany)();if(!a?.id)return{entries:[],error:"Not authenticated"};return{entries:await h(a.id,{since:new Date(Date.now()-864e5),limit:50})}}catch(a){return console.error("Error fetching high severity actions:",a),{entries:[],error:"Failed to fetch high severity actions"}}}async function r(a){try{let b=await (0,d.getActiveCompany)();if(!b?.id)return{preview:null,error:"Not authenticated"};return{preview:await m(b.id,a)}}catch(a){return console.error("Error previewing undo:",a),{preview:null,error:"Failed to preview undo"}}}async function s(a,b){try{let[c,f]=await Promise.all([(0,d.getActiveCompany)(),(0,e.getCurrentUser)()]);if(!c?.id||!f?.id)return{success:!1,revertedEntities:[],failedEntities:[],error:"Not authenticated"};let g=await l(c.id,a,f.id,b);return g.success&&(0,n.revalidatePath)("/dashboard/ai/activity"),g}catch(a){return console.error("Error undoing action:",a),{success:!1,revertedEntities:[],failedEntities:[],error:"Failed to undo action"}}}async function t(a){try{let b=await (0,d.getActiveCompany)();if(!b?.id)return{actions:[],error:"Not authenticated"};if(!a)return{actions:[],error:"Chat ID required"};return{actions:await k(b.id,a,{limit:50,includeReverted:!0})}}catch(a){return console.error("Error fetching revertable actions:",a),{actions:[],error:"Failed to fetch revertable actions"}}}(0,a.i(395731).ensureServerEntryExports)([o,p,q,r,s,t]),(0,b.registerServerReference)(o,"40ab9d70d6580ff2961c19a49b16b0d79fb154a980",null),(0,b.registerServerReference)(p,"407af3536fdb297e86672e08c42b1cbcc44605b218",null),(0,b.registerServerReference)(q,"00fea7a18c082a8ef445059e8141aaf6cac9c342d3",null),(0,b.registerServerReference)(r,"402e94d78c610a36a4222e56d34f753c7b90de4f2a",null),(0,b.registerServerReference)(s,"605b87bf15aa040b179e0be36b8187647d08cd6ade",null),(0,b.registerServerReference)(t,"403d0f0f82c1f7c05bf283c75e680082c1d1f10a2c",null),a.s(["getActivityLogAction",()=>o,"getActivityStatsAction",()=>p,"previewUndoAction",()=>r,"undoActionAction",()=>s],398906)},991443,a=>a.a(async(b,c)=>{try{a.i(288344),a.i(285956),a.i(336176),a.i(933427),a.i(82608);var d=a.i(970552),e=a.i(765839),f=a.i(198114);a.i(103984),a.i(941771),a.i(854963),a.i(672766),a.i(404352);var g=a.i(304381);a.i(371603),a.i(396829),a.i(444057),a.i(910711);var h=a.i(571708);a.i(495405),a.i(417781),a.i(890375),a.i(162803),a.i(398906);var i=b([d,e,f,g,h]);[d,e,f,g,h]=i.then?(await i)():i,a.s([]),c()}catch(a){c(a)}},!1),977148,a=>a.a(async(b,c)=>{try{var d=a.i(991443),e=a.i(288344),f=a.i(285956),g=a.i(336176),h=a.i(933427),i=a.i(82608),j=a.i(970552),k=a.i(765839),l=a.i(198114),m=a.i(103984),n=a.i(941771),o=a.i(854963),p=a.i(672766),q=a.i(404352),r=a.i(304381),s=a.i(371603),t=a.i(396829),u=a.i(444057),v=a.i(910711),w=a.i(571708),x=a.i(495405),y=a.i(417781),z=a.i(890375),A=a.i(162803),B=a.i(398906),C=b([d,j,k,l,r,w]);[d,j,k,l,r,w]=C.then?(await C)():C,a.s(["000478fbf5363dae5000d525663da13e29908cb952",()=>g.getWebRTCCredentials,"0006f7bd89b72f0836ec7bf4db73019f1b32e6c24a",()=>A.getSmsFolderCountsAction,"000f90f949d6a2f5484d061d5a738a59a8c846aeaa",()=>x.getPendingSupportSessions,"001be5cf82b793f19f6a7d010c91c14577fa7a130d",()=>v.checkIsCompanyOwner,"001f005176797ef23488068124fb9a744915a477de",()=>e.getCurrentUserRole,"00235a0ba91f1ba226f33fa40dcf4c93a2c3548c70",()=>y.getEmailFoldersAction,"0043ae510c3322ea499beb9e1bb77d06afb4ef19bd",()=>r.signOut,"004cdde5e6ae8991bab4ba61ae40647c2b823200ba",()=>n.resetHourlyCounters,"00665c1bbcd52d612d5bb4bf3be5e7fc75554132e6",()=>x.getActiveSupportSessions,"006acf41615a2f7795c47b6d7a3016e18300f2ad17",()=>n.resetDailyCounters,"007505a78985e53e083a498c97761ed8a463d3d379",()=>j.checkTelnyxVerificationStatus,"0077abd0cb1e555f91adaa482ad0b2f565bbd0629a",()=>w.getCustomersForDialer,"009e962eae57bf128b2023081fd7259048edd8884a",()=>u.getEmailFolderCountsAction,"00a122f9d5fe3a1603c636c3a251886129b66154f8",()=>p.getProviderHealthDashboard,"00a13dbd00149949fc1367d3e76ae7d789e07f5321",()=>h.createServiceSupabaseClient,"00c53a1f02416c3261983f8096f19a3450bfd51775",()=>m.runHealthCheckForAllDomains,"00cf212b0097820096122537beac12e3403b97d564",()=>q.markAllAsRead,"00ebc03a4ffc993aea7ec2e541686105c2bace2437",()=>u.getTotalUnreadCountAction,"00fe74bdf14126b5ad89e9480e82978d6357f356b3",()=>o.isGmailIntegrationEnabled,"4002f454c46f4c21ca6e9e26362583ccff69c9f914",()=>g.transcribeCallRecording,"400b8fb96146bfd004a3166563a5ab5536bb610c70",()=>m.getDomainHealth,"400ce95360aaffa14a99dfdf969ba5166c69a59eb6",()=>o.getUserGmailTokens,"4019cf9f81eb3c06f82b5c2f8eb042f3d95d91e933",()=>g.getCompanyPhoneNumbers,"401d3d830065dd7c4777fad67f642392f48735c4ab",()=>o.disconnectCompanyGmail,"40247c617842c31b242455a0961cbd2c3297606a16",()=>g.getCallRoutingRules,"4029b163c1c0acfd806352a72fe8030c8ae4f7f8ac",()=>n.incrementEmailCounter,"402e94d78c610a36a4222e56d34f753c7b90de4f2a",()=>B.previewUndoAction,"40369e8ea4eced7bdaef8203d369469ee7b630db8c",()=>x.endActiveSupportSession,"40413bfa888916480edbc33ebb812158fddf960f89",()=>g.updateCallRoutingRule,"404575d602ef4c60c0058b592b8c3e42fbcd13fc4c",()=>o.disconnectUserGmail,"404a3266e0319dbd8c24fec80bb69ecfe029d2a768",()=>z.searchVendors,"404d6f2891af89c71d5bde33d110a216bdd3ee4729",()=>m.recordDeliveryEvent,"404e47931374ad2a1b54bc11f357703790f6104530",()=>g.startCallRecording,"405a16958f97c37bd4b5711bd8761510bdab55839f",()=>g.transferActiveCall,"405c57a8fed352b8679525b56014eb8c49105c850c",()=>m.getCompanyDomainsHealth,"406864ae05b8b51c66cc2c335999e5011a41cb521f",()=>g.searchPhoneNumbers,"406f6624261c6dd1a908026fa1408a3f6d507b6e7d",()=>e.canDeleteTeamMember,"40704f0e856ad801ef93b43436f219a36f7c0efd2c",()=>f.getPayrixMerchantAccount,"40787b1598849126560f9f0b0f8fe8967338c7bf28",()=>o.getCompanyEmailProvider,"407a5a7d0a7dd7989a963eb2485a3527c1dcb20a70",()=>n.getCompanyActiveDomain,"407af3536fdb297e86672e08c42b1cbcc44605b218",()=>B.getActivityStatsAction,"4081009dd4dff14ff4ece62648bad23a83f2f9f63c",()=>t.updateUserStatus,"4082b52123c24a95685a53c36313418a95c259c65b",()=>w.deleteCustomer,"4087f0badccd6aaf6a28b640ab4bbc513f0832d105",()=>j.submitAutomatedVerification,"408d3694fd0dd48e424f53c9bf5083b946ab3ec990",()=>y.createEmailFolderAction,"4094cf679b4a10ca0f969f4fc1b55602aac4e0fbc3",()=>q.markAsRead,"4097c3c574342661f9a3c8244961d001234449f36f",()=>s.switchCompany,"40ab9d70d6580ff2961c19a49b16b0d79fb154a980",()=>B.getActivityLogAction,"40ad037af6f6ab1a3004746d3a1b65afa65527002d",()=>m.processResendWebhookEvent,"40ae25402a089e45aa071d979e8cc6ad136205cc98",()=>j.registerCompanyFor10DLC,"40af86a915f04df8d7cc189fe26e45e0cc24663080",()=>n.checkRateLimit,"40b2df540ec465c5dc19545c96486485bb50b5633b",()=>g.makeCall,"40beeb56302a20d27cd8ba7a0988310f855633d7e6",()=>o.getCompanyGmailTokens,"40c55f8e0922f2c7fd8d502e4c75395bf5f0470430",()=>y.deleteEmailFolderAction,"40c7885bdc4fe4cdd5f57e78579230c58088adbef4",()=>p.checkProviderAlert,"40d050abdabe2ee7293436c505c5f27b4408a2f27c",()=>g.sendTextMessage,"40d3c4ceeaee653aa257a28ed429a7fd272fa9fb66",()=>p.cleanupOldEvents,"40d5cc291162e2fd61245bdb851d5e8ed609e4ed19",()=>g.stopCallRecording,"40e06418f4b93b40c84a25511e0468e1e8a41ddecf",()=>p.recordProviderEvent,"40e9589cb639f2902eb841bedc1247d966486d6fd7",()=>v.getCompanyPendingActions,"40ecf2c792e84ef4b898fda98ec27277b4a9dddef2",()=>m.generateDeliverabilityReport,"40edd91786b2a482e617fb16f2474d26ec295435e7",()=>g.sendMMSMessage,"40f8c061cf84f884e77af3425bc24b8a8d72f598fb",()=>l.sendEmail,"40fab1894acc5e3d1fdd8d8c6128a7cecee06e7e6a",()=>q.deleteNotification,"40fd6a80b32792fab749933f98f07503d8e94c0305",()=>g.purchasePhoneNumber,"6013add076e3eaed7dc37e8b800ce977d5abb8d49a",()=>w.getCustomerByPhone,"60193685409a9d118f1b364e14ecf57d05fa5638a9",()=>w.searchCustomers,"602e89ae7ace85fc30cd3b4b1dd865d517c0cb1cd5",()=>x.approveSupportSessionRequest,"602fab67313b110e6ccb66e54b1e16450b2a772cc7",()=>o.refreshUserGmailToken,"60302947fc4caffa53a719728f3c2cebace926098c",()=>o.sendCompanyGmailEmail,"603643b13bf288cc628303bb4d12df0311b11434c7",()=>o.syncUserInbox,"6045f8436f9cdfdadb7bfe3955677adfc5f4102de0",()=>l.handleComplaintWebhook,"605b87bf15aa040b179e0be36b8187647d08cd6ade",()=>B.undoActionAction,"606753f8910b46d5792f4bdeb457cdf29d1a8bbadc",()=>i.ensureMessagingBranding,"607d0f958daf66b2a0d5277cdda17600dace5156bb",()=>g.deleteCallRoutingRule,"60853f1e409364f7e171e27229217994ff224414e6",()=>g.toggleCallRoutingRule,"60856182db5eaec7f85eda2a5a94c5d7d3524325d6",()=>o.checkCompanyGmailHealth,"60886af124323873afd4d5b64bb4143abbcba2c154",()=>x.rejectSupportSessionRequest,"60c643a41ce1a8e6cc8338da6e2f3678c386910460",()=>p.getProviderStats,"60eeb51685ac265a4ad793a230a515fe6e462f16f4",()=>o.refreshCompanyGmailToken,"708daa303e36e37247e22b5b828b6aad8c73ac283b",()=>o.fetchUserInbox,"70a648f43fa62ae3dcf2070eb90413e96e81591e77",()=>i.ensureMessagingCampaign,"70dd3bc4222a87350dc137fa9cbcb849fa1913b397",()=>o.setCompanyEmailProvider,"70f58c5ba46ef02b620d7dc87bae8fc83f6d480755",()=>k.sendVerificationSubmittedEmail,"78255c3fa8c9facf7c3f353202f2907836e8eb5539",()=>p.recordSendFailure,"783861d25688b32ba086bbe9e45444975c36a1b285",()=>p.recordSendSuccess,"78766431b437b16f7cb00b4d64a2f3be5e092ed724",()=>p.recordFallbackTriggered,"78a8ea4f1cfa571a366adccf36ac04b1c85d61ae2b",()=>l.handleBounceWebhook,"78d41ef818e75fef94d65a87ea1f0faf418132e3c5",()=>o.storeGmailMessage,"7e3a356960ddd52a3fa4dc6d981ae7202a59eb9a3d",()=>o.storeUserGmailTokens,"7f06df826c4fff42950e712c0f548254e275be2a52",()=>o.storeCompanyGmailTokens]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=apps_web_68eef08f._.js.map