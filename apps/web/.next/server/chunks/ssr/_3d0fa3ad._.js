module.exports=[99910,(a,b,c)=>{"use strict";let d;Object.defineProperty(c,"__esModule",{value:!0});var e={arrayBufferToString:function(){return j},decrypt:function(){return m},encrypt:function(){return l},getActionEncryptionKey:function(){return r},getClientReferenceManifestForRsc:function(){return q},getServerModuleMap:function(){return p},setReferenceManifestsSingleton:function(){return o},stringToUint8Array:function(){return k}};for(var f in e)Object.defineProperty(c,f,{enumerable:!0,get:e[f]});let g=a.r(558425),h=a.r(779133),i=a.r(556704);function j(a){let b=new Uint8Array(a),c=b.byteLength;if(c<65535)return String.fromCharCode.apply(null,b);let d="";for(let a=0;a<c;a++)d+=String.fromCharCode(b[a]);return d}function k(a){let b=a.length,c=new Uint8Array(b);for(let d=0;d<b;d++)c[d]=a.charCodeAt(d);return c}function l(a,b,c){return crypto.subtle.encrypt({name:"AES-GCM",iv:b},a,c)}function m(a,b,c){return crypto.subtle.decrypt({name:"AES-GCM",iv:b},a,c)}let n=Symbol.for("next.server.action-manifests");function o({page:a,clientReferenceManifest:b,serverActionsManifest:c,serverModuleMap:d}){var e;let f=null==(e=globalThis[n])?void 0:e.clientReferenceManifestsPerPage;globalThis[n]={clientReferenceManifestsPerPage:{...f,[(0,h.normalizeAppPath)(a)]:b},serverActionsManifest:c,serverModuleMap:d}}function p(){let a=globalThis[n];if(!a)throw Object.defineProperty(new g.InvariantError("Missing manifest for Server Actions."),"__NEXT_ERROR_CODE",{value:"E606",enumerable:!1,configurable:!0});return a.serverModuleMap}function q(){let a=globalThis[n];if(!a)throw Object.defineProperty(new g.InvariantError("Missing manifest for Server Actions."),"__NEXT_ERROR_CODE",{value:"E606",enumerable:!1,configurable:!0});let{clientReferenceManifestsPerPage:b}=a,c=i.workAsyncStorage.getStore();if(!c){var d=b;let a=Object.values(d),c={clientModules:{},edgeRscModuleMapping:{},rscModuleMapping:{}};for(let b of a)c.clientModules={...c.clientModules,...b.clientModules},c.edgeRscModuleMapping={...c.edgeRscModuleMapping,...b.edgeRscModuleMapping},c.rscModuleMapping={...c.rscModuleMapping,...b.rscModuleMapping};return c}let e=b[c.route];if(!e)throw Object.defineProperty(new g.InvariantError(`Missing Client Reference Manifest for ${c.route}.`),"__NEXT_ERROR_CODE",{value:"E570",enumerable:!1,configurable:!0});return e}async function r(){if(d)return d;let a=globalThis[n];if(!a)throw Object.defineProperty(new g.InvariantError("Missing manifest for Server Actions."),"__NEXT_ERROR_CODE",{value:"E606",enumerable:!1,configurable:!0});let b=process.env.NEXT_SERVER_ACTIONS_ENCRYPTION_KEY||a.serverActionsManifest.encryptionKey;if(void 0===b)throw Object.defineProperty(new g.InvariantError("Missing encryption key for Server Actions"),"__NEXT_ERROR_CODE",{value:"E571",enumerable:!1,configurable:!0});return d=await crypto.subtle.importKey("raw",k(atob(b)),"AES-GCM",!0,["encrypt","decrypt"])}},576489,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d,e,f={decryptActionBoundArgs:function(){return w},encryptActionBoundArgs:function(){return v}};for(var g in f)Object.defineProperty(c,g,{enumerable:!0,get:f[g]});a.r(907279);let h=a.r(742210),i=a.r(778809),j=a.r(978346),k=a.r(99910),l=a.r(832319),m=a.r(354483),n=(d=a.r(429969))&&d.__esModule?d:{default:d},o=new TextEncoder,p=new TextDecoder,q,r;async function s(a,b){let c=await (0,k.getActionEncryptionKey)();if(void 0===c)throw Object.defineProperty(Error("Missing encryption key for Server Action. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E65",enumerable:!1,configurable:!0});let d=atob(b),e=d.slice(0,16),f=d.slice(16),g=p.decode(await (0,k.decrypt)(c,(0,k.stringToUint8Array)(e),(0,k.stringToUint8Array)(f)));if(!g.startsWith(a))throw Object.defineProperty(Error("Invalid Server Action payload: failed to decrypt."),"__NEXT_ERROR_CODE",{value:"E191",enumerable:!1,configurable:!0});return g.slice(a.length)}async function t(a,b){let c=await (0,k.getActionEncryptionKey)();if(void 0===c)throw Object.defineProperty(Error("Missing encryption key for Server Action. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E65",enumerable:!1,configurable:!0});let d=new Uint8Array(16);l.workUnitAsyncStorage.exit(()=>crypto.getRandomValues(d));let e=(0,k.arrayBufferToString)(d.buffer),f=await (0,k.encrypt)(c,d,o.encode(a+b));return btoa(e+(0,k.arrayBufferToString)(f))}var u=((e=u||{})[e.Ready=0]="Ready",e[e.Pending=1]="Pending",e[e.Complete=2]="Complete",e);let v=n.default.cache(async function a(b,...c){let d=l.workUnitAsyncStorage.getStore(),e=d?(0,l.getCacheSignal)(d):void 0,{clientModules:f}=(0,k.getClientReferenceManifestForRsc)(),g=Error();Error.captureStackTrace(g,a);let i=!1,n=d?(0,m.createHangingInputAbortSignal)(d):void 0,o=0;function p(){0===o&&(o=1,null==e||e.beginRead())}function r(){1===o&&(null==e||e.endRead()),o=2}n&&e&&n.addEventListener("abort",p,{once:!0});let s=await (0,j.streamToString)((0,h.renderToReadableStream)(c,f,{filterStackFrame:q,signal:n,onError(a){(null==n?void 0:n.aborted)||i||(i=!0,g.message=a instanceof Error?a.message:String(a))}}),n);if(i)throw r(),g;if(!d)return t(b,s);p();let u=(0,l.getPrerenderResumeDataCache)(d),v=(0,l.getRenderResumeDataCache)(d),w=b+s,x=(null==u?void 0:u.encryptedBoundArgs.get(w))??(null==v?void 0:v.encryptedBoundArgs.get(w));if(x)return x;let y=await t(b,s);return r(),null==u||u.encryptedBoundArgs.set(w,y),y});async function w(a,b){let c,d=await b,e=l.workUnitAsyncStorage.getStore();if(e){let b=(0,l.getCacheSignal)(e),f=(0,l.getPrerenderResumeDataCache)(e),g=(0,l.getRenderResumeDataCache)(e);(c=(null==f?void 0:f.decryptedBoundArgs.get(d))??(null==g?void 0:g.decryptedBoundArgs.get(d)))||(null==b||b.beginRead(),c=await s(a,d),null==b||b.endRead(),null==f||f.decryptedBoundArgs.set(d,c))}else c=await s(a,d);let{edgeRscModuleMapping:f,rscModuleMapping:g}=(0,k.getClientReferenceManifestForRsc)();return await (0,i.createFromReadableStream)(new ReadableStream({start(a){switch(a.enqueue(o.encode(c)),null==e?void 0:e.type){case"prerender":case"prerender-runtime":e.renderSignal.aborted?a.close():e.renderSignal.addEventListener("abort",()=>a.close(),{once:!0});break;case"prerender-client":case"prerender-ppr":case"prerender-legacy":case"request":case"cache":case"private-cache":case"unstable-cache":case void 0:return a.close()}}}),{findSourceMapURL:r,serverConsumerManifest:{moduleLoading:null,moduleMap:g,serverModuleMap:(0,k.getServerModuleMap)()}})}},479016,a=>{"use strict";var b=a.i(504348),c=a.i(780195),d=a.i(576489),e=a.i(465807),f=a.i(835475),g=a.i(516528),h=a.i(981395),i=a.i(676001),j=a.i(8868);a.i(692167);var k=a.i(852596);a.i(801791);var l=a.i(868553);a.i(174010);var m=a.i(705991);a.i(492258);var n=a.i(925834);a.i(730154),a.s([],340162),a.i(340162);var o=a.i(549121);a.s([],204555),a.j(o,204555);var p=a.i(204555),q=a.i(474235);function r({label:a,htmlFor:c,error:d,description:e,required:f,children:g,className:h}){return(0,b.jsxs)("div",{className:(0,q.cn)("space-y-2",h),"data-slot":"form-field",children:[a&&(0,b.jsxs)(o.Label,{htmlFor:c,className:(0,q.cn)(d&&"text-destructive"),"data-error":!!d,children:[a,f&&(0,b.jsx)("span",{className:"text-destructive ml-1","aria-label":"required",children:"*"})]}),g,e&&!d&&(0,b.jsx)("p",{className:"text-muted-foreground text-[0.8rem] leading-relaxed",children:e}),d&&(0,b.jsx)("p",{className:"text-destructive text-[0.8rem] font-medium",role:"alert",children:d})]})}var s=a.i(136874);let t={passwords_mismatch:"Passwords do not match. Please try again.",password_too_short:"Password must be at least 8 characters.",customer_not_found:"Customer account not found. Please contact support.",auth_failed:"Failed to create account. Please try again.",link_failed:"Failed to set up your account. Please contact support."},u=async function(a,b){var[c,e]=await (0,d.decryptActionBoundArgs)("606b0e2c7feb2535b3f9a951f42ee578e4a47230be",a);let f=b.get("password");f!==b.get("confirmPassword")&&(0,k.redirect)(`/portal/setup?token=${c}&error=passwords_mismatch`),f.length<8&&(0,k.redirect)(`/portal/setup?token=${c}&error=password_too_short`);let g=await (0,s.createClient)();if(!g)return(0,k.notFound)();let{data:h}=await g.from("customers").select("id, email, display_name").eq("id",e).is("deleted_at",null).single();h||(0,k.redirect)(`/portal/setup?token=${c}&error=customer_not_found`);let{data:i,error:j}=await g.auth.signUp({email:h.email,password:f,options:{data:{display_name:h.display_name,customer_id:h.id,role:"customer"}}});(j||!i.user)&&(0,k.redirect)(`/portal/setup?token=${c}&error=auth_failed&message=${encodeURIComponent(j?.message||"Failed to create account")}`);let{error:l}=await g.from("customers").update({user_id:i.user.id}).eq("id",h.id);l&&(0,k.redirect)(`/portal/setup?token=${c}&error=link_failed&message=${encodeURIComponent(l.message)}`),(0,k.redirect)("/portal/dashboard")};async function v({searchParams:a}){let c,o,q=await a,v=q.token,x=q.error,y=q.message,z=x?t[x]||y||"An error occurred":null;if(!v)return(0,b.jsx)(w,{message:"No invitation token provided"});try{let a=Buffer.from(v,"base64url").toString("utf-8").split(":");if(c=a[0]||"",o=Number.parseInt(a[1]||"0",10),Date.now()>o+6048e5)return(0,b.jsx)(w,{message:"This invitation link has expired. Please request a new invitation."})}catch{return(0,b.jsx)(w,{message:"Invalid invitation token"})}let A=await (0,s.createClient)();if(!A)return(0,k.notFound)();let{data:B}=await A.from("customers").select("id, email, display_name, portal_enabled, user_id").eq("id",c).is("deleted_at",null).single();if(!B)return(0,b.jsx)(w,{message:"Customer not found or invitation has been revoked"});if(B.user_id)return(0,b.jsx)("div",{className:"from-background via-background to-muted flex min-h-screen items-center justify-center bg-gradient-to-br p-4",children:(0,b.jsxs)(m.Card,{className:"w-full max-w-md",children:[(0,b.jsxs)(m.CardHeader,{className:"text-center",children:[(0,b.jsx)("div",{className:"bg-success mx-auto mb-4 flex size-16 items-center justify-center rounded-full",children:(0,b.jsx)(f.CheckCircle2,{className:"text-success size-8"})}),(0,b.jsx)(m.CardTitle,{className:"text-2xl",children:"Account Already Set Up"}),(0,b.jsx)(m.CardDescription,{children:"Your portal account is already active. You can sign in below."})]}),(0,b.jsx)(m.CardContent,{children:(0,b.jsx)(l.Button,{asChild:!0,className:"w-full",size:"lg",children:(0,b.jsx)(j.default,{href:"/portal/login",children:"Sign In to Portal"})})})]})});var C=u.bind(null,(0,d.encryptActionBoundArgs)("606b0e2c7feb2535b3f9a951f42ee578e4a47230be",v,c));return(0,b.jsx)("div",{className:"from-background via-background to-muted flex min-h-screen items-center justify-center bg-gradient-to-br p-4",children:(0,b.jsxs)(m.Card,{className:"w-full max-w-md",children:[(0,b.jsxs)(m.CardHeader,{className:"text-center",children:[(0,b.jsx)("div",{className:"bg-primary/10 mx-auto mb-4 flex size-16 items-center justify-center rounded-full",children:(0,b.jsx)(g.Lock,{className:"text-primary size-8"})}),(0,b.jsx)(m.CardTitle,{className:"text-2xl",children:"Set Up Your Portal Account"}),(0,b.jsxs)(m.CardDescription,{children:["Welcome, ",B.display_name,"! Create a password to access your customer portal."]})]}),(0,b.jsxs)(m.CardContent,{children:[z&&(0,b.jsxs)("div",{className:"mb-6 flex items-center gap-2 rounded-md bg-red-50 p-3 text-sm text-red-700 dark:bg-red-900/20 dark:text-red-400",children:[(0,b.jsx)(e.AlertCircle,{className:"size-4 shrink-0"}),(0,b.jsx)("span",{children:z})]}),(0,b.jsxs)("form",{action:C,className:"space-y-6",children:[(0,b.jsxs)(r,{label:"Email Address",htmlFor:"email",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(h.Mail,{className:"text-muted-foreground absolute top-3 left-3 size-4"}),(0,b.jsx)(n.Input,{className:"bg-muted pl-10",disabled:!0,id:"email",readOnly:!0,type:"email",value:B.email})]}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"You'll use this email to sign in to your portal"})]}),(0,b.jsx)(r,{label:"Full Name",htmlFor:"name",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(i.User,{className:"text-muted-foreground absolute top-3 left-3 size-4"}),(0,b.jsx)(n.Input,{className:"bg-muted pl-10",disabled:!0,id:"name",readOnly:!0,type:"text",value:B.display_name})]})}),(0,b.jsxs)(r,{label:"Create Password",htmlFor:"password",required:!0,children:[(0,b.jsx)(p.PasswordInput,{id:"password",minLength:8,name:"password",placeholder:"Enter a secure password",required:!0}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Must be at least 8 characters"})]}),(0,b.jsx)(r,{label:"Confirm Password",htmlFor:"confirmPassword",required:!0,children:(0,b.jsx)(p.PasswordInput,{id:"confirmPassword",minLength:8,name:"confirmPassword",placeholder:"Re-enter your password",required:!0})}),(0,b.jsx)("div",{className:"border-primary/20 bg-primary/5 rounded-lg border p-4",children:(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(g.Lock,{className:"text-primary size-5"}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Secure & Private"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Your password is encrypted and secure. We never share your information."})]})]})}),(0,b.jsx)(l.Button,{className:"w-full",size:"lg",type:"submit",children:"Create Account & Sign In"}),(0,b.jsxs)("p",{className:"text-muted-foreground text-center text-sm",children:["Need help?"," ",(0,b.jsx)("a",{className:"text-primary underline",href:"mailto:support@thorbis.com",children:"Contact Support"})]})]})]})]})})}function w({message:a}){return(0,b.jsx)("div",{className:"from-background via-background to-muted flex min-h-screen items-center justify-center bg-gradient-to-br p-4",children:(0,b.jsxs)(m.Card,{className:"w-full max-w-md",children:[(0,b.jsxs)(m.CardHeader,{className:"text-center",children:[(0,b.jsx)("div",{className:"bg-destructive/10 mx-auto mb-4 flex size-16 items-center justify-center rounded-full",children:(0,b.jsx)(e.AlertCircle,{className:"text-destructive size-8"})}),(0,b.jsx)(m.CardTitle,{className:"text-2xl",children:"Invalid Invitation"}),(0,b.jsx)(m.CardDescription,{children:a})]}),(0,b.jsxs)(m.CardContent,{className:"space-y-4",children:[(0,b.jsx)("p",{className:"text-muted-foreground text-center text-sm",children:"If you believe this is an error, please contact our support team."}),(0,b.jsx)(l.Button,{asChild:!0,className:"w-full",size:"lg",variant:"outline",children:(0,b.jsx)("a",{href:"mailto:support@thorbis.com",children:"Contact Support"})})]})]})})}(0,c.registerServerReference)(u,"606b0e2c7feb2535b3f9a951f42ee578e4a47230be",null),a.s(["$$RSC_SERVER_ACTION_0",0,u,"default",()=>v],479016)}];

//# sourceMappingURL=_3d0fa3ad._.js.map