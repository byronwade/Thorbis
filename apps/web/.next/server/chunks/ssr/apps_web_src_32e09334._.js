module.exports=[417781,a=>{"use strict";var b=a.i(780195),c=a.i(146057);a.i(467361);var d=a.i(445074),e=a.i(136874),f=a.i(395731);let g=c.z.object({name:c.z.string().min(1).max(100),description:c.z.string().max(500).optional(),color:c.z.string().regex(/^#[0-9A-Fa-f]{6}$/).optional(),icon:c.z.string().optional()});g.partial().extend({id:c.z.string().uuid(),sort_order:c.z.number().int().optional()});let h=c.z.object({id:c.z.string().uuid()});async function i(){try{let a=await (0,d.getActiveCompanyId)();if(!a)return{success:!1,error:"No active company found"};let b=await (0,e.createClient)();if(!b)return{success:!1,error:"Database connection failed"};let{data:c,error:f}=await b.from("email_folders").select("*").eq("company_id",a).is("deleted_at",null).eq("is_active",!0).order("sort_order",{ascending:!0}).order("name",{ascending:!0});if(f)return{success:!1,error:f.message};return{success:!0,folders:c||[]}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error"}}}async function j(a){try{let b=g.parse(a),c=await (0,d.getActiveCompanyId)();if(!c)return{success:!1,error:"No active company found"};let f=await (0,e.createClient)();if(!f)return{success:!1,error:"Database connection failed"};let{data:{user:h}}=await f.auth.getUser();if(!h)return{success:!1,error:"Not authenticated"};let i=b.name.toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),{data:j}=await f.from("email_folders").select("id").eq("company_id",c).eq("slug",i).is("deleted_at",null).single();if(j)return{success:!1,error:"A folder with this name already exists"};let{data:k}=await f.from("email_folders").select("sort_order").eq("company_id",c).is("deleted_at",null).order("sort_order",{ascending:!1}).limit(1).single(),{data:l,error:m}=await f.from("email_folders").insert({company_id:c,name:b.name,slug:i,description:b.description||null,color:b.color||null,icon:b.icon||null,sort_order:(k?.sort_order||0)+1,created_by:h.id}).select().single();if(m)return{success:!1,error:m.message};return{success:!0,folder:l}}catch(a){if(a instanceof c.z.ZodError)return{success:!1,error:a.errors.map(a=>`${a.path.join(".")}: ${a.message}`).join(", ")};return{success:!1,error:a instanceof Error?a.message:"Unknown error"}}}async function k(a){try{let b=h.parse(a),c=await (0,d.getActiveCompanyId)();if(!c)return{success:!1,error:"No active company found"};let f=await (0,e.createClient)();if(!f)return{success:!1,error:"Database connection failed"};let{data:{user:g}}=await f.auth.getUser();if(!g)return{success:!1,error:"Not authenticated"};let{data:i,error:j}=await f.from("email_folders").select("id, is_system").eq("id",b.id).eq("company_id",c).is("deleted_at",null).single();if(j||!i)return{success:!1,error:"Folder not found"};if(i.is_system)return{success:!1,error:"Cannot delete system folders"};let{error:k}=await f.from("email_folders").update({deleted_at:new Date().toISOString(),deleted_by:g.id,is_active:!1}).eq("id",b.id).eq("company_id",c);if(k)return{success:!1,error:k.message};return{success:!0}}catch(a){if(a instanceof c.z.ZodError)return{success:!1,error:a.errors.map(a=>`${a.path.join(".")}: ${a.message}`).join(", ")};return{success:!1,error:a instanceof Error?a.message:"Unknown error"}}}(0,f.ensureServerEntryExports)([i,j,k]),(0,b.registerServerReference)(i,"009d2437f279bb220435d6b93fe38eb909817e6046",null),(0,b.registerServerReference)(j,"40d07b28bd187d6d3394516f5d39d8c4717c1b232c",null),(0,b.registerServerReference)(k,"40ab3b361b2041f77f436c8d1e4550cc0e1195ba49",null),a.s(["createEmailFolderAction",()=>j,"deleteEmailFolderAction",()=>k,"getEmailFoldersAction",()=>i])},630351,a=>{"use strict";var b=a.i(146057);let c=b.z.object({company_id:b.z.string().uuid(),user_id:b.z.string().uuid().optional().nullable(),type:b.z.enum(["residential","commercial","industrial"]).default("residential"),first_name:b.z.string().min(1,"First name is required").max(100),last_name:b.z.string().min(1,"Last name is required").max(100),company_name:b.z.string().max(200).optional().nullable(),email:b.z.string().email("Invalid email address").optional().nullable(),phone:b.z.string().max(20).optional().nullable(),alternate_phone:b.z.string().max(20).optional().nullable(),address:b.z.string().max(500).optional().nullable(),city:b.z.string().max(100).optional().nullable(),state:b.z.string().max(2).optional().nullable(),zip:b.z.string().max(10).optional().nullable(),latitude:b.z.number().optional().nullable(),longitude:b.z.number().optional().nullable(),status:b.z.enum(["active","inactive","blocked"]).default("active"),source:b.z.string().max(100).optional().nullable(),referred_by:b.z.string().uuid().optional().nullable(),notes:b.z.string().optional().nullable(),tags:b.z.array(b.z.string()).optional().nullable(),total_revenue:b.z.number().int().default(0),total_jobs:b.z.number().int().default(0),outstanding_balance:b.z.number().int().default(0),lifetime_value:b.z.number().int().default(0),average_job_value:b.z.number().int().default(0),last_job_date:b.z.date().optional().nullable(),next_service_due:b.z.date().optional().nullable(),portal_enabled:b.z.boolean().default(!1),portal_invited_at:b.z.date().optional().nullable(),portal_last_login:b.z.date().optional().nullable(),billing_same_as_service:b.z.boolean().default(!0),billing_address:b.z.string().max(500).optional().nullable(),billing_city:b.z.string().max(100).optional().nullable(),billing_state:b.z.string().max(2).optional().nullable(),billing_zip:b.z.string().max(10).optional().nullable(),tax_exempt:b.z.boolean().default(!1),tax_id:b.z.string().max(50).optional().nullable(),preferred_contact_method:b.z.enum(["email","phone","sms","any"]).optional().nullable(),do_not_disturb:b.z.boolean().default(!1),marketing_opt_in:b.z.boolean().default(!0)});c.partial().omit({company_id:!0}),c.extend({id:b.z.string().uuid(),created_at:b.z.date(),updated_at:b.z.date(),deleted_at:b.z.date().nullable(),deleted_by:b.z.string().uuid().nullable()});let d=b.z.object({company_id:b.z.string().uuid(),customer_id:b.z.string().uuid().optional().nullable(),job_id:b.z.string().uuid().optional().nullable(),invoice_id:b.z.string().uuid().optional().nullable(),user_id:b.z.string().uuid().optional().nullable(),type:b.z.enum(["email","sms","phone","chat","note"]),direction:b.z.enum(["inbound","outbound"]),status:b.z.enum(["draft","queued","sending","sent","delivered","failed","read"]).default("draft"),subject:b.z.string().max(500).optional().nullable(),body:b.z.string().optional().nullable(),from_email:b.z.string().email().optional().nullable(),to_email:b.z.string().email().optional().nullable(),from_phone:b.z.string().max(20).optional().nullable(),to_phone:b.z.string().max(20).optional().nullable(),cc:b.z.array(b.z.string().email()).optional().nullable(),bcc:b.z.array(b.z.string().email()).optional().nullable(),thread_id:b.z.string().uuid().optional().nullable(),parent_id:b.z.string().uuid().optional().nullable(),scheduled_for:b.z.date().optional().nullable(),sent_at:b.z.date().optional().nullable(),delivered_at:b.z.date().optional().nullable(),read_at:b.z.date().optional().nullable(),failed_at:b.z.date().optional().nullable(),failure_reason:b.z.string().optional().nullable(),retry_count:b.z.number().int().default(0),open_count:b.z.number().int().default(0),click_count:b.z.number().int().default(0),call_duration:b.z.number().int().optional().nullable(),call_recording_url:b.z.string().url().optional().nullable(),call_transcription:b.z.string().optional().nullable(),internal_note:b.z.boolean().default(!1),pinned:b.z.boolean().default(!1),tags:b.z.array(b.z.string()).optional().nullable(),metadata:b.z.record(b.z.string(),b.z.unknown()).optional().nullable()});d.partial().omit({company_id:!0}),d.extend({id:b.z.string().uuid(),created_at:b.z.date(),updated_at:b.z.date(),deleted_at:b.z.date().nullable(),deleted_by:b.z.string().uuid().nullable()});let e=b.z.object({company_id:b.z.string().uuid(),customer_id:b.z.string().uuid(),invoice_id:b.z.string().uuid().optional().nullable(),job_id:b.z.string().uuid().optional().nullable(),payment_number:b.z.string().min(1,"Payment number is required").max(50),amount:b.z.number().int().min(1,"Amount must be greater than 0"),currency:b.z.string().length(3).default("USD"),payment_method:b.z.enum(["cash","check","credit_card","debit_card","ach","wire","venmo","paypal","other"]),payment_type:b.z.enum(["payment","refund","credit"]).default("payment"),status:b.z.enum(["pending","processing","completed","failed","refunded","partially_refunded","cancelled"]).default("pending"),card_brand:b.z.enum(["visa","mastercard","amex","discover"]).optional().nullable(),card_last4:b.z.string().length(4).optional().nullable(),card_exp_month:b.z.number().int().min(1).max(12).optional().nullable(),card_exp_year:b.z.number().int().min(2024).optional().nullable(),check_number:b.z.string().max(50).optional().nullable(),transaction_id:b.z.string().max(200).optional().nullable(),processor:b.z.string().max(50).optional().nullable(),processor_name:b.z.string().max(50).optional().nullable(),processor_transaction_id:b.z.string().max(200).optional().nullable(),processor_fee:b.z.number().int().default(0),net_amount:b.z.number().int().default(0),processor_metadata:b.z.record(b.z.string(),b.z.unknown()).optional().nullable(),processor_response:b.z.record(b.z.string(),b.z.unknown()).optional().nullable(),refunded_amount:b.z.number().int().default(0),original_payment_id:b.z.string().uuid().optional().nullable(),refund_reason:b.z.string().optional().nullable(),notes:b.z.string().optional().nullable(),is_reconciled:b.z.boolean().default(!1),reconciled_at:b.z.date().optional().nullable(),reconciled_by:b.z.string().uuid().optional().nullable(),deposit_date:b.z.date().optional().nullable(),bank_account_id:b.z.string().uuid().optional().nullable(),processed_at:b.z.date().optional().nullable(),processed_by:b.z.string().uuid().optional().nullable()}),f=e.partial().omit({company_id:!0,payment_number:!0});e.extend({id:b.z.string().uuid(),created_at:b.z.date(),updated_at:b.z.date(),deleted_at:b.z.date().nullable(),deleted_by:b.z.string().uuid().nullable()});let g=b.z.object({company_id:b.z.string().uuid(),customer_id:b.z.string().uuid(),property_id:b.z.string().uuid().optional().nullable(),equipment_number:b.z.string().min(1,"Equipment number is required").max(50),type:b.z.enum(["hvac","plumbing","electrical","appliance","other"]),category:b.z.string().max(100).optional().nullable(),manufacturer:b.z.string().max(100).optional().nullable(),model:b.z.string().max(100).optional().nullable(),serial_number:b.z.string().max(100).optional().nullable(),year:b.z.number().int().min(1900).max(2100).optional().nullable(),install_date:b.z.date().optional().nullable(),location:b.z.string().max(200).optional().nullable(),size:b.z.string().max(50).optional().nullable(),capacity:b.z.string().max(50).optional().nullable(),fuel_type:b.z.string().max(50).optional().nullable(),efficiency_rating:b.z.string().max(50).optional().nullable(),warranty_expiration:b.z.date().optional().nullable(),is_under_warranty:b.z.boolean().default(!1),warranty_provider:b.z.string().max(100).optional().nullable(),warranty_notes:b.z.string().optional().nullable(),purchase_price:b.z.number().int().optional().nullable(),current_value:b.z.number().int().optional().nullable(),status:b.z.enum(["active","inactive","retired","warranty","needs_service"]).default("active"),condition:b.z.enum(["excellent","good","fair","poor"]).optional().nullable(),last_service_date:b.z.date().optional().nullable(),next_service_due:b.z.date().optional().nullable(),service_interval_months:b.z.number().int().optional().nullable(),service_plan_id:b.z.string().uuid().optional().nullable(),notes:b.z.string().optional().nullable(),tags:b.z.array(b.z.string()).optional().nullable(),metadata:b.z.record(b.z.string(),b.z.unknown()).optional().nullable()});g.partial().omit({company_id:!0,equipment_number:!0}),g.extend({id:b.z.string().uuid(),created_at:b.z.date(),updated_at:b.z.date(),deleted_at:b.z.date().nullable(),deleted_by:b.z.string().uuid().nullable()});let h=b.z.object({company_id:b.z.string().uuid(),customer_id:b.z.string().uuid().optional().nullable(),job_id:b.z.string().uuid().optional().nullable(),assigned_to:b.z.string().uuid().optional().nullable(),type:b.z.enum(["appointment","task","event","block","callback"]).default("appointment"),title:b.z.string().min(1,"Title is required").max(200),description:b.z.string().optional().nullable(),start_time:b.z.date(),end_time:b.z.date(),duration:b.z.number().int().min(15),all_day:b.z.boolean().default(!1),status:b.z.enum(["scheduled","confirmed","in_progress","completed","cancelled","no_show"]).default("scheduled"),priority:b.z.enum(["low","normal","high","urgent"]).default("normal"),location:b.z.string().max(500).optional().nullable(),latitude:b.z.number().optional().nullable(),longitude:b.z.number().optional().nullable(),is_recurring:b.z.boolean().default(!1),recurrence_rule:b.z.record(b.z.string(),b.z.unknown()).optional().nullable(),parent_schedule_id:b.z.string().uuid().optional().nullable(),color:b.z.string().max(7).optional().nullable(),reminder_enabled:b.z.boolean().default(!0),reminder_sent:b.z.boolean().default(!1),reminder_hours_before:b.z.number().int().default(24),notes:b.z.string().optional().nullable(),tags:b.z.array(b.z.string()).optional().nullable(),metadata:b.z.record(b.z.string(),b.z.unknown()).optional().nullable(),dispatch_time:b.z.union([b.z.date(),b.z.string()]).optional().nullable(),actual_start_time:b.z.union([b.z.date(),b.z.string()]).optional().nullable(),actual_end_time:b.z.union([b.z.date(),b.z.string()]).optional().nullable(),actual_duration:b.z.number().int().optional().nullable()});h.partial().omit({company_id:!0}),h.extend({id:b.z.string().uuid(),created_at:b.z.date(),updated_at:b.z.date(),deleted_at:b.z.date().nullable(),deleted_by:b.z.string().uuid().nullable()});let i=b.z.object({company_id:b.z.string().uuid(),name:b.z.string().min(1,"Tag name is required").max(50),slug:b.z.string().min(1).max(60),description:b.z.string().max(500).optional().nullable(),category:b.z.enum(["customer","job","equipment","communication","general"]).optional().nullable(),color:b.z.string().regex(/^#[0-9A-Fa-f]{6}$/,"Invalid hex color").optional().nullable(),icon:b.z.string().max(50).optional().nullable(),usage_count:b.z.number().int().default(0),is_system:b.z.boolean().default(!1),is_active:b.z.boolean().default(!0)});i.partial().omit({company_id:!0,slug:!0}),i.extend({id:b.z.string().uuid(),created_at:b.z.date(),updated_at:b.z.date()});let j=b.z.object({company_id:b.z.string().uuid(),entity_type:b.z.enum(["job","customer","invoice","equipment","communication","estimate","other"]),entity_id:b.z.string().uuid(),file_name:b.z.string().min(1,"File name is required").max(255),file_size:b.z.number().int().min(1,"File size must be greater than 0"),mime_type:b.z.string().min(1,"MIME type is required").max(100),storage_url:b.z.string().url("Invalid storage URL"),storage_path:b.z.string().max(500).optional().nullable(),bucket:b.z.string().max(100).optional().nullable(),is_image:b.z.boolean().default(!1),is_document:b.z.boolean().default(!1),is_public:b.z.boolean().default(!1),thumbnail_url:b.z.string().url().optional().nullable(),width:b.z.number().int().optional().nullable(),height:b.z.number().int().optional().nullable(),alt_text:b.z.string().max(200).optional().nullable(),description:b.z.string().max(500).optional().nullable(),tags:b.z.array(b.z.string()).optional().nullable(),uploaded_by:b.z.string().uuid().optional().nullable(),uploaded_at:b.z.date().optional().nullable()});j.partial().omit({company_id:!0,entity_type:!0,entity_id:!0}),j.extend({id:b.z.string().uuid(),created_at:b.z.date(),updated_at:b.z.date(),deleted_at:b.z.date().nullable(),deleted_by:b.z.string().uuid().nullable()});let k=b.z.object({job_id:b.z.string().uuid(),company_id:b.z.string().uuid(),user_id:b.z.string().uuid(),clock_in:b.z.date(),clock_out:b.z.date().optional().nullable(),break_minutes:b.z.number().int().min(0).max(1439).default(0),clock_in_location:b.z.object({lat:b.z.number(),lng:b.z.number(),accuracy:b.z.number().optional(),address:b.z.string().optional()}).optional().nullable(),clock_out_location:b.z.object({lat:b.z.number(),lng:b.z.number(),accuracy:b.z.number().optional(),address:b.z.string().optional()}).optional().nullable(),gps_verified:b.z.boolean().default(!1),entry_type:b.z.enum(["manual","auto","gps"]).default("manual"),notes:b.z.string().optional().nullable(),is_overtime:b.z.boolean().default(!1),is_billable:b.z.boolean().default(!0),hourly_rate:b.z.number().int().optional().nullable(),metadata:b.z.any().optional().nullable()});k.partial().omit({job_id:!0,company_id:!0,user_id:!0}),k.extend({id:b.z.string().uuid(),total_hours:b.z.number().optional().nullable(),created_at:b.z.date(),updated_at:b.z.date()});let l=b.z.object({job_id:b.z.string().uuid(),company_id:b.z.string().uuid(),uploaded_by:b.z.string().uuid(),storage_path:b.z.string().min(1,"Storage path is required"),thumbnail_path:b.z.string().optional().nullable(),file_name:b.z.string().min(1,"File name is required").max(255),file_size:b.z.number().int().min(1).max(0x3200000),mime_type:b.z.string().optional().nullable(),category:b.z.enum(["before","during","after","issue","equipment","completion","other"]),subcategory:b.z.string().max(100).optional().nullable(),title:b.z.string().max(200).optional().nullable(),description:b.z.string().optional().nullable(),is_customer_visible:b.z.boolean().default(!0),is_required_photo:b.z.boolean().default(!1),photo_location:b.z.object({lat:b.z.number(),lng:b.z.number(),accuracy:b.z.number().optional(),address:b.z.string().optional()}).optional().nullable(),taken_at:b.z.date().optional().nullable(),device_info:b.z.any().optional().nullable(),exif_data:b.z.any().optional().nullable(),annotations:b.z.array(b.z.any()).optional().nullable(),tags:b.z.array(b.z.string()).optional().nullable(),display_order:b.z.number().int().default(0),metadata:b.z.any().optional().nullable()});l.partial().omit({job_id:!0,company_id:!0,uploaded_by:!0}),l.extend({id:b.z.string().uuid(),created_at:b.z.date(),updated_at:b.z.date()});let m=b.z.object({company_id:b.z.string().uuid(),stage_name:b.z.string().min(1,"Stage name is required").max(100),stage_key:b.z.string().min(1,"Stage key is required").max(100),display_order:b.z.number().int().min(0).default(0),stage_color:b.z.string().max(20).optional().nullable(),stage_icon:b.z.string().max(50).optional().nullable(),is_start_stage:b.z.boolean().default(!1),is_end_stage:b.z.boolean().default(!1),requires_approval:b.z.boolean().default(!1),approval_roles:b.z.array(b.z.any()).optional().nullable(),required_fields:b.z.array(b.z.string()).optional().nullable(),required_photos_count:b.z.number().int().min(0).default(0),required_time_entry:b.z.boolean().default(!1),auto_send_email:b.z.boolean().default(!1),email_template_id:b.z.string().uuid().optional().nullable(),auto_send_sms:b.z.boolean().default(!1),sms_template_id:b.z.string().uuid().optional().nullable(),auto_create_invoice:b.z.boolean().default(!1),allowed_next_stages:b.z.array(b.z.string()).optional().nullable(),industry_type:b.z.string().max(50).optional().nullable(),is_active:b.z.boolean().default(!0),metadata:b.z.any().optional().nullable()});m.partial().omit({company_id:!0}),m.extend({id:b.z.string().uuid(),created_at:b.z.date(),updated_at:b.z.date()});let n=b.z.object({job_id:b.z.string().uuid(),company_id:b.z.string().uuid(),signature_type:b.z.enum(["customer","technician","inspector","supervisor","other"]),signer_name:b.z.string().min(1,"Signer name is required").max(200),signer_email:b.z.string().email().optional().nullable(),signer_phone:b.z.string().max(20).optional().nullable(),signer_role:b.z.string().max(100).optional().nullable(),signature_data_url:b.z.string().min(1,"Signature data is required"),signature_hash:b.z.string().optional().nullable(),signed_at:b.z.date().default(()=>new Date),signed_location:b.z.object({lat:b.z.number(),lng:b.z.number(),accuracy:b.z.number().optional(),address:b.z.string().optional()}).optional().nullable(),ip_address:b.z.string().max(45).optional().nullable(),user_agent:b.z.string().optional().nullable(),device_info:b.z.any().optional().nullable(),document_type:b.z.enum(["job_completion","estimate","change_order","work_authorization","inspection","other"]),document_content:b.z.any().optional().nullable(),agreement_text:b.z.string().optional().nullable(),is_verified:b.z.boolean().default(!1),verified_at:b.z.date().optional().nullable(),verified_by:b.z.string().uuid().optional().nullable(),metadata:b.z.any().optional().nullable()});n.partial().omit({job_id:!0,company_id:!0}),n.extend({id:b.z.string().uuid(),created_at:b.z.date()});let o=b.z.object({company_id:b.z.string().uuid(),job_number:b.z.string().min(1,"Job number is required").max(50),title:b.z.string().min(1,"Title is required").max(200),description:b.z.string().optional().nullable(),status:b.z.enum(["quoted","scheduled","in_progress","on_hold","completed","cancelled","archived"]).default("quoted"),priority:b.z.enum(["low","medium","high","urgent"]).default("medium"),job_type:b.z.string().max(100).optional().nullable(),service_type:b.z.string().max(100).optional().nullable(),property_id:b.z.string().uuid().optional().nullable(),customer_id:b.z.string().uuid().optional().nullable(),assigned_to:b.z.string().uuid().optional().nullable(),scheduled_start:b.z.date().optional().nullable(),scheduled_end:b.z.date().optional().nullable(),notes:b.z.string().optional().nullable(),metadata:b.z.any().optional().nullable()});o.partial().omit({company_id:!0}),o.extend({id:b.z.string().uuid(),created_at:b.z.date(),updated_at:b.z.date(),deleted_at:b.z.date().nullable(),archived_at:b.z.date().nullable(),search_vector:b.z.any().nullable()});let p=b.z.object({company_id:b.z.string().uuid(),name:b.z.string().min(1,"Vendor name is required").max(200),display_name:b.z.string().min(1,"Display name is required").max(200),vendor_number:b.z.string().min(1,"Vendor number is required").max(50),email:b.z.string().email("Invalid email address").optional().nullable(),phone:b.z.string().max(20).optional().nullable(),secondary_phone:b.z.string().max(20).optional().nullable(),website:b.z.string().url("Invalid URL").optional().nullable(),address:b.z.string().max(500).optional().nullable(),address2:b.z.string().max(500).optional().nullable(),city:b.z.string().max(100).optional().nullable(),state:b.z.string().max(100).optional().nullable(),zip_code:b.z.string().max(20).optional().nullable(),country:b.z.string().max(100).default("USA"),tax_id:b.z.string().max(50).optional().nullable(),payment_terms:b.z.enum(["net_15","net_30","net_60","due_on_receipt","custom"]).default("net_30"),credit_limit:b.z.number().int().min(0).default(0),preferred_payment_method:b.z.enum(["check","ach","credit_card","wire"]).optional().nullable(),category:b.z.enum(["supplier","distributor","manufacturer","service_provider","other"]).optional().nullable(),tags:b.z.array(b.z.string()).optional().nullable(),status:b.z.enum(["active","inactive"]).default("active"),notes:b.z.string().optional().nullable(),internal_notes:b.z.string().optional().nullable(),custom_fields:b.z.record(b.z.string(),b.z.any()).optional().nullable()}),q=p.partial().omit({company_id:!0});p.extend({id:b.z.string().uuid(),created_at:b.z.date(),updated_at:b.z.date(),deleted_at:b.z.date().optional().nullable(),deleted_by:b.z.string().uuid().optional().nullable()});let r=b.z.object({id:b.z.string().uuid().optional(),description:b.z.string().min(1,"Description is required"),quantity:b.z.number().positive("Quantity must be positive"),unit_price:b.z.number().nonnegative("Unit price must be non-negative"),total:b.z.number().nonnegative("Total must be non-negative")}),s=b.z.object({company_id:b.z.string().uuid(),job_id:b.z.string().uuid().optional().nullable(),estimate_id:b.z.string().uuid().optional().nullable(),invoice_id:b.z.string().uuid().optional().nullable(),requested_by:b.z.string().uuid(),approved_by:b.z.string().uuid().optional().nullable(),vendor_id:b.z.string().uuid().optional().nullable(),vendor:b.z.string().min(1,"Vendor name is required").max(200),vendor_email:b.z.string().email("Invalid email address").optional().nullable(),vendor_phone:b.z.string().max(20).optional().nullable(),po_number:b.z.string().min(1,"PO number is required").max(100),title:b.z.string().min(1,"Title is required").max(200),description:b.z.string().optional().nullable(),status:b.z.enum(["draft","pending_approval","approved","ordered","partially_received","received","cancelled"]).default("draft"),priority:b.z.enum(["low","normal","high","urgent"]).default("normal"),line_items:b.z.array(r).min(1,"At least one line item is required"),subtotal:b.z.number().int().nonnegative().default(0),tax_amount:b.z.number().int().nonnegative().default(0),shipping_amount:b.z.number().int().nonnegative().default(0),total_amount:b.z.number().int().nonnegative().default(0),expected_delivery:b.z.date().optional().nullable(),actual_delivery:b.z.date().optional().nullable(),delivery_address:b.z.string().max(500).optional().nullable(),notes:b.z.string().optional().nullable(),internal_notes:b.z.string().optional().nullable(),auto_generated:b.z.boolean().default(!1)});s.partial().omit({company_id:!0}),s.extend({id:b.z.string().uuid(),created_at:b.z.date(),updated_at:b.z.date(),approved_at:b.z.date().optional().nullable(),ordered_at:b.z.date().optional().nullable(),received_at:b.z.date().optional().nullable()}),a.s(["paymentInsertSchema",0,e,"paymentUpdateSchema",0,f,"purchaseOrderInsertSchema",0,s,"vendorInsertSchema",0,p,"vendorUpdateSchema",0,q])},890375,a=>{"use strict";var b=a.i(780195),c=a.i(218188),d=a.i(818944),e=a.i(974406),f=a.i(136874),g=a.i(630351);async function h(a,b){return(0,e.withErrorHandling)(async()=>{let h=await (0,f.createClient)();if(!h)throw new d.ActionError("Database connection failed",d.ERROR_CODES.DB_CONNECTION_ERROR);let{data:{user:i}}=await h.auth.getUser();(0,e.assertAuthenticated)(i?.id);let{data:j}=await h.from("company_memberships").select("company_id").eq("user_id",i.id).eq("status","active").single();if(!j?.company_id)throw new d.ActionError("You must be part of a company",d.ERROR_CODES.AUTH_FORBIDDEN,403);let{data:k}=await h.from("vendors").select("id, company_id, vendor_number").eq("id",a).is("deleted_at",null).single();if((0,e.assertExists)(k,"Vendor"),k.company_id!==j.company_id)throw new d.ActionError(d.ERROR_MESSAGES.forbidden("vendor"),d.ERROR_CODES.AUTH_FORBIDDEN,403);let l={};b.has("name")&&(l.name=b.get("name")),b.has("display_name")&&(l.display_name=b.get("display_name")),b.has("vendor_number")&&(l.vendor_number=b.get("vendor_number")),b.has("email")&&(l.email=b.get("email")||void 0),b.has("phone")&&(l.phone=b.get("phone")||void 0),b.has("secondary_phone")&&(l.secondary_phone=b.get("secondary_phone")||void 0),b.has("website")&&(l.website=b.get("website")||void 0),b.has("address")&&(l.address=b.get("address")||void 0),b.has("address2")&&(l.address2=b.get("address2")||void 0),b.has("city")&&(l.city=b.get("city")||void 0),b.has("state")&&(l.state=b.get("state")||void 0),b.has("zip_code")&&(l.zip_code=b.get("zip_code")||void 0),b.has("country")&&(l.country=b.get("country")),b.has("tax_id")&&(l.tax_id=b.get("tax_id")||void 0),b.has("payment_terms")&&(l.payment_terms=b.get("payment_terms")),b.has("credit_limit")&&(l.credit_limit=100*Number.parseInt(b.get("credit_limit"),10)),b.has("preferred_payment_method")&&(l.preferred_payment_method=b.get("preferred_payment_method")),b.has("category")&&(l.category=b.get("category")),b.has("tags")&&(l.tags=JSON.parse(b.get("tags"))),b.has("status")&&(l.status=b.get("status")),b.has("notes")&&(l.notes=b.get("notes")||void 0),b.has("internal_notes")&&(l.internal_notes=b.get("internal_notes")||void 0),b.has("custom_fields")&&(l.custom_fields=JSON.parse(b.get("custom_fields")));let m=g.vendorUpdateSchema.parse(l);if(m.vendor_number&&m.vendor_number!==k.vendor_number){let{data:b}=await h.from("vendors").select("id").eq("company_id",j.company_id).eq("vendor_number",m.vendor_number).neq("id",a).is("deleted_at",null).single();if(b)throw new d.ActionError("Vendor number already exists",d.ERROR_CODES.VALIDATION_FAILED)}let{error:n}=await h.from("vendors").update(m).eq("id",a);if(n)throw new d.ActionError("Failed to update vendor",d.ERROR_CODES.DB_QUERY_ERROR);(0,c.revalidatePath)("/dashboard/inventory/vendors"),(0,c.revalidatePath)(`/dashboard/inventory/vendors/${a}`)})}async function i(b){return(0,e.withErrorHandling)(async()=>{let c=await (0,f.createClient)();if(!c)throw new d.ActionError("Database connection failed",d.ERROR_CODES.DB_CONNECTION_ERROR);let{data:{user:g}}=await c.auth.getUser();(0,e.assertAuthenticated)(g?.id);let{getActiveCompanyId:h}=await a.A(37652),i=await h();if(!i)throw new d.ActionError("No active company",d.ERROR_CODES.AUTH_FORBIDDEN,403);let{data:j}=await c.from("company_memberships").select("company_id").eq("user_id",g.id).eq("company_id",i).eq("status","active").maybeSingle();if(!j?.company_id)throw new d.ActionError("You don't have access to this company",d.ERROR_CODES.AUTH_FORBIDDEN,403);let{data:k,error:l}=await c.from("vendors").select("id, name, display_name, vendor_number, email, phone, status").eq("company_id",i).eq("status","active").is("deleted_at",null).or(`name.ilike.%${b}%,display_name.ilike.%${b}%,vendor_number.ilike.%${b}%,email.ilike.%${b}%`).limit(20);if(l)throw new d.ActionError("Failed to search vendors",d.ERROR_CODES.DB_QUERY_ERROR);return k||[]})}async function j(a,b){return(0,e.withErrorHandling)(async()=>{let g=await (0,f.createClient)();if(!g)throw new d.ActionError("Database connection failed",d.ERROR_CODES.DB_CONNECTION_ERROR);let{data:{user:h}}=await g.auth.getUser();(0,e.assertAuthenticated)(h?.id);let{data:i}=await g.from("company_memberships").select("company_id").eq("user_id",h.id).eq("status","active").single();if(!i?.company_id)throw new d.ActionError("You must be part of a company",d.ERROR_CODES.AUTH_FORBIDDEN,403);let{data:j}=await g.from("purchase_orders").select("id, company_id").eq("id",a).is("deleted_at",null).single();if((0,e.assertExists)(j,"Purchase Order"),j.company_id!==i.company_id)throw new d.ActionError(d.ERROR_MESSAGES.forbidden("purchase order"),d.ERROR_CODES.AUTH_FORBIDDEN,403);let{data:k}=await g.from("vendors").select("id, company_id").eq("id",b).is("deleted_at",null).single();if((0,e.assertExists)(k,"Vendor"),k.company_id!==i.company_id)throw new d.ActionError(d.ERROR_MESSAGES.forbidden("vendor"),d.ERROR_CODES.AUTH_FORBIDDEN,403);let{error:l}=await g.from("purchase_orders").update({vendor_id:b}).eq("id",a);if(l)throw new d.ActionError("Failed to link purchase order",d.ERROR_CODES.DB_QUERY_ERROR);(0,c.revalidatePath)("/dashboard/work/vendors"),(0,c.revalidatePath)(`/dashboard/work/vendors/${b}`),(0,c.revalidatePath)("/dashboard/work/purchase-orders"),(0,c.revalidatePath)(`/dashboard/work/purchase-orders/${a}`)})}async function k(a){try{let b=await (0,f.createClient)();if(!b)return{success:!1,error:"Database connection not available"};let{data:{user:d}}=await b.auth.getUser();if(!d)return{success:!1,error:"Unauthorized"};let{error:e}=await b.from("vendors").update({deleted_at:new Date().toISOString()}).eq("id",a);if(e)return{success:!1,error:e.message};return(0,c.revalidatePath)("/dashboard/work/vendors"),{success:!0}}catch(a){return{success:!1,error:"Failed to archive vendor"}}}(0,a.i(395731).ensureServerEntryExports)([h,i,j,k]),(0,b.registerServerReference)(h,"60a2c2541dd7a2b99ced91c4831ad6e7aed4e0f771",null),(0,b.registerServerReference)(i,"40990cbea52b9beb7f6d90e3e041e715107bac3abd",null),(0,b.registerServerReference)(j,"6018c9fe3e245f3bb8e79754f11be25b7ab31a43e5",null),(0,b.registerServerReference)(k,"40600e0b1fe6893295955e885b5d01cdc3feee8e1b",null),a.s(["archiveVendor",()=>k,"linkPurchaseOrderToVendor",()=>j,"searchVendors",()=>i,"updateVendor",()=>h])}];

//# sourceMappingURL=apps_web_src_32e09334._.js.map