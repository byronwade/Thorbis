module.exports=[961367,a=>{"use strict";var b=a.i(861467),c=a.i(916680),d=a.i(90083),e=a.i(60222),f=a.i(779184),g=a.i(337850),h=a.i(412020),h=h,i=a.i(508399),j=a.i(125987),k=a.i(138382),l=a.i(856856),m=a.i(259515),m=m,n=a.i(483967),o=a.i(898062),p=a.i(217547),q=a.i(331418),q=q,r=a.i(362841),s=a.i(821278),t=a.i(337241),u=a.i(783281);a.i(445255);var v=a.i(18170);a.i(297229);var w=a.i(489904);a.i(146697);var x=a.i(778737);a.i(156120);var y=a.i(864889);a.i(928414);var z=a.i(745250),A=a.i(898465),B=a.i(827033),C=a.i(457693),D=a.i(132440),E=a.i(563491),F=a.i(700760),G=a.i(21118),H=a.i(638446),I=a.i(766153),J=a.i(624126),K=a.i(824124),L=a.i(808249),M=a.i(283753),N=a.i(624038),O=a.i(976803),P=a.i(156916),Q=a.i(169021),R=(0,Q.createServerReference)("709ff518b423ff85ccdab8fd8c525866ab7c2e1e84",Q.callServer,void 0,Q.findSourceMapURL,"applyOptimizedRoute"),S=(0,Q.createServerReference)("700bf3a7c25407ce7fad3c374625a5f2d9a161744c",Q.callServer,void 0,Q.findSourceMapURL,"optimizeTechnicianRoute");a.i(516775);var T=a.i(560272);a.i(288007);var U=a.i(986990);a.i(380934);var V=a.i(347421);a.i(919381);var W=a.i(662143);a.i(799390);var X=a.i(985943);function Y(a){let b=Math.round(a/60);if(b<60)return`${b} min`;let c=Math.floor(b/60),d=b%60;return d>0?`${c}h ${d}m`:`${c}h`}let Z=(0,u.memo)(function({technicianId:a,technicianName:c,jobs:d,onOptimize:e,isOptimizing:f,result:h,onApply:i,isApplying:j}){var k;let[l,m]=(0,u.useState)(!1),n=h&&h.savings.timeSeconds>0,o=c.split(" ").map(a=>a[0]).join("").toUpperCase();return(0,b.jsx)(V.Card,{className:(0,F.cn)("transition-all",n&&"border-green-500/30 bg-green-500/5"),children:(0,b.jsxs)(V.CardContent,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(T.Avatar,{className:"h-9 w-9",children:(0,b.jsx)(T.AvatarFallback,{className:"bg-primary/10 text-primary text-xs font-semibold",children:o})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:c}),(0,b.jsxs)("div",{className:"text-muted-foreground text-sm",children:[d.length," job",1!==d.length?"s":""," scheduled"]})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:h?n?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(U.Badge,{variant:"secondary",className:"bg-green-500/10 text-green-600",children:[(0,b.jsx)(N.TrendingDown,{className:"mr-1 h-3 w-3"}),"Save ",Y(h.savings.timeSeconds)]}),(0,b.jsx)(v.Button,{size:"sm",onClick:i,disabled:j,className:"gap-1",children:j?"Applying...":(0,b.jsxs)(b.Fragment,{children:["Apply",(0,b.jsx)(H.Check,{className:"h-4 w-4"})]})})]}):(0,b.jsx)(U.Badge,{variant:"outline",className:"text-muted-foreground",children:"Already optimal"}):(0,b.jsx)(v.Button,{size:"sm",variant:"outline",onClick:e,disabled:f||d.length<2,className:"gap-1",children:f?"Calculating...":(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(L.Route,{className:"h-4 w-4"}),"Optimize"]})})})]}),h&&n&&(0,b.jsxs)(W.Collapsible,{open:l,onOpenChange:m,children:[(0,b.jsxs)(W.CollapsibleTrigger,{className:"mt-3 flex w-full items-center justify-between rounded-md bg-muted/50 px-3 py-2 text-sm hover:bg-muted transition-colors",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"View optimized route details"}),l?(0,b.jsx)(I.ChevronDown,{className:"h-4 w-4"}):(0,b.jsx)(g.ChevronRight,{className:"h-4 w-4"})]}),(0,b.jsxs)(W.CollapsibleContent,{className:"mt-3 space-y-3",children:[(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,b.jsxs)("div",{className:"rounded-lg bg-muted/50 p-2.5 text-center",children:[(0,b.jsxs)("div",{className:"flex items-center justify-center gap-1 text-green-600",children:[(0,b.jsx)(J.Clock,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"text-sm font-semibold",children:Y(h.savings.timeSeconds)})]}),(0,b.jsx)("div",{className:"text-muted-foreground text-xs",children:"Time saved"})]}),(0,b.jsxs)("div",{className:"rounded-lg bg-muted/50 p-2.5 text-center",children:[(0,b.jsxs)("div",{className:"flex items-center justify-center gap-1 text-green-600",children:[(0,b.jsx)(G.Car,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"text-sm font-semibold",children:(k=h.savings.distanceMeters,`${(k/1609.344).toFixed(1)} mi`)})]}),(0,b.jsx)("div",{className:"text-muted-foreground text-xs",children:"Distance saved"})]}),(0,b.jsxs)("div",{className:"rounded-lg bg-muted/50 p-2.5 text-center",children:[(0,b.jsxs)("div",{className:"flex items-center justify-center gap-1 text-green-600",children:[(0,b.jsx)(N.TrendingDown,{className:"h-4 w-4"}),(0,b.jsxs)("span",{className:"text-sm font-semibold",children:[h.savings.percentImprovement,"%"]})]}),(0,b.jsx)("div",{className:"text-muted-foreground text-xs",children:"Improvement"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-muted-foreground text-xs font-medium uppercase tracking-wide",children:"Optimized Route Order"}),(0,b.jsx)("div",{className:"space-y-1.5",children:h.route.map((a,c)=>{let e=d.find(b=>b.id===a.jobId);return(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-md bg-background/80 p-2 text-sm",children:[(0,b.jsx)("div",{className:"flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-primary/10 text-xs font-semibold text-primary",children:c+1}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("div",{className:"truncate font-medium",children:e?.customer?.name||"Unknown"}),(0,b.jsx)("div",{className:"text-muted-foreground truncate text-xs",children:e?.location?.address?.street})]}),a.fromPrevious&&(0,b.jsxs)("div",{className:"text-muted-foreground shrink-0 text-xs",children:[(0,b.jsx)(G.Car,{className:"mr-1 inline-block h-3 w-3"}),Y(a.fromPrevious.durationSeconds)]})]},a.jobId)})})]})]})]}),d.length<2&&(0,b.jsx)("div",{className:"text-muted-foreground mt-2 text-sm",children:"Need at least 2 jobs to optimize route"})]})})});function $({technicians:a,jobsByTechnician:c,selectedDate:d,className:e}){let[f,g]=(0,u.useTransition)(),[h,i]=(0,u.useState)(null),[j,k]=(0,u.useState)(null),[l,m]=(0,u.useState)(new Map),n=Array.from(a.values()).map(a=>({tech:a,jobs:c.get(a.id)||[]})).filter(({jobs:a})=>a.length>0).sort((a,b)=>b.jobs.length-a.jobs.length),o=n.filter(({jobs:a})=>a.length>=2),p=Array.from(l.values()).reduce((a,b)=>a+b.savings.timeSeconds,0),q=(0,u.useCallback)((b,c)=>{i(b),g(async()=>{try{let d=c.map(a=>({id:a.id,title:a.title,location:{address:a.location?.address?`${a.location.address.street}, ${a.location.address.city}, ${a.location.address.state}`:void 0,latitude:a.location?.coordinates?.lat,longitude:a.location?.coordinates?.lng},scheduledStart:a.startTime,scheduledEnd:a.endTime})),e=await S(b,d);if(e.success&&e.data){let d=a.get(b);m(a=>{let f=new Map(a);return f.set(b,{technicianId:b,technicianName:d?.name||"Technician",jobCount:c.length,originalOrder:c.map(a=>a.id),optimizedOrder:e.data.optimizedOrder,savings:e.data.savings,route:e.data.route.map(a=>({...a,jobTitle:c.find(b=>b.id===a.jobId)?.title}))}),f}),e.data.savings.timeSeconds>0?P.toast.success(`Found ${Y(e.data.savings.timeSeconds)} potential savings!`):P.toast.info("Route is already optimal")}else P.toast.error(e.error||"Failed to optimize route")}catch(a){console.error("Route optimization error:",a),P.toast.error("Failed to calculate optimal route")}finally{i(null)}})},[a]),r=(0,u.useCallback)(a=>{let b=l.get(a);b&&(k(a),g(async()=>{try{let c=await R(a,b.originalOrder,b.optimizedOrder);c.success?(P.toast.success("Route optimized and applied!",{description:`Saved ${Y(b.savings.timeSeconds)} travel time`}),m(b=>{let c=new Map(b);return c.delete(a),c})):P.toast.error(c.error||"Failed to apply route")}catch(a){console.error("Apply route error:",a),P.toast.error("Failed to apply optimized route")}finally{k(null)}}))},[l]),t=(0,u.useCallback)(async()=>{for(let{tech:a,jobs:b}of o)l.has(a.id)||await q(a.id,b)},[o,l,q]);return(0,b.jsxs)("div",{className:(0,F.cn)("flex flex-col gap-4",e),children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(L.Route,{className:"text-primary h-5 w-5"}),(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Route Optimization"})]}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Optimize technician routes to minimize travel time and fuel costs"})]}),p>0&&(0,b.jsx)(V.Card,{className:"border-green-500/30 bg-green-500/5",children:(0,b.jsxs)(V.CardContent,{className:"flex items-center justify-between p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"rounded-full bg-green-500/20 p-2",children:(0,b.jsx)(s.Zap,{className:"h-5 w-5 text-green-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"font-semibold text-green-700 dark:text-green-400",children:[Y(p)," potential savings"]}),(0,b.jsxs)("div",{className:"text-muted-foreground text-sm",children:["Across ",l.size," technician",1!==l.size?"s":""]})]})]}),(0,b.jsxs)(v.Button,{onClick:()=>{for(let[a]of l)r(a)},disabled:f,className:"gap-2",children:["Apply All",(0,b.jsx)(H.Check,{className:"h-4 w-4"})]})]})}),o.length>0&&l.size<o.length&&(0,b.jsxs)(v.Button,{variant:"outline",onClick:t,disabled:f,className:"gap-2",children:[(0,b.jsx)(M.Sparkles,{className:"h-4 w-4"}),"Calculate All Routes (",o.length-l.size," ","remaining)"]}),(0,b.jsx)("div",{className:"space-y-3",children:0===n.length?(0,b.jsx)(V.Card,{children:(0,b.jsxs)(V.CardContent,{className:"flex flex-col items-center justify-center p-8 text-center",children:[(0,b.jsx)(O.Truck,{className:"text-muted-foreground/50 mb-4 h-12 w-12"}),(0,b.jsx)("p",{className:"font-medium",children:"No jobs scheduled"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Route optimization is available when technicians have jobs assigned"})]})}):n.map(({tech:a,jobs:c})=>(0,b.jsx)(Z,{technicianId:a.id,technicianName:a.name,jobs:c,onOptimize:()=>q(a.id,c),isOptimizing:h===a.id,result:l.get(a.id)||null,onApply:()=>r(a.id),isApplying:j===a.id},a.id))}),(0,b.jsx)("div",{className:"text-muted-foreground rounded-lg border border-dashed p-3 text-xs",children:(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(K.MapPin,{className:"mt-0.5 h-4 w-4 shrink-0"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"How it works"}),(0,b.jsx)("p",{className:"mt-1",children:"Route optimization uses the Google Distance Matrix API to calculate the most efficient order for technician visits, reducing travel time and fuel costs while keeping your team on schedule."})]})]})})]})}function _({technicians:a,jobsByTechnician:c,selectedDate:d,trigger:e}){let[f,g]=(0,u.useState)(!1),h=Array.from(a.values()).filter(a=>(c.get(a.id)||[]).length>=2).length;return(0,b.jsxs)(X.Sheet,{open:f,onOpenChange:g,children:[(0,b.jsx)(X.SheetTrigger,{asChild:!0,children:e||(0,b.jsxs)(z.Tooltip,{children:[(0,b.jsx)(z.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)(v.Button,{variant:"outline",size:"sm",className:"gap-1.5",disabled:0===h,children:[(0,b.jsx)(L.Route,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Optimize Routes"}),h>0&&(0,b.jsx)(U.Badge,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:h})]})}),(0,b.jsx)(z.TooltipContent,{children:h>0?`Optimize routes for ${h} technician${1!==h?"s":""}`:"Need technicians with 2+ jobs to optimize"})]})}),(0,b.jsxs)(X.SheetContent,{className:"w-full overflow-y-auto sm:max-w-lg",children:[(0,b.jsxs)(X.SheetHeader,{className:"sr-only",children:[(0,b.jsx)(X.SheetTitle,{children:"Route Optimization"}),(0,b.jsx)(X.SheetDescription,{children:"Optimize technician routes to minimize travel time"})]}),(0,b.jsx)($,{technicians:a,jobsByTechnician:c,selectedDate:d})]})]})}let aa=[{label:"Emergency / Urgent",description:"High priority service calls",icon:c.AlertTriangle,borderClass:"border-l-red-400 dark:border-l-red-700",dotClass:"bg-red-500"},{label:"Callback / Follow Up",description:"Return visits & follow-ups",icon:o.Phone,borderClass:"border-l-orange-400 dark:border-l-orange-700",dotClass:"bg-orange-500"},{label:"Meetings / Events",description:"Training & team events",icon:e.CalendarDays,borderClass:"border-l-purple-400 dark:border-l-purple-700",dotClass:"bg-purple-500"},{label:"Install / New Work",description:"New installations & setups",icon:q.default,borderClass:"border-l-green-400 dark:border-l-green-700",dotClass:"bg-green-500"},{label:"Service / Maintenance",description:"Regular service calls",icon:r.Wrench,borderClass:"border-l-blue-400 dark:border-l-blue-700",dotClass:"bg-blue-500"},{label:"Standard / Other",description:"General appointments",icon:h.default,borderClass:"border-l-slate-300 dark:border-l-slate-700",dotClass:"bg-slate-400"}],ab=[{label:"Scheduled",description:"Job is booked",color:"bg-blue-500",step:1},{label:"Dispatched",description:"Tech en route",color:"bg-sky-500",step:2},{label:"Arrived",description:"Tech on site",color:"bg-emerald-400",step:3},{label:"In Progress",description:"Work started",color:"bg-amber-500",step:4,pulse:!0},{label:"Closed",description:"Work complete",color:"bg-emerald-600",step:5}],ac=[{keys:["T"],description:"Go to Today"},{keys:["N"],description:"New Job"},{keys:["["],description:"Previous Period"},{keys:["]"],description:"Next Period"},{keys:["1"],description:"Timeline View"},{keys:["2"],description:"Monthly View"},{keys:["3"],description:"Kanban View"}];function ad(){let a,c,h,o,q,r,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,[ax,ay]=(0,u.useState)(!1),az=(0,t.usePathname)(),aA=(0,t.useRouter)(),{goToToday:aB,navigatePrevious:aC,navigateNext:aD,viewMode:aE,setViewMode:aF,currentDate:aG}=(0,E.useScheduleViewStore)(),{jobs:aH,technicians:aI}=(a=(0,B.useScheduleStore)(a=>a.isLoading),c=(0,B.useScheduleStore)(a=>a.error),h=(0,B.useScheduleStore)(a=>a.lastSync),o=(0,B.useScheduleStore)(a=>a.jobs),q=(0,B.useScheduleStore)(a=>a.technicians),r=(0,B.useScheduleStore)(a=>a.selectedJobId),G=(0,B.useScheduleStore)(a=>a.selectedTechnicianId),H=(0,B.useScheduleStore)(a=>a.lastFetchedRange),I=(0,B.useScheduleStore)(a=>a.companyId),J=(0,B.useScheduleStore)(a=>a.unassignedHasMore),K=(0,B.useScheduleStore)(a=>a.unassignedSearch),L=(0,B.useScheduleStore)(a=>a.isLoadingUnassigned),M=(0,B.useScheduleStore)(a=>a.unassignedTotalCount),N=(0,B.useScheduleStore)(a=>a.setLoading),O=(0,B.useScheduleStore)(a=>a.setError),P=(0,B.useScheduleStore)(a=>a.setJobs),Q=(0,B.useScheduleStore)(a=>a.setTechnicians),R=(0,B.useScheduleStore)(a=>a.selectJob),S=(0,B.useScheduleStore)(a=>a.selectTechnician),T=(0,B.useScheduleStore)(a=>a.addJob),U=(0,B.useScheduleStore)(a=>a.updateJob),V=(0,B.useScheduleStore)(a=>a.moveJob),W=(0,B.useScheduleStore)(a=>a.deleteJob),X=(0,B.useScheduleStore)(a=>a.duplicateJob),Y=(0,B.useScheduleStore)(a=>a.getJobById),Z=(0,B.useScheduleStore)(a=>a.syncWithServer),$=(0,B.useScheduleStore)(a=>a.setLastSync),ad=(0,B.useScheduleStore)(a=>a.setCompanyId),ae=(0,B.useScheduleStore)(a=>a.setLastFetchedRange),af=(0,B.useScheduleStore)(a=>a.setUnassignedMeta),ag=(0,B.useScheduleStore)(a=>a.getUnassignedJobs),ah=(0,B.useScheduleStore)(a=>a.getJobsGroupedByTechnician),ai=(0,B.useScheduleStore)(a=>a.loadMoreUnassignedJobs),aj=(0,C.useViewStore)(a=>a.filters),ak=(0,C.useViewStore)(a=>a.showCompletedJobs),(0,C.useViewStore)(a=>a.currentDate),(0,C.useViewStore)(a=>a.zoom),am=(al=(0,u.useMemo)(()=>C.useViewStore.getState().getVisibleTimeRange(),[])).start.getTime(),an=al.end.getTime(),ao=(0,u.useRef)(B.useScheduleStore.getState().companyId),(0,u.useEffect)(()=>{ao.current=I},[I]),ap=o.size,aq=(0,u.useMemo)(()=>{if(!H||0===ap)return!1;let a=H.start.getTime(),b=H.end.getTime();return a<=am&&b>=an},[ap,H,an,am]),(0,u.useEffect)(()=>{let a=!0;return aq&&ao.current?()=>{a=!1}:((async()=>{N(!0),O(null);try{let b=(0,D.createClient)();if(!b)throw Error("Database connection not available");let{data:{user:c},error:d}=await b.auth.getUser();if(d)throw d;if(!c)throw Error("User session not found");let e=ao.current;if(!e){let{data:a,error:d}=await b.from("company_memberships").select("company_id").eq("user_id",c.id).eq("status","active").order("joined_at",{ascending:!1,nullsFirst:!1}).limit(1).maybeSingle();if(d)throw d;if(!a?.company_id)throw Error("No active company membership found");ao.current=e=a.company_id,ad(e)}if(!e)throw Error("Unable to resolve company context for schedule data");let{jobs:f,technicians:g,unassignedMeta:h}=await (0,A.fetchScheduleData)({supabase:b,companyId:e,range:{start:new Date(am),end:new Date(an)}});if(!a)return;Q(g),P(f);let i={start:new Date(am),end:new Date(an)};Q(g),P(f);let j=f.filter(a=>a.isUnassigned).length;af(h,j),$(new Date),ae(i)}catch(b){if(!a)return;O(b instanceof Error?b.message:"object"==typeof b&&null!==b&&"message"in b?String(b.message):"Unknown error")}finally{a&&N(!1)}})(),()=>{a=!1})},[aq,an,am,ad,ae,O,P,$,N,Q]),ar=(0,u.useMemo)(()=>{var a,b;let c=(a=Array.from(o.values()),b={technicianIds:aj.technicianIds,statuses:aj.statuses,priorities:aj.priorities,searchQuery:aj.searchQuery},a.filter(a=>{if(b.technicianIds&&b.technicianIds.length>0&&!b.technicianIds.some(b=>{var c,d;return c=a,d=b,c.technicianId===d||c.assignments.some(a=>a.technicianId===d)})||b.statuses&&b.statuses.length>0&&!b.statuses.includes(a.status)||b.priorities&&b.priorities.length>0&&!b.priorities.includes(a.priority))return!1;if(b.searchQuery&&""!==b.searchQuery.trim()){let c=b.searchQuery.toLowerCase(),d=a.title.toLowerCase().includes(c),e=a.customer.name.toLowerCase().includes(c),f=a.description?.toLowerCase().includes(c);if(!(d||e||f))return!1}return!0}));return[...ak?c:c.filter(a=>"completed"!==a.status)].sort((a,b)=>{let c=a.startTime instanceof Date?a.startTime:new Date(a.startTime),d=b.startTime instanceof Date?b.startTime:new Date(b.startTime);return c.getTime()-d.getTime()})},[o,aj,ak]),as=(0,u.useMemo)(()=>{let a=Array.from(q.values());return aj.technicianIds.length>0?a.filter(a=>aj.technicianIds.includes(a.id)):a},[q,aj.technicianIds]),at=(0,u.useMemo)(()=>{let a=new Map;for(let b of ar){let c=b.technicianId;if(c){let d=a.get(c);d?d.push(b):a.set(c,[b])}}return a},[ar]),au=(0,u.useCallback)(a=>at.get(a)??[],[at]),av=(0,u.useMemo)(()=>{let{start:a,end:b}=al;return ar.filter(c=>c.startTime<=b&&c.endTime>=a)},[ar,al]),aw=(0,u.useCallback)(()=>Array.from(o.values()),[o]),{isLoading:a,error:c,lastSync:h,technicians:as,jobs:ar,visibleJobs:av,selectedJobId:r,selectedTechnicianId:G,selectedJob:r?Y(r):null,getJobsForTechnician:au,getAllJobs:aw,selectJob:R,selectTechnician:S,getUnassignedJobs:ag,getJobsGroupedByTechnician:ah,unassignedHasMore:J,unassignedSearch:K,isLoadingUnassigned:L,unassignedTotalCount:M,loadMoreUnassignedJobs:ai,addJob:T,updateJob:U,moveJob:V,deleteJob:W,duplicateJob:X,refresh:Z}),aJ="/dashboard/schedule/dispatch-map"===az,aK=new Map;for(let a of aH.values())for(let b of a.assignments)if(b.technicianId){let c=aK.get(b.technicianId)||[];c.push(a),aK.set(b.technicianId,c)}return((0,u.useEffect)(()=>{aJ&&"map"!==aE?aF("map"):aJ||"map"!==aE||aF("day")},[aJ,aE,aF]),(0,u.useEffect)(()=>{ay(!0)},[]),ax)?(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[!aJ&&(0,b.jsx)(v.Button,{onClick:aB,size:"sm",variant:"outline",children:"Today"}),!aJ&&"day"===aE&&(0,b.jsx)(_,{technicians:aI,jobsByTechnician:aK,selectedDate:aG}),(0,b.jsx)(z.TooltipProvider,{children:(0,b.jsxs)(y.ToggleGroup,{className:"border",onValueChange:a=>{a&&("map"===a?(aF("map"),aA.push("/dashboard/schedule/dispatch-map")):(aJ&&aA.push("/dashboard/schedule"),aF(a)))},size:"sm",type:"single",value:aE,children:[(0,b.jsxs)(z.Tooltip,{children:[(0,b.jsx)(z.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(y.ToggleGroupItem,{"aria-label":"Timeline view",value:"day",children:(0,b.jsx)(i.Columns3,{className:"size-4"})})}),(0,b.jsx)(z.TooltipContent,{children:(0,b.jsx)("p",{children:"Timeline View"})})]}),(0,b.jsxs)(z.Tooltip,{children:[(0,b.jsx)(z.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(y.ToggleGroupItem,{"aria-label":"Monthly view",value:"month",children:(0,b.jsx)(e.CalendarDays,{className:"size-4"})})}),(0,b.jsx)(z.TooltipContent,{children:(0,b.jsx)("p",{children:"Monthly Calendar"})})]}),(0,b.jsxs)(z.Tooltip,{children:[(0,b.jsx)(z.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(y.ToggleGroupItem,{"aria-label":"Kanban view",value:"week",children:(0,b.jsx)(l.LayoutGrid,{className:"size-4"})})}),(0,b.jsx)(z.TooltipContent,{children:(0,b.jsx)("p",{children:"Status Board"})})]}),(0,b.jsxs)(z.Tooltip,{children:[(0,b.jsx)(z.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(y.ToggleGroupItem,{"aria-label":"Map view",value:"map",children:(0,b.jsx)(m.default,{className:"size-4"})})}),(0,b.jsx)(z.TooltipContent,{children:(0,b.jsx)("p",{children:"Dispatch Map"})})]})]})}),!aJ&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(v.Button,{onClick:aC,size:"icon",variant:"ghost",children:(0,b.jsx)(f.ChevronLeft,{className:"size-4"})}),(0,b.jsx)(v.Button,{onClick:aD,size:"icon",variant:"ghost",children:(0,b.jsx)(g.ChevronRight,{className:"size-4"})})]}),!aJ&&(0,b.jsxs)(w.Popover,{children:[(0,b.jsx)(w.PopoverTrigger,{asChild:!0,children:(0,b.jsx)(v.Button,{"aria-label":"Show schedule legend",size:"icon",variant:"ghost",children:(0,b.jsx)(j.HelpCircle,{className:"size-4"})})}),(0,b.jsxs)(w.PopoverContent,{align:"end",className:"w-80 p-0",children:[(0,b.jsx)("div",{className:"border-b px-4 py-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"bg-primary/10 flex size-8 items-center justify-center rounded-md",children:(0,b.jsx)(n.Palette,{className:"text-primary size-4"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Schedule Guide"}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:"Colors, statuses & shortcuts"})]})]})}),(0,b.jsxs)("div",{className:"max-h-[400px] overflow-y-auto",children:[(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsxs)("div",{className:"mb-3 flex items-center gap-2",children:[(0,b.jsx)(s.Zap,{className:"text-muted-foreground size-3.5"}),(0,b.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide",children:"Job Types"})]}),(0,b.jsx)("div",{className:"space-y-2",children:aa.map(a=>{let c=a.icon;return(0,b.jsxs)("div",{className:(0,F.cn)("flex items-center gap-3 rounded-lg border-l-4 bg-card/50 px-3 py-2",a.borderClass),children:[(0,b.jsx)("div",{className:"bg-muted flex size-7 shrink-0 items-center justify-center rounded-md",children:(0,b.jsx)(c,{className:"text-muted-foreground size-3.5"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium truncate",children:a.label}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs truncate",children:a.description})]})]},a.label)})})]}),(0,b.jsx)(x.Separator,{}),(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsxs)("div",{className:"mb-3 flex items-center gap-2",children:[(0,b.jsx)(d.ArrowRight,{className:"text-muted-foreground size-3.5"}),(0,b.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide",children:"Status Workflow"})]}),(0,b.jsx)("div",{className:"mb-3",children:(0,b.jsx)("div",{className:"flex items-center justify-between gap-1",children:ab.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center flex-1",children:[(0,b.jsx)("div",{className:(0,F.cn)("h-1.5 flex-1 rounded-full",a.color,a.pulse&&"animate-pulse")}),c<ab.length-1&&(0,b.jsx)(d.ArrowRight,{className:"text-muted-foreground mx-0.5 size-2.5 shrink-0"})]},a.label))})}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[ab.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-md px-2 py-1.5",children:[(0,b.jsx)("span",{className:(0,F.cn)("size-2.5 rounded-full shrink-0",a.color,a.pulse&&"animate-pulse")}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"text-xs font-medium",children:a.label}),(0,b.jsx)("p",{className:"text-muted-foreground text-[10px] truncate",children:a.description})]})]},a.label)),(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-md px-2 py-1.5",children:[(0,b.jsx)("span",{className:"bg-slate-400 size-2.5 rounded-full shrink-0"}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"text-xs font-medium",children:"Cancelled"}),(0,b.jsx)("p",{className:"text-muted-foreground text-[10px]",children:"Job cancelled"})]})]})]})]}),(0,b.jsx)(x.Separator,{}),(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsxs)("div",{className:"mb-3 flex items-center gap-2",children:[(0,b.jsx)(p.Repeat,{className:"text-muted-foreground size-3.5"}),(0,b.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide",children:"Special Indicators"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"bg-card/50 flex items-center gap-3 rounded-lg border px-3 py-2",children:[(0,b.jsx)(p.Repeat,{className:"text-primary size-4 shrink-0"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs font-medium",children:"Recurring Job"}),(0,b.jsx)("p",{className:"text-muted-foreground text-[10px]",children:"Repeats on a schedule"})]})]}),(0,b.jsxs)("div",{className:"bg-card/50 flex items-center gap-3 rounded-lg border px-3 py-2",children:[(0,b.jsxs)("div",{className:"flex -space-x-1",children:[(0,b.jsx)("div",{className:"bg-primary size-4 rounded-full border-2 border-background"}),(0,b.jsx)("div",{className:"bg-emerald-500 size-4 rounded-full border-2 border-background"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs font-medium",children:"Multi-Tech Job"}),(0,b.jsx)("p",{className:"text-muted-foreground text-[10px]",children:"Multiple technicians assigned"})]})]})]})]}),(0,b.jsx)(x.Separator,{}),(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsxs)("div",{className:"mb-3 flex items-center gap-2",children:[(0,b.jsx)(k.Keyboard,{className:"text-muted-foreground size-3.5"}),(0,b.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide",children:"Keyboard Shortcuts"})]}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1.5",children:ac.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:a.description}),(0,b.jsx)("div",{className:"flex gap-0.5",children:a.keys.map(a=>(0,b.jsx)("kbd",{className:"bg-muted text-muted-foreground rounded px-1.5 py-0.5 font-mono text-[10px]",children:a},a))})]},a.description))})]})]})]})]})]}):(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"bg-muted h-8 w-8 rounded-md"}),(0,b.jsx)("div",{className:"bg-muted h-8 w-20 rounded-md"}),(0,b.jsx)("div",{className:"bg-muted h-8 w-32 rounded-md"}),(0,b.jsx)("div",{className:"bg-muted h-8 w-10 rounded-md"})]})}a.s(["ScheduleToolbarActions",()=>ad],961367)},342461,a=>{"use strict";var b=a.i(861467),c=a.i(665791),d=a.i(912288),e=a.i(556232),f=a.i(773608),g=a.i(696922),h=a.i(238221),i=a.i(766153),j=a.i(624126),k=a.i(283753),l=a.i(783281);a.i(445255);var m=a.i(18170);a.i(708402);var n=a.i(442458);a.i(297229);var o=a.i(489904);a.i(146697);var p=a.i(778737),q=a.i(563491),r=a.i(700760);function s(){let a,[s,t]=(0,l.useState)(!1),[u,v]=(0,l.useState)(!1),{currentDate:w,setCurrentDate:x,viewMode:y}=(0,q.useScheduleViewStore)();(0,l.useEffect)(()=>{t(!0)},[]);let z=w instanceof Date?w:new Date(w),A=(a=new Date,"month"===y?[{label:"This Month",date:a},{label:"Next Month",date:(0,d.addMonths)(a,1)},{label:"In 2 Months",date:(0,d.addMonths)(a,2)}]:"week"===y?[{label:"This Week",date:(0,h.startOfWeek)(a)},{label:"Next Week",date:(0,e.addWeeks)(a,1)},{label:"In 2 Weeks",date:(0,e.addWeeks)(a,2)}]:[{label:"Today",date:a},{label:"Tomorrow",date:(0,c.addDays)(a,1)},{label:"Next Week",date:(0,e.addWeeks)(a,1)}]),B=(0,g.isToday)(z);return s?(0,b.jsxs)(o.Popover,{open:u,onOpenChange:v,children:[(0,b.jsx)(o.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)("button",{className:(0,r.cn)("group flex items-center gap-2 rounded-md px-2 py-1.5 transition-colors","hover:bg-accent/50"),type:"button",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-foreground text-xl font-semibold tracking-tight",children:(()=>{switch(y){case"month":return(0,f.format)(z,"MMMM yyyy");case"week":return(0,f.format)(z,"MMM dd, yyyy");default:return(0,f.format)(z,"EEEE, MMMM dd, yyyy")}})()}),B&&(0,b.jsx)("span",{className:"bg-primary/10 text-primary rounded-full px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide",children:"Today"})]}),(0,b.jsx)(i.ChevronDown,{className:(0,r.cn)("text-muted-foreground size-4 transition-transform",u&&"rotate-180")})]})}),(0,b.jsxs)(o.PopoverContent,{align:"start",className:"w-auto p-0",children:[(0,b.jsxs)("div",{className:"border-b p-3",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,b.jsx)(k.Sparkles,{className:"text-primary size-3.5"}),(0,b.jsx)("span",{className:"text-xs font-medium",children:"Quick Jump"})]}),(0,b.jsx)("div",{className:"flex gap-1.5",children:A.map(a=>(0,b.jsx)(m.Button,{size:"sm",variant:"outline",className:"h-7 text-xs",onClick:()=>{x(a.date),v(!1)},children:a.label},a.label))})]}),(0,b.jsx)(n.Calendar,{initialFocus:!0,mode:"single",onSelect:a=>{a&&(x(a),v(!1))},selected:z,className:"p-3",modifiers:{today:new Date},modifiersClassNames:{today:"bg-primary text-primary-foreground"}}),(0,b.jsx)(p.Separator,{}),(0,b.jsxs)("div",{className:"flex items-center justify-between px-3 py-2",children:[(0,b.jsxs)("div",{className:"text-muted-foreground flex items-center gap-1.5 text-xs",children:[(0,b.jsx)(j.Clock,{className:"size-3"}),(0,b.jsxs)("span",{children:["Current time: ",(0,f.format)(new Date,"h:mm a")]})]}),(0,b.jsx)(m.Button,{size:"sm",variant:"ghost",className:"h-6 text-xs",onClick:()=>{x(new Date),v(!1)},children:"Go to now"})]})]})]}):(0,b.jsx)("div",{className:"bg-muted h-8 w-[220px] rounded-md"})}a.s(["ScheduleToolbarTitle",()=>s])}];

//# sourceMappingURL=apps_web_src_components_schedule_40a2e3d3._.js.map