module.exports=[273568,e=>{"use strict";var t=e.i(471312),a=e.i(381259);async function r(){let e=process.env.SUPABASE_POOLER_URL||"https://togejqdwggezkxahomeh.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;return e&&t?(0,a.createClient)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1},db:{schema:"public"},global:{headers:{"x-my-custom-header":"service-role"}}}):null}(0,e.i(798348).ensureServerEntryExports)([r]),(0,t.registerServerReference)(r,"00a13dbd00149949fc1367d3e76ae7d789e07f5321",null),e.s(["createServiceSupabaseClient",()=>r])},177585,e=>{"use strict";var t=e.i(849614),a=e.i(511368);let r=(0,t.cache)(async()=>{try{let e=await (0,a.createClient)();if(!e)return null;let{data:{user:t},error:r}=await e.auth.getUser();if(r)return r.name,null;return t}catch(e){return e&&"object"==typeof e&&"name"in e&&e.name,null}});(0,t.cache)(async()=>{try{let e=await (0,a.createClient)();if(!e)return null;let{data:{session:t},error:r}=await e.auth.getSession();if(r)return null;return t}catch(e){return null}}),e.s(["getCurrentUser",0,r])},985647,e=>{"use strict";var t=e.i(511368),a=e.i(273568),r=e.i(849614),i=e.i(177585);let n="active_company_id",s=(0,r.cache)(async()=>{let t,{cookies:a}=await e.A(226115);try{t=await a()}catch(e){if(e instanceof Error&&(e.message.includes("During prerendering")||e.message.includes("prerendering")||e.message.includes("cookies()")))return null;throw e}let r=t.get(n)?.value;if(r&&await m(r))return r;let i=await u();return i[0]?.id||null}),c=(0,r.cache)(async()=>{let e=await s();if(!e)return null;let a=await (0,t.createClient)();if(!a)return null;let{data:r}=await a.from("companies").select("id, name, logo, phone, email").eq("id",e).is("deleted_at",null).single();return r});async function l(t){if(!await m(t))throw Error("You don't have access to this company");let{cookies:a}=await e.A(226115);(await a()).set(n,t,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:2592e3,path:"/"})}async function o(){let{cookies:t}=await e.A(226115);(await t()).delete(n)}let u=(0,r.cache)(async()=>{let e=await (0,i.getCurrentUser)();if(!e)return[];let t=await (0,a.createServiceSupabaseClient)();if(!t)return[];let{data:r}=await t.from("company_memberships").select(`
      company_id,
      companies!inner (
        id,
        name,
        logo,
        deleted_at,
        onboarding_completed_at
      )
    `).eq("user_id",e.id).eq("status","active").is("companies.deleted_at",null);return r?r.sort((e,t)=>{let a=!!e.companies.onboarding_completed_at,r=!!t.companies.onboarding_completed_at;return a&&!r?-1:!a&&r?1:e.companies.name.localeCompare(t.companies.name)}).map(e=>({id:e.companies.id,name:e.companies.name,logo:e.companies.logo})):[]}),m=(0,r.cache)(async e=>{let a=await (0,i.getCurrentUser)();if(!a)return!1;let r=await (0,t.createClient)();if(!r)return!1;let[n,s]=await Promise.all([r.from("companies").select("id").eq("id",e).is("deleted_at",null).single(),r.from("company_memberships").select("id").eq("user_id",a.id).eq("company_id",e).eq("status","active").single()]);return!!(n.data&&s.data)}),p=(0,r.cache)(async()=>{let e=await (0,i.getCurrentUser)();if(!e)return null;let a=await s();if(!a)return null;let r=await (0,t.createClient)();if(!r)return null;let{data:n}=await r.from("team_members").select("id").eq("user_id",e.id).eq("company_id",a).eq("status","active").single();return n?.id||null});async function d(){let e=await s();if(!e)throw Error("No active company selected. Please select a company.");return e}async function g(){let e=await (0,i.getCurrentUser)();if(!e)return!1;let t=await s();if(!t)return!1;let r=await (0,a.createServiceSupabaseClient)();if(!r)return!1;let{data:n}=await r.from("company_memberships").select("company_id, companies!inner(stripe_subscription_status, onboarding_progress, onboarding_completed_at)").eq("user_id",e.id).eq("company_id",t).eq("status","active").maybeSingle();if(!n)return!1;let c=Array.isArray(n.companies)?n.companies[0]:n.companies,l=c?.stripe_subscription_status,o=function(e){let{progress:t,completedAt:a}=e;if(a)return!0;if(!t||"object"!=typeof t)return!1;if(!0===t.onboardingCompleted)return!0;let r=t.completedSteps;return!!(Array.isArray(r)&&r.includes("complete"))}({progress:c?.onboarding_progress||null,completedAt:c?.onboarding_completed_at??null});return("active"===l||"trialing"===l)&&o||!1}e.s(["clearActiveCompany",()=>o,"getActiveCompany",0,c,"getActiveCompanyId",0,s,"getActiveTeamMemberId",0,p,"getUserCompanies",0,u,"isActiveCompanyOnboardingComplete",()=>g,"requireActiveCompany",()=>d,"setActiveCompany",()=>l],985647)},16106,e=>{"use strict";e.i(985647),e.s([])},907631,e=>{"use strict";e.i(16106);var t=e.i(985647);e.s(["clearActiveCompany",()=>t.clearActiveCompany,"getActiveCompany",()=>t.getActiveCompany,"getActiveCompanyId",()=>t.getActiveCompanyId,"getActiveTeamMemberId",()=>t.getActiveTeamMemberId,"getUserCompanies",()=>t.getUserCompanies,"isActiveCompanyOnboardingComplete",()=>t.isActiveCompanyOnboardingComplete,"requireActiveCompany",()=>t.requireActiveCompany,"setActiveCompany",()=>t.setActiveCompany])},226115,e=>{e.v(t=>Promise.all(["server/chunks/3c0ae_next_09aa2dd0._.js"].map(t=>e.l(t))).then(()=>t(766988)))}];

//# sourceMappingURL=_ced76d19._.js.map