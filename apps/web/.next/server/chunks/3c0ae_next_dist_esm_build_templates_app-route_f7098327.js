module.exports=[678144,e=>{"use strict";var t=e.i(755535),r=e.i(377233),a=e.i(490003),s=e.i(492991),i=e.i(241970),n=e.i(357699),o=e.i(212454),u=e.i(48717),l=e.i(798301),c=e.i(986366),d=e.i(983537),p=e.i(147475),h=e.i(561930),m=e.i(803747),g=e.i(368557),f=e.i(42037),y=e.i(193695);e.i(432036);var v=e.i(573881),w=e.i(297676),k=e.i(350318);e.i(16106);var R=e.i(985647);let S="https://api.weather.gov",E=new class{apiKey;constructor(){this.apiKey=process.env.PERILPULSE_API_KEY||""}async getRecentEarthquakes(e,t,r={}){let{radiusKm:a=250,days:s=30,minMagnitude:i=2.5}=r;try{let r=new Date().toISOString().split("T")[0],n=new Date(Date.now()-24*s*36e5).toISOString().split("T")[0],o=new URL("https://earthquake.usgs.gov/fdsnws/event/1/query");o.searchParams.set("format","geojson"),o.searchParams.set("latitude",e.toString()),o.searchParams.set("longitude",t.toString()),o.searchParams.set("maxradiuskm",a.toString()),o.searchParams.set("starttime",n),o.searchParams.set("endtime",r),o.searchParams.set("minmagnitude",i.toString()),o.searchParams.set("orderby","time");let u=await fetch(o.toString());if(!u.ok)throw Error(`USGS API error: ${u.status}`);let l=await u.json();if(!l.features||!Array.isArray(l.features))return[];return l.features.map(r=>{let a=r.properties,s=r.geometry.coordinates,i=this.calculateDistance(e,t,s[1],s[0]);return{id:r.id,type:"earthquake",date:new Date(a.time).toISOString(),magnitude:a.mag,description:a.place,distance:Math.round(i),impact:this.getEarthquakeImpact(a.mag)}})}catch(e){return console.error("Error fetching earthquake data:",e),[]}}async getWeatherAlerts(e,t){try{let r=await fetch(`${S}/points/${e},${t}`);if(!r.ok)return[];let a=await r.json(),s=a.properties?.forecastZone;if(!s)return[];let i=s.split("/").pop(),n=await fetch(`${S}/alerts/active/zone/${i}`);if(!n.ok)return[];let o=await n.json();if(!o.features)return[];return o.features.map(e=>{let t=e.properties;return{id:t.id,type:this.mapWeatherEventType(t.event),date:t.effective,description:`${t.event}: ${t.headline}`,distance:0,impact:t.severity}})}catch(e){return console.error("Error fetching weather alerts:",e),[]}}async getEnvironmentalRiskReport(e,t,r){let[a,s]=await Promise.all([this.getRecentEarthquakes(e,t,{radiusKm:500,days:365}),this.getWeatherAlerts(e,t)]),i=[],n=this.assessEarthquakeRisk(a,e,t);i.push(n);let o=this.assessLocationBasedHazards(e,t);i.push(...o);let u=this.assessWeatherHazards(s);i.push(...u);let l=this.calculateOverallRisk(i),c=this.scoreToRiskLevel(l),d=this.generateRecommendations(i);return{lat:e,lng:t,address:r,overallRiskScore:l,overallRiskLevel:c,hazards:i,climateZone:this.getClimateZone(e,t),seismicZone:this.getSeismicZone(e,t),windZone:this.getWindZone(e,t),recommendations:d}}assessEarthquakeRisk(e,t,r){let a,s=e.filter(e=>(e.magnitude||0)>=4),i=e.filter(e=>(e.magnitude||0)>=3&&4>(e.magnitude||0)),n=0,o=this.getSeismicZone(t,r);"high"===o?n+=40:"moderate"===o?n+=20:"low"===o&&(n+=5),n+=10*s.length,n+=3*i.length,n=Math.min(100,n),a=this.scoreToRiskLevel(n);let u=[];return n>=50&&(u.push("Secure water heaters and HVAC equipment to prevent gas leaks"),u.push("Install flexible gas connectors"),u.push("Ensure equipment has seismic bracing")),n>=30&&(u.push("Check for seismic strapping on water heater"),u.push("Consider earthquake shutoff valve for gas line")),{hazardType:"earthquake",riskLevel:a,riskScore:n,description:`Seismic zone: ${o}. ${s.length} significant earthquakes (M4.0+) in past year within 500km.`,historicalFrequency:s.length>0?"Active seismic area":"Low seismic activity",lastMajorEvent:e[0]?.date,mitigationRecommendations:u}}assessLocationBasedHazards(e,t){let r=[];if(t<-100&&e>32&&e<49){let e=t<-115?70:40;r.push({hazardType:"wildfire",riskLevel:this.scoreToRiskLevel(e),riskScore:e,description:"Western US wildfire zone",historicalFrequency:"Annual fire season (May-October)",mitigationRecommendations:["Ensure outdoor HVAC units have defensible space","Use fire-resistant materials for exposed ductwork","Install high-efficiency air filtration for smoke events","Check that attic vents have ember-resistant screens"]})}if(e>25&&e<35&&t>-98&&t<-75||e>35&&e<45&&t>-82&&t<-65){let a=e<30&&t>-90?80:50;r.push({hazardType:"hurricane",riskLevel:this.scoreToRiskLevel(a),riskScore:a,description:"Hurricane-prone coastal region",historicalFrequency:"June-November hurricane season",mitigationRecommendations:["Secure outdoor equipment with hurricane straps","Install surge protectors on HVAC systems","Consider elevated equipment platforms","Ensure condensate drains can handle heavy rain"]})}if(e>30&&e<45&&t>-105&&t<-85){let a=e>33&&e<40&&t>-100&&t<-90?70:40;r.push({hazardType:"tornado",riskLevel:this.scoreToRiskLevel(a),riskScore:a,description:"Tornado-prone region",historicalFrequency:"Peak season March-June",mitigationRecommendations:["Secure outdoor units with proper anchoring","Consider hail guards for condenser units","Install whole-house surge protection","Discuss storm shelter ventilation options"]})}if(e>30&&e<38&&t>-120&&t<-100&&r.push({hazardType:"extreme-heat",riskLevel:"high",riskScore:65,description:"Extreme heat region",historicalFrequency:"Summer temperatures regularly exceed 100Â°F",mitigationRecommendations:["Size AC systems for extreme heat conditions","Recommend high SEER efficiency units","Ensure proper shade/protection for outdoor units","Discuss whole-house fans for evening cooling"]}),e>40){let t=e>45?60:40;r.push({hazardType:"winter-storm",riskLevel:this.scoreToRiskLevel(t),riskScore:t,description:"Cold climate with winter storms",historicalFrequency:"November-March winter season",mitigationRecommendations:["Ensure proper heating system capacity","Recommend backup heat source","Insulate exposed pipes and equipment","Install freeze protection on heat pumps"]})}return r}assessWeatherHazards(e){let t=[];return e.forEach(e=>{"earthquake"!==e.type&&t.push({hazardType:e.type,riskLevel:"high",riskScore:80,description:e.description,mitigationRecommendations:["Active weather alert - postpone non-emergency outdoor work if unsafe"]})}),t}mapWeatherEventType(e){let t=e.toLowerCase();return t.includes("tornado")?"tornado":t.includes("hurricane")||t.includes("tropical")?"hurricane":t.includes("flood")?"flood":t.includes("fire")||t.includes("smoke")?"wildfire":t.includes("winter")||t.includes("snow")||t.includes("ice")||t.includes("blizzard")?"winter-storm":t.includes("heat")?"extreme-heat":t.includes("hail")?"hail":"tornado"}calculateOverallRisk(e){if(0===e.length)return 20;let t=0,r=0;return e.forEach(e=>{let a=e.riskScore>=50?2:1;t+=e.riskScore*a,r+=a}),Math.round(t/r)}scoreToRiskLevel(e){return e>=90?"extreme":e>=75?"severe":e>=55?"high":e>=35?"moderate":e>=15?"low":"minimal"}getEarthquakeImpact(e){return e>=7?"Major - Serious damage possible":e>=6?"Strong - Can cause damage to buildings":e>=5?"Moderate - Can cause minor damage":e>=4?"Light - Noticeable shaking, minimal damage":"Minor - Often not felt"}getSeismicZone(e,t){return e>32&&e<42&&t>-125&&t<-114||e>42&&e<49&&t>-125&&t<-116||e>51&&t<-130?"high":e>35&&e<45&&t>-115&&t<-105||e>35&&e<40&&t>-92&&t<-87?"moderate":t>-100?"low":"moderate"}getWindZone(e,t){return e<35&&t>-98&&t<-75||e>30&&e<45&&t>-105&&t<-85?"high":e>40&&e<49&&t>-110&&t<-95?"moderate":"low"}getClimateZone(e,t){return e>45?"Cold":e<30?"Hot-Humid":t<-100?"Mixed-Dry":t>-85?"Mixed-Humid":"Mixed"}generateRecommendations(e){let t=[];return e.filter(e=>e.riskScore>=50).forEach(e=>{e.mitigationRecommendations.length>0&&t.push(...e.mitigationRecommendations.slice(0,2))}),[...new Set(t)]}calculateDistance(e,t,r,a){let s=this.toRad(r-e),i=this.toRad(a-t),n=Math.sin(s/2)*Math.sin(s/2)+Math.cos(this.toRad(e))*Math.cos(this.toRad(r))*Math.sin(i/2)*Math.sin(i/2);return 2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n))*6371}toRad(e){return Math.PI/180*e}async getPropertyHazardAssessment(e,t,r){let a=await this.getEnvironmentalRiskReport(t,r,e),s=a.hazards.filter(e=>e.riskScore>=40).sort((e,t)=>t.riskScore-e.riskScore),i=[],n=[],o=[];return s.forEach(e=>{switch(e.hazardType){case"earthquake":i.push({equipment:"Seismic strapping for water heater",reason:"Prevents gas leaks and water damage during earthquakes",hazardType:"earthquake",priority:e.riskScore>=60?"required":"recommended"}),i.push({equipment:"Flexible gas connectors",reason:"Allows equipment movement without breaking gas lines",hazardType:"earthquake",priority:"recommended"}),e.riskScore>=70&&i.push({equipment:"Automatic gas shutoff valve",reason:"Cuts gas supply during significant seismic event",hazardType:"earthquake",priority:"recommended"}),n.push("Annual inspection of seismic straps and flexible connections");break;case"wildfire":i.push({equipment:"High-efficiency particulate air filter (MERV 13+)",reason:"Filters smoke particles during fire events",hazardType:"wildfire",priority:"recommended"}),i.push({equipment:"Fire-resistant conduit for outdoor wiring",reason:"Protects electrical connections from ember damage",hazardType:"wildfire",priority:"recommended"}),n.push("Clear vegetation 5+ feet around outdoor equipment"),n.push("Replace air filters immediately after smoke events"),o.push("Document defensible space around equipment for insurance");break;case"hurricane":i.push({equipment:"Hurricane straps/tie-downs for outdoor units",reason:"Prevents equipment from becoming projectile",hazardType:"hurricane",priority:"required"}),i.push({equipment:"Surge protection for HVAC",reason:"Protects equipment from power surge damage",hazardType:"hurricane",priority:"required"}),e.riskScore>=70&&i.push({equipment:"Elevated equipment platform",reason:"Protects from flood damage during storm surge",hazardType:"hurricane",priority:"recommended"}),n.push("Pre-hurricane inspection and securing protocol"),n.push("Post-hurricane system check for debris/damage"),o.push("Ensure wind/flood coverage adequate for replacement");break;case"tornado":i.push({equipment:"Hail guards for condenser",reason:"Protects fins from hail damage",hazardType:"tornado",priority:"recommended"}),i.push({equipment:"Whole-house surge protector",reason:"Protects all systems from lightning/power surges",hazardType:"tornado",priority:"recommended"}),n.push("Post-storm inspection for hail/debris damage"),n.push("Check refrigerant charge after severe storms");break;case"extreme-heat":i.push({equipment:"High-SEER AC unit (18+ SEER)",reason:"Maintains efficiency in extreme temperatures",hazardType:"extreme-heat",priority:"recommended"}),i.push({equipment:"Shade structure for condenser",reason:"Improves efficiency by reducing condenser temperature",hazardType:"extreme-heat",priority:"optional"}),n.push("Bi-annual coil cleaning for optimal heat transfer"),n.push("Check refrigerant charge before peak summer");break;case"winter-storm":i.push({equipment:"Heat pump with cold climate rating",reason:"Maintains efficiency in sub-freezing temperatures",hazardType:"winter-storm",priority:"recommended"}),i.push({equipment:"Pipe insulation and heat tape",reason:"Prevents freeze damage to condensate lines",hazardType:"winter-storm",priority:"required"}),n.push("Fall heating system tune-up before winter"),n.push("Clear snow/ice from outdoor equipment")}}),a.overallRiskScore>=50&&(o.push("Higher risk area - review equipment coverage limits"),o.push("Consider extended warranty for weather-related failures")),{address:e,overallRisk:a.overallRiskLevel,primaryConcerns:s,equipmentRecommendations:i,maintenanceConsiderations:[...new Set(n)],insuranceNotes:[...new Set(o)]}}async getSeasonalServicePlan(e,t){let r=await this.getEnvironmentalRiskReport(e,t),a=[],s=[],i=[];r.hazards.find(e=>"tornado"===e.hazardType)?.riskScore&&(s.push("tornado"),i.push("Peak tornado season - offer pre-storm system checks"),i.push("Verify surge protection before storm season")),r.hazards.find(e=>"flood"===e.hazardType)?.riskScore&&(s.push("flood"),i.push("Spring flooding risk - check sump pump systems")),i.push("Transition to cooling season - AC tune-ups"),a.push({season:"spring",primaryHazards:s,riskLevel:s.length>0?"moderate":"low",notes:i});let n=[],o=[];r.hazards.find(e=>"hurricane"===e.hazardType)?.riskScore&&(n.push("hurricane"),o.push("Hurricane season begins - verify tie-downs")),r.hazards.find(e=>"wildfire"===e.hazardType)?.riskScore&&(n.push("wildfire"),o.push("Wildfire season - check air filtration"),o.push("Clear vegetation around outdoor equipment")),r.hazards.find(e=>"extreme-heat"===e.hazardType)?.riskScore&&(n.push("extreme-heat"),o.push("Peak cooling demand - prioritize emergency AC repairs")),a.push({season:"summer",primaryHazards:n,riskLevel:n.length>=2?"high":1===n.length?"moderate":"low",notes:o});let u=[],l=[];r.hazards.find(e=>"hurricane"===e.hazardType)?.riskScore&&(u.push("hurricane"),l.push("Peak hurricane season continues through November")),r.hazards.find(e=>"wildfire"===e.hazardType)?.riskScore&&(u.push("wildfire"),l.push("Fall fire risk (dry conditions)")),l.push("Heating system tune-up season"),l.push("Winterization preparation for cold climates"),a.push({season:"fall",primaryHazards:u,riskLevel:u.length>0?"moderate":"low",notes:l});let c=[],d=[];return r.hazards.find(e=>"winter-storm"===e.hazardType)?.riskScore&&(c.push("winter-storm"),d.push("Winter storm risk - emergency heating repairs priority"),d.push("Freeze protection checks")),d.push("Peak heating demand season"),a.push({season:"winter",primaryHazards:c,riskLevel:c.length>0?"high":"moderate",notes:d}),a}async checkDispatchSafety(e,t){let r=await this.getWeatherAlerts(e,t),a=r.filter(e=>"Severe"===e.impact||"Extreme"===e.impact||"tornado"===e.type||"hurricane"===e.type);return a.length>0?{safe:!1,activeHazards:a,recommendation:`DELAY DISPATCH: ${a.map(e=>e.description).join("; ")}`}:r.length>0?{safe:!0,activeHazards:r,recommendation:`CAUTION: Active weather alerts. Monitor conditions: ${r.map(e=>e.type).join(", ")}`}:{safe:!0,activeHazards:[],recommendation:"No active weather hazards. Normal dispatch procedures."}}};var q=e.i(511368);async function T(e){try{let t=e.nextUrl.searchParams,r=t.get("lat"),a=t.get("lng"),s=t.get("address"),i=t.get("action")||"report";if(!(r&&a))return w.NextResponse.json({error:"lat and lng required"},{status:400});let n=await (0,q.createClient)();if(!n)return w.NextResponse.json({error:"Database connection failed"},{status:500});let{data:{user:o}}=await n.auth.getUser();if(!o)return w.NextResponse.json({error:"Unauthorized"},{status:401});let u=await (0,R.getActiveCompanyId)();if(!u)return w.NextResponse.json({error:"No active company selected"},{status:401});if(["report","property-assessment","seasonal-plan"].includes(i)){let e=await (0,k.checkApiQuota)(u,"perilpulse");if(e&&!e.has_quota)return w.NextResponse.json({error:"API quota exceeded",currentUsage:e.current_usage,limit:e.monthly_limit},{status:429})}let l=parseFloat(r),c=parseFloat(a),d={earthquakes:"earthquakes","weather-alerts":"weather_alerts",report:"environmental_report","property-assessment":"property_assessment","seasonal-plan":"seasonal_plan","dispatch-safety":"dispatch_safety"}[i];if(!d)return w.NextResponse.json({error:"Invalid action"},{status:400});let p=["earthquakes","weather-alerts","dispatch-safety"].includes(i)?0:void 0,h=await (0,k.withUsageTracking)(u,"perilpulse",d,async()=>{switch(i){case"earthquakes":{let e=t.get("radiusKm"),r=t.get("days"),a=t.get("minMagnitude");return await E.getRecentEarthquakes(l,c,{radiusKm:e?parseInt(e):void 0,days:r?parseInt(r):void 0,minMagnitude:a?parseFloat(a):void 0})}case"weather-alerts":return await E.getWeatherAlerts(l,c);case"report":return await E.getEnvironmentalRiskReport(l,c,s||void 0);case"property-assessment":if(!s)throw Error("address required");return await E.getPropertyHazardAssessment(s,l,c);case"seasonal-plan":return await E.getSeasonalServicePlan(l,c);case"dispatch-safety":return await E.checkDispatchSafety(l,c);default:throw Error(`Unknown action: ${i}`)}},{costCents:p});if(!h)return w.NextResponse.json({error:"No data found"},{status:404});return w.NextResponse.json(h,{headers:{"Cache-Control":"public, s-maxage=1800, stale-while-revalidate=3600"}})}catch(e){if(console.error("PerilPulse API error:",e),e instanceof Error&&e.message.includes("required"))return w.NextResponse.json({error:e.message},{status:400});return w.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["GET",()=>T],611885);var C=e.i(611885);let x=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/risk/environmental/route",pathname:"/api/risk/environmental",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/risk/environmental/route.ts",nextConfigOutput:"",userland:C}),{workAsyncStorage:z,workUnitAsyncStorage:P,serverHooks:A}=x;function b(){return(0,a.patchFetch)({workAsyncStorage:z,workUnitAsyncStorage:P})}async function H(e,t,a){x.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/risk/environmental/route";w=w.replace(/\/index$/,"")||"/";let k=await x.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!k)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:R,params:S,nextConfig:E,parsedUrl:q,isDraftMode:T,prerenderManifest:C,routerServerContext:z,isOnDemandRevalidate:P,revalidateOnlyGenerated:A,resolvedPathname:b,clientReferenceManifest:H,serverActionsManifest:M}=k,N=(0,u.normalizeAppPath)(w),I=!!(C.dynamicRoutes[N]||C.routes[b]),L=async()=>((null==z?void 0:z.render404)?await z.render404(e,t,q,!1):t.end("This page could not be found"),null);if(I&&!T){let e=!!C.routes[b],t=C.dynamicRoutes[N];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await L();throw new y.NoFallbackError}}let _=null;!I||x.isDev||T||(_="/index"===(_=b)?"/":_);let O=!0===x.isDev||!I,D=I&&!O;M&&H&&(0,n.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:H,serverActionsManifest:M,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:M})});let U=e.method||"GET",j=(0,i.getTracer)(),F=j.getActiveScopeSpan(),$={params:S,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:O,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>x.onRequestError(e,t,a,z)},sharedContext:{buildId:R}},W=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),Z=c.NextRequestAdapter.fromNodeNextRequest(W,(0,c.signalFromNodeResponse)(t));try{let n=async e=>x.handle(Z,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${U} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${w}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),u=async s=>{var i,u;let l=async({previousCacheEntry:r})=>{try{if(!o&&P&&A&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await n(s);e.fetchMetrics=$.renderOpts.fetchMetrics;let u=$.renderOpts.pendingWaitUntil;u&&a.waitUntil&&(a.waitUntil(u),u=void 0);let l=$.renderOpts.collectedTags;if(!I)return await (0,h.sendResponse)(W,K,i,$.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(i.headers);l&&(t[f.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,a=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await x.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:P})},z),t}},c=await x.handleResponse({req:e,nextConfig:E,cacheKey:_,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:A,responseGenerator:l,waitUntil:a.waitUntil,isMinimalMode:o});if(!I)return null;if((null==c||null==(i=c.value)?void 0:i.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(u=c.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",P?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),T&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,m.fromNodeOutgoingHttpHeaders)(c.value.headers);return o&&I||d.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,g.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)(W,K,new Response(c.value.body,{headers:d,status:c.value.status||200})),null};F?await u(F):await j.withPropagatedContext(e.headers,()=>j.trace(d.BaseServerSpan.handleRequest,{spanName:`${U} ${w}`,kind:i.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},u))}catch(t){if(t instanceof y.NoFallbackError||await x.onRequestError(e,t,{routerKind:"App Router",routePath:N,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:P})}),I)throw t;return await (0,h.sendResponse)(W,K,new Response(null,{status:500})),null}}e.s(["handler",()=>H,"patchFetch",()=>b,"routeModule",()=>x,"serverHooks",()=>A,"workAsyncStorage",()=>z,"workUnitAsyncStorage",()=>P],678144)}];

//# sourceMappingURL=3c0ae_next_dist_esm_build_templates_app-route_f7098327.js.map