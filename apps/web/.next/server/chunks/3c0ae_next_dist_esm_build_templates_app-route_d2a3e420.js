module.exports=[545870,e=>{"use strict";var t=e.i(755535),a=e.i(377233),r=e.i(490003),n=e.i(492991),o=e.i(241970),i=e.i(357699),s=e.i(212454),l=e.i(48717),c=e.i(798301),u=e.i(986366),d=e.i(983537),p=e.i(147475),h=e.i(561930),g=e.i(803747),f=e.i(368557),m=e.i(42037),w=e.i(193695);e.i(432036);var b=e.i(573881);e.i(715051);var v=e.i(511368),y=e.i(297676),C=e.i(443608);let R=C.z.object({word:C.z.string(),startTime:C.z.string(),endTime:C.z.string(),confidence:C.z.number().optional(),speakerTag:C.z.number().optional()}),T=C.z.object({transcript:C.z.string(),confidence:C.z.number(),words:C.z.array(R).optional()}),S=C.z.object({alternatives:C.z.array(T),channelTag:C.z.number().optional(),languageCode:C.z.string().optional()}),E=C.z.object({results:C.z.array(S).optional().default([]),totalBilledTime:C.z.string().optional()});class A{static instance;apiKey;baseUrl="https://speech.googleapis.com/v1";cache=new Map;CACHE_TTL=36e5;constructor(){this.apiKey=process.env.GOOGLE_API_KEY||"AIzaSyCVKN0pddG230vvjT0EMP9sSIR31j1q2t0",this.apiKey||console.warn("GoogleSpeechToTextService: No API key found. Set GOOGLE_API_KEY environment variable.")}static getInstance(){return A.instance||(A.instance=new A),A.instance}isConfigured(){return!!this.apiKey}hashAudio(e){let t=0;for(let a=0;a<Math.min(e.length,1e3);a++)t=(t<<5)-t+e.charCodeAt(a),t&=t;return t.toString(36)+"_"+e.length}cleanCache(){let e=Date.now();for(let[t,a]of this.cache.entries())e-a.timestamp>this.CACHE_TTL&&this.cache.delete(t)}async transcribeAudio(e,t={}){if(!this.apiKey)throw Error("Speech-to-Text API key not configured");let a=this.hashAudio(e)+JSON.stringify(t);this.cleanCache();let r=this.cache.get(a);if(r)return r.result;let n={languageCode:"en-US",enableAutomaticPunctuation:!0,enableWordTimeOffsets:!1,profanityFilter:!1,model:"default",...t},o=await fetch(`${this.baseUrl}/speech:recognize?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:n,audio:{content:e}})});if(!o.ok){let e=await o.json();throw Error(`Speech-to-Text API error: ${e.error?.message||o.statusText}`)}let i=await o.json(),s=E.parse(i),l=this.simplifyTranscription(s);return this.cache.set(a,{result:l,timestamp:Date.now()}),l}async transcribeFromUri(e,t={}){if(!this.apiKey)throw Error("Speech-to-Text API key not configured");let a={languageCode:"en-US",enableAutomaticPunctuation:!0,enableWordTimeOffsets:!1,profanityFilter:!1,model:"default",...t},r=await fetch(`${this.baseUrl}/speech:recognize?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:a,audio:{uri:e}})});if(!r.ok){let e=await r.json();throw Error(`Speech-to-Text API error: ${e.error?.message||r.statusText}`)}let n=await r.json(),o=E.parse(n);return this.simplifyTranscription(o)}async startLongRunningTranscription(e,t={}){if(!this.apiKey)throw Error("Speech-to-Text API key not configured");let a={languageCode:"en-US",enableAutomaticPunctuation:!0,enableWordTimeOffsets:!0,profanityFilter:!1,model:"latest_long",diarizationConfig:{enableSpeakerDiarization:!0,minSpeakerCount:1,maxSpeakerCount:6},...t},r=await fetch(`${this.baseUrl}/speech:longrunningrecognize?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:a,audio:{uri:e}})});if(!r.ok){let e=await r.json();throw Error(`Speech-to-Text API error: ${e.error?.message||r.statusText}`)}return(await r.json()).name}async checkOperationStatus(e){if(!this.apiKey)throw Error("Speech-to-Text API key not configured");let t=await fetch(`https://speech.googleapis.com/v1/operations/${e}?key=${this.apiKey}`);if(!t.ok){let e=await t.json();throw Error(`Operation status check error: ${e.error?.message||t.statusText}`)}let a=await t.json();if(a.error)return{done:!0,error:a.error.message};if(a.done){let e=E.parse(a.response);return{done:!0,result:this.simplifyTranscription(e)}}return{done:!1,progress:a.metadata?.progressPercent||0}}async transcribeVoiceNote(e,t="en-US"){return this.transcribeAudio(e,{languageCode:t,enableAutomaticPunctuation:!0,model:"latest_short",useEnhanced:!0})}async transcribePhoneCall(e,t={}){let{languageCode:a="en-US",enableSpeakerDiarization:r=!0,maxSpeakers:n=2}=t;return this.transcribeAudio(e,{languageCode:a,enableAutomaticPunctuation:!0,enableWordTimeOffsets:!0,model:"phone_call",useEnhanced:!0,encoding:"MULAW",sampleRateHertz:8e3,diarizationConfig:r?{enableSpeakerDiarization:!0,minSpeakerCount:2,maxSpeakerCount:n}:void 0})}async transcribeFieldServiceNote(e,t="general"){let a={hvac:["HVAC","compressor","condenser","evaporator","refrigerant","R-410A","R-22","thermostat","ductwork","BTU","tonnage","SEER","MERV","air handler","blower motor","capacitor","contactor","heat pump","furnace","coil"],plumbing:["PVC","copper pipe","water heater","sump pump","garbage disposal","faucet","toilet","drain","sewer line","water pressure","shut-off valve","P-trap","backflow","tankless","gallon per minute","GPM"],electrical:["circuit breaker","outlet","GFCI","AFCI","wire gauge","amperage","voltage","panel","conduit","junction box","ground fault","meter base","disconnect","240 volt","120 volt"],general:["estimate","invoice","work order","customer","property","scheduled","completed","parts","labor","warranty","follow-up","callback"]},r=[...a[t]||[],...a.general];return this.transcribeAudio(e,{languageCode:"en-US",enableAutomaticPunctuation:!0,model:"latest_short",useEnhanced:!0,speechContexts:[{phrases:r,boost:10}]})}simplifyTranscription(e){let t;if(!e.results||0===e.results.length)return{text:"",confidence:0};let a=[],r=[],n=0,o=0;for(let t of e.results)if(t.alternatives&&t.alternatives.length>0){let e=t.alternatives[0];a.push(e.transcript),n+=e.confidence,o++,e.words&&r.push(...e.words)}let i=[];if(r.some(e=>void 0!==e.speakerTag)){let e=new Map;for(let t of r){let a=t.speakerTag||0;e.has(a)||e.set(a,[]),e.get(a).push(t.word)}for(let[t,a]of e.entries())i.push({speakerId:t,text:a.join(" ")})}if(r.length>0){let e=r[r.length-1];e.endTime&&(t=parseFloat(e.endTime.replace("s","")))}return{text:a.join(" "),confidence:o>0?n/o:0,words:r.length>0?r:void 0,speakers:i.length>0?i:void 0,duration:t}}clearCache(){this.cache.clear()}}let x=A.getInstance(),k=C.z.object({audioContent:C.z.string().min(1,"Audio content is required"),type:C.z.enum(["voice_note","phone_call","field_service","general"]).default("general"),languageCode:C.z.enum(["en-US","en-GB","es-ES","es-MX","fr-FR","de-DE","it-IT","pt-BR","zh-CN","ja-JP","ko-KR"]).default("en-US").transform(e=>e),serviceType:C.z.enum(["hvac","plumbing","electrical","general"]).optional(),enableSpeakerDiarization:C.z.boolean().optional(),maxSpeakers:C.z.number().min(2).max(6).optional()});async function P(e){try{let t,a=await (0,v.createClient)(),{data:{user:r}}=await a.auth.getUser();if(!r)return y.NextResponse.json({error:"Unauthorized"},{status:401});if(!x.isConfigured())return y.NextResponse.json({error:"Speech-to-Text service is not configured. Set GOOGLE_API_KEY environment variable."},{status:503});let n=await e.json(),o=k.parse(n);switch(o.type){case"voice_note":t=await x.transcribeVoiceNote(o.audioContent,o.languageCode);break;case"phone_call":t=await x.transcribePhoneCall(o.audioContent,{languageCode:o.languageCode,enableSpeakerDiarization:o.enableSpeakerDiarization??!0,maxSpeakers:o.maxSpeakers??2});break;case"field_service":t=await x.transcribeFieldServiceNote(o.audioContent,o.serviceType??"general");break;default:t=await x.transcribeAudio(o.audioContent,{languageCode:o.languageCode,enableAutomaticPunctuation:!0})}return y.NextResponse.json({success:!0,data:{text:t.text,confidence:t.confidence,words:t.words,speakers:t.speakers,duration:t.duration}})}catch(e){if(console.error("Speech transcription error:",e),e instanceof C.z.ZodError)return y.NextResponse.json({error:"Invalid request data",details:e.errors},{status:400});return y.NextResponse.json({error:"Failed to transcribe audio",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}e.s(["POST",()=>P],159965);var O=e.i(159965);let z=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/speech/transcribe/route",pathname:"/api/speech/transcribe",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/speech/transcribe/route.ts",nextConfigOutput:"",userland:O}),{workAsyncStorage:N,workUnitAsyncStorage:_,serverHooks:j}=z;function I(){return(0,r.patchFetch)({workAsyncStorage:N,workUnitAsyncStorage:_})}async function U(e,t,r){z.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/speech/transcribe/route";v=v.replace(/\/index$/,"")||"/";let y=await z.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:C,params:R,nextConfig:T,parsedUrl:S,isDraftMode:E,prerenderManifest:A,routerServerContext:x,isOnDemandRevalidate:k,revalidateOnlyGenerated:P,resolvedPathname:O,clientReferenceManifest:N,serverActionsManifest:_}=y,j=(0,l.normalizeAppPath)(v),I=!!(A.dynamicRoutes[j]||A.routes[O]),U=async()=>((null==x?void 0:x.render404)?await x.render404(e,t,S,!1):t.end("This page could not be found"),null);if(I&&!E){let e=!!A.routes[O],t=A.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await U();throw new w.NoFallbackError}}let K=null;!I||z.isDev||E||(K="/index"===(K=O)?"/":K);let M=!0===z.isDev||!I,D=I&&!M;_&&N&&(0,i.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:N,serverActionsManifest:_,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:_})});let H=e.method||"GET",$=(0,o.getTracer)(),F=$.getActiveScopeSpan(),q={params:R,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>z.onRequestError(e,t,r,x)},sharedContext:{buildId:C}},G=new c.NodeNextRequest(e),L=new c.NodeNextResponse(t),B=u.NextRequestAdapter.fromNodeNextRequest(G,(0,u.signalFromNodeResponse)(t));try{let i=async e=>z.handle(B,q).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=$.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${H} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${v}`)}),s=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var o,l;let c=async({previousCacheEntry:a})=>{try{if(!s&&k&&P&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(n);e.fetchMetrics=q.renderOpts.fetchMetrics;let l=q.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let c=q.renderOpts.collectedTags;if(!I)return await (0,h.sendResponse)(G,L,o,q.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(o.headers);c&&(t[m.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==q.renderOpts.collectedRevalidate&&!(q.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&q.renderOpts.collectedRevalidate,r=void 0===q.renderOpts.collectedExpire||q.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:q.renderOpts.collectedExpire;return{value:{kind:b.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await z.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:k})},x),t}},u=await z.handleResponse({req:e,nextConfig:T,cacheKey:K,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:k,revalidateOnlyGenerated:P,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:s});if(!I)return null;if((null==u||null==(o=u.value)?void 0:o.kind)!==b.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",k?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,g.fromNodeOutgoingHttpHeaders)(u.value.headers);return s&&I||d.delete(m.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,h.sendResponse)(G,L,new Response(u.value.body,{headers:d,status:u.value.status||200})),null};F?await l(F):await $.withPropagatedContext(e.headers,()=>$.trace(d.BaseServerSpan.handleRequest,{spanName:`${H} ${v}`,kind:o.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof w.NoFallbackError||await z.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:k})}),I)throw t;return await (0,h.sendResponse)(G,L,new Response(null,{status:500})),null}}e.s(["handler",()=>U,"patchFetch",()=>I,"routeModule",()=>z,"serverHooks",()=>j,"workAsyncStorage",()=>N,"workUnitAsyncStorage",()=>_],545870)}];

//# sourceMappingURL=3c0ae_next_dist_esm_build_templates_app-route_d2a3e420.js.map