module.exports=[479404,(e,a,t)=>{"use strict";a.exports=e.r(664598).vendored["react-rsc"].ReactServerDOMTurbopackServer},471312,(e,a,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"registerServerReference",{enumerable:!0,get:function(){return s.registerServerReference}});let s=e.r(479404)},798348,(e,a,t)=>{"use strict";function s(e){for(let a=0;a<e.length;a++){let t=e[a];if("function"!=typeof t)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof t}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ensureServerEntryExports",{enumerable:!0,get:function(){return s}})},273568,e=>{"use strict";var a=e.i(471312),t=e.i(381259);async function s(){let e=process.env.SUPABASE_POOLER_URL||"https://togejqdwggezkxahomeh.supabase.co",a=process.env.SUPABASE_SERVICE_ROLE_KEY;return e&&a?(0,t.createClient)(e,a,{auth:{persistSession:!1,autoRefreshToken:!1},db:{schema:"public"},global:{headers:{"x-my-custom-header":"service-role"}}}):null}(0,e.i(798348).ensureServerEntryExports)([s]),(0,a.registerServerReference)(s,"00a13dbd00149949fc1367d3e76ae7d789e07f5321",null),e.s(["createServiceSupabaseClient",()=>s])},614952,e=>{"use strict";var a=e.i(786348),t=e.i(628123);async function s(e,s,r){let n=process.env.TELNYX_API_KEY;if(!n)return{success:!1,error:"TELNYX_API_KEY is not configured"};let i=r?.operation||e,o=r?.timeout??15e3,l=async()=>{let t=new AbortController,r=setTimeout(()=>t.abort(),o);try{a.telnyxLogger.debug("Call API request",{endpoint:e,operation:i});let o=await fetch(`https://api.telnyx.com/v2${e}`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(s),signal:t.signal});clearTimeout(r);let l=await o.json();if(!o.ok){let t=l?.errors?.[0]?.detail||l?.errors?.[0]||o.statusText;a.telnyxLogger.warn("Call API error response",{endpoint:e,operation:i,status:o.status,error:t});let s=Error(`Telnyx ${o.status}: ${t}`);throw s.statusCode=o.status,s}return a.telnyxLogger.debug("Call API success",{endpoint:e,operation:i}),{success:!0,data:l.data}}catch(t){if(clearTimeout(r),t instanceof Error&&"AbortError"===t.name)throw a.telnyxLogger.error("Call API timeout",{endpoint:e,operation:i,timeoutMs:o}),Error(`Request timeout after ${o}ms`);throw t}};try{if(r?.skipRetry)return await l();return await (0,t.withRetry)(l,{endpoint:`calls:${i}`,config:{maxRetries:2,baseDelayMs:500,maxDelayMs:2e3},onRetry:(t,s,r)=>{a.telnyxLogger.warn("Retrying call API request",{endpoint:e,operation:i,attempt:t,error:s.message,delayMs:r})}})}catch(t){return a.telnyxLogger.error("Call API request failed",{endpoint:e,operation:i,error:t instanceof Error?t.message:"Unknown error"}),{success:!1,error:t instanceof Error?t.message:"Request failed"}}}async function r(e){let a=await s("/calls",{to:e.to,from:e.from,connection_id:e.connectionId,webhook_url:e.webhookUrl,answering_machine_detection:e.answeringMachineDetection||"disabled",custom_headers:e.customHeaders},{operation:"initiate"});return a.success&&a.data?{success:!0,callControlId:a.data.call_control_id,callSessionId:a.data.call_session_id,data:a.data}:{success:!1,error:a.error||"Failed to initiate call"}}async function n(e){return s(`/calls/${e.callControlId}/actions/answer`,{webhook_url:e.webhookUrl,client_state:e.clientState},{operation:"answer",skipRetry:!0})}async function i(e){return s(`/calls/${e.callControlId}/actions/reject`,{cause:e.cause||"CALL_REJECTED"},{operation:"reject",skipRetry:!0})}async function o(e){return s(`/calls/${e.callControlId}/actions/hangup`,{},{operation:"hangup"})}async function l(e){return s(`/calls/${e.callControlId}/actions/record_start`,{format:e.format||"mp3",channels:e.channels||"single"},{operation:"record_start"})}async function c(e){return s(`/calls/${e.callControlId}/actions/record_stop`,{},{operation:"record_stop"})}async function d(e){return s(`/calls/${e.callControlId}/actions/playback_start`,{audio_url:e.audioUrl,loop:e.loop},{operation:"playback_start"})}async function u(e){return s(`/calls/${e.callControlId}/actions/speak`,{payload:e.text,voice:e.voice||"female",language:e.language||"en-US"},{operation:"speak"})}async function _(e){return s(`/calls/${e.callControlId}/actions/transfer`,{to:e.to,from:e.from},{operation:"transfer"})}async function m(e){return s(`/calls/${e.callControlId}/actions/send_dtmf`,{digits:e.digits},{operation:"send_dtmf"})}async function p(e){let a=!!e.audioUrl;return s(a?`/calls/${e.callControlId}/actions/gather_using_audio`:`/calls/${e.callControlId}/actions/gather_using_speak`,a?{audio_url:e.audioUrl,valid_digits:e.validDigits,max:e.maxDigits,min:e.minDigits,timeout_millis:e.timeout,terminating_digit:e.terminatingDigit||"#"}:{payload:e.speakText||"",valid_digits:e.validDigits,max:e.maxDigits,min:e.minDigits,timeout_millis:e.timeout,terminating_digit:e.terminatingDigit||"#"},{operation:a?"gather_audio":"gather_speak"})}e.s(["answerCall",()=>n,"gatherInput",()=>p,"hangupCall",()=>o,"initiateCall",()=>r,"playAudio",()=>d,"rejectCall",()=>i,"sendDTMF",()=>m,"speakText",()=>u,"startRecording",()=>l,"stopRecording",()=>c,"transferCall",()=>_])},291546,e=>{"use strict";var a=e.i(471312),t=e.i(717899),s=e.i(511368),r=e.i(893099),n=e.i(798348);let i=process.env.TELNYX_DEFAULT_MESSAGING_PROFILE_ID||process.env.NEXT_PUBLIC_TELNYX_MESSAGING_PROFILE_ID||"",o=/\s+/;function l(e){if(!e)return null;let a=e.replace(/\D/g,"");return a?11===a.length&&a.startsWith("1")?`+${a}`:10===a.length?`+1${a}`:e.startsWith("+")?e:`+${a}`:null}async function c(e,a){let{data:t}=await e.from("messaging_brands").select("id").eq("company_id",a.company_id).maybeSingle();t?await e.from("messaging_brands").update({...a,updated_at:new Date().toISOString()}).eq("id",t.id):await e.from("messaging_brands").insert(a)}async function d(e,a){let{data:t}=await e.from("messaging_campaigns").select("id").eq("messaging_brand_id",a.messaging_brand_id).eq("usecase",a.usecase).maybeSingle();if(t)return await e.from("messaging_campaigns").update({...a,updated_at:new Date().toISOString()}).eq("id",t.id),t.id;let{data:s}=await e.from("messaging_campaigns").insert(a).select("id").single();return s?.id??null}async function u(e,a){let n=a?.supabase??await (0,s.createClient)();if(!n)return{success:!1,error:"Supabase unavailable"};let{data:i,error:d}=await n.from("companies").select("id, name, legal_name, doing_business_as, phone, support_email, support_phone, website, website_url, brand_color, industry, address, city, state, zip_code, owner_id, ein, tax_id").eq("id",e).single();if(d||!i)return{success:!1,error:d?.message||"Company not found"};let{data:u}=await n.from("profiles").select("full_name, email, phone").eq("id",i.owner_id).maybeSingle(),_=function(e){if(!e)return{first:"Support",last:"Team"};let a=e.trim().split(o);return 1===a.length?{first:a[0],last:"Team"}:{first:a[0],last:a.slice(1).join(" ")}}(u?.full_name),m=u?.email||i.support_email||"support@example.com",p=l(u?.phone)||l(i.support_phone)||l(i.phone)||"+18314280176",{data:g}=await n.from("messaging_brands").select("*").eq("company_id",e).maybeSingle();if(g?.telnyx_brand_id){let e=await (0,r.getTenDlcBrand)(g.telnyx_brand_id);e.success&&e.data&&await n.from("messaging_brands").update({status:e.data.status,updated_at:new Date().toISOString()}).eq("id",g.id)}if(!g?.telnyx_brand_id){let a={customer_reference:e,brand_name:i.legal_name||i.name,ein:i.ein||i.tax_id||process.env.FALLBACK_TEST_EIN||"00-0000000",ein_issuing_country:"US",vertical:function(e){if(!e)return"PROFESSIONAL";let a=e.toLowerCase();return a.includes("plumb")||a.includes("hvac")||a.includes("electric")?"HOME_SERVICES":(a.includes("clean"),"PROFESSIONAL")}(i.industry),website:i.website||i.website_url||null,company_type:"PRIVATE_PROFIT",address:{line1:i.address||"115 Flintlock Lane",city:i.city||"Ben Lomond",state:i.state||"CA",postal_code:i.zip_code||"95005",country:"US"},contact:{first_name:_.first,last_name:_.last,email:m,phone:p},optional_attributes:{doing_business_as:i.doing_business_as||i.name}},t=await (0,r.createTenDlcBrand)(a);if(!(t.success&&t.data))return{success:!1,error:t.error||"Failed to create 10DLC brand"};await c(n,{company_id:e,telnyx_brand_id:t.data.id,status:"submitted",legal_name:a.brand_name,doing_business_as:i.doing_business_as||i.name,ein:a.ein,vertical:a.vertical,website:a.website,support_email:m,support_phone:p,address_line1:a.address.line1,city:a.address.city,state:a.address.state,postal_code:a.address.postal_code,brand_color:i.brand_color})}return(0,t.revalidatePath)("/dashboard/settings/communications/brand"),{success:!0}}async function _(e,a,n){let o=n?.supabase??await (0,s.createClient)();if(!o)return{success:!1,error:"Supabase unavailable"};let{data:l}=await o.from("messaging_brands").select("*").eq("company_id",e).maybeSingle();if(!l?.telnyx_brand_id){let t=await u(e,{supabase:o});return t.success?_(e,a):t}let c="CUSTOMER_CARE",{data:m}=await o.from("messaging_campaigns").select("*").eq("messaging_brand_id",l.id).eq("usecase",c).maybeSingle();if(m?.telnyx_campaign_id){let e=await (0,r.getTenDlcCampaign)(m.telnyx_campaign_id);e.success&&e.data&&await o.from("messaging_campaigns").update({status:e.data.status,updated_at:new Date().toISOString()}).eq("id",m.id)}let p=m?.id??null,g=m?.telnyx_campaign_id??null;if(!m?.telnyx_campaign_id){if(!i)return{success:!1,error:"TELNYX_DEFAULT_MESSAGING_PROFILE_ID not configured"};let a=`${l.doing_business_as||l.legal_name} provides appointment updates, reminders, and service notifications to existing customers.`,t=`Hi {{customer_name}}, this is ${l.doing_business_as||l.legal_name} confirming your upcoming appointment. Reply HELP for assistance or STOP to opt out.`,s={brand_id:l.telnyx_brand_id,campaign_alias:`${e}-customer-care`,usecase:c,description:a,sample_messages:[t],message_flow:"Customers opt in during onboarding or by texting our business line. They receive service updates and can opt out by replying STOP.",terms_and_conditions:"Msg & data rates may apply. Reply STOP to opt out, HELP for help.",help_message:`Thanks for contacting ${l.doing_business_as||l.legal_name}. Reply STOP to unsubscribe.`,help_phone_number:l.support_phone||"+18314280176",help_email:l.support_email||"support@example.com",auto_renewal:!0,message_fee_credits:0,opt_in_keywords:["START","YES"],opt_out_keywords:["STOP","UNSUBSCRIBE"],opt_in_message:"Thanks for opting in to receive messages from us. Reply STOP to opt out.",opt_out_message:"You have successfully been unsubscribed and will no longer receive messages. Reply START to opt in again."},n=await (0,r.createTenDlcCampaign)(s);if(!(n.success&&n.data))return{success:!1,error:n.error||"Failed to create 10DLC campaign"};p=await d(o,{messaging_brand_id:l.id,telnyx_campaign_id:n.data.id,status:"submitted",usecase:c,description:a,sample_messages:s.sample_messages,messaging_profile_id:i})||m?.id||null,g=n.data.id}if(!(p&&g))return{success:!1,error:"Campaign not ready"};let{data:f}=await o.from("messaging_campaign_phone_numbers").select("*").eq("messaging_campaign_id",p).eq("phone_number_id",a.id).maybeSingle();if(!f?.telnyx_relationship_id){let e=await (0,r.attachNumberToCampaign)(g,a.e164);if(!(e.success&&e.data))return{success:!1,error:e.error||"Failed to link number to campaign"};f?await o.from("messaging_campaign_phone_numbers").update({telnyx_relationship_id:e.data.id,status:"submitted"}).eq("id",f.id):await o.from("messaging_campaign_phone_numbers").insert({messaging_campaign_id:p,phone_number_id:a.id,telnyx_relationship_id:e.data.id,status:"submitted"})}return await o.from("phone_numbers").update({telnyx_messaging_profile_id:i,metadata:{ten_dlc_campaign_id:g}}).eq("id",a.id),(0,t.revalidatePath)("/dashboard/settings/communications/phone-numbers"),{success:!0}}(0,n.ensureServerEntryExports)([u,_]),(0,a.registerServerReference)(u,"606753f8910b46d5792f4bdeb457cdf29d1a8bbadc",null),(0,a.registerServerReference)(_,"70a648f43fa62ae3dcf2070eb90413e96e81591e77",null),e.s(["ensureMessagingBranding",()=>u,"ensureMessagingCampaign",()=>_])},989318,e=>{e.v(a=>Promise.all(["server/chunks/apps_web_src_lib_telnyx_messaging-profile-fetcher_ts_3db46723._.js"].map(a=>e.l(a))).then(()=>a(394972)))},764856,e=>{e.v(e=>Promise.resolve().then(()=>e(614952)))},229637,e=>{e.v(a=>Promise.all(["server/chunks/apps_web_src_lib_assemblyai_client_ts_2b8329fc._.js"].map(a=>e.l(a))).then(()=>a(268901)))},175702,e=>{e.v(a=>Promise.all(["server/chunks/_0a9984ef._.js"].map(a=>e.l(a))).then(()=>a(907631)))},925531,e=>{e.v(a=>Promise.all(["server/chunks/[root-of-the-server]__ca80feab._.js","server/chunks/apps_web_src_lib_email_88ddc82e._.js","server/chunks/apps_web_src_lib_email_d758aae7._.js","server/chunks/node_modules__pnpm_1a9e968f._.js","server/chunks/_81ba2cec._.js","server/chunks/node_modules__pnpm_c28f4879._.js","server/chunks/_68658d0d._.js","server/chunks/apps_web_7b2fec1c._.js","server/chunks/apps_web_src_lib_email_gmail-client_ts_e648327c._.js","server/chunks/37e87_zod_v4_de06a7a1._.js"].map(a=>e.l(a))).then(()=>a(8583)))},633428,e=>{e.v(a=>Promise.all(["server/chunks/[root-of-the-server]__d1ab72d3._.js"].map(a=>e.l(a))).then(()=>a(333085)))}];

//# sourceMappingURL=_877c2ad6._.js.map