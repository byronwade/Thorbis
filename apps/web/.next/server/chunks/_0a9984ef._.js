module.exports=[177585,e=>{"use strict";var t=e.i(511368),a=e.i(849614);let i=(0,a.cache)(async()=>{try{let e=await (0,t.createClient)();if(!e)return null;let{data:{user:a},error:i}=await e.auth.getUser();if(i)return i.name,null;return a}catch(e){return e&&"object"==typeof e&&"name"in e&&e.name,null}});(0,a.cache)(async()=>{try{let e=await (0,t.createClient)();if(!e)return null;let{data:{session:a},error:i}=await e.auth.getSession();if(i)return null;return a}catch(e){return null}}),e.s(["getCurrentUser",0,i])},985647,e=>{"use strict";var t=e.i(511368),a=e.i(273568),i=e.i(849614),r=e.i(177585);let n="active_company_id",c=(0,i.cache)(async()=>{let t,{cookies:a}=await e.A(226115);try{t=await a()}catch(e){if(e instanceof Error&&(e.message.includes("During prerendering")||e.message.includes("prerendering")||e.message.includes("cookies()")))return null;throw e}let i=t.get(n)?.value;if(i&&await u(i))return i;let r=await m();return r[0]?.id||null}),s=(0,i.cache)(async()=>{let e=await c();if(!e)return null;let a=await (0,t.createClient)();if(!a)return null;let{data:i}=await a.from("companies").select("id, name, logo, phone, email").eq("id",e).is("deleted_at",null).single();return i});async function o(t){if(!await u(t))throw Error("You don't have access to this company");let{cookies:a}=await e.A(226115);(await a()).set(n,t,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:2592e3,path:"/"})}async function l(){let{cookies:t}=await e.A(226115);(await t()).delete(n)}let m=(0,i.cache)(async()=>{let e=await (0,r.getCurrentUser)();if(!e)return[];let t=await (0,a.createServiceSupabaseClient)();if(!t)return[];let{data:i}=await t.from("company_memberships").select(`
      company_id,
      companies!inner (
        id,
        name,
        logo,
        deleted_at,
        onboarding_completed_at
      )
    `).eq("user_id",e.id).eq("status","active").is("companies.deleted_at",null);return i?i.sort((e,t)=>{let a=!!e.companies.onboarding_completed_at,i=!!t.companies.onboarding_completed_at;return a&&!i?-1:!a&&i?1:e.companies.name.localeCompare(t.companies.name)}).map(e=>({id:e.companies.id,name:e.companies.name,logo:e.companies.logo})):[]}),u=(0,i.cache)(async e=>{let a=await (0,r.getCurrentUser)();if(!a)return!1;let i=await (0,t.createClient)();if(!i)return!1;let[n,c]=await Promise.all([i.from("companies").select("id").eq("id",e).is("deleted_at",null).single(),i.from("company_memberships").select("id").eq("user_id",a.id).eq("company_id",e).eq("status","active").single()]);return!!(n.data&&c.data)}),p=(0,i.cache)(async()=>{let e=await (0,r.getCurrentUser)();if(!e)return null;let a=await c();if(!a)return null;let i=await (0,t.createClient)();if(!i)return null;let{data:n}=await i.from("team_members").select("id").eq("user_id",e.id).eq("company_id",a).eq("status","active").single();return n?.id||null});async function d(){let e=await c();if(!e)throw Error("No active company selected. Please select a company.");return e}async function y(){let e=await (0,r.getCurrentUser)();if(!e)return!1;let t=await c();if(!t)return!1;let i=await (0,a.createServiceSupabaseClient)();if(!i)return!1;let{data:n}=await i.from("company_memberships").select("company_id, companies!inner(stripe_subscription_status, onboarding_progress, onboarding_completed_at)").eq("user_id",e.id).eq("company_id",t).eq("status","active").maybeSingle();if(!n)return!1;let s=Array.isArray(n.companies)?n.companies[0]:n.companies,o=s?.stripe_subscription_status,l=function(e){let{progress:t,completedAt:a}=e;if(a)return!0;if(!t||"object"!=typeof t)return!1;if(!0===t.onboardingCompleted)return!0;let i=t.completedSteps;return!!(Array.isArray(i)&&i.includes("complete"))}({progress:s?.onboarding_progress||null,completedAt:s?.onboarding_completed_at??null});return("active"===o||"trialing"===o)&&l||!1}e.s(["clearActiveCompany",()=>l,"getActiveCompany",0,s,"getActiveCompanyId",0,c,"getActiveTeamMemberId",0,p,"getUserCompanies",0,m,"isActiveCompanyOnboardingComplete",()=>y,"requireActiveCompany",()=>d,"setActiveCompany",()=>o],985647)},16106,e=>{"use strict";e.i(985647),e.s([])},907631,e=>{"use strict";e.i(16106);var t=e.i(985647);e.s(["clearActiveCompany",()=>t.clearActiveCompany,"getActiveCompany",()=>t.getActiveCompany,"getActiveCompanyId",()=>t.getActiveCompanyId,"getActiveTeamMemberId",()=>t.getActiveTeamMemberId,"getUserCompanies",()=>t.getUserCompanies,"isActiveCompanyOnboardingComplete",()=>t.isActiveCompanyOnboardingComplete,"requireActiveCompany",()=>t.requireActiveCompany,"setActiveCompany",()=>t.setActiveCompany])},226115,e=>{e.v(e=>Promise.resolve().then(()=>e(766988)))}];

//# sourceMappingURL=_0a9984ef._.js.map