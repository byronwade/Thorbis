module.exports=[614952,e=>{"use strict";var t=e.i(786348),r=e.i(628123);async function o(e,o,i){let s=process.env.TELNYX_API_KEY;if(!s)return{success:!1,error:"TELNYX_API_KEY is not configured"};let a=i?.operation||e,n=i?.timeout??15e3,l=async()=>{let r=new AbortController,i=setTimeout(()=>r.abort(),n);try{t.telnyxLogger.debug("Call API request",{endpoint:e,operation:a});let n=await fetch(`https://api.telnyx.com/v2${e}`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(o),signal:r.signal});clearTimeout(i);let l=await n.json();if(!n.ok){let r=l?.errors?.[0]?.detail||l?.errors?.[0]||n.statusText;t.telnyxLogger.warn("Call API error response",{endpoint:e,operation:a,status:n.status,error:r});let o=Error(`Telnyx ${n.status}: ${r}`);throw o.statusCode=n.status,o}return t.telnyxLogger.debug("Call API success",{endpoint:e,operation:a}),{success:!0,data:l.data}}catch(r){if(clearTimeout(i),r instanceof Error&&"AbortError"===r.name)throw t.telnyxLogger.error("Call API timeout",{endpoint:e,operation:a,timeoutMs:n}),Error(`Request timeout after ${n}ms`);throw r}};try{if(i?.skipRetry)return await l();return await (0,r.withRetry)(l,{endpoint:`calls:${a}`,config:{maxRetries:2,baseDelayMs:500,maxDelayMs:2e3},onRetry:(r,o,i)=>{t.telnyxLogger.warn("Retrying call API request",{endpoint:e,operation:a,attempt:r,error:o.message,delayMs:i})}})}catch(r){return t.telnyxLogger.error("Call API request failed",{endpoint:e,operation:a,error:r instanceof Error?r.message:"Unknown error"}),{success:!1,error:r instanceof Error?r.message:"Request failed"}}}async function i(e){let t=await o("/calls",{to:e.to,from:e.from,connection_id:e.connectionId,webhook_url:e.webhookUrl,answering_machine_detection:e.answeringMachineDetection||"disabled",custom_headers:e.customHeaders},{operation:"initiate"});return t.success&&t.data?{success:!0,callControlId:t.data.call_control_id,callSessionId:t.data.call_session_id,data:t.data}:{success:!1,error:t.error||"Failed to initiate call"}}async function s(e){return o(`/calls/${e.callControlId}/actions/answer`,{webhook_url:e.webhookUrl,client_state:e.clientState},{operation:"answer",skipRetry:!0})}async function a(e){return o(`/calls/${e.callControlId}/actions/reject`,{cause:e.cause||"CALL_REJECTED"},{operation:"reject",skipRetry:!0})}async function n(e){return o(`/calls/${e.callControlId}/actions/hangup`,{},{operation:"hangup"})}async function l(e){return o(`/calls/${e.callControlId}/actions/record_start`,{format:e.format||"mp3",channels:e.channels||"single"},{operation:"record_start"})}async function c(e){return o(`/calls/${e.callControlId}/actions/record_stop`,{},{operation:"record_stop"})}async function u(e){return o(`/calls/${e.callControlId}/actions/playback_start`,{audio_url:e.audioUrl,loop:e.loop},{operation:"playback_start"})}async function _(e){return o(`/calls/${e.callControlId}/actions/speak`,{payload:e.text,voice:e.voice||"female",language:e.language||"en-US"},{operation:"speak"})}async function d(e){return o(`/calls/${e.callControlId}/actions/transfer`,{to:e.to,from:e.from},{operation:"transfer"})}async function p(e){return o(`/calls/${e.callControlId}/actions/send_dtmf`,{digits:e.digits},{operation:"send_dtmf"})}async function f(e){let t=!!e.audioUrl;return o(t?`/calls/${e.callControlId}/actions/gather_using_audio`:`/calls/${e.callControlId}/actions/gather_using_speak`,t?{audio_url:e.audioUrl,valid_digits:e.validDigits,max:e.maxDigits,min:e.minDigits,timeout_millis:e.timeout,terminating_digit:e.terminatingDigit||"#"}:{payload:e.speakText||"",valid_digits:e.validDigits,max:e.maxDigits,min:e.minDigits,timeout_millis:e.timeout,terminating_digit:e.terminatingDigit||"#"},{operation:t?"gather_audio":"gather_speak"})}e.s(["answerCall",()=>s,"gatherInput",()=>f,"hangupCall",()=>n,"initiateCall",()=>i,"playAudio",()=>u,"rejectCall",()=>a,"sendDTMF",()=>p,"speakText",()=>_,"startRecording",()=>l,"stopRecording",()=>c,"transferCall",()=>d])},244284,e=>{"use strict";var t=e.i(895811);function r(e){let t=e.toLowerCase();return t.includes("localhost")||t.includes("127.0.0.1")||t.includes("0.0.0.0")||t.endsWith(".local")||t.includes("://local")}function o(){let e=[],o=[],i={apiKey:!1,connectionId:!1,messagingProfileId:!1,webhookSecret:!1,publicKey:!1,siteUrl:!1};t.TELNYX_CONFIG.apiKey&&""!==t.TELNYX_CONFIG.apiKey.trim()?t.TELNYX_CONFIG.apiKey.length<20?e.push("TELNYX_API_KEY appears to be invalid (too short). Get your API key from https://portal.telnyx.com"):i.apiKey=!0:e.push("TELNYX_API_KEY is not set. This is required for all Telnyx operations."),t.TELNYX_CONFIG.connectionId&&""!==t.TELNYX_CONFIG.connectionId.trim()?i.connectionId=!0:e.push("NEXT_PUBLIC_TELNYX_CONNECTION_ID is not set. This is required for phone calls. Get it from Telnyx Portal → Mission Control → Connections."),t.TELNYX_CONFIG.messagingProfileId&&""!==t.TELNYX_CONFIG.messagingProfileId.trim()?i.messagingProfileId=!0:e.push("TELNYX_DEFAULT_MESSAGING_PROFILE_ID or NEXT_PUBLIC_TELNYX_MESSAGING_PROFILE_ID is not set. This is required for SMS/MMS. Run getDefaultMessagingProfile() to fetch it automatically from Telnyx."),t.TELNYX_CONFIG.webhookSecret&&""!==t.TELNYX_CONFIG.webhookSecret.trim()?i.webhookSecret=!0:o.push("TELNYX_WEBHOOK_SECRET is not set. Webhook signature verification will be disabled. Set this in production for security."),t.TELNYX_CONFIG.publicKey&&""!==t.TELNYX_CONFIG.publicKey.trim()?i.publicKey=!0:o.push("TELNYX_PUBLIC_KEY is not set. Webhook signature verification may not work correctly. Get it from Telnyx Portal → API Keys.");let s=function(){for(let e of["http://localhost:3000",process.env.SITE_URL,"http://localhost:3000",process.env.APP_URL])if(e&&e.trim()){let t=e.trim();if(!r(t))return t.startsWith("http")?t:`https://${t}`}let e=process.env.VERCEL_URL;if(e&&!r(e))return e.startsWith("http")?e:`https://${e}`}();return s?r(s)?"production"===process.env.VERCEL_ENV||"production"===process.env.DEPLOYMENT_ENV?e.push(`Site URL is set to localhost (${s}) but you're in production. Set NEXT_PUBLIC_SITE_URL to your production domain.`):o.push(`Site URL is set to localhost (${s}). This will not work in production.`):i.siteUrl=!0:e.push("NEXT_PUBLIC_SITE_URL or SITE_URL is not set to a valid production URL. This is required for webhook callbacks. Set it to your production domain (e.g., https://thorbis.co)."),{valid:0===e.length,errors:e,warnings:o,config:i}}async function i(){let t=o();if(!t.config.apiKey)return{valid:!1,error:"TELNYX_API_KEY is required for SMS operations"};if(!t.config.messagingProfileId){try{let{getDefaultMessagingProfile:t}=await e.A(989318),r=await t();if(r.success&&r.profile)return{valid:!1,error:"TELNYX_DEFAULT_MESSAGING_PROFILE_ID is required for SMS operations.",suggestedProfileId:r.profile.id}}catch{}return{valid:!1,error:"TELNYX_DEFAULT_MESSAGING_PROFILE_ID is required for SMS operations. Run getDefaultMessagingProfile() to fetch it automatically from Telnyx."}}return t.config.siteUrl?{valid:!0}:{valid:!1,error:"NEXT_PUBLIC_SITE_URL must be set to a valid production URL for SMS webhooks."}}function s(){let e=o();return e.config.apiKey?e.config.connectionId?e.config.siteUrl?{valid:!0}:{valid:!1,error:"NEXT_PUBLIC_SITE_URL must be set to a valid production URL for call webhooks."}:{valid:!1,error:"NEXT_PUBLIC_TELNYX_CONNECTION_ID is required for phone calls. Get it from Telnyx Portal → Mission Control → Connections."}:{valid:!1,error:"TELNYX_API_KEY is required for phone calls"}}e.s(["validateCallConfig",()=>s,"validateSmsConfig",()=>i,"validateTelnyxConfig",()=>o])},226115,e=>{e.v(e=>Promise.resolve().then(()=>e(766988)))},989318,e=>{e.v(t=>Promise.all(["server/chunks/apps_web_src_lib_telnyx_messaging-profile-fetcher_ts_3db46723._.js"].map(t=>e.l(t))).then(()=>t(394972)))},764856,e=>{e.v(e=>Promise.resolve().then(()=>e(614952)))},229637,e=>{e.v(t=>Promise.all(["server/chunks/apps_web_src_lib_assemblyai_client_ts_2b8329fc._.js"].map(t=>e.l(t))).then(()=>t(268901)))},175702,e=>{e.v(t=>Promise.all(["server/chunks/_0a9984ef._.js"].map(t=>e.l(t))).then(()=>t(907631)))},925531,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__48abd311._.js","server/chunks/apps_web_src_lib_email_88ddc82e._.js","server/chunks/apps_web_src_lib_email_d758aae7._.js","server/chunks/node_modules__pnpm_1a9e968f._.js","server/chunks/_81ba2cec._.js","server/chunks/node_modules__pnpm_c28f4879._.js","server/chunks/_68658d0d._.js","server/chunks/apps_web_7b2fec1c._.js","server/chunks/apps_web_src_lib_email_gmail-client_ts_e648327c._.js","server/chunks/37e87_zod_v4_de06a7a1._.js"].map(t=>e.l(t))).then(()=>t(8583)))},633428,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__d1ab72d3._.js"].map(t=>e.l(t))).then(()=>t(333085)))}];

//# sourceMappingURL=_b2702387._.js.map