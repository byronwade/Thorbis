module.exports=[839719,e=>{"use strict";var t=e.i(755535),r=e.i(377233),a=e.i(490003),i=e.i(492991),n=e.i(241970),o=e.i(357699),s=e.i(212454),l=e.i(48717),c=e.i(798301),u=e.i(986366),h=e.i(983537),d=e.i(147475),p=e.i(561930),m=e.i(803747),g=e.i(368557),v=e.i(42037),y=e.i(193695);e.i(432036);var f=e.i(573881),R=e.i(297676),w=e.i(350318);e.i(16106);var C=e.i(985647);let b={alabama:"AL",alaska:"AK",arizona:"AZ",arkansas:"AR",california:"CA",colorado:"CO",connecticut:"CT",delaware:"DE",florida:"FL",georgia:"GA",hawaii:"HI",idaho:"ID",illinois:"IL",indiana:"IN",iowa:"IA",kansas:"KS",kentucky:"KY",louisiana:"LA",maine:"ME",maryland:"MD",massachusetts:"MA",michigan:"MI",minnesota:"MN",mississippi:"MS",missouri:"MO",montana:"MT",nebraska:"NE",nevada:"NV","new hampshire":"NH","new jersey":"NJ","new mexico":"NM","new york":"NY","north carolina":"NC","north dakota":"ND",ohio:"OH",oklahoma:"OK",oregon:"OR",pennsylvania:"PA","rhode island":"RI","south carolina":"SC","south dakota":"SD",tennessee:"TN",texas:"TX",utah:"UT",vermont:"VT",virginia:"VA",washington:"WA","west virginia":"WV",wisconsin:"WI",wyoming:"WY","district of columbia":"DC"},S=new class{baseUrl="https://api.usa.gov/crime/fbi/cde";async getStateCrimeStats(e,t){let r=t||new Date().getFullYear()-1;try{let t=await fetch(`${this.baseUrl}/estimate/state/${e}?year=${r}`);if(!t.ok)throw Error(`FBI API error: ${t.status}`);let a=await t.json();if(!a.results||0===a.results.length)return null;let i=a.results[0],n=i.population||1;return{year:i.year,population:n,violentCrime:i.violent_crime||0,violentCrimeRate:(i.violent_crime||0)/n*1e5,homicide:i.homicide||0,homicideRate:(i.homicide||0)/n*1e5,rape:i.rape_revised||i.rape_legacy||0,rapeRate:(i.rape_revised||i.rape_legacy||0)/n*1e5,robbery:i.robbery||0,robberyRate:(i.robbery||0)/n*1e5,aggravatedAssault:i.aggravated_assault||0,aggravatedAssaultRate:(i.aggravated_assault||0)/n*1e5,propertyCrime:i.property_crime||0,propertyCrimeRate:(i.property_crime||0)/n*1e5,burglary:i.burglary||0,burglaryRate:(i.burglary||0)/n*1e5,larceny:i.larceny||0,larcenyRate:(i.larceny||0)/n*1e5,motorVehicleTheft:i.motor_vehicle_theft||0,motorVehicleTheftRate:(i.motor_vehicle_theft||0)/n*1e5,arson:i.arson}}catch(e){return console.error("Error fetching state crime stats:",e),null}}async getNationalCrimeStats(e){let t=e||new Date().getFullYear()-1;try{let e=await fetch(`${this.baseUrl}/estimate/national?year=${t}`);if(!e.ok)throw Error(`FBI API error: ${e.status}`);let r=await e.json();if(!r.results||0===r.results.length)return null;let a=r.results[0],i=a.population||1;return{year:a.year,population:i,violentCrime:a.violent_crime||0,violentCrimeRate:(a.violent_crime||0)/i*1e5,homicide:a.homicide||0,homicideRate:(a.homicide||0)/i*1e5,rape:a.rape_revised||a.rape_legacy||0,rapeRate:(a.rape_revised||a.rape_legacy||0)/i*1e5,robbery:a.robbery||0,robberyRate:(a.robbery||0)/i*1e5,aggravatedAssault:a.aggravated_assault||0,aggravatedAssaultRate:(a.aggravated_assault||0)/i*1e5,propertyCrime:a.property_crime||0,propertyCrimeRate:(a.property_crime||0)/i*1e5,burglary:a.burglary||0,burglaryRate:(a.burglary||0)/i*1e5,larceny:a.larceny||0,larcenyRate:(a.larceny||0)/i*1e5,motorVehicleTheft:a.motor_vehicle_theft||0,motorVehicleTheftRate:(a.motor_vehicle_theft||0)/i*1e5,arson:a.arson}}catch(e){return console.error("Error fetching national crime stats:",e),null}}async getCrimeTrends(e,t="violent-crime",r=5){let a=new Date().getFullYear()-1,i=a-r+1;try{let r,n=await fetch(`${this.baseUrl}/trend/state/${e}/${t}?from=${i}&to=${a}`);if(!n.ok)throw Error(`FBI API error: ${n.status}`);let o=await n.json();if(!o.results||0===o.results.length)return null;let s=o.results.map(e=>({year:e.year,count:e.value||0,rate:e.rate||0})),l=s[0],c=s[s.length-1],u=l.count>0?(c.count-l.count)/l.count*100:0;return r=u>5?"increasing":u<-5?"decreasing":"stable",{startYear:i,endYear:a,category:t,percentChange:Math.round(10*u)/10,direction:r,yearlyData:s}}catch(e){return console.error("Error fetching crime trends:",e),null}}async getAgenciesInState(e){try{let t=await fetch(`${this.baseUrl}/agency/byStateAbbr/${e}`);if(!t.ok)throw Error(`FBI API error: ${t.status}`);let r=await t.json();if(!r.results)return[];return r.results.map(e=>({ori:e.ori,agencyName:e.agency_name,agencyType:e.agency_type_name,state:e.state_abbr,stateName:e.state_name,city:e.city_name,county:e.county_name,population:e.population,nibrsParticipation:"Y"===e.nibrs_participation}))}catch(e){return console.error("Error fetching agencies:",e),[]}}calculateSafetyScore(e,t){let r=t.violentCrimeRate||380,a=t.propertyCrimeRate||2100,i=e.violentCrimeRate/r,n=Math.max(0,Math.min(100,Math.round(100-(40*i+20*(e.propertyCrimeRate/a))))),o=Math.round((i-1)*100),s=o>0?`${o}% higher violent crime than national average`:o<0?`${Math.abs(o)}% lower violent crime than national average`:"At national average for violent crime",l=[],c=e.violentCrimeRate<200?"low":e.violentCrimeRate<400?"moderate":e.violentCrimeRate<700?"high":"very-high",u=e.propertyCrimeRate<1500?"low":e.propertyCrimeRate<2500?"moderate":e.propertyCrimeRate<4e3?"high":"very-high";return("high"===c||"very-high"===c)&&(l.push("Schedule appointments during daylight hours when possible"),l.push("Consider technician safety training and protocols"),l.push("Use GPS tracking for service vehicles")),("high"===u||"very-high"===u)&&(l.push("Secure tools and equipment in locked vehicle compartments"),l.push("Consider increased insurance coverage"),l.push("Avoid leaving vehicle unattended with visible equipment"),l.push("Document equipment with photos before/after service calls")),e.burglaryRate>500&&l.push("High burglary area - recommend security system upsells to customers"),e.motorVehicleTheftRate>300&&l.push("High vehicle theft area - use steering wheel locks on service vehicles"),{score:n,grade:n>=80?"A":n>=65?"B":n>=50?"C":n>=35?"D":"F",violentCrimeRisk:c,propertyCrimeRisk:u,comparison:{vsNational:s,vsState:""},recommendations:l}}getStateAbbreviation(e){return b[e.toLowerCase().trim()]||(2===e.length?e.toUpperCase():null)}async getServiceAreaSafetyReport(e){let t=this.getStateAbbreviation(e);if(!t)return console.error("Could not determine state from:",e),null;let[r,a,i,n,o]=await Promise.all([this.getStateCrimeStats(t),this.getNationalCrimeStats(),this.getCrimeTrends(t,"violent-crime",5),this.getCrimeTrends(t,"property-crime",5),this.getCrimeTrends(t,"burglary",5)]);if(!r||!a)return null;let s=this.calculateSafetyScore(r,a),l=[i,n,o].filter(e=>null!==e),c=this.generateFieldServiceImplications(r,s,l);return{location:e,stateAbbr:t,safetyScore:s,recentStats:r,trends:l,fieldServiceImplications:c}}generateFieldServiceImplications(e,t,r){let a=[];"high"===t.violentCrimeRisk||"very-high"===t.violentCrimeRisk?a.push({category:"scheduling",risk:"high",recommendation:"Prefer daytime appointments (7AM-5PM). Avoid scheduling after dark in high-risk areas."}):"moderate"===t.violentCrimeRisk?a.push({category:"scheduling",risk:"medium",recommendation:"Evening appointments acceptable but notify dispatch of completion."}):a.push({category:"scheduling",risk:"low",recommendation:"Standard scheduling practices acceptable for this area."}),"high"===t.propertyCrimeRisk||"very-high"===t.propertyCrimeRisk?a.push({category:"equipment",risk:"high",recommendation:"High theft risk - use locked tool boxes, avoid visible equipment, never leave vehicle unlocked."}):e.motorVehicleTheftRate>300&&a.push({category:"equipment",risk:"medium",recommendation:"Elevated vehicle theft risk - consider GPS tracking and steering wheel locks."}),"low"!==t.violentCrimeRisk&&a.push({category:"safety",risk:"very-high"===t.violentCrimeRisk?"high":"medium",recommendation:"Implement buddy system for first visits. Share customer info with dispatch before arrival."});let i=r.find(e=>"burglary"===e.category);return(e.burglaryRate>600||i&&"increasing"===i.direction)&&a.push({category:"insurance",risk:"high",recommendation:"Review tool and equipment insurance coverage. Consider higher deductible theft policy."}),a}async isEveningServiceSafe(e){let t=await this.getStateCrimeStats(e);return t?t.violentCrimeRate<350?{safe:!0,recommendation:"Area is relatively safe for evening service calls. Standard precautions apply.",violentCrimeRate:Math.round(t.violentCrimeRate)}:t.violentCrimeRate<500?{safe:!0,recommendation:"Exercise caution for evening calls. Notify dispatch of arrival and departure.",violentCrimeRate:Math.round(t.violentCrimeRate)}:{safe:!1,recommendation:"Avoid evening appointments when possible. If necessary, use two-person teams.",violentCrimeRate:Math.round(t.violentCrimeRate)}:{safe:!1,recommendation:"Unable to determine crime data. Use caution for evening appointments.",violentCrimeRate:0}}async getEquipmentTheftRisk(e){let t,r=await this.getStateCrimeStats(e);if(!r)return{riskLevel:"medium",larcenyRate:0,vehicleTheftRate:0,burglaryRate:0,recommendations:["Unable to determine theft risk. Use standard security measures."]};let a=(r.larcenyRate>2500?3:r.larcenyRate>1500?2:+(r.larcenyRate>800))+(r.motorVehicleTheftRate>400?3:r.motorVehicleTheftRate>250?2:+(r.motorVehicleTheftRate>150))+(r.burglaryRate>600?3:r.burglaryRate>400?2:+(r.burglaryRate>200)),i=[];return a<=2?(t="low",i.push("Standard vehicle security is sufficient"),i.push("Lock vehicle and keep tools out of sight")):a<=4?(t="medium",i.push("Use locked tool boxes and cargo areas"),i.push("Avoid leaving vehicle unattended for extended periods"),i.push("Park in visible, well-lit areas")):a<=6?(t="high",i.push("Install vehicle alarm system and GPS tracker"),i.push("Use cable locks for large tools"),i.push("Consider insurance coverage for tools"),i.push("Take high-value tools inside when possible")):(t="very-high",i.push("Use enclosed, secured cargo area with alarm"),i.push("GPS tracking essential for recovery"),i.push("Consider hiring security for high-value jobs"),i.push("Document all tools with serial numbers and photos"),i.push("Review insurance policy for adequate coverage")),{riskLevel:t,larcenyRate:Math.round(r.larcenyRate),vehicleTheftRate:Math.round(r.motorVehicleTheftRate),burglaryRate:Math.round(r.burglaryRate),recommendations:i}}async compareServiceAreas(e){let t=await this.getNationalCrimeStats();return t?(await Promise.all(e.map(async e=>{let r,a=await this.getStateCrimeStats(e);if(!a)return null;let i=this.calculateSafetyScore(a,t);return r=i.score>=70?"Low risk area - standard operations":i.score>=50?"Moderate risk - implement safety protocols":"High risk - enhanced security measures required",{state:e,safetyScore:i.score,violentCrimeRate:Math.round(a.violentCrimeRate),propertyCrimeRate:Math.round(a.propertyCrimeRate),recommendation:r}}))).filter(e=>null!==e).sort((e,t)=>t.safetyScore-e.safetyScore):[]}};var k=e.i(511368);async function E(e){try{let t=e.nextUrl.searchParams,r=t.get("state"),a=t.get("year"),i=t.get("action")||"state-stats",n=await (0,k.createClient)();if(!n)return R.NextResponse.json({error:"Database connection failed"},{status:500});let{data:{user:o}}=await n.auth.getUser();if(!o)return R.NextResponse.json({error:"Unauthorized"},{status:401});let s=await (0,C.getActiveCompanyId)();if(!s)return R.NextResponse.json({error:"No active company selected"},{status:401});let l={"state-stats":"state_stats","national-stats":"national_stats",trends:"crime_trends",agencies:"agencies","safety-report":"safety_report","evening-safety":"evening_safety","equipment-theft-risk":"equipment_theft_risk","compare-areas":"compare_areas"}[i];if(!l)return R.NextResponse.json({error:"Invalid action"},{status:400});let c=await (0,w.withUsageTracking)(s,"fbi_crime",l,async()=>{switch(i){case"state-stats":if(!r)throw Error("state required");return await S.getStateCrimeStats(r,a?parseInt(a):void 0);case"national-stats":return await S.getNationalCrimeStats(a?parseInt(a):void 0);case"trends":{if(!r)throw Error("state required");let e=t.get("category")||"violent-crime",a=t.get("years");return await S.getCrimeTrends(r,e,a?parseInt(a):void 0)}case"agencies":if(!r)throw Error("state required");return await S.getAgenciesInState(r);case"safety-report":{let e=t.get("location");if(!e)throw Error("location required");return await S.getServiceAreaSafetyReport(e)}case"evening-safety":if(!r)throw Error("state required");return await S.isEveningServiceSafe(r);case"equipment-theft-risk":if(!r)throw Error("state required");return await S.getEquipmentTheftRisk(r);case"compare-areas":{let e=t.get("states");if(!e)throw Error("states required (comma-separated)");return await S.compareServiceAreas(e.split(","))}default:throw Error(`Unknown action: ${i}`)}},{costCents:0});if(!c)return R.NextResponse.json({error:"No data found"},{status:404});return R.NextResponse.json(c,{headers:{"Cache-Control":"public, s-maxage=86400, stale-while-revalidate=172800"}})}catch(e){if(console.error("FBI Crime API error:",e),e instanceof Error&&e.message.includes("required"))return R.NextResponse.json({error:e.message},{status:400});return R.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["GET",()=>E],253098);var A=e.i(253098);let _=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/risk/crime/route",pathname:"/api/risk/crime",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/risk/crime/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:T,workUnitAsyncStorage:N,serverHooks:x}=_;function I(){return(0,a.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:N})}async function M(e,t,a){_.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/risk/crime/route";R=R.replace(/\/index$/,"")||"/";let w=await _.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:C,params:b,nextConfig:S,parsedUrl:k,isDraftMode:E,prerenderManifest:A,routerServerContext:T,isOnDemandRevalidate:N,revalidateOnlyGenerated:x,resolvedPathname:I,clientReferenceManifest:M,serverActionsManifest:P}=w,q=(0,l.normalizeAppPath)(R),U=!!(A.dynamicRoutes[q]||A.routes[I]),$=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,k,!1):t.end("This page could not be found"),null);if(U&&!E){let e=!!A.routes[I],t=A.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await $();throw new y.NoFallbackError}}let D=null;!U||_.isDev||E||(D="/index"===(D=I)?"/":D);let O=!0===_.isDev||!U,H=U&&!O;P&&M&&(0,o.setReferenceManifestsSingleton)({page:R,clientReferenceManifest:M,serverActionsManifest:P,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:P})});let j=e.method||"GET",F=(0,n.getTracer)(),V=F.getActiveScopeSpan(),L={params:b,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:O,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>_.onRequestError(e,t,a,T)},sharedContext:{buildId:C}},K=new c.NodeNextRequest(e),B=new c.NodeNextResponse(t),G=u.NextRequestAdapter.fromNodeNextRequest(K,(0,u.signalFromNodeResponse)(t));try{let o=async e=>_.handle(G,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=F.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==h.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${j} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${R}`)}),s=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var n,l;let c=async({previousCacheEntry:r})=>{try{if(!s&&N&&x&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(i);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let c=L.renderOpts.collectedTags;if(!U)return await (0,p.sendResponse)(K,B,n,L.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[v.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,a=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await _.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:N})},T),t}},u=await _.handleResponse({req:e,nextConfig:S,cacheKey:D,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:x,responseGenerator:c,waitUntil:a.waitUntil,isMinimalMode:s});if(!U)return null;if((null==u||null==(n=u.value)?void 0:n.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",N?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return s&&U||h.delete(v.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,g.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(K,B,new Response(u.value.body,{headers:h,status:u.value.status||200})),null};V?await l(V):await F.withPropagatedContext(e.headers,()=>F.trace(h.BaseServerSpan.handleRequest,{spanName:`${j} ${R}`,kind:n.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},l))}catch(t){if(t instanceof y.NoFallbackError||await _.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:N})}),U)throw t;return await (0,p.sendResponse)(K,B,new Response(null,{status:500})),null}}e.s(["handler",()=>M,"patchFetch",()=>I,"routeModule",()=>_,"serverHooks",()=>x,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>N],839719)}];

//# sourceMappingURL=3c0ae_next_dist_esm_build_templates_app-route_cb94e366.js.map