{"version":3,"sources":["../../../../../apps/web/src/lib/ai/action-approval.ts","../../../../../apps/web/src/lib/ai/agent-tools.ts","../../../../../apps/web/src/lib/services/google-custom-search-service.ts"],"sourcesContent":["/**\n * AI Action Approval Service\n *\n * Handles owner-only approval workflow for destructive AI actions.\n * Ensures no destructive action can execute without explicit owner permission.\n */\n\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\nimport {\n\tisDestructiveTool,\n\tgetDestructiveToolMetadata,\n\ttype DestructiveToolMetadata,\n\ttype DestructiveActionType,\n\ttype RiskLevel,\n} from \"./agent-tools\";\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface PendingAction {\n\tid: string;\n\tcompanyId: string;\n\tchatId: string;\n\tmessageId: string;\n\tuserId: string;\n\ttoolName: string;\n\ttoolArgs: Record<string, unknown>;\n\tactionType: DestructiveActionType;\n\taffectedEntityType: string;\n\taffectedEntityIds: string[];\n\taffectedCount: number;\n\triskLevel: RiskLevel;\n\tstatus: \"pending\" | \"approved\" | \"rejected\" | \"expired\" | \"executed\" | \"failed\";\n\tapprovedBy?: string;\n\tapprovedAt?: string;\n\trejectionReason?: string;\n\texecutedAt?: string;\n\texecutionResult?: Record<string, unknown>;\n\texecutionError?: string;\n\texpiresAt: string;\n\tcreatedAt: string;\n}\n\nexport interface CreatePendingActionInput {\n\tcompanyId: string;\n\tchatId: string;\n\tmessageId: string;\n\tuserId: string;\n\ttoolName: string;\n\ttoolArgs: Record<string, unknown>;\n\taffectedEntityIds?: string[];\n}\n\nexport interface ApprovalResult {\n\tsuccess: boolean;\n\terror?: string;\n\tactionId?: string;\n\ttoolName?: string;\n\ttoolArgs?: Record<string, unknown>;\n}\n\n// ============================================================================\n// Owner Verification\n// ============================================================================\n\n/**\n * Check if a user is the owner of a company\n * Uses the database function for consistency with RLS\n */\nexport async function isCompanyOwner(\n\tcompanyId: string,\n\tuserId: string\n): Promise<boolean> {\n\tconst supabase = createServiceSupabaseClient();\n\n\tconst { data, error } = await supabase.rpc(\"is_company_owner\", {\n\t\tp_company_id: companyId,\n\t\tp_user_id: userId,\n\t});\n\n\tif (error) {\n\t\tconsole.error(\"Error checking owner status:\", error);\n\t\treturn false;\n\t}\n\n\treturn data === true;\n}\n\n/**\n * Get the owner(s) of a company\n */\nexport async function getCompanyOwners(companyId: string): Promise<Array<{\n\tuserId: string;\n\temail: string;\n\tfirstName: string;\n\tlastName: string;\n}>> {\n\tconst supabase = createServiceSupabaseClient();\n\n\tconst { data, error } = await supabase\n\t\t.from(\"company_memberships\")\n\t\t.select(`\n\t\t\tuser_id,\n\t\t\tusers!company_memberships_users_id_fkey (\n\t\t\t\temail,\n\t\t\t\tname\n\t\t\t)\n\t\t`)\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"role\", \"owner\");\n\n\tif (error) {\n\t\tconsole.error(\"Error fetching company owners:\", error);\n\t\treturn [];\n\t}\n\n\treturn (data || []).map((row) => {\n\t\tconst user = row.users as { email: string; name: string } | null;\n\t\tconst nameParts = (user?.name || \"\").split(\" \");\n\t\treturn {\n\t\t\tuserId: row.user_id,\n\t\t\temail: user?.email || \"\",\n\t\t\tfirstName: nameParts[0] || \"\",\n\t\t\tlastName: nameParts.slice(1).join(\" \") || \"\",\n\t\t};\n\t});\n}\n\n// ============================================================================\n// Pending Action Management\n// ============================================================================\n\n/**\n * Create a pending action that requires owner approval\n * Returns the pending action ID for tracking\n */\nexport async function createPendingAction(\n\tinput: CreatePendingActionInput\n): Promise<{ success: boolean; pendingActionId?: string; error?: string }> {\n\tconst supabase = createServiceSupabaseClient();\n\n\t// Get metadata about this destructive tool\n\tconst metadata = getDestructiveToolMetadata(input.toolName);\n\tif (!metadata) {\n\t\treturn { success: false, error: `Tool '${input.toolName}' is not registered as destructive` };\n\t}\n\n\t// Calculate expiration (24 hours from now)\n\tconst expiresAt = new Date();\n\texpiresAt.setHours(expiresAt.getHours() + 24);\n\n\t// Create the pending action record\n\tconst { data, error } = await supabase\n\t\t.from(\"ai_pending_actions\")\n\t\t.insert({\n\t\t\tcompany_id: input.companyId,\n\t\t\tchat_id: input.chatId,\n\t\t\tmessage_id: input.messageId,\n\t\t\tuser_id: input.userId,\n\t\t\ttool_name: input.toolName,\n\t\t\ttool_args: input.toolArgs,\n\t\t\taction_type: metadata.actionType,\n\t\t\taction_title: `AI wants to: ${metadata.description}`,\n\t\t\taction_summary: generateActionSummary(input.toolName, input.toolArgs, metadata),\n\t\t\taction_details: {\n\t\t\t\ttoolName: input.toolName,\n\t\t\t\ttoolArgs: input.toolArgs,\n\t\t\t\tmetadata,\n\t\t\t},\n\t\t\taffected_entity_type: metadata.affectedEntityType,\n\t\t\taffected_entity_ids: input.affectedEntityIds || [],\n\t\t\taffected_count: input.affectedEntityIds?.length || 1,\n\t\t\trisk_level: metadata.riskLevel,\n\t\t\tstatus: \"pending\",\n\t\t\turgency: metadata.riskLevel === \"critical\" ? \"high\" : metadata.riskLevel === \"high\" ? \"medium\" : \"low\",\n\t\t\texpires_at: expiresAt.toISOString(),\n\t\t\t// Required by existing schema\n\t\t\taction_log_id: crypto.randomUUID(),\n\t\t})\n\t\t.select(\"id\")\n\t\t.single();\n\n\tif (error) {\n\t\tconsole.error(\"Error creating pending action:\", error);\n\t\treturn { success: false, error: error.message };\n\t}\n\n\treturn { success: true, pendingActionId: data.id };\n}\n\n/**\n * Generate a human-readable summary of the action\n */\nfunction generateActionSummary(\n\ttoolName: string,\n\ttoolArgs: Record<string, unknown>,\n\tmetadata: DestructiveToolMetadata\n): string {\n\tconst parts: string[] = [metadata.description];\n\n\t// Add relevant details from toolArgs\n\tif (toolArgs.to || toolArgs.recipient) {\n\t\tparts.push(`Recipient: ${toolArgs.to || toolArgs.recipient}`);\n\t}\n\tif (toolArgs.subject) {\n\t\tparts.push(`Subject: \"${toolArgs.subject}\"`);\n\t}\n\tif (toolArgs.customerId) {\n\t\tparts.push(`Customer ID: ${toolArgs.customerId}`);\n\t}\n\tif (toolArgs.amount) {\n\t\tparts.push(`Amount: $${(toolArgs.amount as number) / 100}`);\n\t}\n\n\treturn parts.join(\" | \");\n}\n\n/**\n * Get all pending actions for a chat session\n */\nexport async function getPendingActionsForChat(\n\tcompanyId: string,\n\tchatId: string\n): Promise<PendingAction[]> {\n\tconst supabase = createServiceSupabaseClient();\n\n\tconst { data, error } = await supabase\n\t\t.from(\"ai_pending_actions\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"chat_id\", chatId)\n\t\t.eq(\"status\", \"pending\")\n\t\t.order(\"created_at\", { ascending: false });\n\n\tif (error) {\n\t\tconsole.error(\"Error fetching pending actions:\", error);\n\t\treturn [];\n\t}\n\n\treturn (data || []).map(mapDbToPendingAction);\n}\n\n/**\n * Get all pending actions for a company (for owner dashboard)\n */\nexport async function getPendingActionsForCompany(\n\tcompanyId: string,\n\toptions?: {\n\t\tstatus?: \"pending\" | \"approved\" | \"rejected\" | \"expired\";\n\t\tlimit?: number;\n\t}\n): Promise<PendingAction[]> {\n\tconst supabase = createServiceSupabaseClient();\n\n\tlet query = supabase\n\t\t.from(\"ai_pending_actions\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.order(\"created_at\", { ascending: false });\n\n\tif (options?.status) {\n\t\tquery = query.eq(\"status\", options.status);\n\t}\n\n\tif (options?.limit) {\n\t\tquery = query.limit(options.limit);\n\t}\n\n\tconst { data, error } = await query;\n\n\tif (error) {\n\t\tconsole.error(\"Error fetching pending actions:\", error);\n\t\treturn [];\n\t}\n\n\treturn (data || []).map(mapDbToPendingAction);\n}\n\n/**\n * Get a specific pending action by ID\n */\nexport async function getPendingAction(\n\tcompanyId: string,\n\tactionId: string\n): Promise<PendingAction | null> {\n\tconst supabase = createServiceSupabaseClient();\n\n\tconst { data, error } = await supabase\n\t\t.from(\"ai_pending_actions\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"id\", actionId)\n\t\t.single();\n\n\tif (error) {\n\t\tconsole.error(\"Error fetching pending action:\", error);\n\t\treturn null;\n\t}\n\n\treturn mapDbToPendingAction(data);\n}\n\n// ============================================================================\n// Approval/Rejection (Owner-Only)\n// ============================================================================\n\n/**\n * Approve a pending action - OWNER ONLY\n * Uses the database function which enforces owner check\n */\nexport async function approveAction(\n\tactionId: string,\n\tapproverId: string\n): Promise<ApprovalResult> {\n\tconst supabase = createServiceSupabaseClient();\n\n\tconst { data, error } = await supabase.rpc(\"approve_pending_action\", {\n\t\tp_action_id: actionId,\n\t\tp_approver_id: approverId,\n\t});\n\n\tif (error) {\n\t\tconsole.error(\"Error approving action:\", error);\n\t\treturn { success: false, error: error.message };\n\t}\n\n\tconst result = data as ApprovalResult;\n\treturn result;\n}\n\n/**\n * Reject a pending action - OWNER ONLY\n * Uses the database function which enforces owner check\n */\nexport async function rejectAction(\n\tactionId: string,\n\trejectorId: string,\n\treason?: string\n): Promise<ApprovalResult> {\n\tconst supabase = createServiceSupabaseClient();\n\n\tconst { data, error } = await supabase.rpc(\"reject_pending_action\", {\n\t\tp_action_id: actionId,\n\t\tp_rejector_id: rejectorId,\n\t\tp_reason: reason || null,\n\t});\n\n\tif (error) {\n\t\tconsole.error(\"Error rejecting action:\", error);\n\t\treturn { success: false, error: error.message };\n\t}\n\n\tconst result = data as ApprovalResult;\n\treturn result;\n}\n\n// ============================================================================\n// Execution After Approval\n// ============================================================================\n\n/**\n * Mark an approved action as executed\n */\nexport async function markActionExecuted(\n\tcompanyId: string,\n\tactionId: string,\n\tresult: Record<string, unknown>\n): Promise<boolean> {\n\tconst supabase = createServiceSupabaseClient();\n\n\tconst { error } = await supabase\n\t\t.from(\"ai_pending_actions\")\n\t\t.update({\n\t\t\tstatus: \"executed\",\n\t\t\texecuted_at: new Date().toISOString(),\n\t\t\texecution_result: result,\n\t\t\tupdated_at: new Date().toISOString(),\n\t\t})\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"id\", actionId)\n\t\t.eq(\"status\", \"approved\"); // Can only execute approved actions\n\n\tif (error) {\n\t\tconsole.error(\"Error marking action as executed:\", error);\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\n/**\n * Mark an approved action as failed\n */\nexport async function markActionFailed(\n\tcompanyId: string,\n\tactionId: string,\n\terrorMessage: string\n): Promise<boolean> {\n\tconst supabase = createServiceSupabaseClient();\n\n\tconst { error } = await supabase\n\t\t.from(\"ai_pending_actions\")\n\t\t.update({\n\t\t\tstatus: \"failed\",\n\t\t\texecution_error: errorMessage,\n\t\t\tupdated_at: new Date().toISOString(),\n\t\t})\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"id\", actionId)\n\t\t.eq(\"status\", \"approved\");\n\n\tif (error) {\n\t\tconsole.error(\"Error marking action as failed:\", error);\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\n// ============================================================================\n// Expiration Handling\n// ============================================================================\n\n/**\n * Expire old pending actions (called by cron or on access)\n */\nexport async function expireOldActions(companyId: string): Promise<number> {\n\tconst supabase = createServiceSupabaseClient();\n\n\tconst { data, error } = await supabase\n\t\t.from(\"ai_pending_actions\")\n\t\t.update({\n\t\t\tstatus: \"expired\",\n\t\t\tupdated_at: new Date().toISOString(),\n\t\t})\n\t\t.eq(\"company_id\", companyId)\n\t\t.eq(\"status\", \"pending\")\n\t\t.lt(\"expires_at\", new Date().toISOString())\n\t\t.select(\"id\");\n\n\tif (error) {\n\t\tconsole.error(\"Error expiring old actions:\", error);\n\t\treturn 0;\n\t}\n\n\treturn data?.length || 0;\n}\n\n// ============================================================================\n// Tool Interception Helper\n// ============================================================================\n\n/**\n * Check if a tool call should be intercepted for owner approval\n * Returns the pending action details if interception is needed\n */\nexport async function shouldInterceptTool(\n\ttoolName: string,\n\ttoolArgs: Record<string, unknown>,\n\tcontext: {\n\t\tcompanyId: string;\n\t\tchatId: string;\n\t\tmessageId: string;\n\t\tuserId: string;\n\t}\n): Promise<{\n\tintercept: boolean;\n\tpendingActionId?: string;\n\tmetadata?: DestructiveToolMetadata;\n\terror?: string;\n}> {\n\t// Check if tool is destructive\n\tif (!isDestructiveTool(toolName)) {\n\t\treturn { intercept: false };\n\t}\n\n\tconst metadata = getDestructiveToolMetadata(toolName);\n\tif (!metadata || !metadata.requiresOwnerApproval) {\n\t\treturn { intercept: false };\n\t}\n\n\t// Check if user is already an owner (owners can self-approve in UI)\n\tconst isOwner = await isCompanyOwner(context.companyId, context.userId);\n\n\t// Even owners need to see the dialog and explicitly approve\n\t// This ensures conscious decision-making for destructive actions\n\n\t// Create pending action\n\tconst result = await createPendingAction({\n\t\tcompanyId: context.companyId,\n\t\tchatId: context.chatId,\n\t\tmessageId: context.messageId,\n\t\tuserId: context.userId,\n\t\ttoolName,\n\t\ttoolArgs,\n\t});\n\n\tif (!result.success) {\n\t\treturn { intercept: true, error: result.error, metadata };\n\t}\n\n\treturn {\n\t\tintercept: true,\n\t\tpendingActionId: result.pendingActionId,\n\t\tmetadata,\n\t};\n}\n\n// ============================================================================\n// Helpers\n// ============================================================================\n\nfunction mapDbToPendingAction(row: Record<string, unknown>): PendingAction {\n\treturn {\n\t\tid: row.id as string,\n\t\tcompanyId: row.company_id as string,\n\t\tchatId: row.chat_id as string,\n\t\tmessageId: row.message_id as string,\n\t\tuserId: row.user_id as string,\n\t\ttoolName: row.tool_name as string,\n\t\ttoolArgs: (row.tool_args as Record<string, unknown>) || {},\n\t\tactionType: row.action_type as DestructiveActionType,\n\t\taffectedEntityType: row.affected_entity_type as string,\n\t\taffectedEntityIds: (row.affected_entity_ids as string[]) || [],\n\t\taffectedCount: (row.affected_count as number) || 1,\n\t\triskLevel: (row.risk_level as RiskLevel) || \"medium\",\n\t\tstatus: row.status as PendingAction[\"status\"],\n\t\tapprovedBy: row.approved_by as string | undefined,\n\t\tapprovedAt: row.approved_at as string | undefined,\n\t\trejectionReason: row.rejection_reason as string | undefined,\n\t\texecutedAt: row.executed_at as string | undefined,\n\t\texecutionResult: row.execution_result as Record<string, unknown> | undefined,\n\t\texecutionError: row.execution_error as string | undefined,\n\t\texpiresAt: row.expires_at as string,\n\t\tcreatedAt: row.created_at as string,\n\t};\n}\n\n// ============================================================================\n// Exports for use in AI chat route and UI\n// ============================================================================\n\nexport {\n\tisDestructiveTool,\n\tgetDestructiveToolMetadata,\n\ttype DestructiveToolMetadata,\n\ttype DestructiveActionType,\n\ttype RiskLevel,\n} from \"./agent-tools\";\n","/**\n * AI Agent Tools - Comprehensive tool definitions for the AI Manager\n * Integrates with database, Resend, Telnyx, and financial systems\n */\n\nimport { tool } from \"ai\";\nimport { z } from \"zod\";\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\nimport {\n\tsearchCustomersFullText,\n\tsearchJobsFullText,\n\tsearchAllEntities,\n} from \"@/lib/search/full-text-search\";\nimport { googleCustomSearchService } from \"@/lib/services/google-custom-search-service\";\n\n// Tool categories for permission checking\nexport type ToolCategory = \"communication\" | \"financial\" | \"scheduling\" | \"customer\" | \"reporting\" | \"system\" | \"team\" | \"vendor\" | \"notification\" | \"property\" | \"equipment\";\n\n// ============================================================================\n// UNIVERSAL DATABASE ACCESS TOOLS\n// ============================================================================\n\nexport const listDatabaseTablesTool = tool({\n\tdescription: \"List all available database tables and their purposes. Use this to understand what data is available.\",\n\tparameters: z.object({}),\n\texecute: async () => {\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\ttables: [\n\t\t\t\t{ name: \"customers\", description: \"Customer records with contact info, revenue, and status\" },\n\t\t\t\t{ name: \"team_members\", description: \"Employee/staff records with roles, contact info, and assignments\" },\n\t\t\t\t{ name: \"vendors\", description: \"Supplier/vendor records with contact and payment info\" },\n\t\t\t\t{ name: \"jobs\", description: \"Work orders and service jobs with status, scheduling, and costs\" },\n\t\t\t\t{ name: \"appointments\", description: \"Scheduled appointments and service calls\" },\n\t\t\t\t{ name: \"invoices\", description: \"Customer invoices with line items and payment status\" },\n\t\t\t\t{ name: \"estimates\", description: \"Price estimates/quotes for customers\" },\n\t\t\t\t{ name: \"contracts\", description: \"Service contracts and agreements\" },\n\t\t\t\t{ name: \"payments\", description: \"Payment records and transactions\" },\n\t\t\t\t{ name: \"properties\", description: \"Customer properties/service locations\" },\n\t\t\t\t{ name: \"equipment\", description: \"Equipment and assets at properties\" },\n\t\t\t\t{ name: \"communications\", description: \"Email, SMS, and call history\" },\n\t\t\t\t{ name: \"price_book_items\", description: \"Service and product pricing catalog\" },\n\t\t\t\t{ name: \"materials\", description: \"Materials and parts inventory\" },\n\t\t\t\t{ name: \"purchase_orders\", description: \"Orders placed with vendors\" },\n\t\t\t\t{ name: \"time_entries\", description: \"Time tracking for jobs and employees\" },\n\t\t\t\t{ name: \"expenses\", description: \"Business expenses and costs\" },\n\t\t\t\t{ name: \"service_agreements\", description: \"Recurring service agreements\" },\n\t\t\t\t{ name: \"maintenance_plans\", description: \"Equipment maintenance schedules\" },\n\t\t\t\t{ name: \"notes\", description: \"Notes attached to various records\" },\n\t\t\t\t{ name: \"tags\", description: \"Tags/labels for organizing records\" },\n\t\t\t\t{ name: \"finance_virtual_buckets\", description: \"Financial savings goals and allocations\" },\n\t\t\t\t{ name: \"scheduled_notifications\", description: \"Scheduled reminders and notifications\" },\n\t\t\t],\n\t\t};\n\t},\n});\n\nexport const queryDatabaseTool = tool({\n\tdescription: \"Query any database table to retrieve records. Use this for flexible data access when specific tools don't cover your needs.\",\n\tparameters: z.object({\n\t\ttable: z.string().describe(\"Table name to query (e.g., 'customers', 'jobs', 'invoices')\"),\n\t\tselect: z.string().optional().default(\"*\").describe(\"Columns to select (comma-separated or * for all)\"),\n\t\tfilters: z.array(z.object({\n\t\t\tcolumn: z.string(),\n\t\t\toperator: z.enum([\"eq\", \"neq\", \"gt\", \"gte\", \"lt\", \"lte\", \"like\", \"ilike\", \"in\", \"is\"]),\n\t\t\tvalue: z.union([z.string(), z.number(), z.boolean(), z.null(), z.array(z.string())]),\n\t\t})).optional().describe(\"Filters to apply\"),\n\t\torderBy: z.object({\n\t\t\tcolumn: z.string(),\n\t\t\tascending: z.boolean().default(false),\n\t\t}).optional().describe(\"Sort order\"),\n\t\tlimit: z.number().optional().default(50).describe(\"Max records to return\"),\n\t\toffset: z.number().optional().default(0).describe(\"Records to skip for pagination\"),\n\t}),\n\texecute: async ({ table, select, filters, orderBy, limit, offset }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\t// Security: Only allow access to business tables\n\t\tconst allowedTables = [\n\t\t\t\"customers\", \"team_members\", \"vendors\", \"jobs\", \"appointments\", \"invoices\",\n\t\t\t\"estimates\", \"contracts\", \"payments\", \"properties\", \"equipment\", \"communications\",\n\t\t\t\"price_book_items\", \"materials\", \"purchase_orders\", \"time_entries\", \"expenses\",\n\t\t\t\"service_agreements\", \"maintenance_plans\", \"notes\", \"tags\", \"finance_virtual_buckets\",\n\t\t\t\"scheduled_notifications\", \"job_line_items\", \"invoice_line_items\", \"estimate_line_items\",\n\t\t];\n\n\t\tif (!allowedTables.includes(table)) {\n\t\t\treturn { success: false, error: `Table '${table}' is not accessible. Available: ${allowedTables.join(\", \")}` };\n\t\t}\n\n\t\tlet query = supabase.from(table).select(select);\n\n\t\t// Always filter by company_id for security\n\t\tquery = query.eq(\"company_id\", companyId);\n\n\t\t// Apply filters\n\t\tif (filters) {\n\t\t\tfor (const filter of filters) {\n\t\t\t\tswitch (filter.operator) {\n\t\t\t\t\tcase \"eq\": query = query.eq(filter.column, filter.value); break;\n\t\t\t\t\tcase \"neq\": query = query.neq(filter.column, filter.value); break;\n\t\t\t\t\tcase \"gt\": query = query.gt(filter.column, filter.value); break;\n\t\t\t\t\tcase \"gte\": query = query.gte(filter.column, filter.value); break;\n\t\t\t\t\tcase \"lt\": query = query.lt(filter.column, filter.value); break;\n\t\t\t\t\tcase \"lte\": query = query.lte(filter.column, filter.value); break;\n\t\t\t\t\tcase \"like\": query = query.like(filter.column, filter.value as string); break;\n\t\t\t\t\tcase \"ilike\": query = query.ilike(filter.column, filter.value as string); break;\n\t\t\t\t\tcase \"in\": query = query.in(filter.column, filter.value as string[]); break;\n\t\t\t\t\tcase \"is\": query = query.is(filter.column, filter.value); break;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Apply ordering\n\t\tif (orderBy) {\n\t\t\tquery = query.order(orderBy.column, { ascending: orderBy.ascending });\n\t\t}\n\n\t\t// Apply pagination\n\t\tquery = query.range(offset, offset + limit - 1);\n\n\t\tconst { data, error, count } = await query;\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, data, count: data?.length || 0, table };\n\t},\n});\n\nexport const getRecordByIdTool = tool({\n\tdescription: \"Get a specific record by its ID from any table. Use when you need full details of a known record.\",\n\tparameters: z.object({\n\t\ttable: z.string().describe(\"Table name\"),\n\t\tid: z.string().uuid().describe(\"Record UUID\"),\n\t\tselect: z.string().optional().default(\"*\").describe(\"Columns to select\"),\n\t}),\n\texecute: async ({ table, id, select }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst allowedTables = [\n\t\t\t\"customers\", \"team_members\", \"vendors\", \"jobs\", \"appointments\", \"invoices\",\n\t\t\t\"estimates\", \"contracts\", \"payments\", \"properties\", \"equipment\", \"communications\",\n\t\t\t\"price_book_items\", \"materials\", \"purchase_orders\", \"time_entries\", \"expenses\",\n\t\t\t\"service_agreements\", \"maintenance_plans\", \"notes\", \"finance_virtual_buckets\",\n\t\t];\n\n\t\tif (!allowedTables.includes(table)) {\n\t\t\treturn { success: false, error: `Table '${table}' is not accessible` };\n\t\t}\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(table)\n\t\t\t.select(select)\n\t\t\t.eq(\"id\", id)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, record: data, table };\n\t},\n});\n\nexport const getRelatedRecordsTool = tool({\n\tdescription: \"Get records related to a specific entity (e.g., all jobs for a customer, all invoices for a job).\",\n\tparameters: z.object({\n\t\tparentTable: z.string().describe(\"Parent table (e.g., 'customers')\"),\n\t\tparentId: z.string().uuid().describe(\"Parent record ID\"),\n\t\tchildTable: z.string().describe(\"Related table to query (e.g., 'jobs')\"),\n\t\tforeignKey: z.string().describe(\"Foreign key column in child table (e.g., 'customer_id')\"),\n\t\tselect: z.string().optional().default(\"*\"),\n\t\tlimit: z.number().optional().default(50),\n\t}),\n\texecute: async ({ parentTable, parentId, childTable, foreignKey, select, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(childTable)\n\t\t\t.select(select)\n\t\t\t.eq(foreignKey, parentId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.limit(limit);\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, data, count: data?.length || 0, parentTable, childTable };\n\t},\n});\n\nexport const getCompanyOverviewTool = tool({\n\tdescription: \"Get a comprehensive overview of the entire company including counts and summaries from all major tables.\",\n\tparameters: z.object({}),\n\texecute: async (_params, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst [\n\t\t\tcustomersResult,\n\t\t\tteamResult,\n\t\t\tvendorsResult,\n\t\t\tjobsResult,\n\t\t\tinvoicesResult,\n\t\t\testimatesResult,\n\t\t\tcontractsResult,\n\t\t\tpropertiesResult,\n\t\t\tequipmentResult,\n\t\t\tappointmentsResult,\n\t\t] = await Promise.all([\n\t\t\tsupabase.from(\"customers\").select(\"id, status\", { count: \"exact\" }).eq(\"company_id\", companyId),\n\t\t\tsupabase.from(\"team_members\").select(\"id, status, role\", { count: \"exact\" }).eq(\"company_id\", companyId),\n\t\t\tsupabase.from(\"vendors\").select(\"id, status\", { count: \"exact\" }).eq(\"company_id\", companyId),\n\t\t\tsupabase.from(\"jobs\").select(\"id, status, total_amount\", { count: \"exact\" }).eq(\"company_id\", companyId),\n\t\t\tsupabase.from(\"invoices\").select(\"id, status, total_amount, balance_amount\", { count: \"exact\" }).eq(\"company_id\", companyId),\n\t\t\tsupabase.from(\"estimates\").select(\"id, status, total_amount\", { count: \"exact\" }).eq(\"company_id\", companyId),\n\t\t\tsupabase.from(\"contracts\").select(\"id, status, total_value\", { count: \"exact\" }).eq(\"company_id\", companyId),\n\t\t\tsupabase.from(\"properties\").select(\"id\", { count: \"exact\" }).eq(\"company_id\", companyId),\n\t\t\tsupabase.from(\"equipment\").select(\"id\", { count: \"exact\" }).eq(\"company_id\", companyId),\n\t\t\tsupabase.from(\"appointments\").select(\"id, status\", { count: \"exact\" }).eq(\"company_id\", companyId),\n\t\t]);\n\n\t\t// Calculate summaries\n\t\tconst activeCustomers = customersResult.data?.filter(c => c.status === \"active\").length || 0;\n\t\tconst activeTeam = teamResult.data?.filter(t => t.status === \"active\").length || 0;\n\t\tconst openJobs = jobsResult.data?.filter(j => [\"pending\", \"scheduled\", \"in_progress\"].includes(j.status)).length || 0;\n\t\tconst completedJobs = jobsResult.data?.filter(j => j.status === \"completed\").length || 0;\n\t\tconst pendingInvoices = invoicesResult.data?.filter(i => [\"sent\", \"viewed\"].includes(i.status)).length || 0;\n\t\tconst overdueBalance = invoicesResult.data?.filter(i => i.balance_amount > 0).reduce((s, i) => s + i.balance_amount, 0) || 0;\n\t\tconst pendingEstimates = estimatesResult.data?.filter(e => [\"sent\", \"viewed\"].includes(e.status)).length || 0;\n\t\tconst activeContracts = contractsResult.data?.filter(c => c.status === \"active\").length || 0;\n\n\t\t// Team role breakdown\n\t\tconst roleBreakdown: Record<string, number> = {};\n\t\tteamResult.data?.forEach(t => {\n\t\t\troleBreakdown[t.role || \"unassigned\"] = (roleBreakdown[t.role || \"unassigned\"] || 0) + 1;\n\t\t});\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\toverview: {\n\t\t\t\tcustomers: {\n\t\t\t\t\ttotal: customersResult.count || 0,\n\t\t\t\t\tactive: activeCustomers,\n\t\t\t\t},\n\t\t\t\tteam: {\n\t\t\t\t\ttotal: teamResult.count || 0,\n\t\t\t\t\tactive: activeTeam,\n\t\t\t\t\tbyRole: roleBreakdown,\n\t\t\t\t},\n\t\t\t\tvendors: {\n\t\t\t\t\ttotal: vendorsResult.count || 0,\n\t\t\t\t},\n\t\t\t\tjobs: {\n\t\t\t\t\ttotal: jobsResult.count || 0,\n\t\t\t\t\topen: openJobs,\n\t\t\t\t\tcompleted: completedJobs,\n\t\t\t\t},\n\t\t\t\tinvoices: {\n\t\t\t\t\ttotal: invoicesResult.count || 0,\n\t\t\t\t\tpending: pendingInvoices,\n\t\t\t\t\toutstandingBalance: overdueBalance / 100,\n\t\t\t\t},\n\t\t\t\testimates: {\n\t\t\t\t\ttotal: estimatesResult.count || 0,\n\t\t\t\t\tpending: pendingEstimates,\n\t\t\t\t},\n\t\t\t\tcontracts: {\n\t\t\t\t\ttotal: contractsResult.count || 0,\n\t\t\t\t\tactive: activeContracts,\n\t\t\t\t},\n\t\t\t\tproperties: {\n\t\t\t\t\ttotal: propertiesResult.count || 0,\n\t\t\t\t},\n\t\t\t\tequipment: {\n\t\t\t\t\ttotal: equipmentResult.count || 0,\n\t\t\t\t},\n\t\t\t\tappointments: {\n\t\t\t\t\ttotal: appointmentsResult.count || 0,\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t},\n});\n\nexport const searchAllEntitesTool = tool({\n\tdescription: \"Search across multiple tables simultaneously using full-text search with relevance ranking. Use for broad searches when you don't know which entity type contains the information.\",\n\tparameters: z.object({\n\t\tquery: z.string().describe(\"Search term - supports multi-word queries and typo tolerance\"),\n\t\tlimit: z.number().optional().default(10).describe(\"Results per table\"),\n\t}),\n\texecute: async ({ query, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\t// Use unified full-text search for better performance and relevance\n\t\tconst searchResults = await searchAllEntities(supabase, companyId, query, { limit });\n\n\t\t// Format results for AI consumption\n\t\tconst results: Record<string, unknown[]> = {};\n\t\tif (searchResults.customers.length > 0) results.customers = searchResults.customers;\n\t\tif (searchResults.jobs.length > 0) results.jobs = searchResults.jobs;\n\t\tif (searchResults.properties.length > 0) results.properties = searchResults.properties;\n\t\tif (searchResults.equipment.length > 0) results.equipment = searchResults.equipment;\n\t\tif (searchResults.priceBookItems.length > 0) results.priceBookItems = searchResults.priceBookItems;\n\n\t\tconst totalResults = Object.values(results).reduce((sum, arr) => sum + arr.length, 0);\n\n\t\treturn { success: true, results, totalResults, query };\n\t},\n});\n\n// ============================================================================\n// CUSTOMER TOOLS\n// ============================================================================\n\nexport const searchCustomersTool = tool({\n\tdescription: \"Search for customers by name, email, phone, or address using full-text search with relevance ranking. Supports multi-word queries and typo tolerance.\",\n\tparameters: z.object({\n\t\tquery: z.string().describe(\"Search query - can be name, email, phone, or address\"),\n\t\tlimit: z.number().optional().default(10).describe(\"Maximum results to return\"),\n\t}),\n\texecute: async ({ query, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\t// Use full-text search for better performance and relevance\n\t\tconst customers = await searchCustomersFullText(supabase, companyId, query, { limit });\n\n\t\treturn { success: true, customers, count: customers.length };\n\t},\n});\n\nexport const getCustomerDetailsTool = tool({\n\tdescription: \"Get detailed information about a specific customer including their jobs, invoices, and communication history\",\n\tparameters: z.object({\n\t\tcustomerId: z.string().uuid().describe(\"The UUID of the customer\"),\n\t}),\n\texecute: async ({ customerId }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst [customerResult, jobsResult, invoicesResult] = await Promise.all([\n\t\t\tsupabase\n\t\t\t\t.from(\"customers\")\n\t\t\t\t.select(\"*\")\n\t\t\t\t.eq(\"id\", customerId)\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.single(),\n\t\t\tsupabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\"id, title, status, total_amount, scheduled_start\")\n\t\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t\t.limit(5),\n\t\t\tsupabase\n\t\t\t\t.from(\"invoices\")\n\t\t\t\t.select(\"id, invoice_number, status, total_amount, balance_amount, due_date\")\n\t\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t\t.limit(5),\n\t\t]);\n\n\t\tif (customerResult.error) return { success: false, error: customerResult.error.message };\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tcustomer: customerResult.data,\n\t\t\trecentJobs: jobsResult.data || [],\n\t\t\trecentInvoices: invoicesResult.data || [],\n\t\t};\n\t},\n});\n\nexport const createCustomerTool = tool({\n\tdescription: \"Create a new customer in the system. Use this when a new customer contacts the business.\",\n\tparameters: z.object({\n\t\tfirstName: z.string().describe(\"Customer's first name\"),\n\t\tlastName: z.string().describe(\"Customer's last name\"),\n\t\temail: z.string().email().describe(\"Customer's email address\"),\n\t\tphone: z.string().describe(\"Customer's phone number\"),\n\t\taddress: z.string().optional().describe(\"Street address\"),\n\t\tcity: z.string().optional().describe(\"City\"),\n\t\tstate: z.string().optional().describe(\"State\"),\n\t\tzipCode: z.string().optional().describe(\"ZIP code\"),\n\t\tsource: z.string().optional().describe(\"How the customer found us (referral, google, etc.)\"),\n\t}),\n\texecute: async (params, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"customers\")\n\t\t\t.insert({\n\t\t\t\tcompany_id: companyId,\n\t\t\t\tfirst_name: params.firstName,\n\t\t\t\tlast_name: params.lastName,\n\t\t\t\tdisplay_name: `${params.firstName} ${params.lastName}`,\n\t\t\t\temail: params.email,\n\t\t\t\tphone: params.phone,\n\t\t\t\taddress: params.address,\n\t\t\t\tcity: params.city,\n\t\t\t\tstate: params.state,\n\t\t\t\tzip_code: params.zipCode,\n\t\t\t\tsource: params.source,\n\t\t\t\tstatus: \"active\",\n\t\t\t})\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, customer: data, message: `Created customer ${data.display_name}` };\n\t},\n});\n\nexport const updateCustomerTool = tool({\n\tdescription: \"Update customer information\",\n\tparameters: z.object({\n\t\tcustomerId: z.string().uuid().describe(\"Customer ID to update\"),\n\t\tupdates: z.object({\n\t\t\tfirstName: z.string().optional(),\n\t\t\tlastName: z.string().optional(),\n\t\t\temail: z.string().email().optional(),\n\t\t\tphone: z.string().optional(),\n\t\t\taddress: z.string().optional(),\n\t\t\tcity: z.string().optional(),\n\t\t\tstate: z.string().optional(),\n\t\t\tzipCode: z.string().optional(),\n\t\t\tnotes: z.string().optional(),\n\t\t}).describe(\"Fields to update\"),\n\t}),\n\texecute: async ({ customerId, updates }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst updateData: Record<string, unknown> = {};\n\t\tif (updates.firstName) updateData.first_name = updates.firstName;\n\t\tif (updates.lastName) updateData.last_name = updates.lastName;\n\t\tif (updates.email) updateData.email = updates.email;\n\t\tif (updates.phone) updateData.phone = updates.phone;\n\t\tif (updates.address) updateData.address = updates.address;\n\t\tif (updates.city) updateData.city = updates.city;\n\t\tif (updates.state) updateData.state = updates.state;\n\t\tif (updates.zipCode) updateData.zip_code = updates.zipCode;\n\t\tif (updates.notes) updateData.notes = updates.notes;\n\n\t\tif (updates.firstName || updates.lastName) {\n\t\t\tupdateData.display_name = `${updates.firstName || \"\"} ${updates.lastName || \"\"}`.trim();\n\t\t}\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"customers\")\n\t\t\t.update(updateData)\n\t\t\t.eq(\"id\", customerId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, customer: data };\n\t},\n});\n\n// ============================================================================\n// TEAM MEMBER TOOLS\n// ============================================================================\n\nexport const searchTeamMembersTool = tool({\n\tdescription: \"Search for team members by name, role, or department. Use this to find employees to assign or contact.\",\n\tparameters: z.object({\n\t\tquery: z.string().optional().describe(\"Search query - name or email\"),\n\t\trole: z.string().optional().describe(\"Filter by role (technician, admin, manager, etc.)\"),\n\t\tlimit: z.number().optional().default(20),\n\t}),\n\texecute: async ({ query, role, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tlet queryBuilder = supabase\n\t\t\t.from(\"team_members\")\n\t\t\t.select(\"id, first_name, last_name, email, phone, role, department, status, hire_date, avatar_url\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"status\", \"active\");\n\n\t\tif (query) {\n\t\t\tqueryBuilder = queryBuilder.or(`first_name.ilike.%${query}%,last_name.ilike.%${query}%,email.ilike.%${query}%`);\n\t\t}\n\t\tif (role) queryBuilder = queryBuilder.eq(\"role\", role);\n\n\t\tconst { data, error } = await queryBuilder.limit(limit);\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, teamMembers: data, count: data?.length || 0 };\n\t},\n});\n\nexport const getTeamMemberDetailsTool = tool({\n\tdescription: \"Get detailed information about a team member including their schedule and performance\",\n\tparameters: z.object({\n\t\tteamMemberId: z.string().uuid().describe(\"The team member's ID\"),\n\t}),\n\texecute: async ({ teamMemberId }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst [memberResult, jobsResult] = await Promise.all([\n\t\t\tsupabase\n\t\t\t\t.from(\"team_members\")\n\t\t\t\t.select(\"*\")\n\t\t\t\t.eq(\"id\", teamMemberId)\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.single(),\n\t\t\tsupabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\"id, title, status, scheduled_start, total_amount\")\n\t\t\t\t.eq(\"assigned_to\", teamMemberId)\n\t\t\t\t.order(\"scheduled_start\", { ascending: false })\n\t\t\t\t.limit(10),\n\t\t]);\n\n\t\tif (memberResult.error) return { success: false, error: memberResult.error.message };\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tteamMember: memberResult.data,\n\t\t\trecentJobs: jobsResult.data || [],\n\t\t};\n\t},\n});\n\nexport const sendTeamEmailTool = tool({\n\tdescription: \"Send an email to a team member for internal communication, assignments, or updates.\",\n\tparameters: z.object({\n\t\tteamMemberId: z.string().uuid().describe(\"Team member ID to send email to\"),\n\t\tsubject: z.string().describe(\"Email subject\"),\n\t\tbody: z.string().describe(\"Email body (HTML supported)\"),\n\t}),\n\texecute: async ({ teamMemberId, subject, body }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\t// Get team member email\n\t\tconst { data: member } = await supabase\n\t\t\t.from(\"team_members\")\n\t\t\t.select(\"email, first_name, last_name\")\n\t\t\t.eq(\"id\", teamMemberId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (!member?.email) return { success: false, error: \"Team member email not found\" };\n\n\t\tconst { resend } = await import(\"@/lib/email/resend-client\");\n\t\tif (!resend) return { success: false, error: \"Email service not configured\" };\n\n\t\tconst { data, error } = await resend.emails.send({\n\t\t\tfrom: process.env.RESEND_FROM_EMAIL || \"noreply@thorbis.com\",\n\t\t\tto: member.email,\n\t\t\tsubject,\n\t\t\thtml: body,\n\t\t});\n\n\t\tif (error) return { success: false, error: error.message };\n\n\t\treturn { success: true, messageId: data?.id, message: `Email sent to ${member.first_name} ${member.last_name}` };\n\t},\n});\n\nexport const sendTeamSmsTool = tool({\n\tdescription: \"Send an SMS to a team member for urgent updates or assignments.\",\n\tparameters: z.object({\n\t\tteamMemberId: z.string().uuid().describe(\"Team member ID\"),\n\t\tmessage: z.string().max(160).describe(\"SMS message (max 160 chars)\"),\n\t}),\n\texecute: async ({ teamMemberId, message }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst { data: member } = await supabase\n\t\t\t.from(\"team_members\")\n\t\t\t.select(\"phone, first_name, last_name\")\n\t\t\t.eq(\"id\", teamMemberId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (!member?.phone) return { success: false, error: \"Team member phone not found\" };\n\n\t\tconst { data: phoneNumber } = await supabase\n\t\t\t.from(\"phone_numbers\")\n\t\t\t.select(\"phone_number\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"is_primary\", true)\n\t\t\t.single();\n\n\t\tif (!phoneNumber) return { success: false, error: \"No company phone configured\" };\n\n\t\tconst { sendSMS } = await import(\"@/lib/telnyx/messaging\");\n\t\tconst result = await sendSMS({\n\t\t\tfrom: phoneNumber.phone_number,\n\t\t\tto: member.phone,\n\t\t\ttext: message,\n\t\t});\n\n\t\tif (!result.success) return { success: false, error: result.error };\n\n\t\treturn { success: true, messageId: result.messageId, message: `SMS sent to ${member.first_name} ${member.last_name}` };\n\t},\n});\n\n// ============================================================================\n// VENDOR TOOLS\n// ============================================================================\n\nexport const searchVendorsTool = tool({\n\tdescription: \"Search for vendors/suppliers by name, category, or status\",\n\tparameters: z.object({\n\t\tquery: z.string().optional().describe(\"Search query - name or contact\"),\n\t\tcategory: z.string().optional().describe(\"Vendor category (supplies, equipment, parts, etc.)\"),\n\t\tlimit: z.number().optional().default(20),\n\t}),\n\texecute: async ({ query, category, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tlet queryBuilder = supabase\n\t\t\t.from(\"vendors\")\n\t\t\t.select(\"id, name, contact_name, email, phone, category, status, account_number, payment_terms\")\n\t\t\t.eq(\"company_id\", companyId);\n\n\t\tif (query) queryBuilder = queryBuilder.or(`name.ilike.%${query}%,contact_name.ilike.%${query}%`);\n\t\tif (category) queryBuilder = queryBuilder.eq(\"category\", category);\n\n\t\tconst { data, error } = await queryBuilder.limit(limit);\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, vendors: data, count: data?.length || 0 };\n\t},\n});\n\nexport const getVendorDetailsTool = tool({\n\tdescription: \"Get detailed information about a vendor including purchase history\",\n\tparameters: z.object({\n\t\tvendorId: z.string().uuid().describe(\"Vendor ID\"),\n\t}),\n\texecute: async ({ vendorId }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst [vendorResult, purchasesResult] = await Promise.all([\n\t\t\tsupabase\n\t\t\t\t.from(\"vendors\")\n\t\t\t\t.select(\"*\")\n\t\t\t\t.eq(\"id\", vendorId)\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.single(),\n\t\t\tsupabase\n\t\t\t\t.from(\"purchase_orders\")\n\t\t\t\t.select(\"id, po_number, status, total_amount, order_date\")\n\t\t\t\t.eq(\"vendor_id\", vendorId)\n\t\t\t\t.order(\"order_date\", { ascending: false })\n\t\t\t\t.limit(10),\n\t\t]);\n\n\t\tif (vendorResult.error) return { success: false, error: vendorResult.error.message };\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tvendor: vendorResult.data,\n\t\t\trecentPurchases: purchasesResult.data || [],\n\t\t};\n\t},\n});\n\nexport const sendVendorEmailTool = tool({\n\tdescription: \"Send an email to a vendor for orders, inquiries, or communication.\",\n\tparameters: z.object({\n\t\tvendorId: z.string().uuid().describe(\"Vendor ID\"),\n\t\tsubject: z.string().describe(\"Email subject\"),\n\t\tbody: z.string().describe(\"Email body\"),\n\t}),\n\texecute: async ({ vendorId, subject, body }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst { data: vendor } = await supabase\n\t\t\t.from(\"vendors\")\n\t\t\t.select(\"email, name, contact_name\")\n\t\t\t.eq(\"id\", vendorId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (!vendor?.email) return { success: false, error: \"Vendor email not found\" };\n\n\t\tconst { resend } = await import(\"@/lib/email/resend-client\");\n\t\tif (!resend) return { success: false, error: \"Email service not configured\" };\n\n\t\tconst { data, error } = await resend.emails.send({\n\t\t\tfrom: process.env.RESEND_FROM_EMAIL || \"noreply@thorbis.com\",\n\t\t\tto: vendor.email,\n\t\t\tsubject,\n\t\t\thtml: body,\n\t\t});\n\n\t\tif (error) return { success: false, error: error.message };\n\n\t\treturn { success: true, messageId: data?.id, message: `Email sent to ${vendor.name}` };\n\t},\n});\n\nexport const sendVendorSmsTool = tool({\n\tdescription: \"Send an SMS to a vendor contact for urgent communication.\",\n\tparameters: z.object({\n\t\tvendorId: z.string().uuid().describe(\"Vendor ID\"),\n\t\tmessage: z.string().max(160).describe(\"SMS message\"),\n\t}),\n\texecute: async ({ vendorId, message }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst { data: vendor } = await supabase\n\t\t\t.from(\"vendors\")\n\t\t\t.select(\"phone, name\")\n\t\t\t.eq(\"id\", vendorId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (!vendor?.phone) return { success: false, error: \"Vendor phone not found\" };\n\n\t\tconst { data: phoneNumber } = await supabase\n\t\t\t.from(\"phone_numbers\")\n\t\t\t.select(\"phone_number\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"is_primary\", true)\n\t\t\t.single();\n\n\t\tif (!phoneNumber) return { success: false, error: \"No company phone configured\" };\n\n\t\tconst { sendSMS } = await import(\"@/lib/telnyx/messaging\");\n\t\tconst result = await sendSMS({\n\t\t\tfrom: phoneNumber.phone_number,\n\t\t\tto: vendor.phone,\n\t\t\ttext: message,\n\t\t});\n\n\t\tif (!result.success) return { success: false, error: result.error };\n\n\t\treturn { success: true, messageId: result.messageId, message: `SMS sent to ${vendor.name}` };\n\t},\n});\n\n// ============================================================================\n// PROPERTY & EQUIPMENT TOOLS\n// ============================================================================\n\nexport const searchPropertiesTool = tool({\n\tdescription: \"Search for service properties by address, customer, or type\",\n\tparameters: z.object({\n\t\tquery: z.string().optional().describe(\"Address or property name search\"),\n\t\tcustomerId: z.string().uuid().optional().describe(\"Filter by customer\"),\n\t\tpropertyType: z.string().optional().describe(\"Property type (residential, commercial, etc.)\"),\n\t\tlimit: z.number().optional().default(20),\n\t}),\n\texecute: async ({ query, customerId, propertyType, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tlet queryBuilder = supabase\n\t\t\t.from(\"properties\")\n\t\t\t.select(\"id, name, address, city, state, zip_code, property_type, customer:customers(display_name)\")\n\t\t\t.eq(\"company_id\", companyId);\n\n\t\tif (query) queryBuilder = queryBuilder.or(`address.ilike.%${query}%,name.ilike.%${query}%`);\n\t\tif (customerId) queryBuilder = queryBuilder.eq(\"customer_id\", customerId);\n\t\tif (propertyType) queryBuilder = queryBuilder.eq(\"property_type\", propertyType);\n\n\t\tconst { data, error } = await queryBuilder.limit(limit);\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, properties: data, count: data?.length || 0 };\n\t},\n});\n\nexport const getPropertyDetailsTool = tool({\n\tdescription: \"Get detailed property information including equipment and service history\",\n\tparameters: z.object({\n\t\tpropertyId: z.string().uuid().describe(\"Property ID\"),\n\t}),\n\texecute: async ({ propertyId }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst [propertyResult, equipmentResult, jobsResult] = await Promise.all([\n\t\t\tsupabase\n\t\t\t\t.from(\"properties\")\n\t\t\t\t.select(\"*, customer:customers(display_name, phone, email)\")\n\t\t\t\t.eq(\"id\", propertyId)\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.single(),\n\t\t\tsupabase\n\t\t\t\t.from(\"equipment\")\n\t\t\t\t.select(\"id, name, model, serial_number, install_date, warranty_expiry, last_service_date\")\n\t\t\t\t.eq(\"property_id\", propertyId)\n\t\t\t\t.limit(20),\n\t\t\tsupabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\"id, title, status, scheduled_start, completed_at\")\n\t\t\t\t.eq(\"property_id\", propertyId)\n\t\t\t\t.order(\"scheduled_start\", { ascending: false })\n\t\t\t\t.limit(10),\n\t\t]);\n\n\t\tif (propertyResult.error) return { success: false, error: propertyResult.error.message };\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tproperty: propertyResult.data,\n\t\t\tequipment: equipmentResult.data || [],\n\t\t\tserviceHistory: jobsResult.data || [],\n\t\t};\n\t},\n});\n\nexport const searchEquipmentTool = tool({\n\tdescription: \"Search for equipment/assets by type, customer, or model\",\n\tparameters: z.object({\n\t\tquery: z.string().optional().describe(\"Equipment name, model, or serial number\"),\n\t\tcustomerId: z.string().uuid().optional(),\n\t\tequipmentType: z.string().optional().describe(\"Equipment type (HVAC, plumbing, electrical, etc.)\"),\n\t\tlimit: z.number().optional().default(20),\n\t}),\n\texecute: async ({ query, customerId, equipmentType, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tlet queryBuilder = supabase\n\t\t\t.from(\"equipment\")\n\t\t\t.select(\"id, name, model, serial_number, equipment_type, install_date, warranty_expiry, last_service_date, property:properties(address, customer:customers(display_name))\")\n\t\t\t.eq(\"company_id\", companyId);\n\n\t\tif (query) queryBuilder = queryBuilder.or(`name.ilike.%${query}%,model.ilike.%${query}%,serial_number.ilike.%${query}%`);\n\t\tif (equipmentType) queryBuilder = queryBuilder.eq(\"equipment_type\", equipmentType);\n\n\t\tconst { data, error } = await queryBuilder.limit(limit);\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, equipment: data, count: data?.length || 0 };\n\t},\n});\n\nexport const getMaintenanceDueTool = tool({\n\tdescription: \"Get equipment that is due or overdue for maintenance service\",\n\tparameters: z.object({\n\t\tdaysAhead: z.number().optional().default(30).describe(\"Look ahead days for upcoming maintenance\"),\n\t}),\n\texecute: async ({ daysAhead }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tconst futureDate = new Date(Date.now() + daysAhead * 24 * 60 * 60 * 1000);\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"equipment\")\n\t\t\t.select(\"id, name, model, last_service_date, next_service_date, property:properties(address, customer:customers(display_name, phone, email))\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.lte(\"next_service_date\", futureDate.toISOString())\n\t\t\t.order(\"next_service_date\", { ascending: true })\n\t\t\t.limit(50);\n\n\t\tif (error) return { success: false, error: error.message };\n\n\t\tconst overdue = data?.filter((e) => new Date(e.next_service_date) < new Date()) || [];\n\t\tconst upcoming = data?.filter((e) => new Date(e.next_service_date) >= new Date()) || [];\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\toverdue,\n\t\t\tupcoming,\n\t\t\toverdueCount: overdue.length,\n\t\t\tupcomingCount: upcoming.length,\n\t\t};\n\t},\n});\n\n// ============================================================================\n// JOB/SCHEDULING TOOLS\n// ============================================================================\n\nexport const searchJobsTool = tool({\n\tdescription: \"Search for jobs by title, job number, description, or status using full-text search with relevance ranking. Supports multi-word queries and typo tolerance.\",\n\tparameters: z.object({\n\t\tquery: z.string().optional().describe(\"Search query - searches job number, title, description\"),\n\t\tstatus: z.enum([\"pending\", \"scheduled\", \"in_progress\", \"completed\", \"cancelled\"]).optional(),\n\t\tcustomerId: z.string().uuid().optional(),\n\t\tlimit: z.number().optional().default(10),\n\t}),\n\texecute: async ({ query, status, customerId, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\t// Use full-text search if there's a query\n\t\tif (query && !status && !customerId) {\n\t\t\tconst jobs = await searchJobsFullText(supabase, companyId, query, { limit });\n\t\t\treturn { success: true, jobs, count: jobs.length };\n\t\t}\n\n\t\t// Fall back to filtered query when status/customerId filters are used\n\t\tlet queryBuilder = supabase\n\t\t\t.from(\"jobs\")\n\t\t\t.select(\"id, job_number, title, status, total_amount, scheduled_start, scheduled_end, customer:customers(display_name, phone)\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.is(\"deleted_at\", null);\n\n\t\tif (query) queryBuilder = queryBuilder.or(`title.ilike.%${query}%,job_number.ilike.%${query}%`);\n\t\tif (status) queryBuilder = queryBuilder.eq(\"status\", status);\n\t\tif (customerId) queryBuilder = queryBuilder.eq(\"customer_id\", customerId);\n\n\t\tconst { data, error } = await queryBuilder.order(\"scheduled_start\", { ascending: false }).limit(limit);\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, jobs: data, count: data?.length || 0 };\n\t},\n});\n\nexport const createAppointmentTool = tool({\n\tdescription: \"Schedule a new appointment for a customer. Use this to book service calls or consultations.\",\n\tparameters: z.object({\n\t\tcustomerId: z.string().uuid().describe(\"Customer to schedule for\"),\n\t\tpropertyId: z.string().uuid().describe(\"Property where service will be performed\"),\n\t\ttitle: z.string().describe(\"Appointment title/description\"),\n\t\tstartTime: z.string().describe(\"Start time in ISO format (YYYY-MM-DDTHH:mm:ss)\"),\n\t\tduration: z.number().describe(\"Duration in minutes\"),\n\t\ttype: z.enum([\"service\", \"consultation\", \"estimate\", \"follow_up\"]).default(\"service\"),\n\t\tnotes: z.string().optional().describe(\"Additional notes for the technician\"),\n\t}),\n\texecute: async (params, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tconst startDate = new Date(params.startTime);\n\t\tconst endDate = new Date(startDate.getTime() + params.duration * 60000);\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"appointments\")\n\t\t\t.insert({\n\t\t\t\tcompany_id: companyId,\n\t\t\t\tcustomer_id: params.customerId,\n\t\t\t\tproperty_id: params.propertyId,\n\t\t\t\ttitle: params.title,\n\t\t\t\tstart_time: startDate.toISOString(),\n\t\t\t\tend_time: endDate.toISOString(),\n\t\t\t\tduration: params.duration,\n\t\t\t\ttype: params.type,\n\t\t\t\tnotes: params.notes,\n\t\t\t\tstatus: \"scheduled\",\n\t\t\t})\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, appointment: data, message: `Scheduled appointment for ${startDate.toLocaleString()}` };\n\t},\n});\n\nexport const getAvailableSlotsTool = tool({\n\tdescription: \"Find available appointment slots for scheduling. Returns available time windows.\",\n\tparameters: z.object({\n\t\tdate: z.string().describe(\"Date to check (YYYY-MM-DD)\"),\n\t\tduration: z.number().default(60).describe(\"Required duration in minutes\"),\n\t}),\n\texecute: async ({ date, duration }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tconst targetDate = new Date(date);\n\t\tconst dayStart = new Date(targetDate.setHours(8, 0, 0, 0));\n\t\tconst dayEnd = new Date(targetDate.setHours(18, 0, 0, 0));\n\n\t\t// Get existing appointments for that day\n\t\tconst { data: appointments } = await supabase\n\t\t\t.from(\"appointments\")\n\t\t\t.select(\"start_time, end_time\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.gte(\"start_time\", dayStart.toISOString())\n\t\t\t.lte(\"start_time\", dayEnd.toISOString())\n\t\t\t.neq(\"status\", \"cancelled\");\n\n\t\t// Calculate available slots (simplified)\n\t\tconst availableSlots = [];\n\t\tlet currentTime = dayStart;\n\n\t\twhile (currentTime < dayEnd) {\n\t\t\tconst slotEnd = new Date(currentTime.getTime() + duration * 60000);\n\t\t\tconst hasConflict = appointments?.some((apt) => {\n\t\t\t\tconst aptStart = new Date(apt.start_time);\n\t\t\t\tconst aptEnd = new Date(apt.end_time);\n\t\t\t\treturn currentTime < aptEnd && slotEnd > aptStart;\n\t\t\t});\n\n\t\t\tif (!hasConflict && slotEnd <= dayEnd) {\n\t\t\t\tavailableSlots.push({\n\t\t\t\t\tstart: currentTime.toISOString(),\n\t\t\t\t\tend: slotEnd.toISOString(),\n\t\t\t\t});\n\t\t\t}\n\t\t\tcurrentTime = new Date(currentTime.getTime() + 30 * 60000); // 30-minute increments\n\t\t}\n\n\t\treturn { success: true, availableSlots, date };\n\t},\n});\n\n// ============================================================================\n// INVOICE/FINANCIAL TOOLS\n// ============================================================================\n\nexport const searchInvoicesTool = tool({\n\tdescription: \"Search for invoices by number, customer, or status\",\n\tparameters: z.object({\n\t\tquery: z.string().optional(),\n\t\tstatus: z.enum([\"draft\", \"sent\", \"viewed\", \"paid\", \"overdue\", \"cancelled\"]).optional(),\n\t\tcustomerId: z.string().uuid().optional(),\n\t\tlimit: z.number().optional().default(10),\n\t}),\n\texecute: async ({ query, status, customerId, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tlet queryBuilder = supabase\n\t\t\t.from(\"invoices\")\n\t\t\t.select(\"id, invoice_number, title, status, total_amount, balance_amount, due_date, customer:customers(display_name)\")\n\t\t\t.eq(\"company_id\", companyId);\n\n\t\tif (query) queryBuilder = queryBuilder.ilike(\"invoice_number\", `%${query}%`);\n\t\tif (status) queryBuilder = queryBuilder.eq(\"status\", status);\n\t\tif (customerId) queryBuilder = queryBuilder.eq(\"customer_id\", customerId);\n\n\t\tconst { data, error } = await queryBuilder.order(\"created_at\", { ascending: false }).limit(limit);\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, invoices: data, count: data?.length || 0 };\n\t},\n});\n\nexport const createInvoiceTool = tool({\n\tdescription: \"Create a new invoice for a customer\",\n\tparameters: z.object({\n\t\tcustomerId: z.string().uuid().describe(\"Customer to invoice\"),\n\t\ttitle: z.string().describe(\"Invoice title/description\"),\n\t\tlineItems: z.array(z.object({\n\t\t\tdescription: z.string(),\n\t\t\tquantity: z.number(),\n\t\t\tunitPrice: z.number().describe(\"Price in cents\"),\n\t\t})).describe(\"Line items for the invoice\"),\n\t\tdueDate: z.string().optional().describe(\"Due date (YYYY-MM-DD)\"),\n\t\tnotes: z.string().optional(),\n\t}),\n\texecute: async (params, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\t// Calculate totals\n\t\tconst subtotal = params.lineItems.reduce((sum, item) => sum + item.quantity * item.unitPrice, 0);\n\t\tconst taxAmount = Math.round(subtotal * 0.08); // 8% tax example\n\t\tconst totalAmount = subtotal + taxAmount;\n\n\t\t// Generate invoice number\n\t\tconst invoiceNumber = `INV-${Date.now().toString(36).toUpperCase()}`;\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"invoices\")\n\t\t\t.insert({\n\t\t\t\tcompany_id: companyId,\n\t\t\t\tcustomer_id: params.customerId,\n\t\t\t\tinvoice_number: invoiceNumber,\n\t\t\t\ttitle: params.title,\n\t\t\t\tline_items: params.lineItems,\n\t\t\t\tsubtotal,\n\t\t\t\ttax_amount: taxAmount,\n\t\t\t\ttotal_amount: totalAmount,\n\t\t\t\tbalance_amount: totalAmount,\n\t\t\t\tdue_date: params.dueDate ? new Date(params.dueDate).toISOString() : null,\n\t\t\t\tnotes: params.notes,\n\t\t\t\tstatus: \"draft\",\n\t\t\t})\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tinvoice: data,\n\t\t\tmessage: `Created invoice ${invoiceNumber} for $${(totalAmount / 100).toFixed(2)}`,\n\t\t};\n\t},\n});\n\nexport const getFinancialSummaryTool = tool({\n\tdescription: \"Get a financial summary including revenue, outstanding balances, and trends. Use this to provide business advice.\",\n\tparameters: z.object({\n\t\tperiod: z.enum([\"today\", \"week\", \"month\", \"quarter\", \"year\"]).default(\"month\"),\n\t}),\n\texecute: async ({ period }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst now = new Date();\n\t\tlet startDate: Date;\n\n\t\tswitch (period) {\n\t\t\tcase \"today\":\n\t\t\t\tstartDate = new Date(now.setHours(0, 0, 0, 0));\n\t\t\t\tbreak;\n\t\t\tcase \"week\":\n\t\t\t\tstartDate = new Date(now.setDate(now.getDate() - 7));\n\t\t\t\tbreak;\n\t\t\tcase \"month\":\n\t\t\t\tstartDate = new Date(now.setMonth(now.getMonth() - 1));\n\t\t\t\tbreak;\n\t\t\tcase \"quarter\":\n\t\t\t\tstartDate = new Date(now.setMonth(now.getMonth() - 3));\n\t\t\t\tbreak;\n\t\t\tcase \"year\":\n\t\t\t\tstartDate = new Date(now.setFullYear(now.getFullYear() - 1));\n\t\t\t\tbreak;\n\t\t}\n\n\t\tconst [invoicesResult, paymentsResult, overdueResult] = await Promise.all([\n\t\t\tsupabase\n\t\t\t\t.from(\"invoices\")\n\t\t\t\t.select(\"total_amount, paid_amount, balance_amount, status\")\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.gte(\"created_at\", startDate.toISOString()),\n\t\t\tsupabase\n\t\t\t\t.from(\"payments\")\n\t\t\t\t.select(\"amount\")\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.eq(\"status\", \"completed\")\n\t\t\t\t.gte(\"created_at\", startDate.toISOString()),\n\t\t\tsupabase\n\t\t\t\t.from(\"invoices\")\n\t\t\t\t.select(\"id, invoice_number, balance_amount, due_date, customer:customers(display_name)\")\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.eq(\"status\", \"sent\")\n\t\t\t\t.lt(\"due_date\", new Date().toISOString())\n\t\t\t\t.gt(\"balance_amount\", 0),\n\t\t]);\n\n\t\tconst totalInvoiced = invoicesResult.data?.reduce((sum, inv) => sum + inv.total_amount, 0) || 0;\n\t\tconst totalCollected = paymentsResult.data?.reduce((sum, pay) => sum + pay.amount, 0) || 0;\n\t\tconst totalOutstanding = invoicesResult.data?.reduce((sum, inv) => sum + inv.balance_amount, 0) || 0;\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tperiod,\n\t\t\tsummary: {\n\t\t\t\ttotalInvoiced: totalInvoiced / 100,\n\t\t\t\ttotalCollected: totalCollected / 100,\n\t\t\t\ttotalOutstanding: totalOutstanding / 100,\n\t\t\t\tinvoiceCount: invoicesResult.data?.length || 0,\n\t\t\t\tcollectionRate: totalInvoiced > 0 ? ((totalCollected / totalInvoiced) * 100).toFixed(1) : 0,\n\t\t\t},\n\t\t\toverdueInvoices: overdueResult.data || [],\n\t\t};\n\t},\n});\n\nexport const getVirtualBucketsTool = tool({\n\tdescription: \"Get virtual financial buckets for the company. These are savings goals and fund allocations.\",\n\tparameters: z.object({}),\n\texecute: async (_params, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"finance_virtual_buckets\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"is_active\", true);\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, buckets: data };\n\t},\n});\n\nexport const transferToBucketTool = tool({\n\tdescription: \"Transfer funds to a virtual bucket for savings goals. This is for financial planning.\",\n\tparameters: z.object({\n\t\tbucketId: z.string().uuid().describe(\"Target bucket ID\"),\n\t\tamount: z.number().describe(\"Amount to transfer in cents\"),\n\t\tnote: z.string().optional().describe(\"Note for the transfer\"),\n\t}),\n\texecute: async ({ bucketId, amount, note }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\t// Update bucket balance\n\t\tconst { data: bucket, error: fetchError } = await supabase\n\t\t\t.from(\"finance_virtual_buckets\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"id\", bucketId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (fetchError || !bucket) return { success: false, error: \"Bucket not found\" };\n\n\t\tconst newBalance = (bucket.current_balance || 0) + amount;\n\t\tconst { error: updateError } = await supabase\n\t\t\t.from(\"finance_virtual_buckets\")\n\t\t\t.update({\n\t\t\t\tcurrent_balance: newBalance,\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", bucketId);\n\n\t\tif (updateError) return { success: false, error: updateError.message };\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tmessage: `Transferred $${(amount / 100).toFixed(2)} to ${bucket.name}. New balance: $${(newBalance / 100).toFixed(2)}`,\n\t\t\tbucket: { ...bucket, current_balance: newBalance },\n\t\t};\n\t},\n});\n\n// ============================================================================\n// COMMUNICATION TOOLS\n// ============================================================================\n\nexport const sendEmailTool = tool({\n\tdescription: \"Send an email to a customer. Use this for follow-ups, reminders, or responding to inquiries.\",\n\tparameters: z.object({\n\t\tto: z.string().email().describe(\"Recipient email address\"),\n\t\tsubject: z.string().describe(\"Email subject line\"),\n\t\tbody: z.string().describe(\"Email body content (HTML supported)\"),\n\t\tcustomerId: z.string().uuid().optional().describe(\"Associated customer ID for tracking\"),\n\t}),\n\texecute: async (params, { companyId }: { companyId: string }) => {\n\t\t// Import Resend dynamically to avoid issues\n\t\tconst { resend } = await import(\"@/lib/email/resend-client\");\n\n\t\tif (!resend) {\n\t\t\treturn { success: false, error: \"Email service not configured\" };\n\t\t}\n\n\t\tconst { data, error } = await resend.emails.send({\n\t\t\tfrom: process.env.RESEND_FROM_EMAIL || \"noreply@thorbis.com\",\n\t\t\tto: params.to,\n\t\t\tsubject: params.subject,\n\t\t\thtml: params.body,\n\t\t});\n\n\t\tif (error) return { success: false, error: error.message };\n\n\t\t// Log communication\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tawait supabase.from(\"communications\").insert({\n\t\t\tcompany_id: companyId,\n\t\t\tcustomer_id: params.customerId,\n\t\t\ttype: \"email\",\n\t\t\tdirection: \"outbound\",\n\t\t\tto_address: params.to,\n\t\t\tsubject: params.subject,\n\t\t\tbody: params.body,\n\t\t\tbody_html: params.body,\n\t\t\tstatus: \"sent\",\n\t\t\tsent_at: new Date().toISOString(),\n\t\t\tprovider_message_id: data?.id,\n\t\t});\n\n\t\treturn { success: true, messageId: data?.id, message: `Email sent to ${params.to}` };\n\t},\n});\n\nexport const sendSmsTool = tool({\n\tdescription: \"Send an SMS text message to a customer. Use for appointment reminders or quick updates.\",\n\tparameters: z.object({\n\t\tto: z.string().describe(\"Phone number (format: +1XXXXXXXXXX)\"),\n\t\tmessage: z.string().max(160).describe(\"Message content (max 160 characters)\"),\n\t\tcustomerId: z.string().uuid().optional().describe(\"Associated customer ID\"),\n\t}),\n\texecute: async (params, { companyId }: { companyId: string }) => {\n\t\t// Get company phone number\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tconst { data: phoneNumber } = await supabase\n\t\t\t.from(\"phone_numbers\")\n\t\t\t.select(\"phone_number, telnyx_connection_id\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"is_primary\", true)\n\t\t\t.single();\n\n\t\tif (!phoneNumber) {\n\t\t\treturn { success: false, error: \"No phone number configured for company\" };\n\t\t}\n\n\t\t// Send via Telnyx\n\t\tconst { sendSMS } = await import(\"@/lib/telnyx/messaging\");\n\t\tconst result = await sendSMS({\n\t\t\tfrom: phoneNumber.phone_number,\n\t\t\tto: params.to,\n\t\t\ttext: params.message,\n\t\t});\n\n\t\tif (!result.success) return { success: false, error: result.error };\n\n\t\t// Log communication\n\t\tawait supabase.from(\"communications\").insert({\n\t\t\tcompany_id: companyId,\n\t\t\tcustomer_id: params.customerId,\n\t\t\ttype: \"sms\",\n\t\t\tdirection: \"outbound\",\n\t\t\tto_address: params.to,\n\t\t\tbody: params.message,\n\t\t\tstatus: \"sent\",\n\t\t\tsent_at: new Date().toISOString(),\n\t\t\ttelnyx_message_id: result.messageId,\n\t\t});\n\n\t\treturn { success: true, messageId: result.messageId, message: `SMS sent to ${params.to}` };\n\t},\n});\n\nexport const initiateCallTool = tool({\n\tdescription: \"Initiate a phone call to a customer. The call will be connected through the business phone system.\",\n\tparameters: z.object({\n\t\tto: z.string().describe(\"Phone number to call (format: +1XXXXXXXXXX)\"),\n\t\tcustomerId: z.string().uuid().optional().describe(\"Associated customer ID\"),\n\t\treason: z.string().optional().describe(\"Reason for the call (for logging)\"),\n\t}),\n\texecute: async (params, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\t// Get company phone configuration\n\t\tconst { data: phoneNumber } = await supabase\n\t\t\t.from(\"phone_numbers\")\n\t\t\t.select(\"phone_number, telnyx_connection_id\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"is_primary\", true)\n\t\t\t.single();\n\n\t\tif (!phoneNumber) {\n\t\t\treturn { success: false, error: \"No phone number configured\" };\n\t\t}\n\n\t\t// Initiate call via Telnyx\n\t\tconst { initiateCall } = await import(\"@/lib/telnyx/calls\");\n\t\tconst result = await initiateCall({\n\t\t\tconnectionId: phoneNumber.telnyx_connection_id,\n\t\t\tfrom: phoneNumber.phone_number,\n\t\t\tto: params.to,\n\t\t});\n\n\t\tif (!result.success) return { success: false, error: result.error };\n\n\t\t// Log communication\n\t\tawait supabase.from(\"communications\").insert({\n\t\t\tcompany_id: companyId,\n\t\t\tcustomer_id: params.customerId,\n\t\t\ttype: \"call\",\n\t\t\tdirection: \"outbound\",\n\t\t\tto_address: params.to,\n\t\t\tfrom_address: phoneNumber.phone_number,\n\t\t\tbody: params.reason || \"Outbound call\",\n\t\t\tstatus: \"pending\",\n\t\t\ttelnyx_call_control_id: result.callControlId,\n\t\t});\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tcallControlId: result.callControlId,\n\t\t\tmessage: `Call initiated to ${params.to}`,\n\t\t};\n\t},\n});\n\nexport const getCommunicationHistoryTool = tool({\n\tdescription: \"Get communication history with a customer (calls, texts, emails)\",\n\tparameters: z.object({\n\t\tcustomerId: z.string().uuid().describe(\"Customer ID to get history for\"),\n\t\ttype: z.enum([\"all\", \"email\", \"sms\", \"call\"]).optional().default(\"all\"),\n\t\tlimit: z.number().optional().default(20),\n\t}),\n\texecute: async ({ customerId, type, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tlet queryBuilder = supabase\n\t\t\t.from(\"communications\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"customer_id\", customerId);\n\n\t\tif (type !== \"all\") queryBuilder = queryBuilder.eq(\"type\", type);\n\n\t\tconst { data, error } = await queryBuilder\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(limit);\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, communications: data };\n\t},\n});\n\n// ============================================================================\n// REPORTING/ANALYTICS TOOLS\n// ============================================================================\n\nexport const getDashboardMetricsTool = tool({\n\tdescription: \"Get key business metrics for the dashboard. Use this to provide business insights and recommendations.\",\n\tparameters: z.object({}),\n\texecute: async (_params, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tconst now = new Date();\n\t\tconst thirtyDaysAgo = new Date(now.setDate(now.getDate() - 30));\n\n\t\tconst [customersResult, jobsResult, invoicesResult] = await Promise.all([\n\t\t\tsupabase\n\t\t\t\t.from(\"customers\")\n\t\t\t\t.select(\"id\", { count: \"exact\", head: true })\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.eq(\"status\", \"active\"),\n\t\t\tsupabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\"id, status, total_amount\")\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.gte(\"created_at\", thirtyDaysAgo.toISOString()),\n\t\t\tsupabase\n\t\t\t\t.from(\"invoices\")\n\t\t\t\t.select(\"id, total_amount, balance_amount, status\")\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.gte(\"created_at\", thirtyDaysAgo.toISOString()),\n\t\t]);\n\n\t\tconst completedJobs = jobsResult.data?.filter((j) => j.status === \"completed\") || [];\n\t\tconst overdueInvoices = invoicesResult.data?.filter((i) => i.status === \"sent\" && i.balance_amount > 0) || [];\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tmetrics: {\n\t\t\t\tactiveCustomers: customersResult.count || 0,\n\t\t\t\tjobsLast30Days: jobsResult.data?.length || 0,\n\t\t\t\tcompletedJobsLast30Days: completedJobs.length,\n\t\t\t\tjobCompletionRate: jobsResult.data?.length\n\t\t\t\t\t? ((completedJobs.length / jobsResult.data.length) * 100).toFixed(1)\n\t\t\t\t\t: 0,\n\t\t\t\tinvoicesLast30Days: invoicesResult.data?.length || 0,\n\t\t\t\toverdueInvoiceCount: overdueInvoices.length,\n\t\t\t\ttotalOutstanding: overdueInvoices.reduce((sum, i) => sum + i.balance_amount, 0) / 100,\n\t\t\t},\n\t\t};\n\t},\n});\n\nexport const getProactiveInsightsTool = tool({\n\tdescription: \"Get proactive business insights and recommendations. Use this to help owners make decisions.\",\n\tparameters: z.object({}),\n\texecute: async (_params, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\t// Get various insights\n\t\tconst [overdueResult, inactiveCustomersResult, upcomingAppointmentsResult] = await Promise.all([\n\t\t\t// Overdue invoices\n\t\t\tsupabase\n\t\t\t\t.from(\"invoices\")\n\t\t\t\t.select(\"id, invoice_number, balance_amount, due_date, customer:customers(display_name, phone, email)\")\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.eq(\"status\", \"sent\")\n\t\t\t\t.lt(\"due_date\", new Date().toISOString())\n\t\t\t\t.gt(\"balance_amount\", 0)\n\t\t\t\t.limit(5),\n\t\t\t// Customers inactive for 90+ days\n\t\t\tsupabase\n\t\t\t\t.from(\"customers\")\n\t\t\t\t.select(\"id, display_name, phone, email, last_job_date\")\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.eq(\"status\", \"active\")\n\t\t\t\t.lt(\"last_job_date\", new Date(Date.now() - 90 * 24 * 60 * 60 * 1000).toISOString())\n\t\t\t\t.limit(5),\n\t\t\t// Tomorrow's appointments\n\t\t\tsupabase\n\t\t\t\t.from(\"appointments\")\n\t\t\t\t.select(\"id, title, start_time, customer:customers(display_name, phone)\")\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.eq(\"status\", \"scheduled\")\n\t\t\t\t.gte(\"start_time\", new Date().toISOString())\n\t\t\t\t.lt(\"start_time\", new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString())\n\t\t\t\t.limit(10),\n\t\t]);\n\n\t\tconst insights = [];\n\n\t\tif (overdueResult.data && overdueResult.data.length > 0) {\n\t\t\tconst totalOverdue = overdueResult.data.reduce((sum, inv) => sum + inv.balance_amount, 0);\n\t\t\tinsights.push({\n\t\t\t\ttype: \"overdue_invoices\",\n\t\t\t\tseverity: \"high\",\n\t\t\t\ttitle: `${overdueResult.data.length} overdue invoices totaling $${(totalOverdue / 100).toFixed(2)}`,\n\t\t\t\trecommendation: \"Consider sending payment reminders or initiating collection calls\",\n\t\t\t\tdata: overdueResult.data,\n\t\t\t});\n\t\t}\n\n\t\tif (inactiveCustomersResult.data && inactiveCustomersResult.data.length > 0) {\n\t\t\tinsights.push({\n\t\t\t\ttype: \"inactive_customers\",\n\t\t\t\tseverity: \"medium\",\n\t\t\t\ttitle: `${inactiveCustomersResult.data.length} customers haven't had service in 90+ days`,\n\t\t\t\trecommendation: \"Send re-engagement emails or offer maintenance service promotions\",\n\t\t\t\tdata: inactiveCustomersResult.data,\n\t\t\t});\n\t\t}\n\n\t\tif (upcomingAppointmentsResult.data && upcomingAppointmentsResult.data.length > 0) {\n\t\t\tinsights.push({\n\t\t\t\ttype: \"upcoming_appointments\",\n\t\t\t\tseverity: \"info\",\n\t\t\t\ttitle: `${upcomingAppointmentsResult.data.length} appointments scheduled for tomorrow`,\n\t\t\t\trecommendation: \"Consider sending reminder messages to customers\",\n\t\t\t\tdata: upcomingAppointmentsResult.data,\n\t\t\t});\n\t\t}\n\n\t\treturn { success: true, insights };\n\t},\n});\n\n// ============================================================================\n// REMINDER/NOTIFICATION TOOLS\n// ============================================================================\n\nexport const scheduleReminderTool = tool({\n\tdescription: \"Schedule a reminder email or SMS to be sent at a specific time. Use for appointment reminders, payment reminders, or follow-ups.\",\n\tparameters: z.object({\n\t\trecipientType: z.enum([\"customer\", \"team_member\", \"vendor\"]).describe(\"Type of recipient\"),\n\t\trecipientId: z.string().uuid().describe(\"ID of the recipient\"),\n\t\tchannel: z.enum([\"email\", \"sms\", \"both\"]).describe(\"Communication channel\"),\n\t\tsubject: z.string().optional().describe(\"Email subject (for email channel)\"),\n\t\tmessage: z.string().describe(\"Message content\"),\n\t\tsendAt: z.string().describe(\"When to send (ISO format)\"),\n\t\trelatedTo: z.object({\n\t\t\ttype: z.enum([\"job\", \"invoice\", \"appointment\", \"estimate\"]).optional(),\n\t\t\tid: z.string().uuid().optional(),\n\t\t}).optional().describe(\"Related entity\"),\n\t}),\n\texecute: async (params, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\t// Get recipient details based on type\n\t\tlet recipientEmail: string | null = null;\n\t\tlet recipientPhone: string | null = null;\n\t\tlet recipientName = \"\";\n\n\t\tif (params.recipientType === \"customer\") {\n\t\t\tconst { data } = await supabase\n\t\t\t\t.from(\"customers\")\n\t\t\t\t.select(\"email, phone, display_name\")\n\t\t\t\t.eq(\"id\", params.recipientId)\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.single();\n\t\t\tif (data) {\n\t\t\t\trecipientEmail = data.email;\n\t\t\t\trecipientPhone = data.phone;\n\t\t\t\trecipientName = data.display_name;\n\t\t\t}\n\t\t} else if (params.recipientType === \"team_member\") {\n\t\t\tconst { data } = await supabase\n\t\t\t\t.from(\"team_members\")\n\t\t\t\t.select(\"email, phone, first_name, last_name\")\n\t\t\t\t.eq(\"id\", params.recipientId)\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.single();\n\t\t\tif (data) {\n\t\t\t\trecipientEmail = data.email;\n\t\t\t\trecipientPhone = data.phone;\n\t\t\t\trecipientName = `${data.first_name} ${data.last_name}`;\n\t\t\t}\n\t\t} else if (params.recipientType === \"vendor\") {\n\t\t\tconst { data } = await supabase\n\t\t\t\t.from(\"vendors\")\n\t\t\t\t.select(\"email, phone, name\")\n\t\t\t\t.eq(\"id\", params.recipientId)\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.single();\n\t\t\tif (data) {\n\t\t\t\trecipientEmail = data.email;\n\t\t\t\trecipientPhone = data.phone;\n\t\t\t\trecipientName = data.name;\n\t\t\t}\n\t\t}\n\n\t\tif (!recipientEmail && !recipientPhone) {\n\t\t\treturn { success: false, error: \"Recipient contact information not found\" };\n\t\t}\n\n\t\t// Create scheduled notification\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"scheduled_notifications\")\n\t\t\t.insert({\n\t\t\t\tcompany_id: companyId,\n\t\t\t\trecipient_type: params.recipientType,\n\t\t\t\trecipient_id: params.recipientId,\n\t\t\t\trecipient_name: recipientName,\n\t\t\t\trecipient_email: recipientEmail,\n\t\t\t\trecipient_phone: recipientPhone,\n\t\t\t\tchannel: params.channel,\n\t\t\t\tsubject: params.subject,\n\t\t\t\tmessage: params.message,\n\t\t\t\tscheduled_at: params.sendAt,\n\t\t\t\trelated_type: params.relatedTo?.type,\n\t\t\t\trelated_id: params.relatedTo?.id,\n\t\t\t\tstatus: \"scheduled\",\n\t\t\t})\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) return { success: false, error: error.message };\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\treminder: data,\n\t\t\tmessage: `Reminder scheduled for ${recipientName} at ${new Date(params.sendAt).toLocaleString()}`,\n\t\t};\n\t},\n});\n\nexport const cancelReminderTool = tool({\n\tdescription: \"Cancel a scheduled reminder\",\n\tparameters: z.object({\n\t\treminderId: z.string().uuid().describe(\"ID of the reminder to cancel\"),\n\t}),\n\texecute: async ({ reminderId }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"scheduled_notifications\")\n\t\t\t.update({ status: \"cancelled\" })\n\t\t\t.eq(\"id\", reminderId)\n\t\t\t.eq(\"company_id\", companyId);\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, message: \"Reminder cancelled successfully\" };\n\t},\n});\n\nexport const getScheduledRemindersTool = tool({\n\tdescription: \"Get list of scheduled reminders for a customer, job, or entity\",\n\tparameters: z.object({\n\t\trecipientType: z.enum([\"customer\", \"team_member\", \"vendor\"]).optional(),\n\t\trecipientId: z.string().uuid().optional(),\n\t\trelatedType: z.enum([\"job\", \"invoice\", \"appointment\", \"estimate\"]).optional(),\n\t\trelatedId: z.string().uuid().optional(),\n\t\tstatus: z.enum([\"scheduled\", \"sent\", \"cancelled\", \"failed\"]).optional().default(\"scheduled\"),\n\t}),\n\texecute: async (params, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tlet queryBuilder = supabase\n\t\t\t.from(\"scheduled_notifications\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"company_id\", companyId);\n\n\t\tif (params.recipientType) queryBuilder = queryBuilder.eq(\"recipient_type\", params.recipientType);\n\t\tif (params.recipientId) queryBuilder = queryBuilder.eq(\"recipient_id\", params.recipientId);\n\t\tif (params.relatedType) queryBuilder = queryBuilder.eq(\"related_type\", params.relatedType);\n\t\tif (params.relatedId) queryBuilder = queryBuilder.eq(\"related_id\", params.relatedId);\n\t\tif (params.status) queryBuilder = queryBuilder.eq(\"status\", params.status);\n\n\t\tconst { data, error } = await queryBuilder.order(\"scheduled_at\", { ascending: true });\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, reminders: data, count: data?.length || 0 };\n\t},\n});\n\nexport const sendImmediateNotificationTool = tool({\n\tdescription: \"Send an immediate notification to a customer, team member, or vendor. Use for urgent updates.\",\n\tparameters: z.object({\n\t\trecipientType: z.enum([\"customer\", \"team_member\", \"vendor\"]).describe(\"Type of recipient\"),\n\t\trecipientId: z.string().uuid().describe(\"ID of the recipient\"),\n\t\tchannel: z.enum([\"email\", \"sms\", \"both\"]).describe(\"Communication channel\"),\n\t\tsubject: z.string().optional().describe(\"Email subject\"),\n\t\tmessage: z.string().describe(\"Message content\"),\n\t\tpriority: z.enum([\"normal\", \"high\", \"urgent\"]).optional().default(\"normal\"),\n\t}),\n\texecute: async (params, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tconst results: { email?: { success: boolean; messageId?: string; error?: string }; sms?: { success: boolean; messageId?: string; error?: string } } = {};\n\n\t\t// Get recipient details\n\t\tlet recipientEmail: string | null = null;\n\t\tlet recipientPhone: string | null = null;\n\t\tlet recipientName = \"\";\n\n\t\tif (params.recipientType === \"customer\") {\n\t\t\tconst { data } = await supabase.from(\"customers\").select(\"email, phone, display_name\").eq(\"id\", params.recipientId).single();\n\t\t\tif (data) { recipientEmail = data.email; recipientPhone = data.phone; recipientName = data.display_name; }\n\t\t} else if (params.recipientType === \"team_member\") {\n\t\t\tconst { data } = await supabase.from(\"team_members\").select(\"email, phone, first_name, last_name\").eq(\"id\", params.recipientId).single();\n\t\t\tif (data) { recipientEmail = data.email; recipientPhone = data.phone; recipientName = `${data.first_name} ${data.last_name}`; }\n\t\t} else if (params.recipientType === \"vendor\") {\n\t\t\tconst { data } = await supabase.from(\"vendors\").select(\"email, phone, name\").eq(\"id\", params.recipientId).single();\n\t\t\tif (data) { recipientEmail = data.email; recipientPhone = data.phone; recipientName = data.name; }\n\t\t}\n\n\t\t// Send email if requested\n\t\tif ((params.channel === \"email\" || params.channel === \"both\") && recipientEmail) {\n\t\t\tconst { resend } = await import(\"@/lib/email/resend-client\");\n\t\t\tif (resend) {\n\t\t\t\tconst { data, error } = await resend.emails.send({\n\t\t\t\t\tfrom: process.env.RESEND_FROM_EMAIL || \"noreply@thorbis.com\",\n\t\t\t\t\tto: recipientEmail,\n\t\t\t\t\tsubject: params.subject || \"Notification\",\n\t\t\t\t\thtml: params.message,\n\t\t\t\t});\n\t\t\t\tresults.email = error ? { success: false, error: error.message } : { success: true, messageId: data?.id };\n\t\t\t}\n\t\t}\n\n\t\t// Send SMS if requested\n\t\tif ((params.channel === \"sms\" || params.channel === \"both\") && recipientPhone) {\n\t\t\tconst { data: phoneNumber } = await supabase.from(\"phone_numbers\").select(\"phone_number\").eq(\"company_id\", companyId).eq(\"is_primary\", true).single();\n\t\t\tif (phoneNumber) {\n\t\t\t\tconst { sendSMS } = await import(\"@/lib/telnyx/messaging\");\n\t\t\t\tconst result = await sendSMS({ from: phoneNumber.phone_number, to: recipientPhone, text: params.message.slice(0, 160) });\n\t\t\t\tresults.sms = result.success ? { success: true, messageId: result.messageId } : { success: false, error: result.error };\n\t\t\t}\n\t\t}\n\n\t\treturn { success: true, results, message: `Notification sent to ${recipientName}` };\n\t},\n});\n\n// ============================================================================\n// ENHANCED REPORTING TOOLS\n// ============================================================================\n\nexport const getJobCostingReportTool = tool({\n\tdescription: \"Get detailed job costing report including labor, materials, and profit margins\",\n\tparameters: z.object({\n\t\tjobId: z.string().uuid().optional().describe(\"Specific job ID, or omit for summary\"),\n\t\tperiod: z.enum([\"week\", \"month\", \"quarter\", \"year\"]).optional().default(\"month\"),\n\t\tlimit: z.number().optional().default(20),\n\t}),\n\texecute: async ({ jobId, period, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tif (jobId) {\n\t\t\t// Single job costing\n\t\t\tconst { data: job, error } = await supabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\"*, customer:customers(display_name), line_items, labor_cost, material_cost, total_amount\")\n\t\t\t\t.eq(\"id\", jobId)\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.single();\n\n\t\t\tif (error) return { success: false, error: error.message };\n\n\t\t\tconst laborCost = job?.labor_cost || 0;\n\t\t\tconst materialCost = job?.material_cost || 0;\n\t\t\tconst totalRevenue = job?.total_amount || 0;\n\t\t\tconst profit = totalRevenue - laborCost - materialCost;\n\t\t\tconst margin = totalRevenue > 0 ? (profit / totalRevenue) * 100 : 0;\n\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tjob: {\n\t\t\t\t\t...job,\n\t\t\t\t\tcosting: {\n\t\t\t\t\t\tlaborCost: laborCost / 100,\n\t\t\t\t\t\tmaterialCost: materialCost / 100,\n\t\t\t\t\t\ttotalCost: (laborCost + materialCost) / 100,\n\t\t\t\t\t\trevenue: totalRevenue / 100,\n\t\t\t\t\t\tprofit: profit / 100,\n\t\t\t\t\t\tmarginPercent: margin.toFixed(1),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\t// Period summary\n\t\tconst now = new Date();\n\t\tlet startDate: Date;\n\t\tswitch (period) {\n\t\t\tcase \"week\": startDate = new Date(now.setDate(now.getDate() - 7)); break;\n\t\t\tcase \"month\": startDate = new Date(now.setMonth(now.getMonth() - 1)); break;\n\t\t\tcase \"quarter\": startDate = new Date(now.setMonth(now.getMonth() - 3)); break;\n\t\t\tcase \"year\": startDate = new Date(now.setFullYear(now.getFullYear() - 1)); break;\n\t\t}\n\n\t\tconst { data: jobs } = await supabase\n\t\t\t.from(\"jobs\")\n\t\t\t.select(\"id, title, labor_cost, material_cost, total_amount, status, completed_at, customer:customers(display_name)\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"status\", \"completed\")\n\t\t\t.gte(\"completed_at\", startDate.toISOString())\n\t\t\t.order(\"completed_at\", { ascending: false })\n\t\t\t.limit(limit);\n\n\t\tconst summary = {\n\t\t\ttotalJobs: jobs?.length || 0,\n\t\t\ttotalRevenue: (jobs?.reduce((s, j) => s + (j.total_amount || 0), 0) || 0) / 100,\n\t\t\ttotalLaborCost: (jobs?.reduce((s, j) => s + (j.labor_cost || 0), 0) || 0) / 100,\n\t\t\ttotalMaterialCost: (jobs?.reduce((s, j) => s + (j.material_cost || 0), 0) || 0) / 100,\n\t\t\ttotalProfit: 0,\n\t\t\taverageMargin: 0,\n\t\t};\n\t\tsummary.totalProfit = summary.totalRevenue - summary.totalLaborCost - summary.totalMaterialCost;\n\t\tsummary.averageMargin = summary.totalRevenue > 0 ? (summary.totalProfit / summary.totalRevenue) * 100 : 0;\n\n\t\treturn { success: true, period, summary, jobs };\n\t},\n});\n\nexport const getRevenueBreakdownTool = tool({\n\tdescription: \"Get revenue breakdown by customer, service type, or time period\",\n\tparameters: z.object({\n\t\tgroupBy: z.enum([\"customer\", \"service_type\", \"month\", \"week\"]).default(\"month\"),\n\t\tperiod: z.enum([\"month\", \"quarter\", \"year\"]).default(\"quarter\"),\n\t\tlimit: z.number().optional().default(20),\n\t}),\n\texecute: async ({ groupBy, period, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst now = new Date();\n\t\tlet startDate: Date;\n\t\tswitch (period) {\n\t\t\tcase \"month\": startDate = new Date(now.setMonth(now.getMonth() - 1)); break;\n\t\t\tcase \"quarter\": startDate = new Date(now.setMonth(now.getMonth() - 3)); break;\n\t\t\tcase \"year\": startDate = new Date(now.setFullYear(now.getFullYear() - 1)); break;\n\t\t}\n\n\t\tconst { data: invoices } = await supabase\n\t\t\t.from(\"invoices\")\n\t\t\t.select(\"id, total_amount, paid_amount, created_at, customer:customers(id, display_name), job:jobs(service_type)\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"status\", \"paid\")\n\t\t\t.gte(\"created_at\", startDate.toISOString());\n\n\t\t// Group data\n\t\tconst breakdown: Record<string, { label: string; revenue: number; count: number }> = {};\n\n\t\tinvoices?.forEach((inv) => {\n\t\t\tlet key = \"\";\n\t\t\tlet label = \"\";\n\n\t\t\tif (groupBy === \"customer\") {\n\t\t\t\tkey = inv.customer?.id || \"unknown\";\n\t\t\t\tlabel = inv.customer?.display_name || \"Unknown\";\n\t\t\t} else if (groupBy === \"service_type\") {\n\t\t\t\tkey = inv.job?.service_type || \"general\";\n\t\t\t\tlabel = inv.job?.service_type || \"General\";\n\t\t\t} else if (groupBy === \"month\") {\n\t\t\t\tconst date = new Date(inv.created_at);\n\t\t\t\tkey = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, \"0\")}`;\n\t\t\t\tlabel = date.toLocaleDateString(\"en-US\", { year: \"numeric\", month: \"short\" });\n\t\t\t} else if (groupBy === \"week\") {\n\t\t\t\tconst date = new Date(inv.created_at);\n\t\t\t\tconst weekStart = new Date(date.setDate(date.getDate() - date.getDay()));\n\t\t\t\tkey = weekStart.toISOString().split(\"T\")[0];\n\t\t\t\tlabel = `Week of ${weekStart.toLocaleDateString()}`;\n\t\t\t}\n\n\t\t\tif (!breakdown[key]) breakdown[key] = { label, revenue: 0, count: 0 };\n\t\t\tbreakdown[key].revenue += (inv.paid_amount || 0) / 100;\n\t\t\tbreakdown[key].count += 1;\n\t\t});\n\n\t\tconst results = Object.values(breakdown).sort((a, b) => b.revenue - a.revenue).slice(0, limit);\n\t\tconst totalRevenue = results.reduce((s, r) => s + r.revenue, 0);\n\n\t\treturn { success: true, groupBy, period, breakdown: results, totalRevenue };\n\t},\n});\n\nexport const getARAgingReportTool = tool({\n\tdescription: \"Get accounts receivable aging report showing outstanding invoices by age (30/60/90+ days)\",\n\tparameters: z.object({}),\n\texecute: async (_params, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tconst now = new Date();\n\n\t\tconst { data: invoices } = await supabase\n\t\t\t.from(\"invoices\")\n\t\t\t.select(\"id, invoice_number, balance_amount, due_date, created_at, customer:customers(display_name, phone, email)\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.in(\"status\", [\"sent\", \"viewed\"])\n\t\t\t.gt(\"balance_amount\", 0);\n\n\t\tconst aging = {\n\t\t\tcurrent: { amount: 0, count: 0, invoices: [] as typeof invoices },\n\t\t\tdays30: { amount: 0, count: 0, invoices: [] as typeof invoices },\n\t\t\tdays60: { amount: 0, count: 0, invoices: [] as typeof invoices },\n\t\t\tdays90Plus: { amount: 0, count: 0, invoices: [] as typeof invoices },\n\t\t};\n\n\t\tinvoices?.forEach((inv) => {\n\t\t\tconst dueDate = new Date(inv.due_date);\n\t\t\tconst daysOverdue = Math.floor((now.getTime() - dueDate.getTime()) / (1000 * 60 * 60 * 24));\n\n\t\t\tif (daysOverdue <= 0) {\n\t\t\t\taging.current.amount += inv.balance_amount;\n\t\t\t\taging.current.count += 1;\n\t\t\t\taging.current.invoices?.push(inv);\n\t\t\t} else if (daysOverdue <= 30) {\n\t\t\t\taging.days30.amount += inv.balance_amount;\n\t\t\t\taging.days30.count += 1;\n\t\t\t\taging.days30.invoices?.push(inv);\n\t\t\t} else if (daysOverdue <= 60) {\n\t\t\t\taging.days60.amount += inv.balance_amount;\n\t\t\t\taging.days60.count += 1;\n\t\t\t\taging.days60.invoices?.push(inv);\n\t\t\t} else {\n\t\t\t\taging.days90Plus.amount += inv.balance_amount;\n\t\t\t\taging.days90Plus.count += 1;\n\t\t\t\taging.days90Plus.invoices?.push(inv);\n\t\t\t}\n\t\t});\n\n\t\t// Convert to dollars\n\t\tObject.keys(aging).forEach((key) => {\n\t\t\taging[key as keyof typeof aging].amount = aging[key as keyof typeof aging].amount / 100;\n\t\t});\n\n\t\tconst totalOutstanding = aging.current.amount + aging.days30.amount + aging.days60.amount + aging.days90Plus.amount;\n\n\t\treturn { success: true, aging, totalOutstanding, totalInvoices: invoices?.length || 0 };\n\t},\n});\n\nexport const getTeamPerformanceReportTool = tool({\n\tdescription: \"Get team member performance metrics including jobs completed, revenue generated, and ratings\",\n\tparameters: z.object({\n\t\tteamMemberId: z.string().uuid().optional().describe(\"Specific team member, or omit for all\"),\n\t\tperiod: z.enum([\"week\", \"month\", \"quarter\", \"year\"]).default(\"month\"),\n\t}),\n\texecute: async ({ teamMemberId, period }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst now = new Date();\n\t\tlet startDate: Date;\n\t\tswitch (period) {\n\t\t\tcase \"week\": startDate = new Date(now.setDate(now.getDate() - 7)); break;\n\t\t\tcase \"month\": startDate = new Date(now.setMonth(now.getMonth() - 1)); break;\n\t\t\tcase \"quarter\": startDate = new Date(now.setMonth(now.getMonth() - 3)); break;\n\t\t\tcase \"year\": startDate = new Date(now.setFullYear(now.getFullYear() - 1)); break;\n\t\t}\n\n\t\tlet queryBuilder = supabase\n\t\t\t.from(\"jobs\")\n\t\t\t.select(\"id, assigned_to, status, total_amount, completed_at\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.gte(\"created_at\", startDate.toISOString());\n\n\t\tif (teamMemberId) queryBuilder = queryBuilder.eq(\"assigned_to\", teamMemberId);\n\n\t\tconst { data: jobs } = await queryBuilder;\n\t\tconst { data: teamMembers } = await supabase\n\t\t\t.from(\"team_members\")\n\t\t\t.select(\"id, first_name, last_name, role\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"status\", \"active\");\n\n\t\t// Aggregate by team member\n\t\tconst performance: Record<string, {\n\t\t\tname: string;\n\t\t\trole: string;\n\t\t\tjobsAssigned: number;\n\t\t\tjobsCompleted: number;\n\t\t\tcompletionRate: number;\n\t\t\trevenue: number;\n\t\t}> = {};\n\n\t\tteamMembers?.forEach((tm) => {\n\t\t\tperformance[tm.id] = {\n\t\t\t\tname: `${tm.first_name} ${tm.last_name}`,\n\t\t\t\trole: tm.role,\n\t\t\t\tjobsAssigned: 0,\n\t\t\t\tjobsCompleted: 0,\n\t\t\t\tcompletionRate: 0,\n\t\t\t\trevenue: 0,\n\t\t\t};\n\t\t});\n\n\t\tjobs?.forEach((job) => {\n\t\t\tif (job.assigned_to && performance[job.assigned_to]) {\n\t\t\t\tperformance[job.assigned_to].jobsAssigned += 1;\n\t\t\t\tif (job.status === \"completed\") {\n\t\t\t\t\tperformance[job.assigned_to].jobsCompleted += 1;\n\t\t\t\t\tperformance[job.assigned_to].revenue += (job.total_amount || 0) / 100;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Calculate completion rates\n\t\tObject.values(performance).forEach((p) => {\n\t\t\tp.completionRate = p.jobsAssigned > 0 ? (p.jobsCompleted / p.jobsAssigned) * 100 : 0;\n\t\t});\n\n\t\tconst results = Object.values(performance).sort((a, b) => b.revenue - a.revenue);\n\n\t\treturn { success: true, period, performance: results };\n\t},\n});\n\nexport const getCustomerLifetimeValueTool = tool({\n\tdescription: \"Get customer lifetime value (CLV) analysis showing total revenue and engagement per customer\",\n\tparameters: z.object({\n\t\tcustomerId: z.string().uuid().optional().describe(\"Specific customer, or omit for top customers\"),\n\t\tlimit: z.number().optional().default(20),\n\t}),\n\texecute: async ({ customerId, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tif (customerId) {\n\t\t\t// Single customer CLV\n\t\t\tconst [customerResult, invoicesResult, jobsResult] = await Promise.all([\n\t\t\t\tsupabase.from(\"customers\").select(\"*\").eq(\"id\", customerId).eq(\"company_id\", companyId).single(),\n\t\t\t\tsupabase.from(\"invoices\").select(\"total_amount, paid_amount, status, created_at\").eq(\"customer_id\", customerId),\n\t\t\t\tsupabase.from(\"jobs\").select(\"id, status, completed_at\").eq(\"customer_id\", customerId),\n\t\t\t]);\n\n\t\t\tif (customerResult.error) return { success: false, error: customerResult.error.message };\n\n\t\t\tconst totalRevenue = (invoicesResult.data?.filter((i) => i.status === \"paid\").reduce((s, i) => s + (i.paid_amount || 0), 0) || 0) / 100;\n\t\t\tconst jobCount = jobsResult.data?.length || 0;\n\t\t\tconst firstInvoice = invoicesResult.data?.sort((a, b) => new Date(a.created_at).getTime() - new Date(b.created_at).getTime())[0];\n\t\t\tconst customerSince = firstInvoice ? new Date(firstInvoice.created_at) : new Date(customerResult.data.created_at);\n\t\t\tconst monthsAsCustomer = Math.max(1, Math.floor((Date.now() - customerSince.getTime()) / (1000 * 60 * 60 * 24 * 30)));\n\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tcustomer: customerResult.data,\n\t\t\t\tclv: {\n\t\t\t\t\ttotalRevenue,\n\t\t\t\t\tjobCount,\n\t\t\t\t\taverageJobValue: jobCount > 0 ? totalRevenue / jobCount : 0,\n\t\t\t\t\tcustomerSince: customerSince.toISOString(),\n\t\t\t\t\tmonthsAsCustomer,\n\t\t\t\t\tmonthlyAverageRevenue: totalRevenue / monthsAsCustomer,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\t// Top customers by CLV\n\t\tconst { data: customers } = await supabase\n\t\t\t.from(\"customers\")\n\t\t\t.select(\"id, display_name, total_revenue, job_count, created_at\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"status\", \"active\")\n\t\t\t.order(\"total_revenue\", { ascending: false })\n\t\t\t.limit(limit);\n\n\t\tconst clvData = customers?.map((c) => ({\n\t\t\t...c,\n\t\t\ttotalRevenue: (c.total_revenue || 0) / 100,\n\t\t\taverageJobValue: c.job_count > 0 ? (c.total_revenue || 0) / 100 / c.job_count : 0,\n\t\t}));\n\n\t\treturn { success: true, topCustomers: clvData };\n\t},\n});\n\n// ============================================================================\n// ESTIMATE & CONTRACT TOOLS\n// ============================================================================\n\nexport const searchEstimatesTool = tool({\n\tdescription: \"Search for estimates by customer, status, or amount\",\n\tparameters: z.object({\n\t\tquery: z.string().optional(),\n\t\tstatus: z.enum([\"draft\", \"sent\", \"viewed\", \"approved\", \"rejected\", \"expired\"]).optional(),\n\t\tcustomerId: z.string().uuid().optional(),\n\t\tlimit: z.number().optional().default(20),\n\t}),\n\texecute: async ({ query, status, customerId, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tlet queryBuilder = supabase\n\t\t\t.from(\"estimates\")\n\t\t\t.select(\"id, estimate_number, title, status, total_amount, valid_until, customer:customers(display_name)\")\n\t\t\t.eq(\"company_id\", companyId);\n\n\t\tif (query) queryBuilder = queryBuilder.ilike(\"estimate_number\", `%${query}%`);\n\t\tif (status) queryBuilder = queryBuilder.eq(\"status\", status);\n\t\tif (customerId) queryBuilder = queryBuilder.eq(\"customer_id\", customerId);\n\n\t\tconst { data, error } = await queryBuilder.order(\"created_at\", { ascending: false }).limit(limit);\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, estimates: data, count: data?.length || 0 };\n\t},\n});\n\nexport const searchContractsTool = tool({\n\tdescription: \"Search for contracts by customer, status, or type\",\n\tparameters: z.object({\n\t\tquery: z.string().optional(),\n\t\tstatus: z.enum([\"draft\", \"sent\", \"active\", \"expired\", \"cancelled\"]).optional(),\n\t\tcustomerId: z.string().uuid().optional(),\n\t\tlimit: z.number().optional().default(20),\n\t}),\n\texecute: async ({ query, status, customerId, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tlet queryBuilder = supabase\n\t\t\t.from(\"contracts\")\n\t\t\t.select(\"id, contract_number, title, status, total_value, start_date, end_date, customer:customers(display_name)\")\n\t\t\t.eq(\"company_id\", companyId);\n\n\t\tif (query) queryBuilder = queryBuilder.ilike(\"contract_number\", `%${query}%`);\n\t\tif (status) queryBuilder = queryBuilder.eq(\"status\", status);\n\t\tif (customerId) queryBuilder = queryBuilder.eq(\"customer_id\", customerId);\n\n\t\tconst { data, error } = await queryBuilder.order(\"created_at\", { ascending: false }).limit(limit);\n\n\t\tif (error) return { success: false, error: error.message };\n\t\treturn { success: true, contracts: data, count: data?.length || 0 };\n\t},\n});\n\n// ============================================================================\n// EXPORT ALL TOOLS\n// ============================================================================\n\nexport const aiAgentTools = {\n\t// Universal Database Access tools\n\tlistDatabaseTables: listDatabaseTablesTool,\n\tqueryDatabase: queryDatabaseTool,\n\tgetRecordById: getRecordByIdTool,\n\tgetRelatedRecords: getRelatedRecordsTool,\n\tgetCompanyOverview: getCompanyOverviewTool,\n\tsearchAllEntities: searchAllEntitesTool,\n\n\t// Customer tools\n\tsearchCustomers: searchCustomersTool,\n\tgetCustomerDetails: getCustomerDetailsTool,\n\tcreateCustomer: createCustomerTool,\n\tupdateCustomer: updateCustomerTool,\n\n\t// Team Member tools\n\tsearchTeamMembers: searchTeamMembersTool,\n\tgetTeamMemberDetails: getTeamMemberDetailsTool,\n\tsendTeamEmail: sendTeamEmailTool,\n\tsendTeamSms: sendTeamSmsTool,\n\n\t// Vendor tools\n\tsearchVendors: searchVendorsTool,\n\tgetVendorDetails: getVendorDetailsTool,\n\tsendVendorEmail: sendVendorEmailTool,\n\tsendVendorSms: sendVendorSmsTool,\n\n\t// Property & Equipment tools\n\tsearchProperties: searchPropertiesTool,\n\tgetPropertyDetails: getPropertyDetailsTool,\n\tsearchEquipment: searchEquipmentTool,\n\tgetMaintenanceDue: getMaintenanceDueTool,\n\n\t// Job/Scheduling tools\n\tsearchJobs: searchJobsTool,\n\tcreateAppointment: createAppointmentTool,\n\tgetAvailableSlots: getAvailableSlotsTool,\n\n\t// Invoice/Financial tools\n\tsearchInvoices: searchInvoicesTool,\n\tcreateInvoice: createInvoiceTool,\n\tgetFinancialSummary: getFinancialSummaryTool,\n\tgetVirtualBuckets: getVirtualBucketsTool,\n\ttransferToBucket: transferToBucketTool,\n\n\t// Communication tools\n\tsendEmail: sendEmailTool,\n\tsendSms: sendSmsTool,\n\tinitiateCall: initiateCallTool,\n\tgetCommunicationHistory: getCommunicationHistoryTool,\n\n\t// Reminder/Notification tools\n\tscheduleReminder: scheduleReminderTool,\n\tcancelReminder: cancelReminderTool,\n\tgetScheduledReminders: getScheduledRemindersTool,\n\tsendImmediateNotification: sendImmediateNotificationTool,\n\n\t// Enhanced Reporting tools\n\tgetJobCostingReport: getJobCostingReportTool,\n\tgetRevenueBreakdown: getRevenueBreakdownTool,\n\tgetARAgingReport: getARAgingReportTool,\n\tgetTeamPerformanceReport: getTeamPerformanceReportTool,\n\tgetCustomerLifetimeValue: getCustomerLifetimeValueTool,\n\tgetDashboardMetrics: getDashboardMetricsTool,\n\tgetProactiveInsights: getProactiveInsightsTool,\n\n\t// Estimate & Contract tools\n\tsearchEstimates: searchEstimatesTool,\n\tsearchContracts: searchContractsTool,\n};\n\n// Tool category mapping for permission checking\nexport const toolCategories: Record<string, ToolCategory> = {\n\t// Universal Database Access (read-only, reporting category)\n\tlistDatabaseTables: \"reporting\",\n\tqueryDatabase: \"reporting\",\n\tgetRecordById: \"reporting\",\n\tgetRelatedRecords: \"reporting\",\n\tgetCompanyOverview: \"reporting\",\n\tsearchAllEntities: \"reporting\",\n\n\t// Customer\n\tsearchCustomers: \"customer\",\n\tgetCustomerDetails: \"customer\",\n\tcreateCustomer: \"customer\",\n\tupdateCustomer: \"customer\",\n\n\t// Team\n\tsearchTeamMembers: \"team\",\n\tgetTeamMemberDetails: \"team\",\n\tsendTeamEmail: \"team\",\n\tsendTeamSms: \"team\",\n\n\t// Vendor\n\tsearchVendors: \"vendor\",\n\tgetVendorDetails: \"vendor\",\n\tsendVendorEmail: \"vendor\",\n\tsendVendorSms: \"vendor\",\n\n\t// Property & Equipment\n\tsearchProperties: \"property\",\n\tgetPropertyDetails: \"property\",\n\tsearchEquipment: \"equipment\",\n\tgetMaintenanceDue: \"equipment\",\n\n\t// Scheduling\n\tsearchJobs: \"scheduling\",\n\tcreateAppointment: \"scheduling\",\n\tgetAvailableSlots: \"scheduling\",\n\n\t// Financial\n\tsearchInvoices: \"financial\",\n\tcreateInvoice: \"financial\",\n\tgetFinancialSummary: \"reporting\",\n\tgetVirtualBuckets: \"financial\",\n\ttransferToBucket: \"financial\",\n\n\t// Communication\n\tsendEmail: \"communication\",\n\tsendSms: \"communication\",\n\tinitiateCall: \"communication\",\n\tgetCommunicationHistory: \"communication\",\n\n\t// Notifications\n\tscheduleReminder: \"notification\",\n\tcancelReminder: \"notification\",\n\tgetScheduledReminders: \"notification\",\n\tsendImmediateNotification: \"notification\",\n\n\t// Reporting\n\tgetJobCostingReport: \"reporting\",\n\tgetRevenueBreakdown: \"reporting\",\n\tgetARAgingReport: \"reporting\",\n\tgetTeamPerformanceReport: \"reporting\",\n\tgetCustomerLifetimeValue: \"reporting\",\n\tgetDashboardMetrics: \"reporting\",\n\tgetProactiveInsights: \"reporting\",\n\n\t// Estimates & Contracts\n\tsearchEstimates: \"financial\",\n\tsearchContracts: \"financial\",\n};\n\n// ============================================================================\n// DESTRUCTIVE TOOLS - Require Owner Approval\n// These tools perform actions that cannot be easily undone or have significant impact\n// ============================================================================\n\nexport type DestructiveActionType =\n\t| \"delete\"\n\t| \"bulk_update\"\n\t| \"bulk_delete\"\n\t| \"archive\"\n\t| \"financial\"\n\t| \"send_communication\";\n\nexport type RiskLevel = \"low\" | \"medium\" | \"high\" | \"critical\";\n\nexport interface DestructiveToolMetadata {\n\tisDestructive: true;\n\tactionType: DestructiveActionType;\n\triskLevel: RiskLevel;\n\trequiresOwnerApproval: boolean;\n\tdescription: string;\n\taffectedEntityType: string;\n}\n\n// ============================================================================\n// SEMANTIC MEMORY TOOLS\n// ============================================================================\n\n/**\n * Store a fact or preference about an entity (customer, job, property, etc.)\n * This enables long-term semantic memory across conversations.\n */\nexport const storeMemoryTool = tool({\n\tdescription: \"Store a fact, preference, or important information about an entity (customer, job, property, etc.) for future reference. Use this to remember important details that should persist across conversations.\",\n\tparameters: z.object({\n\t\tcontent: z.string().describe(\"The fact or information to remember\"),\n\t\tmemoryType: z.enum([\"fact\", \"preference\", \"interaction\", \"context\", \"entity\", \"procedure\", \"feedback\"]).describe(\"Type of memory\"),\n\t\tentityType: z.enum([\"customer\", \"job\", \"property\", \"equipment\", \"invoice\", \"estimate\", \"team_member\"]).optional().describe(\"Type of entity this memory relates to\"),\n\t\tentityId: z.string().uuid().optional().describe(\"ID of the related entity\"),\n\t\timportance: z.enum([\"low\", \"medium\", \"high\"]).default(\"medium\").describe(\"How important is this memory\"),\n\t\ttags: z.array(z.string()).optional().describe(\"Tags to categorize the memory\"),\n\t}),\n\texecute: async ({ content, memoryType, entityType, entityId, importance, tags }, { companyId, userId }: { companyId: string; userId?: string }) => {\n\t\tconst { storeMemory } = await import(\"./memory-service\");\n\n\t\tconst importanceScore = { low: 0.3, medium: 0.6, high: 0.9 }[importance];\n\n\t\tconst memoryId = await storeMemory(companyId, userId || \"system\", {\n\t\t\tcontent,\n\t\t\tmemoryType,\n\t\t\tentityType,\n\t\t\tentityId,\n\t\t\timportance: importanceScore,\n\t\t\ttags,\n\t\t\tsourceType: \"agent\",\n\t\t});\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tmessage: `Memory stored successfully`,\n\t\t\tmemoryId,\n\t\t\tsummary: `Remembered: \"${content.substring(0, 50)}...\"`,\n\t\t};\n\t},\n});\n\n/**\n * Search semantic memories using natural language\n */\nexport const searchMemoriesTool = tool({\n\tdescription: \"Search through stored memories using natural language. Use this to recall facts, preferences, or context about customers, jobs, or other entities.\",\n\tparameters: z.object({\n\t\tquery: z.string().describe(\"Natural language search query (e.g., 'customer preferences for Johnson family')\"),\n\t\tentityType: z.enum([\"customer\", \"job\", \"property\", \"equipment\", \"invoice\", \"estimate\", \"team_member\"]).optional().describe(\"Filter to specific entity type\"),\n\t\tentityId: z.string().uuid().optional().describe(\"Filter to specific entity\"),\n\t\tmemoryTypes: z.array(z.enum([\"fact\", \"preference\", \"interaction\", \"context\", \"entity\", \"procedure\", \"feedback\"])).optional().describe(\"Filter by memory types\"),\n\t\tlimit: z.number().optional().default(5).describe(\"Max memories to return\"),\n\t}),\n\texecute: async ({ query, entityType, entityId, memoryTypes, limit }, { companyId }: { companyId: string }) => {\n\t\tconst { searchMemories } = await import(\"./memory-service\");\n\n\t\tconst results = await searchMemories(companyId, query, {\n\t\t\tentityType,\n\t\t\tentityId,\n\t\t\tmemoryTypes,\n\t\t\tlimit,\n\t\t\tminSimilarity: 0.5,\n\t\t});\n\n\t\tif (results.length === 0) {\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tmessage: \"No relevant memories found\",\n\t\t\t\tmemories: [],\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tmessage: `Found ${results.length} relevant memories`,\n\t\t\tmemories: results.map(m => ({\n\t\t\t\tcontent: m.content,\n\t\t\t\ttype: m.memoryType,\n\t\t\t\trelevance: Math.round(m.similarity * 100) + \"%\",\n\t\t\t\tentityType: m.entityType,\n\t\t\t\tcreatedAt: m.createdAt,\n\t\t\t})),\n\t\t};\n\t},\n});\n\n/**\n * Get all memories for a specific entity\n */\nexport const getEntityMemoriesTool = tool({\n\tdescription: \"Retrieve all stored memories about a specific entity (customer, job, property, etc.). Use this before interacting with a customer or job to get full context.\",\n\tparameters: z.object({\n\t\tentityType: z.enum([\"customer\", \"job\", \"property\", \"equipment\", \"invoice\", \"estimate\", \"team_member\"]).describe(\"Type of entity\"),\n\t\tentityId: z.string().uuid().describe(\"Entity ID\"),\n\t\tmemoryTypes: z.array(z.enum([\"fact\", \"preference\", \"interaction\", \"context\", \"entity\", \"procedure\", \"feedback\"])).optional().describe(\"Filter by memory types\"),\n\t\tlimit: z.number().optional().default(20).describe(\"Max memories to return\"),\n\t}),\n\texecute: async ({ entityType, entityId, memoryTypes, limit }, { companyId }: { companyId: string }) => {\n\t\tconst { getEntityMemories } = await import(\"./memory-service\");\n\n\t\tconst memories = await getEntityMemories(companyId, entityType, entityId, {\n\t\t\ttypes: memoryTypes,\n\t\t\tlimit,\n\t\t});\n\n\t\tif (memories.length === 0) {\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tmessage: `No memories stored for this ${entityType}`,\n\t\t\t\tmemories: [],\n\t\t\t};\n\t\t}\n\n\t\t// Group by type for better presentation\n\t\tconst grouped: Record<string, Array<{ content: string; importance: number }>> = {};\n\t\tfor (const m of memories) {\n\t\t\tif (!grouped[m.memory_type]) grouped[m.memory_type] = [];\n\t\t\tgrouped[m.memory_type].push({\n\t\t\t\tcontent: m.content,\n\t\t\t\timportance: m.importance,\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tmessage: `Found ${memories.length} memories for ${entityType}`,\n\t\t\tmemoriesByType: grouped,\n\t\t\ttotalCount: memories.length,\n\t\t};\n\t},\n});\n\n/**\n * Recall relevant context for current conversation\n */\nexport const recallContextTool = tool({\n\tdescription: \"Automatically recall relevant memories and context based on what's being discussed. Use this at the start of conversations or when switching topics to get background information.\",\n\tparameters: z.object({\n\t\ttopic: z.string().describe(\"The current topic or context (e.g., 'scheduling job for Smith residence', 'invoice payment issue')\"),\n\t\tcustomerName: z.string().optional().describe(\"Customer name if known\"),\n\t\tjobId: z.string().uuid().optional().describe(\"Job ID if discussing a specific job\"),\n\t}),\n\texecute: async ({ topic, customerName, jobId }, { companyId }: { companyId: string }) => {\n\t\tconst { searchMemories } = await import(\"./memory-service\");\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst context: {\n\t\t\tmemories: Array<{ content: string; type: string; relevance: string }>;\n\t\t\tcustomer?: { id: string; name: string; notes?: string };\n\t\t\tjob?: { id: string; title: string; status: string };\n\t\t} = {\n\t\t\tmemories: [],\n\t\t};\n\n\t\t// Search for relevant memories\n\t\tconst memories = await searchMemories(companyId, topic, {\n\t\t\tlimit: 5,\n\t\t\tminSimilarity: 0.4,\n\t\t});\n\n\t\tcontext.memories = memories.map(m => ({\n\t\t\tcontent: m.content,\n\t\t\ttype: m.memoryType,\n\t\t\trelevance: Math.round(m.similarity * 100) + \"%\",\n\t\t}));\n\n\t\t// If customer name provided, try to find them\n\t\tif (customerName) {\n\t\t\tconst { data: customer } = await supabase\n\t\t\t\t.from(\"customers\")\n\t\t\t\t.select(\"id, name, notes\")\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.ilike(\"name\", `%${customerName}%`)\n\t\t\t\t.limit(1)\n\t\t\t\t.single();\n\n\t\t\tif (customer) {\n\t\t\t\tcontext.customer = customer;\n\n\t\t\t\t// Get customer-specific memories\n\t\t\t\tconst customerMemories = await searchMemories(companyId, `${customerName} customer preferences`, {\n\t\t\t\t\tentityType: \"customer\",\n\t\t\t\t\tentityId: customer.id,\n\t\t\t\t\tlimit: 3,\n\t\t\t\t});\n\n\t\t\t\tfor (const m of customerMemories) {\n\t\t\t\t\tif (!context.memories.some(cm => cm.content === m.content)) {\n\t\t\t\t\t\tcontext.memories.push({\n\t\t\t\t\t\t\tcontent: m.content,\n\t\t\t\t\t\t\ttype: m.memoryType,\n\t\t\t\t\t\t\trelevance: Math.round(m.similarity * 100) + \"%\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// If job ID provided, get job details\n\t\tif (jobId) {\n\t\t\tconst { data: job } = await supabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\"id, title, status, description\")\n\t\t\t\t.eq(\"id\", jobId)\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.single();\n\n\t\t\tif (job) {\n\t\t\t\tcontext.job = { id: job.id, title: job.title, status: job.status };\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\ttopic,\n\t\t\tcontext,\n\t\t\tsummary: context.memories.length > 0\n\t\t\t\t? `Found ${context.memories.length} relevant memories for context`\n\t\t\t\t: \"No specific memories found, but retrieved available entity info\",\n\t\t};\n\t},\n});\n\n// ============================================================================\n// COMMUNICATION LEARNING TOOLS\n// ============================================================================\n\n/**\n * Search across all communications (calls, emails, SMS) using full-text search\n */\nexport const searchCommunicationsFullTextTool = tool({\n\tdescription: \"Search across all customer communications (calls, emails, SMS) to find specific conversations, topics, or issues discussed. Great for finding 'what did the customer say about...'\",\n\tparameters: z.object({\n\t\tquery: z.string().describe(\"Search query (e.g., 'water heater issue', 'preferred time morning')\"),\n\t\tchannel: z.enum([\"email\", \"sms\", \"call\", \"all\"]).optional().default(\"all\").describe(\"Filter by communication channel\"),\n\t\tcustomerId: z.string().uuid().optional().describe(\"Filter to specific customer\"),\n\t\tdirection: z.enum([\"inbound\", \"outbound\", \"all\"]).optional().default(\"all\").describe(\"Filter by direction\"),\n\t\tlimit: z.number().optional().default(10).describe(\"Max results\"),\n\t}),\n\texecute: async ({ query, channel, customerId, direction, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tlet dbQuery = supabase\n\t\t\t.from(\"communications\")\n\t\t\t.select(`\n\t\t\t\tid, type, channel, direction, subject, body_plain,\n\t\t\t\tcall_transcript, call_sentiment, from_name, to_name,\n\t\t\t\tcustomer_id, created_at,\n\t\t\t\tcustomer:customers(id, name)\n\t\t\t`)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(limit);\n\n\t\t// Apply filters\n\t\tif (channel !== \"all\") {\n\t\t\tdbQuery = dbQuery.eq(\"channel\", channel);\n\t\t}\n\t\tif (customerId) {\n\t\t\tdbQuery = dbQuery.eq(\"customer_id\", customerId);\n\t\t}\n\t\tif (direction !== \"all\") {\n\t\t\tdbQuery = dbQuery.eq(\"direction\", direction);\n\t\t}\n\n\t\t// Full-text search on body and transcript\n\t\tdbQuery = dbQuery.or(`body_plain.ilike.%${query}%,call_transcript.ilike.%${query}%,subject.ilike.%${query}%`);\n\n\t\tconst { data, error } = await dbQuery;\n\n\t\tif (error) return { success: false, error: error.message };\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tmessage: `Found ${data?.length || 0} communications matching \"${query}\"`,\n\t\t\tresults: data?.map(c => ({\n\t\t\t\tid: c.id,\n\t\t\t\tchannel: c.channel,\n\t\t\t\tdirection: c.direction,\n\t\t\t\tsubject: c.subject,\n\t\t\t\tpreview: (c.body_plain || c.call_transcript || \"\").substring(0, 200),\n\t\t\t\tsentiment: c.call_sentiment,\n\t\t\t\tcustomerName: c.customer?.name,\n\t\t\t\tdate: c.created_at,\n\t\t\t})),\n\t\t};\n\t},\n});\n\n/**\n * Get call transcript with AI-extracted insights\n */\nexport const getCallTranscriptTool = tool({\n\tdescription: \"Get the full transcript of a phone call along with extracted insights. Use when you need to review what was discussed in a specific call.\",\n\tparameters: z.object({\n\t\tcommunicationId: z.string().uuid().describe(\"The communication ID of the call\"),\n\t}),\n\texecute: async ({ communicationId }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"communications\")\n\t\t\t.select(`\n\t\t\t\tid, type, channel, direction, call_duration, call_transcript,\n\t\t\t\tcall_sentiment, call_recording_url, from_name, to_name,\n\t\t\t\tcustomer_id, created_at,\n\t\t\t\tcustomer:customers(id, name, email, phone)\n\t\t\t`)\n\t\t\t.eq(\"id\", communicationId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (error) return { success: false, error: error.message };\n\t\tif (!data?.call_transcript) {\n\t\t\treturn { success: false, error: \"No transcript available for this communication\" };\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tcall: {\n\t\t\t\tid: data.id,\n\t\t\t\tdirection: data.direction,\n\t\t\t\tduration: data.call_duration ? `${Math.floor(data.call_duration / 60)}m ${data.call_duration % 60}s` : \"Unknown\",\n\t\t\t\tsentiment: data.call_sentiment,\n\t\t\t\tcustomerName: data.customer?.name,\n\t\t\t\tdate: data.created_at,\n\t\t\t\ttranscript: data.call_transcript,\n\t\t\t\thasRecording: !!data.call_recording_url,\n\t\t\t},\n\t\t};\n\t},\n});\n\n/**\n * Search voicemail transcriptions\n */\nexport const searchVoicemailTranscriptsTool = tool({\n\tdescription: \"Search through voicemail transcriptions to find messages about specific topics or from specific customers.\",\n\tparameters: z.object({\n\t\tquery: z.string().optional().describe(\"Search query for transcription content\"),\n\t\tcustomerId: z.string().uuid().optional().describe(\"Filter to specific customer\"),\n\t\turgentOnly: z.boolean().optional().default(false).describe(\"Only show urgent voicemails\"),\n\t\tunreadOnly: z.boolean().optional().default(false).describe(\"Only show unread voicemails\"),\n\t\tlimit: z.number().optional().default(10).describe(\"Max results\"),\n\t}),\n\texecute: async ({ query, customerId, urgentOnly, unreadOnly, limit }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tlet dbQuery = supabase\n\t\t\t.from(\"voicemails\")\n\t\t\t.select(`\n\t\t\t\tid, from_number, duration, transcription, transcription_confidence,\n\t\t\t\tis_read, is_urgent, received_at, customer_id,\n\t\t\t\tcustomer:customers(id, name)\n\t\t\t`)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.order(\"received_at\", { ascending: false })\n\t\t\t.limit(limit);\n\n\t\tif (customerId) {\n\t\t\tdbQuery = dbQuery.eq(\"customer_id\", customerId);\n\t\t}\n\t\tif (urgentOnly) {\n\t\t\tdbQuery = dbQuery.eq(\"is_urgent\", true);\n\t\t}\n\t\tif (unreadOnly) {\n\t\t\tdbQuery = dbQuery.eq(\"is_read\", false);\n\t\t}\n\t\tif (query) {\n\t\t\tdbQuery = dbQuery.ilike(\"transcription\", `%${query}%`);\n\t\t}\n\n\t\tconst { data, error } = await dbQuery;\n\n\t\tif (error) return { success: false, error: error.message };\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tmessage: `Found ${data?.length || 0} voicemails`,\n\t\t\tvoicemails: data?.map(v => ({\n\t\t\t\tid: v.id,\n\t\t\t\tfrom: v.from_number,\n\t\t\t\tcustomerName: v.customer?.name,\n\t\t\t\tduration: v.duration ? `${Math.floor(v.duration / 60)}m ${v.duration % 60}s` : \"Unknown\",\n\t\t\t\ttranscription: v.transcription,\n\t\t\t\tconfidence: v.transcription_confidence,\n\t\t\t\tisUrgent: v.is_urgent,\n\t\t\t\tisRead: v.is_read,\n\t\t\t\treceivedAt: v.received_at,\n\t\t\t})),\n\t\t};\n\t},\n});\n\n/**\n * Get all recent communications for a customer\n */\nexport const getCustomerCommunicationHistoryTool = tool({\n\tdescription: \"Get the complete communication history for a customer including calls, emails, SMS, and voicemails. Use this to understand the full context of a customer relationship.\",\n\tparameters: z.object({\n\t\tcustomerId: z.string().uuid().describe(\"Customer UUID\"),\n\t\tdays: z.number().optional().default(90).describe(\"Look back this many days\"),\n\t\tincludeTranscripts: z.boolean().optional().default(false).describe(\"Include full call transcripts\"),\n\t}),\n\texecute: async ({ customerId, days, includeTranscripts }, { companyId }: { companyId: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\t\tconst cutoffDate = new Date();\n\t\tcutoffDate.setDate(cutoffDate.getDate() - days);\n\n\t\t// Get communications\n\t\tconst { data: comms, error: commsError } = await supabase\n\t\t\t.from(\"communications\")\n\t\t\t.select(`\n\t\t\t\tid, type, channel, direction, subject, body_plain,\n\t\t\t\tcall_transcript, call_sentiment, call_duration,\n\t\t\t\tfrom_name, to_name, created_at, status\n\t\t\t`)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.gte(\"created_at\", cutoffDate.toISOString())\n\t\t\t.order(\"created_at\", { ascending: false });\n\n\t\t// Get voicemails\n\t\tconst { data: voicemails, error: vmError } = await supabase\n\t\t\t.from(\"voicemails\")\n\t\t\t.select(\"id, from_number, duration, transcription, is_urgent, received_at\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.gte(\"received_at\", cutoffDate.toISOString())\n\t\t\t.order(\"received_at\", { ascending: false });\n\n\t\tif (commsError) return { success: false, error: commsError.message };\n\n\t\t// Summarize by channel\n\t\tconst summary = {\n\t\t\temails: comms?.filter(c => c.channel === \"email\").length || 0,\n\t\t\tcalls: comms?.filter(c => c.channel === \"call\").length || 0,\n\t\t\tsms: comms?.filter(c => c.channel === \"sms\").length || 0,\n\t\t\tvoicemails: voicemails?.length || 0,\n\t\t};\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tcustomerId,\n\t\t\tperiod: `Last ${days} days`,\n\t\t\tsummary,\n\t\t\tcommunications: comms?.map(c => ({\n\t\t\t\tid: c.id,\n\t\t\t\tchannel: c.channel,\n\t\t\t\tdirection: c.direction,\n\t\t\t\tsubject: c.subject,\n\t\t\t\tpreview: includeTranscripts\n\t\t\t\t\t? (c.body_plain || c.call_transcript || \"\").substring(0, 500)\n\t\t\t\t\t: (c.body_plain || c.call_transcript || \"\").substring(0, 100),\n\t\t\t\tsentiment: c.call_sentiment,\n\t\t\t\tdate: c.created_at,\n\t\t\t})),\n\t\t\tvoicemails: voicemails?.map(v => ({\n\t\t\t\tid: v.id,\n\t\t\t\tduration: v.duration,\n\t\t\t\ttranscription: v.transcription?.substring(0, 200),\n\t\t\t\tisUrgent: v.is_urgent,\n\t\t\t\tdate: v.received_at,\n\t\t\t})),\n\t\t};\n\t},\n});\n\n/**\n * Extract and store insights from a communication\n */\nexport const extractCommunicationInsightsTool = tool({\n\tdescription: \"Analyze a communication (call, email, SMS) and extract key insights like customer preferences, issues, sentiment. Automatically stores insights in memory for future reference.\",\n\tparameters: z.object({\n\t\tcommunicationId: z.string().uuid().describe(\"Communication ID to analyze\"),\n\t\tinsightTypes: z.array(z.enum([\"preference\", \"issue\", \"sentiment\", \"action_item\", \"feedback\"])).optional().describe(\"Types of insights to extract\"),\n\t}),\n\texecute: async ({ communicationId, insightTypes }, { companyId, userId }: { companyId: string; userId?: string }) => {\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\t// Get the communication\n\t\tconst { data: comm, error } = await supabase\n\t\t\t.from(\"communications\")\n\t\t\t.select(`\n\t\t\t\tid, channel, direction, subject, body_plain, call_transcript,\n\t\t\t\tcall_sentiment, customer_id,\n\t\t\t\tcustomer:customers(id, name)\n\t\t\t`)\n\t\t\t.eq(\"id\", communicationId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (error || !comm) {\n\t\t\treturn { success: false, error: \"Communication not found\" };\n\t\t}\n\n\t\tconst content = comm.body_plain || comm.call_transcript || \"\";\n\t\tif (!content) {\n\t\t\treturn { success: false, error: \"No content to analyze\" };\n\t\t}\n\n\t\t// Extract insights using pattern matching (basic implementation)\n\t\tconst insights: Array<{ type: string; content: string; importance: string }> = [];\n\n\t\t// Look for preferences (morning, afternoon, specific days, etc.)\n\t\tconst preferencePatterns = [\n\t\t\t/prefer[s]?\\s+(morning|afternoon|evening|weekend|monday|tuesday|wednesday|thursday|friday)/gi,\n\t\t\t/best\\s+time[s]?\\s+(?:is|are|would be)\\s+([^.]+)/gi,\n\t\t\t/don'?t\\s+(?:like|want|prefer)\\s+([^.]+)/gi,\n\t\t];\n\n\t\tfor (const pattern of preferencePatterns) {\n\t\t\tconst matches = content.matchAll(pattern);\n\t\t\tfor (const match of matches) {\n\t\t\t\tinsights.push({\n\t\t\t\t\ttype: \"preference\",\n\t\t\t\t\tcontent: `Customer prefers: ${match[0]}`,\n\t\t\t\t\timportance: \"medium\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Look for issues/complaints\n\t\tconst issuePatterns = [\n\t\t\t/problem[s]?\\s+with\\s+([^.]+)/gi,\n\t\t\t/issue[s]?\\s+with\\s+([^.]+)/gi,\n\t\t\t/not\\s+working\\s+([^.]+)/gi,\n\t\t\t/broken\\s+([^.]+)/gi,\n\t\t];\n\n\t\tfor (const pattern of issuePatterns) {\n\t\t\tconst matches = content.matchAll(pattern);\n\t\t\tfor (const match of matches) {\n\t\t\t\tinsights.push({\n\t\t\t\t\ttype: \"issue\",\n\t\t\t\t\tcontent: `Reported issue: ${match[0]}`,\n\t\t\t\t\timportance: \"high\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Store insights in memory if customer is linked\n\t\tif (comm.customer_id && insights.length > 0) {\n\t\t\tconst { storeMemory } = await import(\"./memory-service\");\n\n\t\t\tfor (const insight of insights) {\n\t\t\t\tawait storeMemory(companyId, userId || \"system\", {\n\t\t\t\t\tcontent: insight.content,\n\t\t\t\t\tmemoryType: insight.type as \"preference\" | \"feedback\",\n\t\t\t\t\tentityType: \"customer\",\n\t\t\t\t\tentityId: comm.customer_id,\n\t\t\t\t\timportance: insight.importance === \"high\" ? 0.9 : 0.6,\n\t\t\t\t\tsourceType: \"communication\",\n\t\t\t\t\tsourceChatId: communicationId,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tcommunicationId,\n\t\t\tchannel: comm.channel,\n\t\t\tcustomerName: comm.customer?.name,\n\t\t\textractedInsights: insights,\n\t\t\tstoredToMemory: insights.length > 0 && !!comm.customer_id,\n\t\t\tsentiment: comm.call_sentiment,\n\t\t};\n\t},\n});\n\n// =============================================================================\n// EXTERNAL DATA TOOLS - Weather, Traffic, GPS, Maps\n// =============================================================================\n\n/**\n * Get weather forecast and alerts for a location\n *\n * Uses the NWS (National Weather Service) API to get:\n * - 7-day forecast\n * - Hourly forecast\n * - Active weather alerts\n * - Severe weather warnings\n */\nexport const getWeatherForLocationTool = tool({\n\tdescription: `Get weather forecast and alerts for a specific location. Provides 7-day forecast, hourly conditions, and any active weather alerts. Use this when:\n- Scheduling outdoor jobs\n- Checking if weather is suitable for work\n- Planning technician routes\n- Informing customers about weather delays\n\nReturns forecast periods, temperature, wind, precipitation chances, and any severe weather alerts.`,\n\tparameters: z.object({\n\t\tlat: z.number().describe(\"Latitude of the location\"),\n\t\tlon: z.number().describe(\"Longitude of the location\"),\n\t\tincludeHourly: z\n\t\t\t.boolean()\n\t\t\t.optional()\n\t\t\t.default(true)\n\t\t\t.describe(\"Include hourly forecast for next 24 hours\"),\n\t}),\n\texecute: async ({ lat, lon, includeHourly }) => {\n\t\tconst { weatherService } = await import(\"../services/weather-service\");\n\n\t\tconst weather = await weatherService.getWeatherData(lat, lon);\n\n\t\tif (!weather) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Unable to fetch weather data for this location\",\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tlocation: weather.location,\n\t\t\tcurrentConditions: weather.hourly?.periods?.[0] || null,\n\t\t\tforecast: weather.forecast?.periods?.slice(0, 7) || [],\n\t\t\thourly: includeHourly\n\t\t\t\t? weather.hourly?.periods?.slice(0, 12) || []\n\t\t\t\t: [],\n\t\t\talerts: weather.alerts,\n\t\t\thasActiveAlerts: weather.hasActiveAlerts,\n\t\t\thighestSeverity: weather.highestSeverity,\n\t\t\tenrichedAt: weather.enrichedAt,\n\t\t};\n\t},\n});\n\n/**\n * Check if weather is suitable for outdoor work\n *\n * Analyzes weather conditions and alerts to determine if\n * it's safe and practical to do outdoor work\n */\nexport const checkWeatherForJobTool = tool({\n\tdescription: `Check if weather conditions are suitable for outdoor field service work at a specific location. Considers:\n- Severe weather alerts\n- Precipitation (rain, snow, storms)\n- Extreme temperatures (freezing or excessive heat)\n- Wind conditions\n\nReturns a clear recommendation on whether to proceed with outdoor work.`,\n\tparameters: z.object({\n\t\tlat: z.number().describe(\"Latitude of the job location\"),\n\t\tlon: z.number().describe(\"Longitude of the job location\"),\n\t\tjobType: z\n\t\t\t.string()\n\t\t\t.optional()\n\t\t\t.describe(\"Type of job (e.g., 'roofing', 'HVAC outdoor', 'landscaping')\"),\n\t}),\n\texecute: async ({ lat, lon, jobType }) => {\n\t\tconst { weatherService } = await import(\"../services/weather-service\");\n\n\t\tconst weather = await weatherService.getWeatherData(lat, lon);\n\n\t\tif (!weather) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tsuitable: null,\n\t\t\t\terror: \"Unable to fetch weather data\",\n\t\t\t};\n\t\t}\n\n\t\tconst suitability = weatherService.isSuitableForOutdoorWork(weather);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tsuitable: suitability.suitable,\n\t\t\treason: suitability.reason || \"Weather conditions are acceptable for outdoor work\",\n\t\t\tcurrentConditions: weather.hourly?.periods?.[0]\n\t\t\t\t? {\n\t\t\t\t\t\ttemperature: weather.hourly.periods[0].temperature,\n\t\t\t\t\t\ttemperatureUnit: weather.hourly.periods[0].temperatureUnit,\n\t\t\t\t\t\tshortForecast: weather.hourly.periods[0].shortForecast,\n\t\t\t\t\t\twindSpeed: weather.hourly.periods[0].windSpeed,\n\t\t\t\t\t}\n\t\t\t\t: null,\n\t\t\talerts: weather.alerts.map((a) => ({\n\t\t\t\tevent: a.event,\n\t\t\t\tseverity: a.severity,\n\t\t\t\theadline: a.headline,\n\t\t\t})),\n\t\t\tjobType,\n\t\t\trecommendation: suitability.suitable\n\t\t\t\t? \"Proceed with outdoor work\"\n\t\t\t\t: `Consider rescheduling: ${suitability.reason}`,\n\t\t};\n\t},\n});\n\n/**\n * Get active weather alerts only (faster than full forecast)\n */\nexport const getWeatherAlertsTool = tool({\n\tdescription: `Quickly check for active weather alerts at a location without fetching the full forecast. Use this for:\n- Quick safety checks\n- Emergency notifications\n- Batch checking multiple job sites\n\nReturns only alert information (faster than full weather data).`,\n\tparameters: z.object({\n\t\tlat: z.number().describe(\"Latitude\"),\n\t\tlon: z.number().describe(\"Longitude\"),\n\t}),\n\texecute: async ({ lat, lon }) => {\n\t\tconst { weatherService } = await import(\"../services/weather-service\");\n\n\t\tconst alerts = await weatherService.getActiveAlerts(lat, lon);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\thasAlerts: alerts.length > 0,\n\t\t\talertCount: alerts.length,\n\t\t\talerts: alerts.map((a) => ({\n\t\t\t\tevent: a.event,\n\t\t\t\tseverity: a.severity,\n\t\t\t\turgency: a.urgency,\n\t\t\t\theadline: a.headline,\n\t\t\t\tinstruction: a.instruction,\n\t\t\t\texpires: a.expires,\n\t\t\t})),\n\t\t};\n\t},\n});\n\n/**\n * Get traffic conditions and incidents along a route\n *\n * Uses Google Maps API to check for traffic incidents,\n * construction, accidents, and congestion\n */\nexport const getTrafficConditionsTool = tool({\n\tdescription: `Get real-time traffic conditions and incidents near a job location or along a route. Detects:\n- Traffic accidents/crashes\n- Road construction\n- Road closures\n- Police activity\n- Congestion levels\n\nUseful for:\n- Planning technician dispatch\n- Estimating arrival times\n- Routing around incidents\n- Notifying customers of delays`,\n\tparameters: z.object({\n\t\tdestinationLat: z.number().describe(\"Latitude of the destination/job site\"),\n\t\tdestinationLon: z.number().describe(\"Longitude of the destination/job site\"),\n\t\toriginLat: z\n\t\t\t.number()\n\t\t\t.optional()\n\t\t\t.describe(\"Latitude of origin (e.g., shop/office) to check route\"),\n\t\toriginLon: z\n\t\t\t.number()\n\t\t\t.optional()\n\t\t\t.describe(\"Longitude of origin to check route\"),\n\t}),\n\texecute: async ({ destinationLat, destinationLon, originLat, originLon }) => {\n\t\tconst { trafficService } = await import(\"../services/traffic-service\");\n\n\t\tconst traffic = await trafficService.getTrafficIncidents(\n\t\t\tdestinationLat,\n\t\t\tdestinationLon,\n\t\t\toriginLat,\n\t\t\toriginLon\n\t\t);\n\n\t\tif (!traffic) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Unable to fetch traffic data. Check Google Maps API configuration.\",\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\ttotalIncidents: traffic.totalIncidents,\n\t\t\tnearbyIncidents: traffic.nearbyIncidents,\n\t\t\trouteAffectingIncidents: traffic.routeAffectingIncidents,\n\t\t\tincidents: traffic.incidents.map((i) => ({\n\t\t\t\ttype: i.type,\n\t\t\t\tseverity: i.severity,\n\t\t\t\tdescription: i.description,\n\t\t\t\tdistance: i.distance,\n\t\t\t\taffectsRoute: i.affectsRoute,\n\t\t\t})),\n\t\t\trecommendation:\n\t\t\t\ttraffic.routeAffectingIncidents > 0\n\t\t\t\t\t? `${traffic.routeAffectingIncidents} incident(s) may affect travel time`\n\t\t\t\t\t: \"No significant traffic issues detected\",\n\t\t\tenrichedAt: traffic.enrichedAt,\n\t\t};\n\t},\n});\n\n/**\n * Geocode an address to GPS coordinates\n *\n * Converts a street address to latitude/longitude coordinates\n */\nexport const geocodeAddressTool = tool({\n\tdescription: `Convert a street address to GPS coordinates (latitude/longitude). Use this when:\n- You have an address but need coordinates for weather/traffic lookup\n- Verifying an address is valid\n- Getting standardized/formatted address\n\nReturns coordinates and Google's formatted version of the address.`,\n\tparameters: z.object({\n\t\taddress: z.string().describe(\"Street address (e.g., '123 Main St')\"),\n\t\tcity: z.string().describe(\"City name\"),\n\t\tstate: z.string().describe(\"State (e.g., 'CA' or 'California')\"),\n\t\tzipCode: z.string().describe(\"ZIP code\"),\n\t\tcountry: z.string().optional().default(\"USA\").describe(\"Country (defaults to USA)\"),\n\t}),\n\texecute: async ({ address, city, state, zipCode, country }) => {\n\t\tconst { geocodeAddressSilent } = await import(\"../services/geocoding\");\n\n\t\tconst result = await geocodeAddressSilent(address, city, state, zipCode, country);\n\n\t\tif (!result) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Unable to geocode address. The address may be invalid or geocoding service unavailable.\",\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tcoordinates: {\n\t\t\t\tlat: result.lat,\n\t\t\t\tlon: result.lon,\n\t\t\t},\n\t\t\tformattedAddress: result.formattedAddress,\n\t\t};\n\t},\n});\n\n/**\n * Get property weather and conditions summary\n *\n * Combines multiple data sources to give a complete picture\n * of conditions at a property/job site\n */\nexport const getPropertyConditionsTool = tool({\n\tdescription: `Get a comprehensive conditions summary for a property/job site including weather, traffic, and alerts. This is the \"one-stop\" tool for checking all external conditions before dispatching or scheduling.\n\nCombines:\n- Current and forecast weather\n- Weather alerts\n- Traffic conditions (if shop coordinates provided)\n- Work suitability assessment`,\n\tparameters: z.object({\n\t\tpropertyLat: z.number().describe(\"Latitude of the property\"),\n\t\tpropertyLon: z.number().describe(\"Longitude of the property\"),\n\t\tshopLat: z.number().optional().describe(\"Shop/office latitude for traffic routing\"),\n\t\tshopLon: z.number().optional().describe(\"Shop/office longitude for traffic routing\"),\n\t\tjobType: z\n\t\t\t.string()\n\t\t\t.optional()\n\t\t\t.describe(\"Type of job being performed (for work suitability)\"),\n\t}),\n\texecute: async ({ propertyLat, propertyLon, shopLat, shopLon, jobType }) => {\n\t\tconst { weatherService } = await import(\"../services/weather-service\");\n\t\tconst { trafficService } = await import(\"../services/traffic-service\");\n\n\t\t// Fetch weather and traffic in parallel\n\t\tconst [weather, traffic] = await Promise.all([\n\t\t\tweatherService.getWeatherData(propertyLat, propertyLon),\n\t\t\tshopLat && shopLon\n\t\t\t\t? trafficService.getTrafficIncidents(propertyLat, propertyLon, shopLat, shopLon)\n\t\t\t\t: Promise.resolve(null),\n\t\t]);\n\n\t\tconst result: Record<string, unknown> = {\n\t\t\tsuccess: true,\n\t\t\tpropertyLocation: { lat: propertyLat, lon: propertyLon },\n\t\t};\n\n\t\t// Weather conditions\n\t\tif (weather) {\n\t\t\tconst suitability = weatherService.isSuitableForOutdoorWork(weather);\n\t\t\tresult.weather = {\n\t\t\t\tcurrent: weather.hourly?.periods?.[0]\n\t\t\t\t\t? {\n\t\t\t\t\t\t\ttemperature: weather.hourly.periods[0].temperature,\n\t\t\t\t\t\t\ttemperatureUnit: weather.hourly.periods[0].temperatureUnit,\n\t\t\t\t\t\t\tconditions: weather.hourly.periods[0].shortForecast,\n\t\t\t\t\t\t\twind: weather.hourly.periods[0].windSpeed,\n\t\t\t\t\t\t}\n\t\t\t\t\t: null,\n\t\t\t\tforecast: weather.forecast?.periods?.slice(0, 3).map((p) => ({\n\t\t\t\t\tname: p.name,\n\t\t\t\t\ttemperature: p.temperature,\n\t\t\t\t\tshortForecast: p.shortForecast,\n\t\t\t\t})),\n\t\t\t\talerts: weather.alerts.map((a) => ({\n\t\t\t\t\tevent: a.event,\n\t\t\t\t\tseverity: a.severity,\n\t\t\t\t\theadline: a.headline,\n\t\t\t\t})),\n\t\t\t\thasAlerts: weather.hasActiveAlerts,\n\t\t\t\thighestAlertSeverity: weather.highestSeverity,\n\t\t\t};\n\t\t\tresult.workSuitability = {\n\t\t\t\tsuitable: suitability.suitable,\n\t\t\t\treason: suitability.reason || \"Conditions acceptable\",\n\t\t\t\tjobType,\n\t\t\t};\n\t\t} else {\n\t\t\tresult.weather = { error: \"Weather data unavailable\" };\n\t\t\tresult.workSuitability = { suitable: null, reason: \"Unable to assess\" };\n\t\t}\n\n\t\t// Traffic conditions\n\t\tif (traffic) {\n\t\t\tresult.traffic = {\n\t\t\t\ttotalIncidents: traffic.totalIncidents,\n\t\t\t\trouteAffecting: traffic.routeAffectingIncidents,\n\t\t\t\tincidents: traffic.incidents.slice(0, 5).map((i) => ({\n\t\t\t\t\ttype: i.type,\n\t\t\t\t\tseverity: i.severity,\n\t\t\t\t\tdescription: i.description,\n\t\t\t\t})),\n\t\t\t};\n\t\t} else if (shopLat && shopLon) {\n\t\t\tresult.traffic = { error: \"Traffic data unavailable\" };\n\t\t}\n\n\t\t// Overall recommendation\n\t\tconst issues: string[] = [];\n\t\tif (weather?.hasActiveAlerts) {\n\t\t\tissues.push(`Weather alert: ${weather.highestSeverity}`);\n\t\t}\n\t\tif (weather && !weatherService.isSuitableForOutdoorWork(weather).suitable) {\n\t\t\tissues.push(\"Weather not suitable for outdoor work\");\n\t\t}\n\t\tif (traffic && traffic.routeAffectingIncidents > 0) {\n\t\t\tissues.push(`${traffic.routeAffectingIncidents} traffic incident(s) on route`);\n\t\t}\n\n\t\tresult.overallStatus = issues.length === 0 ? \"good\" : \"caution\";\n\t\tresult.issues = issues;\n\t\tresult.recommendation =\n\t\t\tissues.length === 0\n\t\t\t\t? \"Conditions look good for this job\"\n\t\t\t\t: `Review before proceeding: ${issues.join(\"; \")}`;\n\n\t\treturn result;\n\t},\n});\n\n// =============================================================================\n// CODE SEARCH TOOLS - Building, Plumbing, Electrical Codes\n// =============================================================================\n\n/**\n * Common building code references by trade type\n * This is a knowledge base that can be enhanced with actual API integrations\n */\nconst codeReferences = {\n\tplumbing: {\n\t\tname: \"Uniform Plumbing Code (UPC) / International Plumbing Code (IPC)\",\n\t\tcommonRequirements: [\n\t\t\t\"Drain pipe slope: 1/4 inch per foot minimum\",\n\t\t\t\"Vent pipes must extend through roof\",\n\t\t\t\"P-traps required on all fixtures\",\n\t\t\t\"Water heater T&P relief valve required\",\n\t\t\t\"Backflow prevention on potable water\",\n\t\t\t\"Minimum fixture unit calculations for pipe sizing\",\n\t\t\t\"Air gap requirements for indirect waste\",\n\t\t],\n\t\tpermitTriggers: [\n\t\t\t\"New water heater installation\",\n\t\t\t\"Moving or adding fixtures\",\n\t\t\t\"New water/sewer line connections\",\n\t\t\t\"Gas line work\",\n\t\t\t\"Sewer line replacement\",\n\t\t],\n\t},\n\telectrical: {\n\t\tname: \"National Electrical Code (NEC)\",\n\t\tcommonRequirements: [\n\t\t\t\"GFCI required in kitchens, bathrooms, garages, outdoors\",\n\t\t\t\"AFCI required in bedrooms and living areas\",\n\t\t\t\"Smoke detectors on every floor and bedroom\",\n\t\t\t\"Panel accessibility clearance: 36 inches\",\n\t\t\t\"Wire sizing based on amperage load\",\n\t\t\t\"Grounding requirements for all circuits\",\n\t\t\t\"Box fill calculations for junction boxes\",\n\t\t],\n\t\tpermitTriggers: [\n\t\t\t\"New circuits or subpanels\",\n\t\t\t\"Service upgrade\",\n\t\t\t\"Adding outlets or switches\",\n\t\t\t\"Electric vehicle charger installation\",\n\t\t\t\"Generator installation\",\n\t\t],\n\t},\n\thvac: {\n\t\tname: \"International Mechanical Code (IMC)\",\n\t\tcommonRequirements: [\n\t\t\t\"Proper equipment sizing (Manual J calculation)\",\n\t\t\t\"Ductwork sizing (Manual D calculation)\",\n\t\t\t\"Combustion air requirements for gas appliances\",\n\t\t\t\"Clearances from combustible materials\",\n\t\t\t\"Condensate drain requirements\",\n\t\t\t\"Refrigerant line sizing and insulation\",\n\t\t\t\"Energy efficiency minimums (SEER ratings)\",\n\t\t],\n\t\tpermitTriggers: [\n\t\t\t\"New HVAC system installation\",\n\t\t\t\"Equipment replacement (like-for-like may be exempt)\",\n\t\t\t\"Ductwork modifications\",\n\t\t\t\"Gas line work\",\n\t\t\t\"Mini-split installation\",\n\t\t],\n\t},\n\tgeneral: {\n\t\tname: \"International Building Code (IBC) / International Residential Code (IRC)\",\n\t\tcommonRequirements: [\n\t\t\t\"Egress window requirements for bedrooms\",\n\t\t\t\"Stair rise/run specifications (7.75 in max rise, 10 in min run)\",\n\t\t\t\"Handrail requirements (34-38 inches height)\",\n\t\t\t\"Smoke and CO detector placement\",\n\t\t\t\"Fire-rated assemblies where required\",\n\t\t\t\"Structural load calculations\",\n\t\t],\n\t\tpermitTriggers: [\n\t\t\t\"Structural modifications\",\n\t\t\t\"Adding/removing walls\",\n\t\t\t\"Roof replacement (varies by jurisdiction)\",\n\t\t\t\"Window/door changes\",\n\t\t\t\"Additions or conversions\",\n\t\t],\n\t},\n\troofing: {\n\t\tname: \"International Building Code (IBC) - Roofing Section\",\n\t\tcommonRequirements: [\n\t\t\t\"Minimum roof slope requirements by material\",\n\t\t\t\"Underlayment requirements\",\n\t\t\t\"Ice and water shield in cold climates\",\n\t\t\t\"Flashing requirements at penetrations\",\n\t\t\t\"Ventilation requirements (1:150 or 1:300 ratio)\",\n\t\t\t\"Fire-rated materials in certain zones\",\n\t\t],\n\t\tpermitTriggers: [\n\t\t\t\"Complete re-roof (varies by jurisdiction)\",\n\t\t\t\"Structural repairs\",\n\t\t\t\"Adding skylights or vents\",\n\t\t\t\"Changing roofing material type\",\n\t\t],\n\t},\n};\n\n/**\n * Search building codes by trade type and work description\n */\nexport const searchBuildingCodesTool = tool({\n\tdescription: `Search for relevant building code requirements based on the type of work being performed. Returns common code requirements, permit triggers, and best practices for:\n- Plumbing (UPC/IPC)\n- Electrical (NEC)\n- HVAC (IMC)\n- General construction (IBC/IRC)\n- Roofing\n\nUse this to help technicians understand code requirements before starting work.`,\n\tparameters: z.object({\n\t\ttradeType: z\n\t\t\t.enum([\"plumbing\", \"electrical\", \"hvac\", \"general\", \"roofing\"])\n\t\t\t.describe(\"The trade or type of work\"),\n\t\tworkDescription: z\n\t\t\t.string()\n\t\t\t.optional()\n\t\t\t.describe(\"Specific description of the work being performed\"),\n\t\tstate: z\n\t\t\t.string()\n\t\t\t.optional()\n\t\t\t.describe(\"State abbreviation (codes vary by jurisdiction)\"),\n\t}),\n\texecute: async ({ tradeType, workDescription, state }) => {\n\t\tconst codeInfo = codeReferences[tradeType];\n\n\t\t// Build relevance context\n\t\tconst relevantRequirements: string[] = [];\n\t\tif (workDescription) {\n\t\t\tconst desc = workDescription.toLowerCase();\n\n\t\t\t// Filter requirements based on work description keywords\n\t\t\tfor (const req of codeInfo.commonRequirements) {\n\t\t\t\tconst reqLower = req.toLowerCase();\n\t\t\t\t// Simple relevance matching\n\t\t\t\tconst keywords = desc.split(/\\s+/);\n\t\t\t\tif (keywords.some((kw) => kw.length > 3 && reqLower.includes(kw))) {\n\t\t\t\t\trelevantRequirements.push(req);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\ttradeType,\n\t\t\tcodeName: codeInfo.name,\n\t\t\tcommonRequirements: codeInfo.commonRequirements,\n\t\t\trelevantToWork:\n\t\t\t\trelevantRequirements.length > 0 ? relevantRequirements : null,\n\t\t\tpermitTriggers: codeInfo.permitTriggers,\n\t\t\tjurisdictionNote: state\n\t\t\t\t? `Note: Requirements may vary in ${state}. Always verify with local building department.`\n\t\t\t\t: \"Requirements vary by jurisdiction. Always verify with local building department.\",\n\t\t\tdisclaimer:\n\t\t\t\t\"This is general guidance only. Consult actual code books and local jurisdiction for specific requirements.\",\n\t\t};\n\t},\n});\n\n/**\n * Get permit requirements for a specific type of work\n */\nexport const getPermitRequirementsTool = tool({\n\tdescription: `Determine if a permit is likely required for specific work and what type of permit. Helps field service companies understand when to pull permits and advise customers.\n\nReturns:\n- Whether permit is typically required\n- Type of permit needed\n- Common exceptions\n- Inspection requirements`,\n\tparameters: z.object({\n\t\tworkType: z.string().describe(\"Type of work being performed (e.g., 'water heater replacement', 'outlet installation')\"),\n\t\tpropertyType: z\n\t\t\t.enum([\"residential\", \"commercial\"])\n\t\t\t.optional()\n\t\t\t.default(\"residential\"),\n\t\tcity: z.string().optional().describe(\"City for jurisdiction-specific guidance\"),\n\t\tstate: z.string().optional().describe(\"State abbreviation\"),\n\t}),\n\texecute: async ({ workType, propertyType, city, state }) => {\n\t\tconst workLower = workType.toLowerCase();\n\n\t\t// Analyze work type to determine permit requirements\n\t\tlet permitRequired = false;\n\t\tlet permitType = \"unknown\";\n\t\tlet confidence = \"medium\";\n\t\tconst notes: string[] = [];\n\t\tconst inspections: string[] = [];\n\n\t\t// Electrical work\n\t\tif (\n\t\t\tworkLower.includes(\"outlet\") ||\n\t\t\tworkLower.includes(\"circuit\") ||\n\t\t\tworkLower.includes(\"panel\") ||\n\t\t\tworkLower.includes(\"electrical\") ||\n\t\t\tworkLower.includes(\"wire\") ||\n\t\t\tworkLower.includes(\"ev charger\")\n\t\t) {\n\t\t\tpermitRequired = true;\n\t\t\tpermitType = \"electrical\";\n\t\t\tinspections.push(\"Rough-in inspection\", \"Final inspection\");\n\t\t\tif (workLower.includes(\"panel\") || workLower.includes(\"service\")) {\n\t\t\t\tnotes.push(\"Service upgrades typically require utility coordination\");\n\t\t\t}\n\t\t}\n\n\t\t// Plumbing work\n\t\tif (\n\t\t\tworkLower.includes(\"water heater\") ||\n\t\t\tworkLower.includes(\"plumbing\") ||\n\t\t\tworkLower.includes(\"sewer\") ||\n\t\t\tworkLower.includes(\"drain\") ||\n\t\t\tworkLower.includes(\"fixture\")\n\t\t) {\n\t\t\tpermitRequired = true;\n\t\t\tpermitType = \"plumbing\";\n\t\t\tinspections.push(\"Rough-in inspection\", \"Final inspection\");\n\t\t\tif (workLower.includes(\"water heater\")) {\n\t\t\t\tnotes.push(\"Water heater permits often include gas and electrical inspections\");\n\t\t\t\tconfidence = \"high\";\n\t\t\t}\n\t\t}\n\n\t\t// HVAC work\n\t\tif (\n\t\t\tworkLower.includes(\"hvac\") ||\n\t\t\tworkLower.includes(\"furnace\") ||\n\t\t\tworkLower.includes(\"air condition\") ||\n\t\t\tworkLower.includes(\"ac \") ||\n\t\t\tworkLower.includes(\"heat pump\") ||\n\t\t\tworkLower.includes(\"mini-split\")\n\t\t) {\n\t\t\tpermitRequired = true;\n\t\t\tpermitType = \"mechanical\";\n\t\t\tinspections.push(\"Final inspection\");\n\t\t\tnotes.push(\"EPA certification required for refrigerant handling\");\n\t\t}\n\n\t\t// Roofing\n\t\tif (workLower.includes(\"roof\") || workLower.includes(\"re-roof\")) {\n\t\t\tpermitRequired = true;\n\t\t\tpermitType = \"building/roofing\";\n\t\t\tinspections.push(\"Final inspection\");\n\t\t\tnotes.push(\"Requirements vary significantly by jurisdiction - some exempt repairs under certain square footage\");\n\t\t\tconfidence = \"low\";\n\t\t}\n\n\t\t// Gas work\n\t\tif (\n\t\t\tworkLower.includes(\"gas line\") ||\n\t\t\tworkLower.includes(\"gas pipe\")\n\t\t) {\n\t\t\tpermitRequired = true;\n\t\t\tpermitType = \"gas/plumbing\";\n\t\t\tinspections.push(\"Pressure test inspection\", \"Final inspection\");\n\t\t\tnotes.push(\"Gas work requires licensed gas fitter in most jurisdictions\");\n\t\t\tconfidence = \"high\";\n\t\t}\n\n\t\t// Minor repairs generally don't require permits\n\t\tif (\n\t\t\tworkLower.includes(\"repair\") &&\n\t\t\t!workLower.includes(\"replace\") &&\n\t\t\t!workLower.includes(\"install\")\n\t\t) {\n\t\t\tpermitRequired = false;\n\t\t\tnotes.push(\"Minor repairs typically exempt, but verify with local jurisdiction\");\n\t\t\tconfidence = \"low\";\n\t\t}\n\n\t\t// Like-for-like replacements\n\t\tif (workLower.includes(\"like for like\") || workLower.includes(\"same location\")) {\n\t\t\tnotes.push(\"Like-for-like replacements may be exempt in some jurisdictions\");\n\t\t\tconfidence = \"low\";\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tworkType,\n\t\t\tpropertyType,\n\t\t\tlocation: city && state ? `${city}, ${state}` : state || \"Not specified\",\n\t\t\tpermitRequired,\n\t\t\tpermitType: permitRequired ? permitType : null,\n\t\t\tconfidence,\n\t\t\ttypicalInspections: permitRequired ? inspections : [],\n\t\t\tnotes,\n\t\t\trecommendations: permitRequired\n\t\t\t\t? [\n\t\t\t\t\t\t\"Contact local building department for specific requirements\",\n\t\t\t\t\t\t\"Have contractor license number ready\",\n\t\t\t\t\t\t\"Allow 1-3 business days for permit processing\",\n\t\t\t\t\t\t\"Schedule inspections in advance\",\n\t\t\t\t\t]\n\t\t\t\t: [\n\t\t\t\t\t\t\"Document work performed for records\",\n\t\t\t\t\t\t\"When in doubt, contact local building department\",\n\t\t\t\t\t],\n\t\t\tdisclaimer:\n\t\t\t\t\"Permit requirements vary by jurisdiction. Always verify with local building department.\",\n\t\t};\n\t},\n});\n\n/**\n * Get safety and code compliance checklist for a job type\n */\nexport const getCodeComplianceChecklistTool = tool({\n\tdescription: `Generate a code compliance and safety checklist for a specific type of job. Helps technicians ensure they're meeting code requirements during installation or repair.\n\nReturns a checklist of items to verify for code compliance.`,\n\tparameters: z.object({\n\t\tjobType: z.string().describe(\"Type of job (e.g., 'water heater installation', 'panel upgrade', 'AC replacement')\"),\n\t\tincludesSafety: z\n\t\t\t.boolean()\n\t\t\t.optional()\n\t\t\t.default(true)\n\t\t\t.describe(\"Include safety checklist items\"),\n\t}),\n\texecute: async ({ jobType, includesSafety }) => {\n\t\tconst jobLower = jobType.toLowerCase();\n\t\tconst checklist: Array<{ category: string; items: string[] }> = [];\n\n\t\t// Water heater specific\n\t\tif (\n\t\t\tjobLower.includes(\"water heater\") ||\n\t\t\tjobLower.includes(\"hot water\")\n\t\t) {\n\t\t\tchecklist.push({\n\t\t\t\tcategory: \"Temperature & Pressure Relief\",\n\t\t\t\titems: [\n\t\t\t\t\t\"T&P relief valve installed in top 6 inches of tank\",\n\t\t\t\t\t\"Discharge pipe routes to within 6 inches of floor\",\n\t\t\t\t\t\"Discharge pipe same size as valve outlet\",\n\t\t\t\t\t\"No valves or restrictions in discharge line\",\n\t\t\t\t],\n\t\t\t});\n\t\t\tchecklist.push({\n\t\t\t\tcategory: \"Seismic & Stability\",\n\t\t\t\titems: [\n\t\t\t\t\t\"Seismic straps installed (required in seismic zones)\",\n\t\t\t\t\t\"Unit stable and level\",\n\t\t\t\t\t\"Proper clearances maintained\",\n\t\t\t\t],\n\t\t\t});\n\t\t\tchecklist.push({\n\t\t\t\tcategory: \"Connections\",\n\t\t\t\titems: [\n\t\t\t\t\t\"Proper venting for gas units (draft hood, flue)\",\n\t\t\t\t\t\"Gas shutoff valve accessible\",\n\t\t\t\t\t\"Sediment trap on gas line\",\n\t\t\t\t\t\"Dielectric unions on water connections\",\n\t\t\t\t\t\"Expansion tank installed if closed system\",\n\t\t\t\t],\n\t\t\t});\n\t\t}\n\n\t\t// Electrical panel/service\n\t\tif (\n\t\t\tjobLower.includes(\"panel\") ||\n\t\t\tjobLower.includes(\"electrical\") ||\n\t\t\tjobLower.includes(\"breaker\")\n\t\t) {\n\t\t\tchecklist.push({\n\t\t\t\tcategory: \"Panel Requirements\",\n\t\t\t\titems: [\n\t\t\t\t\t\"36-inch clearance in front of panel\",\n\t\t\t\t\t\"30-inch width clearance\",\n\t\t\t\t\t\"78-inch height clearance\",\n\t\t\t\t\t\"Panel cover intact and secured\",\n\t\t\t\t\t\"All breakers labeled\",\n\t\t\t\t\t\"No exposed conductors\",\n\t\t\t\t],\n\t\t\t});\n\t\t\tchecklist.push({\n\t\t\t\tcategory: \"Grounding & Bonding\",\n\t\t\t\titems: [\n\t\t\t\t\t\"Ground rod(s) installed\",\n\t\t\t\t\t\"Bonding jumper at water heater\",\n\t\t\t\t\t\"CSST gas line bonded (if applicable)\",\n\t\t\t\t\t\"Grounding electrode conductor sized properly\",\n\t\t\t\t],\n\t\t\t});\n\t\t}\n\n\t\t// HVAC\n\t\tif (\n\t\t\tjobLower.includes(\"hvac\") ||\n\t\t\tjobLower.includes(\"furnace\") ||\n\t\t\tjobLower.includes(\"ac\") ||\n\t\t\tjobLower.includes(\"heat pump\")\n\t\t) {\n\t\t\tchecklist.push({\n\t\t\t\tcategory: \"Equipment Installation\",\n\t\t\t\titems: [\n\t\t\t\t\t\"Clearances from combustibles maintained\",\n\t\t\t\t\t\"Condensate drain properly routed\",\n\t\t\t\t\t\"Secondary drain pan with float switch (if in attic)\",\n\t\t\t\t\t\"Filter access provided\",\n\t\t\t\t\t\"Disconnect within sight of unit\",\n\t\t\t\t],\n\t\t\t});\n\t\t\tchecklist.push({\n\t\t\t\tcategory: \"Ductwork & Airflow\",\n\t\t\t\titems: [\n\t\t\t\t\t\"Supply and return balanced\",\n\t\t\t\t\t\"Duct connections sealed\",\n\t\t\t\t\t\"No kinks in flex duct\",\n\t\t\t\t\t\"Adequate return air\",\n\t\t\t\t],\n\t\t\t});\n\t\t\tif (jobLower.includes(\"gas\") || jobLower.includes(\"furnace\")) {\n\t\t\t\tchecklist.push({\n\t\t\t\t\tcategory: \"Gas & Combustion\",\n\t\t\t\t\titems: [\n\t\t\t\t\t\t\"Combustion air adequate\",\n\t\t\t\t\t\t\"Gas pressure verified\",\n\t\t\t\t\t\t\"CO testing performed\",\n\t\t\t\t\t\t\"Heat exchanger inspected\",\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Safety checklist\n\t\tif (includesSafety) {\n\t\t\tchecklist.push({\n\t\t\t\tcategory: \"General Safety\",\n\t\t\t\titems: [\n\t\t\t\t\t\"Work area secured and clean\",\n\t\t\t\t\t\"PPE used appropriately\",\n\t\t\t\t\t\"All utilities verified off before work\",\n\t\t\t\t\t\"Test equipment calibrated\",\n\t\t\t\t\t\"Customer informed of work\",\n\t\t\t\t],\n\t\t\t});\n\t\t}\n\n\t\t// If no specific checklist matched, provide general\n\t\tif (checklist.length === (includesSafety ? 1 : 0)) {\n\t\t\tchecklist.unshift({\n\t\t\t\tcategory: \"General Code Compliance\",\n\t\t\t\titems: [\n\t\t\t\t\t\"Work matches permit scope (if applicable)\",\n\t\t\t\t\t\"Materials meet code requirements\",\n\t\t\t\t\t\"Manufacturer installation instructions followed\",\n\t\t\t\t\t\"All connections secure\",\n\t\t\t\t\t\"System tested and operational\",\n\t\t\t\t\t\"Area cleaned up\",\n\t\t\t\t],\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tjobType,\n\t\t\tchecklist,\n\t\t\ttotalItems: checklist.reduce((sum, cat) => sum + cat.items.length, 0),\n\t\t\treminder:\n\t\t\t\t\"Document completion of each item. Photos recommended for permit inspections.\",\n\t\t\tdisclaimer:\n\t\t\t\t\"This checklist is general guidance. Refer to local codes and manufacturer instructions.\",\n\t\t};\n\t},\n});\n\n// =============================================================================\n// PROACTIVE LEARNING SYSTEM - Auto-learn from customer interactions\n// =============================================================================\n\n/**\n * Analyze recent communications to extract learnings\n *\n * Scans recent communications and extracts insights that can be stored\n * to memory for future reference\n */\nexport const analyzeRecentCommunicationsTool = tool({\n\tdescription: `Proactively analyze recent customer communications to extract insights and learnings. Scans the last N days of communications and identifies:\n- Customer preferences mentioned in calls/emails\n- Common issues or complaints\n- Positive feedback and compliments\n- Service requests patterns\n- Emergency situations or urgent needs\n\nUse this for periodic learning runs to build customer knowledge.`,\n\tparameters: z.object({\n\t\tcompanyId: z.string().describe(\"Company ID\"),\n\t\tdaysBack: z\n\t\t\t.number()\n\t\t\t.optional()\n\t\t\t.default(7)\n\t\t\t.describe(\"Number of days to look back\"),\n\t\tlimit: z\n\t\t\t.number()\n\t\t\t.optional()\n\t\t\t.default(50)\n\t\t\t.describe(\"Maximum communications to analyze\"),\n\t\tfocusArea: z\n\t\t\t.enum([\"all\", \"preferences\", \"issues\", \"feedback\", \"urgent\"])\n\t\t\t.optional()\n\t\t\t.default(\"all\")\n\t\t\t.describe(\"Focus on specific type of insights\"),\n\t}),\n\texecute: async ({ companyId, daysBack, limit, focusArea }) => {\n\t\tconst { createServiceSupabaseClient } = await import(\n\t\t\t\"@/lib/supabase/service-client\"\n\t\t);\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst startDate = new Date();\n\t\tstartDate.setDate(startDate.getDate() - daysBack);\n\n\t\t// Get recent communications with transcripts\n\t\tconst { data: comms, error } = await supabase\n\t\t\t.from(\"communications\")\n\t\t\t.select(\n\t\t\t\t`\n\t\t\t\tid,\n\t\t\t\tchannel,\n\t\t\t\tdirection,\n\t\t\t\tcall_transcript,\n\t\t\t\tcall_sentiment,\n\t\t\t\tbody_plain,\n\t\t\t\tcustomer_id,\n\t\t\t\tcreated_at,\n\t\t\t\tcustomer:customers!customer_id(id, name)\n\t\t\t`\n\t\t\t)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.gte(\"created_at\", startDate.toISOString())\n\t\t\t.not(\"call_transcript\", \"is\", null)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(limit);\n\n\t\tif (error || !comms) {\n\t\t\treturn { success: false, error: error?.message || \"No communications found\" };\n\t\t}\n\n\t\tconst insights: Array<{\n\t\t\tcustomerId: string | null;\n\t\t\tcustomerName: string | null;\n\t\t\ttype: string;\n\t\t\tcontent: string;\n\t\t\tsource: string;\n\t\t\timportance: \"low\" | \"medium\" | \"high\";\n\t\t}> = [];\n\n\t\t// Pattern matching for different insight types\n\t\tconst patterns = {\n\t\t\tpreferences: [\n\t\t\t\t/prefer[s]?\\s+([^.]+)/gi,\n\t\t\t\t/like[s]?\\s+([^.]+)/gi,\n\t\t\t\t/want[s]?\\s+([^.]+)/gi,\n\t\t\t\t/always\\s+([^.]+)/gi,\n\t\t\t\t/please\\s+([^.]+)/gi,\n\t\t\t],\n\t\t\tissues: [\n\t\t\t\t/problem[s]?\\s+with\\s+([^.]+)/gi,\n\t\t\t\t/issue[s]?\\s+with\\s+([^.]+)/gi,\n\t\t\t\t/not\\s+working\\s+([^.]+)/gi,\n\t\t\t\t/broken\\s+([^.]+)/gi,\n\t\t\t\t/complaint[s]?\\s+about\\s+([^.]+)/gi,\n\t\t\t\t/frustrated\\s+([^.]+)/gi,\n\t\t\t],\n\t\t\tfeedback: [\n\t\t\t\t/great\\s+([^.]+)/gi,\n\t\t\t\t/excellent\\s+([^.]+)/gi,\n\t\t\t\t/thank\\s+you\\s+for\\s+([^.]+)/gi,\n\t\t\t\t/appreciate\\s+([^.]+)/gi,\n\t\t\t\t/happy\\s+with\\s+([^.]+)/gi,\n\t\t\t],\n\t\t\turgent: [\n\t\t\t\t/emergency\\s+([^.]+)/gi,\n\t\t\t\t/urgent\\s+([^.]+)/gi,\n\t\t\t\t/asap\\s+([^.]+)/gi,\n\t\t\t\t/right\\s+away\\s+([^.]+)/gi,\n\t\t\t\t/immediately\\s+([^.]+)/gi,\n\t\t\t],\n\t\t};\n\n\t\tfor (const comm of comms) {\n\t\t\tconst content = comm.call_transcript || comm.body_plain || \"\";\n\t\t\tif (!content) continue;\n\n\t\t\tconst customer = comm.customer as { id: string; name: string } | null;\n\n\t\t\t// Extract insights based on focus area\n\t\t\tconst areasToScan =\n\t\t\t\tfocusArea === \"all\"\n\t\t\t\t\t? (Object.keys(patterns) as Array<keyof typeof patterns>)\n\t\t\t\t\t: [focusArea as keyof typeof patterns];\n\n\t\t\tfor (const area of areasToScan) {\n\t\t\t\tfor (const pattern of patterns[area] || []) {\n\t\t\t\t\tconst matches = content.matchAll(pattern);\n\t\t\t\t\tfor (const match of matches) {\n\t\t\t\t\t\tinsights.push({\n\t\t\t\t\t\t\tcustomerId: comm.customer_id,\n\t\t\t\t\t\t\tcustomerName: customer?.name || null,\n\t\t\t\t\t\t\ttype: area,\n\t\t\t\t\t\t\tcontent: match[0],\n\t\t\t\t\t\t\tsource: `${comm.channel} on ${new Date(comm.created_at).toLocaleDateString()}`,\n\t\t\t\t\t\t\timportance: area === \"urgent\" || area === \"issues\" ? \"high\" : \"medium\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Also flag negative sentiment calls\n\t\t\tif (\n\t\t\t\tcomm.call_sentiment &&\n\t\t\t\t[\"negative\", \"very_negative\"].includes(comm.call_sentiment)\n\t\t\t) {\n\t\t\t\tinsights.push({\n\t\t\t\t\tcustomerId: comm.customer_id,\n\t\t\t\t\tcustomerName: customer?.name || null,\n\t\t\t\t\ttype: \"sentiment\",\n\t\t\t\t\tcontent: `Negative sentiment detected in ${comm.channel} communication`,\n\t\t\t\t\tsource: `${comm.channel} on ${new Date(comm.created_at).toLocaleDateString()}`,\n\t\t\t\t\timportance: \"high\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tcommunicationsAnalyzed: comms.length,\n\t\t\tdaysBack,\n\t\t\tfocusArea,\n\t\t\tinsightsFound: insights.length,\n\t\t\tinsights: insights.slice(0, 100), // Limit response size\n\t\t\tsummary: {\n\t\t\t\tbyType: {\n\t\t\t\t\tpreferences: insights.filter((i) => i.type === \"preferences\").length,\n\t\t\t\t\tissues: insights.filter((i) => i.type === \"issues\").length,\n\t\t\t\t\tfeedback: insights.filter((i) => i.type === \"feedback\").length,\n\t\t\t\t\turgent: insights.filter((i) => i.type === \"urgent\").length,\n\t\t\t\t\tsentiment: insights.filter((i) => i.type === \"sentiment\").length,\n\t\t\t\t},\n\t\t\t\thighImportance: insights.filter((i) => i.importance === \"high\").length,\n\t\t\t},\n\t\t};\n\t},\n});\n\n/**\n * Learn from completed jobs to improve future recommendations\n */\nexport const learnFromCompletedJobsTool = tool({\n\tdescription: `Analyze completed jobs to learn patterns about:\n- Common job durations by type\n- Frequently used materials\n- Customer satisfaction indicators\n- Technician performance patterns\n- Seasonal job patterns\n\nHelps improve scheduling and resource allocation.`,\n\tparameters: z.object({\n\t\tcompanyId: z.string().describe(\"Company ID\"),\n\t\tdaysBack: z\n\t\t\t.number()\n\t\t\t.optional()\n\t\t\t.default(30)\n\t\t\t.describe(\"Days to look back\"),\n\t\tjobType: z\n\t\t\t.string()\n\t\t\t.optional()\n\t\t\t.describe(\"Filter by job type\"),\n\t}),\n\texecute: async ({ companyId, daysBack, jobType }) => {\n\t\tconst { createServiceSupabaseClient } = await import(\n\t\t\t\"@/lib/supabase/service-client\"\n\t\t);\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\tconst startDate = new Date();\n\t\tstartDate.setDate(startDate.getDate() - daysBack);\n\n\t\tlet query = supabase\n\t\t\t.from(\"jobs\")\n\t\t\t.select(\n\t\t\t\t`\n\t\t\t\tid,\n\t\t\t\ttitle,\n\t\t\t\tjob_type,\n\t\t\t\tstatus,\n\t\t\t\tscheduled_start,\n\t\t\t\tscheduled_end,\n\t\t\t\tactual_start,\n\t\t\t\tactual_end,\n\t\t\t\ttotal_amount,\n\t\t\t\tcustomer:customers!customer_id(name),\n\t\t\t\tproperty:properties!property_id(address_line1, city)\n\t\t\t`\n\t\t\t)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"status\", \"completed\")\n\t\t\t.gte(\"created_at\", startDate.toISOString())\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(100);\n\n\t\tif (jobType) {\n\t\t\tquery = query.eq(\"job_type\", jobType);\n\t\t}\n\n\t\tconst { data: jobs, error } = await query;\n\n\t\tif (error || !jobs) {\n\t\t\treturn { success: false, error: error?.message || \"No jobs found\" };\n\t\t}\n\n\t\t// Analyze job patterns\n\t\tconst durationAnalysis: Record<string, number[]> = {};\n\t\tconst revenueAnalysis: Record<string, number[]> = {};\n\t\tconst accuracyAnalysis: Array<{\n\t\t\tjobType: string;\n\t\t\tscheduledMinutes: number;\n\t\t\tactualMinutes: number;\n\t\t\taccuracy: number;\n\t\t}> = [];\n\n\t\tfor (const job of jobs) {\n\t\t\tconst type = job.job_type || \"unknown\";\n\n\t\t\t// Duration analysis\n\t\t\tif (job.actual_start && job.actual_end) {\n\t\t\t\tconst actualMinutes =\n\t\t\t\t\t(new Date(job.actual_end).getTime() -\n\t\t\t\t\t\tnew Date(job.actual_start).getTime()) /\n\t\t\t\t\t60000;\n\t\t\t\tif (!durationAnalysis[type]) durationAnalysis[type] = [];\n\t\t\t\tdurationAnalysis[type].push(actualMinutes);\n\n\t\t\t\t// Scheduling accuracy\n\t\t\t\tif (job.scheduled_start && job.scheduled_end) {\n\t\t\t\t\tconst scheduledMinutes =\n\t\t\t\t\t\t(new Date(job.scheduled_end).getTime() -\n\t\t\t\t\t\t\tnew Date(job.scheduled_start).getTime()) /\n\t\t\t\t\t\t60000;\n\t\t\t\t\taccuracyAnalysis.push({\n\t\t\t\t\t\tjobType: type,\n\t\t\t\t\t\tscheduledMinutes,\n\t\t\t\t\t\tactualMinutes,\n\t\t\t\t\t\taccuracy: Math.min(scheduledMinutes / actualMinutes, actualMinutes / scheduledMinutes) * 100,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Revenue analysis\n\t\t\tif (job.total_amount) {\n\t\t\t\tif (!revenueAnalysis[type]) revenueAnalysis[type] = [];\n\t\t\t\trevenueAnalysis[type].push(job.total_amount);\n\t\t\t}\n\t\t}\n\n\t\t// Calculate averages\n\t\tconst durationSummary: Record<\n\t\t\tstring,\n\t\t\t{ avg: number; min: number; max: number; count: number }\n\t\t> = {};\n\t\tfor (const [type, durations] of Object.entries(durationAnalysis)) {\n\t\t\tconst avg = durations.reduce((a, b) => a + b, 0) / durations.length;\n\t\t\tdurationSummary[type] = {\n\t\t\t\tavg: Math.round(avg),\n\t\t\t\tmin: Math.round(Math.min(...durations)),\n\t\t\t\tmax: Math.round(Math.max(...durations)),\n\t\t\t\tcount: durations.length,\n\t\t\t};\n\t\t}\n\n\t\tconst revenueSummary: Record<\n\t\t\tstring,\n\t\t\t{ avg: number; min: number; max: number; count: number }\n\t\t> = {};\n\t\tfor (const [type, amounts] of Object.entries(revenueAnalysis)) {\n\t\t\tconst avg = amounts.reduce((a, b) => a + b, 0) / amounts.length;\n\t\t\trevenueSummary[type] = {\n\t\t\t\tavg: Math.round(avg * 100) / 100,\n\t\t\t\tmin: Math.min(...amounts),\n\t\t\t\tmax: Math.max(...amounts),\n\t\t\t\tcount: amounts.length,\n\t\t\t};\n\t\t}\n\n\t\t// Scheduling accuracy summary\n\t\tconst avgAccuracy =\n\t\t\taccuracyAnalysis.length > 0\n\t\t\t\t? accuracyAnalysis.reduce((sum, a) => sum + a.accuracy, 0) /\n\t\t\t\t\taccuracyAnalysis.length\n\t\t\t\t: null;\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tjobsAnalyzed: jobs.length,\n\t\t\tdaysBack,\n\t\t\tinsights: {\n\t\t\t\tdurationByType: durationSummary,\n\t\t\t\trevenueByType: revenueSummary,\n\t\t\t\tschedulingAccuracy: avgAccuracy\n\t\t\t\t\t? `${Math.round(avgAccuracy)}% average accuracy`\n\t\t\t\t\t: \"Insufficient data\",\n\t\t\t},\n\t\t\trecommendations: Object.entries(durationSummary).map(([type, stats]) => ({\n\t\t\t\tjobType: type,\n\t\t\t\trecommendedDuration: stats.avg,\n\t\t\t\tnote:\n\t\t\t\t\tstats.max > stats.avg * 1.5\n\t\t\t\t\t\t? `Consider allocating buffer time - some ${type} jobs take up to ${stats.max} minutes`\n\t\t\t\t\t\t: null,\n\t\t\t})),\n\t\t};\n\t},\n});\n\n/**\n * Build customer profile from all available data\n */\nexport const buildCustomerProfileTool = tool({\n\tdescription: `Build a comprehensive customer profile by aggregating all available data:\n- Communication history and sentiment\n- Job history and preferences\n- Payment history\n- Property information\n- Stored memories and notes\n\nUse this to prepare for customer interactions or to understand customer value.`,\n\tparameters: z.object({\n\t\tcustomerId: z.string().describe(\"Customer UUID\"),\n\t\tcompanyId: z.string().describe(\"Company ID\"),\n\t}),\n\texecute: async ({ customerId, companyId }) => {\n\t\tconst { createServiceSupabaseClient } = await import(\n\t\t\t\"@/lib/supabase/service-client\"\n\t\t);\n\t\tconst supabase = createServiceSupabaseClient();\n\n\t\t// Fetch all customer data in parallel\n\t\tconst [\n\t\t\tcustomerResult,\n\t\t\tjobsResult,\n\t\t\tcommsResult,\n\t\t\tinvoicesResult,\n\t\t\tmemoriesResult,\n\t\t] = await Promise.all([\n\t\t\tsupabase\n\t\t\t\t.from(\"customers\")\n\t\t\t\t.select(\"*\")\n\t\t\t\t.eq(\"id\", customerId)\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.single(),\n\t\t\tsupabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\"id, title, job_type, status, total_amount, created_at\")\n\t\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t\t.limit(20),\n\t\t\tsupabase\n\t\t\t\t.from(\"communications\")\n\t\t\t\t.select(\"id, channel, direction, call_sentiment, created_at\")\n\t\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t\t.limit(50),\n\t\t\tsupabase\n\t\t\t\t.from(\"invoices\")\n\t\t\t\t.select(\"id, status, total, paid_amount, created_at\")\n\t\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t\t.limit(20),\n\t\t\tsupabase\n\t\t\t\t.from(\"ai_memory\")\n\t\t\t\t.select(\"content, memory_type, importance, created_at\")\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.eq(\"entity_id\", customerId)\n\t\t\t\t.eq(\"entity_type\", \"customer\")\n\t\t\t\t.order(\"importance\", { ascending: false })\n\t\t\t\t.limit(20),\n\t\t]);\n\n\t\tconst customer = customerResult.data;\n\t\tconst jobs = jobsResult.data || [];\n\t\tconst comms = commsResult.data || [];\n\t\tconst invoices = invoicesResult.data || [];\n\t\tconst memories = memoriesResult.data || [];\n\n\t\tif (!customer) {\n\t\t\treturn { success: false, error: \"Customer not found\" };\n\t\t}\n\n\t\t// Analyze job history\n\t\tconst completedJobs = jobs.filter((j) => j.status === \"completed\");\n\t\tconst totalRevenue = jobs.reduce((sum, j) => sum + (j.total_amount || 0), 0);\n\t\tconst jobTypes = [...new Set(jobs.map((j) => j.job_type).filter(Boolean))];\n\n\t\t// Analyze communication sentiment\n\t\tconst sentiments = comms\n\t\t\t.map((c) => c.call_sentiment)\n\t\t\t.filter(Boolean);\n\t\tconst negativeSentiments = sentiments.filter(\n\t\t\t(s) => s === \"negative\" || s === \"very_negative\"\n\t\t).length;\n\t\tconst positiveSentiments = sentiments.filter(\n\t\t\t(s) => s === \"positive\" || s === \"very_positive\"\n\t\t).length;\n\n\t\t// Analyze payment behavior\n\t\tconst paidInvoices = invoices.filter((i) => i.status === \"paid\");\n\t\tconst overdueInvoices = invoices.filter((i) => i.status === \"overdue\");\n\t\tconst totalOwed = invoices\n\t\t\t.filter((i) => i.status !== \"paid\")\n\t\t\t.reduce((sum, i) => sum + ((i.total || 0) - (i.paid_amount || 0)), 0);\n\n\t\t// Customer tier based on revenue and history\n\t\tlet tier: \"new\" | \"regular\" | \"vip\" | \"at_risk\" = \"new\";\n\t\tif (completedJobs.length >= 5 && totalRevenue > 5000) {\n\t\t\ttier = \"vip\";\n\t\t} else if (completedJobs.length >= 2) {\n\t\t\ttier = \"regular\";\n\t\t}\n\t\tif (negativeSentiments > positiveSentiments || overdueInvoices.length > 2) {\n\t\t\ttier = \"at_risk\";\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tcustomer: {\n\t\t\t\tid: customer.id,\n\t\t\t\tname: customer.name,\n\t\t\t\temail: customer.email,\n\t\t\t\tphone: customer.phone,\n\t\t\t\tcreatedAt: customer.created_at,\n\t\t\t},\n\t\t\ttier,\n\t\t\tjobHistory: {\n\t\t\t\ttotalJobs: jobs.length,\n\t\t\t\tcompletedJobs: completedJobs.length,\n\t\t\t\ttotalRevenue,\n\t\t\t\tcommonJobTypes: jobTypes,\n\t\t\t\trecentJobs: jobs.slice(0, 5).map((j) => ({\n\t\t\t\t\ttitle: j.title,\n\t\t\t\t\ttype: j.job_type,\n\t\t\t\t\tstatus: j.status,\n\t\t\t\t\tamount: j.total_amount,\n\t\t\t\t})),\n\t\t\t},\n\t\t\tcommunicationHistory: {\n\t\t\t\ttotalInteractions: comms.length,\n\t\t\t\tchannelBreakdown: {\n\t\t\t\t\tcalls: comms.filter((c) => c.channel === \"phone\").length,\n\t\t\t\t\temails: comms.filter((c) => c.channel === \"email\").length,\n\t\t\t\t\tsms: comms.filter((c) => c.channel === \"sms\").length,\n\t\t\t\t},\n\t\t\t\tsentimentSummary: {\n\t\t\t\t\tpositive: positiveSentiments,\n\t\t\t\t\tnegative: negativeSentiments,\n\t\t\t\t\tneutral: sentiments.length - positiveSentiments - negativeSentiments,\n\t\t\t\t},\n\t\t\t},\n\t\t\tfinancials: {\n\t\t\t\ttotalInvoices: invoices.length,\n\t\t\t\tpaidInvoices: paidInvoices.length,\n\t\t\t\toverdueInvoices: overdueInvoices.length,\n\t\t\t\tcurrentBalance: totalOwed,\n\t\t\t\tpaymentHealth:\n\t\t\t\t\toverdueInvoices.length === 0\n\t\t\t\t\t\t? \"good\"\n\t\t\t\t\t\t: overdueInvoices.length < 3\n\t\t\t\t\t\t\t? \"fair\"\n\t\t\t\t\t\t\t: \"poor\",\n\t\t\t},\n\t\t\tmemories: memories.map((m) => ({\n\t\t\t\tcontent: m.content,\n\t\t\t\ttype: m.memory_type,\n\t\t\t\timportance: m.importance,\n\t\t\t})),\n\t\t\trecommendations:\n\t\t\t\ttier === \"at_risk\"\n\t\t\t\t\t? [\n\t\t\t\t\t\t\t\"Review recent negative interactions\",\n\t\t\t\t\t\t\t\"Consider follow-up call to address concerns\",\n\t\t\t\t\t\t\t\"Check for outstanding payment issues\",\n\t\t\t\t\t\t]\n\t\t\t\t\t: tier === \"vip\"\n\t\t\t\t\t\t? [\n\t\t\t\t\t\t\t\t\"Prioritize this customer's requests\",\n\t\t\t\t\t\t\t\t\"Consider loyalty discount or perks\",\n\t\t\t\t\t\t\t\t\"Proactive maintenance reminders\",\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t: [\"Standard service approach\", \"Opportunity to build relationship\"],\n\t\t};\n\t},\n});\n\n// ============================================================================\n// ROUTE OPTIMIZATION TOOLS\n// Integration with routing-service.ts for directions and supplier finding\n// ============================================================================\n\n/**\n * Get driving route between two or more locations\n */\nexport const getRouteTool = tool({\n\tdescription:\n\t\t\"Calculate optimal driving route between locations with distance and duration\",\n\tparameters: z.object({\n\t\tcompanyId: z.string().describe(\"Company UUID\"),\n\t\twaypoints: z\n\t\t\t.array(\n\t\t\t\tz.object({\n\t\t\t\t\taddress: z.string().describe(\"Full address\"),\n\t\t\t\t\tlat: z.number().optional().describe(\"Latitude if known\"),\n\t\t\t\t\tlng: z.number().optional().describe(\"Longitude if known\"),\n\t\t\t\t})\n\t\t\t)\n\t\t\t.min(2)\n\t\t\t.describe(\"Array of waypoints (minimum 2: origin and destination)\"),\n\t\toptimizeOrder: z\n\t\t\t.boolean()\n\t\t\t.optional()\n\t\t\t.default(false)\n\t\t\t.describe(\"Whether to optimize waypoint order for shortest route\"),\n\t}),\n\texecute: async ({ waypoints }) => {\n\t\t// Geocode any waypoints without coordinates\n\t\tconst geocodedWaypoints = await Promise.all(\n\t\t\twaypoints.map(async (wp) => {\n\t\t\t\tif (wp.lat && wp.lng) {\n\t\t\t\t\treturn { ...wp, coordinates: [wp.lng, wp.lat] as [number, number] };\n\t\t\t\t}\n\t\t\t\t// Use geocoding service (Nominatim requires User-Agent per ToS)\n\t\t\t\tconst geocodeUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(wp.address)}&limit=1`;\n\t\t\t\ttry {\n\t\t\t\t\tconst response = await fetch(geocodeUrl, {\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\"User-Agent\": \"Stratos-FSM/1.0 (https://stratos.app; support@stratos.app)\",\n\t\t\t\t\t\t\t\"Accept\": \"application/json\",\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\tconsole.warn(`Geocoding failed for ${wp.address}: ${response.status}`);\n\t\t\t\t\t\treturn { ...wp, coordinates: null };\n\t\t\t\t\t}\n\t\t\t\t\tconst data = await response.json();\n\t\t\t\t\tif (data.length > 0) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...wp,\n\t\t\t\t\t\t\tcoordinates: [\n\t\t\t\t\t\t\t\tparseFloat(data[0].lon),\n\t\t\t\t\t\t\t\tparseFloat(data[0].lat),\n\t\t\t\t\t\t\t] as [number, number],\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.warn(`Geocoding error for ${wp.address}:`, error);\n\t\t\t\t}\n\t\t\t\treturn { ...wp, coordinates: null };\n\t\t\t})\n\t\t);\n\n\t\tconst validWaypoints = geocodedWaypoints.filter((wp) => wp.coordinates);\n\t\tif (validWaypoints.length < 2) {\n\t\t\treturn { error: \"Could not geocode enough waypoints for routing\" };\n\t\t}\n\n\t\t// Get route from OpenRouteService (if API key available)\n\t\tconst apiKey = process.env.OPENROUTESERVICE_API_KEY;\n\t\tif (apiKey) {\n\t\t\ttry {\n\t\t\t\tconst coordinates = validWaypoints.map((wp) => wp.coordinates);\n\t\t\t\tconst response = await fetch(\n\t\t\t\t\t\"https://api.openrouteservice.org/v2/directions/driving-car/geojson\",\n\t\t\t\t\t{\n\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\tAuthorization: apiKey,\n\t\t\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbody: JSON.stringify({ coordinates, instructions: true }),\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tconst routeData = await response.json();\n\n\t\t\t\tif (routeData.features?.[0]) {\n\t\t\t\t\tconst feature = routeData.features[0];\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdistance_km: (feature.properties.summary.distance / 1000).toFixed(1),\n\t\t\t\t\t\tduration_minutes: Math.round(feature.properties.summary.duration / 60),\n\t\t\t\t\t\twaypoints: validWaypoints.map((wp) => wp.address),\n\t\t\t\t\t\tgeometry: feature.geometry,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Fall through to estimate\n\t\t\t}\n\t\t}\n\n\t\t// Fallback: Calculate straight-line distance estimate\n\t\tconst coords = validWaypoints.map((wp) => wp.coordinates!);\n\t\tlet totalDistance = 0;\n\t\tfor (let i = 0; i < coords.length - 1; i++) {\n\t\t\tconst [lon1, lat1] = coords[i];\n\t\t\tconst [lon2, lat2] = coords[i + 1];\n\t\t\tconst R = 6371;\n\t\t\tconst dLat = ((lat2 - lat1) * Math.PI) / 180;\n\t\t\tconst dLon = ((lon2 - lon1) * Math.PI) / 180;\n\t\t\tconst a =\n\t\t\t\tMath.sin(dLat / 2) * Math.sin(dLat / 2) +\n\t\t\t\tMath.cos((lat1 * Math.PI) / 180) *\n\t\t\t\t\tMath.cos((lat2 * Math.PI) / 180) *\n\t\t\t\t\tMath.sin(dLon / 2) *\n\t\t\t\t\tMath.sin(dLon / 2);\n\t\t\tconst c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\t\t\ttotalDistance += R * c;\n\t\t}\n\n\t\tconst drivingDistance = totalDistance * 1.3;\n\t\tconst durationMinutes = Math.round((drivingDistance / 50) * 60);\n\n\t\treturn {\n\t\t\tdistance_km: drivingDistance.toFixed(1),\n\t\t\tduration_minutes: durationMinutes,\n\t\t\twaypoints: validWaypoints.map((wp) => wp.address),\n\t\t\tnote: \"Estimated based on straight-line distance\",\n\t\t};\n\t},\n});\n\n/**\n * Find nearby suppliers (plumbing supply, electrical supply, etc.)\n */\nexport const findNearbySuppliersTool = tool({\n\tdescription: \"Find nearby supply stores for parts (plumbing, electrical, HVAC, hardware)\",\n\tparameters: z.object({\n\t\tcompanyId: z.string().describe(\"Company UUID\"),\n\t\tlocation: z.object({\n\t\t\tlat: z.number().describe(\"Latitude\"),\n\t\t\tlng: z.number().describe(\"Longitude\"),\n\t\t}),\n\t\tsupplyType: z\n\t\t\t.enum([\"plumbing\", \"electrical\", \"hvac\", \"hardware\", \"all\"])\n\t\t\t.default(\"all\"),\n\t\tradiusKm: z.number().optional().default(10),\n\t}),\n\texecute: async ({ location, supplyType, radiusKm }) => {\n\t\tconst typeFilters: Record<string, string> = {\n\t\t\tplumbing: '[\"shop\"=\"trade\"][\"trade\"~\"plumbing|bathroom\"]',\n\t\t\telectrical: '[\"shop\"=\"trade\"][\"trade\"~\"electrical\"]',\n\t\t\thvac: '[\"shop\"=\"trade\"][\"trade\"~\"hvac|air_conditioning\"]',\n\t\t\thardware: '[\"shop\"=\"doityourself\"]',\n\t\t\tall: '[\"shop\"~\"trade|doityourself|hardware\"]',\n\t\t};\n\n\t\tconst filter = typeFilters[supplyType];\n\t\tconst query = `[out:json][timeout:25];(node${filter}(around:${radiusKm * 1000},${location.lat},${location.lng});way${filter}(around:${radiusKm * 1000},${location.lat},${location.lng}););out center;`;\n\n\t\ttry {\n\t\t\tconst response = await fetch(\"https://overpass-api.de/api/interpreter\", {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: query,\n\t\t\t});\n\t\t\tconst data = await response.json();\n\n\t\t\tconst suppliers = data.elements\n\t\t\t\t.map((el: { tags?: { name?: string; phone?: string; website?: string }; lat?: number; lon?: number; center?: { lat: number; lon: number } }) => ({\n\t\t\t\t\tname: el.tags?.name || \"Unknown Supplier\",\n\t\t\t\t\tphone: el.tags?.phone,\n\t\t\t\t\twebsite: el.tags?.website,\n\t\t\t\t\tlat: el.lat || el.center?.lat,\n\t\t\t\t\tlng: el.lon || el.center?.lon,\n\t\t\t\t}))\n\t\t\t\t.filter((s: { name: string }) => s.name !== \"Unknown Supplier\")\n\t\t\t\t.slice(0, 10);\n\n\t\t\treturn { suppliers, searchRadius: radiusKm, supplyType };\n\t\t} catch {\n\t\t\treturn { error: \"Failed to search for suppliers\" };\n\t\t}\n\t},\n});\n\n// ============================================================================\n// INVENTORY & PARTS TOOLS\n// ============================================================================\n\n/**\n * Search inventory for parts\n */\nexport const searchInventoryTool = tool({\n\tdescription: \"Search company inventory for parts by name, SKU, or category\",\n\tparameters: z.object({\n\t\tcompanyId: z.string().describe(\"Company UUID\"),\n\t\tquery: z.string().describe(\"Search query\"),\n\t\tcategory: z.string().optional(),\n\t\tinStockOnly: z.boolean().optional().default(false),\n\t}),\n\texecute: async ({ companyId, query, category, inStockOnly }) => {\n\t\tconst supabase = await createClient();\n\n\t\tlet dbQuery = supabase\n\t\t\t.from(\"inventory\")\n\t\t\t.select(\"id, sku, name, description, category, quantity_on_hand, quantity_reserved, reorder_point, unit_cost, unit_price, location\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.or(`name.ilike.%${query}%,sku.ilike.%${query}%,description.ilike.%${query}%`);\n\n\t\tif (category) dbQuery = dbQuery.eq(\"category\", category);\n\t\tif (inStockOnly) dbQuery = dbQuery.gt(\"quantity_on_hand\", 0);\n\n\t\tconst { data, error } = await dbQuery.order(\"name\").limit(20);\n\t\tif (error) return { error: error.message };\n\n\t\treturn {\n\t\t\titems: data.map((item) => ({\n\t\t\t\t...item,\n\t\t\t\tavailable: item.quantity_on_hand - (item.quantity_reserved || 0),\n\t\t\t\tneedsReorder: item.quantity_on_hand <= (item.reorder_point || 0),\n\t\t\t})),\n\t\t\ttotal: data.length,\n\t\t};\n\t},\n});\n\n/**\n * Check parts availability for a job\n */\nexport const checkPartsAvailabilityTool = tool({\n\tdescription: \"Check if required parts are available in inventory for a job\",\n\tparameters: z.object({\n\t\tcompanyId: z.string().describe(\"Company UUID\"),\n\t\tparts: z.array(\n\t\t\tz.object({\n\t\t\t\titemId: z.string().optional(),\n\t\t\t\tsku: z.string().optional(),\n\t\t\t\tname: z.string().optional(),\n\t\t\t\tquantity: z.number(),\n\t\t\t})\n\t\t),\n\t}),\n\texecute: async ({ companyId, parts }) => {\n\t\tif (!parts.length) {\n\t\t\treturn { error: \"At least one part is required\" };\n\t\t}\n\n\t\tconst supabase = await createClient();\n\n\t\t// Batch lookup: collect IDs and SKUs for a single query\n\t\tconst itemIds = parts.filter((p) => p.itemId).map((p) => p.itemId!);\n\t\tconst skus = parts.filter((p) => p.sku && !p.itemId).map((p) => p.sku!);\n\n\t\t// Fetch all matching inventory items in one query\n\t\tlet inventoryQuery = supabase\n\t\t\t.from(\"inventory\")\n\t\t\t.select(\"id, sku, name, quantity_on_hand, quantity_reserved, unit_cost, unit_price\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.is(\"deleted_at\", null);\n\n\t\t// Build OR conditions for batch lookup\n\t\tconst orConditions: string[] = [];\n\t\tif (itemIds.length > 0) {\n\t\t\torConditions.push(`id.in.(${itemIds.join(\",\")})`);\n\t\t}\n\t\tif (skus.length > 0) {\n\t\t\torConditions.push(`sku.in.(${skus.join(\",\")})`);\n\t\t}\n\n\t\tlet inventoryItems: { id: string; sku: string | null; name: string; quantity_on_hand: number; quantity_reserved: number | null; unit_cost: number | null; unit_price: number | null }[] = [];\n\n\t\tif (orConditions.length > 0) {\n\t\t\tconst { data } = await inventoryQuery.or(orConditions.join(\",\"));\n\t\t\tinventoryItems = data || [];\n\t\t}\n\n\t\t// For name-based lookups, we still need individual queries (fuzzy match)\n\t\tconst nameOnlyParts = parts.filter((p) => !p.itemId && !p.sku && p.name);\n\t\tif (nameOnlyParts.length > 0) {\n\t\t\tconst nameResults = await Promise.all(\n\t\t\t\tnameOnlyParts.map(async (part) => {\n\t\t\t\t\tconst { data } = await supabase\n\t\t\t\t\t\t.from(\"inventory\")\n\t\t\t\t\t\t.select(\"id, sku, name, quantity_on_hand, quantity_reserved, unit_cost, unit_price\")\n\t\t\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t\t\t.is(\"deleted_at\", null)\n\t\t\t\t\t\t.ilike(\"name\", `%${part.name}%`)\n\t\t\t\t\t\t.limit(1)\n\t\t\t\t\t\t.single();\n\t\t\t\t\treturn data;\n\t\t\t\t})\n\t\t\t);\n\t\t\tinventoryItems.push(...nameResults.filter((r): r is NonNullable<typeof r> => r !== null));\n\t\t}\n\n\t\t// Map results to parts\n\t\tconst results = parts.map((part) => {\n\t\t\tconst item = inventoryItems.find(\n\t\t\t\t(inv) =>\n\t\t\t\t\t(part.itemId && inv.id === part.itemId) ||\n\t\t\t\t\t(part.sku && inv.sku === part.sku) ||\n\t\t\t\t\t(part.name && inv.name.toLowerCase().includes(part.name.toLowerCase()))\n\t\t\t);\n\n\t\t\tif (!item) {\n\t\t\t\treturn { ...part, found: false, available: 0, canFulfill: false };\n\t\t\t}\n\n\t\t\tconst available = item.quantity_on_hand - (item.quantity_reserved || 0);\n\t\t\treturn {\n\t\t\t\titemId: item.id,\n\t\t\t\tsku: item.sku,\n\t\t\t\tname: item.name,\n\t\t\t\tfound: true,\n\t\t\t\tavailable,\n\t\t\t\tneeded: part.quantity,\n\t\t\t\tcanFulfill: available >= part.quantity,\n\t\t\t\tunitPrice: item.unit_price,\n\t\t\t\ttotalPrice: (item.unit_price || 0) * part.quantity,\n\t\t\t};\n\t\t});\n\n\t\treturn {\n\t\t\tallPartsAvailable: results.every((r) => r.canFulfill),\n\t\t\tparts: results,\n\t\t\tmissingParts: results.filter((r) => !r.canFulfill),\n\t\t\ttotalEstimatedPrice: results.reduce((sum, r) => sum + (r.totalPrice || 0), 0),\n\t\t};\n\t},\n});\n\n/**\n * Get low stock alerts\n */\nexport const getLowStockAlertsTool = tool({\n\tdescription: \"Get inventory items at or below reorder point\",\n\tparameters: z.object({\n\t\tcompanyId: z.string().describe(\"Company UUID\"),\n\t\tcategory: z.string().optional(),\n\t\tlimit: z.number().optional().default(50).describe(\"Max items to return\"),\n\t}),\n\texecute: async ({ companyId, category, limit }) => {\n\t\tconst supabase = await createClient();\n\n\t\t// Use a raw filter to get only items where quantity <= reorder_point\n\t\tlet query = supabase\n\t\t\t.from(\"inventory\")\n\t\t\t.select(\"id, sku, name, category, quantity_on_hand, reorder_point, reorder_quantity, unit_cost\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.is(\"deleted_at\", null)\n\t\t\t.not(\"reorder_point\", \"is\", null);\n\n\t\tif (category) query = query.eq(\"category\", category);\n\n\t\tconst { data, error } = await query.order(\"quantity_on_hand\", { ascending: true }).limit(limit * 2);\n\t\tif (error) return { error: error.message };\n\n\t\t// Filter for items at or below reorder point and limit\n\t\tconst lowStockItems = data\n\t\t\t.filter((item) => item.quantity_on_hand <= (item.reorder_point || 0))\n\t\t\t.slice(0, limit)\n\t\t\t.map((item) => ({\n\t\t\t\t...item,\n\t\t\t\tshortfall: (item.reorder_point || 0) - item.quantity_on_hand,\n\t\t\t\tsuggestedOrderQty: item.reorder_quantity || 10,\n\t\t\t\turgency: item.quantity_on_hand === 0 ? \"critical\" : item.quantity_on_hand <= (item.reorder_point || 0) / 2 ? \"high\" : \"normal\",\n\t\t\t}));\n\n\t\treturn {\n\t\t\tlowStockCount: lowStockItems.length,\n\t\t\titems: lowStockItems,\n\t\t\tcriticalCount: lowStockItems.filter((i) => i.urgency === \"critical\").length,\n\t\t};\n\t},\n});\n\n// ============================================================================\n// EQUIPMENT HISTORY TOOLS\n// ============================================================================\n\n/**\n * Get equipment at a property\n */\nexport const getPropertyEquipmentTool = tool({\n\tdescription: \"Get list of equipment installed at a customer's property\",\n\tparameters: z.object({\n\t\tcompanyId: z.string().describe(\"Company UUID\"),\n\t\tpropertyId: z.string().optional(),\n\t\tcustomerId: z.string().optional(),\n\t}),\n\texecute: async ({ companyId, propertyId, customerId }) => {\n\t\t// Validate: at least one filter is required\n\t\tif (!propertyId && !customerId) {\n\t\t\treturn { error: \"Either propertyId or customerId is required\" };\n\t\t}\n\n\t\tconst supabase = await createClient();\n\n\t\tlet query = supabase\n\t\t\t.from(\"equipment\")\n\t\t\t.select(\"id, name, model_number, serial_number, manufacturer, install_date, warranty_expiry, last_service_date, next_service_due, status, notes\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.is(\"deleted_at\", null);\n\n\t\tif (propertyId) {\n\t\t\tquery = query.eq(\"property_id\", propertyId);\n\t\t} else if (customerId) {\n\t\t\tconst { data: properties } = await supabase\n\t\t\t\t.from(\"properties\")\n\t\t\t\t.select(\"id\")\n\t\t\t\t.eq(\"customer_id\", customerId)\n\t\t\t\t.is(\"deleted_at\", null);\n\t\t\tif (!properties?.length) {\n\t\t\t\treturn { equipment: [], total: 0, message: \"No properties found for this customer\" };\n\t\t\t}\n\t\t\tquery = query.in(\"property_id\", properties.map((p) => p.id));\n\t\t}\n\n\t\tconst { data, error } = await query.order(\"name\").limit(100);\n\t\tif (error) return { error: error.message };\n\n\t\tconst now = new Date();\n\t\treturn {\n\t\t\tequipment: data.map((eq) => ({\n\t\t\t\t...eq,\n\t\t\t\twarrantyStatus: eq.warranty_expiry\n\t\t\t\t\t? new Date(eq.warranty_expiry) > now ? \"active\" : \"expired\"\n\t\t\t\t\t: \"unknown\",\n\t\t\t\tserviceDue: eq.next_service_due ? new Date(eq.next_service_due) <= now : false,\n\t\t\t})),\n\t\t\ttotal: data.length,\n\t\t};\n\t},\n});\n\n/**\n * Get service history for specific equipment\n */\nexport const getEquipmentServiceHistoryTool = tool({\n\tdescription: \"Get service history for a specific piece of equipment\",\n\tparameters: z.object({\n\t\tcompanyId: z.string().describe(\"Company UUID\"),\n\t\tequipmentId: z.string().describe(\"Equipment UUID\"),\n\t\tlimit: z.number().optional().default(10),\n\t}),\n\texecute: async ({ companyId, equipmentId, limit }) => {\n\t\tconst supabase = await createClient();\n\n\t\tconst { data: equipment } = await supabase\n\t\t\t.from(\"equipment\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"id\", equipmentId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (!equipment) return { error: \"Equipment not found\" };\n\n\t\tconst { data: serviceHistory } = await supabase\n\t\t\t.from(\"job_equipment\")\n\t\t\t.select(\"job:jobs(id, title, status, completed_at), notes, work_performed, created_at\")\n\t\t\t.eq(\"equipment_id\", equipmentId)\n\t\t\t.order(\"created_at\", { ascending: false })\n\t\t\t.limit(limit);\n\n\t\treturn {\n\t\t\tequipment: {\n\t\t\t\tid: equipment.id,\n\t\t\t\tname: equipment.name,\n\t\t\t\tmodel: equipment.model_number,\n\t\t\t\tserial: equipment.serial_number,\n\t\t\t},\n\t\t\tserviceHistory: serviceHistory || [],\n\t\t\ttotalServices: serviceHistory?.length || 0,\n\t\t};\n\t},\n});\n\n/**\n * Check equipment warranty status\n */\nexport const checkEquipmentWarrantyTool = tool({\n\tdescription: \"Check warranty status for equipment\",\n\tparameters: z.object({\n\t\tcompanyId: z.string().describe(\"Company UUID\"),\n\t\tequipmentId: z.string().describe(\"Equipment UUID\"),\n\t}),\n\texecute: async ({ companyId, equipmentId }) => {\n\t\tconst supabase = await createClient();\n\n\t\tconst { data: equipment, error } = await supabase\n\t\t\t.from(\"equipment\")\n\t\t\t.select(\"id, name, model_number, serial_number, warranty_expiry, warranty_type, warranty_notes\")\n\t\t\t.eq(\"id\", equipmentId)\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (error || !equipment) return { error: \"Equipment not found\" };\n\n\t\tconst now = new Date();\n\t\tconst warrantyEnd = equipment.warranty_expiry ? new Date(equipment.warranty_expiry) : null;\n\t\tlet status: \"active\" | \"expired\" | \"expiring_soon\" | \"unknown\" = \"unknown\";\n\t\tlet daysRemaining = null;\n\n\t\tif (warrantyEnd) {\n\t\t\tdaysRemaining = Math.ceil((warrantyEnd.getTime() - now.getTime()) / (24 * 60 * 60 * 1000));\n\t\t\tstatus = daysRemaining < 0 ? \"expired\" : daysRemaining <= 30 ? \"expiring_soon\" : \"active\";\n\t\t}\n\n\t\treturn {\n\t\t\tequipment: { name: equipment.name, model: equipment.model_number, serial: equipment.serial_number },\n\t\t\twarranty: {\n\t\t\t\tstatus,\n\t\t\t\texpiryDate: equipment.warranty_expiry,\n\t\t\t\tdaysRemaining: daysRemaining && daysRemaining > 0 ? daysRemaining : 0,\n\t\t\t\ttype: equipment.warranty_type,\n\t\t\t},\n\t\t};\n\t},\n});\n\n// ============================================================================\n// TECHNICIAN MATCHING TOOLS\n// ============================================================================\n\n/**\n * Find technicians by skills\n */\nexport const findTechniciansBySkillsTool = tool({\n\tdescription: \"Find available technicians with specific skills or certifications\",\n\tparameters: z.object({\n\t\tcompanyId: z.string().describe(\"Company UUID\"),\n\t\tskills: z.array(z.string()).optional(),\n\t\tcertifications: z.array(z.string()).optional(),\n\t\tdate: z.string().optional().describe(\"Date to check availability\"),\n\t}),\n\texecute: async ({ companyId, skills, certifications, date }) => {\n\t\ttry {\n\t\t\tconst supabase = await createClient();\n\n\t\t\tconst { data: members, error } = await supabase\n\t\t\t\t.from(\"company_memberships\")\n\t\t\t\t.select(\"id, role, skills, certifications, service_areas, user:users(id, first_name, last_name, email)\")\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.eq(\"role\", \"technician\");\n\n\t\t\tif (error) return { error: error.message };\n\n\t\t\tlet filtered = members;\n\t\t\tif (skills?.length) {\n\t\t\t\tfiltered = filtered.filter((m) =>\n\t\t\t\t\tskills.some((skill) =>\n\t\t\t\t\t\t((m.skills as string[]) || []).map((s) => s.toLowerCase()).includes(skill.toLowerCase())\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (certifications?.length) {\n\t\t\t\tfiltered = filtered.filter((m) =>\n\t\t\t\t\tcertifications.some((cert) =>\n\t\t\t\t\t\t((m.certifications as string[]) || []).map((c) => c.toLowerCase()).includes(cert.toLowerCase())\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (date) {\n\t\t\t\tconst dayStart = new Date(date);\n\t\t\t\tdayStart.setHours(0, 0, 0, 0);\n\t\t\t\tconst dayEnd = new Date(date);\n\t\t\t\tdayEnd.setHours(23, 59, 59, 999);\n\n\t\t\t\tconst { data: assignments } = await supabase\n\t\t\t\t\t.from(\"jobs\")\n\t\t\t\t\t.select(\"assigned_to\")\n\t\t\t\t\t.is(\"deleted_at\", null)\n\t\t\t\t\t.in(\"assigned_to\", filtered.map((m) => m.id))\n\t\t\t\t\t.gte(\"scheduled_start\", dayStart.toISOString())\n\t\t\t\t\t.lte(\"scheduled_start\", dayEnd.toISOString());\n\n\t\t\t\tconst jobCounts: Record<string, number> = {};\n\t\t\t\tassignments?.forEach((a) => {\n\t\t\t\t\tif (a.assigned_to) jobCounts[a.assigned_to] = (jobCounts[a.assigned_to] || 0) + 1;\n\t\t\t\t});\n\n\t\t\t\tfiltered = filtered.map((m) => ({\n\t\t\t\t\t...m,\n\t\t\t\t\tjobsOnDate: jobCounts[m.id] || 0,\n\t\t\t\t\tavailability: (jobCounts[m.id] || 0) === 0 ? \"available\" : (jobCounts[m.id] || 0) < 4 ? \"partially_booked\" : \"fully_booked\",\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\ttechnicians: filtered.map((m) => ({\n\t\t\t\t\tid: m.id,\n\t\t\t\t\tname: `${(m.user as { first_name: string; last_name: string })?.first_name} ${(m.user as { first_name: string; last_name: string })?.last_name}`,\n\t\t\t\t\tskills: m.skills,\n\t\t\t\t\tcertifications: m.certifications,\n\t\t\t\t\tavailability: (m as { availability?: string }).availability,\n\t\t\t\t})),\n\t\t\t\ttotal: filtered.length,\n\t\t\t};\n\t\t} catch (err) {\n\t\t\treturn { error: err instanceof Error ? err.message : \"Failed to find technicians\" };\n\t\t}\n\t},\n});\n\n/**\n * Get technician workload\n */\nexport const getTechnicianWorkloadTool = tool({\n\tdescription: \"Get a technician's current workload and schedule\",\n\tparameters: z.object({\n\t\tcompanyId: z.string().describe(\"Company UUID\"),\n\t\ttechnicianId: z.string().describe(\"Technician membership UUID\"),\n\t\tstartDate: z.string(),\n\t\tendDate: z.string(),\n\t}),\n\texecute: async ({ companyId, technicianId, startDate, endDate }) => {\n\t\ttry {\n\t\t\tconst supabase = await createClient();\n\n\t\t\tconst { data: tech } = await supabase\n\t\t\t\t.from(\"company_memberships\")\n\t\t\t\t.select(\"id, user:users(first_name, last_name)\")\n\t\t\t\t.eq(\"id\", technicianId)\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.single();\n\n\t\t\tif (!tech) return { error: \"Technician not found\" };\n\n\t\t\tconst { data: jobs } = await supabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\"id, title, status, scheduled_start, scheduled_end, customer:customers(name)\")\n\t\t\t\t.eq(\"assigned_to\", technicianId)\n\t\t\t\t.is(\"deleted_at\", null)\n\t\t\t\t.gte(\"scheduled_start\", startDate)\n\t\t\t\t.lte(\"scheduled_start\", endDate)\n\t\t\t\t.order(\"scheduled_start\");\n\n\t\t\treturn {\n\t\t\t\ttechnician: { id: tech.id, name: `${(tech.user as { first_name: string; last_name: string })?.first_name} ${(tech.user as { first_name: string; last_name: string })?.last_name}` },\n\t\t\t\tsummary: {\n\t\t\t\t\ttotalJobs: jobs?.length || 0,\n\t\t\t\t\tcompleted: jobs?.filter((j) => j.status === \"completed\").length || 0,\n\t\t\t\t\tscheduled: jobs?.filter((j) => j.status === \"scheduled\").length || 0,\n\t\t\t\t},\n\t\t\t\tjobs: jobs?.map((j) => ({\n\t\t\t\t\tid: j.id,\n\t\t\t\t\ttitle: j.title,\n\t\t\t\t\tstatus: j.status,\n\t\t\t\t\tscheduledStart: j.scheduled_start,\n\t\t\t\t\tcustomer: (j.customer as { name: string })?.name,\n\t\t\t\t})) || [],\n\t\t\t};\n\t\t} catch (err) {\n\t\t\treturn { error: err instanceof Error ? err.message : \"Failed to get technician workload\" };\n\t\t}\n\t},\n});\n\n// ============================================================================\n// PRICING & ESTIMATION TOOLS\n// ============================================================================\n\n/**\n * Search price book for services\n */\nexport const searchPriceBookTool = tool({\n\tdescription: \"Search price book for services, parts, and flat-rate pricing\",\n\tparameters: z.object({\n\t\tcompanyId: z.string().describe(\"Company UUID\"),\n\t\tquery: z.string(),\n\t\tcategory: z.string().optional(),\n\t}),\n\texecute: async ({ companyId, query, category }) => {\n\t\tconst supabase = await createClient();\n\n\t\tlet dbQuery = supabase\n\t\t\t.from(\"price_book_items\")\n\t\t\t.select(\"id, name, description, category, sku, unit_price, cost, is_active\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"is_active\", true)\n\t\t\t.or(`name.ilike.%${query}%,description.ilike.%${query}%,sku.ilike.%${query}%`);\n\n\t\tif (category) dbQuery = dbQuery.eq(\"category\", category);\n\t\tconst { data, error } = await dbQuery.order(\"name\").limit(20);\n\t\tif (error) return { error: error.message };\n\n\t\treturn {\n\t\t\titems: data.map((item) => ({\n\t\t\t\t...item,\n\t\t\t\tprofit: item.unit_price - (item.cost || 0),\n\t\t\t})),\n\t\t\ttotal: data.length,\n\t\t};\n\t},\n});\n\n/**\n * Calculate estimate from price book items\n */\nexport const calculateEstimateTool = tool({\n\tdescription: \"Calculate an estimate total from price book items\",\n\tparameters: z.object({\n\t\tcompanyId: z.string().describe(\"Company UUID\"),\n\t\titems: z.array(\n\t\t\tz.object({\n\t\t\t\tpriceBookItemId: z.string().optional(),\n\t\t\t\tname: z.string().optional(),\n\t\t\t\tquantity: z.number().default(1),\n\t\t\t\tcustomPrice: z.number().optional(),\n\t\t\t})\n\t\t),\n\t\tdiscount: z.object({ type: z.enum([\"percentage\", \"fixed\"]), value: z.number() }).optional(),\n\t\ttaxRate: z.number().optional(),\n\t}),\n\texecute: async ({ companyId, items, discount, taxRate }) => {\n\t\tconst supabase = await createClient();\n\n\t\tconst priceBookIds = items.filter((i) => i.priceBookItemId).map((i) => i.priceBookItemId);\n\t\tlet priceBookItems: { id: string; name: string; unit_price: number; cost: number | null }[] = [];\n\t\tif (priceBookIds.length > 0) {\n\t\t\tconst { data } = await supabase.from(\"price_book_items\").select(\"id, name, unit_price, cost\").in(\"id\", priceBookIds);\n\t\t\tpriceBookItems = data || [];\n\t\t}\n\n\t\tconst lineItems = items.map((item) => {\n\t\t\tconst pbItem = priceBookItems.find((p) => p.id === item.priceBookItemId);\n\t\t\tconst unitPrice = item.customPrice || pbItem?.unit_price || 0;\n\t\t\treturn {\n\t\t\t\tname: item.name || pbItem?.name || \"Unknown Item\",\n\t\t\t\tquantity: item.quantity,\n\t\t\t\tunitPrice,\n\t\t\t\tlineTotal: unitPrice * item.quantity,\n\t\t\t};\n\t\t});\n\n\t\tconst subtotal = lineItems.reduce((sum, item) => sum + item.lineTotal, 0);\n\t\tlet discountAmount = 0;\n\t\tif (discount) {\n\t\t\tdiscountAmount = discount.type === \"percentage\" ? subtotal * (discount.value / 100) : discount.value;\n\t\t}\n\t\tconst afterDiscount = subtotal - discountAmount;\n\t\tconst taxAmount = afterDiscount * ((taxRate || 0) / 100);\n\n\t\treturn {\n\t\t\tlineItems,\n\t\t\tsubtotal,\n\t\t\tdiscount: discountAmount > 0 ? { ...discount, amount: discountAmount } : null,\n\t\t\ttax: { rate: taxRate || 0, amount: taxAmount },\n\t\t\tgrandTotal: afterDiscount + taxAmount,\n\t\t};\n\t},\n});\n\n// ============================================================================\n// SMART SCHEDULING TOOLS\n// ============================================================================\n\n/**\n * Suggest best technician for a job\n */\nexport const suggestTechnicianForJobTool = tool({\n\tdescription: \"Suggest the best technician for a job based on skills, location, and availability\",\n\tparameters: z.object({\n\t\tcompanyId: z.string().describe(\"Company UUID\"),\n\t\tjobType: z.string(),\n\t\trequiredSkills: z.array(z.string()).optional(),\n\t\tpreferredDate: z.string(),\n\t}),\n\texecute: async ({ companyId, jobType, requiredSkills, preferredDate }) => {\n\t\ttry {\n\t\t\tconst supabase = await createClient();\n\n\t\t\tconst { data: technicians } = await supabase\n\t\t\t\t.from(\"company_memberships\")\n\t\t\t\t.select(\"id, skills, preferred_job_types, user:users(first_name, last_name)\")\n\t\t\t\t.eq(\"company_id\", companyId)\n\t\t\t\t.eq(\"role\", \"technician\");\n\n\t\t\tif (!technicians?.length) return { error: \"No technicians found\" };\n\n\t\t\tconst dayStart = new Date(preferredDate);\n\t\t\tdayStart.setHours(0, 0, 0, 0);\n\t\t\tconst dayEnd = new Date(preferredDate);\n\t\t\tdayEnd.setHours(23, 59, 59, 999);\n\n\t\t\tconst { data: existingJobs } = await supabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\"assigned_to\")\n\t\t\t\t.is(\"deleted_at\", null)\n\t\t\t\t.in(\"assigned_to\", technicians.map((t) => t.id))\n\t\t\t\t.gte(\"scheduled_start\", dayStart.toISOString())\n\t\t\t\t.lte(\"scheduled_start\", dayEnd.toISOString());\n\n\t\t\tconst jobCounts: Record<string, number> = {};\n\t\t\texistingJobs?.forEach((j) => {\n\t\t\t\tif (j.assigned_to) jobCounts[j.assigned_to] = (jobCounts[j.assigned_to] || 0) + 1;\n\t\t\t});\n\n\t\t\tconst scored = technicians.map((tech) => {\n\t\t\t\tlet score = 0;\n\t\t\t\tconst reasons: string[] = [];\n\n\t\t\t\tconst techSkills = ((tech.skills as string[]) || []).map((s) => s.toLowerCase());\n\t\t\t\tconst matchedSkills = (requiredSkills || []).filter((s) => techSkills.includes(s.toLowerCase()));\n\t\t\t\tif (matchedSkills.length > 0) {\n\t\t\t\t\tscore += 40 * (matchedSkills.length / (requiredSkills?.length || 1));\n\t\t\t\t\treasons.push(`Matches ${matchedSkills.length} skills`);\n\t\t\t\t}\n\n\t\t\t\tconst preferredTypes = ((tech.preferred_job_types as string[]) || []).map((t) => t.toLowerCase());\n\t\t\t\tif (preferredTypes.includes(jobType.toLowerCase())) {\n\t\t\t\t\tscore += 20;\n\t\t\t\t\treasons.push(\"Prefers this job type\");\n\t\t\t\t}\n\n\t\t\t\tconst techJobs = jobCounts[tech.id] || 0;\n\t\t\t\tif (techJobs === 0) { score += 30; reasons.push(\"Fully available\"); }\n\t\t\t\telse if (techJobs < 3) { score += 15; reasons.push(`${techJobs} jobs scheduled`); }\n\n\t\t\t\treturn {\n\t\t\t\t\tid: tech.id,\n\t\t\t\t\tname: `${(tech.user as { first_name: string; last_name: string })?.first_name} ${(tech.user as { first_name: string; last_name: string })?.last_name}`,\n\t\t\t\t\tscore: Math.round(score),\n\t\t\t\t\treasons,\n\t\t\t\t\tjobsOnDate: techJobs,\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tscored.sort((a, b) => b.score - a.score);\n\t\t\treturn { recommendations: scored.slice(0, 5), bestMatch: scored[0] };\n\t\t} catch (err) {\n\t\t\treturn { error: err instanceof Error ? err.message : \"Failed to suggest technician\" };\n\t\t}\n\t},\n});\n\n/**\n * Optimize job order for a technician's day\n */\nexport const optimizeJobOrderTool = tool({\n\tdescription: \"Optimize the order of jobs for a technician to minimize travel time\",\n\tparameters: z.object({\n\t\tcompanyId: z.string().describe(\"Company UUID\"),\n\t\ttechnicianId: z.string(),\n\t\tdate: z.string(),\n\t}),\n\texecute: async ({ technicianId, date }) => {\n\t\ttry {\n\t\t\tconst supabase = await createClient();\n\n\t\t\tconst dayStart = new Date(date);\n\t\t\tdayStart.setHours(0, 0, 0, 0);\n\t\t\tconst dayEnd = new Date(date);\n\t\t\tdayEnd.setHours(23, 59, 59, 999);\n\n\t\t\tconst { data: jobs } = await supabase\n\t\t\t\t.from(\"jobs\")\n\t\t\t\t.select(\"id, title, scheduled_start, priority, property:properties(address, city, latitude, longitude)\")\n\t\t\t\t.eq(\"assigned_to\", technicianId)\n\t\t\t\t.is(\"deleted_at\", null)\n\t\t\t\t.gte(\"scheduled_start\", dayStart.toISOString())\n\t\t\t\t.lte(\"scheduled_start\", dayEnd.toISOString())\n\t\t\t\t.order(\"scheduled_start\");\n\n\t\t\tif (!jobs || jobs.length < 2) return { message: \"Not enough jobs to optimize\", jobs: jobs || [] };\n\n\t\t\tconst jobsWithCoords = jobs\n\t\t\t\t.filter((j) => (j.property as { latitude: number; longitude: number })?.latitude)\n\t\t\t\t.map((j) => ({\n\t\t\t\t\t...j,\n\t\t\t\t\tlat: (j.property as { latitude: number })?.latitude,\n\t\t\t\t\tlng: (j.property as { longitude: number })?.longitude,\n\t\t\t\t}));\n\n\t\t\tif (jobsWithCoords.length < 2) return { message: \"Not enough jobs with location data\", jobs };\n\n\t\t\t// Simple nearest-neighbor optimization\n\t\t\tconst optimized: typeof jobsWithCoords = [];\n\t\t\tconst remaining = [...jobsWithCoords];\n\t\t\tlet current = { lat: jobsWithCoords[0].lat, lng: jobsWithCoords[0].lng };\n\n\t\t\twhile (remaining.length > 0) {\n\t\t\t\tlet nearestIdx = 0;\n\t\t\t\tlet nearestDist = Infinity;\n\t\t\t\tremaining.forEach((job, idx) => {\n\t\t\t\t\tconst dist = Math.sqrt(Math.pow(job.lat - current.lat, 2) + Math.pow(job.lng - current.lng, 2));\n\t\t\t\t\tconst priorityBonus = job.priority === \"high\" ? 0.8 : 1;\n\t\t\t\t\tif (dist * priorityBonus < nearestDist) {\n\t\t\t\t\t\tnearestDist = dist * priorityBonus;\n\t\t\t\t\t\tnearestIdx = idx;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst next = remaining.splice(nearestIdx, 1)[0];\n\t\t\t\toptimized.push(next);\n\t\t\t\tcurrent = { lat: next.lat, lng: next.lng };\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\toptimizedOrder: optimized.map((j, idx) => ({\n\t\t\t\t\torder: idx + 1,\n\t\t\t\t\tjobId: j.id,\n\t\t\t\t\ttitle: j.title,\n\t\t\t\t\taddress: `${(j.property as { address: string; city: string })?.address}, ${(j.property as { address: string; city: string })?.city}`,\n\t\t\t\t})),\n\t\t\t\tjobCount: optimized.length,\n\t\t\t};\n\t\t} catch (err) {\n\t\t\treturn { error: err instanceof Error ? err.message : \"Failed to optimize job order\" };\n\t\t}\n\t},\n});\n\n// ============================================================================\n// WEB SEARCH & RESEARCH TOOLS\n// ============================================================================\n\n/**\n * Web search tool - Search the web for information\n * Use this for general questions, industry news, regulations, pricing research, etc.\n */\nexport const webSearchTool = tool({\n\tdescription: \"Search the web for information. Use this to find answers to questions, research topics, look up current events, regulations, industry news, competitor information, or any general knowledge questions.\",\n\tparameters: z.object({\n\t\tquery: z.string().describe(\"The search query - be specific and include relevant keywords\"),\n\t\tnumResults: z.number().optional().default(5).describe(\"Number of results to return (1-10)\"),\n\t\tdateRestrict: z.string().optional().describe(\"Limit to recent results: d7 (7 days), m1 (1 month), y1 (1 year)\"),\n\t}),\n\texecute: async ({ query, numResults, dateRestrict }) => {\n\t\tif (!googleCustomSearchService.isConfigured()) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Web search is not configured. Please set GOOGLE_API_KEY and GOOGLE_SEARCH_ENGINE_ID.\",\n\t\t\t\tconfigStatus: googleCustomSearchService.getConfigStatus(),\n\t\t\t};\n\t\t}\n\n\t\tconst results = await googleCustomSearchService.search(query, {\n\t\t\tnum: Math.min(numResults, 10),\n\t\t\tdateRestrict,\n\t\t});\n\n\t\tif (!results) {\n\t\t\treturn { success: false, error: \"Search failed. Please try again.\" };\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tquery,\n\t\t\ttotalResults: results.totalResults,\n\t\t\tsearchTime: results.searchTime,\n\t\t\tresults: results.results.map((r) => ({\n\t\t\t\ttitle: r.title,\n\t\t\t\turl: r.link,\n\t\t\t\tsnippet: r.snippet,\n\t\t\t\tsource: r.displayLink,\n\t\t\t})),\n\t\t};\n\t},\n});\n\n/**\n * Web search for news - Search for recent news articles\n * Use this for industry news, current events, company news, etc.\n */\nexport const webSearchNewsTool = tool({\n\tdescription: \"Search for recent news articles. Use this for industry news, current events, company updates, regulation changes, or any time-sensitive information.\",\n\tparameters: z.object({\n\t\tquery: z.string().describe(\"The news search query - include topic and relevant keywords\"),\n\t\tdaysBack: z.number().optional().default(7).describe(\"How many days back to search (1-30)\"),\n\t\tnumResults: z.number().optional().default(5).describe(\"Number of results to return (1-10)\"),\n\t}),\n\texecute: async ({ query, daysBack, numResults }) => {\n\t\tif (!googleCustomSearchService.isConfigured()) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Web search is not configured. Please set GOOGLE_API_KEY and GOOGLE_SEARCH_ENGINE_ID.\",\n\t\t\t};\n\t\t}\n\n\t\tconst results = await googleCustomSearchService.searchNews(query, {\n\t\t\tdaysBack: Math.min(daysBack, 30),\n\t\t\tnum: Math.min(numResults, 10),\n\t\t});\n\n\t\tif (!results) {\n\t\t\treturn { success: false, error: \"News search failed. Please try again.\" };\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tquery,\n\t\t\tsearchType: \"news\",\n\t\t\tdaysBack,\n\t\t\ttotalResults: results.totalResults,\n\t\t\tresults: results.results.map((r) => ({\n\t\t\t\ttitle: r.title,\n\t\t\t\turl: r.link,\n\t\t\t\tsnippet: r.snippet,\n\t\t\t\tsource: r.displayLink,\n\t\t\t})),\n\t\t};\n\t},\n});\n\n/**\n * Technical/documentation search - Search for technical documentation, guides, and tutorials\n * Use this for code examples, API documentation, how-to guides, etc.\n */\nexport const webSearchTechnicalTool = tool({\n\tdescription: \"Search for technical documentation, guides, tutorials, and code examples. Use this when looking for how to do something technical, API documentation, troubleshooting guides, or code references.\",\n\tparameters: z.object({\n\t\tquery: z.string().describe(\"The technical search query - include technology names and specific topics\"),\n\t\tnumResults: z.number().optional().default(5).describe(\"Number of results to return (1-10)\"),\n\t}),\n\texecute: async ({ query, numResults }) => {\n\t\tif (!googleCustomSearchService.isConfigured()) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Web search is not configured. Please set GOOGLE_API_KEY and GOOGLE_SEARCH_ENGINE_ID.\",\n\t\t\t};\n\t\t}\n\n\t\tconst results = await googleCustomSearchService.searchTechnical(query, {\n\t\t\tnum: Math.min(numResults, 10),\n\t\t});\n\n\t\tif (!results) {\n\t\t\treturn { success: false, error: \"Technical search failed. Please try again.\" };\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tquery,\n\t\t\tsearchType: \"technical\",\n\t\t\ttotalResults: results.totalResults,\n\t\t\tresults: results.results.map((r) => ({\n\t\t\t\ttitle: r.title,\n\t\t\t\turl: r.link,\n\t\t\t\tsnippet: r.snippet,\n\t\t\t\tsource: r.displayLink,\n\t\t\t})),\n\t\t};\n\t},\n});\n\n/**\n * Site-specific search - Search within a specific website\n * Use this to find information within a particular domain (e.g., manufacturer sites, gov sites)\n */\nexport const webSearchSiteTool = tool({\n\tdescription: \"Search within a specific website. Use this to find information on a particular site like manufacturer documentation, government sites, or specific company websites.\",\n\tparameters: z.object({\n\t\tquery: z.string().describe(\"The search query\"),\n\t\tsite: z.string().describe(\"The domain to search within (e.g., 'epa.gov', 'osha.gov', 'lennox.com')\"),\n\t\tnumResults: z.number().optional().default(5).describe(\"Number of results to return (1-10)\"),\n\t}),\n\texecute: async ({ query, site, numResults }) => {\n\t\tif (!googleCustomSearchService.isConfigured()) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Web search is not configured. Please set GOOGLE_API_KEY and GOOGLE_SEARCH_ENGINE_ID.\",\n\t\t\t};\n\t\t}\n\n\t\tconst results = await googleCustomSearchService.searchSite(query, site, {\n\t\t\tnum: Math.min(numResults, 10),\n\t\t});\n\n\t\tif (!results) {\n\t\t\treturn { success: false, error: \"Site search failed. Please try again.\" };\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tquery,\n\t\t\tsite,\n\t\t\ttotalResults: results.totalResults,\n\t\t\tresults: results.results.map((r) => ({\n\t\t\t\ttitle: r.title,\n\t\t\t\turl: r.link,\n\t\t\t\tsnippet: r.snippet,\n\t\t\t})),\n\t\t};\n\t},\n});\n\n/**\n * Maps tool names to their destructive metadata.\n * Tools marked as destructive will be intercepted and require owner approval.\n */\nexport const destructiveTools: Record<string, DestructiveToolMetadata> = {\n\t// Communication tools - sending messages to external parties\n\tsendEmail: {\n\t\tisDestructive: true,\n\t\tactionType: \"send_communication\",\n\t\triskLevel: \"high\",\n\t\trequiresOwnerApproval: true,\n\t\tdescription: \"Sends an email to a customer on behalf of your company\",\n\t\taffectedEntityType: \"customer\",\n\t},\n\tsendSms: {\n\t\tisDestructive: true,\n\t\tactionType: \"send_communication\",\n\t\triskLevel: \"high\",\n\t\trequiresOwnerApproval: true,\n\t\tdescription: \"Sends an SMS message to a customer on behalf of your company\",\n\t\taffectedEntityType: \"customer\",\n\t},\n\tinitiateCall: {\n\t\tisDestructive: true,\n\t\tactionType: \"send_communication\",\n\t\triskLevel: \"critical\",\n\t\trequiresOwnerApproval: true,\n\t\tdescription: \"Initiates a phone call to a customer\",\n\t\taffectedEntityType: \"customer\",\n\t},\n\tsendTeamEmail: {\n\t\tisDestructive: true,\n\t\tactionType: \"send_communication\",\n\t\triskLevel: \"medium\",\n\t\trequiresOwnerApproval: true,\n\t\tdescription: \"Sends an internal email to a team member\",\n\t\taffectedEntityType: \"team_member\",\n\t},\n\tsendTeamSms: {\n\t\tisDestructive: true,\n\t\tactionType: \"send_communication\",\n\t\triskLevel: \"medium\",\n\t\trequiresOwnerApproval: true,\n\t\tdescription: \"Sends an SMS to a team member\",\n\t\taffectedEntityType: \"team_member\",\n\t},\n\tsendVendorEmail: {\n\t\tisDestructive: true,\n\t\tactionType: \"send_communication\",\n\t\triskLevel: \"high\",\n\t\trequiresOwnerApproval: true,\n\t\tdescription: \"Sends an email to a vendor on behalf of your company\",\n\t\taffectedEntityType: \"vendor\",\n\t},\n\tsendVendorSms: {\n\t\tisDestructive: true,\n\t\tactionType: \"send_communication\",\n\t\triskLevel: \"high\",\n\t\trequiresOwnerApproval: true,\n\t\tdescription: \"Sends an SMS to a vendor on behalf of your company\",\n\t\taffectedEntityType: \"vendor\",\n\t},\n\tsendImmediateNotification: {\n\t\tisDestructive: true,\n\t\tactionType: \"send_communication\",\n\t\triskLevel: \"high\",\n\t\trequiresOwnerApproval: true,\n\t\tdescription: \"Sends an immediate notification to a recipient\",\n\t\taffectedEntityType: \"notification\",\n\t},\n\n\t// Financial tools - money movement and financial records\n\tcreateInvoice: {\n\t\tisDestructive: true,\n\t\tactionType: \"financial\",\n\t\triskLevel: \"high\",\n\t\trequiresOwnerApproval: true,\n\t\tdescription: \"Creates a new invoice that will be sent to a customer\",\n\t\taffectedEntityType: \"invoice\",\n\t},\n\ttransferToBucket: {\n\t\tisDestructive: true,\n\t\tactionType: \"financial\",\n\t\triskLevel: \"critical\",\n\t\trequiresOwnerApproval: true,\n\t\tdescription: \"Transfers funds between financial buckets\",\n\t\taffectedEntityType: \"finance_bucket\",\n\t},\n\n\t// Scheduling tools - affects customer commitments\n\tcreateAppointment: {\n\t\tisDestructive: true,\n\t\tactionType: \"bulk_update\",\n\t\triskLevel: \"medium\",\n\t\trequiresOwnerApproval: true,\n\t\tdescription: \"Creates a new appointment which commits company resources\",\n\t\taffectedEntityType: \"appointment\",\n\t},\n\tcancelReminder: {\n\t\tisDestructive: true,\n\t\tactionType: \"delete\",\n\t\triskLevel: \"low\",\n\t\trequiresOwnerApproval: true,\n\t\tdescription: \"Cancels a scheduled reminder\",\n\t\taffectedEntityType: \"reminder\",\n\t},\n\n\t// Data modification tools\n\tupdateCustomer: {\n\t\tisDestructive: true,\n\t\tactionType: \"bulk_update\",\n\t\triskLevel: \"medium\",\n\t\trequiresOwnerApproval: true,\n\t\tdescription: \"Modifies customer record information\",\n\t\taffectedEntityType: \"customer\",\n\t},\n};\n\n/**\n * Check if a tool is destructive and requires owner approval\n */\nexport function isDestructiveTool(toolName: string): boolean {\n\treturn toolName in destructiveTools;\n}\n\n/**\n * Get the metadata for a destructive tool\n */\nexport function getDestructiveToolMetadata(toolName: string): DestructiveToolMetadata | null {\n\treturn destructiveTools[toolName] || null;\n}\n\n/**\n * Get all destructive tool names\n */\nexport function getDestructiveToolNames(): string[] {\n\treturn Object.keys(destructiveTools);\n}\n","/**\n * Google Custom Search Service\n *\n * Provides web search capabilities for the AI agent:\n * - General web search\n * - News search\n * - Image search\n * - Site-specific search\n *\n * API: Google Custom Search JSON API\n * Free Tier: 100 queries/day free, then $5/1000 queries\n * Docs: https://developers.google.com/custom-search/v1/overview\n *\n * Setup:\n * 1. Enable Custom Search API in Google Cloud Console\n * 2. Create a Programmable Search Engine at https://programmablesearchengine.google.com/\n * 3. Get your Search Engine ID (cx parameter)\n * 4. Set GOOGLE_SEARCH_ENGINE_ID in environment\n */\n\nimport { z } from \"zod\";\n\nconst USER_AGENT = \"Stratos-FMS/1.0 (support@stratos.app)\";\n\n// Zod schemas for type safety\nconst SearchResultSchema = z.object({\n\ttitle: z.string(),\n\tlink: z.string().url(),\n\tsnippet: z.string(),\n\tdisplayLink: z.string(),\n\tformattedUrl: z.string().optional(),\n\tpagemap: z\n\t\t.object({\n\t\t\tcse_thumbnail: z\n\t\t\t\t.array(\n\t\t\t\t\tz.object({\n\t\t\t\t\t\tsrc: z.string(),\n\t\t\t\t\t\twidth: z.string().optional(),\n\t\t\t\t\t\theight: z.string().optional(),\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t\t.optional(),\n\t\t\tmetatags: z\n\t\t\t\t.array(\n\t\t\t\t\tz.record(z.string())\n\t\t\t\t)\n\t\t\t\t.optional(),\n\t\t})\n\t\t.optional(),\n});\n\nconst SearchResponseSchema = z.object({\n\tresults: z.array(SearchResultSchema),\n\ttotalResults: z.number(),\n\tsearchTime: z.number(),\n\tquery: z.string(),\n\tsearchType: z.enum([\"web\", \"news\", \"image\"]),\n\tnextPageToken: z.string().optional(),\n});\n\nexport type SearchResult = z.infer<typeof SearchResultSchema>;\nexport type SearchResponse = z.infer<typeof SearchResponseSchema>;\n\n/**\n * Search options\n */\nexport interface SearchOptions {\n\t/** Number of results to return (max 10 per request) */\n\tnum?: number;\n\t/** Starting index for pagination (1-based) */\n\tstart?: number;\n\t/** Restrict to specific site (e.g., \"reddit.com\") */\n\tsiteSearch?: string;\n\t/** Exclude results from site */\n\tsiteSearchExclude?: string;\n\t/** Date restriction: d[number], w[number], m[number], y[number] */\n\tdateRestrict?: string;\n\t/** Safe search level */\n\tsafe?: \"off\" | \"medium\" | \"high\";\n\t/** Filter adult content */\n\tfilter?: \"0\" | \"1\";\n\t/** Country to search from (ISO 3166-1 alpha-2) */\n\tgl?: string;\n\t/** Language of results (ISO 639-1) */\n\tlr?: string;\n\t/** Sort by date (if supported) */\n\tsort?: \"date\" | \"relevance\";\n}\n\nconst CACHE_TTL_MS = 1000 * 60 * 15; // 15 minutes\n\n// biome-ignore lint/suspicious/noConsole: Backend service logging is acceptable\nclass GoogleCustomSearchService {\n\tprivate readonly apiKey: string | undefined;\n\tprivate readonly searchEngineId: string | undefined;\n\tprivate readonly cache: Map<string, { data: SearchResponse; timestamp: number }> = new Map();\n\tprivate readonly cacheTTL = CACHE_TTL_MS;\n\n\tconstructor() {\n\t\t// Use unified GOOGLE_API_KEY for all Google services\n\t\tthis.apiKey =\n\t\t\tprocess.env.GOOGLE_API_KEY ||\n\t\t\tprocess.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY ||\n\t\t\tprocess.env.GOOGLE_MAPS_API_KEY;\n\t\tthis.searchEngineId =\n\t\t\tprocess.env.GOOGLE_SEARCH_ENGINE_ID ||\n\t\t\tprocess.env.GOOGLE_CSE_ID ||\n\t\t\tprocess.env.NEXT_PUBLIC_GOOGLE_SEARCH_ENGINE_ID;\n\t}\n\n\t/**\n\t * Perform a web search\n\t */\n\tasync search(query: string, options: SearchOptions = {}): Promise<SearchResponse | null> {\n\t\tif (!this.apiKey || !this.searchEngineId) {\n\t\t\tconsole.warn(\"Google Custom Search not configured: missing API key or Search Engine ID\");\n\t\t\treturn null;\n\t\t}\n\n\t\tconst cacheKey = this.getCacheKey(query, options, \"web\");\n\t\tconst cached = this.cache.get(cacheKey);\n\n\t\tif (cached && Date.now() - cached.timestamp < this.cacheTTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\tconst params = this.buildParams(query, options);\n\t\t\tconst url = `https://www.googleapis.com/customsearch/v1?${params.toString()}`;\n\n\t\t\tconst response = await fetch(url, {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconst error = await response.json();\n\t\t\t\tconsole.error(\"Google Custom Search error:\", error);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\t\t\tconst searchResponse = this.parseResponse(data, query, \"web\");\n\n\t\t\tthis.cache.set(cacheKey, { data: searchResponse, timestamp: Date.now() });\n\t\t\treturn searchResponse;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Google Custom Search failed:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Search for news articles\n\t * Uses date restriction to get recent results\n\t */\n\tasync searchNews(\n\t\tquery: string,\n\t\toptions: SearchOptions & { daysBack?: number } = {}\n\t): Promise<SearchResponse | null> {\n\t\tconst { daysBack = 7, ...searchOptions } = options;\n\n\t\t// Add date restriction for recent news\n\t\tconst newsOptions: SearchOptions = {\n\t\t\t...searchOptions,\n\t\t\tdateRestrict: `d${daysBack}`,\n\t\t\tsort: \"date\",\n\t\t};\n\n\t\tconst cacheKey = this.getCacheKey(query, newsOptions, \"news\");\n\t\tconst cached = this.cache.get(cacheKey);\n\n\t\tif (cached && Date.now() - cached.timestamp < this.cacheTTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\tconst result = await this.search(query, newsOptions);\n\t\tif (result) {\n\t\t\tresult.searchType = \"news\";\n\t\t\tthis.cache.set(cacheKey, { data: result, timestamp: Date.now() });\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * Search for images\n\t */\n\tasync searchImages(query: string, options: SearchOptions = {}): Promise<SearchResponse | null> {\n\t\tif (!this.apiKey || !this.searchEngineId) {\n\t\t\tconsole.warn(\"Google Custom Search not configured\");\n\t\t\treturn null;\n\t\t}\n\n\t\tconst cacheKey = this.getCacheKey(query, options, \"image\");\n\t\tconst cached = this.cache.get(cacheKey);\n\n\t\tif (cached && Date.now() - cached.timestamp < this.cacheTTL) {\n\t\t\treturn cached.data;\n\t\t}\n\n\t\ttry {\n\t\t\tconst params = this.buildParams(query, options);\n\t\t\tparams.set(\"searchType\", \"image\");\n\n\t\t\tconst url = `https://www.googleapis.com/customsearch/v1?${params.toString()}`;\n\n\t\t\tconst response = await fetch(url, {\n\t\t\t\theaders: { \"User-Agent\": USER_AGENT },\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconst error = await response.json();\n\t\t\t\tconsole.error(\"Google Image Search error:\", error);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\t\t\tconst searchResponse = this.parseImageResponse(data, query);\n\n\t\t\tthis.cache.set(cacheKey, { data: searchResponse, timestamp: Date.now() });\n\t\t\treturn searchResponse;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Google Image Search failed:\", error);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Search within a specific site\n\t */\n\tasync searchSite(\n\t\tquery: string,\n\t\tsite: string,\n\t\toptions: SearchOptions = {}\n\t): Promise<SearchResponse | null> {\n\t\treturn this.search(query, {\n\t\t\t...options,\n\t\t\tsiteSearch: site,\n\t\t});\n\t}\n\n\t/**\n\t * Search for technical/documentation content\n\t * Focuses on official docs, Stack Overflow, GitHub\n\t */\n\tasync searchTechnical(query: string, options: SearchOptions = {}): Promise<SearchResponse | null> {\n\t\t// Append technical terms to improve results\n\t\tconst technicalQuery = `${query} documentation OR tutorial OR guide`;\n\t\treturn this.search(technicalQuery, options);\n\t}\n\n\t/**\n\t * Build URL params for API request\n\t */\n\tprivate buildParams(query: string, options: SearchOptions): URLSearchParams {\n\t\tconst params = new URLSearchParams({\n\t\t\tkey: this.apiKey!,\n\t\t\tcx: this.searchEngineId!,\n\t\t\tq: query,\n\t\t});\n\n\t\tif (options.num) params.set(\"num\", String(Math.min(options.num, 10)));\n\t\tif (options.start) params.set(\"start\", String(options.start));\n\t\tif (options.siteSearch) params.set(\"siteSearch\", options.siteSearch);\n\t\tif (options.siteSearchExclude) {\n\t\t\tparams.set(\"siteSearch\", options.siteSearchExclude);\n\t\t\tparams.set(\"siteSearchFilter\", \"e\");\n\t\t}\n\t\tif (options.dateRestrict) params.set(\"dateRestrict\", options.dateRestrict);\n\t\tif (options.safe) params.set(\"safe\", options.safe);\n\t\tif (options.filter) params.set(\"filter\", options.filter);\n\t\tif (options.gl) params.set(\"gl\", options.gl);\n\t\tif (options.lr) params.set(\"lr\", options.lr);\n\t\tif (options.sort === \"date\") params.set(\"sort\", \"date\");\n\n\t\treturn params;\n\t}\n\n\t/**\n\t * Parse API response into our schema\n\t */\n\tprivate parseResponse(\n\t\tdata: Record<string, unknown>,\n\t\tquery: string,\n\t\tsearchType: \"web\" | \"news\" | \"image\"\n\t): SearchResponse {\n\t\tconst items = (data.items as Array<Record<string, unknown>>) || [];\n\t\tconst searchInfo = data.searchInformation as { totalResults?: string; searchTime?: number } | undefined;\n\n\t\treturn {\n\t\t\tresults: items.map((item) => ({\n\t\t\t\ttitle: (item.title as string) || \"\",\n\t\t\t\tlink: (item.link as string) || \"\",\n\t\t\t\tsnippet: (item.snippet as string) || \"\",\n\t\t\t\tdisplayLink: (item.displayLink as string) || \"\",\n\t\t\t\tformattedUrl: item.formattedUrl as string | undefined,\n\t\t\t\tpagemap: item.pagemap as SearchResult[\"pagemap\"],\n\t\t\t})),\n\t\t\ttotalResults: Number.parseInt(searchInfo?.totalResults || \"0\", 10),\n\t\t\tsearchTime: searchInfo?.searchTime || 0,\n\t\t\tquery,\n\t\t\tsearchType,\n\t\t\tnextPageToken: data.queries\n\t\t\t\t? ((data.queries as Record<string, Array<{ startIndex: number }>>).nextPage?.[0]?.startIndex?.toString())\n\t\t\t\t: undefined,\n\t\t};\n\t}\n\n\t/**\n\t * Parse image search response\n\t */\n\tprivate parseImageResponse(data: Record<string, unknown>, query: string): SearchResponse {\n\t\tconst items = (data.items as Array<Record<string, unknown>>) || [];\n\t\tconst searchInfo = data.searchInformation as { totalResults?: string; searchTime?: number } | undefined;\n\n\t\treturn {\n\t\t\tresults: items.map((item) => ({\n\t\t\t\ttitle: (item.title as string) || \"\",\n\t\t\t\tlink: (item.link as string) || \"\",\n\t\t\t\tsnippet: (item.snippet as string) || \"\",\n\t\t\t\tdisplayLink: (item.displayLink as string) || \"\",\n\t\t\t\tformattedUrl: (item.image as { contextLink?: string })?.contextLink,\n\t\t\t\tpagemap: {\n\t\t\t\t\tcse_thumbnail: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsrc: (item.image as { thumbnailLink?: string })?.thumbnailLink || (item.link as string),\n\t\t\t\t\t\t\twidth: String((item.image as { thumbnailWidth?: number })?.thumbnailWidth || \"\"),\n\t\t\t\t\t\t\theight: String((item.image as { thumbnailHeight?: number })?.thumbnailHeight || \"\"),\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t})),\n\t\t\ttotalResults: Number.parseInt(searchInfo?.totalResults || \"0\", 10),\n\t\t\tsearchTime: searchInfo?.searchTime || 0,\n\t\t\tquery,\n\t\t\tsearchType: \"image\",\n\t\t};\n\t}\n\n\t/**\n\t * Generate cache key\n\t */\n\tprivate getCacheKey(query: string, options: SearchOptions, type: string): string {\n\t\treturn `search:${type}:${query}:${JSON.stringify(options)}`;\n\t}\n\n\t/**\n\t * Check if service is configured\n\t */\n\tisConfigured(): boolean {\n\t\treturn !!this.apiKey && !!this.searchEngineId;\n\t}\n\n\t/**\n\t * Get configuration status details\n\t */\n\tgetConfigStatus(): { configured: boolean; hasApiKey: boolean; hasSearchEngineId: boolean } {\n\t\treturn {\n\t\t\tconfigured: this.isConfigured(),\n\t\t\thasApiKey: !!this.apiKey,\n\t\t\thasSearchEngineId: !!this.searchEngineId,\n\t\t};\n\t}\n\n\t/**\n\t * Clear the cache\n\t */\n\tclearCache(): void {\n\t\tthis.cache.clear();\n\t}\n}\n\nexport const googleCustomSearchService = new GoogleCustomSearchService();\n"],"names":[],"mappings":"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"}