{"version":3,"sources":["../../../../../apps/web/emails/templates/onboarding/verification-complete.tsx","../../../../../apps/web/emails/templates/onboarding/verification-submitted.tsx","../../../../../apps/web/src/lib/email/verification-emails.ts","../../../../../apps/web/src/lib/telnyx/account-verification.ts","../../../../../apps/web/src/actions/ten-dlc-registration.ts"],"sourcesContent":["/**\n * Verification Complete Email Template\n * Sent when toll-free verification is approved (or all verifications complete)\n *\n * Features:\n * - Celebrates approval\n * - Confirms SMS/MMS are now enabled\n * - Provides quick start guide\n * - Links to messaging dashboard\n */\n\nimport { Text } from \"@react-email/components\";\nimport type { VerificationCompleteProps } from \"../../../src/lib/email/email-types\";\nimport { Button } from \"../../components/button\";\nimport { Card } from \"../../components/card\";\nimport { Heading } from \"../../components/heading\";\nimport { BaseLayout } from \"../../layouts/base-layout\";\n\nexport default function VerificationCompleteEmail({\n\tcompanyName,\n\tcontactName,\n\tverificationTypes,\n\tdashboardUrl,\n\tmessagingUrl,\n\tpreviewText = \"Your business messaging is now fully enabled!\",\n}: VerificationCompleteProps) {\n\tconst hasTollFree = verificationTypes.includes(\"toll-free\");\n\tconst has10DLC = verificationTypes.includes(\"10dlc\");\n\n\treturn (\n\t\t<BaseLayout previewText={previewText}>\n\t\t\t<Heading level={1}>üéâ Your Messaging is Live!</Heading>\n\n\t\t\t<Text style={paragraph}>Hi {contactName},</Text>\n\n\t\t\t<Text style={paragraph}>\n\t\t\t\tExcellent news! Your business messaging verification for{\" \"}\n\t\t\t\t<strong>{companyName}</strong> has been approved. You can now send SMS\n\t\t\t\tand MMS messages to your customers.\n\t\t\t</Text>\n\n\t\t\t{/* Success Card */}\n\t\t\t<Card style={successCard}>\n\t\t\t\t<div style={cardIcon}>‚úÖ</div>\n\t\t\t\t<Heading level={3} style={cardTitle}>\n\t\t\t\t\tAll Systems Ready\n\t\t\t\t</Heading>\n\t\t\t\t<Text style={cardText}>\n\t\t\t\t\t{hasTollFree && has10DLC && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\tBoth your toll-free and regular (10DLC) numbers are now approved\n\t\t\t\t\t\t\tand ready to send messages.\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t\t{hasTollFree && !has10DLC && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\tYour toll-free numbers have been approved and are ready to send\n\t\t\t\t\t\t\tmessages.\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t\t{!hasTollFree && has10DLC && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\tYour 10DLC (regular) numbers have been approved and are ready to\n\t\t\t\t\t\t\tsend messages.\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</Text>\n\t\t\t</Card>\n\n\t\t\t{/* What You Can Do Now */}\n\t\t\t<Heading level={3}>What You Can Do Now</Heading>\n\n\t\t\t<ul style={list}>\n\t\t\t\t<li style={listItem}>\n\t\t\t\t\t<strong>Send SMS/MMS:</strong> Text your customers with appointment\n\t\t\t\t\treminders, estimates, invoices, and updates\n\t\t\t\t</li>\n\t\t\t\t<li style={listItem}>\n\t\t\t\t\t<strong>Two-Way Messaging:</strong> Receive and respond to customer\n\t\t\t\t\ttexts directly in your dashboard\n\t\t\t\t</li>\n\t\t\t\t<li style={listItem}>\n\t\t\t\t\t<strong>Automated Messages:</strong> Set up automatic text\n\t\t\t\t\tnotifications for jobs, appointments, and payments\n\t\t\t\t</li>\n\t\t\t\t<li style={listItem}>\n\t\t\t\t\t<strong>Rich Media:</strong> Send photos, documents, and other\n\t\t\t\t\tattachments via MMS\n\t\t\t\t</li>\n\t\t\t\t{hasTollFree && (\n\t\t\t\t\t<li style={listItem}>\n\t\t\t\t\t\t<strong>RCS Messaging:</strong> Support for read receipts and rich\n\t\t\t\t\t\tmessaging features on compatible devices\n\t\t\t\t\t</li>\n\t\t\t\t)}\n\t\t\t</ul>\n\n\t\t\t{/* Quick Start */}\n\t\t\t<Card>\n\t\t\t\t<Heading level={3}>Quick Start Guide</Heading>\n\n\t\t\t\t<Text style={stepText}>\n\t\t\t\t\t<strong>1. Set Up Message Templates</strong>\n\t\t\t\t\t<br />\n\t\t\t\t\tCreate reusable templates for common messages like appointment\n\t\t\t\t\tconfirmations and reminders.\n\t\t\t\t</Text>\n\n\t\t\t\t<Text style={stepText}>\n\t\t\t\t\t<strong>2. Configure Notifications</strong>\n\t\t\t\t\t<br />\n\t\t\t\t\tEnable automatic text notifications for job updates, invoice payments,\n\t\t\t\t\tand more.\n\t\t\t\t</Text>\n\n\t\t\t\t<Text style={stepText}>\n\t\t\t\t\t<strong>3. Start Messaging</strong>\n\t\t\t\t\t<br />\n\t\t\t\t\tSend your first text message! Try texting a test appointment reminder\n\t\t\t\t\tor estimate notification.\n\t\t\t\t</Text>\n\t\t\t</Card>\n\n\t\t\t{/* CTAs */}\n\t\t\t<div style={buttonContainer}>\n\t\t\t\t<Button href={messagingUrl}>Open Messaging Dashboard</Button>\n\t\t\t</div>\n\n\t\t\t<div style={secondaryButtonContainer}>\n\t\t\t\t<a href={dashboardUrl} style={secondaryLink}>\n\t\t\t\t\tBack to Main Dashboard ‚Üí\n\t\t\t\t</a>\n\t\t\t</div>\n\n\t\t\t{/* Support */}\n\t\t\t<Text style={supportText}>\n\t\t\t\t<strong>Need help getting started?</strong> Check out our{\" \"}\n\t\t\t\t<a href=\"https://thorbis.com/docs/messaging\" style={link}>\n\t\t\t\t\tmessaging guide\n\t\t\t\t</a>{\" \"}\n\t\t\t\tor contact support at{\" \"}\n\t\t\t\t<a href=\"mailto:support@thorbis.com\" style={link}>\n\t\t\t\t\tsupport@thorbis.com\n\t\t\t\t</a>\n\t\t\t</Text>\n\n\t\t\t<Text style={footerNote}>\n\t\t\t\tYour approval was issued by The Campaign Registry and is valid for all\n\t\t\t\tUS carriers. Keep sending great messages! üì±\n\t\t\t</Text>\n\t\t</BaseLayout>\n\t);\n}\n\nconst paragraph = {\n\tcolor: \"#374151\",\n\tfontSize: \"16px\",\n\tlineHeight: \"24px\",\n\tmargin: \"0 0 16px 0\",\n};\n\nconst successCard = {\n\tbackgroundColor: \"#f0fdf4\",\n\tborder: \"1px solid #86efac\",\n\tborderRadius: \"8px\",\n\tpadding: \"24px\",\n\tmargin: \"24px 0\",\n\ttextAlign: \"center\" as const,\n};\n\nconst cardIcon = {\n\tfontSize: \"48px\",\n\tmarginBottom: \"12px\",\n};\n\nconst cardTitle = {\n\tcolor: \"#166534\",\n\tfontSize: \"20px\",\n\tfontWeight: \"600\",\n\tmargin: \"0 0 8px 0\",\n};\n\nconst cardText = {\n\tcolor: \"#15803d\",\n\tfontSize: \"16px\",\n\tlineHeight: \"24px\",\n\tmargin: \"0\",\n};\n\nconst list = {\n\tcolor: \"#374151\",\n\tfontSize: \"16px\",\n\tlineHeight: \"24px\",\n\tmargin: \"16px 0 24px 24px\",\n\tpadding: \"0\",\n};\n\nconst listItem = {\n\tmargin: \"0 0 12px 0\",\n};\n\nconst stepText = {\n\tcolor: \"#6b7280\",\n\tfontSize: \"15px\",\n\tlineHeight: \"22px\",\n\tmargin: \"0 0 16px 0\",\n};\n\nconst buttonContainer = {\n\tmargin: \"32px 0 16px 0\",\n\ttextAlign: \"center\" as const,\n};\n\nconst secondaryButtonContainer = {\n\tmargin: \"0 0 32px 0\",\n\ttextAlign: \"center\" as const,\n};\n\nconst secondaryLink = {\n\tcolor: \"hsl(217 91% 60%)\",\n\tfontSize: \"16px\",\n\ttextDecoration: \"none\",\n\tfontWeight: \"500\",\n};\n\nconst supportText = {\n\tcolor: \"#374151\",\n\tfontSize: \"16px\",\n\tlineHeight: \"24px\",\n\tmargin: \"24px 0 0 0\",\n\tpadding: \"16px\",\n\tbackgroundColor: \"#f9fafb\",\n\tborderRadius: \"8px\",\n\ttextAlign: \"center\" as const,\n};\n\nconst footerNote = {\n\tcolor: \"#9ca3af\",\n\tfontSize: \"13px\",\n\tlineHeight: \"18px\",\n\tmargin: \"24px 0 0 0\",\n\ttextAlign: \"center\" as const,\n\tfontStyle: \"italic\",\n};\n\nconst link = {\n\tcolor: \"hsl(217 91% 60%)\",\n\ttextDecoration: \"underline\",\n};\n","/**\n * Verification Submitted Email Template\n * Sent immediately after user submits toll-free/10DLC verification during onboarding\n *\n * Features:\n * - Confirms submission received\n * - Explains verification timeline\n * - Sets expectations for what happens next\n * - Provides support contact info\n */\n\nimport { Text } from \"@react-email/components\";\nimport type { VerificationSubmittedProps } from \"../../../src/lib/email/email-types\";\nimport { Button } from \"../../components/button\";\nimport { Card } from \"../../components/card\";\nimport { Heading } from \"../../components/heading\";\nimport { BaseLayout } from \"../../layouts/base-layout\";\n\nexport default function VerificationSubmittedEmail({\n\tcompanyName,\n\tcontactName,\n\thasTollFreeNumbers,\n\thas10DLCNumbers,\n\ttollFreeCount = 0,\n\tdlcCount = 0,\n\tdashboardUrl,\n\tpreviewText = \"Your messaging verification has been submitted successfully\",\n}: VerificationSubmittedProps) {\n\treturn (\n\t\t<BaseLayout previewText={previewText}>\n\t\t\t<Heading level={1}>Verification Submitted Successfully!</Heading>\n\n\t\t\t<Text style={paragraph}>Hi {contactName},</Text>\n\n\t\t\t<Text style={paragraph}>\n\t\t\t\tGreat news! We've successfully submitted your business messaging\n\t\t\t\tverification for <strong>{companyName}</strong>. Here's what happens\n\t\t\t\tnext:\n\t\t\t</Text>\n\n\t\t\t{/* Timeline Cards */}\n\t\t\t<div style={timelineContainer}>\n\t\t\t\t{has10DLCNumbers && (\n\t\t\t\t\t<Card style={successCard}>\n\t\t\t\t\t\t<div style={cardIcon}>‚úÖ</div>\n\t\t\t\t\t\t<Heading level={3} style={cardTitle}>\n\t\t\t\t\t\t\t10DLC Registration Complete\n\t\t\t\t\t\t</Heading>\n\t\t\t\t\t\t<Text style={cardText}>\n\t\t\t\t\t\t\t<strong>\n\t\t\t\t\t\t\t\t{dlcCount} regular number{dlcCount !== 1 ? \"s\" : \"\"}\n\t\t\t\t\t\t\t</strong>{\" \"}\n\t\t\t\t\t\t\tenabled for SMS immediately. You can start sending text messages\n\t\t\t\t\t\t\tright away!\n\t\t\t\t\t\t</Text>\n\t\t\t\t\t</Card>\n\t\t\t\t)}\n\n\t\t\t\t{hasTollFreeNumbers && (\n\t\t\t\t\t<Card style={pendingCard}>\n\t\t\t\t\t\t<div style={cardIcon}>‚è∞</div>\n\t\t\t\t\t\t<Heading level={3} style={cardTitle}>\n\t\t\t\t\t\t\tToll-Free Verification Pending\n\t\t\t\t\t\t</Heading>\n\t\t\t\t\t\t<Text style={cardText}>\n\t\t\t\t\t\t\t<strong>\n\t\t\t\t\t\t\t\t{tollFreeCount} toll-free number{tollFreeCount !== 1 ? \"s\" : \"\"}\n\t\t\t\t\t\t\t</strong>{\" \"}\n\t\t\t\t\t\t\tsubmitted for verification. Approval typically takes{\" \"}\n\t\t\t\t\t\t\t<strong>5-7 business days</strong>.\n\t\t\t\t\t\t</Text>\n\t\t\t\t\t</Card>\n\t\t\t\t)}\n\t\t\t</div>\n\n\t\t\t{/* What to Expect */}\n\t\t\t<Card>\n\t\t\t\t<Heading level={3}>What to Expect</Heading>\n\n\t\t\t\t<ul style={list}>\n\t\t\t\t\t{has10DLCNumbers && (\n\t\t\t\t\t\t<li style={listItem}>\n\t\t\t\t\t\t\t<strong>Regular Numbers (10DLC):</strong> Ready to use! Start\n\t\t\t\t\t\t\tsending SMS/MMS to your customers right away.\n\t\t\t\t\t\t</li>\n\t\t\t\t\t)}\n\t\t\t\t\t{hasTollFreeNumbers && (\n\t\t\t\t\t\t<li style={listItem}>\n\t\t\t\t\t\t\t<strong>Toll-Free Numbers:</strong> Under review by our carrier\n\t\t\t\t\t\t\tpartners. We'll email you when they're approved (usually within\n\t\t\t\t\t\t\t5-7 business days).\n\t\t\t\t\t\t</li>\n\t\t\t\t\t)}\n\t\t\t\t\t<li style={listItem}>\n\t\t\t\t\t\t<strong>No Action Required:</strong> We're handling everything\n\t\t\t\t\t\tautomatically. You can continue setting up your account.\n\t\t\t\t\t</li>\n\t\t\t\t\t<li style={listItem}>\n\t\t\t\t\t\t<strong>Notification:</strong> You'll receive another email once\n\t\t\t\t\t\tyour toll-free verification is complete.\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</Card>\n\n\t\t\t{/* CTA */}\n\t\t\t<div style={buttonContainer}>\n\t\t\t\t<Button href={dashboardUrl}>Go to Dashboard</Button>\n\t\t\t</div>\n\n\t\t\t{/* Support */}\n\t\t\t<Text style={supportText}>\n\t\t\t\t<strong>Need help?</strong> If you have any questions about the\n\t\t\t\tverification process, our support team is here to help at{\" \"}\n\t\t\t\t<a href=\"mailto:support@thorbis.com\" style={link}>\n\t\t\t\t\tsupport@thorbis.com\n\t\t\t\t</a>\n\t\t\t</Text>\n\n\t\t\t<Text style={footerNote}>\n\t\t\t\tThis is a federal requirement enforced by The Campaign Registry and US\n\t\t\t\tcarriers to prevent spam and ensure legitimate business messaging.\n\t\t\t</Text>\n\t\t</BaseLayout>\n\t);\n}\n\nconst paragraph = {\n\tcolor: \"#374151\",\n\tfontSize: \"16px\",\n\tlineHeight: \"24px\",\n\tmargin: \"0 0 16px 0\",\n};\n\nconst timelineContainer = {\n\tmargin: \"32px 0\",\n\tdisplay: \"grid\",\n\tgap: \"16px\",\n};\n\nconst successCard = {\n\tbackgroundColor: \"#f0fdf4\",\n\tborder: \"1px solid #86efac\",\n\tborderRadius: \"8px\",\n\tpadding: \"24px\",\n};\n\nconst pendingCard = {\n\tbackgroundColor: \"#fffbeb\",\n\tborder: \"1px solid #fde047\",\n\tborderRadius: \"8px\",\n\tpadding: \"24px\",\n};\n\nconst cardIcon = {\n\tfontSize: \"32px\",\n\tmarginBottom: \"8px\",\n};\n\nconst cardTitle = {\n\tcolor: \"#374151\",\n\tfontSize: \"18px\",\n\tfontWeight: \"600\",\n\tmargin: \"0 0 8px 0\",\n};\n\nconst cardText = {\n\tcolor: \"#6b7280\",\n\tfontSize: \"14px\",\n\tlineHeight: \"20px\",\n\tmargin: \"0\",\n};\n\nconst list = {\n\tcolor: \"#374151\",\n\tfontSize: \"16px\",\n\tlineHeight: \"24px\",\n\tmargin: \"16px 0 0 24px\",\n\tpadding: \"0\",\n};\n\nconst listItem = {\n\tmargin: \"0 0 12px 0\",\n};\n\nconst buttonContainer = {\n\tmargin: \"32px 0\",\n\ttextAlign: \"center\" as const,\n};\n\nconst supportText = {\n\tcolor: \"#374151\",\n\tfontSize: \"16px\",\n\tlineHeight: \"24px\",\n\tmargin: \"24px 0 0 0\",\n\tpadding: \"16px\",\n\tbackgroundColor: \"#f9fafb\",\n\tborderRadius: \"8px\",\n\ttextAlign: \"center\" as const,\n};\n\nconst footerNote = {\n\tcolor: \"#9ca3af\",\n\tfontSize: \"13px\",\n\tlineHeight: \"18px\",\n\tmargin: \"24px 0 0 0\",\n\ttextAlign: \"center\" as const,\n\tfontStyle: \"italic\",\n};\n\nconst link = {\n\tcolor: \"hsl(217 91% 60%)\",\n\ttextDecoration: \"underline\",\n};\n","/**\n * Verification Email Utilities\n * Helper functions for sending onboarding verification emails\n *\n * Features:\n * - Send \"verification submitted\" email\n * - Send \"verification complete\" email\n * - Type-safe email sending\n * - Company-specific context\n */\n\n\"use server\";\n\nimport type { ReactElement } from \"react\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport VerificationCompleteEmail from \"../../../emails/templates/onboarding/verification-complete\";\nimport VerificationSubmittedEmail from \"../../../emails/templates/onboarding/verification-submitted\";\nimport { sendEmail } from \"./email-sender\";\nimport type { EmailSendResult } from \"./email-types\";\nimport { EmailTemplate } from \"./email-types\";\nimport { emailConfig } from \"./resend-client\";\n\n/**\n * Send \"Verification Submitted\" email\n * Called immediately after user submits toll-free/10DLC verification during onboarding\n *\n * @param companyId - Company UUID\n * @param recipientEmail - Email address to send to (usually company owner)\n * @param context - Additional context about the verification\n */\nexport async function sendVerificationSubmittedEmail(\n\tcompanyId: string,\n\trecipientEmail: string,\n\tcontext: {\n\t\thasTollFreeNumbers: boolean;\n\t\thas10DLCNumbers: boolean;\n\t\ttollFreeCount?: number;\n\t\tdlcCount?: number;\n\t},\n): Promise<EmailSendResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Fetch company details\n\t\tconst { data: company, error: companyError } = await supabase\n\t\t\t.from(\"companies\")\n\t\t\t.select(\"name\")\n\t\t\t.eq(\"id\", companyId)\n\t\t\t.single();\n\n\t\tif (companyError || !company) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: `Company not found: ${companyError?.message}`,\n\t\t\t};\n\t\t}\n\n\t\t// Fetch user details (company owner)\n\t\tconst { data: owner, error: ownerError } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\"full_name\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"role\", \"owner\")\n\t\t\t.single();\n\n\t\tconst contactName = owner?.full_name || \"there\";\n\n\t\t// Build dashboard URL\n\t\tconst dashboardUrl = `${emailConfig.appUrl}/dashboard`;\n\n\t\t// Create email template\n\t\tconst emailTemplate = VerificationSubmittedEmail({\n\t\t\tcompanyName: company.name,\n\t\t\tcontactName,\n\t\t\thasTollFreeNumbers: context.hasTollFreeNumbers,\n\t\t\thas10DLCNumbers: context.has10DLCNumbers,\n\t\t\ttollFreeCount: context.tollFreeCount || 0,\n\t\t\tdlcCount: context.dlcCount || 0,\n\t\t\tdashboardUrl,\n\t\t}) as ReactElement;\n\n\t\t// Send email\n\t\treturn await sendEmail({\n\t\t\tto: recipientEmail,\n\t\t\tsubject: `Messaging Verification Submitted - ${company.name}`,\n\t\t\ttemplate: emailTemplate,\n\t\t\ttemplateType: EmailTemplate.VERIFICATION_SUBMITTED,\n\t\t\tcompanyId,\n\t\t\ttags: [\n\t\t\t\t{ name: \"type\", value: \"onboarding\" },\n\t\t\t\t{ name: \"verification\", value: \"submitted\" },\n\t\t\t],\n\t\t});\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror:\n\t\t\t\terror instanceof Error\n\t\t\t\t\t? error.message\n\t\t\t\t\t: \"Failed to send verification submitted email\",\n\t\t};\n\t}\n}\n\n/**\n * Send \"Verification Complete\" email\n * Called when toll-free verification is approved (or all verifications complete)\n *\n * @param companyId - Company UUID\n * @param recipientEmail - Email address to send to\n * @param verificationTypes - Array of verification types that completed ([\"toll-free\", \"10dlc\"])\n */\nasync function sendVerificationCompleteEmail(\n\tcompanyId: string,\n\trecipientEmail: string,\n\tverificationTypes: string[],\n): Promise<EmailSendResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Fetch company details\n\t\tconst { data: company, error: companyError } = await supabase\n\t\t\t.from(\"companies\")\n\t\t\t.select(\"name\")\n\t\t\t.eq(\"id\", companyId)\n\t\t\t.single();\n\n\t\tif (companyError || !company) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: `Company not found: ${companyError?.message}`,\n\t\t\t};\n\t\t}\n\n\t\t// Fetch user details (company owner)\n\t\tconst { data: owner } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\"full_name\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"role\", \"owner\")\n\t\t\t.single();\n\n\t\tconst contactName = owner?.full_name || \"there\";\n\n\t\t// Build URLs\n\t\tconst dashboardUrl = `${emailConfig.appUrl}/dashboard`;\n\t\tconst messagingUrl = `${emailConfig.appUrl}/dashboard/communications/messaging`;\n\n\t\t// Create email template\n\t\tconst emailTemplate = VerificationCompleteEmail({\n\t\t\tcompanyName: company.name,\n\t\t\tcontactName,\n\t\t\tverificationTypes,\n\t\t\tdashboardUrl,\n\t\t\tmessagingUrl,\n\t\t}) as ReactElement;\n\n\t\t// Send email\n\t\treturn await sendEmail({\n\t\t\tto: recipientEmail,\n\t\t\tsubject: `üéâ Messaging Approved - ${company.name}`,\n\t\t\ttemplate: emailTemplate,\n\t\t\ttemplateType: EmailTemplate.VERIFICATION_COMPLETE,\n\t\t\tcompanyId,\n\t\t\ttags: [\n\t\t\t\t{ name: \"type\", value: \"onboarding\" },\n\t\t\t\t{ name: \"verification\", value: \"complete\" },\n\t\t\t],\n\t\t});\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror:\n\t\t\t\terror instanceof Error\n\t\t\t\t\t? error.message\n\t\t\t\t\t: \"Failed to send verification complete email\",\n\t\t};\n\t}\n}\n","/**\n * Telnyx Account Verification\n *\n * Utilities for checking Telnyx account verification status.\n * Verification levels:\n * - Level 1: Basic identity verification (1-2 business days)\n * - Level 2: Business verification required for 10DLC (2-5 business days)\n */\n\nimport { telnyxRequest } from \"./api\";\n\nexport type VerificationLevel = \"none\" | \"level_1\" | \"level_2\";\n\nexport type VerificationStatus = {\n\tcurrentLevel: VerificationLevel;\n\tisLevel1Complete: boolean;\n\tisLevel2Complete: boolean;\n\tcanCreate10DLC: boolean;\n\trequirementsRemaining: string[];\n\testimatedCompletionDays?: number;\n};\n\n/**\n * Check the current verification level of the Telnyx account\n *\n * Note: This endpoint may not exist in Telnyx API. If it fails,\n * we'll need to infer verification status from 10DLC brand creation attempts.\n */\nexport async function checkAccountVerificationStatus(): Promise<{\n\tsuccess: boolean;\n\tdata?: VerificationStatus;\n\terror?: string;\n}> {\n\ttry {\n\t\t// Try to get account verification info\n\t\t// Note: Telnyx may not have a direct endpoint for this\n\t\tconst accountResult = await telnyxRequest<{\n\t\t\tverifications: {\n\t\t\t\tidentity_verification: { status: string; level: number };\n\t\t\t\tbusiness_verification: { status: string; level: number };\n\t\t\t};\n\t\t}>(\"/account/verifications\", {\n\t\t\tmethod: \"GET\",\n\t\t});\n\n\t\tif (accountResult.success && accountResult.data) {\n\t\t\tconst { verifications } = accountResult.data;\n\t\t\tconst level1Complete =\n\t\t\t\tverifications.identity_verification?.status === \"verified\";\n\t\t\tconst level2Complete =\n\t\t\t\tverifications.business_verification?.status === \"verified\";\n\n\t\t\tconst requirementsRemaining: string[] = [];\n\t\t\tlet estimatedDays = 0;\n\n\t\t\tif (!level1Complete) {\n\t\t\t\trequirementsRemaining.push(\n\t\t\t\t\t\"Complete Level 1 verification (ID, payment method, contact info)\",\n\t\t\t\t);\n\t\t\t\testimatedDays = Math.max(estimatedDays, 2);\n\t\t\t}\n\n\t\t\tif (!level2Complete) {\n\t\t\t\trequirementsRemaining.push(\n\t\t\t\t\t\"Complete Level 2 verification (EIN letter, business license, proof of address)\",\n\t\t\t\t);\n\t\t\t\testimatedDays = Math.max(estimatedDays, 5);\n\t\t\t}\n\n\t\t\tconst currentLevel: VerificationLevel = level2Complete\n\t\t\t\t? \"level_2\"\n\t\t\t\t: level1Complete\n\t\t\t\t\t? \"level_1\"\n\t\t\t\t\t: \"none\";\n\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tdata: {\n\t\t\t\t\tcurrentLevel,\n\t\t\t\t\tisLevel1Complete: level1Complete,\n\t\t\t\t\tisLevel2Complete: level2Complete,\n\t\t\t\t\tcanCreate10DLC: level2Complete,\n\t\t\t\t\trequirementsRemaining,\n\t\t\t\t\testimatedCompletionDays:\n\t\t\t\t\t\trequirementsRemaining.length > 0 ? estimatedDays : undefined,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\t// If direct endpoint doesn't exist, try to infer from 10DLC brand creation\n\t\t// This will fail with 403 if not verified\n\t\tconst brandTestResult = await telnyxRequest<{ id: string }>(\n\t\t\t\"/10dlc/brand\",\n\t\t\t{\n\t\t\t\tmethod: \"GET\",\n\t\t\t},\n\t\t);\n\n\t\tif (brandTestResult.success) {\n\t\t\t// If we can access brands, Level 2 is complete\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tdata: {\n\t\t\t\t\tcurrentLevel: \"level_2\",\n\t\t\t\t\tisLevel1Complete: true,\n\t\t\t\t\tisLevel2Complete: true,\n\t\t\t\t\tcanCreate10DLC: true,\n\t\t\t\t\trequirementsRemaining: [],\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\t// Check the error to determine verification level\n\t\tif (\n\t\t\tbrandTestResult.error?.includes(\"403\") ||\n\t\t\tbrandTestResult.error?.includes(\"verification\")\n\t\t) {\n\t\t\t// 403 means account exists but not verified for 10DLC\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tdata: {\n\t\t\t\t\tcurrentLevel: \"level_1\",\n\t\t\t\t\tisLevel1Complete: true,\n\t\t\t\t\tisLevel2Complete: false,\n\t\t\t\t\tcanCreate10DLC: false,\n\t\t\t\t\trequirementsRemaining: [\n\t\t\t\t\t\t\"Complete Level 2 verification (EIN letter, business license, proof of address)\",\n\t\t\t\t\t],\n\t\t\t\t\testimatedCompletionDays: 5,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\t// Unknown state - assume no verification\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: {\n\t\t\t\tcurrentLevel: \"none\",\n\t\t\t\tisLevel1Complete: false,\n\t\t\t\tisLevel2Complete: false,\n\t\t\t\tcanCreate10DLC: false,\n\t\t\t\trequirementsRemaining: [\n\t\t\t\t\t\"Complete Level 1 verification (ID, payment method, contact info)\",\n\t\t\t\t\t\"Complete Level 2 verification (EIN letter, business license, proof of address)\",\n\t\t\t\t],\n\t\t\t\testimatedCompletionDays: 7,\n\t\t\t},\n\t\t};\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror:\n\t\t\t\terror instanceof Error\n\t\t\t\t\t? error.message\n\t\t\t\t\t: \"Failed to check verification status\",\n\t\t};\n\t}\n}\n\n/**\n * Get verification requirements based on current level\n */\nexport function getVerificationRequirements(currentLevel: VerificationLevel): {\n\tlevel1: { required: boolean; items: string[] };\n\tlevel2: { required: boolean; items: string[] };\n} {\n\treturn {\n\t\tlevel1: {\n\t\t\trequired: currentLevel === \"none\",\n\t\t\titems: [\n\t\t\t\t\"Valid government-issued ID (Driver's License, Passport, etc.)\",\n\t\t\t\t\"Payment method (Credit card or bank account)\",\n\t\t\t\t\"Phone number verification\",\n\t\t\t\t\"Email verification\",\n\t\t\t\t\"Business address confirmation\",\n\t\t\t],\n\t\t},\n\t\tlevel2: {\n\t\t\trequired: currentLevel === \"none\" || currentLevel === \"level_1\",\n\t\t\titems: [\n\t\t\t\t\"IRS EIN Confirmation Letter (CP 575 or 147C)\",\n\t\t\t\t\"Business License or Articles of Incorporation\",\n\t\t\t\t\"Proof of Business Address (Utility bill, lease agreement)\",\n\t\t\t\t\"Government-issued ID for business representative\",\n\t\t\t\t\"Tax documents (W-9 or recent tax return)\",\n\t\t\t],\n\t\t},\n\t};\n}\n\n/**\n * Get next steps based on verification status\n */\nexport function getNextSteps(\n\tstatus: VerificationStatus,\n): Array<{ step: string; action: string; url?: string }> {\n\tconst steps: Array<{ step: string; action: string; url?: string }> = [];\n\n\tif (!status.isLevel1Complete) {\n\t\tsteps.push({\n\t\t\tstep: \"Complete Level 1 Verification\",\n\t\t\taction:\n\t\t\t\t\"Visit Telnyx Portal ‚Üí Account ‚Üí Public Profile and complete identity verification\",\n\t\t\turl: \"https://portal.telnyx.com/#/app/account/public-profile\",\n\t\t});\n\t}\n\n\tif (!status.isLevel2Complete && status.isLevel1Complete) {\n\t\tsteps.push({\n\t\t\tstep: \"Complete Level 2 Verification\",\n\t\t\taction:\n\t\t\t\t\"Visit Telnyx Portal ‚Üí Account ‚Üí Verifications and upload business documents\",\n\t\t\turl: \"https://portal.telnyx.com/#/app/account/verifications\",\n\t\t});\n\t}\n\n\tif (status.canCreate10DLC) {\n\t\tsteps.push({\n\t\t\tstep: \"Create 10DLC Brand & Campaign\",\n\t\t\taction:\n\t\t\t\t\"Run automated setup to create 10DLC brand and campaign (fully automated)\",\n\t\t\turl: \"/test-telnyx-setup\",\n\t\t});\n\t}\n\n\treturn steps;\n}\n","\"use server\";\n\nimport { sendVerificationSubmittedEmail } from \"@/lib/email/verification-emails\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { createServiceSupabaseClient } from \"@/lib/supabase/service-client\";\nimport {\n\tcheckAccountVerificationStatus,\n\tgetNextSteps,\n\tgetVerificationRequirements,\n\ttype VerificationStatus,\n} from \"@/lib/telnyx/account-verification\";\nimport {\n\tattachNumberToCampaign,\n\tcreateTenDlcBrand,\n\tcreateTenDlcCampaign,\n\tgetTenDlcBrand,\n\tgetTenDlcCampaign,\n\ttype TenDlcBrandPayload,\n\ttype TenDlcCampaignPayload,\n} from \"@/lib/telnyx/ten-dlc\";\n\ntype RegistrationResult = {\n\tsuccess: boolean;\n\tbrandId?: string;\n\tcampaignId?: string;\n\terror?: string;\n\tlog: string[];\n};\n\n/**\n * Automated 10DLC registration for a company\n *\n * This function:\n * 1. Fetches company data from database\n * 2. Creates a 10DLC brand with Telnyx\n * 3. Waits for brand approval (polls status)\n * 4. Creates a 10DLC campaign\n * 5. Waits for campaign approval\n * 6. Attaches all company phone numbers to the campaign\n * 7. Updates company_telnyx_settings with brand and campaign IDs\n */\nexport async function registerCompanyFor10DLC(\n\tcompanyId: string,\n): Promise<RegistrationResult> {\n\tconst log: string[] = [];\n\tconst supabase = await createClient();\n\n\tif (!supabase) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: \"Failed to create Supabase client\",\n\t\t\tlog,\n\t\t};\n\t}\n\n\ttry {\n\t\t// 1. Fetch company data\n\t\tlog.push(\"Fetching company data...\");\n\t\tconst { data: company, error: companyError } = await supabase\n\t\t\t.from(\"companies\")\n\t\t\t.select(\n\t\t\t\t`\n\t\t\t\tid,\n\t\t\t\tname,\n\t\t\t\tein,\n\t\t\t\twebsite,\n\t\t\t\tindustry,\n\t\t\t\taddress,\n\t\t\t\tcity,\n\t\t\t\tstate,\n\t\t\t\tzip_code,\n\t\t\t\tphone,\n\t\t\t\temail,\n\t\t\t\tsupport_email,\n\t\t\t\tsupport_phone\n\t\t\t`,\n\t\t\t)\n\t\t\t.eq(\"id\", companyId)\n\t\t\t.single();\n\n\t\tif (companyError || !company) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: `Company not found: ${companyError?.message}`,\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\n\t\t// Validate required fields\n\t\tif (!company.ein) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror:\n\t\t\t\t\t\"Company EIN is required for 10DLC registration. Please add the company's Tax ID.\",\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\n\t\tif (\n\t\t\t!company.address ||\n\t\t\t!company.city ||\n\t\t\t!company.state ||\n\t\t\t!company.zip_code\n\t\t) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror:\n\t\t\t\t\t\"Company address is incomplete. Please add full address, city, state, and ZIP code.\",\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\n\t\tconst contactEmail = company.email || company.support_email;\n\t\tconst contactPhone = company.phone || company.support_phone;\n\n\t\tif (!contactEmail || !contactPhone) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror:\n\t\t\t\t\t\"Company contact email and phone are required for 10DLC registration.\",\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\n\t\t// CRITICAL: Verify email domain before 10DLC registration\n\t\tlog.push(\"Verifying company email domain...\");\n\n\t\tconst supabaseService = await createServiceSupabaseClient();\n\t\tif (!supabaseService) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Database service client failed\",\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\n\t\tconst { data: verifiedDomain } = await supabaseService\n\t\t\t.from(\"company_email_domains\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"status\", \"verified\")\n\t\t\t.single();\n\n\t\tif (!verifiedDomain) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror:\n\t\t\t\t\t\"Company email domain must be verified before 10DLC registration. TCR (The Campaign Registry) requires a verified business email domain with proper SPF/DKIM/DMARC records. Please complete email domain setup in the onboarding steps.\",\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\n\t\t// Use domain email for TCR registration\n\t\tconst fullDomain = verifiedDomain.subdomain\n\t\t\t? `${verifiedDomain.subdomain}.${verifiedDomain.domain_name}`\n\t\t\t: verifiedDomain.domain_name;\n\n\t\tconst domainEmail = `admin@${fullDomain}`;\n\t\tlog.push(`Email domain verified: ${fullDomain}`);\n\n\t\t// Normalize phone to E.164 format (Telnyx requirement)\n\t\tconst normalizeToE164 = (phone: string): string => {\n\t\t\t// Remove all non-digit characters\n\t\t\tconst digits = phone.replace(/\\D/g, \"\");\n\t\t\t// Ensure it starts with country code (default to US +1)\n\t\t\tif (digits.length === 10) {\n\t\t\t\treturn `+1${digits}`;\n\t\t\t}\n\t\t\tif (digits.length === 11 && digits.startsWith(\"1\")) {\n\t\t\t\treturn `+${digits}`;\n\t\t\t}\n\t\t\t// Already has country code\n\t\t\treturn `+${digits}`;\n\t\t};\n\n\t\tconst normalizedPhone = normalizeToE164(contactPhone);\n\n\t\t// 2. Check if already registered\n\t\tlog.push(\"Checking existing 10DLC registration...\");\n\t\tconst { data: settings } = await supabase\n\t\t\t.from(\"company_telnyx_settings\")\n\t\t\t.select(\"ten_dlc_brand_id, ten_dlc_campaign_id\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.single();\n\n\t\tif (settings?.ten_dlc_brand_id && settings?.ten_dlc_campaign_id) {\n\t\t\tlog.push(\"Company already has 10DLC registration\");\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tbrandId: settings.ten_dlc_brand_id,\n\t\t\t\tcampaignId: settings.ten_dlc_campaign_id,\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\n\t\t// 3. Create 10DLC Brand\n\t\tlog.push(\"Creating 10DLC brand with Telnyx...\");\n\t\tconst brandPayload: TenDlcBrandPayload = {\n\t\t\tentityType: \"PRIVATE_PROFIT\", // Default - could be made configurable\n\t\t\tdisplayName: company.name || \"Unknown Company\",\n\t\t\tcompanyName: company.name || \"Unknown Company\",\n\t\t\tfirstName: \"Business\", // No separate first/last name fields in companies table\n\t\t\tlastName: \"Owner\",\n\t\t\tein: company.ein,\n\t\t\tphone: normalizedPhone, // E.164 format required by Telnyx\n\t\t\tstreet: company.address || \"\",\n\t\t\tcity: company.city || \"\",\n\t\t\tstate: company.state || \"\",\n\t\t\tpostalCode: company.zip_code || \"\",\n\t\t\tcountry: \"US\",\n\t\t\temail: contactEmail,\n\t\t\twebsite: company.website,\n\t\t\tvertical: determineVertical(company.industry),\n\t\t\tbusinessContactEmail: contactEmail,\n\t\t\t// ISV/Reseller identification - Stratos is the platform\n\t\t\tisReseller: true,\n\t\t};\n\n\t\tconst brandResult = await createTenDlcBrand(brandPayload);\n\n\t\tif (!brandResult.success || !brandResult.data?.brandId) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: `Failed to create 10DLC brand: ${brandResult.error}`,\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\n\t\tconst brandId = brandResult.data.brandId;\n\t\tlog.push(`Brand created: ${brandId}`);\n\n\t\t// 4. Poll brand status until approved (max 60 seconds)\n\t\tlog.push(\"Waiting for brand approval...\");\n\t\tconst brandApprovalResult = await pollForApproval(\n\t\t\t() => getTenDlcBrand(brandId),\n\t\t\t60,\n\t\t);\n\n\t\tif (!brandApprovalResult.approved) {\n\t\t\tlog.push(\n\t\t\t\t`Brand approval failed: ${brandApprovalResult.failureReason || \"Unknown reason\"}`,\n\t\t\t);\n\n\t\t\t// Check if failure was due to email validation (fail fast)\n\t\t\tif (brandApprovalResult.failureReason?.toLowerCase().includes(\"email\")) {\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror:\n\t\t\t\t\t\t`Email validation failed: ${brandApprovalResult.failureReason}. ` +\n\t\t\t\t\t\t\"TCR requires a verified business email domain (not personal/free providers). \" +\n\t\t\t\t\t\t\"Options: 1) Use toll-free numbers (bypasses TCR), \" +\n\t\t\t\t\t\t\"2) Set up Google Workspace/Microsoft 365, \" +\n\t\t\t\t\t\t\"3) See /TELNYX_10DLC_EMAIL_REQUIREMENTS.md\",\n\t\t\t\t\tbrandId,\n\t\t\t\t\tlog,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Save brand ID even if not approved yet\n\t\t\tawait supabase\n\t\t\t\t.from(\"company_telnyx_settings\")\n\t\t\t\t.update({ ten_dlc_brand_id: brandId })\n\t\t\t\t.eq(\"company_id\", companyId);\n\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror:\n\t\t\t\t\tbrandApprovalResult.failureReason ||\n\t\t\t\t\t\"Brand created but approval pending. Please check back in a few minutes.\",\n\t\t\t\tbrandId,\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\n\t\tlog.push(\"Brand approved\");\n\n\t\t// 5. Create 10DLC Campaign\n\t\tlog.push(\"Creating 10DLC campaign...\");\n\t\tconst campaignPayload: TenDlcCampaignPayload = {\n\t\t\tbrandId: brandId,\n\t\t\tusecase: \"MIXED\", // Mixed use case covers most business needs\n\t\t\tdescription: `Business messaging for ${company.name}`,\n\t\t\tmessageFlow:\n\t\t\t\t\"Customers opt-in when providing phone number. Messages sent for appointments, invoices, and general updates.\",\n\t\t\thelpMessage: \"Reply HELP for assistance or call us.\",\n\t\t\thelpKeywords: \"HELP\",\n\t\t\toptinKeywords: \"START YES SUBSCRIBE\",\n\t\t\toptinMessage:\n\t\t\t\t\"You are now subscribed to messages from \" +\n\t\t\t\tcompany.name +\n\t\t\t\t\". Reply STOP to unsubscribe.\",\n\t\t\toptoutKeywords: \"STOP END UNSUBSCRIBE CANCEL QUIT\",\n\t\t\toptoutMessage:\n\t\t\t\t\"You have been unsubscribed from \" +\n\t\t\t\tcompany.name +\n\t\t\t\t\" messages. Reply START to resubscribe.\",\n\t\t\tsample1: \"Your appointment is confirmed for tomorrow at 2 PM.\",\n\t\t\tsample2: \"Thank you for your payment. Receipt: #12345\",\n\t\t\tsample3: \"Reminder: Service scheduled for next week.\",\n\t\t\tautoRenewal: true,\n\t\t\ttermsAndConditions: true,\n\t\t\ttermsAndConditionsLink: company.website\n\t\t\t\t? `${company.website}/terms`\n\t\t\t\t: \"https://stratos.thorbis.com/terms\",\n\t\t\tsubscriberHelp: true,\n\t\t\tsubscriberOptin: true,\n\t\t\tsubscriberOptout: true,\n\t\t};\n\n\t\tconst campaignResult = await createTenDlcCampaign(campaignPayload);\n\n\t\tif (!campaignResult.success || !campaignResult.data?.campaignId) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: `Failed to create 10DLC campaign: ${campaignResult.error}`,\n\t\t\t\tbrandId,\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\n\t\tconst campaignId = campaignResult.data.campaignId;\n\t\tlog.push(`Campaign created: ${campaignId}`);\n\n\t\t// 6. Poll campaign status\n\t\tlog.push(\"Waiting for campaign approval...\");\n\t\tconst campaignApprovalResult = await pollForApproval(\n\t\t\t() => getTenDlcCampaign(campaignId),\n\t\t\t60,\n\t\t);\n\n\t\tif (!campaignApprovalResult.approved) {\n\t\t\tlog.push(\n\t\t\t\t`Campaign approval failed: ${campaignApprovalResult.failureReason || \"Unknown reason\"}`,\n\t\t\t);\n\t\t\tawait supabase\n\t\t\t\t.from(\"company_telnyx_settings\")\n\t\t\t\t.update({\n\t\t\t\t\tten_dlc_brand_id: brandId,\n\t\t\t\t\tten_dlc_campaign_id: campaignId,\n\t\t\t\t})\n\t\t\t\t.eq(\"company_id\", companyId);\n\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror:\n\t\t\t\t\tcampaignApprovalResult.failureReason ||\n\t\t\t\t\t\"Campaign created but approval pending. Please check back in a few minutes.\",\n\t\t\t\tbrandId,\n\t\t\t\tcampaignId,\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\n\t\tlog.push(\"Campaign approved\");\n\n\t\t// 7. Attach all company phone numbers to campaign\n\t\tlog.push(\"Attaching phone numbers to campaign...\");\n\t\tconst { data: phoneNumbers } = await supabase\n\t\t\t.from(\"phone_numbers\")\n\t\t\t.select(\"phone_number\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"status\", \"active\");\n\n\t\tlet attachedCount = 0;\n\t\tfor (const phone of phoneNumbers || []) {\n\t\t\tconst attachResult = await attachNumberToCampaign(\n\t\t\t\tcampaignId,\n\t\t\t\tphone.phone_number,\n\t\t\t);\n\n\t\t\tif (attachResult.success) {\n\t\t\t\tattachedCount++;\n\t\t\t} else {\n\t\t\t\tlog.push(\n\t\t\t\t\t`Failed to attach ${phone.phone_number}: ${attachResult.error}`,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tlog.push(`Attached ${attachedCount} phone numbers to campaign`);\n\n\t\t// 8. Update company settings\n\t\tlog.push(\"Updating company Telnyx settings...\");\n\t\tawait supabase\n\t\t\t.from(\"company_telnyx_settings\")\n\t\t\t.update({\n\t\t\t\tten_dlc_brand_id: brandId,\n\t\t\t\tten_dlc_campaign_id: campaignId,\n\t\t\t})\n\t\t\t.eq(\"company_id\", companyId);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tbrandId,\n\t\t\tcampaignId,\n\t\t\tlog,\n\t\t};\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\tlog,\n\t\t};\n\t}\n}\n\n/**\n * Poll approval status until approved or timeout\n */\nasync function pollForApproval(\n\tfetcher: () => Promise<{\n\t\tsuccess: boolean;\n\t\tdata?: {\n\t\t\tstatus: string;\n\t\t\tfailureReasons?: Array<{ fields: string[]; description: string }>;\n\t\t};\n\t}>,\n\tmaxSeconds: number,\n): Promise<{ approved: boolean; failureReason?: string }> {\n\tconst startTime = Date.now();\n\tconst pollInterval = 5000; // 5 seconds\n\n\twhile (Date.now() - startTime < maxSeconds * 1000) {\n\t\tconst result = await fetcher();\n\n\t\tif (!result.success || !result.data) {\n\t\t\treturn { approved: false, failureReason: \"Failed to fetch status\" };\n\t\t}\n\n\t\tconst status = result.data.status.toLowerCase();\n\n\t\tif (status === \"approved\" || status === \"active\") {\n\t\t\treturn { approved: true };\n\t\t}\n\n\t\tif (\n\t\t\tstatus === \"rejected\" ||\n\t\t\tstatus === \"failed\" ||\n\t\t\tstatus === \"registration_failed\"\n\t\t) {\n\t\t\t// Extract failure reason from response\n\t\t\tconst failureReason =\n\t\t\t\tresult.data.failureReasons?.[0]?.description ||\n\t\t\t\t`Registration ${status}`;\n\t\t\treturn { approved: false, failureReason };\n\t\t}\n\n\t\t// Wait before polling again\n\t\tawait new Promise((resolve) => setTimeout(resolve, pollInterval));\n\t}\n\n\treturn { approved: false, failureReason: \"Timeout waiting for approval\" };\n}\n\n/**\n * Map business type to 10DLC vertical\n */\nfunction determineVertical(businessType?: string | null): string {\n\tif (!businessType) return \"PROFESSIONAL\";\n\n\tconst type = businessType.toLowerCase();\n\n\t// Map to Telnyx's exact vertical values\n\t// Valid values from error: AGRICULTURE, COMMUNICATION, CONSTRUCTION, EDUCATION,\n\t// ENERGY, ENTERTAINMENT, FINANCIAL, GAMBLING, GOVERNMENT, HEALTHCARE, HOSPITALITY,\n\t// HUMAN_RESOURCES, INSURANCE, LEGAL, MANUFACTURING, NGO, POLITICAL, POSTAL,\n\t// PROFESSIONAL, REAL_ESTATE, RETAIL, TECHNOLOGY, TRANSPORTATION\n\n\tif (type.includes(\"healthcare\") || type.includes(\"medical\"))\n\t\treturn \"HEALTHCARE\";\n\tif (type.includes(\"finance\") || type.includes(\"banking\")) return \"FINANCIAL\";\n\tif (type.includes(\"insurance\")) return \"INSURANCE\";\n\tif (type.includes(\"real estate\")) return \"REAL_ESTATE\";\n\tif (type.includes(\"retail\") || type.includes(\"ecommerce\")) return \"RETAIL\";\n\tif (\n\t\ttype.includes(\"hospitality\") ||\n\t\ttype.includes(\"restaurant\") ||\n\t\ttype.includes(\"food\") ||\n\t\ttype.includes(\"hotel\")\n\t)\n\t\treturn \"HOSPITALITY\";\n\tif (type.includes(\"education\")) return \"EDUCATION\";\n\tif (type.includes(\"technology\") || type.includes(\"software\"))\n\t\treturn \"TECHNOLOGY\";\n\tif (\n\t\ttype.includes(\"nonprofit\") ||\n\t\ttype.includes(\"charity\") ||\n\t\ttype.includes(\"ngo\")\n\t)\n\t\treturn \"NGO\";\n\tif (\n\t\ttype.includes(\"construction\") ||\n\t\ttype.includes(\"plumbing\") ||\n\t\ttype.includes(\"hvac\") ||\n\t\ttype.includes(\"electrical\") ||\n\t\ttype.includes(\"contractor\")\n\t)\n\t\treturn \"CONSTRUCTION\";\n\tif (type.includes(\"legal\") || type.includes(\"law\")) return \"LEGAL\";\n\tif (type.includes(\"manufacturing\")) return \"MANUFACTURING\";\n\tif (type.includes(\"transportation\") || type.includes(\"logistics\"))\n\t\treturn \"TRANSPORTATION\";\n\tif (type.includes(\"energy\") || type.includes(\"utilities\")) return \"ENERGY\";\n\tif (type.includes(\"agriculture\") || type.includes(\"farming\"))\n\t\treturn \"AGRICULTURE\";\n\tif (type.includes(\"entertainment\") || type.includes(\"media\"))\n\t\treturn \"ENTERTAINMENT\";\n\n\t// Default for service businesses\n\treturn \"PROFESSIONAL\";\n}\n\n/**\n * Check Telnyx account verification status\n *\n * Returns the current verification level and what's required to proceed\n */\nexport async function checkTelnyxVerificationStatus(): Promise<{\n\tsuccess: boolean;\n\tdata?: VerificationStatus & {\n\t\tnextSteps: Array<{ step: string; action: string; url?: string }>;\n\t\trequirements: {\n\t\t\tlevel1: { required: boolean; items: string[] };\n\t\t\tlevel2: { required: boolean; items: string[] };\n\t\t};\n\t};\n\terror?: string;\n}> {\n\ttry {\n\t\tconst statusResult = await checkAccountVerificationStatus();\n\n\t\tif (!statusResult.success) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: statusResult.error || \"Failed to check verification status\",\n\t\t\t};\n\t\t}\n\n\t\tconst status = statusResult.data!;\n\t\tconst nextSteps = getNextSteps(status);\n\t\tconst requirements = getVerificationRequirements(status.currentLevel);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: {\n\t\t\t\t...status,\n\t\t\t\tnextSteps,\n\t\t\t\trequirements,\n\t\t\t},\n\t\t};\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror:\n\t\t\t\terror instanceof Error\n\t\t\t\t\t? error.message\n\t\t\t\t\t: \"Failed to check verification status\",\n\t\t};\n\t}\n}\n\n/**\n * Automatically submit toll-free and 10DLC verification during onboarding\n *\n * This function is called when a company completes Step 4 of onboarding.\n * It automatically submits verification to Telnyx using the company data\n * collected during Step 1 (Company Information).\n *\n * ServiceTitan-style flow: Users never leave the platform or visit Telnyx Portal\n */\nexport async function submitAutomatedVerification(companyId: string): Promise<{\n\tsuccess: boolean;\n\ttollFreeRequestId?: string;\n\tbrandId?: string;\n\tcampaignId?: string;\n\terror?: string;\n\tmessage?: string;\n\tlog?: string[];\n\trequiresPlatformSetup?: boolean;\n}> {\n\tconst supabase = await createClient();\n\tconst log: string[] = [];\n\n\tconst normalizePhone = (value: string | null) => {\n\t\tif (!value) return null;\n\t\tconst digits = value.replace(/\\D/g, \"\");\n\t\tif (!digits) return null;\n\t\tif (digits.length === 10) {\n\t\t\treturn `+1${digits}`;\n\t\t}\n\t\tif (digits.length === 11 && digits.startsWith(\"1\")) {\n\t\t\treturn `+${digits}`;\n\t\t}\n\t\treturn value.startsWith(\"+\") ? value : `+${digits}`;\n\t};\n\n\tif (!supabase) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: \"Failed to create Supabase client\",\n\t\t\tlog,\n\t\t};\n\t}\n\n\ttry {\n\t\t// 1. Fetch company data\n\t\tconst { data: company, error: companyError } = await supabase\n\t\t\t.from(\"companies\")\n\t\t\t.select(\n\t\t\t\t`\n\t\t\t\tid,\n\t\t\t\tname,\n\t\t\t\tein,\n\t\t\t\twebsite,\n\t\t\t\tindustry,\n\t\t\t\taddress,\n\t\t\t\tcity,\n\t\t\t\tstate,\n\t\t\t\tzip_code,\n\t\t\t\tphone,\n\t\t\t\temail,\n\t\t\t\tsupport_email,\n\t\t\t\tsupport_phone\n\t\t\t`,\n\t\t\t)\n\t\t\t.eq(\"id\", companyId)\n\t\t\t.single();\n\n\t\tif (companyError || !company) {\n\t\t\tlog.push(\"Company lookup failed\");\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: `Company not found: ${companyError?.message}`,\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\t\tlog.push(`Company loaded: ${company.name} (${company.id})`);\n\n\t\t// Validate required fields\n\t\tif (!company.ein) {\n\t\t\tlog.push(\"Missing EIN\");\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror:\n\t\t\t\t\t\"Company EIN is required for messaging verification. Please add your Tax ID in Step 1.\",\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\n\t\tif (\n\t\t\t!company.address ||\n\t\t\t!company.city ||\n\t\t\t!company.state ||\n\t\t\t!company.zip_code\n\t\t) {\n\t\t\tlog.push(\"Incomplete address\");\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror:\n\t\t\t\t\t\"Company address is incomplete. Please complete all address fields in Step 1.\",\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\n\t\tconst companyPhone = normalizePhone(company.phone || company.support_phone);\n\t\tif (!companyPhone) {\n\t\t\tlog.push(\"Missing company phone\");\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Company phone number is required for verification.\",\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\n\t\t// 2. Get company phone numbers\n\t\tconst { data: phoneNumbers, error: phoneError } = await supabase\n\t\t\t.from(\"phone_numbers\")\n\t\t\t.select(\"phone_number, number_type\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"status\", \"active\");\n\n\t\tif (phoneError || !phoneNumbers || phoneNumbers.length === 0) {\n\t\t\tlog.push(\"No phone numbers found for company\");\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror:\n\t\t\t\t\t\"No phone numbers found. Please add a phone number before enabling messaging.\",\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\n\t\t// Separate toll-free and 10DLC numbers\n\t\tconst tollFreeNumbers = phoneNumbers.filter(\n\t\t\t(p) => p.number_type === \"toll-free\",\n\t\t);\n\t\tconst dlcNumbers = phoneNumbers.filter((p) => p.number_type === \"local\");\n\t\tlog.push(\n\t\t\t`Detected toll-free numbers: ${tollFreeNumbers.length}, 10DLC numbers: ${dlcNumbers.length}`,\n\t\t);\n\n\t\t// If no toll-free numbers, recommend using toll-free for immediate setup\n\t\tif (tollFreeNumbers.length === 0 && dlcNumbers.length > 0) {\n\t\t\tconsole.log(\n\t\t\t\t\"Note: Only local numbers found. Toll-free verification works immediately without Level 2. Consider adding toll-free numbers for faster setup.\",\n\t\t\t);\n\t\t}\n\n\t\tconst contactPhone = companyPhone;\n\t\tconst contactEmail = company.email || company.support_email || null;\n\t\tif (!contactEmail) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"A primary email is required for toll-free verification.\",\n\t\t\t\tlog,\n\t\t\t};\n\t\t}\n\n\t\t// Get company owner's profile for business contact info\n\t\tconst { data: ownerMembership } = await supabase\n\t\t\t.from(\"company_memberships\")\n\t\t\t.select(\"user_id, user_profiles!inner(first_name, last_name)\")\n\t\t\t.eq(\"company_id\", companyId)\n\t\t\t.eq(\"role\", \"owner\")\n\t\t\t.eq(\"status\", \"active\")\n\t\t\t.single();\n\n\t\t// Extract owner name, fallback to \"Admin User\" if not found\n\t\tconst ownerProfile = (ownerMembership as any)?.user_profiles;\n\t\tconst businessContactFirstName = ownerProfile?.first_name || \"Admin\";\n\t\tconst businessContactLastName = ownerProfile?.last_name || \"User\";\n\n\t\t// 3. Submit toll-free verification if we have toll-free numbers\n\t\tlet tollFreeRequestId: string | undefined;\n\t\tif (tollFreeNumbers.length > 0) {\n\t\t\tlog.push(\"Preparing toll-free verification payload\");\n\t\t\tconst normalizedWebsite =\n\t\t\t\tcompany.website ||\n\t\t\t\t`https://${company.name.toLowerCase().replace(/\\s+/g, \"\")}.com`;\n\t\t\tconst optInImageUrl = `${normalizedWebsite.replace(/\\/$/, \"\")}/opt-in`;\n\t\t\tconst additionalInfo = `${company.name} sends timely service notifications, scheduling updates, and customer support follow-ups for ${company.industry || \"field service\"} operations.`;\n\t\t\tconst sanitizedEin = company.ein.replace(/[^\\d]/g, \"\");\n\n\t\t\tconst tollFreePayload: TollFreeVerificationPayload = {\n\t\t\t\tbusinessName: company.name,\n\t\t\t\tcorporateWebsite: normalizedWebsite,\n\t\t\t\tbusinessAddr1: company.address,\n\t\t\t\tbusinessCity: company.city,\n\t\t\t\tbusinessState: company.state,\n\t\t\t\tbusinessZip: company.zip_code,\n\t\t\t\tbusinessContactFirstName: businessContactFirstName,\n\t\t\t\tbusinessContactLastName: businessContactLastName,\n\t\t\t\tbusinessContactEmail: contactEmail,\n\t\t\t\tbusinessContactPhone: contactPhone,\n\t\t\t\tphoneNumbers: tollFreeNumbers.map((p) => ({\n\t\t\t\t\tphoneNumber: p.phone_number,\n\t\t\t\t})),\n\t\t\t\tuseCase: \"Customer Support\",\n\t\t\t\tuseCaseSummary: `${company.industry} business communications including appointment reminders, service notifications, and customer support`,\n\t\t\t\tproductionMessageContent: `Hi! This is ${company.name}. Your appointment is scheduled for tomorrow at 10 AM. Reply STOP to opt out.`,\n\t\t\t\tmessageVolume: \"10000\",\n\t\t\t\toptInWorkflow:\n\t\t\t\t\t\"Customers opt-in during service booking and account creation\",\n\t\t\t\toptInWorkflowImageURLs: [\n\t\t\t\t\t{\n\t\t\t\t\t\turl:\n\t\t\t\t\t\t\toptInImageUrl ||\n\t\t\t\t\t\t\t\"https://dummyimage.com/600x400/cccccc/000000&text=Opt-In\",\n\t\t\t\t\t\tdescription: \"Opt-in form screenshot\",\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\toptInKeywords: \"YES,START\",\n\t\t\t\toptOutKeywords: \"STOP,UNSUBSCRIBE\",\n\t\t\t\toptOutMessage: `You have opted out of ${company.name} messages. Reply START to opt in again.`,\n\t\t\t\thelpKeywords: \"HELP,INFO\",\n\t\t\t\tbusinessRegistrationNumber: sanitizedEin,\n\t\t\t\tbusinessRegistrationType: \"EIN\",\n\t\t\t\tbusinessRegistrationCountry: \"US\",\n\t\t\t\tentityType: \"PRIVATE_PROFIT\",\n\t\t\t\tadditionalInformation: additionalInfo,\n\t\t\t\thelpMessageResponse: `For help, reply HELP or call ${companyPhone}.`,\n\t\t\t\toptInConfirmationResponse: `Thanks for subscribing to ${company.name} updates.`,\n\t\t\t};\n\n\t\t\tlog.push(\"Submitting toll-free verification to Telnyx\");\n\t\t\tconst tollFreeResult = await submitTollFreeVerification(tollFreePayload);\n\n\t\t\tif (!tollFreeResult.success || !tollFreeResult.data) {\n\t\t\t\tlog.push(\n\t\t\t\t\t`Toll-free verification failed: ${tollFreeResult.error || \"unknown\"}`,\n\t\t\t\t);\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror: `Toll-free verification failed: ${tollFreeResult.error}`,\n\t\t\t\t\tlog,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttollFreeRequestId = tollFreeResult.data.id;\n\t\t\tlog.push(`Toll-free verification request created: ${tollFreeRequestId}`);\n\n\t\t\t// Save toll-free request ID to database\n\t\t\tawait supabase.from(\"company_telnyx_settings\").upsert({\n\t\t\t\tcompany_id: companyId,\n\t\t\t\ttoll_free_verification_request_id: tollFreeRequestId,\n\t\t\t\ttoll_free_verification_status: \"pending\",\n\t\t\t\ttoll_free_verification_submitted_at: new Date().toISOString(),\n\t\t\t});\n\t\t}\n\n\t\t// 4. Submit 10DLC registration if we have regular numbers (OPTIONAL - won't block toll-free)\n\t\tlet brandId: string | undefined;\n\t\tlet campaignId: string | undefined;\n\t\tlet dlcError: string | undefined;\n\n\t\tif (dlcNumbers.length > 0) {\n\t\t\tlog.push(\"Attempting 10DLC registration\");\n\t\t\tconst registrationResult = await registerCompanyFor10DLC(companyId);\n\n\t\t\tif (!registrationResult.success) {\n\t\t\t\t// Check if this is a 403 error (account verification required)\n\t\t\t\tconst is403Error =\n\t\t\t\t\tregistrationResult.error?.includes(\"403\") ||\n\t\t\t\t\tregistrationResult.error?.includes(\"verifications required\");\n\n\t\t\t\tif (is403Error) {\n\t\t\t\t\t// Platform account needs Level 2 verification\n\t\t\t\t\t// Don't fail - just log the error and continue with toll-free\n\t\t\t\t\tdlcError =\n\t\t\t\t\t\t\"10DLC requires Level 2 verification (see /TELNYX_PLATFORM_SETUP.md). Toll-free verification will proceed.\";\n\t\t\t\t\tconsole.warn(dlcError);\n\t\t\t\t\tlog.push(dlcError);\n\n\t\t\t\t\t// If we have toll-free numbers, continue (toll-free works without Level 2)\n\t\t\t\t\t// If we ONLY have local numbers and no toll-free, then fail\n\t\t\t\t\tif (tollFreeNumbers.length === 0) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\t\terror:\n\t\t\t\t\t\t\t\t\"Platform setup required: Your Telnyx account needs Level 2 verification to enable 10DLC registration for local numbers. Alternative: Add toll-free numbers which work immediately without Level 2 verification. See /TELNYX_PLATFORM_SETUP.md for details.\",\n\t\t\t\t\t\t\trequiresPlatformSetup: true,\n\t\t\t\t\t\t\tlog,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Other error - log but don't fail if we have toll-free\n\t\t\t\t\tdlcError = `10DLC registration failed: ${registrationResult.error}`;\n\t\t\t\t\tconsole.error(dlcError);\n\t\t\t\t\tlog.push(dlcError);\n\n\t\t\t\t\tif (tollFreeNumbers.length === 0) {\n\t\t\t\t\t\t// No toll-free backup - fail\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\t\terror: dlcError,\n\t\t\t\t\t\t\tlog,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbrandId = registrationResult.brandId;\n\t\t\t\tcampaignId = registrationResult.campaignId;\n\t\t\t\tlog.push(\n\t\t\t\t\t`10DLC registration completed: brand=${brandId}, campaign=${campaignId}`,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// 5. Send verification submitted email\n\t\t// Note: Don't block the response if email fails - verification was successful\n\t\tif (company.email) {\n\t\t\ttry {\n\t\t\t\tawait sendVerificationSubmittedEmail(companyId, company.email, {\n\t\t\t\t\thasTollFreeNumbers: tollFreeNumbers.length > 0,\n\t\t\t\t\thas10DLCNumbers: dlcNumbers.length > 0,\n\t\t\t\t\ttollFreeCount: tollFreeNumbers.length,\n\t\t\t\t\tdlcCount: dlcNumbers.length,\n\t\t\t\t});\n\t\t\t\tlog.push(\"Verification submitted email sent\");\n\t\t\t} catch (emailError) {\n\t\t\t\t// Log but don't fail - email is non-critical\n\t\t\t\tconsole.error(\"Failed to send verification email:\", emailError);\n\t\t\t\tlog.push(\n\t\t\t\t\t`Failed to send verification email: ${emailError instanceof Error ? emailError.message : emailError}`,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// Build success message\n\t\tconst messages: string[] = [];\n\t\tif (tollFreeRequestId) {\n\t\t\tmessages.push(\n\t\t\t\t`‚úÖ Toll-free verification submitted (${tollFreeNumbers.length} number${tollFreeNumbers.length > 1 ? \"s\" : \"\"}) - Approval in 5-7 business days`,\n\t\t\t);\n\t\t}\n\t\tif (brandId && campaignId) {\n\t\t\tmessages.push(\n\t\t\t\t`‚úÖ 10DLC registration completed (${dlcNumbers.length} number${dlcNumbers.length > 1 ? \"s\" : \"\"}) - Active immediately`,\n\t\t\t);\n\t\t}\n\t\tif (dlcError) {\n\t\t\tmessages.push(`‚ö†Ô∏è ${dlcError}`);\n\t\t}\n\t\tlog.push(...messages);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\ttollFreeRequestId,\n\t\t\tbrandId,\n\t\t\tcampaignId,\n\t\t\tmessage: messages.join(\". \"),\n\t\t\tlog,\n\t\t};\n\t} catch (error) {\n\t\tlog.push(\n\t\t\t`Unhandled verification error: ${error instanceof Error ? error.message : error}`,\n\t\t);\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror:\n\t\t\t\terror instanceof Error\n\t\t\t\t\t? error.message\n\t\t\t\t\t: \"Failed to submit verification\",\n\t\t\tlog,\n\t\t};\n\t}\n}\n"],"names":[],"mappings":"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"}