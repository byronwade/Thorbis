{"version":3,"sources":["../../../../../apps/web/src/lib/services/geocoding.ts"],"sourcesContent":["/**\n * Google Geocoding API Utility\n *\n * Automatically acquires GPS coordinates (lat/lon) from addresses\n * Used during customer creation, property creation, and company onboarding\n */\n\ntype GeocodeResult = {\n\tlat: number;\n\tlon: number;\n\tformattedAddress?: string;\n};\n\ntype GeocodeResponse = {\n\tsuccess: boolean;\n\tcoordinates?: GeocodeResult;\n\terror?: string;\n};\n\n/**\n * Geocode an address to get GPS coordinates\n *\n * @param address - Street address\n * @param city - City\n * @param state - State\n * @param zipCode - ZIP code\n * @param country - Country (defaults to \"USA\")\n * @returns Coordinates {lat, lon} or null if geocoding fails\n */\nasync function geocodeAddress(\n\taddress: string,\n\tcity: string,\n\tstate: string,\n\tzipCode: string,\n\tcountry = \"USA\",\n): Promise<GeocodeResponse> {\n\ttry {\n\t\t// Build full address string\n\t\tconst fullAddress = `${address}, ${city}, ${state} ${zipCode}, ${country}`;\n\n\t\t// Get API key from environment\n\t\tconst apiKey = process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY;\n\n\t\tif (!apiKey) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Geocoding API key not configured\",\n\t\t\t};\n\t\t}\n\n\t\t// Call Google Geocoding API\n\t\tconst encodedAddress = encodeURIComponent(fullAddress);\n\t\tconst url = `https://maps.googleapis.com/maps/api/geocode/json?address=${encodedAddress}&key=${apiKey}`;\n\n\t\tconst response = await fetch(url);\n\n\t\tif (!response.ok) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: `Geocoding failed with status ${response.status}`,\n\t\t\t};\n\t\t}\n\n\t\tconst data = await response.json();\n\n\t\t// Check if we got results\n\t\tif (data.status === \"OK\" && data.results && data.results.length > 0) {\n\t\t\tconst location = data.results[0].geometry.location;\n\t\t\tconst formattedAddress = data.results[0].formatted_address;\n\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tcoordinates: {\n\t\t\t\t\tlat: location.lat,\n\t\t\t\t\tlon: location.lng,\n\t\t\t\t\tformattedAddress,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\tif (data.status === \"ZERO_RESULTS\") {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Address not found\",\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: data.error_message || `Geocoding failed: ${data.status}`,\n\t\t};\n\t} catch (error) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: error instanceof Error ? error.message : \"Unknown geocoding error\",\n\t\t};\n\t}\n}\n\n/**\n * Geocode an address silently in the background\n * Does not throw errors - returns null on failure\n *\n * Useful for non-critical geocoding where we don't want to block\n * the main operation if geocoding fails\n */\nexport async function geocodeAddressSilent(\n\taddress: string,\n\tcity: string,\n\tstate: string,\n\tzipCode: string,\n\tcountry = \"USA\",\n): Promise<GeocodeResult | null> {\n\ttry {\n\t\tconst result = await geocodeAddress(address, city, state, zipCode, country);\n\t\treturn result.success && result.coordinates ? result.coordinates : null;\n\t} catch (_error) {\n\t\treturn null;\n\t}\n}\n"],"names":[],"mappings":"wCA6BA,eAAe,EACd,CAAe,CACf,CAAY,CACZ,CAAa,CACb,CAAe,CACf,EAAU,KAAK,EAEf,GAAI,CAEH,IAAM,EAAc,CAAA,EAAG,EAAQ,EAAE,EAAE,EAAK,EAAE,EAAE,EAAM,CAAC,EAAE,EAAQ,EAAE,EAAE,EAAA,CAAS,CAapE,EAAiB,mBAAmB,GACpC,EAAM,CAAC,0DAA0D,EAAE,eAAe,KAAK,EAAE,yBAAQ,CAEjG,EAAW,MAAM,MAAM,GAE7B,GAAI,CAAC,EAAS,EAAE,CACf,CADiB,KACV,CACN,SAAS,EACT,MAAO,CAAC,6BAA6B,EAAE,EAAS,MAAM,CAAA,CAAE,AACzD,EAGD,IAAM,EAAO,MAAM,EAAS,IAAI,GAGhC,GAAoB,OAAhB,EAAK,MAAM,EAAa,EAAK,OAAO,EAAI,EAAK,OAAO,CAAC,MAAM,CAAG,EAAG,CACpE,IAAM,EAAW,EAAK,OAAO,CAAC,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAC5C,EAAmB,EAAK,OAAO,CAAC,EAAE,CAAC,iBAAiB,CAE1D,MAAO,CACN,SAAS,EACT,YAAa,CACZ,IAAK,EAAS,GAAG,CACjB,IAAK,EAAS,GAAG,CACjB,kBACD,CACD,CACD,CACA,GAAoB,gBAAgB,CAAhC,EAAK,MAAM,CACd,MAAO,CACN,SAAS,EACT,MAAO,mBACR,EAED,MAAO,CACN,SAAS,EACT,MAAO,EAAK,aAAa,EAAI,CAAC,kBAAkB,EAAE,EAAK,MAAM,CAAA,CAAE,AAChE,CACD,CAAE,MAAO,EAAO,CACf,MAAO,CACN,SAAS,EACT,MAAO,aAAiB,MAAQ,EAAM,OAAO,CAAG,yBACjD,CACD,CACD,CASO,eAAe,EACrB,CAAe,CACf,CAAY,CACZ,CAAa,CACb,CAAe,CACf,EAAU,KAAK,EAEf,GAAI,CACH,IAAM,EAAS,MAAM,EAAe,EAAS,EAAM,EAAO,EAAS,GACnE,OAAO,EAAO,OAAO,EAAI,EAAO,WAAW,CAAG,EAAO,WAAW,CAAG,IACpE,CAAE,MAAO,EAAQ,CAChB,OAAO,IACR,CACD"}