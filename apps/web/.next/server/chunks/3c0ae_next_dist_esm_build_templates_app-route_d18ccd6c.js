module.exports=[469638,e=>{"use strict";var t=e.i(755535),r=e.i(377233),a=e.i(490003),n=e.i(492991),o=e.i(241970),i=e.i(357699),s=e.i(212454),l=e.i(48717),u=e.i(798301),c=e.i(986366),d=e.i(983537),p=e.i(147475),m=e.i(561930),g=e.i(803747),f=e.i(368557),h=e.i(42037),T=e.i(193695);e.i(432036);var R=e.i(573881);e.i(715051);var w=e.i(511368),v=e.i(297676),S=e.i(443608);S.z.object({status:S.z.enum(["OK","INVALID_REQUEST","OVER_DAILY_LIMIT","OVER_QUERY_LIMIT","REQUEST_DENIED","UNKNOWN_ERROR","ZERO_RESULTS"]),dstOffset:S.z.number().optional(),rawOffset:S.z.number().optional(),timeZoneId:S.z.string().optional(),timeZoneName:S.z.string().optional(),errorMessage:S.z.string().optional()});class E{apiKey;cache=new Map;cacheTTL=2592e6;constructor(){this.apiKey=process.env.GOOGLE_API_KEY||process.env.GOOGLE_MAPS_API_KEY}generateCacheKey(e,t){return`tz:${e.toFixed(2)},${t.toFixed(2)}`}formatUtcOffset(e){let t=Math.floor(Math.abs(e)/3600),r=Math.floor(Math.abs(e)%3600/60);return`UTC${e>=0?"+":"-"}${t.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`}async getTimeZone(e,t){if(!this.apiKey)return console.warn("Google Time Zone API key not configured"),null;let r=this.generateCacheKey(e.latitude,e.longitude),a=this.cache.get(r);if(a&&Date.now()-a.timestamp<this.cacheTTL){let e=new Date((t||new Date).getTime()+1e3*a.data.totalOffsetSeconds);return{...a.data,localTime:e,localTimeString:e.toISOString().replace("Z","")}}try{let a=t||new Date,n=Math.floor(a.getTime()/1e3),o=new URLSearchParams({location:`${e.latitude},${e.longitude}`,timestamp:String(n),key:this.apiKey}),i=`https://maps.googleapis.com/maps/api/timezone/json?${o.toString()}`,s=await fetch(i,{headers:{"User-Agent":"Stratos-FMS/1.0 (support@stratos.app)"}});if(!s.ok)return console.error("Time Zone API error:",s.status),null;let l=await s.json();if("OK"!==l.status)return console.error("Time Zone API status:",l.status,l.errorMessage),null;let u=l.rawOffset||0,c=l.dstOffset||0,d=u+c,p=new Date(a.getTime()+1e3*d),m={timeZoneId:l.timeZoneId,timeZoneName:l.timeZoneName,rawOffsetSeconds:u,dstOffsetSeconds:c,totalOffsetSeconds:d,totalOffsetHours:d/3600,utcOffsetString:this.formatUtcOffset(d),isDST:0!==c,localTime:p,localTimeString:p.toISOString().replace("Z","")};return this.cache.set(r,{data:m,timestamp:Date.now()}),m}catch(e){return console.error("Time Zone API error:",e),null}}async getTimeZoneByAddress(e){return console.warn("getTimeZoneByAddress requires geocoding integration"),null}async convertTime(e,t,r){let a=await this.getTimeZone(t,e),n=await this.getTimeZone(r,e);if(!a||!n)return null;let o=n.totalOffsetSeconds-a.totalOffsetSeconds,i=new Date(e.getTime()+1e3*o);return{sourceTime:e,targetTime:i,sourceTz:a,targetTz:n}}async checkBusinessHours(e,t,r){let a,n,o=await this.getTimeZone(e);if(!o)return null;let i=o.localTime.toTimeString().slice(0,5),[s,l]=t.split(":").map(Number),[u,c]=r.split(":").map(Number),[d,p]=i.split(":").map(Number),m=60*s+l,g=60*u+c,f=60*d+p,h=f>=m&&f<g;return h?n=this.formatDuration(g-f):a=f<m?this.formatDuration(m-f):this.formatDuration(1440-f+m),{timeZoneId:o.timeZoneId,openTime:t,closeTime:r,isCurrentlyOpen:h,opensIn:a,closesIn:n,localTime:i}}formatDuration(e){if(e<60)return`${e} min`;let t=Math.floor(e/60),r=e%60;return 0===r?`${t}h`:`${t}h ${r}m`}async getTimeAtLocations(e){return await Promise.all(e.map(async({id:e,location:t})=>({id:e,timezone:await this.getTimeZone(t)})))}async calculateArrivalTime(e,t,r,a){let n=await this.getTimeZone(t,e),o=new Date(e.getTime()+60*a*1e3),i=await this.getTimeZone(r,o);return n&&i?{departureLocal:n.localTime,arrivalLocal:i.localTime,departureTz:n.timeZoneId,arrivalTz:i.timeZoneId}:null}isConfigured(){return!!this.apiKey}clearCache(){this.cache.clear()}}let O=new E,z=S.z.object({latitude:S.z.number(),longitude:S.z.number()}),x=S.z.object({action:S.z.literal("lookup"),location:z,timestamp:S.z.string().optional()}),N=S.z.object({action:S.z.literal("convert"),sourceTime:S.z.string(),sourceLocation:z,targetLocation:z}),I=S.z.object({action:S.z.literal("business_hours"),location:z,openTime:S.z.string().regex(/^\d{2}:\d{2}$/),closeTime:S.z.string().regex(/^\d{2}:\d{2}$/)}),y=S.z.object({action:S.z.literal("multiple"),locations:S.z.array(S.z.object({id:S.z.string(),location:z})).min(1).max(50)}),C=S.z.object({action:S.z.literal("arrival"),departureTime:S.z.string(),departureLocation:z,arrivalLocation:z,travelDurationMinutes:S.z.number().min(0)}),b=S.z.discriminatedUnion("action",[x,N,I,y,C]);async function A(e){try{let t=await (0,w.createClient)(),{data:{user:r}}=await t.auth.getUser();if(!r)return v.NextResponse.json({error:"Unauthorized"},{status:401});if(!O.isConfigured())return v.NextResponse.json({error:"Time Zone service is not configured. Set GOOGLE_API_KEY environment variable."},{status:503});let{searchParams:a}=new URL(e.url),n=a.get("lat"),o=a.get("lng"),i=a.get("timestamp");if(!n||!o)return v.NextResponse.json({error:"lat and lng parameters required"},{status:400});let s={latitude:Number.parseFloat(n),longitude:Number.parseFloat(o)},l=await O.getTimeZone(s,i?new Date(i):void 0);if(!l)return v.NextResponse.json({error:"Could not determine timezone for location"},{status:404});return v.NextResponse.json({success:!0,data:{...l,localTime:l.localTime.toISOString()}})}catch(e){return console.error("Time Zone GET error:",e),v.NextResponse.json({error:"Failed to get timezone",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function _(e){try{let t=await (0,w.createClient)(),{data:{user:r}}=await t.auth.getUser();if(!r)return v.NextResponse.json({error:"Unauthorized"},{status:401});if(!O.isConfigured())return v.NextResponse.json({error:"Time Zone service is not configured. Set GOOGLE_API_KEY environment variable."},{status:503});let a=await e.json(),n=b.parse(a);switch(n.action){case"lookup":{let e=await O.getTimeZone(n.location,n.timestamp?new Date(n.timestamp):void 0);if(!e)return v.NextResponse.json({error:"Could not determine timezone for location"},{status:404});return v.NextResponse.json({success:!0,data:{...e,localTime:e.localTime.toISOString()}})}case"convert":{let e=await O.convertTime(new Date(n.sourceTime),n.sourceLocation,n.targetLocation);if(!e)return v.NextResponse.json({error:"Could not convert time between timezones"},{status:500});return v.NextResponse.json({success:!0,data:{sourceTime:e.sourceTime.toISOString(),targetTime:e.targetTime.toISOString(),sourceTimezone:e.sourceTz.timeZoneId,targetTimezone:e.targetTz.timeZoneId,sourceOffset:e.sourceTz.utcOffsetString,targetOffset:e.targetTz.utcOffsetString}})}case"business_hours":{let e=await O.checkBusinessHours(n.location,n.openTime,n.closeTime);if(!e)return v.NextResponse.json({error:"Could not check business hours"},{status:500});return v.NextResponse.json({success:!0,data:e})}case"multiple":{let e=await O.getTimeAtLocations(n.locations.map(e=>({id:e.id,location:e.location})));return v.NextResponse.json({success:!0,data:{timezones:e.map(e=>({id:e.id,timezone:e.timezone?{...e.timezone,localTime:e.timezone.localTime.toISOString()}:null})),count:e.length}})}case"arrival":{let e=await O.calculateArrivalTime(new Date(n.departureTime),n.departureLocation,n.arrivalLocation,n.travelDurationMinutes);if(!e)return v.NextResponse.json({error:"Could not calculate arrival time"},{status:500});return v.NextResponse.json({success:!0,data:{departureLocal:e.departureLocal.toISOString(),arrivalLocal:e.arrivalLocal.toISOString(),departureTimezone:e.departureTz,arrivalTimezone:e.arrivalTz}})}default:return v.NextResponse.json({error:"Invalid action"},{status:400})}}catch(e){if(console.error("Time Zone API error:",e),e instanceof S.z.ZodError)return v.NextResponse.json({error:"Invalid request data",details:e.errors},{status:400});return v.NextResponse.json({error:"Failed to process timezone request",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}e.s(["GET",()=>A,"POST",()=>_],256603);var j=e.i(256603);let D=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/timezone/route",pathname:"/api/timezone",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/timezone/route.ts",nextConfigOutput:"",userland:j}),{workAsyncStorage:P,workUnitAsyncStorage:Z,serverHooks:L}=D;function U(){return(0,a.patchFetch)({workAsyncStorage:P,workUnitAsyncStorage:Z})}async function M(e,t,a){D.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/timezone/route";w=w.replace(/\/index$/,"")||"/";let v=await D.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:S,params:E,nextConfig:O,parsedUrl:z,isDraftMode:x,prerenderManifest:N,routerServerContext:I,isOnDemandRevalidate:y,revalidateOnlyGenerated:C,resolvedPathname:b,clientReferenceManifest:A,serverActionsManifest:_}=v,j=(0,l.normalizeAppPath)(w),P=!!(N.dynamicRoutes[j]||N.routes[b]),Z=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,z,!1):t.end("This page could not be found"),null);if(P&&!x){let e=!!N.routes[b],t=N.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(O.experimental.adapterPath)return await Z();throw new T.NoFallbackError}}let L=null;!P||D.isDev||x||(L="/index"===(L=b)?"/":L);let U=!0===D.isDev||!P,M=P&&!U;_&&A&&(0,i.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:A,serverActionsManifest:_,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:_})});let k=e.method||"GET",$=(0,o.getTracer)(),K=$.getActiveScopeSpan(),H={params:E,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!O.experimental.authInterrupts},cacheComponents:!!O.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:O.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>D.onRequestError(e,t,a,I)},sharedContext:{buildId:S}},q=new u.NodeNextRequest(e),F=new u.NodeNextResponse(t),G=c.NextRequestAdapter.fromNodeNextRequest(q,(0,c.signalFromNodeResponse)(t));try{let i=async e=>D.handle(G,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${k} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${w}`)}),s=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var o,l;let u=async({previousCacheEntry:r})=>{try{if(!s&&y&&C&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(n);e.fetchMetrics=H.renderOpts.fetchMetrics;let l=H.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=H.renderOpts.collectedTags;if(!P)return await (0,m.sendResponse)(q,F,o,H.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(o.headers);u&&(t[h.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,a=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await D.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:y})},I),t}},c=await D.handleResponse({req:e,nextConfig:O,cacheKey:L,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:y,revalidateOnlyGenerated:C,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:s});if(!P)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",y?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,g.fromNodeOutgoingHttpHeaders)(c.value.headers);return s&&P||d.delete(h.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,f.getCacheControlHeader)(c.cacheControl)),await (0,m.sendResponse)(q,F,new Response(c.value.body,{headers:d,status:c.value.status||200})),null};K?await l(K):await $.withPropagatedContext(e.headers,()=>$.trace(d.BaseServerSpan.handleRequest,{spanName:`${k} ${w}`,kind:o.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},l))}catch(t){if(t instanceof T.NoFallbackError||await D.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:y})}),P)throw t;return await (0,m.sendResponse)(q,F,new Response(null,{status:500})),null}}e.s(["handler",()=>M,"patchFetch",()=>U,"routeModule",()=>D,"serverHooks",()=>L,"workAsyncStorage",()=>P,"workUnitAsyncStorage",()=>Z],469638)}];

//# sourceMappingURL=3c0ae_next_dist_esm_build_templates_app-route_d18ccd6c.js.map