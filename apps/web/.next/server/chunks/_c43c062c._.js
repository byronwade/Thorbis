module.exports=[116876,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"ReadonlyURLSearchParams",{enumerable:!0,get:function(){return n}});class r extends Error{constructor(){super("Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams")}}class n extends URLSearchParams{append(){throw new r}delete(){throw new r}set(){throw new r}sort(){throw new r}}("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),t.exports=a.default)},17958,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"RedirectStatusCode",{enumerable:!0,get:function(){return n}});var r,n=((r={})[r.SeeOther=303]="SeeOther",r[r.TemporaryRedirect=307]="TemporaryRedirect",r[r.PermanentRedirect=308]="PermanentRedirect",r);("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),t.exports=a.default)},735542,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r,n={REDIRECT_ERROR_CODE:function(){return o},RedirectType:function(){return u},isRedirectError:function(){return s}};for(var l in n)Object.defineProperty(a,l,{enumerable:!0,get:n[l]});let i=e.r(17958),o="NEXT_REDIRECT";var u=((r={}).push="push",r.replace="replace",r);function s(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let t=e.digest.split(";"),[a,r]=t,n=t.slice(2,-2).join(";"),l=Number(t.at(-2));return a===o&&("replace"===r||"push"===r)&&"string"==typeof n&&!isNaN(l)&&l in i.RedirectStatusCode}("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),t.exports=a.default)},931095,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r={getRedirectError:function(){return u},getRedirectStatusCodeFromError:function(){return p},getRedirectTypeFromError:function(){return f},getURLFromRedirectError:function(){return c},permanentRedirect:function(){return d},redirect:function(){return s}};for(var n in r)Object.defineProperty(a,n,{enumerable:!0,get:r[n]});let l=e.r(17958),i=e.r(735542),o=e.r(120635).actionAsyncStorage;function u(e,t,a=l.RedirectStatusCode.TemporaryRedirect){let r=Object.defineProperty(Error(i.REDIRECT_ERROR_CODE),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return r.digest=`${i.REDIRECT_ERROR_CODE};${t};${e};${a};`,r}function s(e,t){throw u(e,t??=o?.getStore()?.isAction?i.RedirectType.push:i.RedirectType.replace,l.RedirectStatusCode.TemporaryRedirect)}function d(e,t=i.RedirectType.replace){throw u(e,t,l.RedirectStatusCode.PermanentRedirect)}function c(e){return(0,i.isRedirectError)(e)?e.digest.split(";").slice(2,-2).join(";"):null}function f(e){if(!(0,i.isRedirectError)(e))throw Object.defineProperty(Error("Not a redirect error"),"__NEXT_ERROR_CODE",{value:"E260",enumerable:!1,configurable:!0});return e.digest.split(";",2)[1]}function p(e){if(!(0,i.isRedirectError)(e))throw Object.defineProperty(Error("Not a redirect error"),"__NEXT_ERROR_CODE",{value:"E260",enumerable:!1,configurable:!0});return Number(e.digest.split(";").at(-2))}("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),t.exports=a.default)},670336,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r={HTTPAccessErrorStatus:function(){return l},HTTP_ERROR_FALLBACK_ERROR_CODE:function(){return o},getAccessFallbackErrorTypeByStatus:function(){return d},getAccessFallbackHTTPStatus:function(){return s},isHTTPAccessFallbackError:function(){return u}};for(var n in r)Object.defineProperty(a,n,{enumerable:!0,get:r[n]});let l={NOT_FOUND:404,FORBIDDEN:403,UNAUTHORIZED:401},i=new Set(Object.values(l)),o="NEXT_HTTP_ERROR_FALLBACK";function u(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,a]=e.digest.split(";");return t===o&&i.has(Number(a))}function s(e){return Number(e.digest.split(";")[1])}function d(e){switch(e){case 401:return"unauthorized";case 403:return"forbidden";case 404:return"not-found";default:return}}("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),t.exports=a.default)},37215,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"notFound",{enumerable:!0,get:function(){return l}});let r=e.r(670336),n=`${r.HTTP_ERROR_FALLBACK_ERROR_CODE};404`;function l(){let e=Object.defineProperty(Error(n),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});throw e.digest=n,e}("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),t.exports=a.default)},8548,(e,t,a)=>{"use strict";function r(){throw Object.defineProperty(Error("`forbidden()` is experimental and only allowed to be enabled when `experimental.authInterrupts` is enabled."),"__NEXT_ERROR_CODE",{value:"E488",enumerable:!1,configurable:!0})}Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"forbidden",{enumerable:!0,get:function(){return r}}),e.r(670336).HTTP_ERROR_FALLBACK_ERROR_CODE,("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),t.exports=a.default)},715911,(e,t,a)=>{"use strict";function r(){throw Object.defineProperty(Error("`unauthorized()` is experimental and only allowed to be used when `experimental.authInterrupts` is enabled."),"__NEXT_ERROR_CODE",{value:"E411",enumerable:!1,configurable:!0})}Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"unauthorized",{enumerable:!0,get:function(){return r}}),e.r(670336).HTTP_ERROR_FALLBACK_ERROR_CODE,("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),t.exports=a.default)},322472,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"isPostpone",{enumerable:!0,get:function(){return n}});let r=Symbol.for("react.postpone");function n(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}},79193,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"isNextRouterError",{enumerable:!0,get:function(){return l}});let r=e.r(670336),n=e.r(735542);function l(e){return(0,n.isRedirectError)(e)||(0,r.isHTTPAccessFallbackError)(e)}("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),t.exports=a.default)},607823,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"unstable_rethrow",{enumerable:!0,get:function(){return function e(t){if((0,i.isNextRouterError)(t)||(0,l.isBailoutToCSRError)(t)||(0,u.isDynamicServerError)(t)||(0,o.isDynamicPostpone)(t)||(0,n.isPostpone)(t)||(0,r.isHangingPromiseRejectionError)(t)||(0,o.isPrerenderInterruptedError)(t))throw t;t instanceof Error&&"cause"in t&&e(t.cause)}}});let r=e.r(58656),n=e.r(322472),l=e.r(771291),i=e.r(79193),o=e.r(826675),u=e.r(84756);("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),t.exports=a.default)},960717,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"unstable_rethrow",{enumerable:!0,get:function(){return r}});let r=e.r(607823).unstable_rethrow;("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),t.exports=a.default)},966995,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r={ReadonlyURLSearchParams:function(){return l.ReadonlyURLSearchParams},RedirectType:function(){return o.RedirectType},forbidden:function(){return s.forbidden},notFound:function(){return u.notFound},permanentRedirect:function(){return i.permanentRedirect},redirect:function(){return i.redirect},unauthorized:function(){return d.unauthorized},unstable_isUnrecognizedActionError:function(){return f},unstable_rethrow:function(){return c.unstable_rethrow}};for(var n in r)Object.defineProperty(a,n,{enumerable:!0,get:r[n]});let l=e.r(116876),i=e.r(931095),o=e.r(735542),u=e.r(37215),s=e.r(8548),d=e.r(715911),c=e.r(960717);function f(){throw Object.defineProperty(Error("`unstable_isUnrecognizedActionError` can only be used on the client."),"__NEXT_ERROR_CODE",{value:"E776",enumerable:!1,configurable:!0})}("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),t.exports=a.default)},905394,e=>{"use strict";let t=(0,e.i(479404).registerClientReference)(function(){throw Error("Attempted to call StatusPipeline() from the server but StatusPipeline is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/ui/status-pipeline.tsx <module evaluation>","StatusPipeline");e.s(["StatusPipeline",0,t])},477352,e=>{"use strict";let t=(0,e.i(479404).registerClientReference)(function(){throw Error("Attempted to call StatusPipeline() from the server but StatusPipeline is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/web/src/components/ui/status-pipeline.tsx","StatusPipeline");e.s(["StatusPipeline",0,t])},501860,e=>{"use strict";e.i(905394);var t=e.i(477352);e.n(t)},389095,e=>{"use strict";var t=e.i(755535),a=e.i(377233),r=e.i(490003),n=e.i(492991),l=e.i(241970),i=e.i(357699),o=e.i(212454),u=e.i(48717),s=e.i(798301),d=e.i(986366),c=e.i(983537),f=e.i(147475),p=e.i(561930),_=e.i(803747),h=e.i(368557),g=e.i(42037),m=e.i(193695);e.i(432036);var v=e.i(573881),b=e.i(297676),y=e.i(660198),w=e.i(966995),R=e.i(501860),E=e.i(849614);e.i(16106);var O=e.i(985647),C=e.i(273568);let S=(0,E.cache)(async e=>{let t=e??await (0,O.getActiveCompanyId)();if(!t)return null;let a=await (0,C.createServiceSupabaseClient)();if(!a)throw Error("Supabase client not configured");let{data:r,error:n}=await a.from("appointments").select("status, archived_at, deleted_at").eq("company_id",t).eq("type","appointment").limit(5e4);if(n)throw Error(`Failed to fetch appointment stats: ${n.message}`);let l={total:0,scheduled:0,confirmed:0,in_progress:0,completed:0,cancelled:0};for(let e of r??[]){if(e.archived_at||e.deleted_at)continue;l.total++;let t=(e.status||"").toLowerCase();"scheduled"===t?l.scheduled++:"confirmed"===t?l.confirmed++:"in_progress"===t?l.in_progress++:"completed"===t?l.completed++:"cancelled"===t&&l.cancelled++}return l});async function P(){let e=await S();return e?[{label:"Scheduled",value:e.scheduled,change:8.4*(e.scheduled>0)},{label:"Confirmed",value:e.confirmed,change:12.1*(e.confirmed>0)},{label:"In Progress",value:e.in_progress,change:5.7*(e.in_progress>0)},{label:"Completed",value:e.completed,change:9.3*(e.completed>0)},{label:"Cancelled",value:e.cancelled,change:e.cancelled>0?-3.2:2.1}]:[]}(0,E.cache)(async(e,t,a,r=50)=>{let n=e??await (0,O.getActiveCompanyId)();if(!n)return[];let l=await (0,C.createServiceSupabaseClient)();if(!l)throw Error("Supabase client not configured");let{data:i,error:o}=await l.rpc("get_appointments_with_details",{p_company_id:n,p_start_time:t||null,p_end_time:a||null,p_limit:r});return o?(console.error("Error fetching appointments via RPC:",o),[]):i||[]}),(0,E.cache)(async(e,t)=>{let a=await (0,C.createServiceSupabaseClient)();if(!a)throw Error("Supabase client not configured");let{data:r,error:n}=await a.rpc("get_appointment_complete",{p_appointment_id:e,p_company_id:t});return n?(console.error("Error fetching appointment:",n),null):r?.[0]?.appointment_data||null}),e.i(464524);var j=e.i(177585);let T=(0,E.cache)(async e=>{let t=e??await (0,O.getActiveCompanyId)();if(!t)return[];let a=await (0,C.createServiceSupabaseClient)();if(!a)throw Error("Supabase client not configured");let{data:r,error:n}=await a.from("contracts").select("status, archived_at, deleted_at").eq("company_id",t);if(n)throw Error(`Failed to fetch contract stats: ${n.message}`);return r??[]});async function A(){let[e,t]=await Promise.all([(0,j.getCurrentUser)(),(0,O.getActiveCompanyId)()]);if(!e||!t)return(0,w.notFound)();let a=[];try{a=await T(t)}catch(e){return(0,y.jsx)(R.StatusPipeline,{compact:!0,stats:[]})}let r=a.filter(e=>!(e.archived_at||e.deleted_at)),n=r.length,l=r.filter(e=>"signed"===e.status).length,i=r.filter(e=>"sent"===e.status||"viewed"===e.status).length,o=r.filter(e=>"draft"===e.status).length,u=r.filter(e=>"expired"===e.status).length;return[{label:"Draft",value:o,change:o>0?0:5.1},{label:"Awaiting Signature",value:i,change:i>0?0:6.8},{label:"Signed",value:l,change:14.2*(l>0)},{label:"Expired",value:u,change:u>0?-4.3:2.7},{label:"Total Contracts",value:n,change:8.9*(n>0)}]}(0,E.cache)(async(e,t)=>{let a=await (0,C.createServiceSupabaseClient)();if(!a)throw Error("Supabase client not configured");let{data:r,error:n}=await a.rpc("get_contract_complete",{p_contract_id:e,p_company_id:t});return n?(console.error("Error fetching contract:",n),null):r?.[0]?.contract_data||null});var D=e.i(511368);async function x(){let e=await (0,D.createClient)();if(!e)return(0,w.notFound)();let{data:{user:t}}=await e.auth.getUser();if(!t)return(0,w.notFound)();let a=await (0,O.getActiveCompanyId)();if(!a)return(0,w.notFound)();let{data:r,error:n}=await e.from("equipment").select(`
      *,
      customer:customers!customer_id(display_name, first_name, last_name),
      property:properties!property_id(address, city, state)
    `).eq("company_id",a).order("created_at",{ascending:!1});if(n)throw Error(`Failed to load equipment: ${n.message}`);let l=(r||[]).map(e=>({id:e.id,status:e.status,condition:e.condition,nextServiceDue:e.next_service_due?new Date(e.next_service_due).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",archived_at:e.archived_at,deleted_at:e.deleted_at})).filter(e=>!(e.archived_at||e.deleted_at)),i=l.length,o=l.filter(e=>"active"===e.status).length,u=l.filter(e=>"inactive"===e.status).length,s=l.filter(e=>"poor"===e.condition||"needs_replacement"===e.condition).length,d=l.filter(e=>{if(!e.nextServiceDue)return!1;let t=new Date(e.nextServiceDue),a=new Date,r=Math.ceil((t.getTime()-a.getTime())/864e5);return r<=30&&r>=0}).length;return[{label:"Total Equipment",value:i,change:8.4*(i>0)},{label:"Active",value:o,change:12.1*(o>0)},{label:"In Maintenance",value:s,change:s>0?-3.5:4.2},{label:"Service Due Soon",value:d,change:d>0?-5.8:3.6},{label:"Inactive",value:u,change:u>0?0:2.9}]}async function F(){let e=await (0,C.createServiceSupabaseClient)(),t=await (0,O.getActiveCompanyId)();if(!t)return(0,w.notFound)();let{data:a,error:r}=await e.from("estimates").select("id, status, total_amount, archived_at, deleted_at").eq("company_id",t);if(r)return(0,y.jsx)(R.StatusPipeline,{compact:!0,stats:[]});let n=(a||[]).filter(e=>!(e.archived_at||e.deleted_at)),l=n.filter(e=>"draft"===e.status).length,i=n.filter(e=>"sent"===e.status).length,o=n.filter(e=>"accepted"===e.status).length,u=n.filter(e=>"declined"===e.status).length,s=n.reduce((e,t)=>e+(t.total_amount||0),0),d=n.filter(e=>"accepted"===e.status).reduce((e,t)=>e+(t.total_amount||0),0),c=n.filter(e=>"sent"===e.status).reduce((e,t)=>e+(t.total_amount||0),0);return[{label:"Draft",value:l,change:l>0?0:4.8},{label:"Sent",value:`$${(c/100).toLocaleString()}`,change:i>0?0:7.2},{label:"Accepted",value:`$${(d/100).toLocaleString()}`,change:15.3*(o>0)},{label:"Declined",value:u,change:u>0?-5.4:3.1},{label:"Total Value",value:`$${(s/100).toLocaleString()}`,change:10.8*(s>0)}]}function M(e,t){return 0===t?100*(e>0):Math.round((e-t)/t*1e3)/10}async function N(){let e=await (0,C.createServiceSupabaseClient)();await (0,O.isActiveCompanyOnboardingComplete)()||(0,w.redirect)("/dashboard");let t=await (0,O.getActiveCompanyId)();t||(0,w.redirect)("/dashboard");let a=new Date,r=new Date(a.getTime()-2592e6),n=new Date(a.getTime()-5184e6),{data:l}=await e.from("invoices").select("status, total_amount, paid_amount, balance_amount, archived_at, deleted_at, created_at, paid_at").eq("company_id",t).is("deleted_at",null),i=l?.filter(e=>!e.archived_at)||[],o=i.filter(e=>"draft"===e.status),u=i.filter(e=>"sent"===e.status||"partial"===e.status),s=i.filter(e=>"paid"===e.status),d=i.filter(e=>"past_due"===e.status),c=o.length;u.length,s.length;let f=d.length,p=s.reduce((e,t)=>e+(t.paid_amount||0),0),_=u.reduce((e,t)=>e+(t.balance_amount||t.total_amount||0),0),h=d.reduce((e,t)=>e+(t.balance_amount||t.total_amount||0),0),g=o.reduce((e,t)=>e+(t.total_amount||0),0),m=s.filter(e=>e.paid_at&&new Date(e.paid_at)>=r).reduce((e,t)=>e+(t.paid_amount||0),0),v=s.filter(e=>e.paid_at&&new Date(e.paid_at)>=n&&new Date(e.paid_at)<r).reduce((e,t)=>e+(t.paid_amount||0),0),b=i.filter(e=>new Date(e.created_at)>=r).length,y=i.filter(e=>new Date(e.created_at)>=n&&new Date(e.created_at)<r).length;return[{label:"Draft",value:c>0?`${c} ($${(g/100).toLocaleString()})`:"0",change:0},{label:"Pending",value:`$${(_/100).toLocaleString()}`,change:0},{label:"Paid",value:`$${(p/100).toLocaleString()}`,change:M(m,v)},{label:"Overdue",value:f>0?`$${(h/100).toLocaleString()}`:"$0",change:f>0?-f:0},{label:"Total Invoices",value:i.length,change:M(b,y)}]}function I(e,t){return 0===t?100*(e>0):Math.round((e-t)/t*1e3)/10}async function $(){let e=await (0,C.createServiceSupabaseClient)();await (0,O.isActiveCompanyOnboardingComplete)()||(0,w.redirect)("/dashboard");let t=await (0,O.getActiveCompanyId)();t||(0,w.redirect)("/dashboard");let a=new Date,r=new Date(a.getTime()-6048e5),n=new Date(a.getTime()-12096e5),{data:l}=await e.from("jobs").select("status, created_at, archived_at, deleted_at").eq("company_id",t).is("deleted_at",null).gte("created_at",r.toISOString()),{data:i}=await e.from("jobs").select("status, created_at, archived_at, deleted_at").eq("company_id",t).is("deleted_at",null).gte("created_at",n.toISOString()).lt("created_at",r.toISOString()),{data:o}=await e.from("jobs").select("status, archived_at, deleted_at").eq("company_id",t).is("deleted_at",null).is("archived_at",null),u=o||[],s=l||[],d=i||[],c=u.filter(e=>"scheduled"===e.status).length,f=u.filter(e=>"in_progress"===e.status).length,p=u.filter(e=>"completed"===e.status).length,_=u.filter(e=>"quoted"===e.status).length,h=u.filter(e=>"on_hold"===e.status).length,g=s.filter(e=>"scheduled"===e.status).length,m=s.filter(e=>"in_progress"===e.status).length,v=s.filter(e=>"completed"===e.status).length,b=s.filter(e=>"quoted"===e.status).length,y=d.filter(e=>"scheduled"===e.status).length,R=d.filter(e=>"in_progress"===e.status).length,E=d.filter(e=>"completed"===e.status).length;return[{label:"Quoted",value:_,change:I(b,d.filter(e=>"quoted"===e.status).length)},{label:"Scheduled",value:c,change:I(g,y)},{label:"In Progress",value:f,change:I(m,R)},{label:"Completed",value:p,change:I(v,E)},{label:"On Hold",value:h,change:0}]}async function k(){let e=await (0,D.createClient)();if(!e)return(0,w.notFound)();let{data:{user:t}}=await e.auth.getUser();if(!t)return(0,w.notFound)();let a=await (0,O.getActiveCompanyId)();if(!a)return(0,w.notFound)();let{data:r,error:n}=await e.from("inventory").select(`
      id,
      quantity_on_hand,
      quantity_available,
      cost_per_unit,
      total_cost_value,
      status
    `).eq("company_id",a).is("deleted_at",null);if(n)throw Error(`Failed to fetch materials: ${n.message}`);let l=(r||[]).map(e=>({status:e.status||"in-stock",totalValue:Number(e.total_cost_value??0)||Number(e.cost_per_unit??0)*Number(e.quantity_on_hand??e.quantity_available??0)})),i=l.length,o=l.filter(e=>"in-stock"===e.status).length,u=l.filter(e=>"low-stock"===e.status).length;l.filter(e=>"out-of-stock"===e.status).length;let s=l.reduce((e,t)=>e+(t.totalValue||0),0);return[{label:"Total Items",value:i,change:7.5*(i>0)},{label:"In Stock",value:o,change:9.2*(o>0)},{label:"Low Stock",value:u,change:u>0?-4.7:2.1},{label:"Inventory Value",value:`$${(s/100).toLocaleString()}`,change:11.3*(s>0)},{label:"Total SKUs",value:i,change:5.8*(i>0)}]}async function U(){let e=await (0,C.createServiceSupabaseClient)(),t=await (0,O.getActiveCompanyId)();if(!t)return(0,w.notFound)();let{data:a,error:r}=await e.from("payments").select(`
      *,
      customers!customer_id(first_name, last_name, display_name)
    `).eq("company_id",t).order("processed_at",{ascending:!1}).order("created_at",{ascending:!1}).limit(100);if(r){let e=r.message||r.hint||JSON.stringify(r)||"Unknown database error";throw Error(`Failed to load payments: ${e}`)}let n=(a||[]).map(e=>({id:e.id,status:e.status||"pending",archived_at:e.archived_at,deleted_at:e.deleted_at})).filter(e=>!(e.archived_at||e.deleted_at)),l=n.filter(e=>"completed"===e.status).length,i=n.filter(e=>"pending"===e.status).length,o=n.filter(e=>"refunded"===e.status||"partially_refunded"===e.status).length,u=n.filter(e=>"failed"===e.status).length;return[{label:"Completed",value:l,change:14.2*(l>0)},{label:"Pending",value:i,change:i>0?0:6.5},{label:"Refunded",value:o,change:o>0?-4.1:3.2},{label:"Failed",value:u,change:u>0?-7.8:5.9}]}async function q(){let e=await (0,D.createClient)();if(!e)return(0,w.notFound)();let{data:{user:t}}=await e.auth.getUser();if(!t)return(0,w.notFound)();let a=await (0,O.getActiveCompanyId)();if(!a)return(0,w.notFound)();let{data:r,error:n}=await e.from("purchase_orders").select("id, status, total_amount, archived_at").eq("company_id",a).order("created_at",{ascending:!1});if(n)throw Error(`Failed to fetch purchase orders: ${n.message}`);let l=(r||[]).map(e=>({id:e.id,status:e.status,totalAmount:e.total_amount||0,archived_at:e.archived_at,deleted_at:null})).filter(e=>!(e.archived_at||e.deleted_at)),i=l.length,o=l.filter(e=>"pending_approval"===e.status).length,u=l.filter(e=>"ordered"===e.status).length,s=l.filter(e=>"received"===e.status).length,d=l.reduce((e,t)=>e+t.totalAmount,0);return[{label:"Pending Approval",value:o,change:o>0?0:4.2},{label:"Ordered",value:u,change:6.8*(u>0)},{label:"Received",value:s,change:8.5*(s>0)},{label:"Total Value",value:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(d/100),change:5.3*(d>0)},{label:"Total Orders",value:i,change:7.1*(i>0)}]}async function L(){let e=await (0,O.getActiveCompanyId)();if(!e)return(0,w.notFound)();let t=await (0,C.createServiceSupabaseClient)(),{data:a,error:r}=await t.from("company_memberships").select("id, status, archived_at").eq("company_id",e);if(r)throw Error(`Failed to load team members: ${r.message}`);let n=(a||[]).filter(e=>!e.archived_at),l=n.length,i=n.filter(e=>"active"===e.status).length,o=n.filter(e=>"invited"===e.status).length,u=n.filter(e=>"suspended"===e.status).length;return[{label:"Total Members",value:l,change:8.4*(l>0)},{label:"Active",value:i,change:8.4*(i>0)},{label:"Invited",value:o,change:3.2*(o>0)},{label:"Suspended",value:u,change:u>0?-2.1:1.5}]}function H(e,t={}){let{minimumFractionDigits:a=0,maximumFractionDigits:r=t.decimals??2,showZero:n=!0,decimals:l}=t,i=void 0!==l?l:r,o=void 0!==l?l:a;return null==e?n?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(0):"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:o,maximumFractionDigits:i}).format(e/100)}async function K(){let e=await (0,D.createClient)();if(!e)return(0,w.notFound)();let{data:{user:t}}=await e.auth.getUser();if(!t)return(0,w.notFound)();let a=await (0,O.getActiveCompanyId)();if(!a)return(0,w.notFound)();let{data:r,error:n}=await e.from("vendors").select("id, status").eq("company_id",a).is("deleted_at",null);if(n)throw Error(`Failed to fetch vendors: ${n.message}`);let l=r||[],i=l.length,o=l.filter(e=>"active"===e.status).length,u=l.filter(e=>"inactive"===e.status).length,{data:s}=await e.from("purchase_orders").select("id, vendor_id, total_amount, status, created_at").eq("company_id",a).is("deleted_at",null),d=s||[],c=new Date;c.setFullYear(c.getFullYear()-1);let f=d.filter(e=>new Date(e.created_at).getTime()>=c.getTime()).reduce((e,t)=>e+(t.total_amount||0),0),p=new Set(d.filter(e=>e.vendor_id&&new Date(e.created_at)>=c).map(e=>e.vendor_id)).size,_=["draft","pending_approval","approved","ordered","partially_received"],h=d.filter(e=>_.includes((e.status||"").toLowerCase())),g=h.reduce((e,t)=>e+(t.total_amount||0),0),m=i>0?Math.round(o/i*100):0;return[{label:"Total Vendors",value:i,change:m},{label:"Active Vendors",value:o,change:u},{label:"12-mo Spend",value:H(f),change:p},{label:"Open PO Value",value:H(g),change:h.length}]}async function B(e,{params:t}){let{page:a}=await t;try{let e;switch(a){case"appointments":e=await P();break;case"jobs":e=await $();break;case"invoices":e=await N();break;case"contracts":e=await A();break;case"estimates":e=await F();break;case"payments":e=await U();break;case"equipment":e=await x();break;case"materials":e=await k();break;case"purchase-orders":e=await q();break;case"team":e=await L();break;case"vendors":e=await K();break;default:return b.NextResponse.json({error:"Invalid page"},{status:400})}return b.NextResponse.json({stats:e},{headers:{"Cache-Control":"private, max-age=60, stale-while-revalidate=120"}})}catch(e){return console.error(`Error fetching stats for ${a}:`,e),b.NextResponse.json({error:"Failed to fetch stats"},{status:500})}}e.s(["GET",()=>B],452116);var X=e.i(452116);let V=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/work-stats/[page]/route",pathname:"/api/work-stats/[page]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/work-stats/[page]/route.ts",nextConfigOutput:"",userland:X}),{workAsyncStorage:z,workUnitAsyncStorage:G,serverHooks:W}=V;function Y(){return(0,r.patchFetch)({workAsyncStorage:z,workUnitAsyncStorage:G})}async function Z(e,t,r){V.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let b="/api/work-stats/[page]/route";b=b.replace(/\/index$/,"")||"/";let y=await V.prepare(e,t,{srcPage:b,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:w,params:R,nextConfig:E,parsedUrl:O,isDraftMode:C,prerenderManifest:S,routerServerContext:P,isOnDemandRevalidate:j,revalidateOnlyGenerated:T,resolvedPathname:A,clientReferenceManifest:D,serverActionsManifest:x}=y,F=(0,u.normalizeAppPath)(b),M=!!(S.dynamicRoutes[F]||S.routes[A]),N=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,O,!1):t.end("This page could not be found"),null);if(M&&!C){let e=!!S.routes[A],t=S.dynamicRoutes[F];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await N();throw new m.NoFallbackError}}let I=null;!M||V.isDev||C||(I="/index"===(I=A)?"/":I);let $=!0===V.isDev||!M,k=M&&!$;x&&D&&(0,i.setReferenceManifestsSingleton)({page:b,clientReferenceManifest:D,serverActionsManifest:x,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:x})});let U=e.method||"GET",q=(0,l.getTracer)(),L=q.getActiveScopeSpan(),H={params:R,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>V.onRequestError(e,t,r,P)},sharedContext:{buildId:w}},K=new s.NodeNextRequest(e),B=new s.NodeNextResponse(t),X=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let i=async e=>V.handle(X,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=q.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${U} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${b}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),u=async n=>{var l,u;let s=async({previousCacheEntry:a})=>{try{if(!o&&j&&T&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let l=await i(n);e.fetchMetrics=H.renderOpts.fetchMetrics;let u=H.renderOpts.pendingWaitUntil;u&&r.waitUntil&&(r.waitUntil(u),u=void 0);let s=H.renderOpts.collectedTags;if(!M)return await (0,p.sendResponse)(K,B,l,H.renderOpts.pendingWaitUntil),null;{let e=await l.blob(),t=(0,_.toNodeOutgoingHttpHeaders)(l.headers);s&&(t[g.NEXT_CACHE_TAGS_HEADER]=s),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,r=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:l.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await V.onRequestError(e,t,{routerKind:"App Router",routePath:b,routeType:"route",revalidateReason:(0,f.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:j})},P),t}},d=await V.handleResponse({req:e,nextConfig:E,cacheKey:I,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:j,revalidateOnlyGenerated:T,responseGenerator:s,waitUntil:r.waitUntil,isMinimalMode:o});if(!M)return null;if((null==d||null==(l=d.value)?void 0:l.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(u=d.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",j?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,_.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&M||c.delete(g.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,h.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(K,B,new Response(d.value.body,{headers:c,status:d.value.status||200})),null};L?await u(L):await q.withPropagatedContext(e.headers,()=>q.trace(c.BaseServerSpan.handleRequest,{spanName:`${U} ${b}`,kind:l.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},u))}catch(t){if(t instanceof m.NoFallbackError||await V.onRequestError(e,t,{routerKind:"App Router",routePath:F,routeType:"route",revalidateReason:(0,f.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:j})}),M)throw t;return await (0,p.sendResponse)(K,B,new Response(null,{status:500})),null}}e.s(["handler",()=>Z,"patchFetch",()=>Y,"routeModule",()=>V,"serverHooks",()=>W,"workAsyncStorage",()=>z,"workUnitAsyncStorage",()=>G],389095)}];

//# sourceMappingURL=_c43c062c._.js.map