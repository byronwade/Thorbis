(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,68511,e=>{"use strict";var t=e.i(15573),s=e.i(5005);e.i(58939);var a=e.i(21251);e.i(54934);var n=e.i(77607);e.i(15252);var r=e.i(35613);e.i(26359);var l=e.i(63712),i=e.i(8693),o=e.i(46672),d=e.i(10685),c=e.i(63942),m=e.i(83206);let u=(0,m.default)("forward",[["path",{d:"m15 17 5-5-5-5",key:"nf172w"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]]);var x=e.i(59586),h=e.i(47146),p=e.i(38614),g=e.i(39397),f=e.i(60424);let j=(0,m.default)("reply",[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]]),w=(0,m.default)("reply-all",[["path",{d:"m12 17-5-5 5-5",key:"1s3y5u"}],["path",{d:"M22 18v-2a4 4 0 0 0-4-4H7",key:"1fcyog"}],["path",{d:"m7 17-5-5 5-5",key:"1ed8i2"}]]);var v=e.i(87268);let y=(0,m.default)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);var b=e.i(69219),N=e.i(32727);let k=(0,m.default)("voicemail",[["circle",{cx:"6",cy:"12",r:"4",key:"1ehtga"}],["circle",{cx:"18",cy:"12",r:"4",key:"4vafl8"}],["line",{x1:"6",x2:"18",y1:"16",y2:"16",key:"pmt8us"}]]);var C=e.i(12409),M=e.i(19260),M=M;e.i(48105);var S=e.i(63078),D=e.i(30188);e.i(11268);var T=e.i(71056);e.i(82800);var z=e.i(80177);e.i(92265);var I=e.i(13990),B=e.i(9759);let A=(0,m.default)("bold",[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]]);var L=e.i(76389),P=e.i(12710),R=e.i(63699),$=e.i(36764);let F=(0,m.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),U=(0,m.default)("italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]),E=(0,m.default)("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),H=(0,m.default)("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]),O=(0,m.default)("list-ordered",[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]]);var q=e.i(41304);let K=(0,m.default)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);var V=e.i(54115),_=e.i(42642);let Y=(0,m.default)("underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]),W=[{id:"follow-up",label:"Friendly follow-up",body:"Hi there,\n\nJust checking in - let me know if you have any questions or if you'd like to see anything else from my side.\n\nBest,"},{id:"thank-you",label:"Thank you note",body:"Hi there,\n\nThanks again for your patience while we sorted this out. Let me know if there's anything else I can help with.\n\nWarm regards,"},{id:"next-steps",label:"Outline next steps",body:"Hi there,\n\nI've outlined the next steps:\n1. Review the details above.\n2. Confirm when you'd like to move forward.\n3. I'll lock everything in once you reply.\n\nLet me know if you want to adjust anything."},{id:"resolution",label:"Issue resolved",body:"Hi there,\n\nI wanted to let you know that we've resolved the issue you reported. Here's a summary of what was done:\n\n[Summary]\n\nPlease let us know if you experience any further issues.\n\nBest regards,"}],X=[{id:"none",label:"No signature",value:""},{id:"support",label:"Stratos Support",value:"\n\nThanks,\nStratos Support Team"},{id:"admin",label:"Admin Team",value:"\n\nBest regards,\nStratos Admin"}];function G({mode:e,selectedMessage:a,onClose:l,onSent:o,className:d}){let{toast:c}=(0,B.useToast)(),m=(0,s.useRef)(null),u=(0,s.useRef)(null),[x,h]=(0,s.useState)(""),[g,f]=(0,s.useState)(!1),[j,w]=(0,s.useState)(!1),[v,y]=(0,s.useState)("support"),[b,k]=(0,s.useState)(!1),[M,D]=(0,s.useState)([]),[G,Q]=(0,s.useState)([]),[J,Z]=(0,s.useState)([]),[ee,et]=(0,s.useState)(!1),[es,ea]=(0,s.useState)(!1),[en,er]=(0,s.useState)(""),[el,ei]=(0,s.useState)([]),[eo,ed]=(0,s.useState)(""),[ec,em]=(0,s.useState)(!1),[eu,ex]=(0,s.useState)(""),[eh,ep]=(0,s.useState)(""),[eg,ef]=(0,s.useState)(!1),[ej,ew]=(0,s.useState)(5),ev=(0,s.useRef)(null),ey=(0,s.useRef)(null),eb=(0,s.useMemo)(()=>X.find(e=>e.id===v)??X[0],[v]);(0,s.useEffect)(()=>{if(!a)return;let t=a.subject?.trim()||"No subject",s="forward"===e?"Fwd:":"Re:";er(t.toLowerCase().startsWith(s.toLowerCase())?t:`${s} ${t}`),"forward"!==e&&a.from&&D([{id:`recipient-${a.from}`,name:a.userName||a.companyName||a.from,email:a.from,type:a.companyId?"company":"custom"}])},[e,a]);let eN=(0,s.useCallback)(()=>{let e=m.current;e&&(e.style.height="auto",e.style.height=`${Math.min(e.scrollHeight,200)}px`)},[]);(0,s.useEffect)(()=>{eN()},[x,eN]),(0,s.useEffect)(()=>{setTimeout(()=>m.current?.focus(),100)},[]);let ek=(0,s.useCallback)(()=>{ev.current&&(clearTimeout(ev.current),ev.current=null),ey.current&&(clearInterval(ey.current),ey.current=null),ef(!1),ew(5),c.info("Email cancelled")},[c]);(0,s.useEffect)(()=>()=>{ev.current&&clearTimeout(ev.current),ey.current&&clearInterval(ey.current)},[]);let eC=e=>{let t,s=new Date;switch(e){case"tomorrow_morning":(t=new Date(s)).setDate(t.getDate()+1),t.setHours(8,0,0,0);break;case"tomorrow_afternoon":(t=new Date(s)).setDate(t.getDate()+1),t.setHours(13,0,0,0);break;case"monday_morning":let a=(t=new Date(s)).getDay();t.setDate(t.getDate()+(0===a?1:8-a)),t.setHours(8,0,0,0)}return t},eM=async e=>{a?0===M.length?c.error("Add at least one recipient"):x.trim()?e<=new Date?c.error("Schedule time must be in the future"):(w(!0),setTimeout(()=>{let t=e.toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"});c.success(`Email scheduled - Will be sent ${t}`),o?.({}),l(),w(!1),em(!1)},1e3)):c.error("Please write a message"):c.error("Missing context")},eS=async()=>{if(!a)return void c.error("Missing context");if(0===M.length)return void c.error("Add at least one recipient");if(!x.trim())return void c.error("Please write a message");ef(!0),ew(5),c.loading("Sending email...");let e=5;ey.current=setInterval(()=>{ew(--e),e<=0&&ey.current&&(clearInterval(ey.current),ey.current=null)},1e3),ev.current=setTimeout(()=>{ey.current&&(clearInterval(ey.current),ey.current=null),w(!0),ef(!1),setTimeout(()=>{c.success("Email sent successfully"),o?.({}),l(),w(!1)},500)},5e3)},eD=(0,s.useCallback)(async e=>{let t=e.target.files;if(!t||0===t.length)return;let s=[];for(let e of Array.from(t)){if(e.size>0xa00000){c.error(`File "${e.name}" is too large (max 10MB)`);continue}try{let t=await new Promise((t,s)=>{let a=new FileReader;a.onload=()=>{let e=a.result.split(",")[1];t(e)},a.onerror=s,a.readAsDataURL(e)});s.push({filename:e.name,content:t,contentType:e.type,size:e.size})}catch{c.error(`Failed to read file "${e.name}"`)}}s.length>0&&ei(e=>[...e,...s]),u.current&&(u.current.value="")},[c]),eT=(0,s.useCallback)(e=>{ei(t=>t.filter(t=>t.filename!==e))},[]),ez=e=>{e&&e.includes("@")&&(M.some(t=>t.email.toLowerCase()===e.toLowerCase())||(D(t=>[...t,{id:`custom-${e}`,name:e,email:e,type:"custom"}]),ed("")))},eI=(0,s.useMemo)(()=>{if(!a)return"";let e=a.userName||a.companyName||a.from||"Unknown",t=new Date(a.createdAt).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"});return`On ${t}, ${e} wrote:
${a.preview||""}`},[a]),eB=(0,s.useMemo)(()=>{if(!a?.preview&&!a?.subject)return[];let e=`${a.subject||""} ${a.preview||""}`.toLowerCase(),t=[];return(e.includes("?")||e.includes("when")||e.includes("can you"))&&((e.includes("schedule")||e.includes("appointment")||e.includes("when"))&&t.push("Yes, I can schedule that. What time works best for you?"),(e.includes("price")||e.includes("cost")||e.includes("quote"))&&t.push("I'll prepare a quote and send it over shortly.")),(e.includes("thank")||e.includes("thanks"))&&t.push("You're welcome! Let me know if you need anything else."),(e.includes("urgent")||e.includes("asap"))&&t.push("I understand the urgency. I'm on it right now."),(e.includes("issue")||e.includes("problem")||e.includes("error"))&&(t.push("I'll look into this and get back to you shortly."),t.push("Can you provide more details about the issue?")),0===t.length&&(t.push("Thanks for reaching out. I'll get back to you shortly."),t.push("Got it, thanks for the update.")),t.slice(0,3)},[a]);return a?(0,t.jsx)(I.TooltipProvider,{children:(0,t.jsxs)("div",{className:(0,i.cn)("w-full overflow-hidden rounded-xl border border-border bg-background shadow-sm transition-all duration-200","focus-within:border-primary/50 focus-within:shadow-md",d),children:[(0,t.jsxs)("button",{type:"button",onClick:()=>f(!g),className:"flex w-full items-center justify-between gap-2 px-3 py-2 text-left hover:bg-muted/50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide shrink-0",children:"forward"===e?"Forward":"reply-all"===e?"Reply All":"Reply"}),(0,t.jsx)("span",{className:"text-sm text-foreground truncate",children:M.length>0?M.map(e=>e.name).join(", "):"Add recipients..."})]}),g?(0,t.jsx)(R.ChevronUp,{className:"h-4 w-4 text-muted-foreground shrink-0"}):(0,t.jsx)(P.ChevronDown,{className:"h-4 w-4 text-muted-foreground shrink-0"})]}),g&&(0,t.jsxs)("div",{className:"border-t border-border/50 px-3 py-2 space-y-2 bg-muted/30",children:[(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-muted-foreground w-12 pt-2",children:"To:"}),(0,t.jsxs)("div",{className:"flex-1 flex flex-wrap gap-1 items-center",children:[M.map(e=>(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-primary/10 text-primary text-xs rounded-full",children:[e.name,(0,t.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.email,void D(e=>e.filter(e=>e.email!==t))},className:"hover:text-destructive",children:(0,t.jsx)(C.X,{className:"h-3 w-3"})})]},e.id)),(0,t.jsx)("input",{type:"email",value:eo,onChange:e=>ed(e.target.value),onKeyDown:e=>{("Enter"===e.key||","===e.key)&&(e.preventDefault(),ez(eo.trim()))},onBlur:()=>ez(eo.trim()),placeholder:"Add email...",className:"flex-1 min-w-[120px] bg-transparent text-sm outline-none placeholder:text-muted-foreground"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 pt-1.5",children:[!ee&&(0,t.jsx)("button",{type:"button",onClick:()=>et(!0),className:"text-xs text-muted-foreground hover:text-foreground px-1.5 py-0.5 rounded hover:bg-muted transition-colors",children:"Cc"}),!es&&(0,t.jsx)("button",{type:"button",onClick:()=>ea(!0),className:"text-xs text-muted-foreground hover:text-foreground px-1.5 py-0.5 rounded hover:bg-muted transition-colors",children:"Bcc"})]})]}),ee&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-muted-foreground w-12",children:"Cc:"}),(0,t.jsx)("input",{type:"email",placeholder:"Add Cc recipients...",className:"flex-1 bg-transparent text-sm outline-none placeholder:text-muted-foreground"}),(0,t.jsx)("button",{type:"button",onClick:()=>{et(!1),Q([])},className:"text-xs text-muted-foreground hover:text-destructive",children:(0,t.jsx)(C.X,{className:"h-3 w-3"})})]}),es&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-muted-foreground w-12",children:"Bcc:"}),(0,t.jsx)("input",{type:"email",placeholder:"Add Bcc recipients...",className:"flex-1 bg-transparent text-sm outline-none placeholder:text-muted-foreground"}),(0,t.jsx)("button",{type:"button",onClick:()=>{ea(!1),Z([])},className:"text-xs text-muted-foreground hover:text-destructive",children:(0,t.jsx)(C.X,{className:"h-3 w-3"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-muted-foreground w-12",children:"Subject:"}),(0,t.jsx)("input",{type:"text",value:en,onChange:e=>er(e.target.value),placeholder:"Subject",className:"flex-1 bg-transparent text-sm outline-none placeholder:text-muted-foreground"})]})]}),eB.length>0&&!x&&(0,t.jsx)("div",{className:"px-3 py-2 border-b border-border/50",children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 flex-wrap",children:[(0,t.jsx)(_.Sparkles,{className:"h-3.5 w-3.5 text-muted-foreground shrink-0"}),eB.map((e,s)=>(0,t.jsx)("button",{type:"button",onClick:()=>{h(e),m.current?.focus()},className:"text-xs px-2.5 py-1 rounded-full border border-border bg-muted/50 hover:bg-muted hover:border-primary/50 transition-colors truncate max-w-[200px]",title:e,children:e.length>40?`${e.slice(0,40)}...`:e},s))]})}),(0,t.jsxs)("div",{className:"px-3 py-2",children:[(0,t.jsx)("textarea",{ref:m,value:x,onChange:e=>h(e.target.value),onInput:eN,onKeyDown:e=>{"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),eS())},placeholder:"Write your reply...",className:(0,i.cn)("w-full resize-none bg-transparent outline-none","text-sm","placeholder:text-muted-foreground","min-h-[80px] max-h-[200px]"),rows:3}),eb.value&&(0,t.jsxs)("div",{className:"mt-2 pt-2 border-t border-dashed border-border/50",children:[(0,t.jsxs)("div",{className:"text-xs text-muted-foreground mb-1 flex items-center justify-between",children:[(0,t.jsx)("span",{children:"Signature"}),(0,t.jsx)("button",{type:"button",onClick:()=>y("none"),className:"text-[10px] hover:text-foreground transition-colors",children:"Remove"})]}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:eb.value.trim()})]})]}),a.preview&&(0,t.jsxs)("div",{className:"px-3 pb-2",children:[(0,t.jsxs)("button",{type:"button",onClick:()=>k(!b),className:"text-xs text-muted-foreground hover:text-foreground flex items-center gap-1",children:[(0,t.jsx)(p.MoreHorizontal,{className:"h-3 w-3"}),b?"Hide":"Show"," quoted text"]}),b&&(0,t.jsx)("div",{className:"mt-2 pl-3 border-l-2 border-muted text-xs text-muted-foreground whitespace-pre-wrap max-h-[100px] overflow-y-auto",children:eI})]}),el.length>0&&(0,t.jsx)("div",{className:"px-3 py-2 border-t border-border/50 bg-muted/20",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:el.map(e=>{var s;return(0,t.jsxs)("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-background border rounded-md text-xs",children:[(0,t.jsx)(K,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{className:"max-w-[120px] truncate",children:e.filename}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:["(",(s=e.size)<1024?`${s} B`:s<1048576?`${(s/1024).toFixed(1)} KB`:`${(s/1048576).toFixed(1)} MB`,")"]}),(0,t.jsx)("button",{type:"button",onClick:()=>eT(e.filename),className:"ml-1 text-muted-foreground hover:text-destructive",children:(0,t.jsx)(C.X,{className:"h-3 w-3"})})]},e.filename)})})}),(0,t.jsx)("input",{ref:u,type:"file",multiple:!0,className:"hidden",onChange:eD,accept:"*/*"}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-1 border-t border-border/50 px-2 py-1.5 bg-muted/30",children:[(0,t.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,t.jsxs)(I.Tooltip,{children:[(0,t.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>u.current?.click(),children:(0,t.jsx)(K,{className:"h-4 w-4 text-muted-foreground"})})}),(0,t.jsx)(I.TooltipContent,{side:"top",children:"Attach file"})]}),(0,t.jsxs)(I.Tooltip,{children:[(0,t.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",children:(0,t.jsx)(F,{className:"h-4 w-4 text-muted-foreground"})})}),(0,t.jsx)(I.TooltipContent,{side:"top",children:"Insert image"})]}),(0,t.jsxs)(I.Tooltip,{children:[(0,t.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",children:(0,t.jsx)(E,{className:"h-4 w-4 text-muted-foreground"})})}),(0,t.jsx)(I.TooltipContent,{side:"top",children:"Insert link"})]}),(0,t.jsx)("div",{className:"w-px h-4 bg-border mx-1"}),(0,t.jsxs)(S.DropdownMenu,{children:[(0,t.jsx)(S.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(n.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 gap-1",children:[(0,t.jsx)(A,{className:"h-3.5 w-3.5 text-muted-foreground"}),(0,t.jsx)(P.ChevronDown,{className:"h-3 w-3 text-muted-foreground"})]})}),(0,t.jsxs)(S.DropdownMenuContent,{align:"start",className:"w-40",children:[(0,t.jsxs)(S.DropdownMenuItem,{children:[(0,t.jsx)(A,{className:"h-4 w-4 mr-2"})," Bold"]}),(0,t.jsxs)(S.DropdownMenuItem,{children:[(0,t.jsx)(U,{className:"h-4 w-4 mr-2"})," Italic"]}),(0,t.jsxs)(S.DropdownMenuItem,{children:[(0,t.jsx)(Y,{className:"h-4 w-4 mr-2"})," Underline"]}),(0,t.jsx)(S.DropdownMenuSeparator,{}),(0,t.jsxs)(S.DropdownMenuItem,{children:[(0,t.jsx)(H,{className:"h-4 w-4 mr-2"})," Bullet list"]}),(0,t.jsxs)(S.DropdownMenuItem,{children:[(0,t.jsx)(O,{className:"h-4 w-4 mr-2"})," Numbered list"]})]})]}),(0,t.jsxs)(S.DropdownMenu,{children:[(0,t.jsx)(S.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(n.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 gap-1",children:[(0,t.jsx)(_.Sparkles,{className:"h-3.5 w-3.5 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground hidden sm:inline",children:"Templates"})]})}),(0,t.jsxs)(S.DropdownMenuContent,{align:"start",className:"w-48",children:[W.map(e=>(0,t.jsx)(S.DropdownMenuItem,{onClick:()=>{var t;let s;return t=e.id,void((s=W.find(e=>e.id===t))&&h(s.body))},children:e.label},e.id)),(0,t.jsx)(S.DropdownMenuSeparator,{}),(0,t.jsxs)(S.DropdownMenuItem,{className:"text-muted-foreground text-xs",children:["Signature: ",eb.label]}),X.map(e=>(0,t.jsx)(S.DropdownMenuItem,{onClick:()=>y(e.id),className:(0,i.cn)("pl-6",v===e.id&&"font-medium text-primary"),children:e.label},e.id))]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsxs)(I.Tooltip,{children:[(0,t.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-muted-foreground hover:text-destructive",onClick:l,children:(0,t.jsx)(N.Trash2,{className:"h-4 w-4"})})}),(0,t.jsx)(I.TooltipContent,{side:"top",children:"Discard"})]}),eg?(0,t.jsx)(n.Button,{size:"sm",className:"h-7 px-3 gap-1.5 rounded-full bg-amber-500 hover:bg-amber-600",onClick:ek,children:(0,t.jsxs)("span",{className:"text-xs font-medium",children:["Undo (",ej,"s)"]})}):(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsxs)(n.Button,{size:"sm",className:"h-7 px-3 gap-1.5 rounded-l-full rounded-r-none",onClick:eS,disabled:j||!x.trim(),children:[j?(0,t.jsx)(q.Loader2,{className:"h-3.5 w-3.5 animate-spin"}):(0,t.jsx)(V.Send,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"text-xs font-medium",children:"Send"})]}),(0,t.jsxs)(T.Popover,{open:ec,onOpenChange:em,children:[(0,t.jsx)(T.PopoverTrigger,{asChild:!0,children:(0,t.jsx)(n.Button,{size:"sm",className:"h-7 px-1.5 rounded-l-none rounded-r-full border-l border-primary-foreground/20",disabled:j||!x.trim(),children:(0,t.jsx)(P.ChevronDown,{className:"h-3.5 w-3.5"})})}),(0,t.jsx)(T.PopoverContent,{className:"w-72 p-2",align:"end",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-muted-foreground px-2 py-1",children:"Schedule send"}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)(n.Button,{variant:"ghost",size:"sm",className:"w-full justify-start h-8 text-xs",onClick:()=>eM(eC("tomorrow_morning")),children:[(0,t.jsx)($.Clock,{className:"h-3.5 w-3.5 mr-2"}),"Tomorrow morning (8:00 AM)"]}),(0,t.jsxs)(n.Button,{variant:"ghost",size:"sm",className:"w-full justify-start h-8 text-xs",onClick:()=>eM(eC("tomorrow_afternoon")),children:[(0,t.jsx)($.Clock,{className:"h-3.5 w-3.5 mr-2"}),"Tomorrow afternoon (1:00 PM)"]}),(0,t.jsxs)(n.Button,{variant:"ghost",size:"sm",className:"w-full justify-start h-8 text-xs",onClick:()=>eM(eC("monday_morning")),children:[(0,t.jsx)(L.Calendar,{className:"h-3.5 w-3.5 mr-2"}),"Monday morning (8:00 AM)"]})]}),(0,t.jsxs)("div",{className:"border-t border-border pt-2",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-muted-foreground px-2 py-1",children:"Pick date & time"}),(0,t.jsxs)("div",{className:"flex gap-2 px-2",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(z.Label,{htmlFor:"schedule-date",className:"sr-only",children:"Date"}),(0,t.jsx)(r.Input,{id:"schedule-date",type:"date",value:eu,onChange:e=>ex(e.target.value),min:new Date().toISOString().split("T")[0],className:"h-8 text-xs"})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(z.Label,{htmlFor:"schedule-time",className:"sr-only",children:"Time"}),(0,t.jsx)(r.Input,{id:"schedule-time",type:"time",value:eh,onChange:e=>ep(e.target.value),className:"h-8 text-xs"})]})]}),(0,t.jsxs)(n.Button,{size:"sm",className:"w-full mt-2 h-8 text-xs",onClick:()=>{eu&&eh?eM(new Date(`${eu}T${eh}`)):c.error("Please select both date and time")},disabled:!eu||!eh,children:[(0,t.jsx)($.Clock,{className:"h-3.5 w-3.5 mr-2"}),"Schedule"]})]})]})})]})]})]})]}),(0,t.jsx)("div",{className:"px-3 pb-1.5 text-[10px] text-muted-foreground/60 text-right",children:"Cmd/Ctrl + Enter to send"})]})}):null}var Q=e.i(61199);function J({className:e,children:s,...a}){return(0,t.jsxs)(Q.Root,{className:(0,i.cn)("relative overflow-hidden",e),"data-slot":"scroll-area",...a,children:[(0,t.jsx)(Q.Viewport,{className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1","data-slot":"scroll-area-viewport",children:s}),(0,t.jsx)(Z,{}),(0,t.jsx)(Q.Corner,{})]})}function Z({className:e,orientation:s="vertical",...a}){return(0,t.jsx)(Q.ScrollAreaScrollbar,{className:(0,i.cn)("flex touch-none p-px transition-colors select-none","vertical"===s&&"h-full w-2.5 border-l border-l-transparent","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent",e),"data-slot":"scroll-area-scrollbar",orientation:s,...a,children:(0,t.jsx)(Q.ScrollAreaThumb,{className:"bg-border relative flex-1 rounded-full","data-slot":"scroll-area-thumb"})})}var ee=e.i(30902),et=e.i(87122);function es(e){return(0,et.constructFrom)(e,Date.now())}var ea=e.i(3882),en=e.i(98279),er=e.i(79254);let el=(0,m.default)("check-check",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);var ei=e.i(18796),eo=e.i(14435);function ed(e){var t;let s=new Date(e);return(0,ea.isSameDay)((0,et.constructFrom)(s,s),es(s))?"Today":(0,ea.isSameDay)((0,et.constructFrom)(s,s),(t=es(s),(0,en.addDays)(t,-1,void 0)))?"Yesterday":(0,ee.format)(s,"EEEE, MMMM d")}function ec({message:e,isFirst:s,isLast:n,showAvatar:r}){let l="outbound"===e.direction;return(0,t.jsxs)("div",{className:(0,i.cn)("flex gap-2",l?"flex-row-reverse":"flex-row",!s&&"mt-0.5"),children:[!l&&(0,t.jsx)("div",{className:"w-7 shrink-0",children:r&&(0,t.jsx)(a.Avatar,{className:"size-7",children:(0,t.jsx)(a.AvatarFallback,{className:"bg-muted text-[10px]",children:e.senderName?.charAt(0)||"?"})})}),(0,t.jsx)("div",{className:(0,i.cn)("max-w-[75%] px-3 py-2 text-sm",l?"bg-primary text-primary-foreground":"bg-muted text-foreground",s&&n&&"rounded-2xl",s&&!n&&(l?"rounded-2xl rounded-br-md":"rounded-2xl rounded-bl-md"),!s&&!n&&(l?"rounded-2xl rounded-r-md":"rounded-2xl rounded-l-md"),!s&&n&&(l?"rounded-2xl rounded-tr-md":"rounded-2xl rounded-tl-md")),children:(0,t.jsx)("p",{className:"whitespace-pre-wrap break-words leading-relaxed",children:e.content})}),l&&(0,t.jsx)("div",{className:"w-7 shrink-0"})]})}function em({messages:e,showDateDivider:s,dateLabel:a}){let n,r=e[0]?.direction==="outbound",l=e[e.length-1];return(0,t.jsxs)("div",{className:"space-y-0.5",children:[s&&(0,t.jsx)("div",{className:"flex justify-center py-3",children:(0,t.jsx)("span",{className:"rounded-full bg-muted px-3 py-1 text-[10px] font-medium text-muted-foreground",children:a})}),e.map((s,a)=>(0,t.jsx)(ec,{message:s,isFirst:0===a,isLast:a===e.length-1,showAvatar:!r&&a===e.length-1},s.id)),(0,t.jsxs)("div",{className:(0,i.cn)("flex items-center gap-1 px-9 pt-1",r?"justify-end":"justify-start"),children:[(0,t.jsx)("span",{className:"text-[10px] text-muted-foreground",children:(n=new Date(l?.timestamp||""),(0,ee.format)(n,"h:mm a"))}),r&&function(e){switch(e){case"sending":return(0,t.jsx)($.Clock,{className:"size-3 text-muted-foreground"});case"sent":return(0,t.jsx)(er.Check,{className:"size-3 text-muted-foreground"});case"delivered":return(0,t.jsx)(el,{className:"size-3 text-muted-foreground"});case"read":return(0,t.jsx)(el,{className:"size-3 text-primary"});case"failed":return(0,t.jsx)(ei.AlertCircle,{className:"size-3 text-destructive"});default:return null}}(l?.status)]})]})}function eu(){return(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("div",{className:"w-7 shrink-0",children:(0,t.jsx)(a.Avatar,{className:"size-7",children:(0,t.jsx)(a.AvatarFallback,{className:"bg-muted text-[10px]",children:"..."})})}),(0,t.jsx)("div",{className:"rounded-2xl rounded-bl-md bg-muted px-4 py-3",children:(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)("span",{className:"size-2 animate-bounce rounded-full bg-muted-foreground/50 [animation-delay:-0.3s]"}),(0,t.jsx)("span",{className:"size-2 animate-bounce rounded-full bg-muted-foreground/50 [animation-delay:-0.15s]"}),(0,t.jsx)("span",{className:"size-2 animate-bounce rounded-full bg-muted-foreground/50"})]})})]})}function ex({conversation:e,className:n}){let r=(0,s.useRef)(null),o=(0,s.useRef)(null);(0,s.useEffect)(()=>{o.current?.scrollIntoView({behavior:"smooth"})},[e.messages.length,e.isTyping]);let d=[],m=[],u=null;return e.messages.forEach((t,s)=>{let a=new Date(t.timestamp),n=e.messages[s-1],r=!u||!(0,ea.isSameDay)(a,u);(!n||n.direction!==t.direction||a.getTime()-new Date(n.timestamp).getTime()>12e4||r)&&m.length>0&&(d.push({messages:m,showDateDivider:!u||!(0,ea.isSameDay)(new Date(m[0]?.timestamp||""),u),dateLabel:ed(m[0]?.timestamp||"")}),u=new Date(m[0]?.timestamp||""),m=[]),m.push(t)}),m.length>0&&d.push({messages:m,showDateDivider:!u||!(0,ea.isSameDay)(new Date(m[0]?.timestamp||""),u),dateLabel:ed(m[0]?.timestamp||"")}),(0,t.jsxs)("div",{className:(0,i.cn)("flex h-full flex-col",n),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 border-b border-border/50 bg-card px-4 py-3",children:[(0,t.jsx)(a.Avatar,{className:"size-10",children:(0,t.jsx)(a.AvatarFallback,{className:"bg-primary/10 text-primary",children:e.contactName.split(" ").map(e=>e[0]).join("").substring(0,2)})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h3",{className:"truncate font-semibold",children:e.contactName}),e.companyName&&(0,t.jsxs)(l.Badge,{variant:"outline",className:"shrink-0 gap-1 text-[10px]",children:[(0,t.jsx)(c.Building2,{className:"size-2.5"}),e.companyName]})]}),(0,t.jsx)("p",{className:"truncate text-xs text-muted-foreground",children:e.contactPhone})]})]}),(0,t.jsx)(J,{ref:r,className:"flex-1",children:(0,t.jsxs)("div",{className:"space-y-4 p-4",children:[0===d.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,t.jsx)("div",{className:"mb-3 rounded-full bg-muted p-4",children:(0,t.jsx)(eo.User,{className:"size-8 text-muted-foreground"})}),(0,t.jsx)("h4",{className:"font-medium",children:"No messages yet"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Start the conversation by sending a message below"})]}):d.map((e,s)=>(0,t.jsx)(em,{messages:e.messages,showDateDivider:e.showDateDivider,dateLabel:e.dateLabel},`group-${s}`)),e.isTyping&&(0,t.jsx)("div",{className:"pt-2",children:(0,t.jsx)(eu,{})}),(0,t.jsx)("div",{ref:o})]})})]})}var eh=e.i(7205);let ep=(0,m.default)("message-square-text",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}],["path",{d:"M7 11h10",key:"1twpyw"}],["path",{d:"M7 15h6",key:"d9of3u"}],["path",{d:"M7 7h8",key:"af5zfr"}]]),eg=(0,m.default)("smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),ef=[{id:"follow-up",label:"Follow Up",preview:"Service follow-up request",text:"Hi, just following up on our recent communication. Is there anything else I can help you with?"},{id:"thank-you",label:"Thank You",preview:"Thank you message",text:"Thank you for reaching out! We appreciate your business and are here to help."},{id:"escalated",label:"Escalated",preview:"Issue escalation notice",text:"I've escalated your issue to our senior support team. Someone will be in touch shortly."},{id:"resolved",label:"Issue Resolved",preview:"Resolution confirmation",text:"Great news - the issue has been resolved. Please let us know if you experience any further problems."}],ej=[{name:"Frequently Used",emojis:["ğŸ˜€","ğŸ˜‚","ğŸ˜","ğŸ¥°","ğŸ˜˜","ğŸ˜Š","ğŸ˜‰","ğŸ˜","ğŸ¤”","ğŸ˜","ğŸ‘","ğŸ‘‹","ğŸ™","â¤ï¸","âœ…","ğŸ‰"]},{name:"Smileys",emojis:["ğŸ˜€","ğŸ˜ƒ","ğŸ˜„","ğŸ˜","ğŸ˜†","ğŸ˜…","ğŸ¤£","ğŸ˜‚","ğŸ™‚","ğŸ˜‰","ğŸ˜Š","ğŸ˜‡","ğŸ¥°","ğŸ˜","ğŸ˜˜","ğŸ˜—"]},{name:"Gestures",emojis:["ğŸ‘‹","ğŸ¤š","ğŸ–","âœ‹","ğŸ‘Œ","ğŸ¤","âœŒï¸","ğŸ¤","ğŸ¤Ÿ","ğŸ¤˜","ğŸ¤™","ğŸ‘ˆ","ğŸ‘‰","ğŸ‘","ğŸ‘","âœŠ"]},{name:"Symbols",emojis:["â¤ï¸","ğŸ§¡","ğŸ’›","ğŸ’š","ğŸ’™","ğŸ’œ","ğŸ–¤","ğŸ¤","âœ…","âŒ","â­","ğŸŒŸ","ğŸ’¯","ğŸ”¥","ğŸ’ª","ğŸ™Œ"]}];function ew({value:e,onChange:a,onSend:r,sending:l=!1,disabled:o=!1,placeholder:d="Type a message..."}){let[c,m]=(0,s.useState)(!1),[u,x]=(0,s.useState)(!1),h=(0,s.useRef)(null),p=function(e){if(!e)return{segments:0,charsPerSegment:160,isUnicode:!1};let t=!/^[@Â£$Â¥Ã¨Ã©Ã¹Ã¬Ã²Ã‡\nÃ˜Ã¸\rÃ…Ã¥Î”_Î¦Î“Î›Î©Î Î¨Î£Î˜Î\x1B !"#Â¤%&'()*+,\-./0-9:;<=>?Â¡A-ZÃ„Ã–Ã‘Ü§Â¿a-zÃ¤Ã¶Ã±Ã¼Ã ]*$/.test(e),s=t?70:160,a=t?67:153;return e.length<=s?{segments:1,charsPerSegment:s,isUnicode:t}:{segments:Math.ceil(e.length/a),charsPerSegment:a,isUnicode:t}}(e),g=e.length>0&&(u||e.length>100);(0,s.useEffect)(()=>{h.current&&(h.current.style.height="auto",h.current.style.height=`${Math.min(h.current.scrollHeight,120)}px`)},[e]);let f=(0,s.useCallback)(t=>{let s=h.current;if(s){let n=s.selectionStart,r=s.selectionEnd;a(e.substring(0,n)+t+e.substring(r)),setTimeout(()=>{s.selectionStart=n+t.length,s.selectionEnd=n+t.length,s.focus()},0)}else a(e+t);m(!1)},[e,a]),j=(0,s.useCallback)(e=>{a(e.text),h.current?.focus()},[a]),w=(0,s.useCallback)(()=>{!e.trim()||l||o||r()},[e,l,o,r]),v=(0,s.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),w())},[w]);return(0,t.jsxs)("div",{className:"bg-card border-t border-border/50",children:[g&&(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2 px-3 pt-2 pb-1",children:[(0,t.jsxs)("span",{className:"text-[10px] text-muted-foreground",children:[e.length," chars"]}),(0,t.jsx)("span",{className:"text-[10px] text-muted-foreground",children:"Â·"}),(0,t.jsxs)("span",{className:(0,i.cn)("text-[10px] font-medium",p.segments>1?"text-amber-500":"text-muted-foreground"),children:[p.segments," segment",1!==p.segments?"s":""]}),p.isUnicode&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-[10px] text-muted-foreground",children:"Â·"}),(0,t.jsx)("span",{className:"text-[10px] text-amber-500",children:"Unicode"})]})]}),(0,t.jsxs)("div",{className:"flex items-end gap-1.5 p-2",children:[(0,t.jsxs)(S.DropdownMenu,{children:[(0,t.jsx)(S.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(n.Button,{type:"button",variant:"ghost",size:"icon",className:"mb-0.5 size-10 md:size-8 shrink-0 rounded-full hover:bg-muted",disabled:o,title:"Quick replies",children:(0,t.jsx)(ep,{className:"size-5 md:size-4 text-muted-foreground"})})}),(0,t.jsxs)(S.DropdownMenuContent,{align:"start",side:"top",className:"w-56",children:[(0,t.jsx)("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground",children:"Quick Replies"}),ef.map(e=>(0,t.jsxs)(S.DropdownMenuItem,{onClick:()=>j(e),className:"flex-col items-start gap-0.5",children:[(0,t.jsx)("span",{className:"font-medium",children:e.label}),(0,t.jsx)("span",{className:"line-clamp-1 text-xs text-muted-foreground",children:e.preview})]},e.id))]})]}),(0,t.jsx)("div",{className:"relative min-w-0 flex-1",children:(0,t.jsxs)("div",{className:(0,i.cn)("flex w-full items-center overflow-y-auto rounded-[18px] border border-border bg-muted/50 pl-3 pr-1 py-1 transition-colors","min-h-[44px] md:min-h-[36px] max-h-[120px]","focus-within:border-primary/30 focus-within:bg-background focus-within:ring-1 focus-within:ring-primary/20",(o||l)&&"cursor-not-allowed opacity-50"),children:[(0,t.jsx)("textarea",{ref:h,value:e,onChange:e=>a(e.target.value),onKeyDown:v,onFocus:()=>x(!0),onBlur:()=>x(!1),placeholder:d,disabled:o||l,rows:1,className:(0,i.cn)("w-full min-w-0 resize-none bg-transparent py-1 leading-5 outline-none","text-base md:text-sm","placeholder:text-muted-foreground/60",(o||l)&&"pointer-events-none")}),(0,t.jsxs)("div",{className:"flex shrink-0 items-center gap-0.5 pl-1",children:[(0,t.jsxs)(T.Popover,{open:c,onOpenChange:m,children:[(0,t.jsx)(T.PopoverTrigger,{asChild:!0,children:(0,t.jsx)("button",{type:"button",className:(0,i.cn)("flex size-9 md:size-7 items-center justify-center rounded-full transition-colors","hover:bg-muted/80",c&&"bg-muted"),disabled:o,title:"Add emoji",children:(0,t.jsx)(eg,{className:"size-5 md:size-4 text-muted-foreground"})})}),(0,t.jsx)(T.PopoverContent,{side:"top",align:"end",className:"w-[300px] p-0",children:(0,t.jsx)(J,{className:"h-[220px]",children:(0,t.jsx)("div",{className:"p-2",children:ej.map((e,s)=>(0,t.jsxs)("div",{className:s>0?"mt-3":"",children:[(0,t.jsx)("h4",{className:"mb-1.5 px-1 text-[10px] font-semibold uppercase tracking-wider text-muted-foreground",children:e.name}),(0,t.jsx)("div",{className:"grid grid-cols-8 gap-0.5",children:e.emojis.map((e,s)=>(0,t.jsx)("button",{type:"button",className:"flex size-8 items-center justify-center rounded-lg text-lg transition-colors hover:bg-muted",onClick:()=>f(e),children:e},`${e}-${s}`))})]},e.name))})})})]}),(0,t.jsx)("button",{type:"button",onClick:w,disabled:!e.trim()||l||o,className:(0,i.cn)("flex size-9 md:size-7 items-center justify-center rounded-full transition-all duration-200",e.trim()?"bg-primary hover:bg-primary/90 scale-100 active:scale-95":"bg-muted/50 scale-90"),children:l?(0,t.jsx)(q.Loader2,{className:(0,i.cn)("size-5 md:size-4 animate-spin",e.trim()?"text-primary-foreground":"text-muted-foreground")}):(0,t.jsx)(eh.ArrowUp,{className:(0,i.cn)("size-5 md:size-4",e.trim()?"text-primary-foreground":"text-muted-foreground")})})]})]})})]})]})}let ev=(0,e.i(99168).create)((e,t)=>({activeFilter:"all",setActiveFilter:t=>e({activeFilter:t}),selectedMessageId:null,setSelectedMessageId:t=>e({selectedMessageId:t}),isDetailView:!1,setIsDetailView:t=>e({isDetailView:t}),activeThreadId:null,setActiveThreadId:t=>e({activeThreadId:t}),composer:{isOpen:!1,type:null,mode:"new"},openComposer:(t,s="new",a)=>{e({composer:{isOpen:!0,type:t,mode:s,context:a}})},closeComposer:()=>e({composer:{isOpen:!1,type:null,mode:"new"}}),replyMode:null,setReplyMode:t=>e({replyMode:t}),pendingMessages:{},addPendingMessage:t=>e(e=>{let s=e.pendingMessages[t.conversationId]??[];return{pendingMessages:{...e.pendingMessages,[t.conversationId]:[...s,t]}}}),resolvePendingMessage:(t,s,a)=>e(e=>{let n=(e.pendingMessages[t]??[]).filter(e=>e.id!==s);return a&&n.push(a),{pendingMessages:n.length>0?{...e.pendingMessages,[t]:n}:Object.fromEntries(Object.entries(e.pendingMessages).filter(([e])=>e!==t))}}),resetPendingMessages:t=>e(e=>e.pendingMessages[t]?{pendingMessages:Object.fromEntries(Object.entries(e.pendingMessages).filter(([e])=>e!==t))}:{pendingMessages:e.pendingMessages}),undoSend:{messageId:null,timeoutId:null,secondsRemaining:5},setUndoSend:(t,s=null)=>e({undoSend:{messageId:t,timeoutId:s,secondsRemaining:5}}),decrementUndoTimer:()=>e(e=>({undoSend:{...e.undoSend,secondsRemaining:Math.max(0,e.undoSend.secondsRemaining-1)}})),cancelUndoSend:()=>{let{undoSend:s}=t();s.timeoutId&&clearTimeout(s.timeoutId),e({undoSend:{messageId:null,timeoutId:null,secondsRemaining:5}})}}));function ey({communication:e,onMessageSent:a,className:n}){let r,[l,o]=(0,s.useState)(""),[d,c]=(0,s.useTransition)(),[m,u]=(0,s.useState)([]),{addPendingMessage:x,resolvePendingMessage:h}=ev(),p=(r=[{id:e.id,direction:e.direction,content:e.preview||"",timestamp:e.createdAt,status:"outbound"===e.direction?"delivered":void 0,senderName:"inbound"===e.direction?e.userName:"You"}],{id:e.id,contactName:e.userName||e.from||"Unknown",contactPhone:"inbound"===e.direction?e.from||"":e.to||"",companyName:e.companyName,companyId:e.companyId,messages:r,isTyping:!1}),g={...p,messages:[...p.messages,...m]},f=(0,s.useCallback)(()=>{if(!l.trim()||d)return;let t=`temp_${Date.now()}`,s={id:t,direction:"outbound",content:l.trim(),timestamp:new Date().toISOString(),status:"sending",senderName:"You"};u(e=>[...e,s]),o(""),x({id:t,conversationId:e.id,direction:"outbound",content:s.content,timestamp:s.timestamp,status:"sending",contactName:g.contactName,contactPhone:g.contactPhone,companyId:e.companyId}),c(async()=>{try{await new Promise(e=>setTimeout(e,1e3)),u(e=>e.map(e=>e.id===t?{...e,status:"sent"}:e)),await new Promise(e=>setTimeout(e,500)),u(e=>e.map(e=>e.id===t?{...e,status:"delivered"}:e)),h(e.id,t),a?.(s)}catch{u(e=>e.map(e=>e.id===t?{...e,status:"failed"}:e))}})},[l,d,e.id,g.contactName,g.contactPhone,e.companyId,x,h,a]);return(0,t.jsxs)("div",{className:(0,i.cn)("flex h-full flex-col",n),children:[(0,t.jsx)("div",{className:"min-h-0 flex-1",children:(0,t.jsx)(ex,{conversation:g})}),(0,t.jsx)(ew,{value:l,onChange:o,onSend:f,sending:d,placeholder:`Message ${g.contactName}...`})]})}let eb={email:{icon:x.Mail,color:"text-blue-500",bg:"bg-blue-500/10",label:"Email"},sms:{icon:h.MessageSquare,color:"text-green-500",bg:"bg-green-500/10",label:"SMS"},call:{icon:g.Phone,color:"text-purple-500",bg:"bg-purple-500/10",label:"Call"},voicemail:{icon:k,color:"text-orange-500",bg:"bg-orange-500/10",label:"Voicemail"},ticket:{icon:b.Ticket,color:"text-amber-500",bg:"bg-amber-500/10",label:"Ticket"}},eN=[{type:"all",label:"All"},{type:"email",label:"Email"},{type:"sms",label:"SMS"},{type:"call",label:"Calls"},{type:"voicemail",label:"Voicemail"},{type:"ticket",label:"Tickets"}];function ek({communications:e,onRefresh:m}){let h,g,{toggleSidebar:b}=(0,D.useSidebar)(),[k,T]=(0,s.useState)(""),[z,I]=(0,s.useState)("all"),[B,A]=(0,s.useState)(null),[L,P]=(0,s.useState)(!1),[R,$]=(0,s.useState)(null),F=e.filter(e=>{if("all"!==z&&e.type!==z)return!1;if(k){let t=k.toLowerCase(),s=e.subject?.toLowerCase().includes(t),a=e.preview?.toLowerCase().includes(t),n=e.from?.toLowerCase().includes(t),r=e.to?.toLowerCase().includes(t),l=e.companyName?.toLowerCase().includes(t);return s||a||n||r||l}return!0}),U=e.reduce((e,t)=>(e[t.type]=(e[t.type]||0)+1,e),{}),E=(0,s.useCallback)(()=>{P(!0),m?.(),setTimeout(()=>P(!1),1e3)},[m]),H=(0,s.useCallback)(e=>{A(e),$(null)},[]),O=(0,s.useCallback)(()=>{A(null),$(null)},[]),q=(0,s.useCallback)(()=>{$(null)},[]),K=(0,s.useCallback)(()=>{$(null)},[]),V=e=>eb[e]||eb.email,_=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Y=!B;return(0,t.jsx)("div",{className:"flex h-full w-full flex-col overflow-hidden bg-sidebar",children:(0,t.jsxs)("div",{className:"flex flex-1 overflow-hidden min-h-0 md:gap-2",children:[(0,t.jsx)("div",{className:(0,i.cn)("bg-card mb-1 shadow-sm flex flex-col overflow-hidden","w-full h-full","md:w-[400px] lg:w-[480px] md:rounded-tr-2xl",Y?"flex":"hidden md:flex"),children:(0,t.jsxs)("div",{className:"w-full h-full flex flex-col",children:[(0,t.jsxs)("div",{className:"sticky top-0 z-15 flex flex-col gap-2 p-2 pb-0 transition-colors bg-card",children:[(0,t.jsx)("div",{className:"grid grid-cols-12 gap-2 mt-1",children:(0,t.jsxs)("div",{className:"col-span-12 flex gap-2",children:[(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:b,className:"h-10 w-10 p-0 md:h-8 md:w-8 shrink-0",title:"Toggle sidebar",children:(0,t.jsx)(M.default,{className:"h-5 w-5 md:h-4 md:w-4 text-muted-foreground"})}),(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(r.Input,{type:"search",placeholder:"Search communications...",value:k,onChange:e=>T(e.target.value),className:"h-10 md:h-8 pl-9 pr-8 text-base md:text-sm border-input bg-background"}),(0,t.jsx)(v.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),k&&(0,t.jsx)("button",{onClick:()=>T(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:(0,t.jsx)(C.X,{className:"h-3 w-3"})})]}),(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:E,disabled:L,className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"Refresh",children:(0,t.jsx)(f.RefreshCw,{className:`h-5 w-5 md:h-4 md:w-4 text-muted-foreground ${L?"animate-spin":""}`})})]})}),(0,t.jsx)("div",{className:"flex gap-1 overflow-x-auto pb-2 scrollbar-none",children:eN.map(({type:s,label:a})=>{let r="all"===s?e.length:U[s]||0;return(0,t.jsxs)(n.Button,{variant:z===s?"default":"ghost",size:"sm",onClick:()=>I(s),className:"h-7 gap-1 whitespace-nowrap text-xs shrink-0",children:[a,r>0&&(0,t.jsx)(l.Badge,{variant:z===s?"secondary":"outline",className:"ml-0.5 h-4 px-1 text-[10px]",children:r})]},s)})})]}),(0,t.jsx)("div",{className:(0,i.cn)("bg-primary relative z-5 h-0.5 w-full transition-opacity",L?"opacity-100 animate-pulse":"opacity-0")}),(0,t.jsx)("div",{className:"relative z-1 flex-1 overflow-y-auto pt-0 min-h-0",children:(0,t.jsx)("div",{className:"flex h-full w-full",children:(0,t.jsx)("div",{className:"flex flex-1 flex-col",children:F.length>0?(0,t.jsx)("div",{className:"min-h-[200px] px-2",children:F.map(e=>{let s=B?.id===e.id,r="unread"===e.status||"new"===e.status,l=V(e.type),d=l.icon;return(0,t.jsx)("div",{className:"select-none md:my-1",children:(0,t.jsxs)("div",{className:(0,i.cn)("hover:bg-accent group flex cursor-pointer flex-col items-start rounded-lg py-2 text-left text-sm transition-all hover:opacity-100 relative",s?"bg-accent opacity-100":"",r?"opacity-100":"opacity-60"),onClick:()=>H(e),children:[(0,t.jsxs)("div",{className:"absolute right-2 z-25 flex -translate-y-1/2 items-center gap-1 rounded-xl border bg-popover p-1 opacity-0 shadow-sm group-hover:opacity-100 top-[-1] transition-opacity duration-200",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 overflow-visible p-0 hover:bg-accent group/star",title:"Star",children:(0,t.jsx)(y,{className:"h-4 w-4 text-muted-foreground transition-colors group-hover/star:text-yellow-500"})}),(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:bg-accent group/archive",title:"Archive",children:(0,t.jsx)(o.Archive,{className:"h-4 w-4 text-muted-foreground transition-colors group-hover/archive:text-blue-500"})})]}),(0,t.jsxs)("div",{className:"relative flex w-full items-center justify-between gap-4 px-2",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(a.Avatar,{className:"h-8 w-8 shrink-0 rounded-full",children:(0,t.jsx)(a.AvatarFallback,{className:"bg-primary/10 text-primary font-bold text-xs",children:(e=>{if(!e)return"?";let t=e.split("@")[0];return t.includes(".")?t.split(".").map(e=>e[0]).join("").toUpperCase().slice(0,2):t.substring(0,2).toUpperCase()})("inbound"===e.direction?e.from:e.to)})}),(0,t.jsx)("div",{className:(0,i.cn)("absolute -bottom-1 -right-1 rounded-full p-0.5 border border-background",l.bg),children:(0,t.jsx)(d,{className:(0,i.cn)("h-2.5 w-2.5",l.color)})})]}),(0,t.jsx)("div",{className:"flex w-full justify-between",children:(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsxs)("div",{className:"flex w-full flex-row items-center justify-between",children:[(0,t.jsx)("div",{className:"flex flex-row items-center gap-[4px]",children:(0,t.jsx)("span",{className:"font-bold text-md flex items-baseline gap-1 group-hover:opacity-100",children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"line-clamp-1 overflow-hidden text-sm",children:"outbound"===e.direction?e.to||"Unknown recipient":e.from||"Unknown sender"}),r&&(0,t.jsx)("span",{className:"ml-0.5 size-2 rounded-full bg-primary"})]})})}),(0,t.jsx)("p",{className:"text-muted-foreground text-nowrap text-xs font-normal opacity-70 transition-opacity group-hover:opacity-100",children:_(e.createdAt)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center gap-2",children:[(0,t.jsx)("p",{className:"mt-1 line-clamp-1 min-w-0 overflow-hidden text-sm text-muted-foreground flex-1",children:e.subject||e.preview||"No content"}),e.companyName&&(0,t.jsxs)("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-muted text-muted-foreground flex items-center gap-0.5 shrink-0",children:[(0,t.jsx)(c.Building2,{className:"h-2.5 w-2.5"}),e.companyName]})]})]})})]})]})},e.id)})}):(0,t.jsx)("div",{className:"flex items-center justify-center p-8 h-full",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(x.Mail,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No communications found"}),k&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Try adjusting your search"})]})})})})})]})}),B?(0,t.jsx)("div",{className:(0,i.cn)("bg-card mb-1 shadow-sm flex flex-col min-w-0 overflow-hidden","w-full h-full","md:rounded-tl-2xl md:flex-1",B?"flex":"hidden md:flex"),children:(0,t.jsx)("div",{className:"relative flex-1 min-h-0 flex flex-col",children:(0,t.jsxs)("div",{className:"bg-card relative flex flex-col overflow-hidden transition-all duration-300 h-full flex-1 min-h-0",children:[(0,t.jsxs)("div",{className:"sticky top-0 z-15 flex shrink-0 items-center justify-between gap-1.5 p-2 pb-0 transition-colors bg-card",children:[(0,t.jsx)("div",{className:"flex flex-1 items-center gap-2",children:(0,t.jsxs)(n.Button,{variant:"ghost",size:"sm",onClick:O,className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"Back to list",children:[(0,t.jsx)(d.ArrowLeft,{className:"h-5 w-5 md:hidden text-muted-foreground"}),(0,t.jsx)(C.X,{className:"h-4 w-4 hidden md:block text-muted-foreground"})]})}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[("email"===B.type||"sms"===B.type||"ticket"===B.type)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.Button,{variant:"reply"===R?"default":"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-auto md:px-2",title:"Reply",onClick:()=>$("reply"===R?null:"reply"),children:[(0,t.jsx)(j,{className:"h-5 w-5 md:h-4 md:w-4 md:mr-1.5 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm leading-none font-medium hidden md:inline",children:"Reply"})]}),(0,t.jsxs)(S.DropdownMenu,{children:[(0,t.jsx)(S.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"More reply options",children:(0,t.jsx)(w,{className:"h-5 w-5 md:h-4 md:w-4 text-muted-foreground"})})}),(0,t.jsxs)(S.DropdownMenuContent,{align:"end",className:"w-40",children:[(0,t.jsxs)(S.DropdownMenuItem,{onClick:()=>$("reply"),children:[(0,t.jsx)(j,{className:"h-4 w-4 mr-2"}),"Reply"]}),(0,t.jsxs)(S.DropdownMenuItem,{onClick:()=>$("reply-all"),children:[(0,t.jsx)(w,{className:"h-4 w-4 mr-2"}),"Reply All"]}),(0,t.jsx)(S.DropdownMenuSeparator,{}),(0,t.jsxs)(S.DropdownMenuItem,{onClick:()=>$("forward"),children:[(0,t.jsx)(u,{className:"h-4 w-4 mr-2"}),"Forward"]})]})]})]}),(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8 group/star",title:"Star",children:(0,t.jsx)(y,{className:"h-5 w-5 md:h-4 md:w-4 text-muted-foreground transition-colors group-hover/star:text-yellow-500"})}),(0,t.jsx)(n.Button,{variant:"destructive",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"Archive",children:(0,t.jsx)(o.Archive,{className:"h-5 w-5 md:h-4 md:w-4"})}),(0,t.jsxs)(S.DropdownMenu,{children:[(0,t.jsx)(S.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 md:h-8 md:w-8",title:"More",children:(0,t.jsx)(p.MoreHorizontal,{className:"h-5 w-5 md:h-4 md:w-4 text-muted-foreground"})})}),(0,t.jsx)(S.DropdownMenuContent,{align:"end",className:"w-48",children:(0,t.jsxs)(S.DropdownMenuItem,{className:"text-destructive focus:text-destructive",children:[(0,t.jsx)(N.Trash2,{className:"h-4 w-4 mr-2"}),"Delete"]})})]})]})]}),(0,t.jsx)("div",{className:"flex min-h-0 flex-1 flex-col overflow-y-auto",children:"sms"===B.type?(0,t.jsx)(ey,{communication:B,className:"flex-1"}):(0,t.jsxs)("div",{className:"relative overflow-hidden flex-1 h-full min-h-0 flex flex-col",children:[(0,t.jsxs)("div",{className:"border-b border-border/50 px-4 py-4 space-y-3",children:[(0,t.jsx)("h1",{className:"text-base font-semibold text-foreground",children:B.subject||"No Subject"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(a.Avatar,{className:"h-9 w-9 shrink-0 rounded-md cursor-pointer",children:(0,t.jsx)(a.AvatarFallback,{className:"bg-muted text-muted-foreground font-semibold text-sm rounded-md",children:("inbound"===B.direction?B.from?.[0]:B.to?.[0])?.toUpperCase()||"?"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-semibold text-sm text-foreground",children:"inbound"===B.direction?B.from||"Unknown":B.to||"Unknown"}),("unread"===B.status||"new"===B.status)&&(0,t.jsx)("div",{className:"h-2 w-2 rounded-full bg-primary"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)("span",{children:"inbound"===B.direction?`from ${B.from?.split("@")[0]||"unknown"}`:`to ${B.to?.split("@")[0]||"unknown"}`}),B.companyName&&(0,t.jsxs)(l.Badge,{variant:"outline",className:"gap-1",children:[(0,t.jsx)(c.Building2,{className:"h-2.5 w-2.5"}),B.companyName]})]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:[(h=new Date(B.createdAt),0===(g=Math.floor((new Date().getTime()-h.getTime())/864e5))?"Today":1===g?"Yesterday":g<7?h.toLocaleDateString([],{weekday:"short"}):h.toLocaleDateString([],{month:"short",day:"numeric"}))," at"," ",_(B.createdAt)]})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[B.type&&(0,t.jsx)(l.Badge,{variant:"outline",className:"gap-1",children:V(B.type).label}),B.status&&(0,t.jsx)(l.Badge,{variant:"outline",className:"gap-1",children:B.status})]})]}),(0,t.jsx)("div",{className:"flex-1 px-4 py-4 overflow-y-auto",children:(0,t.jsx)("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:(0,t.jsx)("p",{className:"whitespace-pre-wrap",children:B.preview||"No content"})})}),R&&("email"===B.type||"ticket"===B.type)&&(0,t.jsx)("div",{className:"border-t border-border/50 p-4",children:(0,t.jsx)(G,{mode:R,selectedMessage:B,onClose:q,onSent:K})})]})})]})})}):(0,t.jsxs)("div",{className:(0,i.cn)("bg-card mb-1 shadow-sm hidden md:flex md:flex-col md:items-center md:justify-center md:rounded-tl-2xl md:flex-1"),children:[(0,t.jsx)(x.Mail,{className:"h-16 w-16 text-muted-foreground mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"No communication selected"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select a communication from the list to view details"})]})]})})}e.s(["AdminUnifiedInbox",()=>ek],68511)}]);