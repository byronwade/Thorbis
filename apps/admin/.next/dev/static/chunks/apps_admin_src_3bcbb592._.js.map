{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/admin/src/lib/stores/campaign-store.ts"],"sourcesContent":["/**\n * Email Campaign Store - Zustand state management\n *\n * Manages campaign state for the admin marketing panel:\n * - Campaign list with filtering/sorting\n * - Selected campaign for detail view\n * - Campaign builder wizard state\n * - Sending progress tracking\n * - Audience preview state\n */\n\nimport { create } from \"zustand\";\nimport type {\n\tEmailCampaign,\n\tEmailCampaignStatus,\n\tEmailCampaignAudienceType,\n\tCampaignDraft,\n\tCampaignBuilderStep,\n\tAudienceFilter,\n\tWaitlistStats,\n} from \"@/types/campaigns\";\n\n// ============================================================================\n// Filter & Sort Types\n// ============================================================================\n\ntype CampaignSortField = \"name\" | \"status\" | \"createdAt\" | \"scheduledFor\" | \"sentAt\" | \"openRate\" | \"clickRate\";\ntype SortDirection = \"asc\" | \"desc\";\n\ntype CampaignFilters = {\n\tstatus?: EmailCampaignStatus[];\n\taudienceType?: EmailCampaignAudienceType[];\n\tdateRange?: {\n\t\tstart: string;\n\t\tend: string;\n\t};\n\tsearch?: string;\n\ttags?: string[];\n};\n\n// ============================================================================\n// Builder State Types\n// ============================================================================\n\ntype BuilderState = {\n\tisOpen: boolean;\n\tcurrentStep: CampaignBuilderStep;\n\tdraft: CampaignDraft;\n\teditingCampaignId?: string;\n\tisDirty: boolean;\n\tvalidationErrors: Record<string, string>;\n};\n\nconst defaultDraft: CampaignDraft = {\n\tname: \"\",\n\tsubject: \"\",\n\tpreviewText: \"\",\n\taudienceType: \"waitlist\",\n\taudienceFilter: {\n\t\texcludeUnsubscribed: true,\n\t\texcludeBounced: true,\n\t\texcludeComplained: true,\n\t},\n\tfromName: \"Thorbis\",\n\tfromEmail: \"noreply@thorbis.com\",\n\ttags: [],\n};\n\n// ============================================================================\n// Sending State Types\n// ============================================================================\n\ntype SendingProgress = {\n\tcampaignId: string;\n\tstatus: \"preparing\" | \"sending\" | \"completed\" | \"failed\" | \"cancelled\";\n\ttotalRecipients: number;\n\tsentCount: number;\n\tfailedCount: number;\n\tstartedAt: string;\n\testimatedCompletionTime?: string;\n\terrorMessage?: string;\n};\n\n// ============================================================================\n// Audience Preview Types\n// ============================================================================\n\ntype AudiencePreview = {\n\tisLoading: boolean;\n\testimatedCount: number;\n\tsampleRecipients: {\n\t\temail: string;\n\t\tname?: string;\n\t\ttype: string;\n\t}[];\n\tlastUpdated?: string;\n};\n\n// ============================================================================\n// Store Type Definition\n// ============================================================================\n\ntype CampaignStore = {\n\t// -------------------------------------------------------------------------\n\t// Campaign List State\n\t// -------------------------------------------------------------------------\n\tcampaigns: EmailCampaign[];\n\tsetCampaigns: (campaigns: EmailCampaign[]) => void;\n\taddCampaign: (campaign: EmailCampaign) => void;\n\tupdateCampaign: (id: string, updates: Partial<EmailCampaign>) => void;\n\tremoveCampaign: (id: string) => void;\n\n\t// List loading state\n\tisLoading: boolean;\n\tsetIsLoading: (loading: boolean) => void;\n\terror: string | null;\n\tsetError: (error: string | null) => void;\n\n\t// -------------------------------------------------------------------------\n\t// Selection State\n\t// -------------------------------------------------------------------------\n\tselectedCampaignId: string | null;\n\tsetSelectedCampaignId: (id: string | null) => void;\n\n\t// -------------------------------------------------------------------------\n\t// Filters & Sorting\n\t// -------------------------------------------------------------------------\n\tfilters: CampaignFilters;\n\tsetFilters: (filters: Partial<CampaignFilters>) => void;\n\tresetFilters: () => void;\n\n\tsortField: CampaignSortField;\n\tsortDirection: SortDirection;\n\tsetSort: (field: CampaignSortField, direction?: SortDirection) => void;\n\n\t// -------------------------------------------------------------------------\n\t// Campaign Builder State\n\t// -------------------------------------------------------------------------\n\tbuilder: BuilderState;\n\topenBuilder: (campaignId?: string) => void;\n\tcloseBuilder: () => void;\n\tsetBuilderStep: (step: CampaignBuilderStep) => void;\n\tupdateDraft: (updates: Partial<CampaignDraft>) => void;\n\tsetValidationErrors: (errors: Record<string, string>) => void;\n\tclearValidationError: (field: string) => void;\n\tresetBuilder: () => void;\n\n\t// -------------------------------------------------------------------------\n\t// Audience Preview State\n\t// -------------------------------------------------------------------------\n\taudiencePreview: AudiencePreview;\n\tsetAudiencePreview: (preview: Partial<AudiencePreview>) => void;\n\tresetAudiencePreview: () => void;\n\n\t// -------------------------------------------------------------------------\n\t// Sending Progress State\n\t// -------------------------------------------------------------------------\n\tsendingProgress: SendingProgress | null;\n\tsetSendingProgress: (progress: SendingProgress | null) => void;\n\tupdateSendingProgress: (updates: Partial<SendingProgress>) => void;\n\n\t// -------------------------------------------------------------------------\n\t// Waitlist Stats (for dashboard)\n\t// -------------------------------------------------------------------------\n\twaitlistStats: WaitlistStats | null;\n\tsetWaitlistStats: (stats: WaitlistStats | null) => void;\n\n\t// -------------------------------------------------------------------------\n\t// UI State\n\t// -------------------------------------------------------------------------\n\tactiveTab: \"campaigns\" | \"templates\" | \"segments\" | \"settings\";\n\tsetActiveTab: (tab: \"campaigns\" | \"templates\" | \"segments\" | \"settings\") => void;\n\n\t// Preview modal\n\tpreviewCampaignId: string | null;\n\tsetPreviewCampaignId: (id: string | null) => void;\n\n\t// Delete confirmation\n\tdeletingCampaignId: string | null;\n\tsetDeletingCampaignId: (id: string | null) => void;\n};\n\n// ============================================================================\n// Store Implementation\n// ============================================================================\n\nexport const useCampaignStore = create<CampaignStore>((set, get) => ({\n\t// -------------------------------------------------------------------------\n\t// Campaign List State\n\t// -------------------------------------------------------------------------\n\tcampaigns: [],\n\tsetCampaigns: (campaigns) => set({ campaigns }),\n\taddCampaign: (campaign) =>\n\t\tset((state) => ({\n\t\t\tcampaigns: [campaign, ...state.campaigns],\n\t\t})),\n\tupdateCampaign: (id, updates) =>\n\t\tset((state) => ({\n\t\t\tcampaigns: state.campaigns.map((c) => (c.id === id ? { ...c, ...updates } : c)),\n\t\t})),\n\tremoveCampaign: (id) =>\n\t\tset((state) => ({\n\t\t\tcampaigns: state.campaigns.filter((c) => c.id !== id),\n\t\t\tselectedCampaignId: state.selectedCampaignId === id ? null : state.selectedCampaignId,\n\t\t})),\n\n\tisLoading: false,\n\tsetIsLoading: (isLoading) => set({ isLoading }),\n\terror: null,\n\tsetError: (error) => set({ error }),\n\n\t// -------------------------------------------------------------------------\n\t// Selection State\n\t// -------------------------------------------------------------------------\n\tselectedCampaignId: null,\n\tsetSelectedCampaignId: (id) => set({ selectedCampaignId: id }),\n\n\t// -------------------------------------------------------------------------\n\t// Filters & Sorting\n\t// -------------------------------------------------------------------------\n\tfilters: {},\n\tsetFilters: (filters) =>\n\t\tset((state) => ({\n\t\t\tfilters: { ...state.filters, ...filters },\n\t\t})),\n\tresetFilters: () => set({ filters: {} }),\n\n\tsortField: \"createdAt\",\n\tsortDirection: \"desc\",\n\tsetSort: (field, direction) =>\n\t\tset((state) => ({\n\t\t\tsortField: field,\n\t\t\tsortDirection: direction ?? (state.sortField === field && state.sortDirection === \"asc\" ? \"desc\" : \"asc\"),\n\t\t})),\n\n\t// -------------------------------------------------------------------------\n\t// Campaign Builder State\n\t// -------------------------------------------------------------------------\n\tbuilder: {\n\t\tisOpen: false,\n\t\tcurrentStep: \"details\",\n\t\tdraft: { ...defaultDraft },\n\t\tisDirty: false,\n\t\tvalidationErrors: {},\n\t},\n\topenBuilder: (campaignId) => {\n\t\tconst { campaigns } = get();\n\t\tconst existingCampaign = campaignId ? campaigns.find((c) => c.id === campaignId) : null;\n\n\t\tif (existingCampaign) {\n\t\t\t// Load existing campaign into draft\n\t\t\tset({\n\t\t\t\tbuilder: {\n\t\t\t\t\tisOpen: true,\n\t\t\t\t\tcurrentStep: \"details\",\n\t\t\t\t\teditingCampaignId: campaignId,\n\t\t\t\t\tisDirty: false,\n\t\t\t\t\tvalidationErrors: {},\n\t\t\t\t\tdraft: {\n\t\t\t\t\t\tname: existingCampaign.name,\n\t\t\t\t\t\tsubject: existingCampaign.subject,\n\t\t\t\t\t\tpreviewText: existingCampaign.previewText || \"\",\n\t\t\t\t\t\ttemplateId: existingCampaign.templateId,\n\t\t\t\t\t\ttemplateData: existingCampaign.templateData,\n\t\t\t\t\t\thtmlContent: existingCampaign.htmlContent,\n\t\t\t\t\t\tplainTextContent: existingCampaign.plainTextContent,\n\t\t\t\t\t\taudienceType: existingCampaign.audienceType,\n\t\t\t\t\t\taudienceFilter: existingCampaign.audienceFilter || defaultDraft.audienceFilter,\n\t\t\t\t\t\tfromName: existingCampaign.fromName,\n\t\t\t\t\t\tfromEmail: existingCampaign.fromEmail,\n\t\t\t\t\t\treplyTo: existingCampaign.replyTo,\n\t\t\t\t\t\ttags: existingCampaign.tags,\n\t\t\t\t\t\tnotes: existingCampaign.notes,\n\t\t\t\t\t\tscheduledFor: existingCampaign.scheduledFor,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t} else {\n\t\t\t// New campaign\n\t\t\tset({\n\t\t\t\tbuilder: {\n\t\t\t\t\tisOpen: true,\n\t\t\t\t\tcurrentStep: \"details\",\n\t\t\t\t\tdraft: { ...defaultDraft },\n\t\t\t\t\tisDirty: false,\n\t\t\t\t\tvalidationErrors: {},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t},\n\tcloseBuilder: () =>\n\t\tset({\n\t\t\tbuilder: {\n\t\t\t\tisOpen: false,\n\t\t\t\tcurrentStep: \"details\",\n\t\t\t\tdraft: { ...defaultDraft },\n\t\t\t\tisDirty: false,\n\t\t\t\tvalidationErrors: {},\n\t\t\t},\n\t\t}),\n\tsetBuilderStep: (step) =>\n\t\tset((state) => ({\n\t\t\tbuilder: { ...state.builder, currentStep: step },\n\t\t})),\n\tupdateDraft: (updates) =>\n\t\tset((state) => ({\n\t\t\tbuilder: {\n\t\t\t\t...state.builder,\n\t\t\t\tdraft: { ...state.builder.draft, ...updates },\n\t\t\t\tisDirty: true,\n\t\t\t},\n\t\t})),\n\tsetValidationErrors: (errors) =>\n\t\tset((state) => ({\n\t\t\tbuilder: { ...state.builder, validationErrors: errors },\n\t\t})),\n\tclearValidationError: (field) =>\n\t\tset((state) => {\n\t\t\tconst { [field]: _, ...rest } = state.builder.validationErrors;\n\t\t\treturn {\n\t\t\t\tbuilder: { ...state.builder, validationErrors: rest },\n\t\t\t};\n\t\t}),\n\tresetBuilder: () =>\n\t\tset({\n\t\t\tbuilder: {\n\t\t\t\tisOpen: false,\n\t\t\t\tcurrentStep: \"details\",\n\t\t\t\tdraft: { ...defaultDraft },\n\t\t\t\tisDirty: false,\n\t\t\t\tvalidationErrors: {},\n\t\t\t},\n\t\t}),\n\n\t// -------------------------------------------------------------------------\n\t// Audience Preview State\n\t// -------------------------------------------------------------------------\n\taudiencePreview: {\n\t\tisLoading: false,\n\t\testimatedCount: 0,\n\t\tsampleRecipients: [],\n\t},\n\tsetAudiencePreview: (preview) =>\n\t\tset((state) => ({\n\t\t\taudiencePreview: { ...state.audiencePreview, ...preview },\n\t\t})),\n\tresetAudiencePreview: () =>\n\t\tset({\n\t\t\taudiencePreview: {\n\t\t\t\tisLoading: false,\n\t\t\t\testimatedCount: 0,\n\t\t\t\tsampleRecipients: [],\n\t\t\t},\n\t\t}),\n\n\t// -------------------------------------------------------------------------\n\t// Sending Progress State\n\t// -------------------------------------------------------------------------\n\tsendingProgress: null,\n\tsetSendingProgress: (progress) => set({ sendingProgress: progress }),\n\tupdateSendingProgress: (updates) =>\n\t\tset((state) => ({\n\t\t\tsendingProgress: state.sendingProgress ? { ...state.sendingProgress, ...updates } : null,\n\t\t})),\n\n\t// -------------------------------------------------------------------------\n\t// Waitlist Stats\n\t// -------------------------------------------------------------------------\n\twaitlistStats: null,\n\tsetWaitlistStats: (stats) => set({ waitlistStats: stats }),\n\n\t// -------------------------------------------------------------------------\n\t// UI State\n\t// -------------------------------------------------------------------------\n\tactiveTab: \"campaigns\",\n\tsetActiveTab: (tab) => set({ activeTab: tab }),\n\n\tpreviewCampaignId: null,\n\tsetPreviewCampaignId: (id) => set({ previewCampaignId: id }),\n\n\tdeletingCampaignId: null,\n\tsetDeletingCampaignId: (id) => set({ deletingCampaignId: id }),\n}));\n\n// ============================================================================\n// Selector Hooks (for optimized re-renders)\n// ============================================================================\n\n/** Get filtered and sorted campaigns */\nexport const useFilteredCampaigns = () => {\n\treturn useCampaignStore((state) => {\n\t\tlet filtered = [...state.campaigns];\n\n\t\t// Apply filters\n\t\tif (state.filters.status?.length) {\n\t\t\tfiltered = filtered.filter((c) => state.filters.status!.includes(c.status));\n\t\t}\n\t\tif (state.filters.audienceType?.length) {\n\t\t\tfiltered = filtered.filter((c) => state.filters.audienceType!.includes(c.audienceType));\n\t\t}\n\t\tif (state.filters.search) {\n\t\t\tconst search = state.filters.search.toLowerCase();\n\t\t\tfiltered = filtered.filter(\n\t\t\t\t(c) => c.name.toLowerCase().includes(search) || c.subject.toLowerCase().includes(search) || c.tags.some((t) => t.toLowerCase().includes(search))\n\t\t\t);\n\t\t}\n\t\tif (state.filters.tags?.length) {\n\t\t\tfiltered = filtered.filter((c) => state.filters.tags!.some((t) => c.tags.includes(t)));\n\t\t}\n\t\tif (state.filters.dateRange) {\n\t\t\tconst { start, end } = state.filters.dateRange;\n\t\t\tfiltered = filtered.filter((c) => {\n\t\t\t\tconst date = new Date(c.createdAt);\n\t\t\t\treturn date >= new Date(start) && date <= new Date(end);\n\t\t\t});\n\t\t}\n\n\t\t// Apply sorting\n\t\tfiltered.sort((a, b) => {\n\t\t\tlet aVal: string | number | undefined;\n\t\t\tlet bVal: string | number | undefined;\n\n\t\t\tswitch (state.sortField) {\n\t\t\t\tcase \"name\":\n\t\t\t\t\taVal = a.name.toLowerCase();\n\t\t\t\t\tbVal = b.name.toLowerCase();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"status\":\n\t\t\t\t\taVal = a.status;\n\t\t\t\t\tbVal = b.status;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"createdAt\":\n\t\t\t\t\taVal = a.createdAt;\n\t\t\t\t\tbVal = b.createdAt;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"scheduledFor\":\n\t\t\t\t\taVal = a.scheduledFor || \"\";\n\t\t\t\t\tbVal = b.scheduledFor || \"\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"sentAt\":\n\t\t\t\t\taVal = a.sentAt || \"\";\n\t\t\t\t\tbVal = b.sentAt || \"\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"openRate\":\n\t\t\t\t\taVal = a.totalRecipients > 0 ? a.uniqueOpens / a.totalRecipients : 0;\n\t\t\t\t\tbVal = b.totalRecipients > 0 ? b.uniqueOpens / b.totalRecipients : 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"clickRate\":\n\t\t\t\t\taVal = a.totalRecipients > 0 ? a.uniqueClicks / a.totalRecipients : 0;\n\t\t\t\t\tbVal = b.totalRecipients > 0 ? b.uniqueClicks / b.totalRecipients : 0;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\taVal = a.createdAt;\n\t\t\t\t\tbVal = b.createdAt;\n\t\t\t}\n\n\t\t\tif (aVal === undefined || bVal === undefined) return 0;\n\t\t\tif (aVal < bVal) return state.sortDirection === \"asc\" ? -1 : 1;\n\t\t\tif (aVal > bVal) return state.sortDirection === \"asc\" ? 1 : -1;\n\t\t\treturn 0;\n\t\t});\n\n\t\treturn filtered;\n\t});\n};\n\n/** Get selected campaign */\nexport const useSelectedCampaign = () => {\n\treturn useCampaignStore((state) => (state.selectedCampaignId ? state.campaigns.find((c) => c.id === state.selectedCampaignId) || null : null));\n};\n\n/** Get campaign stats summary */\nexport const useCampaignStats = () => {\n\treturn useCampaignStore((state) => {\n\t\tconst campaigns = state.campaigns;\n\t\treturn {\n\t\t\ttotal: campaigns.length,\n\t\t\tdraft: campaigns.filter((c) => c.status === \"draft\").length,\n\t\t\tscheduled: campaigns.filter((c) => c.status === \"scheduled\").length,\n\t\t\tsending: campaigns.filter((c) => c.status === \"sending\").length,\n\t\t\tsent: campaigns.filter((c) => c.status === \"sent\").length,\n\t\t\ttotalRecipients: campaigns.reduce((sum, c) => sum + c.totalRecipients, 0),\n\t\t\ttotalOpens: campaigns.reduce((sum, c) => sum + c.uniqueOpens, 0),\n\t\t\ttotalClicks: campaigns.reduce((sum, c) => sum + c.uniqueClicks, 0),\n\t\t\ttotalRevenue: campaigns.reduce((sum, c) => sum + c.revenueAttributed, 0),\n\t\t};\n\t});\n};\n\n/** Check if builder has unsaved changes */\nexport const useBuilderIsDirty = () => {\n\treturn useCampaignStore((state) => state.builder.isDirty);\n};\n"],"names":[],"mappings":"AAAA;;;;;;;;;CASC;;;;;;;;;;;;AAED;;;AA0CA,MAAM,eAA8B;IACnC,MAAM;IACN,SAAS;IACT,aAAa;IACb,cAAc;IACd,gBAAgB;QACf,qBAAqB;QACrB,gBAAgB;QAChB,mBAAmB;IACpB;IACA,UAAU;IACV,WAAW;IACX,MAAM,EAAE;AACT;AAwHO,MAAM,mBAAmB,IAAA,+VAAM,EAAgB,CAAC,KAAK,MAAQ,CAAC;QACpE,4EAA4E;QAC5E,sBAAsB;QACtB,4EAA4E;QAC5E,WAAW,EAAE;QACb,cAAc,CAAC,YAAc,IAAI;gBAAE;YAAU;QAC7C,aAAa,CAAC,WACb,IAAI,CAAC,QAAU,CAAC;oBACf,WAAW;wBAAC;2BAAa,MAAM,SAAS;qBAAC;gBAC1C,CAAC;QACF,gBAAgB,CAAC,IAAI,UACpB,IAAI,CAAC,QAAU,CAAC;oBACf,WAAW,MAAM,SAAS,CAAC,GAAG,CAAC,CAAC,IAAO,EAAE,EAAE,KAAK,KAAK;4BAAE,GAAG,CAAC;4BAAE,GAAG,OAAO;wBAAC,IAAI;gBAC7E,CAAC;QACF,gBAAgB,CAAC,KAChB,IAAI,CAAC,QAAU,CAAC;oBACf,WAAW,MAAM,SAAS,CAAC,MAAM,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;oBAClD,oBAAoB,MAAM,kBAAkB,KAAK,KAAK,OAAO,MAAM,kBAAkB;gBACtF,CAAC;QAEF,WAAW;QACX,cAAc,CAAC,YAAc,IAAI;gBAAE;YAAU;QAC7C,OAAO;QACP,UAAU,CAAC,QAAU,IAAI;gBAAE;YAAM;QAEjC,4EAA4E;QAC5E,kBAAkB;QAClB,4EAA4E;QAC5E,oBAAoB;QACpB,uBAAuB,CAAC,KAAO,IAAI;gBAAE,oBAAoB;YAAG;QAE5D,4EAA4E;QAC5E,oBAAoB;QACpB,4EAA4E;QAC5E,SAAS,CAAC;QACV,YAAY,CAAC,UACZ,IAAI,CAAC,QAAU,CAAC;oBACf,SAAS;wBAAE,GAAG,MAAM,OAAO;wBAAE,GAAG,OAAO;oBAAC;gBACzC,CAAC;QACF,cAAc,IAAM,IAAI;gBAAE,SAAS,CAAC;YAAE;QAEtC,WAAW;QACX,eAAe;QACf,SAAS,CAAC,OAAO,YAChB,IAAI,CAAC,QAAU,CAAC;oBACf,WAAW;oBACX,eAAe,aAAa,CAAC,MAAM,SAAS,KAAK,SAAS,MAAM,aAAa,KAAK,QAAQ,SAAS,KAAK;gBACzG,CAAC;QAEF,4EAA4E;QAC5E,yBAAyB;QACzB,4EAA4E;QAC5E,SAAS;YACR,QAAQ;YACR,aAAa;YACb,OAAO;gBAAE,GAAG,YAAY;YAAC;YACzB,SAAS;YACT,kBAAkB,CAAC;QACpB;QACA,aAAa,CAAC;YACb,MAAM,EAAE,SAAS,EAAE,GAAG;YACtB,MAAM,mBAAmB,aAAa,UAAU,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,cAAc;YAEnF,IAAI,kBAAkB;gBACrB,oCAAoC;gBACpC,IAAI;oBACH,SAAS;wBACR,QAAQ;wBACR,aAAa;wBACb,mBAAmB;wBACnB,SAAS;wBACT,kBAAkB,CAAC;wBACnB,OAAO;4BACN,MAAM,iBAAiB,IAAI;4BAC3B,SAAS,iBAAiB,OAAO;4BACjC,aAAa,iBAAiB,WAAW,IAAI;4BAC7C,YAAY,iBAAiB,UAAU;4BACvC,cAAc,iBAAiB,YAAY;4BAC3C,aAAa,iBAAiB,WAAW;4BACzC,kBAAkB,iBAAiB,gBAAgB;4BACnD,cAAc,iBAAiB,YAAY;4BAC3C,gBAAgB,iBAAiB,cAAc,IAAI,aAAa,cAAc;4BAC9E,UAAU,iBAAiB,QAAQ;4BACnC,WAAW,iBAAiB,SAAS;4BACrC,SAAS,iBAAiB,OAAO;4BACjC,MAAM,iBAAiB,IAAI;4BAC3B,OAAO,iBAAiB,KAAK;4BAC7B,cAAc,iBAAiB,YAAY;wBAC5C;oBACD;gBACD;YACD,OAAO;gBACN,eAAe;gBACf,IAAI;oBACH,SAAS;wBACR,QAAQ;wBACR,aAAa;wBACb,OAAO;4BAAE,GAAG,YAAY;wBAAC;wBACzB,SAAS;wBACT,kBAAkB,CAAC;oBACpB;gBACD;YACD;QACD;QACA,cAAc,IACb,IAAI;gBACH,SAAS;oBACR,QAAQ;oBACR,aAAa;oBACb,OAAO;wBAAE,GAAG,YAAY;oBAAC;oBACzB,SAAS;oBACT,kBAAkB,CAAC;gBACpB;YACD;QACD,gBAAgB,CAAC,OAChB,IAAI,CAAC,QAAU,CAAC;oBACf,SAAS;wBAAE,GAAG,MAAM,OAAO;wBAAE,aAAa;oBAAK;gBAChD,CAAC;QACF,aAAa,CAAC,UACb,IAAI,CAAC,QAAU,CAAC;oBACf,SAAS;wBACR,GAAG,MAAM,OAAO;wBAChB,OAAO;4BAAE,GAAG,MAAM,OAAO,CAAC,KAAK;4BAAE,GAAG,OAAO;wBAAC;wBAC5C,SAAS;oBACV;gBACD,CAAC;QACF,qBAAqB,CAAC,SACrB,IAAI,CAAC,QAAU,CAAC;oBACf,SAAS;wBAAE,GAAG,MAAM,OAAO;wBAAE,kBAAkB;oBAAO;gBACvD,CAAC;QACF,sBAAsB,CAAC,QACtB,IAAI,CAAC;gBACJ,MAAM,EAAE,CAAC,MAAM,EAAE,CAAC,EAAE,GAAG,MAAM,GAAG,MAAM,OAAO,CAAC,gBAAgB;gBAC9D,OAAO;oBACN,SAAS;wBAAE,GAAG,MAAM,OAAO;wBAAE,kBAAkB;oBAAK;gBACrD;YACD;QACD,cAAc,IACb,IAAI;gBACH,SAAS;oBACR,QAAQ;oBACR,aAAa;oBACb,OAAO;wBAAE,GAAG,YAAY;oBAAC;oBACzB,SAAS;oBACT,kBAAkB,CAAC;gBACpB;YACD;QAED,4EAA4E;QAC5E,yBAAyB;QACzB,4EAA4E;QAC5E,iBAAiB;YAChB,WAAW;YACX,gBAAgB;YAChB,kBAAkB,EAAE;QACrB;QACA,oBAAoB,CAAC,UACpB,IAAI,CAAC,QAAU,CAAC;oBACf,iBAAiB;wBAAE,GAAG,MAAM,eAAe;wBAAE,GAAG,OAAO;oBAAC;gBACzD,CAAC;QACF,sBAAsB,IACrB,IAAI;gBACH,iBAAiB;oBAChB,WAAW;oBACX,gBAAgB;oBAChB,kBAAkB,EAAE;gBACrB;YACD;QAED,4EAA4E;QAC5E,yBAAyB;QACzB,4EAA4E;QAC5E,iBAAiB;QACjB,oBAAoB,CAAC,WAAa,IAAI;gBAAE,iBAAiB;YAAS;QAClE,uBAAuB,CAAC,UACvB,IAAI,CAAC,QAAU,CAAC;oBACf,iBAAiB,MAAM,eAAe,GAAG;wBAAE,GAAG,MAAM,eAAe;wBAAE,GAAG,OAAO;oBAAC,IAAI;gBACrF,CAAC;QAEF,4EAA4E;QAC5E,iBAAiB;QACjB,4EAA4E;QAC5E,eAAe;QACf,kBAAkB,CAAC,QAAU,IAAI;gBAAE,eAAe;YAAM;QAExD,4EAA4E;QAC5E,WAAW;QACX,4EAA4E;QAC5E,WAAW;QACX,cAAc,CAAC,MAAQ,IAAI;gBAAE,WAAW;YAAI;QAE5C,mBAAmB;QACnB,sBAAsB,CAAC,KAAO,IAAI;gBAAE,mBAAmB;YAAG;QAE1D,oBAAoB;QACpB,uBAAuB,CAAC,KAAO,IAAI;gBAAE,oBAAoB;YAAG;IAC7D,CAAC;AAOM,MAAM,uBAAuB;;IACnC,OAAO;iDAAiB,CAAC;YACxB,IAAI,WAAW;mBAAI,MAAM,SAAS;aAAC;YAEnC,gBAAgB;YAChB,IAAI,MAAM,OAAO,CAAC,MAAM,EAAE,QAAQ;gBACjC,WAAW,SAAS,MAAM;6DAAC,CAAC,IAAM,MAAM,OAAO,CAAC,MAAM,CAAE,QAAQ,CAAC,EAAE,MAAM;;YAC1E;YACA,IAAI,MAAM,OAAO,CAAC,YAAY,EAAE,QAAQ;gBACvC,WAAW,SAAS,MAAM;6DAAC,CAAC,IAAM,MAAM,OAAO,CAAC,YAAY,CAAE,QAAQ,CAAC,EAAE,YAAY;;YACtF;YACA,IAAI,MAAM,OAAO,CAAC,MAAM,EAAE;gBACzB,MAAM,SAAS,MAAM,OAAO,CAAC,MAAM,CAAC,WAAW;gBAC/C,WAAW,SAAS,MAAM;6DACzB,CAAC,IAAM,EAAE,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC,WAAW,EAAE,OAAO,CAAC,WAAW,GAAG,QAAQ,CAAC,WAAW,EAAE,IAAI,CAAC,IAAI;qEAAC,CAAC,IAAM,EAAE,WAAW,GAAG,QAAQ,CAAC;;;YAE1I;YACA,IAAI,MAAM,OAAO,CAAC,IAAI,EAAE,QAAQ;gBAC/B,WAAW,SAAS,MAAM;6DAAC,CAAC,IAAM,MAAM,OAAO,CAAC,IAAI,CAAE,IAAI;qEAAC,CAAC,IAAM,EAAE,IAAI,CAAC,QAAQ,CAAC;;;YACnF;YACA,IAAI,MAAM,OAAO,CAAC,SAAS,EAAE;gBAC5B,MAAM,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,MAAM,OAAO,CAAC,SAAS;gBAC9C,WAAW,SAAS,MAAM;6DAAC,CAAC;wBAC3B,MAAM,OAAO,IAAI,KAAK,EAAE,SAAS;wBACjC,OAAO,QAAQ,IAAI,KAAK,UAAU,QAAQ,IAAI,KAAK;oBACpD;;YACD;YAEA,gBAAgB;YAChB,SAAS,IAAI;yDAAC,CAAC,GAAG;oBACjB,IAAI;oBACJ,IAAI;oBAEJ,OAAQ,MAAM,SAAS;wBACtB,KAAK;4BACJ,OAAO,EAAE,IAAI,CAAC,WAAW;4BACzB,OAAO,EAAE,IAAI,CAAC,WAAW;4BACzB;wBACD,KAAK;4BACJ,OAAO,EAAE,MAAM;4BACf,OAAO,EAAE,MAAM;4BACf;wBACD,KAAK;4BACJ,OAAO,EAAE,SAAS;4BAClB,OAAO,EAAE,SAAS;4BAClB;wBACD,KAAK;4BACJ,OAAO,EAAE,YAAY,IAAI;4BACzB,OAAO,EAAE,YAAY,IAAI;4BACzB;wBACD,KAAK;4BACJ,OAAO,EAAE,MAAM,IAAI;4BACnB,OAAO,EAAE,MAAM,IAAI;4BACnB;wBACD,KAAK;4BACJ,OAAO,EAAE,eAAe,GAAG,IAAI,EAAE,WAAW,GAAG,EAAE,eAAe,GAAG;4BACnE,OAAO,EAAE,eAAe,GAAG,IAAI,EAAE,WAAW,GAAG,EAAE,eAAe,GAAG;4BACnE;wBACD,KAAK;4BACJ,OAAO,EAAE,eAAe,GAAG,IAAI,EAAE,YAAY,GAAG,EAAE,eAAe,GAAG;4BACpE,OAAO,EAAE,eAAe,GAAG,IAAI,EAAE,YAAY,GAAG,EAAE,eAAe,GAAG;4BACpE;wBACD;4BACC,OAAO,EAAE,SAAS;4BAClB,OAAO,EAAE,SAAS;oBACpB;oBAEA,IAAI,SAAS,aAAa,SAAS,WAAW,OAAO;oBACrD,IAAI,OAAO,MAAM,OAAO,MAAM,aAAa,KAAK,QAAQ,CAAC,IAAI;oBAC7D,IAAI,OAAO,MAAM,OAAO,MAAM,aAAa,KAAK,QAAQ,IAAI,CAAC;oBAC7D,OAAO;gBACR;;YAEA,OAAO;QACR;;AACD;GA3Ea;;QACL;;;AA6ED,MAAM,sBAAsB;;IAClC,OAAO;gDAAiB,CAAC,QAAW,MAAM,kBAAkB,GAAG,MAAM,SAAS,CAAC,IAAI;wDAAC,CAAC,IAAM,EAAE,EAAE,KAAK,MAAM,kBAAkB;0DAAK,OAAO;;AACzI;IAFa;;QACL;;;AAID,MAAM,mBAAmB;;IAC/B,OAAO;6CAAiB,CAAC;YACxB,MAAM,YAAY,MAAM,SAAS;YACjC,OAAO;gBACN,OAAO,UAAU,MAAM;gBACvB,OAAO,UAAU,MAAM;yDAAC,CAAC,IAAM,EAAE,MAAM,KAAK;wDAAS,MAAM;gBAC3D,WAAW,UAAU,MAAM;yDAAC,CAAC,IAAM,EAAE,MAAM,KAAK;wDAAa,MAAM;gBACnE,SAAS,UAAU,MAAM;yDAAC,CAAC,IAAM,EAAE,MAAM,KAAK;wDAAW,MAAM;gBAC/D,MAAM,UAAU,MAAM;yDAAC,CAAC,IAAM,EAAE,MAAM,KAAK;wDAAQ,MAAM;gBACzD,iBAAiB,UAAU,MAAM;yDAAC,CAAC,KAAK,IAAM,MAAM,EAAE,eAAe;wDAAE;gBACvE,YAAY,UAAU,MAAM;yDAAC,CAAC,KAAK,IAAM,MAAM,EAAE,WAAW;wDAAE;gBAC9D,aAAa,UAAU,MAAM;yDAAC,CAAC,KAAK,IAAM,MAAM,EAAE,YAAY;wDAAE;gBAChE,cAAc,UAAU,MAAM;yDAAC,CAAC,KAAK,IAAM,MAAM,EAAE,iBAAiB;wDAAE;YACvE;QACD;;AACD;IAfa;;QACL;;;AAiBD,MAAM,oBAAoB;;IAChC,OAAO;8CAAiB,CAAC,QAAU,MAAM,OAAO,CAAC,OAAO;;AACzD;IAFa;;QACL","debugId":null}},
    {"offset": {"line": 434, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/admin/src/components/ui/checkbox.tsx"],"sourcesContent":["// Re-export from @stratos/ui package\nexport * from \"@stratos/ui\";\n"],"names":[],"mappings":"AAAA,qCAAqC;;AACrC","debugId":null}},
    {"offset": {"line": 445, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/admin/src/components/marketing/audience-selector.tsx"],"sourcesContent":["\"use client\";\n\n/**\n * Audience Selector Component\n *\n * Allows selection of campaign audience type and filters.\n * Used in the campaign builder for targeting recipients.\n */\n\nimport { useState, useEffect } from \"react\";\nimport {\n\tBuilding2,\n\tCheck,\n\tClock,\n\tFilter,\n\tMail,\n\tUsers,\n\tLoader2,\n} from \"lucide-react\";\nimport { Button, Label, cn } from \"@stratos/ui\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport type { EmailCampaignAudienceType, AudienceFilter } from \"@/types/campaigns\";\nimport { useCampaignStore } from \"@/lib/stores/campaign-store\";\n\ntype AudienceSelectorProps = {\n\tvalue: EmailCampaignAudienceType;\n\tfilter?: AudienceFilter;\n\tonChange: (type: EmailCampaignAudienceType, filter: AudienceFilter) => void;\n\terror?: string;\n};\n\ntype AudienceOption = {\n\tid: EmailCampaignAudienceType;\n\tlabel: string;\n\tdescription: string;\n\ticon: typeof Users;\n\ticonColor: string;\n\tbgColor: string;\n};\n\nconst AUDIENCE_OPTIONS: AudienceOption[] = [\n\t{\n\t\tid: \"waitlist\",\n\t\tlabel: \"Waitlist Subscribers\",\n\t\tdescription: \"Send to everyone who signed up for the waitlist\",\n\t\ticon: Clock,\n\t\ticonColor: \"text-emerald-600\",\n\t\tbgColor: \"bg-emerald-500/10\",\n\t},\n\t{\n\t\tid: \"all_users\",\n\t\tlabel: \"All Platform Users\",\n\t\tdescription: \"Send to all registered users across all companies\",\n\t\ticon: Users,\n\t\ticonColor: \"text-blue-600\",\n\t\tbgColor: \"bg-blue-500/10\",\n\t},\n\t{\n\t\tid: \"all_companies\",\n\t\tlabel: \"All Companies\",\n\t\tdescription: \"Send to company owners/admins only\",\n\t\ticon: Building2,\n\t\ticonColor: \"text-purple-600\",\n\t\tbgColor: \"bg-purple-500/10\",\n\t},\n\t{\n\t\tid: \"segment\",\n\t\tlabel: \"Custom Segment\",\n\t\tdescription: \"Filter users or companies by specific criteria\",\n\t\ticon: Filter,\n\t\ticonColor: \"text-amber-600\",\n\t\tbgColor: \"bg-amber-500/10\",\n\t},\n\t{\n\t\tid: \"custom\",\n\t\tlabel: \"Custom Email List\",\n\t\tdescription: \"Enter specific email addresses manually\",\n\t\ticon: Mail,\n\t\ticonColor: \"text-gray-600\",\n\t\tbgColor: \"bg-gray-500/10\",\n\t},\n];\n\nexport function AudienceSelector({ value, filter, onChange, error }: AudienceSelectorProps) {\n\tconst [localFilter, setLocalFilter] = useState<AudienceFilter>(\n\t\tfilter || {\n\t\t\texcludeUnsubscribed: true,\n\t\t\texcludeBounced: true,\n\t\t\texcludeComplained: true,\n\t\t}\n\t);\n\tconst [customEmails, setCustomEmails] = useState<string>(\n\t\tfilter?.customEmails?.join(\"\\n\") || \"\"\n\t);\n\n\tconst { audiencePreview, setAudiencePreview } = useCampaignStore();\n\n\t// Simulate fetching audience count when selection changes\n\tuseEffect(() => {\n\t\tsetAudiencePreview({ isLoading: true });\n\n\t\t// Simulate API call\n\t\tconst timer = setTimeout(() => {\n\t\t\tconst counts: Record<EmailCampaignAudienceType, number> = {\n\t\t\t\twaitlist: 2156,\n\t\t\t\tall_users: 8432,\n\t\t\t\tall_companies: 342,\n\t\t\t\tsegment: 0,\n\t\t\t\tcustom: customEmails.split(\"\\n\").filter((e) => e.trim()).length,\n\t\t\t};\n\n\t\t\tsetAudiencePreview({\n\t\t\t\tisLoading: false,\n\t\t\t\testimatedCount: counts[value] || 0,\n\t\t\t\tsampleRecipients: [\n\t\t\t\t\t{ email: \"john@example.com\", name: \"John Doe\", type: value },\n\t\t\t\t\t{ email: \"jane@example.com\", name: \"Jane Smith\", type: value },\n\t\t\t\t\t{ email: \"mike@example.com\", name: \"Mike Johnson\", type: value },\n\t\t\t\t],\n\t\t\t\tlastUpdated: new Date().toISOString(),\n\t\t\t});\n\t\t}, 500);\n\n\t\treturn () => clearTimeout(timer);\n\t}, [value, customEmails, setAudiencePreview]);\n\n\tconst handleTypeChange = (type: EmailCampaignAudienceType) => {\n\t\tonChange(type, localFilter);\n\t};\n\n\tconst handleFilterChange = (updates: Partial<AudienceFilter>) => {\n\t\tconst newFilter = { ...localFilter, ...updates };\n\t\tsetLocalFilter(newFilter);\n\t\tonChange(value, newFilter);\n\t};\n\n\tconst handleCustomEmailsChange = (emails: string) => {\n\t\tsetCustomEmails(emails);\n\t\tconst emailList = emails\n\t\t\t.split(\"\\n\")\n\t\t\t.map((e) => e.trim())\n\t\t\t.filter((e) => e && e.includes(\"@\"));\n\t\thandleFilterChange({ customEmails: emailList });\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t{/* Audience Type Selection */}\n\t\t\t<div className=\"grid gap-3\">\n\t\t\t\t{AUDIENCE_OPTIONS.map((option) => {\n\t\t\t\t\tconst isSelected = value === option.id;\n\t\t\t\t\tconst Icon = option.icon;\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tkey={option.id}\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\"flex items-start gap-4 rounded-lg border p-4 text-left transition-colors\",\n\t\t\t\t\t\t\t\tisSelected\n\t\t\t\t\t\t\t\t\t? \"border-primary bg-primary/5 ring-1 ring-primary\"\n\t\t\t\t\t\t\t\t\t: \"hover:border-primary/50 hover:bg-muted/50\"\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\tonClick={() => handleTypeChange(option.id)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div className={cn(\"rounded-lg p-2\", option.bgColor)}>\n\t\t\t\t\t\t\t\t<Icon className={cn(\"size-5\", option.iconColor)} />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<p className=\"font-medium\">{option.label}</p>\n\t\t\t\t\t\t\t\t\t{isSelected && (\n\t\t\t\t\t\t\t\t\t\t<div className=\"rounded-full bg-primary p-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t<Check className=\"size-3 text-primary-foreground\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">{option.description}</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t);\n\t\t\t\t})}\n\t\t\t</div>\n\n\t\t\t{error && <p className=\"text-sm text-destructive\">{error}</p>}\n\n\t\t\t{/* Filter Options for Segment */}\n\t\t\t{value === \"segment\" && (\n\t\t\t\t<div className=\"rounded-lg border p-4 space-y-4\">\n\t\t\t\t\t<h4 className=\"font-medium\">Segment Filters</h4>\n\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t{/* User Roles */}\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label className=\"text-sm\">User Roles</Label>\n\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\n\t\t\t\t\t\t\t\t{([\"owner\", \"admin\", \"manager\", \"technician\"] as const).map((role) => (\n\t\t\t\t\t\t\t\t\t<label\n\t\t\t\t\t\t\t\t\t\tkey={role}\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center gap-2 rounded border px-3 py-1.5 text-sm cursor-pointer hover:bg-muted\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Checkbox\n\t\t\t\t\t\t\t\t\t\t\tchecked={localFilter.userRoles?.includes(role) || false}\n\t\t\t\t\t\t\t\t\t\t\tonCheckedChange={(checked) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst currentRoles = localFilter.userRoles || [];\n\t\t\t\t\t\t\t\t\t\t\t\tconst newRoles = checked\n\t\t\t\t\t\t\t\t\t\t\t\t\t? [...currentRoles, role]\n\t\t\t\t\t\t\t\t\t\t\t\t\t: currentRoles.filter((r) => r !== role);\n\t\t\t\t\t\t\t\t\t\t\t\thandleFilterChange({ userRoles: newRoles.length > 0 ? newRoles : undefined });\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<span className=\"capitalize\">{role}</span>\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* Company Plans */}\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label className=\"text-sm\">Company Plans</Label>\n\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\n\t\t\t\t\t\t\t\t{([\"starter\", \"professional\", \"enterprise\"] as const).map((plan) => (\n\t\t\t\t\t\t\t\t\t<label\n\t\t\t\t\t\t\t\t\t\tkey={plan}\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center gap-2 rounded border px-3 py-1.5 text-sm cursor-pointer hover:bg-muted\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Checkbox\n\t\t\t\t\t\t\t\t\t\t\tchecked={localFilter.companyPlans?.includes(plan) || false}\n\t\t\t\t\t\t\t\t\t\t\tonCheckedChange={(checked) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst currentPlans = localFilter.companyPlans || [];\n\t\t\t\t\t\t\t\t\t\t\t\tconst newPlans = checked\n\t\t\t\t\t\t\t\t\t\t\t\t\t? [...currentPlans, plan]\n\t\t\t\t\t\t\t\t\t\t\t\t\t: currentPlans.filter((p) => p !== plan);\n\t\t\t\t\t\t\t\t\t\t\t\thandleFilterChange({ companyPlans: newPlans.length > 0 ? newPlans : undefined });\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<span className=\"capitalize\">{plan}</span>\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{/* Status Filters */}\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label className=\"text-sm\">Company Status</Label>\n\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\n\t\t\t\t\t\t\t\t{([\"active\", \"trial\", \"suspended\"] as const).map((status) => (\n\t\t\t\t\t\t\t\t\t<label\n\t\t\t\t\t\t\t\t\t\tkey={status}\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center gap-2 rounded border px-3 py-1.5 text-sm cursor-pointer hover:bg-muted\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Checkbox\n\t\t\t\t\t\t\t\t\t\t\tchecked={localFilter.companyStatuses?.includes(status) || false}\n\t\t\t\t\t\t\t\t\t\t\tonCheckedChange={(checked) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst currentStatuses = localFilter.companyStatuses || [];\n\t\t\t\t\t\t\t\t\t\t\t\tconst newStatuses = checked\n\t\t\t\t\t\t\t\t\t\t\t\t\t? [...currentStatuses, status]\n\t\t\t\t\t\t\t\t\t\t\t\t\t: currentStatuses.filter((s) => s !== status);\n\t\t\t\t\t\t\t\t\t\t\t\thandleFilterChange({ companyStatuses: newStatuses.length > 0 ? newStatuses : undefined });\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<span className=\"capitalize\">{status}</span>\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{/* Custom Email Input */}\n\t\t\t{value === \"custom\" && (\n\t\t\t\t<div className=\"rounded-lg border p-4 space-y-4\">\n\t\t\t\t\t<h4 className=\"font-medium\">Custom Email List</h4>\n\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\tEnter email addresses, one per line\n\t\t\t\t\t</p>\n\t\t\t\t\t<textarea\n\t\t\t\t\t\tclassName=\"w-full min-h-[150px] rounded-md border bg-background px-3 py-2 text-sm font-mono\"\n\t\t\t\t\t\tplaceholder={\"john@example.com\\njane@example.com\\nmike@example.com\"}\n\t\t\t\t\t\tvalue={customEmails}\n\t\t\t\t\t\tonChange={(e) => handleCustomEmailsChange(e.target.value)}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{/* Exclusion Options */}\n\t\t\t<div className=\"rounded-lg border p-4 space-y-4\">\n\t\t\t\t<h4 className=\"font-medium\">Exclusions</h4>\n\t\t\t\t<div className=\"space-y-3\">\n\t\t\t\t\t<label className=\"flex items-center gap-2 cursor-pointer\">\n\t\t\t\t\t\t<Checkbox\n\t\t\t\t\t\t\tchecked={localFilter.excludeUnsubscribed !== false}\n\t\t\t\t\t\t\tonCheckedChange={(checked) =>\n\t\t\t\t\t\t\t\thandleFilterChange({ excludeUnsubscribed: checked === true })\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span className=\"text-sm\">Exclude unsubscribed contacts</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t<label className=\"flex items-center gap-2 cursor-pointer\">\n\t\t\t\t\t\t<Checkbox\n\t\t\t\t\t\t\tchecked={localFilter.excludeBounced !== false}\n\t\t\t\t\t\t\tonCheckedChange={(checked) =>\n\t\t\t\t\t\t\t\thandleFilterChange({ excludeBounced: checked === true })\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span className=\"text-sm\">Exclude bounced emails</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t<label className=\"flex items-center gap-2 cursor-pointer\">\n\t\t\t\t\t\t<Checkbox\n\t\t\t\t\t\t\tchecked={localFilter.excludeComplained !== false}\n\t\t\t\t\t\t\tonCheckedChange={(checked) =>\n\t\t\t\t\t\t\t\thandleFilterChange({ excludeComplained: checked === true })\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span className=\"text-sm\">Exclude spam complaints</span>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Audience Preview */}\n\t\t\t<div className=\"rounded-lg border bg-muted/30 p-4\">\n\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Users className=\"size-4 text-muted-foreground\" />\n\t\t\t\t\t\t<span className=\"text-sm font-medium\">Estimated Recipients</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t{audiencePreview.isLoading ? (\n\t\t\t\t\t\t<Loader2 className=\"size-4 animate-spin text-muted-foreground\" />\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<span className=\"text-lg font-bold\">\n\t\t\t\t\t\t\t{audiencePreview.estimatedCount.toLocaleString()}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{!audiencePreview.isLoading && audiencePreview.sampleRecipients.length > 0 && (\n\t\t\t\t\t<div className=\"mt-3 pt-3 border-t\">\n\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground mb-2\">Sample recipients:</p>\n\t\t\t\t\t\t<div className=\"space-y-1\">\n\t\t\t\t\t\t\t{audiencePreview.sampleRecipients.slice(0, 3).map((recipient, i) => (\n\t\t\t\t\t\t\t\t<div key={i} className=\"flex items-center gap-2 text-sm\">\n\t\t\t\t\t\t\t\t\t<Mail className=\"size-3 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t\t<span>{recipient.email}</span>\n\t\t\t\t\t\t\t\t\t{recipient.name && (\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">({recipient.name})</span>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1184, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/admin/src/components/marketing/campaign-builder.tsx"],"sourcesContent":["\"use client\";\n\n/**\n * Campaign Builder Component\n *\n * Multi-step wizard for creating and editing email campaigns.\n * Steps: Details → Content → Audience → Review\n */\n\nimport { useState, useCallback } from \"react\";\nimport {\n\tArrowLeft,\n\tArrowRight,\n\tCheck,\n\tFileText,\n\tLoader2,\n\tMail,\n\tSend,\n\tUsers,\n\tEye,\n\tCalendar,\n\tClock,\n} from \"lucide-react\";\nimport { Button, Input, Label, Textarea, cn } from \"@stratos/ui\";\nimport { useCampaignStore } from \"@/lib/stores/campaign-store\";\nimport type { CampaignBuilderStep, CampaignDraft, EmailCampaignAudienceType } from \"@/types/campaigns\";\nimport { AudienceSelector } from \"./audience-selector\";\n\ntype CampaignBuilderProps = {\n\tonSave?: (draft: CampaignDraft) => Promise<void>;\n\tonSend?: (draft: CampaignDraft) => Promise<void>;\n\tonSchedule?: (draft: CampaignDraft, scheduledFor: string) => Promise<void>;\n\tonCancel?: () => void;\n\tisSubmitting?: boolean;\n};\n\nconst STEPS: { id: CampaignBuilderStep; label: string; icon: typeof FileText }[] = [\n\t{ id: \"details\", label: \"Details\", icon: FileText },\n\t{ id: \"content\", label: \"Content\", icon: Mail },\n\t{ id: \"audience\", label: \"Audience\", icon: Users },\n\t{ id: \"review\", label: \"Review\", icon: Eye },\n];\n\nexport function CampaignBuilder({\n\tonSave,\n\tonSend,\n\tonSchedule,\n\tonCancel,\n\tisSubmitting = false,\n}: CampaignBuilderProps) {\n\tconst { builder, setBuilderStep, updateDraft, setValidationErrors, clearValidationError } =\n\t\tuseCampaignStore();\n\tconst [scheduleDate, setScheduleDate] = useState<string>(\"\");\n\tconst [scheduleTime, setScheduleTime] = useState<string>(\"09:00\");\n\n\tconst { currentStep, draft, validationErrors, editingCampaignId } = builder;\n\tconst currentStepIndex = STEPS.findIndex((s) => s.id === currentStep);\n\n\t// Validation\n\tconst validateStep = useCallback(\n\t\t(step: CampaignBuilderStep): boolean => {\n\t\t\tconst errors: Record<string, string> = {};\n\n\t\t\tswitch (step) {\n\t\t\t\tcase \"details\":\n\t\t\t\t\tif (!draft.name.trim()) errors.name = \"Campaign name is required\";\n\t\t\t\t\tif (!draft.subject.trim()) errors.subject = \"Subject line is required\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"content\":\n\t\t\t\t\tif (!draft.htmlContent?.trim() && !draft.templateId) {\n\t\t\t\t\t\terrors.content = \"Email content or template is required\";\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"audience\":\n\t\t\t\t\tif (!draft.audienceType) errors.audienceType = \"Audience type is required\";\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (Object.keys(errors).length > 0) {\n\t\t\t\tsetValidationErrors(errors);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\t[draft, setValidationErrors]\n\t);\n\n\tconst handleNext = useCallback(() => {\n\t\tif (!validateStep(currentStep)) return;\n\n\t\tconst nextIndex = currentStepIndex + 1;\n\t\tif (nextIndex < STEPS.length) {\n\t\t\tsetBuilderStep(STEPS[nextIndex]!.id);\n\t\t}\n\t}, [currentStep, currentStepIndex, validateStep, setBuilderStep]);\n\n\tconst handleBack = useCallback(() => {\n\t\tconst prevIndex = currentStepIndex - 1;\n\t\tif (prevIndex >= 0) {\n\t\t\tsetBuilderStep(STEPS[prevIndex]!.id);\n\t\t}\n\t}, [currentStepIndex, setBuilderStep]);\n\n\tconst handleStepClick = useCallback(\n\t\t(stepId: CampaignBuilderStep) => {\n\t\t\tconst targetIndex = STEPS.findIndex((s) => s.id === stepId);\n\t\t\t// Can only go back, or to current step\n\t\t\tif (targetIndex <= currentStepIndex) {\n\t\t\t\tsetBuilderStep(stepId);\n\t\t\t}\n\t\t},\n\t\t[currentStepIndex, setBuilderStep]\n\t);\n\n\tconst handleSave = useCallback(async () => {\n\t\tif (onSave) {\n\t\t\tawait onSave(draft);\n\t\t}\n\t}, [draft, onSave]);\n\n\tconst handleSend = useCallback(async () => {\n\t\tif (!validateStep(\"details\") || !validateStep(\"content\") || !validateStep(\"audience\")) {\n\t\t\treturn;\n\t\t}\n\t\tif (onSend) {\n\t\t\tawait onSend(draft);\n\t\t}\n\t}, [draft, onSend, validateStep]);\n\n\tconst handleSchedule = useCallback(async () => {\n\t\tif (!validateStep(\"details\") || !validateStep(\"content\") || !validateStep(\"audience\")) {\n\t\t\treturn;\n\t\t}\n\t\tif (!scheduleDate) {\n\t\t\tsetValidationErrors({ schedule: \"Please select a date\" });\n\t\t\treturn;\n\t\t}\n\t\tconst scheduledFor = `${scheduleDate}T${scheduleTime}:00.000Z`;\n\t\tif (onSchedule) {\n\t\t\tawait onSchedule(draft, scheduledFor);\n\t\t}\n\t}, [draft, onSchedule, scheduleDate, scheduleTime, validateStep, setValidationErrors]);\n\n\treturn (\n\t\t<div className=\"flex h-full flex-col\">\n\t\t\t{/* Step Indicator */}\n\t\t\t<div className=\"border-b px-6 py-4\">\n\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t{STEPS.map((step, index) => {\n\t\t\t\t\t\tconst isActive = step.id === currentStep;\n\t\t\t\t\t\tconst isCompleted = index < currentStepIndex;\n\t\t\t\t\t\tconst isClickable = index <= currentStepIndex;\n\t\t\t\t\t\tconst Icon = step.icon;\n\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div key={step.id} className=\"flex items-center\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-colors\",\n\t\t\t\t\t\t\t\t\t\tisActive && \"bg-primary text-primary-foreground\",\n\t\t\t\t\t\t\t\t\t\tisCompleted && !isActive && \"bg-emerald-100 text-emerald-700\",\n\t\t\t\t\t\t\t\t\t\t!isActive && !isCompleted && \"text-muted-foreground\",\n\t\t\t\t\t\t\t\t\t\tisClickable && !isActive && \"hover:bg-muted cursor-pointer\"\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\tonClick={() => handleStepClick(step.id)}\n\t\t\t\t\t\t\t\t\tdisabled={!isClickable}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{isCompleted && !isActive ? (\n\t\t\t\t\t\t\t\t\t\t<Check className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<Icon className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t<span className=\"hidden sm:inline\">{step.label}</span>\n\t\t\t\t\t\t\t\t\t<span className=\"sm:hidden\">{index + 1}</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t{index < STEPS.length - 1 && (\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"mx-2 h-px w-8 sm:w-12\",\n\t\t\t\t\t\t\t\t\t\t\tindex < currentStepIndex ? \"bg-emerald-500\" : \"bg-border\"\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n\t\t\t\t\t})}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Step Content */}\n\t\t\t<div className=\"flex-1 overflow-auto p-6\">\n\t\t\t\t{currentStep === \"details\" && (\n\t\t\t\t\t<DetailsStep\n\t\t\t\t\t\tdraft={draft}\n\t\t\t\t\t\terrors={validationErrors}\n\t\t\t\t\t\tonChange={updateDraft}\n\t\t\t\t\t\tonClearError={clearValidationError}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t\t{currentStep === \"content\" && (\n\t\t\t\t\t<ContentStep\n\t\t\t\t\t\tdraft={draft}\n\t\t\t\t\t\terrors={validationErrors}\n\t\t\t\t\t\tonChange={updateDraft}\n\t\t\t\t\t\tonClearError={clearValidationError}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t\t{currentStep === \"audience\" && (\n\t\t\t\t\t<AudienceStep\n\t\t\t\t\t\tdraft={draft}\n\t\t\t\t\t\terrors={validationErrors}\n\t\t\t\t\t\tonChange={updateDraft}\n\t\t\t\t\t\tonClearError={clearValidationError}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t\t{currentStep === \"review\" && (\n\t\t\t\t\t<ReviewStep\n\t\t\t\t\t\tdraft={draft}\n\t\t\t\t\t\tscheduleDate={scheduleDate}\n\t\t\t\t\t\tscheduleTime={scheduleTime}\n\t\t\t\t\t\tonScheduleDateChange={setScheduleDate}\n\t\t\t\t\t\tonScheduleTimeChange={setScheduleTime}\n\t\t\t\t\t\terrors={validationErrors}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</div>\n\n\t\t\t{/* Footer Actions */}\n\t\t\t<div className=\"flex items-center justify-between border-t px-6 py-4\">\n\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t{currentStepIndex > 0 && (\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={handleBack} disabled={isSubmitting}>\n\t\t\t\t\t\t\t<ArrowLeft className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\tBack\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t\t{onCancel && (\n\t\t\t\t\t\t<Button variant=\"ghost\" onClick={onCancel} disabled={isSubmitting}>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t{onSave && (\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={handleSave} disabled={isSubmitting}>\n\t\t\t\t\t\t\t{isSubmitting ? (\n\t\t\t\t\t\t\t\t<Loader2 className=\"mr-2 size-4 animate-spin\" />\n\t\t\t\t\t\t\t) : null}\n\t\t\t\t\t\t\tSave Draft\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{currentStep !== \"review\" ? (\n\t\t\t\t\t\t<Button onClick={handleNext} disabled={isSubmitting}>\n\t\t\t\t\t\t\tNext\n\t\t\t\t\t\t\t<ArrowRight className=\"ml-2 size-4\" />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t{onSchedule && scheduleDate && (\n\t\t\t\t\t\t\t\t<Button variant=\"secondary\" onClick={handleSchedule} disabled={isSubmitting}>\n\t\t\t\t\t\t\t\t\t{isSubmitting ? (\n\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"mr-2 size-4 animate-spin\" />\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<Calendar className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\tSchedule\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{onSend && (\n\t\t\t\t\t\t\t\t<Button onClick={handleSend} disabled={isSubmitting}>\n\t\t\t\t\t\t\t\t\t{isSubmitting ? (\n\t\t\t\t\t\t\t\t\t\t<Loader2 className=\"mr-2 size-4 animate-spin\" />\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<Send className=\"mr-2 size-4\" />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\tSend Now\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n// ============================================================================\n// Step Components\n// ============================================================================\n\ntype StepProps = {\n\tdraft: CampaignDraft;\n\terrors: Record<string, string>;\n\tonChange: (updates: Partial<CampaignDraft>) => void;\n\tonClearError: (field: string) => void;\n};\n\nfunction DetailsStep({ draft, errors, onChange, onClearError }: StepProps) {\n\treturn (\n\t\t<div className=\"mx-auto max-w-2xl space-y-6\">\n\t\t\t<div>\n\t\t\t\t<h2 className=\"text-lg font-semibold\">Campaign Details</h2>\n\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\tSet up the basic information for your campaign\n\t\t\t\t</p>\n\t\t\t</div>\n\n\t\t\t<div className=\"space-y-4\">\n\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t<Label htmlFor=\"name\">Campaign Name *</Label>\n\t\t\t\t\t<Input\n\t\t\t\t\t\tid=\"name\"\n\t\t\t\t\t\tplaceholder=\"e.g., Holiday Promotion 2024\"\n\t\t\t\t\t\tvalue={draft.name}\n\t\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\t\tonChange({ name: e.target.value });\n\t\t\t\t\t\t\tonClearError(\"name\");\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tclassName={errors.name ? \"border-destructive\" : \"\"}\n\t\t\t\t\t/>\n\t\t\t\t\t{errors.name && (\n\t\t\t\t\t\t<p className=\"text-sm text-destructive\">{errors.name}</p>\n\t\t\t\t\t)}\n\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\tInternal name for organization (not shown to recipients)\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t<Label htmlFor=\"subject\">Subject Line *</Label>\n\t\t\t\t\t<Input\n\t\t\t\t\t\tid=\"subject\"\n\t\t\t\t\t\tplaceholder=\"e.g., Special Holiday Offer Inside!\"\n\t\t\t\t\t\tvalue={draft.subject}\n\t\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\t\tonChange({ subject: e.target.value });\n\t\t\t\t\t\t\tonClearError(\"subject\");\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tclassName={errors.subject ? \"border-destructive\" : \"\"}\n\t\t\t\t\t/>\n\t\t\t\t\t{errors.subject && (\n\t\t\t\t\t\t<p className=\"text-sm text-destructive\">{errors.subject}</p>\n\t\t\t\t\t)}\n\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t{draft.subject.length}/60 characters recommended\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t<Label htmlFor=\"previewText\">Preview Text</Label>\n\t\t\t\t\t<Input\n\t\t\t\t\t\tid=\"previewText\"\n\t\t\t\t\t\tplaceholder=\"e.g., Get 20% off your next purchase...\"\n\t\t\t\t\t\tvalue={draft.previewText}\n\t\t\t\t\t\tonChange={(e) => onChange({ previewText: e.target.value })}\n\t\t\t\t\t/>\n\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\tText shown after the subject in the inbox preview\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"grid gap-4 sm:grid-cols-2\">\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<Label htmlFor=\"fromName\">From Name</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\tid=\"fromName\"\n\t\t\t\t\t\t\tplaceholder=\"Thorbis\"\n\t\t\t\t\t\t\tvalue={draft.fromName}\n\t\t\t\t\t\t\tonChange={(e) => onChange({ fromName: e.target.value })}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<Label htmlFor=\"fromEmail\">From Email</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\tid=\"fromEmail\"\n\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\tplaceholder=\"hello@thorbis.com\"\n\t\t\t\t\t\t\tvalue={draft.fromEmail}\n\t\t\t\t\t\t\tonChange={(e) => onChange({ fromEmail: e.target.value })}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t<Label htmlFor=\"replyTo\">Reply-To Email</Label>\n\t\t\t\t\t<Input\n\t\t\t\t\t\tid=\"replyTo\"\n\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\tplaceholder=\"support@thorbis.com (optional)\"\n\t\t\t\t\t\tvalue={draft.replyTo || \"\"}\n\t\t\t\t\t\tonChange={(e) => onChange({ replyTo: e.target.value || undefined })}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction ContentStep({ draft, errors, onChange, onClearError }: StepProps) {\n\t// For now, simple HTML textarea - can be replaced with rich editor\n\treturn (\n\t\t<div className=\"mx-auto max-w-3xl space-y-6\">\n\t\t\t<div>\n\t\t\t\t<h2 className=\"text-lg font-semibold\">Email Content</h2>\n\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\tCreate your email content using HTML or select a template\n\t\t\t\t</p>\n\t\t\t</div>\n\n\t\t\t<div className=\"space-y-4\">\n\t\t\t\t{/* Template selector would go here */}\n\t\t\t\t<div className=\"rounded-lg border bg-muted/50 p-4\">\n\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\tTemplate library coming soon. For now, enter HTML content directly.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t<Label htmlFor=\"htmlContent\">HTML Content *</Label>\n\t\t\t\t\t<Textarea\n\t\t\t\t\t\tid=\"htmlContent\"\n\t\t\t\t\t\tplaceholder=\"<html><body><h1>Hello!</h1><p>Your email content here...</p></body></html>\"\n\t\t\t\t\t\tvalue={draft.htmlContent || \"\"}\n\t\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\t\tonChange({ htmlContent: e.target.value });\n\t\t\t\t\t\t\tonClearError(\"content\");\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tclassName={cn(\"min-h-[300px] font-mono text-sm\", errors.content && \"border-destructive\")}\n\t\t\t\t\t/>\n\t\t\t\t\t{errors.content && (\n\t\t\t\t\t\t<p className=\"text-sm text-destructive\">{errors.content}</p>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t<Label htmlFor=\"plainTextContent\">Plain Text Version (optional)</Label>\n\t\t\t\t\t<Textarea\n\t\t\t\t\t\tid=\"plainTextContent\"\n\t\t\t\t\t\tplaceholder=\"Hello! Your email content here...\"\n\t\t\t\t\t\tvalue={draft.plainTextContent || \"\"}\n\t\t\t\t\t\tonChange={(e) => onChange({ plainTextContent: e.target.value })}\n\t\t\t\t\t\tclassName=\"min-h-[150px]\"\n\t\t\t\t\t/>\n\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\tFallback for email clients that don't support HTML\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction AudienceStep({ draft, errors, onChange, onClearError }: StepProps) {\n\treturn (\n\t\t<div className=\"mx-auto max-w-2xl space-y-6\">\n\t\t\t<div>\n\t\t\t\t<h2 className=\"text-lg font-semibold\">Select Audience</h2>\n\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\tChoose who will receive this campaign\n\t\t\t\t</p>\n\t\t\t</div>\n\n\t\t\t<AudienceSelector\n\t\t\t\tvalue={draft.audienceType}\n\t\t\t\tfilter={draft.audienceFilter}\n\t\t\t\tonChange={(audienceType, audienceFilter) => {\n\t\t\t\t\tonChange({ audienceType, audienceFilter });\n\t\t\t\t\tonClearError(\"audienceType\");\n\t\t\t\t}}\n\t\t\t\terror={errors.audienceType}\n\t\t\t/>\n\t\t</div>\n\t);\n}\n\nfunction ReviewStep({\n\tdraft,\n\tscheduleDate,\n\tscheduleTime,\n\tonScheduleDateChange,\n\tonScheduleTimeChange,\n\terrors,\n}: {\n\tdraft: CampaignDraft;\n\tscheduleDate: string;\n\tscheduleTime: string;\n\tonScheduleDateChange: (date: string) => void;\n\tonScheduleTimeChange: (time: string) => void;\n\terrors: Record<string, string>;\n}) {\n\tconst audienceLabels: Record<EmailCampaignAudienceType, string> = {\n\t\tall_users: \"All Users\",\n\t\tall_companies: \"All Companies\",\n\t\twaitlist: \"Waitlist Subscribers\",\n\t\tsegment: \"Custom Segment\",\n\t\tcustom: \"Custom List\",\n\t};\n\n\treturn (\n\t\t<div className=\"mx-auto max-w-2xl space-y-6\">\n\t\t\t<div>\n\t\t\t\t<h2 className=\"text-lg font-semibold\">Review & Send</h2>\n\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\tReview your campaign before sending\n\t\t\t\t</p>\n\t\t\t</div>\n\n\t\t\t{/* Campaign Summary */}\n\t\t\t<div className=\"rounded-lg border p-4 space-y-4\">\n\t\t\t\t<h3 className=\"font-medium\">Campaign Summary</h3>\n\n\t\t\t\t<div className=\"grid gap-4 sm:grid-cols-2\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Campaign Name</p>\n\t\t\t\t\t\t<p className=\"font-medium\">{draft.name || \"—\"}</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">From</p>\n\t\t\t\t\t\t<p className=\"font-medium\">{draft.fromName} &lt;{draft.fromEmail}&gt;</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"sm:col-span-2\">\n\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Subject Line</p>\n\t\t\t\t\t\t<p className=\"font-medium\">{draft.subject || \"—\"}</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t{draft.previewText && (\n\t\t\t\t\t\t<div className=\"sm:col-span-2\">\n\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Preview Text</p>\n\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">{draft.previewText}</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Audience</p>\n\t\t\t\t\t\t<p className=\"font-medium\">{audienceLabels[draft.audienceType]}</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Schedule Option */}\n\t\t\t<div className=\"rounded-lg border p-4 space-y-4\">\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<Clock className=\"size-4 text-muted-foreground\" />\n\t\t\t\t\t<h3 className=\"font-medium\">Schedule (Optional)</h3>\n\t\t\t\t</div>\n\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\tSchedule this campaign for later, or send it immediately\n\t\t\t\t</p>\n\n\t\t\t\t<div className=\"grid gap-4 sm:grid-cols-2\">\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<Label htmlFor=\"scheduleDate\">Date</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\tid=\"scheduleDate\"\n\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\tvalue={scheduleDate}\n\t\t\t\t\t\t\tonChange={(e) => onScheduleDateChange(e.target.value)}\n\t\t\t\t\t\t\tmin={new Date().toISOString().split(\"T\")[0]}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<Label htmlFor=\"scheduleTime\">Time (UTC)</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\tid=\"scheduleTime\"\n\t\t\t\t\t\t\ttype=\"time\"\n\t\t\t\t\t\t\tvalue={scheduleTime}\n\t\t\t\t\t\t\tonChange={(e) => onScheduleTimeChange(e.target.value)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t{errors.schedule && (\n\t\t\t\t\t<p className=\"text-sm text-destructive\">{errors.schedule}</p>\n\t\t\t\t)}\n\t\t\t</div>\n\n\t\t\t{/* Email Preview */}\n\t\t\t<div className=\"rounded-lg border p-4 space-y-4\">\n\t\t\t\t<h3 className=\"font-medium\">Email Preview</h3>\n\t\t\t\t{draft.htmlContent ? (\n\t\t\t\t\t<div className=\"rounded border bg-white p-4\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"prose prose-sm max-w-none\"\n\t\t\t\t\t\t\tdangerouslySetInnerHTML={{ __html: draft.htmlContent }}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t) : (\n\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">No content to preview</p>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2496, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/admin/src/actions/campaigns.ts"],"sourcesContent":["\"use server\";\n\n/**\n * Campaign Server Actions\n *\n * Server-side actions for managing email marketing campaigns.\n * Handles CRUD operations, sending via Resend, scheduling, and analytics.\n */\n\nimport { revalidatePath } from \"next/cache\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { Resend } from \"resend\";\nimport type { CampaignDraft, EmailCampaign, AudienceFilter } from \"@/types/campaigns\";\n\n// Initialize Resend client\nconst resend = new Resend(process.env.RESEND_API_KEY);\n\n// Platform email configuration\nconst PLATFORM_FROM_EMAIL = process.env.RESEND_FROM_EMAIL || \"hello@thorbis.com\";\nconst PLATFORM_FROM_NAME = process.env.RESEND_FROM_NAME || \"Thorbis\";\n\n// ============================================================================\n// Types\n// ============================================================================\n\ntype ActionResult<T = void> = {\n\tsuccess: boolean;\n\tdata?: T;\n\terror?: string;\n};\n\ntype CreateCampaignInput = CampaignDraft;\n\ntype UpdateCampaignInput = Partial<CampaignDraft> & {\n\tid: string;\n};\n\ntype SendCampaignResult = {\n\tcampaignId: string;\n\trecipientCount: number;\n\testimatedCompletionTime: string;\n};\n\ntype AudiencePreviewResult = {\n\testimatedCount: number;\n\tsampleRecipients: {\n\t\temail: string;\n\t\tname?: string;\n\t\ttype: string;\n\t}[];\n};\n\n// ============================================================================\n// Campaign CRUD Actions\n// ============================================================================\n\n/**\n * Create a new campaign as a draft\n */\nexport async function createCampaign(\n\tinput: CreateCampaignInput\n): Promise<ActionResult<EmailCampaign>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.insert({\n\t\t\t\tname: input.name,\n\t\t\t\tsubject: input.subject,\n\t\t\t\tpreview_text: input.previewText,\n\t\t\t\ttemplate_id: input.templateId,\n\t\t\t\ttemplate_data: input.templateData,\n\t\t\t\thtml_content: input.htmlContent,\n\t\t\t\tplain_text_content: input.plainTextContent,\n\t\t\t\taudience_type: input.audienceType,\n\t\t\t\taudience_filter: input.audienceFilter,\n\t\t\t\tfrom_name: input.fromName || PLATFORM_FROM_NAME,\n\t\t\t\tfrom_email: input.fromEmail || PLATFORM_FROM_EMAIL,\n\t\t\t\treply_to: input.replyTo,\n\t\t\t\ttags: input.tags || [],\n\t\t\t\tnotes: input.notes,\n\t\t\t\tstatus: \"draft\",\n\t\t\t\ttotal_recipients: 0,\n\t\t\t\tsent_count: 0,\n\t\t\t\tdelivered_count: 0,\n\t\t\t\topened_count: 0,\n\t\t\t\tunique_opens: 0,\n\t\t\t\tclicked_count: 0,\n\t\t\t\tunique_clicks: 0,\n\t\t\t\tbounced_count: 0,\n\t\t\t\tcomplained_count: 0,\n\t\t\t\tunsubscribed_count: 0,\n\t\t\t\tfailed_count: 0,\n\t\t\t\trevenue_attributed: 0,\n\t\t\t\tconversions_count: 0,\n\t\t\t})\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to create campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to create campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: mapCampaignFromDb(data),\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to create campaign:\", error);\n\t\treturn { success: false, error: \"Failed to create campaign\" };\n\t}\n}\n\n/**\n * Update an existing campaign\n */\nexport async function updateCampaign(\n\tinput: UpdateCampaignInput\n): Promise<ActionResult<EmailCampaign>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Build update object with only provided fields\n\t\tconst updateData: Record<string, unknown> = {\n\t\t\tupdated_at: new Date().toISOString(),\n\t\t};\n\n\t\tif (input.name !== undefined) updateData.name = input.name;\n\t\tif (input.subject !== undefined) updateData.subject = input.subject;\n\t\tif (input.previewText !== undefined) updateData.preview_text = input.previewText;\n\t\tif (input.templateId !== undefined) updateData.template_id = input.templateId;\n\t\tif (input.templateData !== undefined) updateData.template_data = input.templateData;\n\t\tif (input.htmlContent !== undefined) updateData.html_content = input.htmlContent;\n\t\tif (input.plainTextContent !== undefined) updateData.plain_text_content = input.plainTextContent;\n\t\tif (input.audienceType !== undefined) updateData.audience_type = input.audienceType;\n\t\tif (input.audienceFilter !== undefined) updateData.audience_filter = input.audienceFilter;\n\t\tif (input.fromName !== undefined) updateData.from_name = input.fromName;\n\t\tif (input.fromEmail !== undefined) updateData.from_email = input.fromEmail;\n\t\tif (input.replyTo !== undefined) updateData.reply_to = input.replyTo;\n\t\tif (input.tags !== undefined) updateData.tags = input.tags;\n\t\tif (input.notes !== undefined) updateData.notes = input.notes;\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update(updateData)\n\t\t\t.eq(\"id\", input.id)\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to update campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to update campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${input.id}`);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: mapCampaignFromDb(data),\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to update campaign:\", error);\n\t\treturn { success: false, error: \"Failed to update campaign\" };\n\t}\n}\n\n/**\n * Delete a draft campaign\n */\nexport async function deleteCampaign(id: string): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Only allow deleting drafts\n\t\tconst { data: campaign } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.select(\"status\")\n\t\t\t.eq(\"id\", id)\n\t\t\t.single();\n\n\t\tif (campaign?.status !== \"draft\") {\n\t\t\treturn { success: false, error: \"Only draft campaigns can be deleted\" };\n\t\t}\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.delete()\n\t\t\t.eq(\"id\", id);\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to delete campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to delete campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to delete campaign:\", error);\n\t\treturn { success: false, error: \"Failed to delete campaign\" };\n\t}\n}\n\n/**\n * Duplicate an existing campaign\n */\nexport async function duplicateCampaign(id: string): Promise<ActionResult<EmailCampaign>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Fetch original campaign\n\t\tconst { data: original, error: fetchError } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"id\", id)\n\t\t\t.single();\n\n\t\tif (fetchError || !original) {\n\t\t\treturn { success: false, error: \"Campaign not found\" };\n\t\t}\n\n\t\t// Create copy with reset stats\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.insert({\n\t\t\t\tname: `${original.name} (Copy)`,\n\t\t\t\tsubject: original.subject,\n\t\t\t\tpreview_text: original.preview_text,\n\t\t\t\ttemplate_id: original.template_id,\n\t\t\t\ttemplate_data: original.template_data,\n\t\t\t\thtml_content: original.html_content,\n\t\t\t\tplain_text_content: original.plain_text_content,\n\t\t\t\taudience_type: original.audience_type,\n\t\t\t\taudience_filter: original.audience_filter,\n\t\t\t\tfrom_name: original.from_name,\n\t\t\t\tfrom_email: original.from_email,\n\t\t\t\treply_to: original.reply_to,\n\t\t\t\ttags: original.tags,\n\t\t\t\tnotes: original.notes,\n\t\t\t\tstatus: \"draft\",\n\t\t\t\ttotal_recipients: 0,\n\t\t\t\tsent_count: 0,\n\t\t\t\tdelivered_count: 0,\n\t\t\t\topened_count: 0,\n\t\t\t\tunique_opens: 0,\n\t\t\t\tclicked_count: 0,\n\t\t\t\tunique_clicks: 0,\n\t\t\t\tbounced_count: 0,\n\t\t\t\tcomplained_count: 0,\n\t\t\t\tunsubscribed_count: 0,\n\t\t\t\tfailed_count: 0,\n\t\t\t\trevenue_attributed: 0,\n\t\t\t\tconversions_count: 0,\n\t\t\t})\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to duplicate campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to duplicate campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: mapCampaignFromDb(data),\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to duplicate campaign:\", error);\n\t\treturn { success: false, error: \"Failed to duplicate campaign\" };\n\t}\n}\n\n// ============================================================================\n// Campaign Sending Actions\n// ============================================================================\n\n/**\n * Send a campaign immediately\n */\nexport async function sendCampaign(id: string): Promise<ActionResult<SendCampaignResult>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Get campaign details\n\t\tconst { data: campaign, error: fetchError } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"id\", id)\n\t\t\t.single();\n\n\t\tif (fetchError || !campaign) {\n\t\t\treturn { success: false, error: \"Campaign not found\" };\n\t\t}\n\n\t\tif (campaign.status !== \"draft\") {\n\t\t\treturn { success: false, error: \"Only draft campaigns can be sent\" };\n\t\t}\n\n\t\t// Get recipients based on audience type\n\t\tconst recipients = await getAudienceRecipients(campaign.audience_type, campaign.audience_filter);\n\n\t\tif (recipients.length === 0) {\n\t\t\treturn { success: false, error: \"No recipients found for this audience\" };\n\t\t}\n\n\t\t// Update campaign status to sending\n\t\tawait supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"sending\",\n\t\t\t\tsending_started_at: new Date().toISOString(),\n\t\t\t\ttotal_recipients: recipients.length,\n\t\t\t})\n\t\t\t.eq(\"id\", id);\n\n\t\t// Create send records for each recipient\n\t\tconst sendRecords = recipients.map((recipient) => ({\n\t\t\tcampaign_id: id,\n\t\t\trecipient_email: recipient.email,\n\t\t\trecipient_name: recipient.name,\n\t\t\trecipient_type: recipient.type,\n\t\t\trecipient_id: recipient.id,\n\t\t\tstatus: \"pending\",\n\t\t}));\n\n\t\tawait supabase.from(\"email_campaign_sends\").insert(sendRecords);\n\n\t\t// Send emails via Resend (batch processing)\n\t\tlet sentCount = 0;\n\t\tlet failedCount = 0;\n\n\t\tfor (const recipient of recipients) {\n\t\t\ttry {\n\t\t\t\tconst { data: sendResult, error: sendError } = await resend.emails.send({\n\t\t\t\t\tfrom: `${campaign.from_name} <${campaign.from_email}>`,\n\t\t\t\t\tto: recipient.email,\n\t\t\t\t\tsubject: campaign.subject,\n\t\t\t\t\thtml: campaign.html_content || `<p>${campaign.plain_text_content}</p>`,\n\t\t\t\t\ttext: campaign.plain_text_content,\n\t\t\t\t\treplyTo: campaign.reply_to,\n\t\t\t\t\ttags: [\n\t\t\t\t\t\t{ name: \"campaign_id\", value: id },\n\t\t\t\t\t\t{ name: \"recipient_type\", value: recipient.type },\n\t\t\t\t\t],\n\t\t\t\t});\n\n\t\t\t\tif (sendError) {\n\t\t\t\t\tfailedCount++;\n\t\t\t\t\t// Update send record with error\n\t\t\t\t\tawait supabase\n\t\t\t\t\t\t.from(\"email_campaign_sends\")\n\t\t\t\t\t\t.update({\n\t\t\t\t\t\t\tstatus: \"failed\",\n\t\t\t\t\t\t\terror_message: sendError.message,\n\t\t\t\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.eq(\"campaign_id\", id)\n\t\t\t\t\t\t.eq(\"recipient_email\", recipient.email);\n\t\t\t\t} else {\n\t\t\t\t\tsentCount++;\n\t\t\t\t\t// Update send record with Resend ID\n\t\t\t\t\tawait supabase\n\t\t\t\t\t\t.from(\"email_campaign_sends\")\n\t\t\t\t\t\t.update({\n\t\t\t\t\t\t\tstatus: \"sent\",\n\t\t\t\t\t\t\tresend_id: sendResult?.id,\n\t\t\t\t\t\t\tsent_at: new Date().toISOString(),\n\t\t\t\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.eq(\"campaign_id\", id)\n\t\t\t\t\t\t.eq(\"recipient_email\", recipient.email);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tfailedCount++;\n\t\t\t\tconsole.error(`Failed to send to ${recipient.email}:`, err);\n\t\t\t}\n\t\t}\n\n\t\t// Update campaign with final stats\n\t\tawait supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"sent\",\n\t\t\t\tsent_at: new Date().toISOString(),\n\t\t\t\tcompleted_at: new Date().toISOString(),\n\t\t\t\tsent_count: sentCount,\n\t\t\t\tfailed_count: failedCount,\n\t\t\t})\n\t\t\t.eq(\"id\", id);\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: {\n\t\t\t\tcampaignId: id,\n\t\t\t\trecipientCount: recipients.length,\n\t\t\t\testimatedCompletionTime: new Date().toISOString(),\n\t\t\t},\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to send campaign:\", error);\n\t\treturn { success: false, error: \"Failed to send campaign\" };\n\t}\n}\n\n/**\n * Schedule a campaign for later\n */\nexport async function scheduleCampaign(\n\tid: string,\n\tscheduledFor: string\n): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Validate campaign is in draft status\n\t\tconst { data: campaign } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.select(\"status, audience_type, audience_filter\")\n\t\t\t.eq(\"id\", id)\n\t\t\t.single();\n\n\t\tif (campaign?.status !== \"draft\") {\n\t\t\treturn { success: false, error: \"Only draft campaigns can be scheduled\" };\n\t\t}\n\n\t\t// Get recipient count for the campaign\n\t\tconst recipients = await getAudienceRecipients(campaign.audience_type, campaign.audience_filter);\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"scheduled\",\n\t\t\t\tscheduled_for: scheduledFor,\n\t\t\t\ttotal_recipients: recipients.length,\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", id);\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to schedule campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to schedule campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to schedule campaign:\", error);\n\t\treturn { success: false, error: \"Failed to schedule campaign\" };\n\t}\n}\n\n/**\n * Cancel a scheduled campaign\n */\nexport async function cancelScheduledCampaign(id: string): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"draft\",\n\t\t\t\tscheduled_for: null,\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", id)\n\t\t\t.eq(\"status\", \"scheduled\");\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to cancel scheduled campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to cancel scheduled campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to cancel scheduled campaign:\", error);\n\t\treturn { success: false, error: \"Failed to cancel scheduled campaign\" };\n\t}\n}\n\n/**\n * Pause a sending campaign\n */\nexport async function pauseCampaign(id: string): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"paused\",\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", id)\n\t\t\t.eq(\"status\", \"sending\");\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to pause campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to pause campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to pause campaign:\", error);\n\t\treturn { success: false, error: \"Failed to pause campaign\" };\n\t}\n}\n\n/**\n * Resume a paused campaign\n */\nexport async function resumeCampaign(id: string): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"sending\",\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", id)\n\t\t\t.eq(\"status\", \"paused\");\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to resume campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to resume campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to resume campaign:\", error);\n\t\treturn { success: false, error: \"Failed to resume campaign\" };\n\t}\n}\n\n// ============================================================================\n// Audience Actions\n// ============================================================================\n\n/**\n * Preview audience based on filters\n * Returns estimated count and sample recipients\n */\nexport async function previewAudience(\n\taudienceType: string,\n\tfilter?: AudienceFilter\n): Promise<ActionResult<AudiencePreviewResult>> {\n\ttry {\n\t\tconst recipients = await getAudienceRecipients(audienceType, filter);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: {\n\t\t\t\testimatedCount: recipients.length,\n\t\t\t\tsampleRecipients: recipients.slice(0, 5).map((r) => ({\n\t\t\t\t\temail: r.email,\n\t\t\t\t\tname: r.name,\n\t\t\t\t\ttype: r.type,\n\t\t\t\t})),\n\t\t\t},\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to preview audience:\", error);\n\t\treturn { success: false, error: \"Failed to preview audience\" };\n\t}\n}\n\n// ============================================================================\n// Analytics Actions\n// ============================================================================\n\n/**\n * Get campaign analytics\n */\nexport async function getCampaignAnalytics(id: string): Promise<ActionResult<{\n\ttopLinks: { url: string; linkText: string; clicks: number; uniqueClicks: number }[];\n\tdeviceBreakdown: { desktop: number; mobile: number; tablet: number };\n\thourlyOpens: { hour: string; opens: number }[];\n}>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Get link performance\n\t\tconst { data: links } = await supabase\n\t\t\t.from(\"email_campaign_links\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"campaign_id\", id)\n\t\t\t.order(\"unique_clicks\", { ascending: false })\n\t\t\t.limit(10);\n\n\t\tconst topLinks = (links || []).map((link) => ({\n\t\t\turl: link.original_url,\n\t\t\tlinkText: link.link_text || link.original_url,\n\t\t\tclicks: link.total_clicks || 0,\n\t\t\tuniqueClicks: link.unique_clicks || 0,\n\t\t}));\n\n\t\t// Get send metadata for device breakdown (from metadata JSONB)\n\t\tconst { data: sends } = await supabase\n\t\t\t.from(\"email_campaign_sends\")\n\t\t\t.select(\"metadata, first_opened_at\")\n\t\t\t.eq(\"campaign_id\", id)\n\t\t\t.not(\"first_opened_at\", \"is\", null);\n\n\t\t// Calculate device breakdown from metadata\n\t\tlet desktop = 0;\n\t\tlet mobile = 0;\n\t\tlet tablet = 0;\n\n\t\t(sends || []).forEach((send) => {\n\t\t\tconst device = (send.metadata as Record<string, unknown>)?.device as string;\n\t\t\tif (device === \"mobile\") mobile++;\n\t\t\telse if (device === \"tablet\") tablet++;\n\t\t\telse desktop++;\n\t\t});\n\n\t\tconst total = desktop + mobile + tablet || 1;\n\t\tconst deviceBreakdown = {\n\t\t\tdesktop: Math.round((desktop / total) * 100),\n\t\t\tmobile: Math.round((mobile / total) * 100),\n\t\t\ttablet: Math.round((tablet / total) * 100),\n\t\t};\n\n\t\t// Calculate hourly opens\n\t\tconst hourlyMap: Record<string, number> = {};\n\t\t(sends || []).forEach((send) => {\n\t\t\tif (send.first_opened_at) {\n\t\t\t\tconst hour = new Date(send.first_opened_at).getHours();\n\t\t\t\tconst hourLabel = hour < 12 ? `${hour || 12} AM` : `${hour === 12 ? 12 : hour - 12} PM`;\n\t\t\t\thourlyMap[hourLabel] = (hourlyMap[hourLabel] || 0) + 1;\n\t\t\t}\n\t\t});\n\n\t\tconst hourlyOpens = Object.entries(hourlyMap)\n\t\t\t.map(([hour, opens]) => ({ hour, opens }))\n\t\t\t.sort((a, b) => {\n\t\t\t\tconst parseHour = (h: string) => {\n\t\t\t\t\tconst [num, period] = h.split(\" \");\n\t\t\t\t\treturn period === \"PM\" && num !== \"12\" ? parseInt(num) + 12 : parseInt(num);\n\t\t\t\t};\n\t\t\t\treturn parseHour(a.hour) - parseHour(b.hour);\n\t\t\t});\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: { topLinks, deviceBreakdown, hourlyOpens },\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to get campaign analytics:\", error);\n\t\treturn { success: false, error: \"Failed to get campaign analytics\" };\n\t}\n}\n\n/**\n * Record a webhook event (open, click, bounce, etc.)\n * Called by Resend webhooks\n */\nexport async function recordCampaignEvent(\n\tcampaignId: string,\n\trecipientEmail: string,\n\teventType: \"delivered\" | \"opened\" | \"clicked\" | \"bounced\" | \"complained\" | \"unsubscribed\",\n\teventData?: Record<string, unknown>\n): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\t\tconst now = new Date().toISOString();\n\n\t\t// Update send record\n\t\tconst updateData: Record<string, unknown> = {\n\t\t\tupdated_at: now,\n\t\t};\n\n\t\tswitch (eventType) {\n\t\t\tcase \"delivered\":\n\t\t\t\tupdateData.status = \"delivered\";\n\t\t\t\tupdateData.delivered_at = now;\n\t\t\t\tbreak;\n\t\t\tcase \"opened\":\n\t\t\t\tupdateData.status = \"opened\";\n\t\t\t\tupdateData.last_opened_at = now;\n\t\t\t\t// Increment open count\n\t\t\t\tawait supabase.rpc(\"increment_campaign_send_open_count\", {\n\t\t\t\t\tp_campaign_id: campaignId,\n\t\t\t\t\tp_recipient_email: recipientEmail,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase \"clicked\":\n\t\t\t\tupdateData.status = \"clicked\";\n\t\t\t\tupdateData.last_clicked_at = now;\n\t\t\t\tif (eventData?.url) {\n\t\t\t\t\t// Record link click\n\t\t\t\t\tawait supabase.rpc(\"increment_campaign_link_click\", {\n\t\t\t\t\t\tp_campaign_id: campaignId,\n\t\t\t\t\t\tp_url: eventData.url,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"bounced\":\n\t\t\t\tupdateData.status = \"bounced\";\n\t\t\t\tupdateData.bounced_at = now;\n\t\t\t\tupdateData.error_message = eventData?.reason as string;\n\t\t\t\tbreak;\n\t\t\tcase \"complained\":\n\t\t\t\tupdateData.status = \"complained\";\n\t\t\t\tupdateData.complained_at = now;\n\t\t\t\tbreak;\n\t\t\tcase \"unsubscribed\":\n\t\t\t\tupdateData.unsubscribed_at = now;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tawait supabase\n\t\t\t.from(\"email_campaign_sends\")\n\t\t\t.update(updateData)\n\t\t\t.eq(\"campaign_id\", campaignId)\n\t\t\t.eq(\"recipient_email\", recipientEmail);\n\n\t\t// Update aggregate campaign stats\n\t\tawait updateCampaignStats(campaignId);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to record campaign event:\", error);\n\t\treturn { success: false, error: \"Failed to record campaign event\" };\n\t}\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/**\n * Get recipients based on audience type and filter\n */\nasync function getAudienceRecipients(\n\taudienceType: string,\n\tfilter?: AudienceFilter | null\n): Promise<{ email: string; name?: string; type: string; id?: string }[]> {\n\tconst supabase = await createClient();\n\tconst recipients: { email: string; name?: string; type: string; id?: string }[] = [];\n\n\tswitch (audienceType) {\n\t\tcase \"waitlist\": {\n\t\t\t// Get waitlist subscribers from Resend\n\t\t\tconst waitlistContacts = await getWaitlistContacts();\n\t\t\trecipients.push(...waitlistContacts.map((c) => ({\n\t\t\t\temail: c.email,\n\t\t\t\tname: c.firstName ? `${c.firstName} ${c.lastName || \"\"}`.trim() : undefined,\n\t\t\t\ttype: \"waitlist\",\n\t\t\t\tid: c.id,\n\t\t\t})));\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"all_users\": {\n\t\t\t// Get all users from the database\n\t\t\tconst { data: users } = await supabase\n\t\t\t\t.from(\"users\")\n\t\t\t\t.select(\"id, email, full_name\")\n\t\t\t\t.not(\"email\", \"is\", null);\n\n\t\t\trecipients.push(...(users || []).map((u) => ({\n\t\t\t\temail: u.email,\n\t\t\t\tname: u.full_name,\n\t\t\t\ttype: \"user\",\n\t\t\t\tid: u.id,\n\t\t\t})));\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"all_companies\": {\n\t\t\t// Get primary contacts from all companies\n\t\t\tconst { data: companies } = await supabase\n\t\t\t\t.from(\"companies\")\n\t\t\t\t.select(\"id, email, name\")\n\t\t\t\t.not(\"email\", \"is\", null);\n\n\t\t\trecipients.push(...(companies || []).map((c) => ({\n\t\t\t\temail: c.email,\n\t\t\t\tname: c.name,\n\t\t\t\ttype: \"company\",\n\t\t\t\tid: c.id,\n\t\t\t})));\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"custom\": {\n\t\t\t// Use custom email list from filter\n\t\t\tif (filter?.customEmails) {\n\t\t\t\trecipients.push(...filter.customEmails.map((email) => ({\n\t\t\t\t\temail,\n\t\t\t\t\ttype: \"custom\",\n\t\t\t\t})));\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"segment\": {\n\t\t\t// Filter users based on segment criteria\n\t\t\tlet query = supabase.from(\"users\").select(\"id, email, full_name, role\");\n\n\t\t\tif (filter?.userRoles?.length) {\n\t\t\t\tquery = query.in(\"role\", filter.userRoles);\n\t\t\t}\n\t\t\tif (filter?.userStatuses?.length) {\n\t\t\t\tquery = query.in(\"status\", filter.userStatuses);\n\t\t\t}\n\t\t\tif (filter?.createdAfter) {\n\t\t\t\tquery = query.gte(\"created_at\", filter.createdAfter);\n\t\t\t}\n\t\t\tif (filter?.createdBefore) {\n\t\t\t\tquery = query.lte(\"created_at\", filter.createdBefore);\n\t\t\t}\n\n\t\t\tconst { data: users } = await query.not(\"email\", \"is\", null);\n\t\t\trecipients.push(...(users || []).map((u) => ({\n\t\t\t\temail: u.email,\n\t\t\t\tname: u.full_name,\n\t\t\t\ttype: \"segment\",\n\t\t\t\tid: u.id,\n\t\t\t})));\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t// Apply exclusions\n\tif (filter?.excludeUnsubscribed || filter?.excludeBounced || filter?.excludeComplained) {\n\t\t// Get suppressed emails\n\t\tconst { data: suppressions } = await supabase\n\t\t\t.from(\"email_suppressions\")\n\t\t\t.select(\"email, reason\");\n\n\t\tconst suppressedEmails = new Set(\n\t\t\t(suppressions || [])\n\t\t\t\t.filter((s) => {\n\t\t\t\t\tif (filter.excludeUnsubscribed && s.reason === \"unsubscribed\") return true;\n\t\t\t\t\tif (filter.excludeBounced && s.reason === \"bounced\") return true;\n\t\t\t\t\tif (filter.excludeComplained && s.reason === \"complained\") return true;\n\t\t\t\t\treturn false;\n\t\t\t\t})\n\t\t\t\t.map((s) => s.email.toLowerCase())\n\t\t);\n\n\t\treturn recipients.filter((r) => !suppressedEmails.has(r.email.toLowerCase()));\n\t}\n\n\treturn recipients;\n}\n\n/**\n * Get waitlist contacts from Resend\n */\nasync function getWaitlistContacts(): Promise<{ id: string; email: string; firstName?: string; lastName?: string }[]> {\n\ttry {\n\t\tconst audienceId = process.env.RESEND_WAITLIST_AUDIENCE_ID;\n\t\tif (!audienceId) {\n\t\t\tconsole.warn(\"RESEND_WAITLIST_AUDIENCE_ID not configured\");\n\t\t\treturn [];\n\t\t}\n\n\t\tconst response = await resend.contacts.list({ audienceId });\n\n\t\tif (response.error) {\n\t\t\tconsole.error(\"Failed to fetch waitlist contacts:\", response.error);\n\t\t\treturn [];\n\t\t}\n\n\t\treturn (response.data?.data || []).map((contact) => ({\n\t\t\tid: contact.id,\n\t\t\temail: contact.email,\n\t\t\tfirstName: contact.first_name || undefined,\n\t\t\tlastName: contact.last_name || undefined,\n\t\t}));\n\t} catch (error) {\n\t\tconsole.error(\"Failed to fetch waitlist contacts:\", error);\n\t\treturn [];\n\t}\n}\n\n/**\n * Update aggregate campaign statistics\n */\nasync function updateCampaignStats(campaignId: string): Promise<void> {\n\tconst supabase = await createClient();\n\n\t// Get counts from sends table\n\tconst { data: stats } = await supabase\n\t\t.from(\"email_campaign_sends\")\n\t\t.select(\"status\")\n\t\t.eq(\"campaign_id\", campaignId);\n\n\tif (!stats) return;\n\n\tconst counts = {\n\t\tdelivered_count: stats.filter((s) => [\"delivered\", \"opened\", \"clicked\"].includes(s.status)).length,\n\t\topened_count: stats.filter((s) => [\"opened\", \"clicked\"].includes(s.status)).length,\n\t\tunique_opens: stats.filter((s) => [\"opened\", \"clicked\"].includes(s.status)).length,\n\t\tclicked_count: stats.filter((s) => s.status === \"clicked\").length,\n\t\tunique_clicks: stats.filter((s) => s.status === \"clicked\").length,\n\t\tbounced_count: stats.filter((s) => s.status === \"bounced\").length,\n\t\tcomplained_count: stats.filter((s) => s.status === \"complained\").length,\n\t};\n\n\tawait supabase\n\t\t.from(\"email_campaigns\")\n\t\t.update(counts)\n\t\t.eq(\"id\", campaignId);\n}\n\n/**\n * Map database row to EmailCampaign type\n */\nfunction mapCampaignFromDb(row: Record<string, unknown>): EmailCampaign {\n\treturn {\n\t\tid: row.id as string,\n\t\tname: row.name as string,\n\t\tsubject: row.subject as string,\n\t\tpreviewText: row.preview_text as string | undefined,\n\t\ttemplateId: row.template_id as string | undefined,\n\t\ttemplateData: row.template_data as Record<string, unknown> | undefined,\n\t\thtmlContent: row.html_content as string | undefined,\n\t\tplainTextContent: row.plain_text_content as string | undefined,\n\t\tstatus: row.status as EmailCampaign[\"status\"],\n\t\tscheduledFor: row.scheduled_for as string | undefined,\n\t\taudienceType: row.audience_type as EmailCampaign[\"audienceType\"],\n\t\taudienceFilter: row.audience_filter as EmailCampaign[\"audienceFilter\"],\n\t\ttotalRecipients: (row.total_recipients as number) || 0,\n\t\tsentCount: (row.sent_count as number) || 0,\n\t\tdeliveredCount: (row.delivered_count as number) || 0,\n\t\topenedCount: (row.opened_count as number) || 0,\n\t\tuniqueOpens: (row.unique_opens as number) || 0,\n\t\tclickedCount: (row.clicked_count as number) || 0,\n\t\tuniqueClicks: (row.unique_clicks as number) || 0,\n\t\tbouncedCount: (row.bounced_count as number) || 0,\n\t\tcomplainedCount: (row.complained_count as number) || 0,\n\t\tunsubscribedCount: (row.unsubscribed_count as number) || 0,\n\t\tfailedCount: (row.failed_count as number) || 0,\n\t\trevenueAttributed: Number(row.revenue_attributed || 0),\n\t\tconversionsCount: (row.conversions_count as number) || 0,\n\t\tfromName: row.from_name as string,\n\t\tfromEmail: row.from_email as string,\n\t\treplyTo: row.reply_to as string | undefined,\n\t\ttags: (row.tags as string[]) || [],\n\t\tnotes: row.notes as string | undefined,\n\t\tcreatedAt: row.created_at as string,\n\t\tupdatedAt: row.updated_at as string,\n\t\tsentAt: row.sent_at as string | undefined,\n\t};\n}\n"],"names":[],"mappings":";;;;;;;IA2DsB,iBAAA,WAAA,GAAA,IAAA,yZAAA,EAAA,8CAAA,8YAAA,EAAA,KAAA,GAAA,oZAAA,EAAA","debugId":null}},
    {"offset": {"line": 2511, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/admin/src/actions/campaigns.ts"],"sourcesContent":["\"use server\";\n\n/**\n * Campaign Server Actions\n *\n * Server-side actions for managing email marketing campaigns.\n * Handles CRUD operations, sending via Resend, scheduling, and analytics.\n */\n\nimport { revalidatePath } from \"next/cache\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { Resend } from \"resend\";\nimport type { CampaignDraft, EmailCampaign, AudienceFilter } from \"@/types/campaigns\";\n\n// Initialize Resend client\nconst resend = new Resend(process.env.RESEND_API_KEY);\n\n// Platform email configuration\nconst PLATFORM_FROM_EMAIL = process.env.RESEND_FROM_EMAIL || \"hello@thorbis.com\";\nconst PLATFORM_FROM_NAME = process.env.RESEND_FROM_NAME || \"Thorbis\";\n\n// ============================================================================\n// Types\n// ============================================================================\n\ntype ActionResult<T = void> = {\n\tsuccess: boolean;\n\tdata?: T;\n\terror?: string;\n};\n\ntype CreateCampaignInput = CampaignDraft;\n\ntype UpdateCampaignInput = Partial<CampaignDraft> & {\n\tid: string;\n};\n\ntype SendCampaignResult = {\n\tcampaignId: string;\n\trecipientCount: number;\n\testimatedCompletionTime: string;\n};\n\ntype AudiencePreviewResult = {\n\testimatedCount: number;\n\tsampleRecipients: {\n\t\temail: string;\n\t\tname?: string;\n\t\ttype: string;\n\t}[];\n};\n\n// ============================================================================\n// Campaign CRUD Actions\n// ============================================================================\n\n/**\n * Create a new campaign as a draft\n */\nexport async function createCampaign(\n\tinput: CreateCampaignInput\n): Promise<ActionResult<EmailCampaign>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.insert({\n\t\t\t\tname: input.name,\n\t\t\t\tsubject: input.subject,\n\t\t\t\tpreview_text: input.previewText,\n\t\t\t\ttemplate_id: input.templateId,\n\t\t\t\ttemplate_data: input.templateData,\n\t\t\t\thtml_content: input.htmlContent,\n\t\t\t\tplain_text_content: input.plainTextContent,\n\t\t\t\taudience_type: input.audienceType,\n\t\t\t\taudience_filter: input.audienceFilter,\n\t\t\t\tfrom_name: input.fromName || PLATFORM_FROM_NAME,\n\t\t\t\tfrom_email: input.fromEmail || PLATFORM_FROM_EMAIL,\n\t\t\t\treply_to: input.replyTo,\n\t\t\t\ttags: input.tags || [],\n\t\t\t\tnotes: input.notes,\n\t\t\t\tstatus: \"draft\",\n\t\t\t\ttotal_recipients: 0,\n\t\t\t\tsent_count: 0,\n\t\t\t\tdelivered_count: 0,\n\t\t\t\topened_count: 0,\n\t\t\t\tunique_opens: 0,\n\t\t\t\tclicked_count: 0,\n\t\t\t\tunique_clicks: 0,\n\t\t\t\tbounced_count: 0,\n\t\t\t\tcomplained_count: 0,\n\t\t\t\tunsubscribed_count: 0,\n\t\t\t\tfailed_count: 0,\n\t\t\t\trevenue_attributed: 0,\n\t\t\t\tconversions_count: 0,\n\t\t\t})\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to create campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to create campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: mapCampaignFromDb(data),\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to create campaign:\", error);\n\t\treturn { success: false, error: \"Failed to create campaign\" };\n\t}\n}\n\n/**\n * Update an existing campaign\n */\nexport async function updateCampaign(\n\tinput: UpdateCampaignInput\n): Promise<ActionResult<EmailCampaign>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Build update object with only provided fields\n\t\tconst updateData: Record<string, unknown> = {\n\t\t\tupdated_at: new Date().toISOString(),\n\t\t};\n\n\t\tif (input.name !== undefined) updateData.name = input.name;\n\t\tif (input.subject !== undefined) updateData.subject = input.subject;\n\t\tif (input.previewText !== undefined) updateData.preview_text = input.previewText;\n\t\tif (input.templateId !== undefined) updateData.template_id = input.templateId;\n\t\tif (input.templateData !== undefined) updateData.template_data = input.templateData;\n\t\tif (input.htmlContent !== undefined) updateData.html_content = input.htmlContent;\n\t\tif (input.plainTextContent !== undefined) updateData.plain_text_content = input.plainTextContent;\n\t\tif (input.audienceType !== undefined) updateData.audience_type = input.audienceType;\n\t\tif (input.audienceFilter !== undefined) updateData.audience_filter = input.audienceFilter;\n\t\tif (input.fromName !== undefined) updateData.from_name = input.fromName;\n\t\tif (input.fromEmail !== undefined) updateData.from_email = input.fromEmail;\n\t\tif (input.replyTo !== undefined) updateData.reply_to = input.replyTo;\n\t\tif (input.tags !== undefined) updateData.tags = input.tags;\n\t\tif (input.notes !== undefined) updateData.notes = input.notes;\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update(updateData)\n\t\t\t.eq(\"id\", input.id)\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to update campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to update campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${input.id}`);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: mapCampaignFromDb(data),\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to update campaign:\", error);\n\t\treturn { success: false, error: \"Failed to update campaign\" };\n\t}\n}\n\n/**\n * Delete a draft campaign\n */\nexport async function deleteCampaign(id: string): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Only allow deleting drafts\n\t\tconst { data: campaign } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.select(\"status\")\n\t\t\t.eq(\"id\", id)\n\t\t\t.single();\n\n\t\tif (campaign?.status !== \"draft\") {\n\t\t\treturn { success: false, error: \"Only draft campaigns can be deleted\" };\n\t\t}\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.delete()\n\t\t\t.eq(\"id\", id);\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to delete campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to delete campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to delete campaign:\", error);\n\t\treturn { success: false, error: \"Failed to delete campaign\" };\n\t}\n}\n\n/**\n * Duplicate an existing campaign\n */\nexport async function duplicateCampaign(id: string): Promise<ActionResult<EmailCampaign>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Fetch original campaign\n\t\tconst { data: original, error: fetchError } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"id\", id)\n\t\t\t.single();\n\n\t\tif (fetchError || !original) {\n\t\t\treturn { success: false, error: \"Campaign not found\" };\n\t\t}\n\n\t\t// Create copy with reset stats\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.insert({\n\t\t\t\tname: `${original.name} (Copy)`,\n\t\t\t\tsubject: original.subject,\n\t\t\t\tpreview_text: original.preview_text,\n\t\t\t\ttemplate_id: original.template_id,\n\t\t\t\ttemplate_data: original.template_data,\n\t\t\t\thtml_content: original.html_content,\n\t\t\t\tplain_text_content: original.plain_text_content,\n\t\t\t\taudience_type: original.audience_type,\n\t\t\t\taudience_filter: original.audience_filter,\n\t\t\t\tfrom_name: original.from_name,\n\t\t\t\tfrom_email: original.from_email,\n\t\t\t\treply_to: original.reply_to,\n\t\t\t\ttags: original.tags,\n\t\t\t\tnotes: original.notes,\n\t\t\t\tstatus: \"draft\",\n\t\t\t\ttotal_recipients: 0,\n\t\t\t\tsent_count: 0,\n\t\t\t\tdelivered_count: 0,\n\t\t\t\topened_count: 0,\n\t\t\t\tunique_opens: 0,\n\t\t\t\tclicked_count: 0,\n\t\t\t\tunique_clicks: 0,\n\t\t\t\tbounced_count: 0,\n\t\t\t\tcomplained_count: 0,\n\t\t\t\tunsubscribed_count: 0,\n\t\t\t\tfailed_count: 0,\n\t\t\t\trevenue_attributed: 0,\n\t\t\t\tconversions_count: 0,\n\t\t\t})\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to duplicate campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to duplicate campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: mapCampaignFromDb(data),\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to duplicate campaign:\", error);\n\t\treturn { success: false, error: \"Failed to duplicate campaign\" };\n\t}\n}\n\n// ============================================================================\n// Campaign Sending Actions\n// ============================================================================\n\n/**\n * Send a campaign immediately\n */\nexport async function sendCampaign(id: string): Promise<ActionResult<SendCampaignResult>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Get campaign details\n\t\tconst { data: campaign, error: fetchError } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"id\", id)\n\t\t\t.single();\n\n\t\tif (fetchError || !campaign) {\n\t\t\treturn { success: false, error: \"Campaign not found\" };\n\t\t}\n\n\t\tif (campaign.status !== \"draft\") {\n\t\t\treturn { success: false, error: \"Only draft campaigns can be sent\" };\n\t\t}\n\n\t\t// Get recipients based on audience type\n\t\tconst recipients = await getAudienceRecipients(campaign.audience_type, campaign.audience_filter);\n\n\t\tif (recipients.length === 0) {\n\t\t\treturn { success: false, error: \"No recipients found for this audience\" };\n\t\t}\n\n\t\t// Update campaign status to sending\n\t\tawait supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"sending\",\n\t\t\t\tsending_started_at: new Date().toISOString(),\n\t\t\t\ttotal_recipients: recipients.length,\n\t\t\t})\n\t\t\t.eq(\"id\", id);\n\n\t\t// Create send records for each recipient\n\t\tconst sendRecords = recipients.map((recipient) => ({\n\t\t\tcampaign_id: id,\n\t\t\trecipient_email: recipient.email,\n\t\t\trecipient_name: recipient.name,\n\t\t\trecipient_type: recipient.type,\n\t\t\trecipient_id: recipient.id,\n\t\t\tstatus: \"pending\",\n\t\t}));\n\n\t\tawait supabase.from(\"email_campaign_sends\").insert(sendRecords);\n\n\t\t// Send emails via Resend (batch processing)\n\t\tlet sentCount = 0;\n\t\tlet failedCount = 0;\n\n\t\tfor (const recipient of recipients) {\n\t\t\ttry {\n\t\t\t\tconst { data: sendResult, error: sendError } = await resend.emails.send({\n\t\t\t\t\tfrom: `${campaign.from_name} <${campaign.from_email}>`,\n\t\t\t\t\tto: recipient.email,\n\t\t\t\t\tsubject: campaign.subject,\n\t\t\t\t\thtml: campaign.html_content || `<p>${campaign.plain_text_content}</p>`,\n\t\t\t\t\ttext: campaign.plain_text_content,\n\t\t\t\t\treplyTo: campaign.reply_to,\n\t\t\t\t\ttags: [\n\t\t\t\t\t\t{ name: \"campaign_id\", value: id },\n\t\t\t\t\t\t{ name: \"recipient_type\", value: recipient.type },\n\t\t\t\t\t],\n\t\t\t\t});\n\n\t\t\t\tif (sendError) {\n\t\t\t\t\tfailedCount++;\n\t\t\t\t\t// Update send record with error\n\t\t\t\t\tawait supabase\n\t\t\t\t\t\t.from(\"email_campaign_sends\")\n\t\t\t\t\t\t.update({\n\t\t\t\t\t\t\tstatus: \"failed\",\n\t\t\t\t\t\t\terror_message: sendError.message,\n\t\t\t\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.eq(\"campaign_id\", id)\n\t\t\t\t\t\t.eq(\"recipient_email\", recipient.email);\n\t\t\t\t} else {\n\t\t\t\t\tsentCount++;\n\t\t\t\t\t// Update send record with Resend ID\n\t\t\t\t\tawait supabase\n\t\t\t\t\t\t.from(\"email_campaign_sends\")\n\t\t\t\t\t\t.update({\n\t\t\t\t\t\t\tstatus: \"sent\",\n\t\t\t\t\t\t\tresend_id: sendResult?.id,\n\t\t\t\t\t\t\tsent_at: new Date().toISOString(),\n\t\t\t\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.eq(\"campaign_id\", id)\n\t\t\t\t\t\t.eq(\"recipient_email\", recipient.email);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tfailedCount++;\n\t\t\t\tconsole.error(`Failed to send to ${recipient.email}:`, err);\n\t\t\t}\n\t\t}\n\n\t\t// Update campaign with final stats\n\t\tawait supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"sent\",\n\t\t\t\tsent_at: new Date().toISOString(),\n\t\t\t\tcompleted_at: new Date().toISOString(),\n\t\t\t\tsent_count: sentCount,\n\t\t\t\tfailed_count: failedCount,\n\t\t\t})\n\t\t\t.eq(\"id\", id);\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: {\n\t\t\t\tcampaignId: id,\n\t\t\t\trecipientCount: recipients.length,\n\t\t\t\testimatedCompletionTime: new Date().toISOString(),\n\t\t\t},\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to send campaign:\", error);\n\t\treturn { success: false, error: \"Failed to send campaign\" };\n\t}\n}\n\n/**\n * Schedule a campaign for later\n */\nexport async function scheduleCampaign(\n\tid: string,\n\tscheduledFor: string\n): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Validate campaign is in draft status\n\t\tconst { data: campaign } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.select(\"status, audience_type, audience_filter\")\n\t\t\t.eq(\"id\", id)\n\t\t\t.single();\n\n\t\tif (campaign?.status !== \"draft\") {\n\t\t\treturn { success: false, error: \"Only draft campaigns can be scheduled\" };\n\t\t}\n\n\t\t// Get recipient count for the campaign\n\t\tconst recipients = await getAudienceRecipients(campaign.audience_type, campaign.audience_filter);\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"scheduled\",\n\t\t\t\tscheduled_for: scheduledFor,\n\t\t\t\ttotal_recipients: recipients.length,\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", id);\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to schedule campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to schedule campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to schedule campaign:\", error);\n\t\treturn { success: false, error: \"Failed to schedule campaign\" };\n\t}\n}\n\n/**\n * Cancel a scheduled campaign\n */\nexport async function cancelScheduledCampaign(id: string): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"draft\",\n\t\t\t\tscheduled_for: null,\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", id)\n\t\t\t.eq(\"status\", \"scheduled\");\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to cancel scheduled campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to cancel scheduled campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to cancel scheduled campaign:\", error);\n\t\treturn { success: false, error: \"Failed to cancel scheduled campaign\" };\n\t}\n}\n\n/**\n * Pause a sending campaign\n */\nexport async function pauseCampaign(id: string): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"paused\",\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", id)\n\t\t\t.eq(\"status\", \"sending\");\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to pause campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to pause campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to pause campaign:\", error);\n\t\treturn { success: false, error: \"Failed to pause campaign\" };\n\t}\n}\n\n/**\n * Resume a paused campaign\n */\nexport async function resumeCampaign(id: string): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"sending\",\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", id)\n\t\t\t.eq(\"status\", \"paused\");\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to resume campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to resume campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to resume campaign:\", error);\n\t\treturn { success: false, error: \"Failed to resume campaign\" };\n\t}\n}\n\n// ============================================================================\n// Audience Actions\n// ============================================================================\n\n/**\n * Preview audience based on filters\n * Returns estimated count and sample recipients\n */\nexport async function previewAudience(\n\taudienceType: string,\n\tfilter?: AudienceFilter\n): Promise<ActionResult<AudiencePreviewResult>> {\n\ttry {\n\t\tconst recipients = await getAudienceRecipients(audienceType, filter);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: {\n\t\t\t\testimatedCount: recipients.length,\n\t\t\t\tsampleRecipients: recipients.slice(0, 5).map((r) => ({\n\t\t\t\t\temail: r.email,\n\t\t\t\t\tname: r.name,\n\t\t\t\t\ttype: r.type,\n\t\t\t\t})),\n\t\t\t},\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to preview audience:\", error);\n\t\treturn { success: false, error: \"Failed to preview audience\" };\n\t}\n}\n\n// ============================================================================\n// Analytics Actions\n// ============================================================================\n\n/**\n * Get campaign analytics\n */\nexport async function getCampaignAnalytics(id: string): Promise<ActionResult<{\n\ttopLinks: { url: string; linkText: string; clicks: number; uniqueClicks: number }[];\n\tdeviceBreakdown: { desktop: number; mobile: number; tablet: number };\n\thourlyOpens: { hour: string; opens: number }[];\n}>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Get link performance\n\t\tconst { data: links } = await supabase\n\t\t\t.from(\"email_campaign_links\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"campaign_id\", id)\n\t\t\t.order(\"unique_clicks\", { ascending: false })\n\t\t\t.limit(10);\n\n\t\tconst topLinks = (links || []).map((link) => ({\n\t\t\turl: link.original_url,\n\t\t\tlinkText: link.link_text || link.original_url,\n\t\t\tclicks: link.total_clicks || 0,\n\t\t\tuniqueClicks: link.unique_clicks || 0,\n\t\t}));\n\n\t\t// Get send metadata for device breakdown (from metadata JSONB)\n\t\tconst { data: sends } = await supabase\n\t\t\t.from(\"email_campaign_sends\")\n\t\t\t.select(\"metadata, first_opened_at\")\n\t\t\t.eq(\"campaign_id\", id)\n\t\t\t.not(\"first_opened_at\", \"is\", null);\n\n\t\t// Calculate device breakdown from metadata\n\t\tlet desktop = 0;\n\t\tlet mobile = 0;\n\t\tlet tablet = 0;\n\n\t\t(sends || []).forEach((send) => {\n\t\t\tconst device = (send.metadata as Record<string, unknown>)?.device as string;\n\t\t\tif (device === \"mobile\") mobile++;\n\t\t\telse if (device === \"tablet\") tablet++;\n\t\t\telse desktop++;\n\t\t});\n\n\t\tconst total = desktop + mobile + tablet || 1;\n\t\tconst deviceBreakdown = {\n\t\t\tdesktop: Math.round((desktop / total) * 100),\n\t\t\tmobile: Math.round((mobile / total) * 100),\n\t\t\ttablet: Math.round((tablet / total) * 100),\n\t\t};\n\n\t\t// Calculate hourly opens\n\t\tconst hourlyMap: Record<string, number> = {};\n\t\t(sends || []).forEach((send) => {\n\t\t\tif (send.first_opened_at) {\n\t\t\t\tconst hour = new Date(send.first_opened_at).getHours();\n\t\t\t\tconst hourLabel = hour < 12 ? `${hour || 12} AM` : `${hour === 12 ? 12 : hour - 12} PM`;\n\t\t\t\thourlyMap[hourLabel] = (hourlyMap[hourLabel] || 0) + 1;\n\t\t\t}\n\t\t});\n\n\t\tconst hourlyOpens = Object.entries(hourlyMap)\n\t\t\t.map(([hour, opens]) => ({ hour, opens }))\n\t\t\t.sort((a, b) => {\n\t\t\t\tconst parseHour = (h: string) => {\n\t\t\t\t\tconst [num, period] = h.split(\" \");\n\t\t\t\t\treturn period === \"PM\" && num !== \"12\" ? parseInt(num) + 12 : parseInt(num);\n\t\t\t\t};\n\t\t\t\treturn parseHour(a.hour) - parseHour(b.hour);\n\t\t\t});\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: { topLinks, deviceBreakdown, hourlyOpens },\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to get campaign analytics:\", error);\n\t\treturn { success: false, error: \"Failed to get campaign analytics\" };\n\t}\n}\n\n/**\n * Record a webhook event (open, click, bounce, etc.)\n * Called by Resend webhooks\n */\nexport async function recordCampaignEvent(\n\tcampaignId: string,\n\trecipientEmail: string,\n\teventType: \"delivered\" | \"opened\" | \"clicked\" | \"bounced\" | \"complained\" | \"unsubscribed\",\n\teventData?: Record<string, unknown>\n): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\t\tconst now = new Date().toISOString();\n\n\t\t// Update send record\n\t\tconst updateData: Record<string, unknown> = {\n\t\t\tupdated_at: now,\n\t\t};\n\n\t\tswitch (eventType) {\n\t\t\tcase \"delivered\":\n\t\t\t\tupdateData.status = \"delivered\";\n\t\t\t\tupdateData.delivered_at = now;\n\t\t\t\tbreak;\n\t\t\tcase \"opened\":\n\t\t\t\tupdateData.status = \"opened\";\n\t\t\t\tupdateData.last_opened_at = now;\n\t\t\t\t// Increment open count\n\t\t\t\tawait supabase.rpc(\"increment_campaign_send_open_count\", {\n\t\t\t\t\tp_campaign_id: campaignId,\n\t\t\t\t\tp_recipient_email: recipientEmail,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase \"clicked\":\n\t\t\t\tupdateData.status = \"clicked\";\n\t\t\t\tupdateData.last_clicked_at = now;\n\t\t\t\tif (eventData?.url) {\n\t\t\t\t\t// Record link click\n\t\t\t\t\tawait supabase.rpc(\"increment_campaign_link_click\", {\n\t\t\t\t\t\tp_campaign_id: campaignId,\n\t\t\t\t\t\tp_url: eventData.url,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"bounced\":\n\t\t\t\tupdateData.status = \"bounced\";\n\t\t\t\tupdateData.bounced_at = now;\n\t\t\t\tupdateData.error_message = eventData?.reason as string;\n\t\t\t\tbreak;\n\t\t\tcase \"complained\":\n\t\t\t\tupdateData.status = \"complained\";\n\t\t\t\tupdateData.complained_at = now;\n\t\t\t\tbreak;\n\t\t\tcase \"unsubscribed\":\n\t\t\t\tupdateData.unsubscribed_at = now;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tawait supabase\n\t\t\t.from(\"email_campaign_sends\")\n\t\t\t.update(updateData)\n\t\t\t.eq(\"campaign_id\", campaignId)\n\t\t\t.eq(\"recipient_email\", recipientEmail);\n\n\t\t// Update aggregate campaign stats\n\t\tawait updateCampaignStats(campaignId);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to record campaign event:\", error);\n\t\treturn { success: false, error: \"Failed to record campaign event\" };\n\t}\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/**\n * Get recipients based on audience type and filter\n */\nasync function getAudienceRecipients(\n\taudienceType: string,\n\tfilter?: AudienceFilter | null\n): Promise<{ email: string; name?: string; type: string; id?: string }[]> {\n\tconst supabase = await createClient();\n\tconst recipients: { email: string; name?: string; type: string; id?: string }[] = [];\n\n\tswitch (audienceType) {\n\t\tcase \"waitlist\": {\n\t\t\t// Get waitlist subscribers from Resend\n\t\t\tconst waitlistContacts = await getWaitlistContacts();\n\t\t\trecipients.push(...waitlistContacts.map((c) => ({\n\t\t\t\temail: c.email,\n\t\t\t\tname: c.firstName ? `${c.firstName} ${c.lastName || \"\"}`.trim() : undefined,\n\t\t\t\ttype: \"waitlist\",\n\t\t\t\tid: c.id,\n\t\t\t})));\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"all_users\": {\n\t\t\t// Get all users from the database\n\t\t\tconst { data: users } = await supabase\n\t\t\t\t.from(\"users\")\n\t\t\t\t.select(\"id, email, full_name\")\n\t\t\t\t.not(\"email\", \"is\", null);\n\n\t\t\trecipients.push(...(users || []).map((u) => ({\n\t\t\t\temail: u.email,\n\t\t\t\tname: u.full_name,\n\t\t\t\ttype: \"user\",\n\t\t\t\tid: u.id,\n\t\t\t})));\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"all_companies\": {\n\t\t\t// Get primary contacts from all companies\n\t\t\tconst { data: companies } = await supabase\n\t\t\t\t.from(\"companies\")\n\t\t\t\t.select(\"id, email, name\")\n\t\t\t\t.not(\"email\", \"is\", null);\n\n\t\t\trecipients.push(...(companies || []).map((c) => ({\n\t\t\t\temail: c.email,\n\t\t\t\tname: c.name,\n\t\t\t\ttype: \"company\",\n\t\t\t\tid: c.id,\n\t\t\t})));\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"custom\": {\n\t\t\t// Use custom email list from filter\n\t\t\tif (filter?.customEmails) {\n\t\t\t\trecipients.push(...filter.customEmails.map((email) => ({\n\t\t\t\t\temail,\n\t\t\t\t\ttype: \"custom\",\n\t\t\t\t})));\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"segment\": {\n\t\t\t// Filter users based on segment criteria\n\t\t\tlet query = supabase.from(\"users\").select(\"id, email, full_name, role\");\n\n\t\t\tif (filter?.userRoles?.length) {\n\t\t\t\tquery = query.in(\"role\", filter.userRoles);\n\t\t\t}\n\t\t\tif (filter?.userStatuses?.length) {\n\t\t\t\tquery = query.in(\"status\", filter.userStatuses);\n\t\t\t}\n\t\t\tif (filter?.createdAfter) {\n\t\t\t\tquery = query.gte(\"created_at\", filter.createdAfter);\n\t\t\t}\n\t\t\tif (filter?.createdBefore) {\n\t\t\t\tquery = query.lte(\"created_at\", filter.createdBefore);\n\t\t\t}\n\n\t\t\tconst { data: users } = await query.not(\"email\", \"is\", null);\n\t\t\trecipients.push(...(users || []).map((u) => ({\n\t\t\t\temail: u.email,\n\t\t\t\tname: u.full_name,\n\t\t\t\ttype: \"segment\",\n\t\t\t\tid: u.id,\n\t\t\t})));\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t// Apply exclusions\n\tif (filter?.excludeUnsubscribed || filter?.excludeBounced || filter?.excludeComplained) {\n\t\t// Get suppressed emails\n\t\tconst { data: suppressions } = await supabase\n\t\t\t.from(\"email_suppressions\")\n\t\t\t.select(\"email, reason\");\n\n\t\tconst suppressedEmails = new Set(\n\t\t\t(suppressions || [])\n\t\t\t\t.filter((s) => {\n\t\t\t\t\tif (filter.excludeUnsubscribed && s.reason === \"unsubscribed\") return true;\n\t\t\t\t\tif (filter.excludeBounced && s.reason === \"bounced\") return true;\n\t\t\t\t\tif (filter.excludeComplained && s.reason === \"complained\") return true;\n\t\t\t\t\treturn false;\n\t\t\t\t})\n\t\t\t\t.map((s) => s.email.toLowerCase())\n\t\t);\n\n\t\treturn recipients.filter((r) => !suppressedEmails.has(r.email.toLowerCase()));\n\t}\n\n\treturn recipients;\n}\n\n/**\n * Get waitlist contacts from Resend\n */\nasync function getWaitlistContacts(): Promise<{ id: string; email: string; firstName?: string; lastName?: string }[]> {\n\ttry {\n\t\tconst audienceId = process.env.RESEND_WAITLIST_AUDIENCE_ID;\n\t\tif (!audienceId) {\n\t\t\tconsole.warn(\"RESEND_WAITLIST_AUDIENCE_ID not configured\");\n\t\t\treturn [];\n\t\t}\n\n\t\tconst response = await resend.contacts.list({ audienceId });\n\n\t\tif (response.error) {\n\t\t\tconsole.error(\"Failed to fetch waitlist contacts:\", response.error);\n\t\t\treturn [];\n\t\t}\n\n\t\treturn (response.data?.data || []).map((contact) => ({\n\t\t\tid: contact.id,\n\t\t\temail: contact.email,\n\t\t\tfirstName: contact.first_name || undefined,\n\t\t\tlastName: contact.last_name || undefined,\n\t\t}));\n\t} catch (error) {\n\t\tconsole.error(\"Failed to fetch waitlist contacts:\", error);\n\t\treturn [];\n\t}\n}\n\n/**\n * Update aggregate campaign statistics\n */\nasync function updateCampaignStats(campaignId: string): Promise<void> {\n\tconst supabase = await createClient();\n\n\t// Get counts from sends table\n\tconst { data: stats } = await supabase\n\t\t.from(\"email_campaign_sends\")\n\t\t.select(\"status\")\n\t\t.eq(\"campaign_id\", campaignId);\n\n\tif (!stats) return;\n\n\tconst counts = {\n\t\tdelivered_count: stats.filter((s) => [\"delivered\", \"opened\", \"clicked\"].includes(s.status)).length,\n\t\topened_count: stats.filter((s) => [\"opened\", \"clicked\"].includes(s.status)).length,\n\t\tunique_opens: stats.filter((s) => [\"opened\", \"clicked\"].includes(s.status)).length,\n\t\tclicked_count: stats.filter((s) => s.status === \"clicked\").length,\n\t\tunique_clicks: stats.filter((s) => s.status === \"clicked\").length,\n\t\tbounced_count: stats.filter((s) => s.status === \"bounced\").length,\n\t\tcomplained_count: stats.filter((s) => s.status === \"complained\").length,\n\t};\n\n\tawait supabase\n\t\t.from(\"email_campaigns\")\n\t\t.update(counts)\n\t\t.eq(\"id\", campaignId);\n}\n\n/**\n * Map database row to EmailCampaign type\n */\nfunction mapCampaignFromDb(row: Record<string, unknown>): EmailCampaign {\n\treturn {\n\t\tid: row.id as string,\n\t\tname: row.name as string,\n\t\tsubject: row.subject as string,\n\t\tpreviewText: row.preview_text as string | undefined,\n\t\ttemplateId: row.template_id as string | undefined,\n\t\ttemplateData: row.template_data as Record<string, unknown> | undefined,\n\t\thtmlContent: row.html_content as string | undefined,\n\t\tplainTextContent: row.plain_text_content as string | undefined,\n\t\tstatus: row.status as EmailCampaign[\"status\"],\n\t\tscheduledFor: row.scheduled_for as string | undefined,\n\t\taudienceType: row.audience_type as EmailCampaign[\"audienceType\"],\n\t\taudienceFilter: row.audience_filter as EmailCampaign[\"audienceFilter\"],\n\t\ttotalRecipients: (row.total_recipients as number) || 0,\n\t\tsentCount: (row.sent_count as number) || 0,\n\t\tdeliveredCount: (row.delivered_count as number) || 0,\n\t\topenedCount: (row.opened_count as number) || 0,\n\t\tuniqueOpens: (row.unique_opens as number) || 0,\n\t\tclickedCount: (row.clicked_count as number) || 0,\n\t\tuniqueClicks: (row.unique_clicks as number) || 0,\n\t\tbouncedCount: (row.bounced_count as number) || 0,\n\t\tcomplainedCount: (row.complained_count as number) || 0,\n\t\tunsubscribedCount: (row.unsubscribed_count as number) || 0,\n\t\tfailedCount: (row.failed_count as number) || 0,\n\t\trevenueAttributed: Number(row.revenue_attributed || 0),\n\t\tconversionsCount: (row.conversions_count as number) || 0,\n\t\tfromName: row.from_name as string,\n\t\tfromEmail: row.from_email as string,\n\t\treplyTo: row.reply_to as string | undefined,\n\t\ttags: (row.tags as string[]) || [],\n\t\tnotes: row.notes as string | undefined,\n\t\tcreatedAt: row.created_at as string,\n\t\tupdatedAt: row.updated_at as string,\n\t\tsentAt: row.sent_at as string | undefined,\n\t};\n}\n"],"names":[],"mappings":";;;;;;;IA8RsB,eAAA,WAAA,GAAA,IAAA,yZAAA,EAAA,8CAAA,8YAAA,EAAA,KAAA,GAAA,oZAAA,EAAA","debugId":null}},
    {"offset": {"line": 2526, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/admin/src/actions/campaigns.ts"],"sourcesContent":["\"use server\";\n\n/**\n * Campaign Server Actions\n *\n * Server-side actions for managing email marketing campaigns.\n * Handles CRUD operations, sending via Resend, scheduling, and analytics.\n */\n\nimport { revalidatePath } from \"next/cache\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { Resend } from \"resend\";\nimport type { CampaignDraft, EmailCampaign, AudienceFilter } from \"@/types/campaigns\";\n\n// Initialize Resend client\nconst resend = new Resend(process.env.RESEND_API_KEY);\n\n// Platform email configuration\nconst PLATFORM_FROM_EMAIL = process.env.RESEND_FROM_EMAIL || \"hello@thorbis.com\";\nconst PLATFORM_FROM_NAME = process.env.RESEND_FROM_NAME || \"Thorbis\";\n\n// ============================================================================\n// Types\n// ============================================================================\n\ntype ActionResult<T = void> = {\n\tsuccess: boolean;\n\tdata?: T;\n\terror?: string;\n};\n\ntype CreateCampaignInput = CampaignDraft;\n\ntype UpdateCampaignInput = Partial<CampaignDraft> & {\n\tid: string;\n};\n\ntype SendCampaignResult = {\n\tcampaignId: string;\n\trecipientCount: number;\n\testimatedCompletionTime: string;\n};\n\ntype AudiencePreviewResult = {\n\testimatedCount: number;\n\tsampleRecipients: {\n\t\temail: string;\n\t\tname?: string;\n\t\ttype: string;\n\t}[];\n};\n\n// ============================================================================\n// Campaign CRUD Actions\n// ============================================================================\n\n/**\n * Create a new campaign as a draft\n */\nexport async function createCampaign(\n\tinput: CreateCampaignInput\n): Promise<ActionResult<EmailCampaign>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.insert({\n\t\t\t\tname: input.name,\n\t\t\t\tsubject: input.subject,\n\t\t\t\tpreview_text: input.previewText,\n\t\t\t\ttemplate_id: input.templateId,\n\t\t\t\ttemplate_data: input.templateData,\n\t\t\t\thtml_content: input.htmlContent,\n\t\t\t\tplain_text_content: input.plainTextContent,\n\t\t\t\taudience_type: input.audienceType,\n\t\t\t\taudience_filter: input.audienceFilter,\n\t\t\t\tfrom_name: input.fromName || PLATFORM_FROM_NAME,\n\t\t\t\tfrom_email: input.fromEmail || PLATFORM_FROM_EMAIL,\n\t\t\t\treply_to: input.replyTo,\n\t\t\t\ttags: input.tags || [],\n\t\t\t\tnotes: input.notes,\n\t\t\t\tstatus: \"draft\",\n\t\t\t\ttotal_recipients: 0,\n\t\t\t\tsent_count: 0,\n\t\t\t\tdelivered_count: 0,\n\t\t\t\topened_count: 0,\n\t\t\t\tunique_opens: 0,\n\t\t\t\tclicked_count: 0,\n\t\t\t\tunique_clicks: 0,\n\t\t\t\tbounced_count: 0,\n\t\t\t\tcomplained_count: 0,\n\t\t\t\tunsubscribed_count: 0,\n\t\t\t\tfailed_count: 0,\n\t\t\t\trevenue_attributed: 0,\n\t\t\t\tconversions_count: 0,\n\t\t\t})\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to create campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to create campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: mapCampaignFromDb(data),\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to create campaign:\", error);\n\t\treturn { success: false, error: \"Failed to create campaign\" };\n\t}\n}\n\n/**\n * Update an existing campaign\n */\nexport async function updateCampaign(\n\tinput: UpdateCampaignInput\n): Promise<ActionResult<EmailCampaign>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Build update object with only provided fields\n\t\tconst updateData: Record<string, unknown> = {\n\t\t\tupdated_at: new Date().toISOString(),\n\t\t};\n\n\t\tif (input.name !== undefined) updateData.name = input.name;\n\t\tif (input.subject !== undefined) updateData.subject = input.subject;\n\t\tif (input.previewText !== undefined) updateData.preview_text = input.previewText;\n\t\tif (input.templateId !== undefined) updateData.template_id = input.templateId;\n\t\tif (input.templateData !== undefined) updateData.template_data = input.templateData;\n\t\tif (input.htmlContent !== undefined) updateData.html_content = input.htmlContent;\n\t\tif (input.plainTextContent !== undefined) updateData.plain_text_content = input.plainTextContent;\n\t\tif (input.audienceType !== undefined) updateData.audience_type = input.audienceType;\n\t\tif (input.audienceFilter !== undefined) updateData.audience_filter = input.audienceFilter;\n\t\tif (input.fromName !== undefined) updateData.from_name = input.fromName;\n\t\tif (input.fromEmail !== undefined) updateData.from_email = input.fromEmail;\n\t\tif (input.replyTo !== undefined) updateData.reply_to = input.replyTo;\n\t\tif (input.tags !== undefined) updateData.tags = input.tags;\n\t\tif (input.notes !== undefined) updateData.notes = input.notes;\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update(updateData)\n\t\t\t.eq(\"id\", input.id)\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to update campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to update campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${input.id}`);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: mapCampaignFromDb(data),\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to update campaign:\", error);\n\t\treturn { success: false, error: \"Failed to update campaign\" };\n\t}\n}\n\n/**\n * Delete a draft campaign\n */\nexport async function deleteCampaign(id: string): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Only allow deleting drafts\n\t\tconst { data: campaign } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.select(\"status\")\n\t\t\t.eq(\"id\", id)\n\t\t\t.single();\n\n\t\tif (campaign?.status !== \"draft\") {\n\t\t\treturn { success: false, error: \"Only draft campaigns can be deleted\" };\n\t\t}\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.delete()\n\t\t\t.eq(\"id\", id);\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to delete campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to delete campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to delete campaign:\", error);\n\t\treturn { success: false, error: \"Failed to delete campaign\" };\n\t}\n}\n\n/**\n * Duplicate an existing campaign\n */\nexport async function duplicateCampaign(id: string): Promise<ActionResult<EmailCampaign>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Fetch original campaign\n\t\tconst { data: original, error: fetchError } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"id\", id)\n\t\t\t.single();\n\n\t\tif (fetchError || !original) {\n\t\t\treturn { success: false, error: \"Campaign not found\" };\n\t\t}\n\n\t\t// Create copy with reset stats\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.insert({\n\t\t\t\tname: `${original.name} (Copy)`,\n\t\t\t\tsubject: original.subject,\n\t\t\t\tpreview_text: original.preview_text,\n\t\t\t\ttemplate_id: original.template_id,\n\t\t\t\ttemplate_data: original.template_data,\n\t\t\t\thtml_content: original.html_content,\n\t\t\t\tplain_text_content: original.plain_text_content,\n\t\t\t\taudience_type: original.audience_type,\n\t\t\t\taudience_filter: original.audience_filter,\n\t\t\t\tfrom_name: original.from_name,\n\t\t\t\tfrom_email: original.from_email,\n\t\t\t\treply_to: original.reply_to,\n\t\t\t\ttags: original.tags,\n\t\t\t\tnotes: original.notes,\n\t\t\t\tstatus: \"draft\",\n\t\t\t\ttotal_recipients: 0,\n\t\t\t\tsent_count: 0,\n\t\t\t\tdelivered_count: 0,\n\t\t\t\topened_count: 0,\n\t\t\t\tunique_opens: 0,\n\t\t\t\tclicked_count: 0,\n\t\t\t\tunique_clicks: 0,\n\t\t\t\tbounced_count: 0,\n\t\t\t\tcomplained_count: 0,\n\t\t\t\tunsubscribed_count: 0,\n\t\t\t\tfailed_count: 0,\n\t\t\t\trevenue_attributed: 0,\n\t\t\t\tconversions_count: 0,\n\t\t\t})\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to duplicate campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to duplicate campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: mapCampaignFromDb(data),\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to duplicate campaign:\", error);\n\t\treturn { success: false, error: \"Failed to duplicate campaign\" };\n\t}\n}\n\n// ============================================================================\n// Campaign Sending Actions\n// ============================================================================\n\n/**\n * Send a campaign immediately\n */\nexport async function sendCampaign(id: string): Promise<ActionResult<SendCampaignResult>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Get campaign details\n\t\tconst { data: campaign, error: fetchError } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"id\", id)\n\t\t\t.single();\n\n\t\tif (fetchError || !campaign) {\n\t\t\treturn { success: false, error: \"Campaign not found\" };\n\t\t}\n\n\t\tif (campaign.status !== \"draft\") {\n\t\t\treturn { success: false, error: \"Only draft campaigns can be sent\" };\n\t\t}\n\n\t\t// Get recipients based on audience type\n\t\tconst recipients = await getAudienceRecipients(campaign.audience_type, campaign.audience_filter);\n\n\t\tif (recipients.length === 0) {\n\t\t\treturn { success: false, error: \"No recipients found for this audience\" };\n\t\t}\n\n\t\t// Update campaign status to sending\n\t\tawait supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"sending\",\n\t\t\t\tsending_started_at: new Date().toISOString(),\n\t\t\t\ttotal_recipients: recipients.length,\n\t\t\t})\n\t\t\t.eq(\"id\", id);\n\n\t\t// Create send records for each recipient\n\t\tconst sendRecords = recipients.map((recipient) => ({\n\t\t\tcampaign_id: id,\n\t\t\trecipient_email: recipient.email,\n\t\t\trecipient_name: recipient.name,\n\t\t\trecipient_type: recipient.type,\n\t\t\trecipient_id: recipient.id,\n\t\t\tstatus: \"pending\",\n\t\t}));\n\n\t\tawait supabase.from(\"email_campaign_sends\").insert(sendRecords);\n\n\t\t// Send emails via Resend (batch processing)\n\t\tlet sentCount = 0;\n\t\tlet failedCount = 0;\n\n\t\tfor (const recipient of recipients) {\n\t\t\ttry {\n\t\t\t\tconst { data: sendResult, error: sendError } = await resend.emails.send({\n\t\t\t\t\tfrom: `${campaign.from_name} <${campaign.from_email}>`,\n\t\t\t\t\tto: recipient.email,\n\t\t\t\t\tsubject: campaign.subject,\n\t\t\t\t\thtml: campaign.html_content || `<p>${campaign.plain_text_content}</p>`,\n\t\t\t\t\ttext: campaign.plain_text_content,\n\t\t\t\t\treplyTo: campaign.reply_to,\n\t\t\t\t\ttags: [\n\t\t\t\t\t\t{ name: \"campaign_id\", value: id },\n\t\t\t\t\t\t{ name: \"recipient_type\", value: recipient.type },\n\t\t\t\t\t],\n\t\t\t\t});\n\n\t\t\t\tif (sendError) {\n\t\t\t\t\tfailedCount++;\n\t\t\t\t\t// Update send record with error\n\t\t\t\t\tawait supabase\n\t\t\t\t\t\t.from(\"email_campaign_sends\")\n\t\t\t\t\t\t.update({\n\t\t\t\t\t\t\tstatus: \"failed\",\n\t\t\t\t\t\t\terror_message: sendError.message,\n\t\t\t\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.eq(\"campaign_id\", id)\n\t\t\t\t\t\t.eq(\"recipient_email\", recipient.email);\n\t\t\t\t} else {\n\t\t\t\t\tsentCount++;\n\t\t\t\t\t// Update send record with Resend ID\n\t\t\t\t\tawait supabase\n\t\t\t\t\t\t.from(\"email_campaign_sends\")\n\t\t\t\t\t\t.update({\n\t\t\t\t\t\t\tstatus: \"sent\",\n\t\t\t\t\t\t\tresend_id: sendResult?.id,\n\t\t\t\t\t\t\tsent_at: new Date().toISOString(),\n\t\t\t\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.eq(\"campaign_id\", id)\n\t\t\t\t\t\t.eq(\"recipient_email\", recipient.email);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tfailedCount++;\n\t\t\t\tconsole.error(`Failed to send to ${recipient.email}:`, err);\n\t\t\t}\n\t\t}\n\n\t\t// Update campaign with final stats\n\t\tawait supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"sent\",\n\t\t\t\tsent_at: new Date().toISOString(),\n\t\t\t\tcompleted_at: new Date().toISOString(),\n\t\t\t\tsent_count: sentCount,\n\t\t\t\tfailed_count: failedCount,\n\t\t\t})\n\t\t\t.eq(\"id\", id);\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: {\n\t\t\t\tcampaignId: id,\n\t\t\t\trecipientCount: recipients.length,\n\t\t\t\testimatedCompletionTime: new Date().toISOString(),\n\t\t\t},\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to send campaign:\", error);\n\t\treturn { success: false, error: \"Failed to send campaign\" };\n\t}\n}\n\n/**\n * Schedule a campaign for later\n */\nexport async function scheduleCampaign(\n\tid: string,\n\tscheduledFor: string\n): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Validate campaign is in draft status\n\t\tconst { data: campaign } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.select(\"status, audience_type, audience_filter\")\n\t\t\t.eq(\"id\", id)\n\t\t\t.single();\n\n\t\tif (campaign?.status !== \"draft\") {\n\t\t\treturn { success: false, error: \"Only draft campaigns can be scheduled\" };\n\t\t}\n\n\t\t// Get recipient count for the campaign\n\t\tconst recipients = await getAudienceRecipients(campaign.audience_type, campaign.audience_filter);\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"scheduled\",\n\t\t\t\tscheduled_for: scheduledFor,\n\t\t\t\ttotal_recipients: recipients.length,\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", id);\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to schedule campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to schedule campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to schedule campaign:\", error);\n\t\treturn { success: false, error: \"Failed to schedule campaign\" };\n\t}\n}\n\n/**\n * Cancel a scheduled campaign\n */\nexport async function cancelScheduledCampaign(id: string): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"draft\",\n\t\t\t\tscheduled_for: null,\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", id)\n\t\t\t.eq(\"status\", \"scheduled\");\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to cancel scheduled campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to cancel scheduled campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to cancel scheduled campaign:\", error);\n\t\treturn { success: false, error: \"Failed to cancel scheduled campaign\" };\n\t}\n}\n\n/**\n * Pause a sending campaign\n */\nexport async function pauseCampaign(id: string): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"paused\",\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", id)\n\t\t\t.eq(\"status\", \"sending\");\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to pause campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to pause campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to pause campaign:\", error);\n\t\treturn { success: false, error: \"Failed to pause campaign\" };\n\t}\n}\n\n/**\n * Resume a paused campaign\n */\nexport async function resumeCampaign(id: string): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"sending\",\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", id)\n\t\t\t.eq(\"status\", \"paused\");\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to resume campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to resume campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to resume campaign:\", error);\n\t\treturn { success: false, error: \"Failed to resume campaign\" };\n\t}\n}\n\n// ============================================================================\n// Audience Actions\n// ============================================================================\n\n/**\n * Preview audience based on filters\n * Returns estimated count and sample recipients\n */\nexport async function previewAudience(\n\taudienceType: string,\n\tfilter?: AudienceFilter\n): Promise<ActionResult<AudiencePreviewResult>> {\n\ttry {\n\t\tconst recipients = await getAudienceRecipients(audienceType, filter);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: {\n\t\t\t\testimatedCount: recipients.length,\n\t\t\t\tsampleRecipients: recipients.slice(0, 5).map((r) => ({\n\t\t\t\t\temail: r.email,\n\t\t\t\t\tname: r.name,\n\t\t\t\t\ttype: r.type,\n\t\t\t\t})),\n\t\t\t},\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to preview audience:\", error);\n\t\treturn { success: false, error: \"Failed to preview audience\" };\n\t}\n}\n\n// ============================================================================\n// Analytics Actions\n// ============================================================================\n\n/**\n * Get campaign analytics\n */\nexport async function getCampaignAnalytics(id: string): Promise<ActionResult<{\n\ttopLinks: { url: string; linkText: string; clicks: number; uniqueClicks: number }[];\n\tdeviceBreakdown: { desktop: number; mobile: number; tablet: number };\n\thourlyOpens: { hour: string; opens: number }[];\n}>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Get link performance\n\t\tconst { data: links } = await supabase\n\t\t\t.from(\"email_campaign_links\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"campaign_id\", id)\n\t\t\t.order(\"unique_clicks\", { ascending: false })\n\t\t\t.limit(10);\n\n\t\tconst topLinks = (links || []).map((link) => ({\n\t\t\turl: link.original_url,\n\t\t\tlinkText: link.link_text || link.original_url,\n\t\t\tclicks: link.total_clicks || 0,\n\t\t\tuniqueClicks: link.unique_clicks || 0,\n\t\t}));\n\n\t\t// Get send metadata for device breakdown (from metadata JSONB)\n\t\tconst { data: sends } = await supabase\n\t\t\t.from(\"email_campaign_sends\")\n\t\t\t.select(\"metadata, first_opened_at\")\n\t\t\t.eq(\"campaign_id\", id)\n\t\t\t.not(\"first_opened_at\", \"is\", null);\n\n\t\t// Calculate device breakdown from metadata\n\t\tlet desktop = 0;\n\t\tlet mobile = 0;\n\t\tlet tablet = 0;\n\n\t\t(sends || []).forEach((send) => {\n\t\t\tconst device = (send.metadata as Record<string, unknown>)?.device as string;\n\t\t\tif (device === \"mobile\") mobile++;\n\t\t\telse if (device === \"tablet\") tablet++;\n\t\t\telse desktop++;\n\t\t});\n\n\t\tconst total = desktop + mobile + tablet || 1;\n\t\tconst deviceBreakdown = {\n\t\t\tdesktop: Math.round((desktop / total) * 100),\n\t\t\tmobile: Math.round((mobile / total) * 100),\n\t\t\ttablet: Math.round((tablet / total) * 100),\n\t\t};\n\n\t\t// Calculate hourly opens\n\t\tconst hourlyMap: Record<string, number> = {};\n\t\t(sends || []).forEach((send) => {\n\t\t\tif (send.first_opened_at) {\n\t\t\t\tconst hour = new Date(send.first_opened_at).getHours();\n\t\t\t\tconst hourLabel = hour < 12 ? `${hour || 12} AM` : `${hour === 12 ? 12 : hour - 12} PM`;\n\t\t\t\thourlyMap[hourLabel] = (hourlyMap[hourLabel] || 0) + 1;\n\t\t\t}\n\t\t});\n\n\t\tconst hourlyOpens = Object.entries(hourlyMap)\n\t\t\t.map(([hour, opens]) => ({ hour, opens }))\n\t\t\t.sort((a, b) => {\n\t\t\t\tconst parseHour = (h: string) => {\n\t\t\t\t\tconst [num, period] = h.split(\" \");\n\t\t\t\t\treturn period === \"PM\" && num !== \"12\" ? parseInt(num) + 12 : parseInt(num);\n\t\t\t\t};\n\t\t\t\treturn parseHour(a.hour) - parseHour(b.hour);\n\t\t\t});\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: { topLinks, deviceBreakdown, hourlyOpens },\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to get campaign analytics:\", error);\n\t\treturn { success: false, error: \"Failed to get campaign analytics\" };\n\t}\n}\n\n/**\n * Record a webhook event (open, click, bounce, etc.)\n * Called by Resend webhooks\n */\nexport async function recordCampaignEvent(\n\tcampaignId: string,\n\trecipientEmail: string,\n\teventType: \"delivered\" | \"opened\" | \"clicked\" | \"bounced\" | \"complained\" | \"unsubscribed\",\n\teventData?: Record<string, unknown>\n): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\t\tconst now = new Date().toISOString();\n\n\t\t// Update send record\n\t\tconst updateData: Record<string, unknown> = {\n\t\t\tupdated_at: now,\n\t\t};\n\n\t\tswitch (eventType) {\n\t\t\tcase \"delivered\":\n\t\t\t\tupdateData.status = \"delivered\";\n\t\t\t\tupdateData.delivered_at = now;\n\t\t\t\tbreak;\n\t\t\tcase \"opened\":\n\t\t\t\tupdateData.status = \"opened\";\n\t\t\t\tupdateData.last_opened_at = now;\n\t\t\t\t// Increment open count\n\t\t\t\tawait supabase.rpc(\"increment_campaign_send_open_count\", {\n\t\t\t\t\tp_campaign_id: campaignId,\n\t\t\t\t\tp_recipient_email: recipientEmail,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase \"clicked\":\n\t\t\t\tupdateData.status = \"clicked\";\n\t\t\t\tupdateData.last_clicked_at = now;\n\t\t\t\tif (eventData?.url) {\n\t\t\t\t\t// Record link click\n\t\t\t\t\tawait supabase.rpc(\"increment_campaign_link_click\", {\n\t\t\t\t\t\tp_campaign_id: campaignId,\n\t\t\t\t\t\tp_url: eventData.url,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"bounced\":\n\t\t\t\tupdateData.status = \"bounced\";\n\t\t\t\tupdateData.bounced_at = now;\n\t\t\t\tupdateData.error_message = eventData?.reason as string;\n\t\t\t\tbreak;\n\t\t\tcase \"complained\":\n\t\t\t\tupdateData.status = \"complained\";\n\t\t\t\tupdateData.complained_at = now;\n\t\t\t\tbreak;\n\t\t\tcase \"unsubscribed\":\n\t\t\t\tupdateData.unsubscribed_at = now;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tawait supabase\n\t\t\t.from(\"email_campaign_sends\")\n\t\t\t.update(updateData)\n\t\t\t.eq(\"campaign_id\", campaignId)\n\t\t\t.eq(\"recipient_email\", recipientEmail);\n\n\t\t// Update aggregate campaign stats\n\t\tawait updateCampaignStats(campaignId);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to record campaign event:\", error);\n\t\treturn { success: false, error: \"Failed to record campaign event\" };\n\t}\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/**\n * Get recipients based on audience type and filter\n */\nasync function getAudienceRecipients(\n\taudienceType: string,\n\tfilter?: AudienceFilter | null\n): Promise<{ email: string; name?: string; type: string; id?: string }[]> {\n\tconst supabase = await createClient();\n\tconst recipients: { email: string; name?: string; type: string; id?: string }[] = [];\n\n\tswitch (audienceType) {\n\t\tcase \"waitlist\": {\n\t\t\t// Get waitlist subscribers from Resend\n\t\t\tconst waitlistContacts = await getWaitlistContacts();\n\t\t\trecipients.push(...waitlistContacts.map((c) => ({\n\t\t\t\temail: c.email,\n\t\t\t\tname: c.firstName ? `${c.firstName} ${c.lastName || \"\"}`.trim() : undefined,\n\t\t\t\ttype: \"waitlist\",\n\t\t\t\tid: c.id,\n\t\t\t})));\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"all_users\": {\n\t\t\t// Get all users from the database\n\t\t\tconst { data: users } = await supabase\n\t\t\t\t.from(\"users\")\n\t\t\t\t.select(\"id, email, full_name\")\n\t\t\t\t.not(\"email\", \"is\", null);\n\n\t\t\trecipients.push(...(users || []).map((u) => ({\n\t\t\t\temail: u.email,\n\t\t\t\tname: u.full_name,\n\t\t\t\ttype: \"user\",\n\t\t\t\tid: u.id,\n\t\t\t})));\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"all_companies\": {\n\t\t\t// Get primary contacts from all companies\n\t\t\tconst { data: companies } = await supabase\n\t\t\t\t.from(\"companies\")\n\t\t\t\t.select(\"id, email, name\")\n\t\t\t\t.not(\"email\", \"is\", null);\n\n\t\t\trecipients.push(...(companies || []).map((c) => ({\n\t\t\t\temail: c.email,\n\t\t\t\tname: c.name,\n\t\t\t\ttype: \"company\",\n\t\t\t\tid: c.id,\n\t\t\t})));\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"custom\": {\n\t\t\t// Use custom email list from filter\n\t\t\tif (filter?.customEmails) {\n\t\t\t\trecipients.push(...filter.customEmails.map((email) => ({\n\t\t\t\t\temail,\n\t\t\t\t\ttype: \"custom\",\n\t\t\t\t})));\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"segment\": {\n\t\t\t// Filter users based on segment criteria\n\t\t\tlet query = supabase.from(\"users\").select(\"id, email, full_name, role\");\n\n\t\t\tif (filter?.userRoles?.length) {\n\t\t\t\tquery = query.in(\"role\", filter.userRoles);\n\t\t\t}\n\t\t\tif (filter?.userStatuses?.length) {\n\t\t\t\tquery = query.in(\"status\", filter.userStatuses);\n\t\t\t}\n\t\t\tif (filter?.createdAfter) {\n\t\t\t\tquery = query.gte(\"created_at\", filter.createdAfter);\n\t\t\t}\n\t\t\tif (filter?.createdBefore) {\n\t\t\t\tquery = query.lte(\"created_at\", filter.createdBefore);\n\t\t\t}\n\n\t\t\tconst { data: users } = await query.not(\"email\", \"is\", null);\n\t\t\trecipients.push(...(users || []).map((u) => ({\n\t\t\t\temail: u.email,\n\t\t\t\tname: u.full_name,\n\t\t\t\ttype: \"segment\",\n\t\t\t\tid: u.id,\n\t\t\t})));\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t// Apply exclusions\n\tif (filter?.excludeUnsubscribed || filter?.excludeBounced || filter?.excludeComplained) {\n\t\t// Get suppressed emails\n\t\tconst { data: suppressions } = await supabase\n\t\t\t.from(\"email_suppressions\")\n\t\t\t.select(\"email, reason\");\n\n\t\tconst suppressedEmails = new Set(\n\t\t\t(suppressions || [])\n\t\t\t\t.filter((s) => {\n\t\t\t\t\tif (filter.excludeUnsubscribed && s.reason === \"unsubscribed\") return true;\n\t\t\t\t\tif (filter.excludeBounced && s.reason === \"bounced\") return true;\n\t\t\t\t\tif (filter.excludeComplained && s.reason === \"complained\") return true;\n\t\t\t\t\treturn false;\n\t\t\t\t})\n\t\t\t\t.map((s) => s.email.toLowerCase())\n\t\t);\n\n\t\treturn recipients.filter((r) => !suppressedEmails.has(r.email.toLowerCase()));\n\t}\n\n\treturn recipients;\n}\n\n/**\n * Get waitlist contacts from Resend\n */\nasync function getWaitlistContacts(): Promise<{ id: string; email: string; firstName?: string; lastName?: string }[]> {\n\ttry {\n\t\tconst audienceId = process.env.RESEND_WAITLIST_AUDIENCE_ID;\n\t\tif (!audienceId) {\n\t\t\tconsole.warn(\"RESEND_WAITLIST_AUDIENCE_ID not configured\");\n\t\t\treturn [];\n\t\t}\n\n\t\tconst response = await resend.contacts.list({ audienceId });\n\n\t\tif (response.error) {\n\t\t\tconsole.error(\"Failed to fetch waitlist contacts:\", response.error);\n\t\t\treturn [];\n\t\t}\n\n\t\treturn (response.data?.data || []).map((contact) => ({\n\t\t\tid: contact.id,\n\t\t\temail: contact.email,\n\t\t\tfirstName: contact.first_name || undefined,\n\t\t\tlastName: contact.last_name || undefined,\n\t\t}));\n\t} catch (error) {\n\t\tconsole.error(\"Failed to fetch waitlist contacts:\", error);\n\t\treturn [];\n\t}\n}\n\n/**\n * Update aggregate campaign statistics\n */\nasync function updateCampaignStats(campaignId: string): Promise<void> {\n\tconst supabase = await createClient();\n\n\t// Get counts from sends table\n\tconst { data: stats } = await supabase\n\t\t.from(\"email_campaign_sends\")\n\t\t.select(\"status\")\n\t\t.eq(\"campaign_id\", campaignId);\n\n\tif (!stats) return;\n\n\tconst counts = {\n\t\tdelivered_count: stats.filter((s) => [\"delivered\", \"opened\", \"clicked\"].includes(s.status)).length,\n\t\topened_count: stats.filter((s) => [\"opened\", \"clicked\"].includes(s.status)).length,\n\t\tunique_opens: stats.filter((s) => [\"opened\", \"clicked\"].includes(s.status)).length,\n\t\tclicked_count: stats.filter((s) => s.status === \"clicked\").length,\n\t\tunique_clicks: stats.filter((s) => s.status === \"clicked\").length,\n\t\tbounced_count: stats.filter((s) => s.status === \"bounced\").length,\n\t\tcomplained_count: stats.filter((s) => s.status === \"complained\").length,\n\t};\n\n\tawait supabase\n\t\t.from(\"email_campaigns\")\n\t\t.update(counts)\n\t\t.eq(\"id\", campaignId);\n}\n\n/**\n * Map database row to EmailCampaign type\n */\nfunction mapCampaignFromDb(row: Record<string, unknown>): EmailCampaign {\n\treturn {\n\t\tid: row.id as string,\n\t\tname: row.name as string,\n\t\tsubject: row.subject as string,\n\t\tpreviewText: row.preview_text as string | undefined,\n\t\ttemplateId: row.template_id as string | undefined,\n\t\ttemplateData: row.template_data as Record<string, unknown> | undefined,\n\t\thtmlContent: row.html_content as string | undefined,\n\t\tplainTextContent: row.plain_text_content as string | undefined,\n\t\tstatus: row.status as EmailCampaign[\"status\"],\n\t\tscheduledFor: row.scheduled_for as string | undefined,\n\t\taudienceType: row.audience_type as EmailCampaign[\"audienceType\"],\n\t\taudienceFilter: row.audience_filter as EmailCampaign[\"audienceFilter\"],\n\t\ttotalRecipients: (row.total_recipients as number) || 0,\n\t\tsentCount: (row.sent_count as number) || 0,\n\t\tdeliveredCount: (row.delivered_count as number) || 0,\n\t\topenedCount: (row.opened_count as number) || 0,\n\t\tuniqueOpens: (row.unique_opens as number) || 0,\n\t\tclickedCount: (row.clicked_count as number) || 0,\n\t\tuniqueClicks: (row.unique_clicks as number) || 0,\n\t\tbouncedCount: (row.bounced_count as number) || 0,\n\t\tcomplainedCount: (row.complained_count as number) || 0,\n\t\tunsubscribedCount: (row.unsubscribed_count as number) || 0,\n\t\tfailedCount: (row.failed_count as number) || 0,\n\t\trevenueAttributed: Number(row.revenue_attributed || 0),\n\t\tconversionsCount: (row.conversions_count as number) || 0,\n\t\tfromName: row.from_name as string,\n\t\tfromEmail: row.from_email as string,\n\t\treplyTo: row.reply_to as string | undefined,\n\t\ttags: (row.tags as string[]) || [],\n\t\tnotes: row.notes as string | undefined,\n\t\tcreatedAt: row.created_at as string,\n\t\tupdatedAt: row.updated_at as string,\n\t\tsentAt: row.sent_at as string | undefined,\n\t};\n}\n"],"names":[],"mappings":";;;;;;;IAiasB,mBAAA,WAAA,GAAA,IAAA,yZAAA,EAAA,8CAAA,8YAAA,EAAA,KAAA,GAAA,oZAAA,EAAA","debugId":null}},
    {"offset": {"line": 2541, "column": 0}, "map": {"version":3,"sources":["file:///Users/byronwade/Stratos/apps/admin/src/app/%28dashboard%29/dashboard/marketing/campaigns/new/page.tsx"],"sourcesContent":["\"use client\";\n\n/**\n * New Campaign Page\n *\n * Create a new email marketing campaign using the campaign builder wizard.\n * Connects to real server actions for campaign CRUD operations.\n */\n\nimport { useRouter } from \"next/navigation\";\nimport { useCallback, useState, useEffect } from \"react\";\nimport { ArrowLeft } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { Button } from \"@stratos/ui\";\nimport { CampaignBuilder } from \"@/components/marketing/campaign-builder\";\nimport { useCampaignStore } from \"@/lib/stores/campaign-store\";\nimport { createCampaign, sendCampaign, scheduleCampaign } from \"@/actions/campaigns\";\nimport type { CampaignDraft } from \"@/types/campaigns\";\n\nexport default function NewCampaignPage() {\n\tconst router = useRouter();\n\tconst [isSubmitting, setIsSubmitting] = useState(false);\n\tconst [error, setError] = useState<string | null>(null);\n\tconst { openBuilder, closeBuilder } = useCampaignStore();\n\n\t// Initialize builder when page loads\n\tuseEffect(() => {\n\t\topenBuilder();\n\t\treturn () => closeBuilder();\n\t}, [openBuilder, closeBuilder]);\n\n\tconst handleSave = useCallback(\n\t\tasync (draft: CampaignDraft) => {\n\t\t\tsetIsSubmitting(true);\n\t\t\tsetError(null);\n\t\t\ttry {\n\t\t\t\tconst result = await createCampaign(draft);\n\n\t\t\t\tif (!result.success) {\n\t\t\t\t\tsetError(result.error || \"Failed to create campaign\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (result.data) {\n\t\t\t\t\trouter.push(`/dashboard/marketing/campaigns/${result.data.id}`);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"Failed to save campaign:\", err);\n\t\t\t\tsetError(\"An unexpected error occurred\");\n\t\t\t} finally {\n\t\t\t\tsetIsSubmitting(false);\n\t\t\t}\n\t\t},\n\t\t[router]\n\t);\n\n\tconst handleSend = useCallback(\n\t\tasync (draft: CampaignDraft) => {\n\t\t\tsetIsSubmitting(true);\n\t\t\tsetError(null);\n\t\t\ttry {\n\t\t\t\t// First create the campaign as draft\n\t\t\t\tconst createResult = await createCampaign(draft);\n\n\t\t\t\tif (!createResult.success || !createResult.data) {\n\t\t\t\t\tsetError(createResult.error || \"Failed to create campaign\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Then send it\n\t\t\t\tconst sendResult = await sendCampaign(createResult.data.id);\n\n\t\t\t\tif (!sendResult.success) {\n\t\t\t\t\tsetError(sendResult.error || \"Failed to send campaign\");\n\t\t\t\t\t// Still redirect to campaign page so user can see the draft\n\t\t\t\t\trouter.push(`/dashboard/marketing/campaigns/${createResult.data.id}`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\trouter.push(`/dashboard/marketing/campaigns/${createResult.data.id}`);\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"Failed to send campaign:\", err);\n\t\t\t\tsetError(\"An unexpected error occurred\");\n\t\t\t} finally {\n\t\t\t\tsetIsSubmitting(false);\n\t\t\t}\n\t\t},\n\t\t[router]\n\t);\n\n\tconst handleSchedule = useCallback(\n\t\tasync (draft: CampaignDraft, scheduledFor: string) => {\n\t\t\tsetIsSubmitting(true);\n\t\t\tsetError(null);\n\t\t\ttry {\n\t\t\t\t// First create the campaign as draft\n\t\t\t\tconst createResult = await createCampaign(draft);\n\n\t\t\t\tif (!createResult.success || !createResult.data) {\n\t\t\t\t\tsetError(createResult.error || \"Failed to create campaign\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Then schedule it\n\t\t\t\tconst scheduleResult = await scheduleCampaign(createResult.data.id, scheduledFor);\n\n\t\t\t\tif (!scheduleResult.success) {\n\t\t\t\t\tsetError(scheduleResult.error || \"Failed to schedule campaign\");\n\t\t\t\t\t// Still redirect to campaign page so user can see the draft\n\t\t\t\t\trouter.push(`/dashboard/marketing/campaigns/${createResult.data.id}`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\trouter.push(`/dashboard/marketing/campaigns/${createResult.data.id}`);\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"Failed to schedule campaign:\", err);\n\t\t\t\tsetError(\"An unexpected error occurred\");\n\t\t\t} finally {\n\t\t\t\tsetIsSubmitting(false);\n\t\t\t}\n\t\t},\n\t\t[router]\n\t);\n\n\tconst handleCancel = useCallback(() => {\n\t\trouter.push(\"/dashboard/marketing/campaigns\");\n\t}, [router]);\n\n\treturn (\n\t\t<div className=\"flex h-full flex-col\">\n\t\t\t{/* Header */}\n\t\t\t<div className=\"flex items-center gap-4 border-b px-6 py-4\">\n\t\t\t\t<Button variant=\"ghost\" size=\"icon\" asChild>\n\t\t\t\t\t<Link href=\"/dashboard/marketing/campaigns\">\n\t\t\t\t\t\t<ArrowLeft className=\"size-4\" />\n\t\t\t\t\t</Link>\n\t\t\t\t</Button>\n\t\t\t\t<div>\n\t\t\t\t\t<h1 className=\"text-lg font-semibold\">Create Campaign</h1>\n\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\tBuild a new email marketing campaign\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Error Display */}\n\t\t\t{error && (\n\t\t\t\t<div className=\"mx-6 mt-4 rounded-lg border border-destructive/50 bg-destructive/10 p-4\">\n\t\t\t\t\t<p className=\"text-sm text-destructive\">{error}</p>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{/* Campaign Builder */}\n\t\t\t<div className=\"flex-1 overflow-hidden\">\n\t\t\t\t<CampaignBuilder\n\t\t\t\t\tonSave={handleSave}\n\t\t\t\t\tonSend={handleSend}\n\t\t\t\t\tonSchedule={handleSchedule}\n\t\t\t\t\tonCancel={handleCancel}\n\t\t\t\t\tisSubmitting={isSubmitting}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}