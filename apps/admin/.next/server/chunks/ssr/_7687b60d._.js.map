{"version":3,"sources":["turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/server/web/spec-extension/cookies.ts","turbopack:///[project]/apps/admin/src/lib/supabase/admin-client.ts","turbopack:///[project]/apps/admin/src/lib/supabase/server.ts","turbopack:///[project]/apps/admin/src/lib/supabase/web-reader.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts"],"sourcesContent":["export {\n  RequestCookies,\n  ResponseCookies,\n  stringifyCookie,\n} from 'next/dist/compiled/@edge-runtime/cookies'\n","import { createClient as createSupabaseClient } from \"@supabase/supabase-js\";\n\n/**\n * Admin Database Client (Server-Side Only)\n *\n * This client connects to the ADMIN Supabase database (separate from web database).\n *\n * Database: Admin database (iwudmixxoozwskgolqlz)\n * Tables: admin_users, admin_sessions, companies_registry, support_tickets,\n *         email_campaigns, platform_settings, admin_audit_logs, waitlist\n *\n * ⚠️ SECURITY WARNING:\n * - ONLY use this on the server side (Server Components, Server Actions, API Routes)\n * - NEVER expose this client or its credentials to the browser\n * - NEVER use in Client Components\n * - Uses service role key for full access (bypasses RLS)\n *\n * Use cases:\n * - Admin user authentication and management\n * - Session management\n * - Audit logging\n * - Platform settings\n * - Email campaigns\n * - Support tickets\n * - Company registry (metadata only)\n *\n * Note: For accessing CUSTOMER DATA (jobs, invoices, payments, etc.),\n * use createWebClient() from \"./web-client.ts\" instead.\n */\nexport function createAdminClient() {\n\tconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n\tconst serviceRoleKey = process.env.ADMIN_SUPABASE_SERVICE_ROLE_KEY;\n\n\tif (!supabaseUrl) {\n\t\tthrow new Error(\"Missing NEXT_PUBLIC_SUPABASE_URL environment variable\");\n\t}\n\n\tif (!serviceRoleKey) {\n\t\tthrow new Error(\n\t\t\t\"Missing ADMIN_SUPABASE_SERVICE_ROLE_KEY environment variable. \" +\n\t\t\t\t\"Get this from Supabase dashboard -> Settings -> API -> service_role key\"\n\t\t);\n\t}\n\n\treturn createSupabaseClient(supabaseUrl, serviceRoleKey, {\n\t\tauth: {\n\t\t\tautoRefreshToken: false,\n\t\t\tpersistSession: false,\n\t\t},\n\t});\n}\n\n/**\n * Type-safe admin client singleton for repeated use\n */\nlet adminClientInstance: ReturnType<typeof createAdminClient> | null = null;\n\nexport function getAdminClient() {\n\tif (!adminClientInstance) {\n\t\tadminClientInstance = createAdminClient();\n\t}\n\treturn adminClientInstance;\n}\n","import { createClient as createSupabaseClient } from \"@supabase/supabase-js\";\nimport { cookies } from \"next/headers\";\n\n/**\n * Admin Database Server Client\n *\n * This client connects to the ADMIN Supabase project.\n * Used for admin-specific operations like:\n * - Admin user management\n * - Support tickets\n * - Email campaigns\n * - Platform settings\n *\n * NOTE: This uses the service role key for server-side operations.\n * For session-based auth, use the session management in auth/session.ts\n */\nexport async function createClient() {\n\tconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\n\tconst serviceRoleKey = process.env.ADMIN_SUPABASE_SERVICE_ROLE_KEY;\n\tconst anonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\n\n\t// Use service role key if available, otherwise fall back to anon key\n\tconst key = serviceRoleKey || anonKey;\n\n\treturn createSupabaseClient(supabaseUrl, key, {\n\t\tauth: {\n\t\t\tautoRefreshToken: false,\n\t\t\tpersistSession: false,\n\t\t},\n\t});\n}\n\n/**\n * Get the current admin session from cookies\n */\nexport async function getAdminSession() {\n\tconst cookieStore = await cookies();\n\tconst sessionToken = cookieStore.get(\"admin_session\")?.value;\n\n\tif (!sessionToken) {\n\t\treturn null;\n\t}\n\n\t// Verify and decode the session token\n\tconst { verifySessionToken } = await import(\"@/lib/auth/session\");\n\treturn verifySessionToken(sessionToken);\n}\n\n/**\n * Get the current admin user from the session\n */\nexport async function getCurrentAdminUser() {\n\tconst session = await getAdminSession();\n\n\tif (!session) {\n\t\treturn null;\n\t}\n\n\tconst supabase = await createClient();\n\tconst { data, error } = await supabase\n\t\t.from(\"admin_users\")\n\t\t.select(\"*\")\n\t\t.eq(\"id\", session.userId)\n\t\t.single();\n\n\tif (error || !data) {\n\t\treturn null;\n\t}\n\n\treturn data;\n}\n\n// Re-export the admin client for convenience\nexport { createAdminClient, getAdminClient } from \"./admin-client\";\nexport { createWebReaderClient, getWebReaderClient } from \"./web-reader\";\n","import { createClient as createSupabaseClient } from \"@supabase/supabase-js\";\n\n/**\n * Web Database Reader Client (Server-Side Only)\n *\n * This client connects to the WEB Supabase project for READ-ONLY access to:\n * - Companies (customer businesses)\n * - Users (customer employees)\n * - Jobs, Invoices, Estimates\n * - Customers (customer's clients)\n * - Properties, Equipment\n * - All other business data\n *\n * This is used by admin for:\n * - Support/debugging customer issues\n * - Viewing company data for support tickets\n * - Accessing customer data when needed\n *\n * IMPORTANT: This should only be used for READ operations.\n * Never write to the web database from the admin app.\n */\nexport function createWebReaderClient() {\n\tconst supabaseUrl = process.env.WEB_SUPABASE_URL;\n\tconst serviceRoleKey = process.env.WEB_SUPABASE_SERVICE_ROLE_KEY;\n\n\tif (!supabaseUrl) {\n\t\tthrow new Error(\"Missing WEB_SUPABASE_URL environment variable\");\n\t}\n\n\tif (!serviceRoleKey) {\n\t\tthrow new Error(\"Missing WEB_SUPABASE_SERVICE_ROLE_KEY environment variable\");\n\t}\n\n\treturn createSupabaseClient(supabaseUrl, serviceRoleKey, {\n\t\tauth: {\n\t\t\tautoRefreshToken: false,\n\t\t\tpersistSession: false,\n\t\t},\n\t});\n}\n\n/**\n * Type-safe web reader client singleton for repeated use\n */\nlet webReaderInstance: ReturnType<typeof createWebReaderClient> | null = null;\n\nexport function getWebReaderClient() {\n\tif (!webReaderInstance) {\n\t\twebReaderInstance = createWebReaderClient();\n\t}\n\treturn webReaderInstance;\n}\n\n// =============================================================================\n// READ-ONLY HELPER FUNCTIONS\n// =============================================================================\n// These functions provide convenient access to web database tables\n\n/**\n * Get a company from the web database by ID\n */\nexport async function getWebCompany(companyId: string) {\n\tconst client = getWebReaderClient();\n\tconst { data, error } = await client\n\t\t.from(\"companies\")\n\t\t.select(\"*\")\n\t\t.eq(\"id\", companyId)\n\t\t.single();\n\n\tif (error) throw error;\n\treturn data;\n}\n\n/**\n * Get all companies from the web database\n */\nexport async function getWebCompanies(options?: {\n\tlimit?: number;\n\toffset?: number;\n\tstatus?: string;\n}) {\n\tconst client = getWebReaderClient();\n\tlet query = client.from(\"companies\").select(\"*\", { count: \"exact\" });\n\n\tif (options?.status) {\n\t\tquery = query.eq(\"status\", options.status);\n\t}\n\n\tif (options?.limit) {\n\t\tquery = query.limit(options.limit);\n\t}\n\n\tif (options?.offset) {\n\t\tquery = query.range(options.offset, options.offset + (options.limit || 50) - 1);\n\t}\n\n\tconst { data, error, count } = await query.order(\"created_at\", { ascending: false });\n\n\tif (error) throw error;\n\treturn { data, count };\n}\n\n/**\n * Get users for a company from the web database\n */\nexport async function getWebCompanyUsers(companyId: string) {\n\tconst client = getWebReaderClient();\n\tconst { data, error } = await client\n\t\t.from(\"team_members\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.order(\"created_at\", { ascending: false });\n\n\tif (error) throw error;\n\treturn data;\n}\n\n/**\n * Get jobs for a company from the web database\n */\nexport async function getWebCompanyJobs(companyId: string, options?: { limit?: number }) {\n\tconst client = getWebReaderClient();\n\tlet query = client\n\t\t.from(\"jobs\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.order(\"created_at\", { ascending: false });\n\n\tif (options?.limit) {\n\t\tquery = query.limit(options.limit);\n\t}\n\n\tconst { data, error } = await query;\n\n\tif (error) throw error;\n\treturn data;\n}\n\n/**\n * Get customers for a company from the web database\n */\nexport async function getWebCompanyCustomers(companyId: string, options?: { limit?: number }) {\n\tconst client = getWebReaderClient();\n\tlet query = client\n\t\t.from(\"customers\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.order(\"created_at\", { ascending: false });\n\n\tif (options?.limit) {\n\t\tquery = query.limit(options.limit);\n\t}\n\n\tconst { data, error } = await query;\n\n\tif (error) throw error;\n\treturn data;\n}\n\n/**\n * Get invoices for a company from the web database\n */\nexport async function getWebCompanyInvoices(companyId: string, options?: { limit?: number }) {\n\tconst client = getWebReaderClient();\n\tlet query = client\n\t\t.from(\"invoices\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.order(\"created_at\", { ascending: false });\n\n\tif (options?.limit) {\n\t\tquery = query.limit(options.limit);\n\t}\n\n\tconst { data, error } = await query;\n\n\tif (error) throw error;\n\treturn data;\n}\n\n/**\n * Search across web database (for support purposes)\n */\nexport async function searchWebDatabase(searchTerm: string, options?: { limit?: number }) {\n\tconst client = getWebReaderClient();\n\tconst limit = options?.limit || 10;\n\n\t// Search companies\n\tconst { data: companies } = await client\n\t\t.from(\"companies\")\n\t\t.select(\"id, name, slug\")\n\t\t.or(`name.ilike.%${searchTerm}%,slug.ilike.%${searchTerm}%`)\n\t\t.limit(limit);\n\n\t// Search customers\n\tconst { data: customers } = await client\n\t\t.from(\"customers\")\n\t\t.select(\"id, first_name, last_name, email, company_id\")\n\t\t.or(`first_name.ilike.%${searchTerm}%,last_name.ilike.%${searchTerm}%,email.ilike.%${searchTerm}%`)\n\t\t.limit(limit);\n\n\treturn {\n\t\tcompanies: companies || [],\n\t\tcustomers: customers || [],\n\t};\n}\n","/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n"],"names":["RequestCookies","ResponseCookies","stringifyCookie","registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"qGACEA,cAAc,CAAA,kBAAdA,EAAAA,cAAc,EACdC,eAAe,CAAA,kBAAfA,EAAAA,eAAe,EACfC,eAAe,CAAA,kBAAfA,EAAAA,eAAe,8EACV,CAAA,CAAA,IAAA,2BCJP,IAAA,EAAA,EAAA,CAAA,CAAA,OA6BO,SAAS,IAEf,IAAM,EAAiB,QAAQ,GAAG,CAAC,+BAA+B,CAMlE,GAAI,CAAC,EACJ,MAAM,AAAI,MACT,EAFmB,iEAGlB,sEAIH,MAAO,CAAA,EAAA,EAAA,YAAA,AAAoB,EAAC,AAdtB,2CAcmC,EAAgB,CACxD,KAAM,CACL,kBAAkB,EAClB,gBAAgB,CACjB,CACD,EACD,CAKA,IAAI,EAAmE,KAEhE,SAAS,IAIf,OAHI,AAAC,IACJ,EAAsB,GAAA,EAEhB,CACR,SAJ2B,6EC1D3B,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OCoBO,SAAS,IACf,IAAM,EAAc,QAAQ,GAAG,CAAC,gBAAgB,CAC1C,EAAiB,QAAQ,GAAG,CAAC,6BAA6B,CAEhE,GAAI,CAAC,EACJ,MAAM,AAAI,KADO,CACD,iDAGjB,GAAI,CAAC,EACJ,MAAM,AAAI,MAAM,EADI,4DAIrB,MAAO,CAAA,EAAA,EAAA,YAAA,AAAoB,EAAC,EAAa,EAAgB,CACxD,KAAM,CACL,kBAAkB,EAClB,gBAAgB,CACjB,CACD,EACD,CDkCA,EAAA,CAAA,CAAA,OC7BA,IAAI,EAAqE,KAElE,SAAS,IAIf,OAHK,AAAD,IACH,EAAoB,GAAA,EAEd,CACR,CDnCO,MC+BkB,SD/BH,IAErB,IAAM,EAAiB,QAAQ,GAAG,CAAC,+BAA+B,CAMlE,MAAO,CAAA,EAAA,EAAA,YAAA,AAAoB,EAPrB,AAOsB,aAAa,8BAF7B,GAHN,eAGwB,oMAEgB,CAC7C,KAAM,CACL,kBAAkB,EAClB,eAAgB,EACjB,CACD,EACD,CAKO,eAAe,IACrB,IAAM,EAAc,MAAM,CAAA,EAAA,EAAA,OAAA,AAAO,IAC3B,EAAe,EAAY,GAAG,CAAC,kBAAkB,MAEvD,GAAI,CAAC,EACJ,OAAO,KADW,AAKnB,GAAM,oBAAE,CAAkB,CAAE,CAAG,MAAA,EAAA,CAAA,CAAA,OAC/B,OAAO,EAAmB,EAC3B,CAKO,eAAe,IACrB,IAAM,EAAU,MAAM,IAEtB,GAAI,CAAC,EACJ,OADa,AACN,KAGR,IAAM,EAAW,MAAM,IACjB,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAC5B,IAAI,CAAC,eACL,MAAM,CAAC,KACP,EAAE,CAAC,KAAM,EAAQ,MAAM,EACvB,MAAM,UAER,AAAI,GAAS,CAAC,EACN,IADY,CAIb,CACR,yLEtEoD,OAAA,cAAA,CAAA,EAAA,aAAA,oCAC3CC,0BAAAA,qCAAAA,EAAAA,uBAAuB,YAAQ,CAAA,CAAA,IAAA,iCCEjC,SAASC,EAAyBC,CAAc,EACrD,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAQE,MAAM,CAAED,IAAK,CACvC,IAAME,EAASH,CAAO,CAACC,EAAE,CACzB,GAAI,AAAkB,YAAY,OAAvBE,EACT,MAAM,OAAA,cAEL,CAFK,AAAIC,MACR,CAAC,2DAA2D,EAAE,OAAOD,EAAO;AAAA,oEAAuE,CAAC,EADhJ,oBAAA,OAAA,mBAAA,gBAAA,CAEN,EAEJ,CACF,0EATgBJ,2BAAAA,qCAAAA","ignoreList":[0,4,5]}