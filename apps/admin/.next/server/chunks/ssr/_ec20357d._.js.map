{"version":3,"sources":["turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/server/web/spec-extension/cookies.ts","turbopack:///[project]/apps/admin/src/lib/supabase/admin-client.ts","turbopack:///[project]/apps/admin/src/lib/supabase/server.ts","turbopack:///[project]/apps/admin/src/lib/supabase/web-reader.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/client/components/readonly-url-search-params.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/client/components/redirect-status-code.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/client/components/redirect-error.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/client/components/redirect.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/client/components/http-access-fallback/http-access-fallback.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/client/components/not-found.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/client/components/forbidden.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/client/components/unauthorized.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/server/lib/router-utils/is-postpone.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/client/components/is-next-router-error.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/client/components/unstable-rethrow.server.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/client/components/unstable-rethrow.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/client/components/navigation.react-server.ts","turbopack:///[project]/node_modules/.pnpm/next@16.0.1_@opentelemetry+api@1.9.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/api/navigation.react-server.ts","turbopack:///[project]/apps/admin/src/actions/auth.ts","turbopack:///[project]/apps/admin/src/lib/security/rate-limit.ts","turbopack:///[project]/apps/admin/src/lib/security/audit-log.ts"],"sourcesContent":["export {\n  RequestCookies,\n  ResponseCookies,\n  stringifyCookie,\n} from 'next/dist/compiled/@edge-runtime/cookies'\n","import { createClient as createSupabaseClient } from \"@supabase/supabase-js\";\n\n/**\n * Admin Database Client (Server-Side Only)\n *\n * This client connects to the ADMIN Supabase database (separate from web database).\n *\n * Database: Admin database (iwudmixxoozwskgolqlz)\n * Tables: admin_users, admin_sessions, companies_registry, support_tickets,\n *         email_campaigns, platform_settings, admin_audit_logs, waitlist\n *\n * ⚠️ SECURITY WARNING:\n * - ONLY use this on the server side (Server Components, Server Actions, API Routes)\n * - NEVER expose this client or its credentials to the browser\n * - NEVER use in Client Components\n * - Uses service role key for full access (bypasses RLS)\n *\n * Use cases:\n * - Admin user authentication and management\n * - Session management\n * - Audit logging\n * - Platform settings\n * - Email campaigns\n * - Support tickets\n * - Company registry (metadata only)\n *\n * Note: For accessing CUSTOMER DATA (jobs, invoices, payments, etc.),\n * use createWebClient() from \"./web-client.ts\" instead.\n */\nexport function createAdminClient() {\n\tconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n\tconst serviceRoleKey = process.env.ADMIN_SUPABASE_SERVICE_ROLE_KEY;\n\n\tif (!supabaseUrl) {\n\t\tthrow new Error(\"Missing NEXT_PUBLIC_SUPABASE_URL environment variable\");\n\t}\n\n\tif (!serviceRoleKey) {\n\t\tthrow new Error(\n\t\t\t\"Missing ADMIN_SUPABASE_SERVICE_ROLE_KEY environment variable. \" +\n\t\t\t\t\"Get this from Supabase dashboard -> Settings -> API -> service_role key\"\n\t\t);\n\t}\n\n\treturn createSupabaseClient(supabaseUrl, serviceRoleKey, {\n\t\tauth: {\n\t\t\tautoRefreshToken: false,\n\t\t\tpersistSession: false,\n\t\t},\n\t});\n}\n\n/**\n * Type-safe admin client singleton for repeated use\n */\nlet adminClientInstance: ReturnType<typeof createAdminClient> | null = null;\n\nexport function getAdminClient() {\n\tif (!adminClientInstance) {\n\t\tadminClientInstance = createAdminClient();\n\t}\n\treturn adminClientInstance;\n}\n","import { createClient as createSupabaseClient } from \"@supabase/supabase-js\";\nimport { cookies } from \"next/headers\";\n\n/**\n * Admin Database Server Client\n *\n * This client connects to the ADMIN Supabase project.\n * Used for admin-specific operations like:\n * - Admin user management\n * - Support tickets\n * - Email campaigns\n * - Platform settings\n *\n * NOTE: This uses the service role key for server-side operations.\n * For session-based auth, use the session management in auth/session.ts\n */\nexport async function createClient() {\n\tconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\n\tconst serviceRoleKey = process.env.ADMIN_SUPABASE_SERVICE_ROLE_KEY;\n\tconst anonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\n\n\t// Use service role key if available, otherwise fall back to anon key\n\tconst key = serviceRoleKey || anonKey;\n\n\treturn createSupabaseClient(supabaseUrl, key, {\n\t\tauth: {\n\t\t\tautoRefreshToken: false,\n\t\t\tpersistSession: false,\n\t\t},\n\t});\n}\n\n/**\n * Get the current admin session from cookies\n */\nexport async function getAdminSession() {\n\tconst cookieStore = await cookies();\n\tconst sessionToken = cookieStore.get(\"admin_session\")?.value;\n\n\tif (!sessionToken) {\n\t\treturn null;\n\t}\n\n\t// Verify and decode the session token\n\tconst { verifySessionToken } = await import(\"@/lib/auth/session\");\n\treturn verifySessionToken(sessionToken);\n}\n\n/**\n * Get the current admin user from the session\n */\nexport async function getCurrentAdminUser() {\n\tconst session = await getAdminSession();\n\n\tif (!session) {\n\t\treturn null;\n\t}\n\n\tconst supabase = await createClient();\n\tconst { data, error } = await supabase\n\t\t.from(\"admin_users\")\n\t\t.select(\"*\")\n\t\t.eq(\"id\", session.userId)\n\t\t.single();\n\n\tif (error || !data) {\n\t\treturn null;\n\t}\n\n\treturn data;\n}\n\n// Re-export the admin client for convenience\nexport { createAdminClient, getAdminClient } from \"./admin-client\";\nexport { createWebReaderClient, getWebReaderClient } from \"./web-reader\";\n","import { createClient as createSupabaseClient } from \"@supabase/supabase-js\";\n\n/**\n * Web Database Reader Client (Server-Side Only)\n *\n * This client connects to the WEB Supabase project for READ-ONLY access to:\n * - Companies (customer businesses)\n * - Users (customer employees)\n * - Jobs, Invoices, Estimates\n * - Customers (customer's clients)\n * - Properties, Equipment\n * - All other business data\n *\n * This is used by admin for:\n * - Support/debugging customer issues\n * - Viewing company data for support tickets\n * - Accessing customer data when needed\n *\n * IMPORTANT: This should only be used for READ operations.\n * Never write to the web database from the admin app.\n */\nexport function createWebReaderClient() {\n\tconst supabaseUrl = process.env.WEB_SUPABASE_URL;\n\tconst serviceRoleKey = process.env.WEB_SUPABASE_SERVICE_ROLE_KEY;\n\n\tif (!supabaseUrl) {\n\t\tthrow new Error(\"Missing WEB_SUPABASE_URL environment variable\");\n\t}\n\n\tif (!serviceRoleKey) {\n\t\tthrow new Error(\"Missing WEB_SUPABASE_SERVICE_ROLE_KEY environment variable\");\n\t}\n\n\treturn createSupabaseClient(supabaseUrl, serviceRoleKey, {\n\t\tauth: {\n\t\t\tautoRefreshToken: false,\n\t\t\tpersistSession: false,\n\t\t},\n\t});\n}\n\n/**\n * Type-safe web reader client singleton for repeated use\n */\nlet webReaderInstance: ReturnType<typeof createWebReaderClient> | null = null;\n\nexport function getWebReaderClient() {\n\tif (!webReaderInstance) {\n\t\twebReaderInstance = createWebReaderClient();\n\t}\n\treturn webReaderInstance;\n}\n\n// =============================================================================\n// READ-ONLY HELPER FUNCTIONS\n// =============================================================================\n// These functions provide convenient access to web database tables\n\n/**\n * Get a company from the web database by ID\n */\nexport async function getWebCompany(companyId: string) {\n\tconst client = getWebReaderClient();\n\tconst { data, error } = await client\n\t\t.from(\"companies\")\n\t\t.select(\"*\")\n\t\t.eq(\"id\", companyId)\n\t\t.single();\n\n\tif (error) throw error;\n\treturn data;\n}\n\n/**\n * Get all companies from the web database\n */\nexport async function getWebCompanies(options?: {\n\tlimit?: number;\n\toffset?: number;\n\tstatus?: string;\n}) {\n\tconst client = getWebReaderClient();\n\tlet query = client.from(\"companies\").select(\"*\", { count: \"exact\" });\n\n\tif (options?.status) {\n\t\tquery = query.eq(\"status\", options.status);\n\t}\n\n\tif (options?.limit) {\n\t\tquery = query.limit(options.limit);\n\t}\n\n\tif (options?.offset) {\n\t\tquery = query.range(options.offset, options.offset + (options.limit || 50) - 1);\n\t}\n\n\tconst { data, error, count } = await query.order(\"created_at\", { ascending: false });\n\n\tif (error) throw error;\n\treturn { data, count };\n}\n\n/**\n * Get users for a company from the web database\n */\nexport async function getWebCompanyUsers(companyId: string) {\n\tconst client = getWebReaderClient();\n\tconst { data, error } = await client\n\t\t.from(\"team_members\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.order(\"created_at\", { ascending: false });\n\n\tif (error) throw error;\n\treturn data;\n}\n\n/**\n * Get jobs for a company from the web database\n */\nexport async function getWebCompanyJobs(companyId: string, options?: { limit?: number }) {\n\tconst client = getWebReaderClient();\n\tlet query = client\n\t\t.from(\"jobs\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.order(\"created_at\", { ascending: false });\n\n\tif (options?.limit) {\n\t\tquery = query.limit(options.limit);\n\t}\n\n\tconst { data, error } = await query;\n\n\tif (error) throw error;\n\treturn data;\n}\n\n/**\n * Get customers for a company from the web database\n */\nexport async function getWebCompanyCustomers(companyId: string, options?: { limit?: number }) {\n\tconst client = getWebReaderClient();\n\tlet query = client\n\t\t.from(\"customers\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.order(\"created_at\", { ascending: false });\n\n\tif (options?.limit) {\n\t\tquery = query.limit(options.limit);\n\t}\n\n\tconst { data, error } = await query;\n\n\tif (error) throw error;\n\treturn data;\n}\n\n/**\n * Get invoices for a company from the web database\n */\nexport async function getWebCompanyInvoices(companyId: string, options?: { limit?: number }) {\n\tconst client = getWebReaderClient();\n\tlet query = client\n\t\t.from(\"invoices\")\n\t\t.select(\"*\")\n\t\t.eq(\"company_id\", companyId)\n\t\t.order(\"created_at\", { ascending: false });\n\n\tif (options?.limit) {\n\t\tquery = query.limit(options.limit);\n\t}\n\n\tconst { data, error } = await query;\n\n\tif (error) throw error;\n\treturn data;\n}\n\n/**\n * Search across web database (for support purposes)\n */\nexport async function searchWebDatabase(searchTerm: string, options?: { limit?: number }) {\n\tconst client = getWebReaderClient();\n\tconst limit = options?.limit || 10;\n\n\t// Search companies\n\tconst { data: companies } = await client\n\t\t.from(\"companies\")\n\t\t.select(\"id, name, slug\")\n\t\t.or(`name.ilike.%${searchTerm}%,slug.ilike.%${searchTerm}%`)\n\t\t.limit(limit);\n\n\t// Search customers\n\tconst { data: customers } = await client\n\t\t.from(\"customers\")\n\t\t.select(\"id, first_name, last_name, email, company_id\")\n\t\t.or(`first_name.ilike.%${searchTerm}%,last_name.ilike.%${searchTerm}%,email.ilike.%${searchTerm}%`)\n\t\t.limit(limit);\n\n\treturn {\n\t\tcompanies: companies || [],\n\t\tcustomers: customers || [],\n\t};\n}\n","/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","/**\n * ReadonlyURLSearchParams implementation shared between client and server.\n * This file is intentionally not marked as 'use client' or 'use server'\n * so it can be imported by both environments.\n */\n\n/** @internal */\nclass ReadonlyURLSearchParamsError extends Error {\n  constructor() {\n    super(\n      'Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams'\n    )\n  }\n}\n\n/**\n * A read-only version of URLSearchParams that throws errors when mutation methods are called.\n * This ensures that the URLSearchParams returned by useSearchParams() cannot be mutated.\n */\nexport class ReadonlyURLSearchParams extends URLSearchParams {\n  /** @deprecated Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams */\n  append() {\n    throw new ReadonlyURLSearchParamsError()\n  }\n  /** @deprecated Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams */\n  delete() {\n    throw new ReadonlyURLSearchParamsError()\n  }\n  /** @deprecated Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams */\n  set() {\n    throw new ReadonlyURLSearchParamsError()\n  }\n  /** @deprecated Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams */\n  sort() {\n    throw new ReadonlyURLSearchParamsError()\n  }\n}\n","export enum RedirectStatusCode {\n  SeeOther = 303,\n  TemporaryRedirect = 307,\n  PermanentRedirect = 308,\n}\n","import { RedirectStatusCode } from './redirect-status-code'\n\nexport const REDIRECT_ERROR_CODE = 'NEXT_REDIRECT'\n\nexport enum RedirectType {\n  push = 'push',\n  replace = 'replace',\n}\n\nexport type RedirectError = Error & {\n  digest: `${typeof REDIRECT_ERROR_CODE};${RedirectType};${string};${RedirectStatusCode};`\n}\n\n/**\n * Checks an error to determine if it's an error generated by the\n * `redirect(url)` helper.\n *\n * @param error the error that may reference a redirect error\n * @returns true if the error is a redirect error\n */\nexport function isRedirectError(error: unknown): error is RedirectError {\n  if (\n    typeof error !== 'object' ||\n    error === null ||\n    !('digest' in error) ||\n    typeof error.digest !== 'string'\n  ) {\n    return false\n  }\n\n  const digest = error.digest.split(';')\n  const [errorCode, type] = digest\n  const destination = digest.slice(2, -2).join(';')\n  const status = digest.at(-2)\n\n  const statusCode = Number(status)\n\n  return (\n    errorCode === REDIRECT_ERROR_CODE &&\n    (type === 'replace' || type === 'push') &&\n    typeof destination === 'string' &&\n    !isNaN(statusCode) &&\n    statusCode in RedirectStatusCode\n  )\n}\n","import { RedirectStatusCode } from './redirect-status-code'\nimport {\n  RedirectType,\n  type RedirectError,\n  isRedirectError,\n  REDIRECT_ERROR_CODE,\n} from './redirect-error'\n\nconst actionAsyncStorage =\n  typeof window === 'undefined'\n    ? (\n        require('../../server/app-render/action-async-storage.external') as typeof import('../../server/app-render/action-async-storage.external')\n      ).actionAsyncStorage\n    : undefined\n\nexport function getRedirectError(\n  url: string,\n  type: RedirectType,\n  statusCode: RedirectStatusCode = RedirectStatusCode.TemporaryRedirect\n): RedirectError {\n  const error = new Error(REDIRECT_ERROR_CODE) as RedirectError\n  error.digest = `${REDIRECT_ERROR_CODE};${type};${url};${statusCode};`\n  return error\n}\n\n/**\n * This function allows you to redirect the user to another URL. It can be used in\n * [Server Components](https://nextjs.org/docs/app/building-your-application/rendering/server-components),\n * [Route Handlers](https://nextjs.org/docs/app/building-your-application/routing/route-handlers), and\n * [Server Actions](https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions-and-mutations).\n *\n * - In a Server Component, this will insert a meta tag to redirect the user to the target page.\n * - In a Route Handler or Server Action, it will serve a 307/303 to the caller.\n * - In a Server Action, type defaults to 'push' and 'replace' elsewhere.\n *\n * Read more: [Next.js Docs: `redirect`](https://nextjs.org/docs/app/api-reference/functions/redirect)\n */\nexport function redirect(\n  /** The URL to redirect to */\n  url: string,\n  type?: RedirectType\n): never {\n  type ??= actionAsyncStorage?.getStore()?.isAction\n    ? RedirectType.push\n    : RedirectType.replace\n\n  throw getRedirectError(url, type, RedirectStatusCode.TemporaryRedirect)\n}\n\n/**\n * This function allows you to redirect the user to another URL. It can be used in\n * [Server Components](https://nextjs.org/docs/app/building-your-application/rendering/server-components),\n * [Route Handlers](https://nextjs.org/docs/app/building-your-application/routing/route-handlers), and\n * [Server Actions](https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions-and-mutations).\n *\n * - In a Server Component, this will insert a meta tag to redirect the user to the target page.\n * - In a Route Handler or Server Action, it will serve a 308/303 to the caller.\n *\n * Read more: [Next.js Docs: `redirect`](https://nextjs.org/docs/app/api-reference/functions/redirect)\n */\nexport function permanentRedirect(\n  /** The URL to redirect to */\n  url: string,\n  type: RedirectType = RedirectType.replace\n): never {\n  throw getRedirectError(url, type, RedirectStatusCode.PermanentRedirect)\n}\n\n/**\n * Returns the encoded URL from the error if it's a RedirectError, null\n * otherwise. Note that this does not validate the URL returned.\n *\n * @param error the error that may be a redirect error\n * @return the url if the error was a redirect error\n */\nexport function getURLFromRedirectError(error: RedirectError): string\nexport function getURLFromRedirectError(error: unknown): string | null {\n  if (!isRedirectError(error)) return null\n\n  // Slices off the beginning of the digest that contains the code and the\n  // separating ';'.\n  return error.digest.split(';').slice(2, -2).join(';')\n}\n\nexport function getRedirectTypeFromError(error: RedirectError): RedirectType {\n  if (!isRedirectError(error)) {\n    throw new Error('Not a redirect error')\n  }\n\n  return error.digest.split(';', 2)[1] as RedirectType\n}\n\nexport function getRedirectStatusCodeFromError(error: RedirectError): number {\n  if (!isRedirectError(error)) {\n    throw new Error('Not a redirect error')\n  }\n\n  return Number(error.digest.split(';').at(-2))\n}\n","export const HTTPAccessErrorStatus = {\n  NOT_FOUND: 404,\n  FORBIDDEN: 403,\n  UNAUTHORIZED: 401,\n}\n\nconst ALLOWED_CODES = new Set(Object.values(HTTPAccessErrorStatus))\n\nexport const HTTP_ERROR_FALLBACK_ERROR_CODE = 'NEXT_HTTP_ERROR_FALLBACK'\n\nexport type HTTPAccessFallbackError = Error & {\n  digest: `${typeof HTTP_ERROR_FALLBACK_ERROR_CODE};${string}`\n}\n\n/**\n * Checks an error to determine if it's an error generated by\n * the HTTP navigation APIs `notFound()`, `forbidden()` or `unauthorized()`.\n *\n * @param error the error that may reference a HTTP access error\n * @returns true if the error is a HTTP access error\n */\nexport function isHTTPAccessFallbackError(\n  error: unknown\n): error is HTTPAccessFallbackError {\n  if (\n    typeof error !== 'object' ||\n    error === null ||\n    !('digest' in error) ||\n    typeof error.digest !== 'string'\n  ) {\n    return false\n  }\n  const [prefix, httpStatus] = error.digest.split(';')\n\n  return (\n    prefix === HTTP_ERROR_FALLBACK_ERROR_CODE &&\n    ALLOWED_CODES.has(Number(httpStatus))\n  )\n}\n\nexport function getAccessFallbackHTTPStatus(\n  error: HTTPAccessFallbackError\n): number {\n  const httpStatus = error.digest.split(';')[1]\n  return Number(httpStatus)\n}\n\nexport function getAccessFallbackErrorTypeByStatus(\n  status: number\n): 'not-found' | 'forbidden' | 'unauthorized' | undefined {\n  switch (status) {\n    case 401:\n      return 'unauthorized'\n    case 403:\n      return 'forbidden'\n    case 404:\n      return 'not-found'\n    default:\n      return\n  }\n}\n","import {\n  HTTP_ERROR_FALLBACK_ERROR_CODE,\n  type HTTPAccessFallbackError,\n} from './http-access-fallback/http-access-fallback'\n\n/**\n * This function allows you to render the [not-found.js file](https://nextjs.org/docs/app/api-reference/file-conventions/not-found)\n * within a route segment as well as inject a tag.\n *\n * `notFound()` can be used in\n * [Server Components](https://nextjs.org/docs/app/building-your-application/rendering/server-components),\n * [Route Handlers](https://nextjs.org/docs/app/building-your-application/routing/route-handlers), and\n * [Server Actions](https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions-and-mutations).\n *\n * - In a Server Component, this will insert a `<meta name=\"robots\" content=\"noindex\" />` meta tag and set the status code to 404.\n * - In a Route Handler or Server Action, it will serve a 404 to the caller.\n *\n * Read more: [Next.js Docs: `notFound`](https://nextjs.org/docs/app/api-reference/functions/not-found)\n */\n\nconst DIGEST = `${HTTP_ERROR_FALLBACK_ERROR_CODE};404`\n\nexport function notFound(): never {\n  const error = new Error(DIGEST) as HTTPAccessFallbackError\n  ;(error as HTTPAccessFallbackError).digest = DIGEST\n\n  throw error\n}\n","import {\n  HTTP_ERROR_FALLBACK_ERROR_CODE,\n  type HTTPAccessFallbackError,\n} from './http-access-fallback/http-access-fallback'\n\n// TODO: Add `forbidden` docs\n/**\n * @experimental\n * This function allows you to render the [forbidden.js file](https://nextjs.org/docs/app/api-reference/file-conventions/forbidden)\n * within a route segment as well as inject a tag.\n *\n * `forbidden()` can be used in\n * [Server Components](https://nextjs.org/docs/app/building-your-application/rendering/server-components),\n * [Route Handlers](https://nextjs.org/docs/app/building-your-application/routing/route-handlers), and\n * [Server Actions](https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions-and-mutations).\n *\n * Read more: [Next.js Docs: `forbidden`](https://nextjs.org/docs/app/api-reference/functions/forbidden)\n */\n\nconst DIGEST = `${HTTP_ERROR_FALLBACK_ERROR_CODE};403`\n\nexport function forbidden(): never {\n  if (!process.env.__NEXT_EXPERIMENTAL_AUTH_INTERRUPTS) {\n    throw new Error(\n      `\\`forbidden()\\` is experimental and only allowed to be enabled when \\`experimental.authInterrupts\\` is enabled.`\n    )\n  }\n\n  const error = new Error(DIGEST) as HTTPAccessFallbackError\n  ;(error as HTTPAccessFallbackError).digest = DIGEST\n  throw error\n}\n","import {\n  HTTP_ERROR_FALLBACK_ERROR_CODE,\n  type HTTPAccessFallbackError,\n} from './http-access-fallback/http-access-fallback'\n\n// TODO: Add `unauthorized` docs\n/**\n * @experimental\n * This function allows you to render the [unauthorized.js file](https://nextjs.org/docs/app/api-reference/file-conventions/unauthorized)\n * within a route segment as well as inject a tag.\n *\n * `unauthorized()` can be used in\n * [Server Components](https://nextjs.org/docs/app/building-your-application/rendering/server-components),\n * [Route Handlers](https://nextjs.org/docs/app/building-your-application/routing/route-handlers), and\n * [Server Actions](https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions-and-mutations).\n *\n *\n * Read more: [Next.js Docs: `unauthorized`](https://nextjs.org/docs/app/api-reference/functions/unauthorized)\n */\n\nconst DIGEST = `${HTTP_ERROR_FALLBACK_ERROR_CODE};401`\n\nexport function unauthorized(): never {\n  if (!process.env.__NEXT_EXPERIMENTAL_AUTH_INTERRUPTS) {\n    throw new Error(\n      `\\`unauthorized()\\` is experimental and only allowed to be used when \\`experimental.authInterrupts\\` is enabled.`\n    )\n  }\n\n  const error = new Error(DIGEST) as HTTPAccessFallbackError\n  ;(error as HTTPAccessFallbackError).digest = DIGEST\n  throw error\n}\n","const REACT_POSTPONE_TYPE: symbol = Symbol.for('react.postpone')\n\nexport function isPostpone(error: any): boolean {\n  return (\n    typeof error === 'object' &&\n    error !== null &&\n    error.$$typeof === REACT_POSTPONE_TYPE\n  )\n}\n","import {\n  isHTTPAccessFallbackError,\n  type HTTPAccessFallbackError,\n} from './http-access-fallback/http-access-fallback'\nimport { isRedirectError, type RedirectError } from './redirect-error'\n\n/**\n * Returns true if the error is a navigation signal error. These errors are\n * thrown by user code to perform navigation operations and interrupt the React\n * render.\n */\nexport function isNextRouterError(\n  error: unknown\n): error is RedirectError | HTTPAccessFallbackError {\n  return isRedirectError(error) || isHTTPAccessFallbackError(error)\n}\n","import { isHangingPromiseRejectionError } from '../../server/dynamic-rendering-utils'\nimport { isPostpone } from '../../server/lib/router-utils/is-postpone'\nimport { isBailoutToCSRError } from '../../shared/lib/lazy-dynamic/bailout-to-csr'\nimport { isNextRouterError } from './is-next-router-error'\nimport {\n  isDynamicPostpone,\n  isPrerenderInterruptedError,\n} from '../../server/app-render/dynamic-rendering'\nimport { isDynamicServerError } from './hooks-server-context'\n\nexport function unstable_rethrow(error: unknown): void {\n  if (\n    isNextRouterError(error) ||\n    isBailoutToCSRError(error) ||\n    isDynamicServerError(error) ||\n    isDynamicPostpone(error) ||\n    isPostpone(error) ||\n    isHangingPromiseRejectionError(error) ||\n    isPrerenderInterruptedError(error)\n  ) {\n    throw error\n  }\n\n  if (error instanceof Error && 'cause' in error) {\n    unstable_rethrow(error.cause)\n  }\n}\n","/**\n * This function should be used to rethrow internal Next.js errors so that they can be handled by the framework.\n * When wrapping an API that uses errors to interrupt control flow, you should use this function before you do any error handling.\n * This function will rethrow the error if it is a Next.js error so it can be handled, otherwise it will do nothing.\n *\n * Read more: [Next.js Docs: `unstable_rethrow`](https://nextjs.org/docs/app/api-reference/functions/unstable_rethrow)\n */\nexport const unstable_rethrow =\n  typeof window === 'undefined'\n    ? (\n        require('./unstable-rethrow.server') as typeof import('./unstable-rethrow.server')\n      ).unstable_rethrow\n    : (\n        require('./unstable-rethrow.browser') as typeof import('./unstable-rethrow.browser')\n      ).unstable_rethrow\n","import { ReadonlyURLSearchParams } from './readonly-url-search-params'\n\nexport function unstable_isUnrecognizedActionError(): boolean {\n  throw new Error(\n    '`unstable_isUnrecognizedActionError` can only be used on the client.'\n  )\n}\n\nexport { redirect, permanentRedirect } from './redirect'\nexport { RedirectType } from './redirect-error'\nexport { notFound } from './not-found'\nexport { forbidden } from './forbidden'\nexport { unauthorized } from './unauthorized'\nexport { unstable_rethrow } from './unstable-rethrow'\nexport { ReadonlyURLSearchParams }\n","export * from '../client/components/navigation.react-server'\n","\"use server\";\n\nimport { headers } from \"next/headers\";\nimport { redirect } from \"next/navigation\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { createSession, destroySession, getSession } from \"@/lib/auth/session\";\nimport {\n\tcheckAdminAuthRateLimit,\n\tresetRateLimitForEmail,\n\tgetClientIP,\n\tRateLimitError,\n} from \"@/lib/security/rate-limit\";\nimport {\n\tlogAdminLoginSuccess,\n\tlogAdminLoginFailure,\n\tlogRateLimitExceeded,\n} from \"@/lib/security/audit-log\";\n\nexport type AdminLoginResult = {\n\tsuccess: boolean;\n\terror?: string;\n\trateLimited?: boolean;\n\tretryAfter?: number;\n};\n\n/**\n * Admin Sign In Server Action\n *\n * Authenticates admin users against the admin_users table in the admin database.\n * Uses custom JWT-based sessions instead of Supabase Auth.\n */\nexport async function adminSignIn(formData: FormData): Promise<AdminLoginResult> {\n\tconst email = (formData.get(\"email\") as string)?.trim().toLowerCase();\n\tconst password = formData.get(\"password\") as string;\n\n\t// Get client info for rate limiting and logging\n\tconst headersList = await headers();\n\tconst ip = getClientIP(headersList);\n\tconst userAgent = headersList.get(\"user-agent\") || undefined;\n\n\t// Validate inputs\n\tif (!email || !password) {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: \"Email and password are required.\",\n\t\t};\n\t}\n\n\t// Check rate limits BEFORE any other validation\n\ttry {\n\t\tawait checkAdminAuthRateLimit(email, ip);\n\t} catch (error) {\n\t\tif (error instanceof RateLimitError) {\n\t\t\tawait logRateLimitExceeded(email, ip, Date.now() + error.retryAfter);\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: error.message,\n\t\t\t\trateLimited: true,\n\t\t\t\tretryAfter: error.retryAfter,\n\t\t\t};\n\t\t}\n\t\tthrow error;\n\t}\n\n\t// Get admin user from database\n\tconst supabase = await createClient();\n\n\t// Check if user exists and is active\n\tconst { data: adminUser, error: userError } = await supabase\n\t\t.from(\"admin_users\")\n\t\t.select(\"*\")\n\t\t.eq(\"email\", email)\n\t\t.single();\n\n\tif (userError || !adminUser) {\n\t\tawait logAdminLoginFailure(email, ip, \"User not found\", userAgent);\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: \"Invalid email or password.\",\n\t\t};\n\t}\n\n\t// Check if account is active\n\tif (!adminUser.is_active) {\n\t\tawait logAdminLoginFailure(email, ip, \"Account disabled\", userAgent);\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: \"Your account has been disabled. Contact a super admin.\",\n\t\t};\n\t}\n\n\t// Check if account is locked\n\tif (adminUser.locked_until && new Date(adminUser.locked_until) > new Date()) {\n\t\tconst lockRemaining = Math.ceil(\n\t\t\t(new Date(adminUser.locked_until).getTime() - Date.now()) / 1000 / 60\n\t\t);\n\t\tawait logAdminLoginFailure(email, ip, \"Account locked\", userAgent);\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: `Account is locked. Try again in ${lockRemaining} minutes.`,\n\t\t};\n\t}\n\n\t// Verify password using PostgreSQL crypt function\n\tconst { data: passwordMatch, error: verifyError } = await supabase.rpc(\"verify_password\", {\n\t\tpassword_text: password,\n\t\tpassword_hash: adminUser.password_hash,\n\t});\n\n\tif (verifyError || !passwordMatch) {\n\t\t// Increment failed login attempts\n\t\tconst newAttempts = (adminUser.failed_login_attempts || 0) + 1;\n\t\tconst lockUntil = newAttempts >= 5 ? new Date(Date.now() + 15 * 60 * 1000) : null;\n\n\t\tawait supabase\n\t\t\t.from(\"admin_users\")\n\t\t\t.update({\n\t\t\t\tfailed_login_attempts: newAttempts,\n\t\t\t\tlocked_until: lockUntil?.toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", adminUser.id);\n\n\t\tawait logAdminLoginFailure(email, ip, \"Invalid password\", userAgent);\n\n\t\tif (newAttempts >= 5) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Too many failed attempts. Account locked for 15 minutes.\",\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: \"Invalid email or password.\",\n\t\t};\n\t}\n\n\t// Successful login - create session\n\ttry {\n\t\tawait createSession(adminUser.id, adminUser.email, adminUser.role, ip, userAgent);\n\n\t\t// Reset failed attempts and update last login\n\t\tawait supabase\n\t\t\t.from(\"admin_users\")\n\t\t\t.update({\n\t\t\t\tfailed_login_attempts: 0,\n\t\t\t\tlocked_until: null,\n\t\t\t\tlast_login_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", adminUser.id);\n\n\t\t// Reset rate limit and log success\n\t\tresetRateLimitForEmail(email);\n\t\tawait logAdminLoginSuccess(email, ip, userAgent);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Session creation error:\", error);\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: \"Failed to create session. Please try again.\",\n\t\t};\n\t}\n}\n\n/**\n * Admin Sign Out Server Action\n */\nexport async function adminSignOut(): Promise<{ success: boolean; error?: string }> {\n\ttry {\n\t\tawait destroySession();\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Sign out error:\", error);\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\terror: \"Failed to sign out. Please try again.\",\n\t\t};\n\t}\n}\n\n/**\n * Get current admin user\n */\nexport async function getCurrentAdmin() {\n\tconst session = await getSession();\n\n\tif (!session) {\n\t\treturn null;\n\t}\n\n\tconst supabase = await createClient();\n\tconst { data, error } = await supabase\n\t\t.from(\"admin_users\")\n\t\t.select(\"id, email, full_name, avatar_url, role, is_active\")\n\t\t.eq(\"id\", session.userId)\n\t\t.single();\n\n\tif (error || !data) {\n\t\treturn null;\n\t}\n\n\treturn data;\n}\n\n/**\n * Require admin authentication (redirect if not authenticated)\n */\nexport async function requireAdmin() {\n\tconst admin = await getCurrentAdmin();\n\n\tif (!admin) {\n\t\tredirect(\"/login\");\n\t}\n\n\treturn admin;\n}\n\n/**\n * Change admin password\n */\nexport async function changePassword(\n\tcurrentPassword: string,\n\tnewPassword: string\n): Promise<{ success: boolean; error?: string }> {\n\tconst session = await getSession();\n\n\tif (!session) {\n\t\treturn { success: false, error: \"Not authenticated\" };\n\t}\n\n\tconst supabase = await createClient();\n\n\t// Get current user\n\tconst { data: adminUser, error: userError } = await supabase\n\t\t.from(\"admin_users\")\n\t\t.select(\"password_hash\")\n\t\t.eq(\"id\", session.userId)\n\t\t.single();\n\n\tif (userError || !adminUser) {\n\t\treturn { success: false, error: \"User not found\" };\n\t}\n\n\t// Verify current password\n\tconst { data: passwordMatch } = await supabase.rpc(\"verify_password\", {\n\t\tpassword_text: currentPassword,\n\t\tpassword_hash: adminUser.password_hash,\n\t});\n\n\tif (!passwordMatch) {\n\t\treturn { success: false, error: \"Current password is incorrect\" };\n\t}\n\n\t// Hash new password\n\tconst { data: newHash, error: hashError } = await supabase.rpc(\"crypt_password\", {\n\t\tpassword_text: newPassword,\n\t});\n\n\tif (hashError || !newHash) {\n\t\treturn { success: false, error: \"Failed to hash new password\" };\n\t}\n\n\t// Update password\n\tconst { error: updateError } = await supabase\n\t\t.from(\"admin_users\")\n\t\t.update({ password_hash: newHash })\n\t\t.eq(\"id\", session.userId);\n\n\tif (updateError) {\n\t\treturn { success: false, error: \"Failed to update password\" };\n\t}\n\n\treturn { success: true };\n}\n","/**\n * Admin Rate Limiting\n *\n * Protects against brute force attacks on admin login.\n * More restrictive than contractor app due to higher privileges.\n *\n * Limits:\n * - Auth: 3 attempts per 30 minutes per email\n * - Auth: 10 attempts per 30 minutes per IP\n * - After lockout: exponential backoff\n */\n\ninterface RateLimitRecord {\n\tcount: number;\n\trequests: number[];\n\tlockedUntil?: number;\n}\n\nclass AdminRateLimiter {\n\tprivate requests: Map<string, RateLimitRecord>;\n\tprivate readonly maxRequests: number;\n\tprivate readonly windowMs: number;\n\tprivate readonly lockoutMultiplier: number;\n\n\tconstructor(maxRequests: number, windowMs: number, lockoutMultiplier = 2) {\n\t\tthis.requests = new Map();\n\t\tthis.maxRequests = maxRequests;\n\t\tthis.windowMs = windowMs;\n\t\tthis.lockoutMultiplier = lockoutMultiplier;\n\n\t\t// Cleanup old entries every minute\n\t\tif (typeof setInterval !== \"undefined\") {\n\t\t\tsetInterval(() => this.cleanup(), 60_000);\n\t\t}\n\t}\n\n\tasync limit(identifier: string): Promise<{\n\t\tsuccess: boolean;\n\t\tlimit: number;\n\t\tremaining: number;\n\t\treset: number;\n\t\tlocked: boolean;\n\t\tlockoutEnds?: number;\n\t}> {\n\t\tconst now = Date.now();\n\t\tconst key = identifier.toLowerCase(); // Normalize for case-insensitive matching\n\n\t\tlet record = this.requests.get(key);\n\n\t\t// Initialize if doesn't exist\n\t\tif (!record) {\n\t\t\trecord = {\n\t\t\t\tcount: 0,\n\t\t\t\trequests: [],\n\t\t\t};\n\t\t\tthis.requests.set(key, record);\n\t\t}\n\n\t\t// Check if currently locked out\n\t\tif (record.lockedUntil && now < record.lockedUntil) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tlimit: this.maxRequests,\n\t\t\t\tremaining: 0,\n\t\t\t\treset: record.lockedUntil,\n\t\t\t\tlocked: true,\n\t\t\t\tlockoutEnds: record.lockedUntil,\n\t\t\t};\n\t\t}\n\n\t\t// Clear lockout if expired\n\t\tif (record.lockedUntil && now >= record.lockedUntil) {\n\t\t\trecord.lockedUntil = undefined;\n\t\t}\n\n\t\t// Remove requests outside the sliding window\n\t\trecord.requests = record.requests.filter(\n\t\t\t(timestamp) => timestamp > now - this.windowMs,\n\t\t);\n\n\t\t// Check if limit exceeded\n\t\tif (record.requests.length >= this.maxRequests) {\n\t\t\t// Apply lockout with exponential backoff\n\t\t\tconst lockoutDuration =\n\t\t\t\tthis.windowMs *\n\t\t\t\tMath.pow(\n\t\t\t\t\tthis.lockoutMultiplier,\n\t\t\t\t\tMath.floor(record.requests.length / this.maxRequests),\n\t\t\t\t);\n\t\t\trecord.lockedUntil = now + lockoutDuration;\n\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tlimit: this.maxRequests,\n\t\t\t\tremaining: 0,\n\t\t\t\treset: record.lockedUntil,\n\t\t\t\tlocked: true,\n\t\t\t\tlockoutEnds: record.lockedUntil,\n\t\t\t};\n\t\t}\n\n\t\t// Add new request\n\t\trecord.requests.push(now);\n\t\trecord.count = record.requests.length;\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tlimit: this.maxRequests,\n\t\t\tremaining: this.maxRequests - record.count,\n\t\t\treset: now + this.windowMs,\n\t\t\tlocked: false,\n\t\t};\n\t}\n\n\tprivate cleanup() {\n\t\tconst now = Date.now();\n\t\tfor (const [key, record] of this.requests.entries()) {\n\t\t\trecord.requests = record.requests.filter(\n\t\t\t\t(timestamp) => timestamp > now - this.windowMs,\n\t\t\t);\n\t\t\t// Remove if no recent requests and no active lockout\n\t\t\tif (\n\t\t\t\trecord.requests.length === 0 &&\n\t\t\t\t(!record.lockedUntil || now >= record.lockedUntil)\n\t\t\t) {\n\t\t\t\tthis.requests.delete(key);\n\t\t\t}\n\t\t}\n\t}\n\n\treset(identifier: string) {\n\t\tthis.requests.delete(identifier.toLowerCase());\n\t}\n\n\tclear() {\n\t\tthis.requests.clear();\n\t}\n}\n\n// Admin auth rate limiter - stricter than contractor app\n// 3 attempts per 30 minutes, with exponential lockout\nconst adminAuthByEmailLimiter = new AdminRateLimiter(\n\t3, // 3 attempts\n\t30 * 60 * 1000, // per 30 minutes\n\t2, // double lockout each time\n);\n\n// IP-based limiter to prevent distributed attacks\nconst adminAuthByIPLimiter = new AdminRateLimiter(\n\t10, // 10 attempts\n\t30 * 60 * 1000, // per 30 minutes\n\t2,\n);\n\n/**\n * Rate Limit Error\n */\nexport class RateLimitError extends Error {\n\tpublic readonly retryAfter: number;\n\tpublic readonly locked: boolean;\n\n\tconstructor(\n\t\tmessage: string,\n\t\tretryAfter: number,\n\t\tlocked: boolean,\n\t) {\n\t\tsuper(message);\n\t\tthis.name = \"RateLimitError\";\n\t\tthis.retryAfter = retryAfter;\n\t\tthis.locked = locked;\n\t}\n}\n\n/**\n * Check Admin Auth Rate Limit\n *\n * Checks both email and IP-based limits.\n * Throws RateLimitError if either limit exceeded.\n *\n * @param email - User's email address\n * @param ip - Client IP address\n */\nexport async function checkAdminAuthRateLimit(\n\temail: string,\n\tip: string,\n): Promise<void> {\n\t// Check email-based limit\n\tconst emailResult = await adminAuthByEmailLimiter.limit(email);\n\tif (!emailResult.success) {\n\t\tconst retryAfterMs = emailResult.reset - Date.now();\n\t\tconst retryAfterSec = Math.ceil(retryAfterMs / 1000);\n\t\tconst minutes = Math.ceil(retryAfterSec / 60);\n\n\t\tthrow new RateLimitError(\n\t\t\temailResult.locked\n\t\t\t\t? `Account temporarily locked. Try again in ${minutes} minute${minutes === 1 ? \"\" : \"s\"}.`\n\t\t\t\t: `Too many login attempts. Try again in ${minutes} minute${minutes === 1 ? \"\" : \"s\"}.`,\n\t\t\tretryAfterMs,\n\t\t\temailResult.locked,\n\t\t);\n\t}\n\n\t// Check IP-based limit\n\tconst ipResult = await adminAuthByIPLimiter.limit(ip);\n\tif (!ipResult.success) {\n\t\tconst retryAfterMs = ipResult.reset - Date.now();\n\t\tconst retryAfterSec = Math.ceil(retryAfterMs / 1000);\n\t\tconst minutes = Math.ceil(retryAfterSec / 60);\n\n\t\tthrow new RateLimitError(\n\t\t\t`Too many requests from this location. Try again in ${minutes} minute${minutes === 1 ? \"\" : \"s\"}.`,\n\t\t\tretryAfterMs,\n\t\t\tipResult.locked,\n\t\t);\n\t}\n}\n\n/**\n * Reset Rate Limit for Email\n *\n * Call this after successful login to reset the counter.\n * This prevents legitimate users from being locked out after a typo.\n */\nexport function resetRateLimitForEmail(email: string): void {\n\tadminAuthByEmailLimiter.reset(email);\n}\n\n/**\n * Get Client IP Address\n *\n * Extracts IP from request headers for rate limiting.\n */\nexport function getClientIP(headers: Headers): string {\n\t// Check common proxy headers in order of preference\n\tconst forwarded = headers.get(\"x-forwarded-for\");\n\tif (forwarded) {\n\t\treturn forwarded.split(\",\")[0].trim();\n\t}\n\n\tconst realIP = headers.get(\"x-real-ip\");\n\tif (realIP) {\n\t\treturn realIP;\n\t}\n\n\tconst cfIP = headers.get(\"cf-connecting-ip\"); // Cloudflare\n\tif (cfIP) {\n\t\treturn cfIP;\n\t}\n\n\tconst vercelIP = headers.get(\"x-vercel-forwarded-for\");\n\tif (vercelIP) {\n\t\treturn vercelIP.split(\",\")[0].trim();\n\t}\n\n\treturn \"unknown\";\n}\n","/**\n * Admin Audit Logging\n *\n * Logs all authentication and security events for the admin dashboard.\n * Critical for compliance, security monitoring, and incident response.\n *\n * Events logged:\n * - Login attempts (success/failure)\n * - Logout events\n * - Session refreshes\n * - Unauthorized access attempts\n * - Rate limit violations\n * - Domain validation failures\n */\n\nexport type AuditEventType =\n\t| \"LOGIN_ATTEMPT\"\n\t| \"LOGIN_SUCCESS\"\n\t| \"LOGIN_FAILURE\"\n\t| \"LOGOUT\"\n\t| \"SESSION_REFRESH\"\n\t| \"UNAUTHORIZED_ACCESS\"\n\t| \"RATE_LIMIT_EXCEEDED\"\n\t| \"INVALID_DOMAIN\"\n\t| \"SUSPICIOUS_ACTIVITY\";\n\nexport type AuditEventSeverity = \"INFO\" | \"WARN\" | \"ERROR\" | \"CRITICAL\";\n\nexport interface AuditEvent {\n\ttimestamp: string;\n\teventType: AuditEventType;\n\tseverity: AuditEventSeverity;\n\temail?: string;\n\tip?: string;\n\tuserAgent?: string;\n\tdetails?: Record<string, unknown>;\n\tsuccess: boolean;\n}\n\n/**\n * Determine severity based on event type\n */\nfunction getSeverity(eventType: AuditEventType, success: boolean): AuditEventSeverity {\n\tswitch (eventType) {\n\t\tcase \"LOGIN_SUCCESS\":\n\t\tcase \"LOGOUT\":\n\t\tcase \"SESSION_REFRESH\":\n\t\t\treturn \"INFO\";\n\n\t\tcase \"LOGIN_ATTEMPT\":\n\t\t\treturn \"INFO\";\n\n\t\tcase \"LOGIN_FAILURE\":\n\t\t\treturn \"WARN\";\n\n\t\tcase \"RATE_LIMIT_EXCEEDED\":\n\t\tcase \"INVALID_DOMAIN\":\n\t\t\treturn \"WARN\";\n\n\t\tcase \"UNAUTHORIZED_ACCESS\":\n\t\t\treturn \"ERROR\";\n\n\t\tcase \"SUSPICIOUS_ACTIVITY\":\n\t\t\treturn \"CRITICAL\";\n\n\t\tdefault:\n\t\t\treturn success ? \"INFO\" : \"WARN\";\n\t}\n}\n\n/**\n * Log Admin Auth Event\n *\n * Logs authentication events with structured data.\n * Persists to both console and the admin_audit_logs database table.\n *\n * @param eventType - Type of authentication event\n * @param options - Event details\n */\nexport async function logAdminAuthEvent(\n\teventType: AuditEventType,\n\toptions: {\n\t\temail?: string;\n\t\tip?: string;\n\t\tuserAgent?: string;\n\t\tsuccess: boolean;\n\t\tdetails?: Record<string, unknown>;\n\t},\n): Promise<void> {\n\tconst event: AuditEvent = {\n\t\ttimestamp: new Date().toISOString(),\n\t\teventType,\n\t\tseverity: getSeverity(eventType, options.success),\n\t\temail: options.email ? maskEmail(options.email) : undefined,\n\t\tip: options.ip,\n\t\tuserAgent: options.userAgent,\n\t\tdetails: options.details,\n\t\tsuccess: options.success,\n\t};\n\n\t// Log to console in structured format\n\tconst logMessage = formatLogMessage(event);\n\n\tswitch (event.severity) {\n\t\tcase \"CRITICAL\":\n\t\tcase \"ERROR\":\n\t\t\tconsole.error(logMessage);\n\t\t\tbreak;\n\t\tcase \"WARN\":\n\t\t\tconsole.warn(logMessage);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tconsole.log(logMessage);\n\t}\n\n\t// Persist to database\n\ttry {\n\t\tconst { createClient } = await import(\"@/lib/supabase/server\");\n\t\tconst supabase = await createClient();\n\n\t\tawait supabase.from(\"admin_audit_logs\").insert({\n\t\t\taction: eventType,\n\t\t\tadmin_email: options.email,\n\t\t\tip_address: options.ip,\n\t\t\tuser_agent: options.userAgent,\n\t\t\tdetails: {\n\t\t\t\t...options.details,\n\t\t\t\tsuccess: options.success,\n\t\t\t\tseverity: event.severity,\n\t\t\t},\n\t\t});\n\t} catch (error) {\n\t\t// Don't fail the main operation if audit logging fails\n\t\tconsole.error(\"[AUDIT_LOG] Failed to persist audit log:\", error);\n\t}\n}\n\n/**\n * Format log message for structured logging\n */\nfunction formatLogMessage(event: AuditEvent): string {\n\tconst base = `[ADMIN_AUTH] [${event.severity}] ${event.eventType}`;\n\tconst details = [\n\t\tevent.email && `email=${event.email}`,\n\t\tevent.ip && `ip=${event.ip}`,\n\t\t`success=${event.success}`,\n\t\tevent.details && `details=${JSON.stringify(event.details)}`,\n\t]\n\t\t.filter(Boolean)\n\t\t.join(\" \");\n\n\treturn `${base} ${details}`;\n}\n\n/**\n * Mask email for privacy in logs\n * user@domain.com -> u***@domain.com\n */\nfunction maskEmail(email: string): string {\n\tconst [local, domain] = email.split(\"@\");\n\tif (!local || !domain) return \"***@***\";\n\n\tif (local.length <= 2) {\n\t\treturn `${local[0]}***@${domain}`;\n\t}\n\n\treturn `${local[0]}***${local[local.length - 1]}@${domain}`;\n}\n\n/**\n * Log successful admin login\n */\nexport async function logAdminLoginSuccess(\n\temail: string,\n\tip: string,\n\tuserAgent?: string,\n): Promise<void> {\n\tawait logAdminAuthEvent(\"LOGIN_SUCCESS\", {\n\t\temail,\n\t\tip,\n\t\tuserAgent,\n\t\tsuccess: true,\n\t});\n}\n\n/**\n * Log failed admin login attempt\n */\nexport async function logAdminLoginFailure(\n\temail: string,\n\tip: string,\n\treason: string,\n\tuserAgent?: string,\n): Promise<void> {\n\tawait logAdminAuthEvent(\"LOGIN_FAILURE\", {\n\t\temail,\n\t\tip,\n\t\tuserAgent,\n\t\tsuccess: false,\n\t\tdetails: { reason },\n\t});\n}\n\n/**\n * Log rate limit exceeded\n */\nexport async function logRateLimitExceeded(\n\temail: string,\n\tip: string,\n\tlockedUntil?: number,\n): Promise<void> {\n\tawait logAdminAuthEvent(\"RATE_LIMIT_EXCEEDED\", {\n\t\temail,\n\t\tip,\n\t\tsuccess: false,\n\t\tdetails: {\n\t\t\tlockedUntil: lockedUntil ? new Date(lockedUntil).toISOString() : undefined,\n\t\t},\n\t});\n}\n\n/**\n * Log invalid domain attempt\n */\nexport async function logInvalidDomainAttempt(\n\temail: string,\n\tip: string,\n): Promise<void> {\n\tawait logAdminAuthEvent(\"INVALID_DOMAIN\", {\n\t\temail,\n\t\tip,\n\t\tsuccess: false,\n\t\tdetails: {\n\t\t\tdomain: email.split(\"@\")[1]?.toLowerCase(),\n\t\t\tmessage: \"Non-admin domain attempted admin login\",\n\t\t},\n\t});\n}\n\n/**\n * Log unauthorized access attempt\n */\nexport async function logUnauthorizedAccess(\n\temail: string | undefined,\n\tip: string,\n\tpath: string,\n): Promise<void> {\n\tawait logAdminAuthEvent(\"UNAUTHORIZED_ACCESS\", {\n\t\temail,\n\t\tip,\n\t\tsuccess: false,\n\t\tdetails: { path },\n\t});\n}\n"],"names":["RequestCookies","ResponseCookies","stringifyCookie","registerServerReference","ensureServerEntryExports","actions","i","length","action","Error","ReadonlyURLSearchParams","ReadonlyURLSearchParamsError","constructor","URLSearchParams","append","delete","set","sort","RedirectStatusCode","REDIRECT_ERROR_CODE","RedirectType","isRedirectError","error","digest","split","errorCode","type","destination","slice","join","status","at","statusCode","Number","isNaN","getRedirectError","getRedirectStatusCodeFromError","getRedirectTypeFromError","getURLFromRedirectError","permanentRedirect","redirect","actionAsyncStorage","window","require","undefined","url","TemporaryRedirect","getStore","isAction","push","replace","PermanentRedirect","HTTPAccessErrorStatus","HTTP_ERROR_FALLBACK_ERROR_CODE","getAccessFallbackErrorTypeByStatus","getAccessFallbackHTTPStatus","isHTTPAccessFallbackError","NOT_FOUND","FORBIDDEN","UNAUTHORIZED","ALLOWED_CODES","Set","Object","values","prefix","httpStatus","has","notFound","DIGEST","forbidden","process","env","__NEXT_EXPERIMENTAL_AUTH_INTERRUPTS","unauthorized","isPostpone","REACT_POSTPONE_TYPE","Symbol","for","$$typeof","isNextRouterError","unstable_rethrow","isBailoutToCSRError","isDynamicServerError","isDynamicPostpone","isHangingPromiseRejectionError","isPrerenderInterruptedError","cause","unstable_isUnrecognizedActionError"],"mappings":"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","ignoreList":[0,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]}