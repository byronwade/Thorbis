{"version":3,"sources":["turbopack:///[project]/apps/admin/src/actions/campaigns.ts"],"sourcesContent":["\"use server\";\n\n/**\n * Campaign Server Actions\n *\n * Server-side actions for managing email marketing campaigns.\n * Handles CRUD operations, sending via Resend, scheduling, and analytics.\n */\n\nimport { revalidatePath } from \"next/cache\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { getWebReaderClient } from \"@/lib/supabase/web-reader\";\nimport { Resend } from \"resend\";\nimport type { CampaignDraft, EmailCampaign, AudienceFilter } from \"@/types/campaigns\";\n\n// Initialize Resend client\nconst resend = new Resend(process.env.RESEND_API_KEY);\n\n// Platform email configuration\nconst PLATFORM_FROM_EMAIL = process.env.RESEND_FROM_EMAIL || \"hello@thorbis.com\";\nconst PLATFORM_FROM_NAME = process.env.RESEND_FROM_NAME || \"Thorbis\";\n\n// ============================================================================\n// Types\n// ============================================================================\n\ntype ActionResult<T = void> = {\n\tsuccess: boolean;\n\tdata?: T;\n\terror?: string;\n};\n\ntype CreateCampaignInput = CampaignDraft;\n\ntype UpdateCampaignInput = Partial<CampaignDraft> & {\n\tid: string;\n};\n\ntype SendCampaignResult = {\n\tcampaignId: string;\n\trecipientCount: number;\n\testimatedCompletionTime: string;\n};\n\ntype AudiencePreviewResult = {\n\testimatedCount: number;\n\tsampleRecipients: {\n\t\temail: string;\n\t\tname?: string;\n\t\ttype: string;\n\t}[];\n};\n\n// ============================================================================\n// Campaign CRUD Actions\n// ============================================================================\n\n/**\n * Create a new campaign as a draft\n */\nexport async function createCampaign(\n\tinput: CreateCampaignInput\n): Promise<ActionResult<EmailCampaign>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.insert({\n\t\t\t\tname: input.name,\n\t\t\t\tsubject: input.subject,\n\t\t\t\tpreview_text: input.previewText,\n\t\t\t\ttemplate_id: input.templateId,\n\t\t\t\ttemplate_data: input.templateData,\n\t\t\t\thtml_content: input.htmlContent,\n\t\t\t\tplain_text_content: input.plainTextContent,\n\t\t\t\taudience_type: input.audienceType,\n\t\t\t\taudience_filter: input.audienceFilter,\n\t\t\t\tfrom_name: input.fromName || PLATFORM_FROM_NAME,\n\t\t\t\tfrom_email: input.fromEmail || PLATFORM_FROM_EMAIL,\n\t\t\t\treply_to: input.replyTo,\n\t\t\t\ttags: input.tags || [],\n\t\t\t\tnotes: input.notes,\n\t\t\t\tstatus: \"draft\",\n\t\t\t\ttotal_recipients: 0,\n\t\t\t\tsent_count: 0,\n\t\t\t\tdelivered_count: 0,\n\t\t\t\topened_count: 0,\n\t\t\t\tunique_opens: 0,\n\t\t\t\tclicked_count: 0,\n\t\t\t\tunique_clicks: 0,\n\t\t\t\tbounced_count: 0,\n\t\t\t\tcomplained_count: 0,\n\t\t\t\tunsubscribed_count: 0,\n\t\t\t\tfailed_count: 0,\n\t\t\t\trevenue_attributed: 0,\n\t\t\t\tconversions_count: 0,\n\t\t\t})\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to create campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to create campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: mapCampaignFromDb(data),\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to create campaign:\", error);\n\t\treturn { success: false, error: \"Failed to create campaign\" };\n\t}\n}\n\n/**\n * Update an existing campaign\n */\nexport async function updateCampaign(\n\tinput: UpdateCampaignInput\n): Promise<ActionResult<EmailCampaign>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Build update object with only provided fields\n\t\tconst updateData: Record<string, unknown> = {\n\t\t\tupdated_at: new Date().toISOString(),\n\t\t};\n\n\t\tif (input.name !== undefined) updateData.name = input.name;\n\t\tif (input.subject !== undefined) updateData.subject = input.subject;\n\t\tif (input.previewText !== undefined) updateData.preview_text = input.previewText;\n\t\tif (input.templateId !== undefined) updateData.template_id = input.templateId;\n\t\tif (input.templateData !== undefined) updateData.template_data = input.templateData;\n\t\tif (input.htmlContent !== undefined) updateData.html_content = input.htmlContent;\n\t\tif (input.plainTextContent !== undefined) updateData.plain_text_content = input.plainTextContent;\n\t\tif (input.audienceType !== undefined) updateData.audience_type = input.audienceType;\n\t\tif (input.audienceFilter !== undefined) updateData.audience_filter = input.audienceFilter;\n\t\tif (input.fromName !== undefined) updateData.from_name = input.fromName;\n\t\tif (input.fromEmail !== undefined) updateData.from_email = input.fromEmail;\n\t\tif (input.replyTo !== undefined) updateData.reply_to = input.replyTo;\n\t\tif (input.tags !== undefined) updateData.tags = input.tags;\n\t\tif (input.notes !== undefined) updateData.notes = input.notes;\n\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update(updateData)\n\t\t\t.eq(\"id\", input.id)\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to update campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to update campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${input.id}`);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: mapCampaignFromDb(data),\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to update campaign:\", error);\n\t\treturn { success: false, error: \"Failed to update campaign\" };\n\t}\n}\n\n/**\n * Delete a draft campaign\n */\nexport async function deleteCampaign(id: string): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Only allow deleting drafts\n\t\tconst { data: campaign } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.select(\"status\")\n\t\t\t.eq(\"id\", id)\n\t\t\t.single();\n\n\t\tif (campaign?.status !== \"draft\") {\n\t\t\treturn { success: false, error: \"Only draft campaigns can be deleted\" };\n\t\t}\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.delete()\n\t\t\t.eq(\"id\", id);\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to delete campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to delete campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to delete campaign:\", error);\n\t\treturn { success: false, error: \"Failed to delete campaign\" };\n\t}\n}\n\n/**\n * Duplicate an existing campaign\n */\nexport async function duplicateCampaign(id: string): Promise<ActionResult<EmailCampaign>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Fetch original campaign\n\t\tconst { data: original, error: fetchError } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"id\", id)\n\t\t\t.single();\n\n\t\tif (fetchError || !original) {\n\t\t\treturn { success: false, error: \"Campaign not found\" };\n\t\t}\n\n\t\t// Create copy with reset stats\n\t\tconst { data, error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.insert({\n\t\t\t\tname: `${original.name} (Copy)`,\n\t\t\t\tsubject: original.subject,\n\t\t\t\tpreview_text: original.preview_text,\n\t\t\t\ttemplate_id: original.template_id,\n\t\t\t\ttemplate_data: original.template_data,\n\t\t\t\thtml_content: original.html_content,\n\t\t\t\tplain_text_content: original.plain_text_content,\n\t\t\t\taudience_type: original.audience_type,\n\t\t\t\taudience_filter: original.audience_filter,\n\t\t\t\tfrom_name: original.from_name,\n\t\t\t\tfrom_email: original.from_email,\n\t\t\t\treply_to: original.reply_to,\n\t\t\t\ttags: original.tags,\n\t\t\t\tnotes: original.notes,\n\t\t\t\tstatus: \"draft\",\n\t\t\t\ttotal_recipients: 0,\n\t\t\t\tsent_count: 0,\n\t\t\t\tdelivered_count: 0,\n\t\t\t\topened_count: 0,\n\t\t\t\tunique_opens: 0,\n\t\t\t\tclicked_count: 0,\n\t\t\t\tunique_clicks: 0,\n\t\t\t\tbounced_count: 0,\n\t\t\t\tcomplained_count: 0,\n\t\t\t\tunsubscribed_count: 0,\n\t\t\t\tfailed_count: 0,\n\t\t\t\trevenue_attributed: 0,\n\t\t\t\tconversions_count: 0,\n\t\t\t})\n\t\t\t.select()\n\t\t\t.single();\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to duplicate campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to duplicate campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: mapCampaignFromDb(data),\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to duplicate campaign:\", error);\n\t\treturn { success: false, error: \"Failed to duplicate campaign\" };\n\t}\n}\n\n// ============================================================================\n// Campaign Sending Actions\n// ============================================================================\n\n/**\n * Send a campaign immediately\n */\nexport async function sendCampaign(id: string): Promise<ActionResult<SendCampaignResult>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Get campaign details\n\t\tconst { data: campaign, error: fetchError } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"id\", id)\n\t\t\t.single();\n\n\t\tif (fetchError || !campaign) {\n\t\t\treturn { success: false, error: \"Campaign not found\" };\n\t\t}\n\n\t\tif (campaign.status !== \"draft\") {\n\t\t\treturn { success: false, error: \"Only draft campaigns can be sent\" };\n\t\t}\n\n\t\t// Get recipients based on audience type\n\t\tconst recipients = await getAudienceRecipients(campaign.audience_type, campaign.audience_filter);\n\n\t\tif (recipients.length === 0) {\n\t\t\treturn { success: false, error: \"No recipients found for this audience\" };\n\t\t}\n\n\t\t// Update campaign status to sending\n\t\tawait supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"sending\",\n\t\t\t\tsending_started_at: new Date().toISOString(),\n\t\t\t\ttotal_recipients: recipients.length,\n\t\t\t})\n\t\t\t.eq(\"id\", id);\n\n\t\t// Create send records for each recipient\n\t\tconst sendRecords = recipients.map((recipient) => ({\n\t\t\tcampaign_id: id,\n\t\t\trecipient_email: recipient.email,\n\t\t\trecipient_name: recipient.name,\n\t\t\trecipient_type: recipient.type,\n\t\t\trecipient_id: recipient.id,\n\t\t\tstatus: \"pending\",\n\t\t}));\n\n\t\tawait supabase.from(\"email_campaign_sends\").insert(sendRecords);\n\n\t\t// Send emails via Resend (batch processing)\n\t\tlet sentCount = 0;\n\t\tlet failedCount = 0;\n\n\t\tfor (const recipient of recipients) {\n\t\t\ttry {\n\t\t\t\tconst { data: sendResult, error: sendError } = await resend.emails.send({\n\t\t\t\t\tfrom: `${campaign.from_name} <${campaign.from_email}>`,\n\t\t\t\t\tto: recipient.email,\n\t\t\t\t\tsubject: campaign.subject,\n\t\t\t\t\thtml: campaign.html_content || `<p>${campaign.plain_text_content}</p>`,\n\t\t\t\t\ttext: campaign.plain_text_content,\n\t\t\t\t\treplyTo: campaign.reply_to,\n\t\t\t\t\ttags: [\n\t\t\t\t\t\t{ name: \"campaign_id\", value: id },\n\t\t\t\t\t\t{ name: \"recipient_type\", value: recipient.type },\n\t\t\t\t\t],\n\t\t\t\t});\n\n\t\t\t\tif (sendError) {\n\t\t\t\t\tfailedCount++;\n\t\t\t\t\t// Update send record with error\n\t\t\t\t\tawait supabase\n\t\t\t\t\t\t.from(\"email_campaign_sends\")\n\t\t\t\t\t\t.update({\n\t\t\t\t\t\t\tstatus: \"failed\",\n\t\t\t\t\t\t\terror_message: sendError.message,\n\t\t\t\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.eq(\"campaign_id\", id)\n\t\t\t\t\t\t.eq(\"recipient_email\", recipient.email);\n\t\t\t\t} else {\n\t\t\t\t\tsentCount++;\n\t\t\t\t\t// Update send record with Resend ID\n\t\t\t\t\tawait supabase\n\t\t\t\t\t\t.from(\"email_campaign_sends\")\n\t\t\t\t\t\t.update({\n\t\t\t\t\t\t\tstatus: \"sent\",\n\t\t\t\t\t\t\tresend_id: sendResult?.id,\n\t\t\t\t\t\t\tsent_at: new Date().toISOString(),\n\t\t\t\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.eq(\"campaign_id\", id)\n\t\t\t\t\t\t.eq(\"recipient_email\", recipient.email);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tfailedCount++;\n\t\t\t\tconsole.error(`Failed to send to ${recipient.email}:`, err);\n\t\t\t}\n\t\t}\n\n\t\t// Update campaign with final stats\n\t\tawait supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"sent\",\n\t\t\t\tsent_at: new Date().toISOString(),\n\t\t\t\tcompleted_at: new Date().toISOString(),\n\t\t\t\tsent_count: sentCount,\n\t\t\t\tfailed_count: failedCount,\n\t\t\t})\n\t\t\t.eq(\"id\", id);\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: {\n\t\t\t\tcampaignId: id,\n\t\t\t\trecipientCount: recipients.length,\n\t\t\t\testimatedCompletionTime: new Date().toISOString(),\n\t\t\t},\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to send campaign:\", error);\n\t\treturn { success: false, error: \"Failed to send campaign\" };\n\t}\n}\n\n/**\n * Schedule a campaign for later\n */\nexport async function scheduleCampaign(\n\tid: string,\n\tscheduledFor: string\n): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Validate campaign is in draft status\n\t\tconst { data: campaign } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.select(\"status, audience_type, audience_filter\")\n\t\t\t.eq(\"id\", id)\n\t\t\t.single();\n\n\t\tif (campaign?.status !== \"draft\") {\n\t\t\treturn { success: false, error: \"Only draft campaigns can be scheduled\" };\n\t\t}\n\n\t\t// Get recipient count for the campaign\n\t\tconst recipients = await getAudienceRecipients(campaign.audience_type, campaign.audience_filter);\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"scheduled\",\n\t\t\t\tscheduled_for: scheduledFor,\n\t\t\t\ttotal_recipients: recipients.length,\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", id);\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to schedule campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to schedule campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to schedule campaign:\", error);\n\t\treturn { success: false, error: \"Failed to schedule campaign\" };\n\t}\n}\n\n/**\n * Cancel a scheduled campaign\n */\nexport async function cancelScheduledCampaign(id: string): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"draft\",\n\t\t\t\tscheduled_for: null,\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", id)\n\t\t\t.eq(\"status\", \"scheduled\");\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to cancel scheduled campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to cancel scheduled campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to cancel scheduled campaign:\", error);\n\t\treturn { success: false, error: \"Failed to cancel scheduled campaign\" };\n\t}\n}\n\n/**\n * Pause a sending campaign\n */\nexport async function pauseCampaign(id: string): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"paused\",\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", id)\n\t\t\t.eq(\"status\", \"sending\");\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to pause campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to pause campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to pause campaign:\", error);\n\t\treturn { success: false, error: \"Failed to pause campaign\" };\n\t}\n}\n\n/**\n * Resume a paused campaign\n */\nexport async function resumeCampaign(id: string): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\tconst { error } = await supabase\n\t\t\t.from(\"email_campaigns\")\n\t\t\t.update({\n\t\t\t\tstatus: \"sending\",\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t})\n\t\t\t.eq(\"id\", id)\n\t\t\t.eq(\"status\", \"paused\");\n\n\t\tif (error) {\n\t\t\tconsole.error(\"Failed to resume campaign:\", error);\n\t\t\treturn { success: false, error: \"Failed to resume campaign\" };\n\t\t}\n\n\t\trevalidatePath(\"/dashboard/marketing/campaigns\");\n\t\trevalidatePath(`/dashboard/marketing/campaigns/${id}`);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to resume campaign:\", error);\n\t\treturn { success: false, error: \"Failed to resume campaign\" };\n\t}\n}\n\n// ============================================================================\n// Audience Actions\n// ============================================================================\n\n/**\n * Preview audience based on filters\n * Returns estimated count and sample recipients\n */\nexport async function previewAudience(\n\taudienceType: string,\n\tfilter?: AudienceFilter\n): Promise<ActionResult<AudiencePreviewResult>> {\n\ttry {\n\t\tconst recipients = await getAudienceRecipients(audienceType, filter);\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: {\n\t\t\t\testimatedCount: recipients.length,\n\t\t\t\tsampleRecipients: recipients.slice(0, 5).map((r) => ({\n\t\t\t\t\temail: r.email,\n\t\t\t\t\tname: r.name,\n\t\t\t\t\ttype: r.type,\n\t\t\t\t})),\n\t\t\t},\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to preview audience:\", error);\n\t\treturn { success: false, error: \"Failed to preview audience\" };\n\t}\n}\n\n// ============================================================================\n// Analytics Actions\n// ============================================================================\n\n/**\n * Get campaign analytics\n */\nexport async function getCampaignAnalytics(id: string): Promise<ActionResult<{\n\ttopLinks: { url: string; linkText: string; clicks: number; uniqueClicks: number }[];\n\tdeviceBreakdown: { desktop: number; mobile: number; tablet: number };\n\thourlyOpens: { hour: string; opens: number }[];\n}>> {\n\ttry {\n\t\tconst supabase = await createClient();\n\n\t\t// Get link performance\n\t\tconst { data: links } = await supabase\n\t\t\t.from(\"email_campaign_links\")\n\t\t\t.select(\"*\")\n\t\t\t.eq(\"campaign_id\", id)\n\t\t\t.order(\"unique_clicks\", { ascending: false })\n\t\t\t.limit(10);\n\n\t\tconst topLinks = (links || []).map((link) => ({\n\t\t\turl: link.original_url,\n\t\t\tlinkText: link.link_text || link.original_url,\n\t\t\tclicks: link.total_clicks || 0,\n\t\t\tuniqueClicks: link.unique_clicks || 0,\n\t\t}));\n\n\t\t// Get send metadata for device breakdown (from metadata JSONB)\n\t\tconst { data: sends } = await supabase\n\t\t\t.from(\"email_campaign_sends\")\n\t\t\t.select(\"metadata, first_opened_at\")\n\t\t\t.eq(\"campaign_id\", id)\n\t\t\t.not(\"first_opened_at\", \"is\", null);\n\n\t\t// Calculate device breakdown from metadata\n\t\tlet desktop = 0;\n\t\tlet mobile = 0;\n\t\tlet tablet = 0;\n\n\t\t(sends || []).forEach((send) => {\n\t\t\tconst device = (send.metadata as Record<string, unknown>)?.device as string;\n\t\t\tif (device === \"mobile\") mobile++;\n\t\t\telse if (device === \"tablet\") tablet++;\n\t\t\telse desktop++;\n\t\t});\n\n\t\tconst total = desktop + mobile + tablet || 1;\n\t\tconst deviceBreakdown = {\n\t\t\tdesktop: Math.round((desktop / total) * 100),\n\t\t\tmobile: Math.round((mobile / total) * 100),\n\t\t\ttablet: Math.round((tablet / total) * 100),\n\t\t};\n\n\t\t// Calculate hourly opens\n\t\tconst hourlyMap: Record<string, number> = {};\n\t\t(sends || []).forEach((send) => {\n\t\t\tif (send.first_opened_at) {\n\t\t\t\tconst hour = new Date(send.first_opened_at).getHours();\n\t\t\t\tconst hourLabel = hour < 12 ? `${hour || 12} AM` : `${hour === 12 ? 12 : hour - 12} PM`;\n\t\t\t\thourlyMap[hourLabel] = (hourlyMap[hourLabel] || 0) + 1;\n\t\t\t}\n\t\t});\n\n\t\tconst hourlyOpens = Object.entries(hourlyMap)\n\t\t\t.map(([hour, opens]) => ({ hour, opens }))\n\t\t\t.sort((a, b) => {\n\t\t\t\tconst parseHour = (h: string) => {\n\t\t\t\t\tconst [num, period] = h.split(\" \");\n\t\t\t\t\treturn period === \"PM\" && num !== \"12\" ? parseInt(num) + 12 : parseInt(num);\n\t\t\t\t};\n\t\t\t\treturn parseHour(a.hour) - parseHour(b.hour);\n\t\t\t});\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tdata: { topLinks, deviceBreakdown, hourlyOpens },\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\"Failed to get campaign analytics:\", error);\n\t\treturn { success: false, error: \"Failed to get campaign analytics\" };\n\t}\n}\n\n/**\n * Record a webhook event (open, click, bounce, etc.)\n * Called by Resend webhooks\n */\nexport async function recordCampaignEvent(\n\tcampaignId: string,\n\trecipientEmail: string,\n\teventType: \"delivered\" | \"opened\" | \"clicked\" | \"bounced\" | \"complained\" | \"unsubscribed\",\n\teventData?: Record<string, unknown>\n): Promise<ActionResult> {\n\ttry {\n\t\tconst supabase = await createClient();\n\t\tconst now = new Date().toISOString();\n\n\t\t// Update send record\n\t\tconst updateData: Record<string, unknown> = {\n\t\t\tupdated_at: now,\n\t\t};\n\n\t\tswitch (eventType) {\n\t\t\tcase \"delivered\":\n\t\t\t\tupdateData.status = \"delivered\";\n\t\t\t\tupdateData.delivered_at = now;\n\t\t\t\tbreak;\n\t\t\tcase \"opened\":\n\t\t\t\tupdateData.status = \"opened\";\n\t\t\t\tupdateData.last_opened_at = now;\n\t\t\t\t// Increment open count\n\t\t\t\tawait supabase.rpc(\"increment_campaign_send_open_count\", {\n\t\t\t\t\tp_campaign_id: campaignId,\n\t\t\t\t\tp_recipient_email: recipientEmail,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase \"clicked\":\n\t\t\t\tupdateData.status = \"clicked\";\n\t\t\t\tupdateData.last_clicked_at = now;\n\t\t\t\tif (eventData?.url) {\n\t\t\t\t\t// Record link click\n\t\t\t\t\tawait supabase.rpc(\"increment_campaign_link_click\", {\n\t\t\t\t\t\tp_campaign_id: campaignId,\n\t\t\t\t\t\tp_url: eventData.url,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"bounced\":\n\t\t\t\tupdateData.status = \"bounced\";\n\t\t\t\tupdateData.bounced_at = now;\n\t\t\t\tupdateData.error_message = eventData?.reason as string;\n\t\t\t\tbreak;\n\t\t\tcase \"complained\":\n\t\t\t\tupdateData.status = \"complained\";\n\t\t\t\tupdateData.complained_at = now;\n\t\t\t\tbreak;\n\t\t\tcase \"unsubscribed\":\n\t\t\t\tupdateData.unsubscribed_at = now;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tawait supabase\n\t\t\t.from(\"email_campaign_sends\")\n\t\t\t.update(updateData)\n\t\t\t.eq(\"campaign_id\", campaignId)\n\t\t\t.eq(\"recipient_email\", recipientEmail);\n\n\t\t// Update aggregate campaign stats\n\t\tawait updateCampaignStats(campaignId);\n\n\t\treturn { success: true };\n\t} catch (error) {\n\t\tconsole.error(\"Failed to record campaign event:\", error);\n\t\treturn { success: false, error: \"Failed to record campaign event\" };\n\t}\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/**\n * Get recipients based on audience type and filter\n * Uses web database for users/companies (read-only access)\n * Uses admin database for email suppressions\n */\nasync function getAudienceRecipients(\n\taudienceType: string,\n\tfilter?: AudienceFilter | null\n): Promise<{ email: string; name?: string; type: string; id?: string }[]> {\n\tconst adminDb = await createClient();\n\tconst webDb = getWebReaderClient();\n\tconst recipients: { email: string; name?: string; type: string; id?: string }[] = [];\n\n\t// Return empty if web database is not configured (for audience types that need it)\n\tif (!webDb && [\"all_users\", \"all_companies\", \"segment\"].includes(audienceType)) {\n\t\tconsole.warn(\"Web database reader not configured, returning empty recipients for:\", audienceType);\n\t\treturn recipients;\n\t}\n\n\tswitch (audienceType) {\n\t\tcase \"waitlist\": {\n\t\t\t// Get waitlist subscribers from admin database\n\t\t\tconst { data: waitlistData } = await adminDb\n\t\t\t\t.from(\"waitlist\")\n\t\t\t\t.select(\"id, email, name\")\n\t\t\t\t.eq(\"status\", \"pending\")\n\t\t\t\t.not(\"email\", \"is\", null);\n\n\t\t\trecipients.push(...(waitlistData || []).map((w) => ({\n\t\t\t\temail: w.email,\n\t\t\t\tname: w.name || undefined,\n\t\t\t\ttype: \"waitlist\",\n\t\t\t\tid: w.id,\n\t\t\t})));\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"all_users\": {\n\t\t\t// Get all users from the WEB database (read-only)\n\t\t\tconst { data: users } = await webDb!\n\t\t\t\t.from(\"users\")\n\t\t\t\t.select(\"id, email, full_name\")\n\t\t\t\t.not(\"email\", \"is\", null) as { data: { id: string; email: string; full_name: string | null }[] | null };\n\n\t\t\trecipients.push(...(users || []).map((u) => ({\n\t\t\t\temail: u.email,\n\t\t\t\tname: u.full_name || undefined,\n\t\t\t\ttype: \"user\",\n\t\t\t\tid: u.id,\n\t\t\t})));\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"all_companies\": {\n\t\t\t// Get primary contacts from all companies in WEB database (read-only)\n\t\t\tconst { data: companies } = await webDb!\n\t\t\t\t.from(\"companies\")\n\t\t\t\t.select(\"id, email, name\")\n\t\t\t\t.not(\"email\", \"is\", null) as { data: { id: string; email: string; name: string | null }[] | null };\n\n\t\t\trecipients.push(...(companies || []).map((c) => ({\n\t\t\t\temail: c.email,\n\t\t\t\tname: c.name || undefined,\n\t\t\t\ttype: \"company\",\n\t\t\t\tid: c.id,\n\t\t\t})));\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"custom\": {\n\t\t\t// Use custom email list from filter\n\t\t\tif (filter?.customEmails) {\n\t\t\t\trecipients.push(...filter.customEmails.map((email) => ({\n\t\t\t\t\temail,\n\t\t\t\t\ttype: \"custom\",\n\t\t\t\t})));\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\n\t\tcase \"segment\": {\n\t\t\t// Filter users based on segment criteria from WEB database (read-only)\n\t\t\ttype UserResult = { id: string; email: string; full_name: string | null; role: string | null };\n\t\t\tlet query = webDb!.from(\"users\").select(\"id, email, full_name, role\");\n\n\t\t\tif (filter?.userRoles?.length) {\n\t\t\t\tquery = query.in(\"role\", filter.userRoles);\n\t\t\t}\n\t\t\tif (filter?.userStatuses?.length) {\n\t\t\t\tquery = query.in(\"status\", filter.userStatuses);\n\t\t\t}\n\t\t\tif (filter?.createdAfter) {\n\t\t\t\tquery = query.gte(\"created_at\", filter.createdAfter);\n\t\t\t}\n\t\t\tif (filter?.createdBefore) {\n\t\t\t\tquery = query.lte(\"created_at\", filter.createdBefore);\n\t\t\t}\n\n\t\t\tconst { data: users } = await query.not(\"email\", \"is\", null) as { data: UserResult[] | null };\n\t\t\trecipients.push(...(users || []).map((u) => ({\n\t\t\t\temail: u.email,\n\t\t\t\tname: u.full_name || undefined,\n\t\t\t\ttype: \"segment\",\n\t\t\t\tid: u.id,\n\t\t\t})));\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t// Apply exclusions from admin database\n\tif (filter?.excludeUnsubscribed || filter?.excludeBounced || filter?.excludeComplained) {\n\t\t// Get suppressed emails from admin database\n\t\tconst { data: suppressions } = await adminDb\n\t\t\t.from(\"email_suppressions\")\n\t\t\t.select(\"email, reason\");\n\n\t\tconst suppressedEmails = new Set(\n\t\t\t(suppressions || [])\n\t\t\t\t.filter((s) => {\n\t\t\t\t\tif (filter.excludeUnsubscribed && s.reason === \"unsubscribed\") return true;\n\t\t\t\t\tif (filter.excludeBounced && s.reason === \"bounced\") return true;\n\t\t\t\t\tif (filter.excludeComplained && s.reason === \"complained\") return true;\n\t\t\t\t\treturn false;\n\t\t\t\t})\n\t\t\t\t.map((s) => s.email.toLowerCase())\n\t\t);\n\n\t\treturn recipients.filter((r) => !suppressedEmails.has(r.email.toLowerCase()));\n\t}\n\n\treturn recipients;\n}\n\n\n/**\n * Update aggregate campaign statistics\n */\nasync function updateCampaignStats(campaignId: string): Promise<void> {\n\tconst supabase = await createClient();\n\n\t// Get counts from sends table\n\tconst { data: stats } = await supabase\n\t\t.from(\"email_campaign_sends\")\n\t\t.select(\"status\")\n\t\t.eq(\"campaign_id\", campaignId);\n\n\tif (!stats) return;\n\n\tconst counts = {\n\t\tdelivered_count: stats.filter((s) => [\"delivered\", \"opened\", \"clicked\"].includes(s.status)).length,\n\t\topened_count: stats.filter((s) => [\"opened\", \"clicked\"].includes(s.status)).length,\n\t\tunique_opens: stats.filter((s) => [\"opened\", \"clicked\"].includes(s.status)).length,\n\t\tclicked_count: stats.filter((s) => s.status === \"clicked\").length,\n\t\tunique_clicks: stats.filter((s) => s.status === \"clicked\").length,\n\t\tbounced_count: stats.filter((s) => s.status === \"bounced\").length,\n\t\tcomplained_count: stats.filter((s) => s.status === \"complained\").length,\n\t};\n\n\tawait supabase\n\t\t.from(\"email_campaigns\")\n\t\t.update(counts)\n\t\t.eq(\"id\", campaignId);\n}\n\n/**\n * Map database row to EmailCampaign type\n */\nfunction mapCampaignFromDb(row: Record<string, unknown>): EmailCampaign {\n\treturn {\n\t\tid: row.id as string,\n\t\tname: row.name as string,\n\t\tsubject: row.subject as string,\n\t\tpreviewText: row.preview_text as string | undefined,\n\t\ttemplateId: row.template_id as string | undefined,\n\t\ttemplateData: row.template_data as Record<string, unknown> | undefined,\n\t\thtmlContent: row.html_content as string | undefined,\n\t\tplainTextContent: row.plain_text_content as string | undefined,\n\t\tstatus: row.status as EmailCampaign[\"status\"],\n\t\tscheduledFor: row.scheduled_for as string | undefined,\n\t\taudienceType: row.audience_type as EmailCampaign[\"audienceType\"],\n\t\taudienceFilter: row.audience_filter as EmailCampaign[\"audienceFilter\"],\n\t\ttotalRecipients: (row.total_recipients as number) || 0,\n\t\tsentCount: (row.sent_count as number) || 0,\n\t\tdeliveredCount: (row.delivered_count as number) || 0,\n\t\topenedCount: (row.opened_count as number) || 0,\n\t\tuniqueOpens: (row.unique_opens as number) || 0,\n\t\tclickedCount: (row.clicked_count as number) || 0,\n\t\tuniqueClicks: (row.unique_clicks as number) || 0,\n\t\tbouncedCount: (row.bounced_count as number) || 0,\n\t\tcomplainedCount: (row.complained_count as number) || 0,\n\t\tunsubscribedCount: (row.unsubscribed_count as number) || 0,\n\t\tfailedCount: (row.failed_count as number) || 0,\n\t\trevenueAttributed: Number(row.revenue_attributed || 0),\n\t\tconversionsCount: (row.conversions_count as number) || 0,\n\t\tfromName: row.from_name as string,\n\t\tfromEmail: row.from_email as string,\n\t\treplyTo: row.reply_to as string | undefined,\n\t\ttags: (row.tags as string[]) || [],\n\t\tnotes: row.notes as string | undefined,\n\t\tcreatedAt: row.created_at as string,\n\t\tupdatedAt: row.updated_at as string,\n\t\tsentAt: row.sent_at as string | undefined,\n\t};\n}\n"],"names":[],"mappings":"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"}